var _a=Object.defineProperty;var pa=(r,e,t)=>e in r?_a(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var mt=(r,e,t)=>(pa(r,typeof e!="symbol"?e+"":e,t),t);import{i as ma,g as ga,s as kr,a as $e,t as C,c as ke,b as v,f as ha,S as se,d as ae,e as ie,h as Qe,j as w,n as Y,k as y,l as h,m as z,o as M,p as T,q as m,r as oe,u as X,v as Ie,w as ne,x as Zn,y as Ne,z as Ee,A as Re,B as ct,C as Le,D as Se,E as ut,F as ba,G as Mo,H as wa,I as ze,J as A,K as F,L as Oe,M as P,N as ee,O as Kn,P as le,Q as de,R as Xt,T as Nr,U as Ho,V as Pt,W as fs,X as To,Y as qe,Z as Ue,_ as Ao,$ as jt,a0 as ya,a1 as hn,a2 as Go,a3 as cs,a4 as xn,a5 as va,a6 as tn,a7 as ds,a8 as Ur,a9 as $a,aa as ka,ab as Ca,ac as Sa,ad as Er,ae as La,af as We,ag as dn,ah as vt,ai as ao,aj as _n,ak as At,al as Ve,am as It,an as rn,ao as _s,ap as ps,aq as Zt,ar as $t,as as tt,at as Ke,au as Wo,av as Ma,aw as Ta,ax as Aa,ay as Fa,az as _t,aA as rt,aB as kn,aC as Ae,aD as Vt,aE as _e,aF as er,aG as ot,aH as Fn,aI as Rr,aJ as uo,aK as Fo,aL as St,aM as ms,aN as fo,aO as qo,aP as Tr,aQ as tr,aR as nr,aS as co,aT as Jo,aU as Pa,aV as Yo,aW as _o,aX as ja,aY as Ia,aZ as Na}from"./pico.conditional.jade.min-c470e1a1.js";function Zo(r,e){const t=e.token={};function n(o,l,i,s){if(e.token!==t)return;e.resolved=s;let a=e.ctx;i!==void 0&&(a=a.slice(),a[i]=s);const u=o&&(e.current=o)(a);let f=!1;e.block&&(e.blocks?e.blocks.forEach((c,_)=>{_!==l&&c&&($e(),C(c,1,1,()=>{e.blocks[_]===c&&(e.blocks[_]=null)}),ke())}):e.block.d(1),u.c(),v(u,1),u.m(e.mount(),e.anchor),f=!0),e.block=u,e.blocks&&(e.blocks[l]=u),f&&ha()}if(ma(r)){const o=ga();if(r.then(l=>{kr(o),n(e.then,1,e.value,l),kr(null)},l=>{if(kr(o),n(e.catch,2,e.error,l),kr(null),!e.hasCatch)throw l}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function Ea(r,e,t){const n=e.slice(),{resolved:o}=r;r.current===r.then&&(n[r.value]=o),r.current===r.catch&&(n[r.error]=o),r.block.p(n,t)}function He(r,e){const t={},n={},o={$$scope:1};let l=r.length;for(;l--;){const i=r[l],s=e[l];if(s){for(const a in i)a in s||(n[a]=1);for(const a in s)o[a]||(t[a]=s[a],o[a]=1);r[l]=s}else for(const a in i)o[a]=1}for(const i in n)i in t||(t[i]=void 0);return t}function In(r){return typeof r=="object"&&r!==null?r:{}}const gs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",Ra="/ltn/assets/logo-97f2d067.svg",hs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Ko(r){let e,t,n,o=r[1]!=null&&Xo(r);return{c(){e=h("div"),t=z(r[0]),n=M(),o&&o.c(),T(e,"class","cover svelte-1w7hi45")},m(l,i){w(l,e,i),m(e,t),m(e,n),o&&o.m(e,null)},p(l,i){i&1&&oe(t,l[0]),l[1]!=null?o?o.p(l,i):(o=Xo(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&y(e),o&&o.d()}}}function Xo(r){let e,t;return{c(){e=h("div"),t=h("progress"),t.value=r[1],X(t,"width","100%")},m(n,o){w(n,e,o),m(e,t)},p(n,o){o&2&&(t.value=n[1])},d(n){n&&y(e)}}}function za(r){let e,t=r[0]&&Ko(r);return{c(){t&&t.c(),e=Qe()},m(n,o){t&&t.m(n,o),w(n,e,o)},p(n,[o]){n[0]?t?t.p(n,o):(t=Ko(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Y,o:Y,d(n){n&&y(e),t&&t.d(n)}}}function Oa(r,e,t){let{loading:n}=e,{progress:o=null}=e;return r.$$set=l=>{"loading"in l&&t(0,n=l.loading),"progress"in l&&t(1,o=l.progress)},[n,o]}class bs extends se{constructor(e){super(),ae(this,e,Oa,za,ie,{loading:0,progress:1})}}function Ba(r){let e,t,n,o,l;const i=r[5].default,s=Ie(i,r,r[4],null);return{c(){e=h("dialog"),t=h("article"),s&&s.c()},m(a,u){w(a,e,u),m(e,t),s&&s.m(t,null),r[6](e),n=!0,o||(l=[ne(e,"click",Zn(r[1])),ne(e,"keydown",r[2])],o=!0)},p(a,[u]){s&&s.p&&(!n||u&16)&&Ne(s,i,a,a[4],n?Re(i,a[4],u,null):Ee(a[4]),null)},i(a){n||(v(s,a),n=!0)},o(a){C(s,a),n=!1},d(a){a&&y(e),s&&s.d(a),r[6](null),o=!1,ct(l)}}}function Da(r,e,t){let{$$slots:n={},$$scope:o}=e,{show:l=!1}=e,i;function s(f){f.target==i&&t(3,l=!1)}function a(f){(f.key=="Escape"||f.key=="Enter")&&(f.stopPropagation(),t(3,l=!1))}function u(f){Le[f?"unshift":"push"](()=>{i=f,t(0,i)})}return r.$$set=f=>{"show"in f&&t(3,l=f.show),"$$scope"in f&&t(4,o=f.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&i&&(l?i.showModal():i.close())},[i,s,a,l,o,n,u]}class Hr extends se{constructor(e){super(),ae(this,e,Da,Ba,ie,{show:3})}}function Vo(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Qo(r){let e,t,n=r[1]+"",o,l,i,s=r[2]+"",a,u;return{c(){e=h("tr"),t=h("td"),o=z(n),l=M(),i=h("td"),a=z(s),u=M()},m(f,c){w(f,e,c),m(e,t),m(t,o),m(e,l),m(e,i),m(i,a),m(e,u)},p(f,c){c&1&&n!==(n=f[1]+"")&&oe(o,n),c&1&&s!==(s=f[2]+"")&&oe(a,s)},d(f){f&&y(e)}}}function Ua(r){let e,t,n=Se(Object.entries(r[0])),o=[];for(let l=0;l<n.length;l+=1)o[l]=Qo(Vo(r,n,l));return{c(){e=h("table"),t=h("tbody");for(let l=0;l<o.length;l+=1)o[l].c();T(e,"class","svelte-lh2o9l")},m(l,i){w(l,e,i),m(e,t);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(t,null)},p(l,[i]){if(i&1){n=Se(Object.entries(l[0]));let s;for(s=0;s<n.length;s+=1){const a=Vo(l,n,s);o[s]?o[s].p(a,i):(o[s]=Qo(a),o[s].c(),o[s].m(t,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},i:Y,o:Y,d(l){l&&y(e),ut(o,l)}}}function Ha(r,e,t){let{properties:n}=e;return r.$$set=o=>{"properties"in o&&t(0,n=o.properties)},[n]}class sr extends se{constructor(e){super(),ae(this,e,Ha,Ua,ie,{properties:0})}}function xo(r,e,t){const n=r.slice();return n[2]=e[t][0],n[6]=e[t][1],n}function el(r,e,t){const n=r.slice();return n[2]=e[t][0],n[3]=e[t][1],n}function tl(r,e,t){const n=r.slice();return n[3]=e[t][0],n[6]=e[t][1],n}function Ga(r){let e,t=Se(Object.entries(r[0])),n=[];for(let o=0;o<t.length;o+=1)n[o]=nl(xo(r,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Qe()},m(o,l){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,l);w(o,e,l)},p(o,l){if(l&1){t=Se(Object.entries(o[0]));let i;for(i=0;i<t.length;i+=1){const s=xo(o,t,i);n[i]?n[i].p(s,l):(n[i]=nl(s),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&y(e),ut(n,o)}}}function Wa(r){let e,t,n,o=Se(Object.entries(r[0])),l=[];for(let a=0;a<o.length;a+=1)l[a]=rl(tl(r,o,a));let i=Se(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=ol(el(r,i,a));return{c(){e=h("div");for(let a=0;a<l.length;a+=1)l[a].c();t=M(),n=h("div");for(let a=0;a<s.length;a+=1)s[a].c();X(e,"display","flex"),X(n,"display","flex"),X(n,"justify-content","space-between")},m(a,u){w(a,e,u);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);w(a,t,u),w(a,n,u);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(n,null)},p(a,u){if(u&1){o=Se(Object.entries(a[0]));let f;for(f=0;f<o.length;f+=1){const c=tl(a,o,f);l[f]?l[f].p(c,u):(l[f]=rl(c),l[f].c(),l[f].m(e,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=o.length}if(u&1){i=Se(Object.entries(a[0]));let f;for(f=0;f<i.length;f+=1){const c=el(a,i,f);s[f]?s[f].p(c,u):(s[f]=ol(c),s[f].c(),s[f].m(n,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=i.length}},d(a){a&&(y(e),y(t),y(n)),ut(l,a),ut(s,a)}}}function nl(r){let e,t,n,o=r[2]+"",l,i;return{c(){e=h("div"),t=h("span"),n=M(),l=z(o),i=M(),T(t,"class","vertical-block svelte-rl95zk"),X(t,"background",r[6])},m(s,a){w(s,e,a),m(e,t),m(e,n),m(e,l),m(e,i)},p(s,a){a&1&&X(t,"background",s[6]),a&1&&o!==(o=s[2]+"")&&oe(l,o)},d(s){s&&y(e)}}}function rl(r){let e,t;return{c(){e=h("span"),t=z(` 
      `),X(e,"background",r[6]),X(e,"width","100%"),X(e,"border","1px solid black")},m(n,o){w(n,e,o),m(e,t)},p(n,o){o&1&&X(e,"background",n[6])},d(n){n&&y(e)}}}function ol(r){let e,t=r[2]+"",n;return{c(){e=h("span"),n=z(t)},m(o,l){w(o,e,l),m(e,n)},p(o,l){l&1&&t!==(t=o[2]+"")&&oe(n,t)},d(o){o&&y(e)}}}function qa(r){let e;function t(l,i){return l[1]?Wa:Ga}let n=t(r),o=n(r);return{c(){o.c(),e=Qe()},m(l,i){o.m(l,i),w(l,e,i)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},i:Y,o:Y,d(l){l&&y(e),o.d(l)}}}function Ja(r,e,t){let{colors:n}=e,{horiz:o=!1}=e;return r.$$set=l=>{"colors"in l&&t(0,n=l.colors),"horiz"in l&&t(1,o=l.horiz)},[n,o]}class Gr extends se{constructor(e){super(),ae(this,e,Ja,qa,ie,{colors:0,horiz:1})}}function ll(r,e,t){const n=r.slice();return n[3]=e[t],n}function il(r,e,t){const n=r.slice();return n[6]=e[t],n}function sl(r){let e,t;return{c(){e=h("span"),t=z(` 
    `),X(e,"background",r[6]),X(e,"width","100%"),X(e,"border","1px solid black")},m(n,o){w(n,e,o),m(e,t)},p(n,o){o&1&&X(e,"background",n[6])},d(n){n&&y(e)}}}function Ya(r){let e,t=r[3]+"",n;return{c(){e=h("span"),n=z(t)},m(o,l){w(o,e,l),m(e,n)},p(o,l){l&2&&t!==(t=o[3]+"")&&oe(n,t)},d(o){o&&y(e)}}}function Za(r){let e,t=r[3].toFixed(r[2])+"",n;return{c(){e=h("span"),n=z(t)},m(o,l){w(o,e,l),m(e,n)},p(o,l){l&6&&t!==(t=o[3].toFixed(o[2])+"")&&oe(n,t)},d(o){o&&y(e)}}}function al(r){let e;function t(l,i){return l[2]>0?Za:Ya}let n=t(r),o=n(r);return{c(){o.c(),e=Qe()},m(l,i){o.m(l,i),w(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&y(e),o.d(l)}}}function Ka(r){let e,t,n,o=Se(r[0]),l=[];for(let a=0;a<o.length;a+=1)l[a]=sl(il(r,o,a));let i=Se(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=al(ll(r,i,a));return{c(){e=h("div");for(let a=0;a<l.length;a+=1)l[a].c();t=M(),n=h("div");for(let a=0;a<s.length;a+=1)s[a].c();X(e,"display","flex"),X(n,"display","flex"),X(n,"justify-content","space-between")},m(a,u){w(a,e,u);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);w(a,t,u),w(a,n,u);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(n,null)},p(a,[u]){if(u&1){o=Se(a[0]);let f;for(f=0;f<o.length;f+=1){const c=il(a,o,f);l[f]?l[f].p(c,u):(l[f]=sl(c),l[f].c(),l[f].m(e,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=o.length}if(u&6){i=Se(a[1]);let f;for(f=0;f<i.length;f+=1){const c=ll(a,i,f);s[f]?s[f].p(c,u):(s[f]=al(c),s[f].c(),s[f].m(n,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=i.length}},i:Y,o:Y,d(a){a&&(y(e),y(t),y(n)),ut(l,a),ut(s,a)}}}function Xa(r,e,t){let{colorScale:n}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&t(0,n=i.colorScale),"limits"in i&&t(1,o=i.limits),"decimalPlaces"in i&&t(2,l=i.decimalPlaces)},[n,o,l]}class Nn extends se{constructor(e){super(),ae(this,e,Xa,Ka,ie,{colorScale:0,limits:1,decimalPlaces:2})}}function zr(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function gt(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let pe;const ws=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ws.decode();let Un=null;function Xn(){return(Un===null||Un.byteLength===0)&&(Un=new Uint8Array(pe.memory.buffer)),Un}function Ht(r,e){return r=r>>>0,ws.decode(Xn().subarray(r,r+e))}const sn=new Array(128).fill(void 0);sn.push(void 0,null,!0,!1);let Vn=sn.length;function ft(r){Vn===sn.length&&sn.push(sn.length+1);const e=Vn;return Vn=sn[e],sn[e]=r,e}function je(r){return sn[r]}function Va(r){r<132||(sn[r]=Vn,Vn=r)}function Mn(r){const e=je(r);return Va(r),e}function eo(r){return r==null}let Hn=null;function Qa(){return(Hn===null||Hn.byteLength===0)&&(Hn=new Float64Array(pe.memory.buffer)),Hn}let Gn=null;function De(){return(Gn===null||Gn.byteLength===0)&&(Gn=new Int32Array(pe.memory.buffer)),Gn}let pn=0;const Ar=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},xa=typeof Ar.encodeInto=="function"?function(r,e){return Ar.encodeInto(r,e)}:function(r,e){const t=Ar.encode(r);return e.set(t),{read:r.length,written:t.length}};function Cr(r,e,t){if(t===void 0){const s=Ar.encode(r),a=e(s.length,1)>>>0;return Xn().subarray(a,a+s.length).set(s),pn=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=Xn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=Xn().subarray(o+i,o+n),a=xa(r,s);i+=a.written}return pn=i,o}function po(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=po(r[0]));for(let i=1;i<o;i++)l+=", "+po(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function eu(r,e){const t=e(r.length*1,1)>>>0;return Xn().set(r,t/1),pn=r.length,t}function to(r,e){try{return r.apply(this,e)}catch(t){pe.__wbindgen_exn_store(ft(t))}}class Or{static __wrap(e){e=e>>>0;const t=Object.create(Or.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();pe.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=pe.__wbindgen_add_to_stack_pointer(-16),i=eu(e,pe.__wbindgen_malloc),s=pn;pe.jsroutesnapper_new(l,i,s);var t=De()[l/4+0],n=De()[l/4+1],o=De()[l/4+2];if(o)throw Mn(n);return Or.__wrap(t)}finally{pe.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){pe.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ft(e))}setAreaMode(){pe.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const l=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_getConfig(l,this.__wbg_ptr);var n=De()[l/4+0],o=De()[l/4+1];return e=n,t=o,Ht(n,o)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=De()[n/4+0],t=De()[n/4+1];let o;return e!==0&&(o=Ht(e,t).slice(),pe.__wbindgen_free(e,t*1)),o}finally{pe.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const l=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var n=De()[l/4+0],o=De()[l/4+1];return e=n,t=o,Ht(n,o)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(e,t,1)}}toggleSnapMode(){pe.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return pe.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){pe.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return pe.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return pe.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){pe.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_editExisting(o,this.__wbg_ptr,ft(e));var t=De()[o/4+0],n=De()[o/4+1];if(n)throw Mn(t)}finally{pe.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const l=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var n=De()[l/4+0],o=De()[l/4+1];return e=n,t=o,Ht(n,o)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const l=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var n=De()[l/4+0],o=De()[l/4+1];return e=n,t=o,Ht(n,o)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const f=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_routeNameForWaypoints(f,this.__wbg_ptr,ft(e));var o=De()[f/4+0],l=De()[f/4+1],i=De()[f/4+2],s=De()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Mn(i);return t=a,n=u,Ht(a,u)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){pe.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){pe.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const f=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_calculateRoute(f,this.__wbg_ptr,ft(e));var o=De()[f/4+0],l=De()[f/4+1],i=De()[f/4+2],s=De()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Mn(i);return t=a,n=u,Ht(a,u)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,o;try{const c=pe.__wbindgen_add_to_stack_pointer(-16);pe.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,ft(e),ft(t));var l=De()[c/4+0],i=De()[c/4+1],s=De()[c/4+2],a=De()[c/4+3],u=l,f=i;if(a)throw u=0,f=0,Mn(s);return n=u,o=f,Ht(u,f)}finally{pe.__wbindgen_add_to_stack_pointer(16),pe.__wbindgen_free(n,o,1)}}}async function tu(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function nu(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ht(e,t);return ft(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Mn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ht(e,t));return ft(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=je(t),o=typeof n=="number"?n:void 0;Qa()[e/8+1]=eo(o)?0:o,De()[e/4+0]=!eo(o)},r.wbg.__wbindgen_is_object=function(e){const t=je(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return je(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return je(e)in je(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=je(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return je(e)==je(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=je(t),o=typeof n=="string"?n:void 0;var l=eo(o)?0:Cr(o,pe.__wbindgen_malloc,pe.__wbindgen_realloc),i=pn;De()[e/4+1]=i,De()[e/4+0]=l},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(je(t)),o=Cr(n,pe.__wbindgen_malloc,pe.__wbindgen_realloc),l=pn;De()[e/4+1]=l,De()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=je(e);return ft(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=je(e)[je(t)];return ft(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ft(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=je(t).stack,o=Cr(n,pe.__wbindgen_malloc,pe.__wbindgen_realloc),l=pn;De()[e/4+1]=l,De()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(Ht(e,t))}finally{pe.__wbindgen_free(n,o,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(je(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(je(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(je(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(je(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(je(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=je(e)[t>>>0];return ft(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return je(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof je(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=je(e).next;return ft(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return to(function(e){const t=je(e).next();return ft(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return je(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=je(e).value;return ft(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ft(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return to(function(e,t){const n=Reflect.get(je(e),je(t));return ft(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return to(function(e,t){const n=je(e).call(je(t));return ft(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(je(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=je(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=je(e).buffer;return ft(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(je(e));return ft(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){je(e).set(je(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return je(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=je(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=po(je(t)),o=Cr(n,pe.__wbindgen_malloc,pe.__wbindgen_realloc),l=pn;De()[e/4+1]=l,De()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ht(e,t))},r.wbg.__wbindgen_memory=function(){const e=pe.memory;return ft(e)},r}function ru(r,e){return pe=r.exports,ys.__wbindgen_wasm_module=e,Hn=null,Gn=null,Un=null,pe}async function ys(r){if(pe!==void 0)return pe;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=nu();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await tu(await r,e);return ru(t,n)}var yt=63710088e-1,Po={centimeters:yt*100,centimetres:yt*100,degrees:yt/111325,feet:yt*3.28084,inches:yt*39.37,kilometers:yt/1e3,kilometres:yt/1e3,meters:yt,metres:yt,miles:yt/1609.344,millimeters:yt*1e3,millimetres:yt*1e3,nauticalmiles:yt/1852,radians:1,yards:yt*1.0936},ou={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/yt,yards:1.0936133},mo={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function qt(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function lu(r,e,t){switch(r){case"Point":return Tt(e).geometry;case"LineString":return Gt(e).geometry;case"Polygon":return jo(e).geometry;case"MultiPoint":return $s(e).geometry;case"MultiLineString":return vs(e).geometry;case"MultiPolygon":return ks(e).geometry;default:throw new Error(r+" is invalid")}}function Tt(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Br(r[0])||!Br(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return qt(n,e,t)}function iu(r,e,t){return t===void 0&&(t={}),Cn(r.map(function(n){return Tt(n,e)}),t)}function jo(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var l=o[n];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<l[l.length-1].length;i++)if(l[l.length-1][i]!==l[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return qt(s,e,t)}function su(r,e,t){return t===void 0&&(t={}),Cn(r.map(function(n){return jo(n,e)}),t)}function Gt(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return qt(n,e,t)}function au(r,e,t){return t===void 0&&(t={}),Cn(r.map(function(n){return Gt(n,e)}),t)}function Cn(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function vs(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return qt(n,e,t)}function $s(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return qt(n,e,t)}function ks(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return qt(n,e,t)}function uu(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return qt(n,e,t)}function fu(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Io(r,e){e===void 0&&(e="kilometers");var t=Po[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Wr(r,e){e===void 0&&(e="kilometers");var t=Po[e];if(!t)throw new Error(e+" units is invalid");return r/t}function cu(r,e){return rr(Wr(r,e))}function du(r){var e=r%360;return e<0&&(e+=360),e}function rr(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Wt(r){var e=r%360;return e*Math.PI/180}function _u(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Io(Wr(r,e),t)}function pu(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=mo[e];if(!n)throw new Error("invalid original units");var o=mo[t];if(!o)throw new Error("invalid final units");return r/n*o}function Br(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function No(r){return!!r&&r.constructor===Object}function mu(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Br(e))throw new Error("bbox must only contain numbers")})}function gu(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const hu=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:mo,bearingToAzimuth:du,convertArea:pu,convertLength:_u,degreesToRadians:Wt,earthRadius:yt,factors:Po,feature:qt,featureCollection:Cn,geometry:lu,geometryCollection:uu,isNumber:Br,isObject:No,lengthToDegrees:cu,lengthToRadians:Wr,lineString:Gt,lineStrings:au,multiLineString:vs,multiPoint:$s,multiPolygon:ks,point:Tt,points:iu,polygon:jo,polygons:su,radiansToDegrees:rr,radiansToLength:Io,round:fu,unitsFactors:ou,validateBBox:mu,validateId:gu},Symbol.toStringTag,{value:"Module"}));function or(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Pn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function On(r,e,t){t===void 0&&(t={});var n=or(r),o=or(e),l=Wt(o[1]-n[1]),i=Wt(o[0]-n[0]),s=Wt(n[1]),a=Wt(o[1]),u=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return Io(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function ar(r,e,t){if(r!==null)for(var n,o,l,i,s,a,u,f=0,c=0,_,d=r.type,p=d==="FeatureCollection",g=d==="Feature",$=p?r.features.length:1,L=0;L<$;L++){u=p?r.features[L].geometry:g?r.geometry:r,_=u?u.type==="GeometryCollection":!1,s=_?u.geometries.length:1;for(var k=0;k<s;k++){var b=0,S=0;if(i=_?u.geometries[k]:u,i!==null){a=i.coordinates;var N=i.type;switch(f=t&&(N==="Polygon"||N==="MultiPolygon")?1:0,N){case null:break;case"Point":if(e(a,c,L,b,S)===!1)return!1;c++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,L,b,S)===!1)return!1;c++,N==="MultiPoint"&&b++}N==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-f;o++){if(e(a[n][o],c,L,b,S)===!1)return!1;c++}N==="MultiLineString"&&b++,N==="Polygon"&&S++}N==="Polygon"&&b++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(S=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-f;l++){if(e(a[n][o][l],c,L,b,S)===!1)return!1;c++}S++}b++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(ar(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function bu(r,e,t,n){var o=t;return ar(r,function(l,i,s,a,u){i===0&&t===void 0?o=l:o=e(o,l,i,s,a,u)},n),o}function Cs(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function wu(r,e,t){var n=t;return Cs(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function Dr(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function yu(r,e,t){var n=t;return Dr(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function vu(r){var e=[];return ar(r,function(t){e.push(t)}),e}function Eo(r,e){var t,n,o,l,i,s,a,u,f,c,_=0,d=r.type==="FeatureCollection",p=r.type==="Feature",g=d?r.features.length:1;for(t=0;t<g;t++){for(s=d?r.features[t].geometry:p?r.geometry:r,u=d?r.features[t].properties:p?r.properties:{},f=d?r.features[t].bbox:p?r.bbox:void 0,c=d?r.features[t].id:p?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,o=0;o<i;o++){if(l=a?s.geometries[o]:s,l===null){if(e(null,_,u,f,c)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,_,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(e(l.geometries[n],_,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function $u(r,e,t){var n=t;return Eo(r,function(o,l,i,s,a){l===0&&t===void 0?n=o:n=e(n,o,l,i,s,a)}),n}function En(r,e){Eo(r,function(t,n,o,l,i){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(qt(t,o,{bbox:l,id:i}),n,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(qt(c,o),n,u)===!1)return!1}})}function ku(r,e,t){var n=t;return En(r,function(o,l,i){l===0&&i===0&&t===void 0?n=o:n=e(n,o,l,i)}),n}function Ss(r,e){En(r,function(t,n,o){var l=0;if(t.geometry){var i=t.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,u=0,f=0;if(ar(t,function(c,_,d,p,g){if(s===void 0||n>a||p>u||g>f){s=c,a=n,u=p,f=g,l=0;return}var $=Gt([s,c],t.properties);if(e($,n,o,g,l)===!1)return!1;l++,s=c})===!1)return!1}}})}function Cu(r,e,t){var n=t,o=!1;return Ss(r,function(l,i,s,a,u){o===!1&&t===void 0?n=l:n=e(n,l,i,s,a,u),o=!0}),n}function Ls(r,e){if(!r)throw new Error("geojson is required");En(r,function(t,n,o){if(t.geometry!==null){var l=t.geometry.type,i=t.geometry.coordinates;switch(l){case"LineString":if(e(t,n,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Gt(i[s],t.properties),n,o,s)===!1)return!1;break}}})}function Su(r,e,t){var n=t;return Ls(r,function(o,l,i,s){l===0&&t===void 0?n=o:n=e(n,o,l,i,s)}),n}function Lu(r,e){if(e=e||{},!No(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=a.length+l-1),Gt([a[l],a[l+1]],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l-1),Gt([a[o][l],a[o][l+1]],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l-1),Gt([a[n][l],a[n][l+1]],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l-1),Gt([a[n][o][l],a[n][o][l+1]],i,e)}throw new Error("geojson is invalid")}function Mu(r,e){if(e=e||{},!No(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return Tt(a,i,e);case"MultiPoint":return n<0&&(n=a.length+n),Tt(a[n],i,e);case"LineString":return l<0&&(l=a.length+l),Tt(a[l],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l),Tt(a[o][l],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l),Tt(a[n][l],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l),Tt(a[n][o][l],i,e)}throw new Error("geojson is invalid")}const Tu=Object.freeze(Object.defineProperty({__proto__:null,coordAll:vu,coordEach:ar,coordReduce:bu,featureEach:Dr,featureReduce:yu,findPoint:Mu,findSegment:Lu,flattenEach:En,flattenReduce:ku,geomEach:Eo,geomReduce:$u,lineEach:Ls,lineReduce:Su,propEach:Cs,propReduce:wu,segmentEach:Ss,segmentReduce:Cu},Symbol.toStringTag,{value:"Module"}));function Ms(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Au(r,e);var n=or(r),o=or(e),l=Wt(n[0]),i=Wt(o[0]),s=Wt(n[1]),a=Wt(o[1]),u=Math.sin(i-l)*Math.cos(a),f=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return rr(Math.atan2(u,f))}function Au(r,e){var t=Ms(e,r);return t=(t+180)%360,t}function ul(r,e,t,n){n===void 0&&(n={});var o=or(r),l=Wt(o[0]),i=Wt(o[1]),s=Wt(t),a=Wr(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),f=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(u)),c=rr(f),_=rr(u);return Tt([c,_],n.properties)}function fl(r){if(!r)throw new Error("geojson is required");var e=[];return En(r,function(t){Fu(t,e)}),Cn(e)}function Fu(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Pn(n);break;case"LineString":t=[Pn(n)]}t.forEach(function(o){var l=Pu(o,r.properties);l.forEach(function(i){i.id=e.length,e.push(i)})})}}function Pu(r,e){var t=[];return r.reduce(function(n,o){var l=Gt([n,o],e);return l.bbox=ju(n,o),t.push(l),o}),t}function ju(r,e){var t=r[0],n=r[1],o=e[0],l=e[1],i=t<o?t:o,s=n<l?n:l,a=t>o?t:o,u=n>l?n:l;return[i,s,a,u]}var Ro={exports:{}},Ts={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(ba,function(){function t(k,b,S,N,j){(function I(R,D,B,E,O){for(;E>B;){if(E-B>600){var H=E-B+1,W=D-B+1,Z=Math.log(H),re=.5*Math.exp(2*Z/3),ce=.5*Math.sqrt(Z*re*(H-re)/H)*(W-H/2<0?-1:1),U=Math.max(B,Math.floor(D-W*re/H+ce)),be=Math.min(E,Math.floor(D+(H-W)*re/H+ce));I(R,D,U,be,O)}var fe=R[D],te=B,me=E;for(n(R,B,D),O(R[E],fe)>0&&n(R,B,E);te<me;){for(n(R,te,me),te++,me--;O(R[te],fe)<0;)te++;for(;O(R[me],fe)>0;)me--}O(R[B],fe)===0?n(R,B,me):n(R,++me,E),me<=D&&(B=me+1),D<=me&&(E=me-1)}})(k,b,S||0,N||k.length-1,j||o)}function n(k,b,S){var N=k[b];k[b]=k[S],k[S]=N}function o(k,b){return k<b?-1:k>b?1:0}var l=function(k){k===void 0&&(k=9),this._maxEntries=Math.max(4,k),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(k,b,S){if(!S)return b.indexOf(k);for(var N=0;N<b.length;N++)if(S(k,b[N]))return N;return-1}function s(k,b){a(k,0,k.children.length,b,k)}function a(k,b,S,N,j){j||(j=$(null)),j.minX=1/0,j.minY=1/0,j.maxX=-1/0,j.maxY=-1/0;for(var I=b;I<S;I++){var R=k.children[I];u(j,k.leaf?N(R):R)}return j}function u(k,b){return k.minX=Math.min(k.minX,b.minX),k.minY=Math.min(k.minY,b.minY),k.maxX=Math.max(k.maxX,b.maxX),k.maxY=Math.max(k.maxY,b.maxY),k}function f(k,b){return k.minX-b.minX}function c(k,b){return k.minY-b.minY}function _(k){return(k.maxX-k.minX)*(k.maxY-k.minY)}function d(k){return k.maxX-k.minX+(k.maxY-k.minY)}function p(k,b){return k.minX<=b.minX&&k.minY<=b.minY&&b.maxX<=k.maxX&&b.maxY<=k.maxY}function g(k,b){return b.minX<=k.maxX&&b.minY<=k.maxY&&b.maxX>=k.minX&&b.maxY>=k.minY}function $(k){return{children:k,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function L(k,b,S,N,j){for(var I=[b,S];I.length;)if(!((S=I.pop())-(b=I.pop())<=N)){var R=b+Math.ceil((S-b)/N/2)*N;t(k,R,b,S,j),I.push(b,R,R,S)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(k){var b=this.data,S=[];if(!g(k,b))return S;for(var N=this.toBBox,j=[];b;){for(var I=0;I<b.children.length;I++){var R=b.children[I],D=b.leaf?N(R):R;g(k,D)&&(b.leaf?S.push(R):p(k,D)?this._all(R,S):j.push(R))}b=j.pop()}return S},l.prototype.collides=function(k){var b=this.data;if(!g(k,b))return!1;for(var S=[];b;){for(var N=0;N<b.children.length;N++){var j=b.children[N],I=b.leaf?this.toBBox(j):j;if(g(k,I)){if(b.leaf||p(k,I))return!0;S.push(j)}}b=S.pop()}return!1},l.prototype.load=function(k){if(!k||!k.length)return this;if(k.length<this._minEntries){for(var b=0;b<k.length;b++)this.insert(k[b]);return this}var S=this._build(k.slice(),0,k.length-1,0);if(this.data.children.length)if(this.data.height===S.height)this._splitRoot(this.data,S);else{if(this.data.height<S.height){var N=this.data;this.data=S,S=N}this._insert(S,this.data.height-S.height-1,!0)}else this.data=S;return this},l.prototype.insert=function(k){return k&&this._insert(k,this.data.height-1),this},l.prototype.clear=function(){return this.data=$([]),this},l.prototype.remove=function(k,b){if(!k)return this;for(var S,N,j,I=this.data,R=this.toBBox(k),D=[],B=[];I||D.length;){if(I||(I=D.pop(),N=D[D.length-1],S=B.pop(),j=!0),I.leaf){var E=i(k,I.children,b);if(E!==-1)return I.children.splice(E,1),D.push(I),this._condense(D),this}j||I.leaf||!p(I,R)?N?(S++,I=N.children[S],j=!1):I=null:(D.push(I),B.push(S),S=0,N=I,I=I.children[0])}return this},l.prototype.toBBox=function(k){return k},l.prototype.compareMinX=function(k,b){return k.minX-b.minX},l.prototype.compareMinY=function(k,b){return k.minY-b.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(k){return this.data=k,this},l.prototype._all=function(k,b){for(var S=[];k;)k.leaf?b.push.apply(b,k.children):S.push.apply(S,k.children),k=S.pop();return b},l.prototype._build=function(k,b,S,N){var j,I=S-b+1,R=this._maxEntries;if(I<=R)return s(j=$(k.slice(b,S+1)),this.toBBox),j;N||(N=Math.ceil(Math.log(I)/Math.log(R)),R=Math.ceil(I/Math.pow(R,N-1))),(j=$([])).leaf=!1,j.height=N;var D=Math.ceil(I/R),B=D*Math.ceil(Math.sqrt(R));L(k,b,S,B,this.compareMinX);for(var E=b;E<=S;E+=B){var O=Math.min(E+B-1,S);L(k,E,O,D,this.compareMinY);for(var H=E;H<=O;H+=D){var W=Math.min(H+D-1,O);j.children.push(this._build(k,H,W,N-1))}}return s(j,this.toBBox),j},l.prototype._chooseSubtree=function(k,b,S,N){for(;N.push(b),!b.leaf&&N.length-1!==S;){for(var j=1/0,I=1/0,R=void 0,D=0;D<b.children.length;D++){var B=b.children[D],E=_(B),O=(H=k,W=B,(Math.max(W.maxX,H.maxX)-Math.min(W.minX,H.minX))*(Math.max(W.maxY,H.maxY)-Math.min(W.minY,H.minY))-E);O<I?(I=O,j=E<j?E:j,R=B):O===I&&E<j&&(j=E,R=B)}b=R||b.children[0]}var H,W;return b},l.prototype._insert=function(k,b,S){var N=S?k:this.toBBox(k),j=[],I=this._chooseSubtree(N,this.data,b,j);for(I.children.push(k),u(I,N);b>=0&&j[b].children.length>this._maxEntries;)this._split(j,b),b--;this._adjustParentBBoxes(N,j,b)},l.prototype._split=function(k,b){var S=k[b],N=S.children.length,j=this._minEntries;this._chooseSplitAxis(S,j,N);var I=this._chooseSplitIndex(S,j,N),R=$(S.children.splice(I,S.children.length-I));R.height=S.height,R.leaf=S.leaf,s(S,this.toBBox),s(R,this.toBBox),b?k[b-1].children.push(R):this._splitRoot(S,R)},l.prototype._splitRoot=function(k,b){this.data=$([k,b]),this.data.height=k.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(k,b,S){for(var N,j,I,R,D,B,E,O=1/0,H=1/0,W=b;W<=S-b;W++){var Z=a(k,0,W,this.toBBox),re=a(k,W,S,this.toBBox),ce=(j=Z,I=re,R=void 0,D=void 0,B=void 0,E=void 0,R=Math.max(j.minX,I.minX),D=Math.max(j.minY,I.minY),B=Math.min(j.maxX,I.maxX),E=Math.min(j.maxY,I.maxY),Math.max(0,B-R)*Math.max(0,E-D)),U=_(Z)+_(re);ce<O?(O=ce,N=W,H=U<H?U:H):ce===O&&U<H&&(H=U,N=W)}return N||S-b},l.prototype._chooseSplitAxis=function(k,b,S){var N=k.leaf?this.compareMinX:f,j=k.leaf?this.compareMinY:c;this._allDistMargin(k,b,S,N)<this._allDistMargin(k,b,S,j)&&k.children.sort(N)},l.prototype._allDistMargin=function(k,b,S,N){k.children.sort(N);for(var j=this.toBBox,I=a(k,0,b,j),R=a(k,S-b,S,j),D=d(I)+d(R),B=b;B<S-b;B++){var E=k.children[B];u(I,k.leaf?j(E):E),D+=d(I)}for(var O=S-b-1;O>=b;O--){var H=k.children[O];u(R,k.leaf?j(H):H),D+=d(R)}return D},l.prototype._adjustParentBBoxes=function(k,b,S){for(var N=S;N>=0;N--)u(b[N],k)},l.prototype._condense=function(k){for(var b=k.length-1,S=void 0;b>=0;b--)k[b].children.length===0?b>0?(S=k[b-1].children).splice(S.indexOf(k[b]),1):this.clear():s(k[b],this.toBBox)},l})})(Ts);var Iu=Ts.exports;const Nu=Mo(hu),Eu=Mo(Tu);function As(r,e,t){if(r!==null)for(var n,o,l,i,s,a,u,f=0,c=0,_,d=r.type,p=d==="FeatureCollection",g=d==="Feature",$=p?r.features.length:1,L=0;L<$;L++){u=p?r.features[L].geometry:g?r.geometry:r,_=u?u.type==="GeometryCollection":!1,s=_?u.geometries.length:1;for(var k=0;k<s;k++){var b=0,S=0;if(i=_?u.geometries[k]:u,i!==null){a=i.coordinates;var N=i.type;switch(f=t&&(N==="Polygon"||N==="MultiPolygon")?1:0,N){case null:break;case"Point":if(e(a,c,L,b,S)===!1)return!1;c++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,L,b,S)===!1)return!1;c++,N==="MultiPoint"&&b++}N==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-f;o++){if(e(a[n][o],c,L,b,S)===!1)return!1;c++}N==="MultiLineString"&&b++,N==="Polygon"&&S++}N==="Polygon"&&b++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(S=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-f;l++){if(e(a[n][o][l],c,L,b,S)===!1)return!1;c++}S++}b++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(As(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Fs(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return As(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Ru=Fs;const zu=Object.freeze(Object.defineProperty({__proto__:null,bbox:Fs,default:Ru},Symbol.toStringTag,{value:"Module"})),Ou=Mo(zu);var en=Iu,Ps=Nu,js=Eu,Ln=Ou.default,Bu=js.featureEach;js.coordEach;Ps.polygon;var cl=Ps.featureCollection;function Is(r){var e=new en(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ln(t),en.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:Ln(o),n.push(o)}):Bu(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:Ln(o),n.push(o)}),en.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ln(t),en.prototype.remove.call(this,t,n)},e.clear=function(){return en.prototype.clear.call(this)},e.search=function(t){var n=en.prototype.search.call(this,this.toBBox(t));return cl(n)},e.collides=function(t){return en.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=en.prototype.all.call(this);return cl(t)},e.toJSON=function(){return en.prototype.toJSON.call(this)},e.fromJSON=function(t){return en.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Ln(t);else if(t.type==="FeatureCollection")n=Ln(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ro.exports=Is;Ro.exports.default=Is;var Du=Ro.exports;const Uu=wa(Du);function Hu(r,e){var t={},n=[];if(r.type==="LineString"&&(r=qt(r)),e.type==="LineString"&&(e=qt(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=dl(r,e);return o&&n.push(o),Cn(n)}var l=Uu();return l.load(fl(e)),Dr(fl(r),function(i){Dr(l.search(i),function(s){var a=dl(i,s);if(a){var u=Pn(a).join(",");t[u]||(t[u]=!0,n.push(a))}})}),Cn(n)}function dl(r,e){var t=Pn(r),n=Pn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],l=t[0][1],i=t[1][0],s=t[1][1],a=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],_=(c-u)*(i-o)-(f-a)*(s-l),d=(f-a)*(l-u)-(c-u)*(o-a),p=(i-o)*(l-u)-(s-l)*(o-a);if(_===0)return null;var g=d/_,$=p/_;if(g>=0&&g<=1&&$>=0&&$<=1){var L=o+g*(i-o),k=l+g*(s-l);return Tt([L,k])}return null}function Gu(r,e,t){t===void 0&&(t={});var n=Tt([1/0,1/0],{dist:1/0}),o=0;return En(r,function(l){for(var i=Pn(l),s=0;s<i.length-1;s++){var a=Tt(i[s]);a.properties.dist=On(e,a,t);var u=Tt(i[s+1]);u.properties.dist=On(e,u,t);var f=On(a,u,t),c=Math.max(a.properties.dist,u.properties.dist),_=Ms(a,u),d=ul(e,c,_+90,t),p=ul(e,c,_-90,t),g=Hu(Gt([d.geometry.coordinates,p.geometry.coordinates]),Gt([a.geometry.coordinates,u.geometry.coordinates])),$=null;g.features.length>0&&($=g.features[0],$.properties.dist=On(e,$,t),$.properties.location=o+On(a,$,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=s,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=s+1,n.properties.location=o+f),$&&$.properties.dist<n.properties.dist&&(n=$,n.properties.index=s),o+=f}}),n}const Wu=30;class qu{constructor(e,t,n,o,l){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-Wu,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Or(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}function Ju(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;return{c(){e=h("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=M(),n=h("p"),n.innerHTML=`This is an <b>experimental</b>
    version of the
    <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
    . Most parts of it do not work yet, and you should probably use the other version
    of the tool instead.`,o=M(),l=h("p"),l.textContent="To use this tool, you need to:",i=M(),s=h("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
      restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
      effects</li>`,a=M(),u=h("p"),u.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
    and relies heavily on
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    data.`,f=M(),c=h("center"),_=h("button"),_.textContent="Start!"},m(g,$){w(g,e,$),w(g,t,$),w(g,n,$),w(g,o,$),w(g,l,$),w(g,i,$),w(g,s,$),w(g,a,$),w(g,u,$),w(g,f,$),w(g,c,$),m(c,_),d||(p=ne(_,"click",r[1]),d=!0)},p:Y,d(g){g&&(y(e),y(t),y(n),y(o),y(l),y(i),y(s),y(a),y(u),y(f),y(c)),d=!1,p()}}}function Yu(r){let e,t,n;function o(i){r[2](i)}let l={$$slots:{default:[Ju]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.show=r[0]),e=new Hr({props:l}),Le.push(()=>ze(e,"show",o)),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&9&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.show=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function Zu(r,e,t){let n;ee(r,Kn,i=>t(0,n=i));const o=()=>le(Kn,n=!1,n);function l(i){n=i,Kn.set(n)}return[n,o,l]}class Ku extends se{constructor(e){super(),ae(this,e,Zu,Yu,ie,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const Xu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},_l=Xu;function pl(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function no(r){let e,t=[r[12]],n={};for(let o=0;o<t.length;o+=1)n=de(n,t[o]);return{c(){e=Xt(r[11]),Nr(e,n)},m(o,l){w(o,e,l)},p(o,l){Nr(e,n=He(t,[l&32&&o[12]]))},d(o){o&&y(e)}}}function ml(r){let e=r[11],t,n=r[11]&&no(r);return{c(){n&&n.c(),t=Qe()},m(o,l){n&&n.m(o,l),w(o,t,l)},p(o,l){o[11]?e?ie(e,o[11])?(n.d(1),n=no(o),e=o[11],n.c(),n.m(t.parentNode,t)):n.p(o,l):(n=no(o),e=o[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=o[11])},d(o){o&&y(t),n&&n.d(o)}}}function Vu(r){let e,t,n,o,l,i=Se(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=ml(pl(r,i,_));const a=r[10].default,u=Ie(a,r,r[9],null);let f=[_l,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:o=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<f.length;_+=1)c=de(c,f[_]);return{c(){e=Xt("svg");for(let _=0;_<s.length;_+=1)s[_].c();t=Qe(),u&&u.c(),Nr(e,c)},m(_,d){w(_,e,d);for(let p=0;p<s.length;p+=1)s[p]&&s[p].m(e,null);m(e,t),u&&u.m(e,null),l=!0},p(_,[d]){if(d&32){i=Se(_[5]);let p;for(p=0;p<i.length;p+=1){const g=pl(_,i,p);s[p]?s[p].p(g,d):(s[p]=ml(g),s[p].c(),s[p].m(e,t))}for(;p<s.length;p+=1)s[p].d(1);s.length=i.length}u&&u.p&&(!l||d&512)&&Ne(u,a,_,_[9],l?Re(a,_[9],d,null):Ee(_[9]),null),Nr(e,c=He(f,[_l,d&128&&_[7],(!l||d&4)&&{width:_[2]},(!l||d&4)&&{height:_[2]},(!l||d&2)&&{stroke:_[1]},(!l||d&28&&n!==(n=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":n},(!l||d&257&&o!==(o=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:o}]))},i(_){l||(v(u,_),l=!0)},o(_){C(u,_),l=!1},d(_){_&&y(e),ut(s,_),u&&u.d(_)}}}function Qu(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let o=Ho(e,n),{$$slots:l={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:u=24}=e,{strokeWidth:f=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...p)=>p.filter((g,$,L)=>!!g&&L.indexOf(g)===$).join(" ");return r.$$set=p=>{t(8,e=de(de({},e),Pt(p))),t(7,o=Ho(e,n)),"name"in p&&t(0,s=p.name),"color"in p&&t(1,a=p.color),"size"in p&&t(2,u=p.size),"strokeWidth"in p&&t(3,f=p.strokeWidth),"absoluteStrokeWidth"in p&&t(4,c=p.absoluteStrokeWidth),"iconNode"in p&&t(5,_=p.iconNode),"$$scope"in p&&t(9,i=p.$$scope)},e=Pt(e),[s,a,u,f,c,_,d,o,e,i,l]}class xu extends se{constructor(e){super(),ae(this,e,Qu,Vu,ie,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Rn=xu;function ef(r){let e;const t=r[2].default,n=Ie(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Ne(n,t,o,o[3],e?Re(t,o[3],l,null):Ee(o[3]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function tf(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[ef]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Rn({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&In(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function nf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{t(1,e=de(de({},e),Pt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Pt(e),[l,e,n,o]}class rf extends se{constructor(e){super(),ae(this,e,nf,tf,ie,{})}}const of=rf;function lf(r){let e;const t=r[2].default,n=Ie(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Ne(n,t,o,o[3],e?Re(t,o[3],l,null):Ee(o[3]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function sf(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[lf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Rn({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&In(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function af(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=i=>{t(1,e=de(de({},e),Pt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Pt(e),[l,e,n,o]}class uf extends se{constructor(e){super(),ae(this,e,af,sf,ie,{})}}const ff=uf;function cf(r){let e;const t=r[2].default,n=Ie(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Ne(n,t,o,o[3],e?Re(t,o[3],l,null):Ee(o[3]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function df(r){let e,t;const n=[{name:"circle-x"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[cf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Rn({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&In(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function _f(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"m15 9-6 6"}],["path",{d:"m9 9 6 6"}]];return r.$$set=i=>{t(1,e=de(de({},e),Pt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Pt(e),[l,e,n,o]}class pf extends se{constructor(e){super(),ae(this,e,_f,df,ie,{})}}const mf=pf;function gf(r){let e;const t=r[2].default,n=Ie(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Ne(n,t,o,o[3],e?Re(t,o[3],l,null):Ee(o[3]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function hf(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[gf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Rn({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&In(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function bf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=i=>{t(1,e=de(de({},e),Pt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Pt(e),[l,e,n,o]}class wf extends se{constructor(e){super(),ae(this,e,bf,hf,ie,{})}}const yf=wf;function vf(r){let e;const t=r[2].default,n=Ie(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Ne(n,t,o,o[3],e?Re(t,o[3],l,null):Ee(o[3]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function $f(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[vf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Rn({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&In(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function kf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{t(1,e=de(de({},e),Pt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Pt(e),[l,e,n,o]}class Cf extends se{constructor(e){super(),ae(this,e,kf,$f,ie,{})}}const zo=Cf;function Sf(r){let e;const t=r[2].default,n=Ie(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Ne(n,t,o,o[3],e?Re(t,o[3],l,null):Ee(o[3]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Lf(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[Sf]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new Rn({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&3?He(n,[n[0],i&2&&In(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Mf(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{t(1,e=de(de({},e),Pt(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=Pt(e),[l,e,n,o]}class Tf extends se{constructor(e){super(),ae(this,e,Mf,Lf,ie,{})}}const Ns=Tf;function Af(r){let e;const t=r[16].default,n=Ie(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Ne(n,t,o,o[24],e?Re(t,o[24],l,null):Ee(o[24]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Ff(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Af]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new fs({props:l}),Le.push(()=>ze(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function Pf(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=To("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:L=!1}=e,{hovered:k=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:S=!0}=e;function N(O){k=O,t(0,k)}function j(O){qe.call(this,r,O)}function I(O){qe.call(this,r,O)}function R(O){qe.call(this,r,O)}function D(O){qe.call(this,r,O)}function B(O){qe.call(this,r,O)}function E(O){qe.call(this,r,O)}return r.$$set=O=>{"id"in O&&t(1,l=O.id),"source"in O&&t(2,i=O.source),"sourceLayer"in O&&t(3,s=O.sourceLayer),"beforeId"in O&&t(4,a=O.beforeId),"beforeLayerType"in O&&t(5,u=O.beforeLayerType),"paint"in O&&t(6,f=O.paint),"layout"in O&&t(7,c=O.layout),"filter"in O&&t(8,_=O.filter),"applyToClusters"in O&&t(9,d=O.applyToClusters),"minzoom"in O&&t(10,p=O.minzoom),"maxzoom"in O&&t(11,g=O.maxzoom),"hoverCursor"in O&&t(12,$=O.hoverCursor),"manageHoverState"in O&&t(13,L=O.manageHoverState),"hovered"in O&&t(0,k=O.hovered),"eventsIfTopMost"in O&&t(14,b=O.eventsIfTopMost),"interactive"in O&&t(15,S=O.interactive),"$$scope"in O&&t(24,o=O.$$scope)},[k,l,i,s,a,u,f,c,_,d,p,g,$,L,b,S,n,N,j,I,R,D,B,E,o]}let un=class extends se{constructor(e){super(),ae(this,e,Pf,Ff,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function jf(r){let e,t;const n=r[7].default,o=Ie(n,r,r[6],null);return{c(){e=h("div"),o&&o.c(),T(e,"class",r[1]),Ue(e,"maplibregl-ctrl",r[0])},m(l,i){w(l,e,i),o&&o.m(e,null),r[8](e),t=!0},p(l,[i]){o&&o.p&&(!t||i&64)&&Ne(o,n,l,l[6],t?Re(n,l[6],i,null):Ee(l[6]),null),(!t||i&2)&&T(e,"class",l[1]),(!t||i&3)&&Ue(e,"maplibregl-ctrl",l[0])},i(l){t||(v(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&y(e),o&&o.d(l),r[8](null)}}}function If(r,e,t){let n,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:u}=Ao();ee(r,u,d=>t(5,n=d));let f,c={onAdd(){return f},onRemove(){var d;(d=f==null?void 0:f.parentNode)==null||d.removeChild(f)}};jt(()=>{n==null||n.removeControl(c)});function _(d){Le[d?"unshift":"push"](()=>{f=d,t(2,f)})}return r.$$set=d=>{"defaultStyling"in d&&t(0,i=d.defaultStyling),"position"in d&&t(4,s=d.position),"class"in d&&t(1,a=d.class),"$$scope"in d&&t(6,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&f&&n.addControl(c,s)},[i,a,f,u,s,n,l,o,_]}class Nf extends se{constructor(e){super(),ae(this,e,If,jf,ie,{defaultStyling:0,position:4,class:1})}}function Ef(r,e,t){let n,o,{data:l}=e,{idCol:i}=e,{sourceLayer:s=void 0}=e,a=new Set;const{map:u,source:f}=ya();return ee(r,u,c=>t(6,n=c)),ee(r,f,c=>t(7,o=c)),r.$$set=c=>{"data"in c&&t(2,l=c.data),"idCol"in c&&t(3,i=c.idCol),"sourceLayer"in c&&t(4,s=c.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&l&&n&&o){let c=new Set;for(const _ of l){const d=_[i];if(!d)continue;a.delete(d),c.add(d);const p={id:d,source:o,sourceLayer:s},g=n.getFeatureState(p);let $=!1;for(const L of Object.keys(_))if(g[L]!==_[L]){$=!0;break}$&&n.setFeatureState(p,_)}for(const _ of a){const d={id:_,source:o,sourceLayer:s},p=n.getFeatureState(d);for(const g of Object.keys(p))n.removeFeatureState(d,g)}t(5,a=c)}},[u,f,l,i,s,a,n,o]}class Rf extends se{constructor(e){super(),ae(this,e,Ef,null,ie,{data:2,idCol:3,sourceLayer:4})}}function zf(r,e,t){let n;const o=hn();let{layer:l=void 0}=e;const{map:i}=Ao();ee(r,i,f=>t(2,n=f));function s(f){o(f.type,{...f,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return jt(()=>{if(n)if(l)for(const f of a)n.off(f,l,s);else for(const f of u)n.off(f,s)}),r.$$set=f=>{"layer"in f&&t(1,l=f.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(l)for(const f of a)n.on(f,l,s);else for(const f of u)n.on(f,s)},[i,l,n]}class Oo extends se{constructor(e){super(),ae(this,e,zf,null,ie,{layer:1})}}const Of=r=>({marker:r&8}),gl=r=>({marker:r[3]});function Bf(r){let e,t,n,o,l,i,s;const a=r[19].default,u=Ie(a,r,r[18],gl);return{c(){e=h("div"),u&&u.c(),T(e,"tabindex",t=r[1]?0:void 0),T(e,"role",n=r[1]?"button":void 0),X(e,"z-index",r[2])},m(f,c){w(f,e,c),u&&u.m(e,null),l=!0,i||(s=[Go(r[7].call(null,e)),Go(o=Df.call(null,e,r[0])),ne(e,"click",Zn(r[20])),ne(e,"dblclick",Zn(r[21])),ne(e,"contextmenu",Zn(cs(r[22]))),ne(e,"mouseenter",r[23]),ne(e,"mouseleave",r[24]),ne(e,"mousemove",r[25]),ne(e,"keydown",r[8])],i=!0)},p(f,[c]){u&&u.p&&(!l||c&262152)&&Ne(u,a,f,f[18],l?Re(a,f[18],c,Of):Ee(f[18]),gl),(!l||c&2&&t!==(t=f[1]?0:void 0))&&T(e,"tabindex",t),(!l||c&2&&n!==(n=f[1]?"button":void 0))&&T(e,"role",n),o&&xn(o.update)&&c&1&&o.update.call(null,f[0]),c&4&&X(e,"z-index",f[2])},i(f){l||(v(u,f),l=!0)},o(f){C(u,f),l=!1},d(f){f&&y(e),u&&u.d(f),i=!1,ct(s)}}}function Df(r,e){const t=r.className;function n(o){o?r.className=`${t} ${o}`:r.className=t}return n(e),{update:n}}function Uf(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:u}=e,{class:f=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:p=null}=e,{offset:g=void 0}=e,{zIndex:$=void 0}=e,{rotation:L=0}=e,{opacity:k=1}=e;const b=hn(),{map:S,layerEvent:N,self:j,markerClickManager:I}=va();ee(r,S,U=>t(27,l=U)),ee(r,N,U=>t(26,n=U)),ee(r,j,U=>t(3,o=U));function R(U){le(j,o=new tn.Marker({element:U,rotation:L,draggable:d,offset:g,opacity:k.toString()}).setLngLat(u).addTo(l),o),t(11,a=o);const be=()=>E("dragstart"),fe=()=>{D(),E("drag")},te=()=>{D(),E("dragend")};return d&&(o.on("dragstart",be),o.on("drag",fe),o.on("dragend",te)),{destroy(){d&&(o==null||o.off("dragstart",be),o==null||o.off("drag",fe),o==null||o.off("dragend",te)),t(11,a=void 0),o==null||o.remove()}}}function D(){let U=o==null?void 0:o.getLngLat();U&&(Array.isArray(u)?t(10,u=[U.lng,U.lat]):u&&"lon"in u?t(10,u={lon:U.lng,lat:U.lat}):t(10,u=U))}function B(U){U.key===" "&&(U.preventDefault(),U.stopPropagation(),E("click"))}function E(U){if(!c)return;let be=o==null?void 0:o.getLngLat();if(!be)return;const fe=[be.lng,be.lat];let te={map:l,marker:o,lngLat:fe,features:[{type:"Feature",properties:(p==null?void 0:p.properties)??{},geometry:{type:"Point",coordinates:fe}}]};(U==="click"||U==="contextmenu")&&I.handleClick(te),le(N,n={...te,layerType:"marker",type:U},n),b(U,te)}const O=()=>E("click"),H=()=>E("dblclick"),W=()=>{E("contextmenu")},Z=()=>{E("mouseenter")},re=()=>{E("mouseleave")},ce=()=>E("mousemove");return r.$$set=U=>{"marker"in U&&t(11,a=U.marker),"lngLat"in U&&t(10,u=U.lngLat),"class"in U&&t(0,f=U.class),"interactive"in U&&t(12,c=U.interactive),"asButton"in U&&t(1,_=U.asButton),"draggable"in U&&t(13,d=U.draggable),"feature"in U&&t(14,p=U.feature),"offset"in U&&t(15,g=U.offset),"zIndex"in U&&t(2,$=U.zIndex),"rotation"in U&&t(16,L=U.rotation),"opacity"in U&&t(17,k=U.opacity),"$$scope"in U&&t(18,s=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(o==null||o.setLngLat(u)),r.$$.dirty&32776&&(o==null||o.setOffset(g??[0,0])),r.$$.dirty&65544&&(o==null||o.setRotation(L)),r.$$.dirty&131080&&(o==null||o.setOpacity(k.toString()))},[f,_,$,o,S,N,j,R,B,E,u,a,c,d,p,g,L,k,s,i,O,H,W,Z,re,ce]}class qr extends se{constructor(e){super(),ae(this,e,Uf,Bf,ie,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Hf=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),hl=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function bl(r){var o;let e,t,n=(((o=r[4])==null?void 0:o.length)||r[3]instanceof tn.Marker)&&wl(r);return{c(){e=h("div"),n&&n.c()},m(l,i){w(l,e,i),n&&n.m(e,null),r[32](e),t=!0},p(l,i){var s;(s=l[4])!=null&&s.length||l[3]instanceof tn.Marker?n?(n.p(l,i),i[0]&24&&v(n,1)):(n=wl(l),n.c(),v(n,1),n.m(e,null)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(l){t||(v(n),t=!0)},o(l){C(n),t=!1},d(l){l&&y(e),n&&n.d(),r[32](null)}}}function wl(r){let e;const t=r[30].default,n=Ie(t,r,r[29],hl);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[0]&536870933)&&Ne(n,t,o,o[29],e?Re(t,o[29],l,Hf):Ee(o[29]),hl)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Gf(r){let e,t,n=r[9].default&&bl(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,l){o[9].default?n?(n.p(o,l),l[0]&512&&v(n,1)):(n=bl(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function Wf(r,e,t){let n,o,l,i,s,a,{$$slots:u={},$$scope:f}=e;const c=ds(u);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:p=!1}=e,{closeOnMove:g=!1}=e,{openOn:$="click"}=e,{openIfTopMost:L=!0}=e,{focusAfterOpen:k=!0}=e,{anchor:b=void 0}=e,{offset:S=void 0}=e,{popupClass:N=void 0}=e,{maxWidth:j=void 0}=e,{lngLat:I=void 0}=e,{html:R=void 0}=e,{open:D=!1}=e;const B=hn(),{map:E,popupTarget:O,layerEvent:H,layer:W,eventTopMost:Z,markerClickManager:re}=Ao();ee(r,E,q=>t(2,l=q)),ee(r,O,q=>t(3,s=q)),ee(r,H,q=>t(28,i=q)),ee(r,W,q=>t(35,a=q));const ce=["click","dblclick","contextmenu"];let U,be=!1,fe;function te(){if(!U)return;let q=U.getElement();!q||q===fe||(fe=q,$==="hover"&&(fe.style.pointerEvents="none"),fe.addEventListener("mouseenter",()=>{t(24,be=!0)},{passive:!0}),fe.addEventListener("mouseleave",()=>{t(24,be=!1)},{passive:!0}),fe.addEventListener("click",()=>{p&&t(0,D=!1)},{passive:!0}))}Ur(()=>{if(l)return l.on("click",V),l.on("contextmenu",V),re.add(Q),typeof s=="string"&&(l.on("click",s,ye),l.on("dblclick",s,ye),l.on("contextmenu",s,ye),l.on("mousemove",s,K),l.on("mouseleave",s,Ce),l.on("touchstart",s,lt),l.on("touchend",s,Ge)),()=>{l!=null&&l.loaded()&&(U==null||U.remove(),l.off("click",V),l.off("contextmenu",V),re.remove(Q),s instanceof tn.Marker?s.getPopup()===U&&s.setPopup(void 0):typeof s=="string"&&(l.off("click",s,ye),l.off("dblclick",s,ye),l.off("contextmenu",s,ye),l.off("mousemove",s,K),l.off("mouseleave",s,Ce),l.off("touchstart",s,lt),l.off("touchend",s,Ge)))}});function me(q){return L?!("marker"in q)&&!$a(q)&&Z(q)!==a:!1}let ue=null,Fe="normal";function et(q){"layerType"in q&&q.layerType==="deckgl"?(t(10,I=q.coordinate),t(4,ue=q.object?[q.object]:null)):(t(10,I=q.lngLat),t(4,ue=q.features??[]))}function ye(q){q.type!==$||me(q)||(et(q),setTimeout(()=>t(0,D=!0)))}let we=null;function lt(q){we=q.point}function Ge(q){if(!we||$!=="hover")return;let nt=we.dist(q.point);we=null,nt<3&&(t(10,I=q.lngLat),t(4,ue=q.features??[]),U.isOpen()?t(25,Fe="justOpened"):(t(25,Fe="opening"),t(0,D=!0)))}function Ce(q){$!=="hover"||we||Fe!=="normal"||(t(0,D=!1),t(4,ue=null))}function K(q){if(!($!=="hover"||we||Fe!=="normal")){if(me(q)){t(0,D=!1),t(4,ue=null);return}t(0,D=!0),t(4,ue=q.features??[]),t(10,I=q.lngLat)}}function V(q){if(Fe==="justOpened"){t(25,Fe="normal");return}if(!d)return;let nt=[fe,s instanceof tn.Marker?s==null?void 0:s.getElement():null];D&&U.isOpen()&&!nt.some(xe=>xe==null?void 0:xe.contains(q.originalEvent.target))&&(q.type==="contextmenu"&&$==="contextmenu"||q.type!=="contextmenu")&&t(0,D=!1)}function Q(q){d&&D&&U.isOpen()&&q.marker!==s&&t(0,D=!1)}jt(()=>{l&&(U!=null&&U.isOpen())&&U.remove()});let ge;const he=()=>t(0,D=!1);function Pe(q){Le[q?"unshift":"push"](()=>{ge=q,t(1,ge)})}return r.$$set=q=>{"closeButton"in q&&t(11,_=q.closeButton),"closeOnClickOutside"in q&&t(12,d=q.closeOnClickOutside),"closeOnClickInside"in q&&t(13,p=q.closeOnClickInside),"closeOnMove"in q&&t(14,g=q.closeOnMove),"openOn"in q&&t(15,$=q.openOn),"openIfTopMost"in q&&t(16,L=q.openIfTopMost),"focusAfterOpen"in q&&t(17,k=q.focusAfterOpen),"anchor"in q&&t(18,b=q.anchor),"offset"in q&&t(19,S=q.offset),"popupClass"in q&&t(20,N=q.popupClass),"maxWidth"in q&&t(21,j=q.maxWidth),"lngLat"in q&&t(10,I=q.lngLat),"html"in q&&t(22,R=q.html),"open"in q&&t(0,D=q.open),"$$scope"in q&&t(29,f=q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=_??(!d&&!p)),r.$$.dirty[0]&146685952&&(U||(t(23,U=new tn.Popup({closeButton:n,closeOnClick:!1,closeOnMove:g,focusAfterOpen:k,maxWidth:j,className:N,anchor:b,offset:S})),fe=U.getElement(),U.on("open",()=>{t(0,D=!0),te(),B("open",U)}),U.on("close",()=>{t(0,D=!1),B("close",U)}),U.on("hover",()=>{B("hover",U)}))),r.$$.dirty[0]&8421384&&U&&s instanceof tn.Marker&&($==="click"?s.setPopup(U):s.getPopup()===U&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&ce.includes($)&&(i==null?void 0:i.type)===$&&(ye(i),le(H,i=null,i)),r.$$.dirty[0]&268468224&&t(26,o=$==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&$==="hover"&&H&&(o&&i&&et(i),t(0,D=(o||be)??!1)),r.$$.dirty[0]&12582914&&(ge?U.setDOMContent(ge):R&&U.setHTML(R)),r.$$.dirty[0]&8389632&&I&&U.setLngLat(I),r.$$.dirty[0]&41943045&&l){let q=U.isOpen();D&&!q?(U.addTo(l),Fe==="opening"&&t(25,Fe="justOpened")):!D&&q&&U.remove()}},[D,ge,l,s,ue,E,O,H,W,c,I,_,d,p,g,$,L,k,b,S,N,j,R,U,be,Fe,o,n,i,f,u,he,Pe]}class qf extends se{constructor(e){super(),ae(this,e,Wf,Gf,ie,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Jf(r){let e;const t=r[16].default,n=Ie(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Ne(n,t,o,o[24],e?Re(t,o[24],l,null):Ee(o[24]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Yf(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Jf]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new fs({props:l}),Le.push(()=>ze(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function Zf(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=To("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:L=!1}=e,{hovered:k=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:S=!0}=e;function N(O){k=O,t(0,k)}function j(O){qe.call(this,r,O)}function I(O){qe.call(this,r,O)}function R(O){qe.call(this,r,O)}function D(O){qe.call(this,r,O)}function B(O){qe.call(this,r,O)}function E(O){qe.call(this,r,O)}return r.$$set=O=>{"id"in O&&t(1,l=O.id),"source"in O&&t(2,i=O.source),"sourceLayer"in O&&t(3,s=O.sourceLayer),"beforeId"in O&&t(4,a=O.beforeId),"beforeLayerType"in O&&t(5,u=O.beforeLayerType),"paint"in O&&t(6,f=O.paint),"layout"in O&&t(7,c=O.layout),"filter"in O&&t(8,_=O.filter),"applyToClusters"in O&&t(9,d=O.applyToClusters),"minzoom"in O&&t(10,p=O.minzoom),"maxzoom"in O&&t(11,g=O.maxzoom),"hoverCursor"in O&&t(12,$=O.hoverCursor),"manageHoverState"in O&&t(13,L=O.manageHoverState),"hovered"in O&&t(0,k=O.hovered),"eventsIfTopMost"in O&&t(14,b=O.eventsIfTopMost),"interactive"in O&&t(15,S=O.interactive),"$$scope"in O&&t(24,o=O.$$scope)},[k,l,i,s,a,u,f,c,_,d,p,g,$,L,b,S,n,N,j,I,R,D,B,E,o]}class lr extends se{constructor(e){super(),ae(this,e,Zf,Yf,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function yl(r){let e=r[0],t,n,o=vl(r);return{c(){o.c(),t=Qe()},m(l,i){o.m(l,i),w(l,t,i),n=!0},p(l,i){i&1&&ie(e,e=l[0])?($e(),C(o,1,1,Y),ke(),o=vl(l),o.c(),v(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(v(o),n=!0)},o(l){C(o),n=!1},d(l){l&&y(t),o.d(l)}}}function vl(r){let e;const t=r[15].default,n=Ie(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Ne(n,t,o,o[14],e?Re(t,o[14],l,null):Ee(o[14]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Kf(r){let e,t,n=r[0]&&yl(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&v(n,1)):(n=yl(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function Xf(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e,{id:s=To("vector")}=e,{url:a=null}=e,{tiles:u=null}=e,{promoteId:f=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:p=null}=e,{maxzoom:g=null}=e,{volatile:$=null}=e;if(a&&a.includes("pmtiles://")&&!tn.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let S=new La;tn.addProtocol("pmtiles",S.tile)}const{map:L,self:k}=ka();ee(r,L,S=>t(13,o=S)),ee(r,k,S=>t(0,n=S));let b;return jt(()=>{n&&o&&(Ca(L,n,b),le(k,n=null,n),b=void 0)}),r.$$set=S=>{"id"in S&&t(3,s=S.id),"url"in S&&t(4,a=S.url),"tiles"in S&&t(5,u=S.tiles),"promoteId"in S&&t(6,f=S.promoteId),"bounds"in S&&t(7,c=S.bounds),"scheme"in S&&t(8,_=S.scheme),"attribution"in S&&t(9,d=S.attribution),"minzoom"in S&&t(10,p=S.minzoom),"maxzoom"in S&&t(11,g=S.maxzoom),"volatile"in S&&t(12,$=S.volatile),"$$scope"in S&&t(14,i=S.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&o&&n!==s&&(le(k,n=s,n),Sa(o,n,Er({type:"vector",url:a,tiles:u,promoteId:f,bounds:c,scheme:_,attribution:d,minzoom:p,maxzoom:g,volatile:$}),S=>o&&S===n,()=>{n&&(b=o==null?void 0:o.getSource(n))})),r.$$.dirty&8200&&(o==null||o.on("style.load",()=>{b=o==null?void 0:o.getSource(s)}))},[n,L,k,s,a,u,f,c,_,d,p,g,$,o,i,l]}class ur extends se{constructor(e){super(),ae(this,e,Xf,Kf,ie,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}function Vf(r){let e,t,n,o,l,i,s,a,u;return{c(){e=h("label"),t=z(`Basemap:
  `),n=h("select"),o=h("option"),o.textContent="MapTiler Dataviz",l=h("option"),l.textContent="MapTiler Streets",i=h("option"),i.textContent="MapTiler Satellite",s=h("option"),s.textContent="OS Open Zoomstack",o.__value="dataviz",We(o,o.__value),l.__value="streets-v2",We(l,l.__value),i.__value="hybrid",We(i,i.__value),s.__value="uk-openzoomstack-light",We(s,s.__value),r[0]===void 0&&dn(()=>r[1].call(n))},m(f,c){w(f,e,c),m(e,t),m(e,n),m(n,o),m(n,l),m(n,i),m(n,s),vt(n,r[0],!0),a||(u=ne(n,"change",r[1]),a=!0)},p(f,[c]){c&1&&vt(n,f[0])},i:Y,o:Y,d(f){f&&y(e),a=!1,u()}}}function Qf(r,e,t){let n;ee(r,ao,l=>t(0,n=l));function o(){n=_n(this),ao.set(n)}return[n,o]}class xf extends se{constructor(e){super(),ae(this,e,Qf,Vf,ie,{})}}let Fr=At(!0);function ec(r){let e,t;return e=new It({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.layout={visibility:n[0]?"none":"visible"}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function tc(r){let e,t;return e=new Ve({props:{data:r[1],$$slots:{default:[ec]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function nc(r,e,t){let n;return ee(r,Fr,l=>t(0,n=l)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class rc extends se{constructor(e){super(),ae(this,e,nc,tc,ie,{})}}function oc(r){let e,t;return e=new qr({props:{lngLat:r[0],$$slots:{default:[ic]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.lngLat=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function lc(r){let e,t,n;function o(i){r[3](i)}let l={draggable:!0,$$slots:{default:[sc]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.lngLat=r[0]),e=new qr({props:l}),Le.push(()=>ze(e,"lngLat",o)),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.lngLat=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function ic(r){let e,t;const n=r[2].default,o=Ie(n,r,r[4],null);return{c(){e=h("span"),o&&o.c(),T(e,"class","dot svelte-1gcxp27")},m(l,i){w(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Ne(o,n,l,l[4],t?Re(n,l[4],i,null):Ee(l[4]),null)},i(l){t||(v(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&y(e),o&&o.d(l)}}}function sc(r){let e,t;const n=r[2].default,o=Ie(n,r,r[4],null);return{c(){e=h("span"),o&&o.c(),T(e,"class","dot svelte-1gcxp27")},m(l,i){w(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Ne(o,n,l,l[4],t?Re(n,l[4],i,null):Ee(l[4]),null)},i(l){t||(v(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&y(e),o&&o.d(l)}}}function ac(r){let e,t,n,o;const l=[lc,oc],i=[];function s(a,u){return a[1]?0:1}return e=s(r),t=i[e]=l[e](r),{c(){t.c(),n=Qe()},m(a,u){i[e].m(a,u),w(a,n,u),o=!0},p(a,[u]){let f=e;e=s(a),e===f?i[e].p(a,u):($e(),C(i[f],1,1,()=>{i[f]=null}),ke(),t=i[e],t?t.p(a,u):(t=i[e]=l[e](a),t.c()),v(t,1),t.m(n.parentNode,n))},i(a){o||(v(t),o=!0)},o(a){C(t),o=!1},d(a){a&&y(n),i[e].d(a)}}}function uc(r,e,t){let{$$slots:n={},$$scope:o}=e,{lngLat:l}=e,{draggable:i=!1}=e;function s(a){l=a,t(0,l)}return r.$$set=a=>{"lngLat"in a&&t(0,l=a.lngLat),"draggable"in a&&t(1,i=a.draggable),"$$scope"in a&&t(4,o=a.$$scope)},[l,i,n,s,o]}class Sn extends se{constructor(e){super(),ae(this,e,uc,ac,ie,{lngLat:0,draggable:1})}}function fc(r){let e,t,n;const o=r[2].default,l=Ie(o,r,r[5],null);return{c(){e=h("h2"),e.textContent="Help",t=M(),l&&l.c()},m(i,s){w(i,e,s),w(i,t,s),l&&l.m(i,s),n=!0},p(i,s){l&&l.p&&(!n||s&32)&&Ne(l,o,i,i[5],n?Re(o,i[5],s,null):Ee(i[5]),null)},i(i){n||(v(l,i),n=!0)},o(i){C(l,i),n=!1},d(i){i&&(y(e),y(t)),l&&l.d(i)}}}function cc(r){let e,t,n,o,l,i,s,a;t=new of({props:{color:r[0]}});function u(c){r[4](c)}let f={$$slots:{default:[fc]},$$scope:{ctx:r}};return r[1]!==void 0&&(f.show=r[1]),o=new Hr({props:f}),Le.push(()=>ze(o,"show",u)),{c(){e=h("button"),A(t.$$.fragment),n=M(),A(o.$$.fragment),T(e,"class","icon-btn help svelte-my65h"),T(e,"aria-label","Help")},m(c,_){w(c,e,_),F(t,e,null),w(c,n,_),F(o,c,_),i=!0,s||(a=ne(e,"click",Zn(r[3])),s=!0)},p(c,[_]){const d={};_&1&&(d.color=c[0]),t.$set(d);const p={};_&32&&(p.$$scope={dirty:_,ctx:c}),!l&&_&2&&(l=!0,p.show=c[1],Oe(()=>l=!1)),o.$set(p)},i(c){i||(v(t.$$.fragment,c),v(o.$$.fragment,c),i=!0)},o(c){C(t.$$.fragment,c),C(o.$$.fragment,c),i=!1},d(c){c&&(y(e),y(n)),P(t),P(o,c),s=!1,a()}}}function dc(r,e,t){let{$$slots:n={},$$scope:o}=e,l=!1,{color:i="black"}=e;const s=()=>t(1,l=!0);function a(u){l=u,t(1,l)}return r.$$set=u=>{"color"in u&&t(0,i=u.color),"$$scope"in u&&t(5,o=u.$$scope)},[i,l,n,s,a,o]}class Jr extends se{constructor(e){super(),ae(this,e,dc,cc,ie,{color:0})}}function _c(r){let e,t,n,o,l,i=r[0]+1+"",s,a,u=r[1].length+"",f,c,_,d,p,g,$;return{c(){e=h("div"),t=h("button"),n=z("Previous"),l=M(),s=z(i),a=z(" / "),f=z(u),c=M(),_=h("button"),d=z("Next"),t.disabled=o=r[0]==0,T(t,"data-tooltip","Left"),_.disabled=p=r[0]==r[1].length-1,T(_,"data-tooltip","Right"),X(e,"display","flex"),X(e,"justify-content","space-between"),X(e,"align-items","center")},m(L,k){w(L,e,k),m(e,t),m(t,n),m(e,l),m(e,s),m(e,a),m(e,f),m(e,c),m(e,_),m(_,d),g||($=[ne(window,"keydown",r[2]),ne(t,"click",r[3]),ne(_,"click",r[4])],g=!0)},p(L,[k]){k&1&&o!==(o=L[0]==0)&&(t.disabled=o),k&1&&i!==(i=L[0]+1+"")&&oe(s,i),k&2&&u!==(u=L[1].length+"")&&oe(f,u),k&3&&p!==(p=L[0]==L[1].length-1)&&(_.disabled=p)},i:Y,o:Y,d(L){L&&y(e),g=!1,ct($)}}}function pc(r,e,t){let n;ee(r,rn,u=>t(5,n=u));let{list:o}=e,{idx:l=0}=e;Ur(()=>{n==null||n.keyboard.disable()}),jt(()=>{n==null||n.keyboard.enable()});function i(u){u.key=="ArrowLeft"&&(u.stopPropagation(),s()),u.key=="ArrowRight"&&(u.stopPropagation(),a())}function s(){l!=0&&t(0,l--,l)}function a(){l!=o.length-1&&t(0,l++,l)}return r.$$set=u=>{"list"in u&&t(1,o=u.list),"idx"in u&&t(0,l=u.idx)},[l,o,i,s,a]}class Yr extends se{constructor(e){super(),ae(this,e,pc,_c,ie,{list:1,idx:0})}}function mc(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:gc}=_s;function hc(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g;return d=ps(r[8][0]),{c(){e=h("button"),e.textContent="Stop StreetView",t=M(),n=h("fieldset"),o=h("legend"),o.textContent="Source:",l=M(),i=h("label"),s=h("input"),a=z(`
      Google Street View`),u=M(),f=h("label"),c=h("input"),_=z(`
      Bing Streetside`),T(e,"class","secondary"),T(s,"type","radio"),s.__value="google",We(s,s.__value),T(c,"type","radio"),c.__value="bing",We(c,c.__value),d.p(s,c)},m($,L){w($,e,L),w($,t,L),w($,n,L),m(n,o),m(n,l),m(n,i),m(i,s),s.checked=s.__value===r[0],m(i,a),m(n,u),m(n,f),m(f,c),c.checked=c.__value===r[0],m(f,_),p||(g=[ne(e,"click",r[3]),ne(s,"change",r[7]),ne(c,"change",r[9])],p=!0)},p($,L){L&1&&(s.checked=s.__value===$[0]),L&1&&(c.checked=c.__value===$[0])},d($){$&&(y(e),y(t),y(n)),d.r(),p=!1,ct(g)}}}function bc(r){let e,t,n;return{c(){e=h("button"),e.textContent="StreetView",T(e,"class","secondary")},m(o,l){w(o,e,l),t||(n=ne(e,"click",r[2]),t=!0)},p:Y,d(o){o&&y(e),t=!1,n()}}}function wc(r){let e,t,n;function o(s,a){return s[1]?bc:hc}let l=o(r),i=l(r);return{c(){i.c(),e=Qe()},m(s,a){i.m(s,a),w(s,e,a),t||(n=ne(gc,"keydown",r[4]),t=!0)},p(s,[a]){l===(l=o(s))&&i?i.p(s,a):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Y,o:Y,d(s){s&&y(e),i.d(s),t=!1,n()}}}function yc(r,e,t){let n;ee(r,Fr,g=>t(1,n=g));let{map:o}=e,{maptilerBasemap:l}=e,i="google",s=[];function a(){le(Fr,n=!1,n),o.on("click",f),o.getCanvas().style.cursor="crosshair";for(let g of mc(o,l))s.push([g,o.getPaintProperty(g,"line-color")]),o.setPaintProperty(g,"line-color","cyan")}function u(){le(Fr,n=!0,n),o.off("click",f),o.getCanvas().style.cursor="inherit";for(let[g,$]of s)o.setPaintProperty(g,"line-color",$);s=[]}jt(u);function f(g){let $=g.lngLat.lng,L=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${L},${$}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${L}~${$}&style=x`,"_blank")}function c(g){!n&&g.key=="Escape"&&(g.stopPropagation(),u())}const _=[[]];function d(){i=this.__value,t(0,i)}function p(){i=this.__value,t(0,i)}return r.$$set=g=>{"map"in g&&t(5,o=g.map),"maptilerBasemap"in g&&t(6,l=g.maptilerBasemap)},[i,n,a,u,c,o,l,d,_,p]}class vc extends se{constructor(e){super(),ae(this,e,yc,wc,ie,{map:5,maptilerBasemap:6})}}function ve(r,e=!0){return{id:r,beforeId:$c(r),eventsIfTopMost:e}}function $c(r){let e=Zt(rn);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let o=$l.length-1;o>=0;o--){let l=$l[o];if(l==r){n=!0;break}e.getLayer(l)&&(t=l)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let ro=r=>r,oo=r=>r;const $l=[ro(oo("Background")),"neighbourhood-boundaries",ro("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",oo("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations","context-stats19",oo("Road labels"),ro("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function ln(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function mn(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function gn(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function go(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function cn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function kl(r){return r.reduce((e,t)=>e+t,0)}const kc=r=>({}),Cl=r=>({}),Cc=r=>({}),Sl=r=>({});function Ll(r){let e,t;return e=new Jr({props:{color:"var(--pico-secondary-inverse)",$$slots:{default:[Sc]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Sc(r){let e,t;const n=r[3].help,o=Ie(n,r,r[6],Sl);return{c(){e=h("div"),o&&o.c(),T(e,"class","context-layer-help-content")},m(l,i){w(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&64)&&Ne(o,n,l,l[6],t?Re(n,l[6],i,Cc):Ee(l[6]),Sl)},i(l){t||(v(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&y(e),o&&o.d(l)}}}function Ml(r){let e,t;const n=r[3].legend,o=Ie(n,r,r[6],Cl);return{c(){e=h("div"),o&&o.c(),T(e,"class","legend svelte-wh5rsr")},m(l,i){w(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&64)&&Ne(o,n,l,l[6],t?Re(n,l[6],i,kc):Ee(l[6]),Cl)},i(l){t||(v(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&y(e),o&&o.d(l)}}}function Lc(r){let e,t,n,o,l,i,s,a,u,f,c=r[2].help&&Ll(r),_=r[0]&&r[2].legend&&Ml(r);return{c(){e=h("button"),t=h("input"),n=M(),o=z(r[1]),l=M(),c&&c.c(),i=M(),_&&_.c(),s=Qe(),T(t,"type","checkbox"),X(e,"display","flex"),X(e,"align-items","center"),X(e,"justify-content","leading"),X(e,"gap","8px"),X(e,"text-align","left"),T(e,"class","secondary")},m(d,p){w(d,e,p),m(e,t),t.checked=r[0],m(e,n),m(e,o),m(e,l),c&&c.m(e,null),w(d,i,p),_&&_.m(d,p),w(d,s,p),a=!0,u||(f=[ne(t,"change",r[4]),ne(e,"click",r[5])],u=!0)},p(d,[p]){p&1&&(t.checked=d[0]),(!a||p&2)&&oe(o,d[1]),d[2].help?c?(c.p(d,p),p&4&&v(c,1)):(c=Ll(d),c.c(),v(c,1),c.m(e,null)):c&&($e(),C(c,1,1,()=>{c=null}),ke()),d[0]&&d[2].legend?_?(_.p(d,p),p&5&&v(_,1)):(_=Ml(d),_.c(),v(_,1),_.m(s.parentNode,s)):_&&($e(),C(_,1,1,()=>{_=null}),ke())},i(d){a||(v(c),v(_),a=!0)},o(d){C(c),C(_),a=!1},d(d){d&&(y(e),y(i),y(s)),c&&c.d(),_&&_.d(d),u=!1,ct(f)}}}function Mc(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=ds(n);let{label:i}=e,{show:s=!1}=e;function a(){s=this.checked,t(0,s)}const u=()=>t(0,s=!s);return r.$$set=f=>{"label"in f&&t(1,i=f.label),"show"in f&&t(0,s=f.show),"$$scope"in f&&t(6,o=f.$$scope)},[s,i,l,n,a,u,o]}class nn extends se{constructor(e){super(),ae(this,e,Mc,Lc,ie,{label:1,show:0})}}function Tc(r){let e;return{c(){e=h("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Ac(r){let e,t;const n=[ve("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":ln(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&1?He(n,[n[0],n[1],n[2],{layout:{visibility:l[0]?"visible":"none"}}]):{};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Fc(r){let e,t,n,o,l;function i(a){r[1](a)}let s={label:"Bus routes",$$slots:{help:[Tc]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new nn({props:s}),Le.push(()=>ze(e,"show",i)),o=new ur({props:{url:`pmtiles://${$t("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[Ac]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment)},m(a,u){F(e,a,u),w(a,n,u),F(o,a,u),l=!0},p(a,[u]){const f={};u&4&&(f.$$scope={dirty:u,ctx:a}),!t&&u&1&&(t=!0,f.show=a[0],Oe(()=>t=!1)),e.$set(f);const c={};u&5&&(c.$$scope={dirty:u,ctx:a}),o.$set(c)},i(a){l||(v(e.$$.fragment,a),v(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&y(n),P(e,a),P(o,a)}}}function Pc(r,e,t){let n=!1;function o(l){n=l,t(0,n)}return[n,o]}class jc extends se{constructor(e){super(),ae(this,e,Pc,Fc,ie,{})}}function Ic(r){let e,t;return{c(){e=Xt("svg"),t=Xt("path"),T(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),T(e,"viewBox","0 0 14 14"),T(e,"width","13"),T(e,"height","13"),T(e,"class","svelte-en2qvf")},m(n,o){w(n,e,o),m(e,t)},p:Y,i:Y,o:Y,d(n){n&&y(e)}}}class Es extends se{constructor(e){super(),ae(this,e,null,Ic,ie,{})}}function Nc(r){let e,t;return{c(){e=Xt("svg"),t=Xt("path"),T(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),T(e,"viewBox","0 0 30 30"),T(e,"fill","none"),T(e,"xmlns","http://www.w3.org/2000/svg"),T(e,"class","svelte-d2loi5")},m(n,o){w(n,e,o),m(e,t)},p:Y,i:Y,o:Y,d(n){n&&y(e)}}}class Rs extends se{constructor(e){super(),ae(this,e,null,Nc,ie,{})}}function Ec(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"area.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"area.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function Rc(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"reverse.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"reverse.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function zc(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"poi.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"poi.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function Oc(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"postal_code.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"postal_code.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function Bc(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"street.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"street.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function Dc(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"road.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"road.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function Uc(r){let e,t;return{c(){e=h("img"),Ke(e.src,t=r[3]+"housenumber.svg")||T(e,"src",t),T(e,"alt",r[6]),T(e,"class","svelte-ltkwvy")},m(n,o){w(n,e,o)},p(n,o){o&8&&!Ke(e.src,t=n[3]+"housenumber.svg")&&T(e,"src",t),o&64&&T(e,"alt",n[6])},d(n){n&&y(e)}}}function Hc(r){let e,t,n,o;return{c(){e=h("img"),Ke(e.src,t=r[5])||T(e,"src",t),T(e,"alt",r[4]),T(e,"class","svelte-ltkwvy")},m(l,i){w(l,e,i),n||(o=ne(e,"error",r[14]),n=!0)},p(l,i){i&32&&!Ke(e.src,t=l[5])&&T(e,"src",t),i&16&&T(e,"alt",l[4])},d(l){l&&y(e),n=!1,o()}}}function Tl(r){let e,t;return{c(){e=h("span"),t=z(r[6]),T(e,"class","secondary svelte-ltkwvy")},m(n,o){w(n,e,o),m(e,t)},p(n,o){o&64&&oe(t,n[6])},d(n){n&&y(e)}}}function Gc(r){let e,t,n,o,l,i,s,a,u,f=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],p,g,$=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",L,k,b;function S(R,D){return D&1&&(t=null),D&1&&(n=null),D&1&&(o=null),D&1&&(l=null),R[5]?Hc:R[0].address?Uc:(t==null&&(t=!!R[0].id.startsWith("road.")),t?Dc:(n==null&&(n=!!R[0].id.startsWith("address.")),n?Bc:(o==null&&(o=!!R[0].id.startsWith("postal_code.")),o?Oc:(l==null&&(l=!!R[0].id.startsWith("poi.")),l?zc:R[7]?Rc:Ec))))}let N=S(r,-1),j=N(r),I=d&&Tl(r);return{c(){e=h("li"),j.c(),i=M(),s=h("span"),a=h("span"),u=h("span"),c=z(f),_=M(),I&&I.c(),p=M(),g=h("span"),L=z($),T(u,"class","primary svelte-ltkwvy"),T(a,"class","svelte-ltkwvy"),T(g,"class","line2 svelte-ltkwvy"),T(s,"class","texts svelte-ltkwvy"),T(e,"tabindex","0"),T(e,"data-selected",r[1]),T(e,"class","svelte-ltkwvy"),Ue(e,"selected",r[1])},m(R,D){w(R,e,D),j.m(e,null),m(e,i),m(e,s),m(s,a),m(a,u),m(u,c),m(a,_),I&&I.m(a,null),m(s,p),m(s,g),m(g,L),k||(b=[ne(e,"mouseenter",r[12]),ne(e,"focus",r[13])],k=!0)},p(R,[D]){N===(N=S(R,D))&&j?j.p(R,D):(j.d(1),j=N(R),j&&(j.c(),j.m(e,i))),D&1&&f!==(f=(R[7]?R[0].place_name:R[0].place_name.replace(/,.*/,""))+"")&&oe(c,f),D&37&&(d=R[2]==="always"||R[2]!=="never"&&!R[0].address&&!R[0].id.startsWith("road.")&&!R[0].id.startsWith("address.")&&!R[0].id.startsWith("postal_code.")&&(!R[0].id.startsWith("poi.")||!R[5])&&!R[7]),d?I?I.p(R,D):(I=Tl(R),I.c(),I.m(a,null)):I&&(I.d(1),I=null),D&1&&$!==($=(R[7]?"":R[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&oe(L,$),D&2&&T(e,"data-selected",R[1]),D&2&&Ue(e,"selected",R[1])},i:Y,o:Y,d(R){R&&y(e),j.d(),I&&I.d(),k=!1,ct(b)}}}function Wc(r,e,t){var b;let n,o,{feature:l}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:u}=e;const f=(b=l.properties)==null?void 0:b.categories;let c,_,d=0,p=l.place_type[0]==="reverse";function g(){_&&a.add(_),t(10,d++,d)}function $(S){qe.call(this,r,S)}function L(S){qe.call(this,r,S)}const k=()=>g();return r.$$set=S=>{"feature"in S&&t(0,l=S.feature),"selected"in S&&t(1,i=S.selected),"showPlaceType"in S&&t(2,s=S.showPlaceType),"missingIconsCache"in S&&t(9,a=S.missingIconsCache),"iconsBaseUrl"in S&&t(3,u=S.iconsBaseUrl)},r.$$.update=()=>{var S,N,j,I;if(r.$$.dirty&3640)do t(11,n--,n),t(4,c=f==null?void 0:f[n]),t(5,_=c?u+c.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!_||a.has(_)));r.$$.dirty&1&&t(6,o=((N=(S=l.properties)==null?void 0:S.categories)==null?void 0:N.join(", "))??((I=(j=l.properties)==null?void 0:j.place_type_name)==null?void 0:I[0])??l.place_type[0])},t(11,n=(f==null?void 0:f.length)??0),[l,i,s,u,c,_,o,p,g,a,d,n,$,L,k]}class qc extends se{constructor(e){super(),ae(this,e,Wc,Gc,ie,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Jc(r){let e;return{c(){e=h("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',T(e,"class","svelte-7cmwmc")},m(t,n){w(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&y(e)}}}class Yc extends se{constructor(e){super(),ae(this,e,null,Jc,ie,{})}}function Zc(r){let e,t;return{c(){e=Xt("svg"),t=Xt("path"),T(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),T(e,"viewBox","0 0 60.006 21.412"),T(e,"width","14"),T(e,"height","20"),T(e,"class","svelte-en2qvf")},m(n,o){w(n,e,o),m(e,t)},p:Y,i:Y,o:Y,d(n){n&&y(e)}}}class Kc extends se{constructor(e){super(),ae(this,e,null,Zc,ie,{})}}function Xc(r){let e,t,n;return{c(){e=Xt("svg"),t=Xt("circle"),n=Xt("path"),T(t,"cx","4.789"),T(t,"cy","4.787"),T(t,"r","3.85"),T(t,"class","svelte-1aq105l"),T(n,"d","M12.063 12.063 7.635 7.635"),T(n,"class","svelte-1aq105l"),T(e,"xmlns","http://www.w3.org/2000/svg"),T(e,"width","13"),T(e,"height","13"),T(e,"viewBox","0 0 13 13"),T(e,"class","svelte-1aq105l")},m(o,l){w(o,e,l),m(e,t),m(e,n)},p:Y,i:Y,o:Y,d(o){o&&y(e)}}}class Vc extends se{constructor(e){super(),ae(this,e,null,Xc,ie,{})}}function Qc(r,e,t){const n=e[1],o=e[0],l=n-o;return r===n&&t?r:((r-o)%l+l)%l+o}function Al(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Bn;async function xc(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const o of e??[])if(!(n&&(o.minZoom!=null&&o.minZoom>n[0]||o.maxZoom!=null&&o.maxZoom<n[0]))){if(o.type==="fixed")return o.coordinates.join(",");e:if(o.type==="client-geolocation"){if(Bn&&o.cachedLocationExpiry&&Bn.time+o.cachedLocationExpiry>Date.now()){if(!Bn.coords)break e;return Bn.coords}let l;try{return l=await new Promise((i,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(u=>u.toFixed(6)).join(","))},a=>{s(a)},o)}),l}catch{}finally{o.cachedLocationExpiry&&(Bn={time:Date.now(),coords:l})}if(t.signal.aborted)return}if(o.type==="server-geolocation")return"ip";if(n&&o.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}function Fl(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function Pl(r){let e,t;return e=new Yc({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function jl(r){let e,t,n,o,l;return t=new Kc({}),{c(){e=h("button"),A(t.$$.fragment),T(e,"type","button"),T(e,"title",r[9]),T(e,"class","svelte-bz0zu3"),Ue(e,"active",r[0])},m(i,s){w(i,e,s),F(t,e,null),n=!0,o||(l=ne(e,"click",r[69]),o=!0)},p(i,s){(!n||s[0]&512)&&T(e,"title",i[9]),(!n||s[0]&1)&&Ue(e,"active",i[0])},i(i){n||(v(t.$$.fragment,i),n=!0)},o(i){C(t.$$.fragment,i),n=!1},d(i){i&&y(e),P(t),o=!1,l()}}}function ed(r){let e,t=[],n=new Map,o,l,i,s=Se(r[14]);const a=u=>u[84].id+(u[84].address?","+u[84].address:"");for(let u=0;u<s.length;u+=1){let f=Fl(r,s,u),c=a(f);n.set(c,t[u]=Il(c,f))}return{c(){e=h("ul");for(let u=0;u<t.length;u+=1)t[u].c();T(e,"class","options svelte-bz0zu3")},m(u,f){w(u,e,f);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);o=!0,l||(i=[ne(e,"mouseleave",r[73]),ne(e,"blur",r[74])],l=!0)},p(u,f){f[0]&17880064&&(s=Se(u[14]),$e(),t=Ta(t,f,a,1,u,s,n,e,Aa,Il,null,Fl),ke())},i(u){if(!o){for(let f=0;f<s.length;f+=1)v(t[f]);o=!0}},o(u){for(let f=0;f<t.length;f+=1)C(t[f]);o=!1},d(u){u&&y(e);for(let f=0;f<t.length;f+=1)t[f].d();l=!1,ct(i)}}}function td(r){let e,t,n,o,l,i;return t=new Rs({}),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("div"),l=z(r[7]),T(o,"class","svelte-bz0zu3"),T(e,"class","no-results svelte-bz0zu3")},m(s,a){w(s,e,a),F(t,e,null),m(e,n),m(e,o),m(o,l),i=!0},p(s,a){(!i||a[0]&128)&&oe(l,s[7])},i(s){i||(v(t.$$.fragment,s),i=!0)},o(s){C(t.$$.fragment,s),i=!1},d(s){s&&y(e),P(t)}}}function nd(r){let e="",t;return{c(){t=z(e)},m(n,o){w(n,t,o)},p:Y,i:Y,o:Y,d(n){n&&y(t)}}}function rd(r){let e,t,n,o,l,i,s,a,u,f,c;return t=new Rs({}),a=new Es({}),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("div"),l=z(r[6]),i=M(),s=h("button"),A(a.$$.fragment),T(o,"class","svelte-bz0zu3"),T(s,"class","svelte-bz0zu3"),T(e,"class","error svelte-bz0zu3")},m(_,d){w(_,e,d),F(t,e,null),m(e,n),m(e,o),m(o,l),m(e,i),m(e,s),F(a,s,null),u=!0,f||(c=ne(s,"click",r[70]),f=!0)},p(_,d){(!u||d[0]&64)&&oe(l,_[6])},i(_){u||(v(t.$$.fragment,_),v(a.$$.fragment,_),u=!0)},o(_){C(t.$$.fragment,_),C(a.$$.fragment,_),u=!1},d(_){_&&y(e),P(t),P(a),f=!1,c()}}}function Il(r,e){let t,n,o;function l(){return e[71](e[86])}function i(){return e[72](e[84])}return n=new qc({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",l),n.$on("focus",i),{key:r,first:null,c(){t=Qe(),A(n.$$.fragment),this.first=t},m(s,a){w(s,t,a),F(n,s,a),o=!0},p(s,a){e=s;const u={};a[0]&16384&&(u.feature=e[84]),a[0]&1024&&(u.showPlaceType=e[10]),a[0]&49152&&(u.selected=e[15]===e[86]),a[0]&4096&&(u.iconsBaseUrl=e[12]),n.$set(u)},i(s){o||(v(n.$$.fragment,s),o=!0)},o(s){C(n.$$.fragment,s),o=!1},d(s){s&&y(t),P(n,s)}}}function od(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L,k,b,S,N,j=!1;l=new Vc({}),c=new Es({});let I=r[19]&&Pl(),R=r[5]==="button"&&jl(r);const D=r[61].default,B=Ie(D,r,r[60],null),E=[rd,nd,td,ed],O=[];function H(W,Z){var re,ce;return W[18]?0:W[16]?((re=W[14])==null?void 0:re.length)===0?2:W[16]&&((ce=W[14])!=null&&ce.length)?3:-1:1}return~($=H(r))&&(L=O[$]=E[$](r)),{c(){e=M(),t=h("form"),n=h("div"),o=h("button"),A(l.$$.fragment),i=M(),s=h("input"),a=M(),u=h("div"),f=h("button"),A(c.$$.fragment),_=M(),I&&I.c(),d=M(),R&&R.c(),p=M(),B&&B.c(),g=M(),L&&L.c(),T(o,"class","search-button svelte-bz0zu3"),T(o,"type","button"),T(s,"placeholder",r[8]),T(s,"aria-label",r[8]),T(s,"class","svelte-bz0zu3"),T(f,"type","button"),T(f,"title",r[3]),T(f,"class","svelte-bz0zu3"),T(u,"class","clear-button-container svelte-bz0zu3"),Ue(u,"displayable",r[1]!==""),T(n,"class","input-group svelte-bz0zu3"),T(t,"tabindex","0"),T(t,"class",k=Wo(r[2])+" svelte-bz0zu3"),Ue(t,"can-collapse",r[4]&&r[1]==="")},m(W,Z){w(W,e,Z),w(W,t,Z),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),r[63](s),We(s,r[1]),m(n,a),m(n,u),m(u,f),F(c,f,null),m(u,_),I&&I.m(u,null),m(n,d),R&&R.m(n,null),m(n,p),B&&B.m(n,null),m(t,g),~$&&O[$].m(t,null),b=!0,S||(N=[ne(o,"click",r[62]),ne(s,"input",r[64]),ne(s,"focus",r[65]),ne(s,"blur",r[66]),ne(s,"keydown",r[22]),ne(s,"input",r[67]),ne(f,"click",r[68]),ne(t,"submit",cs(r[21]))],S=!0)},p(W,Z){(!b||Z[0]&256)&&T(s,"placeholder",W[8]),(!b||Z[0]&256)&&T(s,"aria-label",W[8]),Z[0]&2&&s.value!==W[1]&&We(s,W[1]),(!b||Z[0]&8)&&T(f,"title",W[3]),W[19]?I?Z[0]&524288&&v(I,1):(I=Pl(),I.c(),v(I,1),I.m(u,null)):I&&($e(),C(I,1,1,()=>{I=null}),ke()),(!b||Z[0]&2)&&Ue(u,"displayable",W[1]!==""),W[5]==="button"?R?(R.p(W,Z),Z[0]&32&&v(R,1)):(R=jl(W),R.c(),v(R,1),R.m(n,p)):R&&($e(),C(R,1,1,()=>{R=null}),ke()),B&&B.p&&(!b||Z[1]&536870912)&&Ne(B,D,W,W[60],b?Re(D,W[60],Z,null):Ee(W[60]),null);let re=$;$=H(W),$===re?~$&&O[$].p(W,Z):(L&&($e(),C(O[re],1,1,()=>{O[re]=null}),ke()),~$?(L=O[$],L?L.p(W,Z):(L=O[$]=E[$](W),L.c()),v(L,1),L.m(t,null)):L=null),(!b||Z[0]&4&&k!==(k=Wo(W[2])+" svelte-bz0zu3"))&&T(t,"class",k),(!b||Z[0]&22)&&Ue(t,"can-collapse",W[4]&&W[1]==="")},i(W){b||(v(j),v(l.$$.fragment,W),v(c.$$.fragment,W),v(I),v(R),v(B,W),v(L),b=!0)},o(W){C(j),C(l.$$.fragment,W),C(c.$$.fragment,W),C(I),C(R),C(B,W),C(L),b=!1},d(W){W&&(y(e),y(t)),P(l),r[63](null),P(c),I&&I.d(),R&&R.d(),B&&B.d(W),~$&&O[$].d(),S=!1,ct(N)}}}function ld(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:u}=e,{bbox:f=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:p=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:$="never"}=e,{errorMessage:L="Something went wrong…"}=e,{filter:k=()=>!0}=e,{flyTo:b=!0}=e,{fuzzyMatch:S=!0}=e,{language:N=void 0}=e,{limit:j=void 0}=e,{mapController:I=void 0}=e,{minLength:R=2}=e,{noResultsMessage:D="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:B="Search"}=e,{proximity:E=[{type:"server-geolocation"}]}=e,{reverseActive:O=$==="always"}=e,{reverseButtonTitle:H="toggle reverse geocoding"}=e,{searchValue:W=""}=e,{pickedResultStyle:Z="full-geometry"}=e,{showPlaceType:re="if-needed"}=e,{showResultsWhileTyping:ce=!0}=e,{selectFirst:U=!0}=e,{flyToSelected:be=!1}=e,{markerOnSelected:fe=!0}=e,{types:te=void 0}=e,{exhaustiveReverseGeocoding:me=!1}=e,{excludeTypes:ue=!1}=e,{zoom:Fe=s}=e,{apiUrl:et="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ye={}}=e,{iconsBaseUrl:we="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:lt=()=>{}}=e;function Ge(){xe.focus()}function Ce(){xe.blur()}function K(J,at=!0,ht=!1){t(1,W=J),at?(t(15,Je=-1),zn()):(fn(!ht,ht),setTimeout(()=>{xe.focus(),xe.select()}))}function V(){t(14,he=void 0),t(56,q=void 0),t(15,Je=-1)}function Q(){t(55,Pe=[]),t(56,q=void 0)}let ge=!1,he,Pe,q,nt="",xe,Je=-1,Ct,Lt=[],Ot,on,Et,yn;const st=new Set,Bt=hn();jt(()=>{I&&(I.setEventHandler(void 0),I.indicateReverse(!1),I.setSelectedMarker(-1),I.setFeatures(void 0,void 0,!1))});function zn(J){if(on&&(clearTimeout(on),on=void 0),Je>-1&&he)t(56,q=he[Je]),t(1,W=q.place_type[0]==="reverse"?q.place_name:q.place_name.replace(/,.*/,"")),t(18,Ct=void 0),t(55,Pe=void 0),t(15,Je=-1);else if(W){const at=J||!bt(W);dt(W,{exact:!0}).then(()=>{t(55,Pe=he),t(56,q=void 0),at&&br()}).catch(ht=>t(18,Ct=ht))}}function bt(J){try{return Ma(J,6)}catch{return!1}}async function dt(J,{byId:at=!1,exact:ht=!1}={}){t(18,Ct=void 0),Ot==null||Ot.abort();const Rt=new AbortController;t(19,Ot=Rt);try{const Be=bt(J),pt=new URLSearchParams;if(N!==void 0&&pt.set("language",Array.isArray(N)?N.join(","):N??""),te&&pt.set("types",te.join(",")),ue&&pt.set("excludeTypes",String(ue)),f&&pt.set("bbox",f.map($r=>$r.toFixed(6)).join(",")),p&&pt.set("country",Array.isArray(p)?p.join(","):p),!at&&!Be){const $r=await xc(I,E,Rt);$r&&pt.set("proximity",$r),(ht||!ce)&&pt.set("autocomplete","false"),pt.set("fuzzyMatch",String(S))}j!==void 0&&(me||!Be||(te==null?void 0:te.length)===1)&&pt.set("limit",String(j)),pt.set("key",u),lt(pt);const xt=et+"/"+encodeURIComponent(Be?Be.decimalLongitude+","+Be.decimalLatitude:J)+".json?"+pt.toString();if(xt===nt){at?(t(14,he=void 0),t(56,q=Lt[0])):t(14,he=Lt);return}nt=xt;const Qr=await fetch(xt,{signal:Rt.signal,...ye});if(!Qr.ok)throw new Error(await Qr.text());const xr=await Qr.json();Bt("response",{url:xt,featureCollection:xr}),at?(t(14,he=void 0),t(56,q=xr.features[0]),Lt=[q]):(t(14,he=xr.features.filter(k)),Be&&he.unshift({type:"Feature",properties:{},id:"reverse_"+Be.decimalLongitude+"_"+Be.decimalLatitude,text:Be.decimalLatitude+", "+Be.decimalLongitude,place_name:Be.decimalLatitude+", "+Be.decimalLongitude,place_type:["reverse"],center:[Be.decimalLongitude,Be.decimalLatitude],bbox:[Be.decimalLongitude,Be.decimalLatitude,Be.decimalLongitude,Be.decimalLatitude],geometry:{type:"Point",coordinates:[Be.decimalLongitude,Be.decimalLatitude]}}),Lt=he,Be&&xe.focus())}catch(Be){if(Be&&typeof Be=="object"&&"name"in Be&&Be.name==="AbortError")return;throw Be}finally{Rt===Ot&&t(19,Ot=void 0)}}function br(){var Rt;if(!(Pe!=null&&Pe.length)||!b)return;const J=[180,90,-180,-90],at=!Pe.some(Be=>!Be.matching_text);let ht;for(const Be of Pe){const pt=Qt(Be);if(ht=ht===void 0?pt:pt===void 0?ht:Math.max(ht,pt),at||!Be.matching_text)for(const xt of[0,1,2,3])J[xt]=Math[xt<2?"min":"max"](J[xt],((Rt=Be.bbox)==null?void 0:Rt[xt])??Be.center[xt%2])}I&&Pe.length>0&&(q&&J[0]===J[2]&&J[1]===J[3]?I.flyTo(q.center,Qt(q)):I.fitBounds(Al(J),50,ht))}function Qt(J){var ht;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const at=J.id.replace(/\..*/,"");return(Array.isArray((ht=J.properties)==null?void 0:ht.categories)?J.properties.categories.reduce((Rt,Be)=>{const pt=Fe[at+"."+Be];return Rt===void 0?pt:pt===void 0?Rt:Math.max(Rt,pt)},void 0):void 0)??Fe[at]}function Dt(J){t(0,O=$==="always"),t(14,he=void 0),t(56,q=void 0),t(15,Je=-1),K(J[1].toFixed(6)+", "+Qc(J[0],[-180,180],!0).toFixed(6),!1,!0)}function wr(J){if(!he)return;let at=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;at&&(Je===(U?0:-1)&&at===-1&&t(15,Je=he.length),t(15,Je+=at),Je>=he.length&&t(15,Je=-1),Je<0&&U&&t(15,Je=0),J.preventDefault())}function fn(J=!0,at=!1){if(t(18,Ct=void 0),ce||at){if(on&&clearTimeout(on),W.length<R)return;const ht=W;on=window.setTimeout(()=>{dt(ht).catch(Rt=>t(18,Ct=Rt))},J?g:0)}else t(14,he=void 0),t(18,Ct=void 0)}function Mt(J){t(56,q=J),t(1,W=J.place_name),t(15,Je=-1)}const Vr=()=>xe.focus();function yr(J){Le[J?"unshift":"push"](()=>{xe=J,t(17,xe)})}function Te(){W=this.value,t(1,W),t(13,ge),t(28,_)}const Xe=()=>t(13,ge=!0),vr=()=>t(13,ge=!1),la=()=>fn(),ia=()=>{t(1,W=""),xe.focus()},sa=()=>t(0,O=!O),aa=()=>t(18,Ct=void 0),ua=J=>t(15,Je=J),fa=J=>Mt(J),ca=()=>{U||t(15,Je=-1)},da=()=>{};return r.$$set=J=>{"class"in J&&t(2,a=J.class),"apiKey"in J&&t(26,u=J.apiKey),"bbox"in J&&t(27,f=J.bbox),"clearButtonTitle"in J&&t(3,c=J.clearButtonTitle),"clearOnBlur"in J&&t(28,_=J.clearOnBlur),"collapsed"in J&&t(4,d=J.collapsed),"country"in J&&t(29,p=J.country),"debounceSearch"in J&&t(30,g=J.debounceSearch),"enableReverse"in J&&t(5,$=J.enableReverse),"errorMessage"in J&&t(6,L=J.errorMessage),"filter"in J&&t(31,k=J.filter),"flyTo"in J&&t(32,b=J.flyTo),"fuzzyMatch"in J&&t(33,S=J.fuzzyMatch),"language"in J&&t(34,N=J.language),"limit"in J&&t(35,j=J.limit),"mapController"in J&&t(36,I=J.mapController),"minLength"in J&&t(37,R=J.minLength),"noResultsMessage"in J&&t(7,D=J.noResultsMessage),"placeholder"in J&&t(8,B=J.placeholder),"proximity"in J&&t(38,E=J.proximity),"reverseActive"in J&&t(0,O=J.reverseActive),"reverseButtonTitle"in J&&t(9,H=J.reverseButtonTitle),"searchValue"in J&&t(1,W=J.searchValue),"pickedResultStyle"in J&&t(39,Z=J.pickedResultStyle),"showPlaceType"in J&&t(10,re=J.showPlaceType),"showResultsWhileTyping"in J&&t(40,ce=J.showResultsWhileTyping),"selectFirst"in J&&t(11,U=J.selectFirst),"flyToSelected"in J&&t(41,be=J.flyToSelected),"markerOnSelected"in J&&t(42,fe=J.markerOnSelected),"types"in J&&t(43,te=J.types),"exhaustiveReverseGeocoding"in J&&t(44,me=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&t(45,ue=J.excludeTypes),"zoom"in J&&t(46,Fe=J.zoom),"apiUrl"in J&&t(47,et=J.apiUrl),"fetchParameters"in J&&t(48,ye=J.fetchParameters),"iconsBaseUrl"in J&&t(12,we=J.iconsBaseUrl),"adjustUrlQuery"in J&&t(49,lt=J.adjustUrlQuery),"$$scope"in J&&t(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,O=$==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Et=ge),_&&!ge&&t(1,W="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&W.length<R&&(t(56,q=void 0),t(14,he=void 0),t(18,Ct=void 0),t(55,Pe=he)),r.$$.dirty[1]&33554688&&Z!=="marker-only"&&q&&!q.address&&q.geometry.type==="Point"&&q.place_type[0]!=="reverse"&&dt(q.id,{byId:!0}).catch(J=>t(18,Ct=J)),r.$$.dirty[1]&100663330&&(I&&q&&q.id!==yn&&b&&(!q.bbox||q.bbox[0]===q.bbox[2]&&q.bbox[1]===q.bbox[3]?I.flyTo(q.center,Qt(q)):I.fitBounds(Al(q.bbox),50,Qt(q)),t(14,he=void 0),t(55,Pe=void 0),t(15,Je=-1)),t(57,yn=q==null?void 0:q.id)),r.$$.dirty[0]&18432&&U&&he!=null&&he.length&&t(15,Je=0),r.$$.dirty[0]&2&&t(15,Je=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Pe!==he&&t(55,Pe=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&I&&I.setEventHandler(J=>{switch(J.type){case"mapClick":O&&Dt(J.coordinates);break;case"markerClick":{const at=he==null?void 0:he.find(ht=>ht.id===J.id);at&&Mt(at)}break;case"markerMouseEnter":Pe&&t(15,Je=Et?(he==null?void 0:he.findIndex(at=>at.id===J.id))??-1:-1);break;case"markerMouseLeave":Pe&&t(15,Je=-1);break}}),r.$$.dirty[0]&49152&&t(58,o=he==null?void 0:he[Je]),r.$$.dirty[1]&134218786&&I&&o&&b&&be&&I.flyTo(o.center,Qt(o)),r.$$.dirty[1]&256&&t(59,n=Z==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(fe||I==null||I.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&I&&fe&&!Pe&&(I.setFeatures(o?[o]:void 0,void 0,n),I.setSelectedMarker(o?0:-1)),r.$$.dirty[1]&318767136&&I&&I.setFeatures(Pe,q,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Pe&&I&&I.setSelectedMarker(Je),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&I){const J=bt(W);I.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Bt("select",{feature:o}),r.$$.dirty[1]&33554432&&Bt("pick",{feature:q}),r.$$.dirty[0]&81920&&Bt("optionsvisibilitychange",{optionsVisible:Et&&!!he}),r.$$.dirty[0]&16384&&Bt("featureslisted",{features:he}),r.$$.dirty[1]&16777216&&Bt("featuresmarked",{features:Pe}),r.$$.dirty[0]&1&&Bt("reversetoggle",{reverse:O}),r.$$.dirty[0]&2&&Bt("querychange",{query:W}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&I&&I.indicateReverse(O)},[O,W,a,c,d,$,L,D,B,H,re,U,we,ge,he,Je,Et,xe,Ct,Ot,st,zn,wr,fn,Mt,s,u,f,_,p,g,k,b,S,N,j,I,R,E,Z,ce,be,fe,te,me,ue,Fe,et,ye,lt,Ge,Ce,K,V,Q,Pe,q,yn,o,n,i,l,Vr,yr,Te,Xe,vr,la,ia,sa,aa,ua,fa,ca,da]}class id extends se{constructor(e){super(),ae(this,e,ld,od,ie,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Nl(r){let e,t,n;return t=new id({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"class","svelte-ixhnie")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l&4&&(i.mapController=o[2]),l&1&&(i.apiKey=o[0]),l&2&&(i.country=o[1]),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function sd(r){let e,t,n=r[2]&&Nl(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,[l]){o[2]?n?(n.p(o,l),l&4&&v(n,1)):(n=Nl(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function ad(r,e,t){let n,{apiKey:o}=e,{map:l}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(u){return u?Fa(u,tn,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=u=>{"apiKey"in u&&t(0,o=u.apiKey),"map"in u&&t(4,l=u.map),"country"in u&&t(1,i=u.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=a(l))},[o,i,n,s,l]}class ud extends se{constructor(e){super(),ae(this,e,ad,sd,ie,{apiKey:0,map:4,country:1})}}function Yt(r,e,t){let n=["match",r];for(let[o,l]of Object.entries(e))n.push(o),n.push(l);return n.push(t),n}function kt(r,e,t){let n=["step",r];for(let o=1;o<e.length;o++)n.push(t[o-1]),n.push(e[o]);return n.push(t[t.length-1]),n}function Ft(){return{type:"FeatureCollection",features:[]}}function fd(r){let e,t,n;return t=new Nn({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","legend")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p:Y,i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function cd(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function dd(r){let e,t,n;return t=new Gr({props:{colors:r[4],horiz:!0}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","legend")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p:Y,i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function _d(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function pd(r){let e,t,n;return t=new Gr({props:{colors:r[5],horiz:!0}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","legend")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p:Y,i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function md(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function gd(r){let e,t,n,o,l,i;const s=[ve("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Yt(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":ln(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=de(a,s[d]);e=new tt({props:a});const u=[ve("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Yt(["get","Level of Service"],r[4],"cyan"),"line-width":ln(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let f={};for(let d=0;d<u.length;d+=1)f=de(f,u[d]);n=new tt({props:f});const c=[ve("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Yt(["get","Infrastructure type"],r[5],"cyan"),"line-width":ln(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return l=new tt({props:_}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment)},m(d,p){F(e,d,p),w(d,t,p),F(n,d,p),w(d,o,p),F(l,d,p),i=!0},p(d,p){const g=p&9?He(s,[s[0],s[1],s[2],p&8&&{paint:{"line-color":Yt(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":ln(0)}},p&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const $=p&18?He(u,[u[0],u[1],p&16&&{paint:{"line-color":Yt(["get","Level of Service"],d[4],"cyan"),"line-width":ln(1)}},p&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};n.$set($);const L=p&36?He(c,[c[0],c[1],c[2],p&32&&{paint:{"line-color":Yt(["get","Infrastructure type"],d[5],"cyan"),"line-width":ln(1)}},p&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};l.$set(L)},i(d){i||(v(e.$$.fragment,d),v(n.$$.fragment,d),v(l.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),i=!1},d(d){d&&(y(t),y(o)),P(e,d),P(n,d),P(l,d)}}}function hd(r){let e,t,n,o,l,i,s,a,u,f,c;function _(k){r[6](k)}let d={label:"Traffic",$$slots:{help:[cd],legend:[fd]},$$scope:{ctx:r}};r[0]!==void 0&&(d.show=r[0]),e=new nn({props:d}),Le.push(()=>ze(e,"show",_));function p(k){r[7](k)}let g={label:"Level of Service",$$slots:{help:[_d],legend:[dd]},$$scope:{ctx:r}};r[1]!==void 0&&(g.show=r[1]),o=new nn({props:g}),Le.push(()=>ze(o,"show",p));function $(k){r[8](k)}let L={label:"Cycle infrastructure",$$slots:{help:[md],legend:[pd]},$$scope:{ctx:r}};return r[2]!==void 0&&(L.show=r[2]),s=new nn({props:L}),Le.push(()=>ze(s,"show",$)),f=new ur({props:{url:`pmtiles://${$t("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[gd]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment),i=M(),A(s.$$.fragment),u=M(),A(f.$$.fragment)},m(k,b){F(e,k,b),w(k,n,b),F(o,k,b),w(k,i,b),F(s,k,b),w(k,u,b),F(f,k,b),c=!0},p(k,[b]){const S={};b&512&&(S.$$scope={dirty:b,ctx:k}),!t&&b&1&&(t=!0,S.show=k[0],Oe(()=>t=!1)),e.$set(S);const N={};b&512&&(N.$$scope={dirty:b,ctx:k}),!l&&b&2&&(l=!0,N.show=k[1],Oe(()=>l=!1)),o.$set(N);const j={};b&512&&(j.$$scope={dirty:b,ctx:k}),!a&&b&4&&(a=!0,j.show=k[2],Oe(()=>a=!1)),s.$set(j);const I={};b&519&&(I.$$scope={dirty:b,ctx:k}),f.$set(I)},i(k){c||(v(e.$$.fragment,k),v(o.$$.fragment,k),v(s.$$.fragment,k),v(f.$$.fragment,k),c=!0)},o(k){C(e.$$.fragment,k),C(o.$$.fragment,k),C(s.$$.fragment,k),C(f.$$.fragment,k),c=!1},d(k){k&&(y(n),y(i),y(u)),P(e,k),P(o,k),P(s,k),P(f,k)}}}function bd(r,e,t){let n=!1,o=!1,l=!1,i={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},a={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function u(_){n=_,t(0,n)}function f(_){o=_,t(1,o)}function c(_){l=_,t(2,l)}return[n,o,l,i,s,a,u,f,c]}class wd extends se{constructor(e){super(),ae(this,e,bd,hd,ie,{})}}function yd(r){let e,t,n;return t=new Gr({props:{colors:r[1],horiz:!0}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","legend")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p:Y,i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function vd(r){let e;return{c(){e=h("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    .`,T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function $d(r){let e=r[3].name+"",t;return{c(){t=z(e)},m(n,o){w(n,t,o)},p(n,o){o&8&&e!==(e=n[3].name+"")&&oe(t,e)},d(n){n&&y(t)}}}function kd(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[$d,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Cd(r){let e,t;const n=[ve("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[kd]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&3?He(n,[n[0],i&2&&{paint:{"circle-color":l[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Sd(r){let e=r[3].name+"",t;return{c(){t=z(e)},m(n,o){w(n,t,o)},p(n,o){o&8&&e!==(e=n[3].name+"")&&oe(t,e)},d(n){n&&y(t)}}}function Ld(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[Sd,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Md(r){let e,t;const n=[ve("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Ld]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&3?He(n,[n[0],i&2&&{paint:{"circle-color":l[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Td(r){let e=r[3].name+"",t,n,o=r[3].pupils+"",l,i;return{c(){t=z(e),n=z(" with "),l=z(o),i=z(" pupils")},m(s,a){w(s,t,a),w(s,n,a),w(s,l,a),w(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&oe(t,e),a&8&&o!==(o=s[3].pupils+"")&&oe(l,o)},d(s){s&&(y(t),y(n),y(l),y(i))}}}function Ad(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[Td,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Fd(r){let e,t;const n=[ve("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Ad]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&3?He(n,[n[0],i&2&&{paint:{"circle-color":l[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Pd(r){let e,t,n,o,l,i,s,a,u;function f(_){r[2](_)}let c={label:"POIs",$$slots:{help:[vd],legend:[yd]},$$scope:{ctx:r}};return r[0]!==void 0&&(c.show=r[0]),e=new nn({props:c}),Le.push(()=>ze(e,"show",f)),o=new Ve({props:{data:$t("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[Cd]},$$scope:{ctx:r}}}),i=new Ve({props:{data:$t("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[Md]},$$scope:{ctx:r}}}),a=new Ve({props:{data:$t("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[Fd]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment),l=M(),A(i.$$.fragment),s=M(),A(a.$$.fragment)},m(_,d){F(e,_,d),w(_,n,d),F(o,_,d),w(_,l,d),F(i,_,d),w(_,s,d),F(a,_,d),u=!0},p(_,[d]){const p={};d&16&&(p.$$scope={dirty:d,ctx:_}),!t&&d&1&&(t=!0,p.show=_[0],Oe(()=>t=!1)),e.$set(p);const g={};d&17&&(g.$$scope={dirty:d,ctx:_}),o.$set(g);const $={};d&17&&($.$$scope={dirty:d,ctx:_}),i.$set($);const L={};d&17&&(L.$$scope={dirty:d,ctx:_}),a.$set(L)},i(_){u||(v(e.$$.fragment,_),v(o.$$.fragment,_),v(i.$$.fragment,_),v(a.$$.fragment,_),u=!0)},o(_){C(e.$$.fragment,_),C(o.$$.fragment,_),C(i.$$.fragment,_),C(a.$$.fragment,_),u=!1},d(_){_&&(y(n),y(l),y(s)),P(e,_),P(o,_),P(i,_),P(a,_)}}}function jd(r,e,t){let n=!1,o={Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"};function l(i){n=i,t(0,n)}return[n,o,l]}class Id extends se{constructor(e){super(),ae(this,e,jd,Pd,ie,{})}}let zs=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],Os=[20,30,40,50,60,70],fr=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],cr=fr,dr=[0,20,40,60,80,100],_r=fr.toReversed(),pr=[0,4700,13e3,33e3,94e3,198e4],Pr=fr.toReversed(),Bs=[0,.3,.6,1,1.5,2],Ds=fr.toReversed(),Bo=[0,1,10,50,100,1e3],Do=fr.toReversed();function Us(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const $n={mapFeature:{hover:{backgroundColor:"blue"}}};function El(r,e,t){const n=r.slice();return n[3]=e[t],n}function Rl(r,e,t){const n=r.slice();return n[6]=e[t],n}function zl(r){let e,t;return{c(){e=h("span"),t=z(` 
    `),X(e,"background",r[6]),X(e,"width","100%"),X(e,"border","1px solid black")},m(n,o){w(n,e,o),m(e,t)},p(n,o){o&1&&X(e,"background",n[6])},d(n){n&&y(e)}}}function Nd(r){let e,t=r[3]+"",n;return{c(){e=h("span"),n=z(t)},m(o,l){w(o,e,l),m(e,n)},p(o,l){l&2&&t!==(t=o[3]+"")&&oe(n,t)},d(o){o&&y(e)}}}function Ed(r){let e,t=r[3].toFixed(r[2])+"",n;return{c(){e=h("span"),n=z(t)},m(o,l){w(o,e,l),m(e,n)},p(o,l){l&6&&t!==(t=o[3].toFixed(o[2])+"")&&oe(n,t)},d(o){o&&y(e)}}}function Ol(r){let e;function t(l,i){return l[2]>0?Ed:Nd}let n=t(r),o=n(r);return{c(){o.c(),e=Qe()},m(l,i){o.m(l,i),w(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&y(e),o.d(l)}}}function Rd(r){let e,t,n,o=Se(r[0]),l=[];for(let a=0;a<o.length;a+=1)l[a]=zl(Rl(r,o,a));let i=Se(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ol(El(r,i,a));return{c(){e=h("div");for(let a=0;a<l.length;a+=1)l[a].c();t=M(),n=h("div");for(let a=0;a<s.length;a+=1)s[a].c();X(e,"display","flex"),X(n,"display","flex"),X(n,"justify-content","space-around")},m(a,u){w(a,e,u);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);w(a,t,u),w(a,n,u);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(n,null)},p(a,[u]){if(u&1){o=Se(a[0]);let f;for(f=0;f<o.length;f+=1){const c=Rl(a,o,f);l[f]?l[f].p(c,u):(l[f]=zl(c),l[f].c(),l[f].m(e,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=o.length}if(u&6){i=Se(a[1]);let f;for(f=0;f<i.length;f+=1){const c=El(a,i,f);s[f]?s[f].p(c,u):(s[f]=Ol(c),s[f].c(),s[f].m(n,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=i.length}},i:Y,o:Y,d(a){a&&(y(e),y(t),y(n)),ut(l,a),ut(s,a)}}}function zd(r,e,t){let{colorScale:n}=e,{buckets:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&t(0,n=i.colorScale),"buckets"in i&&t(1,o=i.buckets),"decimalPlaces"in i&&t(2,l=i.decimalPlaces)},[n,o,l]}class Hs extends se{constructor(e){super(),ae(this,e,zd,Rd,ie,{colorScale:0,buckets:1,decimalPlaces:2})}}function Od(r){let e,t,n,o,l;return t=new Hs({props:{colorScale:cr,buckets:Us(dr)}}),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("div"),o.innerHTML="<span>More deprived</span> <span>Less deprived</span>",X(o,"display","flex"),X(o,"justify-content","space-between"),T(e,"slot","legend")},m(i,s){w(i,e,s),F(t,e,null),m(e,n),m(e,o),l=!0},p:Y,i(i){l||(v(t.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),l=!1},d(i){i&&y(e),P(t)}}}function Bd(r){let e;return{c(){e=h("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Dd(r){let e,t,n,o,l;return t=new Nn({props:{colorScale:_r,limits:pr}}),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("div"),o.innerHTML="<span>Less less</span> <span>More dense</span>",X(o,"display","flex"),X(o,"justify-content","space-between"),T(e,"slot","legend")},m(i,s){w(i,e,s),F(t,e,null),m(e,n),m(e,o),l=!0},p:Y,i(i){l||(v(t.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),l=!1},d(i){i&&y(e),P(t)}}}function Ud(r){let e;return{c(){e=h("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Hd(r){let e,t,n=r[4].id+"",o,l,i=r[4].population.toLocaleString()+"",s,a,u=r[4].imd_rank+"",f,c,_=r[4].imd_percentile+"",d,p;return{c(){e=h("p"),t=z("Data zone "),o=z(n),l=z(`
        has `),s=z(i),a=z(`
        people, and a SIMD rank of `),f=z(u),c=z(`, making it less deprived
        than `),d=z(_),p=z("% of data zones.")},m(g,$){w(g,e,$),m(e,t),m(e,o),m(e,l),m(e,s),m(e,a),m(e,f),m(e,c),m(e,d),m(e,p)},p(g,$){$&16&&n!==(n=g[4].id+"")&&oe(o,n),$&16&&i!==(i=g[4].population.toLocaleString()+"")&&oe(s,i),$&16&&u!==(u=g[4].imd_rank+"")&&oe(f,u),$&16&&_!==(_=g[4].imd_percentile+"")&&oe(d,_)},d(g){g&&y(e)}}}function Gd(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[Hd,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Wd(r){let e,t,n=r[4].id+"",o,l,i=r[4].population.toLocaleString()+"",s,a,u=Math.round(r[4].population/(r[4].area/1e6)).toLocaleString()+"",f,c;return{c(){e=h("p"),t=z("Data zone "),o=z(n),l=z(`
        has `),s=z(i),a=z(`
        people, with a density of `),f=z(u),c=z(" people per square kilometer")},m(_,d){w(_,e,d),m(e,t),m(e,o),m(e,l),m(e,s),m(e,a),m(e,f),m(e,c)},p(_,d){d&16&&n!==(n=_[4].id+"")&&oe(o,n),d&16&&i!==(i=_[4].population.toLocaleString()+"")&&oe(s,i),d&16&&u!==(u=Math.round(_[4].population/(_[4].area/1e6)).toLocaleString()+"")&&oe(f,u)},d(_){_&&y(e)}}}function qd(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[Wd,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&48&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Jd(r){let e,t,n,o,l,i;const s=[ve("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":kt(["get","imd_percentile"],dr,cr),"fill-opacity":rt(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[Gd]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=de(a,s[d]);e=new It({props:a});const u=[ve("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":kt(["/",["get","population"],["/",["get","area"],1e6]],pr,_r),"fill-opacity":rt(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let f={$$slots:{default:[qd]},$$scope:{ctx:r}};for(let d=0;d<u.length;d+=1)f=de(f,u[d]);n=new It({props:f});const c=[ve("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return l=new tt({props:_}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment)},m(d,p){F(e,d,p),w(d,t,p),F(n,d,p),w(d,o,p),F(l,d,p),i=!0},p(d,p){const g=p&1?He(s,[s[0],s[1],s[2],s[3],{layout:{visibility:d[0]?"visible":"none"}}]):{};p&32&&(g.$$scope={dirty:p,ctx:d}),e.$set(g);const $=p&2?He(u,[u[0],u[1],u[2],u[3],{layout:{visibility:d[1]?"visible":"none"}}]):{};p&32&&($.$$scope={dirty:p,ctx:d}),n.$set($);const L=p&3?He(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};l.$set(L)},i(d){i||(v(e.$$.fragment,d),v(n.$$.fragment,d),v(l.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),i=!1},d(d){d&&(y(t),y(o)),P(e,d),P(n,d),P(l,d)}}}function Yd(r){let e,t,n,o,l,i,s,a;function u(d){r[2](d)}let f={label:"SIMD",$$slots:{help:[Bd],legend:[Od]},$$scope:{ctx:r}};r[0]!==void 0&&(f.show=r[0]),e=new nn({props:f}),Le.push(()=>ze(e,"show",u));function c(d){r[3](d)}let _={label:"Population density",$$slots:{help:[Ud],legend:[Dd]},$$scope:{ctx:r}};return r[1]!==void 0&&(_.show=r[1]),o=new nn({props:_}),Le.push(()=>ze(o,"show",c)),s=new ur({props:{url:`pmtiles://${$t("cnt_layers/population.pmtiles")}`,$$slots:{default:[Jd]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment),i=M(),A(s.$$.fragment)},m(d,p){F(e,d,p),w(d,n,p),F(o,d,p),w(d,i,p),F(s,d,p),a=!0},p(d,[p]){const g={};p&32&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Oe(()=>t=!1)),e.$set(g);const $={};p&32&&($.$$scope={dirty:p,ctx:d}),!l&&p&2&&(l=!0,$.show=d[1],Oe(()=>l=!1)),o.$set($);const L={};p&35&&(L.$$scope={dirty:p,ctx:d}),s.$set(L)},i(d){a||(v(e.$$.fragment,d),v(o.$$.fragment,d),v(s.$$.fragment,d),a=!0)},o(d){C(e.$$.fragment,d),C(o.$$.fragment,d),C(s.$$.fragment,d),a=!1},d(d){d&&(y(n),y(i)),P(e,d),P(o,d),P(s,d)}}}function Zd(r,e,t){let n=!1,o=!1;function l(s){n=s,t(0,n)}function i(s){o=s,t(1,o)}return[n,o,l,i]}class Kd extends se{constructor(e){super(),ae(this,e,Zd,Yd,ie,{})}}function Xd(r){let e;return{c(){e=h("div"),e.innerHTML=`<img src="${hs}" alt="National Rail logo"/>
    Station`,T(e,"slot","legend"),X(e,"display","flex"),X(e,"gap","8px"),X(e,"align-items","center")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Vd(r){let e;return{c(){e=h("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Qd(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=h("p"),n=z(t)},m(o,l){w(o,e,l),m(e,n)},p(o,l){l&4&&t!==(t=(o[2].name??"Unnamed railway station")+"")&&oe(n,t)},d(o){o&&y(e)}}}function xd(r){let e,t;return e=new _t({props:{$$slots:{default:[Qd,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&12&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function e_(r){let e,t;const n=[ve("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[xd]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new lr({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&1?He(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:l[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function t_(r){let e,t,n,o,l;function i(a){r[1](a)}let s={label:"Railway stations",$$slots:{help:[Vd],legend:[Xd]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new nn({props:s}),Le.push(()=>ze(e,"show",i)),o=new Ve({props:{data:$t("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[e_]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment)},m(a,u){F(e,a,u),w(a,n,u),F(o,a,u),l=!0},p(a,[u]){const f={};u&8&&(f.$$scope={dirty:u,ctx:a}),!t&&u&1&&(t=!0,f.show=a[0],Oe(()=>t=!1)),e.$set(f);const c={};u&9&&(c.$$scope={dirty:u,ctx:a}),o.$set(c)},i(a){l||(v(e.$$.fragment,a),v(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&y(n),P(e,a),P(o,a)}}}function n_(r,e,t){let n=!1;function o(l){n=l,t(0,n)}return[n,o]}class r_ extends se{constructor(e){super(),ae(this,e,n_,t_,ie,{})}}function Bl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Dl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Ul(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Hl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Gl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Wl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function o_(r){let e;return{c(){e=h("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function ql(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=z(t),e.__value=r[18],We(e,e.__value)},m(o,l){w(o,e,l),m(e,n)},p:Y,d(o){o&&y(e)}}}function Jl(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=z(t),e.__value=r[18],We(e,e.__value)},m(o,l){w(o,e,l),m(e,n)},p:Y,d(o){o&&y(e)}}}function Yl(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=z(t),e.__value=r[18],We(e,e.__value)},m(o,l){w(o,e,l),m(e,n)},p:Y,d(o){o&&y(e)}}}function Zl(r){let e,t=r[19]+"",n;return{c(){e=h("option"),n=z(t),e.__value=r[18],We(e,e.__value)},m(o,l){w(o,e,l),m(e,n)},p:Y,d(o){o&&y(e)}}}function l_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L,k,b=Se(r[7]),S=[];for(let E=0;E<b.length;E+=1)S[E]=ql(Wl(r,b,E));let N=Se(r[8]),j=[];for(let E=0;E<N.length;E+=1)j[E]=Jl(Gl(r,N,E));let I=Se(r[9]),R=[];for(let E=0;E<I.length;E+=1)R[E]=Yl(Hl(r,I,E));let D=Se(r[10]),B=[];for(let E=0;E<D.length;E+=1)B[E]=Zl(Ul(r,D,E));return{c(){e=h("div"),t=h("label"),n=z(`Trip purpose:
      `),o=h("select");for(let E=0;E<S.length;E+=1)S[E].c();l=M(),i=h("label"),s=z(`Scenario:
      `),a=h("select");for(let E=0;E<j.length;E+=1)j[E].c();u=M(),f=h("label"),c=z(`Network type:
      `),_=h("select");for(let E=0;E<R.length;E+=1)R[E].c();d=M(),p=h("label"),g=z(`Color by:
      `),$=h("select");for(let E=0;E<B.length;E+=1)B[E].c();r[0]===void 0&&dn(()=>r[11].call(o)),r[1]===void 0&&dn(()=>r[12].call(a)),r[2]===void 0&&dn(()=>r[13].call(_)),r[3]===void 0&&dn(()=>r[14].call($)),T(e,"slot","legend")},m(E,O){w(E,e,O),m(e,t),m(t,n),m(t,o);for(let H=0;H<S.length;H+=1)S[H]&&S[H].m(o,null);vt(o,r[0],!0),m(e,l),m(e,i),m(i,s),m(i,a);for(let H=0;H<j.length;H+=1)j[H]&&j[H].m(a,null);vt(a,r[1],!0),m(e,u),m(e,f),m(f,c),m(f,_);for(let H=0;H<R.length;H+=1)R[H]&&R[H].m(_,null);vt(_,r[2],!0),m(e,d),m(e,p),m(p,g),m(p,$);for(let H=0;H<B.length;H+=1)B[H]&&B[H].m($,null);vt($,r[3],!0),L||(k=[ne(o,"change",r[11]),ne(a,"change",r[12]),ne(_,"change",r[13]),ne($,"change",r[14])],L=!0)},p(E,O){if(O[0]&128){b=Se(E[7]);let H;for(H=0;H<b.length;H+=1){const W=Wl(E,b,H);S[H]?S[H].p(W,O):(S[H]=ql(W),S[H].c(),S[H].m(o,null))}for(;H<S.length;H+=1)S[H].d(1);S.length=b.length}if(O[0]&129&&vt(o,E[0]),O[0]&256){N=Se(E[8]);let H;for(H=0;H<N.length;H+=1){const W=Gl(E,N,H);j[H]?j[H].p(W,O):(j[H]=Jl(W),j[H].c(),j[H].m(a,null))}for(;H<j.length;H+=1)j[H].d(1);j.length=N.length}if(O[0]&258&&vt(a,E[1]),O[0]&512){I=Se(E[9]);let H;for(H=0;H<I.length;H+=1){const W=Hl(E,I,H);R[H]?R[H].p(W,O):(R[H]=Yl(W),R[H].c(),R[H].m(_,null))}for(;H<R.length;H+=1)R[H].d(1);R.length=I.length}if(O[0]&516&&vt(_,E[2]),O[0]&1024){D=Se(E[10]);let H;for(H=0;H<D.length;H+=1){const W=Ul(E,D,H);B[H]?B[H].p(W,O):(B[H]=Zl(W),B[H].c(),B[H].m($,null))}for(;H<B.length;H+=1)B[H].d(1);B.length=D.length}O[0]&1032&&vt($,E[3])},d(E){E&&y(e),ut(S,E),ut(j,E),ut(R,E),ut(B,E),L=!1,ct(k)}}}function Kl(r){let e,t,n,o,l=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,u=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",f,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",p,g;return{c(){e=h("tr"),t=h("th"),t.textContent=`${r[19]}`,n=M(),o=h("td"),i=z(l),s=M(),a=h("td"),f=z(u),c=M(),_=h("td"),p=z(d),g=M()},m($,L){w($,e,L),m(e,t),m(e,n),m(e,o),m(o,i),m(e,s),m(e,a),m(a,f),m(e,c),m(e,_),m(_,p),m(e,g)},p($,L){L[0]&131072&&l!==(l=$[17][`${$[18]}_fastest_bicycle`].toLocaleString()+"")&&oe(i,l),L[0]&131072&&u!==(u=$[17][`${$[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&oe(f,u),L[0]&131072&&d!==(d=$[17][`${$[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&oe(p,d)},d($){$&&y(e)}}}function Xl(r){let e,t,n,o,l=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,u=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",f,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",p,g;return{c(){e=h("tr"),t=h("th"),t.textContent=`${r[19]}`,n=M(),o=h("td"),i=z(l),s=M(),a=h("td"),f=z(u),c=M(),_=h("td"),p=z(d),g=M()},m($,L){w($,e,L),m(e,t),m(e,n),m(e,o),m(o,i),m(e,s),m(e,a),m(a,f),m(e,c),m(e,_),m(_,p),m(e,g)},p($,L){L[0]&131072&&l!==(l=$[17][`${$[18]}_quietest_bicycle`].toLocaleString()+"")&&oe(i,l),L[0]&131072&&u!==(u=$[17][`${$[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&oe(f,u),L[0]&131072&&d!==(d=$[17][`${$[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&oe(p,d)},d($){$&&y(e)}}}function i_(r){let e,t,n,o=r[17][r[4]].toLocaleString()+"",l,i,s,a,u=r[17].gradient+"",f,c,_,d,p,g=r[17].quietness+"",$,L,k,b,S,N,j,I,R,D,B,E,O,H,W,Z,re,ce=Se(r[7]),U=[];for(let te=0;te<ce.length;te+=1)U[te]=Kl(Dl(r,ce,te));let be=Se(r[7]),fe=[];for(let te=0;te<be.length;te+=1)fe[te]=Xl(Bl(r,be,te));return{c(){e=h("div"),t=h("p"),n=z("Cyclists: "),l=z(o),i=M(),s=h("p"),a=z("Gradient: "),f=z(u),c=z("%"),_=M(),d=h("p"),p=z("Cycle-friendliness: "),$=z(g),L=z("%"),k=M(),b=h("details"),S=h("summary"),S.textContent="All network details",N=M(),j=h("p"),j.textContent="Fast/Direct network",I=M(),R=h("table"),D=h("tr"),D.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",B=M();for(let te=0;te<U.length;te+=1)U[te].c();E=M(),O=h("p"),O.textContent="Quiet/Indirect network",H=M(),W=h("table"),Z=h("tr"),Z.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",re=M();for(let te=0;te<fe.length;te+=1)fe[te].c();X(e,"max-width","30vw"),X(e,"max-height","60vh"),X(e,"overflow","auto")},m(te,me){w(te,e,me),m(e,t),m(t,n),m(t,l),m(e,i),m(e,s),m(s,a),m(s,f),m(s,c),m(e,_),m(e,d),m(d,p),m(d,$),m(d,L),m(e,k),m(e,b),m(b,S),m(b,N),m(b,j),m(b,I),m(b,R),m(R,D),m(R,B);for(let ue=0;ue<U.length;ue+=1)U[ue]&&U[ue].m(R,null);m(b,E),m(b,O),m(b,H),m(b,W),m(W,Z),m(W,re);for(let ue=0;ue<fe.length;ue+=1)fe[ue]&&fe[ue].m(W,null)},p(te,me){if(me[0]&131088&&o!==(o=te[17][te[4]].toLocaleString()+"")&&oe(l,o),me[0]&131072&&u!==(u=te[17].gradient+"")&&oe(f,u),me[0]&131072&&g!==(g=te[17].quietness+"")&&oe($,g),me[0]&131200){ce=Se(te[7]);let ue;for(ue=0;ue<ce.length;ue+=1){const Fe=Dl(te,ce,ue);U[ue]?U[ue].p(Fe,me):(U[ue]=Kl(Fe),U[ue].c(),U[ue].m(R,null))}for(;ue<U.length;ue+=1)U[ue].d(1);U.length=ce.length}if(me[0]&131200){be=Se(te[7]);let ue;for(ue=0;ue<be.length;ue+=1){const Fe=Bl(te,be,ue);fe[ue]?fe[ue].p(Fe,me):(fe[ue]=Xl(Fe),fe[ue].c(),fe[ue].m(W,null))}for(;ue<fe.length;ue+=1)fe[ue].d(1);fe.length=be.length}},d(te){te&&y(e),ut(U,te),ut(fe,te)}}}function s_(r){let e,t;return e=new _t({props:{openOn:"click",$$slots:{default:[i_,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&131088|o[1]&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function a_(r){let e,t;const n=[ve("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Vl(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let o={$$slots:{default:[s_]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i[0]&112?He(n,[n[0],n[1],i[0]&80&&{paint:{"line-color":l[6],"line-width":Vl(["get",l[4]])}},i[0]&32&&{layout:{visibility:l[5]?"visible":"none"}},n[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function u_(r){let e,t,n,o,l;function i(a){r[15](a)}let s={label:"Route network",$$slots:{legend:[l_],help:[o_]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new nn({props:s}),Le.push(()=>ze(e,"show",i)),o=new ur({props:{url:`pmtiles://${$t("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[a_]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment)},m(a,u){F(e,a,u),w(a,n,u),F(o,a,u),l=!0},p(a,u){const f={};u[0]&15|u[1]&2&&(f.$$scope={dirty:u,ctx:a}),!t&&u[0]&32&&(t=!0,f.show=a[5],Oe(()=>t=!1)),e.$set(f);const c={};u[0]&112|u[1]&2&&(c.$$scope={dirty:u,ctx:a}),o.$set(c)},i(a){l||(v(e.$$.fragment,a),v(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&y(n),P(e,a),P(o,a)}}}function Vl(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function f_(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function c_(r,e,t){let n,o,l=!1,i="all",s="bicycle_go_dutch",a="fastest",u="flow",f=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],p={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function g(){i=_n(this),t(0,i),t(7,f)}function $(){s=_n(this),t(1,s),t(8,c)}function L(){a=_n(this),t(2,a),t(9,_)}function k(){u=_n(this),t(3,u),t(10,d)}function b(S){l=S,t(5,l)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&t(6,o={none:"#304ce7",flow:f_(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:kt(["abs",["get","gradient"]],p.limits,p.colorScale)}[u])},[i,s,a,u,n,l,o,f,c,_,d,g,$,L,k,b]}class d_ extends se{constructor(e){super(),ae(this,e,c_,u_,ie,{},null,[-1,-1])}}function __(r){let e;return{c(){e=h("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.</p>`,T(e,"slot","help")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function p_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L,k,b,S,N,j,I;return S=new Gr({props:{colors:r[6],horiz:!0}}),{c(){e=h("div"),t=h("fieldset"),n=h("label"),o=h("input"),l=z(`
        Pedestrians`),i=M(),s=h("label"),a=h("input"),u=z(`
        Cyclists`),f=M(),c=h("fieldset"),_=h("label"),d=z(`From
        `),p=h("input"),g=M(),$=h("label"),L=z(`To
        `),k=h("input"),b=M(),A(S.$$.fragment),T(o,"type","checkbox"),T(o,"class","svelte-rvrx5w"),T(a,"type","checkbox"),T(a,"class","svelte-rvrx5w"),X(t,"display","flex"),X(t,"gap","3em"),T(t,"class","svelte-rvrx5w"),T(p,"type","number"),T(p,"min",2017),T(p,"max",2023),T(p,"class","svelte-rvrx5w"),T(k,"type","number"),T(k,"min",2017),T(k,"max",2023),T(k,"class","svelte-rvrx5w"),T(c,"class","year-filter svelte-rvrx5w"),T(e,"slot","legend")},m(R,D){w(R,e,D),m(e,t),m(t,n),m(n,o),o.checked=r[1].pedestrians,m(n,l),m(t,i),m(t,s),m(s,a),a.checked=r[1].cyclists,m(s,u),m(e,f),m(e,c),m(c,_),m(_,d),m(_,p),We(p,r[1].minYear),m(c,g),m(c,$),m($,L),m($,k),We(k,r[1].maxYear),m(e,b),F(S,e,null),N=!0,j||(I=[ne(o,"change",r[7]),ne(a,"change",r[8]),ne(p,"input",r[9]),ne(k,"input",r[10])],j=!0)},p(R,D){D&2&&(o.checked=R[1].pedestrians),D&2&&(a.checked=R[1].cyclists),D&2&&kn(p.value)!==R[1].minYear&&We(p,R[1].minYear),D&2&&kn(k.value)!==R[1].maxYear&&We(k,R[1].maxYear)},i(R){N||(v(S.$$.fragment,R),N=!0)},o(R){C(S.$$.fragment,R),N=!1},d(R){R&&y(e),P(S),j=!1,ct(I)}}}function Ql(r){let e,t,n,o=r[3][r[12].pedestrian_location]+"",l;return{c(){e=h("p"),t=z("Pedestrian location: "),n=h("b"),l=z(o)},m(i,s){w(i,e,s),m(e,t),m(e,n),m(n,l)},p(i,s){s&4096&&o!==(o=i[3][i[12].pedestrian_location]+"")&&oe(l,o)},d(i){i&&y(e)}}}function xl(r){let e,t,n,o=r[4][r[12].pedestrian_movement]+"",l;return{c(){e=h("p"),t=z("Pedestrian movement: "),n=h("b"),l=z(o)},m(i,s){w(i,e,s),m(e,t),m(e,n),m(n,l)},p(i,s){s&4096&&o!==(o=i[4][i[12].pedestrian_movement]+"")&&oe(l,o)},d(i){i&&y(e)}}}function m_(r){let e,t,n,o=r[12].year+"",l,i,s,a,u,f=r[5][r[12].severity]+"",c,_,d,p,g,$=ei(r[12])+"",L,k,b,S,N,j=r[12].pedestrian_location&&Ql(r),I=r[12].pedestrian_movement&&xl(r);return{c(){e=h("p"),t=z("Year: "),n=h("b"),l=z(o),i=M(),s=h("p"),a=z("Severity: "),u=h("b"),c=z(f),_=M(),d=h("p"),p=z("Casualties: "),g=h("b"),L=z($),k=M(),j&&j.c(),b=M(),I&&I.c(),S=M(),N=h("p"),N.textContent="Click to open full report in CycleStreets"},m(R,D){w(R,e,D),m(e,t),m(e,n),m(n,l),w(R,i,D),w(R,s,D),m(s,a),m(s,u),m(u,c),w(R,_,D),w(R,d,D),m(d,p),m(d,g),m(g,L),w(R,k,D),j&&j.m(R,D),w(R,b,D),I&&I.m(R,D),w(R,S,D),w(R,N,D)},p(R,D){D&4096&&o!==(o=R[12].year+"")&&oe(l,o),D&4096&&f!==(f=R[5][R[12].severity]+"")&&oe(c,f),D&4096&&$!==($=ei(R[12])+"")&&oe(L,$),R[12].pedestrian_location?j?j.p(R,D):(j=Ql(R),j.c(),j.m(b.parentNode,b)):j&&(j.d(1),j=null),R[12].pedestrian_movement?I?I.p(R,D):(I=xl(R),I.c(),I.m(S.parentNode,S)):I&&(I.d(1),I=null)},d(R){R&&(y(e),y(i),y(s),y(_),y(d),y(k),y(b),y(S),y(N)),j&&j.d(R),I&&I.d(R)}}}function g_(r){let e,t;return e=new _t({props:{$$slots:{default:[m_,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&12288&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function h_(r){let e,t;const n=[ve("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":kt(["get","severity"],[1,2,3],[ho,bo,wo]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let o={$$slots:{default:[g_]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),e.$on("click",w_),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&7?He(n,[n[0],n[1],i&0&&{paint:{"circle-color":kt(["get","severity"],[1,2,3],[ho,bo,wo]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},i&6&&{filter:l[2](l[1])},i&1&&{layout:{visibility:l[0]?"visible":"none"}},n[5]]):{};i&8192&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function b_(r){let e,t,n,o,l;function i(a){r[11](a)}let s={label:"Collisions",$$slots:{legend:[p_],help:[__]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new nn({props:s}),Le.push(()=>ze(e,"show",i)),o=new ur({props:{url:`pmtiles://${$t("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[h_]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment)},m(a,u){F(e,a,u),w(a,n,u),F(o,a,u),l=!0},p(a,[u]){const f={};u&8194&&(f.$$scope={dirty:u,ctx:a}),!t&&u&1&&(t=!0,f.show=a[0],Oe(()=>t=!1)),e.$set(f);const c={};u&8195&&(c.$$scope={dirty:u,ctx:a}),o.$set(c)},i(a){l||(v(e.$$.fragment,a),v(o.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),l=!1},d(a){a&&y(n),P(e,a),P(o,a)}}}let ho="#080C54",bo="#1F9EB7",wo="#CDE594";function ei(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function w_(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function y_(r,e,t){let n=!1,o={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function l(g){let $=["any"];return o.pedestrians&&$.push(["get","pedestrian"]),o.cyclists&&$.push(["get","cyclist"]),["all",[">=",["get","year"],o.minYear],["<=",["get","year"],o.maxYear],$]}let i={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},a={1:"Fatal",2:"Serious",3:"Slight"},u={Fatal:ho,Serious:bo,Slight:wo};function f(){o.pedestrians=this.checked,t(1,o)}function c(){o.cyclists=this.checked,t(1,o)}function _(){o.minYear=kn(this.value),t(1,o)}function d(){o.maxYear=kn(this.value),t(1,o)}function p(g){n=g,t(0,n)}return[n,o,l,i,s,a,u,f,c,_,d,p]}class v_ extends se{constructor(e){super(),ae(this,e,y_,b_,ie,{})}}function ti(r){let e;return{c(){e=z("Layers")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function $_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L,k,b,S,N,j,I,R;o=new yf({props:{color:"#333"}});let D=r[0]&&ti();return u=new Id({}),c=new Kd({}),d=new r_({}),g=new jc({}),L=new wd({}),b=new d_({}),N=new v_({}),{c(){e=h("div"),t=h("button"),n=h("div"),A(o.$$.fragment),l=M(),D&&D.c(),s=M(),a=h("div"),A(u.$$.fragment),f=M(),A(c.$$.fragment),_=M(),A(d.$$.fragment),p=M(),A(g.$$.fragment),$=M(),A(L.$$.fragment),k=M(),A(b.$$.fragment),S=M(),A(N.$$.fragment),X(n,"display","flex"),X(n,"gap","12px"),X(n,"color","#333"),X(n,"align-items","center"),X(n,"justify-content","center"),T(t,"class",i="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1o5jpn"),T(t,"aria-label","Layers"),X(a,"flex-direction","column"),X(a,"display",r[0]?"flex":"none"),X(a,"background-color","#515f7A"),T(e,"class","pico contextual-layers svelte-1o5jpn"),X(e,"display","flex"),X(e,"flex-direction","column"),X(e,"max-height","80vh"),X(e,"overflow","auto"),X(e,"border-radius","5px"),X(e,"width",r[0]?"300px":"auto")},m(B,E){w(B,e,E),m(e,t),m(t,n),F(o,n,null),m(n,l),D&&D.m(n,null),m(e,s),m(e,a),F(u,a,null),m(a,f),F(c,a,null),m(a,_),F(d,a,null),m(a,p),F(g,a,null),m(a,$),F(L,a,null),m(a,k),F(b,a,null),m(a,S),F(N,a,null),j=!0,I||(R=ne(t,"click",r[1]),I=!0)},p(B,E){B[0]?D||(D=ti(),D.c(),D.m(n,null)):D&&(D.d(1),D=null),(!j||E&1&&i!==(i="show-layers-button icon-btn "+(B[0]?"expanded":"")+" svelte-1o5jpn"))&&T(t,"class",i),E&1&&X(a,"display",B[0]?"flex":"none"),E&1&&X(e,"width",B[0]?"300px":"auto")},i(B){j||(v(o.$$.fragment,B),v(u.$$.fragment,B),v(c.$$.fragment,B),v(d.$$.fragment,B),v(g.$$.fragment,B),v(L.$$.fragment,B),v(b.$$.fragment,B),v(N.$$.fragment,B),j=!0)},o(B){C(o.$$.fragment,B),C(u.$$.fragment,B),C(c.$$.fragment,B),C(d.$$.fragment,B),C(g.$$.fragment,B),C(L.$$.fragment,B),C(b.$$.fragment,B),C(N.$$.fragment,B),j=!1},d(B){B&&y(e),P(o),D&&D.d(),P(u),P(c),P(d),P(g),P(L),P(b),P(N),I=!1,R()}}}function k_(r){let e,t;return e=new Nf({props:{defaultStyling:!0,$$slots:{default:[$_]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function C_(r,e,t){let n=!1;return[n,()=>t(0,n=!n)]}class S_ extends se{constructor(e){super(),ae(this,e,C_,k_,ie,{})}}let G;const an=new Array(128).fill(void 0);an.push(void 0,null,!0,!1);function Me(r){return an[r]}let wt=0,Wn=null;function An(){return(Wn===null||Wn.byteLength===0)&&(Wn=new Uint8Array(G.memory.buffer)),Wn}const jr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},L_=typeof jr.encodeInto=="function"?function(r,e){return jr.encodeInto(r,e)}:function(r,e){const t=jr.encode(r);return e.set(t),{read:r.length,written:t.length}};function Jt(r,e,t){if(t===void 0){const s=jr.encode(r),a=e(s.length,1)>>>0;return An().subarray(a,a+s.length).set(s),wt=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=An();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=An().subarray(o+i,o+n),a=L_(r,s);i+=a.written}return wt=i,o}function Tn(r){return r==null}let qn=null;function x(){return(qn===null||qn.byteLength===0)&&(qn=new Int32Array(G.memory.buffer)),qn}let Qn=an.length;function M_(r){r<132||(an[r]=Qn,Qn=r)}function Ye(r){const e=Me(r);return M_(r),e}const Gs=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Gs.decode();function it(r,e){return r=r>>>0,Gs.decode(An().subarray(r,r+e))}function Ze(r){Qn===an.length&&an.push(an.length+1);const e=Qn;return Qn=an[e],an[e]=r,e}let Jn=null;function Ws(){return(Jn===null||Jn.byteLength===0)&&(Jn=new Float64Array(G.memory.buffer)),Jn}let Yn=null;function T_(){return(Yn===null||Yn.byteLength===0)&&(Yn=new BigInt64Array(G.memory.buffer)),Yn}function yo(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=yo(r[0]));for(let i=1;i<o;i++)l+=", "+yo(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function lo(r,e){const t=e(r.length*1,1)>>>0;return An().set(r,t/1),wt=r.length,t}function A_(r,e){return r=r>>>0,Ws().subarray(r/8,r/8+e)}function F_(r,e){return r=r>>>0,An().subarray(r/1,r/1+e)}function vn(r,e){try{return r.apply(this,e)}catch(t){G.__wbindgen_exn_store(Ze(t))}}class P_{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();G.__wbg_ltn_free(e)}constructor(e,t,n,o,l){try{const c=G.__wbindgen_add_to_stack_pointer(-16),_=lo(e,G.__wbindgen_malloc),d=wt,p=lo(t,G.__wbindgen_malloc),g=wt,$=lo(n,G.__wbindgen_malloc),L=wt;var i=Tn(l)?0:Jt(l,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_new(c,_,d,p,g,$,L,Ze(o),i,s);var a=x()[c/4+0],u=x()[c/4+1],f=x()[c/4+2];if(f)throw Ye(u);return this.__wbg_ptr=a>>>0,this}finally{G.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getInvertedBoundary(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getBounds(){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getBounds(o,this.__wbg_ptr);var e=x()[o/4+0],t=x()[o/4+1],n=A_(e,t).slice();return G.__wbindgen_free(e,t*8,8),n}finally{G.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_toRouteSnapper(o,this.__wbg_ptr);var e=x()[o/4+0],t=x()[o/4+1],n=F_(e,t).slice();return G.__wbindgen_free(e,t*1,1),n}finally{G.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_toRouteSnapperGj(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderModalFilters(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderTurnRestrictions(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_renderNeighbourhood(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_generatedBoundaries(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_generateMergedBoundary(f,this.__wbg_ptr,Ze(e));var o=x()[f/4+0],l=x()[f/4+1],i=x()[f/4+2],s=x()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ye(i);return t=a,n=u,it(a,u)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Jt(e,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_setNeighbourhoodBoundary(l,this.__wbg_ptr,i,s,Ze(t));var n=x()[l/4+0],o=x()[l/4+1];if(o)throw Ye(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Jt(e,G.__wbindgen_malloc,G.__wbindgen_realloc),n=wt;G.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Jt(e,G.__wbindgen_malloc,G.__wbindgen_realloc),o=wt,l=Jt(t,G.__wbindgen_malloc,G.__wbindgen_realloc),i=wt;G.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,o,l,i)}setCurrentNeighbourhood(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Jt(e,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_setCurrentNeighbourhood(l,this.__wbg_ptr,i,s,t);var n=x()[l/4+0],o=x()[l/4+1];if(o)throw Ye(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Jt(t,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_addModalFilter(l,this.__wbg_ptr,Ze(e),i,s);var n=x()[l/4+0],o=x()[l/4+1];if(o)throw Ye(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16),i=Jt(t,G.__wbindgen_malloc,G.__wbindgen_realloc),s=wt;G.ltn_addManyModalFilters(l,this.__wbg_ptr,Ze(e),i,s);var n=x()[l/4+0],o=x()[l/4+1];if(o)throw Ye(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){G.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_addDiagonalFilter(o,this.__wbg_ptr,e);var t=x()[o/4+0],n=x()[o/4+1];if(n)throw Ye(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_rotateDiagonalFilter(o,this.__wbg_ptr,e);var t=x()[o/4+0],n=x()[o/4+1];if(n)throw Ye(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_deleteDiagonalFilter(o,this.__wbg_ptr,e);var t=x()[o/4+0],n=x()[o/4+1];if(n)throw Ye(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const l=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_addTurnRestriction(l,this.__wbg_ptr,e,t);var n=x()[l/4+0],o=x()[l/4+1];if(o)throw Ye(n)}finally{G.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const i=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_deleteTurnRestriction(i,this.__wbg_ptr,e,t,n);var o=x()[i/4+0],l=x()[i/4+1];if(l)throw Ye(o)}finally{G.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getTurnRestrictionTargets(f,this.__wbg_ptr,e);var o=x()[f/4+0],l=x()[f/4+1],i=x()[f/4+2],s=x()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ye(i);return t=a,n=u,it(a,u)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){G.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){G.ltn_undo(this.__wbg_ptr)}redo(){G.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getShortcutsCrossingRoad(f,this.__wbg_ptr,e);var o=x()[f/4+0],l=x()[f/4+1],i=x()[f/4+2],s=x()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ye(i);return t=a,n=u,it(a,u)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getAllShortcuts(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_toSavefile(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const o=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_loadSavefile(o,this.__wbg_ptr,Ze(e));var t=x()[o/4+0],n=x()[o/4+1];if(n)throw Ye(t)}finally{G.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,o,l){let i,s;try{const p=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_compareRoute(p,this.__wbg_ptr,e,t,n,o,l);var a=x()[p/4+0],u=x()[p/4+1],f=x()[p/4+2],c=x()[p/4+3],_=a,d=u;if(c)throw _=0,d=0,Ye(f);return i=_,s=d,it(_,d)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(i,s,1)}}impactToOneDestination(e,t){let n,o;try{const c=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_impactToOneDestination(c,this.__wbg_ptr,e,t);var l=x()[c/4+0],i=x()[c/4+1],s=x()[c/4+2],a=x()[c/4+3],u=l,f=i;if(a)throw u=0,f=0,Ye(s);return n=u,o=f,it(u,f)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(n,o,1)}}predictImpact(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_predictImpact(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,n;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getImpactsOnRoad(f,this.__wbg_ptr,e);var o=x()[f/4+0],l=x()[f/4+1],i=x()[f/4+2],s=x()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ye(i);return t=a,n=u,it(a,u)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}getAllNeighbourhoods(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getAllNeighbourhoods(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getAllIntersections(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const f=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getMovements(f,this.__wbg_ptr,e);var o=x()[f/4+0],l=x()[f/4+1],i=x()[f/4+2],s=x()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ye(i);return t=a,n=u,it(a,u)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const u=G.__wbindgen_add_to_stack_pointer(-16);G.ltn_getDemandModel(u,this.__wbg_ptr);var n=x()[u/4+0],o=x()[u/4+1],l=x()[u/4+2],i=x()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ye(l);return e=s,t=a,it(s,a)}finally{G.__wbindgen_add_to_stack_pointer(16),G.__wbindgen_free(e,t,1)}}}async function j_(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function I_(){const r={};return r.wbg={},r.wbg.__wbindgen_string_get=function(e,t){const n=Me(t),o=typeof n=="string"?n:void 0;var l=Tn(o)?0:Jt(o,G.__wbindgen_malloc,G.__wbindgen_realloc),i=wt;x()[e/4+1]=i,x()[e/4+0]=l},r.wbg.__wbindgen_object_drop_ref=function(e){Ye(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(it(e,t));return Ze(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=Me(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Me(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=Me(t),o=typeof n=="number"?n:void 0;Ws()[e/8+1]=Tn(o)?0:o,x()[e/4+0]=!Tn(o)},r.wbg.__wbindgen_is_object=function(e){const t=Me(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Me(e)in Me(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Ze(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Me(e)===Me(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Ze(t)},r.wbg.__wbindgen_is_undefined=function(e){return Me(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=it(e,t);return Ze(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Me(e)==Me(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Me(e);return Ze(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=Me(e)[Me(t)];return Ze(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Me(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Me(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Me(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Me(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Me(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Ze(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Me(t).stack,o=Jt(n,G.__wbindgen_malloc,G.__wbindgen_realloc),l=wt;x()[e/4+1]=l,x()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(it(e,t))}finally{G.__wbindgen_free(n,o,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=Me(e).performance;return Ze(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Me(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=Me(e)[t>>>0];return Ze(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Me(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Me(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(it(e,t));return Ze(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=Me(e).next;return Ze(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return vn(function(e){const t=Me(e).next();return Ze(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Me(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=Me(e).value;return Ze(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Ze(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return vn(function(e,t){const n=Reflect.get(Me(e),Me(t));return Ze(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return vn(function(e,t){const n=Me(e).call(Me(t));return Ze(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return vn(function(){const e=self.self;return Ze(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return vn(function(){const e=window.window;return Ze(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return vn(function(){const e=globalThis.globalThis;return Ze(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return vn(function(){const e=global.global;return Ze(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Me(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=Me(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Me(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(Me(e));return Ze(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=Me(e).buffer;return Ze(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(Me(e));return Ze(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){Me(e).set(Me(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Me(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=Me(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Me(t),o=typeof n=="bigint"?n:void 0;T_()[e/8+1]=Tn(o)?BigInt(0):o,x()[e/4+0]=!Tn(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=yo(Me(t)),o=Jt(n,G.__wbindgen_malloc,G.__wbindgen_realloc),l=wt;x()[e/4+1]=l,x()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(it(e,t))},r.wbg.__wbindgen_memory=function(){const e=G.memory;return Ze(e)},r}function N_(r,e){return G=r.exports,qs.__wbindgen_wasm_module=e,Yn=null,Jn=null,qn=null,Wn=null,G}async function qs(r){if(G!==void 0)return G;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=I_();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await j_(await r,e);return N_(t,n)}const E_=r=>({}),ni=r=>({}),R_=r=>({}),ri=r=>({}),z_=r=>({}),oi=r=>({});function O_(r){let e,t,n,o,l,i,s,a;const u=r[1].top,f=Ie(u,r,r[0],oi),c=r[1].left,_=Ie(c,r,r[0],ri),d=r[1].main,p=Ie(d,r,r[0],ni);return{c(){e=h("div"),t=h("div"),f&&f.c(),n=M(),o=h("div"),l=h("div"),_&&_.c(),i=M(),s=h("div"),p&&p.c(),T(t,"class","top svelte-29q570"),T(l,"class","left svelte-29q570"),T(s,"class","main svelte-29q570"),T(o,"class","content svelte-29q570"),T(e,"class","flex-container svelte-29q570")},m(g,$){w(g,e,$),m(e,t),f&&f.m(t,null),m(e,n),m(e,o),m(o,l),_&&_.m(l,null),m(o,i),m(o,s),p&&p.m(s,null),a=!0},p(g,[$]){f&&f.p&&(!a||$&1)&&Ne(f,u,g,g[0],a?Re(u,g[0],$,z_):Ee(g[0]),oi),_&&_.p&&(!a||$&1)&&Ne(_,c,g,g[0],a?Re(c,g[0],$,R_):Ee(g[0]),ri),p&&p.p&&(!a||$&1)&&Ne(p,d,g,g[0],a?Re(d,g[0],$,E_):Ee(g[0]),ni)},i(g){a||(v(f,g),v(_,g),v(p,g),a=!0)},o(g){C(f,g),C(_,g),C(p,g),a=!1},d(g){g&&y(e),f&&f.d(g),_&&_.d(g),p&&p.d(g)}}}function B_(r,e,t){let{$$slots:n={},$$scope:o}=e;return r.$$set=l=>{"$$scope"in l&&t(0,o=l.$$scope)},[o,n]}class D_ extends se{constructor(e){super(),ae(this,e,B_,O_,ie,{})}}const U_=r=>({}),li=r=>({}),H_=r=>({}),ii=r=>({}),G_=r=>({}),si=r=>({});function W_(r){let e,t,n,o,l,i;const s=r[4].top,a=Ie(s,r,r[3],si),u=r[4].sidebar,f=Ie(u,r,r[3],ii),c=r[4].map,_=Ie(c,r,r[3],li);return{c(){e=h("div"),a&&a.c(),t=M(),n=h("div"),f&&f.c(),o=M(),l=h("div"),_&&_.c()},m(d,p){w(d,e,p),a&&a.m(e,null),r[5](e),w(d,t,p),w(d,n,p),f&&f.m(n,null),r[6](n),w(d,o,p),w(d,l,p),_&&_.m(l,null),r[7](l),i=!0},p(d,[p]){a&&a.p&&(!i||p&8)&&Ne(a,s,d,d[3],i?Re(s,d[3],p,G_):Ee(d[3]),si),f&&f.p&&(!i||p&8)&&Ne(f,u,d,d[3],i?Re(u,d[3],p,H_):Ee(d[3]),ii),_&&_.p&&(!i||p&8)&&Ne(_,c,d,d[3],i?Re(c,d[3],p,U_):Ee(d[3]),li)},i(d){i||(v(a,d),v(f,d),v(_,d),i=!0)},o(d){C(a,d),C(f,d),C(_,d),i=!1},d(d){d&&(y(e),y(t),y(n),y(o),y(l)),a&&a.d(d),r[5](null),f&&f.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function q_(r,e,t){let n,o,l;ee(r,vo,c=>t(0,n=c)),ee(r,$o,c=>t(1,o=c)),ee(r,ko,c=>t(2,l=c));let{$$slots:i={},$$scope:s}=e;function a(c){Le[c?"unshift":"push"](()=>{n=c,vo.set(n)})}function u(c){Le[c?"unshift":"push"](()=>{o=c,$o.set(o)})}function f(c){Le[c?"unshift":"push"](()=>{l=c,ko.set(l)})}return r.$$set=c=>{"$$scope"in c&&t(3,s=c.$$scope)},[n,o,l,s,i,a,u,f]}class Nt extends se{constructor(e){super(),ae(this,e,q_,W_,ie,{})}}let vo=At(null),$o=At(null),ko=At(null);function J_(r){let e;return{c(){e=z("Back")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Y_(r){let e,t,n,o;return e=new Ae({props:{$$slots:{default:[J_]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0,n||(o=ne(window,"keydown",r[1]),n=!0)},p(l,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l),n=!1,o()}}}function Z_(r){let e=hn();function t(o){o.key=="Escape"&&(o.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class bn extends se{constructor(e){super(),ae(this,e,Z_,Y_,ie,{})}}function Co(r,e,t){let n=new Set(r.toSavefile().features.filter(o=>o.properties.kind=="boundary").map(o=>o.properties.name));for(;;){let o=window.prompt(e,t);if(!o)return null;if(n.has(o))window.alert(`There is already a neighbourhood called ${o}; please pick another name`);else return o}}function K_(r){let e,t,n,o;return e=new Nn({props:{colorScale:Do,limits:Bo}}),{c(){A(e.$$.fragment),t=M(),n=h("div"),n.textContent="collisions / km²",X(n,"text-align","center")},m(l,i){F(e,l,i),w(l,t,i),w(l,n,i),o=!0},i(l){o||(v(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){l&&(y(t),y(n)),P(e,l)}}}function X_(r){let e,t,n,o;return e=new Hs({props:{colorScale:cr,buckets:Us(dr)}}),{c(){A(e.$$.fragment),t=M(),n=h("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",T(n,"class","sub-labels svelte-3xhwrh")},m(l,i){F(e,l,i),w(l,t,i),w(l,n,i),o=!0},i(l){o||(v(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){l&&(y(t),y(n)),P(e,l)}}}function V_(r){let e,t,n,o;return e=new Nn({props:{colorScale:_r,limits:pr}}),{c(){A(e.$$.fragment),t=M(),n=h("div"),n.innerHTML="<span>Less less</span> <span>More dense</span>",T(n,"class","sub-labels svelte-3xhwrh")},m(l,i){F(e,l,i),w(l,t,i),w(l,n,i),o=!0},i(l){o||(v(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){l&&(y(t),y(n)),P(e,l)}}}function Q_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g;const $=[V_,X_,K_],L=[];function k(b,S){return b[0]=="density"?0:b[0]=="simd"?1:b[0]=="stats19"?2:-1}return~(f=k(r))&&(c=L[f]=$[f](r)),{c(){e=h("div"),t=h("label"),t.textContent="Metric",n=M(),o=h("select"),l=h("option"),l.textContent="None",i=h("option"),i.textContent="Density",s=h("option"),s.textContent="Collisions",a=h("option"),a.textContent="SIMD",u=M(),c&&c.c(),_=Qe(),T(t,"for","prioritization-selection"),l.__value="none",We(l,l.__value),i.__value="density",We(i,i.__value),s.__value="stats19",We(s,s.__value),a.__value="simd",We(a,a.__value),T(o,"id","prioritization-selection"),r[0]===void 0&&dn(()=>r[1].call(o)),X(e,"display","flex"),X(e,"gap","16px"),X(e,"align-items","center")},m(b,S){w(b,e,S),m(e,t),m(e,n),m(e,o),m(o,l),m(o,i),m(o,s),m(o,a),vt(o,r[0],!0),w(b,u,S),~f&&L[f].m(b,S),w(b,_,S),d=!0,p||(g=ne(o,"change",r[1]),p=!0)},p(b,[S]){S&1&&vt(o,b[0]);let N=f;f=k(b),f!==N&&(c&&($e(),C(L[N],1,1,()=>{L[N]=null}),ke()),~f?(c=L[f],c||(c=L[f]=$[f](b),c.c()),v(c,1),c.m(_.parentNode,_)):c=null)},i(b){d||(v(c),d=!0)},o(b){C(c),d=!1},d(b){b&&(y(e),y(u),y(_)),~f&&L[f].d(b),p=!1,g()}}}function x_(r,e,t){let n;ee(r,Vt,s=>t(2,n=s));let{selectedPrioritization:o}=e;function l(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="density"?t(0,o="density"):s=="simd"?t(0,o="simd"):s=="stats19"&&t(0,o="stats19")}n.startsWith("ltn_cnt/")?l():o="none";function i(){o=_n(this),t(0,o)}return r.$$set=s=>{"selectedPrioritization"in s&&t(0,o=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);o=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",o),history.replaceState({},"",s)}},[o,i]}class Js extends se{constructor(e){super(),ae(this,e,x_,Q_,ie,{selectedPrioritization:0})}}function ep(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function tp(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function np(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new Ae({props:{$$slots:{default:[ep]},$$scope:{ctx:r}}}),l.$on("click",r[19]),a=new Ae({props:{$$slots:{default:[tp]},$$scope:{ctx:r}}}),a.$on("click",r[20]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),f.textContent="Use an auto-generated boundary",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(_,d){w(_,e,d),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),c=!0},p(_,d){const p={};d&16777216&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&16777216&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(l.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&y(e),P(l),P(a)}}}function ai(r){let e,t,n,o,l,i,s;function a(f){r[14](f)}let u={};return r[2]!==void 0&&(u.selectedPrioritization=r[2]),l=new Js({props:u}),Le.push(()=>ze(l,"selectedPrioritization",a)),{c(){e=h("h3"),e.textContent="Prioritization",t=M(),n=h("p"),n.textContent="Compare metrics across candidate neighbourhoods.",o=M(),A(l.$$.fragment)},m(f,c){w(f,e,c),w(f,t,c),w(f,n,c),w(f,o,c),F(l,f,c),s=!0},p(f,c){const _={};!i&&c&4&&(i=!0,_.selectedPrioritization=f[2],Oe(()=>i=!1)),l.$set(_)},i(f){s||(v(l.$$.fragment,f),s=!0)},o(f){C(l.$$.fragment,f),s=!1},d(f){f&&(y(e),y(t),y(n),y(o)),P(l,f)}}}function ui(r){let e;return{c(){e=h("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function rp(r){let e,t,n;return{c(){e=h("p"),e.textContent="Choose an area to use as the boundary for your neighbourhood.",t=M(),n=h("p"),n.textContent=`These particular boundaries are suggested by finding roads,
            railways, and water that form severances.`},m(o,l){w(o,e,l),w(o,t,l),w(o,n,l)},p:Y,i:Y,o:Y,d(o){o&&(y(e),y(t),y(n))}}}function op(r){let e,t,n,o,l,i,s,a,u,f,c,_=r[3].properties.area_km2.toFixed(1)+"",d,p,g,$,L,k,b,S=Math.round(r[3].properties.population/r[3].properties.area_km2).toLocaleString()+"",N,j,I,R,D,B,E,O=r[3].properties.simd.toFixed(1)+"",H,W,Z,re,ce,U,be,fe=(r[3].properties.number_stats19_collisions/r[3].properties.area_km2).toFixed(1)+"",te,me,ue,Fe,et;return l=new mf({}),{c(){e=h("div"),t=h("b"),t.textContent="Your Neighbourhood Overall",n=M(),o=h("button"),A(l.$$.fragment),i=M(),s=h("table"),a=h("tr"),u=h("th"),u.textContent="Area",f=M(),c=h("td"),d=z(_),p=z(" km²"),g=M(),$=h("tr"),L=h("th"),L.textContent="Population density",k=M(),b=h("td"),N=z(S),j=z(" people / km²"),I=M(),R=h("tr"),D=h("th"),D.textContent="SIMD",B=M(),E=h("td"),H=z(O),W=z("%"),Z=M(),re=h("tr"),ce=h("th"),ce.textContent="Collision density",U=M(),be=h("td"),te=z(fe),me=z(" / km²"),T(o,"class","icon-btn destructive"),T(o,"aria-label","Clear selection"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(ye,we){w(ye,e,we),m(e,t),m(e,n),m(e,o),F(l,o,null),w(ye,i,we),w(ye,s,we),m(s,a),m(a,u),m(a,f),m(a,c),m(c,d),m(c,p),m(s,g),m(s,$),m($,L),m($,k),m($,b),m(b,N),m(b,j),m(s,I),m(s,R),m(R,D),m(R,B),m(R,E),m(E,H),m(E,W),m(s,Z),m(s,re),m(re,ce),m(re,U),m(re,be),m(be,te),m(be,me),ue=!0,Fe||(et=ne(o,"click",r[15]),Fe=!0)},p(ye,we){(!ue||we&8)&&_!==(_=ye[3].properties.area_km2.toFixed(1)+"")&&oe(d,_),(!ue||we&8)&&S!==(S=Math.round(ye[3].properties.population/ye[3].properties.area_km2).toLocaleString()+"")&&oe(N,S),(!ue||we&8)&&O!==(O=ye[3].properties.simd.toFixed(1)+"")&&oe(H,O),(!ue||we&8)&&fe!==(fe=(ye[3].properties.number_stats19_collisions/ye[3].properties.area_km2).toFixed(1)+"")&&oe(te,fe)},i(ye){ue||(v(l.$$.fragment,ye),ue=!0)},o(ye){C(l.$$.fragment,ye),ue=!1},d(ye){ye&&(y(e),y(i),y(s)),P(l),Fe=!1,et()}}}function fi(r){let e,t,n,o,l,i,s,a,u,f,c;return{c(){e=h("h3"),e.textContent="2. Add to area",t=M(),n=h("p"),n.textContent="Choose any adjacent areas you'd like to add to your boundary.",o=M(),l=h("h3"),l.textContent="3. Finished?",i=M(),s=h("p"),s.textContent=`When you're done, click "Confirm".`,a=M(),u=h("button"),u.textContent="Confirm Boundary"},m(_,d){w(_,e,d),w(_,t,d),w(_,n,d),w(_,o,d),w(_,l,d),w(_,i,d),w(_,s,d),w(_,a,d),w(_,u,d),f||(c=ne(u,"click",r[16]),f=!0)},p:Y,d(_){_&&(y(e),y(t),y(n),y(o),y(l),y(i),y(s),y(a),y(u)),f=!1,c()}}}function lp(r){let e,t,n,o=r[6].startsWith("ltn_cnt/"),l,i,s,a,u,f,c,_,d,p,g,$,L,k,b,S,N,j,I,R,D,B,E,O,H,W;t=new bn({}),t.$on("click",r[13]);let Z=o&&ai(r),re=r[2]=="none"&&ui();const ce=[op,rp],U=[];function be(te,me){return te[3]?0:1}d=be(r),p=U[d]=ce[d](r);let fe=r[3]&&fi(r);return{c(){e=h("div"),A(t.$$.fragment),n=M(),Z&&Z.c(),l=M(),re&&re.c(),i=M(),s=h("hr"),a=M(),u=h("div"),f=h("h3"),f.textContent="1. Choose area",c=M(),_=h("div"),p.c(),g=M(),fe&&fe.c(),$=M(),L=h("hr"),k=M(),b=h("button"),b.textContent="Export to GeoJSON",S=M(),N=h("label"),j=z(`Minimum area (km²)
      `),I=h("input"),R=M(),D=h("label"),B=h("input"),E=z(`
      Remove areas not touching a big road`),X(_,"border","dashed black 2px"),X(_,"padding","8px"),T(b,"class","secondary"),T(I,"type","number"),T(I,"min","0"),T(I,"max","1"),T(I,"step","0.01"),T(B,"type","checkbox"),T(e,"slot","sidebar")},m(te,me){w(te,e,me),F(t,e,null),m(e,n),Z&&Z.m(e,null),m(e,l),re&&re.m(e,null),m(e,i),m(e,s),m(e,a),m(e,u),m(u,f),m(u,c),m(u,_),U[d].m(_,null),m(_,g),fe&&fe.m(_,null),m(e,$),m(e,L),m(e,k),m(e,b),m(e,S),m(e,N),m(N,j),m(N,I),We(I,r[0]),m(e,R),m(e,D),m(D,B),B.checked=r[1],m(D,E),O=!0,H||(W=[ne(b,"click",r[10]),ne(I,"input",r[17]),ne(B,"change",r[18])],H=!0)},p(te,me){me&64&&(o=te[6].startsWith("ltn_cnt/")),o?Z?(Z.p(te,me),me&64&&v(Z,1)):(Z=ai(te),Z.c(),v(Z,1),Z.m(e,l)):Z&&($e(),C(Z,1,1,()=>{Z=null}),ke()),te[2]=="none"?re||(re=ui(),re.c(),re.m(e,i)):re&&(re.d(1),re=null);let ue=d;d=be(te),d===ue?U[d].p(te,me):($e(),C(U[ue],1,1,()=>{U[ue]=null}),ke(),p=U[d],p?p.p(te,me):(p=U[d]=ce[d](te),p.c()),v(p,1),p.m(_,g)),te[3]?fe?fe.p(te,me):(fe=fi(te),fe.c(),fe.m(_,null)):fe&&(fe.d(1),fe=null),me&1&&kn(I.value)!==te[0]&&We(I,te[0]),me&2&&(B.checked=te[1])},i(te){O||(v(t.$$.fragment,te),v(Z),v(p),O=!0)},o(te){C(t.$$.fragment,te),C(Z),C(p),O=!1},d(te){te&&y(e),P(t),Z&&Z.d(),re&&re.d(),U[d].d(),fe&&fe.d(),H=!1,ct(W)}}}function ci(r){let e,t;return e=new Ve({props:{data:{type:"FeatureCollection",features:[r[3]]},$$slots:{default:[ip]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&8&&(l.data={type:"FeatureCollection",features:[n[3]]}),o&16777216&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function ip(r){let e,t,n,o;const l=[ve("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let i={};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new tt({props:i});const s=[ve("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let a={};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new tt({props:a}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _={};n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function di(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[fp,({props:n})=>({23:n}),({props:n})=>n?8388608:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&25165828&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function sp(r){let e,t,n=(r[23].number_stats19_collisions/r[23].area_km2).toFixed(1)+"",o,l;return{c(){e=h("b"),e.textContent="Pedestrian and cyclist collisions:",t=M(),o=z(n),l=z(" / km²")},m(i,s){w(i,e,s),w(i,t,s),w(i,o,s),w(i,l,s)},p(i,s){s&8388608&&n!==(n=(i[23].number_stats19_collisions/i[23].area_km2).toFixed(1)+"")&&oe(o,n)},d(i){i&&(y(e),y(t),y(o),y(l))}}}function ap(r){let e,t,n=Math.round(r[23].population/r[23].area_km2).toLocaleString()+"",o,l;return{c(){e=h("b"),e.textContent="Population density:",t=M(),o=z(n),l=z(` people
              / km²`)},m(i,s){w(i,e,s),w(i,t,s),w(i,o,s),w(i,l,s)},p(i,s){s&8388608&&n!==(n=Math.round(i[23].population/i[23].area_km2).toLocaleString()+"")&&oe(o,n)},d(i){i&&(y(e),y(t),y(o),y(l))}}}function up(r){let e,t,n=r[23].area_km2.toFixed(1)+"",o,l;return{c(){e=h("b"),e.textContent="Area:",t=M(),o=z(n),l=z(" km²")},m(i,s){w(i,e,s),w(i,t,s),w(i,o,s),w(i,l,s)},p(i,s){s&8388608&&n!==(n=i[23].area_km2.toFixed(1)+"")&&oe(o,n)},d(i){i&&(y(e),y(t),y(o),y(l))}}}function fp(r){let e;function t(l,i){if(l[2]=="none")return up;if(l[2]=="density")return ap;if(l[2]=="stats19")return sp}let n=t(r),o=n&&n(r);return{c(){o&&o.c(),e=Qe()},m(l,i){o&&o.m(l,i),w(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o&&o.d(1),o=n&&n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&y(e),o&&o.d(l)}}}function cp(r){let e,t,n=r[2]!="simd"&&di(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,l){o[2]!="simd"?n?(n.p(o,l),l&4&&v(n,1)):(n=di(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function dp(r){let e,t,n,o;const l=[ve("neighbourhood-boundaries",!1),{filter:Sr(r[0],r[1])},{paint:{"fill-color":r[11](r[2]),"fill-opacity":r[12](r[2])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[cp]},$$scope:{ctx:r}};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new It({props:i}),e.$on("click",r[8]);const s=[ve("neighbourhood-boundaries-outline",!1),{filter:Sr(r[0],r[1])},{paint:{"line-color":"black","line-width":1}}];let a={};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new tt({props:a}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,f){const c=f&6151?He(l,[l[0],f&3&&{filter:Sr(u[0],u[1])},f&6148&&{paint:{"fill-color":u[11](u[2]),"fill-opacity":u[12](u[2])}},l[3],l[4]]):{};f&16777220&&(c.$$scope={dirty:f,ctx:u}),e.$set(c);const _=f&3?He(s,[s[0],{filter:Sr(u[0],u[1])},s[2]]):{};n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function _p(r){let e,t,n,o,l=r[3]&&ci(r);return n=new Ve({props:{data:r[7],generateId:!0,$$slots:{default:[dp]},$$scope:{ctx:r}}}),{c(){e=h("div"),l&&l.c(),t=M(),A(n.$$.fragment),T(e,"slot","map")},m(i,s){w(i,e,s),l&&l.m(e,null),m(e,t),F(n,e,null),o=!0},p(i,s){i[3]?l?(l.p(i,s),s&8&&v(l,1)):(l=ci(i),l.c(),v(l,1),l.m(e,t)):l&&($e(),C(l,1,1,()=>{l=null}),ke());const a={};s&16777223&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(v(l),v(n.$$.fragment,i),o=!0)},o(i){C(l),C(n.$$.fragment,i),o=!1},d(i){i&&y(e),l&&l.d(),P(n)}}}function pp(r){let e,t;return e=new Nt({props:{$$slots:{map:[_p],sidebar:[lp],top:[np]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&16777343&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Sr(r,e){let t=["all",[">=",["get","area_km2"],r]];return e&&t.push(["get","touches_big_road"]),t}function mp(r,e,t){let n,o,l,i;ee(r,_e,B=>t(5,n=B)),ee(r,er,B=>t(21,o=B)),ee(r,ot,B=>t(22,l=B)),ee(r,Vt,B=>t(6,i=B));let s=l.generatedBoundaries(),a=0,u=!0,f="none",c=null,_=new Map;function d(B){let E=B.detail.features[0].id,O=s.features[E],H=new Map(_);if(H.has(E)?H.delete(E):H.set(E,O),H.size===0)t(3,c=null),t(4,_=H);else if(H.size===1)t(3,c=H.values().next().value),t(4,_=H);else{let W={type:"FeatureCollection",features:Array.from(H.values())};try{t(3,c=l.generateMergedBoundary(W)),t(4,_=H)}catch(Z){console.log(`error merging boundaries: ${Z}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${Z}`)}}}function p(B){let E=Co(l,"What do you want to name the neighbourhood?","");if(E)try{let O={type:"Feature",properties:{},geometry:B.geometry};l.setNeighbourhoodBoundary(E,O),Fn(),l.setCurrentNeighbourhood(E,o),le(_e,n={mode:"neighbourhood"},n)}catch(O){console.log("error when setting auto-generated neighborhood",O),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working.")}}function g(){zr("auto_boundaries.geojson",JSON.stringify(s,null,"  "))}function $(B){return{none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],area:kt(["get","area_km2"],Bs,Ds),density:kt(["/",["get","population"],["get","area_km2"]],pr,_r),simd:kt(["get","simd"],dr,cr),stats19:kt(["/",["get","number_stats19_collisions"],["get","area_km2"]],Bo,Do)}[B]}function L(B){return{none:rt(.3,.5),area:rt(.7,.9),density:rt(.7,.9),simd:rt(.7,.9),stats19:rt(.7,.9)}[B]}const k=()=>le(_e,n={mode:"pick-neighbourhood"},n);function b(B){f=B,t(2,f)}const S=()=>{t(3,c=null),_.clear(),t(4,_)},N=()=>p(gt(c));function j(){a=kn(this.value),t(0,a)}function I(){u=this.checked,t(1,u)}return[a,u,f,c,_,n,i,s,d,p,g,$,L,k,b,S,N,j,I,()=>le(_e,n={mode:"title",firstLoad:!1},n),()=>le(_e,n={mode:"pick-neighbourhood"},n)]}class gp extends se{constructor(e){super(),ae(this,e,mp,pp,ie,{})}}function hp(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function bp(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function wp(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new Ae({props:{$$slots:{default:[hp]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Ae({props:{$$slots:{default:[bp]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),f.textContent="Debug demand model",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(_,d){w(_,e,d),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),c=!0},p(_,d){const p={};d&65536&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(l.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&y(e),P(l),P(a)}}}function yp(r){let e;return{c(){e=h("p"),e.textContent="Hover on a zone"},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function vp(r){let e,t=r[6].properties.name+"",n,o,l,i,s=r[6].properties.sum_from.toLocaleString()+"",a,u,f,c,_=r[6].properties.sum_to.toLocaleString()+"",d,p,g,$,L=r[6].properties.counts_from[r[3]]+"",k;return{c(){e=h("u"),n=z(t),o=M(),l=h("p"),i=z("Total trips from here: "),a=z(s),u=M(),f=h("p"),c=z("Total trips to here: "),d=z(_),p=M(),g=h("p"),$=z("Total intra-zonal trips starting and ending here: "),k=z(L)},m(b,S){w(b,e,S),m(e,n),w(b,o,S),w(b,l,S),m(l,i),m(l,a),w(b,u,S),w(b,f,S),m(f,c),m(f,d),w(b,p,S),w(b,g,S),m(g,$),m(g,k)},p(b,S){S&64&&t!==(t=b[6].properties.name+"")&&oe(n,t),S&64&&s!==(s=b[6].properties.sum_from.toLocaleString()+"")&&oe(a,s),S&64&&_!==(_=b[6].properties.sum_to.toLocaleString()+"")&&oe(d,_),S&72&&L!==(L=b[6].properties.counts_from[b[3]]+"")&&oe(k,L)},d(b){b&&(y(e),y(o),y(l),y(u),y(f),y(p),y(g))}}}function $p(r){let e,t,n,o,l=r[0].features.length.toLocaleString()+"",i,s,a,u,f,c,_,d,p,g,$=r[1]?"from":"to",L,k,b=r[3]==null?"each zone":"this zone",S,N,j,I,R,D,B,E,O,H;t=new bn({}),t.$on("click",r[9]),I=new Nn({props:{colorScale:Pr,limits:r[5]}});function W(ce,U){return ce[6]&&ce[3]!=null?vp:yp}let Z=W(r),re=Z(r);return{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("p"),i=z(l),s=z(" zones"),a=M(),u=h("label"),f=z(`Trips from
      `),c=h("input"),_=z(`
      Trips to`),d=M(),p=h("p"),g=z("Trips "),L=z($),k=M(),S=z(b),N=z(":"),j=M(),A(I.$$.fragment),R=M(),D=h("hr"),B=M(),re.c(),T(c,"type","checkbox"),T(c,"role","switch"),T(e,"slot","sidebar")},m(ce,U){w(ce,e,U),F(t,e,null),m(e,n),m(e,o),m(o,i),m(o,s),m(e,a),m(e,u),m(u,f),m(u,c),c.checked=r[1],m(u,_),m(e,d),m(e,p),m(p,g),m(p,L),m(p,k),m(p,S),m(p,N),m(e,j),F(I,e,null),m(e,R),m(e,D),m(e,B),re.m(e,null),E=!0,O||(H=ne(c,"change",r[10]),O=!0)},p(ce,U){(!E||U&1)&&l!==(l=ce[0].features.length.toLocaleString()+"")&&oe(i,l),U&2&&(c.checked=ce[1]),(!E||U&2)&&$!==($=ce[1]?"from":"to")&&oe(L,$),(!E||U&8)&&b!==(b=ce[3]==null?"each zone":"this zone")&&oe(S,b);const be={};U&32&&(be.limits=ce[5]),I.$set(be),Z===(Z=W(ce))&&re?re.p(ce,U):(re.d(1),re=Z(ce),re&&(re.c(),re.m(e,null)))},i(ce){E||(v(t.$$.fragment,ce),v(I.$$.fragment,ce),E=!0)},o(ce){C(t.$$.fragment,ce),C(I.$$.fragment,ce),E=!1},d(ce){ce&&y(e),P(t),P(I),re.d(),O=!1,H()}}}function kp(r){let e,t,n,o,l;const i=[ve("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":rt(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=de(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new It({props:a}),Le.push(()=>ze(e,"hovered",s));const u=[ve("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let f={};for(let c=0;c<u.length;c+=1)f=de(f,u[c]);return o=new tt({props:f}),{c(){A(e.$$.fragment),n=M(),A(o.$$.fragment)},m(c,_){F(e,c,_),w(c,n,_),F(o,c,_),l=!0},p(c,_){const d=_&16?He(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":rt(.5,.1)}},i[2]]):{};!t&&_&4&&(t=!0,d.hovered=c[2],Oe(()=>t=!1)),e.$set(d);const p={};o.$set(p)},i(c){l||(v(e.$$.fragment,c),v(o.$$.fragment,c),l=!0)},o(c){C(e.$$.fragment,c),C(o.$$.fragment,c),l=!1},d(c){c&&y(n),P(e,c),P(o,c)}}}function Cp(r){let e,t,n;return t=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[kp]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","map")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l&1&&(i.data=o[0]),l&65556&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function Sp(r){let e,t;return e=new Nt({props:{$$slots:{map:[Cp],sidebar:[$p],top:[wp]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&65791&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Lp(r,e,t){let n,o,l,i,s,a;ee(r,_e,b=>t(7,s=b)),ee(r,ot,b=>t(13,a=b));let u=Ft();try{u=a.getDemandModel()}catch{window.alert("No demand model for this area"),le(_e,s={mode:"pick-neighbourhood"},s)}let f=!1,c=null;function _(b,S){if(b==null){let N=S?"sum_to":"sum_from",j=Math.max(...u.features.map(R=>R.properties[N])),I=d(j);return[I.map(R=>R.toLocaleString()),kt(["get",N],I,Pr)]}else{let N=S?"counts_to":"counts_from",j=[...u.features.map(D=>D.properties[N][b])],I=Math.max(...j),R=d(I);return[R.map(D=>D.toLocaleString()),kt(["at",["id"],["literal",j]],R,Pr)]}}function d(b){let S=Pr.length+1;return Array.from(Array(S).keys()).map(N=>Math.round(b/(S-1)*N))}function p(b){c=b,t(2,c)}const g=()=>le(_e,s={mode:"pick-neighbourhood"},s);function $(){f=this.checked,t(1,f)}const L=()=>le(_e,s={mode:"title",firstLoad:!1},s),k=()=>le(_e,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=c==null?null:c.id),r.$$.dirty&9&&t(6,o=n!=null?u.features[n]:null),r.$$.dirty&10&&t(5,[l,i]=_(n,f),l,(t(4,i),t(3,n),t(1,f),t(2,c)))},[u,f,c,n,i,l,o,s,p,g,$,L,k]}class Mp extends se{constructor(e){super(),ae(this,e,Lp,Sp,ie,{})}}function Tp(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Ap(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Fp(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new Ae({props:{$$slots:{default:[Tp]},$$scope:{ctx:r}}}),l.$on("click",r[9]),a=new Ae({props:{$$slots:{default:[Ap]},$$scope:{ctx:r}}}),a.$on("click",r[10]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),f.textContent="Debug intersections",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(_,d){w(_,e,d),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),c=!0},p(_,d){const p={};d&2048&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&2048&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(l.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&y(e),P(l),P(a)}}}function _i(r){let e,t,n,o,l,i,s;function a(f){r[8](f)}let u={list:r[1].features};return r[2]!==void 0&&(u.idx=r[2]),n=new Yr({props:u}),Le.push(()=>ze(n,"idx",a)),{c(){e=h("button"),e.textContent="Pick another intersection",t=M(),A(n.$$.fragment),T(e,"class","secondary")},m(f,c){w(f,e,c),w(f,t,c),F(n,f,c),l=!0,i||(s=ne(e,"click",r[7]),i=!0)},p(f,c){const _={};c&2&&(_.list=f[1].features),!o&&c&4&&(o=!0,_.idx=f[2],Oe(()=>o=!1)),n.$set(_)},i(f){l||(v(n.$$.fragment,f),l=!0)},o(f){C(n.$$.fragment,f),l=!1},d(f){f&&(y(e),y(t)),P(n,f),i=!1,s()}}}function pi(r){let e,t;return{c(){e=h("a"),t=z("Open OSM"),T(e,"href",r[0]),T(e,"target","_blank")},m(n,o){w(n,e,o),m(e,t)},p(n,o){o&1&&T(e,"href",n[0])},d(n){n&&y(e)}}}function Pp(r){let e,t,n,o,l,i,s;t=new bn({}),t.$on("click",r[6]);let a=r[1].features.length>0&&_i(r),u=r[0]&&pi(r);return{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("p"),o.textContent="Purple intersections have some kind of turn restriction.",l=M(),a&&a.c(),i=M(),u&&u.c(),T(e,"slot","sidebar")},m(f,c){w(f,e,c),F(t,e,null),m(e,n),m(e,o),m(e,l),a&&a.m(e,null),m(e,i),u&&u.m(e,null),s=!0},p(f,c){f[1].features.length>0?a?(a.p(f,c),c&2&&v(a,1)):(a=_i(f),a.c(),v(a,1),a.m(e,i)):a&&($e(),C(a,1,1,()=>{a=null}),ke()),f[0]?u?u.p(f,c):(u=pi(f),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i(f){s||(v(t.$$.fragment,f),v(a),s=!0)},o(f){C(t.$$.fragment,f),C(a),s=!1},d(f){f&&y(e),P(t),a&&a.d(),u&&u.d()}}}function jp(r){let e,t;const n=[ve("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),e.$on("click",r[5]),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Ip(r){let e,t,n,o;const l=[ve("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new tt({props:i});const s=[ve("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let a={};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new It({props:a}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _=f&4?He(s,[s[0],{filter:["==",["id"],u[2]]},s[2]]):{};n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function Np(r){let e,t,n,o,l;return t=new Ve({props:{data:gt(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[jp]},$$scope:{ctx:r}}}),o=new Ve({props:{data:r[1],generateId:!0,$$slots:{default:[Ip]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),T(e,"slot","map")},m(i,s){w(i,e,s),F(t,e,null),m(e,n),F(o,e,null),l=!0},p(i,s){const a={};s&8&&(a.data=gt(i[3]).getAllIntersections()),s&2048&&(a.$$scope={dirty:s,ctx:i}),t.$set(a);const u={};s&2&&(u.data=i[1]),s&2052&&(u.$$scope={dirty:s,ctx:i}),o.$set(u)},i(i){l||(v(t.$$.fragment,i),v(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&y(e),P(t),P(o)}}}function Ep(r){let e,t;return e=new Nt({props:{$$slots:{map:[Np],sidebar:[Pp],top:[Fp]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&2079&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Rp(r,e,t){let n,o;ee(r,ot,p=>t(3,n=p)),ee(r,_e,p=>t(4,o=p));let l=null,i=Ft(),s=0;function a(p){t(0,l=p.detail.features[0].properties.osm),t(1,i=n.getMovements(p.detail.features[0].id)),t(2,s=0)}const u=()=>le(_e,o={mode:"pick-neighbourhood"},o),f=()=>t(1,i=Ft());function c(p){s=p,t(2,s)}return[l,i,s,n,o,a,u,f,c,()=>le(_e,o={mode:"title",firstLoad:!1},o),()=>le(_e,o={mode:"pick-neighbourhood"},o)]}class zp extends se{constructor(e){super(),ae(this,e,Rp,Ep,ie,{})}}function Op(r){let e,t,n,o,l,i;const s=[ve("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=de(a,s[d]);e=new It({props:a});const u=[ve("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let f={};for(let d=0;d<u.length;d+=1)f=de(f,u[d]);n=new It({props:f});const c=[ve("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return l=new tt({props:_}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment)},m(d,p){F(e,d,p),w(d,t,p),F(n,d,p),w(d,o,p),F(l,d,p),i=!0},p(d,[p]){const g=p&1?He(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const $={};n.$set($);const L={};l.$set(L)},i(d){i||(v(e.$$.fragment,d),v(n.$$.fragment,d),v(l.$$.fragment,d),i=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),i=!1},d(d){d&&(y(t),y(o)),P(e,d),P(n,d),P(l,d)}}}function Bp(r,e,t){let n;return ee(r,Rr,o=>t(0,n=o)),[n]}class Zr extends se{constructor(e){super(),ae(this,e,Bp,Op,ie,{})}}function Dp(r){let e,t;const n=[ve("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new It({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}class Kr extends se{constructor(e){super(),ae(this,e,null,Dp,ie,{})}}const Up=r=>({}),mi=r=>({});function gi(r){let e;const t=r[7]["line-popup"],n=Ie(t,r,r[9],mi);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&512)&&Ne(n,t,o,o[9],e?Re(t,o[9],l,Up):Ee(o[9]),mi)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Hp(r){let e,t,n=r[0]&&gi(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l&1&&v(n,1)):(n=gi(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function Gp(r){let e,t,n,o;const l=[ve("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new tt({props:i});const s=[ve("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":rt(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[Hp]},$$scope:{ctx:r}};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new tt({props:a}),n.$on("click",r[8]),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,[f]){const c=f&84?He(l,[l[0],l[1],{paint:{"line-width":u[6](u[2],u[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=f&125?He(s,[s[0],s[1],f&124&&{paint:{"line-width":u[6](u[2],u[4].maxShortcuts,0),"line-color":u[5](u[3],u[4].maxShortcuts),"line-opacity":rt(1,.5)}},s[3],f&1&&{manageHoverState:u[0]},f&1&&{hoverCursor:u[0]?"pointer":void 0}]):{};f&513&&(_.$$scope={dirty:f,ctx:u}),n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function Wp(r,e,t){let n,o;ee(r,uo,d=>t(2,n=d)),ee(r,Rr,d=>t(3,o=d));let{$$slots:l={},$$scope:i}=e,s=Fo("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:u=(d,p)=>{}}=e;function f(d,p){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?kt(["get","speed_mph"],Os,zs):p<=2?rt("white","blue"):rt(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",p,"#A32015"],$n.mapFeature.hover.backgroundColor)}function c(d,p,g){return!d||p<=2?ln(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,p,25+g]}const _=d=>a&&u(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&t(0,a=d.interactive),"onClickLine"in d&&t(1,u=d.onClickLine),"$$scope"in d&&t(9,i=d.$$scope)},[a,u,n,o,s,f,c,l,_,i]}class mr extends se{constructor(e){super(),ae(this,e,Wp,Gp,ie,{interactive:0,onClickLine:1})}}function qp(r){let e;const t=r[6].default,n=Ie(t,r,r[8],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&256)&&Ne(n,t,o,o[8],e?Re(t,o[8],l,null):Ee(o[8]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Jp(r){let e,t,n;const o=[ve("turn-restrictions"),{minzoom:13},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function l(s){r[7](s)}let i={$$slots:{default:[qp]},$$scope:{ctx:r}};for(let s=0;s<o.length;s+=1)i=de(i,o[s]);return r[1]!==void 0&&(i.hovered=r[1]),e=new lr({props:i}),Le.push(()=>ze(e,"hovered",l)),e.$on("click",function(){xn(r[0])&&r[0].apply(this,arguments)}),{c(){A(e.$$.fragment)},m(s,a){F(e,s,a),n=!0},p(s,a){r=s;const u={};a&256&&(u.$$scope={dirty:a,ctx:r}),!t&&a&2&&(t=!0,u.hovered=r[1],Oe(()=>t=!1)),e.$set(u)},i(s){n||(v(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){P(e,s)}}}function Yp(r){let e,t;const n=[ve("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Zp(r){let e,t,n,o;return e=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[Jp]},$$scope:{ctx:r}}}),n=new Ve({props:{data:r[3],$$slots:{default:[Yp]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(l,i){F(e,l,i),w(l,t,i),F(n,l,i),o=!0},p(l,[i]){const s={};i&4&&(s.data=l[2]),i&259&&(s.$$scope={dirty:i,ctx:l}),e.$set(s);const a={};i&8&&(a.data=l[3]),i&256&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(v(e.$$.fragment,l),v(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&y(t),P(e,l),P(n,l)}}}function Kp(r,e,t){let n,o,l,i;ee(r,ot,_=>t(4,l=_)),ee(r,St,_=>t(5,i=_));let{$$slots:s={},$$scope:a}=e,{onClickTurnRestriction:u=()=>{}}=e,f=null;function c(_){f=_,t(1,f)}return r.$$set=_=>{"onClickTurnRestriction"in _&&t(0,u=_.onClickTurnRestriction),"$$scope"in _&&t(8,a=_.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=f==null?Ft():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(f.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(f.properties.to_geometry),properties:{}}]}),r.$$.dirty&48&&t(2,o=i>0?l.renderTurnRestrictions():Ft())},[u,f,o,n,l,i,s,c,a]}class Xp extends se{constructor(e){super(),ae(this,e,Kp,Zp,ie,{onClickTurnRestriction:0})}}const Vp=r=>({}),hi=r=>({}),Qp=r=>({}),bi=r=>({});function xp(r){let e;const t=r[5]["modal-filter"],n=Ie(t,r,r[6],bi);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&64)&&Ne(n,t,o,o[6],e?Re(t,o[6],l,Qp):Ee(o[6]),bi)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function em(r){let e,t,n,o;const l=[ve("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{minzoom:Lr},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[xp]},$$scope:{ctx:r}};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new lr({props:i}),e.$on("click",function(){xn(r[0])&&r[0].apply(this,arguments)});const s=[ve("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Lr},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new lr({props:a}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,f){r=u;const c=f&0?He(l,[l[0],l[1],{minzoom:Lr},l[3],l[4]]):{};f&64&&(c.$$scope={dirty:f,ctx:r}),e.$set(c);const _=f&0?He(s,[s[0],s[1],{minzoom:Lr},s[3],s[4]]):{};n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function tm(r){let e;const t=r[5]["turn-restriction"],n=Ie(t,r,r[6],hi);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&64)&&Ne(n,t,o,o[6],e?Re(t,o[6],l,Vp):Ee(o[6]),hi)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function nm(r){let e,t,n,o;return e=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[em]},$$scope:{ctx:r}}}),n=new Xp({props:{onClickTurnRestriction:r[1],$$slots:{default:[tm]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(l,i){F(e,l,i),w(l,t,i),F(n,l,i),o=!0},p(l,[i]){const s={};i&4&&(s.data=l[2]),i&65&&(s.$$scope={dirty:i,ctx:l}),e.$set(s);const a={};i&2&&(a.onClickTurnRestriction=l[1]),i&64&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(v(e.$$.fragment,l),v(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&y(t),P(e,l),P(n,l)}}}let Lr=13;function rm(r,e,t){let n,o,l;ee(r,ot,f=>t(3,o=f)),ee(r,St,f=>t(4,l=f));let{$$slots:i={},$$scope:s}=e,{onClickModalFilter:a=()=>{}}=e,{onClickTurnRestriction:u=()=>{}}=e;return r.$$set=f=>{"onClickModalFilter"in f&&t(0,a=f.onClickModalFilter),"onClickTurnRestriction"in f&&t(1,u=f.onClickTurnRestriction),"$$scope"in f&&t(6,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&24&&t(2,n=l>0?o.renderModalFilters():Ft())},[a,u,n,o,l,i,s]}class wn extends se{constructor(e){super(),ae(this,e,rm,nm,ie,{onClickModalFilter:0,onClickTurnRestriction:1})}}function om(r){let e,t;const n=[ve("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new lr({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}class Xr extends se{constructor(e){super(),ae(this,e,null,om,ie,{})}}function lm(r){let e;const t=r[3].default,n=Ie(t,r,r[4],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16)&&Ne(n,t,o,o[4],e?Re(t,o[4],l,null):Ee(o[4]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function im(r){let e,t;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[lm]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function sm(r,e,t){let n,o;ee(r,ot,a=>t(2,o=a));let{$$slots:l={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&t(1,s=a.input),"$$scope"in a&&t(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||o.renderNeighbourhood()),r.$$.dirty&1&&ms("neighbourhoodGj",n)},[n,s,o,l,i]}class gr extends se{constructor(e){super(),ae(this,e,sm,im,ie,{input:1})}}function am(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function um(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function fm(r){let e;return{c(){e=z("Editing")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function cm(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;return l=new Ae({props:{$$slots:{default:[am]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new Ae({props:{$$slots:{default:[um]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Ae({props:{$$slots:{default:[fm]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),A(c.$$.fragment),_=M(),d=h("li"),d.textContent="Debug mode",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(g,$){w(g,e,$),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),F(c,f,null),m(n,_),m(n,d),p=!0},p(g,$){const L={};$&4096&&(L.$$scope={dirty:$,ctx:g}),l.$set(L);const k={};$&4096&&(k.$$scope={dirty:$,ctx:g}),a.$set(k);const b={};$&4096&&(b.$$scope={dirty:$,ctx:g}),c.$set(b)},i(g){p||(v(l.$$.fragment,g),v(a.$$.fragment,g),v(c.$$.fragment,g),p=!0)},o(g){C(l.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),p=!1},d(g){g&&y(e),P(l),P(a),P(c)}}}function wi(r){let e,t,n;return{c(){e=h("button"),e.textContent="Ⓧ",T(e,"class","close-btn svelte-khnvno")},m(o,l){w(o,e,l),t||(n=ne(e,"click",r[6]),t=!0)},p:Y,d(o){o&&y(e),t=!1,n()}}}function dm(r){let e;return{c(){e=h("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){w(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&y(e)}}}function _m(r){let e,t,n,o,l,i,s;e=new sr({props:{properties:r[0].feature.properties}});function a(f){r[7](f)}let u={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(u.idx=r[0].movementIdx),l=new Yr({props:u}),Le.push(()=>ze(l,"idx",a)),{c(){A(e.$$.fragment),t=M(),n=h("h5"),n.textContent="Turn restrictions:",o=M(),A(l.$$.fragment)},m(f,c){F(e,f,c),w(f,t,c),w(f,n,c),w(f,o,c),F(l,f,c),s=!0},p(f,c){const _={};c&1&&(_.properties=f[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=f[0].movements.features),!i&&c&1&&(i=!0,d.idx=f[0].movementIdx,Oe(()=>i=!1)),l.$set(d)},i(f){s||(v(e.$$.fragment,f),v(l.$$.fragment,f),s=!0)},o(f){C(e.$$.fragment,f),C(l.$$.fragment,f),s=!1},d(f){f&&(y(t),y(n),y(o)),P(e,f),P(l,f)}}}function pm(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;t=new bn({}),t.$on("click",r[5]);let g=r[0]&&wi(r);const $=[_m,dm],L=[];function k(b,S){return b[0]?0:1}return _=k(r),d=L[_]=$[_](r),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("h4"),o.textContent="Roads",l=M(),i=h("p"),i.textContent="Click a road to visit its OSM object.",s=M(),a=h("div"),u=h("h4"),u.textContent="Intersections",f=M(),g&&g.c(),c=M(),d.c(),X(a,"display","flex"),X(a,"align-items","start"),X(a,"justify-content","space-between"),T(e,"slot","sidebar")},m(b,S){w(b,e,S),F(t,e,null),m(e,n),m(e,o),m(e,l),m(e,i),m(e,s),m(e,a),m(a,u),m(a,f),g&&g.m(a,null),m(e,c),L[_].m(e,null),p=!0},p(b,S){b[0]?g?g.p(b,S):(g=wi(b),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let N=_;_=k(b),_===N?L[_].p(b,S):($e(),C(L[N],1,1,()=>{L[N]=null}),ke(),d=L[_],d?d.p(b,S):(d=L[_]=$[_](b),d.c()),v(d,1),d.m(e,null))},i(b){p||(v(t.$$.fragment,b),v(d),p=!0)},o(b){C(t.$$.fragment,b),C(d),p=!1},d(b){b&&y(e),P(t),g&&g.d(),L[_].d()}}}function mm(r){let e,t;return e=new sr({props:{properties:r[11]}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function gm(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[mm,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function hm(r){let e,t;return e=new sr({props:{properties:r[11]}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function bm(r){let e,t,n;return t=new _t({props:{openOn:"hover",$$slots:{default:[hm,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","line-popup")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l&6144&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function wm(r){let e,t,n,o,l,i,s,a,u,f;e=new Kr({}),n=new Zr({}),l=new Xr({});const c=[ve("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[gm]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=de(_,c[d]);return s=new un({props:_}),u=new mr({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[bm]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),A(s.$$.fragment),a=M(),A(u.$$.fragment)},m(d,p){F(e,d,p),w(d,t,p),F(n,d,p),w(d,o,p),F(l,d,p),w(d,i,p),F(s,d,p),w(d,a,p),F(u,d,p),f=!0},p(d,p){const g={};p&4096&&(g.$$scope={dirty:p,ctx:d}),s.$set(g);const $={};p&4096&&($.$$scope={dirty:p,ctx:d}),u.$set($)},i(d){f||(v(e.$$.fragment,d),v(n.$$.fragment,d),v(l.$$.fragment,d),v(s.$$.fragment,d),v(u.$$.fragment,d),f=!0)},o(d){C(e.$$.fragment,d),C(n.$$.fragment,d),C(l.$$.fragment,d),C(s.$$.fragment,d),C(u.$$.fragment,d),f=!1},d(d){d&&(y(t),y(o),y(i),y(a)),P(e,d),P(n,d),P(l,d),P(s,d),P(u,d)}}}function ym(r){let e,t;return e=new sr({props:{properties:r[11]}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function vm(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[ym,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function $m(r){let e,t;return e=new sr({props:{properties:r[11]}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function km(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[$m,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Cm(r){var l,i,s;let e,t;const n=[ve("debug-intersections"),{paint:{"circle-radius":go(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":rt(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(l=r[0])==null?void 0:l.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,rt(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[km]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)o=de(o,n[a]);return e=new un({props:o}),e.$on("click",r[3]),{c(){A(e.$$.fragment)},m(a,u){F(e,a,u),t=!0},p(a,u){var c,_,d;const f=u&1?He(n,[n[0],{paint:{"circle-radius":go(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":rt(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,rt(0,.5)]}},n[2],n[3]]):{};u&4096&&(f.$$scope={dirty:u,ctx:a}),e.$set(f)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function yi(r){let e,t;return e=new Ve({props:{data:r[0].movements,generateId:!0,$$slots:{default:[Sm]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0].movements),o&4097&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Sm(r){let e,t,n,o;const l=[ve("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new tt({props:i});const s=[ve("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new It({props:a}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _=f&1?He(s,[s[0],{filter:["==",["id"],u[0].movementIdx]},s[2]]):{};n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function Lm(r){let e,t,n,o,l,i,s,a;t=new gr({props:{$$slots:{default:[wm]},$$scope:{ctx:r}}}),o=new wn({props:{$$slots:{default:[vm]},$$scope:{ctx:r}}}),i=new Ve({props:{data:gt(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[Cm]},$$scope:{ctx:r}}});let u=r[0]&&yi(r);return{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),l=M(),A(i.$$.fragment),s=M(),u&&u.c(),T(e,"slot","map")},m(f,c){w(f,e,c),F(t,e,null),m(e,n),F(o,e,null),m(e,l),F(i,e,null),m(e,s),u&&u.m(e,null),a=!0},p(f,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:f}),t.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:f}),o.$set(d);const p={};c&2&&(p.data=gt(f[1]).getAllIntersections()),c&4097&&(p.$$scope={dirty:c,ctx:f}),i.$set(p),f[0]?u?(u.p(f,c),c&1&&v(u,1)):(u=yi(f),u.c(),v(u,1),u.m(e,null)):u&&($e(),C(u,1,1,()=>{u=null}),ke())},i(f){a||(v(t.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),v(u),a=!0)},o(f){C(t.$$.fragment,f),C(o.$$.fragment,f),C(i.$$.fragment,f),C(u),a=!1},d(f){f&&y(e),P(t),P(o),P(i),u&&u.d()}}}function Mm(r){let e,t;return e=new Nt({props:{$$slots:{map:[Lm],sidebar:[pm],top:[cm]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Tm(r,e,t){let n,o;ee(r,ot,p=>t(1,n=p)),ee(r,_e,p=>t(2,o=p));let l=null;function i(p){let g=p.detail.features[0],$=n.getMovements(g.properties.intersection_id);t(0,l={feature:g,movements:$,movementIdx:0})}const s=(p,g)=>window.open(gt(p.properties).way,"_blank"),a=()=>le(_e,o={mode:"neighbourhood"},o),u=()=>t(0,l=null);function f(p){r.$$.not_equal(l.movementIdx,p)&&(l.movementIdx=p,t(0,l))}return[l,n,o,i,s,a,u,f,()=>le(_e,o={mode:"title",firstLoad:!1},o),()=>le(_e,o={mode:"pick-neighbourhood"},o),()=>le(_e,o={mode:"neighbourhood"},o)]}class Am extends se{constructor(e){super(),ae(this,e,Tm,Mm,ie,{})}}var zt=63710088e-1,Ys={centimeters:zt*100,centimetres:zt*100,degrees:360/(2*Math.PI),feet:zt*3.28084,inches:zt*39.37,kilometers:zt/1e3,kilometres:zt/1e3,meters:zt,metres:zt,miles:zt/1609.344,millimeters:zt*1e3,millimetres:zt*1e3,nauticalmiles:zt/1852,radians:1,yards:zt*1.0936};function Fm(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function So(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vi(r[0])||!vi(r[1]))throw new Error("coordinates must contain numbers");return Fm({type:"Point",coordinates:r},e,t)}function Pm(r,e="kilometers"){const t=Ys[e];if(!t)throw new Error(e+" units is invalid");return r*t}function jm(r,e="kilometers"){const t=Ys[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Lo(r){return r%(2*Math.PI)*180/Math.PI}function Kt(r){return r%360*Math.PI/180}function vi(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function ir(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Im(r){return r.type==="Feature"?r.geometry:r}function Zs(r,e,t={}){if(t.final===!0)return Nm(r,e);const n=ir(r),o=ir(e),l=Kt(n[0]),i=Kt(o[0]),s=Kt(n[1]),a=Kt(o[1]),u=Math.sin(i-l)*Math.cos(a),f=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return Lo(Math.atan2(u,f))}function Nm(r,e){let t=Zs(e,r);return t=(t+180)%360,t}function Em(r,e,t,n={}){const o=ir(r),l=Kt(o[0]),i=Kt(o[1]),s=Kt(t),a=jm(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),f=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(u)),c=Lo(f),_=Lo(u);return So([c,_],n.properties)}function Rm(r,e,t={}){var n=ir(r),o=ir(e),l=Kt(o[1]-n[1]),i=Kt(o[0]-n[0]),s=Kt(n[1]),a=Kt(o[1]),u=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return Pm(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function zm(r,e,t={}){const o=Im(r).coordinates;let l=0;for(let i=0;i<o.length&&!(e>=l&&i===o.length-1);i++)if(l>=e){const s=e-l;if(s){const a=Zs(o[i],o[i-1])-180;return Em(o[i],s,a,t)}else return So(o[i])}else l+=Rm(o[i],o[i+1],t);return So(o[o.length-1])}var Om=zm;function Bm(r){let e,t;const n=[ve("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Dm(r){let e,t;return e=new Ve({props:{data:r[0],$$slots:{default:[Bm]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}let Um=50,Hm=100,Gm=.01;function Wm(r,e,t){let{paths:n}=e,o=a(),l=u(),i=c(),s=setInterval(_,Hm);jt(()=>clearInterval(s));function a(){return n.features.map(d=>1/d.properties.directness).reduce((d,p)=>d+p,0)}function u(){return n.features.length==0?[]:Array.from({length:Um},f)}function f(){let d=Math.random()*o,p=0;for(let[g,$]of n.features.entries())if(p+=1/$.properties.directness,d<p)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${o}`)}function c(){return{type:"FeatureCollection",features:l.map(({idx:d,distance:p})=>Om(n.features[d],p,{units:"kilometers"}))}}function _(){for(let[d,p]of l.entries())p.distance+=Gm,p.distance>=n.features[p.idx].properties.length_meters/1e3&&(l[d]=f());t(0,i=c())}return r.$$set=d=>{"paths"in d&&t(1,n=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(o=a(),l=u())},[i,n]}class qm extends se{constructor(e){super(),ae(this,e,Wm,Dm,ie,{paths:1})}}class Jm{constructor(e){mt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function Ym(r){let e,t,n,o,l;return{c(){e=h("div"),e.textContent="+",t=M(),n=h("img"),l=z(`
    Add diagonal filter`),X(e,"font-size","200%"),X(e,"margin-top","-12px"),T(e,"class","icon"),Ke(n.src,o="/ltn//filters/diagonal_filter_icon.png")||T(n,"src",o),T(n,"alt","Add diagonal filter"),X(n,"transform","rotate(135deg)"),T(n,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,t,s),w(i,n,s),w(i,l,s)},p:Y,d(i){i&&(y(e),y(t),y(n),y(l))}}}function Zm(r){let e;function t(l,i){return l[0].hasRotatedFilter?Xm:Km}let n=t(r),o=n(r);return{c(){o.c(),e=Qe()},m(l,i){o.m(l,i),w(l,e,i)},p(l,i){n!==(n=t(l))&&(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&y(e),o.d(l)}}}function Km(r){let e,t,n,o,l;return{c(){e=h("div"),e.textContent="↻",t=M(),n=h("img"),l=z(`
      Rotate diagonal filter`),X(e,"font-size","200%"),X(e,"padding-bottom","4px"),T(e,"class","icon"),Ke(n.src,o="/ltn//filters/diagonal_filter_icon.png")||T(n,"src",o),T(n,"alt","Rotate diagonal filter"),X(n,"transform","rotate(45deg)"),T(n,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,t,s),w(i,n,s),w(i,l,s)},d(i){i&&(y(e),y(t),y(n),y(l))}}}function Xm(r){let e,t,n,o,l;return{c(){e=h("div"),e.textContent="❌",t=M(),n=h("img"),l=z(`
      Delete diagonal filter`),T(e,"class","icon"),Ke(n.src,o="/ltn//filters/diagonal_filter_icon.png")||T(n,"src",o),T(n,"alt","Remove diagonal filter"),X(n,"transform","rotate(45deg)"),T(n,"class","svelte-j2s60j")},m(i,s){w(i,e,s),w(i,t,s),w(i,n,s),w(i,l,s)},d(i){i&&(y(e),y(t),y(n),y(l))}}}function Vm(r){let e;function t(l,i){return l[0].filter?Zm:Ym}let n=t(r),o=n(r);return{c(){e=h("div"),o.c(),X(e,"display","flex"),X(e,"align-items","center")},m(l,i){w(l,e,i),o.m(e,null)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e,null)))},i:Y,o:Y,d(l){l&&y(e),o.d()}}}function Qm(r,e,t){let{intersection:n}=e;return r.$$set=o=>{"intersection"in o&&t(0,n=o.intersection)},[n]}class xm extends se{constructor(e){super(),ae(this,e,Qm,Vm,ie,{intersection:0})}}function eg(r){let e,t;return e=new xm({props:{intersection:r[2](r[6])}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&64&&(l.intersection=n[2](n[6])),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function tg(r){let e,t;return e=new qf({props:{openOn:"hover",$$slots:{default:[eg,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function ng(r){let e,t;const n=[ve("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":go(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-opacity":rt(0,.5),"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":rt(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[tg]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new un({props:o}),e.$on("click",r[4]),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,[i]){const s=i&2?He(n,[n[0],n[1],n[2],{interactive:l[1]},n[4],n[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function rg(r,e,t){let{neighbourhood:n=Fo("neighbourhoodGj")}=e,{onClickIntersection:o=u=>{}}=e,{interactive:l=!1}=e;function i(u){let f=n.features[u];return new Jm(f)}function s(u){return i(u[0].id)}const a=u=>o(s(u.detail.features));return r.$$set=u=>{"neighbourhood"in u&&t(3,n=u.neighbourhood),"onClickIntersection"in u&&t(0,o=u.onClickIntersection),"interactive"in u&&t(1,l=u.interactive)},[o,l,s,n,a]}class og extends se{constructor(e){super(),ae(this,e,rg,ng,ie,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function $i(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function ki(r){let e,t,n,o,l,i,s=r[8]+"",a,u,f,c,_;function d(){return r[4](r[7])}return{c(){e=h("button"),t=h("img"),o=M(),l=h("br"),i=M(),a=z(s),u=M(),Ke(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||T(t,"src",n),T(t,"width","80"),T(t,"alt",r[8]),T(e,"class","outline"),X(e,"width","100%"),e.disabled=f=r[1]==r[7]},m(p,g){w(p,e,g),m(e,t),m(e,o),m(e,l),m(e,i),m(e,a),m(e,u),c||(_=ne(e,"click",d),c=!0)},p(p,g){r=p,g&2&&f!==(f=r[1]==r[7])&&(e.disabled=f)},d(p){p&&y(e),c=!1,_()}}}function lg(r){let e,t,n,o,l,i,s,a,u,f,c,_,d=r[2][2]+"",p,g,$,L,k,b,S=Se(r[3]),N=[];for(let j=0;j<S.length;j+=1)N[j]=ki($i(r,S,j));return{c(){e=h("h3"),e.textContent="Choose a modal filter to place on streets",t=M(),n=h("table"),o=h("tr"),l=h("td");for(let j=0;j<N.length;j+=1)N[j].c();i=M(),s=h("td"),a=h("img"),c=M(),_=h("p"),p=z(d),g=M(),$=h("center"),L=h("button"),L.textContent="Confirm",Ke(a.src,u=`/ltn//filters/${r[1]}.gif`)||T(a,"src",u),T(a,"height","300"),T(a,"alt",f=r[2][1])},m(j,I){w(j,e,I),w(j,t,I),w(j,n,I),m(n,o),m(o,l);for(let R=0;R<N.length;R+=1)N[R]&&N[R].m(l,null);m(o,i),m(o,s),m(s,a),m(s,c),m(s,_),m(_,p),w(j,g,I),w(j,$,I),m($,L),k||(b=ne(L,"click",r[5]),k=!0)},p(j,I){if(I&10){S=Se(j[3]);let R;for(R=0;R<S.length;R+=1){const D=$i(j,S,R);N[R]?N[R].p(D,I):(N[R]=ki(D),N[R].c(),N[R].m(l,null))}for(;R<N.length;R+=1)N[R].d(1);N.length=S.length}I&2&&!Ke(a.src,u=`/ltn//filters/${j[1]}.gif`)&&T(a,"src",u),I&4&&f!==(f=j[2][1])&&T(a,"alt",f),I&4&&d!==(d=j[2][2]+"")&&oe(p,d)},d(j){j&&(y(e),y(t),y(n),y(g),y($)),ut(N,j),k=!1,b()}}}function ig(r){let e,t,n;function o(i){r[6](i)}let l={$$slots:{default:[lg]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.show=r[0]),e=new Hr({props:l}),Le.push(()=>ze(e,"show",o)),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&4103&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.show=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function sg(r,e,t){let n,o;ee(r,fo,f=>t(1,o=f));let l=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]],{show:i}=e;const s=f=>le(fo,o=f,o),a=()=>t(0,i=!1);function u(f){i=f,t(0,i)}return r.$$set=f=>{"show"in f&&t(0,i=f.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=l.find(f=>f[0]==o))},[i,o,n,l,s,a,u]}class ag extends se{constructor(e){super(),ae(this,e,sg,ig,ie,{show:0})}}function Ci(r){let e,t;return e=new Ve({props:{data:r[0],$$slots:{default:[ug]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0]),o&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function ug(r){let e,t;const n=[ve("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function fg(r){let e,t,n=r[0]&&Ci(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&v(n,1)):(n=Ci(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function cg(r,e,t){let{map:n}=e,o=null;const l=hn();n.on("dragstart",i),n.on("mousemove",s),n.on("mouseup",a),jt(()=>{n.dragPan.enable(),n.off("dragstart",i),n.off("mousemove",s),n.off("mouseup",a)});function i(){n.dragPan.disable(),t(0,o={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(u){o&&(o.geometry.coordinates.push(u.lngLat.toArray()),t(0,o))}function a(){o&&(l("done",o),t(0,o=null))}return r.$$set=u=>{"map"in u&&t(1,n=u.map)},[o,n]}class dg extends se{constructor(e){super(),ae(this,e,cg,fg,ie,{map:1})}}function _g(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function pg(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function mg(r){let e;return{c(){e=h("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function gg(r){let e;return{c(){e=z("View shortcuts")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function hg(r){let e;return{c(){e=z("Route")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function bg(r){let e;return{c(){e=z("Impact routing to one destination")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function wg(r){let e;return{c(){e=z("Change this boundary")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function yg(r){let e;return{c(){e=z("Debug")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function vg(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L,k,b,S,N,j,I,R,D,B,E,O,H,W;return l=new Ae({props:{$$slots:{default:[_g]},$$scope:{ctx:r}}}),l.$on("click",r[36]),a=new Ae({props:{$$slots:{default:[pg]},$$scope:{ctx:r}}}),a.$on("click",r[37]),_=new Jr({props:{$$slots:{default:[mg]},$$scope:{ctx:r}}}),L=new Ae({props:{$$slots:{default:[gg]},$$scope:{ctx:r}}}),L.$on("click",r[38]),S=new Ae({props:{$$slots:{default:[hg]},$$scope:{ctx:r}}}),S.$on("click",r[39]),I=new Ae({props:{$$slots:{default:[bg]},$$scope:{ctx:r}}}),I.$on("click",r[40]),B=new Ae({props:{$$slots:{default:[wg]},$$scope:{ctx:r}}}),B.$on("click",r[41]),H=new Ae({props:{$$slots:{default:[yg]},$$scope:{ctx:r}}}),H.$on("click",r[42]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),c=z(`Editing
          `),A(_.$$.fragment),d=M(),p=h("nav"),g=h("ul"),$=h("li"),A(L.$$.fragment),k=M(),b=h("li"),A(S.$$.fragment),N=M(),j=h("li"),A(I.$$.fragment),R=M(),D=h("li"),A(B.$$.fragment),E=M(),O=h("li"),A(H.$$.fragment),T(t,"aria-label","breadcrumb"),T(e,"slot","top"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(Z,re){w(Z,e,re),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),m(f,c),F(_,f,null),m(e,d),m(e,p),m(p,g),m(g,$),F(L,$,null),m(g,k),m(g,b),F(S,b,null),m(g,N),m(g,j),F(I,j,null),m(g,R),m(g,D),F(B,D,null),m(g,E),m(g,O),F(H,O,null),W=!0},p(Z,re){const ce={};re[1]&32768&&(ce.$$scope={dirty:re,ctx:Z}),l.$set(ce);const U={};re[1]&32768&&(U.$$scope={dirty:re,ctx:Z}),a.$set(U);const be={};re[1]&32768&&(be.$$scope={dirty:re,ctx:Z}),_.$set(be);const fe={};re[1]&32768&&(fe.$$scope={dirty:re,ctx:Z}),L.$set(fe);const te={};re[1]&32768&&(te.$$scope={dirty:re,ctx:Z}),S.$set(te);const me={};re[1]&32768&&(me.$$scope={dirty:re,ctx:Z}),I.$set(me);const ue={};re[1]&32768&&(ue.$$scope={dirty:re,ctx:Z}),B.$set(ue);const Fe={};re[1]&32768&&(Fe.$$scope={dirty:re,ctx:Z}),H.$set(Fe)},i(Z){W||(v(l.$$.fragment,Z),v(a.$$.fragment,Z),v(_.$$.fragment,Z),v(L.$$.fragment,Z),v(S.$$.fragment,Z),v(I.$$.fragment,Z),v(B.$$.fragment,Z),v(H.$$.fragment,Z),W=!0)},o(Z){C(l.$$.fragment,Z),C(a.$$.fragment,Z),C(_.$$.fragment,Z),C(L.$$.fragment,Z),C(S.$$.fragment,Z),C(I.$$.fragment,Z),C(B.$$.fragment,Z),C(H.$$.fragment,Z),W=!1},d(Z){Z&&y(e),P(l),P(a),P(_),P(L),P(S),P(I),P(B),P(H)}}}function Si(r){let e;return{c(){e=h("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Li(r){let e,t;return e=new Nn({props:{colorScale:zs,limits:Os}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function $g(r){let e,t,n;return{c(){e=z("Undo ("),t=z(r[4]),n=z(")")},m(o,l){w(o,e,l),w(o,t,l),w(o,n,l)},p(o,l){l[0]&16&&oe(t,o[4])},d(o){o&&(y(e),y(t),y(n))}}}function kg(r){let e;return{c(){e=z("Undo")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Cg(r){let e,t,n;return{c(){e=z("Redo ("),t=z(r[5]),n=z(")")},m(o,l){w(o,e,l),w(o,t,l),w(o,n,l)},p(o,l){l[0]&32&&oe(t,o[5])},d(o){o&&(y(e),y(t),y(n))}}}function Sg(r){let e;return{c(){e=z("Redo")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Lg(r){let e,t,n,o,l=gt(r[6]).properties.name+"",i,s,a=gt(r[6]).properties.area_km2.toFixed(1)+"",u,f,c,_,d,p,g,$,L,k,b,S,N,j,I,R,D,B,E,O,H,W,Z,re,ce,U,be,fe,te,me,ue,Fe,et,ye,we,lt,Ge,Ce,K,V,Q,ge,he,Pe,q,nt,xe,Je,Ct,Lt,Ot,on,Et,yn,st,Bt,zn,bt=r[8]>0&&Si(),dt=r[12]=="speeds"&&Li();function br(Te,Xe){return Te[4]==0?kg:$g}let Qt=br(r),Dt=Qt(r);function wr(Te,Xe){return Te[5]==0?Sg:Cg}let fn=wr(r),Mt=fn(r);function Vr(Te){r[35](Te)}let yr={};return r[3]!==void 0&&(yr.show=r[3]),Et=new ag({props:yr}),Le.push(()=>ze(Et,"show",Vr)),{c(){e=h("div"),t=h("p"),n=z("Editing neighbourhood "),o=h("u"),i=z(l),s=z(`
      , with an area of `),u=z(a),f=z(" km²"),c=M(),bt&&bt.c(),_=M(),d=h("div"),p=h("button"),g=h("img"),k=M(),b=h("button"),S=h("img"),I=M(),R=h("button"),D=h("img"),O=M(),H=h("button"),W=h("img"),ce=M(),U=h("button"),U.textContent="Change modal filter type",be=M(),fe=h("label"),te=h("input"),me=z(`
      Animate shortcuts`),ue=M(),Fe=h("label"),et=h("input"),ye=z(`
      Include perimeter roads`),we=M(),lt=h("div"),Ge=h("label"),Ce=z(`Draw roads:
        `),K=h("select"),V=h("option"),V.textContent="Worst shortcuts",Q=h("option"),Q.textContent="Cell",ge=h("option"),ge.textContent="Edits (either filter or direction)",he=h("option"),he.textContent="Speed limit",Pe=M(),dt&&dt.c(),q=M(),nt=h("div"),xe=h("button"),Dt.c(),Ct=M(),Lt=h("button"),Mt.c(),on=M(),A(Et.$$.fragment),Ke(g.src,$=`/ltn//filters/${r[9]}_icon.gif`)||T(g,"src",$),T(g,"alt","Add a modal filter"),T(g,"class","svelte-1e8mfll"),p.disabled=L=r[0].kind=="filter",T(p,"data-tooltip","Add a modal filter (hotkey 1)"),T(p,"class","svelte-1e8mfll"),Ue(p,"active",r[0].kind=="filter"),Ue(p,"outline",r[0].kind!="filter"),Ke(S.src,N="/ltn//filters/select_freehand.png")||T(S,"src",N),T(S,"alt","Add many modal filters along a line"),T(S,"class","svelte-1e8mfll"),b.disabled=j=r[0].kind=="freehand-filters",T(b,"data-tooltip","Add many modal filters along a line (hotkey 2)"),T(b,"class","svelte-1e8mfll"),Ue(b,"active",r[0].kind=="freehand-filters"),Ue(b,"outline",r[0].kind!="freehand-filters"),Ke(D.src,B=gs)||T(D,"src",B),T(D,"alt","Reverse directions"),T(D,"class","svelte-1e8mfll"),R.disabled=E=r[0].kind=="oneway",T(R,"data-tooltip","Reverse directions (hotkey 3)"),T(R,"class","svelte-1e8mfll"),Ue(R,"active",r[0].kind=="oneway"),Ue(R,"outline",r[0].kind!="oneway"),Ke(W.src,Z="/ltn//filters/no_right_turn.png")||T(W,"src",Z),T(W,"alt","Restrict turns"),T(W,"class","svelte-1e8mfll"),H.disabled=re=r[0].kind=="turn_restriction",T(H,"data-tooltip","Restrict turns (hotkey 4)"),T(H,"class","svelte-1e8mfll"),Ue(H,"active",r[0].kind=="turn_restriction"),Ue(H,"outline",r[0].kind!="turn_restriction"),T(d,"class","tool-palette svelte-1e8mfll"),T(U,"class","outline"),T(te,"type","checkbox"),T(et,"type","checkbox"),V.__value="shortcuts",We(V,V.__value),Q.__value="cells",We(Q,Q.__value),ge.__value="edits",We(ge,ge.__value),he.__value="speeds",We(he,he.__value),r[12]===void 0&&dn(()=>r[34].call(K)),X(lt,"border","1px solid black"),X(lt,"padding","4px"),T(xe,"class","outline"),xe.disabled=Je=r[4]==0,T(xe,"data-tooltip","Ctrl+Z"),T(Lt,"class","outline"),Lt.disabled=Ot=r[5]==0,T(Lt,"data-tooltip","Ctrl+Y"),X(nt,"display","flex"),X(nt,"justify-content","space-between"),T(e,"slot","sidebar")},m(Te,Xe){w(Te,e,Xe),m(e,t),m(t,n),m(t,o),m(o,i),m(t,s),m(t,u),m(t,f),m(e,c),bt&&bt.m(e,null),m(e,_),m(e,d),m(d,p),m(p,g),m(d,k),m(d,b),m(b,S),m(d,I),m(d,R),m(R,D),m(d,O),m(d,H),m(H,W),m(e,ce),m(e,U),m(e,be),m(e,fe),m(fe,te),te.checked=r[11],m(fe,me),m(e,ue),m(e,Fe),m(Fe,et),et.checked=r[10],m(Fe,ye),m(e,we),m(e,lt),m(lt,Ge),m(Ge,Ce),m(Ge,K),m(K,V),m(K,Q),m(K,ge),m(K,he),vt(K,r[12],!0),m(lt,Pe),dt&&dt.m(lt,null),m(e,q),m(e,nt),m(nt,xe),Dt.m(xe,null),m(nt,Ct),m(nt,Lt),Mt.m(Lt,null),m(e,on),F(Et,e,null),st=!0,Bt||(zn=[ne(p,"click",r[27]),ne(b,"click",r[28]),ne(R,"click",r[29]),ne(H,"click",r[30]),ne(U,"click",r[31]),ne(te,"change",r[32]),ne(et,"change",r[33]),ne(et,"change",r[15]),ne(K,"change",r[34]),ne(xe,"click",r[23]),ne(Lt,"click",r[24])],Bt=!0)},p(Te,Xe){(!st||Xe[0]&64)&&l!==(l=gt(Te[6]).properties.name+"")&&oe(i,l),(!st||Xe[0]&64)&&a!==(a=gt(Te[6]).properties.area_km2.toFixed(1)+"")&&oe(u,a),Te[8]>0?bt||(bt=Si(),bt.c(),bt.m(e,_)):bt&&(bt.d(1),bt=null),(!st||Xe[0]&512&&!Ke(g.src,$=`/ltn//filters/${Te[9]}_icon.gif`))&&T(g,"src",$),(!st||Xe[0]&1&&L!==(L=Te[0].kind=="filter"))&&(p.disabled=L),(!st||Xe[0]&1)&&Ue(p,"active",Te[0].kind=="filter"),(!st||Xe[0]&1)&&Ue(p,"outline",Te[0].kind!="filter"),(!st||Xe[0]&1&&j!==(j=Te[0].kind=="freehand-filters"))&&(b.disabled=j),(!st||Xe[0]&1)&&Ue(b,"active",Te[0].kind=="freehand-filters"),(!st||Xe[0]&1)&&Ue(b,"outline",Te[0].kind!="freehand-filters"),(!st||Xe[0]&1&&E!==(E=Te[0].kind=="oneway"))&&(R.disabled=E),(!st||Xe[0]&1)&&Ue(R,"active",Te[0].kind=="oneway"),(!st||Xe[0]&1)&&Ue(R,"outline",Te[0].kind!="oneway"),(!st||Xe[0]&1&&re!==(re=Te[0].kind=="turn_restriction"))&&(H.disabled=re),(!st||Xe[0]&1)&&Ue(H,"active",Te[0].kind=="turn_restriction"),(!st||Xe[0]&1)&&Ue(H,"outline",Te[0].kind!="turn_restriction"),Xe[0]&2048&&(te.checked=Te[11]),Xe[0]&1024&&(et.checked=Te[10]),Xe[0]&4096&&vt(K,Te[12]),Te[12]=="speeds"?dt?Xe[0]&4096&&v(dt,1):(dt=Li(),dt.c(),v(dt,1),dt.m(lt,null)):dt&&($e(),C(dt,1,1,()=>{dt=null}),ke()),Qt===(Qt=br(Te))&&Dt?Dt.p(Te,Xe):(Dt.d(1),Dt=Qt(Te),Dt&&(Dt.c(),Dt.m(xe,null))),(!st||Xe[0]&16&&Je!==(Je=Te[4]==0))&&(xe.disabled=Je),fn===(fn=wr(Te))&&Mt?Mt.p(Te,Xe):(Mt.d(1),Mt=fn(Te),Mt&&(Mt.c(),Mt.m(Lt,null))),(!st||Xe[0]&32&&Ot!==(Ot=Te[5]==0))&&(Lt.disabled=Ot);const vr={};!yn&&Xe[0]&8&&(yn=!0,vr.show=Te[3],Oe(()=>yn=!1)),Et.$set(vr)},i(Te){st||(v(dt),v(Et.$$.fragment,Te),st=!0)},o(Te){C(dt),C(Et.$$.fragment,Te),st=!1},d(Te){Te&&y(e),bt&&bt.d(),dt&&dt.d(),Dt.d(),Mt.d(),P(Et),Bt=!1,ct(zn)}}}function Mg(r){let e;return{c(){e=h("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Tg(r){let e;return{c(){e=h("p"),e.textContent="Click to change direction"},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Ag(r){let e,t,n,o;return{c(){e=h("div"),t=h("img"),o=z(`
                Click to add modal filter`),Ke(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||T(t,"src",n),T(t,"width","20"),T(t,"alt","Add modal filter")},m(l,i){w(l,e,i),m(e,t),m(e,o)},p(l,i){i[0]&512&&!Ke(t.src,n=`/ltn//filters/${l[9]}_icon.gif`)&&T(t,"src",n)},d(l){l&&y(e)}}}function Fg(r){let e,t=r[45].shortcuts+"",n,o,l=(r[45].name??"unnamed road")+"",i,s,a=Math.round(r[45].speed_mph)+"",u,f,c,_;function d($,L){if($[0].kind=="filter")return Ag;if($[0].kind=="oneway")return Tg;if($[0].kind=="turn_restriction")return Mg}let p=d(r),g=p&&p(r);return{c(){e=h("p"),n=z(t),o=z(" shortcuts through "),i=z(l),s=z(`
              (`),u=z(a),f=z(" mph)"),c=M(),g&&g.c(),_=Qe()},m($,L){w($,e,L),m(e,n),m(e,o),m(e,i),m(e,s),m(e,u),m(e,f),w($,c,L),g&&g.m($,L),w($,_,L)},p($,L){L[1]&16384&&t!==(t=$[45].shortcuts+"")&&oe(n,t),L[1]&16384&&l!==(l=($[45].name??"unnamed road")+"")&&oe(i,l),L[1]&16384&&a!==(a=Math.round($[45].speed_mph)+"")&&oe(u,a),p===(p=d($))&&g?g.p($,L):(g&&g.d(1),g=p&&p($),g&&(g.c(),g.m(_.parentNode,_)))},d($){$&&(y(e),y(c),y(_)),g&&g.d($)}}}function Pg(r){let e,t,n;return t=new _t({props:{openOn:"hover",$$slots:{default:[Fg,({props:o})=>({45:o}),({props:o})=>[0,o?16384:0]]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","line-popup")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l[0]&513|l[1]&49152&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function jg(r){let e,t,n,o,l,i,s,a,u,f;return e=new Kr({}),n=new Zr({}),l=new Xr({}),s=new mr({props:{interactive:r[0].kind=="filter"||r[0].kind=="oneway"||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[16],$$slots:{"line-popup":[Pg]},$$scope:{ctx:r}}}),u=new og({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[21]}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),A(s.$$.fragment),a=M(),A(u.$$.fragment)},m(c,_){F(e,c,_),w(c,t,_),F(n,c,_),w(c,o,_),F(l,c,_),w(c,i,_),F(s,c,_),w(c,a,_),F(u,c,_),f=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0].kind=="filter"||c[0].kind=="oneway"||c[0].kind=="turn_restriction"&&c[0].from_road_id==null),_[0]&513|_[1]&32768&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const p={};_[0]&1&&(p.interactive=c[0].kind=="filter"),_[0]&2&&(p.neighbourhood=c[1]),u.$set(p)},i(c){f||(v(e.$$.fragment,c),v(n.$$.fragment,c),v(l.$$.fragment,c),v(s.$$.fragment,c),v(u.$$.fragment,c),f=!0)},o(c){C(e.$$.fragment,c),C(n.$$.fragment,c),C(l.$$.fragment,c),C(s.$$.fragment,c),C(u.$$.fragment,c),f=!1},d(c){c&&(y(t),y(o),y(i),y(a)),P(e,c),P(n,c),P(l,c),P(s,c),P(u,c)}}}function Mi(r){let e,t;return e=new qm({props:{paths:r[7]}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&128&&(l.paths=n[7]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Ig(r){let e;return{c(){e=z("Click to delete")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Ng(r){let e,t,n;return t=new _t({props:{openOn:"hover",$$slots:{default:[Ig]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","modal-filter")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l[1]&32768&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function Eg(r){let e;return{c(){e=z("Click to delete")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Rg(r){let e,t,n;return t=new _t({props:{openOn:"hover",$$slots:{default:[Eg]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","turn-restriction")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l[1]&32768&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function Ti(r){let e,t;return e=new dg({props:{map:gt(r[2])}}),e.$on("done",r[25]),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&4&&(l.map=gt(n[2])),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Ai(r){let e,t;return e=new Ve({props:{data:r[0].possible_targets||Ft(),generateId:!0,$$slots:{default:[Bg]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&1&&(l.data=n[0].possible_targets||Ft()),o[0]&1|o[1]&32768&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function zg(r){let e,t,n,o,l=r[0].from_road_name+"",i,s,a=(r[45].name||"unnamed road")+"",u;return{c(){e=h("div"),t=h("img"),o=z(`

              Create a turn restriction from `),i=z(l),s=z(" to "),u=z(a),Ke(t.src,n=`/ltn//filters/no_${r[45].kind}_turn.png`)||T(t,"src",n),T(t,"width","20"),T(t,"alt","Add turn restriction")},m(f,c){w(f,e,c),m(e,t),m(e,o),m(e,i),m(e,s),m(e,u)},p(f,c){c[1]&16384&&!Ke(t.src,n=`/ltn//filters/no_${f[45].kind}_turn.png`)&&T(t,"src",n),c[0]&1&&l!==(l=f[0].from_road_name+"")&&oe(i,l),c[1]&16384&&a!==(a=(f[45].name||"unnamed road")+"")&&oe(u,a)},d(f){f&&y(e)}}}function Og(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[zg,({props:n})=>({45:n}),({props:n})=>[0,n?16384:0]]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&1|o[1]&49152&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Bg(r){let e,t;const n=[ve("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":rt(.5,1),"line-width":ln(1)}}];let o={$$slots:{default:[Og]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),e.$on("click",r[18]),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};i[0]&1|i[1]&32768&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Dg(r){let e,t,n,o,l,i,s,a,u,f;t=new Oo({}),t.$on("click",r[17]),o=new gr({props:{input:r[1],$$slots:{default:[jg]},$$scope:{ctx:r}}});let c=r[11]&&Mi(r);s=new wn({props:{onClickModalFilter:r[19],onClickTurnRestriction:r[20],$$slots:{"turn-restriction":[Rg],"modal-filter":[Ng]},$$scope:{ctx:r}}});let _=r[0].kind=="freehand-filters"&&Ti(r),d=r[0].kind=="turn_restriction"&&Ai(r);return{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),l=M(),c&&c.c(),i=M(),A(s.$$.fragment),a=M(),_&&_.c(),u=M(),d&&d.c(),T(e,"slot","map")},m(p,g){w(p,e,g),F(t,e,null),m(e,n),F(o,e,null),m(e,l),c&&c.m(e,null),m(e,i),F(s,e,null),m(e,a),_&&_.m(e,null),m(e,u),d&&d.m(e,null),f=!0},p(p,g){const $={};g[0]&2&&($.input=p[1]),g[0]&515|g[1]&32768&&($.$$scope={dirty:g,ctx:p}),o.$set($),p[11]?c?(c.p(p,g),g[0]&2048&&v(c,1)):(c=Mi(p),c.c(),v(c,1),c.m(e,i)):c&&($e(),C(c,1,1,()=>{c=null}),ke());const L={};g[1]&32768&&(L.$$scope={dirty:g,ctx:p}),s.$set(L),p[0].kind=="freehand-filters"?_?(_.p(p,g),g[0]&1&&v(_,1)):(_=Ti(p),_.c(),v(_,1),_.m(e,u)):_&&($e(),C(_,1,1,()=>{_=null}),ke()),p[0].kind=="turn_restriction"?d?(d.p(p,g),g[0]&1&&v(d,1)):(d=Ai(p),d.c(),v(d,1),d.m(e,null)):d&&($e(),C(d,1,1,()=>{d=null}),ke())},i(p){f||(v(t.$$.fragment,p),v(o.$$.fragment,p),v(c),v(s.$$.fragment,p),v(_),v(d),f=!0)},o(p){C(t.$$.fragment,p),C(o.$$.fragment,p),C(c),C(s.$$.fragment,p),C(_),C(d),f=!1},d(p){p&&y(e),P(t),P(o),c&&c.d(),P(s),_&&_.d(),d&&d.d()}}}function Ug(r){let e,t,n,o;return e=new Nt({props:{$$slots:{map:[Dg],sidebar:[Lg],top:[vg]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0,n||(o=ne(window,"keydown",r[22]),n=!0)},p(l,i){const s={};i[0]&16383|i[1]&32768&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l),n=!1,o()}}}function Hg(r,e,t){let n,o,l,i,s,a,u,f,c;ee(r,St,V=>t(26,o=V)),ee(r,fo,V=>t(9,l=V)),ee(r,ot,V=>t(43,i=V)),ee(r,rn,V=>t(2,s=V)),ee(r,er,V=>t(10,a=V)),ee(r,qo,V=>t(11,u=V)),ee(r,Rr,V=>t(12,f=V)),ee(r,_e,V=>t(13,c=V));function _(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Ft()}}let d={kind:"filter"},p=!1,g=0,$=0,L,k,b=i.getAllShortcuts();jt(()=>{s.doubleClickZoom.enable()});function S(V){t(1,k=i.renderNeighbourhood()),t(6,L=k.features.find(Q=>Q.properties.kind=="boundary")),t(4,g=k.undo_length),t(5,$=k.redo_length),t(7,b=i.getAllShortcuts()),Fn()}function N(){i.setCurrentNeighbourhood(L.properties.name,a),le(St,o++,o)}function j(V,Q){d.kind=="filter"?(i.addModalFilter(Q,l),le(St,o++,o)):d.kind=="oneway"?(i.toggleTravelFlow(V.properties.road),le(St,o++,o)):d.kind=="turn_restriction"&&(t(0,d.from_road_id=V.properties.road,d),t(0,d.from_road_name=V.properties.name||"unnamed road",d),t(0,d.possible_targets=i.getTurnRestrictionTargets(V.properties.road),d))}function I(V){d.kind=="turn_restriction"&&(s.queryRenderedFeatures(V.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,d=_()))}function R(V){if(d.kind=="turn_restriction"&&d.from_road_id!=null){let Q=V.detail.features[0].properties.road;i.addTurnRestriction(d.from_road_id,Q),le(St,o++,o)}t(0,d=_())}function D(V){let Q=V.detail.features[0];i.deleteModalFilter(Q.properties.road),le(St,o++,o)}function B(V){let Q=V.detail.features[0];i.deleteTurnRestriction(Q.properties.intersection,Q.properties.from_road,Q.properties.to_road),le(St,o++,o)}function E(V){if(d.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${d.kind}`);return}V.hasRotatedFilter?(i.deleteDiagonalFilter(V),le(St,o++,o)):V.filter?(i.rotateDiagonalFilter(V),le(St,o++,o)):(i.addDiagonalFilter(V),le(St,o++,o))}function O(V){V.target.tagName!="INPUT"&&(V.ctrlKey&&V.key=="z"&&H(),V.ctrlKey&&V.key=="y"&&W(),V.key=="1"&&t(0,d={kind:"filter"}),V.key=="2"&&t(0,d={kind:"freehand-filters"}),V.key=="3"&&t(0,d={kind:"oneway"}),V.key=="4"&&t(0,d=_()))}function H(){i.undo(),le(St,o++,o)}function W(){i.redo(),le(St,o++,o)}function Z(V){let Q=V.detail;Q&&(i.addManyModalFilters(Q,l),le(St,o++,o)),t(0,d={kind:"filter"})}const re=()=>t(0,d={kind:"filter"}),ce=()=>t(0,d={kind:"freehand-filters"}),U=()=>t(0,d={kind:"oneway"}),be=()=>t(0,d=_()),fe=()=>t(3,p=!0);function te(){u=this.checked,qo.set(u)}function me(){a=this.checked,er.set(a)}function ue(){f=_n(this),Rr.set(f)}function Fe(V){p=V,t(3,p)}const et=()=>le(_e,c={mode:"title",firstLoad:!1},c),ye=()=>le(_e,c={mode:"pick-neighbourhood"},c),we=()=>le(_e,c={mode:"view-shortcuts"},c),lt=()=>le(_e,c={mode:"route",prevMode:"neighbourhood"},c),Ge=()=>le(_e,c={mode:"impact-one-destination"},c),Ce=()=>le(_e,c={mode:"set-boundary",name:gt(L).properties.name,existing:L},c),K=()=>le(_e,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(d.kind=="oneway"?s.doubleClickZoom.disable():s.doubleClickZoom.enable()),r.$$.dirty[0]&67108864&&S(),r.$$.dirty[0]&2&&t(8,n=k.features.filter(V=>V.properties.kind=="cell"&&V.properties.cell_color=="disconnected").length)},[d,k,s,p,g,$,L,b,n,l,a,u,f,c,_,N,j,I,R,D,B,E,O,H,W,Z,o,re,ce,U,be,fe,te,me,ue,Fe,et,ye,we,lt,Ge,Ce,K]}class Gg extends se{constructor(e){super(),ae(this,e,Hg,Ug,ie,{},null,[-1,-1])}}function Wg(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function qg(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Jg(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new Ae({props:{$$slots:{default:[Wg]},$$scope:{ctx:r}}}),l.$on("click",r[7]),a=new Ae({props:{$$slots:{default:[qg]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),f.textContent="Predict impact",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(_,d){w(_,e,d),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),c=!0},p(_,d){const p={};d&1024&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(l.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&y(e),P(l),P(a)}}}function Yg(r){let e;return{c(){e=z("Pick a different road")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Zg(r){let e,t,n,o,l,i,s,a;t=new Ae({props:{$$slots:{default:[Yg]},$$scope:{ctx:r}}}),t.$on("click",r[5]);function u(c){r[6](c)}let f={list:r[2]};return r[0]!==void 0&&(f.idx=r[0]),o=new Yr({props:f}),Le.push(()=>ze(o,"idx",u)),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),i=M(),s=h("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,T(e,"slot","sidebar")},m(c,_){w(c,e,_),F(t,e,null),m(e,n),F(o,e,null),m(e,i),m(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),t.$set(d);const p={};!l&&_&1&&(l=!0,p.idx=c[0],Oe(()=>l=!1)),o.$set(p)},i(c){a||(v(t.$$.fragment,c),v(o.$$.fragment,c),a=!0)},o(c){C(t.$$.fragment,c),C(o.$$.fragment,c),a=!1},d(c){c&&y(e),P(t),P(o)}}}function Kg(r){let e,t;const n=[ve("predict-impact"),{paint:{"line-width":Yt(["get","kind"],{focus:8},5),"line-color":Yt(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Yt(["get","kind"],{focus:1},.5)}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function Xg(r){let e;return{c(){e=z("A")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Vg(r){let e;return{c(){e=z("B")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Qg(r){let e,t,n,o,l,i,s,a,u;return t=new Ve({props:{data:r[3](r[0]),$$slots:{default:[Kg]},$$scope:{ctx:r}}}),o=new Sn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[Xg]},$$scope:{ctx:r}}}),i=new Sn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[Vg]},$$scope:{ctx:r}}}),a=new wn({}),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),l=M(),A(i.$$.fragment),s=M(),A(a.$$.fragment),T(e,"slot","map")},m(f,c){w(f,e,c),F(t,e,null),m(e,n),F(o,e,null),m(e,l),F(i,e,null),m(e,s),F(a,e,null),u=!0},p(f,c){const _={};c&1&&(_.data=f[3](f[0])),c&1024&&(_.$$scope={dirty:c,ctx:f}),t.$set(_);const d={};c&1&&(d.lngLat=f[2][f[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:f}),o.$set(d);const p={};c&1&&(p.lngLat=f[2][f[0]][0].geometry.coordinates[f[2][f[0]][0].geometry.coordinates.length-1]),c&1024&&(p.$$scope={dirty:c,ctx:f}),i.$set(p)},i(f){u||(v(t.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),v(a.$$.fragment,f),u=!0)},o(f){C(t.$$.fragment,f),C(o.$$.fragment,f),C(i.$$.fragment,f),C(a.$$.fragment,f),u=!1},d(f){f&&y(e),P(t),P(o),P(i),P(a)}}}function xg(r){let e,t;return e=new Nt({props:{$$slots:{map:[Qg],sidebar:[Zg],top:[Jg]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function e1(r,e,t){let n,o;ee(r,ot,d=>t(9,n=d)),ee(r,_e,d=>t(1,o=d));let{road:l}=e;l.properties.kind="focus";let i=n.getImpactsOnRoad(l.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],l]}}const u=()=>le(_e,o={mode:"predict-impact"},o);function f(d){s=d,t(0,s)}const c=()=>le(_e,o={mode:"title",firstLoad:!1},o),_=()=>le(_e,o={mode:"pick-neighbourhood"},o);return r.$$set=d=>{"road"in d&&t(4,l=d.road)},[s,o,i,a,l,u,f,c,_]}class t1 extends se{constructor(e){super(),ae(this,e,e1,xg,ie,{road:4})}}function n1(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function r1(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function o1(r){let e;return{c(){e=z("Editing")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function l1(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;return l=new Ae({props:{$$slots:{default:[n1]},$$scope:{ctx:r}}}),l.$on("click",r[12]),a=new Ae({props:{$$slots:{default:[r1]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Ae({props:{$$slots:{default:[o1]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),A(c.$$.fragment),_=M(),d=h("li"),d.textContent="Impact routing to one destination",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(g,$){w(g,e,$),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),F(c,f,null),m(n,_),m(n,d),p=!0},p(g,$){const L={};$&262144&&(L.$$scope={dirty:$,ctx:g}),l.$set(L);const k={};$&262144&&(k.$$scope={dirty:$,ctx:g}),a.$set(k);const b={};$&262144&&(b.$$scope={dirty:$,ctx:g}),c.$set(b)},i(g){p||(v(l.$$.fragment,g),v(a.$$.fragment,g),v(c.$$.fragment,g),p=!0)},o(g){C(l.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),p=!1},d(g){g&&y(e),P(l),P(a),P(c)}}}function i1(r){let e,t,n,o,l,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",u,f;return t=new bn({}),t.$on("click",r[5]),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("p"),o.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,l=M(),i=h("p"),s=z("Highest ratio is "),u=z(a),T(e,"slot","sidebar")},m(c,_){w(c,e,_),F(t,e,null),m(e,n),m(e,o),m(e,l),m(e,i),m(i,s),m(i,u),f=!0},p(c,_){(!f||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&oe(u,a)},i(c){f||(v(t.$$.fragment,c),f=!0)},o(c){C(t.$$.fragment,c),f=!1},d(c){c&&y(e),P(t)}}}function s1(r){let e,t;const n=[ve("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new It({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function a1(r){let e,t=mn(r[17].distance_before)+"",n,o,l=gn(r[17].time_before)+"",i,s,a,u,f=mn(r[17].distance_after)+"",c,_,d=gn(r[17].time_after)+"",p,g,$,L,k,b=(r[17].time_after/r[17].time_before).toFixed(1)+"",S;return{c(){e=h("p"),n=z(t),o=z(", "),i=z(l),s=z(" before"),a=M(),u=h("p"),c=z(f),_=z(", "),p=z(d),g=z(" after"),$=M(),L=h("p"),k=z("Time ratio: "),S=z(b)},m(N,j){w(N,e,j),m(e,n),m(e,o),m(e,i),m(e,s),w(N,a,j),w(N,u,j),m(u,c),m(u,_),m(u,p),m(u,g),w(N,$,j),w(N,L,j),m(L,k),m(L,S)},p(N,j){j&131072&&t!==(t=mn(N[17].distance_before)+"")&&oe(n,t),j&131072&&l!==(l=gn(N[17].time_before)+"")&&oe(i,l),j&131072&&f!==(f=mn(N[17].distance_after)+"")&&oe(c,f),j&131072&&d!==(d=gn(N[17].time_after)+"")&&oe(p,d),j&131072&&b!==(b=(N[17].time_after/N[17].time_before).toFixed(1)+"")&&oe(S,b)},d(N){N&&(y(e),y(a),y(u),y($),y(L))}}}function u1(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[a1,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&393216&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function f1(r){let e,t,n;const o=[ve("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function l(s){r[9](s)}let i={$$slots:{default:[u1]},$$scope:{ctx:r}};for(let s=0;s<o.length;s+=1)i=de(i,o[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new tt({props:i}),Le.push(()=>ze(e,"hovered",l)),e.$on("click",r[10]),{c(){A(e.$$.fragment)},m(s,a){F(e,s,a),n=!0},p(s,a){const u=a&8?He(o,[o[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},o[2]]):{};a&262144&&(u.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,u.hovered=s[0],Oe(()=>t=!1)),e.$set(u)},i(s){n||(v(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){P(e,s)}}}function c1(r){let e,t;const n=[ve("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Yt(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function d1(r){let e;return{c(){e=z("X")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function _1(r){let e,t,n,o,l,i,s,a,u,f,c,_;t=new gr({props:{$$slots:{default:[s1]},$$scope:{ctx:r}}}),o=new Ve({props:{data:r[3],generateId:!0,$$slots:{default:[f1]},$$scope:{ctx:r}}}),i=new Ve({props:{data:r[2],$$slots:{default:[c1]},$$scope:{ctx:r}}}),a=new wn({});function d(g){r[11](g)}let p={draggable:!0,$$slots:{default:[d1]},$$scope:{ctx:r}};return r[1]!==void 0&&(p.lngLat=r[1]),f=new Sn({props:p}),Le.push(()=>ze(f,"lngLat",d)),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),l=M(),A(i.$$.fragment),s=M(),A(a.$$.fragment),u=M(),A(f.$$.fragment),T(e,"slot","map")},m(g,$){w(g,e,$),F(t,e,null),m(e,n),F(o,e,null),m(e,l),F(i,e,null),m(e,s),F(a,e,null),m(e,u),F(f,e,null),_=!0},p(g,$){const L={};$&262144&&(L.$$scope={dirty:$,ctx:g}),t.$set(L);const k={};$&8&&(k.data=g[3]),$&262153&&(k.$$scope={dirty:$,ctx:g}),o.$set(k);const b={};$&4&&(b.data=g[2]),$&262144&&(b.$$scope={dirty:$,ctx:g}),i.$set(b);const S={};$&262144&&(S.$$scope={dirty:$,ctx:g}),!c&&$&2&&(c=!0,S.lngLat=g[1],Oe(()=>c=!1)),f.$set(S)},i(g){_||(v(t.$$.fragment,g),v(o.$$.fragment,g),v(i.$$.fragment,g),v(a.$$.fragment,g),v(f.$$.fragment,g),_=!0)},o(g){C(t.$$.fragment,g),C(o.$$.fragment,g),C(i.$$.fragment,g),C(a.$$.fragment,g),C(f.$$.fragment,g),_=!1},d(g){g&&y(e),P(t),P(o),P(i),P(a),P(f)}}}function p1(r){let e,t,n,o;return e=new Oo({}),e.$on("contextmenu",r[7]),n=new Nt({props:{$$slots:{map:[_1],sidebar:[i1],top:[l1]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(l,i){F(e,l,i),w(l,t,i),F(n,l,i),o=!0},p(l,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:l}),n.$set(s)},i(l){o||(v(e.$$.fragment,l),v(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&y(t),P(e,l),P(n,l)}}}function m1(r,e,t){let n,o,l,i,s,a,u;ee(r,Tr,S=>t(1,l=S)),ee(r,_e,S=>t(4,i=S)),ee(r,tr,S=>t(14,s=S)),ee(r,nr,S=>t(15,a=S)),ee(r,ot,S=>t(8,u=S));function f(){le(_e,i={mode:"neighbourhood"},i)}let c=null;function _(S){return S?u.compareRoute(new co.LngLat(S.properties.pt1_x,S.properties.pt1_y),l,1):Ft()}function d(S){le(nr,a=new co.LngLat(S.properties.pt1_x,S.properties.pt1_y),a),le(tr,s=l,s),le(_e,i={mode:"route",prevMode:"impact-one-destination"},i)}function p(S){le(Tr,l=S.detail.lngLat,l)}function g(S){c=S,t(0,c)}const $=S=>d(S.detail.features[0]);function L(S){l=S,Tr.set(l)}const k=()=>le(_e,i={mode:"title",firstLoad:!1},i),b=()=>le(_e,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&t(3,n=u.impactToOneDestination(l)),r.$$.dirty&1&&t(2,o=_(c))},[c,l,o,n,i,f,d,p,u,g,$,L,k,b]}class g1 extends se{constructor(e){super(),ae(this,e,m1,p1,ie,{})}}function Fi(r,e,t){const n=r.slice();return n[32]=e[t].properties.name,n}function h1(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function b1(r){let e;return{c(){e=h("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function w1(r){let e;return{c(){e=z("Route")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function y1(r){let e;return{c(){e=z("Predict impact")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function v1(r){let e;return{c(){e=z("Debug intersections")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function $1(r){let e;return{c(){e=z("Debug demand")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function k1(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L,k,b,S,N,j,I,R;return l=new Ae({props:{$$slots:{default:[h1]},$$scope:{ctx:r}}}),l.$on("click",r[25]),u=new Jr({props:{$$slots:{default:[b1]},$$scope:{ctx:r}}}),p=new Ae({props:{$$slots:{default:[w1]},$$scope:{ctx:r}}}),p.$on("click",r[26]),L=new Ae({props:{$$slots:{default:[y1]},$$scope:{ctx:r}}}),L.$on("click",r[27]),S=new Ae({props:{$$slots:{default:[v1]},$$scope:{ctx:r}}}),S.$on("click",r[28]),I=new Ae({props:{$$slots:{default:[$1]},$$scope:{ctx:r}}}),I.$on("click",r[29]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),a=z(`Pick neighbourhood
          `),A(u.$$.fragment),f=M(),c=h("nav"),_=h("ul"),d=h("li"),A(p.$$.fragment),g=M(),$=h("li"),A(L.$$.fragment),k=M(),b=h("li"),A(S.$$.fragment),N=M(),j=h("li"),A(I.$$.fragment),T(t,"aria-label","breadcrumb"),T(e,"slot","top"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(D,B){w(D,e,B),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),m(s,a),F(u,s,null),m(e,f),m(e,c),m(c,_),m(_,d),F(p,d,null),m(_,g),m(_,$),F(L,$,null),m(_,k),m(_,b),F(S,b,null),m(_,N),m(_,j),F(I,j,null),R=!0},p(D,B){const E={};B[1]&16&&(E.$$scope={dirty:B,ctx:D}),l.$set(E);const O={};B[1]&16&&(O.$$scope={dirty:B,ctx:D}),u.$set(O);const H={};B[1]&16&&(H.$$scope={dirty:B,ctx:D}),p.$set(H);const W={};B[1]&16&&(W.$$scope={dirty:B,ctx:D}),L.$set(W);const Z={};B[1]&16&&(Z.$$scope={dirty:B,ctx:D}),S.$set(Z);const re={};B[1]&16&&(re.$$scope={dirty:B,ctx:D}),I.$set(re)},i(D){R||(v(l.$$.fragment,D),v(u.$$.fragment,D),v(p.$$.fragment,D),v(L.$$.fragment,D),v(S.$$.fragment,D),v(I.$$.fragment,D),R=!0)},o(D){C(l.$$.fragment,D),C(u.$$.fragment,D),C(p.$$.fragment,D),C(L.$$.fragment,D),C(S.$$.fragment,D),C(I.$$.fragment,D),R=!1},d(D){D&&y(e),P(l),P(u),P(p),P(L),P(S),P(I)}}}function C1(r){let e=r[32]+"",t;return{c(){t=z(e)},m(n,o){w(n,t,o)},p(n,o){o[0]&1&&e!==(e=n[32]+"")&&oe(t,e)},d(n){n&&y(t)}}}function Pi(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;function g(){return r[18](r[32])}o=new Ae({props:{$$slots:{default:[C1]},$$scope:{ctx:r}}}),o.$on("click",g),a=new zo({props:{color:"black"}});function $(){return r[19](r[32])}c=new Ns({props:{color:"white"}});function L(){return r[20](r[32])}function k(){return r[21](r[32])}return{c(){var b;e=h("li"),t=h("span"),n=h("span"),A(o.$$.fragment),l=M(),i=h("span"),s=h("button"),A(a.$$.fragment),u=M(),f=h("button"),A(c.$$.fragment),T(n,"class","neighbourhood-name svelte-v2avug"),T(s,"class","outline icon-btn"),T(s,"aria-label","Rename neighbourhood"),T(f,"class","icon-btn destructive"),T(f,"aria-label","Delete neighbourhood"),X(i,"display","flex"),X(i,"gap","16px"),X(t,"display","flex"),X(t,"justify-content","space-between"),T(e,"class","svelte-v2avug"),Ue(e,"highlighted",((b=r[3])==null?void 0:b.properties.name)==r[32])},m(b,S){w(b,e,S),m(e,t),m(t,n),F(o,n,null),m(t,l),m(t,i),m(i,s),F(a,s,null),m(i,u),m(i,f),F(c,f,null),_=!0,d||(p=[ne(s,"click",$),ne(f,"click",L),ne(e,"mouseenter",k),ne(e,"mouseleave",r[22])],d=!0)},p(b,S){var j;r=b;const N={};S[0]&1|S[1]&16&&(N.$$scope={dirty:S,ctx:r}),o.$set(N),(!_||S[0]&9)&&Ue(e,"highlighted",((j=r[3])==null?void 0:j.properties.name)==r[32])},i(b){_||(v(o.$$.fragment,b),v(a.$$.fragment,b),v(c.$$.fragment,b),_=!0)},o(b){C(o.$$.fragment,b),C(a.$$.fragment,b),C(c.$$.fragment,b),_=!1},d(b){b&&y(e),P(o),P(a),P(c),d=!1,ct(p)}}}function S1(r){let e,t,n;return e=new zo({}),{c(){A(e.$$.fragment),t=z(`
              Draw a new boundary`)},m(o,l){F(e,o,l),w(o,t,l),n=!0},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){o&&y(t),P(e,o)}}}function L1(r){let e,t,n;return e=new ff({}),{c(){A(e.$$.fragment),t=z(`
              Use a generated boundary`)},m(o,l){F(e,o,l),w(o,t,l),n=!0},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){C(e.$$.fragment,o),n=!1},d(o){o&&y(t),P(e,o)}}}function ji(r){let e,t,n,o,l,i,s,a,u;function f(_){r[24](_)}let c={};return r[1]!==void 0&&(c.selectedPrioritization=r[1]),l=new Js({props:c}),Le.push(()=>ze(l,"selectedPrioritization",f)),{c(){e=h("h3"),e.textContent="Prioritization",t=M(),n=h("p"),n.textContent="Compare metrics across your neighbourhoods.",o=M(),A(l.$$.fragment),s=M(),a=h("hr")},m(_,d){w(_,e,d),w(_,t,d),w(_,n,d),w(_,o,d),F(l,_,d),w(_,s,d),w(_,a,d),u=!0},p(_,d){const p={};!i&&d[0]&2&&(i=!0,p.selectedPrioritization=_[1],Oe(()=>i=!1)),l.$set(p)},i(_){u||(v(l.$$.fragment,_),u=!0)},o(_){C(l.$$.fragment,_),u=!1},d(_){_&&(y(e),y(t),y(n),y(o),y(s),y(a)),P(l,_)}}}function M1(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g=r[5].startsWith("ltn_cnt/"),$,L,k,b,S,N,j=r[4].modalFilters+"",I,R,D,B,E=r[4].deletedModalFilters+"",O,H,W,Z,re=r[4].travelFlows+"",ce,U,be,fe,te,me,ue,Fe,et,ye=Se(r[0].features),we=[];for(let Ce=0;Ce<ye.length;Ce+=1)we[Ce]=Pi(Fi(r,ye,Ce));const lt=Ce=>C(we[Ce],1,1,()=>{we[Ce]=null});f=new Ae({props:{$$slots:{default:[S1]},$$scope:{ctx:r}}}),f.$on("click",r[10]),d=new Ae({props:{$$slots:{default:[L1]},$$scope:{ctx:r}}}),d.$on("click",r[23]);let Ge=g&&ji(r);return{c(){e=h("div"),t=h("h3"),t.textContent="Neighbourhoods",n=M(),o=h("ul");for(let Ce=0;Ce<we.length;Ce+=1)we[Ce].c();l=M(),i=h("li"),s=z(`Add a new neighbourhood:
        `),a=h("ul"),u=h("li"),A(f.$$.fragment),c=M(),_=h("li"),A(d.$$.fragment),p=M(),Ge&&Ge.c(),$=M(),L=h("p"),k=z("Current project: "),b=z(r[5]),S=M(),N=h("p"),I=z(j),R=z(" new modal filter(s) added"),D=M(),B=h("p"),O=z(E),H=z(`
      existing modal filter(s) removed`),W=M(),Z=h("p"),ce=z(re),U=z(" road segment direction(s) changed"),be=M(),fe=h("button"),fe.textContent="Export project to GeoJSON",te=M(),me=h("button"),me.textContent="Debug route-snapper",X(t,"padding","4px 8px"),X(t,"margin-bottom","0"),X(u,"list-style","none"),X(_,"list-style","none"),X(a,"margin-bottom","0"),X(a,"padding","0"),T(i,"class","svelte-v2avug"),T(o,"class","neighbourhood-list svelte-v2avug"),T(me,"class","secondary"),T(e,"slot","sidebar")},m(Ce,K){w(Ce,e,K),m(e,t),m(e,n),m(e,o);for(let V=0;V<we.length;V+=1)we[V]&&we[V].m(o,null);m(o,l),m(o,i),m(i,s),m(i,a),m(a,u),F(f,u,null),m(a,c),m(a,_),F(d,_,null),m(e,p),Ge&&Ge.m(e,null),m(e,$),m(e,L),m(L,k),m(L,b),m(e,S),m(e,N),m(N,I),m(N,R),m(e,D),m(e,B),m(B,O),m(B,H),m(e,W),m(e,Z),m(Z,ce),m(Z,U),m(e,be),m(e,fe),m(e,te),m(e,me),ue=!0,Fe||(et=[ne(fe,"click",r[11]),ne(me,"click",r[12])],Fe=!0)},p(Ce,K){if(K[0]&909){ye=Se(Ce[0].features);let ge;for(ge=0;ge<ye.length;ge+=1){const he=Fi(Ce,ye,ge);we[ge]?(we[ge].p(he,K),v(we[ge],1)):(we[ge]=Pi(he),we[ge].c(),v(we[ge],1),we[ge].m(o,l))}for($e(),ge=ye.length;ge<we.length;ge+=1)lt(ge);ke()}const V={};K[1]&16&&(V.$$scope={dirty:K,ctx:Ce}),f.$set(V);const Q={};K[1]&16&&(Q.$$scope={dirty:K,ctx:Ce}),d.$set(Q),K[0]&32&&(g=Ce[5].startsWith("ltn_cnt/")),g?Ge?(Ge.p(Ce,K),K[0]&32&&v(Ge,1)):(Ge=ji(Ce),Ge.c(),v(Ge,1),Ge.m(e,$)):Ge&&($e(),C(Ge,1,1,()=>{Ge=null}),ke()),(!ue||K[0]&32)&&oe(b,Ce[5]),(!ue||K[0]&16)&&j!==(j=Ce[4].modalFilters+"")&&oe(I,j),(!ue||K[0]&16)&&E!==(E=Ce[4].deletedModalFilters+"")&&oe(O,E),(!ue||K[0]&16)&&re!==(re=Ce[4].travelFlows+"")&&oe(ce,re)},i(Ce){if(!ue){for(let K=0;K<ye.length;K+=1)v(we[K]);v(f.$$.fragment,Ce),v(d.$$.fragment,Ce),v(Ge),ue=!0}},o(Ce){we=we.filter(Boolean);for(let K=0;K<we.length;K+=1)C(we[K]);C(f.$$.fragment,Ce),C(d.$$.fragment,Ce),C(Ge),ue=!1},d(Ce){Ce&&y(e),ut(we,Ce),P(f),P(d),Ge&&Ge.d(),Fe=!1,ct(et)}}}function T1(r){let e,t,n=(r[31].number_stats19_collisions/r[31].area_km2).toFixed(1)+"",o,l;return{c(){e=h("b"),e.textContent="Pedestrian and cyclist collisions:",t=M(),o=z(n),l=z(" / km²")},m(i,s){w(i,e,s),w(i,t,s),w(i,o,s),w(i,l,s)},p(i,s){s[1]&1&&n!==(n=(i[31].number_stats19_collisions/i[31].area_km2).toFixed(1)+"")&&oe(o,n)},d(i){i&&(y(e),y(t),y(o),y(l))}}}function A1(r){let e,t,n=Math.round(r[31].population/r[31].area_km2).toLocaleString()+"",o,l;return{c(){e=h("b"),e.textContent="Population density:",t=M(),o=z(n),l=z(` people
            / km²`)},m(i,s){w(i,e,s),w(i,t,s),w(i,o,s),w(i,l,s)},p(i,s){s[1]&1&&n!==(n=Math.round(i[31].population/i[31].area_km2).toLocaleString()+"")&&oe(o,n)},d(i){i&&(y(e),y(t),y(o),y(l))}}}function F1(r){let e,t=r[31].name+"",n,o,l;function i(u,f){if(u[1]=="density")return A1;if(u[1]=="stats19")return T1}let s=i(r),a=s&&s(r);return{c(){e=h("h2"),n=z(t),o=M(),a&&a.c(),l=Qe()},m(u,f){w(u,e,f),m(e,n),w(u,o,f),a&&a.m(u,f),w(u,l,f)},p(u,f){f[1]&1&&t!==(t=u[31].name+"")&&oe(n,t),s===(s=i(u))&&a?a.p(u,f):(a&&a.d(1),a=s&&s(u),a&&(a.c(),a.m(l.parentNode,l)))},d(u){u&&(y(e),y(o),y(l)),a&&a.d(u)}}}function P1(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[F1,({props:n})=>({31:n}),({props:n})=>[0,n?1:0]]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&2|o[1]&17&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function j1(r){let e,t,n,o,l;e=new Rf({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const i=[ve("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function s(u){r[16](u)}let a={$$slots:{default:[P1]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)a=de(a,i[u]);return r[3]!==void 0&&(a.hovered=r[3]),n=new It({props:a}),Le.push(()=>ze(n,"hovered",s)),n.$on("click",r[17]),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),l=!0},p(u,f){const c={};f[0]&4&&(c.data=u[2]?[{name:u[2],highlight:"yes"}]:[]),e.$set(c);const _=f[0]&24578?He(i,[i[0],i[1],{paint:{"fill-color":u[13](u[1]),"fill-opacity":u[14](u[1])}},i[3],i[4]]):{};f[0]&2|f[1]&16&&(_.$$scope={dirty:f,ctx:u}),!o&&f[0]&8&&(o=!0,_.hovered=u[3],Oe(()=>o=!1)),n.$set(_)},i(u){l||(v(e.$$.fragment,u),v(n.$$.fragment,u),l=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),l=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function I1(r){let e,t,n,o,l;return t=new Ve({props:{data:r[0],promoteId:"name",$$slots:{default:[j1]},$$scope:{ctx:r}}}),o=new wn({}),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),T(e,"slot","map")},m(i,s){w(i,e,s),F(t,e,null),m(e,n),F(o,e,null),l=!0},p(i,s){const a={};s[0]&1&&(a.data=i[0]),s[0]&14|s[1]&16&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(v(t.$$.fragment,i),v(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&y(e),P(t),P(o)}}}function N1(r){let e,t;return e=new Nt({props:{$$slots:{map:[I1],sidebar:[M1],top:[k1]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o[0]&127|o[1]&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function E1(r){let e=0,t=0,n=0;for(let o of r.features)o.properties.kind=="modal_filter"?e++:o.properties.kind=="deleted_existing_modal_filter"?t++:o.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function R1(r,e,t){let n,o,l,i,s,a;ee(r,ot,U=>t(15,l=U)),ee(r,Vt,U=>t(5,i=U)),ee(r,_e,U=>t(6,s=U)),ee(r,er,U=>t(30,a=U));let u="none",f=null,c=null;function _(U){l.setCurrentNeighbourhood(U,a),le(_e,s={mode:"neighbourhood"},s)}function d(U){window.confirm(`Really delete neighbourhood ${U}? You can't undo this.`)&&(l.deleteNeighbourhoodBoundary(U),Fn(),t(0,n=l.getAllNeighbourhoods()))}function p(U){let be=Co(l,`Rename neighbourhood ${U} to what?`,U);be&&(l.renameNeighbourhoodBoundary(U,be),Fn(),t(0,n=l.getAllNeighbourhoods()))}function g(){let U=Co(l,"What do you want to name the neighbourhood?","");U&&le(_e,s={mode:"set-boundary",name:U,existing:null},s)}function $(){zr(i+".geojson",JSON.stringify(l.toSavefile()))}function L(){zr("debug_route_snapper.geojson",l.toRouteSnapperGj())}function k(U){let be={none:"black",area:kt(["get","area_km2"],Bs,Ds),density:kt(["/",["get","population"],["get","area_km2"]],pr,_r),simd:kt(["get","simd"],dr,cr),stats19:kt(["/",["get","number_stats19_collisions"],["get","area_km2"]],Bo,Do)}[U];return["case",["==",["feature-state","highlight"],"yes"],"yellow",be]}function b(U){return{none:rt(.3,.5),area:rt(.7,.9),density:rt(.7,.9),simd:rt(.7,.9),stats19:rt(.7,.9)}[U]}function S(U){c=U,t(3,c)}const N=U=>_(gt(U.detail.features[0].properties).name),j=U=>_(U),I=U=>p(U),R=U=>d(U),D=U=>t(2,f=U),B=()=>t(2,f=null),E=()=>le(_e,s={mode:"auto-boundaries"},s);function O(U){u=U,t(1,u)}const H=()=>le(_e,s={mode:"title",firstLoad:!1},s),W=()=>le(_e,s={mode:"route",prevMode:"pick-neighbourhood"},s),Z=()=>le(_e,s={mode:"predict-impact"},s),re=()=>le(_e,s={mode:"debug-intersections"},s),ce=()=>le(_e,s={mode:"debug-demand"},s);return r.$$.update=()=>{r.$$.dirty[0]&32768&&t(0,n=l.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,o=E1(n))},[n,u,f,c,o,i,s,_,d,p,g,$,L,k,b,l,S,N,j,I,R,D,B,E,O,H,W,Z,re,ce]}class z1 extends se{constructor(e){super(),ae(this,e,R1,N1,ie,{},null,[-1,-1])}}function O1(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function B1(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function D1(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new Ae({props:{$$slots:{default:[O1]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ae({props:{$$slots:{default:[B1]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),f.textContent="Predict impact",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(_,d){w(_,e,d),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),c=!0},p(_,d){const p={};d&1024&&(p.$$scope={dirty:d,ctx:_}),l.$set(p);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(l.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){C(l.$$.fragment,_),C(a.$$.fragment,_),c=!1},d(_){_&&y(e),P(l),P(a)}}}function U1(r){let e,t,n,o,l,i,s,a,u;return t=new bn({}),t.$on("click",r[5]),{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("p"),o.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,l=M(),i=h("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=M(),a=h("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,T(e,"slot","sidebar")},m(f,c){w(f,e,c),F(t,e,null),m(e,n),m(e,o),m(e,l),m(e,i),m(e,s),m(e,a),u=!0},p:Y,i(f){u||(v(t.$$.fragment,f),u=!0)},o(f){C(t.$$.fragment,f),u=!1},d(f){f&&y(e),P(t)}}}function H1(r){let e,t=r[9].before.toLocaleString()+"",n,o,l=r[9].after.toLocaleString()+"",i,s,a,u,f=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=h("p"),n=z(t),o=z(" before, "),i=z(l),s=z(`
            after`),a=M(),u=h("p"),c=z(f),_=z("%")},m(d,p){w(d,e,p),m(e,n),m(e,o),m(e,i),m(e,s),w(d,a,p),w(d,u,p),m(u,c),m(u,_)},p(d,p){p&512&&t!==(t=d[9].before.toLocaleString()+"")&&oe(n,t),p&512&&l!==(l=d[9].after.toLocaleString()+"")&&oe(i,l),p&512&&f!==(f=Math.round(100*d[9].after/d[9].before)+"")&&oe(c,f)},d(d){d&&(y(e),y(a),y(u))}}}function G1(r){let e,t;return e=new _t({props:{openOn:"hover",$$slots:{default:[H1,({props:n})=>({9:n}),({props:n})=>n?512:0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1536&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function W1(r){let e,t;const n=[ve("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ii,r[2].max_count,Ni],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[G1]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),e.$on("click",r[4]),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s=i&6?He(n,[n[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ii,l[2].max_count,Ni],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,l[1][0],50,l[1][1],100,l[1][2],150,l[1][3],200,l[1][4]]]}},n[2],n[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function q1(r){let e,t,n,o,l;return t=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[W1]},$$scope:{ctx:r}}}),o=new wn({}),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),T(e,"slot","map")},m(i,s){w(i,e,s),F(t,e,null),m(e,n),F(o,e,null),l=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(v(t.$$.fragment,i),v(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&y(e),P(t),P(o)}}}function J1(r){let e,t;return e=new Nt({props:{$$slots:{map:[q1],sidebar:[U1],top:[D1]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&1025&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}let Ii=3,Ni=10;function Y1(r,e,t){let n,o;ee(r,_e,_=>t(0,n=_)),ee(r,ot,_=>t(8,o=_));let l=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=o.predictImpact();function s(_){le(_e,n={mode:"impact-detail",road:_},n)}return[n,l,i,s,_=>s(_.detail.features[0]),()=>le(_e,n={mode:"pick-neighbourhood"},n),()=>le(_e,n={mode:"title",firstLoad:!1},n),()=>le(_e,n={mode:"pick-neighbourhood"},n)]}class Z1 extends se{constructor(e){super(),ae(this,e,Y1,J1,ie,{})}}function K1(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function X1(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Ei(r){let e,t,n;return t=new Ae({props:{$$slots:{default:[V1]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=h("li"),A(t.$$.fragment)},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function V1(r){let e;return{c(){e=z("Editing")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Q1(r){let e,t,n,o,l,i,s,a,u,f,c,_;l=new Ae({props:{$$slots:{default:[K1]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Ae({props:{$$slots:{default:[X1]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&Ei(r);return{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),d&&d.c(),f=M(),c=h("li"),c.textContent="Routing",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(p,g){w(p,e,g),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),d&&d.m(n,null),m(n,f),m(n,c),_=!0},p(p,g){const $={};g&16384&&($.$$scope={dirty:g,ctx:p}),l.$set($);const L={};g&16384&&(L.$$scope={dirty:g,ctx:p}),a.$set(L),p[0]=="neighbourhood"?d?(d.p(p,g),g&1&&v(d,1)):(d=Ei(p),d.c(),v(d,1),d.m(n,f)):d&&($e(),C(d,1,1,()=>{d=null}),ke())},i(p){_||(v(l.$$.fragment,p),v(a.$$.fragment,p),v(d),_=!0)},o(p){C(l.$$.fragment,p),C(a.$$.fragment,p),C(d),_=!1},d(p){p&&y(e),P(l),P(a),d&&d.d()}}}function Ri(r){let e,t,n,o=mn(r[4].features[0].properties.distance)+"",l,i,s=gn(r[4].features[0].properties.time)+"",a,u,f,c,_,d=mn(r[4].features[1].properties.distance)+"",p,g,$=gn(r[4].features[1].properties.time)+"",L;return{c(){e=h("p"),t=h("span"),t.textContent="Route before",n=z(`
        : `),l=z(o),i=z(", "),a=z(s),u=M(),f=h("p"),c=h("span"),c.textContent="Route after",_=z(`
        : `),p=z(d),g=z(", "),L=z($),X(t,"color","red"),X(c,"color","blue")},m(k,b){w(k,e,b),m(e,t),m(e,n),m(e,l),m(e,i),m(e,a),w(k,u,b),w(k,f,b),m(f,c),m(f,_),m(f,p),m(f,g),m(f,L)},p(k,b){b&16&&o!==(o=mn(k[4].features[0].properties.distance)+"")&&oe(l,o),b&16&&s!==(s=gn(k[4].features[0].properties.time)+"")&&oe(a,s),b&16&&d!==(d=mn(k[4].features[1].properties.distance)+"")&&oe(p,d),b&16&&$!==($=gn(k[4].features[1].properties.time)+"")&&oe(L,$)},d(k){k&&(y(e),y(u),y(f))}}}function x1(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$;t=new bn({}),t.$on("click",r[6]);let L=r[4].features.length==2&&Ri(r);return{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("p"),o.textContent="Drag markers for a route",l=M(),L&&L.c(),i=M(),s=h("label"),a=z("Slow-down factor for main roads: "),u=z(r[1]),f=M(),c=h("input"),_=M(),d=h("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,T(c,"type","range"),T(c,"min","1.0"),T(c,"max","5.0"),T(c,"step","0.1"),T(e,"slot","sidebar")},m(k,b){w(k,e,b),F(t,e,null),m(e,n),m(e,o),m(e,l),L&&L.m(e,null),m(e,i),m(e,s),m(s,a),m(s,u),m(s,f),m(s,c),We(c,r[1]),m(e,_),m(e,d),p=!0,g||($=[ne(c,"change",r[10]),ne(c,"input",r[10])],g=!0)},p(k,b){k[4].features.length==2?L?L.p(k,b):(L=Ri(k),L.c(),L.m(e,i)):L&&(L.d(1),L=null),(!p||b&2)&&oe(u,k[1]),b&2&&We(c,k[1])},i(k){p||(v(t.$$.fragment,k),p=!0)},o(k){C(t.$$.fragment,k),p=!1},d(k){k&&y(e),P(t),L&&L.d(),g=!1,ct($)}}}function zi(r){let e,t;return e=new gr({props:{$$slots:{default:[eh]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function eh(r){let e,t,n,o,l,i,s,a;return e=new Kr({}),n=new Zr({}),l=new Xr({}),s=new mr({props:{interactive:!1}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),A(s.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),w(u,o,f),F(l,u,f),w(u,i,f),F(s,u,f),a=!0},p:Y,i(u){a||(v(e.$$.fragment,u),v(n.$$.fragment,u),v(l.$$.fragment,u),v(s.$$.fragment,u),a=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),C(l.$$.fragment,u),C(s.$$.fragment,u),a=!1},d(u){u&&(y(t),y(o),y(i)),P(e,u),P(n,u),P(l,u),P(s,u)}}}function th(r){let e,t;const n=[ve("compare-route"),{paint:{"line-width":10,"line-color":Yt(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function nh(r){let e;return{c(){e=z("A")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function rh(r){let e;return{c(){e=z("B")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function oh(r){let e,t,n,o,l,i,s,a,u,f,c,_,d=r[0]=="neighbourhood"&&zi(r);n=new wn({}),l=new Ve({props:{data:r[4],$$slots:{default:[th]},$$scope:{ctx:r}}});function p(k){r[8](k)}let g={draggable:!0,$$slots:{default:[nh]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new Sn({props:g}),Le.push(()=>ze(s,"lngLat",p));function $(k){r[9](k)}let L={draggable:!0,$$slots:{default:[rh]},$$scope:{ctx:r}};return r[2]!==void 0&&(L.lngLat=r[2]),f=new Sn({props:L}),Le.push(()=>ze(f,"lngLat",$)),{c(){e=h("div"),d&&d.c(),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),A(s.$$.fragment),u=M(),A(f.$$.fragment),T(e,"slot","map")},m(k,b){w(k,e,b),d&&d.m(e,null),m(e,t),F(n,e,null),m(e,o),F(l,e,null),m(e,i),F(s,e,null),m(e,u),F(f,e,null),_=!0},p(k,b){k[0]=="neighbourhood"?d?b&1&&v(d,1):(d=zi(k),d.c(),v(d,1),d.m(e,t)):d&&($e(),C(d,1,1,()=>{d=null}),ke());const S={};b&16&&(S.data=k[4]),b&16384&&(S.$$scope={dirty:b,ctx:k}),l.$set(S);const N={};b&16384&&(N.$$scope={dirty:b,ctx:k}),!a&&b&8&&(a=!0,N.lngLat=k[3],Oe(()=>a=!1)),s.$set(N);const j={};b&16384&&(j.$$scope={dirty:b,ctx:k}),!c&&b&4&&(c=!0,j.lngLat=k[2],Oe(()=>c=!1)),f.$set(j)},i(k){_||(v(d),v(n.$$.fragment,k),v(l.$$.fragment,k),v(s.$$.fragment,k),v(f.$$.fragment,k),_=!0)},o(k){C(d),C(n.$$.fragment,k),C(l.$$.fragment,k),C(s.$$.fragment,k),C(f.$$.fragment,k),_=!1},d(k){k&&y(e),d&&d.d(),P(n),P(l),P(s),P(f)}}}function lh(r){let e,t;return e=new Nt({props:{$$slots:{map:[oh],sidebar:[x1],top:[Q1]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&16447&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function ih(r,e,t){let n,o,l,i,s,a;ee(r,_e,L=>t(5,o=L)),ee(r,Jo,L=>t(1,l=L)),ee(r,tr,L=>t(2,i=L)),ee(r,nr,L=>t(3,s=L)),ee(r,ot,L=>t(7,a=L));let{prevMode:u}=e;function f(){le(_e,o={mode:u},o)}function c(L){s=L,nr.set(s)}function _(L){i=L,tr.set(i)}function d(){l=kn(this.value),Jo.set(l)}const p=()=>le(_e,o={mode:"title",firstLoad:!1},o),g=()=>le(_e,o={mode:"pick-neighbourhood"},o),$=()=>le(_e,o={mode:"neighbourhood"},o);return r.$$set=L=>{"prevMode"in L&&t(0,u=L.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&t(4,n=a.compareRoute(s,i,l))},[u,l,i,s,n,o,f,a,c,_,d,p,g,$]}class sh extends se{constructor(e){super(),ae(this,e,ih,lh,ie,{prevMode:0})}}let jn=At(null);const Ut=At([]);function Ks(r){if(r.length<3)return JSON.parse(Zt(jn).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Zt(jn).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:ah}=_s,uh=r=>({}),Oi=r=>({}),fh=r=>({}),Bi=r=>({});function Di(r,e,t){const n=r.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function Ui(r,e,t){const n=r.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function ch(r){let e,t;const n=r[24]["extra-top"],o=Ie(n,r,r[38],Oi);return{c(){e=h("div"),o&&o.c(),T(e,"slot","top")},m(l,i){w(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i[1]&128)&&Ne(o,n,l,l[38],t?Re(n,l[38],i,uh):Ee(l[38]),Oi)},i(l){t||(v(o,l),t=!0)},o(l){C(o,l),t=!1},d(l){l&&y(e),o&&o.d(l)}}}function dh(r){let e,t,n,o,l;return{c(){e=h("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=M(),n=h("p"),n.textContent="Keyboard shortcuts:",o=M(),l=h("ul"),l.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){w(i,e,s),w(i,t,s),w(i,n,s),w(i,o,s),w(i,l,s)},p:Y,d(i){i&&(y(e),y(t),y(n),y(o),y(l))}}}function _h(r){let e,t=r[8].length+"",n,o;return{c(){e=z("Undo ("),n=z(t),o=z(")")},m(l,i){w(l,e,i),w(l,n,i),w(l,o,i)},p(l,i){i[0]&256&&t!==(t=l[8].length+"")&&oe(n,t)},d(l){l&&(y(e),y(n),y(o))}}}function ph(r){let e;return{c(){e=z("Undo")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function mh(r){let e;return{c(){e=h("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function gh(r){let e,t,n,o,l,i,s,a,u,f,c,_,d;return c=ps(r[36][0]),{c(){e=h("fieldset"),t=h("label"),n=h("input"),o=z(`
          Snap to roads`),l=M(),i=h("label"),s=h("input"),a=z(`
          Draw anywhere`),u=M(),f=h("p"),f.textContent="Click to add at least 3 points",T(n,"type","radio"),n.__value="snap",We(n,n.__value),T(s,"type","radio"),s.__value="free",We(s,s.__value),c.p(n,s)},m(p,g){w(p,e,g),m(e,t),m(t,n),n.checked=n.__value===r[7],m(t,o),m(e,l),m(e,i),m(i,s),s.checked=s.__value===r[7],m(i,a),w(p,u,g),w(p,f,g),_||(d=[ne(n,"change",r[35]),ne(s,"change",r[37])],_=!0)},p(p,g){g[0]&128&&(n.checked=n.__value===p[7]),g[0]&128&&(s.checked=s.__value===p[7])},d(p){p&&(y(e),y(u),y(f)),c.r(),_=!1,ct(d)}}}function hh(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p,g,$,L;const k=r[24]["extra-sidebar"],b=Ie(k,r,r[38],Bi);f=new Jr({props:{$$slots:{default:[dh]},$$scope:{ctx:r}}});function S(B,E){return B[8].length==0?ph:_h}let N=S(r),j=N(r);function I(B,E){return B[5].length<3?gh:mh}let R=I(r),D=R(r);return{c(){e=h("div"),b&&b.c(),t=M(),n=h("div"),o=h("button"),l=z("Finish"),s=M(),a=h("button"),a.textContent="Cancel",u=M(),A(f.$$.fragment),c=M(),_=h("button"),j.c(),p=M(),D.c(),o.disabled=i=r[5].length<3,T(a,"class","secondary"),X(n,"display","flex"),T(_,"class","secondary"),_.disabled=d=r[8].length==0,T(e,"slot","sidebar")},m(B,E){w(B,e,E),b&&b.m(e,null),m(e,t),m(e,n),m(n,o),m(o,l),m(n,s),m(n,a),m(n,u),F(f,n,null),m(e,c),m(e,_),j.m(_,null),m(e,p),D.m(e,null),g=!0,$||(L=[ne(o,"click",function(){xn(r[0])&&r[0].apply(this,arguments)}),ne(a,"click",function(){xn(r[1])&&r[1].apply(this,arguments)}),ne(_,"click",r[11])],$=!0)},p(B,E){r=B,b&&b.p&&(!g||E[1]&128)&&Ne(b,k,r,r[38],g?Re(k,r[38],E,fh):Ee(r[38]),Bi),(!g||E[0]&32&&i!==(i=r[5].length<3))&&(o.disabled=i);const O={};E[1]&128&&(O.$$scope={dirty:E,ctx:r}),f.$set(O),N===(N=S(r))&&j?j.p(r,E):(j.d(1),j=N(r),j&&(j.c(),j.m(_,null))),(!g||E[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),R===(R=I(r))&&D?D.p(r,E):(D.d(1),D=R(r),D&&(D.c(),D.m(e,null)))},i(B){g||(v(b,B),v(f.$$.fragment,B),g=!0)},o(B){C(b,B),C(f.$$.fragment,B),g=!1},d(B){B&&y(e),b&&b.d(B),P(f),j.d(),D.d(),$=!1,ct(L)}}}function bh(r){let e;return{c(){e=h("span"),T(e,"class","dot svelte-1cj4rwq"),Ue(e,"snapped-node",r[47].snapped),Ue(e,"free-node",!r[47].snapped),Ue(e,"hide",r[4])},m(t,n){w(t,e,n)},p(t,n){n[0]&512&&Ue(e,"snapped-node",t[47].snapped),n[0]&512&&Ue(e,"free-node",!t[47].snapped),n[0]&16&&Ue(e,"hide",t[4])},d(t){t&&y(e)}}}function Hi(r){let e,t,n;function o(u){r[25](u,r[47])}function l(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[bh]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new qr({props:a}),Le.push(()=>ze(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){A(e.$$.fragment)},m(u,f){F(e,u,f),n=!0},p(u,f){r=u;const c={};f[0]&528|f[1]&128&&(c.$$scope={dirty:f,ctx:r}),!t&&f[0]&512&&(t=!0,c.lngLat=r[47].point,Oe(()=>t=!1)),e.$set(c)},i(u){n||(v(e.$$.fragment,u),n=!0)},o(u){C(e.$$.fragment,u),n=!1},d(u){P(e,u)}}}function wh(r){let e;return{c(){e=h("span"),e.textContent=`${r[46]+1}`,T(e,"class","dot svelte-1cj4rwq"),Ue(e,"snapped",r[44].snapped)},m(t,n){w(t,e,n)},p(t,n){n[0]&32&&Ue(e,"snapped",t[44].snapped)},d(t){t&&y(e)}}}function Gi(r){let e,t,n;function o(a){r[29](a,r[44])}function l(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[wh]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new qr({props:s}),Le.push(()=>ze(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){A(e.$$.fragment)},m(a,u){F(e,a,u),n=!0},p(a,u){r=a;const f={};u[0]&32|u[1]&128&&(f.$$scope={dirty:u,ctx:r}),!t&&u[0]&32&&(t=!0,f.lngLat=r[44].point,Oe(()=>t=!1)),e.$set(f)},i(a){n||(v(e.$$.fragment,a),n=!0)},o(a){C(e.$$.fragment,a),n=!1},d(a){P(e,a)}}}function yh(r){let e,t,n,o;const l=[ve("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let u=0;u<l.length;u+=1)i=de(i,l[u]);e=new tt({props:i});const s=[ve("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let u=0;u<s.length;u+=1)a=de(a,s[u]);return n=new It({props:a}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _={};n.$set(_)},i(u){o||(v(e.$$.fragment,u),v(n.$$.fragment,u),o=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),o=!1},d(u){u&&y(t),P(e,u),P(n,u)}}}function vh(r){let e,t;return e=new tt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function $h(r){let e,t,n,o,l,i,s,a,u;t=new Oo({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let f=Se(r[9]),c=[];for(let $=0;$<f.length;$+=1)c[$]=Hi(Ui(r,f,$));const _=$=>C(c[$],1,1,()=>{c[$]=null});let d=Se(r[5]),p=[];for(let $=0;$<d.length;$+=1)p[$]=Gi(Di(r,d,$));const g=$=>C(p[$],1,1,()=>{p[$]=null});return i=new Ve({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[yh]},$$scope:{ctx:r}}}),a=new Ve({props:{data:r[10],$$slots:{default:[vh]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),n=M();for(let $=0;$<c.length;$+=1)c[$].c();o=M();for(let $=0;$<p.length;$+=1)p[$].c();l=M(),A(i.$$.fragment),s=M(),A(a.$$.fragment),T(e,"slot","map")},m($,L){w($,e,L),F(t,e,null),m(e,n);for(let k=0;k<c.length;k+=1)c[k]&&c[k].m(e,null);m(e,o);for(let k=0;k<p.length;k+=1)p[k]&&p[k].m(e,null);m(e,l),F(i,e,null),m(e,s),F(a,e,null),u=!0},p($,L){if(L[0]&918032){f=Se($[9]);let S;for(S=0;S<f.length;S+=1){const N=Ui($,f,S);c[S]?(c[S].p(N,L),v(c[S],1)):(c[S]=Hi(N),c[S].c(),v(c[S],1),c[S].m(e,o))}for($e(),S=f.length;S<c.length;S+=1)_(S);ke()}if(L[0]&2146348){d=Se($[5]);let S;for(S=0;S<d.length;S+=1){const N=Di($,d,S);p[S]?(p[S].p(N,L),v(p[S],1)):(p[S]=Gi(N),p[S].c(),v(p[S],1),p[S].m(e,l))}for($e(),S=d.length;S<p.length;S+=1)g(S);ke()}const k={};L[0]&96&&(k.data=$[16]($[6],$[5])),L[1]&128&&(k.$$scope={dirty:L,ctx:$}),i.$set(k);const b={};L[0]&1024&&(b.data=$[10]),L[1]&128&&(b.$$scope={dirty:L,ctx:$}),a.$set(b)},i($){if(!u){v(t.$$.fragment,$);for(let L=0;L<f.length;L+=1)v(c[L]);for(let L=0;L<d.length;L+=1)v(p[L]);v(i.$$.fragment,$),v(a.$$.fragment,$),u=!0}},o($){C(t.$$.fragment,$),c=c.filter(Boolean);for(let L=0;L<c.length;L+=1)C(c[L]);p=p.filter(Boolean);for(let L=0;L<p.length;L+=1)C(p[L]);C(i.$$.fragment,$),C(a.$$.fragment,$),u=!1},d($){$&&y(e),P(t),ut(c,$),ut(p,$),P(i),P(a)}}}function kh(r){let e,t,n,o;return e=new Nt({props:{$$slots:{map:[$h],sidebar:[hh],top:[ch]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0,n||(o=ne(ah,"keydown",r[20]),n=!0)},p(l,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l),n=!1,o()}}}function Ch(r,e,t){let n,o,l;ee(r,Ut,K=>t(5,o=K)),ee(r,jn,K=>t(6,l=K));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:u}=e,{cancel:f}=e;jt(()=>{le(Ut,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],p=null,g=!1,$=!1,L=!1;function k(K){let V=K.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=V}function b(){let K=_.pop();t(8,_),K&&le(Ut,o=K,o)}function S(){_.length==100&&_.shift(),t(8,_=[..._,JSON.parse(JSON.stringify(o))])}function N(){t(7,c=c=="snap"?"free":"snap"),p&&t(23,p.snapped=c=="snap",p)}function j(K){o.length>=3||(S(),Ut.update(V=>(V.push({point:K.detail.lngLat.toArray(),snapped:c=="snap"}),V)))}function I(K){t(23,p={point:K.detail.lngLat.toArray(),snapped:c=="snap"})}function R(K){S(),Ut.update(V=>(V[K].snapped=!V[K].snapped,V))}function D(K){S(),Ut.update(V=>(V.splice(K,1),V)),t(2,g=!1)}function B(K,V){try{if(K)return Ks(V)}catch{}return Ft()}function E(K,V,Q,ge){if(ge||V.length>=3)return Ft();try{if(K&&V.length>0&&Q)return JSON.parse(K.inner.calculateRoute([V[V.length-1],Q]))}catch{}return Ft()}function O(K,V,Q){if(Q)return;if(!K||V.length<3){t(9,d=[]);return}let ge=[],he=1,Pe=JSON.parse(JSON.stringify(V));Pe.push(Pe[0]);for(let q=0;q<Pe.length-1;q++){let nt=JSON.parse(K.inner.getExtraNodes(Pe[q],Pe[q+1]));for(let[xe,Je,Ct]of nt)ge.push({point:[xe,Je],snapped:Ct,insertIdx:he});he++}t(9,d=ge)}function H(K){S(),Ut.update(V=>(V.splice(K.insertIdx,0,{point:K.point,snapped:K.snapped}),V)),t(4,L=!0)}function W(K){Ut.update(V=>(V[K.insertIdx].point=K.point,V))}function Z(){t(4,L=!1)}function re(K){let V=K.target.tagName,Q=V=="INPUT"||V=="TEXTAREA";K.key=="Enter"&&!Q||K.key=="Escape"?(K.stopPropagation(),o.length>=3?u():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):K.key=="s"&&!Q?N():K.key=="z"&&K.ctrlKey&&(K.stopPropagation(),b())}function ce(){S(),t(3,$=!0)}const U=[[]];function be(K,V){r.$$.not_equal(V.point,K)&&(V.point=K,t(9,d))}const fe=K=>H(K),te=K=>W(K),me=K=>{H(K),t(4,L=!1)};function ue(K,V){r.$$.not_equal(V.point,K)&&(V.point=K,Ut.set(o))}const Fe=K=>R(K),et=K=>D(K),ye=()=>t(2,g=!0),we=()=>t(2,g=!1),lt=()=>t(3,$=!1);function Ge(){c=this.__value,t(7,c)}function Ce(){c=this.__value,t(7,c)}return r.$$set=K=>{"map"in K&&t(22,a=K.map),"finish"in K&&t(0,u=K.finish),"cancel"in K&&t(1,f=K.cancel),"$$scope"in K&&t(38,s=K.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&O(l,o,L),r.$$.dirty[0]&8388716&&t(10,n=E(l,o,p,g||$)),r.$$.dirty[0]&32&&k(o)},[u,f,g,$,L,o,l,c,_,d,n,b,j,I,R,D,B,H,W,Z,re,ce,a,p,i,be,fe,te,me,ue,Fe,et,ye,we,lt,Ge,U,Ce,s]}class Sh extends se{constructor(e){super(),ae(this,e,Ch,kh,ie,{map:22,finish:0,cancel:1},null,[-1,-1])}}function Lh(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Mh(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Th(r){let e;return{c(){e=h("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){w(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&y(e)}}}function Ah(r){let e,t,n,o,l;return t=new Ae({props:{$$slots:{default:[Fh]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=h("li"),A(t.$$.fragment),n=M(),o=h("li"),o.textContent="Changing neighbourhood boundary"},m(i,s){w(i,e,s),F(t,e,null),w(i,n,s),w(i,o,s),l=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(v(t.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),l=!1},d(i){i&&(y(e),y(n),y(o)),P(t)}}}function Fh(r){let e;return{c(){e=z("Editing")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Ph(r){let e,t,n,o,l,i,s,a,u,f,c,_;l=new Ae({props:{$$slots:{default:[Lh]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ae({props:{$$slots:{default:[Mh]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[Ah,Th],p=[];function g($,L){return $[1]?0:1}return f=g(r),c=p[f]=d[f](r),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),c.c(),T(t,"aria-label","breadcrumb"),T(e,"slot","extra-top")},m($,L){w($,e,L),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),p[f].m(n,null),_=!0},p($,L){const k={};L&4096&&(k.$$scope={dirty:L,ctx:$}),l.$set(k);const b={};L&4096&&(b.$$scope={dirty:L,ctx:$}),a.$set(b);let S=f;f=g($),f===S?p[f].p($,L):($e(),C(p[S],1,1,()=>{p[S]=null}),ke(),c=p[f],c?c.p($,L):(c=p[f]=d[f]($),c.c()),v(c,1),c.m(n,null))},i($){_||(v(l.$$.fragment,$),v(a.$$.fragment,$),v(c),_=!0)},o($){C(l.$$.fragment,$),C(a.$$.fragment,$),C(c),_=!1},d($){$&&y(e),P(l),P(a),p[f].d()}}}function jh(r){let e,t,n,o;return{c(){e=h("div"),t=h("h1"),n=z("Draw your neighbourhood boundary for "),o=z(r[0]),T(e,"slot","extra-sidebar")},m(l,i){w(l,e,i),m(e,t),m(t,n),m(t,o)},p(l,i){i&1&&oe(o,l[0])},d(l){l&&y(e)}}}function Ih(r){let e,t;return e=new Sh({props:{map:gt(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[jh],"extra-top":[Ph]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&8&&(l.map=gt(n[3])),o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Nh(r,e,t){let n,o,l,i,s;ee(r,_e,g=>t(2,n=g)),ee(r,er,g=>t(9,o=g)),ee(r,ot,g=>t(10,l=g)),ee(r,Ut,g=>t(11,i=g)),ee(r,rn,g=>t(3,s=g));let{name:a}=e,{existing:u}=e;u&&(u.properties.waypoints?le(Ut,i=u.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):le(Ut,i=u.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function f(){if(i.length>=3)try{let g=Ks(i);l.setNeighbourhoodBoundary(a,g),Fn(),l.setCurrentNeighbourhood(a,o),le(_e,n={mode:"neighbourhood"},n)}catch(g){console.log("error when setting hand drawn neighborhood",g),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working."),c()}}function c(){u?le(_e,n={mode:"neighbourhood"},n):le(_e,n={mode:"pick-neighbourhood"},n)}const _=()=>le(_e,n={mode:"title",firstLoad:!1},n),d=()=>le(_e,n={mode:"pick-neighbourhood"},n),p=()=>le(_e,n={mode:"neighbourhood"},n);return r.$$set=g=>{"name"in g&&t(0,a=g.name),"existing"in g&&t(1,u=g.existing)},[a,u,n,s,f,c,_,d,p]}class Eh extends se{constructor(e){super(),ae(this,e,Nh,Ih,ie,{name:0,existing:1})}}const Rh="/ltn/assets/settings-342fb430.svg";function zh(r){let e,t,n,o,l,i,s,a,u,f,c,_,d;return n=new xf({}),{c(){e=h("h1"),e.textContent="Settings",t=M(),A(n.$$.fragment),o=M(),l=h("label"),i=h("input"),s=z(`
    Road thickness depends on shortcuts`),a=M(),u=h("center"),f=h("button"),f.textContent="Confirm",T(i,"type","checkbox")},m(p,g){w(p,e,g),w(p,t,g),F(n,p,g),w(p,o,g),w(p,l,g),m(l,i),i.checked=r[1],m(l,s),w(p,a,g),w(p,u,g),m(u,f),c=!0,_||(d=[ne(i,"change",r[3]),ne(f,"click",r[4])],_=!0)},p(p,g){g&2&&(i.checked=p[1])},i(p){c||(v(n.$$.fragment,p),c=!0)},o(p){C(n.$$.fragment,p),c=!1},d(p){p&&(y(e),y(t),y(o),y(l),y(a),y(u)),P(n,p),_=!1,ct(d)}}}function Oh(r){let e,t,n,o,l,i,s;function a(f){r[5](f)}let u={$$slots:{default:[zh]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.show=r[0]),n=new Hr({props:u}),Le.push(()=>ze(n,"show",a)),{c(){e=h("button"),e.innerHTML=`<img src="${Rh}" alt="Settings"/>`,t=M(),A(n.$$.fragment),T(e,"class","outline")},m(f,c){w(f,e,c),w(f,t,c),F(n,f,c),l=!0,i||(s=ne(e,"click",r[2]),i=!0)},p(f,[c]){const _={};c&67&&(_.$$scope={dirty:c,ctx:f}),!o&&c&1&&(o=!0,_.show=f[0],Oe(()=>o=!1)),n.$set(_)},i(f){l||(v(n.$$.fragment,f),l=!0)},o(f){C(n.$$.fragment,f),l=!1},d(f){f&&(y(e),y(t)),P(n,f),i=!1,s()}}}function Bh(r,e,t){let n;ee(r,uo,u=>t(1,n=u));let o=!1;const l=()=>t(0,o=!0);function i(){n=this.checked,uo.set(n)}const s=()=>t(0,o=!1);function a(u){o=u,t(0,o)}return[o,n,l,i,s,a]}class Dh extends se{constructor(e){super(),ae(this,e,Bh,Oh,ie,{})}}const Uh=["==",["geometry-type"],"Polygon"],Hh=["==",["geometry-type"],"LineString"],Gh=["==",["geometry-type"],"Point"];function Xs(){return{type:"FeatureCollection",features:[]}}function io(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Vs(r)}}}function Vs(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Qs=At(Xs()),xs=At(0),Wh=100;class qh{constructor(e){mt(this,"map");mt(this,"active");mt(this,"eventListenersSuccess");mt(this,"eventListenersUpdated");mt(this,"eventListenersFailure");mt(this,"points");mt(this,"cursor");mt(this,"hover");mt(this,"dragFrom");mt(this,"previousStates");mt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});mt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Wi(this.points).forEach((n,o)=>{t.push([o+1,Gu(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});mt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=io(e.lngLat.toArray()),this.onClick(e),this.finish())});mt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});mt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});mt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});mt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Xs();this.points.forEach((o,l)=>{let i=io(o);i.properties.hover=this.hover==l,i.properties.idx=l,e.features.push(i)}),e.features=e.features.concat(Wi(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Qs.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,xs.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=io(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Vs),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Wh&&this.previousStates.shift()}}function Wi(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Jh(r){let e,t,n;return{c(){e=z("Undo ("),t=z(r[1]),n=z(")")},m(o,l){w(o,e,l),w(o,t,l),w(o,n,l)},p(o,l){l&2&&oe(t,o[1])},d(o){o&&(y(e),y(t),y(n))}}}function Yh(r){let e;return{c(){e=z("Undo")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function Zh(r){let e,t,n,o,l,i,s,a,u,f,c;function _(g,$){return g[1]==0?Yh:Jh}let d=_(r),p=d(r);return{c(){e=h("div"),t=h("button"),t.textContent="Finish",n=M(),o=h("button"),o.textContent="Cancel",l=M(),i=h("button"),p.c(),a=M(),u=h("ul"),u.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,X(e,"display","flex"),X(e,"justify-content","space-between")},m(g,$){w(g,e,$),m(e,t),m(e,n),m(e,o),m(e,l),m(e,i),p.m(i,null),w(g,a,$),w(g,u,$),f||(c=[ne(t,"click",r[2]),ne(o,"click",r[3]),ne(i,"click",r[4])],f=!0)},p(g,[$]){d===(d=_(g))&&p?p.p(g,$):(p.d(1),p=d(g),p&&(p.c(),p.m(i,null))),$&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Y,o:Y,d(g){g&&(y(e),y(a),y(u)),p.d(),f=!1,ct(c)}}}function Kh(r,e,t){let n;ee(r,xs,a=>t(1,n=a));let{polygonTool:o}=e;const l=()=>o.finish(),i=()=>o.cancel(),s=()=>o.undo();return r.$$set=a=>{"polygonTool"in a&&t(0,o=a.polygonTool)},[o,n,l,i,s]}class Xh extends se{constructor(e){super(),ae(this,e,Kh,Zh,ie,{polygonTool:0})}}let Vh=Date.now();function hr(r){return`${r}-${Vh++}`}const ea=Symbol.for("svelte-maplibre");function Qh(){return Fo(ea)}function qi(r){return{subscribe:r.subscribe}}function ta({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let o=Qh(),l=At(null),i=qi(l),s={...o,[r]:qi(l)};if(e&&(s.popupTarget=i),n){let a=At(null);s.layerEvent=a,o.layerEvent=a}return t&&(s.cluster=At()),ms(ea,s),{...o,self:l}}function xh(){return ta({key:"source",setCluster:!0})}function e0(r=!0){return ta({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Ji(r){let e;return t=>{if(t)for(let n in t){let o=e==null?void 0:e[n],l=t[n];o!==l&&r(n,l,o)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function t0(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function n0(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Yi(r){let e=r[0],t,n,o=Zi(r);return{c(){o.c(),t=Qe()},m(l,i){o.m(l,i),w(l,t,i),n=!0},p(l,i){i[0]&1&&ie(e,e=l[0])?($e(),C(o,1,1,Y),ke(),o=Zi(l),o.c(),v(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(v(o),n=!0)},o(l){C(o),n=!1},d(l){l&&y(t),o.d(l)}}}function Zi(r){let e;const t=r[36].default,n=Ie(t,r,r[35],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[1]&16)&&Ne(n,t,o,o[35],e?Re(t,o[35],l,null):Ee(o[35]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function r0(r){let e,t,n=r[0]&&Yi(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l[0]&1&&v(n,1)):(n=Yi(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function o0(r,e,t){let n,o,l,i,s,a,u,f,c,_,d,p,{$$slots:g={},$$scope:$}=e,{id:L=hr("layer")}=e,{source:k=void 0}=e,{sourceLayer:b=void 0}=e,{beforeId:S=void 0}=e,{beforeLayerType:N=void 0}=e,{type:j}=e,{paint:I=void 0}=e,{layout:R=void 0}=e,{filter:D=void 0}=e,{applyToClusters:B=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:O=void 0}=e,{manageHoverState:H=!1}=e,{hovered:W=null}=e,{interactive:Z=!0}=e,{hoverCursor:re=void 0}=e,{eventsIfTopMost:ce=!1}=e;const U=hn(),{map:be,source:fe,self:te,minzoom:me,maxzoom:ue,eventTopMost:Fe,layerInfo:et}=e0();ee(r,be,Q=>t(31,c=Q)),ee(r,fe,Q=>t(32,_=Q)),ee(r,te,Q=>t(0,f=Q)),ee(r,me,Q=>t(34,p=Q)),ee(r,ue,Q=>t(33,d=Q)),jt(()=>{f&&c&&(et.delete(f),c==null||c.removeLayer(f))});let ye;function we(Q){var q,nt;if(!Z||!f||!c||ce&&Fe(Q)!==f)return;let ge=Q.features??[],he=(nt=(q=ge[0])==null?void 0:q.properties)==null?void 0:nt.cluster_id,Pe={event:Q,map:c,clusterId:he,layer:f,source:s,features:ge};U(Q.type,Pe)}function lt(Q){var q,nt;if(!Z||!f||!c||ce&&Fe(Q)!==f)return;re&&(c.getCanvas().style.cursor=re);let ge=Q.features??[];t(6,W=ge[0]??null);let he=(nt=(q=ge[0])==null?void 0:q.properties)==null?void 0:nt.cluster_id;U("mouseenter",{event:Q,map:c,clusterId:he,layer:f,source:s,features:ge})}function Ge(Q){var q,nt,xe;if(!Z||!c)return;if(ce&&Fe(Q)!==f){t(6,W=null),H&&ye!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:b,id:ye},{hover:!1}),ye=void 0);return}c.getCanvas().style.cursor=re;let ge=Q.features??[],he=(nt=(q=ge[0])==null?void 0:q.properties)==null?void 0:nt.cluster_id,Pe=(xe=ge[0])==null?void 0:xe.id;Pe!==ye&&(H&&(ye!==void 0&&(c==null||c.setFeatureState({source:s,id:ye,sourceLayer:b},{hover:!1})),c==null||c.setFeatureState({source:s,id:Pe,sourceLayer:b},{hover:!0})),ye=Pe,t(6,W=ge[0]??null)),U("mousemove",{event:Q,map:c,clusterId:he,layer:f,source:s,features:ge})}function Ce(Q){if(!(!Z||!f||!c)){if(re&&(c.getCanvas().style.cursor=""),t(6,W=null),H&&ye!==void 0){const ge={source:s,id:ye,sourceLayer:b};c==null||c.setFeatureState(ge,{hover:!1}),ye=void 0}U("mouseleave",{map:c,layer:f,source:s})}}let K=!0;function V(Q){c&&(c.off("click",Q,we),c.off("dblclick",Q,we),c.off("contextmenu",Q,we),c.off("mouseenter",Q,lt),c.off("mousemove",Q,Ge),c.off("mouseleave",Q,Ce))}return jt(()=>{c&&f&&V(f)}),r.$$set=Q=>{"id"in Q&&t(7,L=Q.id),"source"in Q&&t(8,k=Q.source),"sourceLayer"in Q&&t(9,b=Q.sourceLayer),"beforeId"in Q&&t(10,S=Q.beforeId),"beforeLayerType"in Q&&t(11,N=Q.beforeLayerType),"type"in Q&&t(12,j=Q.type),"paint"in Q&&t(13,I=Q.paint),"layout"in Q&&t(14,R=Q.layout),"filter"in Q&&t(15,D=Q.filter),"applyToClusters"in Q&&t(16,B=Q.applyToClusters),"minzoom"in Q&&t(17,E=Q.minzoom),"maxzoom"in Q&&t(18,O=Q.maxzoom),"manageHoverState"in Q&&t(19,H=Q.manageHoverState),"hovered"in Q&&t(6,W=Q.hovered),"interactive"in Q&&t(20,Z=Q.interactive),"hoverCursor"in Q&&t(21,re=Q.hoverCursor),"eventsIfTopMost"in Q&&t(22,ce=Q.eventsIfTopMost),"$$scope"in Q&&t(35,$=Q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=n0(B)),r.$$.dirty[0]&1073774592&&t(24,o=t0("all",n,D)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,l=E??p),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,i=O??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=k||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&f!==L&&s){f&&(V(f),et.delete(f));let Q=S;if(!S&&N){let ge=c.getStyle().layers,he=typeof N=="function"?N:q=>q.type===N,Pe=ge==null?void 0:ge.find(he);Pe&&(Q=Pe.id)}le(te,f=L,f),c.addLayer(Er({id:f,type:j,source:s,"source-layer":b,filter:o,paint:I,layout:R,minzoom:l,maxzoom:i}),Q),t(23,K=!0),c.on("click",f,we),c.on("dblclick",f,we),c.on("contextmenu",f,we),c.on("mouseenter",f,lt),c.on("mousemove",f,Ge),c.on("mouseleave",f,Ce)}r.$$.dirty[0]&1048577&&f&&et.set(f,{interactive:Z}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,a=f?Ji((Q,ge)=>c==null?void 0:c.setPaintProperty(f,Q,ge)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,u=f?Ji((Q,ge)=>c==null?void 0:c.setLayoutProperty(f,Q,ge)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(I)),r.$$.dirty[0]&134234112&&(u==null||u(R)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&f&&(c==null||c.setLayerZoomRange(f,l,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&f&&(K?t(23,K=!1):c==null||c.setFilter(f,o))},[f,be,fe,te,me,ue,W,L,k,b,S,N,j,I,R,D,B,E,O,H,Z,re,ce,K,o,i,l,u,a,s,n,c,_,d,p,$,g]}class Uo extends se{constructor(e){super(),ae(this,e,o0,r0,ie,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function l0(r){let e;const t=r[16].default,n=Ie(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Ne(n,t,o,o[24],e?Re(t,o[24],l,null):Ee(o[24]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function i0(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[l0]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Uo({props:l}),Le.push(()=>ze(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function s0(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=hr("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:L=!1}=e,{hovered:k=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:S=!0}=e;function N(O){k=O,t(0,k)}function j(O){qe.call(this,r,O)}function I(O){qe.call(this,r,O)}function R(O){qe.call(this,r,O)}function D(O){qe.call(this,r,O)}function B(O){qe.call(this,r,O)}function E(O){qe.call(this,r,O)}return r.$$set=O=>{"id"in O&&t(1,l=O.id),"source"in O&&t(2,i=O.source),"sourceLayer"in O&&t(3,s=O.sourceLayer),"beforeId"in O&&t(4,a=O.beforeId),"beforeLayerType"in O&&t(5,u=O.beforeLayerType),"paint"in O&&t(6,f=O.paint),"layout"in O&&t(7,c=O.layout),"filter"in O&&t(8,_=O.filter),"applyToClusters"in O&&t(9,d=O.applyToClusters),"minzoom"in O&&t(10,p=O.minzoom),"maxzoom"in O&&t(11,g=O.maxzoom),"hoverCursor"in O&&t(12,$=O.hoverCursor),"manageHoverState"in O&&t(13,L=O.manageHoverState),"hovered"in O&&t(0,k=O.hovered),"eventsIfTopMost"in O&&t(14,b=O.eventsIfTopMost),"interactive"in O&&t(15,S=O.interactive),"$$scope"in O&&t(24,o=O.$$scope)},[k,l,i,s,a,u,f,c,_,d,p,g,$,L,b,S,n,N,j,I,R,D,B,E,o]}class a0 extends se{constructor(e){super(),ae(this,e,s0,i0,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function u0(r){let e;const t=r[15].default,n=Ie(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Ne(n,t,o,o[23],e?Re(t,o[23],l,null):Ee(o[23]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function f0(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[u0]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Uo({props:l}),Le.push(()=>ze(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function c0(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=hr("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:p=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:$=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:k=!1}=e,{interactive:b=!0}=e;function S(E){L=E,t(0,L)}function N(E){qe.call(this,r,E)}function j(E){qe.call(this,r,E)}function I(E){qe.call(this,r,E)}function R(E){qe.call(this,r,E)}function D(E){qe.call(this,r,E)}function B(E){qe.call(this,r,E)}return r.$$set=E=>{"id"in E&&t(1,l=E.id),"source"in E&&t(2,i=E.source),"sourceLayer"in E&&t(3,s=E.sourceLayer),"beforeId"in E&&t(4,a=E.beforeId),"beforeLayerType"in E&&t(5,u=E.beforeLayerType),"paint"in E&&t(6,f=E.paint),"layout"in E&&t(7,c=E.layout),"filter"in E&&t(8,_=E.filter),"minzoom"in E&&t(9,d=E.minzoom),"maxzoom"in E&&t(10,p=E.maxzoom),"hoverCursor"in E&&t(11,g=E.hoverCursor),"manageHoverState"in E&&t(12,$=E.manageHoverState),"hovered"in E&&t(0,L=E.hovered),"eventsIfTopMost"in E&&t(13,k=E.eventsIfTopMost),"interactive"in E&&t(14,b=E.interactive),"$$scope"in E&&t(23,o=E.$$scope)},[L,l,i,s,a,u,f,c,_,d,p,g,$,k,b,n,S,N,j,I,R,D,B,o]}class d0 extends se{constructor(e){super(),ae(this,e,c0,f0,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function _0(r,e,t,n,o){let l=!1;r.getSource(e)&&(l=!0,r.removeSource(e));const i=()=>{n(e)&&(r.addSource(e,t),o())};if(l){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function p0(r,e,t){Pa().then(()=>{let n=Zt(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Ki(r){let e=r[0],t,n,o=Xi(r);return{c(){o.c(),t=Qe()},m(l,i){o.m(l,i),w(l,t,i),n=!0},p(l,i){i&1&&ie(e,e=l[0])?($e(),C(o,1,1,Y),ke(),o=Xi(l),o.c(),v(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(v(o),n=!0)},o(l){C(o),n=!1},d(l){l&&y(t),o.d(l)}}}function Xi(r){let e;const t=r[15].default,n=Ie(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Ne(n,t,o,o[14],e?Re(t,o[14],l,null):Ee(o[14]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function m0(r){let e,t,n=r[0]&&Ki(r);return{c(){n&&n.c(),e=Qe()},m(o,l){n&&n.m(o,l),w(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&v(n,1)):(n=Ki(o),n.c(),v(n,1),n.m(e.parentNode,e)):n&&($e(),C(n,1,1,()=>{n=null}),ke())},i(o){t||(v(n),t=!0)},o(o){C(n),t=!1},d(o){o&&y(e),n&&n.d(o)}}}function g0(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{id:a=hr("geojson")}=e,{data:u}=e,{generateId:f=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:p=void 0}=e;const{map:g,cluster:$,self:L}=xh();ee(r,g,S=>t(13,o=S)),ee(r,$,S=>t(16,l=S)),ee(r,L,S=>t(0,n=S));let k,b=!0;return jt(()=>{n&&k&&o&&(p0(g,n,k),le(L,n=null,n),t(11,k=void 0))}),r.$$set=S=>{"id"in S&&t(4,a=S.id),"data"in S&&t(5,u=S.data),"generateId"in S&&t(6,f=S.generateId),"promoteId"in S&&t(7,c=S.promoteId),"filter"in S&&t(8,_=S.filter),"lineMetrics"in S&&t(9,d=S.lineMetrics),"cluster"in S&&t(10,p=S.cluster),"$$scope"in S&&t(14,s=S.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&le($,l=p,l),r.$$.dirty&12273&&o&&n!==a&&(le(L,n=a,n),_0(o,n,Er({type:"geojson",data:u,filter:_,lineMetrics:d,generateId:f,promoteId:c,cluster:!!p,clusterMinPoints:p==null?void 0:p.minPoints,clusterMaxZoom:p==null?void 0:p.maxZoom,clusterRadius:p==null?void 0:p.radius,clusterProperties:p==null?void 0:p.properties}),S=>o&&S===n,()=>{n&&(t(11,k=o==null?void 0:o.getSource(n)),t(12,b=!0))})),r.$$.dirty&8208&&(o==null||o.on("style.load",()=>{t(11,k=o==null?void 0:o.getSource(a))})),r.$$.dirty&6176&&k&&(b?t(12,b=!1):k.setData(u)),r.$$.dirty&3072&&(k==null||k.setClusterOptions(Er({cluster:!!p,clusterMaxZoom:p==null?void 0:p.maxZoom,clusterRadius:p==null?void 0:p.radius})))},[n,g,$,L,a,u,f,c,_,d,p,k,b,o,s,i]}class h0 extends se{constructor(e){super(),ae(this,e,g0,m0,ie,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function b0(r){let e;const t=r[15].default,n=Ie(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Ne(n,t,o,o[23],e?Re(t,o[23],l,null):Ee(o[23]),null)},i(o){e||(v(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function w0(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[b0]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Uo({props:l}),Le.push(()=>ze(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function y0(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=hr("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:p=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:$=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:k=!1}=e,{interactive:b=!0}=e;function S(E){L=E,t(0,L)}function N(E){qe.call(this,r,E)}function j(E){qe.call(this,r,E)}function I(E){qe.call(this,r,E)}function R(E){qe.call(this,r,E)}function D(E){qe.call(this,r,E)}function B(E){qe.call(this,r,E)}return r.$$set=E=>{"id"in E&&t(1,l=E.id),"source"in E&&t(2,i=E.source),"sourceLayer"in E&&t(3,s=E.sourceLayer),"beforeId"in E&&t(4,a=E.beforeId),"beforeLayerType"in E&&t(5,u=E.beforeLayerType),"paint"in E&&t(6,f=E.paint),"layout"in E&&t(7,c=E.layout),"filter"in E&&t(8,_=E.filter),"minzoom"in E&&t(9,d=E.minzoom),"maxzoom"in E&&t(10,p=E.maxzoom),"hoverCursor"in E&&t(11,g=E.hoverCursor),"manageHoverState"in E&&t(12,$=E.manageHoverState),"hovered"in E&&t(0,L=E.hovered),"eventsIfTopMost"in E&&t(13,k=E.eventsIfTopMost),"interactive"in E&&t(14,b=E.interactive),"$$scope"in E&&t(23,o=E.$$scope)},[L,l,i,s,a,u,f,c,_,d,p,g,$,k,b,n,S,N,j,I,R,D,B,o]}class v0 extends se{constructor(e){super(),ae(this,e,y0,w0,ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function $0(r){let e,t,n,o,l,i;return e=new d0({props:{id:"edit-polygon-fill",filter:Uh,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new v0({props:{id:"edit-polygon-lines",filter:Hh,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),l=new a0({props:{id:"edit-polygon-vertices",filter:Gh,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment)},m(s,a){F(e,s,a),w(s,t,a),F(n,s,a),w(s,o,a),F(l,s,a),i=!0},p:Y,i(s){i||(v(e.$$.fragment,s),v(n.$$.fragment,s),v(l.$$.fragment,s),i=!0)},o(s){C(e.$$.fragment,s),C(n.$$.fragment,s),C(l.$$.fragment,s),i=!1},d(s){s&&(y(t),y(o)),P(e,s),P(n,s),P(l,s)}}}function k0(r){let e,t;return e=new h0({props:{data:r[0],$$slots:{default:[$0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function C0(r,e,t){let n;return ee(r,Qs,o=>t(0,n=o)),[n]}class S0 extends se{constructor(e){super(),ae(this,e,C0,k0,ie,{})}}function L0(r){let e,t,n,o,l,i,s;return{c(){e=h("button"),e.textContent="Import current view",t=M(),n=h("i"),n.textContent="or...",o=M(),l=h("button"),l.textContent="Draw an area to import on the map",T(e,"type","button"),T(l,"type","button")},m(a,u){w(a,e,u),w(a,t,u),w(a,n,u),w(a,o,u),w(a,l,u),i||(s=[ne(e,"click",r[2]),ne(l,"click",r[3])],i=!0)},p:Y,i:Y,o:Y,d(a){a&&(y(e),y(t),y(n),y(o),y(l)),i=!1,ct(s)}}}function M0(r){let e,t;return e=new Xh({props:{polygonTool:r[0]}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.polygonTool=n[0]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function T0(r){let e,t,n,o,l,i,s,a,u;const f=[M0,L0],c=[];function _(d,p){return d[0]?0:1}return e=_(r),t=c[e]=f[e](r),{c(){t.c(),n=M(),o=h("label"),l=h("input"),i=z(`Save a copy of the osm.xml
  after importing`),T(l,"type","checkbox")},m(d,p){c[e].m(d,p),w(d,n,p),w(d,o,p),m(o,l),l.checked=r[1],m(o,i),s=!0,a||(u=ne(l,"change",r[5]),a=!0)},p(d,[p]){let g=e;e=_(d),e===g?c[e].p(d,p):($e(),C(c[g],1,1,()=>{c[g]=null}),ke(),t=c[e],t?t.p(d,p):(t=c[e]=f[e](d),t.c()),v(t,1),t.m(n.parentNode,n)),p&2&&(l.checked=d[1])},i(d){s||(v(t),s=!0)},o(d){C(t),s=!1},d(d){d&&(y(n),y(o)),c[e].d(d),a=!1,u()}}}function Dn(r){return[r.lng,r.lat]}function A0(r,e,t){let{map:n}=e;const o=hn();let l=null,i=!1;async function s(_){try{o("loading","Loading from Overpass");let p=await(await fetch(na(_))).text();i&&zr("osm.xml",p),o("gotXml",{xml:p,boundary:_})}catch(d){o("error",d.toString())}}function a(){let _=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Dn(_.getSouthWest()),Dn(_.getNorthWest()),Dn(_.getNorthEast()),Dn(_.getSouthEast()),Dn(_.getSouthWest())]],type:"Polygon"}}}async function u(){if(n){if(n.getZoom()<13){o("error","Zoom in more to import");return}await s(a())}}function f(){n&&(t(0,l=new qh(n)),l.startNew(),l.addEventListenerSuccess(async _=>{t(0,l=null),await s(_)}),l.addEventListenerFailure(()=>{t(0,l=null)}))}function c(){i=this.checked,t(1,i)}return r.$$set=_=>{"map"in _&&t(4,n=_.map)},[l,i,u,f,n,c]}class F0 extends se{constructor(e){super(),ae(this,e,A0,T0,ie,{map:4})}}function na(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,o]of r.geometry.coordinates[0])e+=`${o} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,o]of r.geometry.coordinates[0][0])e+=`${o} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class ra{constructor(e,t,n,o,l){mt(this,"inner");this.inner=new P_(e,t||new Uint8Array,n||new Uint8Array,o,l)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=P0(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=kl(t.properties.counts_from),t.properties.sum_to=kl(t.properties.counts_to);return e}}function P0(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function Ir(r){Vt.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:o,boundary:l}=await j0(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),ot.set(new ra(new Uint8Array(t),n?new Uint8Array(n):void 0,o?new Uint8Array(o):void 0,l,e.study_area_name||void 0)),Zt(ot).loadSavefile(e),console.timeEnd("load"),oa()}catch(e){window.alert(`Couldn't open project: ${e}`),Vt.set("")}}async function j0(r,e){if(e){let t=$t(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${t}`);let o=await(await cn(t)).arrayBuffer(),l=$t(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await cn(l)).json(),a=$t(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let u;try{u=await(await cn(a)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let f=$t(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${f}`);let c;try{c=await(await cn(f)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:o,boundary:s,demandBuffer:u,contextDataBuffer:c}}else if(r.study_area_name){let t=$t(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${t}`);let o=await(await cn(t)).arrayBuffer(),l=$t(`boundaries/${r.study_area_name}.geojson`),s=await(await cn(l)).json();return{osmBuffer:o,boundary:s}}else{console.log("Grabbing from Overpass");let t=r.features.find(l=>l.properties.kind=="study_area_boundary");return{osmBuffer:await(await cn(na(t))).arrayBuffer(),boundary:t}}}function oa(){_e.set({mode:"pick-neighbourhood"}),jn.set(new qu(Zt(rn),Zt(ot).toRouteSnapper(),At(Ft()),At(!0),At(0))),Zt(rn).fitBounds(Zt(ot).getBounds(),{animate:!1}),nr.set(so()),tr.set(so()),Tr.set(so());let r=new URL(window.location.href);r.searchParams.set("project",Zt(Vt)),window.history.replaceState(null,"",r.toString())}function so(){let r=Zt(ot).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new co.LngLat(e,t)}function Vi(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function Qi(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function I0(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function N0(r){let e,t,n,o,l,i,s,a;return l=new Ae({props:{$$slots:{default:[I0]},$$scope:{ctx:r}}}),l.$on("click",r[13]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),s.textContent="New project",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(u,f){w(u,e,f),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),a=!0},p(u,f){const c={};f&16777216&&(c.$$scope={dirty:f,ctx:u}),l.$set(c)},i(u){a||(v(l.$$.fragment,u),a=!0)},o(u){C(l.$$.fragment,u),a=!1},d(u){u&&y(e),P(l)}}}function xi(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;e=new bs({props:{loading:r[4]}});let g=Se(r[3]),$=[];for(let L=0;L<g.length;L+=1)$[L]=ts(Vi(r,g,L));return c=new F0({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){A(e.$$.fragment),t=M(),n=h("label"),o=z(`Load a built-in area:
        `),l=h("select"),i=h("option");for(let L=0;L<$.length;L+=1)$[L].c();s=M(),a=h("i"),a.textContent="or...",u=M(),f=h("div"),A(c.$$.fragment),i.__value="",We(i,i.__value),r[2]===void 0&&dn(()=>r[9].call(l))},m(L,k){F(e,L,k),w(L,t,k),w(L,n,k),m(n,o),m(n,l),m(l,i);for(let b=0;b<$.length;b+=1)$[b]&&$[b].m(l,null);vt(l,r[2],!0),w(L,s,k),w(L,a,k),w(L,u,k),w(L,f,k),F(c,f,null),_=!0,d||(p=[ne(l,"change",r[9]),ne(l,"change",r[10])],d=!0)},p(L,k){const b={};if(k&16&&(b.loading=L[4]),e.$set(b),k&8){g=Se(L[3]);let N;for(N=0;N<g.length;N+=1){const j=Vi(L,g,N);$[N]?$[N].p(j,k):($[N]=ts(j),$[N].c(),$[N].m(l,null))}for(;N<$.length;N+=1)$[N].d(1);$.length=g.length}k&12&&vt(l,L[2]);const S={};k&32&&(S.map=L[5]),c.$set(S)},i(L){_||(v(e.$$.fragment,L),v(c.$$.fragment,L),_=!0)},o(L){C(e.$$.fragment,L),C(c.$$.fragment,L),_=!1},d(L){L&&(y(t),y(n),y(s),y(a),y(u),y(f)),P(e,L),ut($,L),P(c),d=!1,ct(p)}}}function es(r){let e,t=r[21]+"",n,o;return{c(){e=h("option"),n=z(t),e.__value=o=r[20],We(e,e.__value)},m(l,i){w(l,e,i),m(e,n)},p(l,i){i&8&&t!==(t=l[21]+"")&&oe(n,t),i&8&&o!==(o=l[20])&&(e.__value=o,We(e,e.__value))},d(l){l&&y(e)}}}function ts(r){let e,t,n=Se(r[17]),o=[];for(let l=0;l<n.length;l+=1)o[l]=es(Qi(r,n,l));return{c(){e=h("optgroup");for(let l=0;l<o.length;l+=1)o[l].c();T(e,"label",t=r[16])},m(l,i){w(l,e,i);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(l,i){if(i&8){n=Se(l[17]);let s;for(s=0;s<n.length;s+=1){const a=Qi(l,n,s);o[s]?o[s].p(a,i):(o[s]=es(a),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}i&8&&t!==(t=l[16])&&T(e,"label",t)},d(l){l&&y(e),ut(o,l)}}}function E0(r){let e,t,n,o,l,i,s,a,u,f=r[1]&&xi(r);return{c(){e=h("div"),t=h("div"),n=h("label"),o=z(`Project name:
        `),l=h("input"),i=M(),f&&f.c(),T(l,"type","text"),T(e,"slot","sidebar")},m(c,_){w(c,e,_),m(e,t),m(t,n),m(n,o),m(n,l),We(l,r[1]),m(e,i),f&&f.m(e,null),s=!0,a||(u=ne(l,"input",r[8]),a=!0)},p(c,_){_&2&&l.value!==c[1]&&We(l,c[1]),c[1]?f?(f.p(c,_),_&2&&v(f,1)):(f=xi(c),f.c(),v(f,1),f.m(e,null)):f&&($e(),C(f,1,1,()=>{f=null}),ke())},i(c){s||(v(f),s=!0)},o(c){C(f),s=!1},d(c){c&&y(e),f&&f.d(),a=!1,u()}}}function R0(r){let e,t,n;return t=new S0({}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","map")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p:Y,i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function z0(r){let e,t;return e=new Nt({props:{$$slots:{map:[R0],sidebar:[E0],top:[N0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&16777342&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function O0(r,e,t){let n,o,l,i;ee(r,Vt,b=>t(14,n=b)),ee(r,ot,b=>t(15,o=b)),ee(r,rn,b=>t(5,l=b)),ee(r,_e,b=>t(6,i=b));let s="",a="",u=[],f="";Ur(async()=>{let b=await cn($t("severance_pbfs/areas.json"));t(3,u=await b.json())});function c(b){t(4,f="Loading OSM");try{le(ot,o=new ra(new TextEncoder().encode(b.detail.xml),void 0,void 0,b.detail.boundary,void 0),o),le(Vt,n=`ltn_${s}`,n),oa(),Fn()}catch(S){window.alert(`Couldn't import from Overpass: ${S}`)}t(4,f="")}async function _(){if(a=="")return;let b=`ltn_${s}`;window.localStorage.setItem(b,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),t(4,f=`Loading pre-clipped OSM area ${a}`),await Ir(b),t(4,f="")}function d(){s=this.value,t(1,s)}function p(){a=_n(this),t(2,a),t(3,u)}return[_,s,a,u,f,l,i,c,d,p,()=>_(),b=>t(4,f=b.detail),b=>window.alert(b.detail),()=>le(_e,i={mode:"title",firstLoad:!1},i)]}class B0 extends se{constructor(e){super(),ae(this,e,O0,z0,ie,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function ns(r,e,t){const n=r.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function rs(r,e,t){const n=r.slice();return n[23]=e[t],n}function D0(r){let e;return{c(){e=h("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',T(e,"slot","top")},m(t,n){w(t,e,n)},p:Y,d(t){t&&y(e)}}}function U0(r){let e;return{c(){e=h("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){w(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&y(e)}}}function H0(r){let e,t,n,o,l,i,s,a,u,f,c,_,d;t=new Ae({props:{$$slots:{default:[G0]},$$scope:{ctx:r}}}),t.$on("click",r[11]);let p=Se(r[2]),g=[];for(let L=0;L<p.length;L+=1)g[L]=ls(ns(r,p,L));const $=L=>C(g[L],1,1,()=>{g[L]=null});return{c(){e=h("div"),A(t.$$.fragment),n=M(),o=h("p"),o.textContent="Load a saved project:",l=M(),i=h("ul");for(let L=0;L<g.length;L+=1)g[L].c();s=M(),a=h("label"),u=z(`Load a project from a file
        `),f=h("input"),T(f,"type","file")},m(L,k){w(L,e,k),F(t,e,null),w(L,n,k),w(L,o,k),w(L,l,k),w(L,i,k);for(let b=0;b<g.length;b+=1)g[b]&&g[b].m(i,null);w(L,s,k),w(L,a,k),m(a,u),m(a,f),r[15](f),c=!0,_||(d=ne(f,"change",r[6]),_=!0)},p(L,k){const b={};if(k&67108864&&(b.$$scope={dirty:k,ctx:L}),t.$set(b),k&900){p=Se(L[2]);let S;for(S=0;S<p.length;S+=1){const N=ns(L,p,S);g[S]?(g[S].p(N,k),v(g[S],1)):(g[S]=ls(N),g[S].c(),v(g[S],1),g[S].m(i,null))}for($e(),S=p.length;S<g.length;S+=1)$(S);ke()}},i(L){if(!c){v(t.$$.fragment,L);for(let k=0;k<p.length;k+=1)v(g[k]);c=!0}},o(L){C(t.$$.fragment,L),g=g.filter(Boolean);for(let k=0;k<g.length;k+=1)C(g[k]);c=!1},d(L){L&&(y(e),y(n),y(o),y(l),y(i),y(s),y(a)),P(t),ut(g,L),r[15](null),_=!1,d()}}}function G0(r){let e;return{c(){e=z("New project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function W0(r){let e=r[23].slice(4)+"",t;return{c(){t=z(e)},m(n,o){w(n,t,o)},p(n,o){o&4&&e!==(e=n[23].slice(4)+"")&&oe(t,e)},d(n){n&&y(t)}}}function os(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;function g(){return r[12](r[23])}n=new Ae({props:{$$slots:{default:[W0]},$$scope:{ctx:r}}}),n.$on("click",g),s=new zo({props:{color:"black"}});function $(){return r[13](r[23])}f=new Ns({props:{color:"white"}});function L(){return r[14](r[23])}return{c(){e=h("li"),t=h("span"),A(n.$$.fragment),o=M(),l=h("span"),i=h("button"),A(s.$$.fragment),a=M(),u=h("button"),A(f.$$.fragment),c=M(),T(i,"class","outline icon-btn"),T(i,"aria-label","Rename project"),T(u,"class","icon-btn destructive"),T(u,"aria-label","Delete project"),X(l,"display","flex"),X(l,"gap","16px"),X(t,"display","flex"),X(t,"justify-content","space-between")},m(k,b){w(k,e,b),m(e,t),F(n,t,null),m(t,o),m(t,l),m(l,i),F(s,i,null),m(l,a),m(l,u),F(f,u,null),m(e,c),_=!0,d||(p=[ne(i,"click",$),ne(u,"click",L)],d=!0)},p(k,b){r=k;const S={};b&67108868&&(S.$$scope={dirty:b,ctx:r}),n.$set(S)},i(k){_||(v(n.$$.fragment,k),v(s.$$.fragment,k),v(f.$$.fragment,k),_=!0)},o(k){C(n.$$.fragment,k),C(s.$$.fragment,k),C(f.$$.fragment,k),_=!1},d(k){k&&y(e),P(n),P(s),P(f),d=!1,ct(p)}}}function ls(r){let e,t=(r[19]??"custom area")+"",n,o,l,i,s=Se(r[20]),a=[];for(let f=0;f<s.length;f+=1)a[f]=os(rs(r,s,f));const u=f=>C(a[f],1,1,()=>{a[f]=null});return{c(){e=h("u"),n=z(t),o=M();for(let f=0;f<a.length;f+=1)a[f].c();l=Qe()},m(f,c){w(f,e,c),m(e,n),w(f,o,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(f,c);w(f,l,c),i=!0},p(f,c){if((!i||c&4)&&t!==(t=(f[19]??"custom area")+"")&&oe(n,t),c&900){s=Se(f[20]);let _;for(_=0;_<s.length;_+=1){const d=rs(f,s,_);a[_]?(a[_].p(d,c),v(a[_],1)):(a[_]=os(d),a[_].c(),v(a[_],1),a[_].m(l.parentNode,l))}for($e(),_=s.length;_<a.length;_+=1)u(_);ke()}},i(f){if(!i){for(let c=0;c<s.length;c+=1)v(a[c]);i=!0}},o(f){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)C(a[c]);i=!1},d(f){f&&(y(e),y(o),y(l)),ut(a,f)}}}function q0(r){let e,t,n,o;const l=[H0,U0],i=[];function s(a,u){return a[4]&&a[0]?0:1}return t=s(r),n=i[t]=l[t](r),{c(){e=h("div"),n.c(),T(e,"slot","sidebar")},m(a,u){w(a,e,u),i[t].m(e,null),o=!0},p(a,u){let f=t;t=s(a),t===f?i[t].p(a,u):($e(),C(i[f],1,1,()=>{i[f]=null}),ke(),n=i[t],n?n.p(a,u):(n=i[t]=l[t](a),n.c()),v(n,1),n.m(e,null))},i(a){o||(v(n),o=!0)},o(a){C(n),o=!1},d(a){a&&y(e),i[t].d()}}}function J0(r){let e,t,n,o;return e=new bs({props:{loading:r[1]}}),n=new Nt({props:{$$slots:{sidebar:[q0],top:[D0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment)},m(l,i){F(e,l,i),w(l,t,i),F(n,l,i),o=!0},p(l,[i]){const s={};i&2&&(s.loading=l[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(v(e.$$.fragment,l),v(n.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(n.$$.fragment,l),o=!1},d(l){l&&y(t),P(e,l),P(n,l)}}}function Mr(){let r=new Map,e=[];for(let n=0;n<window.localStorage.length;n++){let o=window.localStorage.key(n);if(o.startsWith("ltn_")){let l="";try{l=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch{}l&&l.length>0?(r.has(l)||r.set(l,[]),r.get(l).push(o)):e.push(o)}}let t=[...r.entries()];return t.sort((n,o)=>n[0].localeCompare(o[0])),t.push(["custom",e]),t}function Y0(r,e,t){let n,o,l,i,s;ee(r,Vt,j=>t(16,n=j)),ee(r,jn,j=>t(17,o=j)),ee(r,ot,j=>t(18,l=j)),ee(r,rn,j=>t(4,i=j)),ee(r,_e,j=>t(5,s=j));let{wasmReady:a}=e,{firstLoad:u}=e,f="";if(le(ot,l=null,l),le(jn,o=null,o),le(Vt,n="",n),u){let I=new URLSearchParams(window.location.search).get("project");I&&(f=`Loading project ${I}`,Ir(I))}else{let j=new URL(window.location.href);j.searchParams.delete("project"),window.history.replaceState(null,"",j.toString())}let c=Mr(),_;async function d(j){let I="ltn_"+_.files[0].name;t(1,f=`Loading from file ${I}`),window.localStorage.setItem(I,await _.files[0].text()),t(2,c=Mr()),await Ir(I),t(1,f="")}function p(j){window.confirm(`Really delete project ${j}? You can't undo this.`)&&(window.localStorage.removeItem(j),t(2,c=Mr()))}function g(j){let I=window.prompt(`Rename project ${j} to what?`,j);if(I){I.startsWith("ltn_")||(I=`ltn_${I}`);let R=window.localStorage.getItem(j);window.localStorage.setItem(I,R),window.localStorage.removeItem(j),t(2,c=Mr())}}async function $(j){t(1,f=`Loading project ${j}`),await Ir(j),t(1,f="")}const L=()=>le(_e,s={mode:"new-project"},s),k=j=>$(j),b=j=>g(j),S=j=>p(j);function N(j){Le[j?"unshift":"push"](()=>{_=j,t(3,_)})}return r.$$set=j=>{"wasmReady"in j&&t(0,a=j.wasmReady),"firstLoad"in j&&t(10,u=j.firstLoad)},[a,f,c,_,i,s,d,p,g,$,u,L,k,b,S,N]}class Z0 extends se{constructor(e){super(),ae(this,e,Y0,J0,ie,{wasmReady:0,firstLoad:10})}}function K0(r){let e;return{c(){e=z("Choose project")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function X0(r){let e;return{c(){e=z("Pick neighbourhood")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function V0(r){let e;return{c(){e=z("Editing")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function Q0(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,p;return l=new Ae({props:{$$slots:{default:[K0]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Ae({props:{$$slots:{default:[X0]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Ae({props:{$$slots:{default:[V0]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=h("div"),t=h("nav"),n=h("ul"),o=h("li"),A(l.$$.fragment),i=M(),s=h("li"),A(a.$$.fragment),u=M(),f=h("li"),A(c.$$.fragment),_=M(),d=h("li"),d.textContent="Viewing shortcuts",T(t,"aria-label","breadcrumb"),T(e,"slot","top")},m(g,$){w(g,e,$),m(e,t),m(t,n),m(n,o),F(l,o,null),m(n,i),m(n,s),F(a,s,null),m(n,u),m(n,f),F(c,f,null),m(n,_),m(n,d),p=!0},p(g,$){const L={};$&1024&&(L.$$scope={dirty:$,ctx:g}),l.$set(L);const k={};$&1024&&(k.$$scope={dirty:$,ctx:g}),a.$set(k);const b={};$&1024&&(b.$$scope={dirty:$,ctx:g}),c.$set(b)},i(g){p||(v(l.$$.fragment,g),v(a.$$.fragment,g),v(c.$$.fragment,g),p=!0)},o(g){C(l.$$.fragment,g),C(a.$$.fragment,g),C(c.$$.fragment,g),p=!1},d(g){g&&y(e),P(l),P(a),P(c)}}}function x0(r){let e,t,n,o,l,i,s,a,u,f,c=gt(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,p,g,$,L;function k(S){r[5](S)}let b={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(b.idx=r[0].shortcutIndex),l=new Yr({props:b}),Le.push(()=>ze(l,"idx",k)),{c(){e=h("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=M(),n=h("button"),n.textContent="Pick a different road",o=M(),A(l.$$.fragment),s=M(),a=h("p"),u=z("This shortcut is "),f=h("b"),_=z(c),d=z("x"),p=z(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(S,N){w(S,e,N),w(S,t,N),w(S,n,N),w(S,o,N),F(l,S,N),w(S,s,N),w(S,a,N),m(a,u),m(a,f),m(f,_),m(f,d),m(a,p),g=!0,$||(L=ne(n,"click",r[4]),$=!0)},p(S,N){const j={};N&1&&(j.list=S[0].gj.features),!i&&N&1&&(i=!0,j.idx=S[0].shortcutIndex,Oe(()=>i=!1)),l.$set(j),(!g||N&1)&&c!==(c=gt(S[0].gj.features[S[0].shortcutIndex].properties).directness.toFixed(1)+"")&&oe(_,c)},i(S){g||(v(l.$$.fragment,S),g=!0)},o(S){C(l.$$.fragment,S),g=!1},d(S){S&&(y(e),y(t),y(n),y(o),y(s),y(a)),P(l,S),$=!1,L()}}}function eb(r){let e;return{c(){e=h("p"),e.textContent="Click a road to see shortcuts"},m(t,n){w(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&y(e)}}}function tb(r){let e,t,n,o,l,i;t=new bn({}),t.$on("click",r[3]);const s=[eb,x0],a=[];function u(f,c){return f[0].state=="neutral"?0:f[0].state=="chose-road"?1:-1}return~(o=u(r))&&(l=a[o]=s[o](r)),{c(){e=h("div"),A(t.$$.fragment),n=M(),l&&l.c(),T(e,"slot","sidebar")},m(f,c){w(f,e,c),F(t,e,null),m(e,n),~o&&a[o].m(e,null),i=!0},p(f,c){let _=o;o=u(f),o===_?~o&&a[o].p(f,c):(l&&($e(),C(a[_],1,1,()=>{a[_]=null}),ke()),~o?(l=a[o],l?l.p(f,c):(l=a[o]=s[o](f),l.c()),v(l,1),l.m(e,null)):l=null)},i(f){i||(v(t.$$.fragment,f),v(l),i=!0)},o(f){C(t.$$.fragment,f),C(l),i=!1},d(f){f&&y(e),P(t),~o&&a[o].d()}}}function nb(r){let e,t;return e=new mr({props:{interactive:!1}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function rb(r){let e,t;return e=new mr({props:{onClickLine:r[2],$$slots:{"line-popup":[lb]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function ob(r){let e,t=r[9].shortcuts+"",n,o,l=(r[9].name??"unnamed road")+"",i;return{c(){e=h("p"),n=z(t),o=z(" shortcuts through "),i=z(l)},m(s,a){w(s,e,a),m(e,n),m(e,o),m(e,i)},p(s,a){a&512&&t!==(t=s[9].shortcuts+"")&&oe(n,t),a&512&&l!==(l=(s[9].name??"unnamed road")+"")&&oe(i,l)},d(s){s&&y(e)}}}function lb(r){let e,t,n;return t=new _t({props:{openOn:"hover",$$slots:{default:[ob,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),T(e,"slot","line-popup")},m(o,l){w(o,e,l),F(t,e,null),n=!0},p(o,l){const i={};l&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(v(t.$$.fragment,o),n=!0)},o(o){C(t.$$.fragment,o),n=!1},d(o){o&&y(e),P(t)}}}function ib(r){let e,t,n,o,l,i,s,a,u,f;e=new Kr({}),n=new Zr({}),l=new Xr({});const c=[rb,nb],_=[];function d(p,g){return p[0].state=="neutral"?0:p[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),a&&a.c(),u=Qe()},m(p,g){F(e,p,g),w(p,t,g),F(n,p,g),w(p,o,g),F(l,p,g),w(p,i,g),~s&&_[s].m(p,g),w(p,u,g),f=!0},p(p,g){let $=s;s=d(p),s===$?~s&&_[s].p(p,g):(a&&($e(),C(_[$],1,1,()=>{_[$]=null}),ke()),~s?(a=_[s],a?a.p(p,g):(a=_[s]=c[s](p),a.c()),v(a,1),a.m(u.parentNode,u)):a=null)},i(p){f||(v(e.$$.fragment,p),v(n.$$.fragment,p),v(l.$$.fragment,p),v(a),f=!0)},o(p){C(e.$$.fragment,p),C(n.$$.fragment,p),C(l.$$.fragment,p),C(a),f=!1},d(p){p&&(y(t),y(o),y(i),y(u)),P(e,p),P(n,p),P(l,p),~s&&_[s].d(p)}}}function is(r){let e,t,n,o,l,i,s,a;return e=new Ve({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[sb]},$$scope:{ctx:r}}}),n=new Ve({props:{data:r[0].roadGj,$$slots:{default:[ab]},$$scope:{ctx:r}}}),l=new Sn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[ub]},$$scope:{ctx:r}}}),s=new Sn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[fb]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),A(s.$$.fragment)},m(u,f){F(e,u,f),w(u,t,f),F(n,u,f),w(u,o,f),F(l,u,f),w(u,i,f),F(s,u,f),a=!0},p(u,f){const c={};f&1&&(c.data=u[0].gj.features[u[0].shortcutIndex]),f&1024&&(c.$$scope={dirty:f,ctx:u}),e.$set(c);const _={};f&1&&(_.data=u[0].roadGj),f&1024&&(_.$$scope={dirty:f,ctx:u}),n.$set(_);const d={};f&1&&(d.lngLat=u[0].gj.features[u[0].shortcutIndex].geometry.coordinates[0]),f&1024&&(d.$$scope={dirty:f,ctx:u}),l.$set(d);const p={};f&1&&(p.lngLat=u[0].gj.features[u[0].shortcutIndex].geometry.coordinates[u[0].gj.features[u[0].shortcutIndex].geometry.coordinates.length-1]),f&1024&&(p.$$scope={dirty:f,ctx:u}),s.$set(p)},i(u){a||(v(e.$$.fragment,u),v(n.$$.fragment,u),v(l.$$.fragment,u),v(s.$$.fragment,u),a=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),C(l.$$.fragment,u),C(s.$$.fragment,u),a=!1},d(u){u&&(y(t),y(o),y(i)),P(e,u),P(n,u),P(l,u),P(s,u)}}}function sb(r){let e,t;const n=[ve("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function ab(r){let e,t;const n=[ve("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new tt({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function ub(r){let e;return{c(){e=z("A")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function fb(r){let e;return{c(){e=z("B")},m(t,n){w(t,e,n)},d(t){t&&y(e)}}}function cb(r){let e,t,n,o,l,i;t=new gr({props:{$$slots:{default:[ib]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&is(r);return l=new wn({}),{c(){e=h("div"),A(t.$$.fragment),n=M(),s&&s.c(),o=M(),A(l.$$.fragment),T(e,"slot","map")},m(a,u){w(a,e,u),F(t,e,null),m(e,n),s&&s.m(e,null),m(e,o),F(l,e,null),i=!0},p(a,u){const f={};u&1025&&(f.$$scope={dirty:u,ctx:a}),t.$set(f),a[0].state=="chose-road"?s?(s.p(a,u),u&1&&v(s,1)):(s=is(a),s.c(),v(s,1),s.m(e,o)):s&&($e(),C(s,1,1,()=>{s=null}),ke())},i(a){i||(v(t.$$.fragment,a),v(s),v(l.$$.fragment,a),i=!0)},o(a){C(t.$$.fragment,a),C(s),C(l.$$.fragment,a),i=!1},d(a){a&&y(e),P(t),s&&s.d(),P(l)}}}function db(r){let e,t;return e=new Nt({props:{$$slots:{map:[cb],sidebar:[tb],top:[Q0]},$$scope:{ctx:r}}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function _b(r,e,t){let n,o;ee(r,_e,_=>t(1,n=_)),ee(r,ot,_=>t(8,o=_));let l={state:"neutral"};function i(_,d){let p=o.getShortcutsCrossingRoad(_.properties.id);if(p.features.length==0){window.alert("No shortcuts here");return}t(0,l={state:"chose-road",roadGj:_,gj:p,shortcutIndex:0})}function s(){le(_e,n={mode:"neighbourhood"},n)}const a=()=>t(0,l={state:"neutral"});function u(_){r.$$.not_equal(l.shortcutIndex,_)&&(l.shortcutIndex=_,t(0,l))}return[l,n,i,s,a,u,()=>le(_e,n={mode:"title",firstLoad:!1},n),()=>le(_e,n={mode:"pick-neighbourhood"},n)]}class pb extends se{constructor(e){super(),ae(this,e,_b,db,ie,{})}}function mb(r){let e,t,n,o,l,i,s,a,u;return o=new Dh({}),{c(){e=h("div"),t=h("button"),t.innerHTML=`<img src="${Ra}" style="height: 6vh;" alt="A/B Street logo"/>`,n=M(),A(o.$$.fragment),l=M(),i=h("span"),T(t,"class","outline"),X(i,"width","100%"),T(e,"slot","top"),T(e,"class","pico"),X(e,"display","flex")},m(f,c){w(f,e,c),m(e,t),m(e,n),F(o,e,null),m(e,l),m(e,i),r[21](i),s=!0,a||(u=ne(t,"click",r[20]),a=!0)},p:Y,i(f){s||(v(o.$$.fragment,f),s=!0)},o(f){C(o.$$.fragment,f),s=!1},d(f){f&&y(e),P(o),r[21](null),a=!1,u()}}}function ss(r){let e,t,n,o,l,i;return n=new vc({props:{map:gt(r[6]),maptilerBasemap:r[7]}}),{c(){e=h("button"),e.textContent="Zoom to fit study area",t=M(),A(n.$$.fragment),T(e,"class","secondary")},m(s,a){w(s,e,a),w(s,t,a),F(n,s,a),o=!0,l||(i=ne(e,"click",r[11]),l=!0)},p(s,a){const u={};a&64&&(u.map=gt(s[6])),a&128&&(u.maptilerBasemap=s[7]),n.$set(u)},i(s){o||(v(n.$$.fragment,s),o=!0)},o(s){C(n.$$.fragment,s),o=!1},d(s){s&&(y(e),y(t)),P(n,s),l=!1,i()}}}function gb(r){let e,t,n,o,l,i,s=r[5]&&ss(r);return{c(){e=h("div"),t=h("div"),n=M(),o=h("hr"),l=M(),s&&s.c(),T(e,"class","pico"),T(e,"slot","left")},m(a,u){w(a,e,u),m(e,t),r[19](t),m(e,n),m(e,o),m(e,l),s&&s.m(e,null),i=!0},p(a,u){a[5]?s?(s.p(a,u),u&32&&v(s,1)):(s=ss(a),s.c(),v(s,1),s.m(e,null)):s&&($e(),C(s,1,1,()=>{s=null}),ke())},i(a){i||(v(s),i=!0)},o(a){C(s),i=!1},d(a){a&&y(e),r[19](null),s&&s.d()}}}function hb(r){return{c:Y,m:Y,p:Y,i:Y,o:Y,d:Y}}function bb(r){let e,t,n;function o(i){r[17](i)}let l={style:r[23],hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:gs},{id:"national_rail",url:hs}],$$slots:{default:[Nb]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.map=r[0]),e=new ja({props:l}),Le.push(()=>ze(e,"map",o)),e.$on("error",r[18]),{c(){A(e.$$.fragment)},m(i,s){F(e,i,s),n=!0},p(i,s){const a={};s&128&&(a.style=i[23]),s&16778041&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.map=i[0],Oe(()=>t=!1)),e.$set(a)},i(i){n||(v(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){P(e,i)}}}function as(r){let e,t;return e=new S_({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function wb(r){let e,t;return e=new B0({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function yb(r){let e,t;return e=new Z0({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&16&&(l.wasmReady=n[4]),o&512&&(l.firstLoad=n[9].firstLoad),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function us(r){let e,t,n,o,l,i;e=new Ve({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[vb]},$$scope:{ctx:r}}});const s=[Ib,jb,Pb,Fb,Ab,Tb,Mb,Lb,Sb,Cb,kb,$b],a=[];function u(f,c){return f[9].mode=="pick-neighbourhood"?0:f[9].mode=="set-boundary"?1:f[9].mode=="auto-boundaries"?2:f[9].mode=="neighbourhood"?3:f[9].mode=="view-shortcuts"?4:f[9].mode=="impact-one-destination"?5:f[9].mode=="route"?6:f[9].mode=="predict-impact"?7:f[9].mode=="impact-detail"?8:f[9].mode=="debug-neighbourhood"?9:f[9].mode=="debug-intersections"?10:f[9].mode=="debug-demand"?11:-1}return~(n=u(r))&&(o=a[n]=s[n](r)),{c(){A(e.$$.fragment),t=M(),o&&o.c(),l=Qe()},m(f,c){F(e,f,c),w(f,t,c),~n&&a[n].m(f,c),w(f,l,c),i=!0},p(f,c){const _={};c&32&&(_.data=f[5].getInvertedBoundary()),c&16777216&&(_.$$scope={dirty:c,ctx:f}),e.$set(_);let d=n;n=u(f),n===d?~n&&a[n].p(f,c):(o&&($e(),C(a[d],1,1,()=>{a[d]=null}),ke()),~n?(o=a[n],o?o.p(f,c):(o=a[n]=s[n](f),o.c()),v(o,1),o.m(l.parentNode,l)):o=null)},i(f){i||(v(e.$$.fragment,f),v(o),i=!0)},o(f){C(e.$$.fragment,f),C(o),i=!1},d(f){f&&(y(t),y(l)),P(e,f),~n&&a[n].d(f)}}}function vb(r){let e,t;const n=[ve("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=de(o,n[l]);return e=new It({props:o}),{c(){A(e.$$.fragment)},m(l,i){F(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){P(e,l)}}}function $b(r){let e,t;return e=new Mp({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function kb(r){let e,t;return e=new zp({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Cb(r){let e,t;return e=new Am({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Sb(r){let e,t;return e=new t1({props:{road:r[9].road}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.road=n[9].road),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Lb(r){let e,t;return e=new Z1({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Mb(r){let e,t;return e=new sh({props:{prevMode:r[9].prevMode}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.prevMode=n[9].prevMode),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Tb(r){let e,t;return e=new g1({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Ab(r){let e,t;return e=new pb({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Fb(r){let e,t;return e=new Gg({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Pb(r){let e,t;return e=new gp({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function jb(r){let e,t;return e=new Eh({props:{name:r[9].name,existing:r[9].existing}}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.name=n[9].name),o&512&&(l.existing=n[9].existing),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Ib(r){let e,t;return e=new z1({}),{c(){A(e.$$.fragment)},m(n,o){F(e,n,o),t=!0},p:Y,i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){C(e.$$.fragment,n),t=!1},d(n){P(e,n)}}}function Nb(r){let e,t,n,o,l,i,s=r[8].startsWith("ltn_cnt/"),a,u,f,c,_,d,p,g,$;e=new Ia({}),n=new Na({}),l=new ud({props:{map:r[0],apiKey:_o,country:void 0}});let L=s&&as();const k=[yb,wb],b=[];function S(j,I){return j[9].mode=="title"?0:j[9].mode=="new-project"?1:-1}~(c=S(r))&&(_=b[c]=k[c](r));let N=r[5]&&us(r);return g=new rc({}),{c(){A(e.$$.fragment),t=M(),A(n.$$.fragment),o=M(),A(l.$$.fragment),i=M(),L&&L.c(),a=M(),u=h("div"),f=M(),_&&_.c(),d=M(),N&&N.c(),p=M(),A(g.$$.fragment)},m(j,I){F(e,j,I),w(j,t,I),F(n,j,I),w(j,o,I),F(l,j,I),w(j,i,I),L&&L.m(j,I),w(j,a,I),w(j,u,I),r[16](u),w(j,f,I),~c&&b[c].m(j,I),w(j,d,I),N&&N.m(j,I),w(j,p,I),F(g,j,I),$=!0},p(j,I){const R={};I&1&&(R.map=j[0]),l.$set(R),I&256&&(s=j[8].startsWith("ltn_cnt/")),s?L?I&256&&v(L,1):(L=as(),L.c(),v(L,1),L.m(a.parentNode,a)):L&&($e(),C(L,1,1,()=>{L=null}),ke());let D=c;c=S(j),c===D?~c&&b[c].p(j,I):(_&&($e(),C(b[D],1,1,()=>{b[D]=null}),ke()),~c?(_=b[c],_?_.p(j,I):(_=b[c]=k[c](j),_.c()),v(_,1),_.m(d.parentNode,d)):_=null),j[5]?N?(N.p(j,I),I&32&&v(N,1)):(N=us(j),N.c(),v(N,1),N.m(p.parentNode,p)):N&&($e(),C(N,1,1,()=>{N=null}),ke())},i(j){$||(v(e.$$.fragment,j),v(n.$$.fragment,j),v(l.$$.fragment,j),v(L),v(_),v(N),v(g.$$.fragment,j),$=!0)},o(j){C(e.$$.fragment,j),C(n.$$.fragment,j),C(l.$$.fragment,j),C(L),C(_),C(N),C(g.$$.fragment,j),$=!1},d(j){j&&(y(t),y(o),y(i),y(a),y(u),y(f),y(d),y(p)),P(e,j),P(n,j),P(l,j),L&&L.d(j),r[16](null),~c&&b[c].d(j),N&&N.d(j),P(g,j)}}}function Eb(r){return{c:Y,m:Y,p:Y,i:Y,o:Y,d:Y}}function Rb(r){let e,t,n,o={ctx:r,current:null,token:null,hasCatch:!1,pending:Eb,then:bb,catch:hb,value:23,blocks:[,,,]};return Zo(t=r[12](r[7]),o),{c(){e=h("div"),o.block.c(),T(e,"slot","main"),X(e,"position","relative"),X(e,"width","100%"),X(e,"height","100%")},m(l,i){w(l,e,i),o.block.m(e,o.anchor=null),o.mount=()=>e,o.anchor=null,n=!0},p(l,i){r=l,o.ctx=r,i&128&&t!==(t=r[12](r[7]))&&Zo(t,o)||Ea(o,r,i)},i(l){n||(v(o.block),n=!0)},o(l){for(let i=0;i<3;i+=1){const s=o.blocks[i];C(s)}n=!1},d(l){l&&y(e),o.block.d(),o.token=null,o=null}}}function zb(r){let e,t,n,o,l;return t=new Ku({}),o=new D_({props:{$$slots:{main:[Rb],left:[gb],top:[mb]},$$scope:{ctx:r}}}),{c(){e=h("div"),A(t.$$.fragment),n=M(),A(o.$$.fragment),T(e,"class","pico")},m(i,s){w(i,e,s),F(t,e,null),w(i,n,s),F(o,i,s),l=!0},p(i,[s]){const a={};s&16779263&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(v(t.$$.fragment,i),v(o.$$.fragment,i),l=!0)},o(i){C(t.$$.fragment,i),C(o.$$.fragment,i),l=!1},d(i){i&&(y(e),y(n)),P(t),P(o,i)}}}function Ob(r,e,t){let n,o,l,i,s,a,u,f,c,_;ee(r,ko,B=>t(13,n=B)),ee(r,$o,B=>t(14,o=B)),ee(r,vo,B=>t(15,l=B)),ee(r,ot,B=>t(5,i=B)),ee(r,rn,B=>t(6,s=B)),ee(r,Yo,B=>t(22,a=B)),ee(r,ao,B=>t(7,u=B)),ee(r,Vt,B=>t(8,f=B)),ee(r,_e,B=>t(9,c=B)),ee(r,Kn,B=>t(10,_=B));let d=!1;Ur(async()=>{await qs(),await ys(),t(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(le(Yo,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let p=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let $,L,k;async function b(B){if(B!="streets-v2")return`https://api.maptiler.com/maps/${B}/style.json?key=${_o}`;let O=await(await fetch(`https://api.maptiler.com/maps/${B}/style.json?key=${_o}`)).json();return O.layers=O.layers.filter(H=>H.id!="Building 3D"),delete O.layers.find(H=>H.id=="Building").maxzoom,O}function S(B){Le[B?"unshift":"push"](()=>{k=B,t(3,k),t(13,n)})}function N(B){p=B,t(0,p)}const j=B=>{console.log(B.detail.error)};function I(B){Le[B?"unshift":"push"](()=>{L=B,t(2,L),t(14,o)})}const R=()=>le(Kn,_=!0,_);function D(B){Le[B?"unshift":"push"](()=>{$=B,t(1,$),t(15,l)})}return r.$$.update=()=>{r.$$.dirty&1&&p&&rn.set(p),r.$$.dirty&32770&&$&&l&&(t(1,$.innerHTML="",$),$.appendChild(l)),r.$$.dirty&16388&&L&&o&&(t(2,L.innerHTML="",L),L.appendChild(o)),r.$$.dirty&8200&&k&&n&&(t(3,k.innerHTML="",k),k.appendChild(n))},[p,$,L,k,d,i,s,u,f,c,_,g,b,n,o,l,S,N,j,I,R,D]}class Bb extends se{constructor(e){super(),ae(this,e,Ob,zb,ie,{})}}new Bb({target:document.getElementById("app")});
