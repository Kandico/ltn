var Bg=Object.defineProperty;var Fg=(h,o,l)=>o in h?Bg(h,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):h[o]=l;var _i=(h,o,l)=>(Fg(h,typeof o!="symbol"?o+"":o,l),l);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const T of v.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&c(T)}).observe(document,{childList:!0,subtree:!0});function l(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerPolicy&&(v.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?v.credentials="include":m.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function c(m){if(m.ep)return;m.ep=!0;const v=l(m);fetch(m.href,v)}})();function Vt(){}function Rg(h,o){for(const l in o)h[l]=o[l];return h}function $f(h){return h()}function nf(){return Object.create(null)}function gn(h){h.forEach($f)}function Lu(h){return typeof h=="function"}function oi(h,o){return h!=h?o==o:h!==o||h&&typeof h=="object"||typeof h=="function"}let xu;function Qh(h,o){return h===o?!0:(xu||(xu=document.createElement("a")),xu.href=o,h===xu.href)}function Og(h){return Object.keys(h).length===0}function Qf(h,...o){if(h==null){for(const c of o)c(void 0);return Vt}const l=h.subscribe(...o);return l.unsubscribe?()=>l.unsubscribe():l}function Ng(h){let o;return Qf(h,l=>o=l)(),o}function Et(h,o,l){h.$$.on_destroy.push(Qf(o,l))}function Jr(h,o,l,c){if(h){const m=em(h,o,l,c);return h[0](m)}}function em(h,o,l,c){return h[1]&&c?Rg(l.ctx.slice(),h[1](c(o))):l.ctx}function $r(h,o,l,c){if(h[2]&&c){const m=h[2](c(l));if(o.dirty===void 0)return m;if(typeof m=="object"){const v=[],T=Math.max(o.dirty.length,m.length);for(let s=0;s<T;s+=1)v[s]=o.dirty[s]|m[s];return v}return o.dirty|m}return o.dirty}function Qr(h,o,l,c,m,v){if(m){const T=em(o,l,c,v);h.p(T,m)}}function en(h){if(h.ctx.length>32){const o=[],l=h.ctx.length/32;for(let c=0;c<l;c++)o[c]=-1;return o}return-1}function Vg(h){const o={};for(const l in h)o[l]=!0;return o}function of(h){return h??""}function Si(h,o,l){return h.set(l),o}function ed(h){return h&&Lu(h.destroy)?h.destroy:Vt}const Ug=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function _e(h,o){h.appendChild(o)}function Re(h,o,l){h.insertBefore(o,l||null)}function Fe(h){h.parentNode&&h.parentNode.removeChild(h)}function hd(h,o){for(let l=0;l<h.length;l+=1)h[l]&&h[l].d(o)}function we(h){return document.createElement(h)}function Xt(h){return document.createTextNode(h)}function st(){return Xt(" ")}function Bn(){return Xt("")}function Dt(h,o,l,c){return h.addEventListener(o,l,c),()=>h.removeEventListener(o,l,c)}function qt(h,o,l){l==null?h.removeAttribute(o):h.getAttribute(o)!==l&&h.setAttribute(o,l)}function jg(h){return Array.from(h.childNodes)}function tn(h,o){o=""+o,h.data!==o&&(h.data=o)}function Ln(h,o){h.value=o??""}function Ea(h,o,l,c){l==null?h.style.removeProperty(o):h.style.setProperty(o,l,c?"important":"")}function sf(h,o,l){for(let c=0;c<h.options.length;c+=1){const m=h.options[c];if(m.__value===o){m.selected=!0;return}}(!l||o!==void 0)&&(h.selectedIndex=-1)}function qg(h){const o=h.querySelector(":checked");return o&&o.__value}function af(h,o,l){h.classList.toggle(o,!!l)}function Zg(h,o,{bubbles:l=!1,cancelable:c=!1}={}){return new CustomEvent(h,{detail:o,bubbles:l,cancelable:c})}let nc;function ec(h){nc=h}function ac(){if(!nc)throw new Error("Function called outside component initialization");return nc}function lc(h){ac().$$.on_mount.push(h)}function bo(h){ac().$$.on_destroy.push(h)}function cc(){const h=ac();return(o,l,{cancelable:c=!1}={})=>{const m=h.$$.callbacks[o];if(m){const v=Zg(o,l,{cancelable:c});return m.slice().forEach(T=>{T.call(h,v)}),!v.defaultPrevented}return!0}}function tm(h,o){return ac().$$.context.set(h,o),o}function Gg(h){return ac().$$.context.get(h)}function yr(h,o){const l=h.$$.callbacks[o.type];l&&l.slice().forEach(c=>c.call(this,o))}const Aa=[],Ur=[];let Pa=[];const td=[],im=Promise.resolve();let id=!1;function rm(){id||(id=!0,im.then(nm))}function Xg(){return rm(),im}function Cu(h){Pa.push(h)}function Bs(h){td.push(h)}const Wh=new Set;let Ia=0;function nm(){if(Ia!==0)return;const h=nc;do{try{for(;Ia<Aa.length;){const o=Aa[Ia];Ia++,ec(o),Wg(o.$$)}}catch(o){throw Aa.length=0,Ia=0,o}for(ec(null),Aa.length=0,Ia=0;Ur.length;)Ur.pop()();for(let o=0;o<Pa.length;o+=1){const l=Pa[o];Wh.has(l)||(Wh.add(l),l())}Pa.length=0}while(Aa.length);for(;td.length;)td.pop()();id=!1,Wh.clear(),ec(h)}function Wg(h){if(h.fragment!==null){h.update(),gn(h.before_update);const o=h.dirty;h.dirty=[-1],h.fragment&&h.fragment.p(h.ctx,o),h.after_update.forEach(Cu)}}function Hg(h){const o=[],l=[];Pa.forEach(c=>h.indexOf(c)===-1?o.push(c):l.push(c)),l.forEach(c=>c()),Pa=o}const Tu=new Set;let Ds;function mr(){Ds={r:0,c:[],p:Ds}}function _r(){Ds.r||gn(Ds.c),Ds=Ds.p}function Me(h,o){h&&h.i&&(Tu.delete(h),h.i(o))}function Ae(h,o,l,c){if(h&&h.o){if(Tu.has(h))return;Tu.add(h),Ds.c.push(()=>{Tu.delete(h),c&&(l&&h.d(1),c())}),h.o(o)}else c&&c()}function La(h){return(h==null?void 0:h.length)!==void 0?h:Array.from(h)}function Fs(h,o,l){const c=h.$$.props[o];c!==void 0&&(h.$$.bound[c]=l,l(h.$$.ctx[c]))}function ct(h){h&&h.c()}function at(h,o,l){const{fragment:c,after_update:m}=h.$$;c&&c.m(o,l),Cu(()=>{const v=h.$$.on_mount.map($f).filter(Lu);h.$$.on_destroy?h.$$.on_destroy.push(...v):gn(v),h.$$.on_mount=[]}),m.forEach(Cu)}function lt(h,o){const l=h.$$;l.fragment!==null&&(Hg(l.after_update),gn(l.on_destroy),l.fragment&&l.fragment.d(o),l.on_destroy=l.fragment=null,l.ctx=[])}function Kg(h,o){h.$$.dirty[0]===-1&&(Aa.push(h),rm(),h.$$.dirty.fill(0)),h.$$.dirty[o/31|0]|=1<<o%31}function hi(h,o,l,c,m,v,T=null,s=[-1]){const C=nc;ec(h);const I=h.$$={fragment:null,ctx:[],props:v,update:Vt,not_equal:m,bound:nf(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(o.context||(C?C.$$.context:[])),callbacks:nf(),dirty:s,skip_bound:!1,root:o.target||C.$$.root};T&&T(I.root);let D=!1;if(I.ctx=l?l(h,o.props||{},(q,ie,...de)=>{const oe=de.length?de[0]:ie;return I.ctx&&m(I.ctx[q],I.ctx[q]=oe)&&(!I.skip_bound&&I.bound[q]&&I.bound[q](oe),D&&Kg(h,q)),ie}):[],I.update(),D=!0,gn(I.before_update),I.fragment=c?c(I.ctx):!1,o.target){if(o.hydrate){const q=jg(o.target);I.fragment&&I.fragment.l(q),q.forEach(Fe)}else I.fragment&&I.fragment.c();o.intro&&Me(h.$$.fragment),at(h,o.target,o.anchor),nm()}ec(C)}class di{constructor(){_i(this,"$$");_i(this,"$$set")}$destroy(){lt(this,1),this.$destroy=Vt}$on(o,l){if(!Lu(l))return Vt;const c=this.$$.callbacks[o]||(this.$$.callbacks[o]=[]);return c.push(l),()=>{const m=c.indexOf(l);m!==-1&&c.splice(m,1)}}$set(o){this.$$set&&!Og(o)&&(this.$$.skip_bound=!0,this.$$set(o),this.$$.skip_bound=!1)}}const Yg="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Yg);let et;const Vo=new Array(128).fill(void 0);Vo.push(void 0,null,!0,!1);function Zt(h){return Vo[h]}let tc=Vo.length;function Jg(h){h<132||(Vo[h]=tc,tc=h)}function mn(h){const o=Zt(h);return Jg(h),o}const om=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&om.decode();let Xl=null;function za(){return(Xl===null||Xl.byteLength===0)&&(Xl=new Uint8Array(et.memory.buffer)),Xl}function _n(h,o){return h=h>>>0,om.decode(za().subarray(h,h+o))}function er(h){tc===Vo.length&&Vo.push(Vo.length+1);const o=tc;return tc=Vo[o],Vo[o]=h,o}let Xn=0;const ku=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},$g=typeof ku.encodeInto=="function"?function(h,o){return ku.encodeInto(h,o)}:function(h,o){const l=ku.encode(h);return o.set(l),{read:h.length,written:l.length}};function us(h,o,l){if(l===void 0){const s=ku.encode(h),C=o(s.length,1)>>>0;return za().subarray(C,C+s.length).set(s),Xn=s.length,C}let c=h.length,m=o(c,1)>>>0;const v=za();let T=0;for(;T<c;T++){const s=h.charCodeAt(T);if(s>127)break;v[m+T]=s}if(T!==c){T!==0&&(h=h.slice(T)),m=l(m,c,c=T+h.length*3,1)>>>0;const s=za().subarray(m+T,m+c),C=$g(h,s);T+=C.written}return Xn=T,m}function ql(h){return h==null}let Wl=null;function Tt(){return(Wl===null||Wl.byteLength===0)&&(Wl=new Int32Array(et.memory.buffer)),Wl}let Hl=null;function sm(){return(Hl===null||Hl.byteLength===0)&&(Hl=new Float64Array(et.memory.buffer)),Hl}let Kl=null;function Qg(){return(Kl===null||Kl.byteLength===0)&&(Kl=new BigInt64Array(et.memory.buffer)),Kl}function rd(h){const o=typeof h;if(o=="number"||o=="boolean"||h==null)return`${h}`;if(o=="string")return`"${h}"`;if(o=="symbol"){const m=h.description;return m==null?"Symbol":`Symbol(${m})`}if(o=="function"){const m=h.name;return typeof m=="string"&&m.length>0?`Function(${m})`:"Function"}if(Array.isArray(h)){const m=h.length;let v="[";m>0&&(v+=rd(h[0]));for(let T=1;T<m;T++)v+=", "+rd(h[T]);return v+="]",v}const l=/\[object ([^\]]+)\]/.exec(toString.call(h));let c;if(l.length>1)c=l[1];else return toString.call(h);if(c=="Object")try{return"Object("+JSON.stringify(h)+")"}catch{return"Object"}return h instanceof Error?`${h.name}: ${h.message}
${h.stack}`:c}function ey(h,o){const l=o(h.length*1,1)>>>0;return za().set(h,l/1),Xn=h.length,l}function ty(h,o){return h=h>>>0,sm().subarray(h/8,h/8+o)}function iy(h,o){return h=h>>>0,za().subarray(h/1,h/1+o)}function Hh(h,o){try{return h.apply(this,o)}catch(l){et.__wbindgen_exn_store(er(l))}}class ry{__destroy_into_raw(){const o=this.__wbg_ptr;return this.__wbg_ptr=0,o}free(){const o=this.__destroy_into_raw();et.__wbg_ltn_free(o)}constructor(o){try{const v=et.__wbindgen_add_to_stack_pointer(-16),T=ey(o,et.__wbindgen_malloc),s=Xn;et.ltn_new(v,T,s);var l=Tt()[v/4+0],c=Tt()[v/4+1],m=Tt()[v/4+2];if(m)throw mn(c);return this.__wbg_ptr=l>>>0,this}finally{et.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let o,l;try{const I=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_getInvertedBoundary(I,this.__wbg_ptr);var c=Tt()[I/4+0],m=Tt()[I/4+1],v=Tt()[I/4+2],T=Tt()[I/4+3],s=c,C=m;if(T)throw s=0,C=0,mn(v);return o=s,l=C,_n(s,C)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(o,l,1)}}getBounds(){try{const m=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_getBounds(m,this.__wbg_ptr);var o=Tt()[m/4+0],l=Tt()[m/4+1],c=ty(o,l).slice();return et.__wbindgen_free(o,l*8,8),c}finally{et.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const m=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_toRouteSnapper(m,this.__wbg_ptr);var o=Tt()[m/4+0],l=Tt()[m/4+1],c=iy(o,l).slice();return et.__wbindgen_free(o,l*1,1),c}finally{et.__wbindgen_add_to_stack_pointer(16)}}renderNeighbourhood(){let o,l;try{const I=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_renderNeighbourhood(I,this.__wbg_ptr);var c=Tt()[I/4+0],m=Tt()[I/4+1],v=Tt()[I/4+2],T=Tt()[I/4+3],s=c,C=m;if(T)throw s=0,C=0,mn(v);return o=s,l=C,_n(s,C)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(o,l,1)}}setNeighbourhoodBoundary(o,l){try{const v=et.__wbindgen_add_to_stack_pointer(-16),T=us(o,et.__wbindgen_malloc,et.__wbindgen_realloc),s=Xn;et.ltn_setNeighbourhoodBoundary(v,this.__wbg_ptr,T,s,er(l));var c=Tt()[v/4+0],m=Tt()[v/4+1];if(m)throw mn(c)}finally{et.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(o){const l=us(o,et.__wbindgen_malloc,et.__wbindgen_realloc),c=Xn;et.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,l,c)}setCurrentNeighbourhood(o){let l,c;try{const D=et.__wbindgen_add_to_stack_pointer(-16),q=us(o,et.__wbindgen_malloc,et.__wbindgen_realloc),ie=Xn;et.ltn_setCurrentNeighbourhood(D,this.__wbg_ptr,q,ie);var m=Tt()[D/4+0],v=Tt()[D/4+1],T=Tt()[D/4+2],s=Tt()[D/4+3],C=m,I=v;if(s)throw C=0,I=0,mn(T);return l=C,c=I,_n(C,I)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(l,c,1)}}addModalFilter(o,l){let c,m;try{const q=et.__wbindgen_add_to_stack_pointer(-16),ie=us(l,et.__wbindgen_malloc,et.__wbindgen_realloc),de=Xn;et.ltn_addModalFilter(q,this.__wbg_ptr,er(o),ie,de);var v=Tt()[q/4+0],T=Tt()[q/4+1],s=Tt()[q/4+2],C=Tt()[q/4+3],I=v,D=T;if(C)throw I=0,D=0,mn(s);return c=I,m=D,_n(I,D)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(c,m,1)}}addManyModalFilters(o,l){let c,m;try{const q=et.__wbindgen_add_to_stack_pointer(-16),ie=us(l,et.__wbindgen_malloc,et.__wbindgen_realloc),de=Xn;et.ltn_addManyModalFilters(q,this.__wbg_ptr,er(o),ie,de);var v=Tt()[q/4+0],T=Tt()[q/4+1],s=Tt()[q/4+2],C=Tt()[q/4+3],I=v,D=T;if(C)throw I=0,D=0,mn(s);return c=I,m=D,_n(I,D)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(c,m,1)}}deleteModalFilter(o){let l,c;try{const D=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_deleteModalFilter(D,this.__wbg_ptr,o);var m=Tt()[D/4+0],v=Tt()[D/4+1],T=Tt()[D/4+2],s=Tt()[D/4+3],C=m,I=v;if(s)throw C=0,I=0,mn(T);return l=C,c=I,_n(C,I)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(l,c,1)}}undo(){let o,l;try{const I=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_undo(I,this.__wbg_ptr);var c=Tt()[I/4+0],m=Tt()[I/4+1],v=Tt()[I/4+2],T=Tt()[I/4+3],s=c,C=m;if(T)throw s=0,C=0,mn(v);return o=s,l=C,_n(s,C)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(o,l,1)}}redo(){let o,l;try{const I=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_redo(I,this.__wbg_ptr);var c=Tt()[I/4+0],m=Tt()[I/4+1],v=Tt()[I/4+2],T=Tt()[I/4+3],s=c,C=m;if(T)throw s=0,C=0,mn(v);return o=s,l=C,_n(s,C)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(o,l,1)}}getShortcutsCrossingRoad(o){let l,c;try{const D=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_getShortcutsCrossingRoad(D,this.__wbg_ptr,o);var m=Tt()[D/4+0],v=Tt()[D/4+1],T=Tt()[D/4+2],s=Tt()[D/4+3],C=m,I=v;if(s)throw C=0,I=0,mn(T);return l=C,c=I,_n(C,I)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(l,c,1)}}toSavefile(){let o,l;try{const I=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_toSavefile(I,this.__wbg_ptr);var c=Tt()[I/4+0],m=Tt()[I/4+1],v=Tt()[I/4+2],T=Tt()[I/4+3],s=c,C=m;if(T)throw s=0,C=0,mn(v);return o=s,l=C,_n(s,C)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(o,l,1)}}loadSavefile(o){try{const m=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_loadSavefile(m,this.__wbg_ptr,er(o));var l=Tt()[m/4+0],c=Tt()[m/4+1];if(c)throw mn(l)}finally{et.__wbindgen_add_to_stack_pointer(16)}}compareRoute(o,l,c,m){let v,T;try{const de=et.__wbindgen_add_to_stack_pointer(-16);et.ltn_compareRoute(de,this.__wbg_ptr,o,l,c,m);var s=Tt()[de/4+0],C=Tt()[de/4+1],I=Tt()[de/4+2],D=Tt()[de/4+3],q=s,ie=C;if(D)throw q=0,ie=0,mn(I);return v=q,T=ie,_n(q,ie)}finally{et.__wbindgen_add_to_stack_pointer(16),et.__wbindgen_free(v,T,1)}}}async function ny(h,o){if(typeof Response=="function"&&h instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(h,o)}catch(c){if(h.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const l=await h.arrayBuffer();return await WebAssembly.instantiate(l,o)}else{const l=await WebAssembly.instantiate(h,o);return l instanceof WebAssembly.Instance?{instance:l,module:h}:l}}function oy(){const h={};return h.wbg={},h.wbg.__wbindgen_object_drop_ref=function(o){mn(o)},h.wbg.__wbindgen_error_new=function(o,l){const c=new Error(_n(o,l));return er(c)},h.wbg.__wbindgen_string_get=function(o,l){const c=Zt(l),m=typeof c=="string"?c:void 0;var v=ql(m)?0:us(m,et.__wbindgen_malloc,et.__wbindgen_realloc),T=Xn;Tt()[o/4+1]=T,Tt()[o/4+0]=v},h.wbg.__wbindgen_boolean_get=function(o){const l=Zt(o);return typeof l=="boolean"?l?1:0:2},h.wbg.__wbindgen_is_bigint=function(o){return typeof Zt(o)=="bigint"},h.wbg.__wbindgen_bigint_from_i64=function(o){return er(o)},h.wbg.__wbindgen_jsval_eq=function(o,l){return Zt(o)===Zt(l)},h.wbg.__wbindgen_bigint_from_u64=function(o){const l=BigInt.asUintN(64,o);return er(l)},h.wbg.__wbindgen_number_get=function(o,l){const c=Zt(l),m=typeof c=="number"?c:void 0;sm()[o/8+1]=ql(m)?0:m,Tt()[o/4+0]=!ql(m)},h.wbg.__wbindgen_is_object=function(o){const l=Zt(o);return typeof l=="object"&&l!==null},h.wbg.__wbindgen_in=function(o,l){return Zt(o)in Zt(l)},h.wbg.__wbindgen_string_new=function(o,l){const c=_n(o,l);return er(c)},h.wbg.__wbindgen_is_undefined=function(o){return Zt(o)===void 0},h.wbg.__wbindgen_object_clone_ref=function(o){const l=Zt(o);return er(l)},h.wbg.__wbindgen_jsval_loose_eq=function(o,l){return Zt(o)==Zt(l)},h.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(o,l){const c=Zt(o)[Zt(l)];return er(c)},h.wbg.__wbg_debug_34c9290896ec9856=function(o){console.debug(Zt(o))},h.wbg.__wbg_error_e60eff06f24ab7a4=function(o){console.error(Zt(o))},h.wbg.__wbg_info_d7d58472d0bab115=function(o){console.info(Zt(o))},h.wbg.__wbg_log_a4530b4fe289336f=function(o){console.log(Zt(o))},h.wbg.__wbg_warn_f260f49434e45e62=function(o){console.warn(Zt(o))},h.wbg.__wbg_get_f01601b5a68d10e3=function(o,l){const c=Zt(o)[l>>>0];return er(c)},h.wbg.__wbg_length_1009b1af0c481d7b=function(o){return Zt(o).length},h.wbg.__wbindgen_is_function=function(o){return typeof Zt(o)=="function"},h.wbg.__wbg_next_9b877f231f476d01=function(o){const l=Zt(o).next;return er(l)},h.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Hh(function(o){const l=Zt(o).next();return er(l)},arguments)},h.wbg.__wbg_done_5fe336b092d60cf2=function(o){return Zt(o).done},h.wbg.__wbg_value_0c248a78fdc8e19f=function(o){const l=Zt(o).value;return er(l)},h.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return er(Symbol.iterator)},h.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Hh(function(o,l){const c=Reflect.get(Zt(o),Zt(l));return er(c)},arguments)},h.wbg.__wbg_call_90c26b09837aba1c=function(){return Hh(function(o,l){const c=Zt(o).call(Zt(l));return er(c)},arguments)},h.wbg.__wbg_isArray_74fb723e24f76012=function(o){return Array.isArray(Zt(o))},h.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(o){let l;try{l=Zt(o)instanceof ArrayBuffer}catch{l=!1}return l},h.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(o){return Number.isSafeInteger(Zt(o))},h.wbg.__wbg_entries_9e2e2aa45aa5094a=function(o){const l=Object.entries(Zt(o));return er(l)},h.wbg.__wbg_buffer_a448f833075b71ba=function(o){const l=Zt(o).buffer;return er(l)},h.wbg.__wbg_new_8f67e318f15d7254=function(o){const l=new Uint8Array(Zt(o));return er(l)},h.wbg.__wbg_set_2357bf09366ee480=function(o,l,c){Zt(o).set(Zt(l),c>>>0)},h.wbg.__wbg_length_1d25fa9e4ac21ce7=function(o){return Zt(o).length},h.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(o){let l;try{l=Zt(o)instanceof Uint8Array}catch{l=!1}return l},h.wbg.__wbg_new_abda76e883ba8a5f=function(){const o=new Error;return er(o)},h.wbg.__wbg_stack_658279fe44541cf6=function(o,l){const c=Zt(l).stack,m=us(c,et.__wbindgen_malloc,et.__wbindgen_realloc),v=Xn;Tt()[o/4+1]=v,Tt()[o/4+0]=m},h.wbg.__wbg_error_f851667af71bcfc6=function(o,l){let c,m;try{c=o,m=l,console.error(_n(o,l))}finally{et.__wbindgen_free(c,m,1)}},h.wbg.__wbindgen_bigint_get_as_i64=function(o,l){const c=Zt(l),m=typeof c=="bigint"?c:void 0;Qg()[o/8+1]=ql(m)?BigInt(0):m,Tt()[o/4+0]=!ql(m)},h.wbg.__wbindgen_debug_string=function(o,l){const c=rd(Zt(l)),m=us(c,et.__wbindgen_malloc,et.__wbindgen_realloc),v=Xn;Tt()[o/4+1]=v,Tt()[o/4+0]=m},h.wbg.__wbindgen_throw=function(o,l){throw new Error(_n(o,l))},h.wbg.__wbindgen_memory=function(){const o=et.memory;return er(o)},h}function sy(h,o){return et=h.exports,am.__wbindgen_wasm_module=o,Kl=null,Hl=null,Wl=null,Xl=null,et}async function am(h){if(et!==void 0)return et;typeof h>"u"&&(h="/ltn/assets/backend_bg.wasm");const o=oy();(typeof h=="string"||typeof Request=="function"&&h instanceof Request||typeof URL=="function"&&h instanceof URL)&&(h=fetch(h));const{instance:l,module:c}=await ny(await h,o);return sy(l,c)}let At;const lm=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&lm.decode();let Yl=null;function ic(){return(Yl===null||Yl.byteLength===0)&&(Yl=new Uint8Array(At.memory.buffer)),Yl}function Uo(h,o){return h=h>>>0,lm.decode(ic().subarray(h,h+o))}const jo=new Array(128).fill(void 0);jo.push(void 0,null,!0,!1);let rc=jo.length;function kr(h){rc===jo.length&&jo.push(jo.length+1);const o=rc;return rc=jo[o],jo[o]=h,o}function ti(h){return jo[h]}function ay(h){h<132||(jo[h]=rc,rc=h)}function Iu(h){const o=ti(h);return ay(h),o}function Kh(h){return h==null}let Jl=null;function ly(){return(Jl===null||Jl.byteLength===0)&&(Jl=new Float64Array(At.memory.buffer)),Jl}let $l=null;function Fi(){return($l===null||$l.byteLength===0)&&($l=new Int32Array(At.memory.buffer)),$l}let hs=0;const Mu=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},cy=typeof Mu.encodeInto=="function"?function(h,o){return Mu.encodeInto(h,o)}:function(h,o){const l=Mu.encode(h);return o.set(l),{read:h.length,written:l.length}};function wu(h,o,l){if(l===void 0){const s=Mu.encode(h),C=o(s.length,1)>>>0;return ic().subarray(C,C+s.length).set(s),hs=s.length,C}let c=h.length,m=o(c,1)>>>0;const v=ic();let T=0;for(;T<c;T++){const s=h.charCodeAt(T);if(s>127)break;v[m+T]=s}if(T!==c){T!==0&&(h=h.slice(T)),m=l(m,c,c=T+h.length*3,1)>>>0;const s=ic().subarray(m+T,m+c),C=cy(h,s);T+=C.written}return hs=T,m}function nd(h){const o=typeof h;if(o=="number"||o=="boolean"||h==null)return`${h}`;if(o=="string")return`"${h}"`;if(o=="symbol"){const m=h.description;return m==null?"Symbol":`Symbol(${m})`}if(o=="function"){const m=h.name;return typeof m=="string"&&m.length>0?`Function(${m})`:"Function"}if(Array.isArray(h)){const m=h.length;let v="[";m>0&&(v+=nd(h[0]));for(let T=1;T<m;T++)v+=", "+nd(h[T]);return v+="]",v}const l=/\[object ([^\]]+)\]/.exec(toString.call(h));let c;if(l.length>1)c=l[1];else return toString.call(h);if(c=="Object")try{return"Object("+JSON.stringify(h)+")"}catch{return"Object"}return h instanceof Error?`${h.name}: ${h.message}
${h.stack}`:c}function uy(h,o){const l=o(h.length*1,1)>>>0;return ic().set(h,l/1),hs=h.length,l}function Yh(h,o){try{return h.apply(this,o)}catch(l){At.__wbindgen_exn_store(kr(l))}}class Au{static __wrap(o){o=o>>>0;const l=Object.create(Au.prototype);return l.__wbg_ptr=o,l}__destroy_into_raw(){const o=this.__wbg_ptr;return this.__wbg_ptr=0,o}free(){const o=this.__destroy_into_raw();At.__wbg_jsroutesnapper_free(o)}constructor(o){try{const v=At.__wbindgen_add_to_stack_pointer(-16),T=uy(o,At.__wbindgen_malloc),s=hs;At.jsroutesnapper_new(v,T,s);var l=Fi()[v/4+0],c=Fi()[v/4+1],m=Fi()[v/4+2];if(m)throw Iu(c);return Au.__wrap(l)}finally{At.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(o){At.jsroutesnapper_setRouteConfig(this.__wbg_ptr,kr(o))}setAreaMode(){At.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let o,l;try{const v=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_getConfig(v,this.__wbg_ptr);var c=Fi()[v/4+0],m=Fi()[v/4+1];return o=c,l=m,Uo(c,m)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(o,l,1)}}toFinalFeature(){try{const c=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_toFinalFeature(c,this.__wbg_ptr);var o=Fi()[c/4+0],l=Fi()[c/4+1];let m;return o!==0&&(m=Uo(o,l).slice(),At.__wbindgen_free(o,l*1)),m}finally{At.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let o,l;try{const v=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_renderGeojson(v,this.__wbg_ptr);var c=Fi()[v/4+0],m=Fi()[v/4+1];return o=c,l=m,Uo(c,m)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(o,l,1)}}toggleSnapMode(){At.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(o,l,c){return At.jsroutesnapper_onMouseMove(this.__wbg_ptr,o,l,c)!==0}onClick(){At.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return At.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return At.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){At.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(o){try{const m=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_editExisting(m,this.__wbg_ptr,kr(o));var l=Fi()[m/4+0],c=Fi()[m/4+1];if(c)throw Iu(l)}finally{At.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let o,l;try{const v=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_debugRenderGraph(v,this.__wbg_ptr);var c=Fi()[v/4+0],m=Fi()[v/4+1];return o=c,l=m,Uo(c,m)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(o,l,1)}}routeNameForWaypoints(o){let l,c;try{const D=At.__wbindgen_add_to_stack_pointer(-16);At.jsroutesnapper_routeNameForWaypoints(D,this.__wbg_ptr,kr(o));var m=Fi()[D/4+0],v=Fi()[D/4+1],T=Fi()[D/4+2],s=Fi()[D/4+3],C=m,I=v;if(s)throw C=0,I=0,Iu(T);return l=C,c=I,Uo(C,I)}finally{At.__wbindgen_add_to_stack_pointer(16),At.__wbindgen_free(l,c,1)}}addSnappedWaypoint(o,l){At.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,o,l)}undo(){At.jsroutesnapper_undo(this.__wbg_ptr)}}async function hy(h,o){if(typeof Response=="function"&&h instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(h,o)}catch(c){if(h.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",c);else throw c}const l=await h.arrayBuffer();return await WebAssembly.instantiate(l,o)}else{const l=await WebAssembly.instantiate(h,o);return l instanceof WebAssembly.Instance?{instance:l,module:h}:l}}function dy(){const h={};return h.wbg={},h.wbg.__wbindgen_string_new=function(o,l){const c=Uo(o,l);return kr(c)},h.wbg.__wbindgen_object_drop_ref=function(o){Iu(o)},h.wbg.__wbindgen_error_new=function(o,l){const c=new Error(Uo(o,l));return kr(c)},h.wbg.__wbindgen_is_object=function(o){const l=ti(o);return typeof l=="object"&&l!==null},h.wbg.__wbindgen_is_undefined=function(o){return ti(o)===void 0},h.wbg.__wbindgen_in=function(o,l){return ti(o)in ti(l)},h.wbg.__wbindgen_number_get=function(o,l){const c=ti(l),m=typeof c=="number"?c:void 0;ly()[o/8+1]=Kh(m)?0:m,Fi()[o/4+0]=!Kh(m)},h.wbg.__wbindgen_boolean_get=function(o){const l=ti(o);return typeof l=="boolean"?l?1:0:2},h.wbg.__wbindgen_object_clone_ref=function(o){const l=ti(o);return kr(l)},h.wbg.__wbindgen_jsval_loose_eq=function(o,l){return ti(o)==ti(l)},h.wbg.__wbindgen_string_get=function(o,l){const c=ti(l),m=typeof c=="string"?c:void 0;var v=Kh(m)?0:wu(m,At.__wbindgen_malloc,At.__wbindgen_realloc),T=hs;Fi()[o/4+1]=T,Fi()[o/4+0]=v},h.wbg.__wbg_String_4370c5505c674d30=function(o,l){const c=String(ti(l)),m=wu(c,At.__wbindgen_malloc,At.__wbindgen_realloc),v=hs;Fi()[o/4+1]=v,Fi()[o/4+0]=m},h.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(o,l){const c=ti(o)[ti(l)];return kr(c)},h.wbg.__wbg_new_abda76e883ba8a5f=function(){const o=new Error;return kr(o)},h.wbg.__wbg_stack_658279fe44541cf6=function(o,l){const c=ti(l).stack,m=wu(c,At.__wbindgen_malloc,At.__wbindgen_realloc),v=hs;Fi()[o/4+1]=v,Fi()[o/4+0]=m},h.wbg.__wbg_error_f851667af71bcfc6=function(o,l){let c,m;try{c=o,m=l,console.error(Uo(o,l))}finally{At.__wbindgen_free(c,m,1)}},h.wbg.__wbg_debug_9a6b3243fbbebb61=function(o){console.debug(ti(o))},h.wbg.__wbg_error_788ae33f81d3b84b=function(o){console.error(ti(o))},h.wbg.__wbg_info_2e30e8204b29d91d=function(o){console.info(ti(o))},h.wbg.__wbg_log_1d3ae0273d8f4f8a=function(o){console.log(ti(o))},h.wbg.__wbg_warn_d60e832f9882c1b2=function(o){console.warn(ti(o))},h.wbg.__wbg_get_44be0491f933a435=function(o,l){const c=ti(o)[l>>>0];return kr(c)},h.wbg.__wbg_length_fff51ee6522a1a18=function(o){return ti(o).length},h.wbg.__wbindgen_is_function=function(o){return typeof ti(o)=="function"},h.wbg.__wbg_next_526fc47e980da008=function(o){const l=ti(o).next;return kr(l)},h.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Yh(function(o){const l=ti(o).next();return kr(l)},arguments)},h.wbg.__wbg_done_5c1f01fb660d73b5=function(o){return ti(o).done},h.wbg.__wbg_value_1695675138684bd5=function(o){const l=ti(o).value;return kr(l)},h.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return kr(Symbol.iterator)},h.wbg.__wbg_get_97b561fb56f034b5=function(){return Yh(function(o,l){const c=Reflect.get(ti(o),ti(l));return kr(c)},arguments)},h.wbg.__wbg_call_cb65541d95d71282=function(){return Yh(function(o,l){const c=ti(o).call(ti(l));return kr(c)},arguments)},h.wbg.__wbg_isArray_4c24b343cb13cfb1=function(o){return Array.isArray(ti(o))},h.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(o){let l;try{l=ti(o)instanceof ArrayBuffer}catch{l=!1}return l},h.wbg.__wbg_buffer_085ec1f694018c4f=function(o){const l=ti(o).buffer;return kr(l)},h.wbg.__wbg_new_8125e318e6245eed=function(o){const l=new Uint8Array(ti(o));return kr(l)},h.wbg.__wbg_set_5cf90238115182c3=function(o,l,c){ti(o).set(ti(l),c>>>0)},h.wbg.__wbg_length_72e2208bbc0efc61=function(o){return ti(o).length},h.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(o){let l;try{l=ti(o)instanceof Uint8Array}catch{l=!1}return l},h.wbg.__wbindgen_debug_string=function(o,l){const c=nd(ti(l)),m=wu(c,At.__wbindgen_malloc,At.__wbindgen_realloc),v=hs;Fi()[o/4+1]=v,Fi()[o/4+0]=m},h.wbg.__wbindgen_throw=function(o,l){throw new Error(Uo(o,l))},h.wbg.__wbindgen_memory=function(){const o=At.memory;return kr(o)},h}function py(h,o){return At=h.exports,cm.__wbindgen_wasm_module=o,Jl=null,$l=null,Yl=null,At}async function cm(h){if(At!==void 0)return At;typeof h>"u"&&(h="/ltn/assets/route_snapper_bg.wasm");const o=dy();(typeof h=="string"||typeof Request=="function"&&h instanceof Request||typeof URL=="function"&&h instanceof URL)&&(h=fetch(h));const{instance:l,module:c}=await hy(await h,o);return py(l,c)}const Ma=[];function Jh(h,o){return{subscribe:or(h,o).subscribe}}function or(h,o=Vt){let l;const c=new Set;function m(s){if(oi(h,s)&&(h=s,l)){const C=!Ma.length;for(const I of c)I[1](),Ma.push(I,h);if(C){for(let I=0;I<Ma.length;I+=2)Ma[I][0](Ma[I+1]);Ma.length=0}}}function v(s){m(s(h))}function T(s,C=Vt){const I=[s,C];return c.add(I),c.size===1&&(l=o(m,v)||Vt),s(h),()=>{c.delete(I),c.size===0&&l&&(l(),l=null)}}return{set:m,update:v,subscribe:T}}let fy=Date.now();function uc(h){return`${h}-${fy++}`}const dd=Symbol.for("svelte-maplibre");function Ba(){return Gg(dd)}function my(h){let o=new WeakMap;return l=>{var T;let c=o.get(l.originalEvent);if(c!==void 0)return c;let v=(T=l.target.queryRenderedFeatures(l.point).find(s=>{var C;return(C=h.get(s.layer.id))==null?void 0:C.interactive}))==null?void 0:T.layer.id;return o.set(l.originalEvent,v),v}}function _y(){let h=new Map;return tm(dd,{map:or(null),source:Jh(null),layer:Jh(null),popupTarget:Jh(null),cluster:or(),loadedImages:or(new Set),minzoom:or(0),maxzoom:or(24),layerEvent:or(null),layerInfo:h,eventTopMost:my(h)})}function lf(h){return{subscribe:h.subscribe}}function pd({key:h,setPopupTarget:o=!1,setCluster:l=!1,setMouseEvent:c=!1}){let m=Ba(),v=or(null),T=lf(v),s={...m,[h]:lf(v)};if(o&&(s.popupTarget=T),c){let C=or(null);s.layerEvent=C,m.layerEvent=C}return l&&(s.cluster=or()),tm(dd,s),{...m,self:v}}function gy(){return pd({key:"source",setCluster:!0})}function yy(h=!0){return pd({key:"layer",setPopupTarget:h,setMouseEvent:h})}function vy(){return pd({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function by(h){return"layerType"in h&&h.layerType==="deckgl"}var um=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hm(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}function dm(h){if(h.__esModule)return h;var o=h.default;if(typeof o=="function"){var l=function c(){return this instanceof c?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};l.prototype=o.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(h).forEach(function(c){var m=Object.getOwnPropertyDescriptor(h,c);Object.defineProperty(l,c,m.get?m:{enumerable:!0,get:function(){return h[c]}})}),l}var pm={exports:{}};(function(h,o){(function(l,c){h.exports=c()})(um,function(){var l,c,m;function v(s,C){if(!l)l=C;else if(!c)c=C;else{var I="var sharedChunk = {}; ("+l+")(sharedChunk); ("+c+")(sharedChunk);",D={};l(D),m=C(D),typeof window<"u"&&(m.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}v(["exports"],function(s){function C(i,e,r,a){return new(r||(r=Promise))(function(d,_){function y(M){try{S(a.next(M))}catch(E){_(E)}}function b(M){try{S(a.throw(M))}catch(E){_(E)}}function S(M){var E;M.done?d(M.value):(E=M.value,E instanceof r?E:new r(function(L){L(E)})).then(y,b)}S((a=a.apply(i,e||[])).next())})}function I(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var D=q;function q(i,e){this.x=i,this.y=e}q.prototype={clone:function(){return new q(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,e){var r=Math.cos(i),a=Math.sin(i),d=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},q.convert=function(i){return i instanceof q?i:Array.isArray(i)?new q(i[0],i[1]):i};var ie=I(D),de=oe;function oe(i,e,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=r,this.p2y=a}oe.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var d=this.sampleCurveX(r)-i;if(Math.abs(d)<e)return r;var _=this.sampleCurveDerivativeX(r);if(Math.abs(_)<1e-6)break;r-=d/_}var y=0,b=1;for(r=i,a=0;a<20&&(d=this.sampleCurveX(r),!(Math.abs(d-i)<e));a++)i>d?y=r:b=r,r=.5*(b-y)+y;return r},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}};var Te=I(de);let me,ye;function W(){return me==null&&(me=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),me}function re(){if(ye==null&&(ye=!1,W())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let a=0;a<5*5;a++){const d=4*a;e.fillStyle=`rgb(${d},${d+1},${d+2})`,e.fillRect(a%5,Math.floor(a/5),1,1)}const r=e.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){ye=!0;break}}}return ye||!1}function le(i,e,r,a){const d=new Te(i,e,r,a);return function(_){return d.solve(_)}}const xe=le(.25,.1,.25,1);function Ee(i,e,r){return Math.min(r,Math.max(e,i))}function Ie(i,e,r){const a=r-e,d=((i-e)%a+a)%a+e;return d===e?r:d}function Oe(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}let qe=1;function He(i,e,r){const a={};for(const d in i)a[d]=e.call(r||this,i[d],d,i);return a}function be(i,e,r){const a={};for(const d in i)e.call(r||this,i[d],d,i)&&(a[d]=i[d]);return a}function Ue(i){return Array.isArray(i)?i.map(Ue):typeof i=="object"&&i?He(i,Ue):i}const xt={};function Ne(i){xt[i]||(typeof console<"u"&&console.warn(i),xt[i]=!0)}function vt(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function gt(i){let e=0;for(let r,a,d=0,_=i.length,y=_-1;d<_;y=d++)r=i[d],a=i[y],e+=(a.x-r.x)*(r.y+a.y);return e}function dt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Ft=null;function sr(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Jt(i,e,r,a,d){return C(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(i,{timestamp:0});try{const y=_==null?void 0:_.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const b=y.startsWith("BGR"),S=new Uint8ClampedArray(a*d*4);if(yield _.copyTo(S,function(M,E,L,F,N){const V=4*Math.max(-E,0),Z=(Math.max(0,L)-L)*F*4+V,J=4*F,ee=Math.max(0,E),he=Math.max(0,L);return{rect:{x:ee,y:he,width:Math.min(M.width,E+F)-ee,height:Math.min(M.height,L+N)-he},layout:[{offset:Z,stride:J}]}}(i,e,r,a,d)),b)for(let M=0;M<S.length;M+=4){const E=S[M];S[M]=S[M+2],S[M+2]=E}return S}finally{_.close()}})}let Ut,Rt,fi,Yi;const Ge={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){return this.getImageCanvasContext(i).getImageData(-e,-e,i.width+2*e,i.height+2*e)},getImageCanvasContext(i){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=i.width,e.height=i.height,r.drawImage(i,0,0,i.width,i.height),r},resolveURL:i=>(fi||(fi=document.createElement("a")),fi.href=i,fi.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Yi==null&&(Yi=matchMedia("(prefers-reduced-motion: reduce)")),Yi.matches)}},Ct={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Je extends Error{constructor(e,r,a,d){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=d}}const mi=dt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ht=i=>Ct.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))];function wi(i,e){const r=new AbortController,a=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,cache:i.cache,referrer:mi(),signal:r.signal});let d=!1,_=!1;return i.type==="json"&&a.headers.set("Accept","application/json"),_||fetch(a).then(y=>y.ok?(b=>{(i.type==="arrayBuffer"||i.type==="image"?b.arrayBuffer():i.type==="json"?b.json():b.text()).then(S=>{_||(d=!0,e(null,S,b.headers.get("Cache-Control"),b.headers.get("Expires")))}).catch(S=>{_||e(new Error(S.message))})})(y):y.blob().then(b=>e(new Je(y.status,y.statusText,i.url,b)))).catch(y=>{y.code!==20&&e(new Error(y.message))}),{cancel:()=>{_=!0,d||r.abort()}}}const Zi=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(dt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e);if(!dt())return(Ht(i.url)||wi)(i,e)}if(!(/^file:/.test(r=i.url)||/^file:/.test(mi())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return wi(i,e);if(dt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(a,d){const _=new XMLHttpRequest;_.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(_.responseType="arraybuffer");for(const y in a.headers)_.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=a.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(a.type==="json")try{y=JSON.parse(_.response)}catch(b){return d(b)}d(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else{const y=new Blob([_.response],{type:_.getResponseHeader("Content-Type")});d(new Je(_.status,_.statusText,a.url,y))}},_.send(a.body),{cancel:()=>_.abort()}}(i,e)},Xe=function(i,e){return Zi(Oe(i,{type:"arrayBuffer"}),e)};function Ti(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function Gi(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function rn(i,e,r){if(r&&r[i]){const a=r[i].indexOf(e);a!==-1&&r[i].splice(a,1)}}class Mn{constructor(e,r={}){Oe(this,r),this.type=e}}class zr extends Mn{constructor(e,r={}){super("error",Oe({error:e},r))}}class gr{on(e,r){return this._listeners=this._listeners||{},Gi(e,r,this._listeners),this}off(e,r){return rn(e,r,this._listeners),rn(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Gi(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Mn(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const d=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const b of d)b.call(this,e);const _=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const b of _)rn(a,b,this._oneTimeListeners),b.call(this,e);const y=this._eventedParent;y&&(Oe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof zr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Lr(i,e){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return vr.forEach(a=>{a in e&&(r[a]=e[a])}),r}function ai(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!ai(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!ai(i[r],e[r]))return!1;return!0}return i===e}const Ot={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function nn(i,e,r){r.push({command:Ot.addSource,args:[i,e[i]]})}function Cn(i,e,r){e.push({command:Ot.removeSource,args:[i]}),r[i]=!0}function tr(i,e,r,a){Cn(i,r,a),nn(i,e,r)}function Oi(i,e,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!ai(i[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!ai(i[r][a],e[r][a]))return!1;return!0}function ii(i,e,r,a,d,_){let y;for(y in e=e||{},i=i||{})Object.prototype.hasOwnProperty.call(i,y)&&(ai(i[y],e[y])||r.push({command:_,args:[a,y,e[y],d]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(ai(i[y],e[y])||r.push({command:_,args:[a,y,e[y],d]}))}function Ni(i){return i.id}function xo(i,e){return i[e.id]=e,i}class Ye{constructor(e,r,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)}}function Fn(i,...e){for(const r of e)for(const a in r)i[a]=r[a];return i}class Vi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class wo{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,d]of r)this.bindings[a]=d}concat(e){return new wo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Jn={kind:"null"},Qe={kind:"number"},jt={kind:"string"},zt={kind:"boolean"},Dr={kind:"color"},Rn={kind:"object"},Bt={kind:"value"},$n={kind:"collator"},H={kind:"formatted"},B={kind:"padding"},R={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function Y(i,e){return{kind:"array",itemType:i,N:e}}function $(i){if(i.kind==="array"){const e=$(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const pe=[Jn,Qe,jt,zt,Dr,H,Rn,Y(Bt),B,R,U];function se(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!se(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of pe)if(!se(r,e))return null}}return`Expected ${$(i)} but found ${$(e)} instead.`}function te(i,e){return e.some(r=>r.kind===i.kind)}function ue(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function Pe(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const ze=.96422,Be=.82521,wt=4/29,Pt=6/29,pt=3*Pt*Pt,kt=Pt*Pt*Pt,Lt=Math.PI/180,pi=180/Math.PI;function vi(i){return(i%=360)<0&&(i+=360),i}function ni([i,e,r,a]){let d,_;const y=Ir((.2225045*(i=ri(i))+.7168786*(e=ri(e))+.0606169*(r=ri(r)))/1);i===e&&e===r?d=_=y:(d=Ir((.4360747*i+.3850649*e+.1430804*r)/ze),_=Ir((.0139322*i+.0971045*e+.7141733*r)/Be));const b=116*y-16;return[b<0?0:b,500*(d-y),200*(y-_),a]}function ri(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ir(i){return i>kt?Math.pow(i,1/3):i/pt+wt}function ki([i,e,r,a]){let d=(i+16)/116,_=isNaN(e)?d:d+e/500,y=isNaN(r)?d:d-r/200;return d=1*br(d),_=ze*br(_),y=Be*br(y),[ir(3.1338561*_-1.6168667*d-.4906146*y),ir(-.9787684*_+1.9161415*d+.033454*y),ir(.0719453*_-.2289914*d+1.4052427*y),a]}function ir(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function br(i){return i>Pt?i*i*i:pt*(i-wt)}function yn(i){return parseInt(i.padEnd(2,i),16)/255}function fc(i,e){return Zo(e?i/100:i,0,1)}function Zo(i,e,r){return Math.min(Math.max(e,i),r)}function Go(i){return!i.some(Number.isNaN)}const Vu={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class gi{constructor(e,r,a,d=1,_=!0){this.r=e,this.g=r,this.b=a,this.a=d,_||(this.r*=d,this.g*=d,this.b*=d,d||this.overwriteGetter("rgb",[e,r,a,d]))}static parse(e){if(e instanceof gi)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const d=Vu[a];if(d){const[y,b,S]=d;return[y/255,b/255,S/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let b=1;return[yn(a.slice(b,b+=y)),yn(a.slice(b,b+=y)),yn(a.slice(b,b+=y)),yn(a.slice(b,b+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[b,S,M,E,L,F,N,V,Z,J,ee,he]=y,ne=[E||" ",N||" ",J].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const fe=[M,F,Z].join(""),ve=fe==="%%%"?100:fe===""?255:0;if(ve){const De=[Zo(+S/ve,0,1),Zo(+L/ve,0,1),Zo(+V/ve,0,1),ee?fc(+ee,he):1];if(Go(De))return De}}return}}const _=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[y,b,S,M,E,L,F,N,V]=_,Z=[S||" ",E||" ",F].join("");if(Z==="  "||Z==="  /"||Z===",,"||Z===",,,"){const J=[+b,Zo(+M,0,100),Zo(+L,0,100),N?fc(+N,V):1];if(Go(J))return function([ee,he,ne,fe]){function ve(De){const ot=(De+ee/30)%12,mt=he*Math.min(ne,1-ne);return ne-mt*Math.max(-1,Math.min(ot-3,9-ot,1))}return ee=vi(ee),he/=100,ne/=100,[ve(0),ve(8),ve(4),fe]}(J)}}}(e);return r?new gi(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:d}=this,_=d||1/0;return this.overwriteGetter("rgb",[e/_,r/_,a/_,d])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,d,_]=ni(e),y=Math.sqrt(a*a+d*d);return[Math.round(1e4*y)?vi(Math.atan2(d,a)*pi):NaN,y,r,_]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ni(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,d]=this.rgb;return`rgba(${[e,r,a].map(_=>Math.round(255*_)).join(",")},${d})`}}gi.black=new gi(0,0,0,1),gi.white=new gi(1,1,1,1),gi.transparent=new gi(0,0,0,0),gi.red=new gi(1,0,0,1);class Ra{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Us{constructor(e,r,a,d,_){this.text=e,this.image=r,this.scale=a,this.fontStack=d,this.textColor=_}}class Mr{constructor(e){this.sections=e}static fromString(e){return new Mr([new Us(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Mr?e:Mr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class on{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof on)return e;if(typeof e=="number")return new on([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new on(e)}}toString(){return JSON.stringify(this.values)}}const Uu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class vn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof vn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let r=0;r<e.length;r+=2){const a=e[r],d=e[r+1];if(typeof a!="string"||!Uu.has(a)||!Array.isArray(d)||d.length!==2||typeof d[0]!="number"||typeof d[1]!="number")return}return new vn(e)}}toString(){return JSON.stringify(this.values)}}class xr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new xr({name:e,available:!1}):null}}function js(i,e,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,e,r,a]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof gi||i instanceof Ra||i instanceof Mr||i instanceof on||i instanceof vn||i instanceof xr)return!0;if(Array.isArray(i)){for(const e of i)if(!Xo(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!Xo(i[e]))return!1;return!0}return!1}function zi(i){if(i===null)return Jn;if(typeof i=="string")return jt;if(typeof i=="boolean")return zt;if(typeof i=="number")return Qe;if(i instanceof gi)return Dr;if(i instanceof Ra)return $n;if(i instanceof Mr)return H;if(i instanceof on)return B;if(i instanceof vn)return U;if(i instanceof xr)return R;if(Array.isArray(i)){const e=i.length;let r;for(const a of i){const d=zi(a);if(r){if(r===d)continue;r=Bt;break}r=d}return Y(r||Bt,e)}return Rn}function li(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof gi||i instanceof Mr||i instanceof on||i instanceof vn||i instanceof xr?i.toString():JSON.stringify(i)}class So{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Xo(e[1]))return r.error("invalid value");const a=e[1];let d=zi(a);const _=r.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new So(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ui{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const qs={string:jt,number:Qe,boolean:zt,object:Rn};class bn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,d=1;const _=e[0];if(_==="array"){let b,S;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in qs)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);b=qs[M],d++}else b=Bt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],d++}a=Y(b,S)}else{if(!qs[_])throw new Error(`Types doesn't contain name = ${_}`);a=qs[_]}const y=[];for(;d<e.length;d++){const b=r.parse(e[d],d,Bt);if(!b)return null;y.push(b)}return new bn(a,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!se(this.type,zi(a)))return a;if(r===this.args.length-1)throw new Ui(`Expected value to be of type ${$(this.type)}, but found ${$(zi(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Oa={"to-boolean":zt,"to-color":Dr,"to-number":Qe,"to-string":jt};class co{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!Oa[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const d=Oa[a],_=[];for(let y=1;y<e.length;y++){const b=r.parse(e[y],y,Bt);if(!b)return null;_.push(b)}return new co(d,_)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let r,a;for(const d of this.args){if(r=d.evaluate(e),a=null,r instanceof gi)return r;if(typeof r=="string"){const _=e.parseColor(r);if(_)return _}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:js(r[0],r[1],r[2],r[3]),!a))return new gi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ui(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(e);const d=on.parse(r);if(d)return d}throw new Ui(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(e);const d=vn.parse(r);if(d)return d}throw new Ui(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const d=Number(r);if(!isNaN(d))return d}throw new Ui(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Mr.fromString(li(this.args[0].evaluate(e)));case"resolvedImage":return xr.fromString(li(this.args[0].evaluate(e)));default:return li(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const mc=["Unknown","Point","LineString","Polygon"];class Na{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=gi.parse(e)),r}}class Zs{constructor(e,r,a=[],d,_=new wo,y=[]){this.registry=e,this.path=a,this.key=a.map(b=>`[${b}]`).join(""),this.scope=_,this.errors=y,this.expectedType=d,this._isConstant=r}parse(e,r,a,d,_={}){return r?this.concat(r,a,d)._parse(e,_):this._parse(e,_)}_parse(e,r){function a(d,_,y){return y==="assert"?new bn(_,[d]):y==="coerce"?new co(_,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[d];if(_){let y=_.parse(e,this);if(!y)return null;if(this.expectedType){const b=this.expectedType,S=y.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||S.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(b.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||S.kind!=="value"&&S.kind!=="array"){if(this.checkSubtype(b,S))return null}else y=a(y,b,r.typeAnnotation||"coerce");else y=a(y,b,r.typeAnnotation||"coerce");else y=a(y,b,r.typeAnnotation||"coerce");else y=a(y,b,r.typeAnnotation||"assert")}if(!(y instanceof So)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const b=new Na;try{y=new So(y.type,y.evaluate(b))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const d=typeof e=="number"?this.path.concat(e):this.path,_=a?this.scope.concat(a):this.scope;return new Zs(this.registry,this._isConstant,d,r||null,_,this.errors)}error(e,...r){const a=`${this.key}${r.map(d=>`[${d}]`).join("")}`;this.errors.push(new Vi(a,e))}checkSubtype(e,r){const a=se(e,r);return a&&this.error(a),a}}class Gs{constructor(e,r,a){this.type=$n,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const d=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,zt);if(!d)return null;const _=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,zt);if(!_)return null;let y=null;return a.locale&&(y=r.parse(a.locale,1,jt),!y)?null:new Gs(d,_,y)}evaluate(e){return new Ra(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const uo=8192;function Va(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function ps(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function _c(i,e){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(r*d*uo),Math.round(a*d*uo)]}function ju(i,e,r){const a=i[0]-e[0],d=i[1]-e[1],_=i[0]-r[0],y=i[1]-r[1];return a*y-_*d==0&&a*_<=0&&d*y<=0}function Ua(i,e){let r=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let M=0,E=S.length;M<E-1;M++){if(ju(i,S[M],S[M+1]))return!1;(d=S[M])[1]>(a=i)[1]!=(_=S[M+1])[1]>a[1]&&a[0]<(_[0]-d[0])*(a[1]-d[1])/(_[1]-d[1])+d[0]&&(r=!r)}}var a,d,_;return r}function ja(i,e){for(let r=0;r<e.length;r++)if(Ua(i,e[r]))return!0;return!1}function gc(i,e,r,a){const d=a[0]-r[0],_=a[1]-r[1],y=(i[0]-r[0])*_-d*(i[1]-r[1]),b=(e[0]-r[0])*_-d*(e[1]-r[1]);return y>0&&b<0||y<0&&b>0}function qu(i,e,r){for(const M of r)for(let E=0;E<M.length-1;++E)if((b=[(y=M[E+1])[0]-(_=M[E])[0],y[1]-_[1]])[0]*(S=[(d=e)[0]-(a=i)[0],d[1]-a[1]])[1]-b[1]*S[0]!=0&&gc(a,d,_,y)&&gc(_,y,a,d))return!0;var a,d,_,y,b,S;return!1}function yc(i,e){for(let r=0;r<i.length;++r)if(!Ua(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(qu(i[r],i[r+1],e))return!1;return!0}function vc(i,e){for(let r=0;r<e.length;r++)if(yc(i,e[r]))return!0;return!1}function Xs(i,e,r){const a=[];for(let d=0;d<i.length;d++){const _=[];for(let y=0;y<i[d].length;y++){const b=_c(i[d][y],r);Va(e,b),_.push(b)}a.push(_)}return a}function bc(i,e,r){const a=[];for(let d=0;d<i.length;d++){const _=Xs(i[d],e,r);a.push(_)}return a}function xc(i,e,r,a){if(i[0]<r[0]||i[0]>r[2]){const d=.5*a;let _=i[0]-r[0]>d?-a:r[0]-i[0]>d?a:0;_===0&&(_=i[0]-r[2]>d?-a:r[2]-i[0]>d?a:0),i[0]+=_}Va(e,i)}function qa(i,e,r,a){const d=Math.pow(2,a.z)*uo,_=[a.x*uo,a.y*uo],y=[];for(const b of i)for(const S of b){const M=[S.x+_[0],S.y+_[1]];xc(M,e,r,d),y.push(M)}return y}function Za(i,e,r,a){const d=Math.pow(2,a.z)*uo,_=[a.x*uo,a.y*uo],y=[];for(const S of i){const M=[];for(const E of S){const L=[E.x+_[0],E.y+_[1]];Va(e,L),M.push(L)}y.push(M)}if(e[2]-e[0]<=d/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of y)for(const M of S)xc(M,e,r,d)}var b;return y}class To{constructor(e,r){this.type=zt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Xo(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let d=0;d<a.features.length;++d){const _=a.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new To(a,a.features[d].geometry)}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new To(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new To(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const b=Xs(a.coordinates,_,y),S=qa(r.geometry(),d,_,y);if(!ps(d,_))return!1;for(const M of S)if(!Ua(M,b))return!1}if(a.type==="MultiPolygon"){const b=bc(a.coordinates,_,y),S=qa(r.geometry(),d,_,y);if(!ps(d,_))return!1;for(const M of S)if(!ja(M,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const b=Xs(a.coordinates,_,y),S=Za(r.geometry(),d,_,y);if(!ps(d,_))return!1;for(const M of S)if(!yc(M,b))return!1}if(a.type==="MultiPolygon"){const b=bc(a.coordinates,_,y),S=Za(r.geometry(),d,_,y);if(!ps(d,_))return!1;for(const M of S)if(!vc(M,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ws{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Ws(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class xn{constructor(e,r,a,d){this.name=e,this.type=r,this._evaluate=a,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],d=xn.definitions[a];if(!d)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,b=y.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let S=null;for(const[M,E]of b){S=new Zs(r.registry,Hs,r.path,null,r.scope);const L=[];let F=!1;for(let N=1;N<e.length;N++){const V=e[N],Z=Array.isArray(M)?M[N-1]:M.type,J=S.parse(V,1+L.length,Z);if(!J){F=!0;break}L.push(J)}if(!F)if(Array.isArray(M)&&M.length!==L.length)S.error(`Expected ${M.length} arguments, but found ${L.length} instead.`);else{for(let N=0;N<L.length;N++){const V=Array.isArray(M)?M[N]:M.type,Z=L[N];S.concat(N+1).checkSubtype(V,Z.type)}if(S.errors.length===0)return new xn(a,_,E,L)}}if(b.length===1)r.errors.push(...S.errors);else{const M=(b.length?b:y).map(([L])=>{return F=L,Array.isArray(F)?`(${F.map($).join(", ")})`:`(${$(F.type)}...)`;var F}).join(" | "),E=[];for(let L=1;L<e.length;L++){const F=r.parse(e[L],1+E.length);if(!F)return null;E.push($(F.type))}r.error(`Expected arguments of type ${M}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){xn.definitions=r;for(const a in r)e[a]=xn}}function Hs(i){if(i instanceof Ws)return Hs(i.boundExpression);if(i instanceof xn&&i.name==="error"||i instanceof Gs||i instanceof To)return!1;const e=i instanceof co||i instanceof bn;let r=!0;return i.eachChild(a=>{r=e?r&&Hs(a):r&&a instanceof So}),!!r&&Ks(i)&&Ys(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ks(i){if(i instanceof xn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof To)return!1;let e=!0;return i.eachChild(r=>{e&&!Ks(r)&&(e=!1)}),e}function fs(i){if(i instanceof xn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!fs(r)&&(e=!1)}),e}function Ys(i,e){if(i instanceof xn&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Ys(a,e)&&(r=!1)}),r}function Wo(i,e){const r=i.length-1;let a,d,_=0,y=r,b=0;for(;_<=y;)if(b=Math.floor((_+y)/2),a=i[b],d=i[b+1],a<=e){if(b===r||e<d)return b;_=b+1}else{if(!(a>e))throw new Ui("Input is not a number.");y=b-1}return 0}class ho{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[d,_]of a)this.labels.push(d),this.outputs.push(_)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Qe);if(!a)return null;const d=[];let _=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(let y=1;y<e.length;y+=2){const b=y===1?-1/0:e[y],S=e[y+1],M=y,E=y+1;if(typeof b!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(d.length&&d[d.length-1][0]>=b)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const L=r.parse(S,E,_);if(!L)return null;_=_||L.type,d.push([b,L])}return new ho(_,a,d)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);const _=r.length;return d>=r[_-1]?a[_-1].evaluate(e):a[Wo(r,d)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Qt(i,e,r){return i+r*(e-i)}function Js(i,e,r){return i.map((a,d)=>Qt(a,e[d],r))}const sn={number:Qt,color:function(i,e,r,a="rgb"){switch(a){case"rgb":{const[d,_,y,b]=Js(i.rgb,e.rgb,r);return new gi(d,_,y,b,!1)}case"hcl":{const[d,_,y,b]=i.hcl,[S,M,E,L]=e.hcl;let F,N;if(isNaN(d)||isNaN(S))isNaN(d)?isNaN(S)?F=NaN:(F=S,y!==1&&y!==0||(N=M)):(F=d,E!==1&&E!==0||(N=_));else{let he=S-d;S>d&&he>180?he-=360:S<d&&d-S>180&&(he+=360),F=d+r*he}const[V,Z,J,ee]=function([he,ne,fe,ve]){return he=isNaN(he)?0:he*Lt,ki([fe,Math.cos(he)*ne,Math.sin(he)*ne,ve])}([F,N??Qt(_,M,r),Qt(y,E,r),Qt(b,L,r)]);return new gi(V,Z,J,ee,!1)}case"lab":{const[d,_,y,b]=ki(Js(i.lab,e.lab,r));return new gi(d,_,y,b,!1)}}},array:Js,padding:function(i,e,r){return new on(Js(i.values,e.values,r))},variableAnchorOffsetCollection:function(i,e,r){const a=i.values,d=e.values;if(a.length!==d.length)throw new Ui(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);const _=[];for(let y=0;y<a.length;y+=2){if(a[y]!==d[y])throw new Ui(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${a[y]}, to[${y}]: ${d[y]}`);_.push(a[y]);const[b,S]=a[y+1],[M,E]=d[y+1];_.push([Qt(b,M,r),Qt(S,E,r)])}return new vn(_)}};class an{constructor(e,r,a,d,_){this.type=e,this.operator=r,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(const[y,b]of _)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(e,r,a,d){let _=0;if(e.name==="exponential")_=Ga(r,e.base,a,d);else if(e.name==="linear")_=Ga(r,1,a,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;_=new Te(y[0],y[1],y[2],y[3]).solve(Ga(r,1,a,d))}return _}static parse(e,r){let[a,d,_,...y]=e;if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const M=d[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:M}}else{if(d[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const M=d.slice(1);if(M.length!==4||M.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(_=r.parse(_,2,Qe),!_)return null;const b=[];let S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=Dr:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let M=0;M<y.length;M+=2){const E=y[M],L=y[M+1],F=M+3,N=M+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(b.length&&b[b.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const V=r.parse(L,N,S);if(!V)return null;S=S||V.type,b.push([E,V])}return Pe(S,Qe)||Pe(S,Dr)||Pe(S,B)||Pe(S,U)||Pe(S,Y(Qe))?new an(S,a,d,_,b):r.error(`Type ${$(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);const _=r.length;if(d>=r[_-1])return a[_-1].evaluate(e);const y=Wo(r,d),b=an.interpolationFactor(this.interpolation,d,r[y],r[y+1]),S=a[y].evaluate(e),M=a[y+1].evaluate(e);switch(this.operator){case"interpolate":return sn[this.type.kind](S,M,b);case"interpolate-hcl":return sn.color(S,M,b,"hcl");case"interpolate-lab":return sn.color(S,M,b,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Ga(i,e,r,a){const d=a-r,_=i-r;return d===0?0:e===1?_/d:(Math.pow(e,_)-1)/(Math.pow(e,d)-1)}class $s{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const d=r.expectedType;d&&d.kind!=="value"&&(a=d);const _=[];for(const b of e.slice(1)){const S=r.parse(b,1+_.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,_.push(S)}if(!a)throw new Error("No output type");const y=d&&_.some(b=>se(d,b.type));return new $s(y?Bt:a,_)}evaluate(e){let r,a=null,d=0;for(const _ of this.args)if(d++,a=_.evaluate(e),a&&a instanceof xr&&!a.available&&(r||(r=a.name),a=null,d===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Qs{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let _=1;_<e.length-1;_+=2){const y=e[_];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=r.parse(e[_+1],_+1);if(!b)return null;a.push([y,b])}const d=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return d?new Qs(a,d):null}outputDefined(){return this.result.outputDefined()}}class Xa{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Qe),d=r.parse(e[2],2,Y(r.expectedType||Bt));return a&&d?new Xa(d.type.itemType,a,d):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Ui(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ui(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ui(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Wa{constructor(e,r){this.type=zt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Bt),d=r.parse(e[2],2,Bt);return a&&d?te(a.type,[zt,jt,Qe,Jn,Bt])?new Wa(a,d):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ue(r,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${$(zi(r))} instead.`);if(!ue(a,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${$(zi(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class ea{constructor(e,r,a){this.type=Qe,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Bt),d=r.parse(e[2],2,Bt);if(!a||!d)return null;if(!te(a.type,[zt,jt,Qe,Jn,Bt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$(a.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,Qe);return _?new ea(a,d,_):null}return new ea(a,d)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ue(r,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${$(zi(r))} instead.`);if(!ue(a,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${$(zi(a))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return a.indexOf(r,d)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Ha{constructor(e,r,a,d,_,y){this.inputType=e,this.type=r,this.input=a,this.cases=d,this.outputs=_,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);const _={},y=[];for(let M=2;M<e.length-1;M+=2){let E=e[M];const L=e[M+1];Array.isArray(E)||(E=[E]);const F=r.concat(M);if(E.length===0)return F.error("Expected at least one branch label.");for(const V of E){if(typeof V!="number"&&typeof V!="string")return F.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return F.error("Numeric branch labels must be integer values.");if(a){if(F.checkSubtype(a,zi(V)))return null}else a=zi(V);if(_[String(V)]!==void 0)return F.error("Branch labels must be unique.");_[String(V)]=y.length}const N=r.parse(L,M,d);if(!N)return null;d=d||N.type,y.push(N)}const b=r.parse(e[1],1,Bt);if(!b)return null;const S=r.parse(e[e.length-1],e.length-1,d);return S?b.type.kind!=="value"&&r.concat(1).checkSubtype(a,b.type)?null:new Ha(a,d,b,_,y,S):null}evaluate(e){const r=this.input.evaluate(e);return(zi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Ka{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const b=r.parse(e[y],y,zt);if(!b)return null;const S=r.parse(e[y+1],y+1,a);if(!S)return null;d.push([b,S]),a=a||S.type}const _=r.parse(e[e.length-1],e.length-1,a);if(!_)return null;if(!a)throw new Error("Can't infer output type");return new Ka(a,d,_)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ta{constructor(e,r,a,d){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=d}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Bt),d=r.parse(e[2],2,Qe);if(!a||!d)return null;if(!te(a.type,[Y(Bt),jt,Bt]))return r.error(`Expected first argument to be of type array or string, but found ${$(a.type)} instead`);if(e.length===4){const _=r.parse(e[3],3,Qe);return _?new ta(a.type,a,d,_):null}return new ta(a.type,a,d)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ue(r,["string","array"]))throw new Ui(`Expected first argument to be of type array or string, but found ${$(zi(r))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return r.slice(a,d)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function wc(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Sc(i,e,r,a){return a.compare(e,r)===0}function Ho(i,e,r){const a=i!=="=="&&i!=="!=";return class fm{constructor(_,y,b){this.type=zt,this.lhs=_,this.rhs=y,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const b=_[0];let S=y.parse(_[1],1,Bt);if(!S)return null;if(!wc(b,S.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${$(S.type)}'.`);let M=y.parse(_[2],2,Bt);if(!M)return null;if(!wc(b,M.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${$(M.type)}'.`);if(S.type.kind!==M.type.kind&&S.type.kind!=="value"&&M.type.kind!=="value")return y.error(`Cannot compare types '${$(S.type)}' and '${$(M.type)}'.`);a&&(S.type.kind==="value"&&M.type.kind!=="value"?S=new bn(M.type,[S]):S.type.kind!=="value"&&M.type.kind==="value"&&(M=new bn(S.type,[M])));let E=null;if(_.length===4){if(S.type.kind!=="string"&&M.type.kind!=="string"&&S.type.kind!=="value"&&M.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(E=y.parse(_[3],3,$n),!E)return null}return new fm(S,M,E)}evaluate(_){const y=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(a&&this.hasUntypedArgument){const S=zi(y),M=zi(b);if(S.kind!==M.kind||S.kind!=="string"&&S.kind!=="number")throw new Ui(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${M.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=zi(y),M=zi(b);if(S.kind!=="string"||M.kind!=="string")return e(_,y,b)}return this.collator?r(_,y,b,this.collator.evaluate(_)):e(_,y,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const Zu=Ho("==",function(i,e,r){return e===r},Sc),Gu=Ho("!=",function(i,e,r){return e!==r},function(i,e,r,a){return!Sc(0,e,r,a)}),Xu=Ho("<",function(i,e,r){return e<r},function(i,e,r,a){return a.compare(e,r)<0}),Wu=Ho(">",function(i,e,r){return e>r},function(i,e,r,a){return a.compare(e,r)>0}),Hu=Ho("<=",function(i,e,r){return e<=r},function(i,e,r,a){return a.compare(e,r)<=0}),Ku=Ho(">=",function(i,e,r){return e>=r},function(i,e,r,a){return a.compare(e,r)>=0});class Ya{constructor(e,r,a,d,_){this.type=jt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=_}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Qe);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=r.parse(d.locale,1,jt),!_))return null;let y=null;if(d.currency&&(y=r.parse(d.currency,1,jt),!y))return null;let b=null;if(d["min-fraction-digits"]&&(b=r.parse(d["min-fraction-digits"],1,Qe),!b))return null;let S=null;return d["max-fraction-digits"]&&(S=r.parse(d["max-fraction-digits"],1,Qe),!S)?null:new Ya(a,_,y,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class ia{constructor(e){this.type=H,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const d=[];let _=!1;for(let y=1;y<=e.length-1;++y){const b=e[y];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let S=null;if(b["font-scale"]&&(S=r.parse(b["font-scale"],1,Qe),!S))return null;let M=null;if(b["text-font"]&&(M=r.parse(b["text-font"],1,Y(jt)),!M))return null;let E=null;if(b["text-color"]&&(E=r.parse(b["text-color"],1,Dr),!E))return null;const L=d[d.length-1];L.scale=S,L.font=M,L.textColor=E}else{const S=r.parse(e[y],1,Bt);if(!S)return null;const M=S.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:S,scale:null,font:null,textColor:null})}}return new ia(d)}evaluate(e){return new Mr(this.sections.map(r=>{const a=r.content.evaluate(e);return zi(a)===R?new Us("",a,null,null,null):new Us(li(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Ja{constructor(e){this.type=R,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,jt);return a?new Ja(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=xr.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class $a{constructor(e){this.type=Qe,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${$(a.type)} instead.`):new $a(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ui(`Expected value to be of type string or array, but found ${$(zi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ko={"==":Zu,"!=":Gu,">":Wu,"<":Xu,">=":Ku,"<=":Hu,array:bn,at:Xa,boolean:bn,case:Ka,coalesce:$s,collator:Gs,format:ia,image:Ja,in:Wa,"index-of":ea,interpolate:an,"interpolate-hcl":an,"interpolate-lab":an,length:$a,let:Qs,literal:So,match:Ha,number:bn,"number-format":Ya,object:bn,slice:ta,step:ho,string:bn,"to-boolean":co,"to-color":co,"to-number":co,"to-string":co,var:Ws,within:To};function Tc(i,[e,r,a,d]){e=e.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const _=d?d.evaluate(i):1,y=js(e,r,a,_);if(y)throw new Ui(y);return new gi(e/255,r/255,a/255,_,!1)}function kc(i,e){return i in e}function Qa(i,e){const r=e[i];return r===void 0?null:r}function ko(i){return{type:i}}function Ic(i){return{result:"success",value:i}}function po(i){return{result:"error",value:i}}function Yo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Mc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function el(i){return!!i.expression&&i.expression.interpolated}function ci(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Li(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Yu(i){return i}function ei(i,e){const r=e.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",d=a||!(a||i.property!==void 0),_=i.type||(el(e)?"exponential":"interval");if(r||e.type==="padding"){const E=r?gi.parse:on.parse;(i=Fn({},i)).stops&&(i.stops=i.stops.map(L=>[L[0],E(L[1])])),i.default=E(i.default?i.default:e.default)}if(i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;let b,S,M;if(_==="exponential")b=ms;else if(_==="interval")b=Ei;else if(_==="categorical"){b=Di,S=Object.create(null);for(const E of i.stops)S[E[0]]=E[1];M=typeof i.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);b=Cc}if(a){const E={},L=[];for(let V=0;V<i.stops.length;V++){const Z=i.stops[V],J=Z[0].zoom;E[J]===void 0&&(E[J]={zoom:J,type:i.type,property:i.property,default:i.default,stops:[]},L.push(J)),E[J].stops.push([Z[0].value,Z[1]])}const F=[];for(const V of L)F.push([E[V].zoom,ei(E[V],e)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:an.interpolationFactor.bind(void 0,N),zoomStops:F.map(V=>V[0]),evaluate:({zoom:V},Z)=>ms({stops:F,base:i.base},e,V).evaluate(V,Z)}}if(d){const E=_==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:an.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(L=>L[0]),evaluate:({zoom:L})=>b(i,e,L,S,M)}}return{kind:"source",evaluate(E,L){const F=L&&L.properties?L.properties[i.property]:void 0;return F===void 0?Io(i.default,e.default):b(i,e,F,S,M)}}}function Io(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Di(i,e,r,a,d){return Io(typeof r===d?a[r]:void 0,i.default,e.default)}function Ei(i,e,r){if(ci(r)!=="number")return Io(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const d=Wo(i.stops.map(_=>_[0]),r);return i.stops[d][1]}function ms(i,e,r){const a=i.base!==void 0?i.base:1;if(ci(r)!=="number")return Io(i.default,e.default);const d=i.stops.length;if(d===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[d-1][0])return i.stops[d-1][1];const _=Wo(i.stops.map(E=>E[0]),r),y=function(E,L,F,N){const V=N-F,Z=E-F;return V===0?0:L===1?Z/V:(Math.pow(L,Z)-1)/(Math.pow(L,V)-1)}(r,a,i.stops[_][0],i.stops[_+1][0]),b=i.stops[_][1],S=i.stops[_+1][1],M=sn[e.type]||Yu;return typeof b.evaluate=="function"?{evaluate(...E){const L=b.evaluate.apply(void 0,E),F=S.evaluate.apply(void 0,E);if(L!==void 0&&F!==void 0)return M(L,F,y,i.colorSpace)}}:M(b,S,y,i.colorSpace)}function Cc(i,e,r){switch(e.type){case"color":r=gi.parse(r);break;case"formatted":r=Mr.fromString(r.toString());break;case"resolvedImage":r=xr.fromString(r.toString());break;case"padding":r=on.parse(r);break;default:ci(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Io(r,i.default,e.default)}xn.register(Ko,{error:[{kind:"error"},[jt],(i,[e])=>{throw new Ui(e.evaluate(i))}],typeof:[jt,[Bt],(i,[e])=>$(zi(e.evaluate(i)))],"to-rgba":[Y(Qe,4),[Dr],(i,[e])=>{const[r,a,d,_]=e.evaluate(i).rgb;return[255*r,255*a,255*d,_]}],rgb:[Dr,[Qe,Qe,Qe],Tc],rgba:[Dr,[Qe,Qe,Qe,Qe],Tc],has:{type:zt,overloads:[[[jt],(i,[e])=>kc(e.evaluate(i),i.properties())],[[jt,Rn],(i,[e,r])=>kc(e.evaluate(i),r.evaluate(i))]]},get:{type:Bt,overloads:[[[jt],(i,[e])=>Qa(e.evaluate(i),i.properties())],[[jt,Rn],(i,[e,r])=>Qa(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Bt,[jt],(i,[e])=>Qa(e.evaluate(i),i.featureState||{})],properties:[Rn,[],i=>i.properties()],"geometry-type":[jt,[],i=>i.geometryType()],id:[Bt,[],i=>i.id()],zoom:[Qe,[],i=>i.globals.zoom],"heatmap-density":[Qe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Qe,[],i=>i.globals.lineProgress||0],accumulated:[Bt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Qe,ko(Qe),(i,e)=>{let r=0;for(const a of e)r+=a.evaluate(i);return r}],"*":[Qe,ko(Qe),(i,e)=>{let r=1;for(const a of e)r*=a.evaluate(i);return r}],"-":{type:Qe,overloads:[[[Qe,Qe],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Qe],(i,[e])=>-e.evaluate(i)]]},"/":[Qe,[Qe,Qe],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Qe,[Qe,Qe],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Qe,[],()=>Math.LN2],pi:[Qe,[],()=>Math.PI],e:[Qe,[],()=>Math.E],"^":[Qe,[Qe,Qe],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Qe,[Qe],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Qe,[Qe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Qe,[Qe],(i,[e])=>Math.log(e.evaluate(i))],log2:[Qe,[Qe],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Qe,[Qe],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Qe,[Qe],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Qe,[Qe],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Qe,[Qe],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Qe,[Qe],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Qe,[Qe],(i,[e])=>Math.atan(e.evaluate(i))],min:[Qe,ko(Qe),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Qe,ko(Qe),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Qe,[Qe],(i,[e])=>Math.abs(e.evaluate(i))],round:[Qe,[Qe],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Qe,[Qe],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Qe,[Qe],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[zt,[jt,Bt],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[zt,[Bt],(i,[e])=>i.id()===e.value],"filter-type-==":[zt,[jt],(i,[e])=>i.geometryType()===e.value],"filter-<":[zt,[jt,Bt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a<d}],"filter-id-<":[zt,[Bt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[zt,[jt,Bt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a>d}],"filter-id->":[zt,[Bt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[zt,[jt,Bt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[zt,[Bt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[zt,[jt,Bt],(i,[e,r])=>{const a=i.properties()[e.value],d=r.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[zt,[Bt],(i,[e])=>{const r=i.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[zt,[Bt],(i,[e])=>e.value in i.properties()],"filter-has-id":[zt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[zt,[Y(jt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[zt,[Y(Bt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[zt,[jt,Y(Bt)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[zt,[jt,Y(Bt)],(i,[e,r])=>function(a,d,_,y){for(;_<=y;){const b=_+y>>1;if(d[b]===a)return!0;d[b]>a?y=b-1:_=b+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:zt,overloads:[[[zt,zt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[ko(zt),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:zt,overloads:[[[zt,zt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[ko(zt),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[zt,[zt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[zt,[jt],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[jt,[jt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[jt,[jt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[jt,ko(Bt),(i,e)=>e.map(r=>li(r.evaluate(i))).join("")],"resolved-locale":[jt,[$n],(i,[e])=>e.evaluate(i).resolvedLocale()]});class tl{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new Na,this._defaultValue=r?(a=r).type==="color"&&Li(a.default)?new gi(0,0,0,0):a.type==="color"?gi.parse(a.default)||null:a.type==="padding"?on.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?vn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,d,_,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,d,_,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Ui(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function ra(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ko}function na(i,e){const r=new Zs(Ko,Hs,[],e?function(d){const _={color:Dr,string:jt,number:Qe,enum:jt,boolean:zt,formatted:H,padding:B,resolvedImage:R,variableAnchorOffsetCollection:U};return d.type==="array"?Y(_[d.value]||Bt,d.length):_[d.type]}(e):void 0),a=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Ic(new tl(a,e)):po(r.errors)}class il{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!fs(r.expression)}evaluateWithoutErrorHandling(e,r,a,d,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,_,y)}evaluate(e,r,a,d,_,y){return this._styleExpression.evaluate(e,r,a,d,_,y)}}class oa{constructor(e,r,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!fs(r.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,r,a,d,_,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,_,y)}evaluate(e,r,a,d,_,y){return this._styleExpression.evaluate(e,r,a,d,_,y)}interpolationFactor(e,r,a){return this.interpolationType?an.interpolationFactor(this.interpolationType,e,r,a):0}}function rl(i,e){const r=na(i,e);if(r.result==="error")return r;const a=r.value.expression,d=Ks(a);if(!d&&!Yo(e))return po([new Vi("","data expressions not supported")]);const _=Ys(a,["zoom"]);if(!_&&!Mc(e))return po([new Vi("","zoom expressions not supported")]);const y=gs(a);return y||_?y instanceof Vi?po([y]):y instanceof an&&!el(e)?po([new Vi("",'"interpolate" expressions cannot be used with this property')]):Ic(y?new oa(d?"camera":"composite",r.value,y.labels,y instanceof an?y.interpolation:void 0):new il(d?"constant":"source",r.value)):po([new Vi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _s{constructor(e,r){this._parameters=e,this._specification=r,Fn(this,ei(this._parameters,this._specification))}static deserialize(e){return new _s(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function gs(i){let e=null;if(i instanceof Qs)e=gs(i.result);else if(i instanceof $s){for(const r of i.args)if(e=gs(r),e)break}else(i instanceof ho||i instanceof an)&&i.input instanceof xn&&i.input.name==="zoom"&&(e=i);return e instanceof Vi||i.eachChild(r=>{const a=gs(r);a instanceof Vi?e=a:!e&&a?e=new Vi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Vi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function ys(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!ys(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ju={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function nl(i){if(i==null)return{filter:()=>!0,needGeometry:!1};ys(i)||(i=sa(i));const e=na(i,Ju);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,d)=>e.value.evaluate(r,a,{},d),needGeometry:Ac(i)}}function $u(i,e){return i<e?-1:i>e?1:0}function Ac(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Ac(i[e]))return!0;return!1}function sa(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ol(i[1],i[2],"=="):e==="!="?vs(ol(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ol(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(sa))):e==="all"?["all"].concat(i.slice(1).map(sa)):e==="none"?["all"].concat(i.slice(1).map(sa).map(vs)):e==="in"?Ec(i[1],i.slice(2)):e==="!in"?vs(Ec(i[1],i.slice(2))):e==="has"?Pc(i[1]):e==="!has"?vs(Pc(i[1])):e!=="within"||i;var r}function ol(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function Ec(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort($u)]]:["filter-in-small",i,["literal",e]]}}function Pc(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function vs(i){return["!",i]}function aa(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let d="[";for(const _ of i)d+=`${aa(_)},`;return`${d}]`}const r=Object.keys(i).sort();let a="{";for(let d=0;d<r.length;d++)a+=`${JSON.stringify(r[d])}:${aa(i[r[d]])},`;return`${a}}`}function la(i){let e="";for(const r of vr)e+=`/${aa(i[r])}`;return e}function zc(i){const e=i.value;return e?[new Ye(i.key,e,"constants have been deprecated as of v8")]:[]}function ji(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Mo(i){if(Array.isArray(i))return i.map(Mo);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=Mo(i[r]);return e}return ji(i)}function jr(i){const e=i.key,r=i.value,a=i.valueSpec||{},d=i.objectElementValidators||{},_=i.style,y=i.styleSpec,b=i.validateSpec;let S=[];const M=ci(r);if(M!=="object")return[new Ye(e,r,`object expected, ${M} found`)];for(const E in r){const L=E.split(".")[0],F=a[L]||a["*"];let N;if(d[L])N=d[L];else if(a[L])N=b;else if(d["*"])N=d["*"];else{if(!a["*"]){S.push(new Ye(e,r[E],`unknown property "${E}"`));continue}N=b}S=S.concat(N({key:(e&&`${e}.`)+E,value:r[E],valueSpec:F,style:_,styleSpec:y,object:r,objectKey:E,validateSpec:b},r))}for(const E in a)d[E]||a[E].required&&a[E].default===void 0&&r[E]===void 0&&S.push(new Ye(e,r,`missing required property "${E}"`));return S}function Jo(i){const e=i.value,r=i.valueSpec,a=i.style,d=i.styleSpec,_=i.key,y=i.arrayElementValidator||i.validateSpec;if(ci(e)!=="array")return[new Ye(_,e,`array expected, ${ci(e)} found`)];if(r.length&&e.length!==r.length)return[new Ye(_,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Ye(_,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let b={type:r.value,values:r.values};d.$version<7&&(b.function=r.function),ci(r.value)==="object"&&(b=r.value);let S=[];for(let M=0;M<e.length;M++)S=S.concat(y({array:e,arrayIndex:M,value:e[M],valueSpec:b,validateSpec:i.validateSpec,style:a,styleSpec:d,key:`${_}[${M}]`}));return S}function bs(i){const e=i.key,r=i.value,a=i.valueSpec;let d=ci(r);return d==="number"&&r!=r&&(d="NaN"),d!=="number"?[new Ye(e,r,`number expected, ${d} found`)]:"minimum"in a&&r<a.minimum?[new Ye(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Ye(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function ca(i){const e=i.valueSpec,r=ji(i.value.type);let a,d,_,y={};const b=r!=="categorical"&&i.value.property===void 0,S=!b,M=ci(i.value.stops)==="array"&&ci(i.value.stops[0])==="array"&&ci(i.value.stops[0][0])==="object",E=jr({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(N){if(r==="identity")return[new Ye(N.key,N.value,'identity function may not have a "stops" property')];let V=[];const Z=N.value;return V=V.concat(Jo({key:N.key,value:Z,valueSpec:N.valueSpec,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:L})),ci(Z)==="array"&&Z.length===0&&V.push(new Ye(N.key,Z,"array must have at least one stop")),V},default:function(N){return N.validateSpec({key:N.key,value:N.value,valueSpec:e,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec})}}});return r==="identity"&&b&&E.push(new Ye(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||E.push(new Ye(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!el(i.valueSpec)&&E.push(new Ye(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!Yo(i.valueSpec)?E.push(new Ye(i.key,i.value,"property functions not supported")):b&&!Mc(i.valueSpec)&&E.push(new Ye(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!M||i.value.property!==void 0||E.push(new Ye(i.key,i.value,'"property" property is required')),E;function L(N){let V=[];const Z=N.value,J=N.key;if(ci(Z)!=="array")return[new Ye(J,Z,`array expected, ${ci(Z)} found`)];if(Z.length!==2)return[new Ye(J,Z,`array length 2 expected, length ${Z.length} found`)];if(M){if(ci(Z[0])!=="object")return[new Ye(J,Z,`object expected, ${ci(Z[0])} found`)];if(Z[0].zoom===void 0)return[new Ye(J,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new Ye(J,Z,"object stop key must have value")];if(_&&_>ji(Z[0].zoom))return[new Ye(J,Z[0].zoom,"stop zoom values must appear in ascending order")];ji(Z[0].zoom)!==_&&(_=ji(Z[0].zoom),d=void 0,y={}),V=V.concat(jr({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:bs,value:F}}))}else V=V.concat(F({key:`${J}[0]`,value:Z[0],valueSpec:{},validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec},Z));return ra(Mo(Z[1]))?V.concat([new Ye(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):V.concat(N.validateSpec({key:`${J}[1]`,value:Z[1],valueSpec:e,validateSpec:N.validateSpec,style:N.style,styleSpec:N.styleSpec}))}function F(N,V){const Z=ci(N.value),J=ji(N.value),ee=N.value!==null?N.value:V;if(a){if(Z!==a)return[new Ye(N.key,ee,`${Z} stop domain type must match previous stop domain type ${a}`)]}else a=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean")return[new Ye(N.key,ee,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&r!=="categorical"){let he=`number expected, ${Z} found`;return Yo(e)&&r===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(N.key,ee,he)]}return r!=="categorical"||Z!=="number"||isFinite(J)&&Math.floor(J)===J?r!=="categorical"&&Z==="number"&&d!==void 0&&J<d?[new Ye(N.key,ee,"stop domain values must appear in ascending order")]:(d=J,r==="categorical"&&J in y?[new Ye(N.key,ee,"stop domain values must be unique")]:(y[J]=!0,[])):[new Ye(N.key,ee,`integer expected, found ${J}`)]}}function Co(i){const e=(i.expressionContext==="property"?rl:na)(Mo(i.value),i.valueSpec);if(e.result==="error")return e.value.map(a=>new Ye(`${i.key}${a.key}`,i.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Ye(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!fs(r))return[new Ye(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!fs(r))return[new Ye(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ys(r,["zoom","feature-state"]))return[new Ye(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ks(r))return[new Ye(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xs(i){const e=i.key,r=i.value,a=i.valueSpec,d=[];return Array.isArray(a.values)?a.values.indexOf(ji(r))===-1&&d.push(new Ye(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ji(r))===-1&&d.push(new Ye(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),d}function $o(i){return ys(Mo(i.value))?Co(Fn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Lc(i)}function Lc(i){const e=i.value,r=i.key;if(ci(e)!=="array")return[new Ye(r,e,`array expected, ${ci(e)} found`)];const a=i.styleSpec;let d,_=[];if(e.length<1)return[new Ye(r,e,"filter array must have at least 1 element")];switch(_=_.concat(xs({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),ji(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ji(e[1])==="$type"&&_.push(new Ye(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&_.push(new Ye(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=ci(e[1]),d!=="string"&&_.push(new Ye(`${r}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=ci(e[y]),ji(e[1])==="$type"?_=_.concat(xs({key:`${r}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&_.push(new Ye(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)_=_.concat(Lc({key:`${r}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":d=ci(e[1]),e.length!==2?_.push(new Ye(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&_.push(new Ye(`${r}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=ci(e[1]),e.length!==2?_.push(new Ye(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&_.push(new Ye(`${r}[1]`,e[1],`object expected, ${d} found`))}return _}function Dc(i,e){const r=i.key,a=i.validateSpec,d=i.style,_=i.styleSpec,y=i.value,b=i.objectKey,S=_[`${e}_${i.layerType}`];if(!S)return[];const M=b.match(/^(.*)-transition$/);if(e==="paint"&&M&&S[M[1]]&&S[M[1]].transition)return a({key:r,value:y,valueSpec:_.transition,style:d,styleSpec:_});const E=i.valueSpec||S[b];if(!E)return[new Ye(r,y,`unknown property "${b}"`)];let L;if(ci(y)==="string"&&Yo(E)&&!E.tokens&&(L=/^{([^}]+)}$/.exec(y)))return[new Ye(r,y,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const F=[];return i.layerType==="symbol"&&(b==="text-field"&&d&&!d.glyphs&&F.push(new Ye(r,y,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Li(Mo(y))&&ji(y.type)==="identity"&&F.push(new Ye(r,y,'"text-font" does not support identity functions'))),F.concat(a({key:i.key,value:y,valueSpec:E,style:d,styleSpec:_,expressionContext:"property",propertyType:e,propertyKey:b}))}function Bc(i){return Dc(i,"paint")}function Fc(i){return Dc(i,"layout")}function Rc(i){let e=[];const r=i.value,a=i.key,d=i.style,_=i.styleSpec;r.type||r.ref||e.push(new Ye(a,r,'either "type" or "ref" is required'));let y=ji(r.type);const b=ji(r.ref);if(r.id){const S=ji(r.id);for(let M=0;M<i.arrayIndex;M++){const E=d.layers[M];ji(E.id)===S&&e.push(new Ye(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach(M=>{M in r&&e.push(new Ye(a,r[M],`"${M}" is prohibited for ref layers`))}),d.layers.forEach(M=>{ji(M.id)===b&&(S=M)}),S?S.ref?e.push(new Ye(a,r.ref,"ref cannot reference another ref layer")):y=ji(S.type):e.push(new Ye(a,r.ref,`ref layer "${b}" not found`))}else if(y!=="background")if(r.source){const S=d.sources&&d.sources[r.source],M=S&&ji(S.type);S?M==="vector"&&y==="raster"?e.push(new Ye(a,r.source,`layer "${r.id}" requires a raster source`)):M!=="raster-dem"&&y==="hillshade"?e.push(new Ye(a,r.source,`layer "${r.id}" requires a raster-dem source`)):M==="raster"&&y!=="raster"?e.push(new Ye(a,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&y!=="hillshade"?e.push(new Ye(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||M==="geojson"&&S.lineMetrics||e.push(new Ye(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ye(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Ye(a,r.source,`source "${r.source}" not found`))}else e.push(new Ye(a,r,'missing required property "source"'));return e=e.concat(jr({key:a,value:r,valueSpec:_.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:_.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:$o,layout:S=>jr({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":M=>Fc(Fn({layerType:y},M))}}),paint:S=>jr({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":M=>Bc(Fn({layerType:y},M))}})}})),e}function On(i){const e=i.value,r=i.key,a=ci(e);return a!=="string"?[new Ye(r,e,`string expected, ${a} found`)]:[]}const ws={promoteId:function({key:i,value:e}){if(ci(e)==="string")return On({key:i,value:e});{const r=[];for(const a in e)r.push(...On({key:`${i}.${a}`,value:e[a]}));return r}}};function ln(i){const e=i.value,r=i.key,a=i.styleSpec,d=i.style,_=i.validateSpec;if(!e.type)return[new Ye(r,e,'"type" is required')];const y=ji(e.type);let b;switch(y){case"vector":case"raster":return b=jr({key:r,value:e,valueSpec:a[`source_${y.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:ws,validateSpec:_}),b;case"raster-dem":return b=function(S){var M;const E=(M=S.sourceName)!==null&&M!==void 0?M:"",L=S.value,F=S.styleSpec,N=F.source_raster_dem,V=S.style;let Z=[];const J=ci(L);if(L===void 0)return Z;if(J!=="object")return Z.push(new Ye("source_raster_dem",L,`object expected, ${J} found`)),Z;const ee=ji(L.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],ne=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const fe in L)!ee&&he.includes(fe)?Z.push(new Ye(fe,L[fe],`In "${E}": "${fe}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):N[fe]?Z=Z.concat(S.validateSpec({key:fe,value:L[fe],valueSpec:N[fe],validateSpec:S.validateSpec,style:V,styleSpec:F})):Z.push(new Ye(fe,L[fe],`unknown property "${fe}"`));return Z}({sourceName:r,value:e,style:i.style,styleSpec:a,validateSpec:_}),b;case"geojson":if(b=jr({key:r,value:e,valueSpec:a.source_geojson,style:d,styleSpec:a,validateSpec:_,objectElementValidators:ws}),e.cluster)for(const S in e.clusterProperties){const[M,E]=e.clusterProperties[S],L=typeof M=="string"?[M,["accumulated"],["get",S]]:M;b.push(...Co({key:`${r}.${S}.map`,value:E,validateSpec:_,expressionContext:"cluster-map"})),b.push(...Co({key:`${r}.${S}.reduce`,value:L,validateSpec:_,expressionContext:"cluster-reduce"}))}return b;case"video":return jr({key:r,value:e,valueSpec:a.source_video,style:d,validateSpec:_,styleSpec:a});case"image":return jr({key:r,value:e,valueSpec:a.source_image,style:d,validateSpec:_,styleSpec:a});case"canvas":return[new Ye(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,validateSpec:_,styleSpec:a})}}function Ss(i){const e=i.value,r=i.styleSpec,a=r.light,d=i.style;let _=[];const y=ci(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new Ye("light",e,`object expected, ${y} found`)]),_;for(const b in e){const S=b.match(/^(.*)-transition$/);_=_.concat(S&&a[S[1]]&&a[S[1]].transition?i.validateSpec({key:b,value:e[b],valueSpec:r.transition,validateSpec:i.validateSpec,style:d,styleSpec:r}):a[b]?i.validateSpec({key:b,value:e[b],valueSpec:a[b],validateSpec:i.validateSpec,style:d,styleSpec:r}):[new Ye(b,e[b],`unknown property "${b}"`)])}return _}function Oc(i){const e=i.value,r=i.styleSpec,a=r.terrain,d=i.style;let _=[];const y=ci(e);if(e===void 0)return _;if(y!=="object")return _=_.concat([new Ye("terrain",e,`object expected, ${y} found`)]),_;for(const b in e)_=_.concat(a[b]?i.validateSpec({key:b,value:e[b],valueSpec:a[b],validateSpec:i.validateSpec,style:d,styleSpec:r}):[new Ye(b,e[b],`unknown property "${b}"`)]);return _}function Nc(i){let e=[];const r=i.value,a=i.key;if(Array.isArray(r)){const d=[],_=[];for(const y in r)r[y].id&&d.includes(r[y].id)&&e.push(new Ye(a,r,`all the sprites' ids must be unique, but ${r[y].id} is duplicated`)),d.push(r[y].id),r[y].url&&_.includes(r[y].url)&&e.push(new Ye(a,r,`all the sprites' URLs must be unique, but ${r[y].url} is duplicated`)),_.push(r[y].url),e=e.concat(jr({key:`${a}[${y}]`,value:r[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return On({key:a,value:r})}const Vc={"*":()=>[],array:Jo,boolean:function(i){const e=i.value,r=i.key,a=ci(e);return a!=="boolean"?[new Ye(r,e,`boolean expected, ${a} found`)]:[]},number:bs,color:function(i){const e=i.key,r=i.value,a=ci(r);return a!=="string"?[new Ye(e,r,`color expected, ${a} found`)]:gi.parse(String(r))?[]:[new Ye(e,r,`color expected, "${r}" found`)]},constants:zc,enum:xs,filter:$o,function:ca,layer:Rc,object:jr,source:ln,light:Ss,terrain:Oc,string:On,formatted:function(i){return On(i).length===0?[]:Co(i)},resolvedImage:function(i){return On(i).length===0?[]:Co(i)},padding:function(i){const e=i.key,r=i.value;if(ci(r)==="array"){if(r.length<1||r.length>4)return[new Ye(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let d=[];for(let _=0;_<r.length;_++)d=d.concat(i.validateSpec({key:`${e}[${_}]`,value:r[_],validateSpec:i.validateSpec,valueSpec:a}));return d}return bs({key:e,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const e=i.key,r=i.value,a=ci(r),d=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Ye(e,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let y=0;y<r.length;y+=2)_=_.concat(xs({key:`${e}[${y}]`,value:r[y],valueSpec:d.layout_symbol["text-anchor"]})),_=_.concat(Jo({key:`${e}[${y+1}]`,value:r[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:d}));return _},sprite:Nc};function Qn(i){const e=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=Qn,r.expression&&Li(ji(e))?ca(i):r.expression&&ra(Mo(e))?Co(i):r.type&&Vc[r.type]?Vc[r.type](i):jr(Fn({},i,{valueSpec:r.type?a[r.type]:r}))}function Uc(i){const e=i.value,r=i.key,a=On(i);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Ye(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Ye(r,e,'"glyphs" url must include a "{range}" token'))),a}function wn(i,e=Ce){let r=[];return r=r.concat(Qn({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Qn,objectElementValidators:{glyphs:Uc,"*":()=>[]}})),i.constants&&(r=r.concat(zc({key:"constants",value:i.constants,style:i,styleSpec:e,validateSpec:Qn}))),ua(r)}function eo(i){return function(e){return i({...e,validateSpec:Qn})}}function ua(i){return[].concat(i).sort((e,r)=>e.line-r.line)}function to(i){return function(...e){return ua(i.apply(this,e))}}wn.source=to(eo(ln)),wn.sprite=to(eo(Nc)),wn.glyphs=to(eo(Uc)),wn.light=to(eo(Ss)),wn.terrain=to(eo(Oc)),wn.layer=to(eo(Rc)),wn.filter=to(eo($o)),wn.paintProperty=to(eo(Bc)),wn.layoutProperty=to(eo(Fc));const io=wn,Qu=io.light,sl=io.paintProperty,jc=io.layoutProperty;function ha(i,e){let r=!1;if(e&&e.length)for(const a of e)i.fire(new zr(new Error(a.message))),r=!0;return r}class Qo{constructor(e,r,a){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(a=y[2]);for(let S=0;S<this.d*this.d;S++){const M=y[3+S],E=y[3+S+1];d.push(M===E?null:y.subarray(M,E))}const b=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],b),this.bboxes=y.subarray(b),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const _=a/r*e;this.min=-_,this.max=e+_}insert(e,r,a,d,_){this._forEachCell(r,a,d,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,d,_,y){this.cells[_].push(y)}query(e,r,a,d,_){const y=this.min,b=this.max;if(e<=y&&r<=y&&b<=a&&b<=d&&!_)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,a,d,this._queryCell,S,{},_),S}}_queryCell(e,r,a,d,_,y,b,S){const M=this.cells[_];if(M!==null){const E=this.keys,L=this.bboxes;for(let F=0;F<M.length;F++){const N=M[F];if(b[N]===void 0){const V=4*N;(S?S(L[V+0],L[V+1],L[V+2],L[V+3]):e<=L[V+2]&&r<=L[V+3]&&a>=L[V+0]&&d>=L[V+1])?(b[N]=!0,y.push(E[N])):b[N]=!1}}}}_forEachCell(e,r,a,d,_,y,b,S){const M=this._convertToCellCoord(e),E=this._convertToCellCoord(r),L=this._convertToCellCoord(a),F=this._convertToCellCoord(d);for(let N=M;N<=L;N++)for(let V=E;V<=F;V++){const Z=this.d*V+N;if((!S||S(this._convertFromCellCoord(N),this._convertFromCellCoord(V),this._convertFromCellCoord(N+1),this._convertFromCellCoord(V+1)))&&_.call(this,e,r,a,d,Z,y,b,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const d=new Int32Array(r+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let _=r;for(let y=0;y<e.length;y++){const b=e[y];d[3+y]=_,d.set(b,_),_+=b.length}return d[3+e.length]=_,d.set(this.keys,_),_+=this.keys.length,d[3+e.length+1]=_,d.set(this.bboxes,_),_+=this.bboxes.length,d.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new Qo(e.buffer)}}const ro={};function ut(i,e,r={}){if(ro[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),ro[i]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}ut("Object",Object),ut("TransferableGridIndex",Qo),ut("Color",gi),ut("Error",Error),ut("AJAXError",Je),ut("ResolvedImage",xr),ut("StylePropertyFunction",_s),ut("StyleExpression",tl,{omit:["_evaluator"]}),ut("ZoomDependentExpression",oa),ut("ZoomConstantExpression",il),ut("CompoundExpression",xn,{omit:["_evaluate"]});for(const i in Ko)Ko[i]._classRegistryKey||ut(`Expression_${i}`,Ko[i]);function da(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function fo(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(da(i)||sr(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const r=i;return e&&e.push(r.buffer),r}if(i instanceof ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const a of i)r.push(fo(a,e));return r}if(typeof i=="object"){const r=i.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!ro[a])throw new Error(`${a} is not registered.`);const d=r.serialize?r.serialize(i,e):{};if(r.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in i){if(!i.hasOwnProperty(_)||ro[a].omit.indexOf(_)>=0)continue;const y=i[_];d[_]=ro[a].shallow.indexOf(_)>=0?y:fo(y,e)}i instanceof Error&&(d.message=i.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}throw new Error("can't serialize object of type "+typeof i)}function es(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||da(i)||sr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(es);if(typeof i=="object"){const e=i.$name||"Object";if(!ro[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=ro[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const d of Object.keys(i)){if(d==="$name")continue;const _=i[d];a[d]=ro[e].shallow.indexOf(d)>=0?_:es(_)}return a}throw new Error("can't deserialize object of type "+typeof i)}class qc{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const nt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function al(i){for(const e of i)if(cl(e.charCodeAt(0)))return!0;return!1}function ll(i){for(const e of i)if(!eh(e.charCodeAt(0)))return!1;return!0}function eh(i){return!(nt.Arabic(i)||nt["Arabic Supplement"](i)||nt["Arabic Extended-A"](i)||nt["Arabic Presentation Forms-A"](i)||nt["Arabic Presentation Forms-B"](i))}function cl(i){return!(i!==746&&i!==747&&(i<4352||!(nt["Bopomofo Extended"](i)||nt.Bopomofo(i)||nt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||nt["CJK Compatibility Ideographs"](i)||nt["CJK Compatibility"](i)||nt["CJK Radicals Supplement"](i)||nt["CJK Strokes"](i)||!(!nt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||nt["CJK Unified Ideographs Extension A"](i)||nt["CJK Unified Ideographs"](i)||nt["Enclosed CJK Letters and Months"](i)||nt["Hangul Compatibility Jamo"](i)||nt["Hangul Jamo Extended-A"](i)||nt["Hangul Jamo Extended-B"](i)||nt["Hangul Jamo"](i)||nt["Hangul Syllables"](i)||nt.Hiragana(i)||nt["Ideographic Description Characters"](i)||nt.Kanbun(i)||nt["Kangxi Radicals"](i)||nt["Katakana Phonetic Extensions"](i)||nt.Katakana(i)&&i!==12540||!(!nt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!nt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||nt["Unified Canadian Aboriginal Syllabics"](i)||nt["Unified Canadian Aboriginal Syllabics Extended"](i)||nt["Vertical Forms"](i)||nt["Yijing Hexagram Symbols"](i)||nt["Yi Syllables"](i)||nt["Yi Radicals"](i))))}function Zc(i){return!(cl(i)||function(e){return!!(nt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||nt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||nt["Letterlike Symbols"](e)||nt["Number Forms"](e)||nt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||nt["Control Pictures"](e)&&e!==9251||nt["Optical Character Recognition"](e)||nt["Enclosed Alphanumerics"](e)||nt["Geometric Shapes"](e)||nt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||nt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||nt["CJK Symbols and Punctuation"](e)||nt.Katakana(e)||nt["Private Use Area"](e)||nt["CJK Compatibility Forms"](e)||nt["Small Form Variants"](e)||nt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Gc(i){return i>=1424&&i<=2303||nt["Arabic Presentation Forms-A"](i)||nt["Arabic Presentation Forms-B"](i)}function Xc(i,e){return!(!e&&Gc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||nt.Khmer(i))}function th(i){for(const e of i)if(Gc(e.charCodeAt(0)))return!0;return!1}const ul="deferred",hl="loading",dl="loaded";let pl=null,qr="unavailable",mo=null;const Ts=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(qr="error"),pl&&pl(i)};function fl(){ks.fire(new Mn("pluginStateChange",{pluginStatus:qr,pluginURL:mo}))}const ks=new gr,ml=function(){return qr},Wc=function(){if(qr!==ul||!mo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qr=hl,fl(),mo&&Xe({url:mo},i=>{i?Ts(i):(qr=dl,fl())})},cn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qr===dl||cn.applyArabicShaping!=null,isLoading:()=>qr===hl,setState(i){if(!dt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");qr=i.pluginStatus,mo=i.pluginURL},isParsed(){if(!dt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return cn.applyArabicShaping!=null&&cn.processBidirectionalText!=null&&cn.processStyledBidirectionalText!=null},getPluginURL(){if(!dt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return mo}};class Mi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new qc,this.transition={})}isSupportedScript(e){return function(r,a){for(const d of r)if(!Xc(d.charCodeAt(0),a))return!1;return!0}(e,cn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class pa{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,d){if(Li(a))return new _s(a,d);if(ra(a)){const _=rl(a,d);if(_.result==="error")throw new Error(_.value.map(y=>`${y.key}: ${y.message}`).join(", "));return _.value}{let _=a;return d.type==="color"&&typeof a=="string"?_=gi.parse(a):d.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?d.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(_=vn.parse(a)):_=on.parse(a),{kind:"constant",evaluate:()=>_}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class _l{constructor(e){this.property=e,this.value=new pa(e,void 0)}transitioned(e,r){return new Kc(this.property,this.value,r,Oe({},e.transition,this.transition),e.now)}untransitioned(){return new Kc(this.property,this.value,null,{},0)}}class Hc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ue(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _l(this._values[e].property)),this._values[e].value=new pa(this._values[e].property,r===null?void 0:Ue(r))}getTransition(e){return Ue(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new _l(this._values[e].property)),this._values[e].transition=Ue(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const d=this.getTransition(r);d!==void 0&&(e[`${r}-transition`]=d)}return e}transitioned(e,r){const a=new Yc(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].transitioned(e,r._values[d]);return a}untransitioned(){const e=new Yc(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Kc{constructor(e,r,a,d,_){this.property=e,this.value=r,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const d=e.now||0,_=this.value.possiblyEvaluate(e,r,a),y=this.prior;if(y){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return y.possiblyEvaluate(e,r,a);{const b=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,a),_,function(S){if(S<=0)return 0;if(S>=1)return 1;const M=S*S,E=M*S;return 4*(S<.5?E:3*(S-M)+E-.75)}(b))}}return _}}class Yc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const d=new fa(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(e,r,a);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ih{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Ue(this._values[e].value)}setValue(e,r){this._values[e]=new pa(this._values[e].property,r===null?void 0:Ue(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const d=new fa(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(e,r,a);return d}}class Br{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,d){return this.property.evaluate(this.value,this.parameters,e,r,a,d)}}class fa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const d=sn[this.specification.type];return d?d(e,r,a):e}}class It{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,d){return new Br(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,d)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Br(this,{kind:"constant",value:void 0},e.parameters);const d=sn[this.specification.type];if(d){const _=d(e.value.value,r.value.value,a);return new Br(this,{kind:"constant",value:_},e.parameters)}return e}evaluate(e,r,a,d,_,y){return e.kind==="constant"?e.value:e.evaluate(r,a,d,_,y)}}class Is extends It{possiblyEvaluate(e,r,a,d){if(e.value===void 0)return new Br(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const _=e.expression.evaluate(r,null,{},a,d),y=e.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,b=this._calculate(y,y,y,r);return new Br(this,{kind:"constant",value:b},r)}if(e.expression.kind==="camera"){const _=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new Br(this,{kind:"constant",value:_},r)}return new Br(this,e.expression,r)}evaluate(e,r,a,d,_,y){if(e.kind==="source"){const b=e.evaluate(r,a,d,_,y);return this._calculate(b,b,b,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,d),e.evaluate({zoom:Math.floor(r.zoom)},a,d),e.evaluate({zoom:Math.floor(r.zoom)+1},a,d),r):e.value}_calculate(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class gl{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const _=e.expression.evaluate(r,null,{},a,d);return this._calculate(_,_,_,r)}return this._calculate(e.expression.evaluate(new Mi(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Mi(Math.floor(r.zoom),r)),e.expression.evaluate(new Mi(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class yl{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,d){return!!e.expression.evaluate(r,null,{},a,d)}interpolate(){return!1}}class Ji{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const d=this.defaultPropertyValues[r]=new pa(a,void 0),_=this.defaultTransitionablePropertyValues[r]=new _l(a);this.defaultTransitioningPropertyValues[r]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}}}ut("DataDrivenProperty",It),ut("DataConstantProperty",bt),ut("CrossFadedDataDrivenProperty",Is),ut("CrossFadedProperty",gl),ut("ColorRampProperty",yl);const vl="-transition";class Sn extends gr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ih(r.layout)),r.paint)){this._transitionablePaint=new Hc(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fa(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(jc,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(vl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(sl,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(vl))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const d=this._transitionablePaint._values[e],_=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),b=d.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||y||_||this._handleOverridablePaintPropertyUpdate(e,b,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),be(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,d,_={}){return(!_||_.validate!==!1)&&ha(this,e.call(io,{key:r,layerType:this.type,objectKey:a,value:d,styleSpec:Ce,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Br&&Yo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Jc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ao{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Bi(i,e=1){let r=0,a=0;return{members:i.map(d=>{const _=Jc[d.type].BYTES_PER_ELEMENT,y=r=ts(r,Math.max(e,_)),b=d.components||1;return a=Math.max(a,_),r+=_*b,{name:d.name,type:d.type,components:b,offset:y}}),size:ts(r,Math.max(a,e)),alignment:e}}function ts(i,e){return Math.ceil(i/e)*e}class Ms extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.int16[d+0]=r,this.int16[d+1]=a,e}}Ms.prototype.bytesPerElement=4,ut("StructArrayLayout2i4",Ms);class Cs extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.int16[_+0]=r,this.int16[_+1]=a,this.int16[_+2]=d,e}}Cs.prototype.bytesPerElement=6,ut("StructArrayLayout3i6",Cs);class Eo extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,d)}emplace(e,r,a,d,_){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=d,this.int16[y+3]=_,e}}Eo.prototype.bytesPerElement=8,ut("StructArrayLayout4i8",Eo);class bl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,d,_,y)}emplace(e,r,a,d,_,y,b){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=d,this.int16[S+3]=_,this.int16[S+4]=y,this.int16[S+5]=b,e}}bl.prototype.bytesPerElement=12,ut("StructArrayLayout2i4i12",bl);class xl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,d,_,y)}emplace(e,r,a,d,_,y,b){const S=4*e,M=8*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[M+4]=d,this.uint8[M+5]=_,this.uint8[M+6]=y,this.uint8[M+7]=b,e}}xl.prototype.bytesPerElement=8,ut("StructArrayLayout2i4ub8",xl);class is extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.float32[d+0]=r,this.float32[d+1]=a,e}}is.prototype.bytesPerElement=8,ut("StructArrayLayout2f8",is);class wl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,S,M,E){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,d,_,y,b,S,M,E)}emplace(e,r,a,d,_,y,b,S,M,E,L){const F=10*e;return this.uint16[F+0]=r,this.uint16[F+1]=a,this.uint16[F+2]=d,this.uint16[F+3]=_,this.uint16[F+4]=y,this.uint16[F+5]=b,this.uint16[F+6]=S,this.uint16[F+7]=M,this.uint16[F+8]=E,this.uint16[F+9]=L,e}}wl.prototype.bytesPerElement=20,ut("StructArrayLayout10ui20",wl);class Sl extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,S,M,E,L,F){const N=this.length;return this.resize(N+1),this.emplace(N,e,r,a,d,_,y,b,S,M,E,L,F)}emplace(e,r,a,d,_,y,b,S,M,E,L,F,N){const V=12*e;return this.int16[V+0]=r,this.int16[V+1]=a,this.int16[V+2]=d,this.int16[V+3]=_,this.uint16[V+4]=y,this.uint16[V+5]=b,this.uint16[V+6]=S,this.uint16[V+7]=M,this.int16[V+8]=E,this.int16[V+9]=L,this.int16[V+10]=F,this.int16[V+11]=N,e}}Sl.prototype.bytesPerElement=24,ut("StructArrayLayout4i4ui4i24",Sl);class ui extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.float32[_+0]=r,this.float32[_+1]=a,this.float32[_+2]=d,e}}ui.prototype.bytesPerElement=12,ut("StructArrayLayout3f12",ui);class f extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}f.prototype.bytesPerElement=4,ut("StructArrayLayout1ul4",f);class t extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,S,M){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,a,d,_,y,b,S,M)}emplace(e,r,a,d,_,y,b,S,M,E){const L=10*e,F=5*e;return this.int16[L+0]=r,this.int16[L+1]=a,this.int16[L+2]=d,this.int16[L+3]=_,this.int16[L+4]=y,this.int16[L+5]=b,this.uint32[F+3]=S,this.uint16[L+8]=M,this.uint16[L+9]=E,e}}t.prototype.bytesPerElement=20,ut("StructArrayLayout6i1ul2ui20",t);class n extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,d,_,y)}emplace(e,r,a,d,_,y,b){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=d,this.int16[S+3]=_,this.int16[S+4]=y,this.int16[S+5]=b,e}}n.prototype.bytesPerElement=12,ut("StructArrayLayout2i2i2i12",n);class u extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,d,_)}emplace(e,r,a,d,_,y){const b=4*e,S=8*e;return this.float32[b+0]=r,this.float32[b+1]=a,this.float32[b+2]=d,this.int16[S+6]=_,this.int16[S+7]=y,e}}u.prototype.bytesPerElement=16,ut("StructArrayLayout2f1f2i16",u);class p extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,d)}emplace(e,r,a,d,_){const y=12*e,b=3*e;return this.uint8[y+0]=r,this.uint8[y+1]=a,this.float32[b+1]=d,this.float32[b+2]=_,e}}p.prototype.bytesPerElement=12,ut("StructArrayLayout2ub2f12",p);class g extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.uint16[_+0]=r,this.uint16[_+1]=a,this.uint16[_+2]=d,e}}g.prototype.bytesPerElement=6,ut("StructArrayLayout3ui6",g);class x extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z,J,ee){const he=this.length;return this.resize(he+1),this.emplace(he,e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z,J,ee)}emplace(e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z,J,ee,he){const ne=24*e,fe=12*e,ve=48*e;return this.int16[ne+0]=r,this.int16[ne+1]=a,this.uint16[ne+2]=d,this.uint16[ne+3]=_,this.uint32[fe+2]=y,this.uint32[fe+3]=b,this.uint32[fe+4]=S,this.uint16[ne+10]=M,this.uint16[ne+11]=E,this.uint16[ne+12]=L,this.float32[fe+7]=F,this.float32[fe+8]=N,this.uint8[ve+36]=V,this.uint8[ve+37]=Z,this.uint8[ve+38]=J,this.uint32[fe+10]=ee,this.int16[ne+22]=he,e}}x.prototype.bytesPerElement=48,ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",x);class w extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z,J,ee,he,ne,fe,ve,De,ot,mt,rt,it,Ke,ht){const $e=this.length;return this.resize($e+1),this.emplace($e,e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z,J,ee,he,ne,fe,ve,De,ot,mt,rt,it,Ke,ht)}emplace(e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z,J,ee,he,ne,fe,ve,De,ot,mt,rt,it,Ke,ht,$e){const Ze=32*e,St=16*e;return this.int16[Ze+0]=r,this.int16[Ze+1]=a,this.int16[Ze+2]=d,this.int16[Ze+3]=_,this.int16[Ze+4]=y,this.int16[Ze+5]=b,this.int16[Ze+6]=S,this.int16[Ze+7]=M,this.uint16[Ze+8]=E,this.uint16[Ze+9]=L,this.uint16[Ze+10]=F,this.uint16[Ze+11]=N,this.uint16[Ze+12]=V,this.uint16[Ze+13]=Z,this.uint16[Ze+14]=J,this.uint16[Ze+15]=ee,this.uint16[Ze+16]=he,this.uint16[Ze+17]=ne,this.uint16[Ze+18]=fe,this.uint16[Ze+19]=ve,this.uint16[Ze+20]=De,this.uint16[Ze+21]=ot,this.uint16[Ze+22]=mt,this.uint32[St+12]=rt,this.float32[St+13]=it,this.float32[St+14]=Ke,this.uint16[Ze+30]=ht,this.uint16[Ze+31]=$e,e}}w.prototype.bytesPerElement=64,ut("StructArrayLayout8i15ui1ul2f2ui64",w);class k extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}k.prototype.bytesPerElement=4,ut("StructArrayLayout1f4",k);class A extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=3*e;return this.uint16[6*e+0]=r,this.float32[_+1]=a,this.float32[_+2]=d,e}}A.prototype.bytesPerElement=12,ut("StructArrayLayout1ui2f12",A);class P extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,a)}emplace(e,r,a,d){const _=4*e;return this.uint32[2*e+0]=r,this.uint16[_+2]=a,this.uint16[_+3]=d,e}}P.prototype.bytesPerElement=8,ut("StructArrayLayout1ul2ui8",P);class z extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const d=2*e;return this.uint16[d+0]=r,this.uint16[d+1]=a,e}}z.prototype.bytesPerElement=4,ut("StructArrayLayout2ui4",z);class O extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}O.prototype.bytesPerElement=2,ut("StructArrayLayout1ui2",O);class X extends qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,d)}emplace(e,r,a,d,_){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=d,this.float32[y+3]=_,e}}X.prototype.bytesPerElement=16,ut("StructArrayLayout4f16",X);class G extends Ao{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ie(this.anchorPointX,this.anchorPointY)}}G.prototype.size=20;class K extends t{get(e){return new G(this,e)}}ut("CollisionBoxArray",K);class j extends Ao{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}j.prototype.size=48;class ae extends x{get(e){return new j(this,e)}}ut("PlacedSymbolArray",ae);class ge extends Ao{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ge.prototype.size=64;class Q extends w{get(e){return new ge(this,e)}}ut("SymbolInstanceArray",Q);class ce extends k{getoffsetX(e){return this.float32[1*e+0]}}ut("GlyphOffsetArray",ce);class Se extends Cs{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ut("SymbolLineVertexArray",Se);class ke extends Ao{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ke.prototype.size=12;class Le extends A{get(e){return new ke(this,e)}}ut("TextAnchorOffsetArray",Le);class je extends Ao{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}je.prototype.size=8;class Ve extends P{get(e){return new je(this,e)}}ut("FeatureIndexArray",Ve);class We extends Ms{}class ft extends Ms{}class Kt extends Ms{}class tt extends bl{}class Mt extends xl{}class _t extends is{}class yi extends wl{}class Wt extends Sl{}class Nt extends ui{}class Yt extends f{}class Xi extends n{}class Ii extends p{}class wr extends g{}class ar extends z{}const $i=Bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:un}=$i;class Ci{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,d){let _=this.segments[this.segments.length-1];return e>Ci.MAX_VERTEX_ARRAY_LENGTH&&Ne(`Max vertices per segment is ${Ci.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!_||_.vertexLength+e>Ci.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,d){return new Ci([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])}}function Nn(i,e){return 256*(i=Ee(Math.floor(i),0,255))+Ee(Math.floor(e),0,255)}Ci.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut("SegmentVector",Ci);const Vn=Bi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var _o={exports:{}},Po={exports:{}};Po.exports=function(i,e){var r,a,d,_,y,b,S,M;for(a=i.length-(r=3&i.length),d=e,y=3432918353,b=461845907,M=0;M<a;)S=255&i.charCodeAt(M)|(255&i.charCodeAt(++M))<<8|(255&i.charCodeAt(++M))<<16|(255&i.charCodeAt(++M))<<24,++M,d=27492+(65535&(_=5*(65535&(d=(d^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,r){case 3:S^=(255&i.charCodeAt(M+2))<<16;case 2:S^=(255&i.charCodeAt(M+1))<<8;case 1:d^=S=(65535&(S=(S=(65535&(S^=255&i.charCodeAt(M)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var rs=Po.exports,Cr={exports:{}};Cr.exports=function(i,e){for(var r,a=i.length,d=e^a,_=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(r>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++_;switch(a){case 3:d^=(255&i.charCodeAt(_+2))<<16;case 2:d^=(255&i.charCodeAt(_+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(_)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var Sr=rs,Fr=Cr.exports;_o.exports=Sr,_o.exports.murmur3=Sr,_o.exports.murmur2=Fr;var zo=I(_o.exports);class Wi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,d){this.ids.push(lr(e)),this.positions.push(r,a,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=lr(e);let a=0,d=this.ids.length-1;for(;a<d;){const y=a+d>>1;this.ids[y]>=r?d=y:a=y+1}const _=[];for(;this.ids[a]===r;)_.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return _}static serialize(e,r){const a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return Zr(a,d,0,a.length-1),r&&r.push(a.buffer,d.buffer),{ids:a,positions:d}}static deserialize(e){const r=new Wi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function lr(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:zo(String(i))}function Zr(i,e,r,a){for(;r<a;){const d=i[r+a>>1];let _=r-1,y=a+1;for(;;){do _++;while(i[_]<d);do y--;while(i[y]>d);if(_>=y)break;Hi(i,_,y),Hi(e,3*_,3*y),Hi(e,3*_+1,3*y+1),Hi(e,3*_+2,3*y+2)}y-r<a-y?(Zr(i,e,r,y),r=y+1):(Zr(i,e,y+1,a),a=y)}}function Hi(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}ut("FeaturePositionMap",Wi);class Lo{constructor(e,r){this.gl=e.gl,this.location=r}}class ma extends Lo{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class $c extends Lo{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Qc extends Lo{constructor(e,r){super(e,r),this.current=gi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const rh=new Float32Array(16);function Tl(i){return[Nn(255*i.r,255*i.g),Nn(255*i.b,255*i.a)]}class Un{constructor(e,r,a){this.value=e,this.uniformNames=r.map(d=>`u_${d}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new Qc(e,r):new ma(e,r)}}class Do{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,d){const _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&e.set(_)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new $c(e,r):new ma(e,r)}}class jn{constructor(e,r,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,a,d,_){const y=this.paintVertexArray.length,b=this.expression.evaluate(new Mi(0),r,{},d,[],_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,a,d){const _=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,r,_)}_setPaintValue(e,r,a){if(this.type==="color"){const d=Tl(a);for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Tn{constructor(e,r,a,d,_,y){this.expression=e,this.uniformNames=r.map(b=>`u_${b}_t`),this.type=a,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map(b=>({name:`a_${b}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,a,d,_){const y=this.expression.evaluate(new Mi(this.zoom),r,{},d,[],_),b=this.expression.evaluate(new Mi(this.zoom+1),r,{},d,[],_),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,y,b)}updatePaintArray(e,r,a,d){const _=this.expression.evaluate({zoom:this.zoom},a,d),y=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,r,_,y)}_setPaintValue(e,r,a,d){if(this.type==="color"){const _=Tl(a),y=Tl(d);for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,_[0],_[1],y[0],y[1])}else{for(let _=e;_<r;_++)this.paintVertexArray.emplace(_,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=Ee(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,r,a){return new ma(e,r)}}class qn{constructor(e,r,a,d,_,y){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,r,a){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,d,_){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,r,a,d){if(!d||!a)return;const{min:_,mid:y,max:b}=a,S=d[_],M=d[y],E=d[b];if(S&&M&&E)for(let L=e;L<r;L++)this.zoomInPaintVertexArray.emplace(L,M.tl[0],M.tl[1],M.br[0],M.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],M.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,M.tl[0],M.tl[1],M.br[0],M.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],M.pixelRatio,E.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Vn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Vn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class kl{constructor(e,r,a){this.binders={},this._buffers=[];const d=[];for(const _ in e.paint._values){if(!a(_))continue;const y=e.paint.get(_);if(!(y instanceof Br&&Yo(y.property.specification)))continue;const b=Um(_,e.type),S=y.value,M=y.property.specification.type,E=y.property.useIntegerZoom,L=y.property.specification["property-type"],F=L==="cross-faded"||L==="cross-faded-data-driven";if(S.kind==="constant")this.binders[_]=F?new Do(S.value,b):new Un(S.value,b,M),d.push(`/u_${_}`);else if(S.kind==="source"||F){const N=Sd(_,M,"source");this.binders[_]=F?new qn(S,M,E,r,N,e.id):new jn(S,b,M,N),d.push(`/a_${_}`)}else{const N=Sd(_,M,"composite");this.binders[_]=new Tn(S,b,M,E,r,N),d.push(`/z_${_}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof jn||r instanceof Tn?r.maxValue:0}populatePaintArrays(e,r,a,d,_){for(const y in this.binders){const b=this.binders[y];(b instanceof jn||b instanceof Tn||b instanceof qn)&&b.populatePaintArray(e,r,a,d,_)}}setConstantPatternPositions(e,r){for(const a in this.binders){const d=this.binders[a];d instanceof Do&&d.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,d,_){let y=!1;for(const b in e){const S=r.getPositions(b);for(const M of S){const E=a.feature(M.index);for(const L in this.binders){const F=this.binders[L];if((F instanceof jn||F instanceof Tn||F instanceof qn)&&F.expression.isStateDependent===!0){const N=d.paint.get(L);F.expression=N.value,F.updatePaintArray(M.start,M.end,E,e[b],_),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Un||a instanceof Do)&&e.push(...a.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof jn||a instanceof Tn)for(let d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof qn)for(let d=0;d<Vn.members.length;d++)e.push(Vn.members[d].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Un||a instanceof Do||a instanceof Tn)for(const d of a.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof Un||_ instanceof Do||_ instanceof Tn){for(const y of _.uniformNames)if(r[y]){const b=_.getBinding(e,r[y],y);a.push({name:y,property:d,binding:b})}}}return a}setUniforms(e,r,a,d){for(const{name:_,property:y,binding:b}of r)this.binders[y].setUniform(b,d,a.get(y),_)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof qn){const d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof jn||a instanceof Tn)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof jn||a instanceof Tn||a instanceof qn)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof jn||r instanceof Tn||r instanceof qn)&&r.destroy()}}}class no{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new kl(d,r,a);this.needsUpload=!1,this._featureMap=new Wi,this._bufferOffset=0}populatePaintArrays(e,r,a,d,_,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,d,_,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,d){for(const _ of a)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,r,_,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Um(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Sd(i,e,r){const a={color:{source:is,composite:X},number:{source:k,composite:is}},d=function(_){return{"line-pattern":{source:yi,composite:yi},"fill-pattern":{source:yi,composite:yi},"fill-extrusion-pattern":{source:yi,composite:yi}}[_]}(i);return d&&d[r]||a[e][r]}ut("ConstantBinder",Un),ut("CrossFadedConstantBinder",Do),ut("SourceExpressionBinder",jn),ut("CrossFadedCompositeBinder",qn),ut("CompositeExpressionBinder",Tn),ut("ProgramConfiguration",kl,{omit:["_buffers"]}),ut("ProgramConfigurationSet",no);const rr=8192,nh=Math.pow(2,14)-1,Td=-nh-1;function As(i){const e=rr/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const d=r[a];for(let _=0;_<d.length;_++){const y=d[_],b=Math.round(y.x*e),S=Math.round(y.y*e);y.x=Ee(b,Td,nh),y.y=Ee(S,Td,nh),(b<y.x||b>y.x+1||S<y.y||S>y.y+1)&&Ne("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Es(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?As(i):[]}}function eu(i,e,r,a,d){i.emplaceBack(2*e+(a+1)/2,2*r+(d+1)/2)}class oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ft,this.indexArray=new wr,this.segments=new Ci,this.programConfigurations=new no(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const d=this.layers[0],_=[];let y=null,b=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),b=!y.isConstant());for(const{feature:S,id:M,index:E,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,N=Es(S,F);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),N,a))continue;const V=b?y.evaluate(N,{},a):void 0,Z={id:M,properties:S.properties,type:S.type,sourceLayerIndex:L,index:E,geometry:F?N.geometry:As(S),patterns:{},sortKey:V};_.push(Z)}b&&_.sort((S,M)=>S.sortKey-M.sortKey);for(const S of _){const{geometry:M,index:E,sourceLayerIndex:L}=S,F=e[E].feature;this.addFeature(S,M,E,a),r.featureIndex.insert(F,M,E,L,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,un),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,d){for(const _ of r)for(const y of _){const b=y.x,S=y.y;if(b<0||b>=rr||S<0||S>=rr)continue;const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=M.vertexLength;eu(this.layoutVertexArray,b,S,-1,-1),eu(this.layoutVertexArray,b,S,1,-1),eu(this.layoutVertexArray,b,S,1,1),eu(this.layoutVertexArray,b,S,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)}}function kd(i,e){for(let r=0;r<i.length;r++)if(_a(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(_a(i,e[r]))return!0;return!!sh(i,e)}function jm(i,e,r){return!!_a(i,e)||!!ah(e,i,r)}function Id(i,e){if(i.length===1)return Cd(e,i[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let d=0;d<a.length;d++)if(_a(i,a[d]))return!0}for(let r=0;r<i.length;r++)if(Cd(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(sh(i,e[r]))return!0;return!1}function qm(i,e,r){if(i.length>1){if(sh(i,e))return!0;for(let a=0;a<e.length;a++)if(ah(e[a],i,r))return!0}for(let a=0;a<i.length;a++)if(ah(i[a],e,r))return!0;return!1}function sh(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],d=i[r+1];for(let _=0;_<e.length-1;_++)if(Zm(a,d,e[_],e[_+1]))return!0}return!1}function Zm(i,e,r,a){return vt(i,r,a)!==vt(e,r,a)&&vt(i,e,r)!==vt(i,e,a)}function ah(i,e,r){const a=r*r;if(e.length===1)return i.distSqr(e[0])<a;for(let d=1;d<e.length;d++)if(Md(i,e[d-1],e[d])<a)return!0;return!1}function Md(i,e,r){const a=e.distSqr(r);if(a===0)return i.distSqr(e);const d=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/a;return i.distSqr(d<0?e:d>1?r:r.sub(e)._mult(d)._add(e))}function Cd(i,e){let r,a,d,_=!1;for(let y=0;y<i.length;y++){r=i[y];for(let b=0,S=r.length-1;b<r.length;S=b++)a=r[b],d=r[S],a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(_=!_)}return _}function _a(i,e){let r=!1;for(let a=0,d=i.length-1;a<i.length;d=a++){const _=i[a],y=i[d];_.y>e.y!=y.y>e.y&&e.x<(y.x-_.x)*(e.y-_.y)/(y.y-_.y)+_.x&&(r=!r)}return r}function Gm(i,e,r){const a=r[0],d=r[2];if(i.x<a.x&&e.x<a.x||i.x>d.x&&e.x>d.x||i.y<a.y&&e.y<a.y||i.y>d.y&&e.y>d.y)return!1;const _=vt(i,e,r[0]);return _!==vt(i,e,r[1])||_!==vt(i,e,r[2])||_!==vt(i,e,r[3])}function Il(i,e,r){const a=e.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(i)}function tu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function iu(i,e,r,a,d){if(!e[0]&&!e[1])return i;const _=ie.convert(e)._mult(d);r==="viewport"&&_._rotate(-a);const y=[];for(let b=0;b<i.length;b++)y.push(i[b].sub(_));return y}let Ad,Ed;ut("CircleBucket",oh,{omit:["layers"]});var Xm={get paint(){return Ed=Ed||new Ji({"circle-radius":new It(Ce.paint_circle["circle-radius"]),"circle-color":new It(Ce.paint_circle["circle-color"]),"circle-blur":new It(Ce.paint_circle["circle-blur"]),"circle-opacity":new It(Ce.paint_circle["circle-opacity"]),"circle-translate":new bt(Ce.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(Ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(Ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(Ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(Ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(Ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(Ce.paint_circle["circle-stroke-opacity"])})},get layout(){return Ad=Ad||new Ji({"circle-sort-key":new It(Ce.layout_circle["circle-sort-key"])})}},Gr=1e-6,ga=typeof Float32Array<"u"?Float32Array:Array;function lh(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Pd(i,e,r){var a=e[0],d=e[1],_=e[2],y=e[3],b=e[4],S=e[5],M=e[6],E=e[7],L=e[8],F=e[9],N=e[10],V=e[11],Z=e[12],J=e[13],ee=e[14],he=e[15],ne=r[0],fe=r[1],ve=r[2],De=r[3];return i[0]=ne*a+fe*b+ve*L+De*Z,i[1]=ne*d+fe*S+ve*F+De*J,i[2]=ne*_+fe*M+ve*N+De*ee,i[3]=ne*y+fe*E+ve*V+De*he,i[4]=(ne=r[4])*a+(fe=r[5])*b+(ve=r[6])*L+(De=r[7])*Z,i[5]=ne*d+fe*S+ve*F+De*J,i[6]=ne*_+fe*M+ve*N+De*ee,i[7]=ne*y+fe*E+ve*V+De*he,i[8]=(ne=r[8])*a+(fe=r[9])*b+(ve=r[10])*L+(De=r[11])*Z,i[9]=ne*d+fe*S+ve*F+De*J,i[10]=ne*_+fe*M+ve*N+De*ee,i[11]=ne*y+fe*E+ve*V+De*he,i[12]=(ne=r[12])*a+(fe=r[13])*b+(ve=r[14])*L+(De=r[15])*Z,i[13]=ne*d+fe*S+ve*F+De*J,i[14]=ne*_+fe*M+ve*N+De*ee,i[15]=ne*y+fe*E+ve*V+De*he,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Ml,Wm=Pd;function ru(i,e,r){var a=e[0],d=e[1],_=e[2],y=e[3];return i[0]=r[0]*a+r[4]*d+r[8]*_+r[12]*y,i[1]=r[1]*a+r[5]*d+r[9]*_+r[13]*y,i[2]=r[2]*a+r[6]*d+r[10]*_+r[14]*y,i[3]=r[3]*a+r[7]*d+r[11]*_+r[15]*y,i}Ml=new ga(4),ga!=Float32Array&&(Ml[0]=0,Ml[1]=0,Ml[2]=0,Ml[3]=0);class Hm extends Sn{constructor(e){super(e,Xm)}createBucket(e){return new oh(e)}queryRadius(e){const r=e;return Il("circle-radius",this,r)+Il("circle-stroke-width",this,r)+tu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,d,_,y,b,S){const M=iu(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,b),E=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),L=this.paint.get("circle-pitch-alignment")==="map",F=L?M:function(V,Z){return V.map(J=>zd(J,Z))}(M,S),N=L?E*b:E;for(const V of d)for(const Z of V){const J=L?Z:zd(Z,S);let ee=N;const he=ru([],[Z.x,Z.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=he[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=y.cameraToCenterDistance/he[3]),jm(F,J,ee))return!0}return!1}}function zd(i,e){const r=ru([],[i.x,i.y,0,1],e);return new ie(r[0]/r[3],r[1]/r[3])}class Ld extends oh{}let Dd;ut("HeatmapBucket",Ld,{omit:["layers"]});var Km={get paint(){return Dd=Dd||new Ji({"heatmap-radius":new It(Ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(Ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(Ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yl(Ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(Ce.paint_heatmap["heatmap-opacity"])})}};function ch(i,{width:e,height:r},a,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*r*a}`)}else d=new Uint8Array(e*r*a);return i.width=e,i.height=r,i.data=d,i}function Bd(i,{width:e,height:r},a){if(e===i.width&&r===i.height)return;const d=ch({},{width:e,height:r},a);uh(i,d,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,r)},a),i.width=e,i.height=r,i.data=d.data}function uh(i,e,r,a,d,_){if(d.width===0||d.height===0)return e;if(d.width>i.width||d.height>i.height||r.x>i.width-d.width||r.y>i.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,b=e.data;if(y===b)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<d.height;S++){const M=((r.y+S)*i.width+r.x)*_,E=((a.y+S)*e.width+a.x)*_;for(let L=0;L<d.width*_;L++)b[E+L]=y[M+L]}return e}class Cl{constructor(e,r){ch(this,e,1,r)}resize(e){Bd(this,e,1)}clone(){return new Cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,d,_){uh(e,r,a,d,_,1)}}class An{constructor(e,r){ch(this,e,4,r)}resize(e){Bd(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new An({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,d,_){uh(e,r,a,d,_,4)}}function Fd(i){const e={},r=i.resolution||256,a=i.clips?i.clips.length:1,d=i.image||new An({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const _=(y,b,S)=>{e[i.evaluationKey]=S;const M=i.expression.evaluate(e);d.data[y+b+0]=Math.floor(255*M.r/M.a),d.data[y+b+1]=Math.floor(255*M.g/M.a),d.data[y+b+2]=Math.floor(255*M.b/M.a),d.data[y+b+3]=Math.floor(255*M.a)};if(i.clips)for(let y=0,b=0;y<a;++y,b+=4*r)for(let S=0,M=0;S<r;S++,M+=4){const E=S/(r-1),{start:L,end:F}=i.clips[y];_(b,M,L*(1-E)+F*E)}else for(let y=0,b=0;y<r;y++,b+=4)_(0,b,y/(r-1));return d}ut("AlphaImage",Cl),ut("RGBAImage",An);class Ym extends Sn{createBucket(e){return new Ld(e)}constructor(e){super(e,Km),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Rd;var Jm={get paint(){return Rd=Rd||new Ji({"hillshade-illumination-direction":new bt(Ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(Ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(Ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(Ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(Ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(Ce.paint_hillshade["hillshade-accent-color"])})}};class $m extends Sn{constructor(e){super(e,Jm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qm=Bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:e_}=Qm;var hh={exports:{}};function nu(i,e,r){r=r||2;var a,d,_,y,b,S,M,E=e&&e.length,L=E?e[0]*r:i.length,F=Od(i,0,L,r,!0),N=[];if(!F||F.next===F.prev)return N;if(E&&(F=function(Z,J,ee,he){var ne,fe,ve,De=[];for(ne=0,fe=J.length;ne<fe;ne++)(ve=Od(Z,J[ne]*he,ne<fe-1?J[ne+1]*he:Z.length,he,!1))===ve.next&&(ve.steiner=!0),De.push(l_(ve));for(De.sort(o_),ne=0;ne<De.length;ne++)ee=s_(De[ne],ee);return ee}(i,e,F,r)),i.length>80*r){a=_=i[0],d=y=i[1];for(var V=r;V<L;V+=r)(b=i[V])<a&&(a=b),(S=i[V+1])<d&&(d=S),b>_&&(_=b),S>y&&(y=S);M=(M=Math.max(_-a,y-d))!==0?32767/M:0}return Al(F,N,r,a,d,M,0),N}function Od(i,e,r,a,d){var _,y;if(d===fh(i,e,r,a)>0)for(_=e;_<r;_+=a)y=Ud(_,i[_],i[_+1],y);else for(_=r-a;_>=e;_-=a)y=Ud(_,i[_],i[_+1],y);return y&&ou(y,y.next)&&(Pl(y),y=y.next),y}function Ps(i,e){if(!i)return i;e||(e=i);var r,a=i;do if(r=!1,a.steiner||!ou(a,a.next)&&Qi(a.prev,a,a.next)!==0)a=a.next;else{if(Pl(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function Al(i,e,r,a,d,_,y){if(i){!y&&_&&function(E,L,F,N){var V=E;do V.z===0&&(V.z=dh(V.x,V.y,L,F,N)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==E);V.prevZ.nextZ=null,V.prevZ=null,function(Z){var J,ee,he,ne,fe,ve,De,ot,mt=1;do{for(ee=Z,Z=null,fe=null,ve=0;ee;){for(ve++,he=ee,De=0,J=0;J<mt&&(De++,he=he.nextZ);J++);for(ot=mt;De>0||ot>0&&he;)De!==0&&(ot===0||!he||ee.z<=he.z)?(ne=ee,ee=ee.nextZ,De--):(ne=he,he=he.nextZ,ot--),fe?fe.nextZ=ne:Z=ne,ne.prevZ=fe,fe=ne;ee=he}fe.nextZ=null,mt*=2}while(ve>1)}(V)}(i,a,d,_);for(var b,S,M=i;i.prev!==i.next;)if(b=i.prev,S=i.next,_?i_(i,a,d,_):t_(i))e.push(b.i/r|0),e.push(i.i/r|0),e.push(S.i/r|0),Pl(i),i=S.next,M=S.next;else if((i=S)===M){y?y===1?Al(i=r_(Ps(i),e,r),e,r,a,d,_,2):y===2&&n_(i,e,r,a,d,_):Al(Ps(i),e,r,a,d,_,1);break}}}function t_(i){var e=i.prev,r=i,a=i.next;if(Qi(e,r,a)>=0)return!1;for(var d=e.x,_=r.x,y=a.x,b=e.y,S=r.y,M=a.y,E=d<_?d<y?d:y:_<y?_:y,L=b<S?b<M?b:M:S<M?S:M,F=d>_?d>y?d:y:_>y?_:y,N=b>S?b>M?b:M:S>M?S:M,V=a.next;V!==e;){if(V.x>=E&&V.x<=F&&V.y>=L&&V.y<=N&&ya(d,b,_,S,y,M,V.x,V.y)&&Qi(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function i_(i,e,r,a){var d=i.prev,_=i,y=i.next;if(Qi(d,_,y)>=0)return!1;for(var b=d.x,S=_.x,M=y.x,E=d.y,L=_.y,F=y.y,N=b<S?b<M?b:M:S<M?S:M,V=E<L?E<F?E:F:L<F?L:F,Z=b>S?b>M?b:M:S>M?S:M,J=E>L?E>F?E:F:L>F?L:F,ee=dh(N,V,e,r,a),he=dh(Z,J,e,r,a),ne=i.prevZ,fe=i.nextZ;ne&&ne.z>=ee&&fe&&fe.z<=he;){if(ne.x>=N&&ne.x<=Z&&ne.y>=V&&ne.y<=J&&ne!==d&&ne!==y&&ya(b,E,S,L,M,F,ne.x,ne.y)&&Qi(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,fe.x>=N&&fe.x<=Z&&fe.y>=V&&fe.y<=J&&fe!==d&&fe!==y&&ya(b,E,S,L,M,F,fe.x,fe.y)&&Qi(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ne&&ne.z>=ee;){if(ne.x>=N&&ne.x<=Z&&ne.y>=V&&ne.y<=J&&ne!==d&&ne!==y&&ya(b,E,S,L,M,F,ne.x,ne.y)&&Qi(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;fe&&fe.z<=he;){if(fe.x>=N&&fe.x<=Z&&fe.y>=V&&fe.y<=J&&fe!==d&&fe!==y&&ya(b,E,S,L,M,F,fe.x,fe.y)&&Qi(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function r_(i,e,r){var a=i;do{var d=a.prev,_=a.next.next;!ou(d,_)&&Nd(d,a,a.next,_)&&El(d,_)&&El(_,d)&&(e.push(d.i/r|0),e.push(a.i/r|0),e.push(_.i/r|0),Pl(a),Pl(a.next),a=i=_),a=a.next}while(a!==i);return Ps(a)}function n_(i,e,r,a,d,_){var y=i;do{for(var b=y.next.next;b!==y.prev;){if(y.i!==b.i&&c_(y,b)){var S=Vd(y,b);return y=Ps(y,y.next),S=Ps(S,S.next),Al(y,e,r,a,d,_,0),void Al(S,e,r,a,d,_,0)}b=b.next}y=y.next}while(y!==i)}function o_(i,e){return i.x-e.x}function s_(i,e){var r=function(d,_){var y,b=_,S=d.x,M=d.y,E=-1/0;do{if(M<=b.y&&M>=b.next.y&&b.next.y!==b.y){var L=b.x+(M-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(L<=S&&L>E&&(E=L,y=b.x<b.next.x?b:b.next,L===S))return y}b=b.next}while(b!==_);if(!y)return null;var F,N=y,V=y.x,Z=y.y,J=1/0;b=y;do S>=b.x&&b.x>=V&&S!==b.x&&ya(M<Z?S:E,M,V,Z,M<Z?E:S,M,b.x,b.y)&&(F=Math.abs(M-b.y)/(S-b.x),El(b,d)&&(F<J||F===J&&(b.x>y.x||b.x===y.x&&a_(y,b)))&&(y=b,J=F)),b=b.next;while(b!==N);return y}(i,e);if(!r)return e;var a=Vd(r,i);return Ps(a,a.next),Ps(r,r.next)}function a_(i,e){return Qi(i.prev,i,e.prev)<0&&Qi(e.next,i,i.next)<0}function dh(i,e,r,a,d){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function l_(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function ya(i,e,r,a,d,_,y,b){return(d-y)*(e-b)>=(i-y)*(_-b)&&(i-y)*(a-b)>=(r-y)*(e-b)&&(r-y)*(_-b)>=(d-y)*(a-b)}function c_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,a){var d=r;do{if(d.i!==r.i&&d.next.i!==r.i&&d.i!==a.i&&d.next.i!==a.i&&Nd(d,d.next,r,a))return!0;d=d.next}while(d!==r);return!1}(i,e)&&(El(i,e)&&El(e,i)&&function(r,a){var d=r,_=!1,y=(r.x+a.x)/2,b=(r.y+a.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&y<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==r);return _}(i,e)&&(Qi(i.prev,i,e.prev)||Qi(i,e.prev,e))||ou(i,e)&&Qi(i.prev,i,i.next)>0&&Qi(e.prev,e,e.next)>0)}function Qi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function ou(i,e){return i.x===e.x&&i.y===e.y}function Nd(i,e,r,a){var d=au(Qi(i,e,r)),_=au(Qi(i,e,a)),y=au(Qi(r,a,i)),b=au(Qi(r,a,e));return d!==_&&y!==b||!(d!==0||!su(i,r,e))||!(_!==0||!su(i,a,e))||!(y!==0||!su(r,i,a))||!(b!==0||!su(r,e,a))}function su(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function au(i){return i>0?1:i<0?-1:0}function El(i,e){return Qi(i.prev,i,i.next)<0?Qi(i,e,i.next)>=0&&Qi(i,i.prev,e)>=0:Qi(i,e,i.prev)<0||Qi(i,i.next,e)<0}function Vd(i,e){var r=new ph(i.i,i.x,i.y),a=new ph(e.i,e.x,e.y),d=i.next,_=e.prev;return i.next=e,e.prev=i,r.next=d,d.prev=r,a.next=r,r.prev=a,_.next=a,a.prev=_,a}function Ud(i,e,r,a){var d=new ph(i,e,r);return a?(d.next=a.next,d.prev=a,a.next.prev=d,a.next=d):(d.prev=d,d.next=d),d}function Pl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ph(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fh(i,e,r,a){for(var d=0,_=e,y=r-a;_<r;_+=a)d+=(i[y]-i[_])*(i[_+1]+i[y+1]),y=_;return d}hh.exports=nu,hh.exports.default=nu,nu.deviation=function(i,e,r,a){var d=e&&e.length,_=Math.abs(fh(i,0,d?e[0]*r:i.length,r));if(d)for(var y=0,b=e.length;y<b;y++)_-=Math.abs(fh(i,e[y]*r,y<b-1?e[y+1]*r:i.length,r));var S=0;for(y=0;y<a.length;y+=3){var M=a[y]*r,E=a[y+1]*r,L=a[y+2]*r;S+=Math.abs((i[M]-i[L])*(i[E+1]-i[M+1])-(i[M]-i[E])*(i[L+1]-i[M+1]))}return _===0&&S===0?0:Math.abs((S-_)/_)},nu.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,d=0;d<i.length;d++){for(var _=0;_<i[d].length;_++)for(var y=0;y<e;y++)r.vertices.push(i[d][_][y]);d>0&&r.holes.push(a+=i[d-1].length)}return r};var jd=I(hh.exports);function u_(i,e,r,a,d){qd(i,e,r||0,a||i.length-1,d||h_)}function qd(i,e,r,a,d){for(;a>r;){if(a-r>600){var _=a-r+1,y=e-r+1,b=Math.log(_),S=.5*Math.exp(2*b/3),M=.5*Math.sqrt(b*S*(_-S)/_)*(y-_/2<0?-1:1);qd(i,e,Math.max(r,Math.floor(e-y*S/_+M)),Math.min(a,Math.floor(e+(_-y)*S/_+M)),d)}var E=i[e],L=r,F=a;for(zl(i,r,e),d(i[a],E)>0&&zl(i,r,a);L<F;){for(zl(i,L,F),L++,F--;d(i[L],E)<0;)L++;for(;d(i[F],E)>0;)F--}d(i[r],E)===0?zl(i,r,F):zl(i,++F,a),F<=e&&(r=F+1),e<=F&&(a=F-1)}}function zl(i,e,r){var a=i[e];i[e]=i[r],i[r]=a}function h_(i,e){return i<e?-1:i>e?1:0}function mh(i,e){const r=i.length;if(r<=1)return[i];const a=[];let d,_;for(let y=0;y<r;y++){const b=gt(i[y]);b!==0&&(i[y].area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(d&&a.push(d),d=[i[y]]):d.push(i[y]))}if(d&&a.push(d),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(u_(a[y],e,1,a[y].length-1,d_),a[y]=a[y].slice(0,e));return a}function d_(i,e){return e.area-i.area}function _h(i,e,r){const a=r.patternDependencies;let d=!1;for(const _ of e){const y=_.paint.get(`${i}-pattern`);y.isConstant()||(d=!0);const b=y.constantOr(null);b&&(d=!0,a[b.to]=!0,a[b.from]=!0)}return d}function gh(i,e,r,a,d){const _=d.patternDependencies;for(const y of e){const b=y.paint.get(`${i}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:a-1},r,{},d.availableImages),M=b.evaluate({zoom:a},r,{},d.availableImages),E=b.evaluate({zoom:a+1},r,{},d.availableImages);S=S&&S.name?S.name:S,M=M&&M.name?M.name:M,E=E&&E.name?E.name:E,_[S]=!0,_[M]=!0,_[E]=!0,r.patterns[y.id]={min:S,mid:M,max:E}}}return r}class yh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Kt,this.indexArray=new wr,this.indexArray2=new ar,this.programConfigurations=new no(e.layers,e.zoom),this.segments=new Ci,this.segments2=new Ci,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=_h("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),_=!d.isConstant(),y=[];for(const{feature:b,id:S,index:M,sourceLayerIndex:E}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Es(b,L);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),F,a))continue;const N=_?d.evaluate(F,{},a,r.availableImages):void 0,V={id:S,properties:b.properties,type:b.type,sourceLayerIndex:E,index:M,geometry:L?F.geometry:As(b),patterns:{},sortKey:N};y.push(V)}_&&y.sort((b,S)=>b.sortKey-S.sortKey);for(const b of y){const{geometry:S,index:M,sourceLayerIndex:E}=b;if(this.hasPattern){const L=gh("fill",this.layers,b,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(b,S,M,a,{});r.featureIndex.insert(e[M].feature,S,M,E,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,e_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,d,_){for(const y of mh(r,500)){let b=0;for(const N of y)b+=N.length;const S=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),M=S.vertexLength,E=[],L=[];for(const N of y){if(N.length===0)continue;N!==y[0]&&L.push(E.length/2);const V=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),Z=V.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(Z+N.length-1,Z),E.push(N[0].x),E.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(Z+J-1,Z+J),E.push(N[J].x),E.push(N[J].y);V.vertexLength+=N.length,V.primitiveLength+=N.length}const F=jd(E,L);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(M+F[N],M+F[N+1],M+F[N+2]);S.vertexLength+=b,S.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)}}let Zd,Gd;ut("FillBucket",yh,{omit:["layers","patternFeatures"]});var p_={get paint(){return Gd=Gd||new Ji({"fill-antialias":new bt(Ce.paint_fill["fill-antialias"]),"fill-opacity":new It(Ce.paint_fill["fill-opacity"]),"fill-color":new It(Ce.paint_fill["fill-color"]),"fill-outline-color":new It(Ce.paint_fill["fill-outline-color"]),"fill-translate":new bt(Ce.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(Ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new Is(Ce.paint_fill["fill-pattern"])})},get layout(){return Zd=Zd||new Ji({"fill-sort-key":new It(Ce.layout_fill["fill-sort-key"])})}};class f_ extends Sn{constructor(e){super(e,p_)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new yh(e)}queryRadius(){return tu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,d,_,y,b){return Id(iu(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,b),d)}isTileClipped(){return!0}}const m_=Bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),__=Bi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:g_}=m_;var ns={},y_=D,Xd=va;function va(i,e,r,a,d){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=d,i.readFields(v_,this,e)}function v_(i,e,r){i==1?e.id=r.readVarint():i==2?function(a,d){for(var _=a.readVarint()+a.pos;a.pos<_;){var y=d._keys[a.readVarint()],b=d._values[a.readVarint()];d.properties[y]=b}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function b_(i){for(var e,r,a=0,d=0,_=i.length,y=_-1;d<_;y=d++)a+=((r=i[y]).x-(e=i[d]).x)*(e.y+r.y);return a}va.types=["Unknown","Point","LineString","Polygon"],va.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,a=1,d=0,_=0,y=0,b=[];i.pos<r;){if(d<=0){var S=i.readVarint();a=7&S,d=S>>3}if(d--,a===1||a===2)_+=i.readSVarint(),y+=i.readSVarint(),a===1&&(e&&b.push(e),e=[]),e.push(new y_(_,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&b.push(e),b},va.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,a=0,d=0,_=0,y=1/0,b=-1/0,S=1/0,M=-1/0;i.pos<e;){if(a<=0){var E=i.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(d+=i.readSVarint())<y&&(y=d),d>b&&(b=d),(_+=i.readSVarint())<S&&(S=_),_>M&&(M=_);else if(r!==7)throw new Error("unknown command "+r)}return[y,S,b,M]},va.prototype.toGeoJSON=function(i,e,r){var a,d,_=this.extent*Math.pow(2,r),y=this.extent*i,b=this.extent*e,S=this.loadGeometry(),M=va.types[this.type];function E(N){for(var V=0;V<N.length;V++){var Z=N[V];N[V]=[360*(Z.x+y)/_-180,360/Math.PI*Math.atan(Math.exp((180-360*(Z.y+b)/_)*Math.PI/180))-90]}}switch(this.type){case 1:var L=[];for(a=0;a<S.length;a++)L[a]=S[a][0];E(S=L);break;case 2:for(a=0;a<S.length;a++)E(S[a]);break;case 3:for(S=function(N){var V=N.length;if(V<=1)return[N];for(var Z,J,ee=[],he=0;he<V;he++){var ne=b_(N[he]);ne!==0&&(J===void 0&&(J=ne<0),J===ne<0?(Z&&ee.push(Z),Z=[N[he]]):Z.push(N[he]))}return Z&&ee.push(Z),ee}(S),a=0;a<S.length;a++)for(d=0;d<S[a].length;d++)E(S[a][d])}S.length===1?S=S[0]:M="Multi"+M;var F={type:"Feature",geometry:{type:M,coordinates:S},properties:this.properties};return"id"in this&&(F.id=this.id),F};var x_=Xd,Wd=Hd;function Hd(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(w_,this,e),this.length=this._features.length}function w_(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(a){for(var d=null,_=a.readVarint()+a.pos;a.pos<_;){var y=a.readVarint()>>3;d=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return d}(r))}Hd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new x_(this._pbf,e,this.extent,this._keys,this._values)};var S_=Wd;function T_(i,e,r){if(i===3){var a=new S_(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}ns.VectorTile=function(i,e){this.layers=i.readFields(T_,{},e)},ns.VectorTileFeature=Xd,ns.VectorTileLayer=Wd;const k_=ns.VectorTileFeature.types,vh=Math.pow(2,13);function Ll(i,e,r,a,d,_,y,b){i.emplaceBack(e,r,2*Math.floor(a*vh)+y,d*vh*2,_*vh*2,Math.round(b))}class bh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new tt,this.centroidVertexArray=new We,this.indexArray=new wr,this.programConfigurations=new no(e.layers,e.zoom),this.segments=new Ci,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=_h("fill-extrusion",this.layers,r);for(const{feature:d,id:_,index:y,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,M=Es(d,S);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),M,a))continue;const E={id:_,sourceLayerIndex:b,index:y,geometry:S?M.geometry:As(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(gh("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,y,a,{}),r.featureIndex.insert(d,E.geometry,y,b,this.index,!0)}}addFeatures(e,r,a){for(const d of this.features){const{geometry:_}=d;this.addFeature(d,_,d.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g_),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,__.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,d,_){const y={x:0,y:0,vertexCount:0};for(const b of mh(r,500)){let S=0;for(const V of b)S+=V.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const V of b){if(V.length===0||M_(V))continue;let Z=0;for(let J=0;J<V.length;J++){const ee=V[J];if(J>=1){const he=V[J-1];if(!I_(ee,he)){M.vertexLength+4>Ci.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ne=ee.sub(he)._perp()._unit(),fe=he.dist(ee);Z+fe>32768&&(Z=0),Ll(this.layoutVertexArray,ee.x,ee.y,ne.x,ne.y,0,0,Z),Ll(this.layoutVertexArray,ee.x,ee.y,ne.x,ne.y,0,1,Z),y.x+=2*ee.x,y.y+=2*ee.y,y.vertexCount+=2,Z+=fe,Ll(this.layoutVertexArray,he.x,he.y,ne.x,ne.y,0,0,Z),Ll(this.layoutVertexArray,he.x,he.y,ne.x,ne.y,0,1,Z),y.x+=2*he.x,y.y+=2*he.y,y.vertexCount+=2;const ve=M.vertexLength;this.indexArray.emplaceBack(ve,ve+2,ve+1),this.indexArray.emplaceBack(ve+1,ve+2,ve+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+S>Ci.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),k_[e.type]!=="Polygon")continue;const E=[],L=[],F=M.vertexLength;for(const V of b)if(V.length!==0){V!==b[0]&&L.push(E.length/2);for(let Z=0;Z<V.length;Z++){const J=V[Z];Ll(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),y.x+=J.x,y.y+=J.y,y.vertexCount+=1,E.push(J.x),E.push(J.y)}}const N=jd(E,L);for(let V=0;V<N.length;V+=3)this.indexArray.emplaceBack(F+N[V],F+N[V+2],F+N[V+1]);M.primitiveLength+=N.length/3,M.vertexLength+=S}for(let b=0;b<y.vertexCount;b++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)}}function I_(i,e){return i.x===e.x&&(i.x<0||i.x>rr)||i.y===e.y&&(i.y<0||i.y>rr)}function M_(i){return i.every(e=>e.x<0)||i.every(e=>e.x>rr)||i.every(e=>e.y<0)||i.every(e=>e.y>rr)}let Kd;ut("FillExtrusionBucket",bh,{omit:["layers","features"]});var C_={get paint(){return Kd=Kd||new Ji({"fill-extrusion-opacity":new bt(Ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(Ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(Ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(Ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Is(Ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new It(Ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(Ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bt(Ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class A_ extends Sn{constructor(e){super(e,C_)}createBucket(e){return new bh(e)}queryRadius(){return tu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,d,_,y,b,S){const M=iu(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,b),E=this.paint.get("fill-extrusion-height").evaluate(r,a),L=this.paint.get("fill-extrusion-base").evaluate(r,a),F=function(V,Z,J,ee){const he=[];for(const ne of V){const fe=[ne.x,ne.y,0,1];ru(fe,fe,Z),he.push(new ie(fe[0]/fe[3],fe[1]/fe[3]))}return he}(M,S),N=function(V,Z,J,ee){const he=[],ne=[],fe=ee[8]*Z,ve=ee[9]*Z,De=ee[10]*Z,ot=ee[11]*Z,mt=ee[8]*J,rt=ee[9]*J,it=ee[10]*J,Ke=ee[11]*J;for(const ht of V){const $e=[],Ze=[];for(const St of ht){const yt=St.x,Gt=St.y,Ai=ee[0]*yt+ee[4]*Gt+ee[12],Pi=ee[1]*yt+ee[5]*Gt+ee[13],ur=ee[2]*yt+ee[6]*Gt+ee[14],kn=ee[3]*yt+ee[7]*Gt+ee[15],Xr=ur+De,nr=kn+ot,Tr=Ai+mt,Er=Pi+rt,Wr=ur+it,Hr=kn+Ke,hr=new ie((Ai+fe)/nr,(Pi+ve)/nr);hr.z=Xr/nr,$e.push(hr);const dr=new ie(Tr/Hr,Er/Hr);dr.z=Wr/Hr,Ze.push(dr)}he.push($e),ne.push(Ze)}return[he,ne]}(d,L,E,S);return function(V,Z,J){let ee=1/0;Id(J,Z)&&(ee=Yd(J,Z[0]));for(let he=0;he<Z.length;he++){const ne=Z[he],fe=V[he];for(let ve=0;ve<ne.length-1;ve++){const De=ne[ve],ot=[De,ne[ve+1],fe[ve+1],fe[ve],De];kd(J,ot)&&(ee=Math.min(ee,Yd(J,ot)))}}return ee!==1/0&&ee}(N[0],N[1],F)}}function Dl(i,e){return i.x*e.x+i.y*e.y}function Yd(i,e){if(i.length===1){let r=0;const a=e[r++];let d;for(;!d||a.equals(d);)if(d=e[r++],!d)return 1/0;for(;r<e.length;r++){const _=e[r],y=i[0],b=d.sub(a),S=_.sub(a),M=y.sub(a),E=Dl(b,b),L=Dl(b,S),F=Dl(S,S),N=Dl(M,b),V=Dl(M,S),Z=E*F-L*L,J=(F*N-L*V)/Z,ee=(E*V-L*N)/Z,he=a.z*(1-J-ee)+d.z*J+_.z*ee;if(isFinite(he))return he}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const E_=Bi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:P_}=E_,z_=Bi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:L_}=z_,D_=ns.VectorTileFeature.types,B_=Math.cos(Math.PI/180*37.5),Jd=Math.pow(2,14)/.5;class xh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Mt,this.layoutVertexArray2=new _t,this.indexArray=new wr,this.programConfigurations=new no(e.layers,e.zoom),this.segments=new Ci,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=_h("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),_=!d.isConstant(),y=[];for(const{feature:b,id:S,index:M,sourceLayerIndex:E}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Es(b,L);if(!this.layers[0]._featureFilter.filter(new Mi(this.zoom),F,a))continue;const N=_?d.evaluate(F,{},a):void 0,V={id:S,properties:b.properties,type:b.type,sourceLayerIndex:E,index:M,geometry:L?F.geometry:As(b),patterns:{},sortKey:N};y.push(V)}_&&y.sort((b,S)=>b.sortKey-S.sortKey);for(const b of y){const{geometry:S,index:M,sourceLayerIndex:E}=b;if(this.hasPattern){const L=gh("line",this.layers,b,this.zoom,r);this.patternFeatures.push(L)}else this.addFeature(b,S,M,a,{});r.featureIndex.insert(e[M].feature,S,M,E,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,L_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,P_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,d,_){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),S=y.get("line-cap"),M=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of r)this.addLine(L,e,b,S,M,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)}addLine(e,r,a,d,_,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=D_[r.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let M=0;for(;M<S-1&&e[M].equals(e[M+1]);)M++;if(S<(b?3:2))return;a==="bevel"&&(_=1.05);const E=this.overscaling<=16?15*rr/(512*this.overscaling):0,L=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let F,N,V,Z,J;this.e1=this.e2=-1,b&&(F=e[S-2],J=e[M].sub(F)._unit()._perp());for(let ee=M;ee<S;ee++){if(V=ee===S-1?b?e[M+1]:void 0:e[ee+1],V&&e[ee].equals(V))continue;J&&(Z=J),F&&(N=F),F=e[ee],J=V?V.sub(F)._unit()._perp():Z,Z=Z||J;let he=Z.add(J);he.x===0&&he.y===0||he._unit();const ne=Z.x*J.x+Z.y*J.y,fe=he.x*J.x+he.y*J.y,ve=fe!==0?1/fe:1/0,De=2*Math.sqrt(2-2*fe),ot=fe<B_&&N&&V,mt=Z.x*J.y-Z.y*J.x>0;if(ot&&ee>M){const Ke=F.dist(N);if(Ke>2*E){const ht=F.sub(F.sub(N)._mult(E/Ke)._round());this.updateDistance(N,ht),this.addCurrentVertex(ht,Z,0,0,L),N=ht}}const rt=N&&V;let it=rt?a:b?"butt":d;if(rt&&it==="round"&&(ve<y?it="miter":ve<=2&&(it="fakeround")),it==="miter"&&ve>_&&(it="bevel"),it==="bevel"&&(ve>2&&(it="flipbevel"),ve<_&&(it="miter")),N&&this.updateDistance(N,F),it==="miter")he._mult(ve),this.addCurrentVertex(F,he,0,0,L);else if(it==="flipbevel"){if(ve>100)he=J.mult(-1);else{const Ke=ve*Z.add(J).mag()/Z.sub(J).mag();he._perp()._mult(Ke*(mt?-1:1))}this.addCurrentVertex(F,he,0,0,L),this.addCurrentVertex(F,he.mult(-1),0,0,L)}else if(it==="bevel"||it==="fakeround"){const Ke=-Math.sqrt(ve*ve-1),ht=mt?Ke:0,$e=mt?0:Ke;if(N&&this.addCurrentVertex(F,Z,ht,$e,L),it==="fakeround"){const Ze=Math.round(180*De/Math.PI/20);for(let St=1;St<Ze;St++){let yt=St/Ze;if(yt!==.5){const Ai=yt-.5;yt+=yt*Ai*(yt-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*Ai*Ai+(.848013+ne*(.215638*ne-1.06021)))}const Gt=J.sub(Z)._mult(yt)._add(Z)._unit()._mult(mt?-1:1);this.addHalfVertex(F,Gt.x,Gt.y,!1,mt,0,L)}}V&&this.addCurrentVertex(F,J,-ht,-$e,L)}else if(it==="butt")this.addCurrentVertex(F,he,0,0,L);else if(it==="square"){const Ke=N?1:-1;this.addCurrentVertex(F,he,Ke,Ke,L)}else it==="round"&&(N&&(this.addCurrentVertex(F,Z,0,0,L),this.addCurrentVertex(F,Z,1,1,L,!0)),V&&(this.addCurrentVertex(F,J,-1,-1,L,!0),this.addCurrentVertex(F,J,0,0,L)));if(ot&&ee<S-1){const Ke=F.dist(V);if(Ke>2*E){const ht=F.add(V.sub(F)._mult(E/Ke)._round());this.updateDistance(F,ht),this.addCurrentVertex(ht,J,0,0,L),F=ht}}}}addCurrentVertex(e,r,a,d,_,y=!1){const b=r.y*d-r.x,S=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,y,!1,a,_),this.addHalfVertex(e,b,S,y,!0,-d,_),this.distance>Jd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,d,_,y))}addHalfVertex({x:e,y:r},a,d,_,y,b,S){const M=.5*(this.lineClips?this.scaledDistance*(Jd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(_?1:0),(r<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*d)+128,1+(b===0?0:b<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),S.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let $d,Qd;ut("LineBucket",xh,{omit:["layers","patternFeatures"]});var ep={get paint(){return Qd=Qd||new Ji({"line-opacity":new It(Ce.paint_line["line-opacity"]),"line-color":new It(Ce.paint_line["line-color"]),"line-translate":new bt(Ce.paint_line["line-translate"]),"line-translate-anchor":new bt(Ce.paint_line["line-translate-anchor"]),"line-width":new It(Ce.paint_line["line-width"]),"line-gap-width":new It(Ce.paint_line["line-gap-width"]),"line-offset":new It(Ce.paint_line["line-offset"]),"line-blur":new It(Ce.paint_line["line-blur"]),"line-dasharray":new gl(Ce.paint_line["line-dasharray"]),"line-pattern":new Is(Ce.paint_line["line-pattern"]),"line-gradient":new yl(Ce.paint_line["line-gradient"])})},get layout(){return $d=$d||new Ji({"line-cap":new bt(Ce.layout_line["line-cap"]),"line-join":new It(Ce.layout_line["line-join"]),"line-miter-limit":new bt(Ce.layout_line["line-miter-limit"]),"line-round-limit":new bt(Ce.layout_line["line-round-limit"]),"line-sort-key":new It(Ce.layout_line["line-sort-key"])})}};class F_ extends It{possiblyEvaluate(e,r){return r=new Mi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,d){return r=Oe({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,d)}}let lu;class R_ extends Sn{constructor(e){super(e,ep),this.gradientVersion=0,lu||(lu=new F_(ep.paint.properties["line-width"].specification),lu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ho,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=lu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new xh(e)}queryRadius(e){const r=e,a=tp(Il("line-width",this,r),Il("line-gap-width",this,r)),d=Il("line-offset",this,r);return a/2+Math.abs(d)+tu(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,d,_,y,b){const S=iu(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,b),M=b/2*tp(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(d=function(L,F){const N=[];for(let V=0;V<L.length;V++){const Z=L[V],J=[];for(let ee=0;ee<Z.length;ee++){const he=Z[ee-1],ne=Z[ee],fe=Z[ee+1],ve=ee===0?new ie(0,0):ne.sub(he)._unit()._perp(),De=ee===Z.length-1?new ie(0,0):fe.sub(ne)._unit()._perp(),ot=ve._add(De)._unit(),mt=ot.x*De.x+ot.y*De.y;mt!==0&&ot._mult(1/mt),J.push(ot._mult(F)._add(ne))}N.push(J)}return N}(d,E*b)),function(L,F,N){for(let V=0;V<F.length;V++){const Z=F[V];if(L.length>=3){for(let J=0;J<Z.length;J++)if(_a(L,Z[J]))return!0}if(qm(L,Z,N))return!0}return!1}(S,d,M)}isTileClipped(){return!0}}function tp(i,e){return e>0?e+2*i:i}const O_=Bi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N_=Bi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const V_=Bi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Bi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ip=Bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),U_=Bi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function j_(i,e,r){return i.sections.forEach(a=>{a.text=function(d,_,y){const b=_.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?d=d.toLocaleUpperCase():b==="lowercase"&&(d=d.toLocaleLowerCase()),cn.applyArabicShaping&&(d=cn.applyArabicShaping(d)),d}(a.text,e,r)}),i}Bi([{name:"triangle",components:3,type:"Uint16"}]),Bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Bi([{type:"Float32",name:"offsetX"}]),Bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Bi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Bl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var cr=24,rp=bi,np=function(i,e,r,a,d){var _,y,b=8*d-a-1,S=(1<<b)-1,M=S>>1,E=-7,L=r?d-1:0,F=r?-1:1,N=i[e+L];for(L+=F,_=N&(1<<-E)-1,N>>=-E,E+=b;E>0;_=256*_+i[e+L],L+=F,E-=8);for(y=_&(1<<-E)-1,_>>=-E,E+=a;E>0;y=256*y+i[e+L],L+=F,E-=8);if(_===0)_=1-M;else{if(_===S)return y?NaN:1/0*(N?-1:1);y+=Math.pow(2,a),_-=M}return(N?-1:1)*y*Math.pow(2,_-a)},op=function(i,e,r,a,d,_){var y,b,S,M=8*_-d-1,E=(1<<M)-1,L=E>>1,F=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=a?0:_-1,V=a?1:-1,Z=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,y=E):(y=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-y))<1&&(y--,S*=2),(e+=y+L>=1?F/S:F*Math.pow(2,1-L))*S>=2&&(y++,S/=2),y+L>=E?(b=0,y=E):y+L>=1?(b=(e*S-1)*Math.pow(2,d),y+=L):(b=e*Math.pow(2,L-1)*Math.pow(2,d),y=0));d>=8;i[r+N]=255&b,N+=V,b/=256,d-=8);for(y=y<<d|b,M+=d;M>0;i[r+N]=255&y,N+=V,y/=256,M-=8);i[r+N-V]|=128*Z};function bi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}bi.Varint=0,bi.Fixed64=1,bi.Bytes=2,bi.Fixed32=5;var wh=4294967296,sp=1/wh,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bo(i){return i.type===bi.Bytes?i.readVarint()+i.pos:i.pos+1}function ba(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function lp(i,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var d=r.pos-1;d>=i;d--)r.buf[d+a]=r.buf[d]}function q_(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function Z_(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function G_(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function X_(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function W_(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function H_(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function K_(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function Y_(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function J_(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function cu(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function xa(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function cp(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}bi.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),d=a>>3,_=this.pos;this.type=7&a,i(d,e,this),this.pos===_&&this.skip(a)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=cu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=cp(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=cu(this.buf,this.pos)+cu(this.buf,this.pos+4)*wh;return this.pos+=8,i},readSFixed64:function(){var i=cu(this.buf,this.pos)+cp(this.buf,this.pos+4)*wh;return this.pos+=8,i},readFloat:function(){var i=np(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=np(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(d,_,y){var b,S,M=y.buf;if(b=(112&(S=M[y.pos++]))>>4,S<128||(b|=(127&(S=M[y.pos++]))<<3,S<128)||(b|=(127&(S=M[y.pos++]))<<10,S<128)||(b|=(127&(S=M[y.pos++]))<<17,S<128)||(b|=(127&(S=M[y.pos++]))<<24,S<128)||(b|=(1&(S=M[y.pos++]))<<31,S<128))return ba(d,b,_);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&ap?function(r,a,d){return ap.decode(r.subarray(a,d))}(this.buf,e,i):function(r,a,d){for(var _="",y=a;y<d;){var b,S,M,E=r[y],L=null,F=E>239?4:E>223?3:E>191?2:1;if(y+F>d)break;F===1?E<128&&(L=E):F===2?(192&(b=r[y+1]))==128&&(L=(31&E)<<6|63&b)<=127&&(L=null):F===3?(S=r[y+2],(192&(b=r[y+1]))==128&&(192&S)==128&&((L=(15&E)<<12|(63&b)<<6|63&S)<=2047||L>=55296&&L<=57343)&&(L=null)):F===4&&(S=r[y+2],M=r[y+3],(192&(b=r[y+1]))==128&&(192&S)==128&&(192&M)==128&&((L=(15&E)<<18|(63&b)<<12|(63&S)<<6|63&M)<=65535||L>=1114112)&&(L=null)),L===null?(L=65533,F=1):L>65535&&(L-=65536,_+=String.fromCharCode(L>>>10&1023|55296),L=56320|1023&L),_+=String.fromCharCode(L),y+=F}return _}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==bi.Bytes)return i.push(this.readVarint(e));var r=Bo(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==bi.Bytes)return i.push(this.readSVarint());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==bi.Bytes)return i.push(this.readBoolean());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==bi.Bytes)return i.push(this.readFloat());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==bi.Bytes)return i.push(this.readDouble());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==bi.Bytes)return i.push(this.readFixed32());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==bi.Bytes)return i.push(this.readSFixed32());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==bi.Bytes)return i.push(this.readFixed64());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==bi.Bytes)return i.push(this.readSFixed64());var e=Bo(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===bi.Varint)for(;this.buf[this.pos++]>127;);else if(e===bi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===bi.Fixed32)this.pos+=4;else{if(e!==bi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),xa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),xa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),xa(this.buf,-1&i,this.pos),xa(this.buf,Math.floor(i*sp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),xa(this.buf,-1&i,this.pos),xa(this.buf,Math.floor(i*sp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var a,d;if(e>=0?(a=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(_,y,b){b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,_>>>=7,b.buf[b.pos++]=127&_|128,b.buf[b.pos]=127&(_>>>=7)}(a,0,r),function(_,y){var b=(7&_)<<4;y.buf[y.pos++]|=b|((_>>>=3)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_|((_>>>=7)?128:0),_&&(y.buf[y.pos++]=127&_)))))}(d,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(a,d,_){for(var y,b,S=0;S<d.length;S++){if((y=d.charCodeAt(S))>55295&&y<57344){if(!b){y>56319||S+1===d.length?(a[_++]=239,a[_++]=191,a[_++]=189):b=y;continue}if(y<56320){a[_++]=239,a[_++]=191,a[_++]=189,b=y;continue}y=b-55296<<10|y-56320|65536,b=null}else b&&(a[_++]=239,a[_++]=191,a[_++]=189,b=null);y<128?a[_++]=y:(y<2048?a[_++]=y>>6|192:(y<65536?a[_++]=y>>12|224:(a[_++]=y>>18|240,a[_++]=y>>12&63|128),a[_++]=y>>6&63|128),a[_++]=63&y|128)}return _}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&lp(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),op(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),op(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var a=this.pos-r;a>=128&&lp(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,e,r){this.writeTag(i,bi.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,q_,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,Z_,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,W_,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,G_,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,X_,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,H_,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,K_,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,Y_,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,J_,e)},writeBytesField:function(i,e){this.writeTag(i,bi.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,bi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,bi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,bi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,bi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,bi.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,bi.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,bi.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,bi.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,bi.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,!!e)}};var Sh=I(rp);const Th=3;function $_(i,e,r){i===1&&r.readMessage(Q_,e)}function Q_(i,e,r){if(i===3){const{id:a,bitmap:d,width:_,height:y,left:b,top:S,advance:M}=r.readMessage(eg,{});e.push({id:a,bitmap:new Cl({width:_+2*Th,height:y+2*Th},d),metrics:{width:_,height:y,left:b,top:S,advance:M}})}}function eg(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const up=Th;function hp(i){let e=0,r=0;for(const y of i)e+=y.w*y.h,r=Math.max(r,y.w);i.sort((y,b)=>b.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let d=0,_=0;for(const y of i)for(let b=a.length-1;b>=0;b--){const S=a[b];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,_=Math.max(_,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===S.w&&y.h===S.h){const M=a.pop();b<a.length&&(a[b]=M)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:d,h:_,fill:e/(d*_)||0}}const hn=1;class kh{constructor(e,{pixelRatio:r,version:a,stretchX:d,stretchY:_,content:y}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=d,this.stretchY=_,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+hn,this.paddedRect.y+hn]}get br(){return[this.paddedRect.x+this.paddedRect.w-hn,this.paddedRect.y+this.paddedRect.h-hn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*hn)/this.pixelRatio,(this.paddedRect.h-2*hn)/this.pixelRatio]}}class dp{constructor(e,r){const a={},d={};this.haveRenderCallbacks=[];const _=[];this.addImages(e,a,_),this.addImages(r,d,_);const{w:y,h:b}=hp(_),S=new An({width:y||1,height:b||1});for(const M in e){const E=e[M],L=a[M].paddedRect;An.copy(E.data,S,{x:0,y:0},{x:L.x+hn,y:L.y+hn},E.data)}for(const M in r){const E=r[M],L=d[M].paddedRect,F=L.x+hn,N=L.y+hn,V=E.data.width,Z=E.data.height;An.copy(E.data,S,{x:0,y:0},{x:F,y:N},E.data),An.copy(E.data,S,{x:0,y:Z-1},{x:F,y:N-1},{width:V,height:1}),An.copy(E.data,S,{x:0,y:0},{x:F,y:N+Z},{width:V,height:1}),An.copy(E.data,S,{x:V-1,y:0},{x:F-1,y:N},{width:1,height:Z}),An.copy(E.data,S,{x:0,y:0},{x:F+V,y:N},{width:1,height:Z})}this.image=S,this.iconPositions=a,this.patternPositions=d}addImages(e,r,a){for(const d in e){const _=e[d],y={x:0,y:0,w:_.data.width+2*hn,h:_.data.height+2*hn};a.push(y),r[d]=new kh(y,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[d,_]=e.tl;a.update(r.data,void 0,{x:d,y:_})}}var os;ut("ImagePosition",kh),ut("ImageAtlas",dp),s.ai=void 0,(os=s.ai||(s.ai={}))[os.none=0]="none",os[os.horizontal=1]="horizontal",os[os.vertical=2]="vertical",os[os.horizontalOnly=3]="horizontalOnly";const Fl=-17;class Rl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new Rl;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new Rl;return r.imageName=e,r}}class wa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new wa;for(let d=0;d<e.sections.length;d++){const _=e.sections[d];_.image?a.addImageSection(_):a.addTextSection(_,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const d=e.charCodeAt(a+1)||null,_=e.charCodeAt(a-1)||null;r+=d&&Zc(d)&&!Bl[e[a+1]]||_&&Zc(_)&&!Bl[e[a-1]]||!Bl[e[a]]?e[a]:Bl[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&hu[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&hu[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new wa;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Rl.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void Ne("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Rl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ne("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function uu(i,e,r,a,d,_,y,b,S,M,E,L,F,N,V,Z){const J=wa.fromFeature(i,d);let ee;L===s.ai.vertical&&J.verticalizePunctuation();const{processBidirectionalText:he,processStyledBidirectionalText:ne}=cn;if(he&&J.sections.length===1){ee=[];const De=he(J.toString(),Ih(J,M,_,e,a,N,V));for(const ot of De){const mt=new wa;mt.text=ot,mt.sections=J.sections;for(let rt=0;rt<ot.length;rt++)mt.sectionIndex.push(0);ee.push(mt)}}else if(ne){ee=[];const De=ne(J.text,J.sectionIndex,Ih(J,M,_,e,a,N,V));for(const ot of De){const mt=new wa;mt.text=ot[0],mt.sectionIndex=ot[1],mt.sections=J.sections,ee.push(mt)}}else ee=function(De,ot){const mt=[],rt=De.text;let it=0;for(const Ke of ot)mt.push(De.substring(it,Ke)),it=Ke;return it<rt.length&&mt.push(De.substring(it,rt.length)),mt}(J,Ih(J,M,_,e,a,N,V));const fe=[],ve={positionedLines:fe,text:J.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(De,ot,mt,rt,it,Ke,ht,$e,Ze,St,yt,Gt){let Ai=0,Pi=Fl,ur=0,kn=0;const Xr=$e==="right"?1:$e==="left"?0:.5;let nr=0;for(const hr of it){hr.trim();const dr=hr.getMaxScale(),Rr=(dr-1)*cr,Kr={positionedGlyphs:[],lineOffset:0};De.positionedLines[nr]=Kr;const Or=Kr.positionedGlyphs;let dn=0;if(!hr.length()){Pi+=Ke,++nr;continue}for(let pr=0;pr<hr.length();pr++){const $t=hr.getSection(pr),Nr=hr.getSectionIndex(pr),Pr=hr.getCharCode(pr);let fr=0,Zn=null,oo=null,so=null,Fo=cr;const Gn=!(Ze===s.ai.horizontal||!yt&&!cl(Pr)||yt&&(hu[Pr]||(Tr=Pr,nt.Arabic(Tr)||nt["Arabic Supplement"](Tr)||nt["Arabic Extended-A"](Tr)||nt["Arabic Presentation Forms-A"](Tr)||nt["Arabic Presentation Forms-B"](Tr))));if($t.imageName){const Pn=rt[$t.imageName];if(!Pn)continue;so=$t.imageName,De.iconsInText=De.iconsInText||!0,oo=Pn.paddedRect;const fn=Pn.displaySize;$t.scale=$t.scale*cr/Gt,Zn={width:fn[0],height:fn[1],left:hn,top:-up,advance:Gn?fn[1]:fn[0]},fr=Rr+(cr-fn[1]*$t.scale),Fo=Zn.advance;const Ro=Gn?fn[0]*$t.scale-cr*dr:fn[1]*$t.scale-cr*dr;Ro>0&&Ro>dn&&(dn=Ro)}else{const Pn=mt[$t.fontStack],fn=Pn&&Pn[Pr];if(fn&&fn.rect)oo=fn.rect,Zn=fn.metrics;else{const Ro=ot[$t.fontStack],jl=Ro&&Ro[Pr];if(!jl)continue;Zn=jl.metrics}fr=(dr-$t.scale)*cr}Gn?(De.verticalizable=!0,Or.push({glyph:Pr,imageName:so,x:Ai,y:Pi+fr,vertical:Gn,scale:$t.scale,fontStack:$t.fontStack,sectionIndex:Nr,metrics:Zn,rect:oo}),Ai+=Fo*$t.scale+St):(Or.push({glyph:Pr,imageName:so,x:Ai,y:Pi+fr,vertical:Gn,scale:$t.scale,fontStack:$t.fontStack,sectionIndex:Nr,metrics:Zn,rect:oo}),Ai+=Zn.advance*$t.scale+St)}Or.length!==0&&(ur=Math.max(Ai-St,ur),rg(Or,0,Or.length-1,Xr,dn)),Ai=0;const pn=Ke*dr+dn;Kr.lineOffset=Math.max(dn,Rr),Pi+=pn,kn=Math.max(pn,kn),++nr}var Tr;const Er=Pi-Fl,{horizontalAlign:Wr,verticalAlign:Hr}=Mh(ht);(function(hr,dr,Rr,Kr,Or,dn,pn,pr,$t){const Nr=(dr-Rr)*Or;let Pr=0;Pr=dn!==pn?-pr*Kr-Fl:(-Kr*$t+.5)*pn;for(const fr of hr)for(const Zn of fr.positionedGlyphs)Zn.x+=Nr,Zn.y+=Pr})(De.positionedLines,Xr,Wr,Hr,ur,kn,Ke,Er,it.length),De.top+=-Hr*Er,De.bottom=De.top+Er,De.left+=-Wr*ur,De.right=De.left+ur}(ve,e,r,a,ee,y,b,S,L,M,F,Z),!function(De){for(const ot of De)if(ot.positionedGlyphs.length!==0)return!1;return!0}(fe)&&ve}const hu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function pp(i,e,r,a,d,_){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*cr/_+d:0}{const y=r[e.fontStack],b=y&&y[i];return b?b.metrics.advance*e.scale+d:0}}function fp(i,e,r,a){const d=Math.pow(i-e,2);return a?i<e?d/2:2*d:d+Math.abs(r)*r}function ig(i,e,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function mp(i,e,r,a,d,_){let y=null,b=fp(e,r,d,_);for(const S of a){const M=fp(e-S.x,r,d,_)+S.badness;M<=b&&(y=S,b=M)}return{index:i,x:e,priorBreak:y,badness:b}}function _p(i){return i?_p(i.priorBreak).concat(i.index):[]}function Ih(i,e,r,a,d,_,y){if(_!=="point")return[];if(!i)return[];const b=[],S=function(F,N,V,Z,J,ee){let he=0;for(let ne=0;ne<F.length();ne++){const fe=F.getSection(ne);he+=pp(F.getCharCode(ne),fe,Z,J,N,ee)}return he/Math.max(1,Math.ceil(he/V))}(i,e,r,a,d,y),M=i.text.indexOf("​")>=0;let E=0;for(let F=0;F<i.length();F++){const N=i.getSection(F),V=i.getCharCode(F);if(hu[V]||(E+=pp(V,N,a,d,e,y)),F<i.length()-1){const Z=!((L=V)<11904||!(nt["Bopomofo Extended"](L)||nt.Bopomofo(L)||nt["CJK Compatibility Forms"](L)||nt["CJK Compatibility Ideographs"](L)||nt["CJK Compatibility"](L)||nt["CJK Radicals Supplement"](L)||nt["CJK Strokes"](L)||nt["CJK Symbols and Punctuation"](L)||nt["CJK Unified Ideographs Extension A"](L)||nt["CJK Unified Ideographs"](L)||nt["Enclosed CJK Letters and Months"](L)||nt["Halfwidth and Fullwidth Forms"](L)||nt.Hiragana(L)||nt["Ideographic Description Characters"](L)||nt["Kangxi Radicals"](L)||nt["Katakana Phonetic Extensions"](L)||nt.Katakana(L)||nt["Vertical Forms"](L)||nt["Yi Radicals"](L)||nt["Yi Syllables"](L)));(tg[V]||Z||N.imageName)&&b.push(mp(F+1,E,S,b,ig(V,i.getCharCode(F+1),Z&&M),!1))}}var L;return _p(mp(i.length(),E,S,b,0,!0))}function Mh(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function rg(i,e,r,a,d){if(!a&&!d)return;const _=i[r],y=(i[r].x+_.metrics.advance*_.scale)*a;for(let b=e;b<=r;b++)i[b].x-=y,i[b].y+=d}function ng(i,e,r){const{horizontalAlign:a,verticalAlign:d}=Mh(r),_=e[0]-i.displaySize[0]*a,y=e[1]-i.displaySize[1]*d;return{image:i,top:y,bottom:y+i.displaySize[1],left:_,right:_+i.displaySize[0]}}function gp(i,e,r,a,d,_){const y=i.image;let b;if(y.content){const J=y.content,ee=y.pixelRatio||1;b=[J[0]/ee,J[1]/ee,y.displaySize[0]-J[2]/ee,y.displaySize[1]-J[3]/ee]}const S=e.left*_,M=e.right*_;let E,L,F,N;r==="width"||r==="both"?(N=d[0]+S-a[3],L=d[0]+M+a[1]):(N=d[0]+(S+M-y.displaySize[0])/2,L=N+y.displaySize[0]);const V=e.top*_,Z=e.bottom*_;return r==="height"||r==="both"?(E=d[1]+V-a[0],F=d[1]+Z+a[2]):(E=d[1]+(V+Z-y.displaySize[1])/2,F=E+y.displaySize[1]),{image:y,top:E,right:L,bottom:F,left:N,collisionPadding:b}}const Ol=255,go=128,ss=Ol*go;function yp(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Mi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:d}=r;let _=0;for(;_<a.length&&a[_]<=i;)_++;_=Math.max(0,_-1);let y=_;for(;y<a.length&&a[y]<i+1;)y++;y=Math.min(a.length-1,y);const b=a[_],S=a[y];return r.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:d}:{kind:"camera",minZoom:b,maxZoom:S,minSize:r.evaluate(new Mi(b)),maxSize:r.evaluate(new Mi(S)),interpolationType:d}}}function Ch(i,e,r){let a="never";const d=i.get(e);return d?a=d:i.get(r)&&(a="always"),a}const og=ns.VectorTileFeature.types,sg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function du(i,e,r,a,d,_,y,b,S,M,E,L,F){const N=b?Math.min(ss,Math.round(b[0])):0,V=b?Math.min(ss,Math.round(b[1])):0;i.emplaceBack(e,r,Math.round(32*a),Math.round(32*d),_,y,(N<<1)+(S?1:0),V,16*M,16*E,256*L,256*F)}function Ah(i,e,r){i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r),i.emplaceBack(e.x,e.y,r)}function ag(i){for(const e of i.sections)if(th(e.text))return!0;return!1}class Eh{constructor(e){this.layoutVertexArray=new Wt,this.indexArray=new wr,this.programConfigurations=e,this.segments=new Ci,this.dynamicLayoutVertexArray=new Nt,this.opacityVertexArray=new Yt,this.hasVisibleVertices=!1,this.placedSymbolArray=new ae}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,N_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sg,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ut("SymbolBuffers",Eh);class Ph{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Ci,this.collisionVertexArray=new Ii}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,V_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ut("CollisionBuffers",Ph);class Sa{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=lh([]),this.placementViewportMatrix=lh([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yp(this.zoom,r["text-size"]),this.iconSizeData=yp(this.zoom,r["icon-size"]);const a=this.layers[0].layout,d=a.get("symbol-sort-key"),_=a.get("symbol-z-order");this.canOverlap=Ch(a,"text-overlap","text-allow-overlap")!=="never"||Ch(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>s.ai[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Eh(new no(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Eh(new no(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ce,this.lineVertexArray=new Se,this.symbolInstances=new Q,this.textAnchorOffsets=new Le}calculateGlyphDependencies(e,r,a,d,_){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(a||d)&&_){const b=Bl[e.charAt(y)];b&&(r[b.charCodeAt(0)]=!0)}}populate(e,r,a){const d=this.layers[0],_=d.layout,y=_.get("text-font"),b=_.get("text-field"),S=_.get("icon-image"),M=(b.value.kind!=="constant"||b.value.value instanceof Mr&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),E=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!M&&!E)return;const F=r.iconDependencies,N=r.glyphDependencies,V=r.availableImages,Z=new Mi(this.zoom);for(const{feature:J,id:ee,index:he,sourceLayerIndex:ne}of e){const fe=d._featureFilter.needGeometry,ve=Es(J,fe);if(!d._featureFilter.filter(Z,ve,a))continue;let De,ot;if(fe||(ve.geometry=As(J)),M){const rt=d.getValueAndResolveTokens("text-field",ve,a,V),it=Mr.factory(rt);ag(it)&&(this.hasRTLText=!0),(!this.hasRTLText||ml()==="unavailable"||this.hasRTLText&&cn.isParsed())&&(De=j_(it,d,ve))}if(E){const rt=d.getValueAndResolveTokens("icon-image",ve,a,V);ot=rt instanceof xr?rt:xr.fromString(rt)}if(!De&&!ot)continue;const mt=this.sortFeaturesByKey?L.evaluate(ve,{},a):void 0;if(this.features.push({id:ee,text:De,icon:ot,index:he,sourceLayerIndex:ne,geometry:ve.geometry,properties:J.properties,type:og[J.type],sortKey:mt}),ot&&(F[ot.name]=!0),De){const rt=y.evaluate(ve,{},a).join(","),it=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const Ke of De.sections)if(Ke.image)F[Ke.image.name]=!0;else{const ht=al(De.toString()),$e=Ke.fontStack||rt,Ze=N[$e]=N[$e]||{};this.calculateGlyphDependencies(Ke.text,Ze,it,this.allowVerticalPlacement,ht)}}}_.get("symbol-placement")==="line"&&(this.features=function(J){const ee={},he={},ne=[];let fe=0;function ve(rt){ne.push(J[rt]),fe++}function De(rt,it,Ke){const ht=he[rt];return delete he[rt],he[it]=ht,ne[ht].geometry[0].pop(),ne[ht].geometry[0]=ne[ht].geometry[0].concat(Ke[0]),ht}function ot(rt,it,Ke){const ht=ee[it];return delete ee[it],ee[rt]=ht,ne[ht].geometry[0].shift(),ne[ht].geometry[0]=Ke[0].concat(ne[ht].geometry[0]),ht}function mt(rt,it,Ke){const ht=Ke?it[0][it[0].length-1]:it[0][0];return`${rt}:${ht.x}:${ht.y}`}for(let rt=0;rt<J.length;rt++){const it=J[rt],Ke=it.geometry,ht=it.text?it.text.toString():null;if(!ht){ve(rt);continue}const $e=mt(ht,Ke),Ze=mt(ht,Ke,!0);if($e in he&&Ze in ee&&he[$e]!==ee[Ze]){const St=ot($e,Ze,Ke),yt=De($e,Ze,ne[St].geometry);delete ee[$e],delete he[Ze],he[mt(ht,ne[yt].geometry,!0)]=yt,ne[St].geometry=null}else $e in he?De($e,Ze,Ke):Ze in ee?ot($e,Ze,Ke):(ve(rt),ee[$e]=fe-1,he[Ze]=fe-1)}return ne.filter(rt=>rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(r[e.segment+1]),_=e.dist(r[e.segment]);const y={};for(let b=e.segment+1;b<r.length;b++)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:d},b<r.length-1&&(d+=r[b+1].dist(r[b]));for(let b=e.segment||0;b>=0;b--)y[b]={x:r[b].x,y:r[b].y,tileUnitDistanceFromAnchor:_},b>0&&(_+=r[b-1].dist(r[b]));for(let b=0;b<r.length;b++){const S=y[b];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,d,_,y,b,S,M,E,L,F){const N=e.indexArray,V=e.layoutVertexArray,Z=e.segments.prepareSegment(4*r.length,V,N,this.canOverlap?y.sortKey:void 0),J=this.glyphOffsetArray.length,ee=Z.vertexLength,he=this.allowVerticalPlacement&&b===s.ai.vertical?Math.PI/2:0,ne=y.text&&y.text.sections;for(let fe=0;fe<r.length;fe++){const{tl:ve,tr:De,bl:ot,br:mt,tex:rt,pixelOffsetTL:it,pixelOffsetBR:Ke,minFontScaleX:ht,minFontScaleY:$e,glyphOffset:Ze,isSDF:St,sectionIndex:yt}=r[fe],Gt=Z.vertexLength,Ai=Ze[1];du(V,S.x,S.y,ve.x,Ai+ve.y,rt.x,rt.y,a,St,it.x,it.y,ht,$e),du(V,S.x,S.y,De.x,Ai+De.y,rt.x+rt.w,rt.y,a,St,Ke.x,it.y,ht,$e),du(V,S.x,S.y,ot.x,Ai+ot.y,rt.x,rt.y+rt.h,a,St,it.x,Ke.y,ht,$e),du(V,S.x,S.y,mt.x,Ai+mt.y,rt.x+rt.w,rt.y+rt.h,a,St,Ke.x,Ke.y,ht,$e),Ah(e.dynamicLayoutVertexArray,S,he),N.emplaceBack(Gt,Gt+1,Gt+2),N.emplaceBack(Gt+1,Gt+2,Gt+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ze[0]),fe!==r.length-1&&yt===r[fe+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,y,y.index,{},F,ne&&ne[yt])}e.placedSymbolArray.emplaceBack(S.x,S.y,J,this.glyphOffsetArray.length-J,ee,M,E,S.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],b,0,!1,0,L)}_addCollisionDebugVertex(e,r,a,d,_,y){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,_,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,a,d,_,y,b){const S=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),M=S.vertexLength,E=_.layoutVertexArray,L=_.collisionVertexArray,F=b.anchorX,N=b.anchorY;this._addCollisionDebugVertex(E,L,y,F,N,new ie(e,r)),this._addCollisionDebugVertex(E,L,y,F,N,new ie(a,r)),this._addCollisionDebugVertex(E,L,y,F,N,new ie(a,d)),this._addCollisionDebugVertex(E,L,y,F,N,new ie(e,d)),S.vertexLength+=4;const V=_.indexArray;V.emplaceBack(M,M+1),V.emplaceBack(M+1,M+2),V.emplaceBack(M+2,M+3),V.emplaceBack(M+3,M),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,d){for(let _=e;_<r;_++){const y=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ph(Xi,ip.members,ar),this.iconCollisionBox=new Ph(Xi,ip.members,ar);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,d,_,y,b,S,M){const E={};for(let L=r;L<a;L++){const F=e.get(L);E.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.textFeatureIndex=F.featureIndex;break}for(let L=d;L<_;L++){const F=e.get(L);E.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalTextFeatureIndex=F.featureIndex;break}for(let L=y;L<b;L++){const F=e.get(L);E.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.iconFeatureIndex=F.featureIndex;break}for(let L=S;L<M;L++){const F=e.get(L);E.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalIconFeatureIndex=F.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),d=a.vertexStartIndex+4*a.numGlyphs;for(let _=a.vertexStartIndex;_<d;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),d=[],_=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const S=this.symbolInstances.get(b);d.push(0|Math.round(r*S.anchorX+a*S.anchorY)),_.push(S.featureIndex)}return y.sort((b,S)=>d[b]-d[S]||_[S]-_[b]),y}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((d,_,y)=>{d>=0&&y.indexOf(d)===_&&this.addIndicesForPlacedSymbol(this.text,d)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vp,bp;ut("SymbolBucket",Sa,{omit:["layers","collisionBoxArray","features","compareText"]}),Sa.MAX_GLYPHS=65535,Sa.addDynamicAttributes=Ah;var zh={get paint(){return bp=bp||new Ji({"icon-opacity":new It(Ce.paint_symbol["icon-opacity"]),"icon-color":new It(Ce.paint_symbol["icon-color"]),"icon-halo-color":new It(Ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(Ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(Ce.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(Ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(Ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new It(Ce.paint_symbol["text-opacity"]),"text-color":new It(Ce.paint_symbol["text-color"],{runtimeType:Dr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new It(Ce.paint_symbol["text-halo-color"]),"text-halo-width":new It(Ce.paint_symbol["text-halo-width"]),"text-halo-blur":new It(Ce.paint_symbol["text-halo-blur"]),"text-translate":new bt(Ce.paint_symbol["text-translate"]),"text-translate-anchor":new bt(Ce.paint_symbol["text-translate-anchor"])})},get layout(){return vp=vp||new Ji({"symbol-placement":new bt(Ce.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(Ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(Ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(Ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(Ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bt(Ce.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bt(Ce.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bt(Ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(Ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(Ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(Ce.layout_symbol["icon-size"]),"icon-text-fit":new bt(Ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bt(Ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(Ce.layout_symbol["icon-image"]),"icon-rotate":new It(Ce.layout_symbol["icon-rotate"]),"icon-padding":new It(Ce.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(Ce.layout_symbol["icon-keep-upright"]),"icon-offset":new It(Ce.layout_symbol["icon-offset"]),"icon-anchor":new It(Ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(Ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(Ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(Ce.layout_symbol["text-rotation-alignment"]),"text-field":new It(Ce.layout_symbol["text-field"]),"text-font":new It(Ce.layout_symbol["text-font"]),"text-size":new It(Ce.layout_symbol["text-size"]),"text-max-width":new It(Ce.layout_symbol["text-max-width"]),"text-line-height":new bt(Ce.layout_symbol["text-line-height"]),"text-letter-spacing":new It(Ce.layout_symbol["text-letter-spacing"]),"text-justify":new It(Ce.layout_symbol["text-justify"]),"text-radial-offset":new It(Ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(Ce.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new It(Ce.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new It(Ce.layout_symbol["text-anchor"]),"text-max-angle":new bt(Ce.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(Ce.layout_symbol["text-writing-mode"]),"text-rotate":new It(Ce.layout_symbol["text-rotate"]),"text-padding":new bt(Ce.layout_symbol["text-padding"]),"text-keep-upright":new bt(Ce.layout_symbol["text-keep-upright"]),"text-transform":new It(Ce.layout_symbol["text-transform"]),"text-offset":new It(Ce.layout_symbol["text-offset"]),"text-allow-overlap":new bt(Ce.layout_symbol["text-allow-overlap"]),"text-overlap":new bt(Ce.layout_symbol["text-overlap"]),"text-ignore-placement":new bt(Ce.layout_symbol["text-ignore-placement"]),"text-optional":new bt(Ce.layout_symbol["text-optional"])})}};class xp{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Jn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut("FormatSectionOverride",xp,{omit:["defaultValue"]});class pu extends Sn{constructor(e){super(e,zh)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const d=[];for(const _ of a)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,d){const _=this.layout.get(e).evaluate(r,{},a,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||ra(y.value)||!_?_:function(b,S){return S.replace(/{([^{}]+)}/g,(M,E)=>b&&E in b?String(b[E]):"")}(r.properties,_)}createBucket(e){return new Sa(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of zh.paint.overridableProperties){if(!pu.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new xp(r),d=new tl(a,r.property.specification);let _=null;_=r.value.kind==="constant"||r.value.kind==="source"?new il("source",d):new oa("composite",d,r.value.zoomStops),this.paint._values[e]=new Br(r.property,_,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&pu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),d=zh.paint.properties[r];let _=!1;const y=b=>{for(const S of b)if(d.overrides&&d.overrides.hasOverride(S))return void(_=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Mr)y(a.value.value.sections);else if(a.value.kind==="source"){const b=M=>{_||(M instanceof So&&zi(M.value)===H?y(M.value.sections):M instanceof ia?y(M.sections):M.eachChild(b))},S=a.value;S._styleExpression&&b(S._styleExpression.expression)}return _}}let wp;var lg={get paint(){return wp=wp||new Ji({"background-color":new bt(Ce.paint_background["background-color"]),"background-pattern":new gl(Ce.paint_background["background-pattern"]),"background-opacity":new bt(Ce.paint_background["background-opacity"])})}};class cg extends Sn{constructor(e){super(e,lg)}}let Sp;var ug={get paint(){return Sp=Sp||new Ji({"raster-opacity":new bt(Ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new bt(Ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(Ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(Ce.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(Ce.paint_raster["raster-saturation"]),"raster-contrast":new bt(Ce.paint_raster["raster-contrast"]),"raster-resampling":new bt(Ce.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(Ce.paint_raster["raster-fade-duration"])})}};class hg extends Sn{constructor(e){super(e,ug)}}class dg extends Sn{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class pg{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Lh=63710088e-1;class as{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new as(Ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,d=e.lat*r,_=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return Lh*Math.acos(Math.min(_,1))}static convert(e){if(e instanceof as)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new as(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new as(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Tp=2*Math.PI*Lh;function kp(i){return Tp*Math.cos(i*Math.PI/180)}function Ip(i){return(180+i)/360}function Mp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Cp(i,e){return i/kp(e)}function Ap(i){return 360*i-180}function Dh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class fu{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=as.convert(e);return new fu(Ip(a.lng),Mp(a.lat),Cp(r,a.lat))}toLngLat(){return new as(Ap(this.x),Dh(this.y))}toAltitude(){return this.z*kp(Dh(this.y))}meterInMercatorCoordinateUnits(){return 1/Tp*(e=Dh(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ep(i,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Bh{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Nl(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const d=(y=this.y,b=this.z,S=Ep(256*(_=this.x),256*(y=Math.pow(2,b)-y-1),b),M=Ep(256*(_+1),256*(y+1),b),S[0]+","+S[1]+","+M[0]+","+M[1]);var _,y,b,S,M;const E=function(L,F,N){let V,Z="";for(let J=L;J>0;J--)V=1<<J-1,Z+=(F&V?1:0)+(N&V?2:0);return Z}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new ie((e.x*r-this.x)*rr,(e.y*r-this.y)*rr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pp{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Nl(e,r.z,r.z,r.x,r.y)}}class En{constructor(e,r,a,d,_){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Bh(a,+d,+_),this.key=Nl(r,e,a,d,_)}clone(){return new En(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new En(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new En(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Nl(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Nl(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new En(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new En(r,this.wrap,r,a,d),new En(r,this.wrap,r,a+1,d),new En(r,this.wrap,r,a,d+1),new En(r,this.wrap,r,a+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new En(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new En(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new fu(e.x-this.wrap,e.y))}}function Nl(i,e,r,a,d){(i*=2)<0&&(i=-1*i-1);const _=1<<r;return(_*_*i+_*d+a).toString(36)+r.toString(36)+e.toString(36)}ut("CanonicalTileID",Bh),ut("OverscaledTileID",En,{omit:["posMatrix"]});class zp{constructor(e,r,a,d=1,_=1,y=1,b=0){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void Ne(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const S=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=d,this.greenFactor=_,this.blueFactor=y,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<S;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(S,M)]=this.data[this._idx(S-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,S)]=this.data[this._idx(M,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<S;M++)for(let E=0;E<S;E++){const L=this.get(M,E);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(e,r){const a=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return this.unpack(a[d],a[d+1],a[d+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}unpack(e,r,a){return e*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new An({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=r*this.dim,_=r*this.dim+this.dim,y=a*this.dim,b=a*this.dim+this.dim;switch(r){case-1:d=_-1;break;case 1:_=d+1}switch(a){case-1:y=b-1;break;case 1:b=y+1}const S=-r*this.dim,M=-a*this.dim;for(let E=y;E<b;E++)for(let L=d;L<_;L++)this.data[this._idx(L,E)]=e.data[this._idx(L+S,E+M)]}}ut("DEMData",zp);class Lp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Dp{constructor(e,r,a,d,_){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=d,this.properties=e.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Bp{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Qo(rr,16,0),this.grid3D=new Qo(rr,16,0),this.featureIndexArray=new Ve,this.promoteId=r}insert(e,r,a,d,_,y){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,_);const S=y?this.grid3D:this.grid;for(let M=0;M<r.length;M++){const E=r[M],L=[1/0,1/0,-1/0,-1/0];for(let F=0;F<E.length;F++){const N=E[F];L[0]=Math.min(L[0],N.x),L[1]=Math.min(L[1],N.y),L[2]=Math.max(L[2],N.x),L[3]=Math.max(L[3],N.y)}L[0]<rr&&L[1]<rr&&L[2]>=0&&L[3]>=0&&S.insert(b,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ns.VectorTile(new Sh(this.rawTileData)).layers,this.sourceLayerCoder=new Lp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,d){this.loadVTLayers();const _=e.params||{},y=rr/e.tileSize/e.scale,b=nl(_.filter),S=e.queryGeometry,M=e.queryPadding*y,E=Rp(S),L=this.grid.query(E.minX-M,E.minY-M,E.maxX+M,E.maxY+M),F=Rp(e.cameraQueryGeometry),N=this.grid3D.query(F.minX-M,F.minY-M,F.maxX+M,F.maxY+M,(J,ee,he,ne)=>function(fe,ve,De,ot,mt){for(const it of fe)if(ve<=it.x&&De<=it.y&&ot>=it.x&&mt>=it.y)return!0;const rt=[new ie(ve,De),new ie(ve,mt),new ie(ot,mt),new ie(ot,De)];if(fe.length>2){for(const it of rt)if(_a(fe,it))return!0}for(let it=0;it<fe.length-1;it++)if(Gm(fe[it],fe[it+1],rt))return!0;return!1}(e.cameraQueryGeometry,J-M,ee-M,he+M,ne+M));for(const J of N)L.push(J);L.sort(fg);const V={};let Z;for(let J=0;J<L.length;J++){const ee=L[J];if(ee===Z)continue;Z=ee;const he=this.featureIndexArray.get(ee);let ne=null;this.loadMatchingFeature(V,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,b,_.layers,_.availableImages,r,a,d,(fe,ve,De)=>(ne||(ne=As(fe)),ve.queryIntersectsFeature(S,fe,De,ne,this.z,e.transform,y,e.pixelPosMatrix)))}return V}loadMatchingFeature(e,r,a,d,_,y,b,S,M,E,L){const F=this.bucketLayerIDs[r];if(y&&!function(J,ee){for(let he=0;he<J.length;he++)if(ee.indexOf(J[he])>=0)return!0;return!1}(y,F))return;const N=this.sourceLayerCoder.decode(a),V=this.vtLayers[N].feature(d);if(_.needGeometry){const J=Es(V,!0);if(!_.filter(new Mi(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!_.filter(new Mi(this.tileID.overscaledZ),V))return;const Z=this.getId(V,N);for(let J=0;J<F.length;J++){const ee=F[J];if(y&&y.indexOf(ee)<0)continue;const he=S[ee];if(!he)continue;let ne={};Z&&E&&(ne=E.getState(he.sourceLayer||"_geojsonTileLayer",Z));const fe=Oe({},M[ee]);fe.paint=Fp(fe.paint,he.paint,V,ne,b),fe.layout=Fp(fe.layout,he.layout,V,ne,b);const ve=!L||L(V,he,ne);if(!ve)continue;const De=new Dp(V,this.z,this.x,this.y,Z);De.layer=fe;let ot=e[ee];ot===void 0&&(ot=e[ee]=[]),ot.push({featureIndex:d,feature:De,intersectionZ:ve})}}lookupSymbolFeatures(e,r,a,d,_,y,b,S){const M={};this.loadVTLayers();const E=nl(_);for(const L of e)this.loadMatchingFeature(M,a,d,L,E,y,b,S,r);return M}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Fp(i,e,r,a,d){return He(i,(_,y)=>{const b=e instanceof fa?e.get(y):null;return b&&b.evaluate?b.evaluate(r,a,d):b})}function Rp(i){let e=1/0,r=1/0,a=-1/0,d=-1/0;for(const _ of i)e=Math.min(e,_.x),r=Math.min(r,_.y),a=Math.max(a,_.x),d=Math.max(d,_.y);return{minX:e,minY:r,maxX:a,maxY:d}}function fg(i,e){return e-i}function Op(i,e,r,a,d){const _=[];for(let y=0;y<i.length;y++){const b=i[y];let S;for(let M=0;M<b.length-1;M++){let E=b[M],L=b[M+1];E.x<e&&L.x<e||(E.x<e?E=new ie(e,E.y+(e-E.x)/(L.x-E.x)*(L.y-E.y))._round():L.x<e&&(L=new ie(e,E.y+(e-E.x)/(L.x-E.x)*(L.y-E.y))._round()),E.y<r&&L.y<r||(E.y<r?E=new ie(E.x+(r-E.y)/(L.y-E.y)*(L.x-E.x),r)._round():L.y<r&&(L=new ie(E.x+(r-E.y)/(L.y-E.y)*(L.x-E.x),r)._round()),E.x>=a&&L.x>=a||(E.x>=a?E=new ie(a,E.y+(a-E.x)/(L.x-E.x)*(L.y-E.y))._round():L.x>=a&&(L=new ie(a,E.y+(a-E.x)/(L.x-E.x)*(L.y-E.y))._round()),E.y>=d&&L.y>=d||(E.y>=d?E=new ie(E.x+(d-E.y)/(L.y-E.y)*(L.x-E.x),d)._round():L.y>=d&&(L=new ie(E.x+(d-E.y)/(L.y-E.y)*(L.x-E.x),d)._round()),S&&E.equals(S[S.length-1])||(S=[E],_.push(S)),S.push(L)))))}}return _}ut("FeatureIndex",Bp,{omit:["rawTileData","sourceLayerCoder"]});class ls extends ie{constructor(e,r,a,d){super(e,r),this.angle=a,d!==void 0&&(this.segment=d)}clone(){return new ls(this.x,this.y,this.angle,this.segment)}}function Np(i,e,r,a,d){if(e.segment===void 0||r===0)return!0;let _=e,y=e.segment+1,b=0;for(;b>-r/2;){if(y--,y<0)return!1;b-=i[y].dist(_),_=i[y]}b+=i[y].dist(i[y+1]),y++;const S=[];let M=0;for(;b<r/2;){const E=i[y],L=i[y+1];if(!L)return!1;let F=i[y-1].angleTo(E)-E.angleTo(L);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:F}),M+=F;b-S[0].distance>a;)M-=S.shift().angleDelta;if(M>d)return!1;y++,b+=E.dist(L)}return!0}function Vp(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Up(i,e,r){return i?.6*e*r:0}function jp(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function mg(i,e,r,a,d,_){const y=Up(r,d,_),b=jp(r,a)*_;let S=0;const M=Vp(i)/2;for(let E=0;E<i.length-1;E++){const L=i[E],F=i[E+1],N=L.dist(F);if(S+N>M){const V=(M-S)/N,Z=sn.number(L.x,F.x,V),J=sn.number(L.y,F.y,V),ee=new ls(Z,J,F.angleTo(L),E);return ee._round(),!y||Np(i,ee,b,y,e)?ee:void 0}S+=N}}function _g(i,e,r,a,d,_,y,b,S){const M=Up(a,_,y),E=jp(a,d),L=E*y,F=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-L<e/4&&(e=L+e/4),qp(i,F?e/2*b%e:(E/2+2*_)*y*b%e,e,M,r,L,F,!1,S)}function qp(i,e,r,a,d,_,y,b,S){const M=_/2,E=Vp(i);let L=0,F=e-r,N=[];for(let V=0;V<i.length-1;V++){const Z=i[V],J=i[V+1],ee=Z.dist(J),he=J.angleTo(Z);for(;F+r<L+ee;){F+=r;const ne=(F-L)/ee,fe=sn.number(Z.x,J.x,ne),ve=sn.number(Z.y,J.y,ne);if(fe>=0&&fe<S&&ve>=0&&ve<S&&F-M>=0&&F+M<=E){const De=new ls(fe,ve,he,V);De._round(),a&&!Np(i,De,_,a,d)||N.push(De)}}L+=ee}return b||N.length||y||(N=qp(i,L/2,r,a,d,_,y,!0,S)),N}ut("Anchor",ls);const Ta=hn;function Zp(i,e,r,a){const d=[],_=i.image,y=_.pixelRatio,b=_.paddedRect.w-2*Ta,S=_.paddedRect.h-2*Ta,M=i.right-i.left,E=i.bottom-i.top,L=_.stretchX||[[0,b]],F=_.stretchY||[[0,S]],N=(Ke,ht)=>Ke+ht[1]-ht[0],V=L.reduce(N,0),Z=F.reduce(N,0),J=b-V,ee=S-Z;let he=0,ne=V,fe=0,ve=Z,De=0,ot=J,mt=0,rt=ee;if(_.content&&a){const Ke=_.content;he=mu(L,0,Ke[0]),fe=mu(F,0,Ke[1]),ne=mu(L,Ke[0],Ke[2]),ve=mu(F,Ke[1],Ke[3]),De=Ke[0]-he,mt=Ke[1]-fe,ot=Ke[2]-Ke[0]-ne,rt=Ke[3]-Ke[1]-ve}const it=(Ke,ht,$e,Ze)=>{const St=_u(Ke.stretch-he,ne,M,i.left),yt=gu(Ke.fixed-De,ot,Ke.stretch,V),Gt=_u(ht.stretch-fe,ve,E,i.top),Ai=gu(ht.fixed-mt,rt,ht.stretch,Z),Pi=_u($e.stretch-he,ne,M,i.left),ur=gu($e.fixed-De,ot,$e.stretch,V),kn=_u(Ze.stretch-fe,ve,E,i.top),Xr=gu(Ze.fixed-mt,rt,Ze.stretch,Z),nr=new ie(St,Gt),Tr=new ie(Pi,Gt),Er=new ie(Pi,kn),Wr=new ie(St,kn),Hr=new ie(yt/y,Ai/y),hr=new ie(ur/y,Xr/y),dr=e*Math.PI/180;if(dr){const Or=Math.sin(dr),dn=Math.cos(dr),pn=[dn,-Or,Or,dn];nr._matMult(pn),Tr._matMult(pn),Wr._matMult(pn),Er._matMult(pn)}const Rr=Ke.stretch+Ke.fixed,Kr=ht.stretch+ht.fixed;return{tl:nr,tr:Tr,bl:Wr,br:Er,tex:{x:_.paddedRect.x+Ta+Rr,y:_.paddedRect.y+Ta+Kr,w:$e.stretch+$e.fixed-Rr,h:Ze.stretch+Ze.fixed-Kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hr,pixelOffsetBR:hr,minFontScaleX:ot/y/M,minFontScaleY:rt/y/E,isSDF:r}};if(a&&(_.stretchX||_.stretchY)){const Ke=Gp(L,J,V),ht=Gp(F,ee,Z);for(let $e=0;$e<Ke.length-1;$e++){const Ze=Ke[$e],St=Ke[$e+1];for(let yt=0;yt<ht.length-1;yt++)d.push(it(Ze,ht[yt],St,ht[yt+1]))}}else d.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return d}function mu(i,e,r){let a=0;for(const d of i)a+=Math.max(e,Math.min(r,d[1]))-Math.max(e,Math.min(r,d[0]));return a}function Gp(i,e,r){const a=[{fixed:-Ta,stretch:0}];for(const[d,_]of i){const y=a[a.length-1];a.push({fixed:d-y.stretch,stretch:y.stretch}),a.push({fixed:d-y.stretch,stretch:y.stretch+(_-d)})}return a.push({fixed:e+Ta,stretch:r}),a}function _u(i,e,r,a){return i/e*r+a}function gu(i,e,r,a){return i-e*r/a}class yu{constructor(e,r,a,d,_,y,b,S,M,E){if(this.boxStartIndex=e.length,M){let L=y.top,F=y.bottom;const N=y.collisionPadding;N&&(L-=N[1],F+=N[3]);let V=F-L;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{let L=y.top*b-S[0],F=y.bottom*b+S[2],N=y.left*b-S[3],V=y.right*b+S[1];const Z=y.collisionPadding;if(Z&&(N-=Z[0]*b,L-=Z[1]*b,V+=Z[2]*b,F+=Z[3]*b),E){const J=new ie(N,L),ee=new ie(V,L),he=new ie(N,F),ne=new ie(V,F),fe=E*Math.PI/180;J._rotate(fe),ee._rotate(fe),he._rotate(fe),ne._rotate(fe),N=Math.min(J.x,ee.x,he.x,ne.x),V=Math.max(J.x,ee.x,he.x,ne.x),L=Math.min(J.y,ee.y,he.y,ne.y),F=Math.max(J.y,ee.y,he.y,ne.y)}e.emplaceBack(r.x,r.y,N,L,V,F,a,d,_)}this.boxEndIndex=e.length}}class gg{constructor(e=[],r=yg){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,d=r[e];for(;e>0;){const _=e-1>>1,y=r[_];if(a(d,y)>=0)break;r[e]=y,e=_}r[e]=d}_down(e){const{data:r,compare:a}=this,d=this.length>>1,_=r[e];for(;e<d;){let y=1+(e<<1),b=r[y];const S=y+1;if(S<this.length&&a(r[S],b)<0&&(y=S,b=r[S]),a(b,_)>=0)break;r[e]=b,e=y}r[e]=_}}function yg(i,e){return i<e?-1:i>e?1:0}function vg(i,e=1,r=!1){let a=1/0,d=1/0,_=-1/0,y=-1/0;const b=i[0];for(let N=0;N<b.length;N++){const V=b[N];(!N||V.x<a)&&(a=V.x),(!N||V.y<d)&&(d=V.y),(!N||V.x>_)&&(_=V.x),(!N||V.y>y)&&(y=V.y)}const S=Math.min(_-a,y-d);let M=S/2;const E=new gg([],bg);if(S===0)return new ie(a,d);for(let N=a;N<_;N+=S)for(let V=d;V<y;V+=S)E.push(new ka(N+M,V+M,M,i));let L=function(N){let V=0,Z=0,J=0;const ee=N[0];for(let he=0,ne=ee.length,fe=ne-1;he<ne;fe=he++){const ve=ee[he],De=ee[fe],ot=ve.x*De.y-De.x*ve.y;Z+=(ve.x+De.x)*ot,J+=(ve.y+De.y)*ot,V+=3*ot}return new ka(Z/V,J/V,0,N)}(i),F=E.length;for(;E.length;){const N=E.pop();(N.d>L.d||!L.d)&&(L=N,r&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,F)),N.max-L.d<=e||(M=N.h/2,E.push(new ka(N.p.x-M,N.p.y-M,M,i)),E.push(new ka(N.p.x+M,N.p.y-M,M,i)),E.push(new ka(N.p.x-M,N.p.y+M,M,i)),E.push(new ka(N.p.x+M,N.p.y+M,M,i)),F+=4)}return r&&(console.log(`num probes: ${F}`),console.log(`best distance: ${L.d}`)),L.p}function bg(i,e){return e.max-i.max}function ka(i,e,r,a){this.p=new ie(i,e),this.h=r,this.d=function(d,_){let y=!1,b=1/0;for(let S=0;S<_.length;S++){const M=_[S];for(let E=0,L=M.length,F=L-1;E<L;F=E++){const N=M[E],V=M[F];N.y>d.y!=V.y>d.y&&d.x<(V.x-N.x)*(d.y-N.y)/(V.y-N.y)+N.x&&(y=!y),b=Math.min(b,Md(d,N,V))}}return(y?1:-1)*Math.sqrt(b)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var Ar;s.aq=void 0,(Ar=s.aq||(s.aq={}))[Ar.center=1]="center",Ar[Ar.left=2]="left",Ar[Ar.right=3]="right",Ar[Ar.top=4]="top",Ar[Ar.bottom=5]="bottom",Ar[Ar["top-left"]=6]="top-left",Ar[Ar["top-right"]=7]="top-right",Ar[Ar["bottom-left"]=8]="bottom-left",Ar[Ar["bottom-right"]=9]="bottom-right";const cs=7,Fh=Number.POSITIVE_INFINITY;function Xp(i,e){return e[1]!==Fh?function(r,a,d){let _=0,y=0;switch(a=Math.abs(a),d=Math.abs(d),r){case"top-right":case"top-left":case"top":y=d-cs;break;case"bottom-right":case"bottom-left":case"bottom":y=-d+cs}switch(r){case"top-right":case"bottom-right":case"right":_=-a;break;case"top-left":case"bottom-left":case"left":_=a}return[_,y]}(i,e[0],e[1]):function(r,a){let d=0,_=0;a<0&&(a=0);const y=a/Math.SQRT2;switch(r){case"top-right":case"top-left":_=y-cs;break;case"bottom-right":case"bottom-left":_=-y+cs;break;case"bottom":_=-a+cs;break;case"top":_=a-cs}switch(r){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=a;break;case"right":d=-a}return[d,_]}(i,e[0])}function Wp(i,e,r){var a;const d=i.layout,_=(a=d.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(e,{},r);if(_){const b=_.values,S=[];for(let M=0;M<b.length;M+=2){const E=S[M]=b[M],L=b[M+1].map(F=>F*cr);E.startsWith("top")?L[1]-=cs:E.startsWith("bottom")&&(L[1]+=cs),S[M+1]=L}return new vn(S)}const y=d.get("text-variable-anchor");if(y){let b;b=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[d.get("text-radial-offset").evaluate(e,{},r)*cr,Fh]:d.get("text-offset").evaluate(e,{},r).map(M=>M*cr);const S=[];for(const M of y)S.push(M,Xp(M,b));return new vn(S)}return null}function Rh(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xg(i,e,r,a,d,_,y,b,S,M,E){let L=_.textMaxSize.evaluate(e,{});L===void 0&&(L=y);const F=i.layers[0].layout,N=F.get("icon-offset").evaluate(e,{},E),V=Kp(r.horizontal),Z=y/24,J=i.tilePixelRatio*Z,ee=i.tilePixelRatio*L/24,he=i.tilePixelRatio*b,ne=i.tilePixelRatio*F.get("symbol-spacing"),fe=F.get("text-padding")*i.tilePixelRatio,ve=function(Ze,St,yt,Gt=1){const Ai=Ze.get("icon-padding").evaluate(St,{},yt),Pi=Ai&&Ai.values;return[Pi[0]*Gt,Pi[1]*Gt,Pi[2]*Gt,Pi[3]*Gt]}(F,e,E,i.tilePixelRatio),De=F.get("text-max-angle")/180*Math.PI,ot=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",mt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",rt=F.get("symbol-placement"),it=ne/2,Ke=F.get("icon-text-fit");let ht;a&&Ke!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(ht=gp(a,r.vertical,Ke,F.get("icon-text-fit-padding"),N,Z)),V&&(a=gp(a,V,Ke,F.get("icon-text-fit-padding"),N,Z)));const $e=(Ze,St)=>{St.x<0||St.x>=rr||St.y<0||St.y>=rr||function(yt,Gt,Ai,Pi,ur,kn,Xr,nr,Tr,Er,Wr,Hr,hr,dr,Rr,Kr,Or,dn,pn,pr,$t,Nr,Pr,fr,Zn){const oo=yt.addToLineVertexArray(Gt,Ai);let so,Fo,Gn,Pn,fn=0,Ro=0,jl=0,Qp=0,Gh=-1,Xh=-1;const Oo={};let ef=zo("");if(yt.allowVerticalPlacement&&Pi.vertical){const Vr=nr.layout.get("text-rotate").evaluate($t,{},fr)+90;Gn=new yu(Tr,Gt,Er,Wr,Hr,Pi.vertical,hr,dr,Rr,Vr),Xr&&(Pn=new yu(Tr,Gt,Er,Wr,Hr,Xr,Or,dn,Rr,Vr))}if(ur){const Vr=nr.layout.get("icon-rotate").evaluate($t,{}),zn=nr.layout.get("icon-text-fit")!=="none",zs=Zp(ur,Vr,Pr,zn),lo=Xr?Zp(Xr,Vr,Pr,zn):void 0;Fo=new yu(Tr,Gt,Er,Wr,Hr,ur,Or,dn,!1,Vr),fn=4*zs.length;const Ls=yt.iconSizeData;let yo=null;Ls.kind==="source"?(yo=[go*nr.layout.get("icon-size").evaluate($t,{})],yo[0]>ss&&Ne(`${yt.layerIds[0]}: Value for "icon-size" is >= ${Ol}. Reduce your "icon-size".`)):Ls.kind==="composite"&&(yo=[go*Nr.compositeIconSizes[0].evaluate($t,{},fr),go*Nr.compositeIconSizes[1].evaluate($t,{},fr)],(yo[0]>ss||yo[1]>ss)&&Ne(`${yt.layerIds[0]}: Value for "icon-size" is >= ${Ol}. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,zs,yo,pr,pn,$t,s.ai.none,Gt,oo.lineStartIndex,oo.lineLength,-1,fr),Gh=yt.icon.placedSymbolArray.length-1,lo&&(Ro=4*lo.length,yt.addSymbols(yt.icon,lo,yo,pr,pn,$t,s.ai.vertical,Gt,oo.lineStartIndex,oo.lineLength,-1,fr),Xh=yt.icon.placedSymbolArray.length-1)}const tf=Object.keys(Pi.horizontal);for(const Vr of tf){const zn=Pi.horizontal[Vr];if(!so){ef=zo(zn.text);const lo=nr.layout.get("text-rotate").evaluate($t,{},fr);so=new yu(Tr,Gt,Er,Wr,Hr,zn,hr,dr,Rr,lo)}const zs=zn.positionedLines.length===1;if(jl+=Hp(yt,Gt,zn,kn,nr,Rr,$t,Kr,oo,Pi.vertical?s.ai.horizontal:s.ai.horizontalOnly,zs?tf:[Vr],Oo,Gh,Nr,fr),zs)break}Pi.vertical&&(Qp+=Hp(yt,Gt,Pi.vertical,kn,nr,Rr,$t,Kr,oo,s.ai.vertical,["vertical"],Oo,Xh,Nr,fr));const Tg=so?so.boxStartIndex:yt.collisionBoxArray.length,kg=so?so.boxEndIndex:yt.collisionBoxArray.length,Ig=Gn?Gn.boxStartIndex:yt.collisionBoxArray.length,Mg=Gn?Gn.boxEndIndex:yt.collisionBoxArray.length,Cg=Fo?Fo.boxStartIndex:yt.collisionBoxArray.length,Ag=Fo?Fo.boxEndIndex:yt.collisionBoxArray.length,Eg=Pn?Pn.boxStartIndex:yt.collisionBoxArray.length,Pg=Pn?Pn.boxEndIndex:yt.collisionBoxArray.length;let ao=-1;const bu=(Vr,zn)=>Vr&&Vr.circleDiameter?Math.max(Vr.circleDiameter,zn):zn;ao=bu(so,ao),ao=bu(Gn,ao),ao=bu(Fo,ao),ao=bu(Pn,ao);const rf=ao>-1?1:0;rf&&(ao*=Zn/cr),yt.glyphOffsetArray.length>=Sa.MAX_GLYPHS&&Ne("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),$t.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,$t.sortKey);const zg=Wp(nr,$t,fr),[Lg,Dg]=function(Vr,zn){const zs=Vr.length,lo=zn==null?void 0:zn.values;if((lo==null?void 0:lo.length)>0)for(let Ls=0;Ls<lo.length;Ls+=2){const yo=lo[Ls+1];Vr.emplaceBack(s.aq[lo[Ls]],yo[0],yo[1])}return[zs,Vr.length]}(yt.textAnchorOffsets,zg);yt.symbolInstances.emplaceBack(Gt.x,Gt.y,Oo.right>=0?Oo.right:-1,Oo.center>=0?Oo.center:-1,Oo.left>=0?Oo.left:-1,Oo.vertical||-1,Gh,Xh,ef,Tg,kg,Ig,Mg,Cg,Ag,Eg,Pg,Er,jl,Qp,fn,Ro,rf,0,hr,ao,Lg,Dg)}(i,St,Ze,r,a,d,ht,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,J,[fe,fe,fe,fe],ot,S,he,ve,mt,N,e,_,M,E,y)};if(rt==="line")for(const Ze of Op(e.geometry,0,0,rr,rr)){const St=_g(Ze,ne,De,r.vertical||V,a,24,ee,i.overscaling,rr);for(const yt of St)V&&wg(i,V.text,it,yt)||$e(Ze,yt)}else if(rt==="line-center"){for(const Ze of e.geometry)if(Ze.length>1){const St=mg(Ze,De,r.vertical||V,a,24,ee);St&&$e(Ze,St)}}else if(e.type==="Polygon")for(const Ze of mh(e.geometry,0)){const St=vg(Ze,16);$e(Ze[0],new ls(St.x,St.y,0))}else if(e.type==="LineString")for(const Ze of e.geometry)$e(Ze,new ls(Ze[0].x,Ze[0].y,0));else if(e.type==="Point")for(const Ze of e.geometry)for(const St of Ze)$e([St],new ls(St.x,St.y,0))}function Hp(i,e,r,a,d,_,y,b,S,M,E,L,F,N,V){const Z=function(he,ne,fe,ve,De,ot,mt,rt){const it=ve.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,Ke=[];for(const ht of ne.positionedLines)for(const $e of ht.positionedGlyphs){if(!$e.rect)continue;const Ze=$e.rect||{};let St=up+1,yt=!0,Gt=1,Ai=0;const Pi=(De||rt)&&$e.vertical,ur=$e.metrics.advance*$e.scale/2;if(rt&&ne.verticalizable&&(Ai=ht.lineOffset/2-($e.imageName?-(cr-$e.metrics.width*$e.scale)/2:($e.scale-1)*cr)),$e.imageName){const pr=mt[$e.imageName];yt=pr.sdf,Gt=pr.pixelRatio,St=hn/Gt}const kn=De?[$e.x+ur,$e.y]:[0,0];let Xr=De?[0,0]:[$e.x+ur+fe[0],$e.y+fe[1]-Ai],nr=[0,0];Pi&&(nr=Xr,Xr=[0,0]);const Tr=$e.metrics.isDoubleResolution?2:1,Er=($e.metrics.left-St)*$e.scale-ur+Xr[0],Wr=(-$e.metrics.top-St)*$e.scale+Xr[1],Hr=Er+Ze.w/Tr*$e.scale/Gt,hr=Wr+Ze.h/Tr*$e.scale/Gt,dr=new ie(Er,Wr),Rr=new ie(Hr,Wr),Kr=new ie(Er,hr),Or=new ie(Hr,hr);if(Pi){const pr=new ie(-ur,ur-Fl),$t=-Math.PI/2,Nr=cr/2-ur,Pr=new ie(5-Fl-Nr,-($e.imageName?Nr:0)),fr=new ie(...nr);dr._rotateAround($t,pr)._add(Pr)._add(fr),Rr._rotateAround($t,pr)._add(Pr)._add(fr),Kr._rotateAround($t,pr)._add(Pr)._add(fr),Or._rotateAround($t,pr)._add(Pr)._add(fr)}if(it){const pr=Math.sin(it),$t=Math.cos(it),Nr=[$t,-pr,pr,$t];dr._matMult(Nr),Rr._matMult(Nr),Kr._matMult(Nr),Or._matMult(Nr)}const dn=new ie(0,0),pn=new ie(0,0);Ke.push({tl:dr,tr:Rr,bl:Kr,br:Or,tex:Ze,writingMode:ne.writingMode,glyphOffset:kn,sectionIndex:$e.sectionIndex,isSDF:yt,pixelOffsetTL:dn,pixelOffsetBR:pn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,r,b,d,_,y,a,i.allowVerticalPlacement),J=i.textSizeData;let ee=null;J.kind==="source"?(ee=[go*d.layout.get("text-size").evaluate(y,{})],ee[0]>ss&&Ne(`${i.layerIds[0]}: Value for "text-size" is >= ${Ol}. Reduce your "text-size".`)):J.kind==="composite"&&(ee=[go*N.compositeTextSizes[0].evaluate(y,{},V),go*N.compositeTextSizes[1].evaluate(y,{},V)],(ee[0]>ss||ee[1]>ss)&&Ne(`${i.layerIds[0]}: Value for "text-size" is >= ${Ol}. Reduce your "text-size".`)),i.addSymbols(i.text,Z,ee,b,_,y,M,e,S.lineStartIndex,S.lineLength,F,V);for(const he of E)L[he]=i.text.placedSymbolArray.length-1;return 4*Z.length}function Kp(i){for(const e in i)return i[e];return null}function wg(i,e,r,a){const d=i.compareText;if(e in d){const _=d[e];for(let y=_.length-1;y>=0;y--)if(a.dist(_[y])<r)return!0}else d[e]=[];return d[e].push(a),!1}const Yp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Oh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=a>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=Yp[15&a];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new Oh(b,y,_,e)}constructor(e,r=64,a=Float64Array,d){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const _=Yp.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${a}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Nh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:b}=this,S=[0,_.length-1,0],M=[];for(;S.length;){const E=S.pop()||0,L=S.pop()||0,F=S.pop()||0;if(L-F<=b){for(let J=F;J<=L;J++){const ee=y[2*J],he=y[2*J+1];ee>=e&&ee<=a&&he>=r&&he<=d&&M.push(_[J])}continue}const N=F+L>>1,V=y[2*N],Z=y[2*N+1];V>=e&&V<=a&&Z>=r&&Z<=d&&M.push(_[N]),(E===0?e<=V:r<=Z)&&(S.push(F),S.push(N-1),S.push(1-E)),(E===0?a>=V:d>=Z)&&(S.push(N+1),S.push(L),S.push(1-E))}return M}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:y}=this,b=[0,d.length-1,0],S=[],M=a*a;for(;b.length;){const E=b.pop()||0,L=b.pop()||0,F=b.pop()||0;if(L-F<=y){for(let J=F;J<=L;J++)$p(_[2*J],_[2*J+1],e,r)<=M&&S.push(d[J]);continue}const N=F+L>>1,V=_[2*N],Z=_[2*N+1];$p(V,Z,e,r)<=M&&S.push(d[N]),(E===0?e-a<=V:r-a<=Z)&&(b.push(F),b.push(N-1),b.push(1-E)),(E===0?e+a>=V:r+a>=Z)&&(b.push(N+1),b.push(L),b.push(1-E))}return S}}function Nh(i,e,r,a,d,_){if(d-a<=r)return;const y=a+d>>1;Jp(i,e,y,a,d,_),Nh(i,e,r,a,y-1,1-_),Nh(i,e,r,y+1,d,1-_)}function Jp(i,e,r,a,d,_){for(;d>a;){if(d-a>600){const M=d-a+1,E=r-a+1,L=Math.log(M),F=.5*Math.exp(2*L/3),N=.5*Math.sqrt(L*F*(M-F)/M)*(E-M/2<0?-1:1);Jp(i,e,r,Math.max(a,Math.floor(r-E*F/M+N)),Math.min(d,Math.floor(r+(M-E)*F/M+N)),_)}const y=e[2*r+_];let b=a,S=d;for(Vl(i,e,a,r),e[2*d+_]>y&&Vl(i,e,a,d);b<S;){for(Vl(i,e,b,S),b++,S--;e[2*b+_]<y;)b++;for(;e[2*S+_]>y;)S--}e[2*a+_]===y?Vl(i,e,a,S):(S++,Vl(i,e,S,d)),S<=r&&(a=S+1),r<=S&&(d=S-1)}}function Vl(i,e,r,a){Vh(i,r,a),Vh(e,2*r,2*a),Vh(e,2*r+1,2*a+1)}function Vh(i,e,r){const a=i[e];i[e]=i[r],i[r]=a}function $p(i,e,r,a){const d=i-r,_=e-a;return d*d+_*_}var Uh;s.bh=void 0,(Uh=s.bh||(s.bh={})).create="create",Uh.load="load",Uh.fullLoad="fullLoad";let vu=null,Ul=[];const jh=1e3/60,qh="loadTime",Zh="fullLoadTime",Sg={mark(i){performance.mark(i)},frame(i){const e=i;vu!=null&&Ul.push(e-vu),vu=e},clearMetrics(){vu=null,Ul=[],performance.clearMeasures(qh),performance.clearMeasures(Zh);for(const i in s.bh)performance.clearMarks(s.bh[i])},getPerformanceMetrics(){performance.measure(qh,s.bh.create,s.bh.load),performance.measure(Zh,s.bh.create,s.bh.fullLoad);const i=performance.getEntriesByName(qh)[0].duration,e=performance.getEntriesByName(Zh)[0].duration,r=Ul.length,a=1/(Ul.reduce((_,y)=>_+y,0)/r/1e3),d=Ul.filter(_=>_>jh).reduce((_,y)=>_+(y-jh)/jh,0);return{loadTime:i,fullLoadTime:e,fps:a,percentDroppedFrames:d/(r+d)*100,totalFrames:r}}};s.$=function(i,e,r){var a,d,_,y,b,S,M,E,L,F,N,V,Z=r[0],J=r[1],ee=r[2];return e===i?(i[12]=e[0]*Z+e[4]*J+e[8]*ee+e[12],i[13]=e[1]*Z+e[5]*J+e[9]*ee+e[13],i[14]=e[2]*Z+e[6]*J+e[10]*ee+e[14],i[15]=e[3]*Z+e[7]*J+e[11]*ee+e[15]):(d=e[1],_=e[2],y=e[3],b=e[4],S=e[5],M=e[6],E=e[7],L=e[8],F=e[9],N=e[10],V=e[11],i[0]=a=e[0],i[1]=d,i[2]=_,i[3]=y,i[4]=b,i[5]=S,i[6]=M,i[7]=E,i[8]=L,i[9]=F,i[10]=N,i[11]=V,i[12]=a*Z+b*J+L*ee+e[12],i[13]=d*Z+S*J+F*ee+e[13],i[14]=_*Z+M*J+N*ee+e[14],i[15]=y*Z+E*J+V*ee+e[15]),i},s.A=ga,s.B=sn,s.C=class{constructor(i,e,r){this.receive=a=>{const d=a.data,_=d.id;if(_&&(!d.targetMapId||this.mapId===d.targetMapId))if(d.type==="<cancel>"){delete this.tasks[_];const y=this.cancelCallbacks[_];delete this.cancelCallbacks[_],y&&y()}else dt()||d.mustQueue?(this.tasks[_]=d,this.taskQueue.push(_),this.invoker.trigger()):this.processTask(_,d)},this.process=()=>{if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),d=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),d&&this.processTask(a,d)},this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new pg(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=dt()?i:window}send(i,e,r,a,d=!1){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[_]=r);const y=[],b={id:_,type:i,hasCallback:!!r,targetMapId:a,mustQueue:d,sourceMapId:this.mapId,data:fo(e,y)};return this.target.postMessage(b,{transfer:y}),{cancel:()=>{r&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(i,e){if(e.type==="<response>"){const r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(es(e.error)):r(null,es(e.data)))}else{let r=!1;const a=[],d=e.hasCallback?(b,S)=>{r=!0,delete this.cancelCallbacks[i];const M={id:i,type:"<response>",sourceMapId:this.mapId,error:b?fo(b):null,data:fo(S,a)};this.target.postMessage(M,{transfer:a})}:b=>{r=!0};let _=null;const y=es(e.data);if(this.parent[e.type])_=this.parent[e.type](e.sourceMapId,y,d);else if("getWorkerSource"in this.parent){const b=e.type.split(".");_=this.parent.getWorkerSource(e.sourceMapId,b[0],y.source)[b[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!r&&_&&_.cancel&&(this.cancelCallbacks[i]=_.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=bt,s.E=gr,s.F=function(i,e){const r={};for(let a=0;a<e.length;a++){const d=e[a];d in i&&(r[d]=i[d])}return r},s.G=Ip,s.H=Mp,s.I=kh,s.J=W,s.K=re,s.L=as,s.M=Jt,s.N=rr,s.O=En,s.P=ie,s.Q=Bi,s.R=An,s.S=Ci,s.T=Hc,s.U=fu,s.V=class extends Eo{},s.W=Bh,s.X=function(i,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<i.length;a++){const d=window.document.createElement("source");Ti(i[a])||(r.crossOrigin="Anonymous"),d.src=i[a],r.appendChild(d)}return{cancel:()=>{}}},s.Y=Ye,s.Z=function(){var i=new ga(16);return ga!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},s._=C,s.a=sr,s.a$=class extends O{},s.a0=function(i,e,r){var a=r[0],d=r[1],_=r[2];return i[0]=e[0]*a,i[1]=e[1]*a,i[2]=e[2]*a,i[3]=e[3]*a,i[4]=e[4]*d,i[5]=e[5]*d,i[6]=e[6]*d,i[7]=e[7]*d,i[8]=e[8]*_,i[9]=e[9]*_,i[10]=e[10]*_,i[11]=e[11]*_,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.a1=Pd,s.a2=function(){return qe++},s.a3=K,s.a4=Sa,s.a5=function(){cn.isLoading()||cn.isLoaded()||ml()!=="deferred"||Wc()},s.a6=nl,s.a7=Es,s.a8=Mi,s.a9=Dp,s.aA=Ts,s.aB=function(i){i=i.slice();const e=Object.create(null);for(let r=0;r<i.length;r++)e[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=Lr(i[r],e[i[r].ref]));return i},s.aC=function(i){if(i.type==="custom")return new dg(i);switch(i.type){case"background":return new cg(i);case"circle":return new Hm(i);case"fill":return new f_(i);case"fill-extrusion":return new A_(i);case"heatmap":return new Ym(i);case"hillshade":return new $m(i);case"line":return new R_(i);case"raster":return new hg(i);case"symbol":return new pu(i)}},s.aD=Ue,s.aE=function(i,e){if(!i)return[{command:Ot.setStyle,args:[e]}];let r=[];try{if(!ai(i.version,e.version))return[{command:Ot.setStyle,args:[e]}];ai(i.center,e.center)||r.push({command:Ot.setCenter,args:[e.center]}),ai(i.zoom,e.zoom)||r.push({command:Ot.setZoom,args:[e.zoom]}),ai(i.bearing,e.bearing)||r.push({command:Ot.setBearing,args:[e.bearing]}),ai(i.pitch,e.pitch)||r.push({command:Ot.setPitch,args:[e.pitch]}),ai(i.sprite,e.sprite)||r.push({command:Ot.setSprite,args:[e.sprite]}),ai(i.glyphs,e.glyphs)||r.push({command:Ot.setGlyphs,args:[e.glyphs]}),ai(i.transition,e.transition)||r.push({command:Ot.setTransition,args:[e.transition]}),ai(i.light,e.light)||r.push({command:Ot.setLight,args:[e.light]});const a={},d=[];(function(y,b,S,M){let E;for(E in b=b||{},y=y||{})Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(b,E)||Cn(E,S,M));for(E in b)Object.prototype.hasOwnProperty.call(b,E)&&(Object.prototype.hasOwnProperty.call(y,E)?ai(y[E],b[E])||(y[E].type==="geojson"&&b[E].type==="geojson"&&Oi(y,b,E)?S.push({command:Ot.setGeoJSONSourceData,args:[E,b[E].data]}):tr(E,b,S,M)):nn(E,b,S))})(i.sources,e.sources,d,a);const _=[];i.layers&&i.layers.forEach(y=>{a[y.source]?r.push({command:Ot.removeLayer,args:[y.id]}):_.push(y)}),r=r.concat(d),function(y,b,S){b=b||[];const M=(y=y||[]).map(Ni),E=b.map(Ni),L=y.reduce(xo,{}),F=b.reduce(xo,{}),N=M.slice(),V=Object.create(null);let Z,J,ee,he,ne,fe,ve;for(Z=0,J=0;Z<M.length;Z++)ee=M[Z],Object.prototype.hasOwnProperty.call(F,ee)?J++:(S.push({command:Ot.removeLayer,args:[ee]}),N.splice(N.indexOf(ee,J),1));for(Z=0,J=0;Z<E.length;Z++)ee=E[E.length-1-Z],N[N.length-1-Z]!==ee&&(Object.prototype.hasOwnProperty.call(L,ee)?(S.push({command:Ot.removeLayer,args:[ee]}),N.splice(N.lastIndexOf(ee,N.length-J),1)):J++,fe=N[N.length-Z],S.push({command:Ot.addLayer,args:[F[ee],fe]}),N.splice(N.length-Z,0,ee),V[ee]=!0);for(Z=0;Z<E.length;Z++)if(ee=E[Z],he=L[ee],ne=F[ee],!V[ee]&&!ai(he,ne))if(ai(he.source,ne.source)&&ai(he["source-layer"],ne["source-layer"])&&ai(he.type,ne.type)){for(ve in ii(he.layout,ne.layout,S,ee,null,Ot.setLayoutProperty),ii(he.paint,ne.paint,S,ee,null,Ot.setPaintProperty),ai(he.filter,ne.filter)||S.push({command:Ot.setFilter,args:[ee,ne.filter]}),ai(he.minzoom,ne.minzoom)&&ai(he.maxzoom,ne.maxzoom)||S.push({command:Ot.setLayerZoomRange,args:[ee,ne.minzoom,ne.maxzoom]}),he)Object.prototype.hasOwnProperty.call(he,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?ii(he[ve],ne[ve],S,ee,ve.slice(6),Ot.setPaintProperty):ai(he[ve],ne[ve])||S.push({command:Ot.setLayerProperty,args:[ee,ve,ne[ve]]}));for(ve in ne)Object.prototype.hasOwnProperty.call(ne,ve)&&!Object.prototype.hasOwnProperty.call(he,ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?ii(he[ve],ne[ve],S,ee,ve.slice(6),Ot.setPaintProperty):ai(he[ve],ne[ve])||S.push({command:Ot.setLayerProperty,args:[ee,ve,ne[ve]]}))}else S.push({command:Ot.removeLayer,args:[ee]}),fe=N[N.lastIndexOf(ee)+1],S.push({command:Ot.addLayer,args:[ne,fe]})}(_,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:Ot.setStyle,args:[e]}]}return r},s.aF=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.aG=function i(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!i(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!i(e[a],r[a]))return!1;return!0}return e===r},s.aH=He,s.aI=be,s.aJ=ks,s.aK=function(i){return i({pluginStatus:qr,pluginURL:mo}),ks.on("pluginStateChange",i),i},s.aL=class extends Lo{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.aM=ma,s.aN=class extends Lo{constructor(i,e){super(i,e),this.current=rh}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},s.aO=$c,s.aP=class extends Lo{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},s.aQ=class extends Lo{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},s.aR=Qc,s.aS=function(i,e,r,a,d,_,y){var b=1/(e-r),S=1/(a-d),M=1/(_-y);return i[0]=-2*b,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*M,i[11]=0,i[12]=(e+r)*b,i[13]=(d+a)*S,i[14]=(y+_)*M,i[15]=1,i},s.aT=gi,s.aU=Wm,s.aV=class extends u{},s.aW=U_,s.aX=class extends g{},s.aY=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},s.aZ=Fd,s.a_=We,s.aa=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,d,_)=>{const y=d||_;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},s.ab=function(i,e){const r=[];for(const a in i)a in e||r.push(a);return r},s.ac=function(i){if(Ft==null){const e=i.navigator?i.navigator.userAgent:null;Ft=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ft},s.ad=Ee,s.ae=function(i,e,r){var a=Math.sin(r),d=Math.cos(r),_=e[0],y=e[1],b=e[2],S=e[3],M=e[4],E=e[5],L=e[6],F=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=_*d+M*a,i[1]=y*d+E*a,i[2]=b*d+L*a,i[3]=S*d+F*a,i[4]=M*d-_*a,i[5]=E*d-y*a,i[6]=L*d-b*a,i[7]=F*d-S*a,i},s.af=function(i){var e=new ga(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.ag=ru,s.ah=function(i,e){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:d,minZoom:_,maxZoom:y}=i,b=d?Ee(an.interpolationFactor(d,e,_,y),0,1):0;i.kind==="camera"?a=sn.number(i.minSize,i.maxSize,b):r=b}return{uSizeT:r,uSize:a}},s.aj=function(i,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:d}){return i.kind==="source"?a/go:i.kind==="composite"?sn.number(a/go,d/go,r):e},s.ak=Ah,s.al=function(i,e,r,a){const d=e.y-i.y,_=e.x-i.x,y=a.y-r.y,b=a.x-r.x,S=y*_-b*d;if(S===0)return null;const M=(b*(i.y-r.y)-y*(i.x-r.x))/S;return new ie(i.x+M*_,i.y+M*d)},s.am=Op,s.an=kd,s.ao=lh,s.ap=cr,s.ar=Ch,s.as=function(i,e){var r=e[0],a=e[1],d=e[2],_=e[3],y=e[4],b=e[5],S=e[6],M=e[7],E=e[8],L=e[9],F=e[10],N=e[11],V=e[12],Z=e[13],J=e[14],ee=e[15],he=r*b-a*y,ne=r*S-d*y,fe=r*M-_*y,ve=a*S-d*b,De=a*M-_*b,ot=d*M-_*S,mt=E*Z-L*V,rt=E*J-F*V,it=E*ee-N*V,Ke=L*J-F*Z,ht=L*ee-N*Z,$e=F*ee-N*J,Ze=he*$e-ne*ht+fe*Ke+ve*it-De*rt+ot*mt;return Ze?(i[0]=(b*$e-S*ht+M*Ke)*(Ze=1/Ze),i[1]=(d*ht-a*$e-_*Ke)*Ze,i[2]=(Z*ot-J*De+ee*ve)*Ze,i[3]=(F*De-L*ot-N*ve)*Ze,i[4]=(S*it-y*$e-M*rt)*Ze,i[5]=(r*$e-d*it+_*rt)*Ze,i[6]=(J*fe-V*ot-ee*ne)*Ze,i[7]=(E*ot-F*fe+N*ne)*Ze,i[8]=(y*ht-b*it+M*mt)*Ze,i[9]=(a*it-r*ht-_*mt)*Ze,i[10]=(V*De-Z*fe+ee*he)*Ze,i[11]=(L*fe-E*De-N*he)*Ze,i[12]=(b*rt-y*Ke-S*mt)*Ze,i[13]=(r*Ke-a*rt+d*mt)*Ze,i[14]=(Z*ne-V*ve-J*he)*Ze,i[15]=(E*ve-L*ne+F*he)*Ze,i):null},s.at=Rh,s.au=Mh,s.av=Oh,s.aw=function(){const i={},e=Ce.$version;for(const r in Ce.$root){const a=Ce.$root[r];if(a.required){let d=null;d=r==="version"?e:a.type==="array"?[]:{},d!=null&&(i[r]=d)}}return i},s.ax=Ot,s.ay=qc,s.az=mi,s.b=function(i,e){const r=new Blob([new Uint8Array(i)],{type:"image/png"});createImageBitmap(r).then(a=>{e(null,a)}).catch(a=>{e(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=wr,s.b1=function(i,e){var r=i[0],a=i[1],d=i[2],_=i[3],y=i[4],b=i[5],S=i[6],M=i[7],E=i[8],L=i[9],F=i[10],N=i[11],V=i[12],Z=i[13],J=i[14],ee=i[15],he=e[0],ne=e[1],fe=e[2],ve=e[3],De=e[4],ot=e[5],mt=e[6],rt=e[7],it=e[8],Ke=e[9],ht=e[10],$e=e[11],Ze=e[12],St=e[13],yt=e[14],Gt=e[15];return Math.abs(r-he)<=Gr*Math.max(1,Math.abs(r),Math.abs(he))&&Math.abs(a-ne)<=Gr*Math.max(1,Math.abs(a),Math.abs(ne))&&Math.abs(d-fe)<=Gr*Math.max(1,Math.abs(d),Math.abs(fe))&&Math.abs(_-ve)<=Gr*Math.max(1,Math.abs(_),Math.abs(ve))&&Math.abs(y-De)<=Gr*Math.max(1,Math.abs(y),Math.abs(De))&&Math.abs(b-ot)<=Gr*Math.max(1,Math.abs(b),Math.abs(ot))&&Math.abs(S-mt)<=Gr*Math.max(1,Math.abs(S),Math.abs(mt))&&Math.abs(M-rt)<=Gr*Math.max(1,Math.abs(M),Math.abs(rt))&&Math.abs(E-it)<=Gr*Math.max(1,Math.abs(E),Math.abs(it))&&Math.abs(L-Ke)<=Gr*Math.max(1,Math.abs(L),Math.abs(Ke))&&Math.abs(F-ht)<=Gr*Math.max(1,Math.abs(F),Math.abs(ht))&&Math.abs(N-$e)<=Gr*Math.max(1,Math.abs(N),Math.abs($e))&&Math.abs(V-Ze)<=Gr*Math.max(1,Math.abs(V),Math.abs(Ze))&&Math.abs(Z-St)<=Gr*Math.max(1,Math.abs(Z),Math.abs(St))&&Math.abs(J-yt)<=Gr*Math.max(1,Math.abs(J),Math.abs(yt))&&Math.abs(ee-Gt)<=Gr*Math.max(1,Math.abs(ee),Math.abs(Gt))},s.b2=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},s.b3=function(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i[3]=e[3]*r[3],i},s.b4=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},s.b5=Ie,s.b6=Pp,s.b7=Cp,s.b8=function(i,e,r,a,d){var _,y=1/Math.tan(e/2);return i[0]=y/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,d!=null&&d!==1/0?(i[10]=(d+a)*(_=1/(a-d)),i[14]=2*d*a*_):(i[10]=-1,i[14]=-2*a),i},s.b9=function(i,e,r){var a=Math.sin(r),d=Math.cos(r),_=e[4],y=e[5],b=e[6],S=e[7],M=e[8],E=e[9],L=e[10],F=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=_*d+M*a,i[5]=y*d+E*a,i[6]=b*d+L*a,i[7]=S*d+F*a,i[8]=M*d-_*a,i[9]=E*d-y*a,i[10]=L*d-b*a,i[11]=F*d-S*a,i},s.bA=D,s.bB=rp,s.bC=na,s.bD=cn,s.ba=le,s.bb=xe,s.bc=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},s.bd=class extends Cs{},s.be=Lh,s.bf=Ap,s.bg=Sg,s.bi=Je,s.bj=function(i,e,r=!1){if(qr===ul||qr===hl||qr===dl)throw new Error("setRTLTextPlugin cannot be called multiple times.");mo=Ge.resolveURL(i),qr=ul,pl=e,fl(),r||Wc()},s.bk=ml,s.bl=function(i,e){const r={};for(let d=0;d<i.length;d++){const _=e&&e[i[d].id]||la(i[d]);e&&(e[i[d].id]=_);let y=r[_];y||(y=r[_]=[]),y.push(i[d])}const a=[];for(const d in r)a.push(r[d]);return a},s.bm=ut,s.bn=Lp,s.bo=Bp,s.bp=dp,s.bq=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=rr/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],r=e.layout,a=e._unevaluatedLayout._values,d={layoutIconSize:a["icon-size"].possiblyEvaluate(new Mi(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Mi(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Mi(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:E}=i.bucket.textSizeData;d.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Mi(M),i.canonical),a["text-size"].possiblyEvaluate(new Mi(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:E}=i.bucket.iconSizeData;d.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Mi(M),i.canonical),a["icon-size"].possiblyEvaluate(new Mi(E),i.canonical)]}const _=r.get("text-line-height")*cr,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",b=r.get("text-keep-upright"),S=r.get("text-size");for(const M of i.bucket.features){const E=r.get("text-font").evaluate(M,{},i.canonical).join(","),L=S.evaluate(M,{},i.canonical),F=d.layoutTextSize.evaluate(M,{},i.canonical),N=d.layoutIconSize.evaluate(M,{},i.canonical),V={horizontal:{},vertical:void 0},Z=M.text;let J,ee=[0,0];if(Z){const fe=Z.toString(),ve=r.get("text-letter-spacing").evaluate(M,{},i.canonical)*cr,De=ll(fe)?ve:0,ot=r.get("text-anchor").evaluate(M,{},i.canonical),mt=Wp(e,M,i.canonical);if(!mt){const $e=r.get("text-radial-offset").evaluate(M,{},i.canonical);ee=$e?Xp(ot,[$e*cr,Fh]):r.get("text-offset").evaluate(M,{},i.canonical).map(Ze=>Ze*cr)}let rt=y?"center":r.get("text-justify").evaluate(M,{},i.canonical);const it=r.get("symbol-placement"),Ke=it==="point"?r.get("text-max-width").evaluate(M,{},i.canonical)*cr:0,ht=()=>{i.bucket.allowVerticalPlacement&&al(fe)&&(V.vertical=uu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ke,_,ot,"left",De,ee,s.ai.vertical,!0,it,F,L))};if(!y&&mt){const $e=new Set;if(rt==="auto")for(let St=0;St<mt.values.length;St+=2)$e.add(Rh(mt.values[St]));else $e.add(rt);let Ze=!1;for(const St of $e)if(!V.horizontal[St])if(Ze)V.horizontal[St]=V.horizontal[0];else{const yt=uu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ke,_,"center",St,De,ee,s.ai.horizontal,!1,it,F,L);yt&&(V.horizontal[St]=yt,Ze=yt.positionedLines.length===1)}ht()}else{rt==="auto"&&(rt=Rh(ot));const $e=uu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ke,_,ot,rt,De,ee,s.ai.horizontal,!1,it,F,L);$e&&(V.horizontal[rt]=$e),ht(),al(fe)&&y&&b&&(V.vertical=uu(Z,i.glyphMap,i.glyphPositions,i.imagePositions,E,Ke,_,ot,rt,De,ee,s.ai.vertical,!1,it,F,L))}}let he=!1;if(M.icon&&M.icon.name){const fe=i.imageMap[M.icon.name];fe&&(J=ng(i.imagePositions[M.icon.name],r.get("icon-offset").evaluate(M,{},i.canonical),r.get("icon-anchor").evaluate(M,{},i.canonical)),he=!!fe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=he:i.bucket.sdfIcons!==he&&Ne("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(fe.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ne=Kp(V.horizontal)||V.vertical;i.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||J)&&xg(i.bucket,M,V,J,i.imageMap,d,F,N,ee,he,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},s.br=xh,s.bs=yh,s.bt=bh,s.bu=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},s.bv=Sh,s.bw=ns,s.bx=function(i,e,r,a,d){return C(this,void 0,void 0,function*(){if(re())try{return yield Jt(i,e,r,a,d)}catch{}return function(_,y,b,S,M){const E=_.width,L=_.height;Ut&&Rt||(Ut=new OffscreenCanvas(E,L),Rt=Ut.getContext("2d",{willReadFrequently:!0})),Ut.width=E,Ut.height=L,Rt.drawImage(_,0,0,E,L);const F=Rt.getImageData(y,b,S,M);return Rt.clearRect(0,0,E,L),F.data}(i,e,r,a,d)})},s.by=zp,s.bz=I,s.c=Ct,s.d=function(i,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=Ri})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(i)],{type:"image/png"});r.src=i.byteLength?URL.createObjectURL(a):Ri},s.e=Oe,s.f=function(i,e){return Zi(Oe(i,{type:"json"}),e)},s.g=Ht,s.h=Ge,s.i=dt,s.j=zr,s.k=Mn,s.l=Xe,s.m=Zi,s.n=function(i){return new Sh(i).readFields($_,[])},s.o=function(i,e,r){if(!i.length)return r(null,[]);let a=i.length;const d=new Array(i.length);let _=null;i.forEach((y,b)=>{e(y,(S,M)=>{S&&(_=S),d[b]=M,--a==0&&r(_,d)})})},s.p=hp,s.q=Cl,s.r=Ji,s.s=Ti,s.t=Qu,s.u=nt,s.v=Ce,s.w=Ne,s.x=ha,s.y=io,s.z=function([i,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(r),y:i*Math.sin(e)*Math.sin(r),z:i*Math.cos(r)}}}),v(["./shared"],function(s){class C{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,R){for(const Y of B){this._layerConfigs[Y.id]=Y;const $=this._layers[Y.id]=s.aC(Y);$._featureFilter=s.a6($.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of R)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const U=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const Y of U){const $=Y.map(ze=>this._layers[ze.id]),pe=$[0];if(pe.visibility==="none")continue;const se=pe.source||"";let te=this.familiesBySource[se];te||(te=this.familiesBySource[se]={});const ue=pe.sourceLayer||"_geojsonTileLayer";let Pe=te[ue];Pe||(Pe=te[ue]=[]),Pe.push($)}}}class I{constructor(B){const R={},U=[];for(const se in B){const te=B[se],ue=R[se]={};for(const Pe in te){const ze=te[+Pe];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Be={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};U.push(Be),ue[Pe]={rect:Be,metrics:ze.metrics}}}const{w:Y,h:$}=s.p(U),pe=new s.q({width:Y||1,height:$||1});for(const se in B){const te=B[se];for(const ue in te){const Pe=te[+ue];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const ze=R[se][ue].rect;s.q.copy(Pe.bitmap,pe,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Pe.bitmap)}}this.image=pe,this.positions=R}}s.bm("GlyphAtlas",I);class D{constructor(B){this.tileID=new s.O(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(B,R,U,Y,$){this.status="parsing",this.data=B,this.collisionBoxArray=new s.a3;const pe=new s.bn(Object.keys(B.layers).sort()),se=new s.bo(this.tileID,this.promoteId);se.bucketLayerIDs=[];const te={},ue={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U},Pe=R.familiesBySource[this.source];for(const ni in Pe){const ri=B.layers[ni];if(!ri)continue;ri.version===1&&s.w(`Vector tile source "${this.source}" layer "${ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ir=pe.encode(ni),ki=[];for(let ir=0;ir<ri.length;ir++){const br=ri.feature(ir),yn=se.getId(br,ni);ki.push({feature:br,id:yn,index:ir,sourceLayerIndex:Ir})}for(const ir of Pe[ni]){const br=ir[0];br.source!==this.source&&s.w(`layer.source = ${br.source} does not equal this.source = ${this.source}`),br.minzoom&&this.zoom<Math.floor(br.minzoom)||br.maxzoom&&this.zoom>=br.maxzoom||br.visibility!=="none"&&(q(ir,this.zoom,U),(te[br.id]=br.createBucket({index:se.bucketLayerIDs.length,layers:ir,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ir,sourceID:this.source})).populate(ki,ue,this.tileID.canonical),se.bucketLayerIDs.push(ir.map(yn=>yn.id)))}}let ze,Be,wt,Pt;const pt=s.aH(ue.glyphDependencies,ni=>Object.keys(ni).map(Number));this.inFlightDependencies.forEach(ni=>ni==null?void 0:ni.cancel()),this.inFlightDependencies=[];const kt=++this.dependencySentinel;Object.keys(pt).length?this.inFlightDependencies.push(Y.send("getGlyphs",{uid:this.uid,stacks:pt,source:this.source,tileID:this.tileID,type:"glyphs"},(ni,ri)=>{kt===this.dependencySentinel&&(ze||(ze=ni,Be=ri,vi.call(this)))})):Be={};const Lt=Object.keys(ue.iconDependencies);Lt.length?this.inFlightDependencies.push(Y.send("getImages",{icons:Lt,source:this.source,tileID:this.tileID,type:"icons"},(ni,ri)=>{kt===this.dependencySentinel&&(ze||(ze=ni,wt=ri,vi.call(this)))})):wt={};const pi=Object.keys(ue.patternDependencies);function vi(){if(ze)return $(ze);if(Be&&wt&&Pt){const ni=new I(Be),ri=new s.bp(wt,Pt);for(const Ir in te){const ki=te[Ir];ki instanceof s.a4?(q(ki.layers,this.zoom,U),s.bq({bucket:ki,glyphMap:Be,glyphPositions:ni.positions,imageMap:wt,imagePositions:ri.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ki.hasPattern&&(ki instanceof s.br||ki instanceof s.bs||ki instanceof s.bt)&&(q(ki.layers,this.zoom,U),ki.addFeatures(ue,this.tileID.canonical,ri.patternPositions))}this.status="done",$(null,{buckets:Object.values(te).filter(Ir=>!Ir.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ni.image,imageAtlas:ri,glyphMap:this.returnDependencies?Be:null,iconMap:this.returnDependencies?wt:null,glyphPositions:this.returnDependencies?ni.positions:null})}}pi.length?this.inFlightDependencies.push(Y.send("getImages",{icons:pi,source:this.source,tileID:this.tileID,type:"patterns"},(ni,ri)=>{kt===this.dependencySentinel&&(ze||(ze=ni,Pt=ri,vi.call(this)))})):Pt={},vi.call(this)}}function q(H,B,R){const U=new s.a8(B);for(const Y of H)Y.recalculate(U,R)}function ie(H,B){const R=s.l(H.request,(U,Y,$,pe)=>{if(U)B(U);else if(Y)try{const se=new s.bw.VectorTile(new s.bv(Y));B(null,{vectorTile:se,rawData:Y,cacheControl:$,expires:pe})}catch(se){const te=new Uint8Array(Y);let ue=`Unable to parse the tile at ${H.request.url}, `;ue+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.messge}`,B(new Error(ue))}});return()=>{R.cancel(),B()}}class de{constructor(B,R,U,Y){this.actor=B,this.layerIndex=R,this.availableImages=U,this.loadVectorData=Y||ie,this.fetching={},this.loading={},this.loaded={}}loadTile(B,R){const U=B.uid;this.loading||(this.loading={});const Y=!!(B&&B.request&&B.request.collectResourceTiming)&&new s.bu(B.request),$=this.loading[U]=new D(B);$.abort=this.loadVectorData(B,(pe,se)=>{if(delete this.loading[U],pe||!se)return $.status="done",this.loaded[U]=$,R(pe);const te=se.rawData,ue={};se.expires&&(ue.expires=se.expires),se.cacheControl&&(ue.cacheControl=se.cacheControl);const Pe={};if(Y){const ze=Y.finish();ze&&(Pe.resourceTiming=JSON.parse(JSON.stringify(ze)))}$.vectorTile=se.vectorTile,$.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor,(ze,Be)=>{if(delete this.fetching[U],ze||!Be)return R(ze);R(null,s.e({rawTileData:te.slice(0)},Be,ue,Pe))}),this.loaded=this.loaded||{},this.loaded[U]=$,this.fetching[U]={rawTileData:te,cacheControl:ue,resourceTiming:Pe}})}reloadTile(B,R){const U=this.loaded,Y=B.uid;if(U&&U[Y]){const $=U[Y];$.showCollisionBoxes=B.showCollisionBoxes,$.status==="parsing"?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,(pe,se)=>{if(pe||!se)return R(pe,se);let te;if(this.fetching[Y]){const{rawTileData:ue,cacheControl:Pe,resourceTiming:ze}=this.fetching[Y];delete this.fetching[Y],te=s.e({rawTileData:ue.slice(0)},se,Pe,ze)}else te=se;R(null,te)}):$.status==="done"&&($.vectorTile?$.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,R):R())}}abortTile(B,R){const U=this.loading,Y=B.uid;U&&U[Y]&&U[Y].abort&&(U[Y].abort(),delete U[Y]),R()}removeTile(B,R){const U=this.loaded,Y=B.uid;U&&U[Y]&&delete U[Y],R()}}class oe{constructor(){this.loaded={}}loadTile(B,R){return s._(this,void 0,void 0,function*(){const{uid:U,encoding:Y,rawImageData:$,redFactor:pe,greenFactor:se,blueFactor:te,baseShift:ue}=B,Pe=$.width+2,ze=$.height+2,Be=s.a($)?new s.R({width:Pe,height:ze},yield s.bx($,-1,-1,Pe,ze)):$,wt=new s.by(U,Be,Y,pe,se,te,ue);this.loaded=this.loaded||{},this.loaded[U]=wt,R(null,wt)})}removeTile(B){const R=this.loaded,U=B.uid;R&&R[U]&&delete R[U]}}function Te(H,B){if(H.length!==0){me(H[0],B);for(var R=1;R<H.length;R++)me(H[R],!B)}}function me(H,B){for(var R=0,U=0,Y=0,$=H.length,pe=$-1;Y<$;pe=Y++){var se=(H[Y][0]-H[pe][0])*(H[pe][1]+H[Y][1]),te=R+se;U+=Math.abs(R)>=Math.abs(se)?R-te+se:se-te+R,R=te}R+U>=0!=!!B&&H.reverse()}var ye=s.bz(function H(B,R){var U,Y=B&&B.type;if(Y==="FeatureCollection")for(U=0;U<B.features.length;U++)H(B.features[U],R);else if(Y==="GeometryCollection")for(U=0;U<B.geometries.length;U++)H(B.geometries[U],R);else if(Y==="Feature")H(B.geometry,R);else if(Y==="Polygon")Te(B.coordinates,R);else if(Y==="MultiPolygon")for(U=0;U<B.coordinates.length;U++)Te(B.coordinates[U],R);return B});const W=s.bw.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},le=s.bA,xe=s.bw.VectorTileFeature,Ee=Ie;function Ie(H,B){this.options=B||{},this.features=H,this.length=H.length}function Oe(H,B){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=B||4096}Ie.prototype.feature=function(H){return new Oe(this.features[H],this.options.extent)},Oe.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var B=0;B<H.length;B++){for(var R=H[B],U=[],Y=0;Y<R.length;Y++)U.push(new le(R[Y][0],R[Y][1]));this.geometry.push(U)}return this.geometry},Oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,B=1/0,R=-1/0,U=1/0,Y=-1/0,$=0;$<H.length;$++)for(var pe=H[$],se=0;se<pe.length;se++){var te=pe[se];B=Math.min(B,te.x),R=Math.max(R,te.x),U=Math.min(U,te.y),Y=Math.max(Y,te.y)}return[B,U,R,Y]},Oe.prototype.toGeoJSON=xe.prototype.toGeoJSON;var qe=s.bB,He=Ee;function be(H){var B=new qe;return function(R,U){for(var Y in R.layers)U.writeMessage(3,Ue,R.layers[Y])}(H,B),B.finish()}function Ue(H,B){var R;B.writeVarintField(15,H.version||1),B.writeStringField(1,H.name||""),B.writeVarintField(5,H.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<H.length;R++)U.feature=H.feature(R),B.writeMessage(2,xt,U);var Y=U.keys;for(R=0;R<Y.length;R++)B.writeStringField(3,Y[R]);var $=U.values;for(R=0;R<$.length;R++)B.writeMessage(4,Ft,$[R])}function xt(H,B){var R=H.feature;R.id!==void 0&&B.writeVarintField(1,R.id),B.writeMessage(2,Ne,H),B.writeVarintField(3,R.type),B.writeMessage(4,dt,R)}function Ne(H,B){var R=H.feature,U=H.keys,Y=H.values,$=H.keycache,pe=H.valuecache;for(var se in R.properties){var te=R.properties[se],ue=$[se];if(te!==null){ue===void 0&&(U.push(se),$[se]=ue=U.length-1),B.writeVarint(ue);var Pe=typeof te;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(te=JSON.stringify(te));var ze=Pe+":"+te,Be=pe[ze];Be===void 0&&(Y.push(te),pe[ze]=Be=Y.length-1),B.writeVarint(Be)}}}function vt(H,B){return(B<<3)+(7&H)}function gt(H){return H<<1^H>>31}function dt(H,B){for(var R=H.loadGeometry(),U=H.type,Y=0,$=0,pe=R.length,se=0;se<pe;se++){var te=R[se],ue=1;U===1&&(ue=te.length),B.writeVarint(vt(1,ue));for(var Pe=U===3?te.length-1:te.length,ze=0;ze<Pe;ze++){ze===1&&U!==1&&B.writeVarint(vt(2,Pe-1));var Be=te[ze].x-Y,wt=te[ze].y-$;B.writeVarint(gt(Be)),B.writeVarint(gt(wt)),Y+=Be,$+=wt}U===3&&B.writeVarint(vt(7,1))}}function Ft(H,B){var R=typeof H;R==="string"?B.writeStringField(1,H):R==="boolean"?B.writeBooleanField(7,H):R==="number"&&(H%1!=0?B.writeDoubleField(3,H):H<0?B.writeSVarintField(6,H):B.writeVarintField(5,H))}re.exports=be,re.exports.fromVectorTileJs=be,re.exports.fromGeojsonVt=function(H,B){B=B||{};var R={};for(var U in H)R[U]=new He(H[U].features,B),R[U].name=U,R[U].version=B.version,R[U].extent=B.extent;return be({layers:R})},re.exports.GeoJSONWrapper=He;var sr=s.bz(re.exports);const Ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:H=>H},Jt=Math.fround||(Ut=new Float32Array(1),H=>(Ut[0]=+H,Ut[0]));var Ut;const Rt=3,fi=5,Yi=6;class Ge{constructor(B){this.options=Object.assign(Object.create(Ri),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:R,minZoom:U,maxZoom:Y}=this.options;R&&console.time("total time");const $=`prepare ${B.length} points`;R&&console.time($),this.points=B;const pe=[];for(let te=0;te<B.length;te++){const ue=B[te];if(!ue.geometry)continue;const[Pe,ze]=ue.geometry.coordinates,Be=Jt(mi(Pe)),wt=Jt(Ht(ze));pe.push(Be,wt,1/0,te,-1,1),this.options.reduce&&pe.push(0)}let se=this.trees[Y+1]=this._createTree(pe);R&&console.timeEnd($);for(let te=Y;te>=U;te--){const ue=+Date.now();se=this.trees[te]=this._createTree(this._cluster(se,te)),R&&console.log("z%d: %d clusters in %dms",te,se.numItems,+Date.now()-ue)}return R&&console.timeEnd("total time"),this}getClusters(B,R){let U=((B[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,B[1]));let $=B[2]===180?180:((B[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)U=-180,$=180;else if(U>$){const ze=this.getClusters([U,Y,180,pe],R),Be=this.getClusters([-180,Y,$,pe],R);return ze.concat(Be)}const se=this.trees[this._limitZoom(R)],te=se.range(mi(U),Ht(pe),mi($),Ht(Y)),ue=se.data,Pe=[];for(const ze of te){const Be=this.stride*ze;Pe.push(ue[Be+fi]>1?Ct(ue,Be,this.clusterProps):this.points[ue[Be+Rt]])}return Pe}getChildren(B){const R=this._getOriginId(B),U=this._getOriginZoom(B),Y="No cluster with the specified id.",$=this.trees[U];if(!$)throw new Error(Y);const pe=$.data;if(R*this.stride>=pe.length)throw new Error(Y);const se=this.options.radius/(this.options.extent*Math.pow(2,U-1)),te=$.within(pe[R*this.stride],pe[R*this.stride+1],se),ue=[];for(const Pe of te){const ze=Pe*this.stride;pe[ze+4]===B&&ue.push(pe[ze+fi]>1?Ct(pe,ze,this.clusterProps):this.points[pe[ze+Rt]])}if(ue.length===0)throw new Error(Y);return ue}getLeaves(B,R,U){const Y=[];return this._appendLeaves(Y,B,R=R||10,U=U||0,0),Y}getTile(B,R,U){const Y=this.trees[this._limitZoom(B)],$=Math.pow(2,B),{extent:pe,radius:se}=this.options,te=se/pe,ue=(U-te)/$,Pe=(U+1+te)/$,ze={features:[]};return this._addTileFeatures(Y.range((R-te)/$,ue,(R+1+te)/$,Pe),Y.data,R,U,$,ze),R===0&&this._addTileFeatures(Y.range(1-te/$,ue,1,Pe),Y.data,$,U,$,ze),R===$-1&&this._addTileFeatures(Y.range(0,ue,te/$,Pe),Y.data,-1,U,$,ze),ze.features.length?ze:null}getClusterExpansionZoom(B){let R=this._getOriginZoom(B)-1;for(;R<=this.options.maxZoom;){const U=this.getChildren(B);if(R++,U.length!==1)break;B=U[0].properties.cluster_id}return R}_appendLeaves(B,R,U,Y,$){const pe=this.getChildren(R);for(const se of pe){const te=se.properties;if(te&&te.cluster?$+te.point_count<=Y?$+=te.point_count:$=this._appendLeaves(B,te.cluster_id,U,Y,$):$<Y?$++:B.push(se),B.length===U)break}return $}_createTree(B){const R=new s.av(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<B.length;U+=this.stride)R.add(B[U],B[U+1]);return R.finish(),R.data=B,R}_addTileFeatures(B,R,U,Y,$,pe){for(const se of B){const te=se*this.stride,ue=R[te+fi]>1;let Pe,ze,Be;if(ue)Pe=Je(R,te,this.clusterProps),ze=R[te],Be=R[te+1];else{const pt=this.points[R[te+Rt]];Pe=pt.properties;const[kt,Lt]=pt.geometry.coordinates;ze=mi(kt),Be=Ht(Lt)}const wt={type:1,geometry:[[Math.round(this.options.extent*(ze*$-U)),Math.round(this.options.extent*(Be*$-Y))]],tags:Pe};let Pt;Pt=ue||this.options.generateId?R[te+Rt]:this.points[R[te+Rt]].id,Pt!==void 0&&(wt.id=Pt),pe.features.push(wt)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,R){const{radius:U,extent:Y,reduce:$,minPoints:pe}=this.options,se=U/(Y*Math.pow(2,R)),te=B.data,ue=[],Pe=this.stride;for(let ze=0;ze<te.length;ze+=Pe){if(te[ze+2]<=R)continue;te[ze+2]=R;const Be=te[ze],wt=te[ze+1],Pt=B.within(te[ze],te[ze+1],se),pt=te[ze+fi];let kt=pt;for(const Lt of Pt){const pi=Lt*Pe;te[pi+2]>R&&(kt+=te[pi+fi])}if(kt>pt&&kt>=pe){let Lt,pi=Be*pt,vi=wt*pt,ni=-1;const ri=((ze/Pe|0)<<5)+(R+1)+this.points.length;for(const Ir of Pt){const ki=Ir*Pe;if(te[ki+2]<=R)continue;te[ki+2]=R;const ir=te[ki+fi];pi+=te[ki]*ir,vi+=te[ki+1]*ir,te[ki+4]=ri,$&&(Lt||(Lt=this._map(te,ze,!0),ni=this.clusterProps.length,this.clusterProps.push(Lt)),$(Lt,this._map(te,ki)))}te[ze+4]=ri,ue.push(pi/kt,vi/kt,1/0,ri,-1,kt),$&&ue.push(ni)}else{for(let Lt=0;Lt<Pe;Lt++)ue.push(te[ze+Lt]);if(kt>1)for(const Lt of Pt){const pi=Lt*Pe;if(!(te[pi+2]<=R)){te[pi+2]=R;for(let vi=0;vi<Pe;vi++)ue.push(te[pi+vi])}}}}return ue}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,R,U){if(B[R+fi]>1){const pe=this.clusterProps[B[R+Yi]];return U?Object.assign({},pe):pe}const Y=this.points[B[R+Rt]].properties,$=this.options.map(Y);return U&&$===Y?Object.assign({},$):$}}function Ct(H,B,R){return{type:"Feature",id:H[B+Rt],properties:Je(H,B,R),geometry:{type:"Point",coordinates:[(U=H[B],360*(U-.5)),wi(H[B+1])]}};var U}function Je(H,B,R){const U=H[B+fi],Y=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,$=H[B+Yi],pe=$===-1?{}:Object.assign({},R[$]);return Object.assign(pe,{cluster:!0,cluster_id:H[B+Rt],point_count:U,point_count_abbreviated:Y})}function mi(H){return H/360+.5}function Ht(H){const B=Math.sin(H*Math.PI/180),R=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return R<0?0:R>1?1:R}function wi(H){const B=(180-360*H)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function Zi(H,B,R,U){for(var Y,$=U,pe=R-B>>1,se=R-B,te=H[B],ue=H[B+1],Pe=H[R],ze=H[R+1],Be=B+3;Be<R;Be+=3){var wt=Xe(H[Be],H[Be+1],te,ue,Pe,ze);if(wt>$)Y=Be,$=wt;else if(wt===$){var Pt=Math.abs(Be-pe);Pt<se&&(Y=Be,se=Pt)}}$>U&&(Y-B>3&&Zi(H,B,Y,U),H[Y+2]=$,R-Y>3&&Zi(H,Y,R,U))}function Xe(H,B,R,U,Y,$){var pe=Y-R,se=$-U;if(pe!==0||se!==0){var te=((H-R)*pe+(B-U)*se)/(pe*pe+se*se);te>1?(R=Y,U=$):te>0&&(R+=pe*te,U+=se*te)}return(pe=H-R)*pe+(se=B-U)*se}function Ti(H,B,R,U){var Y={id:H===void 0?null:H,type:B,geometry:R,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($){var pe=$.geometry,se=$.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")Gi($,pe);else if(se==="Polygon"||se==="MultiLineString")for(var te=0;te<pe.length;te++)Gi($,pe[te]);else if(se==="MultiPolygon")for(te=0;te<pe.length;te++)for(var ue=0;ue<pe[te].length;ue++)Gi($,pe[te][ue])}(Y),Y}function Gi(H,B){for(var R=0;R<B.length;R+=3)H.minX=Math.min(H.minX,B[R]),H.minY=Math.min(H.minY,B[R+1]),H.maxX=Math.max(H.maxX,B[R]),H.maxY=Math.max(H.maxY,B[R+1])}function rn(H,B,R,U){if(B.geometry){var Y=B.geometry.coordinates,$=B.geometry.type,pe=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),se=[],te=B.id;if(R.promoteId?te=B.properties[R.promoteId]:R.generateId&&(te=U||0),$==="Point")Mn(Y,se);else if($==="MultiPoint")for(var ue=0;ue<Y.length;ue++)Mn(Y[ue],se);else if($==="LineString")zr(Y,se,pe,!1);else if($==="MultiLineString"){if(R.lineMetrics){for(ue=0;ue<Y.length;ue++)zr(Y[ue],se=[],pe,!1),H.push(Ti(te,"LineString",se,B.properties));return}gr(Y,se,pe,!1)}else if($==="Polygon")gr(Y,se,pe,!0);else{if($!=="MultiPolygon"){if($==="GeometryCollection"){for(ue=0;ue<B.geometry.geometries.length;ue++)rn(H,{id:te,geometry:B.geometry.geometries[ue],properties:B.properties},R,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ue=0;ue<Y.length;ue++){var Pe=[];gr(Y[ue],Pe,pe,!0),se.push(Pe)}}H.push(Ti(te,$,se,B.properties))}}function Mn(H,B){B.push(Ce(H[0])),B.push(vr(H[1])),B.push(0)}function zr(H,B,R,U){for(var Y,$,pe=0,se=0;se<H.length;se++){var te=Ce(H[se][0]),ue=vr(H[se][1]);B.push(te),B.push(ue),B.push(0),se>0&&(pe+=U?(Y*ue-te*$)/2:Math.sqrt(Math.pow(te-Y,2)+Math.pow(ue-$,2))),Y=te,$=ue}var Pe=B.length-3;B[2]=1,Zi(B,0,Pe,R),B[Pe+2]=1,B.size=Math.abs(pe),B.start=0,B.end=B.size}function gr(H,B,R,U){for(var Y=0;Y<H.length;Y++){var $=[];zr(H[Y],$,R,U),B.push($)}}function Ce(H){return H/360+.5}function vr(H){var B=Math.sin(H*Math.PI/180),R=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return R<0?0:R>1?1:R}function Lr(H,B,R,U,Y,$,pe,se){if(U/=B,$>=(R/=B)&&pe<U)return H;if(pe<R||$>=U)return null;for(var te=[],ue=0;ue<H.length;ue++){var Pe=H[ue],ze=Pe.geometry,Be=Pe.type,wt=Y===0?Pe.minX:Pe.minY,Pt=Y===0?Pe.maxX:Pe.maxY;if(wt>=R&&Pt<U)te.push(Pe);else if(!(Pt<R||wt>=U)){var pt=[];if(Be==="Point"||Be==="MultiPoint")ai(ze,pt,R,U,Y);else if(Be==="LineString")Ot(ze,pt,R,U,Y,!1,se.lineMetrics);else if(Be==="MultiLineString")Cn(ze,pt,R,U,Y,!1);else if(Be==="Polygon")Cn(ze,pt,R,U,Y,!0);else if(Be==="MultiPolygon")for(var kt=0;kt<ze.length;kt++){var Lt=[];Cn(ze[kt],Lt,R,U,Y,!0),Lt.length&&pt.push(Lt)}if(pt.length){if(se.lineMetrics&&Be==="LineString"){for(kt=0;kt<pt.length;kt++)te.push(Ti(Pe.id,Be,pt[kt],Pe.tags));continue}Be!=="LineString"&&Be!=="MultiLineString"||(pt.length===1?(Be="LineString",pt=pt[0]):Be="MultiLineString"),Be!=="Point"&&Be!=="MultiPoint"||(Be=pt.length===3?"Point":"MultiPoint"),te.push(Ti(Pe.id,Be,pt,Pe.tags))}}}return te.length?te:null}function ai(H,B,R,U,Y){for(var $=0;$<H.length;$+=3){var pe=H[$+Y];pe>=R&&pe<=U&&(B.push(H[$]),B.push(H[$+1]),B.push(H[$+2]))}}function Ot(H,B,R,U,Y,$,pe){for(var se,te,ue=nn(H),Pe=Y===0?Oi:ii,ze=H.start,Be=0;Be<H.length-3;Be+=3){var wt=H[Be],Pt=H[Be+1],pt=H[Be+2],kt=H[Be+3],Lt=H[Be+4],pi=Y===0?wt:Pt,vi=Y===0?kt:Lt,ni=!1;pe&&(se=Math.sqrt(Math.pow(wt-kt,2)+Math.pow(Pt-Lt,2))),pi<R?vi>R&&(te=Pe(ue,wt,Pt,kt,Lt,R),pe&&(ue.start=ze+se*te)):pi>U?vi<U&&(te=Pe(ue,wt,Pt,kt,Lt,U),pe&&(ue.start=ze+se*te)):tr(ue,wt,Pt,pt),vi<R&&pi>=R&&(te=Pe(ue,wt,Pt,kt,Lt,R),ni=!0),vi>U&&pi<=U&&(te=Pe(ue,wt,Pt,kt,Lt,U),ni=!0),!$&&ni&&(pe&&(ue.end=ze+se*te),B.push(ue),ue=nn(H)),pe&&(ze+=se)}var ri=H.length-3;wt=H[ri],Pt=H[ri+1],pt=H[ri+2],(pi=Y===0?wt:Pt)>=R&&pi<=U&&tr(ue,wt,Pt,pt),ri=ue.length-3,$&&ri>=3&&(ue[ri]!==ue[0]||ue[ri+1]!==ue[1])&&tr(ue,ue[0],ue[1],ue[2]),ue.length&&B.push(ue)}function nn(H){var B=[];return B.size=H.size,B.start=H.start,B.end=H.end,B}function Cn(H,B,R,U,Y,$){for(var pe=0;pe<H.length;pe++)Ot(H[pe],B,R,U,Y,$,!1)}function tr(H,B,R,U){H.push(B),H.push(R),H.push(U)}function Oi(H,B,R,U,Y,$){var pe=($-B)/(U-B);return H.push($),H.push(R+(Y-R)*pe),H.push(1),pe}function ii(H,B,R,U,Y,$){var pe=($-R)/(Y-R);return H.push(B+(U-B)*pe),H.push($),H.push(1),pe}function Ni(H,B){for(var R=[],U=0;U<H.length;U++){var Y,$=H[U],pe=$.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Y=xo($.geometry,B);else if(pe==="MultiLineString"||pe==="Polygon"){Y=[];for(var se=0;se<$.geometry.length;se++)Y.push(xo($.geometry[se],B))}else if(pe==="MultiPolygon")for(Y=[],se=0;se<$.geometry.length;se++){for(var te=[],ue=0;ue<$.geometry[se].length;ue++)te.push(xo($.geometry[se][ue],B));Y.push(te)}R.push(Ti($.id,pe,Y,$.tags))}return R}function xo(H,B){var R=[];R.size=H.size,H.start!==void 0&&(R.start=H.start,R.end=H.end);for(var U=0;U<H.length;U+=3)R.push(H[U]+B,H[U+1],H[U+2]);return R}function Ye(H,B){if(H.transformed)return H;var R,U,Y,$=1<<H.z,pe=H.x,se=H.y;for(R=0;R<H.features.length;R++){var te=H.features[R],ue=te.geometry,Pe=te.type;if(te.geometry=[],Pe===1)for(U=0;U<ue.length;U+=2)te.geometry.push(Fn(ue[U],ue[U+1],B,$,pe,se));else for(U=0;U<ue.length;U++){var ze=[];for(Y=0;Y<ue[U].length;Y+=2)ze.push(Fn(ue[U][Y],ue[U][Y+1],B,$,pe,se));te.geometry.push(ze)}}return H.transformed=!0,H}function Fn(H,B,R,U,Y,$){return[Math.round(R*(H*U-Y)),Math.round(R*(B*U-$))]}function Vi(H,B,R,U,Y){for(var $=B===Y.maxZoom?0:Y.tolerance/((1<<B)*Y.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:U,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<H.length;se++){pe.numFeatures++,wo(pe,H[se],$,Y);var te=H[se].minX,ue=H[se].minY,Pe=H[se].maxX,ze=H[se].maxY;te<pe.minX&&(pe.minX=te),ue<pe.minY&&(pe.minY=ue),Pe>pe.maxX&&(pe.maxX=Pe),ze>pe.maxY&&(pe.maxY=ze)}return pe}function wo(H,B,R,U){var Y=B.geometry,$=B.type,pe=[];if($==="Point"||$==="MultiPoint")for(var se=0;se<Y.length;se+=3)pe.push(Y[se]),pe.push(Y[se+1]),H.numPoints++,H.numSimplified++;else if($==="LineString")Jn(pe,Y,H,R,!1,!1);else if($==="MultiLineString"||$==="Polygon")for(se=0;se<Y.length;se++)Jn(pe,Y[se],H,R,$==="Polygon",se===0);else if($==="MultiPolygon")for(var te=0;te<Y.length;te++){var ue=Y[te];for(se=0;se<ue.length;se++)Jn(pe,ue[se],H,R,!0,se===0)}if(pe.length){var Pe=B.tags||null;if($==="LineString"&&U.lineMetrics){for(var ze in Pe={},B.tags)Pe[ze]=B.tags[ze];Pe.mapbox_clip_start=Y.start/Y.size,Pe.mapbox_clip_end=Y.end/Y.size}var Be={geometry:pe,type:$==="Polygon"||$==="MultiPolygon"?3:$==="LineString"||$==="MultiLineString"?2:1,tags:Pe};B.id!==null&&(Be.id=B.id),H.features.push(Be)}}function Jn(H,B,R,U,Y,$){var pe=U*U;if(U>0&&B.size<(Y?pe:U))R.numPoints+=B.length/3;else{for(var se=[],te=0;te<B.length;te+=3)(U===0||B[te+2]>pe)&&(R.numSimplified++,se.push(B[te]),se.push(B[te+1])),R.numPoints++;Y&&function(ue,Pe){for(var ze=0,Be=0,wt=ue.length,Pt=wt-2;Be<wt;Pt=Be,Be+=2)ze+=(ue[Be]-ue[Pt])*(ue[Be+1]+ue[Pt+1]);if(ze>0===Pe)for(Be=0,wt=ue.length;Be<wt/2;Be+=2){var pt=ue[Be],kt=ue[Be+1];ue[Be]=ue[wt-2-Be],ue[Be+1]=ue[wt-1-Be],ue[wt-2-Be]=pt,ue[wt-1-Be]=kt}}(se,$),H.push(se)}}function Qe(H,B){var R=(B=this.options=function(Y,$){for(var pe in $)Y[pe]=$[pe];return Y}(Object.create(this.options),B)).debug;if(R&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(Y,$){var pe=[];if(Y.type==="FeatureCollection")for(var se=0;se<Y.features.length;se++)rn(pe,Y.features[se],$,se);else rn(pe,Y.type==="Feature"?Y:{geometry:Y},$);return pe}(H,B);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),U=function(Y,$){var pe=$.buffer/$.extent,se=Y,te=Lr(Y,1,-1-pe,pe,0,-1,2,$),ue=Lr(Y,1,1-pe,2+pe,0,-1,2,$);return(te||ue)&&(se=Lr(Y,1,-pe,1+pe,0,-1,2,$)||[],te&&(se=Ni(te,1).concat(se)),ue&&(se=se.concat(Ni(ue,-1)))),se}(U,B),U.length&&this.splitTile(U,0,0,0),R&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jt(H,B,R){return 32*((1<<H)*R+B)+H}function zt(H,B){return B?H.properties[B]:H.id}function Dr(H,B){if(H==null)return!0;if(H.type==="Feature")return zt(H,B)!=null;if(H.type==="FeatureCollection"){const R=new Set;for(const U of H.features){const Y=zt(U,B);if(Y==null||R.has(Y))return!1;R.add(Y)}return!0}return!1}function Rn(H,B){const R=new Map;if(H!=null)if(H.type==="Feature")R.set(zt(H,B),H);else for(const U of H.features)R.set(zt(U,B),U);return R}Qe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Qe.prototype.splitTile=function(H,B,R,U,Y,$,pe){for(var se=[H,B,R,U],te=this.options,ue=te.debug;se.length;){U=se.pop(),R=se.pop(),B=se.pop(),H=se.pop();var Pe=1<<B,ze=jt(B,R,U),Be=this.tiles[ze];if(!Be&&(ue>1&&console.time("creation"),Be=this.tiles[ze]=Vi(H,B,R,U,te),this.tileCoords.push({z:B,x:R,y:U}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,R,U,Be.numFeatures,Be.numPoints,Be.numSimplified),console.timeEnd("creation"));var wt="z"+B;this.stats[wt]=(this.stats[wt]||0)+1,this.total++}if(Be.source=H,Y){if(B===te.maxZoom||B===Y)continue;var Pt=1<<Y-B;if(R!==Math.floor($/Pt)||U!==Math.floor(pe/Pt))continue}else if(B===te.indexMaxZoom||Be.numPoints<=te.indexMaxPoints)continue;if(Be.source=null,H.length!==0){ue>1&&console.time("clipping");var pt,kt,Lt,pi,vi,ni,ri=.5*te.buffer/te.extent,Ir=.5-ri,ki=.5+ri,ir=1+ri;pt=kt=Lt=pi=null,vi=Lr(H,Pe,R-ri,R+ki,0,Be.minX,Be.maxX,te),ni=Lr(H,Pe,R+Ir,R+ir,0,Be.minX,Be.maxX,te),H=null,vi&&(pt=Lr(vi,Pe,U-ri,U+ki,1,Be.minY,Be.maxY,te),kt=Lr(vi,Pe,U+Ir,U+ir,1,Be.minY,Be.maxY,te),vi=null),ni&&(Lt=Lr(ni,Pe,U-ri,U+ki,1,Be.minY,Be.maxY,te),pi=Lr(ni,Pe,U+Ir,U+ir,1,Be.minY,Be.maxY,te),ni=null),ue>1&&console.timeEnd("clipping"),se.push(pt||[],B+1,2*R,2*U),se.push(kt||[],B+1,2*R,2*U+1),se.push(Lt||[],B+1,2*R+1,2*U),se.push(pi||[],B+1,2*R+1,2*U+1)}}},Qe.prototype.getTile=function(H,B,R){var U=this.options,Y=U.extent,$=U.debug;if(H<0||H>24)return null;var pe=1<<H,se=jt(H,B=(B%pe+pe)%pe,R);if(this.tiles[se])return Ye(this.tiles[se],Y);$>1&&console.log("drilling down to z%d-%d-%d",H,B,R);for(var te,ue=H,Pe=B,ze=R;!te&&ue>0;)ue--,Pe=Math.floor(Pe/2),ze=Math.floor(ze/2),te=this.tiles[jt(ue,Pe,ze)];return te&&te.source?($>1&&console.log("found parent tile z%d-%d-%d",ue,Pe,ze),$>1&&console.time("drilling down"),this.splitTile(te.source,ue,Pe,ze,H,B,R),$>1&&console.timeEnd("drilling down"),this.tiles[se]?Ye(this.tiles[se],Y):null):null};class Bt extends de{constructor(B,R,U,Y){super(B,R,U),this._dataUpdateable=new Map,this.loadGeoJSON=($,pe)=>{const{promoteId:se}=$;if($.request)return s.f($.request,(te,ue,Pe,ze)=>{this._dataUpdateable=Dr(ue,se)?Rn(ue,se):void 0,pe(te,ue,Pe,ze)});if(typeof $.data=="string")try{const te=JSON.parse($.data);this._dataUpdateable=Dr(te,se)?Rn(te,se):void 0,pe(null,te)}catch{pe(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`))}else $.dataDiff?this._dataUpdateable?(function(te,ue,Pe){var ze,Be,wt,Pt;if(ue.removeAll&&te.clear(),ue.remove)for(const pt of ue.remove)te.delete(pt);if(ue.add)for(const pt of ue.add){const kt=zt(pt,Pe);kt!=null&&te.set(kt,pt)}if(ue.update)for(const pt of ue.update){let kt=te.get(pt.id);if(kt==null)continue;const Lt=!pt.removeAllProperties&&(((ze=pt.removeProperties)===null||ze===void 0?void 0:ze.length)>0||((Be=pt.addOrUpdateProperties)===null||Be===void 0?void 0:Be.length)>0);if((pt.newGeometry||pt.removeAllProperties||Lt)&&(kt=Object.assign({},kt),te.set(pt.id,kt),Lt&&(kt.properties=Object.assign({},kt.properties))),pt.newGeometry&&(kt.geometry=pt.newGeometry),pt.removeAllProperties)kt.properties={};else if(((wt=pt.removeProperties)===null||wt===void 0?void 0:wt.length)>0)for(const pi of pt.removeProperties)Object.prototype.hasOwnProperty.call(kt.properties,pi)&&delete kt.properties[pi];if(((Pt=pt.addOrUpdateProperties)===null||Pt===void 0?void 0:Pt.length)>0)for(const{key:pi,value:vi}of pt.addOrUpdateProperties)kt.properties[pi]=vi}}(this._dataUpdateable,$.dataDiff,se),pe(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):pe(new Error(`Cannot update existing geojson data in ${$.source}`)):pe(new Error(`Input data given to '${$.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,Y&&(this.loadGeoJSON=Y)}loadGeoJSONTile(B,R){const U=B.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const Y=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!Y)return R(null,null);const $=new class{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=se.length,this._features=se}feature(se){return new class{constructor(te){this._feature=te,this.extent=s.N,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ue of this._feature.geometry)te.push([new s.P(ue[0],ue[1])]);return te}{const te=[];for(const ue of this._feature.geometry){const Pe=[];for(const ze of ue)Pe.push(new s.P(ze[0],ze[1]));te.push(Pe)}return te}}toGeoJSON(te,ue,Pe){return W.call(this,te,ue,Pe)}}(this._features[se])}}(Y.features);let pe=sr($);pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),R(null,{vectorTile:$,rawData:pe.buffer})}loadData(B,R){var U;(U=this._pendingRequest)===null||U===void 0||U.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const Y=!!(B&&B.request&&B.request.collectResourceTiming)&&new s.bu(B.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(B,($,pe)=>{if(delete this._pendingCallback,delete this._pendingRequest,$||!pe)return R($);if(typeof pe!="object")return R(new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`));{ye(pe,!0);try{if(B.filter){const te=s.bC(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));pe={type:"FeatureCollection",features:pe.features.filter(Pe=>te.value.evaluate({zoom:0},Pe))}}this._geoJSONIndex=B.cluster?new Ge(function({superclusterOptions:te,clusterProperties:ue}){if(!ue||!te)return te;const Pe={},ze={},Be={accumulated:null,zoom:0},wt={properties:null},Pt=Object.keys(ue);for(const pt of Pt){const[kt,Lt]=ue[pt],pi=s.bC(Lt),vi=s.bC(typeof kt=="string"?[kt,["accumulated"],["get",pt]]:kt);Pe[pt]=pi.value,ze[pt]=vi.value}return te.map=pt=>{wt.properties=pt;const kt={};for(const Lt of Pt)kt[Lt]=Pe[Lt].evaluate(Be,wt);return kt},te.reduce=(pt,kt)=>{wt.properties=kt;for(const Lt of Pt)Be.accumulated=pt[Lt],pt[Lt]=ze[Lt].evaluate(Be,wt)},te}(B)).load(pe.features):function(te,ue){return new Qe(te,ue)}(pe,B.geojsonVtOptions)}catch(te){return R(te)}this.loaded={};const se={};if(Y){const te=Y.finish();te&&(se.resourceTiming={},se.resourceTiming[B.source]=JSON.parse(JSON.stringify(te)))}R(null,se)}})}reloadTile(B,R){const U=this.loaded;return U&&U[B.uid]?super.reloadTile(B,R):this.loadTile(B,R)}removeSource(B,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(B,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(B.clusterId))}catch(U){R(U)}}getClusterChildren(B,R){try{R(null,this._geoJSONIndex.getChildren(B.clusterId))}catch(U){R(U)}}getClusterLeaves(B,R){try{R(null,this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset))}catch(U){R(U)}}}class $n{constructor(B){this.self=B,this.actor=new s.C(B,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:de,geojson:Bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,U)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=U},this.self.registerRTLTextPlugin=R=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=R.applyArabicShaping,s.bD.processBidirectionalText=R.processBidirectionalText,s.bD.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(B,R){this.referrer=R}setImages(B,R,U){this.availableImages[B]=R;for(const Y in this.workerSources[B]){const $=this.workerSources[B][Y];for(const pe in $)$[pe].availableImages=R}U()}setLayers(B,R,U){this.getLayerIndex(B).replace(R),U()}updateLayers(B,R,U){this.getLayerIndex(B).update(R.layers,R.removedIds),U()}loadTile(B,R,U){this.getWorkerSource(B,R.type,R.source).loadTile(R,U)}loadDEMTile(B,R,U){this.getDEMWorkerSource(B,R.source).loadTile(R,U)}reloadTile(B,R,U){this.getWorkerSource(B,R.type,R.source).reloadTile(R,U)}abortTile(B,R,U){this.getWorkerSource(B,R.type,R.source).abortTile(R,U)}removeTile(B,R,U){this.getWorkerSource(B,R.type,R.source).removeTile(R,U)}removeDEMTile(B,R){this.getDEMWorkerSource(B,R.source).removeTile(R)}removeSource(B,R,U){if(!this.workerSources[B]||!this.workerSources[B][R.type]||!this.workerSources[B][R.type][R.source])return;const Y=this.workerSources[B][R.type][R.source];delete this.workerSources[B][R.type][R.source],Y.removeSource!==void 0?Y.removeSource(R,U):U()}loadWorkerSource(B,R,U){try{this.self.importScripts(R.url),U()}catch(Y){U(Y.toString())}}syncRTLPluginState(B,R,U){try{s.bD.setState(R);const Y=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&Y!=null){this.self.importScripts(Y);const $=s.bD.isParsed();U($?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Y}`),$)}}catch(Y){U(Y.toString())}}getAvailableImages(B){let R=this.availableImages[B];return R||(R=[]),R}getLayerIndex(B){let R=this.layerIndexes[B];return R||(R=this.layerIndexes[B]=new C),R}getWorkerSource(B,R,U){return this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][R]||(this.workerSources[B][R]={}),this.workerSources[B][R][U]||(this.workerSources[B][R][U]=new this.workerSourceTypes[R]({send:(Y,$,pe)=>{this.actor.send(Y,$,pe,B)}},this.getLayerIndex(B),this.getAvailableImages(B))),this.workerSources[B][R][U]}getDEMWorkerSource(B,R){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][R]||(this.demWorkerSources[B][R]=new oe),this.demWorkerSources[B][R]}}return s.i()&&(self.worker=new $n(self)),$n}),v(["./shared"],function(s){var C="3.6.2";class I{static testProp(t){if(!I.docStyle)return t[0];for(let n=0;n<t.length;n++)if(t[n]in I.docStyle)return t[n];return t[0]}static create(t,n,u){const p=window.document.createElement(t);return n!==void 0&&(p.className=n),u&&u.appendChild(p),p}static createNS(t,n){return window.document.createElementNS(t,n)}static disableDrag(){I.docStyle&&I.selectProp&&(I.userSelect=I.docStyle[I.selectProp],I.docStyle[I.selectProp]="none")}static enableDrag(){I.docStyle&&I.selectProp&&(I.docStyle[I.selectProp]=I.userSelect)}static setTransform(t,n){t.style[I.transformProp]=n}static addEventListener(t,n,u,p={}){t.addEventListener(n,u,"passive"in p?p:p.capture)}static removeEventListener(t,n,u,p={}){t.removeEventListener(n,u,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",I.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",I.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",I.suppressClickInternal,!0)},0)}static mousePos(t,n){const u=t.getBoundingClientRect();return new s.P(n.clientX-u.left-t.clientLeft,n.clientY-u.top-t.clientTop)}static touchPos(t,n){const u=t.getBoundingClientRect(),p=[];for(let g=0;g<n.length;g++)p.push(new s.P(n[g].clientX-u.left-t.clientLeft,n[g].clientY-u.top-t.clientTop));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}I.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,I.selectProp=I.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),I.transformProp=I.testProp(["transform","WebkitTransform"]);const D={supported:!1,testSupport:function(f){!de&&ie&&(oe?Te(f):q=f)}};let q,ie,de=!1,oe=!1;function Te(f){const t=f.createTexture();f.bindTexture(f.TEXTURE_2D,t);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,ie),f.isContextLost())return;D.supported=!0}catch{}f.deleteTexture(t),de=!0}var me,ye;typeof document<"u"&&(ie=document.createElement("img"),ie.onload=function(){q&&Te(q),q=null,oe=!0},ie.onerror=function(){de=!0,q=null},ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let t,n,u,p;f.resetRequestQueue=()=>{t=[],n=0,u=0,p={}},f.addThrottleControl=A=>{const P=u++;return p[P]=A,P},f.removeThrottleControl=A=>{delete p[A],w()},f.getImage=(A,P,z=!0)=>{D.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const O={requestParameters:A,supportImageRefresh:z,callback:P,cancelled:!1,completed:!1,cancel:()=>{O.completed||O.cancelled||(O.cancelled=!0,O.innerRequest&&(O.innerRequest.cancel(),n--),w())}};return t.push(O),w(),O};const g=A=>{const{requestParameters:P,supportImageRefresh:z,callback:O}=A;return s.e(P,{type:"image"}),(z!==!1||s.i()||s.g(P.url)||P.headers&&!Object.keys(P.headers).reduce((X,G)=>X&&G==="accept",!0)?s.m:k)(P,(X,G,K,j)=>{x(A,O,X,G,K,j)})},x=(A,P,z,O,X,G)=>{z?P(z):O instanceof HTMLImageElement||s.a(O)?P(null,O):O&&((K,j)=>{typeof createImageBitmap=="function"?s.b(K,j):s.d(K,j)})(O,(K,j)=>{K!=null?P(K):j!=null&&P(null,j,{cacheControl:X,expires:G})}),A.cancelled||(A.completed=!0,n--,w())},w=()=>{const A=(()=>{const P=Object.keys(p);let z=!1;if(P.length>0){for(const O of P)if(z=p[O](),z)break}return z})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=n;P<A&&t.length>0;P++){const z=t.shift();if(z.cancelled){P--;continue}const O=g(z);n++,z.innerRequest=O}},k=(A,P)=>{const z=new Image,O=A.url;let X=!1;const G=A.credentials;return G&&G==="include"?z.crossOrigin="use-credentials":(G&&G==="same-origin"||!s.s(O))&&(z.crossOrigin="anonymous"),z.fetchPriority="high",z.onload=()=>{P(null,z),z.onerror=z.onload=null},z.onerror=()=>{X||P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),z.onerror=z.onload=null},z.src=O,{cancel:()=>{X=!0,z.src=""}}}}(me||(me={})),me.resetRequestQueue(),function(f){f.Glyphs="Glyphs",f.Image="Image",f.Source="Source",f.SpriteImage="SpriteImage",f.SpriteJSON="SpriteJSON",f.Style="Style",f.Tile="Tile",f.Unknown="Unknown"}(ye||(ye={}));class W{constructor(t){this._transformRequestFn=t}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeSpriteURL(t,n,u){const p=function(g){const x=g.match(re);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return p.path+=`${n}${u}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(p)}setTransformRequest(t){this._transformRequestFn=t}}const re=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(f){var t=new s.A(3);return t[0]=f[0],t[1]=f[1],t[2]=f[2],t}var xe,Ee=function(f,t,n){return f[0]=t[0]-n[0],f[1]=t[1]-n[1],f[2]=t[2]-n[2],f};xe=new s.A(3),s.A!=Float32Array&&(xe[0]=0,xe[1]=0,xe[2]=0);var Ie=function(f){var t=f[0],n=f[1];return t*t+n*n};function Oe(f){const t=[];if(typeof f=="string")t.push({id:"default",url:f});else if(f&&f.length>0){const n=[];for(const{id:u,url:p}of f){const g=`${u}${p}`;n.indexOf(g)===-1&&(n.push(g),t.push({id:u,url:p}))}}return t}function qe(f,t,n,u,p){if(u)return void f(u);if(p!==Object.values(t).length||p!==Object.values(n).length)return;const g={};for(const x in t){g[x]={};const w=s.h.getImageCanvasContext(n[x]),k=t[x];for(const A in k){const{width:P,height:z,x:O,y:X,sdf:G,pixelRatio:K,stretchX:j,stretchY:ae,content:ge}=k[A];g[x][A]={data:null,pixelRatio:K,sdf:G,stretchX:j,stretchY:ae,content:ge,spriteData:{width:P,height:z,x:O,y:X,context:w}}}}f(null,g)}(function(){var f=new s.A(2);s.A!=Float32Array&&(f[0]=0,f[1]=0)})();class He{constructor(t,n,u,p){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(n,p)}update(t,n,u){const{width:p,height:g}=t,x=!(this.size&&this.size[0]===p&&this.size[1]===g||u),{context:w}=this,{gl:k}=w;if(this.useMipmap=!!(n&&n.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!n||n.premultiply!==!1)),x)this.size=[p,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,t):k.texImage2D(k.TEXTURE_2D,0,this.format,p,g,0,this.format,k.UNSIGNED_BYTE,t.data);else{const{x:A,y:P}=u||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||s.a(t)?k.texSubImage2D(k.TEXTURE_2D,0,A,P,k.RGBA,k.UNSIGNED_BYTE,t):k.texSubImage2D(k.TEXTURE_2D,0,A,P,p,g,k.RGBA,k.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)}bind(t,n,u){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),u!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,u||t),this.filter=t),n!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function be(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ue extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:n,callback:u}of this.requestors)this._notify(n,u);this.requestors=[]}}getImage(t){const n=this.images[t];if(n&&!n.data&&n.spriteData){const u=n.spriteData;n.data=new s.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),n.spriteData=null}return n}addImage(t,n){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,n)&&(this.images[t]=n)}_validate(t,n){let u=!0;const p=n.data||n.spriteData;return this._validateStretch(n.stretchX,p&&p.width)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,p&&p.height)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new s.j(new Error(`Image "${t}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||n<p[1])return!1;u=p[1]}return!0}_validateContent(t,n){if(!t)return!0;if(t.length!==4)return!1;const u=n.spriteData,p=u&&u.width||n.data.width,g=u&&u.height||n.data.height;return!(t[0]<0||p<t[0]||t[1]<0||g<t[1]||t[2]<0||p<t[2]||t[3]<0||g<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,n,u=!0){const p=this.getImage(t);if(u&&(p.data.width!==n.data.width||p.data.height!==n.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=p.version+1,this.images[t]=n,this.updatedImages[t]=!0}removeImage(t){const n=this.images[t];delete this.images[t],delete this.patterns[t],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,n){let u=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(u=!1);this.isLoaded()||u?this._notify(t,n):this.requestors.push({ids:t,callback:n})}_notify(t,n){const u={};for(const p of t){let g=this.getImage(p);g||(this.fire(new s.k("styleimagemissing",{id:p})),g=this.getImage(p)),g?u[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:s.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,u)}getPixelSize(){const{width:t,height:n}=this.atlasImage;return{width:t,height:n}}getPattern(t){const n=this.patterns[t],u=this.getImage(t);if(!u)return null;if(n&&n.position.version===u.version)return n.position;if(n)n.position.version=u.version;else{const p={w:u.data.width+2,h:u.data.height+2,x:0,y:0},g=new s.I(p,u);this.patterns[t]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new He(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:n,h:u}=s.p(t),p=this.atlasImage;p.resize({width:n||1,height:u||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],w=x.x+1,k=x.y+1,A=this.getImage(g).data,P=A.width,z=A.height;s.R.copy(A,p,{x:0,y:0},{x:w,y:k},{width:P,height:z}),s.R.copy(A,p,{x:0,y:z-1},{x:w,y:k-1},{width:P,height:1}),s.R.copy(A,p,{x:0,y:0},{x:w,y:k+z},{width:P,height:1}),s.R.copy(A,p,{x:P-1,y:0},{x:w-1,y:k},{width:1,height:z}),s.R.copy(A,p,{x:0,y:0},{x:w+P,y:k},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const n of t){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const u=this.getImage(n);u||s.w(`Image with ID: "${n}" was not found`),be(u)&&this.updateImage(n,u)}}}const xt=1e20;function Ne(f,t,n,u,p,g,x,w,k){for(let A=t;A<t+u;A++)vt(f,n*g+A,g,p,x,w,k);for(let A=n;A<n+p;A++)vt(f,A*g+t,1,u,x,w,k)}function vt(f,t,n,u,p,g,x){g[0]=0,x[0]=-xt,x[1]=xt,p[0]=f[t];for(let w=1,k=0,A=0;w<u;w++){p[w]=f[t+w*n];const P=w*w;do{const z=g[k];A=(p[w]-p[z]+P-z*z)/(w-z)/2}while(A<=x[k]&&--k>-1);k++,g[k]=w,x[k]=A,x[k+1]=xt}for(let w=0,k=0;w<u;w++){for(;x[k+1]<w;)k++;const A=g[k],P=w-A;f[t+w*n]=p[A]+P*P}}class gt{constructor(t,n){this.requestManager=t,this.localIdeographFontFamily=n,this.entries={}}setURL(t){this.url=t}getGlyphs(t,n){const u=[];for(const p in t)for(const g of t[p])u.push({stack:p,id:g});s.o(u,({stack:p,id:g},x)=>{let w=this.entries[p];w||(w=this.entries[p]={glyphs:{},requests:{},ranges:{}});let k=w.glyphs[g];if(k!==void 0)return void x(null,{stack:p,id:g,glyph:k});if(k=this._tinySDF(w,p,g),k)return w.glyphs[g]=k,void x(null,{stack:p,id:g,glyph:k});const A=Math.floor(g/256);if(256*A>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[A])return void x(null,{stack:p,id:g,glyph:k});if(!this.url)return void x(new Error("glyphsUrl is not set"));let P=w.requests[A];P||(P=w.requests[A]=[],gt.loadGlyphRange(p,A,this.url,this.requestManager,(z,O)=>{if(O){for(const X in O)this._doesCharSupportLocalGlyph(+X)||(w.glyphs[+X]=O[+X]);w.ranges[A]=!0}for(const X of P)X(z,O);delete w.requests[A]})),P.push((z,O)=>{z?x(z):O&&x(null,{stack:p,id:g,glyph:O[g]||null})})},(p,g)=>{if(p)n(p);else if(g){const x={};for(const{stack:w,id:k,glyph:A}of g)(x[w]||(x[w]={}))[k]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};n(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](t)||s.u["Hangul Syllables"](t)||s.u.Hiragana(t)||s.u.Katakana(t))}_tinySDF(t,n,u){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let g=t.tinySDF;if(!g){let w="400";/bold/i.test(n)?w="900":/medium/i.test(n)?w="500":/light/i.test(n)&&(w="200"),g=t.tinySDF=new gt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:p,fontWeight:w})}const x=g.draw(String.fromCharCode(u));return{id:u,bitmap:new s.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}gt.loadGlyphRange=function(f,t,n,u,p){const g=256*t,x=g+255,w=u.transformRequest(n.replace("{fontstack}",f).replace("{range}",`${g}-${x}`),ye.Glyphs);s.l(w,(k,A)=>{if(k)p(k);else if(A){const P={};for(const z of s.n(A))P[z.id]=z;p(null,P)}})},gt.TinySDF=class{constructor({fontSize:f=24,buffer:t=3,radius:n=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=n;const w=this.size=f+4*t,k=this._createCanvas(w),A=this.ctx=k.getContext("2d",{willReadFrequently:!0});A.font=`${x} ${g} ${f}px ${p}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const t=document.createElement("canvas");return t.width=t.height=f,t}draw(f){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(f),x=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-p))),k=Math.min(this.size-this.buffer,x+Math.ceil(u)),A=w+2*this.buffer,P=k+2*this.buffer,z=Math.max(A*P,0),O=new Uint8ClampedArray(z),X={data:O,width:A,height:P,glyphWidth:w,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(w===0||k===0)return X;const{ctx:G,buffer:K,gridInner:j,gridOuter:ae}=this;G.clearRect(K,K,w,k),G.fillText(f,K,K+x);const ge=G.getImageData(K,K,w,k);ae.fill(xt,0,z),j.fill(0,0,z);for(let Q=0;Q<k;Q++)for(let ce=0;ce<w;ce++){const Se=ge.data[4*(Q*w+ce)+3]/255;if(Se===0)continue;const ke=(Q+K)*A+ce+K;if(Se===1)ae[ke]=0,j[ke]=xt;else{const Le=.5-Se;ae[ke]=Le>0?Le*Le:0,j[ke]=Le<0?Le*Le:0}}Ne(ae,0,0,A,P,A,this.f,this.v,this.z),Ne(j,K,K,w,k,A,this.f,this.v,this.z);for(let Q=0;Q<z;Q++){const ce=Math.sqrt(ae[Q])-Math.sqrt(j[Q]);O[Q]=Math.round(255-255*(ce/this.radius+this.cutoff))}return X}};class dt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(t,n){return s.z(t.expression.evaluate(n))}interpolate(t,n,u){return{x:s.B.number(t.x,n.x,u),y:s.B.number(t.y,n.y,u),z:s.B.number(t.z,n.z,u)}}}let Ft;class sr extends s.E{constructor(t){super(),Ft=Ft||new s.r({anchor:new s.D(s.v.light.anchor),position:new dt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Ft),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n={}){if(!this._validate(s.t,t,n))for(const u in t){const p=t[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),p):this._transitionable.setValue(u,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&s.x(this,t.call(s.y,s.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Ri{constructor(t,n){this.width=t,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,n){const u=t.join(",")+String(n);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(t,n)),this.dashEntry[u]}getDashRanges(t,n,u){const p=[];let g=t.length%2==1?-t[t.length-1]*u:0,x=t[0]*u,w=!0;p.push({left:g,right:x,isDash:w,zeroLength:t[0]===0});let k=t[0];for(let A=1;A<t.length;A++){w=!w;const P=t[A];g=k*u,k+=P,x=k*u,p.push({left:g,right:x,isDash:w,zeroLength:P===0})}return p}addRoundDash(t,n,u){const p=n/2;for(let g=-u;g<=u;g++){const x=this.width*(this.nextRow+u+g);let w=0,k=t[w];for(let A=0;A<this.width;A++){A/k.right>1&&(k=t[++w]);const P=Math.abs(A-k.left),z=Math.abs(A-k.right),O=Math.min(P,z);let X;const G=g/u*(p+1);if(k.isDash){const K=p-Math.abs(G);X=Math.sqrt(O*O+K*K)}else X=p-Math.sqrt(O*O+G*G);this.data[x+A]=Math.max(0,Math.min(255,X+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const k=t[w],A=t[w+1];k.zeroLength?t.splice(w,1):A&&A.isDash===k.isDash&&(A.left=k.left,t.splice(w,1))}const n=t[0],u=t[t.length-1];n.isDash===u.isDash&&(n.left=u.left-this.width,u.right=n.right+this.width);const p=this.width*this.nextRow;let g=0,x=t[g];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++g]);const k=Math.abs(w-x.left),A=Math.abs(w-x.right),P=Math.min(k,A);this.data[p+w]=Math.max(0,Math.min(255,(x.isDash?P:-P)+128))}}addDash(t,n){const u=n?7:0,p=2*u+1;if(this.nextRow+p>this.height)return s.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<t.length;w++)g+=t[w];if(g!==0){const w=this.width/g,k=this.getDashRanges(t,this.width,w);n?this.addRoundDash(k,w,u):this.addRegularDash(k)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(t){const n=t.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}class Jt{constructor(t,n,u){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let g=0;g<p.length;g++){const x=new s.C(p[g],n,u);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,n,u){s.o(this.actors,(p,g)=>{p.send(t,n,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Ut(f,t,n){const u=function(p,g){if(p)return n(p);if(g){const x=s.F(s.e(g,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),n(null,x)}};return f.url?s.f(t.transformRequest(f.url,ye.Source),u):s.h.frame(()=>u(null,f))}class Rt{constructor(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}setSouthWest(t){return this._sw=t instanceof s.L?new s.L(t.lng,t.lat):s.L.convert(t),this}extend(t){const n=this._sw,u=this._ne;let p,g;if(t instanceof s.L)p=t,g=t;else{if(!(t instanceof Rt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Rt.convert(t)):this.extend(s.L.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(s.L.convert(t)):this;if(p=t._sw,g=t._ne,!p||!g)return this}return n||u?(n.lng=Math.min(p.lng,n.lng),n.lat=Math.min(p.lat,n.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new s.L(p.lng,p.lat),this._ne=new s.L(g.lng,g.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:n,lat:u}=s.L.convert(t);let p=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(t){return t instanceof Rt?t:t&&new Rt(t)}static fromLngLat(t,n=0){const u=360*n/40075017,p=u/Math.cos(Math.PI/180*t.lat);return new Rt(new s.L(t.lng-p,t.lat-u),new s.L(t.lng+p,t.lat+u))}}class fi{constructor(t,n,u){this.bounds=Rt.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const n=Math.pow(2,t.z),u=Math.floor(s.G(this.bounds.getWest())*n),p=Math.floor(s.H(this.bounds.getNorth())*n),g=Math.ceil(s.G(this.bounds.getEast())*n),x=Math.ceil(s.H(this.bounds.getSouth())*n);return t.x>=u&&t.x<g&&t.y>=p&&t.y<x}}class Yi extends s.E{constructor(t,n,u,p){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ut(this._options,this.map._requestManager,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),g?this.fire(new s.j(g)):x&&(s.e(this,x),x.bounds&&(this.tileBounds=new fi(x.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(n,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,ye.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,w){return delete t.request,t.aborted?n(null):x&&x.status!==404?n(x):(w&&w.resourceTiming&&(t.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&t.setExpiryData(w),t.loadVectorData(w,this.map.painter),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",p,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",p,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Ge extends s.E{constructor(t,n,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},n),s.e(this,s.F(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Ut(this._options,this.map._requestManager,(t,n)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new s.j(t)):n&&(s.e(this,n),n.bounds&&(this.tileBounds=new fi(n.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}serialize(){return s.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=me.getImage(this.map._requestManager.transformRequest(u,ye.Tile),(p,g,x)=>{if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(p)t.state="errored",n(p);else if(g){this.map._refreshExpiredTiles&&x&&t.setExpiryData(x);const w=this.map.painter.context,k=w.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new He(w,g,k.RGBA,{useMipmap:!0}),t.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",n(null)}},this.map._refreshExpiredTiles)}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n()}unloadTile(t,n){t.texture&&this.map.painter.saveTileTexture(t.texture),n()}hasTransition(){return!1}}class Ct extends Ge{constructor(t,n,u,p){super(t,n,u,p),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,ye.Tile);function g(x,w){x&&(t.state="errored",n(x)),w&&(t.dem=w,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",n(null))}t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.request=me.getImage(p,(x,w,k)=>s._(this,void 0,void 0,function*(){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(x)t.state="errored",n(x);else if(w){this.map._refreshExpiredTiles&&t.setExpiryData(k);const A=s.a(w)&&s.J()?w:yield function(z){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const O=z.width+2,X=z.height+2;try{return new s.R({width:O,height:X},yield s.M(z,-1,-1,O,X))}catch{}}return s.h.getImageData(z,1)})}(w),P={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",P,g))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(t){const n=t.canonical,u=Math.pow(2,n.z),p=(n.x-1+u)%u,g=n.x===0?t.wrap-1:t.wrap,x=(n.x+1+u)%u,w=n.x+1===u?t.wrap+1:t.wrap,k={};return k[new s.O(t.overscaledZ,g,n.z,p,n.y).key]={backfilled:!1},k[new s.O(t.overscaledZ,w,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(k[new s.O(t.overscaledZ,g,n.z,p,n.y-1).key]={backfilled:!1},k[new s.O(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},k[new s.O(t.overscaledZ,w,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<u&&(k[new s.O(t.overscaledZ,g,n.z,p,n.y+1).key]={backfilled:!1},k[new s.O(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},k[new s.O(t.overscaledZ,w,n.z,x,n.y+1).key]={backfilled:!1}),k}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Je extends s.E{constructor(t,n,u,p){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=u.getActor(),this.setEventedParent(p),this._data=n.data,this._options=s.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const g=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*g,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*g,extent:s.N,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.N,radius:(n.clusterRadius||50)*g,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},n),this}getClusterChildren(t,n){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},n),this}getClusterLeaves(t,n,u,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:n,offset:u},p),this}_updateWorkerData(t){const n=s.e({},this.workerOptions);t?n.dataDiff=t:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),ye.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,n,(u,p)=>{if(this._pendingLoads--,this._removed||p&&p.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let g=null;if(p&&p.resourceTiming&&p.resourceTiming[this.id]&&(g=p.resourceTiming[this.id].slice(0)),u)return void this.fire(new s.j(u));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&s.e(x,{resourceTiming:g}),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(t,n){const u=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(u,p,(g,x)=>(delete t.request,t.unloadVectorData(),t.aborted?n(null):g?n(g):(t.loadVectorData(x,this.map.painter,u==="reloadTile"),n(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var mi=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ht extends s.E{constructor(t,n,u,p){super(),this.load=(g,x)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=me.getImage(this.map._requestManager.transformRequest(this.url,ye.Image),(w,k)=>{this._request=null,this._loaded=!0,w?this.fire(new s.j(w)):k&&(this.image=k,g&&(this.coordinates=g),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const g=this.map.painter.context,x=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,mi.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new He(g,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const k in this.tiles){const A=this.tiles[k];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=u,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=n}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const n=t.map(s.U.fromLngLat);this.tileID=function(p){let g=1/0,x=1/0,w=-1/0,k=-1/0;for(const O of p)g=Math.min(g,O.x),x=Math.min(x,O.y),w=Math.max(w,O.x),k=Math.max(k,O.y);const A=Math.max(w-g,k-x),P=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),z=Math.pow(2,P);return new s.W(P,Math.floor((g+w)/2*z),Math.floor((x+k)/2*z))}(n),this.minzoom=this.maxzoom=this.tileID.z;const u=n.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(u[0].x,u[0].y,0,0),this._boundsArray.emplaceBack(u[1].x,u[1].y,s.N,0),this._boundsArray.emplaceBack(u[3].x,u[3].y,0,s.N),this._boundsArray.emplaceBack(u[2].x,u[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,n){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},n(null)):(t.state="errored",n(null))}hasTransition(){return!1}}class wi extends Ht{constructor(t,n,u,p){super(t,n,u,p),this.load=()=>{this._loaded=!1;const g=this.options;this.urls=[];for(const x of g.urls)this.urls.push(this.map._requestManager.transformRequest(x,ye.Source).url);s.X(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new s.j(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,x=g.gl;this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,mi.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new He(g,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const k in this.tiles){const A=this.tiles[k];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=n}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class Zi extends Ht{constructor(t,n,u,p){super(t,n,u,p),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,mi.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new He(x,this.canvas,w.RGBA,{premultiply:!0});let k=!1;for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,k=!0)}k&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${t}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Xe={},Ti=f=>{switch(f){case"geojson":return Je;case"image":return Ht;case"raster":return Ge;case"raster-dem":return Ct;case"vector":return Yi;case"video":return wi;case"canvas":return Zi}return Xe[f]};function Gi(f,t){const n=s.Z();return s.$(n,n,[1,1,0]),s.a0(n,n,[.5*f.width,.5*f.height,1]),s.a1(n,n,f.calculatePosMatrix(t.toUnwrapped()))}function rn(f,t,n,u,p,g){const x=function(z,O,X){if(z)for(const G of z){const K=O[G];if(K&&K.source===X&&K.type==="fill-extrusion")return!0}else for(const G in O){const K=O[G];if(K.source===X&&K.type==="fill-extrusion")return!0}return!1}(p&&p.layers,t,f.id),w=g.maxPitchScaleFactor(),k=f.tilesIn(u,w,x);k.sort(Mn);const A=[];for(const z of k)A.push({wrappedTileID:z.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(t,n,f._state,z.queryGeometry,z.cameraQueryGeometry,z.scale,p,g,w,Gi(f.transform,z.tileID))});const P=function(z){const O={},X={};for(const G of z){const K=G.queryResults,j=G.wrappedTileID,ae=X[j]=X[j]||{};for(const ge in K){const Q=K[ge],ce=ae[ge]=ae[ge]||{},Se=O[ge]=O[ge]||[];for(const ke of Q)ce[ke.featureIndex]||(ce[ke.featureIndex]=!0,Se.push(ke))}}return O}(A);for(const z in P)P[z].forEach(O=>{const X=O.feature,G=f.getFeatureState(X.layer["source-layer"],X.id);X.source=X.layer.source,X.layer["source-layer"]&&(X.sourceLayer=X.layer["source-layer"]),X.state=G});return P}function Mn(f,t){const n=f.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}class zr{constructor(t,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=s.a2(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const n=t+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,n,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,g){const x={};if(!g)return x;for(const w of p){const k=w.layerIds.map(A=>g.getLayer(A)).filter(Boolean);if(k.length!==0){w.layers=k,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(A=>k.filter(P=>P.id===A)[0]));for(const A of k)x[A.id]=w}}return x}(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.a4){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof s.a4&&g.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(p).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(t)}const n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new He(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new He(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,n,u,p,g,x,w,k,A,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:P,transform:k,params:w,queryPadding:this.queryPadding*A},t,n,u):{}}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),g=n&&n.sourceLayer?n.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const w=s.a6(n&&n.filter),{z:k,x:A,y:P}=this.tileID.canonical,z={z:k,x:A,y:P};for(let O=0;O<x.length;O++){const X=x.feature(O);if(w.needGeometry){const j=s.a7(X,!0);if(!w.filter(new s.a8(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!w.filter(new s.a8(this.tileID.overscaledZ),X))continue;const G=u.getId(X,g),K=new s.a9(X,k,A,P,G);K.tile=z,t.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=s.aa(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const g=this.expirationTime-n;g?this.expirationTime=u+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!n.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",w=u[x],k=t[x];if(!w||!k||Object.keys(k).length===0)continue;g.update(k,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=n&&n.style&&n.style.getLayer(p);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.h.now()+t}setDependencies(t,n){const u={};for(const p of n)u[p]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const p=this.dependencies[u];if(p){for(const g of n)if(p[g])return!0}}return!1}}class gr{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:n,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},u)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const u=t.wrapped().key,p=n===void 0?0:this.data[u].indexOf(n),g=this.data[u][p];return this.data[u].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||n.push(p);for(const u of n)this.remove(u.value.tileID,u)}}class Ce{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const p=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},s.e(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])u[g]||(this.deletedStates[t][p][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const p=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,n){const u=String(n),p=s.e({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][n];if(g===null)return{};for(const x in g)delete p[x]}return p}initializeTileState(t,n){t.setFeatureState(this.state,n)}coalesceChanges(t,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),s.e(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];u[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const w of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][w];g[x]=this.state[p][x]}u[p]=u[p]||{},s.e(u[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].setFeatureState(u,n)}}class vr extends s.E{constructor(t,n,u){super(),this.id=t,this.dispatcher=u,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((p,g,x,w)=>{const k=new(Ti(g.type))(p,g,x,w);if(k.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${k.id}`);return k})(t,n,u,this),this._tiles={},this._cache=new gr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ce,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const n=this._tiles[t];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,n){return this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new s.k("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(t),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Lr).map(t=>t.key)}getRenderableIds(t){const n=[];for(const u in this._tiles)this._isIdRenderable(u,t)&&n.push(this._tiles[u]);return t?n.sort((u,p)=>{const g=u.tileID,x=p.tileID,w=new s.P(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),k=new s.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||k.y-w.y||k.x-w.x}).map(u=>u.tileID.key):n.map(u=>u.tileID).sort(Lr).map(u=>u.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,n){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,t,n)))}_tileLoaded(t,n,u,p){if(p)return t.state="errored",void(p.status!==404?this._source.fire(new s.j(p,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=s.h.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const n=this.getRenderableIds();for(let p=0;p<n.length;p++){const g=n[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);u(t,x),u(x,t)}}function u(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const w=g.tileID.canonical.y-p.tileID.canonical.y,k=Math.pow(2,p.tileID.canonical.z),A=g.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,w),p.neighboringTiles&&p.neighboringTiles[A]&&(p.neighboringTiles[A].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,u,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>u)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(w=A)}let k=w;for(;k.overscaledZ>n;)if(k=k.scaledTo(k.overscaledZ-1),t[k.key]){p[w.key]=w;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=t.overscaledZ-1;u>=n;u--){const p=t.scaledTo(u),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const n=Math.ceil(t.width/this._source.tileSize)+1,u=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(n*u*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const u={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),u[g.tileID.key]=g}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(t,n){if(this.transform=t,this.terrain=n,!this._sourceLoaded||this._paused)return;let u;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new s.O(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(u=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(u=u.filter(P=>this._source.hasTile(P)))):u=[];const p=t.coveringZoomLevel(this._source),g=Math.max(p-vr.maxOverzooming,this._source.minzoom),x=Math.max(p+vr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const z of u)if(z.canonical.z>this._source.minzoom){const O=z.scaledTo(z.canonical.z-1);P[O.key]=O;const X=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));P[X.key]=X}u=u.concat(Object.values(P))}const w=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,p);if(ai(this._source.type)){const P={},z={},O=Object.keys(k),X=s.h.now();for(const G of O){const K=k[G],j=this._tiles[G];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=X)continue;const ae=this.findLoadedParent(K,g);ae&&(this._addTile(ae.tileID),P[ae.tileID.key]=ae.tileID),z[G]=K}this._retainLoadedChildren(z,p,x,k);for(const G in P)k[G]||(this._coveredTiles[G]=!0,k[G]=P[G]);if(n){const G={},K={};for(const j of u)this._tiles[j.key].hasData()?G[j.key]=j:K[j.key]=j;for(const j in K){const ae=K[j].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(G[ae[0].key]=k[ae[0].key]=ae[0],G[ae[1].key]=k[ae[1].key]=ae[1],G[ae[2].key]=k[ae[2].key]=ae[2],G[ae[3].key]=k[ae[3].key]=ae[3],delete K[j])}for(const j in K){const ae=this.findLoadedParent(K[j],this._source.minzoom);if(ae){G[ae.tileID.key]=k[ae.tileID.key]=ae.tileID;for(const ge in G)G[ge].isChildOf(ae.tileID)&&delete G[ge]}}for(const j in this._tiles)G[j]||(this._coveredTiles[j]=!0)}}for(const P in k)this._tiles[P].clearFadeHold();const A=s.ab(this._tiles,k);for(const P of A){const z=this._tiles[P];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,n){const u={},p={},g=Math.max(n-vr.maxOverzooming,this._source.minzoom),x=Math.max(n+vr.maxUnderzooming,this._source.minzoom),w={};for(const k of t){const A=this._addTile(k);u[k.key]=k,A.hasData()||n<this._source.maxzoom&&(w[k.key]=k)}this._retainLoadedChildren(w,n,x,u);for(const k of t){let A=this._tiles[k.key];if(A.hasData())continue;if(n+1>this._source.maxzoom){const z=k.children(this._source.maxzoom)[0],O=this.getTile(z);if(O&&O.hasData()){u[z.key]=z;continue}}else{const z=k.children(this._source.maxzoom);if(u[z[0].key]&&u[z[1].key]&&u[z[2].key]&&u[z[3].key])continue}let P=A.wasRequested();for(let z=k.overscaledZ-1;z>=g;--z){const O=k.scaledTo(z);if(p[O.key])break;if(p[O.key]=!0,A=this.getTile(O),!A&&P&&(A=this._addTile(O)),A){const X=A.hasData();if((P||X)&&(u[O.key]=O),P=A.wasRequested(),X)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}n.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;p=g}for(const g of n)this._loadedParentTiles[g]=u}}_addTile(t){let n=this._tiles[t.key];if(n)return n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const u=n;return n||(n=new zr(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))),n.uses++,this._tiles[t.key]=n,u||this._source.fire(new s.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,n,u){const p=[],g=this.transform;if(!g)return p;const x=u?g.getCameraQueryGeometry(t):t,w=t.map(G=>g.pointCoordinate(G,this.terrain)),k=x.map(G=>g.pointCoordinate(G,this.terrain)),A=this.getIds();let P=1/0,z=1/0,O=-1/0,X=-1/0;for(const G of k)P=Math.min(P,G.x),z=Math.min(z,G.y),O=Math.max(O,G.x),X=Math.max(X,G.y);for(let G=0;G<A.length;G++){const K=this._tiles[A[G]];if(K.holdingForFade())continue;const j=K.tileID,ae=Math.pow(2,g.zoom-K.tileID.overscaledZ),ge=n*K.queryPadding*s.N/K.tileSize/ae,Q=[j.getTilePoint(new s.U(P,z)),j.getTilePoint(new s.U(O,X))];if(Q[0].x-ge<s.N&&Q[0].y-ge<s.N&&Q[1].x+ge>=0&&Q[1].y+ge>=0){const ce=w.map(ke=>j.getTilePoint(ke)),Se=k.map(ke=>j.getTilePoint(ke));p.push({tile:K,tileID:j,queryGeometry:ce,cameraQueryGeometry:Se,scale:ae})}}return p}getVisibleCoordinates(t){const n=this.getRenderableIds(t).map(u=>this._tiles[u].tileID);for(const u of n)u.posMatrix=this.transform.calculatePosMatrix(u.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(ai(this._source.type)){const t=s.h.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=t)return!0}return!1}setFeatureState(t,n,u){this._state.updateState(t=t||"_geojsonTileLayer",n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,u)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,u){const p=this._tiles[t];p&&p.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u in this._tiles)this._tiles[u].hasDependency(t,n)&&this._reloadTile(u,"reloading");this._cache.filter(u=>!u.hasDependency(t,n))}}function Lr(f,t){const n=Math.abs(2*f.wrap)-+(f.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||u-n||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function ai(f){return f==="raster"||f==="image"||f==="video"}vr.maxOverzooming=10,vr.maxUnderzooming=3;const Ot="mapboxgl_preloaded_worker_pool";class nn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<nn.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}const Cn=Math.floor(s.h.hardwareConcurrency/2);let tr;function Oi(){return tr||(tr=new nn),tr}nn.workerCount=s.ac(globalThis)?Math.max(Math.min(Cn,3),1):1;class ii{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.ad(t,0,1);let n=1,u=this._distances[n];const p=t*this.paddedLength+this.padding;for(;u<p&&n<this._distances.length;)u=this._distances[++n];const g=n-1,x=this._distances[g],w=u-x,k=w>0?(p-x)/w:0;return this.points[g].mult(1-k).add(this.points[n].mult(k))}}function Ni(f,t){let n=!0;return f==="always"||f!=="never"&&t!=="never"||(n=!1),n}class xo{constructor(t,n,u){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,p,g){this._forEachCell(n,u,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,n,u,p){this._forEachCell(n-p,u-p,n+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,n,u,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,n,u,p,g,x){this.circleCells[g].push(x)}_query(t,n,u,p,g,x,w){if(u<0||t>this.width||p<0||n>this.height)return[];const k=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=p){if(g)return[{key:null,x1:t,y1:n,x2:u,y2:p}];for(let A=0;A<this.boxKeys.length;A++)k.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],z=this.circles[3*A+1],O=this.circles[3*A+2];k.push({key:this.circleKeys[A],x1:P-O,y1:z-O,x2:P+O,y2:z+O})}}else this._forEachCell(t,n,u,p,this._queryCell,k,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},w);return k}query(t,n,u,p){return this._query(t,n,u,p,!1,null)}hitTest(t,n,u,p,g,x){return this._query(t,n,u,p,!0,g,x).length>0}hitTestCircle(t,n,u,p,g){const x=t-u,w=t+u,k=n-u,A=n+u;if(w<0||x>this.width||A<0||k>this.height)return!1;const P=[];return this._forEachCell(x,k,w,A,this._queryCellCircle,P,{hitTest:!0,overlapMode:p,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},g),P.length>0}_queryCell(t,n,u,p,g,x,w,k){const{seenUids:A,hitTest:P,overlapMode:z}=w,O=this.boxCells[g];if(O!==null){const G=this.bboxes;for(const K of O)if(!A.box[K]){A.box[K]=!0;const j=4*K,ae=this.boxKeys[K];if(t<=G[j+2]&&n<=G[j+3]&&u>=G[j+0]&&p>=G[j+1]&&(!k||k(ae))&&(!P||!Ni(z,ae.overlapMode))&&(x.push({key:ae,x1:G[j],y1:G[j+1],x2:G[j+2],y2:G[j+3]}),P))return!0}}const X=this.circleCells[g];if(X!==null){const G=this.circles;for(const K of X)if(!A.circle[K]){A.circle[K]=!0;const j=3*K,ae=this.circleKeys[K];if(this._circleAndRectCollide(G[j],G[j+1],G[j+2],t,n,u,p)&&(!k||k(ae))&&(!P||!Ni(z,ae.overlapMode))){const ge=G[j],Q=G[j+1],ce=G[j+2];if(x.push({key:ae,x1:ge-ce,y1:Q-ce,x2:ge+ce,y2:Q+ce}),P)return!0}}}return!1}_queryCellCircle(t,n,u,p,g,x,w,k){const{circle:A,seenUids:P,overlapMode:z}=w,O=this.boxCells[g];if(O!==null){const G=this.bboxes;for(const K of O)if(!P.box[K]){P.box[K]=!0;const j=4*K,ae=this.boxKeys[K];if(this._circleAndRectCollide(A.x,A.y,A.radius,G[j+0],G[j+1],G[j+2],G[j+3])&&(!k||k(ae))&&!Ni(z,ae.overlapMode))return x.push(!0),!0}}const X=this.circleCells[g];if(X!==null){const G=this.circles;for(const K of X)if(!P.circle[K]){P.circle[K]=!0;const j=3*K,ae=this.circleKeys[K];if(this._circlesCollide(G[j],G[j+1],G[j+2],A.x,A.y,A.radius)&&(!k||k(ae))&&!Ni(z,ae.overlapMode))return x.push(!0),!0}}}_forEachCell(t,n,u,p,g,x,w,k){const A=this._convertToXCellCoord(t),P=this._convertToYCellCoord(n),z=this._convertToXCellCoord(u),O=this._convertToYCellCoord(p);for(let X=A;X<=z;X++)for(let G=P;G<=O;G++)if(g.call(this,t,n,u,p,this.xCellCount*G+X,x,w,k))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,p,g,x){const w=p-t,k=g-n,A=u+x;return A*A>w*w+k*k}_circleAndRectCollide(t,n,u,p,g,x,w){const k=(x-p)/2,A=Math.abs(t-(p+k));if(A>k+u)return!1;const P=(w-g)/2,z=Math.abs(n-(g+P));if(z>P+u)return!1;if(A<=k||z<=P)return!0;const O=A-k,X=z-P;return O*O+X*X<=u*u}}function Ye(f,t,n,u,p){const g=s.Z();return t?(s.a0(g,g,[1/p,1/p,1]),n||s.ae(g,g,u.angle)):s.a1(g,u.labelPlaneMatrix,f),g}function Fn(f,t,n,u,p){if(t){const g=s.af(f);return s.a0(g,g,[p,p,1]),n||s.ae(g,g,-u.angle),g}return u.glCoordMatrix}function Vi(f,t,n){let u;n?(u=[f.x,f.y,n(f.x,f.y),1],s.ag(u,u,t)):(u=[f.x,f.y,0,1],Y(u,u,t));const p=u[3];return{point:new s.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p}}function wo(f,t){return .5+f/t*.5}function Jn(f,t){const n=f[0]/f[3],u=f[1]/f[3];return n>=-t[0]&&n<=t[0]&&u>=-t[1]&&u<=t[1]}function Qe(f,t,n,u,p,g,x,w,k,A){const P=u?f.textSizeData:f.iconSizeData,z=s.ah(P,n.transform.zoom),O=[256/n.width*2+1,256/n.height*2+1],X=u?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;X.clear();const G=f.lineVertexArray,K=u?f.text.placedSymbolArray:f.icon.placedSymbolArray,j=n.transform.width/n.transform.height;let ae=!1;for(let ge=0;ge<K.length;ge++){const Q=K.get(ge);if(Q.hidden||Q.writingMode===s.ai.vertical&&!ae){U(Q.numGlyphs,X);continue}let ce;if(ae=!1,A?(ce=[Q.anchorX,Q.anchorY,A(Q.anchorX,Q.anchorY),1],s.ag(ce,ce,t)):(ce=[Q.anchorX,Q.anchorY,0,1],Y(ce,ce,t)),!Jn(ce,O)){U(Q.numGlyphs,X);continue}const Se=wo(n.transform.cameraToCenterDistance,ce[3]),ke=s.aj(P,z,Q),Le=x?ke/Se:ke*Se,je=new s.P(Q.anchorX,Q.anchorY),Ve=Vi(je,p,A).point,We={projections:{},offsets:{}},ft=Dr(Q,Le,!1,w,t,p,g,f.glyphOffsetArray,G,X,Ve,je,We,j,k,A);ae=ft.useVertical,(ft.notEnoughRoom||ae||ft.needsFlipping&&Dr(Q,Le,!0,w,t,p,g,f.glyphOffsetArray,G,X,Ve,je,We,j,k,A).notEnoughRoom)&&U(Q.numGlyphs,X)}u?f.text.dynamicLayoutVertexBuffer.updateData(X):f.icon.dynamicLayoutVertexBuffer.updateData(X)}function jt(f,t,n,u,p,g,x,w,k,A,P,z,O){const X=w.glyphStartIndex+w.numGlyphs,G=w.lineStartIndex,K=w.lineStartIndex+w.lineLength,j=t.getoffsetX(w.glyphStartIndex),ae=t.getoffsetX(X-1),ge=B(f*j,n,u,p,g,x,w.segment,G,K,k,A,P,z,O);if(!ge)return null;const Q=B(f*ae,n,u,p,g,x,w.segment,G,K,k,A,P,z,O);return Q?{first:ge,last:Q}:null}function zt(f,t,n,u){return f===s.ai.horizontal&&Math.abs(n.y-t.y)>Math.abs(n.x-t.x)*u?{useVertical:!0}:(f===s.ai.vertical?t.y<n.y:t.x>n.x)?{needsFlipping:!0}:null}function Dr(f,t,n,u,p,g,x,w,k,A,P,z,O,X,G,K){const j=t/24,ae=f.lineOffsetX*j,ge=f.lineOffsetY*j;let Q;if(f.numGlyphs>1){const ce=f.glyphStartIndex+f.numGlyphs,Se=f.lineStartIndex,ke=f.lineStartIndex+f.lineLength,Le=jt(j,w,ae,ge,n,P,z,f,k,g,O,G,K);if(!Le)return{notEnoughRoom:!0};const je=Vi(Le.first.point,x,K).point,Ve=Vi(Le.last.point,x,K).point;if(u&&!n){const We=zt(f.writingMode,je,Ve,X);if(We)return We}Q=[Le.first];for(let We=f.glyphStartIndex+1;We<ce-1;We++)Q.push(B(j*w.getoffsetX(We),ae,ge,n,P,z,f.segment,Se,ke,k,g,O,G,K));Q.push(Le.last)}else{if(u&&!n){const Se=Vi(z,p,K).point,ke=f.lineStartIndex+f.segment+1,Le=new s.P(k.getx(ke),k.gety(ke)),je=Vi(Le,p,K),Ve=je.signedDistanceFromCamera>0?je.point:Rn(z,Le,Se,1,p,K),We=zt(f.writingMode,Se,Ve,X);if(We)return We}const ce=B(j*w.getoffsetX(f.glyphStartIndex),ae,ge,n,P,z,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,k,g,O,G,K);if(!ce)return{notEnoughRoom:!0};Q=[ce]}for(const ce of Q)s.ak(A,ce.point,ce.angle);return{}}function Rn(f,t,n,u,p,g){const x=Vi(f.add(f.sub(t)._unit()),p,g).point,w=n.sub(x);return n.add(w._mult(u/w.mag()))}function Bt(f,t){const{projectionCache:n,lineVertexArray:u,labelPlaneMatrix:p,tileAnchorPoint:g,distanceFromAnchor:x,getElevation:w,previousVertex:k,direction:A,absOffsetX:P}=t;if(n.projections[f])return n.projections[f];const z=new s.P(u.getx(f),u.gety(f)),O=Vi(z,p,w);if(O.signedDistanceFromCamera>0)return n.projections[f]=O.point,O.point;const X=f-A;return Rn(x===0?g:new s.P(u.getx(X),u.gety(X)),z,k,P-x+1,p,w)}function $n(f,t,n){return f._unit()._perp()._mult(t*n)}function H(f,t,n,u,p,g,x,w){const{projectionCache:k,direction:A}=w;if(k.offsets[f])return k.offsets[f];const P=n.add(t);if(f+A<u||f+A>=p)return k.offsets[f]=P,P;const z=Bt(f+A,w),O=$n(z.sub(n),x,A),X=n.add(O),G=z.add(O);return k.offsets[f]=s.al(g,P,X,G)||P,k.offsets[f]}function B(f,t,n,u,p,g,x,w,k,A,P,z,O,X){const G=u?f-t:f+t;let K=G>0?1:-1,j=0;u&&(K*=-1,j=Math.PI),K<0&&(j+=Math.PI);let ae,ge,Q=K>0?w+x:w+x+1,ce=p,Se=p,ke=0,Le=0;const je=Math.abs(G),Ve=[];let We;for(;ke+Le<=je;){if(Q+=K,Q<w||Q>=k)return null;ke+=Le,Se=ce,ge=ae;const tt={projectionCache:z,lineVertexArray:A,labelPlaneMatrix:P,tileAnchorPoint:g,distanceFromAnchor:ke,getElevation:X,previousVertex:Se,direction:K,absOffsetX:je};if(ce=Bt(Q,tt),n===0)Ve.push(Se),We=ce.sub(Se);else{let Mt;const _t=ce.sub(Se);Mt=_t.mag()===0?$n(Bt(Q+K,tt).sub(ce),n,K):$n(_t,n,K),ge||(ge=Se.add(Mt)),ae=H(Q,Mt,ce,w,k,ge,n,tt),Ve.push(ge),We=ae.sub(ge)}Le=We.mag()}const ft=We._mult((je-ke)/Le)._add(ge||Se),Kt=j+Math.atan2(ce.y-Se.y,ce.x-Se.x);return Ve.push(ft),{point:ft,angle:O?Kt:0,path:Ve}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function U(f,t){for(let n=0;n<f;n++){const u=t.length;t.resize(u+4),t.float32.set(R,3*u)}}function Y(f,t,n){const u=t[0],p=t[1];return f[0]=n[0]*u+n[4]*p+n[12],f[1]=n[1]*u+n[5]*p+n[13],f[3]=n[3]*u+n[7]*p+n[15],f}const $=100;class pe{constructor(t,n=new xo(t.width+200,t.height+200,25),u=new xo(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=u,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$,this.screenBottomBoundary=t.height+$,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,n,u,p,g,x){const w=this.projectAndGetPerspectiveRatio(p,t.anchorPointX,t.anchorPointY,x),k=u*w.perspectiveRatio,A=t.x1*k+w.point.x,P=t.y1*k+w.point.y,z=t.x2*k+w.point.x,O=t.y2*k+w.point.y;return!this.isInsideGrid(A,P,z,O)||n!=="always"&&this.grid.hitTest(A,P,z,O,n,g)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,P,z,O],offscreen:this.isOffscreen(A,P,z,O)}}placeCollisionCircles(t,n,u,p,g,x,w,k,A,P,z,O,X,G){const K=[],j=new s.P(n.anchorX,n.anchorY),ae=Vi(j,x,G),ge=wo(this.transform.cameraToCenterDistance,ae.signedDistanceFromCamera),Q=(P?g/ge:g*ge)/s.ap,ce=Vi(j,w,G).point,Se=jt(Q,p,n.lineOffsetX*Q,n.lineOffsetY*Q,!1,ce,j,n,u,w,{projections:{},offsets:{}},!1,G);let ke=!1,Le=!1,je=!0;if(Se){const Ve=.5*O*ge+X,We=new s.P(-100,-100),ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Kt=new ii,tt=Se.first,Mt=Se.last;let _t=[];for(let Nt=tt.path.length-1;Nt>=1;Nt--)_t.push(tt.path[Nt]);for(let Nt=1;Nt<Mt.path.length;Nt++)_t.push(Mt.path[Nt]);const yi=2.5*Ve;if(k){const Nt=_t.map(Yt=>Vi(Yt,k,G));_t=Nt.some(Yt=>Yt.signedDistanceFromCamera<=0)?[]:Nt.map(Yt=>Yt.point)}let Wt=[];if(_t.length>0){const Nt=_t[0].clone(),Yt=_t[0].clone();for(let Xi=1;Xi<_t.length;Xi++)Nt.x=Math.min(Nt.x,_t[Xi].x),Nt.y=Math.min(Nt.y,_t[Xi].y),Yt.x=Math.max(Yt.x,_t[Xi].x),Yt.y=Math.max(Yt.y,_t[Xi].y);Wt=Nt.x>=We.x&&Yt.x<=ft.x&&Nt.y>=We.y&&Yt.y<=ft.y?[_t]:Yt.x<We.x||Nt.x>ft.x||Yt.y<We.y||Nt.y>ft.y?[]:s.am([_t],We.x,We.y,ft.x,ft.y)}for(const Nt of Wt){Kt.reset(Nt,.25*Ve);let Yt=0;Yt=Kt.length<=.5*Ve?1:Math.ceil(Kt.paddedLength/yi)+1;for(let Xi=0;Xi<Yt;Xi++){const Ii=Xi/Math.max(Yt-1,1),wr=Kt.lerp(Ii),ar=wr.x+$,$i=wr.y+$;K.push(ar,$i,Ve,0);const un=ar-Ve,Ci=$i-Ve,Nn=ar+Ve,Vn=$i+Ve;if(je=je&&this.isOffscreen(un,Ci,Nn,Vn),Le=Le||this.isInsideGrid(un,Ci,Nn,Vn),t!=="always"&&this.grid.hitTestCircle(ar,$i,Ve,t,z)&&(ke=!0,!A))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!A&&ke||!Le||ge<this.perspectiveRatioCutoff?[]:K,offscreen:je,collisionDetected:ke}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let u=1/0,p=1/0,g=-1/0,x=-1/0;for(const P of t){const z=new s.P(P.x+$,P.y+$);u=Math.min(u,z.x),p=Math.min(p,z.y),g=Math.max(g,z.x),x=Math.max(x,z.y),n.push(z)}const w=this.grid.query(u,p,g,x).concat(this.ignoredGrid.query(u,p,g,x)),k={},A={};for(const P of w){const z=P.key;if(k[z.bucketInstanceId]===void 0&&(k[z.bucketInstanceId]={}),k[z.bucketInstanceId][z.featureIndex])continue;const O=[new s.P(P.x1,P.y1),new s.P(P.x2,P.y1),new s.P(P.x2,P.y2),new s.P(P.x1,P.y2)];s.an(n,O)&&(k[z.bucketInstanceId][z.featureIndex]=!0,A[z.bucketInstanceId]===void 0&&(A[z.bucketInstanceId]=[]),A[z.bucketInstanceId].push(z.featureIndex))}return A}insertCollisionBox(t,n,u,p,g,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:n},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,p,g,x){const w=u?this.ignoredGrid:this.grid,k={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:n};for(let A=0;A<t.length;A+=4)w.insertCircle(k,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,n,u,p){let g;return p?(g=[n,u,p(n,u),1],s.ag(g,g,t)):(g=[n,u,0,1],Y(g,g,t)),{point:new s.P((g[0]/g[3]+1)/2*this.transform.width+$,(-g[1]/g[3]+1)/2*this.transform.height+$),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,n,u,p){return u<$||t>=this.screenRightBoundary||p<$||n>this.screenBottomBoundary}isInsideGrid(t,n,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.ao([]);return s.$(t,t,[-100,-100,0]),t}}function se(f,t,n){return t*(s.N/(f.tileSize*Math.pow(2,n-f.tileID.overscaledZ)))}class te{constructor(t,n,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ue{constructor(t,n,u,p,g){this.text=new te(t?t.text:null,n,u,g),this.icon=new te(t?t.icon:null,n,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pe{constructor(t,n,u){this.text=t,this.icon=n,this.skipFade=u}}class ze{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Be{constructor(t,n,u,p,g){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=g}}class wt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function Pt(f,t,n,u,p){const{horizontalAlign:g,verticalAlign:x}=s.au(f);return new s.P(-(g-.5)*t+u[0]*p,-(x-.5)*n+u[1]*p)}function pt(f,t,n,u,p,g){const{x1:x,x2:w,y1:k,y2:A,anchorPointX:P,anchorPointY:z}=f,O=new s.P(t,n);return u&&O._rotate(p?g:-g),{x1:x+O.x,y1:k+O.y,x2:w+O.x,y2:A+O.y,anchorPointX:P,anchorPointY:z}}class kt{constructor(t,n,u,p,g){this.transform=t.clone(),this.terrain=n,this.collisionIndex=new pe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new wt(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,u,p){const g=u.getBucket(n),x=u.latestFeatureIndex;if(!g||!x||n.id!==g.layerIds[0])return;const w=u.collisionBoxArray,k=g.layers[0].layout,A=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),P=u.tileSize/s.N,z=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),O=k.get("text-pitch-alignment")==="map",X=k.get("text-rotation-alignment")==="map",G=se(u,1,this.transform.zoom),K=Ye(z,O,X,this.transform,G);let j=null;if(O){const ge=Fn(z,O,X,this.transform,G);j=s.a1([],this.transform.labelPlaneMatrix,ge)}this.retainedQueryData[g.bucketInstanceId]=new Be(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,u.tileID);const ae={bucket:g,layout:k,posMatrix:z,textLabelPlaneMatrix:K,labelToScreenMatrix:j,scale:A,textPixelRatio:P,holdingForFade:u.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const ge of g.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:ce,symbolInstanceEnd:Se}=ge;t.push({sortKey:Q,symbolInstanceStart:ce,symbolInstanceEnd:Se,parameters:ae})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(t,n,u,p,g,x,w,k,A,P,z,O,X,G,K,j){const ae=s.aq[t.textAnchor],ge=[t.textOffset0,t.textOffset1],Q=Pt(ae,u,p,ge,g),ce=this.collisionIndex.placeCollisionBox(pt(n,Q.x,Q.y,x,w,this.transform.angle),z,k,A,P.predicate,j);if((!K||this.collisionIndex.placeCollisionBox(pt(K,Q.x,Q.y,x,w,this.transform.angle),z,k,A,P.predicate,j).box.length!==0)&&ce.box.length>0){let Se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Se=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:ge,width:u,height:p,anchor:ae,textBoxScale:g,prevAnchor:Se},this.markUsedJustification(X,ae,O,G),X.allowVerticalPlacement&&(this.markUsedOrientation(X,G,O),this.placedOrientations[O.crossTileID]=G),{shift:Q,placedGlyphBoxes:ce}}}placeLayerBucketPart(t,n,u){const{bucket:p,layout:g,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:k,textPixelRatio:A,holdingForFade:P,collisionBoxArray:z,partiallyEvaluatedTextSize:O,collisionGroup:X}=t.parameters,G=g.get("text-optional"),K=g.get("icon-optional"),j=s.ar(g,"text-overlap","text-allow-overlap"),ae=j==="always",ge=s.ar(g,"icon-overlap","icon-allow-overlap"),Q=ge==="always",ce=g.get("text-rotation-alignment")==="map",Se=g.get("text-pitch-alignment")==="map",ke=g.get("icon-text-fit")!=="none",Le=g.get("symbol-z-order")==="viewport-y",je=ae&&(Q||!p.hasIconData()||K),Ve=Q&&(ae||!p.hasTextData()||G);!p.collisionArrays&&z&&p.deserializeCollisionBoxes(z);const We=this.retainedQueryData[p.bucketInstanceId].tileID,ft=this.terrain?(tt,Mt)=>this.terrain.getElevation(We,tt,Mt):null,Kt=(tt,Mt)=>{var _t,yi;if(n[tt.crossTileID])return;if(P)return void(this.placements[tt.crossTileID]=new Pe(!1,!1,!1));let Wt=!1,Nt=!1,Yt=!0,Xi=null,Ii={box:null,offscreen:null},wr={box:null,offscreen:null},ar=null,$i=null,un=null,Ci=0,Nn=0,Vn=0;Mt.textFeatureIndex?Ci=Mt.textFeatureIndex:tt.useRuntimeCollisionCircles&&(Ci=tt.featureIndex),Mt.verticalTextFeatureIndex&&(Nn=Mt.verticalTextFeatureIndex);const _o=Mt.textBox;if(_o){const Cr=Wi=>{let lr=s.ai.horizontal;if(p.allowVerticalPlacement&&!Wi&&this.prevPlacement){const Zr=this.prevPlacement.placedOrientations[tt.crossTileID];Zr&&(this.placedOrientations[tt.crossTileID]=Zr,lr=Zr,this.markUsedOrientation(p,lr,tt))}return lr},Sr=(Wi,lr)=>{if(p.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&Mt.verticalTextBox){for(const Zr of p.writingModes)if(Zr===s.ai.vertical?(Ii=lr(),wr=Ii):Ii=Wi(),Ii&&Ii.box&&Ii.box.length)break}else Ii=Wi()},Fr=tt.textAnchorOffsetStartIndex,zo=tt.textAnchorOffsetEndIndex;if(zo===Fr){const Wi=(lr,Zr)=>{const Hi=this.collisionIndex.placeCollisionBox(lr,j,A,x,X.predicate,ft);return Hi&&Hi.box&&Hi.box.length&&(this.markUsedOrientation(p,Zr,tt),this.placedOrientations[tt.crossTileID]=Zr),Hi};Sr(()=>Wi(_o,s.ai.horizontal),()=>{const lr=Mt.verticalTextBox;return p.allowVerticalPlacement&&tt.numVerticalGlyphVertices>0&&lr?Wi(lr,s.ai.vertical):{box:null,offscreen:null}}),Cr(Ii&&Ii.box&&Ii.box.length)}else{let Wi=s.aq[(yi=(_t=this.prevPlacement)===null||_t===void 0?void 0:_t.variableOffsets[tt.crossTileID])===null||yi===void 0?void 0:yi.anchor];const lr=(Hi,Lo,ma)=>{const $c=Hi.x2-Hi.x1,Qc=Hi.y2-Hi.y1,rh=tt.textBoxScale,Tl=ke&&ge==="never"?Lo:null;let Un={box:[],offscreen:!1},Do=j==="never"?1:2,jn="never";Wi&&Do++;for(let Tn=0;Tn<Do;Tn++){for(let qn=Fr;qn<zo;qn++){const kl=p.textAnchorOffsets.get(qn);if(Wi&&kl.textAnchor!==Wi)continue;const no=this.attemptAnchorPlacement(kl,Hi,$c,Qc,rh,ce,Se,A,x,X,jn,tt,p,ma,Tl,ft);if(no&&(Un=no.placedGlyphBoxes,Un&&Un.box&&Un.box.length))return Wt=!0,Xi=no.shift,Un}Wi?Wi=null:jn=j}return Un};Sr(()=>lr(_o,Mt.iconBox,s.ai.horizontal),()=>{const Hi=Mt.verticalTextBox;return p.allowVerticalPlacement&&!(Ii&&Ii.box&&Ii.box.length)&&tt.numVerticalGlyphVertices>0&&Hi?lr(Hi,Mt.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),Ii&&(Wt=Ii.box,Yt=Ii.offscreen);const Zr=Cr(Ii&&Ii.box);if(!Wt&&this.prevPlacement){const Hi=this.prevPlacement.variableOffsets[tt.crossTileID];Hi&&(this.variableOffsets[tt.crossTileID]=Hi,this.markUsedJustification(p,Hi.anchor,tt,Zr))}}}if(ar=Ii,Wt=ar&&ar.box&&ar.box.length>0,Yt=ar&&ar.offscreen,tt.useRuntimeCollisionCircles){const Cr=p.text.placedSymbolArray.get(tt.centerJustifiedTextSymbolIndex),Sr=s.aj(p.textSizeData,O,Cr),Fr=g.get("text-padding");$i=this.collisionIndex.placeCollisionCircles(j,Cr,p.lineVertexArray,p.glyphOffsetArray,Sr,x,w,k,u,Se,X.predicate,tt.collisionCircleDiameter,Fr,ft),$i.circles.length&&$i.collisionDetected&&!u&&s.w("Collisions detected, but collision boxes are not shown"),Wt=ae||$i.circles.length>0&&!$i.collisionDetected,Yt=Yt&&$i.offscreen}if(Mt.iconFeatureIndex&&(Vn=Mt.iconFeatureIndex),Mt.iconBox){const Cr=Sr=>{const Fr=ke&&Xi?pt(Sr,Xi.x,Xi.y,ce,Se,this.transform.angle):Sr;return this.collisionIndex.placeCollisionBox(Fr,ge,A,x,X.predicate,ft)};wr&&wr.box&&wr.box.length&&Mt.verticalIconBox?(un=Cr(Mt.verticalIconBox),Nt=un.box.length>0):(un=Cr(Mt.iconBox),Nt=un.box.length>0),Yt=Yt&&un.offscreen}const Po=G||tt.numHorizontalGlyphVertices===0&&tt.numVerticalGlyphVertices===0,rs=K||tt.numIconVertices===0;if(Po||rs?rs?Po||(Nt=Nt&&Wt):Wt=Nt&&Wt:Nt=Wt=Nt&&Wt,Wt&&ar&&ar.box&&this.collisionIndex.insertCollisionBox(ar.box,j,g.get("text-ignore-placement"),p.bucketInstanceId,wr&&wr.box&&Nn?Nn:Ci,X.ID),Nt&&un&&this.collisionIndex.insertCollisionBox(un.box,ge,g.get("icon-ignore-placement"),p.bucketInstanceId,Vn,X.ID),$i&&(Wt&&this.collisionIndex.insertCollisionCircles($i.circles,j,g.get("text-ignore-placement"),p.bucketInstanceId,Ci,X.ID),u)){const Cr=p.bucketInstanceId;let Sr=this.collisionCircleArrays[Cr];Sr===void 0&&(Sr=this.collisionCircleArrays[Cr]=new ze);for(let Fr=0;Fr<$i.circles.length;Fr+=4)Sr.circles.push($i.circles[Fr+0]),Sr.circles.push($i.circles[Fr+1]),Sr.circles.push($i.circles[Fr+2]),Sr.circles.push($i.collisionDetected?1:0)}if(tt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[tt.crossTileID]=new Pe(Wt||je,Nt||Ve,Yt||p.justReloaded),n[tt.crossTileID]=!0};if(Le){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const tt=p.getSortedSymbolIndexes(this.transform.angle);for(let Mt=tt.length-1;Mt>=0;--Mt){const _t=tt[Mt];Kt(p.symbolInstances.get(_t),p.collisionArrays[_t])}}else for(let tt=t.symbolInstanceStart;tt<t.symbolInstanceEnd;tt++)Kt(p.symbolInstances.get(tt),p.collisionArrays[tt]);if(u&&p.bucketInstanceId in this.collisionCircleArrays){const tt=this.collisionCircleArrays[p.bucketInstanceId];s.as(tt.invProjMatrix,x),tt.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,n,u,p){let g;g=p===s.ai.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[s.at(n)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:u.crossTileID)}markUsedOrientation(t,n,u){const p=n===s.ai.horizontal||n===s.ai.horizontalOnly?n:0,g=n===s.ai.vertical?n:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=p;u.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const p=n?n.symbolFadeChange(t):1,g=n?n.opacities:{},x=n?n.variableOffsets:{},w=n?n.placedOrientations:{};for(const k in this.placements){const A=this.placements[k],P=g[k];P?(this.opacities[k]=new ue(P,p,A.text,A.icon),u=u||A.text!==P.text.placed||A.icon!==P.icon.placed):(this.opacities[k]=new ue(null,p,A.text,A.icon,A.skipFade),u=u||A.text||A.icon)}for(const k in g){const A=g[k];if(!this.opacities[k]){const P=new ue(A,p,!1,!1);P.isHidden()||(this.opacities[k]=P,u=u||A.text.placed||A.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in w)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=w[k]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n){const u={};for(const p of n){const g=p.getBucket(t);g&&p.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,u,p.collisionBoxArray)}}updateBucketOpacities(t,n,u){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0],g=p.layout,x=new ue(null,0,!1,!1,!0),w=g.get("text-allow-overlap"),k=g.get("icon-allow-overlap"),A=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),P=g.get("text-rotation-alignment")==="map",z=g.get("text-pitch-alignment")==="map",O=g.get("icon-text-fit")!=="none",X=new ue(null,0,w&&(k||!t.hasIconData()||g.get("icon-optional")),k&&(w||!t.hasTextData()||g.get("text-optional")),!0);!t.collisionArrays&&u&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(u);const G=(K,j,ae)=>{for(let ge=0;ge<j/4;ge++)K.opacityVertexArray.emplaceBack(ae);K.hasVisibleVertices=K.hasVisibleVertices||ae!==yn};for(let K=0;K<t.symbolInstances.length;K++){const j=t.symbolInstances.get(K),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:ge,crossTileID:Q}=j;let ce=this.opacities[Q];n[Q]?ce=x:ce||(ce=X,this.opacities[Q]=ce),n[Q]=!0;const Se=j.numIconVertices>0,ke=this.placedOrientations[j.crossTileID],Le=ke===s.ai.vertical,je=ke===s.ai.horizontal||ke===s.ai.horizontalOnly;if(ae>0||ge>0){const Ve=br(ce.text);G(t.text,ae,Le?yn:Ve),G(t.text,ge,je?yn:Ve);const We=ce.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(tt=>{tt>=0&&(t.text.placedSymbolArray.get(tt).hidden=We||Le?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=We||je?1:0);const ft=this.variableOffsets[j.crossTileID];ft&&this.markUsedJustification(t,ft.anchor,j,ke);const Kt=this.placedOrientations[j.crossTileID];Kt&&(this.markUsedJustification(t,"left",j,Kt),this.markUsedOrientation(t,Kt,j))}if(Se){const Ve=br(ce.icon),We=!(O&&j.verticalPlacedIconSymbolIndex&&Le);j.placedIconSymbolIndex>=0&&(G(t.icon,j.numIconVertices,We?Ve:yn),t.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=ce.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,j.numVerticalIconVertices,We?yn:Ve),t.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ve=t.collisionArrays[K];if(Ve){let We=new s.P(0,0);if(Ve.textBox||Ve.verticalTextBox){let Kt=!0;if(A){const tt=this.variableOffsets[Q];tt?(We=Pt(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),P&&We._rotate(z?this.transform.angle:-this.transform.angle)):Kt=!1}Ve.textBox&&Lt(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Kt||Le,We.x,We.y),Ve.verticalTextBox&&Lt(t.textCollisionBox.collisionVertexArray,ce.text.placed,!Kt||je,We.x,We.y)}const ft=!!(!je&&Ve.verticalIconBox);Ve.iconBox&&Lt(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,ft,O?We.x:0,O?We.y:0),Ve.verticalIconBox&&Lt(t.iconCollisionBox.collisionVertexArray,ce.icon.placed,!ft,O?We.x:0,O?We.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=K.invProjMatrix,t.placementViewportMatrix=K.viewportMatrix,t.collisionCircleArray=K.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function Lt(f,t,n,u,p){f.emplaceBack(t?1:0,n?1:0,u||0,p||0),f.emplaceBack(t?1:0,n?1:0,u||0,p||0),f.emplaceBack(t?1:0,n?1:0,u||0,p||0),f.emplaceBack(t?1:0,n?1:0,u||0,p||0)}const pi=Math.pow(2,25),vi=Math.pow(2,24),ni=Math.pow(2,17),ri=Math.pow(2,16),Ir=Math.pow(2,9),ki=Math.pow(2,8),ir=Math.pow(2,1);function br(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,n=Math.floor(127*f.opacity);return n*pi+t*vi+n*ni+t*ri+n*Ir+t*ki+n*ir+t}const yn=0;class fc{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,n,u,p,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(x,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,k)=>w.sortKey-k.sortKey));this._currentPartIndex<x.length;)if(n.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,g())return!0;return!1}}class Zo{constructor(t,n,u,p,g,x,w,k){this.placement=new kt(t,n,x,w,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u){const p=s.h.now(),g=()=>!this._forceFullPlacement&&s.h.now()-p>2;for(;this._currentPlacementIndex>=0;){const x=n[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new fc(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Go=512/s.N/2;class Vu{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this._symbolsByKey={};const p=new Map;for(let g=0;g<n.length;g++){const x=n.get(g),w=x.key,k=p.get(w);k?k.push(x):p.set(w,[x])}for(const[g,x]of p){const w={positions:x.map(k=>({x:Math.floor(k.anchorX*Go),y:Math.floor(k.anchorY*Go)})),crossTileIDs:x.map(k=>k.crossTileID)};if(w.positions.length>128){const k=new s.av(w.positions.length,16,Uint16Array);for(const{x:A,y:P}of w.positions)k.add(A,P);k.finish(),delete w.positions,w.index=k}this._symbolsByKey[g]=w}}getScaledCoordinates(t,n){const{x:u,y:p,z:g}=this.tileID.canonical,{x,y:w,z:k}=n.canonical,A=Go/Math.pow(2,k-g),P=(w*s.N+t.anchorY)*A,z=p*s.N*Go;return{x:Math.floor((x*s.N+t.anchorX)*A-u*s.N*Go),y:Math.floor(P-z)}}findMatches(t,n,u){const p=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const k=this.getScaledCoordinates(x,n);if(w.index){const A=w.index.range(k.x-p,k.y-p,k.x+p,k.y+p).sort();for(const P of A){const z=w.crossTileIDs[P];if(!u[z]){u[z]=!0,x.crossTileID=z;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const P=w.positions[A],z=w.crossTileIDs[A];if(Math.abs(P.x-k.x)<=p&&Math.abs(P.y-k.y)<=p&&!u[z]){u[z]=!0,x.crossTileID=z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class gi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ra{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const p=this.indexes[u],g={};for(const x in p){const w=p[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+n),g[w.tileID.key]=w}this.indexes[u]=g}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<n.symbolInstances.length;g++)n.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const w in x){const k=x[w];k.tileID.isChildOf(t)&&k.findMatches(n.symbolInstances,t,p)}else{const w=x[t.scaledTo(Number(g)).key];w&&w.findMatches(n.symbolInstances,t,p)}}for(let g=0;g<n.symbolInstances.length;g++){const x=n.symbolInstances.get(g);x.crossTileID||(x.crossTileID=u.generate(),p[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Vu(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.getCrossTileIDsLists())for(const p of u)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const p=this.indexes[u];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[g]),delete p[g],n=!0)}return n}}class Us{constructor(){this.layerIndexes={},this.crossTileIDs=new gi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new Ra);let g=!1;const x={};p.handleWrapJump(u);for(const w of n){const k=w.getBucket(t);k&&t.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(w.tileID,k,this.crossTileIDs)&&(g=!0),x[k.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const n={};t.forEach(u=>{n[u]=!0});for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}const Mr=(f,t)=>s.x(f,t&&t.filter(n=>n.identifier!=="source.canvas")),on=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Uu=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),vn=s.aw();class xr extends s.E{constructor(t,n={}){super(),this.map=t,this.dispatcher=new Jt(Oi(),this,t._getMapId()),this.imageManager=new Ue,this.imageManager.setEventedParent(this),this.glyphManager=new gt(t._requestManager,n.localIdeographFontFamily),this.lineAtlas=new Ri(256,512),this.crossTileSymbolIndex=new Us,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const u=this;this._rtlTextPluginCallback=xr.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(s.aA(g),x&&x.every(w=>w))for(const w in u.sourceCaches){const k=u.sourceCaches[w].getSource().type;k!=="vector"&&k!=="geojson"||u.sourceCaches[w].reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const k=this._layers[w];k.source===x.id&&this._validateLayer(k)}})}loadURL(t,n={},u){this.fire(new s.k("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const p=this.map._requestManager.transformRequest(t,ye.Style);this._request=s.f(p,(g,x)=>{this._request=null,g?this.fire(new s.j(g)):x&&this._load(x,n,u)})}loadJSON(t,n={},u){this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,n.validate=n.validate!==!1,this._load(t,n,u)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(vn,{validate:!1})}_load(t,n,u){var p;const g=n.transformStyle?n.transformStyle(u,t):t;if(!n.validate||!Mr(this,s.y(g))){this._loaded=!0,this.stylesheet=g;for(const x in g.sources)this.addSource(x,g.sources[x],{validate:!1});g.sprite?this._loadSprite(g.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(g.glyphs),this._createLayers(),this.light=new sr(this.stylesheet.light),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const t=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of t){const u=s.aC(n);u.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=u}}_loadSprite(t,n=!1,u=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(p,g,x,w){const k=Oe(p),A=k.length,P=x>1?"@2x":"",z={},O={},X={};for(const{id:G,url:K}of k){const j=g.transformRequest(g.normalizeSpriteURL(K,P,".json"),ye.SpriteJSON),ae=`${G}_${j.url}`;z[ae]=s.f(j,(ce,Se)=>{delete z[ae],O[G]=Se,qe(w,O,X,ce,A)});const ge=g.transformRequest(g.normalizeSpriteURL(K,P,".png"),ye.SpriteImage),Q=`${G}_${ge.url}`;z[Q]=me.getImage(ge,(ce,Se)=>{delete z[Q],X[G]=Se,qe(w,O,X,ce,A)})}return{cancel(){for(const G of Object.values(z))G.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(p,g)=>{if(this._spriteRequest=null,p)this.fire(new s.j(p));else if(g)for(const x in g){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(k=>!(k in g)):[];for(const k of w)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in g[x]){const A=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,g[x][k],!1):this.imageManager.addImage(A,g[x][k]),n&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),u&&u(p)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(t){const n=this.sourceCaches[t.source];if(!n)return;const u=t.sourceLayer;if(!u)return;const p=n.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.j(new Error(`Source layer "${u}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const n=this._serializedAllLayers();if(!t||t.length===0)return Object.values(n);const u=[];for(const p of t)n[p]&&u.push(n[p]);return u}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const n=Object.keys(this._layers);for(const u of n){const p=this._layers[u];p.type!=="custom"&&(t[u]=p.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const n=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const u={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];u[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in u){const g=this.sourceCaches[p];u[p]!==g.used&&g.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.z=t.zoom,n&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,n){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,n={}){this._checkLoaded();const u=this.serialize();if(t=n.transformStyle?n.transformStyle(u,t):t,Mr(this,s.y(t)))return!1;(t=s.aD(t)).layers=s.aB(t.layers);const p=s.aE(u,t).filter(x=>!(x.command in Uu));if(p.length===0)return!1;const g=p.filter(x=>!(x.command in on));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);for(const x of p)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=t,this._serializedLayers=null,!0}addImage(t,n){if(this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}updateImage(t,n){this.imageManager.updateImage(t,n)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new s.j(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,n,u={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(s.y.source,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const p=this.sourceCaches[t]=new vr(t,n,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===t)return this.fire(new s.j(new Error(`Source "${t}" cannot be removed while layer "${u}" is using it.`)));const n=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],n.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,n){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const u=this.sourceCaches[t].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(n),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,n,u={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new s.j(new Error(`Layer "${p}" already exists on this map.`)));let g;if(t.type==="custom"){if(Mr(this,s.aF(t)))return;g=s.aC(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=s.aD(t),t=s.e(t,{source:p})),this._validate(s.y.layer,`layers.${p}`,t,{arrayIndex:-1},u))return;g=s.aC(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}})}const x=n?this._order.indexOf(n):this._order.length;if(n&&x===-1)this.fire(new s.j(new Error(`Cannot add layer "${p}" before non-existing layer "${n}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const w=this._removedLayers[p];delete this._removedLayers[p],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,n){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new s.j(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===n)return;const u=this._order.indexOf(t);this._order.splice(u,1);const p=n?this._order.indexOf(n):this._order.length;n&&p===-1?this.fire(new s.j(new Error(`Cannot move layer "${t}" before non-existing layer "${n}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const n=this._layers[t];if(!n)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${t}".`)));n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,n,u){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===n&&p.maxzoom===u||(n!=null&&(p.minzoom=n),u!=null&&(p.maxzoom=u),this._updateLayer(p)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,n,u={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!s.aG(p.filter,n))return n==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(s.y.filter,`layers.${p.id}.filter`,n,null,u)||(p.filter=s.aD(n),this._updateLayer(p)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return s.aD(this.getLayer(t).filter)}setLayoutProperty(t,n,u,p={}){this._checkLoaded();const g=this.getLayer(t);g?s.aG(g.getLayoutProperty(n),u)||(g.setLayoutProperty(n,u,p),this._updateLayer(g)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,n){const u=this.getLayer(t);if(u)return u.getLayoutProperty(n);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,n,u,p={}){this._checkLoaded();const g=this.getLayer(t);g?s.aG(g.getPaintProperty(n),u)||(g.setPaintProperty(n,u,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,n){return this.getLayer(t).getPaintProperty(n)}setFeatureState(t,n){this._checkLoaded();const u=t.source,p=t.sourceLayer,g=this.sourceCaches[u];if(g===void 0)return void this.fire(new s.j(new Error(`The source '${u}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&p?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,t.id,n)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,n){this._checkLoaded();const u=t.source,p=this.sourceCaches[u];if(p===void 0)return void this.fire(new s.j(new Error(`The source '${u}' does not exist in the map's style.`)));const g=p.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?n&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,t.id,n):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const n=t.source,u=t.sourceLayer,p=this.sourceCaches[n];if(p!==void 0)return p.getSource().type!=="vector"||u?(t.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),p.getFeatureState(u,t.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=s.aH(this.sourceCaches,g=>g.serialize()),n=this._serializeByIds(this._order),u=this.map.getTerrain()||void 0,p=this.stylesheet;return s.aI({version:p.version,name:p.name,metadata:p.metadata,light:p.light,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,sources:t,layers:n,terrain:u},g=>g!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const n=x=>this._layers[x].type==="fill-extrusion",u={},p=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(n(w)){u[w]=x;for(const k of t){const A=k[w];if(A)for(const P of A)p.push(P)}}}p.sort((x,w)=>w.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(n(w))for(let k=p.length-1;k>=0;k--){const A=p[k].feature;if(u[A.layer.id]<x)break;g.push(A),p.pop()}else for(const k of t){const A=k[w];if(A)for(const P of A)g.push(P.feature)}}return g}queryRenderedFeatures(t,n,u){n&&n.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",n.filter,null,n);const p={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const w of n.layers){const k=this._layers[w];if(!k)return this.fire(new s.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];p[k.source]=!0}}const g=[];n.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)n.layers&&!p[w]||g.push(rn(this.sourceCaches[w],this._layers,x,t,n,u));return this.placement&&g.push(function(w,k,A,P,z,O,X){const G={},K=O.queryRenderedSymbols(P),j=[];for(const ae of Object.keys(K).map(Number))j.push(X[ae]);j.sort(Mn);for(const ae of j){const ge=ae.featureIndex.lookupSymbolFeatures(K[ae.bucketInstanceId],k,ae.bucketIndex,ae.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const Q in ge){const ce=G[Q]=G[Q]||[],Se=ge[Q];Se.sort((ke,Le)=>{const je=ae.featureSortOrder;if(je){const Ve=je.indexOf(ke.featureIndex);return je.indexOf(Le.featureIndex)-Ve}return Le.featureIndex-ke.featureIndex});for(const ke of Se)ce.push(ke)}}for(const ae in G)G[ae].forEach(ge=>{const Q=ge.feature,ce=A[w[ae].source].getFeatureState(Q.layer["source-layer"],Q.id);Q.source=Q.layer.source,Q.layer["source-layer"]&&(Q.sourceLayer=Q.layer["source-layer"]),Q.state=ce});return G}(this._layers,x,this.sourceCaches,t,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,n){n&&n.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",n.filter,null,n);const u=this.sourceCaches[t];return u?function(p,g){const x=p.getRenderableIds().map(A=>p.getTileByID(A)),w=[],k={};for(let A=0;A<x.length;A++){const P=x[A],z=P.tileID.canonical.key;k[z]||(k[z]=!0,P.querySourceFeatures(w,g))}return w}(u,n):[]}addSourceType(t,n,u){return Ti(t)?u(new Error(`A source type called "${t}" already exists.`)):(((p,g)=>{Xe[p]=g})(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},u):u(null,null))}getLight(){return this.light.getLight()}setLight(t,n={}){this._checkLoaded();const u=this.light.getLight();let p=!1;for(const x in t)if(!s.aG(t[x],u[x])){p=!0;break}if(!p)return;const g={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(g)}_validate(t,n,u,p,g={}){return(!g||g.validate!==!1)&&Mr(this,t.call(s.y,s.e({key:n,style:this.serialize(),value:u,styleSpec:s.v},p)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const u=this.sourceCaches[n];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const n in this.sourceCaches)this.sourceCaches[n].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,n,u,p,g=!1){let x=!1,w=!1;const k={};for(const A of this._order){const P=this._layers[A];if(P.type!=="symbol")continue;if(!k[P.source]){const O=this.sourceCaches[P.source];k[P.source]=O.getRenderableIds(!0).map(X=>O.getTileByID(X)).sort((X,G)=>G.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(G.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(P,k[P.source],t.center.lng);x=x||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),t.zoom))&&(this.pauseablePlacement=new Zo(t,this.map.terrain,this._order,g,n,u,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const A of this._order){const P=this._layers[A];P.type==="symbol"&&this.placement.updateLayerOpacities(P,k[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,n,u){this.imageManager.getImages(n.icons,u),this._updateTilesForChangedImages();const p=this.sourceCaches[n.source];p&&p.setDependencies(n.tileID.key,n.type,n.icons)}getGlyphs(t,n,u){this.glyphManager.getGlyphs(n.stacks,u);const p=this.sourceCaches[n.source];p&&p.setDependencies(n.tileID.key,n.type,[""])}getResource(t,n,u){return s.m(n,u)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,n={}){this._checkLoaded(),t&&this._validate(s.y.glyphs,"glyphs",t,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,n,u={},p){this._checkLoaded();const g=[{id:t,url:n}],x=[...Oe(this.stylesheet.sprite),...g];this._validate(s.y.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(g,!0,p))}removeSprite(t){this._checkLoaded();const n=Oe(this.stylesheet.sprite);if(n.find(u=>u.id===t)){if(this._spritesImagesIds[t])for(const u of this._spritesImagesIds[t])this.imageManager.removeImage(u),this._changedImages[u]=!0;n.splice(n.findIndex(u=>u.id===t),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Oe(this.stylesheet.sprite)}setSprite(t,n={},u){this._checkLoaded(),t&&this._validate(s.y.sprite,"sprite",t,null,n)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,u):(this._unloadSprite(),u&&u(null)))}}xr.registerForPluginStateChange=s.aK;var js=s.Q([{name:"a_pos",type:"Int16",components:2}]),Xo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const zi={prelude:li(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:li(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:li(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:li(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:li(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:li("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:li(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:li(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:li(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:li(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:li(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:li(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:li(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:li(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:li(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:li(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:li(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:li(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:li(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:li(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:li("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Xo),terrainDepth:li("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Xo),terrainCoords:li("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Xo)};function li(f,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=t.match(/attribute ([\w]+) ([\w]+)/g),p=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,w={};return{fragmentSource:f=f.replace(n,(k,A,P,z,O)=>(w[O]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
varying ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = u_${O};
#endif
`)),vertexSource:t=t.replace(n,(k,A,P,z,O)=>{const X=z==="float"?"vec2":"vec4",G=O.match(/color/)?"color":X;return w[O]?A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${P} ${X} a_${O};
varying ${P} ${z} ${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
attribute ${P} ${X} a_${O};
#else
uniform ${P} ${z} u_${O};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = a_${O};
#else
    ${P} ${z} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${P} ${z} ${O} = unpack_mix_${G}(a_${O}, u_${O}_t);
#else
    ${P} ${z} ${O} = u_${O};
#endif
`}),staticAttributes:u,staticUniforms:x}}class So{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,n,u,p,g,x,w,k,A){this.context=t;let P=this.boundPaintVertexBuffers.length!==p.length;for(let z=0;!P&&z<p.length;z++)this.boundPaintVertexBuffers[z]!==p[z]&&(P=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||P||this.boundIndexBuffer!==g||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==A?this.freshBind(n,u,p,g,x,w,k,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),k&&k.bind(),A&&A.bind())}freshBind(t,n,u,p,g,x,w,k){const A=t.numAttributes,P=this.context,z=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=k,n.enableAttributes(z,t);for(const O of u)O.enableAttributes(z,t);x&&x.enableAttributes(z,t),w&&w.enableAttributes(z,t),k&&k.enableAttributes(z,t),n.bind(),n.setVertexAttribPointers(z,t,g);for(const O of u)O.bind(),O.setVertexAttribPointers(z,t,g);x&&(x.bind(),x.setVertexAttribPointers(z,t,g)),p&&p.bind(),w&&(w.bind(),w.setVertexAttribPointers(z,t,g)),k&&(k.bind(),k.setVertexAttribPointers(z,t,g)),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ui(f){const t=[];for(let n=0;n<f.length;n++){if(f[n]===null)continue;const u=f[n].split(" ");t.push(u.pop())}return t}class qs{constructor(t,n,u,p,g,x){const w=t.gl;this.program=w.createProgram();const k=Ui(n.staticAttributes),A=u?u.getBinderAttributes():[],P=k.concat(A),z=zi.prelude.staticUniforms?Ui(zi.prelude.staticUniforms):[],O=n.staticUniforms?Ui(n.staticUniforms):[],X=u?u.getBinderUniforms():[],G=z.concat(O).concat(X),K=[];for(const ke of G)K.indexOf(ke)<0&&K.push(ke);const j=u?u.defines():[];g&&j.push("#define OVERDRAW_INSPECTOR;"),x&&j.push("#define TERRAIN3D;");const ae=j.concat(zi.prelude.fragmentSource,n.fragmentSource).join(`
`),ge=j.concat(zi.prelude.vertexSource,n.vertexSource).join(`
`),Q=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(Q,ae),w.compileShader(Q),!w.getShaderParameter(Q,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(Q)}`);w.attachShader(this.program,Q);const ce=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ce,ge),w.compileShader(ce),!w.getShaderParameter(ce,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ce)}`);w.attachShader(this.program,ce),this.attributes={};const Se={};this.numAttributes=P.length;for(let ke=0;ke<this.numAttributes;ke++)P[ke]&&(w.bindAttribLocation(this.program,ke,P[ke]),this.attributes[P[ke]]=ke);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ce),w.deleteShader(Q);for(let ke=0;ke<K.length;ke++){const Le=K[ke];if(Le&&!Se[Le]){const je=w.getUniformLocation(this.program,Le);je&&(Se[Le]=je)}}this.fixedUniforms=p(t,Se),this.terrainUniforms=((ke,Le)=>({u_depth:new s.aL(ke,Le.u_depth),u_terrain:new s.aL(ke,Le.u_terrain),u_terrain_dim:new s.aM(ke,Le.u_terrain_dim),u_terrain_matrix:new s.aN(ke,Le.u_terrain_matrix),u_terrain_unpack:new s.aO(ke,Le.u_terrain_unpack),u_terrain_exaggeration:new s.aM(ke,Le.u_terrain_exaggeration)}))(t,Se),this.binderUniforms=u?u.getUniforms(t,Se):[]}draw(t,n,u,p,g,x,w,k,A,P,z,O,X,G,K,j,ae,ge){const Q=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(u),t.setStencilMode(p),t.setColorMode(g),t.setCullFace(x),k){t.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,k.depthTexture),t.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,k.texture);for(const Se in this.terrainUniforms)this.terrainUniforms[Se].set(k[Se])}for(const Se in this.fixedUniforms)this.fixedUniforms[Se].set(w[Se]);K&&K.setUniforms(t,this.binderUniforms,X,{zoom:G});let ce=0;switch(n){case Q.LINES:ce=2;break;case Q.TRIANGLES:ce=3;break;case Q.LINE_STRIP:ce=1}for(const Se of O.get()){const ke=Se.vaos||(Se.vaos={});(ke[A]||(ke[A]=new So)).bind(t,this,P,K?K.getPaintVertexBuffers():[],z,Se.vertexOffset,j,ae,ge),Q.drawElements(n,Se.primitiveLength*ce,Q.UNSIGNED_SHORT,Se.primitiveOffset*ce*2)}}}function bn(f,t,n){const u=1/se(n,1,t.transform.tileZoom),p=Math.pow(2,n.tileID.overscaledZ),g=n.tileSize*Math.pow(2,t.transform.tileZoom)/p,x=g*(n.tileID.canonical.x+n.tileID.wrap*p),w=g*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[u,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Oa=(f,t,n,u)=>{const p=t.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],w=function(){var A=new s.A(9);return s.A!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();p.properties.get("anchor")==="viewport"&&function(A,P){var z=Math.sin(P),O=Math.cos(P);A[0]=O,A[1]=z,A[2]=0,A[3]=-z,A[4]=O,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(w,-t.transform.angle),function(A,P,z){var O=P[0],X=P[1],G=P[2];A[0]=O*z[0]+X*z[3]+G*z[6],A[1]=O*z[1]+X*z[4]+G*z[7],A[2]=O*z[2]+X*z[5]+G*z[8]}(x,x,w);const k=p.properties.get("color");return{u_matrix:f,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[k.r,k.g,k.b],u_vertical_gradient:+n,u_opacity:u}},co=(f,t,n,u,p,g,x)=>s.e(Oa(f,t,n,u),bn(g,t,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),mc=f=>({u_matrix:f}),Na=(f,t,n,u)=>s.e(mc(f),bn(n,t,u)),Zs=(f,t)=>({u_matrix:f,u_world:t}),Gs=(f,t,n,u,p)=>s.e(Na(f,t,n,u),{u_world:p}),uo=(f,t,n,u)=>{const p=f.transform;let g,x;if(u.paint.get("circle-pitch-alignment")==="map"){const w=se(n,1,p.zoom);g=!0,x=[w,w]}else g=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(u.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(t.posMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:x}},Va=(f,t,n)=>{const u=se(n,1,t.zoom),p=Math.pow(2,t.zoom-n.tileID.overscaledZ),g=n.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:u,u_extrude_scale:[t.pixelsToGLUnits[0]/(u*p),t.pixelsToGLUnits[1]/(u*p)],u_overscale_factor:g}},ps=(f,t,n=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:n}),_c=f=>({u_matrix:f}),ju=(f,t,n,u)=>({u_matrix:f,u_extrude_scale:se(t,1,n),u_intensity:u});function Ua(f,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.U(0,u/n).toLngLat().lat,new s.U(0,(u+1)/n).toLngLat().lat]}const ja=(f,t,n,u)=>{const p=f.transform;return{u_matrix:Xs(f,t,n,u),u_ratio:1/se(t,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},gc=(f,t,n,u,p)=>s.e(ja(f,t,n,p),{u_image:0,u_image_height:u}),qu=(f,t,n,u,p)=>{const g=f.transform,x=vc(t,g);return{u_matrix:Xs(f,t,n,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/se(t,1,g.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[x,u.fromScale,u.toScale],u_fade:u.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},yc=(f,t,n,u,p,g)=>{const x=f.lineAtlas,w=vc(t,f.transform),k=n.layout.get("line-cap")==="round",A=x.getDash(u.from,k),P=x.getDash(u.to,k),z=A.width*p.fromScale,O=P.width*p.toScale;return s.e(ja(f,t,n,g),{u_patternscale_a:[w/z,-A.height/2],u_patternscale_b:[w/O,-P.height/2],u_sdfgamma:x.width/(256*Math.min(z,O)*f.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:P.y,u_mix:p.t})};function vc(f,t){return 1/se(f,1,t.tileZoom)}function Xs(f,t,n,u){return f.translatePosMatrix(u?u.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const bc=(f,t,n,u,p)=>{return{u_matrix:f,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:u.mix,u_opacity:u.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:xc(p.paint.get("raster-hue-rotate"))};var g,x};function xc(f){f*=Math.PI/180;const t=Math.sin(f),n=Math.cos(f);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const qa=(f,t,n,u,p,g,x,w,k,A)=>{const P=p.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:P.cameraToCenterDistance,u_pitch:P.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:P.width/P.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+k,u_pitch_with_map:+u,u_texsize:A,u_texture:0}},Za=(f,t,n,u,p,g,x,w,k,A,P)=>{const z=p.transform;return s.e(qa(f,t,n,u,p,g,x,w,k,A),{u_gamma_scale:u?Math.cos(z._pitch)*z.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+P})},To=(f,t,n,u,p,g,x,w,k,A)=>s.e(Za(f,t,n,u,p,g,x,w,!0,k,!0),{u_texsize_icon:A,u_texture_icon:1}),Ws=(f,t,n)=>({u_matrix:f,u_opacity:t,u_color:n}),xn=(f,t,n,u,p,g)=>s.e(function(x,w,k,A){const P=k.imageManager.getPattern(x.from.toString()),z=k.imageManager.getPattern(x.to.toString()),{width:O,height:X}=k.imageManager.getPixelSize(),G=Math.pow(2,A.tileID.overscaledZ),K=A.tileSize*Math.pow(2,k.transform.tileZoom)/G,j=K*(A.tileID.canonical.x+A.tileID.wrap*G),ae=K*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[O,X],u_mix:w.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/se(A,1,k.transform.tileZoom),u_pixel_coord_upper:[j>>16,ae>>16],u_pixel_coord_lower:[65535&j,65535&ae]}}(u,g,n,p),{u_matrix:f,u_opacity:t}),Hs={fillExtrusion:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_lightpos:new s.aP(f,t.u_lightpos),u_lightintensity:new s.aM(f,t.u_lightintensity),u_lightcolor:new s.aP(f,t.u_lightcolor),u_vertical_gradient:new s.aM(f,t.u_vertical_gradient),u_opacity:new s.aM(f,t.u_opacity)}),fillExtrusionPattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_lightpos:new s.aP(f,t.u_lightpos),u_lightintensity:new s.aM(f,t.u_lightintensity),u_lightcolor:new s.aP(f,t.u_lightcolor),u_vertical_gradient:new s.aM(f,t.u_vertical_gradient),u_height_factor:new s.aM(f,t.u_height_factor),u_image:new s.aL(f,t.u_image),u_texsize:new s.aQ(f,t.u_texsize),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade),u_opacity:new s.aM(f,t.u_opacity)}),fill:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix)}),fillPattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_image:new s.aL(f,t.u_image),u_texsize:new s.aQ(f,t.u_texsize),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade)}),fillOutline:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_world:new s.aQ(f,t.u_world)}),fillOutlinePattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_world:new s.aQ(f,t.u_world),u_image:new s.aL(f,t.u_image),u_texsize:new s.aQ(f,t.u_texsize),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade)}),circle:(f,t)=>({u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_scale_with_map:new s.aL(f,t.u_scale_with_map),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_extrude_scale:new s.aQ(f,t.u_extrude_scale),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_matrix:new s.aN(f,t.u_matrix)}),collisionBox:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(f,t.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(f,t.u_extrude_scale),u_overscale_factor:new s.aM(f,t.u_overscale_factor)}),collisionCircle:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_inv_matrix:new s.aN(f,t.u_inv_matrix),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_viewport_size:new s.aQ(f,t.u_viewport_size)}),debug:(f,t)=>({u_color:new s.aR(f,t.u_color),u_matrix:new s.aN(f,t.u_matrix),u_overlay:new s.aL(f,t.u_overlay),u_overlay_scale:new s.aM(f,t.u_overlay_scale)}),clippingMask:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix)}),heatmap:(f,t)=>({u_extrude_scale:new s.aM(f,t.u_extrude_scale),u_intensity:new s.aM(f,t.u_intensity),u_matrix:new s.aN(f,t.u_matrix)}),heatmapTexture:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_world:new s.aQ(f,t.u_world),u_image:new s.aL(f,t.u_image),u_color_ramp:new s.aL(f,t.u_color_ramp),u_opacity:new s.aM(f,t.u_opacity)}),hillshade:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_image:new s.aL(f,t.u_image),u_latrange:new s.aQ(f,t.u_latrange),u_light:new s.aQ(f,t.u_light),u_shadow:new s.aR(f,t.u_shadow),u_highlight:new s.aR(f,t.u_highlight),u_accent:new s.aR(f,t.u_accent)}),hillshadePrepare:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_image:new s.aL(f,t.u_image),u_dimension:new s.aQ(f,t.u_dimension),u_zoom:new s.aM(f,t.u_zoom),u_unpack:new s.aO(f,t.u_unpack)}),line:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels)}),lineGradient:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels),u_image:new s.aL(f,t.u_image),u_image_height:new s.aM(f,t.u_image_height)}),linePattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_texsize:new s.aQ(f,t.u_texsize),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_image:new s.aL(f,t.u_image),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels),u_scale:new s.aP(f,t.u_scale),u_fade:new s.aM(f,t.u_fade)}),lineSDF:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ratio:new s.aM(f,t.u_ratio),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(f,t.u_units_to_pixels),u_patternscale_a:new s.aQ(f,t.u_patternscale_a),u_patternscale_b:new s.aQ(f,t.u_patternscale_b),u_sdfgamma:new s.aM(f,t.u_sdfgamma),u_image:new s.aL(f,t.u_image),u_tex_y_a:new s.aM(f,t.u_tex_y_a),u_tex_y_b:new s.aM(f,t.u_tex_y_b),u_mix:new s.aM(f,t.u_mix)}),raster:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_tl_parent:new s.aQ(f,t.u_tl_parent),u_scale_parent:new s.aM(f,t.u_scale_parent),u_buffer_scale:new s.aM(f,t.u_buffer_scale),u_fade_t:new s.aM(f,t.u_fade_t),u_opacity:new s.aM(f,t.u_opacity),u_image0:new s.aL(f,t.u_image0),u_image1:new s.aL(f,t.u_image1),u_brightness_low:new s.aM(f,t.u_brightness_low),u_brightness_high:new s.aM(f,t.u_brightness_high),u_saturation_factor:new s.aM(f,t.u_saturation_factor),u_contrast_factor:new s.aM(f,t.u_contrast_factor),u_spin_weights:new s.aP(f,t.u_spin_weights)}),symbolIcon:(f,t)=>({u_is_size_zoom_constant:new s.aL(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(f,t.u_is_size_feature_constant),u_size_t:new s.aM(f,t.u_size_t),u_size:new s.aM(f,t.u_size),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pitch:new s.aM(f,t.u_pitch),u_rotate_symbol:new s.aL(f,t.u_rotate_symbol),u_aspect_ratio:new s.aM(f,t.u_aspect_ratio),u_fade_change:new s.aM(f,t.u_fade_change),u_matrix:new s.aN(f,t.u_matrix),u_label_plane_matrix:new s.aN(f,t.u_label_plane_matrix),u_coord_matrix:new s.aN(f,t.u_coord_matrix),u_is_text:new s.aL(f,t.u_is_text),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_texsize:new s.aQ(f,t.u_texsize),u_texture:new s.aL(f,t.u_texture)}),symbolSDF:(f,t)=>({u_is_size_zoom_constant:new s.aL(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(f,t.u_is_size_feature_constant),u_size_t:new s.aM(f,t.u_size_t),u_size:new s.aM(f,t.u_size),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pitch:new s.aM(f,t.u_pitch),u_rotate_symbol:new s.aL(f,t.u_rotate_symbol),u_aspect_ratio:new s.aM(f,t.u_aspect_ratio),u_fade_change:new s.aM(f,t.u_fade_change),u_matrix:new s.aN(f,t.u_matrix),u_label_plane_matrix:new s.aN(f,t.u_label_plane_matrix),u_coord_matrix:new s.aN(f,t.u_coord_matrix),u_is_text:new s.aL(f,t.u_is_text),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_texsize:new s.aQ(f,t.u_texsize),u_texture:new s.aL(f,t.u_texture),u_gamma_scale:new s.aM(f,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_is_halo:new s.aL(f,t.u_is_halo)}),symbolTextAndIcon:(f,t)=>({u_is_size_zoom_constant:new s.aL(f,t.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(f,t.u_is_size_feature_constant),u_size_t:new s.aM(f,t.u_size_t),u_size:new s.aM(f,t.u_size),u_camera_to_center_distance:new s.aM(f,t.u_camera_to_center_distance),u_pitch:new s.aM(f,t.u_pitch),u_rotate_symbol:new s.aL(f,t.u_rotate_symbol),u_aspect_ratio:new s.aM(f,t.u_aspect_ratio),u_fade_change:new s.aM(f,t.u_fade_change),u_matrix:new s.aN(f,t.u_matrix),u_label_plane_matrix:new s.aN(f,t.u_label_plane_matrix),u_coord_matrix:new s.aN(f,t.u_coord_matrix),u_is_text:new s.aL(f,t.u_is_text),u_pitch_with_map:new s.aL(f,t.u_pitch_with_map),u_texsize:new s.aQ(f,t.u_texsize),u_texsize_icon:new s.aQ(f,t.u_texsize_icon),u_texture:new s.aL(f,t.u_texture),u_texture_icon:new s.aL(f,t.u_texture_icon),u_gamma_scale:new s.aM(f,t.u_gamma_scale),u_device_pixel_ratio:new s.aM(f,t.u_device_pixel_ratio),u_is_halo:new s.aL(f,t.u_is_halo)}),background:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_opacity:new s.aM(f,t.u_opacity),u_color:new s.aR(f,t.u_color)}),backgroundPattern:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_opacity:new s.aM(f,t.u_opacity),u_image:new s.aL(f,t.u_image),u_pattern_tl_a:new s.aQ(f,t.u_pattern_tl_a),u_pattern_br_a:new s.aQ(f,t.u_pattern_br_a),u_pattern_tl_b:new s.aQ(f,t.u_pattern_tl_b),u_pattern_br_b:new s.aQ(f,t.u_pattern_br_b),u_texsize:new s.aQ(f,t.u_texsize),u_mix:new s.aM(f,t.u_mix),u_pattern_size_a:new s.aQ(f,t.u_pattern_size_a),u_pattern_size_b:new s.aQ(f,t.u_pattern_size_b),u_scale_a:new s.aM(f,t.u_scale_a),u_scale_b:new s.aM(f,t.u_scale_b),u_pixel_coord_upper:new s.aQ(f,t.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(f,t.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(f,t.u_tile_units_to_pixels)}),terrain:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_texture:new s.aL(f,t.u_texture),u_ele_delta:new s.aM(f,t.u_ele_delta)}),terrainDepth:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_ele_delta:new s.aM(f,t.u_ele_delta)}),terrainCoords:(f,t)=>({u_matrix:new s.aN(f,t.u_matrix),u_texture:new s.aL(f,t.u_texture),u_terrain_coords_id:new s.aM(f,t.u_terrain_coords_id),u_ele_delta:new s.aM(f,t.u_ele_delta)})};class Ks{constructor(t,n,u){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ys{constructor(t,n,u,p){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=p,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const p=n.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,n,u){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=n.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[fs[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wo=new WeakMap;function ho(f){var t;if(Wo.has(f))return Wo.get(f);{const n=(t=f.getParameter(f.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Wo.set(f,n),n}}class Qt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Js extends Qt{getDefault(){return s.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sn extends Qt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class an extends Qt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ga extends Qt{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $s extends Qt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Qs extends Qt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Xa extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Wa extends Qt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ea extends Qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ha extends Qt{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ka extends Qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class ta extends Qt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class wc extends Qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Sc extends Qt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ho extends Qt{getDefault(){return s.aT.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Zu extends Qt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Gu extends Qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Xu extends Qt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Wu extends Qt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Hu extends Qt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Ku extends Qt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ya extends Qt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ia extends Qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ja extends Qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class $a extends Qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ko extends Qt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Tc extends Qt{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class kc extends Qt{getDefault(){return null}set(t){var n;if(t===this.current&&!this.dirty)return;const u=this.gl;ho(u)?u.bindVertexArray(t):(n=u.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Qa extends Qt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ko extends Qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ic extends Qt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class po extends Qt{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class Yo extends po{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Mc extends po{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class el extends po{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ci{constructor(t,n,u,p,g){this.context=t,this.width=n,this.height=u;const x=t.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Yo(t,w),p)this.depthAttachment=g?new el(t,w):new Mc(t,w);else if(g)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,n=this.colorAttachment.get();if(n&&t.deleteTexture(n),this.depthAttachment){const u=this.depthAttachment.get();u&&t.deleteRenderbuffer(u)}t.deleteFramebuffer(this.framebuffer)}}class Li{constructor(t,n,u){this.blendFunction=t,this.blendColor=n,this.mask=u}}Li.Replace=[1,0],Li.disabled=new Li(Li.Replace,s.aT.transparent,[!1,!1,!1,!1]),Li.unblended=new Li(Li.Replace,s.aT.transparent,[!0,!0,!0,!0]),Li.alphaBlended=new Li([1,771],s.aT.transparent,[!0,!0,!0,!0]);class Yu{constructor(t){var n,u;if(this.gl=t,this.clearColor=new Js(this),this.clearDepth=new sn(this),this.clearStencil=new an(this),this.colorMask=new Ga(this),this.depthMask=new $s(this),this.stencilMask=new Qs(this),this.stencilFunc=new Xa(this),this.stencilOp=new Wa(this),this.stencilTest=new ea(this),this.depthRange=new Ha(this),this.depthTest=new Ka(this),this.depthFunc=new ta(this),this.blend=new wc(this),this.blendFunc=new Sc(this),this.blendColor=new Ho(this),this.blendEquation=new Zu(this),this.cullFace=new Gu(this),this.cullFaceSide=new Xu(this),this.frontFace=new Wu(this),this.program=new Hu(this),this.activeTexture=new Ku(this),this.viewport=new Ya(this),this.bindFramebuffer=new ia(this),this.bindRenderbuffer=new Ja(this),this.bindTexture=new $a(this),this.bindVertexBuffer=new Ko(this),this.bindElementBuffer=new Tc(this),this.bindVertexArray=new kc(this),this.pixelStoreUnpack=new Qa(this),this.pixelStoreUnpackPremultiplyAlpha=new ko(this),this.pixelStoreUnpackFlipY=new Ic(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ho(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=t.RGBA16F)!==null&&n!==void 0?n:p==null?void 0:p.RGBA16F_EXT,this.RGB16F=(u=t.RGB16F)!==null&&u!==void 0?u:p==null?void 0:p.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p==null?void 0:p.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n){return new Ks(this,t,n)}createVertexBuffer(t,n,u){return new Ys(this,t,n,u)}createRenderbuffer(t,n,u){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,n,u,p){return new ci(this,t,n,u,p)}clear({color:t,depth:n,stencil:u}){const p=this.gl;let g=0;t&&(g|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(g|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(g|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),p.clear(g)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.aG(t.blendFunction,Li.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ho(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var n;return ho(this.gl)?this.gl.deleteVertexArray(t):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class ei{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}ei.ReadOnly=!1,ei.ReadWrite=!0,ei.disabled=new ei(519,ei.ReadOnly,[0,1]);const Io=7680;class Di{constructor(t,n,u,p,g,x){this.test=t,this.ref=n,this.mask=u,this.fail=p,this.depthFail=g,this.pass=x}}Di.disabled=new Di({func:519,mask:0},0,0,Io,Io,Io);class Ei{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}let ms;function Cc(f,t,n,u,p,g,x){const w=f.context,k=w.gl,A=f.useProgram("collisionBox"),P=[];let z=0,O=0;for(let Q=0;Q<u.length;Q++){const ce=u[Q],Se=t.getTile(ce),ke=Se.getBucket(n);if(!ke)continue;let Le=ce.posMatrix;p[0]===0&&p[1]===0||(Le=f.translatePosMatrix(ce.posMatrix,Se,p,g));const je=x?ke.textCollisionBox:ke.iconCollisionBox,Ve=ke.collisionCircleArray;if(Ve.length>0){const We=s.Z(),ft=Le;s.aU(We,ke.placementInvProjMatrix,f.transform.glCoordMatrix),s.aU(We,We,ke.placementViewportMatrix),P.push({circleArray:Ve,circleOffset:O,transform:ft,invTransform:We,coord:ce}),z+=Ve.length/4,O=z}je&&A.draw(w,k.LINES,ei.disabled,Di.disabled,f.colorModeForRenderPass(),Ei.disabled,Va(Le,f.transform,Se),f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),n.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,f.transform.zoom,null,null,je.collisionVertexBuffer)}if(!x||!P.length)return;const X=f.useProgram("collisionCircle"),G=new s.aV;G.resize(4*z),G._trim();let K=0;for(const Q of P)for(let ce=0;ce<Q.circleArray.length/4;ce++){const Se=4*ce,ke=Q.circleArray[Se+0],Le=Q.circleArray[Se+1],je=Q.circleArray[Se+2],Ve=Q.circleArray[Se+3];G.emplace(K++,ke,Le,je,Ve,0),G.emplace(K++,ke,Le,je,Ve,1),G.emplace(K++,ke,Le,je,Ve,2),G.emplace(K++,ke,Le,je,Ve,3)}(!ms||ms.length<2*z)&&(ms=function(Q){const ce=2*Q,Se=new s.aX;Se.resize(ce),Se._trim();for(let ke=0;ke<ce;ke++){const Le=6*ke;Se.uint16[Le+0]=4*ke+0,Se.uint16[Le+1]=4*ke+1,Se.uint16[Le+2]=4*ke+2,Se.uint16[Le+3]=4*ke+2,Se.uint16[Le+4]=4*ke+3,Se.uint16[Le+5]=4*ke+0}return Se}(z));const j=w.createIndexBuffer(ms,!0),ae=w.createVertexBuffer(G,s.aW.members,!0);for(const Q of P){const ce={u_matrix:Q.transform,u_inv_matrix:Q.invTransform,u_camera_to_center_distance:(ge=f.transform).cameraToCenterDistance,u_viewport_size:[ge.width,ge.height]};X.draw(w,k.TRIANGLES,ei.disabled,Di.disabled,f.colorModeForRenderPass(),Ei.disabled,ce,f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q.coord),n.id,ae,j,s.S.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ge;ae.destroy(),j.destroy()}Ei.disabled=new Ei(!1,1029,2305),Ei.backCCW=new Ei(!0,1029,2305);const tl=s.ao(new Float32Array(16));function ra(f,t,n,u,p,g){const{horizontalAlign:x,verticalAlign:w}=s.au(f);return new s.P((-(x-.5)*t/p+u[0])*g,(-(w-.5)*n/p+u[1])*g)}function na(f,t,n,u,p,g,x,w,k,A,P){const z=f.text.placedSymbolArray,O=f.text.dynamicLayoutVertexArray,X=f.icon.dynamicLayoutVertexArray,G={};O.clear();for(let K=0;K<z.length;K++){const j=z.get(K),ae=j.hidden||!j.crossTileID||f.allowVerticalPlacement&&!j.placedOrientation?null:u[j.crossTileID];if(ae){const ge=new s.P(j.anchorX,j.anchorY),Q=Vi(ge,n?x:g,P),ce=wo(p.cameraToCenterDistance,Q.signedDistanceFromCamera);let Se=s.aj(f.textSizeData,k,j)*ce/s.ap;n&&(Se*=f.tilePixelRatio/w);const{width:ke,height:Le,anchor:je,textOffset:Ve,textBoxScale:We}=ae,ft=ra(je,ke,Le,Ve,We,Se),Kt=n?Vi(ge.add(ft),g,P).point:Q.point.add(t?ft.rotate(-p.angle):ft),tt=f.allowVerticalPlacement&&j.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Mt=0;Mt<j.numGlyphs;Mt++)s.ak(O,Kt,tt);A&&j.associatedIconIndex>=0&&(G[j.associatedIconIndex]={shiftedAnchor:Kt,angle:tt})}else U(j.numGlyphs,O)}if(A){X.clear();const K=f.icon.placedSymbolArray;for(let j=0;j<K.length;j++){const ae=K.get(j);if(ae.hidden)U(ae.numGlyphs,X);else{const ge=G[j];if(ge)for(let Q=0;Q<ae.numGlyphs;Q++)s.ak(X,ge.shiftedAnchor,ge.angle);else U(ae.numGlyphs,X)}}f.icon.dynamicLayoutVertexBuffer.updateData(X)}f.text.dynamicLayoutVertexBuffer.updateData(O)}function il(f,t,n){return n.iconsInText&&t?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function oa(f,t,n,u,p,g,x,w,k,A,P,z){const O=f.context,X=O.gl,G=f.transform,K=w==="map",j=k==="map",ae=w!=="viewport"&&n.layout.get("symbol-placement")!=="point",ge=K&&!j&&!ae,Q=!n.layout.get("symbol-sort-key").isConstant();let ce=!1;const Se=f.depthModeForSublayer(0,ei.ReadOnly),ke=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Le=[];for(const je of u){const Ve=t.getTile(je),We=Ve.getBucket(n);if(!We)continue;const ft=p?We.text:We.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const Kt=ft.programConfigurations.get(n.id),tt=p||We.sdfIcons,Mt=p?We.textSizeData:We.iconSizeData,_t=j||G.pitch!==0,yi=f.useProgram(il(tt,p,We),Kt),Wt=s.ah(Mt,G.zoom),Nt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(je);let Yt,Xi,Ii,wr,ar=[0,0],$i=null;if(p)Xi=Ve.glyphAtlasTexture,Ii=X.LINEAR,Yt=Ve.glyphAtlasTexture.size,We.iconsInText&&(ar=Ve.imageAtlasTexture.size,$i=Ve.imageAtlasTexture,wr=_t||f.options.rotating||f.options.zooming||Mt.kind==="composite"||Mt.kind==="camera"?X.LINEAR:X.NEAREST);else{const Wi=n.layout.get("icon-size").constantOr(0)!==1||We.iconsNeedLinear;Xi=Ve.imageAtlasTexture,Ii=tt||f.options.rotating||f.options.zooming||Wi||_t?X.LINEAR:X.NEAREST,Yt=Ve.imageAtlasTexture.size}const un=se(Ve,1,f.transform.zoom),Ci=Ye(je.posMatrix,j,K,f.transform,un),Nn=Fn(je.posMatrix,j,K,f.transform,un),Vn=ke&&We.hasTextData(),_o=n.layout.get("icon-text-fit")!=="none"&&Vn&&We.hasIconData();if(ae){const Wi=f.style.map.terrain?(Zr,Hi)=>f.style.map.terrain.getElevation(je,Zr,Hi):null,lr=n.layout.get("text-rotation-alignment")==="map";Qe(We,je.posMatrix,f,p,Ci,Nn,j,A,lr,Wi)}const Po=f.translatePosMatrix(je.posMatrix,Ve,g,x),rs=ae||p&&ke||_o?tl:Ci,Cr=f.translatePosMatrix(Nn,Ve,g,x,!0),Sr=tt&&n.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Fr;Fr=tt?We.iconsInText?To(Mt.kind,Wt,ge,j,f,Po,rs,Cr,Yt,ar):Za(Mt.kind,Wt,ge,j,f,Po,rs,Cr,p,Yt,!0):qa(Mt.kind,Wt,ge,j,f,Po,rs,Cr,p,Yt);const zo={program:yi,buffers:ft,uniformValues:Fr,atlasTexture:Xi,atlasTextureIcon:$i,atlasInterpolation:Ii,atlasInterpolationIcon:wr,isSDF:tt,hasHalo:Sr};if(Q&&We.canOverlap){ce=!0;const Wi=ft.segments.get();for(const lr of Wi)Le.push({segments:new s.S([lr]),sortKey:lr.sortKey,state:zo,terrainData:Nt})}else Le.push({segments:ft.segments,sortKey:0,state:zo,terrainData:Nt})}ce&&Le.sort((je,Ve)=>je.sortKey-Ve.sortKey);for(const je of Le){const Ve=je.state;if(O.activeTexture.set(X.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,X.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(O.activeTexture.set(X.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),Ve.isSDF){const We=Ve.uniformValues;Ve.hasHalo&&(We.u_is_halo=1,rl(Ve.buffers,je.segments,n,f,Ve.program,Se,P,z,We,je.terrainData)),We.u_is_halo=0}rl(Ve.buffers,je.segments,n,f,Ve.program,Se,P,z,Ve.uniformValues,je.terrainData)}}function rl(f,t,n,u,p,g,x,w,k,A){const P=u.context;p.draw(P,P.gl.TRIANGLES,g,x,w,Ei.disabled,k,A,n.id,f.layoutVertexBuffer,f.indexBuffer,t,n.paint,u.transform.zoom,f.programConfigurations.get(n.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function _s(f,t,n,u,p){if(!n||!u||!u.imageAtlas)return;const g=u.imageAtlas.patternPositions;let x=g[n.to.toString()],w=g[n.from.toString()];if(!x&&w&&(x=w),!w&&x&&(w=x),!x||!w){const k=p.getPaintProperty(t);x=g[k],w=g[k]}x&&w&&f.setConstantPatternPositions(x,w)}function gs(f,t,n,u,p,g,x){const w=f.context.gl,k="fill-pattern",A=n.paint.get(k),P=A&&A.constantOr(1),z=n.getCrossfadeParameters();let O,X,G,K,j;x?(X=P&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=w.LINES):(X=P?"fillPattern":"fill",O=w.TRIANGLES);const ae=A.constantOr(null);for(const ge of u){const Q=t.getTile(ge);if(P&&!Q.patternsLoaded())continue;const ce=Q.getBucket(n);if(!ce)continue;const Se=ce.programConfigurations.get(n.id),ke=f.useProgram(X,Se),Le=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ge);P&&(f.context.activeTexture.set(w.TEXTURE0),Q.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),Se.updatePaintBuffers(z)),_s(Se,k,ae,Q,n);const je=Le?ge:null,Ve=f.translatePosMatrix(je?je.posMatrix:ge.posMatrix,Q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(x){K=ce.indexBuffer2,j=ce.segments2;const We=[w.drawingBufferWidth,w.drawingBufferHeight];G=X==="fillOutlinePattern"&&P?Gs(Ve,f,z,Q,We):Zs(Ve,We)}else K=ce.indexBuffer,j=ce.segments,G=P?Na(Ve,f,z,Q):mc(Ve);ke.draw(f.context,O,p,f.stencilModeForClipping(ge),g,Ei.disabled,G,Le,n.id,ce.layoutVertexBuffer,K,j,n.paint,f.transform.zoom,Se)}}function ys(f,t,n,u,p,g,x){const w=f.context,k=w.gl,A="fill-extrusion-pattern",P=n.paint.get(A),z=P.constantOr(1),O=n.getCrossfadeParameters(),X=n.paint.get("fill-extrusion-opacity"),G=P.constantOr(null);for(const K of u){const j=t.getTile(K),ae=j.getBucket(n);if(!ae)continue;const ge=f.style.map.terrain&&f.style.map.terrain.getTerrainData(K),Q=ae.programConfigurations.get(n.id),ce=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",Q);z&&(f.context.activeTexture.set(k.TEXTURE0),j.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Q.updatePaintBuffers(O)),_s(Q,A,G,j,n);const Se=f.translatePosMatrix(K.posMatrix,j,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),ke=n.paint.get("fill-extrusion-vertical-gradient"),Le=z?co(Se,f,ke,X,K,O,j):Oa(Se,f,ke,X);ce.draw(w,w.gl.TRIANGLES,p,g,x,Ei.backCCW,Le,ge,n.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,n.paint,f.transform.zoom,Q,f.style.map.terrain&&ae.centroidVertexBuffer)}}function Ju(f,t,n,u,p,g,x){const w=f.context,k=w.gl,A=n.fbo;if(!A)return;const P=f.useProgram("hillshade"),z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(t);w.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,A.colorAttachment.get()),P.draw(w,k.TRIANGLES,p,g,x,Ei.disabled,((O,X,G,K)=>{const j=G.paint.get("hillshade-shadow-color"),ae=G.paint.get("hillshade-highlight-color"),ge=G.paint.get("hillshade-accent-color");let Q=G.paint.get("hillshade-illumination-direction")*(Math.PI/180);G.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=O.transform.angle);const ce=!O.options.moving;return{u_matrix:K?K.posMatrix:O.transform.calculatePosMatrix(X.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Ua(0,X.tileID),u_light:[G.paint.get("hillshade-exaggeration"),Q],u_shadow:j,u_highlight:ae,u_accent:ge}})(f,n,u,z?t:null),z,u.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function nl(f,t,n,u,p,g){const x=f.context,w=x.gl,k=t.dem;if(k&&k.data){const A=k.dim,P=k.stride,z=k.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(P),t.demTexture){const X=t.demTexture;X.update(z,{premultiply:!1}),X.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new He(x,z,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let O=t.fbo;if(!O){const X=new He(x,{width:A,height:A,data:null},w.RGBA);X.bind(w.LINEAR,w.CLAMP_TO_EDGE),O=t.fbo=x.createFramebuffer(A,A,!0,!1),O.colorAttachment.set(X.texture)}x.bindFramebuffer.set(O.framebuffer),x.viewport.set([0,0,A,A]),f.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,u,p,g,Ei.disabled,((X,G)=>{const K=G.stride,j=s.Z();return s.aS(j,0,s.N,-s.N,0,0,1),s.$(j,j,[0,-s.N,0]),{u_matrix:j,u_image:1,u_dimension:[K,K],u_zoom:X.overscaledZ,u_unpack:G.getUnpackVector()}})(t.tileID,k),null,n.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function $u(f,t,n,u,p,g){const x=u.paint.get("raster-fade-duration");if(!g&&x>0){const w=s.h.now(),k=(w-f.timeAdded)/x,A=t?(w-t.timeAdded)/x:-1,P=n.getSource(),z=p.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),O=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(f.tileID.overscaledZ-z),X=O&&f.refreshedUponExpiration?1:s.ad(O?k:1-A,0,1);return f.refreshedUponExpiration&&k>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}const Ac=new s.aT(1,0,0,1),sa=new s.aT(0,1,0,1),ol=new s.aT(0,0,1,1),Ec=new s.aT(1,0,1,1),Pc=new s.aT(0,1,1,1);function vs(f,t,n,u){la(f,0,t+n/2,f.transform.width,n,u)}function aa(f,t,n,u){la(f,t-n/2,0,n,f.transform.height,u)}function la(f,t,n,u,p,g){const x=f.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*f.pixelRatio,n*f.pixelRatio,u*f.pixelRatio,p*f.pixelRatio),x.clear({color:g}),w.disable(w.SCISSOR_TEST)}function zc(f,t,n){const u=f.context,p=u.gl,g=n.posMatrix,x=f.useProgram("debug"),w=ei.disabled,k=Di.disabled,A=f.colorModeForRenderPass(),P="$debug",z=f.style.map.terrain&&f.style.map.terrain.getTerrainData(n);u.activeTexture.set(p.TEXTURE0);const O=t.getTileByID(n.key).latestRawTileData,X=Math.floor((O&&O.byteLength||0)/1024),G=t.getTile(n).tileSize,K=512/Math.min(G,512)*(n.overscaledZ/f.transform.zoom)*.5;let j=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(j+=` => ${n.overscaledZ}`),function(ae,ge){ae.initDebugOverlayCanvas();const Q=ae.debugOverlayCanvas,ce=ae.context.gl,Se=ae.debugOverlayCanvas.getContext("2d");Se.clearRect(0,0,Q.width,Q.height),Se.shadowColor="white",Se.shadowBlur=2,Se.lineWidth=1.5,Se.strokeStyle="white",Se.textBaseline="top",Se.font="bold 36px Open Sans, sans-serif",Se.fillText(ge,5,5),Se.strokeText(ge,5,5),ae.debugOverlayTexture.update(Q),ae.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(f,`${j} ${X}kB`),x.draw(u,p.TRIANGLES,w,k,Li.alphaBlended,Ei.disabled,ps(g,s.aT.transparent,K),null,P,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),x.draw(u,p.LINE_STRIP,w,k,A,Ei.disabled,ps(g,s.aT.red),z,P,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function ji(f,t,n){const u=f.context,p=u.gl,g=f.colorModeForRenderPass(),x=new ei(p.LEQUAL,ei.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),k=t.getTerrainMesh();u.bindFramebuffer.set(null),u.viewport.set([0,0,f.width,f.height]);for(const A of n){const P=f.renderToTexture.getTexture(A),z=t.getTerrainData(A.tileID);u.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,P.texture);const O={u_matrix:f.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(f.transform.zoom)};w.draw(u,p.TRIANGLES,x,Di.disabled,g,Ei.backCCW,O,z,"terrain",k.vertexBuffer,k.indexBuffer,k.segments)}}class Mo{constructor(t,n){this.context=new Yu(t),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=vr.maxUnderzooming+vr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Us}resize(t,n,u){if(this.width=Math.floor(t*u),this.height=Math.floor(n*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,n=new s.a_;n.emplaceBack(0,0),n.emplaceBack(s.N,0),n.emplaceBack(0,s.N),n.emplaceBack(s.N,s.N),this.tileExtentBuffer=t.createVertexBuffer(n,js.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const u=new s.a_;u.emplaceBack(0,0),u.emplaceBack(s.N,0),u.emplaceBack(0,s.N),u.emplaceBack(s.N,s.N),this.debugBuffer=t.createVertexBuffer(u,js.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const p=new s.V;p.emplaceBack(0,0,0,0),p.emplaceBack(s.N,0,s.N,0),p.emplaceBack(0,s.N,0,s.N),p.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=t.createVertexBuffer(p,mi.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const g=new s.a_;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,js.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const x=new s.a$;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const k=this.context.gl;this.stencilClearMode=new Di({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)}clearStencil(){const t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=s.Z();s.aS(u,0,this.width,this.height,0,0,1),s.a0(u,u,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,ei.disabled,this.stencilClearMode,Li.disabled,Ei.disabled,_c(u),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,n){if(this.currentStencilSource===t.source||!t.isTileClipped()||!n||!n.length)return;this.currentStencilSource=t.source;const u=this.context,p=u.gl;this.nextStencilID+n.length>256&&this.clearStencil(),u.setColorMode(Li.disabled),u.setDepthMode(ei.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of n){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,k=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);g.draw(u,p.TRIANGLES,ei.disabled,new Di({func:p.ALWAYS,mask:0},w,255,p.KEEP,p.KEEP,p.REPLACE),Li.disabled,Ei.disabled,_c(x.posMatrix),k,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new Di({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){const n=this.context.gl;return new Di({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,u=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),p=u[u.length-1].overscaledZ,g=u[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let w=0;w<g;w++)x[w+p]=new Di({func:n.GEQUAL,mask:255},w+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=g,[x,u]}return[{[p]:Di.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Li([t.CONSTANT_COLOR,t.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Li.unblended:Li.alphaBlended}depthModeForSublayer(t,n,u){if(!this.opaquePassEnabledForLayer())return ei.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new ei(u||this.context.gl.LEQUAL,n,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,n){this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const u=this.style._order,p=this.style.sourceCaches,g={},x={},w={};for(const k in p){const A=p[k];A.used&&A.prepare(this.context),g[k]=A.getVisibleCoordinates(),x[k]=g[k].slice().reverse(),w[k]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<u.length;k++)if(this.style._layers[u[k]].is3D()){this.opaquePassCutoff=k;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const k=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,P){const z=A.context,O=z.gl,X=Li.unblended,G=new ei(O.LEQUAL,ei.ReadWrite,[0,1]),K=P.getTerrainMesh(),j=P.sourceCache.getRenderableTiles(),ae=A.useProgram("terrainDepth");z.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1});for(const ge of j){const Q=P.getTerrainData(ge.tileID),ce={u_matrix:A.transform.calculatePosMatrix(ge.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};ae.draw(z,O.TRIANGLES,G,Di.disabled,X,Ei.backCCW,ce,Q,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,P){const z=A.context,O=z.gl,X=Li.unblended,G=new ei(O.LEQUAL,ei.ReadWrite,[0,1]),K=P.getTerrainMesh(),j=P.getCoordsTexture(),ae=P.sourceCache.getRenderableTiles(),ge=A.useProgram("terrainCoords");z.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),z.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),z.clear({color:s.aT.transparent,depth:1}),P.coordsIndex=[];for(const Q of ae){const ce=P.getTerrainData(Q.tileID);z.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,j.texture);const Se={u_matrix:A.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};ge.draw(z,O.TRIANGLES,G,Di.disabled,X,Ei.backCCW,Se,ce,"terrain",K.vertexBuffer,K.indexBuffer,K.segments),P.coordsIndex.push(Q.tileID.key)}z.bindFramebuffer.set(null),z.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const k of u){const A=this.style._layers[k];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const P=x[A.source];(A.type==="custom"||P.length)&&this.renderLayer(this,p[A.source],A,P)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=u.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[u[this.currentLayer]],A=p[k.source],P=g[k.source];this._renderTileClippingMasks(k,P),this.renderLayer(this,A,k,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<u.length;this.currentLayer++){const k=this.style._layers[u[this.currentLayer]],A=p[k.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(k))continue;const P=(k.type==="symbol"?w:x)[k.source];this._renderTileClippingMasks(k,g[k.source]),this.renderLayer(this,A,k,P)}if(this.options.showTileBoundaries){const k=function(A,P){let z=null;const O=Object.values(A._layers).flatMap(j=>j.source&&!j.isHidden(P)?[A.sourceCaches[j.source]]:[]),X=O.filter(j=>j.getSource().type==="vector"),G=O.filter(j=>j.getSource().type!=="vector"),K=j=>{(!z||z.getSource().maxzoom<j.getSource().maxzoom)&&(z=j)};return X.forEach(j=>K(j)),z||G.forEach(j=>K(j)),z}(this.style,this.transform.zoom);k&&function(A,P,z){for(let O=0;O<z.length;O++)zc(A,P,z[O])}(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const A=k.transform.padding;vs(k,k.transform.height-(A.top||0),3,Ac),vs(k,A.bottom||0,3,sa),aa(k,A.left||0,3,ol),aa(k,k.transform.width-(A.right||0),3,Ec);const P=k.transform.centerPoint;(function(z,O,X,G){la(z,O-1,X-10,2,20,G),la(z,O-10,X-1,20,2,G)})(k,P.x,k.transform.height-P.y,Pc)}(this),this.context.setDefault()}renderLayer(t,n,u,p){if(!u.isHidden(this.transform.zoom)&&(u.type==="background"||u.type==="custom"||(p||[]).length))switch(this.id=u.id,u.type){case"symbol":(function(g,x,w,k,A){if(g.renderPass!=="translucent")return;const P=Di.disabled,z=g.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(O,X,G,K,j,ae,ge){const Q=X.transform,ce=j==="map",Se=ae==="map";for(const ke of O){const Le=K.getTile(ke),je=Le.getBucket(G);if(!je||!je.text||!je.text.segments.get().length)continue;const Ve=s.ah(je.textSizeData,Q.zoom),We=se(Le,1,X.transform.zoom),ft=Ye(ke.posMatrix,Se,ce,X.transform,We),Kt=G.layout.get("icon-text-fit")!=="none"&&je.hasIconData();if(Ve){const tt=Math.pow(2,Q.zoom-Le.tileID.overscaledZ);na(je,ce,Se,ge,Q,ft,ke.posMatrix,tt,Ve,Kt,X.style.map.terrain?(Mt,_t)=>X.style.map.terrain.getElevation(ke,Mt,_t):null)}}}(k,g,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),A),w.paint.get("icon-opacity").constantOr(1)!==0&&oa(g,x,w,k,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),P,z),w.paint.get("text-opacity").constantOr(1)!==0&&oa(g,x,w,k,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),P,z),x.map.showCollisionBoxes&&(Cc(g,x,w,k,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),Cc(g,x,w,k,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,n,u,p,this.style.placement.variableOffsets);break;case"circle":(function(g,x,w,k){if(g.renderPass!=="translucent")return;const A=w.paint.get("circle-opacity"),P=w.paint.get("circle-stroke-width"),z=w.paint.get("circle-stroke-opacity"),O=!w.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(P.constantOr(1)===0||z.constantOr(1)===0))return;const X=g.context,G=X.gl,K=g.depthModeForSublayer(0,ei.ReadOnly),j=Di.disabled,ae=g.colorModeForRenderPass(),ge=[];for(let Q=0;Q<k.length;Q++){const ce=k[Q],Se=x.getTile(ce),ke=Se.getBucket(w);if(!ke)continue;const Le=ke.programConfigurations.get(w.id),je=g.useProgram("circle",Le),Ve=ke.layoutVertexBuffer,We=ke.indexBuffer,ft=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce),Kt={programConfiguration:Le,program:je,layoutVertexBuffer:Ve,indexBuffer:We,uniformValues:uo(g,ce,Se,w),terrainData:ft};if(O){const tt=ke.segments.get();for(const Mt of tt)ge.push({segments:new s.S([Mt]),sortKey:Mt.sortKey,state:Kt})}else ge.push({segments:ke.segments,sortKey:0,state:Kt})}O&&ge.sort((Q,ce)=>Q.sortKey-ce.sortKey);for(const Q of ge){const{programConfiguration:ce,program:Se,layoutVertexBuffer:ke,indexBuffer:Le,uniformValues:je,terrainData:Ve}=Q.state;Se.draw(X,G.TRIANGLES,K,j,ae,Ei.disabled,je,Ve,w.id,ke,Le,Q.segments,w.paint,g.transform.zoom,ce)}})(t,n,u,p);break;case"heatmap":(function(g,x,w,k){if(w.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const A=g.context,P=A.gl,z=Di.disabled,O=new Li([P.ONE,P.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(X,G,K){const j=X.gl;X.activeTexture.set(j.TEXTURE1),X.viewport.set([0,0,G.width/4,G.height/4]);let ae=K.heatmapFbo;if(ae)j.bindTexture(j.TEXTURE_2D,ae.colorAttachment.get()),X.bindFramebuffer.set(ae.framebuffer);else{const ge=j.createTexture();j.bindTexture(j.TEXTURE_2D,ge),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),ae=K.heatmapFbo=X.createFramebuffer(G.width/4,G.height/4,!1,!1),function(Q,ce,Se,ke){var Le,je;const Ve=Q.gl,We=(Le=Q.HALF_FLOAT)!==null&&Le!==void 0?Le:Ve.UNSIGNED_BYTE,ft=(je=Q.RGBA16F)!==null&&je!==void 0?je:Ve.RGBA;Ve.texImage2D(Ve.TEXTURE_2D,0,ft,ce.width/4,ce.height/4,0,Ve.RGBA,We,null),ke.colorAttachment.set(Se)}(X,G,ge,ae)}})(A,g,w),A.clear({color:s.aT.transparent});for(let X=0;X<k.length;X++){const G=k[X];if(x.hasRenderableParent(G))continue;const K=x.getTile(G),j=K.getBucket(w);if(!j)continue;const ae=j.programConfigurations.get(w.id),ge=g.useProgram("heatmap",ae),{zoom:Q}=g.transform;ge.draw(A,P.TRIANGLES,ei.disabled,z,O,Ei.disabled,ju(G.posMatrix,K,Q,w.paint.get("heatmap-intensity")),null,w.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,w.paint,g.transform.zoom,ae)}A.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(A,P){const z=A.context,O=z.gl,X=P.heatmapFbo;if(!X)return;z.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,X.colorAttachment.get()),z.activeTexture.set(O.TEXTURE1);let G=P.colorRampTexture;G||(G=P.colorRampTexture=new He(z,P.colorRamp,O.RGBA)),G.bind(O.LINEAR,O.CLAMP_TO_EDGE),A.useProgram("heatmapTexture").draw(z,O.TRIANGLES,ei.disabled,Di.disabled,A.colorModeForRenderPass(),Ei.disabled,((K,j,ae,ge)=>{const Q=s.Z();s.aS(Q,0,K.width,K.height,0,0,1);const ce=K.context.gl;return{u_matrix:Q,u_world:[ce.drawingBufferWidth,ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}})(A,P),null,P.id,A.viewportBuffer,A.quadTriangleIndexBuffer,A.viewportSegments,P.paint,A.transform.zoom)}(g,w))})(t,n,u,p);break;case"line":(function(g,x,w,k){if(g.renderPass!=="translucent")return;const A=w.paint.get("line-opacity"),P=w.paint.get("line-width");if(A.constantOr(1)===0||P.constantOr(1)===0)return;const z=g.depthModeForSublayer(0,ei.ReadOnly),O=g.colorModeForRenderPass(),X=w.paint.get("line-dasharray"),G=w.paint.get("line-pattern"),K=G.constantOr(1),j=w.paint.get("line-gradient"),ae=w.getCrossfadeParameters(),ge=K?"linePattern":X?"lineSDF":j?"lineGradient":"line",Q=g.context,ce=Q.gl;let Se=!0;for(const ke of k){const Le=x.getTile(ke);if(K&&!Le.patternsLoaded())continue;const je=Le.getBucket(w);if(!je)continue;const Ve=je.programConfigurations.get(w.id),We=g.context.program.get(),ft=g.useProgram(ge,Ve),Kt=Se||ft.program!==We,tt=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ke),Mt=G.constantOr(null);if(Mt&&Le.imageAtlas){const Wt=Le.imageAtlas,Nt=Wt.patternPositions[Mt.to.toString()],Yt=Wt.patternPositions[Mt.from.toString()];Nt&&Yt&&Ve.setConstantPatternPositions(Nt,Yt)}const _t=tt?ke:null,yi=K?qu(g,Le,w,ae,_t):X?yc(g,Le,w,X,ae,_t):j?gc(g,Le,w,je.lineClipsArray.length,_t):ja(g,Le,w,_t);if(K)Q.activeTexture.set(ce.TEXTURE0),Le.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Ve.updatePaintBuffers(ae);else if(X&&(Kt||g.lineAtlas.dirty))Q.activeTexture.set(ce.TEXTURE0),g.lineAtlas.bind(Q);else if(j){const Wt=je.gradients[w.id];let Nt=Wt.texture;if(w.gradientVersion!==Wt.version){let Yt=256;if(w.stepInterpolant){const Xi=x.getSource().maxzoom,Ii=ke.canonical.z===Xi?Math.ceil(1<<g.transform.maxZoom-ke.canonical.z):1;Yt=s.ad(s.aY(je.maxLineLength/s.N*1024*Ii),256,Q.maxTextureSize)}Wt.gradient=s.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Yt,image:Wt.gradient||void 0,clips:je.lineClipsArray}),Wt.texture?Wt.texture.update(Wt.gradient):Wt.texture=new He(Q,Wt.gradient,ce.RGBA),Wt.version=w.gradientVersion,Nt=Wt.texture}Q.activeTexture.set(ce.TEXTURE0),Nt.bind(w.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}ft.draw(Q,ce.TRIANGLES,z,g.stencilModeForClipping(ke),O,Ei.disabled,yi,tt,w.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,w.paint,g.transform.zoom,Ve,je.layoutVertexBuffer2),Se=!1}})(t,n,u,p);break;case"fill":(function(g,x,w,k){const A=w.paint.get("fill-color"),P=w.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const z=g.colorModeForRenderPass(),O=w.paint.get("fill-pattern"),X=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&A.constantOr(s.aT.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===X){const G=g.depthModeForSublayer(1,g.renderPass==="opaque"?ei.ReadWrite:ei.ReadOnly);gs(g,x,w,k,G,z,!1)}if(g.renderPass==="translucent"&&w.paint.get("fill-antialias")){const G=g.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,ei.ReadOnly);gs(g,x,w,k,G,z,!0)}})(t,n,u,p);break;case"fill-extrusion":(function(g,x,w,k){const A=w.paint.get("fill-extrusion-opacity");if(A!==0&&g.renderPass==="translucent"){const P=new ei(g.context.gl.LEQUAL,ei.ReadWrite,g.depthRangeFor3D);if(A!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))ys(g,x,w,k,P,Di.disabled,Li.disabled),ys(g,x,w,k,P,g.stencilModeFor3D(),g.colorModeForRenderPass());else{const z=g.colorModeForRenderPass();ys(g,x,w,k,P,Di.disabled,z)}}})(t,n,u,p);break;case"hillshade":(function(g,x,w,k){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent")return;const A=g.context,P=g.depthModeForSublayer(0,ei.ReadOnly),z=g.colorModeForRenderPass(),[O,X]=g.renderPass==="translucent"?g.stencilConfigForOverlap(k):[{},k];for(const G of X){const K=x.getTile(G);K.needsHillshadePrepare!==void 0&&K.needsHillshadePrepare&&g.renderPass==="offscreen"?nl(g,K,w,P,Di.disabled,z):g.renderPass==="translucent"&&Ju(g,G,K,w,P,O[G.overscaledZ],z)}A.viewport.set([0,0,g.width,g.height])})(t,n,u,p);break;case"raster":(function(g,x,w,k){if(g.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!k.length)return;const A=g.context,P=A.gl,z=x.getSource(),O=g.useProgram("raster"),X=g.colorModeForRenderPass(),[G,K]=z instanceof Ht?[{},k]:g.stencilConfigForOverlap(k),j=K[K.length-1].overscaledZ,ae=!g.options.moving;for(const ge of K){const Q=g.depthModeForSublayer(ge.overscaledZ-j,w.paint.get("raster-opacity")===1?ei.ReadWrite:ei.ReadOnly,P.LESS),ce=x.getTile(ge);ce.registerFadeDuration(w.paint.get("raster-fade-duration"));const Se=x.findLoadedParent(ge,0),ke=$u(ce,Se,x,w,g.transform,g.style.map.terrain);let Le,je;const Ve=w.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;A.activeTexture.set(P.TEXTURE0),ce.texture.bind(Ve,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(P.TEXTURE1),Se?(Se.texture.bind(Ve,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Le=Math.pow(2,Se.tileID.overscaledZ-ce.tileID.overscaledZ),je=[ce.tileID.canonical.x*Le%1,ce.tileID.canonical.y*Le%1]):ce.texture.bind(Ve,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);const We=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ge),ft=We?ge:null,Kt=ft?ft.posMatrix:g.transform.calculatePosMatrix(ge.toUnwrapped(),ae),tt=bc(Kt,je||[0,0],Le||1,ke,w);z instanceof Ht?O.draw(A,P.TRIANGLES,Q,Di.disabled,X,Ei.disabled,tt,We,w.id,z.boundsBuffer,g.quadTriangleIndexBuffer,z.boundsSegments):O.draw(A,P.TRIANGLES,Q,G[ge.overscaledZ],X,Ei.disabled,tt,We,w.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments)}})(t,n,u,p);break;case"background":(function(g,x,w,k){const A=w.paint.get("background-color"),P=w.paint.get("background-opacity");if(P===0)return;const z=g.context,O=z.gl,X=g.transform,G=X.tileSize,K=w.paint.get("background-pattern");if(g.isPatternMissing(K))return;const j=!K&&A.a===1&&P===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==j)return;const ae=Di.disabled,ge=g.depthModeForSublayer(0,j==="opaque"?ei.ReadWrite:ei.ReadOnly),Q=g.colorModeForRenderPass(),ce=g.useProgram(K?"backgroundPattern":"background"),Se=k||X.coveringTiles({tileSize:G,terrain:g.style.map.terrain});K&&(z.activeTexture.set(O.TEXTURE0),g.imageManager.bind(g.context));const ke=w.getCrossfadeParameters();for(const Le of Se){const je=k?Le.posMatrix:g.transform.calculatePosMatrix(Le.toUnwrapped()),Ve=K?xn(je,P,g,K,{tileID:Le,tileSize:G},ke):Ws(je,P,A),We=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Le);ce.draw(z,O.TRIANGLES,ge,ae,Q,Ei.disabled,Ve,We,w.id,g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}})(t,0,u,p);break;case"custom":(function(g,x,w){const k=g.context,A=w.implementation;if(g.renderPass==="offscreen"){const P=A.prerender;P&&(g.setCustomLayerDefaults(),k.setColorMode(g.colorModeForRenderPass()),P.call(A,k.gl,g.transform.customLayerMatrix()),k.setDirty(),g.setBaseState())}else if(g.renderPass==="translucent"){g.setCustomLayerDefaults(),k.setColorMode(g.colorModeForRenderPass()),k.setStencilMode(Di.disabled);const P=A.renderingMode==="3d"?new ei(g.context.gl.LEQUAL,ei.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,ei.ReadOnly);k.setDepthMode(P),A.render(k.gl,g.transform.customLayerMatrix()),k.setDirty(),g.setBaseState(),k.bindFramebuffer.set(null)}})(t,0,u)}}translatePosMatrix(t,n,u,p,g){if(!u[0]&&!u[1])return t;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const A=Math.sin(x),P=Math.cos(x);u=[u[0]*P-u[1]*A,u[0]*A+u[1]*P]}const w=[g?u[0]:se(n,u[0],this.transform.zoom),g?u[1]:se(n,u[1],this.transform.zoom),0],k=new Float32Array(16);return s.$(k,t,w),k}saveTileTexture(t){const n=this._tileTextures[t.size[0]];n?n.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const n=this.imageManager.getPattern(t.from.toString()),u=this.imageManager.getPattern(t.to.toString());return!n||!u}useProgram(t,n){this.cache=this.cache||{};const u=t+(n?n.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[u]||(this.cache[u]=new qs(this.context,zi[t],n,Hs[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[u]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new He(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:n}=this.context.gl;return this.width!==t||this.height!==n}}class jr{constructor(t,n){this.points=t,this.planes=n}static fromInvProjectionMatrix(t,n,u){const p=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const k=1/(w=s.ag([],w,t))[3]/n*p;return s.b3(w,w,[k,k,1/w[3],k])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const k=function(O,X){var G=X[0],K=X[1],j=X[2],ae=G*G+K*K+j*j;return ae>0&&(ae=1/Math.sqrt(ae)),O[0]=X[0]*ae,O[1]=X[1]*ae,O[2]=X[2]*ae,O}([],function(O,X,G){var K=X[0],j=X[1],ae=X[2],ge=G[0],Q=G[1],ce=G[2];return O[0]=j*ce-ae*Q,O[1]=ae*ge-K*ce,O[2]=K*Q-j*ge,O}([],Ee([],g[w[0]],g[w[1]]),Ee([],g[w[2]],g[w[1]]))),A=-((P=k)[0]*(z=g[w[1]])[0]+P[1]*z[1]+P[2]*z[2]);var P,z;return k.concat(A)});return new jr(g,x)}}class Jo{constructor(t,n){this.min=t,this.max=n,this.center=function(u,p,g){return u[0]=.5*p[0],u[1]=.5*p[1],u[2]=.5*p[2],u}([],function(u,p,g){return u[0]=p[0]+g[0],u[1]=p[1]+g[1],u[2]=p[2]+g[2],u}([],this.min,this.max))}quadrant(t){const n=[t%2==0,t<2],u=le(this.min),p=le(this.max);for(let g=0;g<n.length;g++)u[g]=n[g]?this.min[g]:this.center[g],p[g]=n[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new Jo(u,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let u=!0;for(let p=0;p<t.planes.length;p++){const g=t.planes[p];let x=0;for(let w=0;w<n.length;w++)s.b4(g,n[w])>=0&&x++;if(x===0)return 0;x!==n.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const k=t.points[w][p]-this.min[p];g=Math.min(g,k),x=Math.max(x,k)}if(x<0||g>this.max[p]-this.min[p])return 0}return 1}}class bs{constructor(t=0,n=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=p}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=s.B.number(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.B.number(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=s.B.number(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=s.B.number(t.right,n.right,u)),this}getCenter(t,n){const u=s.ad((this.left+t-this.right)/2,0,t),p=s.ad((this.top+n-this.bottom)/2,0,n);return new s.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new bs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ca{constructor(t,n,u,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=u??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new bs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const t=new ca(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this._minEleveationForCurrentTile=t._minEleveationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const n=-s.b5(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var u=new s.A(4);return s.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}(),function(u,p,g){var x=p[0],w=p[1],k=p[2],A=p[3],P=Math.sin(g),z=Math.cos(g);u[0]=x*z+k*P,u[1]=w*z+A*P,u[2]=x*-P+k*z,u[3]=w*-P+A*z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=s.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this.tileZoom=Math.max(0,Math.floor(n)),this.scale=this.zoomScale(n),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new s.b6(0,t)];if(this._renderWorldCopies){const u=this.pointCoordinate(new s.P(0,0)),p=this.pointCoordinate(new s.P(this.width,0)),g=this.pointCoordinate(new s.P(this.width,this.height)),x=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(u.x,p.x,g.x,x.x)),k=Math.floor(Math.max(u.x,p.x,g.x,x.x)),A=1;for(let P=w-A;P<=k+A;P++)P!==0&&n.push(new s.b6(P,t))}return n}coveringTiles(t){var n,u;let p=this.coveringZoomLevel(t);const g=p;if(t.minzoom!==void 0&&p<t.minzoom)return[];t.maxzoom!==void 0&&p>t.maxzoom&&(p=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=s.U.fromLngLat(this.center),k=Math.pow(2,p),A=[k*x.x,k*x.y,0],P=[k*w.x,k*w.y,0],z=jr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let O=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(O=p);const X=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,G=Q=>({aabb:new Jo([Q*k,0,0],[(Q+1)*k,k,0]),zoom:0,x:0,y:0,wrap:Q,fullyVisible:!1}),K=[],j=[],ae=p,ge=t.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let Q=1;Q<=3;Q++)K.push(G(-Q)),K.push(G(Q));for(K.push(G(0));K.length>0;){const Q=K.pop(),ce=Q.x,Se=Q.y;let ke=Q.fullyVisible;if(!ke){const ft=Q.aabb.intersects(z);if(ft===0)continue;ke=ft===2}const Le=t.terrain?A:P,je=Q.aabb.distanceX(Le),Ve=Q.aabb.distanceY(Le),We=Math.max(Math.abs(je),Math.abs(Ve));if(Q.zoom===ae||We>X+(1<<ae-Q.zoom)-2&&Q.zoom>=O){const ft=ae-Q.zoom,Kt=A[0]-.5-(ce<<ft),tt=A[1]-.5-(Se<<ft);j.push({tileID:new s.O(Q.zoom===ae?ge:Q.zoom,Q.wrap,Q.zoom,ce,Se),distanceSq:Ie([P[0]-.5-ce,P[1]-.5-Se]),tileDistanceToCamera:Math.sqrt(Kt*Kt+tt*tt)})}else for(let ft=0;ft<4;ft++){const Kt=(ce<<1)+ft%2,tt=(Se<<1)+(ft>>1),Mt=Q.zoom+1;let _t=Q.aabb.quadrant(ft);if(t.terrain){const yi=new s.O(Mt,Q.wrap,Mt,Kt,tt),Wt=t.terrain.getMinMaxElevation(yi),Nt=(n=Wt.minElevation)!==null&&n!==void 0?n:this.elevation,Yt=(u=Wt.maxElevation)!==null&&u!==void 0?u:this.elevation;_t=new Jo([_t.min[0],_t.min[1],Nt],[_t.max[0],_t.max[1],Yt])}K.push({aabb:_t,zoom:Mt,x:Kt,y:tt,wrap:Q.wrap,fullyVisible:ke})}}return j.sort((Q,ce)=>Q.distanceSq-ce.distanceSq).map(Q=>Q.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=s.ad(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(t.lng)*this.worldSize,s.H(n)*this.worldSize)}unproject(t){return new s.U(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const n=this.pointLocation(this.centerPoint,t),u=t.getElevationForLngLatZoom(n,this.tileZoom);if(!(this.elevation-u))return;const p=this.getCameraPosition(),g=s.U.fromLngLat(p.lngLat,p.altitude),x=s.U.fromLngLat(n,u),w=g.x-x.x,k=g.y-x.y,A=g.z-x.z,P=Math.sqrt(w*w+k*k+A*A),z=this.scaleZoom(this.cameraToCenterDistance/P/this.tileSize);this._elevation=u,this._center=n,this.zoom=z}setLocationAtPoint(t,n){const u=this.pointCoordinate(n),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new s.U(g.x-(u.x-p.x),g.y-(u.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,n){return n?this.coordinatePoint(this.locationCoordinate(t),n.getElevationForLngLatZoom(t,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,n){return this.coordinateLocation(this.pointCoordinate(t,n))}locationCoordinate(t){return s.U.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,n){if(n){const O=n.pointCoordinate(t);if(O!=null)return O}const u=[t.x,t.y,0,1],p=[t.x,t.y,1,1];s.ag(u,u,this.pixelMatrixInverse),s.ag(p,p,this.pixelMatrixInverse);const g=u[3],x=p[3],w=u[1]/g,k=p[1]/x,A=u[2]/g,P=p[2]/x,z=A===P?0:(0-A)/(P-A);return new s.U(s.B.number(u[0]/g,p[0]/x,z)/this.worldSize,s.B.number(w,k,z)/this.worldSize)}coordinatePoint(t,n=0,u=this.pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,n,1];return s.ag(p,p,u),new s.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Rt().extend(this.pointLocation(new s.P(0,t))).extend(this.pointLocation(new s.P(this.width,t))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Rt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,n=!1){const u=t.key,p=n?this._alignedPosMatrixCache:this._posMatrixCache;if(p[u])return p[u];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),w=g.x+Math.pow(2,g.z)*t.wrap,k=s.ao(new Float64Array(16));return s.$(k,k,[w*x,g.y*x,0]),s.a0(k,k,[x/s.N,x/s.N,1]),s.a1(k,n?this.alignedProjMatrix:this.projMatrix,k),p[u]=new Float32Array(k),p[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,n,u,p,g=-90,x=90,w=-180,k=180;const A=this.size,P=this._unmodified;if(this.latRange){const X=this.latRange;g=s.H(X[1])*this.worldSize,x=s.H(X[0])*this.worldSize,t=x-g<A.y?A.y/(x-g):0}if(this.lngRange){const X=this.lngRange;w=s.b5(s.G(X[0])*this.worldSize,0,this.worldSize),k=s.b5(s.G(X[1])*this.worldSize,0,this.worldSize),k<w&&(k+=this.worldSize),n=k-w<A.x?A.x/(k-w):0}const z=this.point,O=Math.max(n||0,t||0);if(O)return this.center=this.unproject(new s.P(n?(k+w)/2:z.x,t?(x+g)/2:z.y)),this.zoom+=this.scaleZoom(O),this._unmodified=P,void(this._constraining=!1);if(this.latRange){const X=z.y,G=A.y/2;X-G<g&&(p=g+G),X+G>x&&(p=x-G)}if(this.lngRange){const X=(w+k)/2,G=s.b5(z.x,X-this.worldSize/2,X+this.worldSize/2),K=A.x/2;G-K<w&&(u=w+K),G+K>k&&(u=k-K)}u===void 0&&p===void 0||(this.center=this.unproject(new s.P(u!==void 0?u:z.x,p!==void 0?p:z.y)).wrap()),this._unmodified=P,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.point.x,u=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let p=s.ao(new Float64Array(16));s.a0(p,p,[this.width/2,-this.height/2,1]),s.$(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=s.ao(new Float64Array(16)),s.a0(p,p,[1,-1,1]),s.$(p,p,[-1,-1,0]),s.a0(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p;const g=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),x=Math.min(this.elevation,this._minEleveationForCurrentTile),w=g-x*this._pixelPerMeter/Math.cos(this._pitch),k=x<0?w:g,A=Math.PI/2+this._pitch,P=this._fov*(.5+t.y/this.height),z=Math.sin(P)*k/Math.sin(s.ad(Math.PI-A-P,.01,Math.PI-.01)),O=this.getHorizon(),X=2*Math.atan(O/this.cameraToCenterDistance)*(.5+t.y/(2*O)),G=Math.sin(X)*k/Math.sin(s.ad(Math.PI-A-X,.01,Math.PI-.01)),K=Math.min(z,G),j=1.01*(Math.cos(Math.PI/2-this._pitch)*K+k),ae=this.height/50;p=new Float64Array(16),s.b8(p,this._fov,this.width/this.height,ae,j),p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,s.a0(p,p,[1,-1,1]),s.$(p,p,[0,0,-this.cameraToCenterDistance]),s.b9(p,p,this._pitch),s.ae(p,p,this.angle),s.$(p,p,[-n,-u,0]),this.mercatorMatrix=s.a0([],p,[this.worldSize,this.worldSize,this.worldSize]),s.a0(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,p),s.$(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=s.as([],p),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,p);const ge=this.width%2/2,Q=this.height%2/2,ce=Math.cos(this.angle),Se=Math.sin(this.angle),ke=n-Math.round(n)+ce*ge+Se*Q,Le=u-Math.round(u)+ce*Q+Se*ge,je=new Float64Array(p);if(s.$(je,je,[ke>.5?ke-1:ke,Le>.5?Le-1:Le,0]),this.alignedProjMatrix=je,p=s.as(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new s.P(0,0)),n=[t.x*this.worldSize,t.y*this.worldSize,0,1];return s.ag(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}getCameraQueryGeometry(t){const n=this.getCameraPoint();if(t.length===1)return[t[0],n];{let u=n.x,p=n.y,g=n.x,x=n.y;for(const w of t)u=Math.min(u,w.x),p=Math.min(p,w.y),g=Math.max(g,w.x),x=Math.max(x,w.y);return[new s.P(u,p),new s.P(g,p),new s.P(g,x),new s.P(u,x),new s.P(u,p)]}}}function Co(f,t){let n,u=!1,p=null,g=null;const x=()=>{p=null,u&&(f.apply(g,n),p=setTimeout(x,t),u=!1)};return(...w)=>(u=!0,g=this,n=w,p||x(),p)}class xs{constructor(t){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let u;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(u=p)}),(u&&u[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(u))){const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}},this._updateHash=Co(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const n=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(n.lng*g)/g,w=Math.round(n.lat*g)/g,k=this._map.getBearing(),A=this._map.getPitch();let P="";if(P+=t?`/${x}/${w}/${u}`:`${u}/${w}/${x}`,(k||A)&&(P+="/"+Math.round(10*k)/10),A&&(P+=`/${Math.round(A)}`),this._hashName){const z=this._hashName;let O=!1;const X=window.location.hash.slice(1).split("&").map(G=>{const K=G.split("=")[0];return K===z?(O=!0,`${K}=${P}`):G}).filter(G=>G);return O||X.push(`${z}=${P}`),`#${X.join("&")}`}return`#${P}`}}const $o={linearity:.3,easing:s.ba(0,0,.3,1)},Lc=s.e({deceleration:2500,maxSpeed:1400},$o),Dc=s.e({deceleration:20,maxSpeed:1400},$o),Bc=s.e({deceleration:1e3,maxSpeed:360},$o),Fc=s.e({deceleration:1e3,maxSpeed:90},$o);class Rc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=s.h.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)n.zoom+=g.zoomDelta||0,n.bearing+=g.bearingDelta||0,n.pitch+=g.pitchDelta||0,g.panDelta&&n.pan._add(g.panDelta),g.around&&(n.around=g.around),g.pinchAround&&(n.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(n.pan.mag()){const g=ws(n.pan.mag(),u,s.e({},Lc,t||{}));p.offset=n.pan.mult(g.amount/n.pan.mag()),p.center=this._map.transform.center,On(p,g)}if(n.zoom){const g=ws(n.zoom,u,Dc);p.zoom=this._map.transform.zoom+g.amount,On(p,g)}if(n.bearing){const g=ws(n.bearing,u,Bc);p.bearing=this._map.transform.bearing+s.ad(g.amount,-179,179),On(p,g)}if(n.pitch){const g=ws(n.pitch,u,Fc);p.pitch=this._map.transform.pitch+g.amount,On(p,g)}if(p.zoom||p.bearing){const g=n.pinchAround===void 0?n.around:n.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),s.e(p,{noMoveStart:!0})}}function On(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function ws(f,t,n){const{maxSpeed:u,linearity:p,deceleration:g}=n,x=s.ad(f*p/(t/1e3),-u,u),w=Math.abs(x)/(g*p);return{easing:n.easing,duration:1e3*w,amount:x*(w/2)}}class ln extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,p={}){const g=I.mousePos(n.getCanvasContainer(),u),x=n.unproject(g);super(t,s.e({point:g,lngLat:x,originalEvent:u},p)),this._defaultPrevented=!1,this.target=n}}class Ss extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const p=t==="touchend"?u.changedTouches:u.touches,g=I.touchPos(n.getCanvasContainer(),p),x=g.map(k=>n.unproject(k)),w=g.reduce((k,A,P,z)=>k.add(A.div(z.length)),new s.P(0,0));super(t,{points:g,point:w,lngLats:x,lngLat:n.unproject(w),originalEvent:u}),this._defaultPrevented=!1}}class Oc extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){super(t,{originalEvent:u}),this._defaultPrevented=!1}}class Nc{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Oc(t.type,this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new ln(t.type,this._map,t))}mouseup(t){this._map.fire(new ln(t.type,this._map,t))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new ln(t.type,this._map,t))}dblclick(t){return this._firePreventable(new ln(t.type,this._map,t))}mouseover(t){this._map.fire(new ln(t.type,this._map,t))}mouseout(t){this._map.fire(new ln(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ss(t.type,this._map,t))}touchmove(t){this._map.fire(new Ss(t.type,this._map,t))}touchend(t){this._map.fire(new Ss(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ss(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vc{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new ln(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new ln(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qn{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(s.P.convert(t),this._map.terrain)}}class Uc{constructor(t,n){this._map=t,this._tr=new Qn(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(I.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=u,this._box||(this._box=I.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(p.x,u.x),x=Math.max(p.x,u.x),w=Math.min(p.y,u.y),k=Math.max(p.y,u.y);I.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=x-g+"px",this._box.style.height=k-w+"px"}mouseupWindow(t,n){if(!this._active||t.button!==0)return;const u=this._startPos,p=n;if(this.reset(),I.suppressClick(),u.x!==p.x||u.y!==p.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(I.remove(this._box),this._box=null),I.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.k(t,{originalEvent:n}))}}function wn(f,t){if(f.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${t.length}`);const n={};for(let u=0;u<f.length;u++)n[f[u].identifier]=t[u];return n}class eo{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const g=new s.P(0,0);for(const x of p)g._add(x);return g.div(p.length)}(n),this.touches=wn(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const p=wn(u,n);for(const g in this.touches){const x=p[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class ua{constructor(t){this.singleTap=new eo(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const p=this.singleTap.touchend(t,n,u);if(p){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class to{constructor(t){this._tr=new Qn(t),this._zoomIn=new ua({numTouches:1,numTaps:2}),this._zoomOut=new ua({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const p=this._zoomIn.touchend(t,n,u),g=this._zoomOut.touchend(t,n,u),x=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class io{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const n=this._moveFunction(...t);if(n.bearingDelta||n.pitchDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(t,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=n.length?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,n){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=n.length?n[0]:n;return!this._moved&&p.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(u,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&I.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qu={0:1,2:2};class sl{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const n=I.mouseButton(t);this._eventButton=n}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(n,u){const p=Qu[u];return n.buttons===void 0||(n.buttons&p)!==p}(t,this._eventButton)}isValidEndEvent(t){return I.mouseButton(t)===this._eventButton}}class jc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ha=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=function(t){t.preventDefault()}},Qo=({enable:f,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const u=new sl({checkCorrectEvent:p=>I.mouseButton(p)===0&&p.ctrlKey||I.mouseButton(p)===2});return new io({clickTolerance:t,move:(p,g)=>({bearingDelta:(g.x-p.x)*n}),moveStateManager:u,enable:f,assignEvents:ha})},ro=({enable:f,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const u=new sl({checkCorrectEvent:p=>I.mouseButton(p)===0&&p.ctrlKey||I.mouseButton(p)===2});return new io({clickTolerance:t,move:(p,g)=>({pitchDelta:(g.y-p.y)*n}),moveStateManager:u,enable:f,assignEvents:ha})};class ut{constructor(t,n){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._map._cooperativeGestures&&(this._minTouches===2&&u.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,u.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(u.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,n,u)}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const p=wn(u,n),g=new s.P(0,0),x=new s.P(0,0);let w=0;for(const A in p){const P=p[A],z=this._touches[A];z&&(g._add(P),x._add(P.sub(z)),w++,p[A]=P)}if(this._touches=p,w<this._minTouches||!x.mag())return;const k=x.div(w);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class da{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){if(!this._firstTwoTouches)return;t.preventDefault();const[p,g]=this._firstTwoTouches,x=fo(u,n,p),w=fo(u,n,g);if(!x||!w)return;const k=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],k,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=fo(u,n,p),w=fo(u,n,g);x&&w||(this._active&&I.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fo(f,t,n){for(let u=0;u<f.length;u++)if(f[u].identifier===n)return t[u]}function es(f,t){return Math.log(f/t)/Math.LN2}class qc extends da{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(es(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:es(this._distance,u),pinchAround:n}}}function nt(f,t){return 180*f.angleWith(t)/Math.PI}class al extends da{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const u=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nt(this._vector,u),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=nt(t,this._startVector);return Math.abs(u)<n}}function ll(f){return Math.abs(f.y)>Math.abs(f.x)}class eh extends da{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,n,u){super.touchstart(t,n,u),this._currentTouchCount=u.length}_start(t){this._lastPoints=t,ll(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,u.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=n.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=t.y>0==n.y>0;return ll(t)&&ll(n)&&x}}const cl={panStep:100,bearingStep:15,pitchStep:10};class Zc{constructor(t){this._tr=new Qn(t);const n=cl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,p=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:w=>{const k=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Gc,zoom:n?Math.round(k.zoom)+n*(t.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:k.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Gc(f){return f*(2-f)}const Xc=4.000244140625;class th{constructor(t,n){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=t,this._tr=new Qn(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=s.h.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%Xc==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=I.mousePos(this._el,t),u=this._tr;this._around=s.L.convert(this._aroundCenter?u.center:u.unproject(n)),this._aroundPoint=u.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Xc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&k!==0&&(k=1/k);const A=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(A*k))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,u=this._startZoom,p=this._easing;let g,x=!1;if(this._type==="wheel"&&u&&p){const w=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),k=p(w);g=s.B.number(u,n,k),w<1?this._frameId||(this._frameId=!0):x=!0}else g=n,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.bb;if(this._prevEase){const u=this._prevEase,p=(s.h.now()-u.start)/u.duration,g=u.easing(p+.01)-u.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-x*x);n=s.ba(x,w,.25,1)}return this._prevEase={start:s.h.now(),duration:t,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ul{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hl{constructor(t){this._tr=new Qn(t),this.reset()}reset(){this._active=!1}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dl{constructor(){this._tap=new ua({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,n,u){if(!this._swipePoint)if(this._tapTime){const p=n[0],g=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(p)<30;g&&x?u.length>0&&(this._swipePoint=p,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(t,n,u)}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=n[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const p=this._tap.touchend(t,n,u);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pl{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qr{constructor(t,n,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mo{constructor(t,n,u,p){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ts=f=>f.zoom||f.drag||f.pitch||f.rotate;class fl extends s.k{}function ks(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class ml{constructor(t,n){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,g)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=p.type==="renderFrame"?void 0:p,w={needsRenderFrame:!1},k={},A={},P=p.touches,z=P?this._getMapTouches(P):void 0,O=z?I.touchPos(this._el,z):I.mousePos(this._el,p);for(const{handlerName:K,handler:j,allowed:ae}of this._handlers){if(!j.isEnabled())continue;let ge;this._blockedByActive(A,ae,K)?j.reset():j[g||p.type]&&(ge=j[g||p.type](p,O,z),this.mergeHandlerResult(w,k,ge,K,x),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()),(ge||j.isActive())&&(A[K]=j)}const X={};for(const K in this._previousActiveHandlers)A[K]||(X[K]=x);this._previousActiveHandlers=A,(Object.keys(X).length||ks(w))&&(this._changes.push([w,k,X]),this._triggerRenderFrame()),(Object.keys(A).length||ks(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:G}=w;G&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],G(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rc(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners)I.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,n,u]of this._listeners)I.removeEventListener(t,n,t===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new Nc(n,t));const p=n.boxZoom=new Uc(n,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const g=new to(n),x=new hl(n);n.doubleClickZoom=new ul(x,g),this._add("tapZoom",g),this._add("clickZoom",x),t.interactive&&t.doubleClickZoom&&n.doubleClickZoom.enable();const w=new dl;this._add("tapDragZoom",w);const k=n.touchPitch=new eh(n);this._add("touchPitch",k),t.interactive&&t.touchPitch&&n.touchPitch.enable(t.touchPitch);const A=Qo(t),P=ro(t);n.dragRotate=new qr(t,A,P),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]),t.interactive&&t.dragRotate&&n.dragRotate.enable();const z=(({enable:ae,clickTolerance:ge})=>{const Q=new sl({checkCorrectEvent:ce=>I.mouseButton(ce)===0&&!ce.ctrlKey});return new io({clickTolerance:ge,move:(ce,Se)=>({around:Se,panDelta:Se.sub(ce)}),activateOnStart:!0,moveStateManager:Q,enable:ae,assignEvents:ha})})(t),O=new ut(t,n);n.dragPan=new pl(u,z,O),this._add("mousePan",z),this._add("touchPan",O,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&n.dragPan.enable(t.dragPan);const X=new al,G=new qc;n.touchZoomRotate=new mo(u,G,X,w),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&n.touchZoomRotate.enable(t.touchZoomRotate);const K=n.scrollZoom=new th(n,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),t.interactive&&t.scrollZoom&&n.scrollZoom.enable(t.scrollZoom);const j=n.keyboard=new Zc(n);this._add("keyboard",j),t.interactive&&t.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Vc(n))}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ts(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,n,u){for(const p in t)if(p!==u&&(!n||n.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}mergeHandlerResult(t,n,u,p,g){if(!u)return;s.e(t,u);const x={handlerName:p,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(n.zoom=x),u.panDelta!==void 0&&(n.drag=x),u.pitchDelta!==void 0&&(n.pitch=x),u.bearingDelta!==void 0&&(n.rotate=x)}_applyChanges(){const t={},n={},u={};for(const[p,g,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),s.e(n,g),s.e(u,x);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const p=this._map,g=p._getTransformForUpdate(),x=p.terrain;if(!(ks(t)||x&&this._terrainMovement))return this._fireEvents(n,u,!0);let{panDelta:w,zoomDelta:k,bearingDelta:A,pitchDelta:P,around:z,pinchAround:O}=t;O!==void 0&&(z=O),p._stop(!0),z=z||p.transform.centerPoint;const X=g.pointLocation(w?z.sub(w):z);A&&(g.bearing+=A),P&&(g.pitch+=P),k&&(g.zoom+=k),x?this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?g.center=g.pointLocation(g.centerPoint.sub(w)):g.setLocationAtPoint(X,z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,g.setLocationAtPoint(X,z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,g.recalculateZoom(p.terrain)})):g.setLocationAtPoint(X,z),p._applyUpdatedTransform(g),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_fireEvents(t,n,u){const p=Ts(this._eventsInProgress),g=Ts(t),x={};for(const P in t){const{originalEvent:z}=t[P];this._eventsInProgress[P]||(x[`${P}start`]=z),this._eventsInProgress[P]=t[P]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const P in x)this._fireEvent(P,x[P]);g&&this._fireEvent("move",g.originalEvent);for(const P in t){const{originalEvent:z}=t[P];this._fireEvent(P,z)}const w={};let k;for(const P in this._eventsInProgress){const{handlerName:z,originalEvent:O}=this._eventsInProgress[P];this._handlersById[z].isActive()||(delete this._eventsInProgress[P],k=n[z]||O,w[`${P}end`]=k)}for(const P in w)this._fireEvent(P,w[P]);const A=Ts(this._eventsInProgress);if(u&&(p||g)&&!A){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!P||!P.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:k})),z(this._map.getBearing())&&this._map.resetNorth()):(z(P.bearing||this._map.getBearing())&&(P.bearing=0),P.freezeElevation=!0,this._map.easeTo(P,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.k(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new fl("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Wc extends s.E{constructor(t,n){super(),this._renderFrameCallback=()=>{const u=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,u){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.e({offset:t},n),u)}panTo(t,n,u){return this.easeTo(s.e({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(s.e({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(s.e({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,s.e({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=Rt.convert(t);const u=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),u,n)}_cameraForBoxAndBearing(t,n,u,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=s.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const Se=p.padding;p.padding={top:Se,bottom:Se,right:Se,left:Se}}p.padding=s.e(g,p.padding);const x=this.transform,w=x.padding,k=x.project(s.L.convert(t)),A=x.project(s.L.convert(n)),P=k.rotate(-u*Math.PI/180),z=A.rotate(-u*Math.PI/180),O=new s.P(Math.max(P.x,z.x),Math.max(P.y,z.y)),X=new s.P(Math.min(P.x,z.x),Math.min(P.y,z.y)),G=O.sub(X),K=(x.width-(w.left+w.right+p.padding.left+p.padding.right))/G.x,j=(x.height-(w.top+w.bottom+p.padding.top+p.padding.bottom))/G.y;if(j<0||K<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ae=Math.min(x.scaleZoom(x.scale*Math.min(K,j)),p.maxZoom),ge=s.P.convert(p.offset),Q=new s.P((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(u*Math.PI/180),ce=ge.add(Q).mult(x.scale/x.zoomScale(ae));return{center:x.unproject(k.add(A).div(2).sub(ce)),zoom:ae,bearing:u}}fitBounds(t,n,u){return this._fitInternal(this.cameraForBounds(t,n),n,u)}fitScreenCoordinates(t,n,u,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(t)),this.transform.pointLocation(s.P.convert(n)),u,p),p,g)}_fitInternal(t,n,u){return t?(delete(n=s.e(t,n)).padding,n.linear?this.easeTo(n,u):this.flyTo(n,u)):this}jumpTo(t,n){this.stop();const u=this._getTransformForUpdate();let p=!1,g=!1,x=!1;return"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=s.L.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(x=!0,u.pitch=+t.pitch),t.padding==null||u.isPaddingEqual(t.padding)||(u.padding=t.padding),this._applyUpdatedTransform(u),this.fire(new s.k("movestart",n)).fire(new s.k("move",n)),p&&this.fire(new s.k("zoomstart",n)).fire(new s.k("zoom",n)).fire(new s.k("zoomend",n)),g&&this.fire(new s.k("rotatestart",n)).fire(new s.k("rotate",n)).fire(new s.k("rotateend",n)),x&&this.fire(new s.k("pitchstart",n)).fire(new s.k("pitch",n)).fire(new s.k("pitchend",n)),this.fire(new s.k("moveend",n))}calculateCameraOptionsFromTo(t,n,u,p=0){const g=s.U.fromLngLat(t,n),x=s.U.fromLngLat(u,p),w=x.x-g.x,k=x.y-g.y,A=x.z-g.z,P=Math.hypot(w,k,A);if(P===0)throw new Error("Can't calculate camera options with same From and To");const z=Math.hypot(w,k),O=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),X=180*Math.atan2(w,-k)/Math.PI;let G=180*Math.acos(z/P)/Math.PI;return G=A<0?90-G:90+G,{center:x.toLngLat(),zoom:O,pitch:G,bearing:X}}easeTo(t,n){this._stop(!1,t.easeId),((t=s.e({offset:[0,0],duration:500,easing:s.bb},t)).animate===!1||!t.essential&&s.h.prefersReducedMotion)&&(t.duration=0);const u=this._getTransformForUpdate(),p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),k="zoom"in t?+t.zoom:p,A="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:u.padding,O=s.P.convert(t.offset);let X=u.centerPoint.add(O);const G=u.pointLocation(X),K=s.L.convert(t.center||G);this._normalizeCenter(K);const j=u.project(G),ae=u.project(K).sub(j),ge=u.zoomScale(k-p);let Q,ce;t.around&&(Q=s.L.convert(t.around),ce=u.locationPoint(Q));const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||k!==p,this._rotating=this._rotating||g!==A,this._pitching=this._pitching||P!==x,this._padding=!u.isPaddingEqual(z),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,Se),this.terrain&&this._prepareElevation(K),this._ease(ke=>{if(this._zooming&&(u.zoom=s.B.number(p,k,ke)),this._rotating&&(u.bearing=s.B.number(g,A,ke)),this._pitching&&(u.pitch=s.B.number(x,P,ke)),this._padding&&(u.interpolatePadding(w,z,ke),X=u.centerPoint.add(O)),this.terrain&&!t.freezeElevation&&this._updateElevation(ke),Q)u.setLocationAtPoint(Q,ce);else{const Le=u.zoomScale(u.zoom-p),je=k>p?Math.min(2,ge):Math.max(.5,ge),Ve=Math.pow(je,1-ke),We=u.unproject(j.add(ae.mult(ke*Ve)).mult(Le));u.setLocationAtPoint(u.renderWorldCopies?We.wrap():We,X)}this._applyUpdatedTransform(u),this._fireMoveEvents(n)},ke=>{this.terrain&&this._finalizeElevation(),this._afterEase(n,ke)},t),this}_prepareEase(t,n,u={}){this._moving=!0,n||u.moving||this.fire(new s.k("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.k("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.k("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.k("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&n!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(u-(n-(u*t+this._elevationStart))/(1-t)),this._elevationTarget=n}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const n=t.clone(),{center:u,zoom:p,pitch:g,bearing:x,elevation:w}=this.transformCameraUpdate(n);u&&(n.center=u),p!==void 0&&(n.zoom=p),g!==void 0&&(n.pitch=g),x!==void 0&&(n.bearing=x),w!==void 0&&(n.elevation=w),this.transform.apply(n)}_fireMoveEvents(t){this.fire(new s.k("move",t)),this._zooming&&this.fire(new s.k("zoom",t)),this._rotating&&this.fire(new s.k("rotate",t)),this._pitching&&this.fire(new s.k("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const u=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.k("zoomend",t)),p&&this.fire(new s.k("rotateend",t)),g&&this.fire(new s.k("pitchend",t)),this.fire(new s.k("moveend",t))}flyTo(t,n){if(!t.essential&&s.h.prefersReducedMotion){const _t=s.F(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(_t,n)}this.stop(),t=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},t);const u=this._getTransformForUpdate(),p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),k="zoom"in t?s.ad(+t.zoom,u.minZoom,u.maxZoom):p,A="bearing"in t?this._normalizeBearing(t.bearing,g):g,P="pitch"in t?+t.pitch:x,z="padding"in t?t.padding:u.padding,O=u.zoomScale(k-p),X=s.P.convert(t.offset);let G=u.centerPoint.add(X);const K=u.pointLocation(G),j=s.L.convert(t.center||K);this._normalizeCenter(j);const ae=u.project(K),ge=u.project(j).sub(ae);let Q=t.curve;const ce=Math.max(u.width,u.height),Se=ce/O,ke=ge.mag();if("minZoom"in t){const _t=s.ad(Math.min(t.minZoom,p,k),u.minZoom,u.maxZoom),yi=ce/u.zoomScale(_t-p);Q=Math.sqrt(yi/ke*2)}const Le=Q*Q;function je(_t){const yi=(Se*Se-ce*ce+(_t?-1:1)*Le*Le*ke*ke)/(2*(_t?Se:ce)*Le*ke);return Math.log(Math.sqrt(yi*yi+1)-yi)}function Ve(_t){return(Math.exp(_t)-Math.exp(-_t))/2}function We(_t){return(Math.exp(_t)+Math.exp(-_t))/2}const ft=je(!1);let Kt=function(_t){return We(ft)/We(ft+Q*_t)},tt=function(_t){return ce*((We(ft)*(Ve(yi=ft+Q*_t)/We(yi))-Ve(ft))/Le)/ke;var yi},Mt=(je(!0)-ft)/Q;if(Math.abs(ke)<1e-6||!isFinite(Mt)){if(Math.abs(ce-Se)<1e-6)return this.easeTo(t,n);const _t=Se<ce?-1:1;Mt=Math.abs(Math.log(Se/ce))/Q,tt=function(){return 0},Kt=function(yi){return Math.exp(_t*Q*yi)}}return t.duration="duration"in t?+t.duration:1e3*Mt/("screenSpeed"in t?+t.screenSpeed/Q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==A,this._pitching=P!==x,this._padding=!u.isPaddingEqual(z),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(j),this._ease(_t=>{const yi=_t*Mt,Wt=1/Kt(yi);u.zoom=_t===1?k:p+u.scaleZoom(Wt),this._rotating&&(u.bearing=s.B.number(g,A,_t)),this._pitching&&(u.pitch=s.B.number(x,P,_t)),this._padding&&(u.interpolatePadding(w,z,_t),G=u.centerPoint.add(X)),this.terrain&&!t.freezeElevation&&this._updateElevation(_t);const Nt=_t===1?j:u.unproject(ae.add(ge.mult(tt(yi))).mult(Wt));u.setLocationAtPoint(u.renderWorldCopies?Nt.wrap():Nt,G),this._applyUpdatedTransform(u),this._fireMoveEvents(n)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(n)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,n)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=s.h.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,n){t=s.b5(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(!n.renderWorldCopies||n.lngRange)return;const u=t.lng-n.center.lng;t.lng+=u>180?-360:u<-180?360:0}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(t),this.transform.tileZoom)-this.transform.elevation:null}}class cn{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=I.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=I.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=I.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){I.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,n){const u=this._map._getUIString(`AttributionControl.${n}`);t.title=u,t.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const n=this._map.style.sourceCaches;for(const p in n){const g=n[p];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0});const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Mi{constructor(t={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const u=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=I.create("div","maplibregl-ctrl");const n=I.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){I.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const _l={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Hc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Kc extends s.E{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,n){this.sourceCache.update(t,n),this._renderableTilesKeys=[];const u={};for(const p of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))u[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),s.aS(p.posMatrix,0,s.N,0,s.N,0,1),this._tiles[p.key]=new zr(p,this.tileSize));for(const p in this._tiles)u[p]||delete this._tiles[p]}freeRtt(t){for(const n in this._tiles){const u=this._tiles[n];(!t||u.tileID.equals(t)||u.tileID.isChildOf(t)||t.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const n={};for(const u of this._renderableTilesKeys){const p=this._tiles[u].tileID;if(p.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),s.aS(g.posMatrix,0,s.N,0,s.N,0,1),n[u]=g}else if(p.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=p.canonical.z-t.canonical.z,w=p.canonical.x-(p.canonical.x>>x<<x),k=p.canonical.y-(p.canonical.y>>x<<x),A=s.N>>x;s.aS(g.posMatrix,0,A,0,A,0,1),s.$(g.posMatrix,g.posMatrix,[-w*A,-k*A,0]),n[u]=g}else if(t.canonical.isChildOf(p.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-p.canonical.z,w=t.canonical.x-(t.canonical.x>>x<<x),k=t.canonical.y-(t.canonical.y>>x<<x),A=s.N>>x;s.aS(g.posMatrix,0,s.N,0,s.N,0,1),s.$(g.posMatrix,g.posMatrix,[w*A,k*A,0]),s.a0(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),n[u]=g}}return n}getSourceTile(t,n){const u=this.sourceCache._source;let p=t.overscaledZ-this.deltaZoom;if(p>u.maxzoom&&(p=u.maxzoom),p<u.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&n)for(;p>=u.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(p--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(n=>n.timeAdded>=t)}}class Yc{constructor(t,n,u){this.painter=t,this.sourceCache=new Kc(n),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,n,u,p=s.N){var g;if(!(n>=0&&n<p&&u>=0&&u<p))return 0;const x=this.getTerrainData(t),w=(g=x.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;const k=function(G,K,j){var ae=K[0],ge=K[1];return G[0]=j[0]*ae+j[4]*ge+j[12],G[1]=j[1]*ae+j[5]*ge+j[13],G}([],[n/p*s.N,u/p*s.N],x.u_terrain_matrix),A=[k[0]*w.dim,k[1]*w.dim],P=Math.floor(A[0]),z=Math.floor(A[1]),O=A[0]-P,X=A[1]-z;return w.get(P,z)*(1-O)*(1-X)+w.get(P+1,z)*O*(1-X)+w.get(P,z+1)*(1-O)*X+w.get(P+1,z+1)*O*X}getElevationForLngLatZoom(t,n){const{tileID:u,mercatorX:p,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(t,n);return this.getElevation(u,p%s.N,g%s.N,s.N)}getElevation(t,n,u,p=s.N){return this.getDEMElevation(t,n,u,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,g=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new He(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new He(p,new s.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const n=this.sourceCache.getSourceTile(t,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const p=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new He(p,n.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),n.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const u=n&&n+n.tileID.key+t.key;if(u&&!this._demMatrixCache[u]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-n.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?g=t.canonical.z-p:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),w=t.canonical.y-(t.canonical.y>>g<<g),k=s.bc(new Float64Array(16),[1/(s.N<<g),1/(s.N<<g),0]);s.$(k,k,[x*s.N,w*s.N,0]),this._demMatrixCache[t.key]={matrix:k,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(t){const n=this.painter,u=n.width/devicePixelRatio,p=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new He(n.context,{width:u,height:p,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new He(n.context,{width:u,height:p,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(u,p,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,u,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)n[x+0]=255&w,n[x+1]=255&g,n[x+2]=w>>8<<4|g>>8,n[x+3]=0;const u=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),p=new He(t,u,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){const n=new Uint8Array(4),u=this.painter.context,p=u.gl;u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,n),u.bindFramebuffer.set(null);const g=n[0]+(n[2]>>4<<8),x=n[1]+((15&n[2])<<8),w=this.coordsIndex[255-n[3]],k=w&&this.sourceCache.getTileByID(w);if(!k)return null;const A=this._coordsTextureSize,P=(1<<k.tileID.canonical.z)*A;return new s.U(this._allowMercatorOverflow(t,(k.tileID.canonical.x*A+g)/P),(k.tileID.canonical.y*A+x)/P,this.getElevation(k.tileID,g,x,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,n=new s.bd,u=new s.b0,p=this.meshSize,g=s.N/p,x=p*p;for(let z=0;z<=p;z++)for(let O=0;O<=p;O++)n.emplaceBack(O*g,z*g,0);for(let z=0;z<x;z+=p+1)for(let O=0;O<p;O++)u.emplaceBack(O+z,p+O+z+1,p+O+z+2),u.emplaceBack(O+z,p+O+z+2,O+z+1);const w=n.length,k=w+2*(p+1);for(const z of[0,1])for(let O=0;O<=p;O++)for(const X of[0,1])n.emplaceBack(O*g,z*s.N,X);for(let z=0;z<2*p;z+=2)u.emplaceBack(k+z,k+z+1,k+z+3),u.emplaceBack(k+z,k+z+3,k+z+2),u.emplaceBack(w+z,w+z+3,w+z+1),u.emplaceBack(w+z,w+z+2,w+z+3);const A=n.length,P=A+2*(p+1);for(const z of[0,1])for(let O=0;O<=p;O++)for(const X of[0,1])n.emplaceBack(z*s.N,O*g,X);for(let z=0;z<2*p;z+=2)u.emplaceBack(A+z,A+z+1,A+z+3),u.emplaceBack(A+z,A+z+3,A+z+2),u.emplaceBack(P+z,P+z+3,P+z+1),u.emplaceBack(P+z,P+z+2,P+z+3);return this._mesh={indexBuffer:t.createIndexBuffer(u),vertexBuffer:t.createVertexBuffer(n,Hc.members),segments:s.S.simpleSegment(0,0,n.length,u.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*s.be/Math.pow(2,t)/5}getMinTileElevationForLngLatZoom(t,n){var u;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,n);return(u=this.getMinMaxElevation(p).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(t){const n=this.getTerrainData(t).tile,u={minElevation:null,maxElevation:null};return n&&n.dem&&(u.minElevation=n.dem.min*this.exaggeration,u.maxElevation=n.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(t,n){const u=s.U.fromLngLat(t.wrap()),p=(1<<n)*s.N,g=u.x*p,x=u.y*p,w=Math.floor(g/s.N),k=Math.floor(x/s.N);return{tileID:new s.O(n,0,n,w,k),mercatorX:g,mercatorY:x}}_allowMercatorOverflow(t,n){const u=t.x<this.painter.width/2;let p=s.bf(n);const g=this.painter.transform.center.lng;return u&&Math.sign(p)>0&&Math.sign(g)<0||!u&&Math.sign(p)<0&&Math.sign(g)>0?(p=360*Math.sign(g)+p,s.G(p)):n}}class ih{constructor(t,n,u){this._context=t,this._size=n,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new He(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(u.texture),{id:t,fbo:n,texture:u,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>t.id!==n),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Br={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class fa{constructor(t,n){this.painter=t,this.terrain=n,this.pool=new ih(t.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(u=>!t._layers[u].isHidden(n)),this._coordsDescendingInv={};for(const u in t.sourceCaches){this._coordsDescendingInv[u]={};const p=t.sourceCaches[u].getVisibleCoordinates();for(const g of p){const x=this.terrain.sourceCache.getTerrainCoords(g);for(const w in x)this._coordsDescendingInv[u][w]||(this._coordsDescendingInv[u][w]=[]),this._coordsDescendingInv[u][w].push(x[w])}}this._coordsDescendingInvStr={};for(const u of t._order){const p=t._layers[u],g=p.source;if(Br[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(w=>w.key).sort().join()}}for(const u of this._renderableTiles)for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][u.tileID.key];g&&g!==u.rttCoords[p]&&(u.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const n=t.type,u=this.painter,p=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Br[n]&&(this._prevType&&Br[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(t.id),!p))return!0;if(Br[this._prevType]||Br[n]&&p){this._prevType=n;const g=this._stacks.length-1,x=this._stacks[g]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(ji(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[g]){const A=this.pool.getObjectForId(w.rtt[g].id);if(A.stamp===w.rtt[g].stamp){this.pool.useObject(A);continue}}const k=this.pool.getOrCreateFreeObject();this.pool.useObject(k),this.pool.stampObject(k),w.rtt[g]={id:k.id,stamp:k.stamp},u.context.bindFramebuffer.set(k.fbo.framebuffer),u.context.clear({color:s.aT.transparent,stencil:0}),u.currentStencilSource=void 0;for(let A=0;A<x.length;A++){const P=u.style._layers[x[A]],z=P.source?this._coordsDescendingInv[P.source][w.tileID.key]:[w.tileID];u.context.viewport.set([0,0,k.fbo.width,k.fbo.height]),u._renderTileClippingMasks(P,z),u.renderLayer(u,u.style.sourceCaches[P.source],P,z),P.source&&(w.rttCoords[P.source]=this._coordsDescendingInvStr[P.source][w.tileID.key])}}return ji(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Br[n]}return!1}}const bt=C,It={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Is=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},gl={showCompass:!0,showZoom:!0,visualizePitch:!1};class yl{constructor(t,n,u=!1){this.mousedown=x=>{this.startMouse(s.e({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),I.mousePos(this.element,x)),I.addEventListener(window,"mousemove",this.mousemove),I.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,I.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=I.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),I.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=I.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const p=t.dragRotate._mouseRotate.getClickTolerance(),g=t.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Qo({clickTolerance:p,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:k=.8})=>{const A=new jc;return new io({clickTolerance:w,move:(P,z)=>({bearingDelta:(z.x-P.x)*k}),moveStateManager:A,enable:x,assignEvents:Is})})({clickTolerance:p,enable:!0}),this.map=t,u&&(this.mousePitch=ro({clickTolerance:g,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:k=-.5})=>{const A=new jc;return new io({clickTolerance:w,move:(P,z)=>({pitchDelta:(z.y-P.y)*k}),moveStateManager:A,enable:x,assignEvents:Is})})({clickTolerance:g,enable:!0})),I.addEventListener(n,"mousedown",this.mousedown),I.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),I.addEventListener(n,"touchcancel",this.reset)}startMouse(t,n){this.mouseRotate.dragStart(t,n),this.mousePitch&&this.mousePitch.dragStart(t,n),I.disableDrag()}startTouch(t,n){this.touchRotate.dragStart(t,n),this.touchPitch&&this.touchPitch.dragStart(t,n),I.disableDrag()}moveMouse(t,n){const u=this.map,{bearingDelta:p}=this.mouseRotate.dragMove(t,n)||{};if(p&&u.setBearing(u.getBearing()+p),this.mousePitch){const{pitchDelta:g}=this.mousePitch.dragMove(t,n)||{};g&&u.setPitch(u.getPitch()+g)}}moveTouch(t,n){const u=this.map,{bearingDelta:p}=this.touchRotate.dragMove(t,n)||{};if(p&&u.setBearing(u.getBearing()+p),this.touchPitch){const{pitchDelta:g}=this.touchPitch.dragMove(t,n)||{};g&&u.setPitch(u.getPitch()+g)}}off(){const t=this.element;I.removeEventListener(t,"mousedown",this.mousedown),I.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend),I.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){I.enableDrag(),I.removeEventListener(window,"mousemove",this.mousemove),I.removeEventListener(window,"mouseup",this.mouseup),I.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),I.removeEventListener(window,"touchend",this.touchend)}}let Ji;function vl(f,t,n){if(f=new s.L(f.lng,f.lat),t){const u=new s.L(f.lng-360,f.lat),p=new s.L(f.lng+360,f.lat),g=n.locationPoint(f).distSqr(t);n.locationPoint(u).distSqr(t)<g?f=u:n.locationPoint(p).distSqr(t)<g&&(f=p)}for(;Math.abs(f.lng-n.center.lng)>180;){const u=n.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;f.lng>n.center.lng?f.lng-=360:f.lng+=360}return f}const Sn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jc(f,t,n){const u=f.classList;for(const p in Sn)u.remove(`maplibregl-${n}-anchor-${p}`);u.add(`maplibregl-${n}-anchor-${t}`)}class Ao extends s.E{constructor(t){if(super(),this._onKeyPress=n=>{const u=n.code,p=n.charCode||n.keyCode;u!=="Space"&&u!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=n=>{const u=n.originalEvent.target,p=this._element;this._popup&&(u===p||p.contains(u))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((n==null?void 0:n.type)==="terrain"||(n==null?void 0:n.type)==="render"&&!u)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=vl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),I.setTransform(this._element,`${Sn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${g} ${p}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const x=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=x.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=n=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=I.create("div"),this._element.setAttribute("aria-label","Map marker");const n=I.createNS("http://www.w3.org/2000/svg","svg"),u=41,p=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${u}px`),n.setAttributeNS(null,"width",`${p}px`),n.setAttributeNS(null,"viewBox",`0 0 ${p} ${u}`);const g=I.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");const x=I.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=I.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of k){const ge=I.createNS("http://www.w3.org/2000/svg","ellipse");ge.setAttributeNS(null,"opacity","0.04"),ge.setAttributeNS(null,"cx","10.5"),ge.setAttributeNS(null,"cy","5.80029008"),ge.setAttributeNS(null,"rx",ae.rx),ge.setAttributeNS(null,"ry",ae.ry),w.appendChild(ge)}const A=I.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const P=I.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(P);const z=I.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"opacity","0.25"),z.setAttributeNS(null,"fill","#000000");const O=I.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),z.appendChild(O);const X=I.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"transform","translate(6.0, 7.0)"),X.setAttributeNS(null,"fill","#FFFFFF");const G=I.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=I.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const j=I.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#FFFFFF"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962"),G.appendChild(K),G.appendChild(j),x.appendChild(w),x.appendChild(A),x.appendChild(z),x.appendChild(X),x.appendChild(G),n.appendChild(x),n.setAttributeNS(null,"height",u*this._scale+"px"),n.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(n),this._offset=s.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Jc(this._element,this._anchor,"marker"),t&&t.className)for(const n of t.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),I.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.L.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const qi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Bi=0,ts=!1;const Ms={maxWidth:100,unit:"metric"};function Cs(f,t,n){const u=n&&n.maxWidth||100,p=f._container.clientHeight/2,g=f.unproject([0,p]),x=f.unproject([u,p]),w=g.distanceTo(x);if(n&&n.unit==="imperial"){const k=3.2808*w;k>5280?Eo(t,u,k/5280,f._getUIString("ScaleControl.Miles")):Eo(t,u,k,f._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Eo(t,u,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Eo(t,u,w/1e3,f._getUIString("ScaleControl.Kilometers")):Eo(t,u,w,f._getUIString("ScaleControl.Meters"))}function Eo(f,t,n,u){const p=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(k){const A=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*A)/A}(w),x*w}(n);f.style.width=t*(p/n)+"px",f.innerHTML=`${p}&nbsp;${u}`}const bl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function is(f){if(f){if(typeof f=="number"){const t=Math.round(Math.abs(f)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,f),"top-left":new s.P(t,t),"top-right":new s.P(-t,t),bottom:new s.P(0,-f),"bottom-left":new s.P(t,-t),"bottom-right":new s.P(-t,-t),left:new s.P(f,0),right:new s.P(-f,0)}}if(f instanceof s.P||Array.isArray(f)){const t=s.P.convert(f);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:s.P.convert(f.center||[0,0]),top:s.P.convert(f.top||[0,0]),"top-left":s.P.convert(f["top-left"]||[0,0]),"top-right":s.P.convert(f["top-right"]||[0,0]),bottom:s.P.convert(f.bottom||[0,0]),"bottom-left":s.P.convert(f["bottom-left"]||[0,0]),"bottom-right":s.P.convert(f["bottom-right"]||[0,0]),left:s.P.convert(f.left||[0,0]),right:s.P.convert(f.right||[0,0])}}return is(new s.P(0,0))}const wl={extend:(f,...t)=>s.e(f,...t),run(f){f()},logToElement(f,t=!1,n="log"){const u=window.document.getElementById(n);u&&(t&&(u.innerHTML=""),u.innerHTML+=`<br>${f}`)}},Sl=C;class ui{static get version(){return Sl}static get workerCount(){return nn.workerCount}static set workerCount(t){nn.workerCount=t}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){s.c.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(t){s.c.WORKER_URL=t}static addProtocol(t,n){s.c.REGISTERED_PROTOCOLS[t]=n}static removeProtocol(t){delete s.c.REGISTERED_PROTOCOLS[t]}}return ui.Map=class extends Wc{constructor(f){if(s.bg.mark(s.bh.create),(f=s.e({},It,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ca(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),{bearingSnap:f.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._cooperativeGestures=f.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new pa,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},_l,f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this._imageQueueHandle=me.addThrottleControl(()=>this.isMoving()),this._requestManager=new W(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;const n=Co(u=>{this._trackResize&&!this._removed&&this.resize(u)._update()},50);this._resizeObserver=new ResizeObserver(u=>{t?n(u):t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new ml(this,f),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=f.hash&&new xs(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,s.e({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new cn({customAttribution:f.customAttribution})),f.maplibreLogo&&this.addControl(new Mi,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new s.k(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new s.k(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new s.k("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=f.onAdd(this);this._controls.push(f);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,t,n,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,t,n,u)}resize(f){var t;const n=this._containerDimensions(),u=n[0],p=n[1],g=this._getClampedPixelRatio(u,p);if(this._resizeCanvas(u,p,g),this.painter.resize(u,p,g),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const k=this._getClampedPixelRatio(u,p);this._resizeCanvas(u,p,k),this.painter.resize(u,p,k)}this.transform.resize(u,p),(t=this._requestedCameraState)===null||t===void 0||t.resize(u,p);const x=!this._moving;return x&&(this.stop(),this.fire(new s.k("movestart",f)).fire(new s.k("move",f))),this.fire(new s.k("resize",f)),x&&this.fire(new s.k("moveend",f)),this}_getClampedPixelRatio(f,t){const{0:n,1:u}=this._maxCanvasSize,p=this.getPixelRatio(),g=f*p,x=t*p;return Math.min(g>n?n/g:1,x>u?u/x:1)*p}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(Rt.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(f){return this.transform.locationPoint(s.L.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(s.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,t,n){if(f==="mouseenter"||f==="mouseover"){let u=!1;return{layer:t,listener:n,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?u||(u=!0,n.call(this,new ln(f,this,g.originalEvent,{features:x}))):u=!1},mouseout:()=>{u=!1}}}}if(f==="mouseleave"||f==="mouseout"){let u=!1;return{layer:t,listener:n,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?u=!0:u&&(u=!1,n.call(this,new ln(f,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,n.call(this,new ln(f,this,x.originalEvent)))}}}}{const u=p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length&&(p.features=g,n.call(this,p),delete p.features)};return{layer:t,listener:n,delegates:{[f]:u}}}}on(f,t,n){if(n===void 0)return super.on(f,t);const u=this._createDelegatedListener(f,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(f,t,n){if(n===void 0)return super.once(f,t);const u=this._createDelegatedListener(f,t,n);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,t,n){return n===void 0?super.off(f,t):(this._delegatedListeners&&this._delegatedListeners[f]&&(u=>{const p=this._delegatedListeners[f];for(let g=0;g<p.length;g++){const x=p[g];if(x.layer===t&&x.listener===n){for(const w in x.delegates)this.off(w,x.delegates[w]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(f,t){if(!this.style)return[];let n;const u=f instanceof s.P||Array.isArray(f),p=u?f:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(u?{}:f)||{},p instanceof s.P||typeof p[0]=="number")n=[s.P.convert(p)];else{const g=s.P.convert(p[0]),x=s.P.convert(p[1]);n=[g,new s.P(x.x,g.y),x,new s.P(g.x,x.y),g]}return this.style.queryRenderedFeatures(n,t,this.transform)}querySourceFeatures(f,t){return this.style.querySourceFeatures(f,t)}setStyle(f,t){return(t=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(f,t))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,t));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new xr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,t,n):this.style.loadJSON(f,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,t){if(typeof f=="string"){const n=this._requestManager.transformRequest(f,ye.Style);s.f(n,(u,p)=>{u?this.fire(new s.j(u)):p&&this._updateDiff(p,t)})}else typeof f=="object"&&this._updateDiff(f,t)}_updateDiff(f,t){try{this.style.setState(f,t)&&this._update(!0)}catch(n){s.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(f,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(f,t){return this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)}isSourceLoaded(f){const t=this.style&&this.style.sourceCaches[f];if(t!==void 0)return t.loaded();this.fire(new s.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const t=this.style.sourceCaches[f.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);for(const n in this.style._layers){const u=this.style._layers[n];u.type==="hillshade"&&u.source===f.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Yc(this.painter,t,f),this.painter.renderToTexture=new fa(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=n=>{n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==f.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:f})),this}getTerrain(){var f,t;return(t=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const t in f){const n=f[t]._tiles;for(const u in n){const p=n[u];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(f,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,n)}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,t,n={}){const{pixelRatio:u=1,sdf:p=!1,stretchX:g,stretchY:x,content:w}=n;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||s.a(t))){if(t.width===void 0||t.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:A,data:P}=t,z=t;return this.style.addImage(f,{data:new s.R({width:k,height:A},new Uint8Array(P)),pixelRatio:u,stretchX:g,stretchY:x,content:w,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f),this}}{const{width:k,height:A,data:P}=s.h.getImageData(t);this.style.addImage(f,{data:new s.R({width:k,height:A},P),pixelRatio:u,stretchX:g,stretchY:x,content:w,sdf:p,version:0})}}updateImage(f,t){const n=this.style.getImage(f);if(!n)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=t instanceof HTMLImageElement||s.a(t)?s.h.getImageData(t):t,{width:p,height:g,data:x}=u;if(p===void 0||g===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==n.data.width||g!==n.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||s.a(t));return n.data.replace(x,w),this.style.updateImage(f,n),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,t){me.getImage(this._requestManager.transformRequest(f,ye.Image),t)}listImages(){return this.style.listImages()}addLayer(f,t){return this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)}moveLayer(f,t){return this.style.moveLayer(f,t),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,t,n){return this.style.setLayerZoomRange(f,t,n),this._update(!0)}setFilter(f,t,n={}){return this.style.setFilter(f,t,n),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,t,n,u={}){return this.style.setPaintProperty(f,t,n,u),this._update(!0)}getPaintProperty(f,t){return this.style.getPaintProperty(f,t)}setLayoutProperty(f,t,n,u={}){return this.style.setLayoutProperty(f,t,n,u),this._update(!0)}getLayoutProperty(f,t){return this.style.getLayoutProperty(f,t)}setGlyphs(f,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,t,n,u=>{u||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,t,n=>{n||this._update(!0)}),this}setLight(f,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(f,t){return this.style.setFeatureState(f,t),this._update()}removeFeatureState(f,t){return this.style.removeFeatureState(f,t),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,t=0;return this._container&&(f=this._container.clientWidth||400,t=this._container.clientHeight||300),[f,t]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const t=this._canvasContainer=I.create("div","maplibregl-canvas-container",f);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=I.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),u=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],u);const p=this._controlContainer=I.create("div","maplibregl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{g[x]=I.create("div",`maplibregl-ctrl-${x} `,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=I.create("div","maplibregl-cooperative-gesture-screen",this._container);let f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(f=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${f}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){I.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(f,t,n){this._canvas.width=Math.floor(n*f),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",u=>{t={requestedAttributes:f},u&&(t.statusMessage=u.statusMessage,t.type=u.type)},{once:!0});const n=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!n){const u="Failed to initialize WebGL";throw t?(t.message=u,new Error(JSON.stringify(t))):new Error(u)}this.painter=new Mo(n,this.transform),D.testSupport(n)}_onCooperativeGesture(f,t,n){return!t&&n<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let n=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const p=this.transform.zoom,g=s.h.now();this.style.zoomHistory.update(p,g);const x=new s.a8(p,{now:g,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(n=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||n)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const u=this._sourcesDirty||this._styleDirty||this._placementDirty;return u||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),me.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),I.remove(this._canvasContainer),I.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(f=>{s.bg.frame(f),this._frame=null,this._render(f)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return bt}getCameraTargetElevation(){return this.transform.elevation}},ui.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const t=this._map.getZoom(),n=t===this._map.getMaxZoom(),u=t===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,n)=>{const u=this._map._getUIString(`NavigationControl.${n}`);t.title=u,t.setAttribute("aria-label",u)},this.options=s.e({},gl,f),this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),I.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),I.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=I.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yl(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){I.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,t){const n=I.create("button",f,this._container);return n.type="button",n.addEventListener("click",t),n}},ui.GeolocateControl=class extends s.E{constructor(f){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",t)),this._finish()}},this._updateCamera=t=>{const n=new s.L(t.coords.longitude,t.coords.latitude),u=t.coords.accuracy,p=this._map.getBearing(),g=s.e({bearing:p},this.options.fitBoundsOptions),x=Rt.fromLngLat(n,u);this._map.fitBounds(x,g,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const n=new s.L(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&ts)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=I.create("button","maplibregl-ctrl-geolocate",this._container),I.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=I.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ao({element:this._dotElement}),this._circleElement=I.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ao({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},qi,f)}onAdd(f){return this._map=f,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,n=!1){Ji===void 0||n?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(u=>{Ji=u.state!=="denied",t(Ji)}).catch(()=>{Ji=!!window.navigator.geolocation,t(Ji)}):(Ji=!!window.navigator.geolocation,t(Ji)):t(Ji)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),I.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bi=0,ts=!1}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),n=f.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),t=f.getSouthEast(),n=f.getNorthEast(),u=t.distanceTo(n),p=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bi--,ts=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Bi++,Bi>1?(f={maximumAge:6e5,timeout:0},ts=!0):(f=this.options.positionOptions,ts=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},ui.AttributionControl=cn,ui.LogoControl=Mi,ui.ScaleControl=class{constructor(f){this._onMove=()=>{Cs(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Cs(this._map,this._container,this.options)},this.options=s.e({},Ms,f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){I.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},ui.FullscreenControl=class extends s.E{constructor(f={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){I.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=I.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);I.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},ui.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=f}onAdd(f){return this._map=f,this._container=I.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=I.create("button","maplibregl-ctrl-terrain",this._container),I.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){I.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},ui.Popup=class extends s.E{constructor(f){super(),this.remove=()=>(this._content&&I.remove(this._content),this._container&&(I.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=I.create("div","maplibregl-popup",this._map.getContainer()),this._tip=I.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=vl(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const n=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let u=this.options.anchor;const p=is(this.options.offset);if(!u){const x=this._container.offsetWidth,w=this._container.offsetHeight;let k;k=n.y+p.bottom.y<w?["top"]:n.y>this._map.transform.height-w?["bottom"]:[],n.x<x/2?k.push("left"):n.x>this._map.transform.width-x/2&&k.push("right"),u=k.length===0?"bottom":k.join("-")}const g=n.add(p[u]).round();I.setTransform(this._container,`${Sn[u]} translate(${g.x}px,${g.y}px)`),Jc(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(bl),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=s.L.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=f;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=I.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){this._container&&this._container.classList.add(f)}removeClassName(f){this._container&&this._container.classList.remove(f)}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}_createCloseButton(){this.options.closeButton&&(this._closeButton=I.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(xl);f&&f.focus()}},ui.Marker=Ao,ui.Style=xr,ui.LngLat=s.L,ui.LngLatBounds=Rt,ui.Point=s.P,ui.MercatorCoordinate=s.U,ui.Evented=s.E,ui.AJAXError=s.bi,ui.config=s.c,ui.CanvasSource=Zi,ui.GeoJSONSource=Je,ui.ImageSource=Ht,ui.RasterDEMTileSource=Ct,ui.RasterTileSource=Ge,ui.VectorTileSource=Yi,ui.VideoSource=wi,ui.setRTLTextPlugin=s.bj,ui.getRTLTextPluginStatus=s.bk,ui.prewarm=function(){Oi().acquire(Ot)},ui.clearPrewarmedResources=function(){const f=tr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Ot),tr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},wl.extend(ui,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),ui});var T=m;return T})})(pm);var mm=pm.exports;const Wn=hm(mm);function cf(h){let o;return l=>{if(l)for(let c in l){let m=o==null?void 0:o[c],v=l[c];m!==v&&h(c,v,m)}else if(o)for(let c in o)h(c,void 0,o[c]);o=l}}function xy(h,...o){let l=[h];for(let c of o)if(c)Array.isArray(c)&&c[0]===h?l.push(...c.slice(1)):l.push(c);else continue;if(l.length!==1)return l.length===2?l[1]:l}function wy(h){return h===!0?["has","point_count"]:h===!1?["!",["has","point_count"]]:void 0}function Sy(h,o){return["case",["boolean",["feature-state","hover"],!1],o,h]}var Eu=Ty;function Ty(h){var o,l,c;if(h){if(Array.isArray(h)){for(o=[],l=h.length,c=0;c<l;c++){var m=h[c];m!=null&&o.push(m)}return o}if(typeof h=="object"){o={};var v=Object.keys(h);for(l=v.length,c=0;c<l;c++){var T=v[c],s=h[T];s!=null&&(o[T]=s)}return o}}}function uf(h){let o=h[0],l,c,m=hf(h);return{c(){m.c(),l=Bn()},m(v,T){m.m(v,T),Re(v,l,T),c=!0},p(v,T){T[0]&1&&oi(o,o=v[0])?(mr(),Ae(m,1,1,Vt),_r(),m=hf(v),m.c(),Me(m,1),m.m(l.parentNode,l)):m.p(v,T)},i(v){c||(Me(m),c=!0)},o(v){Ae(m),c=!1},d(v){v&&Fe(l),m.d(v)}}}function hf(h){let o;const l=h[37].default,c=Jr(l,h,h[36],null);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v[1]&32)&&Qr(c,l,m,m[36],o?$r(l,m[36],v,null):en(m[36]),null)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function ky(h){let o,l,c=h[0]&&uf(h);return{c(){c&&c.c(),o=Bn()},m(m,v){c&&c.m(m,v),Re(m,o,v),l=!0},p(m,v){m[0]?c?(c.p(m,v),v[0]&1&&Me(c,1)):(c=uf(m),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(m)}}}function Iy(h,o,l){let c,m,v,T,s,C,I,D,q,ie,de,oe,{$$slots:Te={},$$scope:me}=o,{id:ye=uc("layer")}=o,{source:W=void 0}=o,{sourceLayer:re=void 0}=o,{beforeId:le=void 0}=o,{beforeLayerType:xe=void 0}=o,{type:Ee}=o,{paint:Ie=void 0}=o,{layout:Oe=void 0}=o,{filter:qe=void 0}=o,{applyToClusters:He=void 0}=o,{minzoom:be=void 0}=o,{maxzoom:Ue=void 0}=o,{manageHoverState:xt=!1}=o,{hovered:Ne=null}=o,{interactive:vt=!0}=o,{hoverCursor:gt=void 0}=o,{eventsIfTopMost:dt=!1}=o;const Ft=cc(),{map:sr,source:Ri,self:Jt,minzoom:Ut,maxzoom:Rt,eventTopMost:fi,layerInfo:Yi}=yy();Et(h,sr,Je=>l(32,q=Je)),Et(h,Ri,Je=>l(33,ie=Je)),Et(h,Jt,Je=>l(0,D=Je)),Et(h,Ut,Je=>l(35,oe=Je)),Et(h,Rt,Je=>l(34,de=Je)),bo(()=>{D&&q&&(Yi.delete(D),q==null||q.removeLayer(D))});let Ge,Ct=!0;return h.$$set=Je=>{"id"in Je&&l(7,ye=Je.id),"source"in Je&&l(8,W=Je.source),"sourceLayer"in Je&&l(9,re=Je.sourceLayer),"beforeId"in Je&&l(10,le=Je.beforeId),"beforeLayerType"in Je&&l(11,xe=Je.beforeLayerType),"type"in Je&&l(12,Ee=Je.type),"paint"in Je&&l(13,Ie=Je.paint),"layout"in Je&&l(14,Oe=Je.layout),"filter"in Je&&l(15,qe=Je.filter),"applyToClusters"in Je&&l(16,He=Je.applyToClusters),"minzoom"in Je&&l(17,be=Je.minzoom),"maxzoom"in Je&&l(18,Ue=Je.maxzoom),"manageHoverState"in Je&&l(19,xt=Je.manageHoverState),"hovered"in Je&&l(6,Ne=Je.hovered),"interactive"in Je&&l(20,vt=Je.interactive),"hoverCursor"in Je&&l(21,gt=Je.hoverCursor),"eventsIfTopMost"in Je&&l(22,dt=Je.eventsIfTopMost),"$$scope"in Je&&l(36,me=Je.$$scope)},h.$$.update=()=>{if(h.$$.dirty[0]&65536&&l(31,c=wy(He)),h.$$.dirty[0]&32768|h.$$.dirty[1]&1&&l(25,m=xy("all",c,qe)),h.$$.dirty[0]&131072|h.$$.dirty[1]&16&&l(27,v=be??oe),h.$$.dirty[0]&262144|h.$$.dirty[1]&8&&l(26,T=Ue??de),h.$$.dirty[0]&256|h.$$.dirty[1]&4&&l(30,s=W||ie),h.$$.dirty[0]&1324908161|h.$$.dirty[1]&2&&q&&D!==ye&&s){let Je=function(Ht){var Ti,Gi;if(!vt||!D||!q||dt&&fi(Ht)!==D)return;let wi=Ht.features??[],Zi=(Gi=(Ti=wi[0])==null?void 0:Ti.properties)==null?void 0:Gi.cluster_id,Xe={event:Ht,map:q,clusterId:Zi,layer:D,source:s,features:wi};Ft(Ht.type,Xe)};D&&Yi.delete(D);let mi=le;if(!le&&xe){let Ht=q.getStyle().layers,wi=typeof xe=="function"?xe:Xe=>Xe.type===xe,Zi=Ht==null?void 0:Ht.find(wi);Zi&&(mi=Zi.id)}Si(Jt,D=ye,D),q.addLayer(Eu({id:D,type:Ee,source:s,"source-layer":re,filter:m,paint:Ie,layout:Oe,minzoom:v,maxzoom:T}),mi),l(24,Ct=!0),q.on("click",D,Je),q.on("dblclick",D,Je),q.on("contextmenu",D,Je),q.on("mouseenter",D,Ht=>{var Ti,Gi;if(!vt||!D||!q||dt&&fi(Ht)!==D)return;gt&&(q.getCanvas().style.cursor=gt);let wi=Ht.features??[];l(6,Ne=wi[0]??null);let Zi=(Gi=(Ti=wi[0])==null?void 0:Ti.properties)==null?void 0:Gi.cluster_id;Ft("mouseenter",{event:Ht,map:q,clusterId:Zi,layer:D,source:s,features:wi})}),q.on("mousemove",D,Ht=>{var Ti,Gi,rn;if(!vt)return;if(dt&&fi(Ht)!==D){l(6,Ne=null),xt&&Ge!==void 0&&(q==null||q.setFeatureState({source:s,sourceLayer:re,id:Ge},{hover:!1}),l(23,Ge=void 0));return}q.getCanvas().style.cursor=gt;let wi=Ht.features??[],Zi=(Gi=(Ti=wi[0])==null?void 0:Ti.properties)==null?void 0:Gi.cluster_id,Xe=(rn=wi[0])==null?void 0:rn.id;Xe!==Ge&&(xt&&(Ge!==void 0&&(q==null||q.setFeatureState({source:s,id:Ge,sourceLayer:re},{hover:!1})),q==null||q.setFeatureState({source:s,id:Xe,sourceLayer:re},{hover:!0})),l(23,Ge=Xe),l(6,Ne=wi[0]??null)),Ft("mousemove",{event:Ht,map:q,clusterId:Zi,layer:D,source:s,features:wi})}),q.on("mouseleave",D,Ht=>{if(!(!vt||!D||!q)){if(gt&&(q.getCanvas().style.cursor=""),l(6,Ne=null),xt&&Ge!==void 0){const wi={source:s,id:Ge,sourceLayer:re};q==null||q.setFeatureState(wi,{hover:!1}),l(23,Ge=void 0)}Ft("mouseleave",{map:q,layer:D,source:s})}})}h.$$.dirty[0]&1048577&&D&&Yi.set(D,{interactive:vt}),h.$$.dirty[0]&1|h.$$.dirty[1]&2&&l(29,C=D?cf((Je,mi)=>q==null?void 0:q.setPaintProperty(D,Je,mi)):void 0),h.$$.dirty[0]&1|h.$$.dirty[1]&2&&l(28,I=D?cf((Je,mi)=>q==null?void 0:q.setLayoutProperty(D,Je,mi)):void 0),h.$$.dirty[0]&536879104&&(C==null||C(Ie)),h.$$.dirty[0]&268451840&&(I==null||I(Oe)),h.$$.dirty[0]&201326593|h.$$.dirty[1]&2&&D&&(q==null||q.setLayerZoomRange(D,v,T)),h.$$.dirty[0]&50331649|h.$$.dirty[1]&2&&D&&(Ct?l(24,Ct=!1):q==null||q.setFilter(D,m))},[D,sr,Ri,Jt,Ut,Rt,Ne,ye,W,re,le,xe,Ee,Ie,Oe,qe,He,be,Ue,xt,vt,gt,dt,Ge,Ct,m,T,v,I,C,s,c,q,ie,de,oe,me,Te]}class fd extends di{constructor(o){super(),hi(this,o,Iy,ky,oi,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function My(h){let o;const l=h[16].default,c=Jr(l,h,h[24],null);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v&16777216)&&Qr(c,l,m,m[24],o?$r(l,m[24],v,null):en(m[24]),null)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function Cy(h){let o,l,c;function m(T){h[17](T)}let v={id:h[1],type:"circle",source:h[2],sourceLayer:h[3],beforeId:h[4],beforeLayerType:h[5],paint:h[6],layout:h[7],filter:h[8],applyToClusters:h[9],minzoom:h[10],maxzoom:h[11],hoverCursor:h[12],manageHoverState:h[13],eventsIfTopMost:h[14],interactive:h[15],$$slots:{default:[My]},$$scope:{ctx:h}};return h[0]!==void 0&&(v.hovered=h[0]),o=new fd({props:v}),Ur.push(()=>Fs(o,"hovered",m)),o.$on("click",h[18]),o.$on("dblclick",h[19]),o.$on("contextmenu",h[20]),o.$on("mouseenter",h[21]),o.$on("mousemove",h[22]),o.$on("mouseleave",h[23]),{c(){ct(o.$$.fragment)},m(T,s){at(o,T,s),c=!0},p(T,[s]){const C={};s&2&&(C.id=T[1]),s&4&&(C.source=T[2]),s&8&&(C.sourceLayer=T[3]),s&16&&(C.beforeId=T[4]),s&32&&(C.beforeLayerType=T[5]),s&64&&(C.paint=T[6]),s&128&&(C.layout=T[7]),s&256&&(C.filter=T[8]),s&512&&(C.applyToClusters=T[9]),s&1024&&(C.minzoom=T[10]),s&2048&&(C.maxzoom=T[11]),s&4096&&(C.hoverCursor=T[12]),s&8192&&(C.manageHoverState=T[13]),s&16384&&(C.eventsIfTopMost=T[14]),s&32768&&(C.interactive=T[15]),s&16777216&&(C.$$scope={dirty:s,ctx:T}),!l&&s&1&&(l=!0,C.hovered=T[0],Bs(()=>l=!1)),o.$set(C)},i(T){c||(Me(o.$$.fragment,T),c=!0)},o(T){Ae(o.$$.fragment,T),c=!1},d(T){lt(o,T)}}}function Ay(h,o,l){let{$$slots:c={},$$scope:m}=o,{id:v=uc("circle")}=o,{source:T=void 0}=o,{sourceLayer:s=void 0}=o,{beforeId:C=void 0}=o,{beforeLayerType:I=void 0}=o,{paint:D}=o,{layout:q=void 0}=o,{filter:ie=void 0}=o,{applyToClusters:de=void 0}=o,{minzoom:oe=void 0}=o,{maxzoom:Te=void 0}=o,{hoverCursor:me=void 0}=o,{manageHoverState:ye=!1}=o,{hovered:W=null}=o,{eventsIfTopMost:re=!1}=o,{interactive:le=!0}=o;function xe(Ue){W=Ue,l(0,W)}function Ee(Ue){yr.call(this,h,Ue)}function Ie(Ue){yr.call(this,h,Ue)}function Oe(Ue){yr.call(this,h,Ue)}function qe(Ue){yr.call(this,h,Ue)}function He(Ue){yr.call(this,h,Ue)}function be(Ue){yr.call(this,h,Ue)}return h.$$set=Ue=>{"id"in Ue&&l(1,v=Ue.id),"source"in Ue&&l(2,T=Ue.source),"sourceLayer"in Ue&&l(3,s=Ue.sourceLayer),"beforeId"in Ue&&l(4,C=Ue.beforeId),"beforeLayerType"in Ue&&l(5,I=Ue.beforeLayerType),"paint"in Ue&&l(6,D=Ue.paint),"layout"in Ue&&l(7,q=Ue.layout),"filter"in Ue&&l(8,ie=Ue.filter),"applyToClusters"in Ue&&l(9,de=Ue.applyToClusters),"minzoom"in Ue&&l(10,oe=Ue.minzoom),"maxzoom"in Ue&&l(11,Te=Ue.maxzoom),"hoverCursor"in Ue&&l(12,me=Ue.hoverCursor),"manageHoverState"in Ue&&l(13,ye=Ue.manageHoverState),"hovered"in Ue&&l(0,W=Ue.hovered),"eventsIfTopMost"in Ue&&l(14,re=Ue.eventsIfTopMost),"interactive"in Ue&&l(15,le=Ue.interactive),"$$scope"in Ue&&l(24,m=Ue.$$scope)},[W,v,T,s,C,I,D,q,ie,de,oe,Te,me,ye,re,le,c,xe,Ee,Ie,Oe,qe,He,be,m]}class Du extends di{constructor(o){super(),hi(this,o,Ay,Cy,oi,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Ey(h){let o;const l=h[15].default,c=Jr(l,h,h[23],null);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v&8388608)&&Qr(c,l,m,m[23],o?$r(l,m[23],v,null):en(m[23]),null)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function Py(h){let o,l,c;function m(T){h[16](T)}let v={id:h[1],type:"fill",source:h[2],sourceLayer:h[3],beforeId:h[4],beforeLayerType:h[5],paint:h[6],layout:h[7],filter:h[8],minzoom:h[9],maxzoom:h[10],hoverCursor:h[11],manageHoverState:h[12],eventsIfTopMost:h[13],interactive:h[14],$$slots:{default:[Ey]},$$scope:{ctx:h}};return h[0]!==void 0&&(v.hovered=h[0]),o=new fd({props:v}),Ur.push(()=>Fs(o,"hovered",m)),o.$on("click",h[17]),o.$on("dblclick",h[18]),o.$on("contextmenu",h[19]),o.$on("mouseenter",h[20]),o.$on("mousemove",h[21]),o.$on("mouseleave",h[22]),{c(){ct(o.$$.fragment)},m(T,s){at(o,T,s),c=!0},p(T,[s]){const C={};s&2&&(C.id=T[1]),s&4&&(C.source=T[2]),s&8&&(C.sourceLayer=T[3]),s&16&&(C.beforeId=T[4]),s&32&&(C.beforeLayerType=T[5]),s&64&&(C.paint=T[6]),s&128&&(C.layout=T[7]),s&256&&(C.filter=T[8]),s&512&&(C.minzoom=T[9]),s&1024&&(C.maxzoom=T[10]),s&2048&&(C.hoverCursor=T[11]),s&4096&&(C.manageHoverState=T[12]),s&8192&&(C.eventsIfTopMost=T[13]),s&16384&&(C.interactive=T[14]),s&8388608&&(C.$$scope={dirty:s,ctx:T}),!l&&s&1&&(l=!0,C.hovered=T[0],Bs(()=>l=!1)),o.$set(C)},i(T){c||(Me(o.$$.fragment,T),c=!0)},o(T){Ae(o.$$.fragment,T),c=!1},d(T){lt(o,T)}}}function zy(h,o,l){let{$$slots:c={},$$scope:m}=o,{id:v=uc("fill")}=o,{source:T=void 0}=o,{sourceLayer:s=void 0}=o,{beforeId:C=void 0}=o,{beforeLayerType:I=void 0}=o,{paint:D}=o,{layout:q=void 0}=o,{filter:ie=void 0}=o,{minzoom:de=void 0}=o,{maxzoom:oe=void 0}=o,{hoverCursor:Te=void 0}=o,{manageHoverState:me=!1}=o,{hovered:ye=null}=o,{eventsIfTopMost:W=!1}=o,{interactive:re=!0}=o;function le(be){ye=be,l(0,ye)}function xe(be){yr.call(this,h,be)}function Ee(be){yr.call(this,h,be)}function Ie(be){yr.call(this,h,be)}function Oe(be){yr.call(this,h,be)}function qe(be){yr.call(this,h,be)}function He(be){yr.call(this,h,be)}return h.$$set=be=>{"id"in be&&l(1,v=be.id),"source"in be&&l(2,T=be.source),"sourceLayer"in be&&l(3,s=be.sourceLayer),"beforeId"in be&&l(4,C=be.beforeId),"beforeLayerType"in be&&l(5,I=be.beforeLayerType),"paint"in be&&l(6,D=be.paint),"layout"in be&&l(7,q=be.layout),"filter"in be&&l(8,ie=be.filter),"minzoom"in be&&l(9,de=be.minzoom),"maxzoom"in be&&l(10,oe=be.maxzoom),"hoverCursor"in be&&l(11,Te=be.hoverCursor),"manageHoverState"in be&&l(12,me=be.manageHoverState),"hovered"in be&&l(0,ye=be.hovered),"eventsIfTopMost"in be&&l(13,W=be.eventsIfTopMost),"interactive"in be&&l(14,re=be.interactive),"$$scope"in be&&l(23,m=be.$$scope)},[ye,v,T,s,C,I,D,q,ie,de,oe,Te,me,W,re,c,le,xe,Ee,Ie,Oe,qe,He,m]}class hc extends di{constructor(o){super(),hi(this,o,zy,Py,oi,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Ly(h,o,l){let c;const{map:m}=Ba();Et(h,m,C=>l(4,c=C));let{position:v="top-left"}=o,{container:T=void 0}=o,s=null;return bo(()=>{c!=null&&c.loaded()&&s&&c.removeControl(s)}),h.$$set=C=>{"position"in C&&l(1,v=C.position),"container"in C&&l(2,T=C.container)},h.$$.update=()=>{if(h.$$.dirty&30&&c&&!s){let C;typeof T=="string"?C=document.querySelector(T)??void 0:C=T,l(3,s=new Wn.FullscreenControl({container:C})),c.addControl(s,v)}},[m,v,T,s,c]}class Dy extends di{constructor(o){super(),hi(this,o,Ly,null,oi,{position:1,container:2})}}function By(h,o,l,c,m){let v=!1;h.getSource(o)&&(v=!0,h.removeSource(o));const T=()=>{c(o)&&(h.addSource(o,l),m())};if(v){const s=()=>{o&&(h.getSource(o)?setTimeout(s,1):T())};s()}else T()}function Fy(h,o,l){Xg().then(()=>{let c=Ng(h);if(!c)return;c.getSource(o)===l&&c.removeSource(o)})}function df(h){let o=h[0],l,c,m=pf(h);return{c(){m.c(),l=Bn()},m(v,T){m.m(v,T),Re(v,l,T),c=!0},p(v,T){T&1&&oi(o,o=v[0])?(mr(),Ae(m,1,1,Vt),_r(),m=pf(v),m.c(),Me(m,1),m.m(l.parentNode,l)):m.p(v,T)},i(v){c||(Me(m),c=!0)},o(v){Ae(m),c=!1},d(v){v&&Fe(l),m.d(v)}}}function pf(h){let o;const l=h[15].default,c=Jr(l,h,h[14],null);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v&16384)&&Qr(c,l,m,m[14],o?$r(l,m[14],v,null):en(m[14]),null)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function Ry(h){let o,l,c=h[0]&&df(h);return{c(){c&&c.c(),o=Bn()},m(m,v){c&&c.m(m,v),Re(m,o,v),l=!0},p(m,[v]){m[0]?c?(c.p(m,v),v&1&&Me(c,1)):(c=df(m),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(m)}}}function Oy(h,o,l){let c,m,v,{$$slots:T={},$$scope:s}=o,{id:C=uc("geojson")}=o,{data:I}=o,{generateId:D=!1}=o,{promoteId:q=void 0}=o,{filter:ie=void 0}=o,{lineMetrics:de=void 0}=o,{cluster:oe=void 0}=o;const{map:Te,cluster:me,self:ye}=gy();Et(h,Te,le=>l(13,m=le)),Et(h,me,le=>l(16,v=le)),Et(h,ye,le=>l(0,c=le));let W,re=!0;return bo(()=>{c&&W&&m&&(Fy(Te,c,W),Si(ye,c=null,c),l(11,W=void 0))}),h.$$set=le=>{"id"in le&&l(4,C=le.id),"data"in le&&l(5,I=le.data),"generateId"in le&&l(6,D=le.generateId),"promoteId"in le&&l(7,q=le.promoteId),"filter"in le&&l(8,ie=le.filter),"lineMetrics"in le&&l(9,de=le.lineMetrics),"cluster"in le&&l(10,oe=le.cluster),"$$scope"in le&&l(14,s=le.$$scope)},h.$$.update=()=>{h.$$.dirty&1024&&Si(me,v=oe,v),h.$$.dirty&12273&&m&&c!==C&&(Si(ye,c=C,c),By(m,c,Eu({type:"geojson",data:I,filter:ie,lineMetrics:de,generateId:D,promoteId:q,cluster:!!oe,clusterMinPoints:oe==null?void 0:oe.minPoints,clusterMaxZoom:oe==null?void 0:oe.maxZoom,clusterRadius:oe==null?void 0:oe.radius,clusterProperties:oe==null?void 0:oe.properties}),le=>m&&le===c,()=>{c&&(l(11,W=m==null?void 0:m.getSource(c)),l(12,re=!0))})),h.$$.dirty&8208&&(m==null||m.on("style.load",()=>{l(11,W=m==null?void 0:m.getSource(C))})),h.$$.dirty&6176&&W&&(re?l(12,re=!1):W.setData(I)),h.$$.dirty&3072&&(W==null||W.setClusterOptions(Eu({cluster:!!oe,clusterMaxZoom:oe==null?void 0:oe.maxZoom,clusterRadius:oe==null?void 0:oe.radius})))},[c,Te,me,ye,C,I,D,q,ie,de,oe,W,re,m,s,T]}class qo extends di{constructor(o){super(),hi(this,o,Oy,Ry,oi,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function Ny(h,o,l){let c;const{map:m}=Ba();Et(h,m,ie=>l(8,c=ie));let{position:v="top-left"}=o,{positionOptions:T=void 0}=o,{fitBoundsOptions:s=void 0}=o,{trackUserLocation:C=!1}=o,{showAccuracyCircle:I=!0}=o,{showUserLocation:D=!0}=o,q=null;return bo(()=>{c!=null&&c.loaded()&&q&&c.removeControl(q)}),h.$$set=ie=>{"position"in ie&&l(1,v=ie.position),"positionOptions"in ie&&l(2,T=ie.positionOptions),"fitBoundsOptions"in ie&&l(3,s=ie.fitBoundsOptions),"trackUserLocation"in ie&&l(4,C=ie.trackUserLocation),"showAccuracyCircle"in ie&&l(5,I=ie.showAccuracyCircle),"showUserLocation"in ie&&l(6,D=ie.showUserLocation)},h.$$.update=()=>{h.$$.dirty&510&&c&&!q&&(l(7,q=new Wn.GeolocateControl({positionOptions:T,fitBoundsOptions:s,trackUserLocation:C,showAccuracyCircle:I,showUserLocation:D})),c.addControl(q,v))},[m,v,T,s,C,I,D,q,c]}class Vy extends di{constructor(o){super(),hi(this,o,Ny,null,oi,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function Uy(h){let o;const l=h[15].default,c=Jr(l,h,h[23],null);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v&8388608)&&Qr(c,l,m,m[23],o?$r(l,m[23],v,null):en(m[23]),null)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function jy(h){let o,l,c;function m(T){h[16](T)}let v={id:h[1],type:"line",source:h[2],sourceLayer:h[3],beforeId:h[4],beforeLayerType:h[5],paint:h[6],layout:h[7],filter:h[8],minzoom:h[9],maxzoom:h[10],hoverCursor:h[11],manageHoverState:h[12],eventsIfTopMost:h[13],interactive:h[14],$$slots:{default:[Uy]},$$scope:{ctx:h}};return h[0]!==void 0&&(v.hovered=h[0]),o=new fd({props:v}),Ur.push(()=>Fs(o,"hovered",m)),o.$on("click",h[17]),o.$on("dblclick",h[18]),o.$on("contextmenu",h[19]),o.$on("mouseenter",h[20]),o.$on("mousemove",h[21]),o.$on("mouseleave",h[22]),{c(){ct(o.$$.fragment)},m(T,s){at(o,T,s),c=!0},p(T,[s]){const C={};s&2&&(C.id=T[1]),s&4&&(C.source=T[2]),s&8&&(C.sourceLayer=T[3]),s&16&&(C.beforeId=T[4]),s&32&&(C.beforeLayerType=T[5]),s&64&&(C.paint=T[6]),s&128&&(C.layout=T[7]),s&256&&(C.filter=T[8]),s&512&&(C.minzoom=T[9]),s&1024&&(C.maxzoom=T[10]),s&2048&&(C.hoverCursor=T[11]),s&4096&&(C.manageHoverState=T[12]),s&8192&&(C.eventsIfTopMost=T[13]),s&16384&&(C.interactive=T[14]),s&8388608&&(C.$$scope={dirty:s,ctx:T}),!l&&s&1&&(l=!0,C.hovered=T[0],Bs(()=>l=!1)),o.$set(C)},i(T){c||(Me(o.$$.fragment,T),c=!0)},o(T){Ae(o.$$.fragment,T),c=!1},d(T){lt(o,T)}}}function qy(h,o,l){let{$$slots:c={},$$scope:m}=o,{id:v=uc("line")}=o,{source:T=void 0}=o,{sourceLayer:s=void 0}=o,{beforeId:C=void 0}=o,{beforeLayerType:I=void 0}=o,{paint:D}=o,{layout:q=void 0}=o,{filter:ie=void 0}=o,{minzoom:de=void 0}=o,{maxzoom:oe=void 0}=o,{hoverCursor:Te=void 0}=o,{manageHoverState:me=!1}=o,{hovered:ye=null}=o,{eventsIfTopMost:W=!1}=o,{interactive:re=!0}=o;function le(be){ye=be,l(0,ye)}function xe(be){yr.call(this,h,be)}function Ee(be){yr.call(this,h,be)}function Ie(be){yr.call(this,h,be)}function Oe(be){yr.call(this,h,be)}function qe(be){yr.call(this,h,be)}function He(be){yr.call(this,h,be)}return h.$$set=be=>{"id"in be&&l(1,v=be.id),"source"in be&&l(2,T=be.source),"sourceLayer"in be&&l(3,s=be.sourceLayer),"beforeId"in be&&l(4,C=be.beforeId),"beforeLayerType"in be&&l(5,I=be.beforeLayerType),"paint"in be&&l(6,D=be.paint),"layout"in be&&l(7,q=be.layout),"filter"in be&&l(8,ie=be.filter),"minzoom"in be&&l(9,de=be.minzoom),"maxzoom"in be&&l(10,oe=be.maxzoom),"hoverCursor"in be&&l(11,Te=be.hoverCursor),"manageHoverState"in be&&l(12,me=be.manageHoverState),"hovered"in be&&l(0,ye=be.hovered),"eventsIfTopMost"in be&&l(13,W=be.eventsIfTopMost),"interactive"in be&&l(14,re=be.interactive),"$$scope"in be&&l(23,m=be.$$scope)},[ye,v,T,s,C,I,D,q,ie,de,oe,Te,me,W,re,c,le,xe,Ee,Ie,Oe,qe,He,m]}class ds extends di{constructor(o){super(),hi(this,o,qy,jy,oi,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function Zy(h){let o=h.getCenter(),l=Math.round(h.getZoom()*100)/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,c),v=Math.round(o.lat*m)/m,T=Math.round(o.lng*m)/m,s=`${l}/${v}/${T}`,C=h.getBearing(),I=h.getPitch();return(C||I)&&(s+=`/${Math.round(C*10)/10}`),I&&(s+=`/${Math.round(I)}`),`#${s}`}function Gy(h){return h.replace("#","").split("/").map(parseFloat)}var Su=md;function md(h,o){return h===o||h!==h&&o!==o?!0:typeof h!=typeof o||{}.toString.call(h)!={}.toString.call(o)||h!==Object(h)||!h?!1:Array.isArray(h)?ff(h,o):{}.toString.call(h)=="[object Set]"?ff(Array.from(h),Array.from(o)):{}.toString.call(h)=="[object Object]"?Wy(h,o):Xy(h,o)}function Xy(h,o){return h.toString()===o.toString()}function ff(h,o){var l=h.length;if(l!=o.length)return!1;for(var c=0;c<l;c++)if(!md(h[c],o[c]))return!1;return!0}function Wy(h,o){var l=Object.keys(h),c=l.length;if(c!=Object.keys(o).length)return!1;for(var m=0;m<c;m++){var v=l[m];if(!(o.hasOwnProperty(v)&&md(h[v],o[v])))return!1}return!0}function Hy(h,o,l){let c;const{map:m}=Ba();Et(h,m,D=>l(6,c=D));let{position:v="top-left"}=o,{showCompass:T=!0}=o,{showZoom:s=!0}=o,{visualizePitch:C=!1}=o,I=null;return bo(()=>{c!=null&&c.loaded()&&I&&c.removeControl(I)}),h.$$set=D=>{"position"in D&&l(1,v=D.position),"showCompass"in D&&l(2,T=D.showCompass),"showZoom"in D&&l(3,s=D.showZoom),"visualizePitch"in D&&l(4,C=D.visualizePitch)},h.$$.update=()=>{h.$$.dirty&126&&c&&!I&&(l(5,I=new Wn.NavigationControl({showCompass:T,showZoom:s,visualizePitch:C})),c.addControl(I,v))},[m,v,T,s,C,I,c]}class Ky extends di{constructor(o){super(),hi(this,o,Hy,null,oi,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Yy(h,o,l){let c;const{map:m}=Ba();Et(h,m,I=>l(5,c=I));let{position:v="bottom-left"}=o,{maxWidth:T=void 0}=o,{unit:s="metric"}=o,C=null;return bo(()=>{c!=null&&c.loaded()&&C&&c.removeControl(C)}),h.$$set=I=>{"position"in I&&l(1,v=I.position),"maxWidth"in I&&l(2,T=I.maxWidth),"unit"in I&&l(3,s=I.unit)},h.$$.update=()=>{h.$$.dirty&62&&c&&!C&&(l(4,C=new Wn.ScaleControl({maxWidth:T,unit:s})),c.addControl(C,v))},[m,v,T,s,C,c]}class Jy extends di{constructor(o){super(),hi(this,o,Yy,null,oi,{position:1,maxWidth:2,unit:3})}}const $y=h=>({map:h[0]&8,loadedImages:h[0]&16,allImagesLoaded:h[0]&32}),mf=h=>({map:h[3],loadedImages:h[4],allImagesLoaded:h[5]});function _f(h){let o,l,c=h[2]&&gf(h);const m=h[33].default,v=Jr(m,h,h[32],mf);return{c(){c&&c.c(),o=st(),v&&v.c()},m(T,s){c&&c.m(T,s),Re(T,o,s),v&&v.m(T,s),l=!0},p(T,s){T[2]?c?(c.p(T,s),s[0]&4&&Me(c,1)):(c=gf(T),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r()),v&&v.p&&(!l||s[0]&56|s[1]&2)&&Qr(v,m,T,T[32],l?$r(m,T[32],s,$y):en(T[32]),mf)},i(T){l||(Me(c),Me(v,T),l=!0)},o(T){Ae(c),Ae(v,T),l=!1},d(T){T&&Fe(o),c&&c.d(T),v&&v.d(T)}}}function gf(h){let o,l,c,m,v,T,s,C;return o=new Ky({props:{position:h[6]}}),c=new Vy({props:{position:h[6],fitBoundsOptions:{maxZoom:12}}}),v=new Dy({props:{position:h[6]}}),s=new Jy({props:{position:h[6]}}),{c(){ct(o.$$.fragment),l=st(),ct(c.$$.fragment),m=st(),ct(v.$$.fragment),T=st(),ct(s.$$.fragment)},m(I,D){at(o,I,D),Re(I,l,D),at(c,I,D),Re(I,m,D),at(v,I,D),Re(I,T,D),at(s,I,D),C=!0},p(I,D){const q={};D[0]&64&&(q.position=I[6]),o.$set(q);const ie={};D[0]&64&&(ie.position=I[6]),c.$set(ie);const de={};D[0]&64&&(de.position=I[6]),v.$set(de);const oe={};D[0]&64&&(oe.position=I[6]),s.$set(oe)},i(I){C||(Me(o.$$.fragment,I),Me(c.$$.fragment,I),Me(v.$$.fragment,I),Me(s.$$.fragment,I),C=!0)},o(I){Ae(o.$$.fragment,I),Ae(c.$$.fragment,I),Ae(v.$$.fragment,I),Ae(s.$$.fragment,I),C=!1},d(I){I&&(Fe(l),Fe(m),Fe(T)),lt(o,I),lt(c,I),lt(v,I),lt(s,I)}}}function Qy(h){let o,l,c,m,v,T=h[3]&&h[0]&&_f(h);return{c(){o=we("div"),T&&T.c(),qt(o,"class",l=of(h[1])+" svelte-p00lfq"),af(o,"expand-map",!h[1])},m(s,C){Re(s,o,C),T&&T.m(o,null),c=!0,m||(v=ed(h[9].call(null,o)),m=!0)},p(s,C){s[3]&&s[0]?T?(T.p(s,C),C[0]&9&&Me(T,1)):(T=_f(s),T.c(),Me(T,1),T.m(o,null)):T&&(mr(),Ae(T,1,1,()=>{T=null}),_r()),(!c||C[0]&2&&l!==(l=of(s[1])+" svelte-p00lfq"))&&qt(o,"class",l),(!c||C[0]&2)&&af(o,"expand-map",!s[1])},i(s){c||(Me(T),c=!0)},o(s){Ae(T),c=!1},d(s){s&&Fe(o),T&&T.d(),m=!1,v()}}}function e0(h,o,l){let c,m,v,T,{$$slots:s={},$$scope:C}=o,{map:I=null}=o,{class:D=void 0}=o,{style:q}=o,{diffStyleUpdates:ie=!1}=o,{center:de=void 0}=o,{zoom:oe=void 0}=o,{pitch:Te=0}=o,{bearing:me=0}=o,{bounds:ye=void 0}=o,{hash:W=!1}=o,{loaded:re=!1}=o,{minZoom:le=0}=o,{maxZoom:xe=22}=o,{zoomOnDoubleClick:Ee=!0}=o,{interactive:Ie=!0}=o,{attributionControl:Oe=!0}=o,{preserveDrawingBuffer:qe=!1}=o,{maxBounds:He=void 0}=o,{images:be=[]}=o,{standardControls:Ue=!1}=o,{filterLayers:xt=void 0}=o,{transformRequest:Ne=void 0}=o;const vt=cc(),{map:gt,loadedImages:dt}=_y();Et(h,gt,Ge=>l(3,v=Ge)),Et(h,dt,Ge=>l(4,T=Ge));let Ft=new Set;function sr(Ge){v!=null&&v.loaded()&&("url"in Ge?(Ft.add(Ge.id),v.loadImage(Ge.url,(Ct,Je)=>{Ft.delete(Ge.id),Ct?vt("error",Ct):Je&&(v==null||v.addImage(Ge.id,Je,Ge.options),T.add(Ge.id),dt.set(T))})):(v.addImage(Ge.id,Ge.data,Ge.options),T.add(Ge.id),dt.set(T)))}let Ri,Jt,Ut,Rt;function fi(Ge){if(W){let Ct=Gy(window.location.hash);Ct.length>=3&&(l(11,oe=Ct[0]),l(10,de=[Ct[2],Ct[1]])),Ct.length==5&&(l(15,me=Ct[3]),l(14,Te=Ct[4]))}return Si(gt,v=new Wn.Map(Eu({container:Ge,style:q,center:de,zoom:oe,pitch:Te,bearing:me,minZoom:le,maxZoom:xe,interactive:Ie,preserveDrawingBuffer:qe,maxBounds:He,bounds:ye,attributionControl:Oe,transformRequest:Ne})),v),v.on("load",Ct=>{l(0,re=!0),vt("load",v)}),v.on("error",Ct=>vt("error",{...Ct,map:v})),v.on("movestart",Ct=>vt("movestart",{...Ct,map:v})),v.on("moveend",Ct=>{if(l(10,de=Ct.target.getCenter()),l(11,oe=Ct.target.getZoom()),l(12,ye=Ct.target.getBounds()),vt("moveend",{...Ct,map:v}),W){let Je=window.location.href.replace(/(#.+)?$/,Zy(v));window.history.replaceState(window.history.state,"",Je)}}),v.on("zoomstart",Ct=>vt("zoomstart",{...Ct,map:v})),v.on("zoom",Ct=>{l(11,oe=Ct.target.getZoom()),vt("zoom",{...Ct,map:v})}),v.on("zoomend",Ct=>{l(11,oe=Ct.target.getZoom()),vt("zoomend",{...Ct,map:v})}),v.on("style.load",()=>{if(v){const Ct=v.getStyle();if(l(29,Ri=Ct.layers.map(Je=>Je.id)),l(30,Jt=Object.keys(Ct.sources)),Rt)for(const[Je,mi]of Object.entries(Rt))v.addSource(Je,mi);if(Ut)for(const Je of Ut)v.addLayer(Je)}}),v.on("styledata",Ct=>{if(v&&xt){const Je=v.getStyle().layers;if(Je)for(let mi of Je)xt(mi)||v.setLayoutProperty(mi.id,"visibility","none")}vt("styledata",{...Ct,map:v})}),{destroy(){l(0,re=!1),v==null||v.remove(),Si(gt,v=null,v)}}}let Yi=q;return h.$$set=Ge=>{"map"in Ge&&l(13,I=Ge.map),"class"in Ge&&l(1,D=Ge.class),"style"in Ge&&l(16,q=Ge.style),"diffStyleUpdates"in Ge&&l(17,ie=Ge.diffStyleUpdates),"center"in Ge&&l(10,de=Ge.center),"zoom"in Ge&&l(11,oe=Ge.zoom),"pitch"in Ge&&l(14,Te=Ge.pitch),"bearing"in Ge&&l(15,me=Ge.bearing),"bounds"in Ge&&l(12,ye=Ge.bounds),"hash"in Ge&&l(18,W=Ge.hash),"loaded"in Ge&&l(0,re=Ge.loaded),"minZoom"in Ge&&l(19,le=Ge.minZoom),"maxZoom"in Ge&&l(20,xe=Ge.maxZoom),"zoomOnDoubleClick"in Ge&&l(21,Ee=Ge.zoomOnDoubleClick),"interactive"in Ge&&l(22,Ie=Ge.interactive),"attributionControl"in Ge&&l(23,Oe=Ge.attributionControl),"preserveDrawingBuffer"in Ge&&l(24,qe=Ge.preserveDrawingBuffer),"maxBounds"in Ge&&l(25,He=Ge.maxBounds),"images"in Ge&&l(26,be=Ge.images),"standardControls"in Ge&&l(2,Ue=Ge.standardControls),"filterLayers"in Ge&&l(27,xt=Ge.filterLayers),"transformRequest"in Ge&&l(28,Ne=Ge.transformRequest),"$$scope"in Ge&&l(32,C=Ge.$$scope)},h.$$.update=()=>{if(h.$$.dirty[0]&4&&l(6,c=typeof Ue=="boolean"?void 0:Ue),h.$$.dirty[0]&8&&l(13,I=v),h.$$.dirty[0]&67108873&&re&&v!=null&&v.loaded())for(let Ge of be)!Ft.has(Ge.id)&&!v.hasImage(Ge.id)&&sr(Ge);if(h.$$.dirty[0]&67108880&&l(5,m=be.every(Ge=>T.has(Ge.id))),h.$$.dirty[0]&1610809352|h.$$.dirty[1]&1&&v&&!Su(q,Yi)){const Ge=v.getStyle();if(Ri&&(Ut=Ge.layers.filter(Ct=>!Ri.includes(Ct.id))),Jt){const Ct=Object.keys(Ge.sources).filter(Je=>!Jt.includes(Je));Rt={};for(const Je of Ct)Rt[Je]=Ge.sources[Je]}l(31,Yi=q),v.setStyle(q,{diff:ie})}h.$$.dirty[0]&1032&&de&&!Su(de,v==null?void 0:v.getCenter())&&(v==null||v.panTo(de)),h.$$.dirty[0]&2056&&oe&&!Su(oe,v==null?void 0:v.getZoom())&&(v==null||v.zoomTo(oe)),h.$$.dirty[0]&4104&&ye&&!Su(ye,v==null?void 0:v.getBounds())&&(v==null||v.fitBounds(ye)),h.$$.dirty[0]&2097160&&(Ee?v==null||v.doubleClickZoom.enable():v==null||v.doubleClickZoom.disable())},[re,D,Ue,v,T,m,c,gt,dt,fi,de,oe,ye,I,Te,me,q,ie,W,le,xe,Ee,Ie,Oe,qe,He,be,xt,Ne,Ri,Jt,Yi,C,s]}class t0 extends di{constructor(o){super(),hi(this,o,e0,Qy,oi,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,interactive:22,attributionControl:23,preserveDrawingBuffer:24,maxBounds:25,images:26,standardControls:2,filterLayers:27,transformRequest:28},null,[-1,-1])}}function i0(h){let o,l,c,m,v,T,s;const C=h[16].default,I=Jr(C,h,h[15],null);return{c(){o=we("div"),I&&I.c(),qt(o,"tabindex",l=h[1]?0:void 0),qt(o,"role",c=h[1]?"button":void 0),Ea(o,"z-index",h[2])},m(D,q){Re(D,o,q),I&&I.m(o,null),v=!0,T||(s=[ed(h[6].call(null,o)),ed(m=r0.call(null,o,h[0])),Dt(o,"click",h[17]),Dt(o,"dblclick",h[18]),Dt(o,"contextmenu",h[19]),Dt(o,"mouseenter",h[20]),Dt(o,"mouseleave",h[21]),Dt(o,"mousemove",h[22]),Dt(o,"keydown",h[7])],T=!0)},p(D,[q]){I&&I.p&&(!v||q&32768)&&Qr(I,C,D,D[15],v?$r(C,D[15],q,null):en(D[15]),null),(!v||q&2&&l!==(l=D[1]?0:void 0))&&qt(o,"tabindex",l),(!v||q&2&&c!==(c=D[1]?"button":void 0))&&qt(o,"role",c),m&&Lu(m.update)&&q&1&&m.update.call(null,D[0]),q&4&&Ea(o,"z-index",D[2])},i(D){v||(Me(I,D),v=!0)},o(D){Ae(I,D),v=!1},d(D){D&&Fe(o),I&&I.d(D),T=!1,gn(s)}}}function r0(h,o){const l=h.className;function c(m){m?h.className=`${l} ${m}`:h.className=l}return c(o),{update:c}}function n0(h,o,l){let c,m,v,{$$slots:T={},$$scope:s}=o,{lngLat:C}=o,{class:I=void 0}=o,{interactive:D=!0}=o,{asButton:q=!1}=o,{draggable:ie=!1}=o,{feature:de=null}=o,{offset:oe=void 0}=o,{zIndex:Te=void 0}=o;const me=cc(),{map:ye,layerEvent:W,self:re}=vy();Et(h,ye,Ne=>l(24,v=Ne)),Et(h,W,Ne=>l(23,c=Ne)),Et(h,re,Ne=>l(14,m=Ne));function le(Ne){Si(re,m=new Wn.Marker({element:Ne,draggable:ie,offset:oe}).setLngLat(C).addTo(v),m);const vt=()=>Ie("dragstart"),gt=()=>{xe(),Ie("drag")},dt=()=>{xe(),Ie("dragend")};return ie&&(m.on("dragstart",vt),m.on("drag",gt),m.on("dragend",dt)),{destroy(){ie&&(m==null||m.off("dragstart",vt),m==null||m.off("drag",gt),m==null||m.off("dragend",dt)),m==null||m.remove()}}}function xe(){let Ne=m==null?void 0:m.getLngLat();Ne&&(Array.isArray(C)?l(9,C=[Ne.lng,Ne.lat]):C&&"lon"in C?l(9,C={lon:Ne.lng,lat:Ne.lat}):l(9,C=Ne))}function Ee(Ne){Ne.key===" "&&(Ne.preventDefault(),Ne.stopPropagation(),Ie("click"))}function Ie(Ne){if(!D)return;let vt=m==null?void 0:m.getLngLat();if(!vt)return;const gt=[vt.lng,vt.lat];let dt={map:v,marker:m,lngLat:gt,features:[{type:"Feature",properties:(de==null?void 0:de.properties)??{},geometry:{type:"Point",coordinates:gt}}]};Si(W,c={...dt,layerType:"marker",type:Ne},c),me(Ne,dt)}const Oe=()=>Ie("click"),qe=()=>Ie("dblclick"),He=()=>Ie("contextmenu"),be=Ne=>{Ie("mouseenter")},Ue=()=>{Ie("mouseleave")},xt=()=>Ie("mousemove");return h.$$set=Ne=>{"lngLat"in Ne&&l(9,C=Ne.lngLat),"class"in Ne&&l(0,I=Ne.class),"interactive"in Ne&&l(10,D=Ne.interactive),"asButton"in Ne&&l(1,q=Ne.asButton),"draggable"in Ne&&l(11,ie=Ne.draggable),"feature"in Ne&&l(12,de=Ne.feature),"offset"in Ne&&l(13,oe=Ne.offset),"zIndex"in Ne&&l(2,Te=Ne.zIndex),"$$scope"in Ne&&l(15,s=Ne.$$scope)},h.$$.update=()=>{h.$$.dirty&16896&&(m==null||m.setLngLat(C)),h.$$.dirty&24576&&(m==null||m.setOffset(oe??[0,0]))},[I,q,Te,ye,W,re,le,Ee,Ie,C,D,ie,de,oe,m,s,T,Oe,qe,He,be,Ue,xt]}class yf extends di{constructor(o){super(),hi(this,o,n0,i0,oi,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2})}}const o0=h=>({features:h[0]&16,data:h[0]&16,map:h[0]&4,close:h[0]&1}),vf=h=>{var o;return{features:h[4],data:(o=h[4])==null?void 0:o[0],map:h[2],close:h[31]}};function bf(h){let o,l,c=(h[4]||h[3]instanceof Wn.Marker)&&xf(h);return{c(){o=we("div"),c&&c.c()},m(m,v){Re(m,o,v),c&&c.m(o,null),h[32](o),l=!0},p(m,v){m[4]||m[3]instanceof Wn.Marker?c?(c.p(m,v),v[0]&24&&Me(c,1)):(c=xf(m),c.c(),Me(c,1),c.m(o,null)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(),h[32](null)}}}function xf(h){let o;const l=h[30].default,c=Jr(l,h,h[29],vf);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v[0]&536870933)&&Qr(c,l,m,m[29],o?$r(l,m[29],v,o0):en(m[29]),vf)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function s0(h){let o,l,c=h[9].default&&bf(h);return{c(){c&&c.c(),o=Bn()},m(m,v){c&&c.m(m,v),Re(m,o,v),l=!0},p(m,v){m[9].default?c?(c.p(m,v),v[0]&512&&Me(c,1)):(c=bf(m),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(m)}}}function a0(h,o,l){let c,m,v,T,s,C,{$$slots:I={},$$scope:D}=o;const q=Vg(I);let{closeButton:ie=void 0}=o,{closeOnClickOutside:de=!0}=o,{closeOnClickInside:oe=!1}=o,{closeOnMove:Te=!1}=o,{openOn:me="click"}=o,{openIfTopMost:ye=!0}=o,{focusAfterOpen:W=!0}=o,{anchor:re=void 0}=o,{offset:le=void 0}=o,{popupClass:xe=void 0}=o,{maxWidth:Ee=void 0}=o,{lngLat:Ie=void 0}=o,{html:Oe=void 0}=o,{open:qe=!1}=o;const{map:He,popupTarget:be,layerEvent:Ue,layer:xt,eventTopMost:Ne}=Ba();Et(h,He,Xe=>l(2,v=Xe)),Et(h,be,Xe=>l(3,s=Xe)),Et(h,Ue,Xe=>l(28,T=Xe)),Et(h,xt,Xe=>l(35,C=Xe));const vt=["click","dblclick","contextmenu"];let gt,dt=!1,Ft;function sr(){if(!gt)return;let Xe=gt.getElement();!Xe||Xe===Ft||(Ft=Xe,me==="hover"&&(Ft.style.pointerEvents="none"),Ft.addEventListener("mouseenter",()=>{l(24,dt=!0)},{passive:!0}),Ft.addEventListener("mouseleave",()=>{l(24,dt=!1)},{passive:!0}),Ft.addEventListener("click",()=>{oe&&l(0,qe=!1)},{passive:!0}))}lc(()=>{if(v)return v.on("click",mi),v.on("contextmenu",mi),typeof s=="string"&&(v.on("click",s,Rt),v.on("dblclick",s,Rt),v.on("contextmenu",s,Rt),v.on("mousemove",s,Je),v.on("mouseleave",s,Ct),v.on("touchstart",s,Yi),v.on("touchend",s,Ge)),()=>{v!=null&&v.loaded()&&(gt==null||gt.remove(),v.off("click",mi),v.off("contextmenu",mi),s instanceof Wn.Marker?s.getPopup()===gt&&s.setPopup(void 0):typeof s=="string"&&(v.off("click",s,Rt),v.off("dblclick",s,Rt),v.off("contextmenu",s,Rt),v.off("mousemove",s,Je),v.off("mouseleave",s,Ct),v.off("touchstart",s,Yi),v.off("touchend",s,Ge)))}});function Ri(Xe){return ye?!("marker"in Xe)&&!by(Xe)&&Ne(Xe)!==C:!1}let Jt=null,Ut="normal";function Rt(Xe){Xe.type===me&&(Ri(Xe)||("layerType"in Xe?Xe.layerType==="deckgl"?(l(10,Ie=Xe.coordinate),l(4,Jt=Xe.object?[Xe.object]:null)):(l(10,Ie=Xe.lngLat),l(4,Jt=Xe.features??[])):(l(10,Ie=Xe.lngLat),l(4,Jt=Xe.features??[])),setTimeout(()=>l(0,qe=!0))))}let fi=null;function Yi(Xe){fi=Xe.point}function Ge(Xe){if(!fi||me!=="hover")return;let Ti=fi.dist(Xe.point);fi=null,Ti<3&&(l(10,Ie=Xe.lngLat),l(4,Jt=Xe.features??[]),gt.isOpen()?l(25,Ut="justOpened"):(l(25,Ut="opening"),l(0,qe=!0)))}function Ct(Xe){me!=="hover"||fi||Ut!=="normal"||(l(0,qe=!1),l(4,Jt=null))}function Je(Xe){if(!(me!=="hover"||fi||Ut!=="normal")){if(Ri(Xe)){l(0,qe=!1),l(4,Jt=null);return}l(0,qe=!0),l(4,Jt=Xe.features??[]),l(10,Ie=Xe.lngLat)}}function mi(Xe){if(Ut==="justOpened"){l(25,Ut="normal");return}if(!de)return;let Ti=[Ft,s instanceof Wn.Marker?s==null?void 0:s.getElement():null];qe&&gt.isOpen()&&!Ti.some(Gi=>Gi==null?void 0:Gi.contains(Xe.originalEvent.target))&&(Xe.type==="contextmenu"&&me==="contextmenu"||Xe.type!=="contextmenu")&&l(0,qe=!1)}let Ht;const wi=()=>l(0,qe=!1);function Zi(Xe){Ur[Xe?"unshift":"push"](()=>{Ht=Xe,l(1,Ht)})}return h.$$set=Xe=>{"closeButton"in Xe&&l(11,ie=Xe.closeButton),"closeOnClickOutside"in Xe&&l(12,de=Xe.closeOnClickOutside),"closeOnClickInside"in Xe&&l(13,oe=Xe.closeOnClickInside),"closeOnMove"in Xe&&l(14,Te=Xe.closeOnMove),"openOn"in Xe&&l(15,me=Xe.openOn),"openIfTopMost"in Xe&&l(16,ye=Xe.openIfTopMost),"focusAfterOpen"in Xe&&l(17,W=Xe.focusAfterOpen),"anchor"in Xe&&l(18,re=Xe.anchor),"offset"in Xe&&l(19,le=Xe.offset),"popupClass"in Xe&&l(20,xe=Xe.popupClass),"maxWidth"in Xe&&l(21,Ee=Xe.maxWidth),"lngLat"in Xe&&l(10,Ie=Xe.lngLat),"html"in Xe&&l(22,Oe=Xe.html),"open"in Xe&&l(0,qe=Xe.open),"$$scope"in Xe&&l(29,D=Xe.$$scope)},h.$$.update=()=>{if(h.$$.dirty[0]&14336&&l(27,c=ie??(!de&&!oe)),h.$$.dirty[0]&146685952&&(gt||(l(23,gt=new Wn.Popup({closeButton:c,closeOnClick:!1,closeOnMove:Te,focusAfterOpen:W,maxWidth:Ee,className:xe,anchor:re,offset:le})),Ft=gt.getElement(),gt.on("open",()=>{l(0,qe=!0),sr()}),gt.on("close",Xe=>{l(0,qe=!1)}))),h.$$.dirty[0]&8421384&&gt&&s instanceof Wn.Marker&&(me==="click"?s.setPopup(gt):s.getPopup()===gt&&s.setPopup(void 0)),h.$$.dirty[0]&268468224&&vt.includes(me)&&(T==null?void 0:T.type)===me&&(Rt(T),Si(Ue,T=null,T)),h.$$.dirty[0]&268468224&&l(26,m=me==="hover"&&((T==null?void 0:T.type)==="mousemove"||(T==null?void 0:T.type)==="mouseenter")),h.$$.dirty[0]&352354304&&me==="hover"&&Ue&&(m&&T&&(T.layerType==="deckgl"?(l(10,Ie=T.coordinate),l(4,Jt=T.object?[T.object]:null)):(l(10,Ie=T.lngLat),l(4,Jt=T.features??[]))),l(0,qe=(m||dt)??!1)),h.$$.dirty[0]&12582914&&(Ht?gt.setDOMContent(Ht):Oe&&gt.setHTML(Oe)),h.$$.dirty[0]&8389632&&Ie&&gt.setLngLat(Ie),h.$$.dirty[0]&41943045&&v){let Xe=gt.isOpen();qe&&!Xe?(gt.addTo(v),Ut==="opening"&&l(25,Ut="justOpened")):!qe&&Xe&&gt.remove()}},[qe,Ht,v,s,Jt,He,be,Ue,xt,q,Ie,ie,de,oe,Te,me,ye,W,re,le,xe,Ee,Oe,gt,dt,Ut,m,c,T,D,I,wi,Zi]}class Ns extends di{constructor(o){super(),hi(this,o,a0,s0,oi,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var dc=Uint8Array,_m=Uint16Array,l0=Int32Array,c0=new dc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u0=new dc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gm=function(h,o){for(var l=new _m(31),c=0;c<31;++c)l[c]=o+=1<<h[c-1];for(var m=new l0(l[30]),c=1;c<30;++c)for(var v=l[c];v<l[c+1];++v)m[v]=v-l[c]<<5|c;return{b:l,r:m}},ym=gm(c0,2),h0=ym.b,d0=ym.r;h0[28]=258,d0[258]=28;gm(u0,0);var p0=new _m(32768);for(xi=0;xi<32768;++xi)No=(xi&43690)>>1|(xi&21845)<<1,No=(No&52428)>>2|(No&13107)<<2,No=(No&61680)>>4|(No&3855)<<4,p0[xi]=((No&65280)>>8|(No&255)<<8)>>1;var No,xi,Bu=new dc(288);for(xi=0;xi<144;++xi)Bu[xi]=8;var xi;for(xi=144;xi<256;++xi)Bu[xi]=9;var xi;for(xi=256;xi<280;++xi)Bu[xi]=7;var xi;for(xi=280;xi<288;++xi)Bu[xi]=8;var xi,f0=new dc(32);for(xi=0;xi<32;++xi)f0[xi]=5;var xi,m0=new dc(0),_0=typeof TextDecoder<"u"&&new TextDecoder,g0=0;try{_0.decode(m0,{stream:!0}),g0=1}catch{}const y0=h=>({}),wf=h=>({}),v0=h=>({}),Sf=h=>({});function b0(h){let o,l,c,m;const v=h[1].left,T=Jr(v,h,h[0],Sf),s=h[1].main,C=Jr(s,h,h[0],wf);return{c(){o=we("div"),T&&T.c(),l=st(),c=we("div"),C&&C.c(),qt(o,"class","left svelte-6kzmjs"),qt(c,"class","main svelte-6kzmjs")},m(I,D){Re(I,o,D),T&&T.m(o,null),Re(I,l,D),Re(I,c,D),C&&C.m(c,null),m=!0},p(I,[D]){T&&T.p&&(!m||D&1)&&Qr(T,v,I,I[0],m?$r(v,I[0],D,v0):en(I[0]),Sf),C&&C.p&&(!m||D&1)&&Qr(C,s,I,I[0],m?$r(s,I[0],D,y0):en(I[0]),wf)},i(I){m||(Me(T,I),Me(C,I),m=!0)},o(I){Ae(T,I),Ae(C,I),m=!1},d(I){I&&(Fe(o),Fe(l),Fe(c)),T&&T.d(I),C&&C.d(I)}}}function x0(h,o,l){let{$$slots:c={},$$scope:m}=o;return h.$$set=v=>{"$$scope"in v&&l(0,m=v.$$scope)},[m,c]}class w0 extends di{constructor(o){super(),hi(this,o,x0,b0,oi,{})}}function Tf(h){let o,l;return{c(){o=we("div"),l=Xt(h[0]),qt(o,"class","svelte-1uuov7f")},m(c,m){Re(c,o,m),_e(o,l)},p(c,m){m&1&&tn(l,c[0])},d(c){c&&Fe(o)}}}function S0(h){let o,l=h[0]&&Tf(h);return{c(){l&&l.c(),o=Bn()},m(c,m){l&&l.m(c,m),Re(c,o,m)},p(c,[m]){c[0]?l?l.p(c,m):(l=Tf(c),l.c(),l.m(o.parentNode,o)):l&&(l.d(1),l=null)},i:Vt,o:Vt,d(c){c&&Fe(o),l&&l.d(c)}}}function T0(h,o,l){let{msg:c=null}=o;return h.$$set=m=>{"msg"in m&&l(0,c=m.msg)},[c]}class vm extends di{constructor(o){super(),hi(this,o,T0,S0,oi,{msg:0})}}const k0=h=>({dialog:h&1}),kf=h=>({dialog:h[0]});function I0(h){let o,l,c,m,v;const T=h[4].default,s=Jr(T,h,h[3],kf);return{c(){o=we("dialog"),l=we("div"),s&&s.c(),qt(l,"class","svelte-4ltw9q"),o.open=!0,qt(o,"class","svelte-4ltw9q")},m(C,I){Re(C,o,I),_e(o,l),s&&s.m(l,null),h[6](o),c=!0,m||(v=[Dt(window,"click",h[1]),Dt(window,"keydown",h[2]),Dt(o,"close",h[5])],m=!0)},p(C,[I]){s&&s.p&&(!c||I&9)&&Qr(s,T,C,C[3],c?$r(T,C[3],I,k0):en(C[3]),kf)},i(C){c||(Me(s,C),c=!0)},o(C){Ae(s,C),c=!1},d(C){C&&Fe(o),s&&s.d(C),h[6](null),m=!1,gn(v)}}}function M0(h,o,l){let{$$slots:c={},$$scope:m}=o,v;function T(D){v.open&&D.target==v&&v.close()}function s(D){(D.key=="Escape"||D.key=="Enter")&&(D.stopPropagation(),v.close())}function C(D){yr.call(this,h,D)}function I(D){Ur[D?"unshift":"push"](()=>{v=D,l(0,v)})}return h.$$set=D=>{"$$scope"in D&&l(3,m=D.$$scope)},[v,T,s,m,c,C,I]}class bm extends di{constructor(o){super(),hi(this,o,M0,I0,oi,{})}}var Yr=63710088e-1,_d={centimeters:Yr*100,centimetres:Yr*100,degrees:Yr/111325,feet:Yr*3.28084,inches:Yr*39.37,kilometers:Yr/1e3,kilometres:Yr/1e3,meters:Yr,metres:Yr,miles:Yr/1609.344,millimeters:Yr*1e3,millimetres:Yr*1e3,nauticalmiles:Yr/1852,radians:1,yards:Yr*1.0936},C0={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Yr,yards:1.0936133},od={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Yn(h,o,l){l===void 0&&(l={});var c={type:"Feature"};return(l.id===0||l.id)&&(c.id=l.id),l.bbox&&(c.bbox=l.bbox),c.properties=o||{},c.geometry=h,c}function A0(h,o,l){switch(h){case"Point":return In(o).geometry;case"LineString":return Hn(o).geometry;case"Polygon":return gd(o).geometry;case"MultiPoint":return wm(o).geometry;case"MultiLineString":return xm(o).geometry;case"MultiPolygon":return Sm(o).geometry;default:throw new Error(h+" is invalid")}}function In(h,o,l){if(l===void 0&&(l={}),!h)throw new Error("coordinates is required");if(!Array.isArray(h))throw new Error("coordinates must be an Array");if(h.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pu(h[0])||!Pu(h[1]))throw new Error("coordinates must contain numbers");var c={type:"Point",coordinates:h};return Yn(c,o,l)}function E0(h,o,l){return l===void 0&&(l={}),Rs(h.map(function(c){return In(c,o)}),l)}function gd(h,o,l){l===void 0&&(l={});for(var c=0,m=h;c<m.length;c++){var v=m[c];if(v.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var T=0;T<v[v.length-1].length;T++)if(v[v.length-1][T]!==v[0][T])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:h};return Yn(s,o,l)}function P0(h,o,l){return l===void 0&&(l={}),Rs(h.map(function(c){return gd(c,o)}),l)}function Hn(h,o,l){if(l===void 0&&(l={}),h.length<2)throw new Error("coordinates must be an array of two or more positions");var c={type:"LineString",coordinates:h};return Yn(c,o,l)}function z0(h,o,l){return l===void 0&&(l={}),Rs(h.map(function(c){return Hn(c,o)}),l)}function Rs(h,o){o===void 0&&(o={});var l={type:"FeatureCollection"};return o.id&&(l.id=o.id),o.bbox&&(l.bbox=o.bbox),l.features=h,l}function xm(h,o,l){l===void 0&&(l={});var c={type:"MultiLineString",coordinates:h};return Yn(c,o,l)}function wm(h,o,l){l===void 0&&(l={});var c={type:"MultiPoint",coordinates:h};return Yn(c,o,l)}function Sm(h,o,l){l===void 0&&(l={});var c={type:"MultiPolygon",coordinates:h};return Yn(c,o,l)}function L0(h,o,l){l===void 0&&(l={});var c={type:"GeometryCollection",geometries:h};return Yn(c,o,l)}function D0(h,o){if(o===void 0&&(o=0),o&&!(o>=0))throw new Error("precision must be a positive number");var l=Math.pow(10,o||0);return Math.round(h*l)/l}function yd(h,o){o===void 0&&(o="kilometers");var l=_d[o];if(!l)throw new Error(o+" units is invalid");return h*l}function Fu(h,o){o===void 0&&(o="kilometers");var l=_d[o];if(!l)throw new Error(o+" units is invalid");return h/l}function B0(h,o){return oc(Fu(h,o))}function F0(h){var o=h%360;return o<0&&(o+=360),o}function oc(h){var o=h%(2*Math.PI);return o*180/Math.PI}function Kn(h){var o=h%360;return o*Math.PI/180}function R0(h,o,l){if(o===void 0&&(o="kilometers"),l===void 0&&(l="kilometers"),!(h>=0))throw new Error("length must be a positive number");return yd(Fu(h,o),l)}function O0(h,o,l){if(o===void 0&&(o="meters"),l===void 0&&(l="kilometers"),!(h>=0))throw new Error("area must be a positive number");var c=od[o];if(!c)throw new Error("invalid original units");var m=od[l];if(!m)throw new Error("invalid final units");return h/c*m}function Pu(h){return!isNaN(h)&&h!==null&&!Array.isArray(h)}function vd(h){return!!h&&h.constructor===Object}function N0(h){if(!h)throw new Error("bbox is required");if(!Array.isArray(h))throw new Error("bbox must be an Array");if(h.length!==4&&h.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");h.forEach(function(o){if(!Pu(o))throw new Error("bbox must only contain numbers")})}function V0(h){if(!h)throw new Error("id is required");if(["string","number"].indexOf(typeof h)===-1)throw new Error("id must be a number or a string")}const U0=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:od,bearingToAzimuth:F0,convertArea:O0,convertLength:R0,degreesToRadians:Kn,earthRadius:Yr,factors:_d,feature:Yn,featureCollection:Rs,geometry:A0,geometryCollection:L0,isNumber:Pu,isObject:vd,lengthToDegrees:B0,lengthToRadians:Fu,lineString:Hn,lineStrings:z0,multiLineString:xm,multiPoint:wm,multiPolygon:Sm,point:In,points:E0,polygon:gd,polygons:P0,radiansToDegrees:oc,radiansToLength:yd,round:D0,unitsFactors:C0,validateBBox:N0,validateId:V0},Symbol.toStringTag,{value:"Module"}));function sc(h){if(!h)throw new Error("coord is required");if(!Array.isArray(h)){if(h.type==="Feature"&&h.geometry!==null&&h.geometry.type==="Point")return h.geometry.coordinates;if(h.type==="Point")return h.coordinates}if(Array.isArray(h)&&h.length>=2&&!Array.isArray(h[0])&&!Array.isArray(h[1]))return h;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Da(h){if(Array.isArray(h))return h;if(h.type==="Feature"){if(h.geometry!==null)return h.geometry.coordinates}else if(h.coordinates)return h.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Tm(h,o,l){if(l===void 0&&(l={}),l.final===!0)return j0(h,o);var c=sc(h),m=sc(o),v=Kn(c[0]),T=Kn(m[0]),s=Kn(c[1]),C=Kn(m[1]),I=Math.sin(T-v)*Math.cos(C),D=Math.cos(s)*Math.sin(C)-Math.sin(s)*Math.cos(C)*Math.cos(T-v);return oc(Math.atan2(I,D))}function j0(h,o){var l=Tm(o,h);return l=(l+180)%360,l}function Zl(h,o,l){l===void 0&&(l={});var c=sc(h),m=sc(o),v=Kn(m[1]-c[1]),T=Kn(m[0]-c[0]),s=Kn(c[1]),C=Kn(m[1]),I=Math.pow(Math.sin(v/2),2)+Math.pow(Math.sin(T/2),2)*Math.cos(s)*Math.cos(C);return yd(2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)),l.units)}function If(h,o,l,c){c===void 0&&(c={});var m=sc(h),v=Kn(m[0]),T=Kn(m[1]),s=Kn(l),C=Fu(o,c.units),I=Math.asin(Math.sin(T)*Math.cos(C)+Math.cos(T)*Math.sin(C)*Math.cos(s)),D=v+Math.atan2(Math.sin(s)*Math.sin(C)*Math.cos(T),Math.cos(C)-Math.sin(T)*Math.sin(I)),q=oc(D),ie=oc(I);return In([q,ie],c.properties)}function pc(h,o,l){if(h!==null)for(var c,m,v,T,s,C,I,D=0,q=0,ie,de=h.type,oe=de==="FeatureCollection",Te=de==="Feature",me=oe?h.features.length:1,ye=0;ye<me;ye++){I=oe?h.features[ye].geometry:Te?h.geometry:h,ie=I?I.type==="GeometryCollection":!1,s=ie?I.geometries.length:1;for(var W=0;W<s;W++){var re=0,le=0;if(T=ie?I.geometries[W]:I,T!==null){C=T.coordinates;var xe=T.type;switch(D=l&&(xe==="Polygon"||xe==="MultiPolygon")?1:0,xe){case null:break;case"Point":if(o(C,q,ye,re,le)===!1)return!1;q++,re++;break;case"LineString":case"MultiPoint":for(c=0;c<C.length;c++){if(o(C[c],q,ye,re,le)===!1)return!1;q++,xe==="MultiPoint"&&re++}xe==="LineString"&&re++;break;case"Polygon":case"MultiLineString":for(c=0;c<C.length;c++){for(m=0;m<C[c].length-D;m++){if(o(C[c][m],q,ye,re,le)===!1)return!1;q++}xe==="MultiLineString"&&re++,xe==="Polygon"&&le++}xe==="Polygon"&&re++;break;case"MultiPolygon":for(c=0;c<C.length;c++){for(le=0,m=0;m<C[c].length;m++){for(v=0;v<C[c][m].length-D;v++){if(o(C[c][m][v],q,ye,re,le)===!1)return!1;q++}le++}re++}break;case"GeometryCollection":for(c=0;c<T.geometries.length;c++)if(pc(T.geometries[c],o,l)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function q0(h,o,l,c){var m=l;return pc(h,function(v,T,s,C,I){T===0&&l===void 0?m=v:m=o(m,v,T,s,C,I)},c),m}function km(h,o){var l;switch(h.type){case"FeatureCollection":for(l=0;l<h.features.length&&o(h.features[l].properties,l)!==!1;l++);break;case"Feature":o(h.properties,0);break}}function Z0(h,o,l){var c=l;return km(h,function(m,v){v===0&&l===void 0?c=m:c=o(c,m,v)}),c}function zu(h,o){if(h.type==="Feature")o(h,0);else if(h.type==="FeatureCollection")for(var l=0;l<h.features.length&&o(h.features[l],l)!==!1;l++);}function G0(h,o,l){var c=l;return zu(h,function(m,v){v===0&&l===void 0?c=m:c=o(c,m,v)}),c}function X0(h){var o=[];return pc(h,function(l){o.push(l)}),o}function bd(h,o){var l,c,m,v,T,s,C,I,D,q,ie=0,de=h.type==="FeatureCollection",oe=h.type==="Feature",Te=de?h.features.length:1;for(l=0;l<Te;l++){for(s=de?h.features[l].geometry:oe?h.geometry:h,I=de?h.features[l].properties:oe?h.properties:{},D=de?h.features[l].bbox:oe?h.bbox:void 0,q=de?h.features[l].id:oe?h.id:void 0,C=s?s.type==="GeometryCollection":!1,T=C?s.geometries.length:1,m=0;m<T;m++){if(v=C?s.geometries[m]:s,v===null){if(o(null,ie,I,D,q)===!1)return!1;continue}switch(v.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(o(v,ie,I,D,q)===!1)return!1;break}case"GeometryCollection":{for(c=0;c<v.geometries.length;c++)if(o(v.geometries[c],ie,I,D,q)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ie++}}function W0(h,o,l){var c=l;return bd(h,function(m,v,T,s,C){v===0&&l===void 0?c=m:c=o(c,m,v,T,s,C)}),c}function Fa(h,o){bd(h,function(l,c,m,v,T){var s=l===null?null:l.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return o(Yn(l,m,{bbox:v,id:T}),c,0)===!1?!1:void 0}var C;switch(s){case"MultiPoint":C="Point";break;case"MultiLineString":C="LineString";break;case"MultiPolygon":C="Polygon";break}for(var I=0;I<l.coordinates.length;I++){var D=l.coordinates[I],q={type:C,coordinates:D};if(o(Yn(q,m),c,I)===!1)return!1}})}function H0(h,o,l){var c=l;return Fa(h,function(m,v,T){v===0&&T===0&&l===void 0?c=m:c=o(c,m,v,T)}),c}function Im(h,o){Fa(h,function(l,c,m){var v=0;if(l.geometry){var T=l.geometry.type;if(!(T==="Point"||T==="MultiPoint")){var s,C=0,I=0,D=0;if(pc(l,function(q,ie,de,oe,Te){if(s===void 0||c>C||oe>I||Te>D){s=q,C=c,I=oe,D=Te,v=0;return}var me=Hn([s,q],l.properties);if(o(me,c,m,Te,v)===!1)return!1;v++,s=q})===!1)return!1}}})}function K0(h,o,l){var c=l,m=!1;return Im(h,function(v,T,s,C,I){m===!1&&l===void 0?c=v:c=o(c,v,T,s,C,I),m=!0}),c}function Mm(h,o){if(!h)throw new Error("geojson is required");Fa(h,function(l,c,m){if(l.geometry!==null){var v=l.geometry.type,T=l.geometry.coordinates;switch(v){case"LineString":if(o(l,c,m,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<T.length;s++)if(o(Hn(T[s],l.properties),c,m,s)===!1)return!1;break}}})}function Y0(h,o,l){var c=l;return Mm(h,function(m,v,T,s){v===0&&l===void 0?c=m:c=o(c,m,v,T,s)}),c}function J0(h,o){if(o=o||{},!vd(o))throw new Error("options is invalid");var l=o.featureIndex||0,c=o.multiFeatureIndex||0,m=o.geometryIndex||0,v=o.segmentIndex||0,T=o.properties,s;switch(h.type){case"FeatureCollection":l<0&&(l=h.features.length+l),T=T||h.features[l].properties,s=h.features[l].geometry;break;case"Feature":T=T||h.properties,s=h.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=h;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var C=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return v<0&&(v=C.length+v-1),Hn([C[v],C[v+1]],T,o);case"Polygon":return m<0&&(m=C.length+m),v<0&&(v=C[m].length+v-1),Hn([C[m][v],C[m][v+1]],T,o);case"MultiLineString":return c<0&&(c=C.length+c),v<0&&(v=C[c].length+v-1),Hn([C[c][v],C[c][v+1]],T,o);case"MultiPolygon":return c<0&&(c=C.length+c),m<0&&(m=C[c].length+m),v<0&&(v=C[c][m].length-v-1),Hn([C[c][m][v],C[c][m][v+1]],T,o)}throw new Error("geojson is invalid")}function $0(h,o){if(o=o||{},!vd(o))throw new Error("options is invalid");var l=o.featureIndex||0,c=o.multiFeatureIndex||0,m=o.geometryIndex||0,v=o.coordIndex||0,T=o.properties,s;switch(h.type){case"FeatureCollection":l<0&&(l=h.features.length+l),T=T||h.features[l].properties,s=h.features[l].geometry;break;case"Feature":T=T||h.properties,s=h.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=h;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var C=s.coordinates;switch(s.type){case"Point":return In(C,T,o);case"MultiPoint":return c<0&&(c=C.length+c),In(C[c],T,o);case"LineString":return v<0&&(v=C.length+v),In(C[v],T,o);case"Polygon":return m<0&&(m=C.length+m),v<0&&(v=C[m].length+v),In(C[m][v],T,o);case"MultiLineString":return c<0&&(c=C.length+c),v<0&&(v=C[c].length+v),In(C[c][v],T,o);case"MultiPolygon":return c<0&&(c=C.length+c),m<0&&(m=C[c].length+m),v<0&&(v=C[c][m].length-v),In(C[c][m][v],T,o)}throw new Error("geojson is invalid")}const Q0=Object.freeze(Object.defineProperty({__proto__:null,coordAll:X0,coordEach:pc,coordReduce:q0,featureEach:zu,featureReduce:G0,findPoint:$0,findSegment:J0,flattenEach:Fa,flattenReduce:H0,geomEach:bd,geomReduce:W0,lineEach:Mm,lineReduce:Y0,propEach:km,propReduce:Z0,segmentEach:Im,segmentReduce:K0},Symbol.toStringTag,{value:"Module"}));function Mf(h){if(!h)throw new Error("geojson is required");var o=[];return Fa(h,function(l){ev(l,o)}),Rs(o)}function ev(h,o){var l=[],c=h.geometry;if(c!==null){switch(c.type){case"Polygon":l=Da(c);break;case"LineString":l=[Da(c)]}l.forEach(function(m){var v=tv(m,h.properties);v.forEach(function(T){T.id=o.length,o.push(T)})})}}function tv(h,o){var l=[];return h.reduce(function(c,m){var v=Hn([c,m],o);return v.bbox=iv(c,m),l.push(v),m}),l}function iv(h,o){var l=h[0],c=h[1],m=o[0],v=o[1],T=l<m?l:m,s=c<v?c:v,C=l>m?l:m,I=c>v?c:v;return[T,s,C,I]}var xd={exports:{}},Cm={exports:{}};(function(h,o){(function(l,c){h.exports=c()})(um,function(){function l(W,re,le,xe,Ee){(function Ie(Oe,qe,He,be,Ue){for(;be>He;){if(be-He>600){var xt=be-He+1,Ne=qe-He+1,vt=Math.log(xt),gt=.5*Math.exp(2*vt/3),dt=.5*Math.sqrt(vt*gt*(xt-gt)/xt)*(Ne-xt/2<0?-1:1),Ft=Math.max(He,Math.floor(qe-Ne*gt/xt+dt)),sr=Math.min(be,Math.floor(qe+(xt-Ne)*gt/xt+dt));Ie(Oe,qe,Ft,sr,Ue)}var Ri=Oe[qe],Jt=He,Ut=be;for(c(Oe,He,qe),Ue(Oe[be],Ri)>0&&c(Oe,He,be);Jt<Ut;){for(c(Oe,Jt,Ut),Jt++,Ut--;Ue(Oe[Jt],Ri)<0;)Jt++;for(;Ue(Oe[Ut],Ri)>0;)Ut--}Ue(Oe[He],Ri)===0?c(Oe,He,Ut):c(Oe,++Ut,be),Ut<=qe&&(He=Ut+1),qe<=Ut&&(be=Ut-1)}})(W,re,le||0,xe||W.length-1,Ee||m)}function c(W,re,le){var xe=W[re];W[re]=W[le],W[le]=xe}function m(W,re){return W<re?-1:W>re?1:0}var v=function(W){W===void 0&&(W=9),this._maxEntries=Math.max(4,W),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function T(W,re,le){if(!le)return re.indexOf(W);for(var xe=0;xe<re.length;xe++)if(le(W,re[xe]))return xe;return-1}function s(W,re){C(W,0,W.children.length,re,W)}function C(W,re,le,xe,Ee){Ee||(Ee=me(null)),Ee.minX=1/0,Ee.minY=1/0,Ee.maxX=-1/0,Ee.maxY=-1/0;for(var Ie=re;Ie<le;Ie++){var Oe=W.children[Ie];I(Ee,W.leaf?xe(Oe):Oe)}return Ee}function I(W,re){return W.minX=Math.min(W.minX,re.minX),W.minY=Math.min(W.minY,re.minY),W.maxX=Math.max(W.maxX,re.maxX),W.maxY=Math.max(W.maxY,re.maxY),W}function D(W,re){return W.minX-re.minX}function q(W,re){return W.minY-re.minY}function ie(W){return(W.maxX-W.minX)*(W.maxY-W.minY)}function de(W){return W.maxX-W.minX+(W.maxY-W.minY)}function oe(W,re){return W.minX<=re.minX&&W.minY<=re.minY&&re.maxX<=W.maxX&&re.maxY<=W.maxY}function Te(W,re){return re.minX<=W.maxX&&re.minY<=W.maxY&&re.maxX>=W.minX&&re.maxY>=W.minY}function me(W){return{children:W,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ye(W,re,le,xe,Ee){for(var Ie=[re,le];Ie.length;)if(!((le=Ie.pop())-(re=Ie.pop())<=xe)){var Oe=re+Math.ceil((le-re)/xe/2)*xe;l(W,Oe,re,le,Ee),Ie.push(re,Oe,Oe,le)}}return v.prototype.all=function(){return this._all(this.data,[])},v.prototype.search=function(W){var re=this.data,le=[];if(!Te(W,re))return le;for(var xe=this.toBBox,Ee=[];re;){for(var Ie=0;Ie<re.children.length;Ie++){var Oe=re.children[Ie],qe=re.leaf?xe(Oe):Oe;Te(W,qe)&&(re.leaf?le.push(Oe):oe(W,qe)?this._all(Oe,le):Ee.push(Oe))}re=Ee.pop()}return le},v.prototype.collides=function(W){var re=this.data;if(!Te(W,re))return!1;for(var le=[];re;){for(var xe=0;xe<re.children.length;xe++){var Ee=re.children[xe],Ie=re.leaf?this.toBBox(Ee):Ee;if(Te(W,Ie)){if(re.leaf||oe(W,Ie))return!0;le.push(Ee)}}re=le.pop()}return!1},v.prototype.load=function(W){if(!W||!W.length)return this;if(W.length<this._minEntries){for(var re=0;re<W.length;re++)this.insert(W[re]);return this}var le=this._build(W.slice(),0,W.length-1,0);if(this.data.children.length)if(this.data.height===le.height)this._splitRoot(this.data,le);else{if(this.data.height<le.height){var xe=this.data;this.data=le,le=xe}this._insert(le,this.data.height-le.height-1,!0)}else this.data=le;return this},v.prototype.insert=function(W){return W&&this._insert(W,this.data.height-1),this},v.prototype.clear=function(){return this.data=me([]),this},v.prototype.remove=function(W,re){if(!W)return this;for(var le,xe,Ee,Ie=this.data,Oe=this.toBBox(W),qe=[],He=[];Ie||qe.length;){if(Ie||(Ie=qe.pop(),xe=qe[qe.length-1],le=He.pop(),Ee=!0),Ie.leaf){var be=T(W,Ie.children,re);if(be!==-1)return Ie.children.splice(be,1),qe.push(Ie),this._condense(qe),this}Ee||Ie.leaf||!oe(Ie,Oe)?xe?(le++,Ie=xe.children[le],Ee=!1):Ie=null:(qe.push(Ie),He.push(le),le=0,xe=Ie,Ie=Ie.children[0])}return this},v.prototype.toBBox=function(W){return W},v.prototype.compareMinX=function(W,re){return W.minX-re.minX},v.prototype.compareMinY=function(W,re){return W.minY-re.minY},v.prototype.toJSON=function(){return this.data},v.prototype.fromJSON=function(W){return this.data=W,this},v.prototype._all=function(W,re){for(var le=[];W;)W.leaf?re.push.apply(re,W.children):le.push.apply(le,W.children),W=le.pop();return re},v.prototype._build=function(W,re,le,xe){var Ee,Ie=le-re+1,Oe=this._maxEntries;if(Ie<=Oe)return s(Ee=me(W.slice(re,le+1)),this.toBBox),Ee;xe||(xe=Math.ceil(Math.log(Ie)/Math.log(Oe)),Oe=Math.ceil(Ie/Math.pow(Oe,xe-1))),(Ee=me([])).leaf=!1,Ee.height=xe;var qe=Math.ceil(Ie/Oe),He=qe*Math.ceil(Math.sqrt(Oe));ye(W,re,le,He,this.compareMinX);for(var be=re;be<=le;be+=He){var Ue=Math.min(be+He-1,le);ye(W,be,Ue,qe,this.compareMinY);for(var xt=be;xt<=Ue;xt+=qe){var Ne=Math.min(xt+qe-1,Ue);Ee.children.push(this._build(W,xt,Ne,xe-1))}}return s(Ee,this.toBBox),Ee},v.prototype._chooseSubtree=function(W,re,le,xe){for(;xe.push(re),!re.leaf&&xe.length-1!==le;){for(var Ee=1/0,Ie=1/0,Oe=void 0,qe=0;qe<re.children.length;qe++){var He=re.children[qe],be=ie(He),Ue=(xt=W,Ne=He,(Math.max(Ne.maxX,xt.maxX)-Math.min(Ne.minX,xt.minX))*(Math.max(Ne.maxY,xt.maxY)-Math.min(Ne.minY,xt.minY))-be);Ue<Ie?(Ie=Ue,Ee=be<Ee?be:Ee,Oe=He):Ue===Ie&&be<Ee&&(Ee=be,Oe=He)}re=Oe||re.children[0]}var xt,Ne;return re},v.prototype._insert=function(W,re,le){var xe=le?W:this.toBBox(W),Ee=[],Ie=this._chooseSubtree(xe,this.data,re,Ee);for(Ie.children.push(W),I(Ie,xe);re>=0&&Ee[re].children.length>this._maxEntries;)this._split(Ee,re),re--;this._adjustParentBBoxes(xe,Ee,re)},v.prototype._split=function(W,re){var le=W[re],xe=le.children.length,Ee=this._minEntries;this._chooseSplitAxis(le,Ee,xe);var Ie=this._chooseSplitIndex(le,Ee,xe),Oe=me(le.children.splice(Ie,le.children.length-Ie));Oe.height=le.height,Oe.leaf=le.leaf,s(le,this.toBBox),s(Oe,this.toBBox),re?W[re-1].children.push(Oe):this._splitRoot(le,Oe)},v.prototype._splitRoot=function(W,re){this.data=me([W,re]),this.data.height=W.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},v.prototype._chooseSplitIndex=function(W,re,le){for(var xe,Ee,Ie,Oe,qe,He,be,Ue=1/0,xt=1/0,Ne=re;Ne<=le-re;Ne++){var vt=C(W,0,Ne,this.toBBox),gt=C(W,Ne,le,this.toBBox),dt=(Ee=vt,Ie=gt,Oe=void 0,qe=void 0,He=void 0,be=void 0,Oe=Math.max(Ee.minX,Ie.minX),qe=Math.max(Ee.minY,Ie.minY),He=Math.min(Ee.maxX,Ie.maxX),be=Math.min(Ee.maxY,Ie.maxY),Math.max(0,He-Oe)*Math.max(0,be-qe)),Ft=ie(vt)+ie(gt);dt<Ue?(Ue=dt,xe=Ne,xt=Ft<xt?Ft:xt):dt===Ue&&Ft<xt&&(xt=Ft,xe=Ne)}return xe||le-re},v.prototype._chooseSplitAxis=function(W,re,le){var xe=W.leaf?this.compareMinX:D,Ee=W.leaf?this.compareMinY:q;this._allDistMargin(W,re,le,xe)<this._allDistMargin(W,re,le,Ee)&&W.children.sort(xe)},v.prototype._allDistMargin=function(W,re,le,xe){W.children.sort(xe);for(var Ee=this.toBBox,Ie=C(W,0,re,Ee),Oe=C(W,le-re,le,Ee),qe=de(Ie)+de(Oe),He=re;He<le-re;He++){var be=W.children[He];I(Ie,W.leaf?Ee(be):be),qe+=de(Ie)}for(var Ue=le-re-1;Ue>=re;Ue--){var xt=W.children[Ue];I(Oe,W.leaf?Ee(xt):xt),qe+=de(Oe)}return qe},v.prototype._adjustParentBBoxes=function(W,re,le){for(var xe=le;xe>=0;xe--)I(re[xe],W)},v.prototype._condense=function(W){for(var re=W.length-1,le=void 0;re>=0;re--)W[re].children.length===0?re>0?(le=W[re-1].children).splice(le.indexOf(W[re]),1):this.clear():s(W[re],this.toBBox)},v})})(Cm);var rv=Cm.exports;const nv=dm(U0),Am=dm(Q0);var wd={};Object.defineProperty(wd,"__esModule",{value:!0});var ov=Am;function sd(h){var o=[1/0,1/0,-1/0,-1/0];return ov.coordEach(h,function(l){o[0]>l[0]&&(o[0]=l[0]),o[1]>l[1]&&(o[1]=l[1]),o[2]<l[0]&&(o[2]=l[0]),o[3]<l[1]&&(o[3]=l[1])}),o}sd.default=sd;wd.default=sd;var vo=rv,Em=nv,Pm=Am,Ca=wd.default,sv=Pm.featureEach;Pm.coordEach;Em.polygon;var Cf=Em.featureCollection;function zm(h){var o=new vo(h);return o.insert=function(l){if(l.type!=="Feature")throw new Error("invalid feature");return l.bbox=l.bbox?l.bbox:Ca(l),vo.prototype.insert.call(this,l)},o.load=function(l){var c=[];return Array.isArray(l)?l.forEach(function(m){if(m.type!=="Feature")throw new Error("invalid features");m.bbox=m.bbox?m.bbox:Ca(m),c.push(m)}):sv(l,function(m){if(m.type!=="Feature")throw new Error("invalid features");m.bbox=m.bbox?m.bbox:Ca(m),c.push(m)}),vo.prototype.load.call(this,c)},o.remove=function(l,c){if(l.type!=="Feature")throw new Error("invalid feature");return l.bbox=l.bbox?l.bbox:Ca(l),vo.prototype.remove.call(this,l,c)},o.clear=function(){return vo.prototype.clear.call(this)},o.search=function(l){var c=vo.prototype.search.call(this,this.toBBox(l));return Cf(c)},o.collides=function(l){return vo.prototype.collides.call(this,this.toBBox(l))},o.all=function(){var l=vo.prototype.all.call(this);return Cf(l)},o.toJSON=function(){return vo.prototype.toJSON.call(this)},o.fromJSON=function(l){return vo.prototype.fromJSON.call(this,l)},o.toBBox=function(l){var c;if(l.bbox)c=l.bbox;else if(Array.isArray(l)&&l.length===4)c=l;else if(Array.isArray(l)&&l.length===6)c=[l[0],l[1],l[3],l[4]];else if(l.type==="Feature")c=Ca(l);else if(l.type==="FeatureCollection")c=Ca(l);else throw new Error("invalid geojson");return{minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}},o}xd.exports=zm;xd.exports.default=zm;var av=xd.exports;const lv=hm(av);function cv(h,o){var l={},c=[];if(h.type==="LineString"&&(h=Yn(h)),o.type==="LineString"&&(o=Yn(o)),h.type==="Feature"&&o.type==="Feature"&&h.geometry!==null&&o.geometry!==null&&h.geometry.type==="LineString"&&o.geometry.type==="LineString"&&h.geometry.coordinates.length===2&&o.geometry.coordinates.length===2){var m=Af(h,o);return m&&c.push(m),Rs(c)}var v=lv();return v.load(Mf(o)),zu(Mf(h),function(T){zu(v.search(T),function(s){var C=Af(T,s);if(C){var I=Da(C).join(",");l[I]||(l[I]=!0,c.push(C))}})}),Rs(c)}function Af(h,o){var l=Da(h),c=Da(o);if(l.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(c.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var m=l[0][0],v=l[0][1],T=l[1][0],s=l[1][1],C=c[0][0],I=c[0][1],D=c[1][0],q=c[1][1],ie=(q-I)*(T-m)-(D-C)*(s-v),de=(D-C)*(v-I)-(q-I)*(m-C),oe=(T-m)*(v-I)-(s-v)*(m-C);if(ie===0)return null;var Te=de/ie,me=oe/ie;if(Te>=0&&Te<=1&&me>=0&&me<=1){var ye=m+Te*(T-m),W=v+Te*(s-v);return In([ye,W])}return null}function uv(h,o,l){l===void 0&&(l={});var c=In([1/0,1/0],{dist:1/0}),m=0;return Fa(h,function(v){for(var T=Da(v),s=0;s<T.length-1;s++){var C=In(T[s]);C.properties.dist=Zl(o,C,l);var I=In(T[s+1]);I.properties.dist=Zl(o,I,l);var D=Zl(C,I,l),q=Math.max(C.properties.dist,I.properties.dist),ie=Tm(C,I),de=If(o,q,ie+90,l),oe=If(o,q,ie-90,l),Te=cv(Hn([de.geometry.coordinates,oe.geometry.coordinates]),Hn([C.geometry.coordinates,I.geometry.coordinates])),me=null;Te.features.length>0&&(me=Te.features[0],me.properties.dist=Zl(o,me,l),me.properties.location=m+Zl(C,me,l)),C.properties.dist<c.properties.dist&&(c=C,c.properties.index=s,c.properties.location=m),I.properties.dist<c.properties.dist&&(c=I,c.properties.index=s+1,c.properties.location=m+D),me&&me.properties.dist<c.properties.dist&&(c=me,c.properties.index=s),m+=D}}),c}const Lm=or({type:"FeatureCollection",features:[]}),Dm=or(0),hv=100;class dv{constructor(o){_i(this,"map");_i(this,"active");_i(this,"eventListenersSuccess");_i(this,"eventListenersUpdated");_i(this,"eventListenersFailure");_i(this,"points");_i(this,"cursor");_i(this,"hover");_i(this,"dragFrom");_i(this,"previousStates");_i(this,"onMouseMove",o=>{if(this.active&&!this.dragFrom)this.recalculateHovering(o);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let l=this.dragFrom[0]-o.lngLat.lng,c=this.dragFrom[1]-o.lngLat.lat;for(let m of this.points)m[0]-=l,m[1]-=c}else this.points[this.hover]=o.lngLat.toArray();this.dragFrom=o.lngLat.toArray(),this.redraw()}});_i(this,"onClick",o=>{if(this.beforeUpdate(),this.active&&this.cursor){let l=[];if(Ef(this.points).forEach((c,m)=>{l.push([m+1,uv(c,this.cursor).properties.dist])}),l.sort((c,m)=>c[1]-m[1]),l.length>0){let c=l[0][0];this.points.splice(c,0,this.cursor.geometry.coordinates),this.hover=c}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(o))});_i(this,"onDoubleClick",o=>{this.active&&(o.preventDefault(),this.cursor=$h(o.lngLat.toArray()),this.onClick(o),this.finish())});_i(this,"onMouseDown",o=>{this.active&&!this.dragFrom&&this.hover!=null&&(o.preventDefault(),this.cursor=null,this.dragFrom=o.lngLat.toArray(),this.beforeUpdate(),this.redraw())});_i(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});_i(this,"onKeypress",o=>{this.active&&(o.key=="Enter"?(o.stopPropagation(),this.finish()):o.key=="z"&&o.ctrlKey&&this.undo())});_i(this,"onKeyDown",o=>{this.active&&o.key=="Escape"&&(o.stopPropagation(),this.cancel())});this.map=o,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let o=this.polygonFeature();if(o)for(let l of this.eventListenersSuccess)l(o);else for(let l of this.eventListenersFailure)l();this.stop()}cancel(){for(let o of this.eventListenersFailure)o();this.stop()}addEventListenerSuccess(o){this.eventListenersSuccess.push(o)}addEventListenerUpdated(o){this.eventListenersUpdated.push(o)}addEventListenerFailure(o){this.eventListenersFailure.push(o)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(o){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(o.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let o={type:"FeatureCollection",features:[]};this.points.forEach((m,v)=>{let T=$h(m);T.properties.hover=this.hover==v,T.properties.idx=v,o.features.push(T)}),o.features=o.features.concat(Ef(this.points));let l=this.polygonFeature();l&&(l.properties.hover=this.hover=="polygon",o.features.push(l)),Lm.set(o);let c="crosshair";this.hover!=null&&(c=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=c,Dm.set(this.previousStates.length)}pointsUpdated(){let o=this.polygonFeature();if(o)for(let l of this.eventListenersUpdated)l(o)}recalculateHovering(o){this.cursor=null,this.hover=null;for(let l of this.map.queryRenderedFeatures(o.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(l.geometry.type=="Polygon"){this.hover="polygon";break}else if(l.geometry.type=="Point"&&Object.hasOwn(l.properties,"idx")){this.hover=l.properties.idx;break}this.hover==null&&(this.cursor=$h(o.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let o=this.points.map(Rm),l=[JSON.parse(JSON.stringify(o))];return l[0].push(JSON.parse(JSON.stringify(l[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:l},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>hv&&this.previousStates.shift()}}function Ef(h){let o=[];for(let l=0;l<h.length-1;l++)o.push({type:"Feature",geometry:{type:"LineString",coordinates:[h[l],h[l+1]]},properties:{}});return h.length>=3&&o.push({type:"Feature",geometry:{type:"LineString",coordinates:[h[h.length-1],h[0]]},properties:{}}),o}function pv(h){let o,l,c;return{c(){o=Xt("Undo ("),l=Xt(h[1]),c=Xt(")")},m(m,v){Re(m,o,v),Re(m,l,v),Re(m,c,v)},p(m,v){v&2&&tn(l,m[1])},d(m){m&&(Fe(o),Fe(l),Fe(c))}}}function fv(h){let o;return{c(){o=Xt("Undo")},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function mv(h){let o,l,c,m,v,T;function s(D,q){return D[1]==0?fv:pv}let C=s(h),I=C(h);return{c(){o=we("button"),I.c(),c=st(),m=we("ul"),m.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,o.disabled=l=h[1]==0},m(D,q){Re(D,o,q),I.m(o,null),Re(D,c,q),Re(D,m,q),v||(T=Dt(o,"click",h[2]),v=!0)},p(D,[q]){C===(C=s(D))&&I?I.p(D,q):(I.d(1),I=C(D),I&&(I.c(),I.m(o,null))),q&2&&l!==(l=D[1]==0)&&(o.disabled=l)},i:Vt,o:Vt,d(D){D&&(Fe(o),Fe(c),Fe(m)),I.d(),v=!1,T()}}}function _v(h,o,l){let c;Et(h,Dm,T=>l(1,c=T));let{polygonTool:m}=o;const v=()=>m.undo();return h.$$set=T=>{"polygonTool"in T&&l(0,m=T.polygonTool)},[m,c,v]}class gv extends di{constructor(o){super(),hi(this,o,_v,mv,oi,{polygonTool:0})}}function yv(h){let o,l,c,m,v,T,s;return{c(){o=we("div"),l=we("button"),l.textContent="Import current view",c=st(),m=we("div"),v=we("button"),v.textContent="Draw an area to import on the map",qt(l,"type","button"),qt(v,"type","button")},m(C,I){Re(C,o,I),_e(o,l),Re(C,c,I),Re(C,m,I),_e(m,v),T||(s=[Dt(l,"click",h[1]),Dt(v,"click",h[2])],T=!0)},p:Vt,i:Vt,o:Vt,d(C){C&&(Fe(o),Fe(c),Fe(m)),T=!1,gn(s)}}}function vv(h){let o,l;return o=new gv({props:{polygonTool:h[0]}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&1&&(v.polygonTool=c[0]),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function bv(h){let o,l,c,m;const v=[vv,yv],T=[];function s(C,I){return C[0]?0:1}return o=s(h),l=T[o]=v[o](h),{c(){l.c(),c=Bn()},m(C,I){T[o].m(C,I),Re(C,c,I),m=!0},p(C,[I]){let D=o;o=s(C),o===D?T[o].p(C,I):(mr(),Ae(T[D],1,1,()=>{T[D]=null}),_r(),l=T[o],l?l.p(C,I):(l=T[o]=v[o](C),l.c()),Me(l,1),l.m(c.parentNode,c))},i(C){m||(Me(l),m=!0)},o(C){Ae(l),m=!1},d(C){C&&Fe(c),T[o].d(C)}}}function xv(h){let o='poly:"';for(let[c,m]of h.geometry.coordinates[0])o+=`${m} ${c} `;return o=o.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${o}); node(w)->.x; <;); out meta;`}`}function Gl(h){return[h.lng,h.lat]}function wv(h,o,l){let{map:c}=o;const m=cc();let v=null;async function T(D){try{m("loading","Loading from Overpass");let ie=await(await fetch(xv(D))).text();m("gotXml",ie)}catch(q){m("error",q.toString())}}function s(){let D=c.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Gl(D.getSouthWest()),Gl(D.getNorthWest()),Gl(D.getNorthEast()),Gl(D.getSouthEast()),Gl(D.getSouthWest())]],type:"Polygon"}}}async function C(){if(c){if(c.getZoom()<13){m("error","Zoom in more to import");return}await T(s())}}function I(){c&&(l(0,v=new dv(c)),v.startNew(),v.addEventListenerSuccess(async D=>{l(0,v=null),await T(D)}),v.addEventListenerFailure(()=>{l(0,v=null)}))}return h.$$set=D=>{"map"in D&&l(3,c=D.map)},[v,C,I,c]}class Sv extends di{constructor(o){super(),hi(this,o,wv,bv,oi,{map:3})}}function Pf(h,o,l){const c=h.slice();return c[1]=o[l][0],c[2]=o[l][1],c}function zf(h){let o,l,c=h[1]+"",m,v,T=h[2]+"",s;return{c(){o=we("tr"),l=we("td"),m=Xt(c),v=we("td"),s=Xt(T)},m(C,I){Re(C,o,I),_e(o,l),_e(l,m),_e(o,v),_e(v,s)},p(C,I){I&1&&c!==(c=C[1]+"")&&tn(m,c),I&1&&T!==(T=C[2]+"")&&tn(s,T)},d(C){C&&Fe(o)}}}function Tv(h){let o,l,c=La(Object.entries(h[0])),m=[];for(let v=0;v<c.length;v+=1)m[v]=zf(Pf(h,c,v));return{c(){o=we("table"),l=we("tbody");for(let v=0;v<m.length;v+=1)m[v].c();qt(o,"class","svelte-lh2o9l")},m(v,T){Re(v,o,T),_e(o,l);for(let s=0;s<m.length;s+=1)m[s]&&m[s].m(l,null)},p(v,[T]){if(T&1){c=La(Object.entries(v[0]));let s;for(s=0;s<c.length;s+=1){const C=Pf(v,c,s);m[s]?m[s].p(C,T):(m[s]=zf(C),m[s].c(),m[s].m(l,null))}for(;s<m.length;s+=1)m[s].d(1);m.length=c.length}},i:Vt,o:Vt,d(v){v&&Fe(o),hd(m,v)}}}function kv(h,o,l){let{properties:c}=o;return h.$$set=m=>{"properties"in m&&l(0,c=m.properties)},[c]}class Ru extends di{constructor(o){super(),hi(this,o,kv,Tv,oi,{properties:0})}}const Ou=["==",["geometry-type"],"Polygon"],Bm=["==",["geometry-type"],"LineString"],Fm=["==",["geometry-type"],"Point"];function ad(h,o,l){let c=["match",h];for(let[m,v]of Object.entries(o))c.push(m),c.push(v);return c.push(l),c}function Iv(h,o){let l=document.createElement("a");l.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(o)),l.setAttribute("download",h),document.body.appendChild(l),l.click(),document.body.removeChild(l)}function si(h){if(h==null||h==null)throw new Error("Oops, notNull given something null");return h}function $h(h){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Rm(h)}}}function Rm(h){return[Math.round(h[0]*1e7)/1e7,Math.round(h[1]*1e7)/1e7]}const Om=or({type:"FeatureCollection",features:[]}),Mv=or(!0),Nm=or(0),Cv=30;class Av{constructor(o,l){_i(this,"map");_i(this,"inner");_i(this,"active");_i(this,"eventListenersSuccess");_i(this,"eventListenersUpdated");_i(this,"eventListenersFailure");_i(this,"onMouseMove",o=>{if(!this.active)return;const l=[o.point.x-Cv,o.point.y],c=this.map.unproject(o.point).distanceTo(this.map.unproject(l));this.inner.onMouseMove(o.lngLat.lng,o.lngLat.lat,c)&&(this.redraw(),this.dataUpdated())});_i(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});_i(this,"onDoubleClick",o=>{this.active&&(o.preventDefault(),this.inner.onClick(),this.finish())});_i(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});_i(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});_i(this,"onKeyDown",o=>{this.active&&o.key=="Escape"&&(o.stopPropagation(),this.cancel())});_i(this,"onKeyPress",o=>{this.active&&o.target.tagName!="INPUT"&&(o.key=="Enter"?(o.stopPropagation(),this.finish()):o.key=="s"?(o.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):o.key=="z"&&o.ctrlKey&&this.undo())});this.map=o,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Au(l),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(o){o.properties??(o.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),o.properties.waypoints||(o.properties.waypoints=[{lon:o.geometry.coordinates[0][0],lat:o.geometry.coordinates[0][1],snapped:!0},{lon:o.geometry.coordinates[o.geometry.coordinates.length-1][0],lat:o.geometry.coordinates[o.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(o.properties.waypoints),this.redraw()}editExistingArea(o){o.properties??(o.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),o.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(o.properties.waypoints),this.redraw()}addEventListenerSuccess(o){this.eventListenersSuccess.push(o)}addEventListenerUpdated(o){this.eventListenersUpdated.push(o)}addEventListenerFailure(o){this.eventListenersFailure.push(o)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let o=this.inner.toFinalFeature();if(o)for(let l of this.eventListenersSuccess)l(JSON.parse(o));else for(let l of this.eventListenersFailure)l();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(o){this.inner.setRouteConfig(o),this.redraw()}addSnappedWaypoint(o){this.inner.addSnappedWaypoint(o[0],o[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let o=JSON.parse(this.inner.renderGeojson());Om.set(o),this.map.getCanvas().style.cursor=o.cursor,Mv.set(o.snap_mode),Nm.set(o.undo_length)}dataUpdated(){let o=this.inner.toFinalFeature();if(o)for(let l of this.eventListenersUpdated)l(JSON.parse(o))}}let Dn=or(null),Ki=or({mode:"title"}),ld=or(!0),Os=or(null),Ql=or(""),cd=or(null),ud=or(null);const Ev=h=>({}),Lf=h=>({}),Pv=h=>({}),Df=h=>({}),zv=h=>({}),Bf=h=>({});function Ff(h){let o;const l=h[7]["line-popup"],c=Jr(l,h,h[10],Bf);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v&1024)&&Qr(c,l,m,m[10],o?$r(l,m[10],v,zv):en(m[10]),Bf)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function Lv(h){let o,l,c=h[0]&&Ff(h);return{c(){c&&c.c(),o=Bn()},m(m,v){c&&c.m(m,v),Re(m,o,v),l=!0},p(m,v){m[0]?c?(c.p(m,v),v&1&&Me(c,1)):(c=Ff(m),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(m)}}}function Rf(h){let o;const l=h[7]["circle-popup"],c=Jr(l,h,h[10],Df);return{c(){c&&c.c()},m(m,v){c&&c.m(m,v),o=!0},p(m,v){c&&c.p&&(!o||v&1024)&&Qr(c,l,m,m[10],o?$r(l,m[10],v,Pv):en(m[10]),Df)},i(m){o||(Me(c,m),o=!0)},o(m){Ae(c,m),o=!1},d(m){c&&c.d(m)}}}function Dv(h){let o,l,c=h[0]&&Rf(h);return{c(){c&&c.c(),o=Bn()},m(m,v){c&&c.m(m,v),Re(m,o,v),l=!0},p(m,v){m[0]?c?(c.p(m,v),v&1&&Me(c,1)):(c=Rf(m),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(m)}}}function Bv(h){let o,l,c,m,v,T,s;o=new hc({props:{beforeId:h[5]?"Building":void 0,filter:Ou,paint:{"fill-color":["get","color"],"fill-opacity":.3}}}),c=new ds({props:{filter:["==",["get","kind"],"interior_road"],paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",h[4],"#A32015"]},hoverCursor:h[0]?"pointer":void 0,$$slots:{default:[Lv]},$$scope:{ctx:h}}}),c.$on("click",h[8]),v=new Du({props:{filter:["==",["get","kind"],"modal_filter"],paint:{"circle-radius":15,"circle-color":"black"},$$slots:{default:[Dv]},$$scope:{ctx:h}}}),v.$on("click",h[9]);const C=h[7]["more-layers"],I=Jr(C,h,h[10],Lf);return{c(){ct(o.$$.fragment),l=st(),ct(c.$$.fragment),m=st(),ct(v.$$.fragment),T=st(),I&&I.c()},m(D,q){at(o,D,q),Re(D,l,q),at(c,D,q),Re(D,m,q),at(v,D,q),Re(D,T,q),I&&I.m(D,q),s=!0},p(D,q){const ie={};q&32&&(ie.beforeId=D[5]?"Building":void 0),o.$set(ie);const de={};q&16&&(de.paint={"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D[4],"#A32015"]}),q&1&&(de.hoverCursor=D[0]?"pointer":void 0),q&1025&&(de.$$scope={dirty:q,ctx:D}),c.$set(de);const oe={};q&1025&&(oe.$$scope={dirty:q,ctx:D}),v.$set(oe),I&&I.p&&(!s||q&1024)&&Qr(I,C,D,D[10],s?$r(C,D[10],q,Ev):en(D[10]),Lf)},i(D){s||(Me(o.$$.fragment,D),Me(c.$$.fragment,D),Me(v.$$.fragment,D),Me(I,D),s=!0)},o(D){Ae(o.$$.fragment,D),Ae(c.$$.fragment,D),Ae(v.$$.fragment,D),Ae(I,D),s=!1},d(D){D&&(Fe(l),Fe(m),Fe(T)),lt(o,D),lt(c,D),lt(v,D),I&&I.d(D)}}}function Fv(h){let o,l;return o=new qo({props:{data:h[3],generateId:!0,$$slots:{default:[Bv]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&8&&(v.data=c[3]),m&1079&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Rv(h,o,l){let c;Et(h,ld,Te=>l(5,c=Te));let{$$slots:m={},$$scope:v}=o,{gjInput:T}=o,{interactive:s=!0}=o,{onClickLine:C=Te=>{}}=o,{onClickCircle:I=Te=>{}}=o,D,q;function ie(Te){let me=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];l(4,q=Math.max(...T.features.map(ye=>ye.properties.shortcuts??0)));for(let ye of T.features)ye.properties??(ye.properties={}),ye.properties.cell_color=="disconnected"?ye.properties.color="red":Object.hasOwn(ye.properties,"cell_color")&&(ye.properties.color=me[ye.properties.cell_color%me.length]);l(3,D=T)}const de=Te=>s&&C(Te.detail.features[0]),oe=Te=>s&&I(Te.detail.features[0]);return h.$$set=Te=>{"gjInput"in Te&&l(6,T=Te.gjInput),"interactive"in Te&&l(0,s=Te.interactive),"onClickLine"in Te&&l(1,C=Te.onClickLine),"onClickCircle"in Te&&l(2,I=Te.onClickCircle),"$$scope"in Te&&l(10,v=Te.$$scope)},h.$$.update=()=>{h.$$.dirty&64&&ie()},[s,C,I,D,q,c,T,m,de,oe,v]}class Nu extends di{constructor(o){super(),hi(this,o,Rv,Fv,oi,{gjInput:6,interactive:0,onClickLine:1,onClickCircle:2})}}const Ov=h=>({}),Of=h=>({}),Nv=h=>({}),Nf=h=>({});function Vv(h){let o,l,c,m;const v=h[3].sidebar,T=Jr(v,h,h[2],Nf),s=h[3].map,C=Jr(s,h,h[2],Of);return{c(){o=we("div"),T&&T.c(),l=st(),c=we("div"),C&&C.c()},m(I,D){Re(I,o,D),T&&T.m(o,null),h[4](o),Re(I,l,D),Re(I,c,D),C&&C.m(c,null),h[5](c),m=!0},p(I,[D]){T&&T.p&&(!m||D&4)&&Qr(T,v,I,I[2],m?$r(v,I[2],D,Nv):en(I[2]),Nf),C&&C.p&&(!m||D&4)&&Qr(C,s,I,I[2],m?$r(s,I[2],D,Ov):en(I[2]),Of)},i(I){m||(Me(T,I),Me(C,I),m=!0)},o(I){Ae(T,I),Ae(C,I),m=!1},d(I){I&&(Fe(o),Fe(l),Fe(c)),T&&T.d(I),h[4](null),C&&C.d(I),h[5](null)}}}function Uv(h,o,l){let c,m;Et(h,cd,I=>l(0,c=I)),Et(h,ud,I=>l(1,m=I));let{$$slots:v={},$$scope:T}=o;function s(I){Ur[I?"unshift":"push"](()=>{c=I,cd.set(c)})}function C(I){Ur[I?"unshift":"push"](()=>{m=I,ud.set(m)})}return h.$$set=I=>{"$$scope"in I&&l(2,T=I.$$scope)},[c,m,T,v,s,C]}class Vs extends di{constructor(o){super(),hi(this,o,Uv,Vv,oi,{})}}function jv(h){let o,l,c,m,v,T,s;return{c(){o=we("div"),l=we("h1"),l.textContent="Debug mode",c=st(),m=we("div"),v=we("button"),v.textContent="Back to editing",qt(o,"slot","sidebar")},m(C,I){Re(C,o,I),_e(o,l),_e(o,c),_e(o,m),_e(m,v),T||(s=Dt(v,"click",h[3]),T=!0)},p:Vt,d(C){C&&Fe(o),T=!1,s()}}}function qv(h){let o,l;return o=new Ru({props:{properties:si(h[4]).properties}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&16&&(v.properties=si(c[4]).properties),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Zv(h){let o,l,c;return l=new Ns({props:{openOn:"hover",$$slots:{default:[qv,({data:m})=>({4:m}),({data:m})=>m?16:0]},$$scope:{ctx:h}}}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","line-popup")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p(m,v){const T={};v&48&&(T.$$scope={dirty:v,ctx:m}),l.$set(T)},i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function Gv(h){let o,l;return o=new Ru({props:{properties:si(h[4]).properties}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&16&&(v.properties=si(c[4]).properties),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Xv(h){let o,l,c;return l=new Ns({props:{openOn:"hover",$$slots:{default:[Gv,({data:m})=>({4:m}),({data:m})=>m?16:0]},$$scope:{ctx:h}}}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","circle-popup")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p(m,v){const T={};v&48&&(T.$$scope={dirty:v,ctx:m}),l.$set(T)},i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function Wv(h){let o,l;return o=new Ru({props:{properties:si(h[4]).properties}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&16&&(v.properties=si(c[4]).properties),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Hv(h){let o,l;return o=new Ns({props:{openOn:"hover",$$slots:{default:[Wv,({data:c})=>({4:c}),({data:c})=>c?16:0]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&48&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Kv(h){let o,l;return o=new Ru({props:{properties:si(h[4]).properties}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&16&&(v.properties=si(c[4]).properties),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Yv(h){let o,l;return o=new Ns({props:{openOn:"hover",$$slots:{default:[Kv,({data:c})=>({4:c}),({data:c})=>c?16:0]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&48&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Jv(h){let o,l,c,m;return o=new Du({props:{filter:["==",["get","kind"],"border_intersection"],paint:{"circle-radius":15,"circle-color":"green"},$$slots:{default:[Hv]},$$scope:{ctx:h}}}),c=new ds({props:{filter:["==",["get","kind"],"crosses"],paint:{"line-width":5,"line-color":"blue"},$$slots:{default:[Yv]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment),l=st(),ct(c.$$.fragment)},m(v,T){at(o,v,T),Re(v,l,T),at(c,v,T),m=!0},p(v,T){const s={};T&32&&(s.$$scope={dirty:T,ctx:v}),o.$set(s);const C={};T&32&&(C.$$scope={dirty:T,ctx:v}),c.$set(C)},i(v){m||(Me(o.$$.fragment,v),Me(c.$$.fragment,v),m=!0)},o(v){Ae(o.$$.fragment,v),Ae(c.$$.fragment,v),m=!1},d(v){v&&Fe(l),lt(o,v),lt(c,v)}}}function $v(h){let o,l,c;return l=new Nu({props:{gjInput:JSON.parse(si(h[0]).renderNeighbourhood()),interactive:!0,onClickLine:h[2],$$slots:{"more-layers":[Jv],"circle-popup":[Xv],"line-popup":[Zv]},$$scope:{ctx:h}}}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","map")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p(m,v){const T={};v&1&&(T.gjInput=JSON.parse(si(m[0]).renderNeighbourhood())),v&32&&(T.$$scope={dirty:v,ctx:m}),l.$set(T)},i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function Qv(h){let o,l;return o=new Vs({props:{$$slots:{map:[$v],sidebar:[jv]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&35&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function eb(h,o,l){let c,m;return Et(h,Dn,s=>l(0,c=s)),Et(h,Ki,s=>l(1,m=s)),[c,m,s=>window.open(si(s.properties).way,"_blank"),()=>Si(Ki,m={mode:"neighbourhood"},m)]}class tb extends di{constructor(o){super(),hi(this,o,eb,Qv,oi,{})}}function ib(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de,oe,Te,me,ye,W,re;return me=new vm({props:{msg:h[0]}}),{c(){o=we("details"),l=we("summary"),l.textContent="Save / load project",c=st(),m=we("div"),v=we("button"),v.textContent="Save to GJ",T=st(),s=we("div"),C=we("label"),I=Xt(`Load edits from GJ
      `),D=we("input"),q=st(),ie=we("div"),de=we("button"),de.textContent="Save to local storage",oe=we("button"),oe.textContent="Load from local storage",Te=st(),ct(me.$$.fragment),qt(D,"type","file")},m(le,xe){Re(le,o,xe),_e(o,l),_e(o,c),_e(o,m),_e(m,v),_e(o,T),_e(o,s),_e(s,C),_e(C,I),_e(C,D),h[7](D),_e(o,q),_e(o,ie),_e(ie,de),_e(ie,oe),Re(le,Te,xe),at(me,le,xe),ye=!0,W||(re=[Dt(v,"click",h[2]),Dt(D,"change",h[3]),Dt(de,"click",h[5]),Dt(oe,"click",h[4])],W=!0)},p(le,[xe]){const Ee={};xe&1&&(Ee.msg=le[0]),me.$set(Ee)},i(le){ye||(Me(me.$$.fragment,le),ye=!0)},o(le){Ae(me.$$.fragment,le),ye=!1},d(le){le&&(Fe(o),Fe(Te)),h[7](null),lt(me,le),W=!1,gn(re)}}}function rb(h,o,l){let c,m,v,T;Et(h,Dn,Te=>l(9,m=Te)),Et(h,Ki,Te=>l(10,v=Te)),Et(h,Ql,Te=>l(6,T=Te));let s=null;function C(){Iv(c,m.toSavefile())}let I;async function D(Te){l(0,s="Loading project from file");try{de(await I.files[0].text())}catch(me){window.alert(`Couldn't open this file: ${me}`)}l(0,s=null)}function q(){l(0,s="Loading projects from local storage");try{let Te=window.localStorage.getItem(c);Te?de(Te):window.alert("Nothing was saved in local storage")}catch(Te){window.alert(`Couldn't load from local storage: ${Te}`)}l(0,s=null)}function ie(){window.localStorage.setItem(c,m.toSavefile())}function de(Te){m.loadSavefile(JSON.parse(Te)),Si(Ki,v={mode:"network"},v),Dn.set(m)}function oe(Te){Ur[Te?"unshift":"push"](()=>{I=Te,l(1,I)})}return h.$$.update=()=>{h.$$.dirty&64&&(c=`ltn_${T||"custom"}.geojson`)},[s,I,C,D,q,ie,T,oe]}class Vm extends di{constructor(o){super(),hi(this,o,rb,ib,oi,{})}}function Vf(h,o,l){const c=h.slice();return c[7]=o[l][0],c[8]=o[l][1],c[9]=o[l][2],c}function Uf(h){let o,l,c,m,v=h[8]+"",T,s,C,I,D;function q(){return h[3](h[7])}return{c(){o=we("div"),l=we("button"),c=we("img"),T=Xt(v),C=st(),Qh(c.src,m=`/filters/${h[7]}.svg`)||qt(c,"src",m),qt(c,"alt",h[8]),Ea(l,"width","100%"),l.disabled=s=h[0]==h[7]},m(ie,de){Re(ie,o,de),_e(o,l),_e(l,c),_e(l,T),_e(o,C),I||(D=Dt(l,"click",q),I=!0)},p(ie,de){h=ie,de&1&&s!==(s=h[0]==h[7])&&(l.disabled=s)},d(ie){ie&&Fe(o),I=!1,D()}}}function nb(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de=h[1][2]+"",oe,Te,me,ye,W,re,le=La(h[2]),xe=[];for(let Ie=0;Ie<le.length;Ie+=1)xe[Ie]=Uf(Vf(h,le,Ie));function Ee(){return h[4](h[6])}return{c(){o=we("h3"),o.textContent="Choose a modal filter to place on streets",l=st(),c=we("table"),m=we("tr"),v=we("td");for(let Ie=0;Ie<xe.length;Ie+=1)xe[Ie].c();T=st(),s=we("td"),C=we("img"),q=st(),ie=we("p"),oe=Xt(de),Te=st(),me=we("center"),ye=we("button"),ye.textContent="Confirm",Qh(C.src,I=`/filters/${h[0]}.gif`)||qt(C,"src",I),qt(C,"height","300"),qt(C,"alt",D=h[1][1])},m(Ie,Oe){Re(Ie,o,Oe),Re(Ie,l,Oe),Re(Ie,c,Oe),_e(c,m),_e(m,v);for(let qe=0;qe<xe.length;qe+=1)xe[qe]&&xe[qe].m(v,null);_e(m,T),_e(m,s),_e(s,C),_e(s,q),_e(s,ie),_e(ie,oe),Re(Ie,Te,Oe),Re(Ie,me,Oe),_e(me,ye),W||(re=Dt(ye,"click",Ee),W=!0)},p(Ie,Oe){if(h=Ie,Oe&5){le=La(h[2]);let qe;for(qe=0;qe<le.length;qe+=1){const He=Vf(h,le,qe);xe[qe]?xe[qe].p(He,Oe):(xe[qe]=Uf(He),xe[qe].c(),xe[qe].m(v,null))}for(;qe<xe.length;qe+=1)xe[qe].d(1);xe.length=le.length}Oe&1&&!Qh(C.src,I=`/filters/${h[0]}.gif`)&&qt(C,"src",I),Oe&2&&D!==(D=h[1][1])&&qt(C,"alt",D),Oe&2&&de!==(de=h[1][2]+"")&&tn(oe,de)},d(Ie){Ie&&(Fe(o),Fe(l),Fe(c),Fe(Te),Fe(me)),hd(xe,Ie),W=!1,re()}}}function ob(h){let o,l;return o=new bm({props:{$$slots:{default:[nb,({dialog:c})=>({6:c}),({dialog:c})=>c?64:0]},$$scope:{ctx:h}}}),o.$on("close",h[5]),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&4163&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function sb(h,o,l){let c,{filterType:m}=o,v=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const T=I=>l(0,m=I),s=I=>si(I).close();function C(I){yr.call(this,h,I)}return h.$$set=I=>{"filterType"in I&&l(0,m=I.filterType)},h.$$.update=()=>{h.$$.dirty&1&&l(1,c=v.find(I=>I[0]==m))},[m,c,v,T,s,C]}class ab extends di{constructor(o){super(),hi(this,o,sb,ob,oi,{filterType:0})}}function jf(h){let o,l;return o=new qo({props:{data:h[0],$$slots:{default:[lb]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&1&&(v.data=c[0]),m&64&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function lb(h){let o,l;return o=new ds({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function cb(h){let o,l,c=h[0]&&jf(h);return{c(){c&&c.c(),o=Bn()},m(m,v){c&&c.m(m,v),Re(m,o,v),l=!0},p(m,[v]){m[0]?c?(c.p(m,v),v&1&&Me(c,1)):(c=jf(m),c.c(),Me(c,1),c.m(o.parentNode,o)):c&&(mr(),Ae(c,1,1,()=>{c=null}),_r())},i(m){l||(Me(c),l=!0)},o(m){Ae(c),l=!1},d(m){m&&Fe(o),c&&c.d(m)}}}function ub(h,o,l){let{map:c}=o,m=null;const v=cc();c.on("dragstart",T),c.on("mousemove",s),c.on("mouseup",C),bo(()=>{c.dragPan.enable(),c.off("dragstart",T),c.off("mousemove",s),c.off("mouseup",C)});function T(){c.dragPan.disable(),l(0,m={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(I){m&&(m.geometry.coordinates.push(I.lngLat.toArray()),l(0,m))}function C(){m&&(v("done",m),l(0,m=null))}return h.$$set=I=>{"map"in I&&l(1,c=I.map)},[m,c]}class hb extends di{constructor(o){super(),hi(this,o,ub,cb,oi,{map:1})}}function db(h){let o,l,c;return{c(){o=Xt("Undo ("),l=Xt(h[5]),c=Xt(")")},m(m,v){Re(m,o,v),Re(m,l,v),Re(m,c,v)},p(m,v){v[0]&32&&tn(l,m[5])},d(m){m&&(Fe(o),Fe(l),Fe(c))}}}function pb(h){let o;return{c(){o=Xt("Undo")},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function fb(h){let o,l,c;return{c(){o=Xt("Redo ("),l=Xt(h[6]),c=Xt(")")},m(m,v){Re(m,o,v),Re(m,l,v),Re(m,c,v)},p(m,v){v[0]&64&&tn(l,m[6])},d(m){m&&(Fe(o),Fe(l),Fe(c))}}}function mb(h){let o;return{c(){o=Xt("Redo")},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function qf(h){let o,l,c;function m(T){h[21](T)}let v={};return h[2]!==void 0&&(v.filterType=h[2]),o=new ab({props:v}),Ur.push(()=>Fs(o,"filterType",m)),o.$on("close",h[22]),{c(){ct(o.$$.fragment)},m(T,s){at(o,T,s),c=!0},p(T,s){const C={};!l&&s[0]&4&&(l=!0,C.filterType=T[2],Bs(()=>l=!1)),o.$set(C)},i(T){c||(Me(o.$$.fragment,T),c=!0)},o(T){Ae(o.$$.fragment,T),c=!1},d(T){lt(o,T)}}}function _b(h){let o,l,c,m=si(si(h[7]).properties).name+"",v,T,s,C,I,D,q,ie,de,oe,Te,me,ye,W,re,le,xe,Ee,Ie,Oe,qe,He,be,Ue,xt,Ne,vt,gt,dt,Ft,sr,Ri,Jt,Ut,Rt,fi,Yi,Ge,Ct,Je,mi,Ht,wi,Zi,Xe,Ti,Gi,rn,Mn,zr,gr,Ce,vr;function Lr(ii,Ni){return ii[5]==0?pb:db}let ai=Lr(h),Ot=ai(h);function nn(ii,Ni){return ii[6]==0?mb:fb}let Cn=nn(h),tr=Cn(h),Oi=h[4]&&qf(h);return zr=new Vm({}),{c(){o=we("div"),l=we("h1"),c=Xt("Editing modal filters in "),v=Xt(m),T=st(),s=we("p"),s.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,C=st(),I=we("div"),D=we("button"),D.textContent="Start over and change your study area",q=st(),ie=we("div"),de=we("button"),de.textContent="Pick a different neighbourhood boundary",oe=st(),Te=we("div"),me=we("button"),me.textContent="Change this neighbourhood boundary",ye=st(),W=we("hr"),re=st(),le=we("div"),xe=we("button"),Ee=Xt("Add a modal filter"),Oe=st(),qe=we("button"),He=Xt("Add many modal filters along line"),Ue=st(),xt=we("button"),Ne=Xt("Change modal filter type"),gt=st(),dt=we("div"),Ft=we("button"),Ot.c(),Ri=st(),Jt=we("button"),tr.c(),Rt=st(),Oi&&Oi.c(),fi=st(),Yi=we("hr"),Ge=st(),Ct=we("div"),Je=we("button"),Je.textContent="View shortcuts",mi=st(),Ht=we("div"),wi=we("button"),wi.textContent="Route",Zi=st(),Xe=we("div"),Ti=we("button"),Ti.textContent="Debug",Gi=st(),rn=we("hr"),Mn=st(),ct(zr.$$.fragment),xe.disabled=Ie=h[0]||h[3],qe.disabled=be=h[0]||h[3],xt.disabled=vt=h[0]||h[3],Ft.disabled=sr=h[5]==0,Jt.disabled=Ut=h[6]==0,qt(o,"slot","sidebar")},m(ii,Ni){Re(ii,o,Ni),_e(o,l),_e(l,c),_e(l,v),_e(o,T),_e(o,s),_e(o,C),_e(o,I),_e(I,D),_e(o,q),_e(o,ie),_e(ie,de),_e(o,oe),_e(o,Te),_e(Te,me),_e(o,ye),_e(o,W),_e(o,re),_e(o,le),_e(le,xe),_e(xe,Ee),_e(le,Oe),_e(le,qe),_e(qe,He),_e(le,Ue),_e(le,xt),_e(xt,Ne),_e(o,gt),_e(o,dt),_e(dt,Ft),Ot.m(Ft,null),_e(dt,Ri),_e(dt,Jt),tr.m(Jt,null),_e(o,Rt),Oi&&Oi.m(o,null),_e(o,fi),_e(o,Yi),_e(o,Ge),_e(o,Ct),_e(Ct,Je),_e(o,mi),_e(o,Ht),_e(Ht,wi),_e(o,Zi),_e(o,Xe),_e(Xe,Ti),_e(o,Gi),_e(o,rn),_e(o,Mn),at(zr,o,null),gr=!0,Ce||(vr=[Dt(D,"click",h[16]),Dt(de,"click",h[14]),Dt(me,"click",h[17]),Dt(xe,"click",h[18]),Dt(qe,"click",h[19]),Dt(xt,"click",h[20]),Dt(Ft,"click",h[12]),Dt(Jt,"click",h[13]),Dt(Je,"click",h[23]),Dt(wi,"click",h[24]),Dt(Ti,"click",h[25])],Ce=!0)},p(ii,Ni){(!gr||Ni[0]&128)&&m!==(m=si(si(ii[7]).properties).name+"")&&tn(v,m),(!gr||Ni[0]&9&&Ie!==(Ie=ii[0]||ii[3]))&&(xe.disabled=Ie),(!gr||Ni[0]&9&&be!==(be=ii[0]||ii[3]))&&(qe.disabled=be),(!gr||Ni[0]&9&&vt!==(vt=ii[0]||ii[3]))&&(xt.disabled=vt),ai===(ai=Lr(ii))&&Ot?Ot.p(ii,Ni):(Ot.d(1),Ot=ai(ii),Ot&&(Ot.c(),Ot.m(Ft,null))),(!gr||Ni[0]&32&&sr!==(sr=ii[5]==0))&&(Ft.disabled=sr),Cn===(Cn=nn(ii))&&tr?tr.p(ii,Ni):(tr.d(1),tr=Cn(ii),tr&&(tr.c(),tr.m(Jt,null))),(!gr||Ni[0]&64&&Ut!==(Ut=ii[6]==0))&&(Jt.disabled=Ut),ii[4]?Oi?(Oi.p(ii,Ni),Ni[0]&16&&Me(Oi,1)):(Oi=qf(ii),Oi.c(),Me(Oi,1),Oi.m(o,fi)):Oi&&(mr(),Ae(Oi,1,1,()=>{Oi=null}),_r())},i(ii){gr||(Me(Oi),Me(zr.$$.fragment,ii),gr=!0)},o(ii){Ae(Oi),Ae(zr.$$.fragment,ii),gr=!1},d(ii){ii&&Fe(o),Ot.d(),tr.d(),Oi&&Oi.d(),lt(zr),Ce=!1,gn(vr)}}}function gb(h){let o,l=si(h[30]).properties.shortcuts+"",c,m;return{c(){o=we("p"),c=Xt(l),m=Xt(" shortcuts")},m(v,T){Re(v,o,T),_e(o,c),_e(o,m)},p(v,T){T[0]&1073741824&&l!==(l=si(v[30]).properties.shortcuts+"")&&tn(c,l)},d(v){v&&Fe(o)}}}function yb(h){let o,l,c;return l=new Ns({props:{openOn:"hover",$$slots:{default:[gb,({data:m})=>({30:m}),({data:m})=>[m?1073741824:0]]},$$scope:{ctx:h}}}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","line-popup")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p(m,v){const T={};v[0]&1073741824|v[1]&1&&(T.$$scope={dirty:v,ctx:m}),l.$set(T)},i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function Zf(h){let o,l;return o=new hb({props:{map:si(h[1])}}),o.$on("done",h[15]),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m[0]&2&&(v.map=si(c[1])),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function vb(h){let o,l,c,m;l=new Nu({props:{gjInput:h[8],interactive:!h[0]&&!h[3],onClickCircle:h[10],$$slots:{"line-popup":[yb]},$$scope:{ctx:h}}});let v=h[3]&&Zf(h);return{c(){o=we("div"),ct(l.$$.fragment),c=st(),v&&v.c(),qt(o,"slot","map")},m(T,s){Re(T,o,s),at(l,o,null),_e(o,c),v&&v.m(o,null),m=!0},p(T,s){const C={};s[0]&256&&(C.gjInput=T[8]),s[0]&9&&(C.interactive=!T[0]&&!T[3]),s[1]&1&&(C.$$scope={dirty:s,ctx:T}),l.$set(C),T[3]?v?(v.p(T,s),s[0]&8&&Me(v,1)):(v=Zf(T),v.c(),Me(v,1),v.m(o,null)):v&&(mr(),Ae(v,1,1,()=>{v=null}),_r())},i(T){m||(Me(l.$$.fragment,T),Me(v),m=!0)},o(T){Ae(l.$$.fragment,T),Ae(v),m=!1},d(T){T&&Fe(o),lt(l),v&&v.d()}}}function bb(h){let o,l,c,m;return o=new Vs({props:{$$slots:{map:[vb],sidebar:[_b]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(v,T){at(o,v,T),l=!0,c||(m=Dt(window,"keydown",h[11]),c=!0)},p(v,T){const s={};T[0]&1023|T[1]&1&&(s.$$scope={dirty:T,ctx:v}),o.$set(s)},i(v){l||(Me(o.$$.fragment,v),l=!0)},o(v){Ae(o.$$.fragment,v),l=!1},d(v){lt(o,v),c=!1,m()}}}function xb(h,o,l){let c,m,v;Et(h,Dn,dt=>l(26,c=dt)),Et(h,Ki,dt=>l(9,m=dt)),Et(h,Os,dt=>l(1,v=dt));let T="walk_cycle_only",s=!1,C=!1,I=!1,D=0,q=0,ie,de;oe(c.renderNeighbourhood());function oe(dt){l(8,de=JSON.parse(dt)),l(7,ie=de.features.find(Ft=>Ft.properties.kind=="boundary")),l(5,D=de.undo_length),l(6,q=de.redo_length)}bo(()=>{me()});function Te(dt){oe(c.addModalFilter(dt.lngLat,T)),me()}function me(){l(0,s=!1),v.off("click",Te),v.getCanvas().style.cursor="inherit"}function ye(dt){dt.properties.kind=="modal_filter"&&oe(c.deleteModalFilter(dt.properties.road))}function W(dt){dt.key=="a"&&!s&&!C&&l(0,s=!0),dt.key=="z"&&dt.ctrlKey&&re(),dt.key=="y"&&dt.ctrlKey&&le()}function re(){oe(c.undo())}function le(){oe(c.redo())}function xe(){Si(Ki,m={mode:"network"},m)}function Ee(dt){let Ft=dt.detail;Ft&&oe(c.addManyModalFilters(Ft,T)),l(3,C=!1)}function Ie(){Si(Ki,m={mode:"title"},m),Si(Dn,c=null,c)}const Oe=()=>Si(Ki,m={mode:"set-boundary",name:si(si(ie).properties).name,existing:ie},m),qe=()=>l(0,s=!0),He=()=>l(3,C=!0),be=()=>l(4,I=!0);function Ue(dt){T=dt,l(2,T)}const xt=()=>l(4,I=!1),Ne=()=>Si(Ki,m={mode:"view-shortcuts"},m),vt=()=>Si(Ki,m={mode:"route"},m),gt=()=>Si(Ki,m={mode:"debug"},m);return h.$$.update=()=>{h.$$.dirty[0]&3&&s&&(v.on("click",Te),v.getCanvas().style.cursor="crosshair")},[s,v,T,C,I,D,q,ie,de,m,ye,W,re,le,xe,Ee,Ie,Oe,qe,He,be,Ue,xt,Ne,vt,gt]}class wb extends di{constructor(o){super(),hi(this,o,xb,bb,oi,{},null,[-1,-1])}}function Gf(h,o,l){const c=h.slice();return c[12]=o[l],c}function Xf(h){let o,l,c=h[12]+"",m,v,T,s,C;function I(){return h[8](h[12])}function D(){return h[9](h[12])}return{c(){o=we("div"),l=we("button"),m=Xt(c),v=st(),T=we("button"),T.textContent="X"},m(q,ie){Re(q,o,ie),_e(o,l),_e(l,m),_e(o,v),_e(o,T),s||(C=[Dt(l,"click",I),Dt(T,"click",D)],s=!0)},p(q,ie){h=q,ie&2&&c!==(c=h[12]+"")&&tn(m,c)},d(q){q&&Fe(o),s=!1,gn(C)}}}function Sb(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de,oe,Te,me,ye,W,re=La(h[1]),le=[];for(let xe=0;xe<re.length;xe+=1)le[xe]=Xf(Gf(h,re,xe));return Te=new Vm({}),{c(){o=we("div"),l=we("h1"),l.textContent="Define neighbourhood boundaries",c=st(),m=we("p"),m.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,v=st(),T=we("div"),s=we("button"),s.textContent="Start over and change your study area",C=st(),I=we("div"),D=we("button"),D.textContent="Draw a new boundary",q=st();for(let xe=0;xe<le.length;xe+=1)le[xe].c();ie=st(),de=we("hr"),oe=st(),ct(Te.$$.fragment),qt(o,"slot","sidebar")},m(xe,Ee){Re(xe,o,Ee),_e(o,l),_e(o,c),_e(o,m),_e(o,v),_e(o,T),_e(T,s),_e(o,C),_e(o,I),_e(I,D),_e(o,q);for(let Ie=0;Ie<le.length;Ie+=1)le[Ie]&&le[Ie].m(o,null);_e(o,ie),_e(o,de),_e(o,oe),at(Te,o,null),me=!0,ye||(W=[Dt(s,"click",h[2]),Dt(D,"click",h[5])],ye=!0)},p(xe,Ee){if(Ee&26){re=La(xe[1]);let Ie;for(Ie=0;Ie<re.length;Ie+=1){const Oe=Gf(xe,re,Ie);le[Ie]?le[Ie].p(Oe,Ee):(le[Ie]=Xf(Oe),le[Ie].c(),le[Ie].m(o,ie))}for(;Ie<le.length;Ie+=1)le[Ie].d(1);le.length=re.length}},i(xe){me||(Me(Te.$$.fragment,xe),me=!0)},o(xe){Ae(Te.$$.fragment,xe),me=!1},d(xe){xe&&Fe(o),hd(le,xe),lt(Te),ye=!1,gn(W)}}}function Tb(h){let o,l=si(h[11]).properties.name+"",c;return{c(){o=we("p"),c=Xt(l)},m(m,v){Re(m,o,v),_e(o,c)},p(m,v){v&2048&&l!==(l=si(m[11]).properties.name+"")&&tn(c,l)},d(m){m&&Fe(o)}}}function kb(h){let o,l;return o=new Ns({props:{openOn:"hover",$$slots:{default:[Tb,({data:c})=>({11:c}),({data:c})=>c?2048:0]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&34816&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Ib(h){let o,l;return o=new hc({props:{filter:Ou,paint:{"fill-color":"red","fill-opacity":Sy(.3,.5)},manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[kb]},$$scope:{ctx:h}}}),o.$on("click",h[7]),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&32768&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Mb(h){let o,l,c;return l=new qo({props:{data:h[0],generateId:!0,$$slots:{default:[Ib]},$$scope:{ctx:h}}}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","map")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p(m,v){const T={};v&1&&(T.data=m[0]),v&32768&&(T.$$scope={dirty:v,ctx:m}),l.$set(T)},i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function Cb(h){let o,l;return o=new Vs({props:{$$slots:{map:[Mb],sidebar:[Sb]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&32771&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Ab(h,o,l){let c,m,v,T;Et(h,Ki,oe=>l(10,v=oe)),Et(h,Dn,oe=>l(6,T=oe));function s(){Si(Ki,v={mode:"title"},v),Si(Dn,T=null,T)}function C(oe){T.setCurrentNeighbourhood(oe),Si(Ki,v={mode:"neighbourhood"},v)}function I(oe){T.deleteNeighbourhoodBoundary(oe),l(0,c=JSON.parse(si(T).toSavefile()))}function D(){let oe=window.prompt("What do you want to name the neighbourhood?");oe&&Si(Ki,v={mode:"set-boundary",name:oe,existing:null},v)}const q=oe=>C(si(oe.detail.features[0].properties).name),ie=oe=>C(oe),de=oe=>I(oe);return h.$$.update=()=>{h.$$.dirty&64&&l(0,c=JSON.parse(si(T).toSavefile())),h.$$.dirty&1&&l(1,m=c.features.filter(oe=>si(oe.properties).kind=="boundary").map(oe=>si(oe.properties).name))},[c,m,s,C,I,D,T,q,ie,de]}class Eb extends di{constructor(o){super(),hi(this,o,Ab,Cb,oi,{})}}function Pb(h){let o,l,c,m,v,T,s,C,I;return{c(){o=we("div"),l=we("div"),c=we("button"),c.textContent="Back to editing",m=st(),v=we("p"),v.textContent="Drag markers for a route",T=st(),s=we("p"),s.innerHTML=`<span style="color: red">Route before</span>,
      <span style="color: blue">route after</span>`,qt(o,"slot","sidebar")},m(D,q){Re(D,o,q),_e(o,l),_e(l,c),_e(o,m),_e(o,v),_e(o,T),_e(o,s),C||(I=Dt(c,"click",h[5]),C=!0)},p:Vt,d(D){D&&Fe(o),C=!1,I()}}}function zb(h){let o,l;return o=new ds({props:{paint:{"line-width":10,"line-color":ad(["get","kind"],{before:"red",after:"blue"},"red")}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Lb(h){let o;return{c(){o=we("span"),o.textContent="A",qt(o,"class","dot svelte-1ukzawy")},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function Db(h){let o;return{c(){o=we("span"),o.textContent="B",qt(o,"class","dot svelte-1ukzawy")},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function Bb(h){let o,l,c,m,v,T,s,C,I,D,q;l=new Nu({props:{gjInput:JSON.parse(si(h[2]).renderNeighbourhood()),interactive:!1}}),m=new qo({props:{data:h[3],$$slots:{default:[zb]},$$scope:{ctx:h}}});function ie(me){h[6](me)}let de={draggable:!0,$$slots:{default:[Lb]},$$scope:{ctx:h}};h[0]!==void 0&&(de.lngLat=h[0]),T=new yf({props:de}),Ur.push(()=>Fs(T,"lngLat",ie));function oe(me){h[7](me)}let Te={draggable:!0,$$slots:{default:[Db]},$$scope:{ctx:h}};return h[1]!==void 0&&(Te.lngLat=h[1]),I=new yf({props:Te}),Ur.push(()=>Fs(I,"lngLat",oe)),{c(){o=we("div"),ct(l.$$.fragment),c=st(),ct(m.$$.fragment),v=st(),ct(T.$$.fragment),C=st(),ct(I.$$.fragment),qt(o,"slot","map")},m(me,ye){Re(me,o,ye),at(l,o,null),_e(o,c),at(m,o,null),_e(o,v),at(T,o,null),_e(o,C),at(I,o,null),q=!0},p(me,ye){const W={};ye&4&&(W.gjInput=JSON.parse(si(me[2]).renderNeighbourhood())),l.$set(W);const re={};ye&8&&(re.data=me[3]),ye&2048&&(re.$$scope={dirty:ye,ctx:me}),m.$set(re);const le={};ye&2048&&(le.$$scope={dirty:ye,ctx:me}),!s&&ye&1&&(s=!0,le.lngLat=me[0],Bs(()=>s=!1)),T.$set(le);const xe={};ye&2048&&(xe.$$scope={dirty:ye,ctx:me}),!D&&ye&2&&(D=!0,xe.lngLat=me[1],Bs(()=>D=!1)),I.$set(xe)},i(me){q||(Me(l.$$.fragment,me),Me(m.$$.fragment,me),Me(T.$$.fragment,me),Me(I.$$.fragment,me),q=!0)},o(me){Ae(l.$$.fragment,me),Ae(m.$$.fragment,me),Ae(T.$$.fragment,me),Ae(I.$$.fragment,me),q=!1},d(me){me&&Fe(o),lt(l),lt(m),lt(T),lt(I)}}}function Fb(h){let o,l,c,m;return o=new Vs({props:{$$slots:{map:[Bb],sidebar:[Pb]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(v,T){at(o,v,T),l=!0,c||(m=Dt(window,"keydown",h[4]),c=!0)},p(v,[T]){const s={};T&2063&&(s.$$scope={dirty:T,ctx:v}),o.$set(s)},i(v){l||(Me(o.$$.fragment,v),l=!0)},o(v){Ae(o.$$.fragment,v),l=!1},d(v){lt(o,v),c=!1,m()}}}function Rb(h,o,l){let c,m,v,T;Et(h,Ki,oe=>l(8,m=oe)),Et(h,Dn,oe=>l(2,v=oe)),Et(h,Os,oe=>l(9,T=oe));let s=I(),C=I();lc(()=>{T==null||T.keyboard.disable()}),bo(()=>{T==null||T.keyboard.enable()});function I(){let oe=v.getBounds(),Te=oe[0]+Math.random()*(oe[2]-oe[0]),me=oe[1]+Math.random()*(oe[3]-oe[1]);return new mm.LngLat(Te,me)}function D(oe){oe.key=="Escape"&&(oe.stopPropagation(),q())}function q(){Si(Ki,m={mode:"neighbourhood"},m)}function ie(oe){s=oe,l(0,s)}function de(oe){C=oe,l(1,C)}return h.$$.update=()=>{h.$$.dirty&7&&l(3,c=JSON.parse(v.compareRoute(s.lng,s.lat,C.lng,C.lat)))},[s,C,v,c,D,q,ie,de]}class Ob extends di{constructor(o){super(),hi(this,o,Rb,Fb,oi,{})}}function Nb(h){let o,l,c,m,v,T;return o=new Du({props:{filter:Fm,paint:{"circle-color":ad(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":ad(["get","type"],{node:Wf/2},Wf)}}}),c=new ds({props:{filter:Bm,paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}}),v=new hc({props:{filter:Ou,paint:{"fill-color":"black","fill-opacity":.5}}}),{c(){ct(o.$$.fragment),l=st(),ct(c.$$.fragment),m=st(),ct(v.$$.fragment)},m(s,C){at(o,s,C),Re(s,l,C),at(c,s,C),Re(s,m,C),at(v,s,C),T=!0},p:Vt,i(s){T||(Me(o.$$.fragment,s),Me(c.$$.fragment,s),Me(v.$$.fragment,s),T=!0)},o(s){Ae(o.$$.fragment,s),Ae(c.$$.fragment,s),Ae(v.$$.fragment,s),T=!1},d(s){s&&(Fe(l),Fe(m)),lt(o,s),lt(c,s),lt(v,s)}}}function Vb(h){let o,l;return o=new qo({props:{data:h[0],$$slots:{default:[Nb]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&1&&(v.data=c[0]),m&2&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}const Wf=10;function Ub(h,o,l){let c;return Et(h,Om,m=>l(0,c=m)),[c]}class jb extends di{constructor(o){super(),hi(this,o,Ub,Vb,oi,{})}}function qb(h){let o,l,c;return{c(){o=Xt("Undo ("),l=Xt(h[1]),c=Xt(")")},m(m,v){Re(m,o,v),Re(m,l,v),Re(m,c,v)},p(m,v){v&2&&tn(l,m[1])},d(m){m&&(Fe(o),Fe(l),Fe(c))}}}function Zb(h){let o;return{c(){o=Xt("Undo")},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function Gb(h){let o,l,c,m,v,T;function s(D,q){return D[1]==0?Zb:qb}let C=s(h),I=C(h);return{c(){o=we("button"),I.c(),c=st(),m=we("ul"),m.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,o.disabled=l=h[1]==0},m(D,q){Re(D,o,q),I.m(o,null),Re(D,c,q),Re(D,m,q),v||(T=Dt(o,"click",h[2]),v=!0)},p(D,[q]){C===(C=s(D))&&I?I.p(D,q):(I.d(1),I=C(D),I&&(I.c(),I.m(o,null))),q&2&&l!==(l=D[1]==0)&&(o.disabled=l)},i:Vt,o:Vt,d(D){D&&(Fe(o),Fe(c),Fe(m)),I.d(),v=!1,T()}}}function Xb(h,o,l){let c;Et(h,Nm,T=>l(1,c=T));let{route_tool:m}=o;const v=()=>m.undo();return h.$$set=T=>{"route_tool"in T&&l(0,m=T.route_tool)},[m,c,v]}class Wb extends di{constructor(o){super(),hi(this,o,Xb,Gb,oi,{route_tool:0})}}function Hb(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de,oe,Te,me;return C=new Wb({props:{route_tool:h[0]}}),{c(){o=we("div"),l=we("h1"),c=Xt("Draw your neighbourhood boundary for "),m=Xt(h[1]),v=st(),T=we("p"),T.textContent="TODO: maybe move the instructions from the previous screen to here...",s=st(),ct(C.$$.fragment),I=st(),D=we("div"),q=we("button"),q.textContent="Finish",ie=st(),de=we("button"),de.textContent="Cancel",qt(o,"slot","sidebar")},m(ye,W){Re(ye,o,W),_e(o,l),_e(l,c),_e(l,m),_e(o,v),_e(o,T),_e(o,s),at(C,o,null),_e(o,I),_e(o,D),_e(D,q),_e(D,ie),_e(D,de),oe=!0,Te||(me=[Dt(q,"click",h[4]),Dt(de,"click",h[2])],Te=!0)},p(ye,W){(!oe||W&2)&&tn(m,ye[1]);const re={};W&1&&(re.route_tool=ye[0]),C.$set(re)},i(ye){oe||(Me(C.$$.fragment,ye),oe=!0)},o(ye){Ae(C.$$.fragment,ye),oe=!1},d(ye){ye&&Fe(o),lt(C),Te=!1,gn(me)}}}function Kb(h){let o,l,c;return l=new jb({}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","map")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p:Vt,i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function Yb(h){let o,l;return o=new Vs({props:{$$slots:{map:[Kb],sidebar:[Hb]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&131&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Jb(h,o,l){let c,m;Et(h,Ki,D=>l(5,c=D)),Et(h,Dn,D=>l(6,m=D));let{route_tool:v}=o,{name:T}=o,{existing:s}=o;s?v.editExistingArea(s):v.startArea();function C(){Si(Ki,c={mode:"network"},c),v.clearEventListeners()}v.addEventListenerSuccess(D=>{try{m.setNeighbourhoodBoundary(T,D),m.setCurrentNeighbourhood(T),Si(Ki,c={mode:"neighbourhood"},c),v.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),C()}}),v.addEventListenerFailure(C);const I=()=>v.finish();return h.$$set=D=>{"route_tool"in D&&l(0,v=D.route_tool),"name"in D&&l(1,T=D.name),"existing"in D&&l(3,s=D.existing)},[v,T,C,s,I]}class $b extends di{constructor(o){super(),hi(this,o,Jb,Yb,oi,{route_tool:0,name:1,existing:3})}}function Qb(h){let o,l,c,m,v,T;return o=new hc({props:{id:"edit-polygon-fill",filter:Ou,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),c=new ds({props:{filter:Bm,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),v=new Du({props:{id:"edit-polygon-vertices",filter:Fm,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ct(o.$$.fragment),l=st(),ct(c.$$.fragment),m=st(),ct(v.$$.fragment)},m(s,C){at(o,s,C),Re(s,l,C),at(c,s,C),Re(s,m,C),at(v,s,C),T=!0},p:Vt,i(s){T||(Me(o.$$.fragment,s),Me(c.$$.fragment,s),Me(v.$$.fragment,s),T=!0)},o(s){Ae(o.$$.fragment,s),Ae(c.$$.fragment,s),Ae(v.$$.fragment,s),T=!1},d(s){s&&(Fe(l),Fe(m)),lt(o,s),lt(c,s),lt(v,s)}}}function e1(h){let o,l;return o=new qo({props:{data:h[0],$$slots:{default:[Qb]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&1&&(v.data=c[0]),m&2&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function t1(h,o,l){let c;return Et(h,Lm,m=>l(0,c=m)),[c]}class i1 extends di{constructor(o){super(),hi(this,o,t1,e1,oi,{})}}function r1(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de,oe,Te,me,ye,W,re,le,xe,Ee,Ie,Oe,qe,He,be,Ue,xt;return o=new vm({props:{msg:h[1]}}),He=new Sv({props:{map:h[3]}}),He.$on("gotXml",h[5]),He.$on("loading",h[8]),He.$on("error",h[9]),{c(){ct(o.$$.fragment),l=st(),c=we("div"),m=we("label"),v=Xt(`Load an example:
    `),T=we("select"),s=we("option"),s.textContent="Custom file loaded",C=we("option"),C.textContent="Akihabara",I=we("option"),I.textContent="Hanegi Park",D=we("option"),D.textContent="Harujuku",q=we("option"),q.textContent="Taipei main station",ie=we("option"),ie.textContent="Ximending",de=we("option"),de.textContent="Hong Kong",oe=we("option"),oe.textContent="Kowloon",Te=we("option"),Te.textContent="Bristol",me=we("option"),me.textContent="Elephant & Castle",ye=we("option"),ye.textContent="Westminster",W=we("option"),W.textContent="Montlake",re=we("option"),re.textContent="Strasbourg",le=st(),xe=we("div"),Ee=we("label"),Ie=Xt(`Load an osm.xml or a .pbf file:
    `),Oe=we("input"),qe=st(),ct(He.$$.fragment),s.__value="",Ln(s,s.__value),C.__value="akihabara",Ln(C,C.__value),I.__value="hanegi",Ln(I,I.__value),D.__value="harujuku",Ln(D,D.__value),q.__value="taipei_main_station",Ln(q,q.__value),ie.__value="ximending",Ln(ie,ie.__value),de.__value="hong_kong",Ln(de,de.__value),oe.__value="kowloon",Ln(oe,oe.__value),Te.__value="bristol",Ln(Te,Te.__value),me.__value="elephant_castle",Ln(me,me.__value),ye.__value="westminster",Ln(ye,ye.__value),W.__value="montlake",Ln(W,W.__value),re.__value="strasbourg",Ln(re,re.__value),h[0]===void 0&&Cu(()=>h[6].call(T)),qt(Oe,"type","file")},m(Ne,vt){at(o,Ne,vt),Re(Ne,l,vt),Re(Ne,c,vt),_e(c,m),_e(m,v),_e(m,T),_e(T,s),_e(T,C),_e(T,I),_e(T,D),_e(T,q),_e(T,ie),_e(T,de),_e(T,oe),_e(T,Te),_e(T,me),_e(T,ye),_e(T,W),_e(T,re),sf(T,h[0],!0),Re(Ne,le,vt),Re(Ne,xe,vt),_e(xe,Ee),_e(Ee,Ie),_e(Ee,Oe),h[7](Oe),Re(Ne,qe,vt),at(He,Ne,vt),be=!0,Ue||(xt=[Dt(T,"change",h[6]),Dt(Oe,"change",h[4])],Ue=!0)},p(Ne,[vt]){const gt={};vt&2&&(gt.msg=Ne[1]),o.$set(gt),vt&1&&sf(T,Ne[0]);const dt={};vt&8&&(dt.map=Ne[3]),He.$set(dt)},i(Ne){be||(Me(o.$$.fragment,Ne),Me(He.$$.fragment,Ne),be=!0)},o(Ne){Ae(o.$$.fragment,Ne),Ae(He.$$.fragment,Ne),be=!1},d(Ne){Ne&&(Fe(l),Fe(c),Fe(le),Fe(xe),Fe(qe)),lt(o,Ne),h[7](null),lt(He,Ne),Ue=!1,gn(xt)}}}function n1(h,o,l){let c,m,v;Et(h,Ql,W=>l(0,c=W)),Et(h,Dn,W=>l(11,m=W)),Et(h,Os,W=>l(3,v=W));let T=null,s=!1;lc(async()=>{try{s=(await fetch("/osm/kowloon.pbf",{method:"HEAD"})).ok,console.log("Using local cache, not od2net.org")}catch{}});let C;async function I(W){try{D(await C.files[0].arrayBuffer()),Si(Ql,c="",c)}catch(re){window.alert(`Couldn't open this file: ${re}`)}l(1,T=null)}function D(W){l(1,T="Building map model from OSM input"),console.time("load"),Si(Dn,m=new ry(new Uint8Array(W)),m),console.timeEnd("load")}function q(W){try{D(new TextEncoder().encode(W.detail)),Si(Ql,c="",c)}catch(re){window.alert(`Couldn't import from Overpass: ${re}`)}l(1,T=null)}async function ie(W){W!=""&&(s?await de(`/osm/${W}.pbf`):await de(`https://assets.od2net.org/severance_pbfs/${W}.pbf`))}async function de(W){try{l(1,T=`Downloading ${W}`);let re=await fetch(W);D(await re.arrayBuffer())}catch(re){window.alert(`Couldn't open from URL ${W}: ${re}`)}l(1,T=null)}function oe(){c=qg(this),Ql.set(c)}function Te(W){Ur[W?"unshift":"push"](()=>{C=W,l(2,C)})}const me=W=>l(1,T=W.detail),ye=W=>window.alert(W.detail);return h.$$.update=()=>{h.$$.dirty&1&&ie(c)},[c,T,C,v,I,q,oe,Te,me,ye]}class o1 extends di{constructor(o){super(),hi(this,o,n1,r1,oi,{})}}function Hf(h){let o,l;return o=new bm({props:{$$slots:{default:[s1,({dialog:c})=>({6:c}),({dialog:c})=>c?64:0]},$$scope:{ctx:h}}}),o.$on("close",h[4]),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&192&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function s1(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de,oe;function Te(){return h[3](h[6])}return{c(){o=we("h1"),o.textContent="The Low-traffic neighbourhood (LTN) tool, v2",l=st(),c=we("p"),c.innerHTML=`This is an <b>experimental</b> version of the
          <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>. Most parts of it do not work yet, and you should probably use the
          other version of the tool instead.`,m=st(),v=we("p"),v.textContent="To use this tool, you need to:",T=st(),s=we("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, to fix the basemap data on existing modal filters, turn
            restrictions, one-ways, etc</li> <li>To create one or more proposals with new modal filters, and explore
            their effects</li>`,C=st(),I=we("p"),I.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
          and relies heavily on
          <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a> data.`,D=st(),q=we("center"),ie=we("button"),ie.textContent="Start!"},m(me,ye){Re(me,o,ye),Re(me,l,ye),Re(me,c,ye),Re(me,m,ye),Re(me,v,ye),Re(me,T,ye),Re(me,s,ye),Re(me,C,ye),Re(me,I,ye),Re(me,D,ye),Re(me,q,ye),_e(q,ie),de||(oe=Dt(ie,"click",Te),de=!0)},p(me,ye){h=me},d(me){me&&(Fe(o),Fe(l),Fe(c),Fe(m),Fe(v),Fe(T),Fe(s),Fe(C),Fe(I),Fe(D),Fe(q)),de=!1,oe()}}}function a1(h){let o;return{c(){o=we("p"),o.textContent="Waiting for MapLibre and WASM to load..."},m(l,c){Re(l,o,c)},i:Vt,o:Vt,d(l){l&&Fe(o)}}}function l1(h){let o,l;return o=new o1({}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function c1(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de,oe=h[1]&&Hf(h);const Te=[l1,a1],me=[];function ye(W,re){return W[2]&&W[0]?0:1}return I=ye(h),D=me[I]=Te[I](h),{c(){o=we("div"),oe&&oe.c(),l=st(),c=we("h1"),c.textContent="Choose your study area",m=st(),v=we("button"),v.textContent="About the LTN tool",T=st(),s=we("hr"),C=st(),D.c(),qt(o,"slot","sidebar")},m(W,re){Re(W,o,re),oe&&oe.m(o,null),_e(o,l),_e(o,c),_e(o,m),_e(o,v),_e(o,T),_e(o,s),_e(o,C),me[I].m(o,null),q=!0,ie||(de=Dt(v,"click",h[5]),ie=!0)},p(W,re){W[1]?oe?(oe.p(W,re),re&2&&Me(oe,1)):(oe=Hf(W),oe.c(),Me(oe,1),oe.m(o,l)):oe&&(mr(),Ae(oe,1,1,()=>{oe=null}),_r());let le=I;I=ye(W),I!==le&&(mr(),Ae(me[le],1,1,()=>{me[le]=null}),_r(),D=me[I],D||(D=me[I]=Te[I](W),D.c()),Me(D,1),D.m(o,null))},i(W){q||(Me(oe),Me(D),q=!0)},o(W){Ae(oe),Ae(D),q=!1},d(W){W&&Fe(o),oe&&oe.d(),me[I].d(),ie=!1,de()}}}function u1(h){let o,l,c;return l=new i1({}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","map")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p:Vt,i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function h1(h){let o,l;return o=new Vs({props:{$$slots:{map:[u1],sidebar:[c1]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&135&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function d1(h,o,l){let c;Et(h,Os,I=>l(2,c=I));let{wasmReady:m}=o,v=!0;const T=I=>si(I).close(),s=()=>l(1,v=!1),C=()=>l(1,v=!0);return h.$$set=I=>{"wasmReady"in I&&l(0,m=I.wasmReady)},[m,v,c,T,s,C]}class p1 extends di{constructor(o){super(),hi(this,o,d1,h1,oi,{wasmReady:0})}}const{window:f1}=Ug;function m1(h){let o,l,c,m,v,T=h[0].shortcutIndex+"",s,C,I=h[0].gj.features.length+"",D,q,ie,de,oe,Te,me;return{c(){o=we("div"),l=we("button"),c=Xt("Prev"),v=st(),s=Xt(T),C=Xt(" / "),D=Xt(I),q=st(),ie=we("button"),de=Xt("Next"),l.disabled=m=h[0].shortcutIndex==null||h[0].shortcutIndex==0,ie.disabled=oe=h[0].shortcutIndex==h[0].gj.features.length-1},m(ye,W){Re(ye,o,W),_e(o,l),_e(l,c),_e(o,v),_e(o,s),_e(o,C),_e(o,D),_e(o,q),_e(o,ie),_e(ie,de),Te||(me=[Dt(l,"click",h[6]),Dt(ie,"click",h[7])],Te=!0)},p(ye,W){W&1&&m!==(m=ye[0].shortcutIndex==null||ye[0].shortcutIndex==0)&&(l.disabled=m),W&1&&T!==(T=ye[0].shortcutIndex+"")&&tn(s,T),W&1&&I!==(I=ye[0].gj.features.length+"")&&tn(D,I),W&1&&oe!==(oe=ye[0].shortcutIndex==ye[0].gj.features.length-1)&&(ie.disabled=oe)},d(ye){ye&&Fe(o),Te=!1,gn(me)}}}function _1(h){let o;return{c(){o=we("p"),o.textContent="Click a road to see shortcuts"},m(l,c){Re(l,o,c)},p:Vt,d(l){l&&Fe(o)}}}function g1(h){let o,l,c,m,v,T;function s(D,q){if(D[0].state=="neutral")return _1;if(D[0].state=="chose-road")return m1}let C=s(h),I=C&&C(h);return{c(){o=we("div"),l=we("div"),c=we("button"),c.textContent="Back to editing",m=st(),I&&I.c(),qt(o,"slot","sidebar")},m(D,q){Re(D,o,q),_e(o,l),_e(l,c),_e(o,m),I&&I.m(o,null),v||(T=Dt(c,"click",h[4]),v=!0)},p(D,q){C===(C=s(D))&&I?I.p(D,q):(I&&I.d(1),I=C&&C(D),I&&(I.c(),I.m(o,null)))},d(D){D&&Fe(o),I&&I.d(),v=!1,T()}}}function y1(h){let o,l,c,m;const v=[x1,b1],T=[];function s(C,I){return C[0].shortcutIndex==null?0:1}return o=s(h),l=T[o]=v[o](h),{c(){l.c(),c=Bn()},m(C,I){T[o].m(C,I),Re(C,c,I),m=!0},p(C,I){let D=o;o=s(C),o===D?T[o].p(C,I):(mr(),Ae(T[D],1,1,()=>{T[D]=null}),_r(),l=T[o],l?l.p(C,I):(l=T[o]=v[o](C),l.c()),Me(l,1),l.m(c.parentNode,c))},i(C){m||(Me(l),m=!0)},o(C){Ae(l),m=!1},d(C){C&&Fe(c),T[o].d(C)}}}function v1(h){let o,l;return o=new Nu({props:{gjInput:JSON.parse(si(h[1]).renderNeighbourhood()),onClickLine:h[5],$$slots:{"line-popup":[k1]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&2&&(v.gjInput=JSON.parse(si(c[1]).renderNeighbourhood())),m&2048&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function b1(h){let o,l;return o=new qo({props:{data:h[0].gj.features[h[0].shortcutIndex],$$slots:{default:[w1]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&1&&(v.data=c[0].gj.features[c[0].shortcutIndex]),m&2048&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function x1(h){let o,l;return o=new qo({props:{data:h[0].gj,$$slots:{default:[S1]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&1&&(v.data=c[0].gj),m&2048&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function w1(h){let o,l;return o=new ds({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function S1(h){let o,l;return o=new ds({props:{paint:{"line-width":5,"line-color":"red"}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function T1(h){let o=si(h[10]).properties.shortcuts+"",l;return{c(){l=Xt(o)},m(c,m){Re(c,l,m)},p(c,m){m&1024&&o!==(o=si(c[10]).properties.shortcuts+"")&&tn(l,o)},d(c){c&&Fe(l)}}}function k1(h){let o,l,c;return l=new Ns({props:{openOn:"hover",$$slots:{default:[T1,({data:m})=>({10:m}),({data:m})=>m?1024:0]},$$scope:{ctx:h}}}),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","line-popup")},m(m,v){Re(m,o,v),at(l,o,null),c=!0},p(m,v){const T={};v&3072&&(T.$$scope={dirty:v,ctx:m}),l.$set(T)},i(m){c||(Me(l.$$.fragment,m),c=!0)},o(m){Ae(l.$$.fragment,m),c=!1},d(m){m&&Fe(o),lt(l)}}}function I1(h){let o,l,c,m;const v=[v1,y1],T=[];function s(C,I){return C[0].state=="neutral"?0:C[0].state=="chose-road"?1:-1}return~(l=s(h))&&(c=T[l]=v[l](h)),{c(){o=we("div"),c&&c.c(),qt(o,"slot","map")},m(C,I){Re(C,o,I),~l&&T[l].m(o,null),m=!0},p(C,I){let D=l;l=s(C),l===D?~l&&T[l].p(C,I):(c&&(mr(),Ae(T[D],1,1,()=>{T[D]=null}),_r()),~l?(c=T[l],c?c.p(C,I):(c=T[l]=v[l](C),c.c()),Me(c,1),c.m(o,null)):c=null)},i(C){m||(Me(c),m=!0)},o(C){Ae(c),m=!1},d(C){C&&Fe(o),~l&&T[l].d()}}}function M1(h){let o,l,c,m;return o=new Vs({props:{$$slots:{map:[I1],sidebar:[g1]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(v,T){at(o,v,T),l=!0,c||(m=Dt(f1,"keydown",h[3]),c=!0)},p(v,[T]){const s={};T&2051&&(s.$$scope={dirty:T,ctx:v}),o.$set(s)},i(v){l||(Me(o.$$.fragment,v),l=!0)},o(v){Ae(o.$$.fragment,v),l=!1},d(v){lt(o,v),c=!1,m()}}}function C1(h,o,l){let c,m,v;Et(h,Ki,de=>l(8,c=de)),Et(h,Os,de=>l(9,m=de)),Et(h,Dn,de=>l(1,v=de));let T={state:"neutral"};function s(de){let oe=JSON.parse(v.getShortcutsCrossingRoad(de));if(oe.features.length==0){window.alert("No shortcuts here");return}l(0,T={state:"chose-road",road:de,gj:oe,shortcutIndex:null})}lc(()=>{m==null||m.keyboard.disable()}),bo(()=>{m==null||m.keyboard.enable()});function C(de){T.state=="chose-road"&&(de.key=="ArrowLeft"&&T.shortcutIndex&&(de.stopPropagation(),l(0,T.shortcutIndex--,T)),de.key=="ArrowRight"&&(de.stopPropagation(),T.shortcutIndex==null?l(0,T.shortcutIndex=0,T):T.shortcutIndex!=T.gj.features.length-1&&l(0,T.shortcutIndex++,T)),de.key=="Escape"&&(de.stopPropagation(),I()))}function I(){Si(Ki,c={mode:"neighbourhood"},c)}return[T,v,s,C,I,de=>s(si(de.properties).id),()=>l(0,T.shortcutIndex--,T),()=>l(0,T.shortcutIndex++,T)]}class A1 extends di{constructor(o){super(),hi(this,o,C1,M1,oi,{})}}function Kf(h){let o,l,c,m;return{c(){o=we("div"),l=we("button"),l.textContent="Zoom to fit study area"},m(v,T){Re(v,o,T),_e(o,l),c||(m=Dt(l,"click",h[9]),c=!0)},p:Vt,d(v){v&&Fe(o),c=!1,m()}}}function E1(h){let o,l,c,m,v,T,s,C,I,D,q,ie,de=h[3]&&Kf(h);return{c(){o=we("div"),l=we("div"),c=st(),m=we("hr"),v=st(),de&&de.c(),T=st(),s=we("div"),C=we("label"),I=we("input"),D=Xt("Show basemap"),qt(I,"type","checkbox"),qt(o,"slot","left")},m(oe,Te){Re(oe,o,Te),_e(o,l),h[15](l),_e(o,c),_e(o,m),_e(o,v),de&&de.m(o,null),_e(o,T),_e(o,s),_e(s,C),_e(C,I),I.checked=h[4],_e(C,D),q||(ie=Dt(I,"change",h[16]),q=!0)},p(oe,Te){oe[3]?de?de.p(oe,Te):(de=Kf(oe),de.c(),de.m(o,T)):de&&(de.d(1),de=null),Te&16&&(I.checked=oe[4])},d(oe){oe&&Fe(o),h[15](null),de&&de.d(),q=!1,ie()}}}function Yf(h){let o,l;return o=new p1({props:{wasmReady:h[5]}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&32&&(v.wasmReady=c[5]),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function Jf(h){let o,l,c,m,v,T;o=new qo({props:{data:JSON.parse(h[3].getInvertedBoundary()),$$slots:{default:[P1]},$$scope:{ctx:h}}});const s=[R1,F1,B1,D1,L1,z1],C=[];function I(D,q){return D[8].mode=="network"?0:D[8].mode=="set-boundary"?1:D[8].mode=="neighbourhood"?2:D[8].mode=="view-shortcuts"?3:D[8].mode=="route"?4:D[8].mode=="debug"?5:-1}return~(c=I(h))&&(m=C[c]=s[c](h)),{c(){ct(o.$$.fragment),l=st(),m&&m.c(),v=Bn()},m(D,q){at(o,D,q),Re(D,l,q),~c&&C[c].m(D,q),Re(D,v,q),T=!0},p(D,q){const ie={};q&8&&(ie.data=JSON.parse(D[3].getInvertedBoundary())),q&524288&&(ie.$$scope={dirty:q,ctx:D}),o.$set(ie);let de=c;c=I(D),c===de?~c&&C[c].p(D,q):(m&&(mr(),Ae(C[de],1,1,()=>{C[de]=null}),_r()),~c?(m=C[c],m?m.p(D,q):(m=C[c]=s[c](D),m.c()),Me(m,1),m.m(v.parentNode,v)):m=null)},i(D){T||(Me(o.$$.fragment,D),Me(m),T=!0)},o(D){Ae(o.$$.fragment,D),Ae(m),T=!1},d(D){D&&(Fe(l),Fe(v)),lt(o,D),~c&&C[c].d(D)}}}function P1(h){let o,l;return o=new hc({props:{paint:{"fill-color":"black","fill-opacity":.3}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function z1(h){let o,l;return o=new tb({}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function L1(h){let o,l;return o=new Ob({}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function D1(h){let o,l;return o=new A1({}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function B1(h){let o,l;return o=new wb({}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function F1(h){let o,l;return o=new $b({props:{route_tool:h[6],name:h[8].name,existing:h[8].existing}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,m){const v={};m&64&&(v.route_tool=c[6]),m&256&&(v.name=c[8].name),m&256&&(v.existing=c[8].existing),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function R1(h){let o,l;return o=new Eb({}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p:Vt,i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function O1(h){let o,l,c,m,v,T=h[8].mode=="title"&&Yf(h),s=h[3]&&Jf(h);return{c(){o=we("div"),l=st(),T&&T.c(),c=st(),s&&s.c(),m=Bn()},m(C,I){Re(C,o,I),h[12](o),Re(C,l,I),T&&T.m(C,I),Re(C,c,I),s&&s.m(C,I),Re(C,m,I),v=!0},p(C,I){C[8].mode=="title"?T?(T.p(C,I),I&256&&Me(T,1)):(T=Yf(C),T.c(),Me(T,1),T.m(c.parentNode,c)):T&&(mr(),Ae(T,1,1,()=>{T=null}),_r()),C[3]?s?(s.p(C,I),I&8&&Me(s,1)):(s=Jf(C),s.c(),Me(s,1),s.m(m.parentNode,m)):s&&(mr(),Ae(s,1,1,()=>{s=null}),_r())},i(C){v||(Me(T),Me(s),v=!0)},o(C){Ae(T),Ae(s),v=!1},d(C){C&&(Fe(o),Fe(l),Fe(c),Fe(m)),h[12](null),T&&T.d(C),s&&s.d(C)}}}function N1(h){let o,l,c,m;function v(s){h[13](s)}let T={style:h[7],standardControls:!0,hash:!0,$$slots:{default:[O1]},$$scope:{ctx:h}};return h[0]!==void 0&&(T.map=h[0]),l=new t0({props:T}),Ur.push(()=>Fs(l,"map",v)),l.$on("error",h[14]),{c(){o=we("div"),ct(l.$$.fragment),qt(o,"slot","main"),Ea(o,"position","relative"),Ea(o,"width","100%"),Ea(o,"height","100vh")},m(s,C){Re(s,o,C),at(l,o,null),m=!0},p(s,C){const I={};C&128&&(I.style=s[7]),C&524652&&(I.$$scope={dirty:C,ctx:s}),!c&&C&1&&(c=!0,I.map=s[0],Bs(()=>c=!1)),l.$set(I)},i(s){m||(Me(l.$$.fragment,s),m=!0)},o(s){Ae(l.$$.fragment,s),m=!1},d(s){s&&Fe(o),lt(l)}}}function V1(h){let o,l;return o=new w0({props:{$$slots:{main:[N1],left:[E1]},$$scope:{ctx:h}}}),{c(){ct(o.$$.fragment)},m(c,m){at(o,c,m),l=!0},p(c,[m]){const v={};m&524799&&(v.$$scope={dirty:m,ctx:c}),o.$set(v)},i(c){l||(Me(o.$$.fragment,c),l=!0)},o(c){Ae(o.$$.fragment,c),l=!1},d(c){lt(o,c)}}}function U1(h,o,l){let c,m,v,T,s,C,I;Et(h,ud,Ee=>l(10,m=Ee)),Et(h,cd,Ee=>l(11,v=Ee)),Et(h,Dn,Ee=>l(3,T=Ee)),Et(h,Os,Ee=>l(17,s=Ee)),Et(h,Ki,Ee=>l(8,C=Ee)),Et(h,ld,Ee=>l(4,I=Ee));let D=!1;lc(async()=>{await am(),await cm(),l(5,D=!0)});let q,ie;function de(){s.fitBounds(Array.from(T.getBounds()),{animate:!1})}function oe(Ee){T&&(console.log("New map model loaded"),de(),Si(Ki,C={mode:"network"},C),l(6,ie=new Av(s,T.toRouteSnapper())))}let Te,me;function ye(Ee){Ur[Ee?"unshift":"push"](()=>{me=Ee,l(2,me),l(10,m)})}function W(Ee){q=Ee,l(0,q)}const re=Ee=>{console.log(Ee.detail.error)};function le(Ee){Ur[Ee?"unshift":"push"](()=>{Te=Ee,l(1,Te),l(11,v)})}function xe(){I=this.checked,ld.set(I)}return h.$$.update=()=>{h.$$.dirty&16&&l(7,c=I?"https://api.maptiler.com/maps/dataviz/style.json?key=MZEJTanw3WpxRvt7qDfo":{version:8,sources:{},layers:[]}),h.$$.dirty&1&&q&&Os.set(q),h.$$.dirty&8&&oe(),h.$$.dirty&2050&&Te&&v&&(l(1,Te.innerHTML="",Te),Te.appendChild(v)),h.$$.dirty&1028&&me&&m&&(l(2,me.innerHTML="",me),me.appendChild(m))},[q,Te,me,T,I,D,ie,c,C,de,m,v,ye,W,re,le,xe]}class j1 extends di{constructor(o){super(),hi(this,o,U1,V1,oi,{})}}new j1({target:document.getElementById("app")});
