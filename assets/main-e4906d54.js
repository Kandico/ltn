var Bs=Object.defineProperty;var Rs=(r,e,t)=>e in r?Bs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var st=(r,e,t)=>(Rs(r,typeof e!="symbol"?e+"":e,t),t);import{S as ie,i as se,s as re,e as Ze,a as k,n as Y,d as L,b as $,t as O,c as C,f as E,g as p,h as oe,j as ae,k as Be,l as X,u as Re,m as ze,o as De,p as b,q as S,r as rt,v as Ne,w as Ge,x as Te,y as ot,z as zs,A as no,B as Ds,C as be,D as ye,E as V,F as ur,G as T,H as A,I as F,J as x,L as Pi,K as pt,M as gt,N as ro,O as mt,P as oo,Q as Mt,R as fn,T as bo,U as Pr,V as Ii,W as Dr,X as Us,Y as Kt,Z as Hs,_ as yr,$ as Gs,a0 as Ws,a1 as qs,a2 as Js,a3 as cr,a4 as Zs,a5 as qe,a6 as pn,a7 as $t,a8 as Ur,a9 as gn,aa as St,ab as Ke,ac as Ct,ad as pe,ae as qt,af as dr,ag as yo,ah as an,ai as Yt,aj as ji,ak as Ni,al as Gt,am as Lt,an as xe,ao as Je,ap as wo,aq as Ks,ar as Ys,as as Xs,at as Vs,au as ht,av as ct,aw as Me,ax as fe,ay as Hn,az as Ve,aA as lo,aB as Ln,aC as _r,aD as Hr,aE as io,aF as jt,aG as Oi,aH as Gr,aI as vo,aJ as or,aK as Gn,aL as Wn,aM as Wr,aN as tn,aO as $o,aP as Qs,aQ as qr,aR as xs,aS as ko,aT as ea,aU as ta}from"./pico.conditional.jade.min-9ac8edb3.js";function We(r,e){const t={},n={},o={$$scope:1};let l=r.length;for(;l--;){const i=r[l],s=e[l];if(s){for(const a in i)a in s||(n[a]=1);for(const a in s)o[a]||(t[a]=s[a],o[a]=1);r[l]=s}else for(const a in i)o[a]=1}for(const i in n)i in t||(t[i]=void 0);return t}function so(r){return typeof r=="object"&&r!==null?r:{}}const na="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",ra="/ltn/assets/logo-97f2d067.svg",Bi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Lo(r){let e,t,n,o=r[1]!=null&&So(r);return{c(){e=$("div"),t=O(r[0]),n=C(),o&&o.c(),E(e,"class","cover svelte-1w7hi45")},m(l,i){k(l,e,i),p(e,t),p(e,n),o&&o.m(e,null)},p(l,i){i&1&&oe(t,l[0]),l[1]!=null?o?o.p(l,i):(o=So(l),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(l){l&&L(e),o&&o.d()}}}function So(r){let e,t;return{c(){e=$("div"),t=$("progress"),t.value=r[1],ae(t,"width","100%")},m(n,o){k(n,e,o),p(e,t)},p(n,o){o&2&&(t.value=n[1])},d(n){n&&L(e)}}}function oa(r){let e,t=r[0]&&Lo(r);return{c(){t&&t.c(),e=Ze()},m(n,o){t&&t.m(n,o),k(n,e,o)},p(n,[o]){n[0]?t?t.p(n,o):(t=Lo(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Y,o:Y,d(n){n&&L(e),t&&t.d(n)}}}function la(r,e,t){let{loading:n}=e,{progress:o=null}=e;return r.$$set=l=>{"loading"in l&&t(0,n=l.loading),"progress"in l&&t(1,o=l.progress)},[n,o]}class Ri extends ie{constructor(e){super(),se(this,e,la,oa,re,{loading:0,progress:1})}}const ia=r=>({dialog:r&1}),Mo=r=>({dialog:r[0]});function sa(r){let e,t,n,o,l;const i=r[4].default,s=Be(i,r,r[3],Mo);return{c(){e=$("dialog"),t=$("article"),s&&s.c(),e.open=!0},m(a,f){k(a,e,f),p(e,t),s&&s.m(t,null),r[6](e),n=!0,o||(l=[X(window,"click",r[1]),X(window,"keydown",r[2]),X(e,"close",r[5])],o=!0)},p(a,[f]){s&&s.p&&(!n||f&9)&&Re(s,i,a,a[3],n?De(i,a[3],f,ia):ze(a[3]),Mo)},i(a){n||(b(s,a),n=!0)},o(a){S(s,a),n=!1},d(a){a&&L(e),s&&s.d(a),r[6](null),o=!1,rt(l)}}}function aa(r,e,t){let{$$slots:n={},$$scope:o}=e,l;function i(u){l.open&&u.target==l&&l.close()}function s(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),l.close())}function a(u){Ne.call(this,r,u)}function f(u){Ge[u?"unshift":"push"](()=>{l=u,t(0,l)})}return r.$$set=u=>{"$$scope"in u&&t(3,o=u.$$scope)},[l,i,s,o,n,a,f]}class wr extends ie{constructor(e){super(),se(this,e,aa,sa,re,{})}}function Co(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function To(r){let e,t,n=r[1]+"",o,l,i,s=r[2]+"",a,f;return{c(){e=$("tr"),t=$("td"),o=O(n),l=C(),i=$("td"),a=O(s),f=C()},m(u,c){k(u,e,c),p(e,t),p(t,o),p(e,l),p(e,i),p(i,a),p(e,f)},p(u,c){c&1&&n!==(n=u[1]+"")&&oe(o,n),c&1&&s!==(s=u[2]+"")&&oe(a,s)},d(u){u&&L(e)}}}function fa(r){let e,t,n=Te(Object.entries(r[0])),o=[];for(let l=0;l<n.length;l+=1)o[l]=To(Co(r,n,l));return{c(){e=$("table"),t=$("tbody");for(let l=0;l<o.length;l+=1)o[l].c();E(e,"class","svelte-lh2o9l")},m(l,i){k(l,e,i),p(e,t);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(t,null)},p(l,[i]){if(i&1){n=Te(Object.entries(l[0]));let s;for(s=0;s<n.length;s+=1){const a=Co(l,n,s);o[s]?o[s].p(a,i):(o[s]=To(a),o[s].c(),o[s].m(t,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},i:Y,o:Y,d(l){l&&L(e),ot(o,l)}}}function ua(r,e,t){let{properties:n}=e;return r.$$set=o=>{"properties"in o&&t(0,n=o.properties)},[n]}class Kn extends ie{constructor(e){super(),se(this,e,ua,fa,re,{properties:0})}}function Ao(r,e,t){const n=r.slice();return n[2]=e[t][0],n[6]=e[t][1],n}function Fo(r,e,t){const n=r.slice();return n[2]=e[t][0],n[3]=e[t][1],n}function Eo(r,e,t){const n=r.slice();return n[3]=e[t][0],n[6]=e[t][1],n}function ca(r){let e,t=Te(Object.entries(r[0])),n=[];for(let o=0;o<t.length;o+=1)n[o]=Po(Ao(r,t,o));return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=Ze()},m(o,l){for(let i=0;i<n.length;i+=1)n[i]&&n[i].m(o,l);k(o,e,l)},p(o,l){if(l&1){t=Te(Object.entries(o[0]));let i;for(i=0;i<t.length;i+=1){const s=Ao(o,t,i);n[i]?n[i].p(s,l):(n[i]=Po(s),n[i].c(),n[i].m(e.parentNode,e))}for(;i<n.length;i+=1)n[i].d(1);n.length=t.length}},d(o){o&&L(e),ot(n,o)}}}function da(r){let e,t,n,o=Te(Object.entries(r[0])),l=[];for(let a=0;a<o.length;a+=1)l[a]=Io(Eo(r,o,a));let i=Te(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=jo(Fo(r,i,a));return{c(){e=$("div");for(let a=0;a<l.length;a+=1)l[a].c();t=C(),n=$("div");for(let a=0;a<s.length;a+=1)s[a].c();ae(e,"display","flex"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(a,f){k(a,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);k(a,t,f),k(a,n,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(n,null)},p(a,f){if(f&1){o=Te(Object.entries(a[0]));let u;for(u=0;u<o.length;u+=1){const c=Eo(a,o,u);l[u]?l[u].p(c,f):(l[u]=Io(c),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(f&1){i=Te(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const c=Fo(a,i,u);s[u]?s[u].p(c,f):(s[u]=jo(c),s[u].c(),s[u].m(n,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&(L(e),L(t),L(n)),ot(l,a),ot(s,a)}}}function Po(r){let e,t,n,o=r[2]+"",l,i;return{c(){e=$("div"),t=$("span"),n=C(),l=O(o),i=C(),E(t,"class","vertical-block svelte-rl95zk"),ae(t,"background",r[6])},m(s,a){k(s,e,a),p(e,t),p(e,n),p(e,l),p(e,i)},p(s,a){a&1&&ae(t,"background",s[6]),a&1&&o!==(o=s[2]+"")&&oe(l,o)},d(s){s&&L(e)}}}function Io(r){let e,t;return{c(){e=$("span"),t=O(` 
      `),ae(e,"background",r[6]),ae(e,"width","100%"),ae(e,"border","1px solid black")},m(n,o){k(n,e,o),p(e,t)},p(n,o){o&1&&ae(e,"background",n[6])},d(n){n&&L(e)}}}function jo(r){let e,t=r[2]+"",n;return{c(){e=$("span"),n=O(t)},m(o,l){k(o,e,l),p(e,n)},p(o,l){l&1&&t!==(t=o[2]+"")&&oe(n,t)},d(o){o&&L(e)}}}function _a(r){let e;function t(l,i){return l[1]?da:ca}let n=t(r),o=n(r);return{c(){o.c(),e=Ze()},m(l,i){o.m(l,i),k(l,e,i)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},i:Y,o:Y,d(l){l&&L(e),o.d(l)}}}function ma(r,e,t){let{colors:n}=e,{horiz:o=!1}=e;return r.$$set=l=>{"colors"in l&&t(0,n=l.colors),"horiz"in l&&t(1,o=l.horiz)},[n,o]}class ao extends ie{constructor(e){super(),se(this,e,ma,_a,re,{colors:0,horiz:1})}}function No(r,e,t){const n=r.slice();return n[3]=e[t],n}function Oo(r,e,t){const n=r.slice();return n[6]=e[t],n}function Bo(r){let e,t;return{c(){e=$("span"),t=O(` 
    `),ae(e,"background",r[6]),ae(e,"width","100%"),ae(e,"border","1px solid black")},m(n,o){k(n,e,o),p(e,t)},p(n,o){o&1&&ae(e,"background",n[6])},d(n){n&&L(e)}}}function pa(r){let e,t=r[3]+"",n;return{c(){e=$("span"),n=O(t)},m(o,l){k(o,e,l),p(e,n)},p(o,l){l&2&&t!==(t=o[3]+"")&&oe(n,t)},d(o){o&&L(e)}}}function ga(r){let e,t=r[3].toFixed(r[2])+"",n;return{c(){e=$("span"),n=O(t)},m(o,l){k(o,e,l),p(e,n)},p(o,l){l&6&&t!==(t=o[3].toFixed(o[2])+"")&&oe(n,t)},d(o){o&&L(e)}}}function Ro(r){let e;function t(l,i){return l[2]>0?ga:pa}let n=t(r),o=n(r);return{c(){o.c(),e=Ze()},m(l,i){o.m(l,i),k(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&L(e),o.d(l)}}}function ha(r){let e,t,n,o=Te(r[0]),l=[];for(let a=0;a<o.length;a+=1)l[a]=Bo(Oo(r,o,a));let i=Te(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ro(No(r,i,a));return{c(){e=$("div");for(let a=0;a<l.length;a+=1)l[a].c();t=C(),n=$("div");for(let a=0;a<s.length;a+=1)s[a].c();ae(e,"display","flex"),ae(n,"display","flex"),ae(n,"justify-content","space-between")},m(a,f){k(a,e,f);for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(e,null);k(a,t,f),k(a,n,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(n,null)},p(a,[f]){if(f&1){o=Te(a[0]);let u;for(u=0;u<o.length;u+=1){const c=Oo(a,o,u);l[u]?l[u].p(c,f):(l[u]=Bo(c),l[u].c(),l[u].m(e,null))}for(;u<l.length;u+=1)l[u].d(1);l.length=o.length}if(f&6){i=Te(a[1]);let u;for(u=0;u<i.length;u+=1){const c=No(a,i,u);s[u]?s[u].p(c,f):(s[u]=Ro(c),s[u].c(),s[u].m(n,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},i:Y,o:Y,d(a){a&&(L(e),L(t),L(n)),ot(l,a),ot(s,a)}}}function ba(r,e,t){let{colorScale:n}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&t(0,n=i.colorScale),"limits"in i&&t(1,o=i.limits),"decimalPlaces"in i&&t(2,l=i.decimalPlaces)},[n,o,l]}class Yn extends ie{constructor(e){super(),se(this,e,ba,ha,re,{colorScale:0,limits:1,decimalPlaces:2})}}function mr(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function dt(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let de;const zi=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&zi.decode();let Pn=null;function zn(){return(Pn===null||Pn.byteLength===0)&&(Pn=new Uint8Array(de.memory.buffer)),Pn}function Ot(r,e){return r=r>>>0,zi.decode(zn().subarray(r,r+e))}const Qt=new Array(128).fill(void 0);Qt.push(void 0,null,!0,!1);let Dn=Qt.length;function nt(r){Dn===Qt.length&&Qt.push(Qt.length+1);const e=Dn;return Dn=Qt[e],Qt[e]=r,e}function Ee(r){return Qt[r]}function ya(r){r<132||(Qt[r]=Dn,Dn=r)}function vn(r){const e=Ee(r);return ya(r),e}function Ir(r){return r==null}let In=null;function wa(){return(In===null||In.byteLength===0)&&(In=new Float64Array(de.memory.buffer)),In}let jn=null;function je(){return(jn===null||jn.byteLength===0)&&(jn=new Int32Array(de.memory.buffer)),jn}let rn=0;const lr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},va=typeof lr.encodeInto=="function"?function(r,e){return lr.encodeInto(r,e)}:function(r,e){const t=lr.encode(r);return e.set(t),{read:r.length,written:t.length}};function nr(r,e,t){if(t===void 0){const s=lr.encode(r),a=e(s.length,1)>>>0;return zn().subarray(a,a+s.length).set(s),rn=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=zn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=zn().subarray(o+i,o+n),a=va(r,s);i+=a.written}return rn=i,o}function Jr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=Jr(r[0]));for(let i=1;i<o;i++)l+=", "+Jr(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function $a(r,e){const t=e(r.length*1,1)>>>0;return zn().set(r,t/1),rn=r.length,t}function jr(r,e){try{return r.apply(this,e)}catch(t){de.__wbindgen_exn_store(nt(t))}}class pr{static __wrap(e){e=e>>>0;const t=Object.create(pr.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();de.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=de.__wbindgen_add_to_stack_pointer(-16),i=$a(e,de.__wbindgen_malloc),s=rn;de.jsroutesnapper_new(l,i,s);var t=je()[l/4+0],n=je()[l/4+1],o=je()[l/4+2];if(o)throw vn(n);return pr.__wrap(t)}finally{de.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){de.jsroutesnapper_setRouteConfig(this.__wbg_ptr,nt(e))}setAreaMode(){de.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getConfig(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=je()[n/4+0],t=je()[n/4+1];let o;return e!==0&&(o=Ot(e,t).slice(),de.__wbindgen_free(e,t*1)),o}finally{de.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,t,1)}}toggleSnapMode(){de.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return de.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){de.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return de.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return de.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){de.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_editExisting(o,this.__wbg_ptr,nt(e));var t=je()[o/4+0],n=je()[o/4+1];if(n)throw vn(t)}finally{de.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var n=je()[l/4+0],o=je()[l/4+1];return e=n,t=o,Ot(n,o)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,nt(e));var o=je()[u/4+0],l=je()[u/4+1],i=je()[u/4+2],s=je()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,vn(i);return t=a,n=f,Ot(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){de.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){de.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,nt(e));var o=je()[u/4+0],l=je()[u/4+1],i=je()[u/4+2],s=je()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,vn(i);return t=a,n=f,Ot(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,o;try{const c=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,nt(e),nt(t));var l=je()[c/4+0],i=je()[c/4+1],s=je()[c/4+2],a=je()[c/4+3],f=l,u=i;if(a)throw f=0,u=0,vn(s);return n=f,o=u,Ot(f,u)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,o,1)}}}async function ka(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function La(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ot(e,t);return nt(n)},r.wbg.__wbindgen_object_drop_ref=function(e){vn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ot(e,t));return nt(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Ee(t),o=typeof n=="number"?n:void 0;wa()[e/8+1]=Ir(o)?0:o,je()[e/4+0]=!Ir(o)},r.wbg.__wbindgen_is_object=function(e){const t=Ee(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ee(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Ee(e)in Ee(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Ee(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ee(e)==Ee(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Ee(t),o=typeof n=="string"?n:void 0;var l=Ir(o)?0:nr(o,de.__wbindgen_malloc,de.__wbindgen_realloc),i=rn;je()[e/4+1]=i,je()[e/4+0]=l},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Ee(t)),o=nr(n,de.__wbindgen_malloc,de.__wbindgen_realloc),l=rn;je()[e/4+1]=l,je()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Ee(e);return nt(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Ee(e)[Ee(t)];return nt(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return nt(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ee(t).stack,o=nr(n,de.__wbindgen_malloc,de.__wbindgen_realloc),l=rn;je()[e/4+1]=l,je()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(Ot(e,t))}finally{de.__wbindgen_free(n,o,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ee(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ee(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ee(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ee(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ee(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Ee(e)[t>>>0];return nt(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ee(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ee(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ee(e).next;return nt(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return jr(function(e){const t=Ee(e).next();return nt(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ee(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ee(e).value;return nt(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return nt(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return jr(function(e,t){const n=Reflect.get(Ee(e),Ee(t));return nt(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return jr(function(e,t){const n=Ee(e).call(Ee(t));return nt(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ee(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ee(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ee(e).buffer;return nt(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ee(e));return nt(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Ee(e).set(Ee(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ee(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ee(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Jr(Ee(t)),o=nr(n,de.__wbindgen_malloc,de.__wbindgen_realloc),l=rn;je()[e/4+1]=l,je()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=de.memory;return nt(e)},r}function Sa(r,e){return de=r.exports,Di.__wbindgen_wasm_module=e,In=null,jn=null,Pn=null,de}async function Di(r){if(de!==void 0)return de;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=La();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ka(await r,e);return Sa(t,n)}var bt=63710088e-1,fo={centimeters:bt*100,centimetres:bt*100,degrees:bt/111325,feet:bt*3.28084,inches:bt*39.37,kilometers:bt/1e3,kilometres:bt/1e3,meters:bt,metres:bt,miles:bt/1609.344,millimeters:bt*1e3,millimetres:bt*1e3,nauticalmiles:bt/1852,radians:1,yards:bt*1.0936},Ma={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/bt,yards:1.0936133},Zr={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function zt(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ca(r,e,t){switch(r){case"Point":return kt(e).geometry;case"LineString":return Bt(e).geometry;case"Polygon":return uo(e).geometry;case"MultiPoint":return Hi(e).geometry;case"MultiLineString":return Ui(e).geometry;case"MultiPolygon":return Gi(e).geometry;default:throw new Error(r+" is invalid")}}function kt(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!gr(r[0])||!gr(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return zt(n,e,t)}function Ta(r,e,t){return t===void 0&&(t={}),bn(r.map(function(n){return kt(n,e)}),t)}function uo(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var l=o[n];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<l[l.length-1].length;i++)if(l[l.length-1][i]!==l[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return zt(s,e,t)}function Aa(r,e,t){return t===void 0&&(t={}),bn(r.map(function(n){return uo(n,e)}),t)}function Bt(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return zt(n,e,t)}function Fa(r,e,t){return t===void 0&&(t={}),bn(r.map(function(n){return Bt(n,e)}),t)}function bn(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Ui(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return zt(n,e,t)}function Hi(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return zt(n,e,t)}function Gi(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return zt(n,e,t)}function Ea(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return zt(n,e,t)}function Pa(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function co(r,e){e===void 0&&(e="kilometers");var t=fo[e];if(!t)throw new Error(e+" units is invalid");return r*t}function vr(r,e){e===void 0&&(e="kilometers");var t=fo[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ia(r,e){return qn(vr(r,e))}function ja(r){var e=r%360;return e<0&&(e+=360),e}function qn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Rt(r){var e=r%360;return e*Math.PI/180}function Na(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return co(vr(r,e),t)}function Oa(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Zr[e];if(!n)throw new Error("invalid original units");var o=Zr[t];if(!o)throw new Error("invalid final units");return r/n*o}function gr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function _o(r){return!!r&&r.constructor===Object}function Ba(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!gr(e))throw new Error("bbox must only contain numbers")})}function Ra(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const za=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Zr,bearingToAzimuth:ja,convertArea:Oa,convertLength:Na,degreesToRadians:Rt,earthRadius:bt,factors:fo,feature:zt,featureCollection:bn,geometry:Ca,geometryCollection:Ea,isNumber:gr,isObject:_o,lengthToDegrees:Ia,lengthToRadians:vr,lineString:Bt,lineStrings:Fa,multiLineString:Ui,multiPoint:Hi,multiPolygon:Gi,point:kt,points:Ta,polygon:uo,polygons:Aa,radiansToDegrees:qn,radiansToLength:co,round:Pa,unitsFactors:Ma,validateBBox:Ba,validateId:Ra},Symbol.toStringTag,{value:"Module"}));function Jn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Sn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function An(r,e,t){t===void 0&&(t={});var n=Jn(r),o=Jn(e),l=Rt(o[1]-n[1]),i=Rt(o[0]-n[0]),s=Rt(n[1]),a=Rt(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return co(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function Xn(r,e,t){if(r!==null)for(var n,o,l,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",w=m?r.features.length:1,h=0;h<w;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var y=0;y<s;y++){var v=0,M=0;if(i=_?f.geometries[y]:f,i!==null){a=i.coordinates;var j=i.type;switch(u=t&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(e(a,c,h,v,M)===!1)return!1;c++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,h,v,M)===!1)return!1;c++,j==="MultiPoint"&&v++}j==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-u;o++){if(e(a[n][o],c,h,v,M)===!1)return!1;c++}j==="MultiLineString"&&v++,j==="Polygon"&&M++}j==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(M=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-u;l++){if(e(a[n][o][l],c,h,v,M)===!1)return!1;c++}M++}v++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(Xn(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Da(r,e,t,n){var o=t;return Xn(r,function(l,i,s,a,f){i===0&&t===void 0?o=l:o=e(o,l,i,s,a,f)},n),o}function Wi(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Ua(r,e,t){var n=t;return Wi(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function hr(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Ha(r,e,t){var n=t;return hr(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function Ga(r){var e=[];return Xn(r,function(t){e.push(t)}),e}function mo(r,e){var t,n,o,l,i,s,a,f,u,c,_=0,d=r.type==="FeatureCollection",m=r.type==="Feature",g=d?r.features.length:1;for(t=0;t<g;t++){for(s=d?r.features[t].geometry:m?r.geometry:r,f=d?r.features[t].properties:m?r.properties:{},u=d?r.features[t].bbox:m?r.bbox:void 0,c=d?r.features[t].id:m?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,o=0;o<i;o++){if(l=a?s.geometries[o]:s,l===null){if(e(null,_,f,u,c)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,_,f,u,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(e(l.geometries[n],_,f,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function Wa(r,e,t){var n=t;return mo(r,function(o,l,i,s,a){l===0&&t===void 0?n=o:n=e(n,o,l,i,s,a)}),n}function Cn(r,e){mo(r,function(t,n,o,l,i){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(zt(t,o,{bbox:l,id:i}),n,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var f=0;f<t.coordinates.length;f++){var u=t.coordinates[f],c={type:a,coordinates:u};if(e(zt(c,o),n,f)===!1)return!1}})}function qa(r,e,t){var n=t;return Cn(r,function(o,l,i){l===0&&i===0&&t===void 0?n=o:n=e(n,o,l,i)}),n}function qi(r,e){Cn(r,function(t,n,o){var l=0;if(t.geometry){var i=t.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,f=0,u=0;if(Xn(t,function(c,_,d,m,g){if(s===void 0||n>a||m>f||g>u){s=c,a=n,f=m,u=g,l=0;return}var w=Bt([s,c],t.properties);if(e(w,n,o,g,l)===!1)return!1;l++,s=c})===!1)return!1}}})}function Ja(r,e,t){var n=t,o=!1;return qi(r,function(l,i,s,a,f){o===!1&&t===void 0?n=l:n=e(n,l,i,s,a,f),o=!0}),n}function Ji(r,e){if(!r)throw new Error("geojson is required");Cn(r,function(t,n,o){if(t.geometry!==null){var l=t.geometry.type,i=t.geometry.coordinates;switch(l){case"LineString":if(e(t,n,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Bt(i[s],t.properties),n,o,s)===!1)return!1;break}}})}function Za(r,e,t){var n=t;return Ji(r,function(o,l,i,s){l===0&&t===void 0?n=o:n=e(n,o,l,i,s)}),n}function Ka(r,e){if(e=e||{},!_o(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=a.length+l-1),Bt([a[l],a[l+1]],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l-1),Bt([a[o][l],a[o][l+1]],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l-1),Bt([a[n][l],a[n][l+1]],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l-1),Bt([a[n][o][l],a[n][o][l+1]],i,e)}throw new Error("geojson is invalid")}function Ya(r,e){if(e=e||{},!_o(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return kt(a,i,e);case"MultiPoint":return n<0&&(n=a.length+n),kt(a[n],i,e);case"LineString":return l<0&&(l=a.length+l),kt(a[l],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l),kt(a[o][l],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l),kt(a[n][l],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l),kt(a[n][o][l],i,e)}throw new Error("geojson is invalid")}const Xa=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Ga,coordEach:Xn,coordReduce:Da,featureEach:hr,featureReduce:Ha,findPoint:Ya,findSegment:Ka,flattenEach:Cn,flattenReduce:qa,geomEach:mo,geomReduce:Wa,lineEach:Ji,lineReduce:Za,propEach:Wi,propReduce:Ua,segmentEach:qi,segmentReduce:Ja},Symbol.toStringTag,{value:"Module"}));function Zi(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Va(r,e);var n=Jn(r),o=Jn(e),l=Rt(n[0]),i=Rt(o[0]),s=Rt(n[1]),a=Rt(o[1]),f=Math.sin(i-l)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return qn(Math.atan2(f,u))}function Va(r,e){var t=Zi(e,r);return t=(t+180)%360,t}function zo(r,e,t,n){n===void 0&&(n={});var o=Jn(r),l=Rt(o[0]),i=Rt(o[1]),s=Rt(t),a=vr(e,n.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=qn(u),_=qn(f);return kt([c,_],n.properties)}function Do(r){if(!r)throw new Error("geojson is required");var e=[];return Cn(r,function(t){Qa(t,e)}),bn(e)}function Qa(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Sn(n);break;case"LineString":t=[Sn(n)]}t.forEach(function(o){var l=xa(o,r.properties);l.forEach(function(i){i.id=e.length,e.push(i)})})}}function xa(r,e){var t=[];return r.reduce(function(n,o){var l=Bt([n,o],e);return l.bbox=ef(n,o),t.push(l),o}),t}function ef(r,e){var t=r[0],n=r[1],o=e[0],l=e[1],i=t<o?t:o,s=n<l?n:l,a=t>o?t:o,f=n>l?n:l;return[i,s,a,f]}var po={exports:{}},Ki={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(zs,function(){function t(y,v,M,j,P){(function I(R,B,D,z,N){for(;z>D;){if(z-D>600){var U=z-D+1,G=B-D+1,K=Math.log(U),Z=.5*Math.exp(2*K/3),te=.5*Math.sqrt(K*Z*(U-Z)/U)*(G-U/2<0?-1:1),H=Math.max(D,Math.floor(B-G*Z/U+te)),ve=Math.min(z,Math.floor(B+(U-G)*Z/U+te));I(R,B,H,ve,N)}var ge=R[B],le=D,ue=z;for(n(R,D,B),N(R[z],ge)>0&&n(R,D,z);le<ue;){for(n(R,le,ue),le++,ue--;N(R[le],ge)<0;)le++;for(;N(R[ue],ge)>0;)ue--}N(R[D],ge)===0?n(R,D,ue):n(R,++ue,z),ue<=B&&(D=ue+1),B<=ue&&(z=ue-1)}})(y,v,M||0,j||y.length-1,P||o)}function n(y,v,M){var j=y[v];y[v]=y[M],y[M]=j}function o(y,v){return y<v?-1:y>v?1:0}var l=function(y){y===void 0&&(y=9),this._maxEntries=Math.max(4,y),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(y,v,M){if(!M)return v.indexOf(y);for(var j=0;j<v.length;j++)if(M(y,v[j]))return j;return-1}function s(y,v){a(y,0,y.children.length,v,y)}function a(y,v,M,j,P){P||(P=w(null)),P.minX=1/0,P.minY=1/0,P.maxX=-1/0,P.maxY=-1/0;for(var I=v;I<M;I++){var R=y.children[I];f(P,y.leaf?j(R):R)}return P}function f(y,v){return y.minX=Math.min(y.minX,v.minX),y.minY=Math.min(y.minY,v.minY),y.maxX=Math.max(y.maxX,v.maxX),y.maxY=Math.max(y.maxY,v.maxY),y}function u(y,v){return y.minX-v.minX}function c(y,v){return y.minY-v.minY}function _(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function d(y){return y.maxX-y.minX+(y.maxY-y.minY)}function m(y,v){return y.minX<=v.minX&&y.minY<=v.minY&&v.maxX<=y.maxX&&v.maxY<=y.maxY}function g(y,v){return v.minX<=y.maxX&&v.minY<=y.maxY&&v.maxX>=y.minX&&v.maxY>=y.minY}function w(y){return{children:y,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function h(y,v,M,j,P){for(var I=[v,M];I.length;)if(!((M=I.pop())-(v=I.pop())<=j)){var R=v+Math.ceil((M-v)/j/2)*j;t(y,R,v,M,P),I.push(v,R,R,M)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(y){var v=this.data,M=[];if(!g(y,v))return M;for(var j=this.toBBox,P=[];v;){for(var I=0;I<v.children.length;I++){var R=v.children[I],B=v.leaf?j(R):R;g(y,B)&&(v.leaf?M.push(R):m(y,B)?this._all(R,M):P.push(R))}v=P.pop()}return M},l.prototype.collides=function(y){var v=this.data;if(!g(y,v))return!1;for(var M=[];v;){for(var j=0;j<v.children.length;j++){var P=v.children[j],I=v.leaf?this.toBBox(P):P;if(g(y,I)){if(v.leaf||m(y,I))return!0;M.push(P)}}v=M.pop()}return!1},l.prototype.load=function(y){if(!y||!y.length)return this;if(y.length<this._minEntries){for(var v=0;v<y.length;v++)this.insert(y[v]);return this}var M=this._build(y.slice(),0,y.length-1,0);if(this.data.children.length)if(this.data.height===M.height)this._splitRoot(this.data,M);else{if(this.data.height<M.height){var j=this.data;this.data=M,M=j}this._insert(M,this.data.height-M.height-1,!0)}else this.data=M;return this},l.prototype.insert=function(y){return y&&this._insert(y,this.data.height-1),this},l.prototype.clear=function(){return this.data=w([]),this},l.prototype.remove=function(y,v){if(!y)return this;for(var M,j,P,I=this.data,R=this.toBBox(y),B=[],D=[];I||B.length;){if(I||(I=B.pop(),j=B[B.length-1],M=D.pop(),P=!0),I.leaf){var z=i(y,I.children,v);if(z!==-1)return I.children.splice(z,1),B.push(I),this._condense(B),this}P||I.leaf||!m(I,R)?j?(M++,I=j.children[M],P=!1):I=null:(B.push(I),D.push(M),M=0,j=I,I=I.children[0])}return this},l.prototype.toBBox=function(y){return y},l.prototype.compareMinX=function(y,v){return y.minX-v.minX},l.prototype.compareMinY=function(y,v){return y.minY-v.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(y){return this.data=y,this},l.prototype._all=function(y,v){for(var M=[];y;)y.leaf?v.push.apply(v,y.children):M.push.apply(M,y.children),y=M.pop();return v},l.prototype._build=function(y,v,M,j){var P,I=M-v+1,R=this._maxEntries;if(I<=R)return s(P=w(y.slice(v,M+1)),this.toBBox),P;j||(j=Math.ceil(Math.log(I)/Math.log(R)),R=Math.ceil(I/Math.pow(R,j-1))),(P=w([])).leaf=!1,P.height=j;var B=Math.ceil(I/R),D=B*Math.ceil(Math.sqrt(R));h(y,v,M,D,this.compareMinX);for(var z=v;z<=M;z+=D){var N=Math.min(z+D-1,M);h(y,z,N,B,this.compareMinY);for(var U=z;U<=N;U+=B){var G=Math.min(U+B-1,N);P.children.push(this._build(y,U,G,j-1))}}return s(P,this.toBBox),P},l.prototype._chooseSubtree=function(y,v,M,j){for(;j.push(v),!v.leaf&&j.length-1!==M;){for(var P=1/0,I=1/0,R=void 0,B=0;B<v.children.length;B++){var D=v.children[B],z=_(D),N=(U=y,G=D,(Math.max(G.maxX,U.maxX)-Math.min(G.minX,U.minX))*(Math.max(G.maxY,U.maxY)-Math.min(G.minY,U.minY))-z);N<I?(I=N,P=z<P?z:P,R=D):N===I&&z<P&&(P=z,R=D)}v=R||v.children[0]}var U,G;return v},l.prototype._insert=function(y,v,M){var j=M?y:this.toBBox(y),P=[],I=this._chooseSubtree(j,this.data,v,P);for(I.children.push(y),f(I,j);v>=0&&P[v].children.length>this._maxEntries;)this._split(P,v),v--;this._adjustParentBBoxes(j,P,v)},l.prototype._split=function(y,v){var M=y[v],j=M.children.length,P=this._minEntries;this._chooseSplitAxis(M,P,j);var I=this._chooseSplitIndex(M,P,j),R=w(M.children.splice(I,M.children.length-I));R.height=M.height,R.leaf=M.leaf,s(M,this.toBBox),s(R,this.toBBox),v?y[v-1].children.push(R):this._splitRoot(M,R)},l.prototype._splitRoot=function(y,v){this.data=w([y,v]),this.data.height=y.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(y,v,M){for(var j,P,I,R,B,D,z,N=1/0,U=1/0,G=v;G<=M-v;G++){var K=a(y,0,G,this.toBBox),Z=a(y,G,M,this.toBBox),te=(P=K,I=Z,R=void 0,B=void 0,D=void 0,z=void 0,R=Math.max(P.minX,I.minX),B=Math.max(P.minY,I.minY),D=Math.min(P.maxX,I.maxX),z=Math.min(P.maxY,I.maxY),Math.max(0,D-R)*Math.max(0,z-B)),H=_(K)+_(Z);te<N?(N=te,j=G,U=H<U?H:U):te===N&&H<U&&(U=H,j=G)}return j||M-v},l.prototype._chooseSplitAxis=function(y,v,M){var j=y.leaf?this.compareMinX:u,P=y.leaf?this.compareMinY:c;this._allDistMargin(y,v,M,j)<this._allDistMargin(y,v,M,P)&&y.children.sort(j)},l.prototype._allDistMargin=function(y,v,M,j){y.children.sort(j);for(var P=this.toBBox,I=a(y,0,v,P),R=a(y,M-v,M,P),B=d(I)+d(R),D=v;D<M-v;D++){var z=y.children[D];f(I,y.leaf?P(z):z),B+=d(I)}for(var N=M-v-1;N>=v;N--){var U=y.children[N];f(R,y.leaf?P(U):U),B+=d(R)}return B},l.prototype._adjustParentBBoxes=function(y,v,M){for(var j=M;j>=0;j--)f(v[j],y)},l.prototype._condense=function(y){for(var v=y.length-1,M=void 0;v>=0;v--)y[v].children.length===0?v>0?(M=y[v-1].children).splice(M.indexOf(y[v]),1):this.clear():s(y[v],this.toBBox)},l})})(Ki);var tf=Ki.exports;const nf=no(za),rf=no(Xa);function Yi(r,e,t){if(r!==null)for(var n,o,l,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",w=m?r.features.length:1,h=0;h<w;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var y=0;y<s;y++){var v=0,M=0;if(i=_?f.geometries[y]:f,i!==null){a=i.coordinates;var j=i.type;switch(u=t&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(e(a,c,h,v,M)===!1)return!1;c++,v++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,h,v,M)===!1)return!1;c++,j==="MultiPoint"&&v++}j==="LineString"&&v++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-u;o++){if(e(a[n][o],c,h,v,M)===!1)return!1;c++}j==="MultiLineString"&&v++,j==="Polygon"&&M++}j==="Polygon"&&v++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(M=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-u;l++){if(e(a[n][o][l],c,h,v,M)===!1)return!1;c++}M++}v++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(Yi(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Xi(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Yi(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var of=Xi;const lf=Object.freeze(Object.defineProperty({__proto__:null,bbox:Xi,default:of},Symbol.toStringTag,{value:"Module"})),sf=no(lf);var Zt=tf,Vi=nf,Qi=rf,wn=sf.default,af=Qi.featureEach;Qi.coordEach;Vi.polygon;var Uo=Vi.featureCollection;function xi(r){var e=new Zt(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:wn(t),Zt.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:wn(o),n.push(o)}):af(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:wn(o),n.push(o)}),Zt.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:wn(t),Zt.prototype.remove.call(this,t,n)},e.clear=function(){return Zt.prototype.clear.call(this)},e.search=function(t){var n=Zt.prototype.search.call(this,this.toBBox(t));return Uo(n)},e.collides=function(t){return Zt.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Zt.prototype.all.call(this);return Uo(t)},e.toJSON=function(){return Zt.prototype.toJSON.call(this)},e.fromJSON=function(t){return Zt.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=wn(t);else if(t.type==="FeatureCollection")n=wn(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}po.exports=xi;po.exports.default=xi;var ff=po.exports;const uf=Ds(ff);function cf(r,e){var t={},n=[];if(r.type==="LineString"&&(r=zt(r)),e.type==="LineString"&&(e=zt(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=Ho(r,e);return o&&n.push(o),bn(n)}var l=uf();return l.load(Do(e)),hr(Do(r),function(i){hr(l.search(i),function(s){var a=Ho(i,s);if(a){var f=Sn(a).join(",");t[f]||(t[f]=!0,n.push(a))}})}),bn(n)}function Ho(r,e){var t=Sn(r),n=Sn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],l=t[0][1],i=t[1][0],s=t[1][1],a=n[0][0],f=n[0][1],u=n[1][0],c=n[1][1],_=(c-f)*(i-o)-(u-a)*(s-l),d=(u-a)*(l-f)-(c-f)*(o-a),m=(i-o)*(l-f)-(s-l)*(o-a);if(_===0)return null;var g=d/_,w=m/_;if(g>=0&&g<=1&&w>=0&&w<=1){var h=o+g*(i-o),y=l+g*(s-l);return kt([h,y])}return null}function df(r,e,t){t===void 0&&(t={});var n=kt([1/0,1/0],{dist:1/0}),o=0;return Cn(r,function(l){for(var i=Sn(l),s=0;s<i.length-1;s++){var a=kt(i[s]);a.properties.dist=An(e,a,t);var f=kt(i[s+1]);f.properties.dist=An(e,f,t);var u=An(a,f,t),c=Math.max(a.properties.dist,f.properties.dist),_=Zi(a,f),d=zo(e,c,_+90,t),m=zo(e,c,_-90,t),g=cf(Bt([d.geometry.coordinates,m.geometry.coordinates]),Bt([a.geometry.coordinates,f.geometry.coordinates])),w=null;g.features.length>0&&(w=g.features[0],w.properties.dist=An(e,w,t),w.properties.location=o+An(a,w,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=s,n.properties.location=o),f.properties.dist<n.properties.dist&&(n=f,n.properties.index=s+1,n.properties.location=o+u),w&&w.properties.dist<n.properties.dist&&(n=w,n.properties.index=s),o+=u}}),n}const _f=30;class mf{constructor(e,t,n,o,l){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-_f,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new pr(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}function Go(r){let e,t;return e=new wr({props:{$$slots:{default:[pf,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function pf(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;function g(){return r[1](r[3])}return{c(){e=$("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=C(),n=$("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,o=C(),l=$("p"),l.textContent="To use this tool, you need to:",i=C(),s=$("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=C(),f=$("p"),f.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,u=C(),c=$("center"),_=$("button"),_.textContent="Start!"},m(w,h){k(w,e,h),k(w,t,h),k(w,n,h),k(w,o,h),k(w,l,h),k(w,i,h),k(w,s,h),k(w,a,h),k(w,f,h),k(w,u,h),k(w,c,h),p(c,_),d||(m=X(_,"click",g),d=!0)},p(w,h){r=w},d(w){w&&(L(e),L(t),L(n),L(o),L(l),L(i),L(s),L(a),L(f),L(u),L(c)),d=!1,m()}}}function gf(r){let e,t,n=r[0]&&Go(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=Go(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function hf(r,e,t){let n;return V(r,ur,i=>t(0,n=i)),[n,i=>dt(i).close(),()=>x(ur,n=!1,n)]}class bf extends ie{constructor(e){super(),se(this,e,hf,gf,re,{})}}function yf(r){let e;const t=r[16].default,n=Be(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Re(n,t,o,o[24],e?De(t,o[24],l,null):ze(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function wf(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[yf]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Pi({props:l}),Ge.push(()=>pt(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],gt(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function vf(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=ro("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:h=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:M=!0}=e;function j(N){y=N,t(0,y)}function P(N){Ne.call(this,r,N)}function I(N){Ne.call(this,r,N)}function R(N){Ne.call(this,r,N)}function B(N){Ne.call(this,r,N)}function D(N){Ne.call(this,r,N)}function z(N){Ne.call(this,r,N)}return r.$$set=N=>{"id"in N&&t(1,l=N.id),"source"in N&&t(2,i=N.source),"sourceLayer"in N&&t(3,s=N.sourceLayer),"beforeId"in N&&t(4,a=N.beforeId),"beforeLayerType"in N&&t(5,f=N.beforeLayerType),"paint"in N&&t(6,u=N.paint),"layout"in N&&t(7,c=N.layout),"filter"in N&&t(8,_=N.filter),"applyToClusters"in N&&t(9,d=N.applyToClusters),"minzoom"in N&&t(10,m=N.minzoom),"maxzoom"in N&&t(11,g=N.maxzoom),"hoverCursor"in N&&t(12,w=N.hoverCursor),"manageHoverState"in N&&t(13,h=N.manageHoverState),"hovered"in N&&t(0,y=N.hovered),"eventsIfTopMost"in N&&t(14,v=N.eventsIfTopMost),"interactive"in N&&t(15,M=N.interactive),"$$scope"in N&&t(24,o=N.$$scope)},[y,l,i,s,a,f,u,c,_,d,m,g,w,h,v,M,n,j,P,I,R,B,D,z,o]}let un=class extends ie{constructor(e){super(),se(this,e,vf,wf,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function $f(r){let e,t;const n=r[7].default,o=Be(n,r,r[6],null);return{c(){e=$("div"),o&&o.c(),E(e,"class",r[1]),mt(e,"maplibregl-ctrl",r[0])},m(l,i){k(l,e,i),o&&o.m(e,null),r[8](e),t=!0},p(l,[i]){o&&o.p&&(!t||i&64)&&Re(o,n,l,l[6],t?De(n,l[6],i,null):ze(l[6]),null),(!t||i&2)&&E(e,"class",l[1]),(!t||i&3)&&mt(e,"maplibregl-ctrl",l[0])},i(l){t||(b(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&L(e),o&&o.d(l),r[8](null)}}}function kf(r,e,t){let n,{$$slots:o={},$$scope:l}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:f}=oo();V(r,f,d=>t(5,n=d));let u,c={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Mt(()=>{n==null||n.removeControl(c)});function _(d){Ge[d?"unshift":"push"](()=>{u=d,t(2,u)})}return r.$$set=d=>{"defaultStyling"in d&&t(0,i=d.defaultStyling),"position"in d&&t(4,s=d.position),"class"in d&&t(1,a=d.class),"$$scope"in d&&t(6,l=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&u&&n.addControl(c,s)},[i,a,u,f,s,n,l,o,_]}class Lf extends ie{constructor(e){super(),se(this,e,kf,$f,re,{defaultStyling:0,position:4,class:1})}}function Sf(r,e,t){let n;const o=fn();let{layer:l=void 0}=e;const{map:i}=oo();V(r,i,u=>t(2,n=u));function s(u){o(u.type,{...u,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Mt(()=>{if(n)if(l)for(const u of a)n.off(u,l,s);else for(const u of f)n.off(u,s)}),r.$$set=u=>{"layer"in u&&t(1,l=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(l)for(const u of a)n.on(u,l,s);else for(const u of f)n.on(u,s)},[i,l,n]}class es extends ie{constructor(e){super(),se(this,e,Sf,null,re,{layer:1})}}const Mf=r=>({marker:r&8}),Wo=r=>({marker:r[3]});function Cf(r){let e,t,n,o,l,i,s;const a=r[19].default,f=Be(a,r,r[18],Wo);return{c(){e=$("div"),f&&f.c(),E(e,"tabindex",t=r[1]?0:void 0),E(e,"role",n=r[1]?"button":void 0),ae(e,"z-index",r[2])},m(u,c){k(u,e,c),f&&f.m(e,null),l=!0,i||(s=[bo(r[7].call(null,e)),bo(o=Tf.call(null,e,r[0])),X(e,"click",Pr(r[20])),X(e,"dblclick",Pr(r[21])),X(e,"contextmenu",Pr(Ii(r[22]))),X(e,"mouseenter",r[23]),X(e,"mouseleave",r[24]),X(e,"mousemove",r[25]),X(e,"keydown",r[8])],i=!0)},p(u,[c]){f&&f.p&&(!l||c&262152)&&Re(f,a,u,u[18],l?De(a,u[18],c,Mf):ze(u[18]),Wo),(!l||c&2&&t!==(t=u[1]?0:void 0))&&E(e,"tabindex",t),(!l||c&2&&n!==(n=u[1]?"button":void 0))&&E(e,"role",n),o&&Dr(o.update)&&c&1&&o.update.call(null,u[0]),c&4&&ae(e,"z-index",u[2])},i(u){l||(b(f,u),l=!0)},o(u){S(f,u),l=!1},d(u){u&&L(e),f&&f.d(u),i=!1,rt(s)}}}function Tf(r,e){const t=r.className;function n(o){o?r.className=`${t} ${o}`:r.className=t}return n(e),{update:n}}function Af(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:f}=e,{class:u=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:m=null}=e,{offset:g=void 0}=e,{zIndex:w=void 0}=e,{rotation:h=0}=e,{opacity:y=1}=e;const v=fn(),{map:M,layerEvent:j,self:P,markerClickManager:I}=Us();V(r,M,H=>t(27,l=H)),V(r,j,H=>t(26,n=H)),V(r,P,H=>t(3,o=H));function R(H){x(P,o=new Kt.Marker({element:H,rotation:h,draggable:d,offset:g,opacity:y.toString()}).setLngLat(f).addTo(l),o),t(11,a=o);const ve=()=>z("dragstart"),ge=()=>{B(),z("drag")},le=()=>{B(),z("dragend")};return d&&(o.on("dragstart",ve),o.on("drag",ge),o.on("dragend",le)),{destroy(){d&&(o==null||o.off("dragstart",ve),o==null||o.off("drag",ge),o==null||o.off("dragend",le)),t(11,a=void 0),o==null||o.remove()}}}function B(){let H=o==null?void 0:o.getLngLat();H&&(Array.isArray(f)?t(10,f=[H.lng,H.lat]):f&&"lon"in f?t(10,f={lon:H.lng,lat:H.lat}):t(10,f=H))}function D(H){H.key===" "&&(H.preventDefault(),H.stopPropagation(),z("click"))}function z(H){if(!c)return;let ve=o==null?void 0:o.getLngLat();if(!ve)return;const ge=[ve.lng,ve.lat];let le={map:l,marker:o,lngLat:ge,features:[{type:"Feature",properties:(m==null?void 0:m.properties)??{},geometry:{type:"Point",coordinates:ge}}]};(H==="click"||H==="contextmenu")&&I.handleClick(le),x(j,n={...le,layerType:"marker",type:H},n),v(H,le)}const N=()=>z("click"),U=()=>z("dblclick"),G=()=>{z("contextmenu")},K=()=>{z("mouseenter")},Z=()=>{z("mouseleave")},te=()=>z("mousemove");return r.$$set=H=>{"marker"in H&&t(11,a=H.marker),"lngLat"in H&&t(10,f=H.lngLat),"class"in H&&t(0,u=H.class),"interactive"in H&&t(12,c=H.interactive),"asButton"in H&&t(1,_=H.asButton),"draggable"in H&&t(13,d=H.draggable),"feature"in H&&t(14,m=H.feature),"offset"in H&&t(15,g=H.offset),"zIndex"in H&&t(2,w=H.zIndex),"rotation"in H&&t(16,h=H.rotation),"opacity"in H&&t(17,y=H.opacity),"$$scope"in H&&t(18,s=H.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(o==null||o.setLngLat(f)),r.$$.dirty&32776&&(o==null||o.setOffset(g??[0,0])),r.$$.dirty&65544&&(o==null||o.setRotation(h)),r.$$.dirty&131080&&(o==null||o.setOpacity(y.toString()))},[u,_,w,o,M,j,P,R,D,z,f,a,c,d,m,g,h,y,s,i,N,U,G,K,Z,te]}class $r extends ie{constructor(e){super(),se(this,e,Af,Cf,re,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Ff=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),qo=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function Jo(r){var o;let e,t,n=(((o=r[4])==null?void 0:o.length)||r[3]instanceof Kt.Marker)&&Zo(r);return{c(){e=$("div"),n&&n.c()},m(l,i){k(l,e,i),n&&n.m(e,null),r[32](e),t=!0},p(l,i){var s;(s=l[4])!=null&&s.length||l[3]instanceof Kt.Marker?n?(n.p(l,i),i[0]&24&&b(n,1)):(n=Zo(l),n.c(),b(n,1),n.m(e,null)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(l){t||(b(n),t=!0)},o(l){S(n),t=!1},d(l){l&&L(e),n&&n.d(),r[32](null)}}}function Zo(r){let e;const t=r[30].default,n=Be(t,r,r[29],qo);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[0]&536870933)&&Re(n,t,o,o[29],e?De(t,o[29],l,Ff):ze(o[29]),qo)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Ef(r){let e,t,n=r[9].default&&Jo(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,l){o[9].default?n?(n.p(o,l),l[0]&512&&b(n,1)):(n=Jo(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function Pf(r,e,t){let n,o,l,i,s,a,{$$slots:f={},$$scope:u}=e;const c=Hs(f);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:m=!1}=e,{closeOnMove:g=!1}=e,{openOn:w="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:y=!0}=e,{anchor:v=void 0}=e,{offset:M=void 0}=e,{popupClass:j=void 0}=e,{maxWidth:P=void 0}=e,{lngLat:I=void 0}=e,{html:R=void 0}=e,{open:B=!1}=e;const D=fn(),{map:z,popupTarget:N,layerEvent:U,layer:G,eventTopMost:K,markerClickManager:Z}=oo();V(r,z,W=>t(2,l=W)),V(r,N,W=>t(3,s=W)),V(r,U,W=>t(28,i=W)),V(r,G,W=>t(35,a=W));const te=["click","dblclick","contextmenu"];let H,ve=!1,ge;function le(){if(!H)return;let W=H.getElement();!W||W===ge||(ge=W,w==="hover"&&(ge.style.pointerEvents="none"),ge.addEventListener("mouseenter",()=>{t(24,ve=!0)},{passive:!0}),ge.addEventListener("mouseleave",()=>{t(24,ve=!1)},{passive:!0}),ge.addEventListener("click",()=>{m&&t(0,B=!1)},{passive:!0}))}yr(()=>{if(l)return l.on("click",he),l.on("contextmenu",he),Z.add(Q),typeof s=="string"&&(l.on("click",s,Fe),l.on("dblclick",s,Fe),l.on("contextmenu",s,Fe),l.on("mousemove",s,ne),l.on("mouseleave",s,It),l.on("touchstart",s,Ae),l.on("touchend",s,ft)),()=>{l!=null&&l.loaded()&&(H==null||H.remove(),l.off("click",he),l.off("contextmenu",he),Z.remove(Q),s instanceof Kt.Marker?s.getPopup()===H&&s.setPopup(void 0):typeof s=="string"&&(l.off("click",s,Fe),l.off("dblclick",s,Fe),l.off("contextmenu",s,Fe),l.off("mousemove",s,ne),l.off("mouseleave",s,It),l.off("touchstart",s,Ae),l.off("touchend",s,ft)))}});function ue(W){return h?!("marker"in W)&&!Gs(W)&&K(W)!==a:!1}let me=null,_e="normal";function Se(W){"layerType"in W&&W.layerType==="deckgl"?(t(10,I=W.coordinate),t(4,me=W.object?[W.object]:null)):(t(10,I=W.lngLat),t(4,me=W.features??[]))}function Fe(W){W.type!==w||ue(W)||(Se(W),setTimeout(()=>t(0,B=!0)))}let ce=null;function Ae(W){ce=W.point}function ft(W){if(!ce||w!=="hover")return;let lt=ce.dist(W.point);ce=null,lt<3&&(t(10,I=W.lngLat),t(4,me=W.features??[]),H.isOpen()?t(25,_e="justOpened"):(t(25,_e="opening"),t(0,B=!0)))}function It(W){w!=="hover"||ce||_e!=="normal"||(t(0,B=!1),t(4,me=null))}function ne(W){if(!(w!=="hover"||ce||_e!=="normal")){if(ue(W)){t(0,B=!1),t(4,me=null);return}t(0,B=!0),t(4,me=W.features??[]),t(10,I=W.lngLat)}}function he(W){if(_e==="justOpened"){t(25,_e="normal");return}if(!d)return;let lt=[ge,s instanceof Kt.Marker?s==null?void 0:s.getElement():null];B&&H.isOpen()&&!lt.some(Oe=>Oe==null?void 0:Oe.contains(W.originalEvent.target))&&(W.type==="contextmenu"&&w==="contextmenu"||W.type!=="contextmenu")&&t(0,B=!1)}function Q(W){d&&B&&H.isOpen()&&W.marker!==s&&t(0,B=!1)}Mt(()=>{l&&(H!=null&&H.isOpen())&&H.remove()});let Ce;const we=()=>t(0,B=!1);function $e(W){Ge[W?"unshift":"push"](()=>{Ce=W,t(1,Ce)})}return r.$$set=W=>{"closeButton"in W&&t(11,_=W.closeButton),"closeOnClickOutside"in W&&t(12,d=W.closeOnClickOutside),"closeOnClickInside"in W&&t(13,m=W.closeOnClickInside),"closeOnMove"in W&&t(14,g=W.closeOnMove),"openOn"in W&&t(15,w=W.openOn),"openIfTopMost"in W&&t(16,h=W.openIfTopMost),"focusAfterOpen"in W&&t(17,y=W.focusAfterOpen),"anchor"in W&&t(18,v=W.anchor),"offset"in W&&t(19,M=W.offset),"popupClass"in W&&t(20,j=W.popupClass),"maxWidth"in W&&t(21,P=W.maxWidth),"lngLat"in W&&t(10,I=W.lngLat),"html"in W&&t(22,R=W.html),"open"in W&&t(0,B=W.open),"$$scope"in W&&t(29,u=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=_??(!d&&!m)),r.$$.dirty[0]&146685952&&(H||(t(23,H=new Kt.Popup({closeButton:n,closeOnClick:!1,closeOnMove:g,focusAfterOpen:y,maxWidth:P,className:j,anchor:v,offset:M})),ge=H.getElement(),H.on("open",()=>{t(0,B=!0),le(),D("open",H)}),H.on("close",()=>{t(0,B=!1),D("close",H)}),H.on("hover",()=>{D("hover",H)}))),r.$$.dirty[0]&8421384&&H&&s instanceof Kt.Marker&&(w==="click"?s.setPopup(H):s.getPopup()===H&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&te.includes(w)&&(i==null?void 0:i.type)===w&&(Fe(i),x(U,i=null,i)),r.$$.dirty[0]&268468224&&t(26,o=w==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&w==="hover"&&U&&(o&&i&&Se(i),t(0,B=(o||ve)??!1)),r.$$.dirty[0]&12582914&&(Ce?H.setDOMContent(Ce):R&&H.setHTML(R)),r.$$.dirty[0]&8389632&&I&&H.setLngLat(I),r.$$.dirty[0]&41943045&&l){let W=H.isOpen();B&&!W?(H.addTo(l),_e==="opening"&&t(25,_e="justOpened")):!B&&W&&H.remove()}},[B,Ce,l,s,me,z,N,U,G,c,I,_,d,m,g,w,h,y,v,M,j,P,R,H,ve,_e,o,n,i,u,f,we,$e]}class If extends ie{constructor(e){super(),se(this,e,Pf,Ef,re,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function jf(r){let e;const t=r[16].default,n=Be(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Re(n,t,o,o[24],e?De(t,o[24],l,null):ze(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Nf(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[jf]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Pi({props:l}),Ge.push(()=>pt(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],gt(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Of(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=ro("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:h=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:M=!0}=e;function j(N){y=N,t(0,y)}function P(N){Ne.call(this,r,N)}function I(N){Ne.call(this,r,N)}function R(N){Ne.call(this,r,N)}function B(N){Ne.call(this,r,N)}function D(N){Ne.call(this,r,N)}function z(N){Ne.call(this,r,N)}return r.$$set=N=>{"id"in N&&t(1,l=N.id),"source"in N&&t(2,i=N.source),"sourceLayer"in N&&t(3,s=N.sourceLayer),"beforeId"in N&&t(4,a=N.beforeId),"beforeLayerType"in N&&t(5,f=N.beforeLayerType),"paint"in N&&t(6,u=N.paint),"layout"in N&&t(7,c=N.layout),"filter"in N&&t(8,_=N.filter),"applyToClusters"in N&&t(9,d=N.applyToClusters),"minzoom"in N&&t(10,m=N.minzoom),"maxzoom"in N&&t(11,g=N.maxzoom),"hoverCursor"in N&&t(12,w=N.hoverCursor),"manageHoverState"in N&&t(13,h=N.manageHoverState),"hovered"in N&&t(0,y=N.hovered),"eventsIfTopMost"in N&&t(14,v=N.eventsIfTopMost),"interactive"in N&&t(15,M=N.interactive),"$$scope"in N&&t(24,o=N.$$scope)},[y,l,i,s,a,f,u,c,_,d,m,g,w,h,v,M,n,j,P,I,R,B,D,z,o]}class br extends ie{constructor(e){super(),se(this,e,Of,Nf,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Ko(r){let e=r[0],t,n,o=Yo(r);return{c(){o.c(),t=Ze()},m(l,i){o.m(l,i),k(l,t,i),n=!0},p(l,i){i&1&&re(e,e=l[0])?(be(),S(o,1,1,Y),ye(),o=Yo(l),o.c(),b(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(b(o),n=!0)},o(l){S(o),n=!1},d(l){l&&L(t),o.d(l)}}}function Yo(r){let e;const t=r[15].default,n=Be(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Re(n,t,o,o[14],e?De(t,o[14],l,null):ze(o[14]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Bf(r){let e,t,n=r[0]&&Ko(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=Ko(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function Rf(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e,{id:s=ro("vector")}=e,{url:a=null}=e,{tiles:f=null}=e,{promoteId:u=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:m=null}=e,{maxzoom:g=null}=e,{volatile:w=null}=e;if(a&&a.includes("pmtiles://")&&!Kt.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let M=new Zs;Kt.addProtocol("pmtiles",M.tile)}const{map:h,self:y}=Ws();V(r,h,M=>t(13,o=M)),V(r,y,M=>t(0,n=M));let v;return Mt(()=>{n&&o&&(qs(h,n,v),x(y,n=null,n),v=void 0)}),r.$$set=M=>{"id"in M&&t(3,s=M.id),"url"in M&&t(4,a=M.url),"tiles"in M&&t(5,f=M.tiles),"promoteId"in M&&t(6,u=M.promoteId),"bounds"in M&&t(7,c=M.bounds),"scheme"in M&&t(8,_=M.scheme),"attribution"in M&&t(9,d=M.attribution),"minzoom"in M&&t(10,m=M.minzoom),"maxzoom"in M&&t(11,g=M.maxzoom),"volatile"in M&&t(12,w=M.volatile),"$$scope"in M&&t(14,i=M.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&o&&n!==s&&(x(y,n=s,n),Js(o,n,cr({type:"vector",url:a,tiles:f,promoteId:u,bounds:c,scheme:_,attribution:d,minzoom:m,maxzoom:g,volatile:w}),M=>o&&M===n,()=>{n&&(v=o==null?void 0:o.getSource(n))})),r.$$.dirty&8200&&(o==null||o.on("style.load",()=>{v=o==null?void 0:o.getSource(s)}))},[n,h,y,s,a,f,u,c,_,d,m,g,w,o,i,l]}class kr extends ie{constructor(e){super(),se(this,e,Rf,Bf,re,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const zf="/ltn/assets/layers-03647595.svg";function Df(r){let e,t,n,o,l,i,s,a,f;return{c(){e=$("label"),t=O(`Basemap:
  `),n=$("select"),o=$("option"),o.textContent="MapTiler Dataviz",l=$("option"),l.textContent="MapTiler Streets",i=$("option"),i.textContent="MapTiler Satellite",s=$("option"),s.textContent="OS Open Zoomstack",o.__value="dataviz",qe(o,o.__value),l.__value="streets-v2",qe(l,l.__value),i.__value="hybrid",qe(i,i.__value),s.__value="uk-openzoomstack-light",qe(s,s.__value),r[0]===void 0&&pn(()=>r[1].call(n))},m(u,c){k(u,e,c),p(e,t),p(e,n),p(n,o),p(n,l),p(n,i),p(n,s),$t(n,r[0],!0),a||(f=X(n,"change",r[1]),a=!0)},p(u,[c]){c&1&&$t(n,u[0])},i:Y,o:Y,d(u){u&&L(e),a=!1,f()}}}function Uf(r,e,t){let n;V(r,Ur,l=>t(0,n=l));function o(){n=gn(this),Ur.set(n)}return[n,o]}class Hf extends ie{constructor(e){super(),se(this,e,Uf,Df,re,{})}}let ir=St(!0);function Gf(r){let e,t;return e=new Ct({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.layout={visibility:n[0]?"none":"visible"}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Wf(r){let e,t;return e=new Ke({props:{data:r[1],$$slots:{default:[Gf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function qf(r,e,t){let n;return V(r,ir,l=>t(0,n=l)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class Jf extends ie{constructor(e){super(),se(this,e,qf,Wf,re,{})}}function Zf(r){let e,t;return e=new $r({props:{lngLat:r[0],$$slots:{default:[Yf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.lngLat=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Kf(r){let e,t,n;function o(i){r[3](i)}let l={draggable:!0,$$slots:{default:[Xf]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.lngLat=r[0]),e=new $r({props:l}),Ge.push(()=>pt(e,"lngLat",o)),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.lngLat=i[0],gt(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Yf(r){let e,t;const n=r[2].default,o=Be(n,r,r[4],null);return{c(){e=$("span"),o&&o.c(),E(e,"class","dot svelte-1gcxp27")},m(l,i){k(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Re(o,n,l,l[4],t?De(n,l[4],i,null):ze(l[4]),null)},i(l){t||(b(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&L(e),o&&o.d(l)}}}function Xf(r){let e,t;const n=r[2].default,o=Be(n,r,r[4],null);return{c(){e=$("span"),o&&o.c(),E(e,"class","dot svelte-1gcxp27")},m(l,i){k(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Re(o,n,l,l[4],t?De(n,l[4],i,null):ze(l[4]),null)},i(l){t||(b(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&L(e),o&&o.d(l)}}}function Vf(r){let e,t,n,o;const l=[Kf,Zf],i=[];function s(a,f){return a[1]?0:1}return e=s(r),t=i[e]=l[e](r),{c(){t.c(),n=Ze()},m(a,f){i[e].m(a,f),k(a,n,f),o=!0},p(a,[f]){let u=e;e=s(a),e===u?i[e].p(a,f):(be(),S(i[u],1,1,()=>{i[u]=null}),ye(),t=i[e],t?t.p(a,f):(t=i[e]=l[e](a),t.c()),b(t,1),t.m(n.parentNode,n))},i(a){o||(b(t),o=!0)},o(a){S(t),o=!1},d(a){a&&L(n),i[e].d(a)}}}function Qf(r,e,t){let{$$slots:n={},$$scope:o}=e,{lngLat:l}=e,{draggable:i=!1}=e;function s(a){l=a,t(0,l)}return r.$$set=a=>{"lngLat"in a&&t(0,l=a.lngLat),"draggable"in a&&t(1,i=a.draggable),"$$scope"in a&&t(4,o=a.$$scope)},[l,i,n,s,o]}class yn extends ie{constructor(e){super(),se(this,e,Qf,Vf,re,{lngLat:0,draggable:1})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const xf={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Xo=xf;function Vo(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Nr(r){let e,t=[r[12]],n={};for(let o=0;o<t.length;o+=1)n=pe(n,t[o]);return{c(){e=qt(r[11]),dr(e,n)},m(o,l){k(o,e,l)},p(o,l){dr(e,n=We(t,[l&32&&o[12]]))},d(o){o&&L(e)}}}function Qo(r){let e=r[11],t,n=r[11]&&Nr(r);return{c(){n&&n.c(),t=Ze()},m(o,l){n&&n.m(o,l),k(o,t,l)},p(o,l){o[11]?e?re(e,o[11])?(n.d(1),n=Nr(o),e=o[11],n.c(),n.m(t.parentNode,t)):n.p(o,l):(n=Nr(o),e=o[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=o[11])},d(o){o&&L(t),n&&n.d(o)}}}function eu(r){let e,t,n,o,l,i=Te(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=Qo(Vo(r,i,_));const a=r[10].default,f=Be(a,r,r[9],null);let u=[Xo,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:o=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<u.length;_+=1)c=pe(c,u[_]);return{c(){e=qt("svg");for(let _=0;_<s.length;_+=1)s[_].c();t=Ze(),f&&f.c(),dr(e,c)},m(_,d){k(_,e,d);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null);p(e,t),f&&f.m(e,null),l=!0},p(_,[d]){if(d&32){i=Te(_[5]);let m;for(m=0;m<i.length;m+=1){const g=Vo(_,i,m);s[m]?s[m].p(g,d):(s[m]=Qo(g),s[m].c(),s[m].m(e,t))}for(;m<s.length;m+=1)s[m].d(1);s.length=i.length}f&&f.p&&(!l||d&512)&&Re(f,a,_,_[9],l?De(a,_[9],d,null):ze(_[9]),null),dr(e,c=We(u,[Xo,d&128&&_[7],(!l||d&4)&&{width:_[2]},(!l||d&4)&&{height:_[2]},(!l||d&2)&&{stroke:_[1]},(!l||d&28&&n!==(n=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":n},(!l||d&257&&o!==(o=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:o}]))},i(_){l||(b(f,_),l=!0)},o(_){S(f,_),l=!1},d(_){_&&L(e),ot(s,_),f&&f.d(_)}}}function tu(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let o=yo(e,n),{$$slots:l={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...m)=>m.filter((g,w,h)=>!!g&&h.indexOf(g)===w).join(" ");return r.$$set=m=>{t(8,e=pe(pe({},e),an(m))),t(7,o=yo(e,n)),"name"in m&&t(0,s=m.name),"color"in m&&t(1,a=m.color),"size"in m&&t(2,f=m.size),"strokeWidth"in m&&t(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&t(4,c=m.absoluteStrokeWidth),"iconNode"in m&&t(5,_=m.iconNode),"$$scope"in m&&t(9,i=m.$$scope)},e=an(e),[s,a,f,u,c,_,d,o,e,i,l]}class nu extends ie{constructor(e){super(),se(this,e,tu,eu,re,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const go=nu;function ru(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?De(t,o[3],l,null):ze(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function ou(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[ru]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new go({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s=i&3?We(n,[n[0],i&2&&so(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function lu(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{t(1,e=pe(pe({},e),an(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=an(e),[l,e,n,o]}class iu extends ie{constructor(e){super(),se(this,e,lu,ou,re,{})}}const su=iu;function au(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?De(t,o[3],l,null):ze(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function fu(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[au]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new go({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s=i&3?We(n,[n[0],i&2&&so(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function uu(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{t(1,e=pe(pe({},e),an(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=an(e),[l,e,n,o]}class cu extends ie{constructor(e){super(),se(this,e,uu,fu,re,{})}}const ts=cu;function du(r){let e;const t=r[2].default,n=Be(t,r,r[3],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8)&&Re(n,t,o,o[3],e?De(t,o[3],l,null):ze(o[3]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function _u(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let o={$$slots:{default:[du]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new go({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s=i&3?We(n,[n[0],i&2&&so(l[1]),i&1&&{iconNode:l[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function mu(r,e,t){let{$$slots:n={},$$scope:o}=e;const l=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{t(1,e=pe(pe({},e),an(i))),"$$scope"in i&&t(3,o=i.$$scope)},e=an(e),[l,e,n,o]}class pu extends ie{constructor(e){super(),se(this,e,mu,_u,re,{})}}const ns=pu;function xo(r){let e,t;return e=new wr({props:{$$slots:{default:[gu]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function gu(r){let e,t,n;const o=r[1].default,l=Be(o,r,r[4],null);return{c(){e=$("h2"),e.textContent="Help",t=C(),l&&l.c()},m(i,s){k(i,e,s),k(i,t,s),l&&l.m(i,s),n=!0},p(i,s){l&&l.p&&(!n||s&16)&&Re(l,o,i,i[4],n?De(o,i[4],s,null):ze(i[4]),null)},i(i){n||(b(l,i),n=!0)},o(i){S(l,i),n=!1},d(i){i&&(L(e),L(t)),l&&l.d(i)}}}function hu(r){let e,t,n,o,l,i,s;t=new su({props:{color:"black"}});let a=r[0]&&xo(r);return{c(){e=$("button"),T(t.$$.fragment),n=C(),a&&a.c(),o=Ze(),E(e,"class","icon-btn help svelte-my65h"),E(e,"aria-label","Help")},m(f,u){k(f,e,u),A(t,e,null),k(f,n,u),a&&a.m(f,u),k(f,o,u),l=!0,i||(s=X(e,"click",r[2]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&b(a,1)):(a=xo(f),a.c(),b(a,1),a.m(o.parentNode,o)):a&&(be(),S(a,1,1,()=>{a=null}),ye())},i(f){l||(b(t.$$.fragment,f),b(a),l=!0)},o(f){S(t.$$.fragment,f),S(a),l=!1},d(f){f&&(L(e),L(n),L(o)),F(t),a&&a.d(f),i=!1,s()}}}function bu(r,e,t){let{$$slots:n={},$$scope:o}=e,l=!1;const i=()=>t(0,l=!0),s=()=>t(0,l=!1);return r.$$set=a=>{"$$scope"in a&&t(4,o=a.$$scope)},[l,n,i,s,o]}class Dt extends ie{constructor(e){super(),se(this,e,bu,hu,re,{})}}function yu(r){let e,t,n,o,l,i=r[0]+1+"",s,a,f=r[1].length+"",u,c,_,d,m,g,w;return{c(){e=$("div"),t=$("button"),n=O("Previous"),l=C(),s=O(i),a=O(" / "),u=O(f),c=C(),_=$("button"),d=O("Next"),t.disabled=o=r[0]==0,E(t,"data-tooltip","Left"),_.disabled=m=r[0]==r[1].length-1,E(_,"data-tooltip","Right"),ae(e,"display","flex"),ae(e,"justify-content","space-between"),ae(e,"align-items","center")},m(h,y){k(h,e,y),p(e,t),p(t,n),p(e,l),p(e,s),p(e,a),p(e,u),p(e,c),p(e,_),p(_,d),g||(w=[X(window,"keydown",r[2]),X(t,"click",r[3]),X(_,"click",r[4])],g=!0)},p(h,[y]){y&1&&o!==(o=h[0]==0)&&(t.disabled=o),y&1&&i!==(i=h[0]+1+"")&&oe(s,i),y&2&&f!==(f=h[1].length+"")&&oe(u,f),y&3&&m!==(m=h[0]==h[1].length-1)&&(_.disabled=m)},i:Y,o:Y,d(h){h&&L(e),g=!1,rt(w)}}}function wu(r,e,t){let n;V(r,Yt,f=>t(5,n=f));let{list:o}=e,{idx:l=0}=e;yr(()=>{n==null||n.keyboard.disable()}),Mt(()=>{n==null||n.keyboard.enable()});function i(f){f.key=="ArrowLeft"&&(f.stopPropagation(),s()),f.key=="ArrowRight"&&(f.stopPropagation(),a())}function s(){l!=0&&t(0,l--,l)}function a(){l!=o.length-1&&t(0,l++,l)}return r.$$set=f=>{"list"in f&&t(1,o=f.list),"idx"in f&&t(0,l=f.idx)},[l,o,i,s,a]}class Lr extends ie{constructor(e){super(),se(this,e,wu,yu,re,{list:1,idx:0})}}function vu(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:$u}=ji;function ku(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g;return d=Ni(r[8][0]),{c(){e=$("button"),e.textContent="Stop StreetView",t=C(),n=$("fieldset"),o=$("legend"),o.textContent="Source:",l=C(),i=$("label"),s=$("input"),a=O(`
      Google Street View`),f=C(),u=$("label"),c=$("input"),_=O(`
      Bing Streetside`),E(e,"class","secondary"),E(s,"type","radio"),s.__value="google",qe(s,s.__value),E(c,"type","radio"),c.__value="bing",qe(c,c.__value),d.p(s,c)},m(w,h){k(w,e,h),k(w,t,h),k(w,n,h),p(n,o),p(n,l),p(n,i),p(i,s),s.checked=s.__value===r[0],p(i,a),p(n,f),p(n,u),p(u,c),c.checked=c.__value===r[0],p(u,_),m||(g=[X(e,"click",r[3]),X(s,"change",r[7]),X(c,"change",r[9])],m=!0)},p(w,h){h&1&&(s.checked=s.__value===w[0]),h&1&&(c.checked=c.__value===w[0])},d(w){w&&(L(e),L(t),L(n)),d.r(),m=!1,rt(g)}}}function Lu(r){let e,t,n;return{c(){e=$("button"),e.textContent="StreetView",E(e,"class","secondary")},m(o,l){k(o,e,l),t||(n=X(e,"click",r[2]),t=!0)},p:Y,d(o){o&&L(e),t=!1,n()}}}function Su(r){let e,t,n;function o(s,a){return s[1]?Lu:ku}let l=o(r),i=l(r);return{c(){i.c(),e=Ze()},m(s,a){i.m(s,a),k(s,e,a),t||(n=X($u,"keydown",r[4]),t=!0)},p(s,[a]){l===(l=o(s))&&i?i.p(s,a):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Y,o:Y,d(s){s&&L(e),i.d(s),t=!1,n()}}}function Mu(r,e,t){let n;V(r,ir,g=>t(1,n=g));let{map:o}=e,{maptilerBasemap:l}=e,i="google",s=[];function a(){x(ir,n=!1,n),o.on("click",u),o.getCanvas().style.cursor="crosshair";for(let g of vu(o,l))s.push([g,o.getPaintProperty(g,"line-color")]),o.setPaintProperty(g,"line-color","cyan")}function f(){x(ir,n=!0,n),o.off("click",u),o.getCanvas().style.cursor="inherit";for(let[g,w]of s)o.setPaintProperty(g,"line-color",w);s=[]}Mt(f);function u(g){let w=g.lngLat.lng,h=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${h},${w}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${h}~${w}&style=x`,"_blank")}function c(g){!n&&g.key=="Escape"&&(g.stopPropagation(),f())}const _=[[]];function d(){i=this.__value,t(0,i)}function m(){i=this.__value,t(0,i)}return r.$$set=g=>{"map"in g&&t(5,o=g.map),"maptilerBasemap"in g&&t(6,l=g.maptilerBasemap)},[i,n,a,f,c,o,l,d,_,m]}class Cu extends ie{constructor(e){super(),se(this,e,Mu,Su,re,{map:5,maptilerBasemap:6})}}function Le(r,e=!0){return{id:r,beforeId:Tu(r),eventsIfTopMost:e}}function Tu(r){let e=Gt(Yt);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let o=el.length-1;o>=0;o--){let l=el[o];if(l==r){n=!0;break}e.getLayer(l)&&(t=l)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Or=r=>r,Br=r=>r;const el=[Or(Br("Background")),"neighbourhood-boundaries",Or("Ferry line"),"debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",Br("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations",Br("Road labels"),Or("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function nn(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function on(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function ln(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Kr(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function mn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function tl(r){return r.reduce((e,t)=>e+t,0)}function nl(r){let e,t;return e=new Dt({props:{$$slots:{default:[Au]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Au(r){let e;return{c(){e=$("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
      according to OpenStreetMap.`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Fu(r){let e,t;const n=[Le("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":nn(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&1?We(n,[n[0],n[1],n[2],{layout:{visibility:l[0]?"visible":"none"}}]):{};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Eu(r){let e,t,n,o,l,i,s,a=r[0]&&nl(r);return o=new kr({props:{url:`pmtiles://${Lt("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[Fu]},$$scope:{ctx:r}}}),{c(){e=$("button"),e.textContent="Bus routes",t=C(),a&&a.c(),n=C(),T(o.$$.fragment),E(e,"class","secondary")},m(f,u){k(f,e,u),k(f,t,u),a&&a.m(f,u),k(f,n,u),A(o,f,u),l=!0,i||(s=X(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&b(a,1):(a=nl(f),a.c(),b(a,1),a.m(n.parentNode,n)):a&&(be(),S(a,1,1,()=>{a=null}),ye());const c={};u&5&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){l||(b(a),b(o.$$.fragment,f),l=!0)},o(f){S(a),S(o.$$.fragment,f),l=!1},d(f){f&&(L(e),L(t),L(n)),a&&a.d(f),F(o,f),i=!1,s()}}}function Pu(r,e,t){let n=!1;return[n,()=>t(0,n=!n)]}class Iu extends ie{constructor(e){super(),se(this,e,Pu,Eu,re,{})}}function ju(r){let e,t;return{c(){e=qt("svg"),t=qt("path"),E(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),E(e,"viewBox","0 0 14 14"),E(e,"width","13"),E(e,"height","13"),E(e,"class","svelte-en2qvf")},m(n,o){k(n,e,o),p(e,t)},p:Y,i:Y,o:Y,d(n){n&&L(e)}}}class rs extends ie{constructor(e){super(),se(this,e,null,ju,re,{})}}function Nu(r){let e,t;return{c(){e=qt("svg"),t=qt("path"),E(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),E(e,"viewBox","0 0 30 30"),E(e,"fill","none"),E(e,"xmlns","http://www.w3.org/2000/svg"),E(e,"class","svelte-d2loi5")},m(n,o){k(n,e,o),p(e,t)},p:Y,i:Y,o:Y,d(n){n&&L(e)}}}class os extends ie{constructor(e){super(),se(this,e,null,Nu,re,{})}}function Ou(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"area.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"area.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function Bu(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"reverse.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"reverse.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function Ru(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"poi.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"poi.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function zu(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"postal_code.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"postal_code.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function Du(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"street.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"street.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function Uu(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"road.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"road.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function Hu(r){let e,t;return{c(){e=$("img"),Je(e.src,t=r[3]+"housenumber.svg")||E(e,"src",t),E(e,"alt",r[6]),E(e,"class","svelte-ltkwvy")},m(n,o){k(n,e,o)},p(n,o){o&8&&!Je(e.src,t=n[3]+"housenumber.svg")&&E(e,"src",t),o&64&&E(e,"alt",n[6])},d(n){n&&L(e)}}}function Gu(r){let e,t,n,o;return{c(){e=$("img"),Je(e.src,t=r[5])||E(e,"src",t),E(e,"alt",r[4]),E(e,"class","svelte-ltkwvy")},m(l,i){k(l,e,i),n||(o=X(e,"error",r[14]),n=!0)},p(l,i){i&32&&!Je(e.src,t=l[5])&&E(e,"src",t),i&16&&E(e,"alt",l[4])},d(l){l&&L(e),n=!1,o()}}}function rl(r){let e,t;return{c(){e=$("span"),t=O(r[6]),E(e,"class","secondary svelte-ltkwvy")},m(n,o){k(n,e,o),p(e,t)},p(n,o){o&64&&oe(t,n[6])},d(n){n&&L(e)}}}function Wu(r){let e,t,n,o,l,i,s,a,f,u=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],m,g,w=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",h,y,v;function M(R,B){return B&1&&(t=null),B&1&&(n=null),B&1&&(o=null),B&1&&(l=null),R[5]?Gu:R[0].address?Hu:(t==null&&(t=!!R[0].id.startsWith("road.")),t?Uu:(n==null&&(n=!!R[0].id.startsWith("address.")),n?Du:(o==null&&(o=!!R[0].id.startsWith("postal_code.")),o?zu:(l==null&&(l=!!R[0].id.startsWith("poi.")),l?Ru:R[7]?Bu:Ou))))}let j=M(r,-1),P=j(r),I=d&&rl(r);return{c(){e=$("li"),P.c(),i=C(),s=$("span"),a=$("span"),f=$("span"),c=O(u),_=C(),I&&I.c(),m=C(),g=$("span"),h=O(w),E(f,"class","primary svelte-ltkwvy"),E(a,"class","svelte-ltkwvy"),E(g,"class","line2 svelte-ltkwvy"),E(s,"class","texts svelte-ltkwvy"),E(e,"tabindex","0"),E(e,"data-selected",r[1]),E(e,"class","svelte-ltkwvy"),mt(e,"selected",r[1])},m(R,B){k(R,e,B),P.m(e,null),p(e,i),p(e,s),p(s,a),p(a,f),p(f,c),p(a,_),I&&I.m(a,null),p(s,m),p(s,g),p(g,h),y||(v=[X(e,"mouseenter",r[12]),X(e,"focus",r[13])],y=!0)},p(R,[B]){j===(j=M(R,B))&&P?P.p(R,B):(P.d(1),P=j(R),P&&(P.c(),P.m(e,i))),B&1&&u!==(u=(R[7]?R[0].place_name:R[0].place_name.replace(/,.*/,""))+"")&&oe(c,u),B&37&&(d=R[2]==="always"||R[2]!=="never"&&!R[0].address&&!R[0].id.startsWith("road.")&&!R[0].id.startsWith("address.")&&!R[0].id.startsWith("postal_code.")&&(!R[0].id.startsWith("poi.")||!R[5])&&!R[7]),d?I?I.p(R,B):(I=rl(R),I.c(),I.m(a,null)):I&&(I.d(1),I=null),B&1&&w!==(w=(R[7]?"":R[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&oe(h,w),B&2&&E(e,"data-selected",R[1]),B&2&&mt(e,"selected",R[1])},i:Y,o:Y,d(R){R&&L(e),P.d(),I&&I.d(),y=!1,rt(v)}}}function qu(r,e,t){var v;let n,o,{feature:l}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:f}=e;const u=(v=l.properties)==null?void 0:v.categories;let c,_,d=0,m=l.place_type[0]==="reverse";function g(){_&&a.add(_),t(10,d++,d)}function w(M){Ne.call(this,r,M)}function h(M){Ne.call(this,r,M)}const y=()=>g();return r.$$set=M=>{"feature"in M&&t(0,l=M.feature),"selected"in M&&t(1,i=M.selected),"showPlaceType"in M&&t(2,s=M.showPlaceType),"missingIconsCache"in M&&t(9,a=M.missingIconsCache),"iconsBaseUrl"in M&&t(3,f=M.iconsBaseUrl)},r.$$.update=()=>{var M,j,P,I;if(r.$$.dirty&3640)do t(11,n--,n),t(4,c=u==null?void 0:u[n]),t(5,_=c?f+c.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!_||a.has(_)));r.$$.dirty&1&&t(6,o=((j=(M=l.properties)==null?void 0:M.categories)==null?void 0:j.join(", "))??((I=(P=l.properties)==null?void 0:P.place_type_name)==null?void 0:I[0])??l.place_type[0])},t(11,n=(u==null?void 0:u.length)??0),[l,i,s,f,c,_,o,m,g,a,d,n,w,h,y]}class Ju extends ie{constructor(e){super(),se(this,e,qu,Wu,re,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Zu(r){let e;return{c(){e=$("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',E(e,"class","svelte-7cmwmc")},m(t,n){k(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&L(e)}}}class Ku extends ie{constructor(e){super(),se(this,e,null,Zu,re,{})}}function Yu(r){let e,t;return{c(){e=qt("svg"),t=qt("path"),E(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),E(e,"viewBox","0 0 60.006 21.412"),E(e,"width","14"),E(e,"height","20"),E(e,"class","svelte-en2qvf")},m(n,o){k(n,e,o),p(e,t)},p:Y,i:Y,o:Y,d(n){n&&L(e)}}}class Xu extends ie{constructor(e){super(),se(this,e,null,Yu,re,{})}}function Vu(r){let e,t,n;return{c(){e=qt("svg"),t=qt("circle"),n=qt("path"),E(t,"cx","4.789"),E(t,"cy","4.787"),E(t,"r","3.85"),E(t,"class","svelte-1aq105l"),E(n,"d","M12.063 12.063 7.635 7.635"),E(n,"class","svelte-1aq105l"),E(e,"xmlns","http://www.w3.org/2000/svg"),E(e,"width","13"),E(e,"height","13"),E(e,"viewBox","0 0 13 13"),E(e,"class","svelte-1aq105l")},m(o,l){k(o,e,l),p(e,t),p(e,n)},p:Y,i:Y,o:Y,d(o){o&&L(e)}}}class Qu extends ie{constructor(e){super(),se(this,e,null,Vu,re,{})}}function xu(r,e,t){const n=e[1],o=e[0],l=n-o;return r===n&&t?r:((r-o)%l+l)%l+o}function ol(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Fn;async function ec(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const o of e??[])if(!(n&&(o.minZoom!=null&&o.minZoom>n[0]||o.maxZoom!=null&&o.maxZoom<n[0]))){if(o.type==="fixed")return o.coordinates.join(",");e:if(o.type==="client-geolocation"){if(Fn&&o.cachedLocationExpiry&&Fn.time+o.cachedLocationExpiry>Date.now()){if(!Fn.coords)break e;return Fn.coords}let l;try{return l=await new Promise((i,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(f=>f.toFixed(6)).join(","))},a=>{s(a)},o)}),l}catch{}finally{o.cachedLocationExpiry&&(Fn={time:Date.now(),coords:l})}if(t.signal.aborted)return}if(o.type==="server-geolocation")return"ip";if(n&&o.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}function ll(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function il(r){let e,t;return e=new Ku({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function sl(r){let e,t,n,o,l;return t=new Xu({}),{c(){e=$("button"),T(t.$$.fragment),E(e,"type","button"),E(e,"title",r[9]),E(e,"class","svelte-bz0zu3"),mt(e,"active",r[0])},m(i,s){k(i,e,s),A(t,e,null),n=!0,o||(l=X(e,"click",r[69]),o=!0)},p(i,s){(!n||s[0]&512)&&E(e,"title",i[9]),(!n||s[0]&1)&&mt(e,"active",i[0])},i(i){n||(b(t.$$.fragment,i),n=!0)},o(i){S(t.$$.fragment,i),n=!1},d(i){i&&L(e),F(t),o=!1,l()}}}function tc(r){let e,t=[],n=new Map,o,l,i,s=Te(r[14]);const a=f=>f[84].id+(f[84].address?","+f[84].address:"");for(let f=0;f<s.length;f+=1){let u=ll(r,s,f),c=a(u);n.set(c,t[f]=al(c,u))}return{c(){e=$("ul");for(let f=0;f<t.length;f+=1)t[f].c();E(e,"class","options svelte-bz0zu3")},m(f,u){k(f,e,u);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);o=!0,l||(i=[X(e,"mouseleave",r[73]),X(e,"blur",r[74])],l=!0)},p(f,u){u[0]&17880064&&(s=Te(f[14]),be(),t=Ys(t,u,a,1,f,s,n,e,Xs,al,null,ll),ye())},i(f){if(!o){for(let u=0;u<s.length;u+=1)b(t[u]);o=!0}},o(f){for(let u=0;u<t.length;u+=1)S(t[u]);o=!1},d(f){f&&L(e);for(let u=0;u<t.length;u+=1)t[u].d();l=!1,rt(i)}}}function nc(r){let e,t,n,o,l,i;return t=new os({}),{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("div"),l=O(r[7]),E(o,"class","svelte-bz0zu3"),E(e,"class","no-results svelte-bz0zu3")},m(s,a){k(s,e,a),A(t,e,null),p(e,n),p(e,o),p(o,l),i=!0},p(s,a){(!i||a[0]&128)&&oe(l,s[7])},i(s){i||(b(t.$$.fragment,s),i=!0)},o(s){S(t.$$.fragment,s),i=!1},d(s){s&&L(e),F(t)}}}function rc(r){let e="",t;return{c(){t=O(e)},m(n,o){k(n,t,o)},p:Y,i:Y,o:Y,d(n){n&&L(t)}}}function oc(r){let e,t,n,o,l,i,s,a,f,u,c;return t=new os({}),a=new rs({}),{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("div"),l=O(r[6]),i=C(),s=$("button"),T(a.$$.fragment),E(o,"class","svelte-bz0zu3"),E(s,"class","svelte-bz0zu3"),E(e,"class","error svelte-bz0zu3")},m(_,d){k(_,e,d),A(t,e,null),p(e,n),p(e,o),p(o,l),p(e,i),p(e,s),A(a,s,null),f=!0,u||(c=X(s,"click",r[70]),u=!0)},p(_,d){(!f||d[0]&64)&&oe(l,_[6])},i(_){f||(b(t.$$.fragment,_),b(a.$$.fragment,_),f=!0)},o(_){S(t.$$.fragment,_),S(a.$$.fragment,_),f=!1},d(_){_&&L(e),F(t),F(a),u=!1,c()}}}function al(r,e){let t,n,o;function l(){return e[71](e[86])}function i(){return e[72](e[84])}return n=new Ju({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",l),n.$on("focus",i),{key:r,first:null,c(){t=Ze(),T(n.$$.fragment),this.first=t},m(s,a){k(s,t,a),A(n,s,a),o=!0},p(s,a){e=s;const f={};a[0]&16384&&(f.feature=e[84]),a[0]&1024&&(f.showPlaceType=e[10]),a[0]&49152&&(f.selected=e[15]===e[86]),a[0]&4096&&(f.iconsBaseUrl=e[12]),n.$set(f)},i(s){o||(b(n.$$.fragment,s),o=!0)},o(s){S(n.$$.fragment,s),o=!1},d(s){s&&L(t),F(n,s)}}}function lc(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h,y,v,M,j,P=!1;l=new Qu({}),c=new rs({});let I=r[19]&&il(),R=r[5]==="button"&&sl(r);const B=r[61].default,D=Be(B,r,r[60],null),z=[oc,rc,nc,tc],N=[];function U(G,K){var Z,te;return G[18]?0:G[16]?((Z=G[14])==null?void 0:Z.length)===0?2:G[16]&&((te=G[14])!=null&&te.length)?3:-1:1}return~(w=U(r))&&(h=N[w]=z[w](r)),{c(){e=C(),t=$("form"),n=$("div"),o=$("button"),T(l.$$.fragment),i=C(),s=$("input"),a=C(),f=$("div"),u=$("button"),T(c.$$.fragment),_=C(),I&&I.c(),d=C(),R&&R.c(),m=C(),D&&D.c(),g=C(),h&&h.c(),E(o,"class","search-button svelte-bz0zu3"),E(o,"type","button"),E(s,"placeholder",r[8]),E(s,"aria-label",r[8]),E(s,"class","svelte-bz0zu3"),E(u,"type","button"),E(u,"title",r[3]),E(u,"class","svelte-bz0zu3"),E(f,"class","clear-button-container svelte-bz0zu3"),mt(f,"displayable",r[1]!==""),E(n,"class","input-group svelte-bz0zu3"),E(t,"tabindex","0"),E(t,"class",y=wo(r[2])+" svelte-bz0zu3"),mt(t,"can-collapse",r[4]&&r[1]==="")},m(G,K){k(G,e,K),k(G,t,K),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),r[63](s),qe(s,r[1]),p(n,a),p(n,f),p(f,u),A(c,u,null),p(f,_),I&&I.m(f,null),p(n,d),R&&R.m(n,null),p(n,m),D&&D.m(n,null),p(t,g),~w&&N[w].m(t,null),v=!0,M||(j=[X(o,"click",r[62]),X(s,"input",r[64]),X(s,"focus",r[65]),X(s,"blur",r[66]),X(s,"keydown",r[22]),X(s,"input",r[67]),X(u,"click",r[68]),X(t,"submit",Ii(r[21]))],M=!0)},p(G,K){(!v||K[0]&256)&&E(s,"placeholder",G[8]),(!v||K[0]&256)&&E(s,"aria-label",G[8]),K[0]&2&&s.value!==G[1]&&qe(s,G[1]),(!v||K[0]&8)&&E(u,"title",G[3]),G[19]?I?K[0]&524288&&b(I,1):(I=il(),I.c(),b(I,1),I.m(f,null)):I&&(be(),S(I,1,1,()=>{I=null}),ye()),(!v||K[0]&2)&&mt(f,"displayable",G[1]!==""),G[5]==="button"?R?(R.p(G,K),K[0]&32&&b(R,1)):(R=sl(G),R.c(),b(R,1),R.m(n,m)):R&&(be(),S(R,1,1,()=>{R=null}),ye()),D&&D.p&&(!v||K[1]&536870912)&&Re(D,B,G,G[60],v?De(B,G[60],K,null):ze(G[60]),null);let Z=w;w=U(G),w===Z?~w&&N[w].p(G,K):(h&&(be(),S(N[Z],1,1,()=>{N[Z]=null}),ye()),~w?(h=N[w],h?h.p(G,K):(h=N[w]=z[w](G),h.c()),b(h,1),h.m(t,null)):h=null),(!v||K[0]&4&&y!==(y=wo(G[2])+" svelte-bz0zu3"))&&E(t,"class",y),(!v||K[0]&22)&&mt(t,"can-collapse",G[4]&&G[1]==="")},i(G){v||(b(P),b(l.$$.fragment,G),b(c.$$.fragment,G),b(I),b(R),b(D,G),b(h),v=!0)},o(G){S(P),S(l.$$.fragment,G),S(c.$$.fragment,G),S(I),S(R),S(D,G),S(h),v=!1},d(G){G&&(L(e),L(t)),F(l),r[63](null),F(c),I&&I.d(),R&&R.d(),D&&D.d(G),~w&&N[w].d(),M=!1,rt(j)}}}function ic(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:f}=e,{bbox:u=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:m=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:w="never"}=e,{errorMessage:h="Something went wrong…"}=e,{filter:y=()=>!0}=e,{flyTo:v=!0}=e,{fuzzyMatch:M=!0}=e,{language:j=void 0}=e,{limit:P=void 0}=e,{mapController:I=void 0}=e,{minLength:R=2}=e,{noResultsMessage:B="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:D="Search"}=e,{proximity:z=[{type:"server-geolocation"}]}=e,{reverseActive:N=w==="always"}=e,{reverseButtonTitle:U="toggle reverse geocoding"}=e,{searchValue:G=""}=e,{pickedResultStyle:K="full-geometry"}=e,{showPlaceType:Z="if-needed"}=e,{showResultsWhileTyping:te=!0}=e,{selectFirst:H=!0}=e,{flyToSelected:ve=!1}=e,{markerOnSelected:ge=!0}=e,{types:le=void 0}=e,{exhaustiveReverseGeocoding:ue=!1}=e,{excludeTypes:me=!1}=e,{zoom:_e=s}=e,{apiUrl:Se="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Fe={}}=e,{iconsBaseUrl:ce="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Ae=()=>{}}=e;function ft(){Oe.focus()}function It(){Oe.blur()}function ne(J,Qe=!0,ut=!1){t(1,G=J),Qe?(t(15,Ue=-1),Ft()):(Tr(!ut,ut),setTimeout(()=>{Oe.focus(),Oe.select()}))}function he(){t(14,we=void 0),t(56,W=void 0),t(15,Ue=-1)}function Q(){t(55,$e=[]),t(56,W=void 0)}let Ce=!1,we,$e,W,lt="",Oe,Ue=-1,wt,_t=[],Ye,Xt,Vt,vt;const er=new Set,At=fn();Mt(()=>{I&&(I.setEventHandler(void 0),I.indicateReverse(!1),I.setSelectedMarker(-1),I.setFeatures(void 0,void 0,!1))});function Ft(J){if(Xt&&(clearTimeout(Xt),Xt=void 0),Ue>-1&&we)t(56,W=we[Ue]),t(1,G=W.place_type[0]==="reverse"?W.place_name:W.place_name.replace(/,.*/,"")),t(18,wt=void 0),t(55,$e=void 0),t(15,Ue=-1);else if(G){const Qe=J||!et(G);Pe(G,{exact:!0}).then(()=>{t(55,$e=we),t(56,W=void 0),Qe&&tt()}).catch(ut=>t(18,wt=ut))}}function et(J){try{return Ks(J,6)}catch{return!1}}async function Pe(J,{byId:Qe=!1,exact:ut=!1}={}){t(18,wt=void 0),Ye==null||Ye.abort();const Et=new AbortController;t(19,Ye=Et);try{const Ie=et(J),it=new URLSearchParams;if(j!==void 0&&it.set("language",Array.isArray(j)?j.join(","):j??""),le&&it.set("types",le.join(",")),me&&it.set("excludeTypes",String(me)),u&&it.set("bbox",u.map(tr=>tr.toFixed(6)).join(",")),m&&it.set("country",Array.isArray(m)?m.join(","):m),!Qe&&!Ie){const tr=await ec(I,z,Et);tr&&it.set("proximity",tr),(ut||!te)&&it.set("autocomplete","false"),it.set("fuzzyMatch",String(M))}P!==void 0&&(ue||!Ie||(le==null?void 0:le.length)===1)&&it.set("limit",String(P)),it.set("key",f),Ae(it);const Jt=Se+"/"+encodeURIComponent(Ie?Ie.decimalLongitude+","+Ie.decimalLatitude:J)+".json?"+it.toString();if(Jt===lt){Qe?(t(14,we=void 0),t(56,W=_t[0])):t(14,we=_t);return}lt=Jt;const Fr=await fetch(Jt,{signal:Et.signal,...Fe});if(!Fr.ok)throw new Error(await Fr.text());const Er=await Fr.json();At("response",{url:Jt,featureCollection:Er}),Qe?(t(14,we=void 0),t(56,W=Er.features[0]),_t=[W]):(t(14,we=Er.features.filter(y)),Ie&&we.unshift({type:"Feature",properties:{},id:"reverse_"+Ie.decimalLongitude+"_"+Ie.decimalLatitude,text:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_name:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_type:["reverse"],center:[Ie.decimalLongitude,Ie.decimalLatitude],bbox:[Ie.decimalLongitude,Ie.decimalLatitude,Ie.decimalLongitude,Ie.decimalLatitude],geometry:{type:"Point",coordinates:[Ie.decimalLongitude,Ie.decimalLatitude]}}),_t=we,Ie&&Oe.focus())}catch(Ie){if(Ie&&typeof Ie=="object"&&"name"in Ie&&Ie.name==="AbortError")return;throw Ie}finally{Et===Ye&&t(19,Ye=void 0)}}function tt(){var Et;if(!($e!=null&&$e.length)||!v)return;const J=[180,90,-180,-90],Qe=!$e.some(Ie=>!Ie.matching_text);let ut;for(const Ie of $e){const it=Tn(Ie);if(ut=ut===void 0?it:it===void 0?ut:Math.max(ut,it),Qe||!Ie.matching_text)for(const Jt of[0,1,2,3])J[Jt]=Math[Jt<2?"min":"max"](J[Jt],((Et=Ie.bbox)==null?void 0:Et[Jt])??Ie.center[Jt%2])}I&&$e.length>0&&(W&&J[0]===J[2]&&J[1]===J[3]?I.flyTo(W.center,Tn(W)):I.fitBounds(ol(J),50,ut))}function Tn(J){var ut;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const Qe=J.id.replace(/\..*/,"");return(Array.isArray((ut=J.properties)==null?void 0:ut.categories)?J.properties.categories.reduce((Et,Ie)=>{const it=_e[Qe+"."+Ie];return Et===void 0?it:it===void 0?Et:Math.max(Et,it)},void 0):void 0)??_e[Qe]}function $s(J){t(0,N=w==="always"),t(14,we=void 0),t(56,W=void 0),t(15,Ue=-1),ne(J[1].toFixed(6)+", "+xu(J[0],[-180,180],!0).toFixed(6),!1,!0)}function ks(J){if(!we)return;let Qe=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;Qe&&(Ue===(H?0:-1)&&Qe===-1&&t(15,Ue=we.length),t(15,Ue+=Qe),Ue>=we.length&&t(15,Ue=-1),Ue<0&&H&&t(15,Ue=0),J.preventDefault())}function Tr(J=!0,Qe=!1){if(t(18,wt=void 0),te||Qe){if(Xt&&clearTimeout(Xt),G.length<R)return;const ut=G;Xt=window.setTimeout(()=>{Pe(ut).catch(Et=>t(18,wt=Et))},J?g:0)}else t(14,we=void 0),t(18,wt=void 0)}function Ar(J){t(56,W=J),t(1,G=J.place_name),t(15,Ue=-1)}const Ls=()=>Oe.focus();function Ss(J){Ge[J?"unshift":"push"](()=>{Oe=J,t(17,Oe)})}function Ms(){G=this.value,t(1,G),t(13,Ce),t(28,_)}const Cs=()=>t(13,Ce=!0),Ts=()=>t(13,Ce=!1),As=()=>Tr(),Fs=()=>{t(1,G=""),Oe.focus()},Es=()=>t(0,N=!N),Ps=()=>t(18,wt=void 0),Is=J=>t(15,Ue=J),js=J=>Ar(J),Ns=()=>{H||t(15,Ue=-1)},Os=()=>{};return r.$$set=J=>{"class"in J&&t(2,a=J.class),"apiKey"in J&&t(26,f=J.apiKey),"bbox"in J&&t(27,u=J.bbox),"clearButtonTitle"in J&&t(3,c=J.clearButtonTitle),"clearOnBlur"in J&&t(28,_=J.clearOnBlur),"collapsed"in J&&t(4,d=J.collapsed),"country"in J&&t(29,m=J.country),"debounceSearch"in J&&t(30,g=J.debounceSearch),"enableReverse"in J&&t(5,w=J.enableReverse),"errorMessage"in J&&t(6,h=J.errorMessage),"filter"in J&&t(31,y=J.filter),"flyTo"in J&&t(32,v=J.flyTo),"fuzzyMatch"in J&&t(33,M=J.fuzzyMatch),"language"in J&&t(34,j=J.language),"limit"in J&&t(35,P=J.limit),"mapController"in J&&t(36,I=J.mapController),"minLength"in J&&t(37,R=J.minLength),"noResultsMessage"in J&&t(7,B=J.noResultsMessage),"placeholder"in J&&t(8,D=J.placeholder),"proximity"in J&&t(38,z=J.proximity),"reverseActive"in J&&t(0,N=J.reverseActive),"reverseButtonTitle"in J&&t(9,U=J.reverseButtonTitle),"searchValue"in J&&t(1,G=J.searchValue),"pickedResultStyle"in J&&t(39,K=J.pickedResultStyle),"showPlaceType"in J&&t(10,Z=J.showPlaceType),"showResultsWhileTyping"in J&&t(40,te=J.showResultsWhileTyping),"selectFirst"in J&&t(11,H=J.selectFirst),"flyToSelected"in J&&t(41,ve=J.flyToSelected),"markerOnSelected"in J&&t(42,ge=J.markerOnSelected),"types"in J&&t(43,le=J.types),"exhaustiveReverseGeocoding"in J&&t(44,ue=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&t(45,me=J.excludeTypes),"zoom"in J&&t(46,_e=J.zoom),"apiUrl"in J&&t(47,Se=J.apiUrl),"fetchParameters"in J&&t(48,Fe=J.fetchParameters),"iconsBaseUrl"in J&&t(12,ce=J.iconsBaseUrl),"adjustUrlQuery"in J&&t(49,Ae=J.adjustUrlQuery),"$$scope"in J&&t(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,N=w==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Vt=Ce),_&&!Ce&&t(1,G="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&G.length<R&&(t(56,W=void 0),t(14,we=void 0),t(18,wt=void 0),t(55,$e=we)),r.$$.dirty[1]&33554688&&K!=="marker-only"&&W&&!W.address&&W.geometry.type==="Point"&&W.place_type[0]!=="reverse"&&Pe(W.id,{byId:!0}).catch(J=>t(18,wt=J)),r.$$.dirty[1]&100663330&&(I&&W&&W.id!==vt&&v&&(!W.bbox||W.bbox[0]===W.bbox[2]&&W.bbox[1]===W.bbox[3]?I.flyTo(W.center,Tn(W)):I.fitBounds(ol(W.bbox),50,Tn(W)),t(14,we=void 0),t(55,$e=void 0),t(15,Ue=-1)),t(57,vt=W==null?void 0:W.id)),r.$$.dirty[0]&18432&&H&&we!=null&&we.length&&t(15,Ue=0),r.$$.dirty[0]&2&&t(15,Ue=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&$e!==we&&t(55,$e=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&I&&I.setEventHandler(J=>{switch(J.type){case"mapClick":N&&$s(J.coordinates);break;case"markerClick":{const Qe=we==null?void 0:we.find(ut=>ut.id===J.id);Qe&&Ar(Qe)}break;case"markerMouseEnter":$e&&t(15,Ue=Vt?(we==null?void 0:we.findIndex(Qe=>Qe.id===J.id))??-1:-1);break;case"markerMouseLeave":$e&&t(15,Ue=-1);break}}),r.$$.dirty[0]&49152&&t(58,o=we==null?void 0:we[Ue]),r.$$.dirty[1]&134218786&&I&&o&&v&&ve&&I.flyTo(o.center,Tn(o)),r.$$.dirty[1]&256&&t(59,n=K==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ge||I==null||I.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&I&&ge&&!$e&&(I.setFeatures(o?[o]:void 0,void 0,n),I.setSelectedMarker(o?0:-1)),r.$$.dirty[1]&318767136&&I&&I.setFeatures($e,W,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&$e&&I&&I.setSelectedMarker(Ue),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&I){const J=et(G);I.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&At("select",{feature:o}),r.$$.dirty[1]&33554432&&At("pick",{feature:W}),r.$$.dirty[0]&81920&&At("optionsvisibilitychange",{optionsVisible:Vt&&!!we}),r.$$.dirty[0]&16384&&At("featureslisted",{features:we}),r.$$.dirty[1]&16777216&&At("featuresmarked",{features:$e}),r.$$.dirty[0]&1&&At("reversetoggle",{reverse:N}),r.$$.dirty[0]&2&&At("querychange",{query:G}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&I&&I.indicateReverse(N)},[N,G,a,c,d,w,h,B,D,U,Z,H,ce,Ce,we,Ue,Vt,Oe,wt,Ye,er,Ft,ks,Tr,Ar,s,f,u,_,m,g,y,v,M,j,P,I,R,z,K,te,ve,ge,le,ue,me,_e,Se,Fe,Ae,ft,It,ne,he,Q,$e,W,vt,o,n,i,l,Ls,Ss,Ms,Cs,Ts,As,Fs,Es,Ps,Is,js,Ns,Os]}class sc extends ie{constructor(e){super(),se(this,e,ic,lc,re,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function fl(r){let e,t,n;return t=new sc({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=$("div"),T(t.$$.fragment),E(e,"class","svelte-ixhnie")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&4&&(i.mapController=o[2]),l&1&&(i.apiKey=o[0]),l&2&&(i.country=o[1]),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function ac(r){let e,t,n=r[2]&&fl(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,[l]){o[2]?n?(n.p(o,l),l&4&&b(n,1)):(n=fl(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function fc(r,e,t){let n,{apiKey:o}=e,{map:l}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(f){return f?Vs(f,Kt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=f=>{"apiKey"in f&&t(0,o=f.apiKey),"map"in f&&t(4,l=f.map),"country"in f&&t(1,i=f.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=a(l))},[o,i,n,s,l]}class uc extends ie{constructor(e){super(),se(this,e,fc,ac,re,{apiKey:0,map:4,country:1})}}const cc=["==",["geometry-type"],"Polygon"],dc=["==",["geometry-type"],"LineString"];function Ht(r,e,t){let n=["match",r];for(let[o,l]of Object.entries(e))n.push(o),n.push(l);return n.push(t),n}function sn(r,e,t){let n=["step",r];for(let o=1;o<e.length;o++)n.push(t[o-1]),n.push(e[o]);return n.push(t[t.length-1]),n}function en(){return{type:"FeatureCollection",features:[]}}function ul(r){let e,t,n,o,l;return t=new Yn({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),o=new Dt({props:{$$slots:{default:[_c]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment)},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function _c(r){let e;return{c(){e=$("a"),e.textContent="Data from NPT",E(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),E(e,"target","_blank")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function cl(r){let e,t,n,o,l;return t=new ao({props:{colors:r[4],horiz:!0}}),o=new Dt({props:{$$slots:{default:[mc]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment)},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function mc(r){let e;return{c(){e=$("a"),e.textContent="Data from NPT",E(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),E(e,"target","_blank")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function dl(r){let e,t,n,o,l;return t=new ao({props:{colors:r[5],horiz:!0}}),o=new Dt({props:{$$slots:{default:[pc]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment)},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function pc(r){let e;return{c(){e=$("a"),e.textContent="Data from NPT",E(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),E(e,"target","_blank")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function gc(r){let e,t,n,o,l,i;const s=[Le("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Ht(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":nn(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=pe(a,s[d]);e=new xe({props:a});const f=[Le("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Ht(["get","Level of Service"],r[4],"cyan"),"line-width":nn(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={};for(let d=0;d<f.length;d+=1)u=pe(u,f[d]);n=new xe({props:u});const c=[Le("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Ht(["get","Infrastructure type"],r[5],"cyan"),"line-width":nn(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=pe(_,c[d]);return l=new xe({props:_}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment)},m(d,m){A(e,d,m),k(d,t,m),A(n,d,m),k(d,o,m),A(l,d,m),i=!0},p(d,m){const g=m&9?We(s,[s[0],s[1],s[2],m&8&&{paint:{"line-color":Ht(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":nn(0)}},m&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const w=m&18?We(f,[f[0],f[1],m&16&&{paint:{"line-color":Ht(["get","Level of Service"],d[4],"cyan"),"line-width":nn(1)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};n.$set(w);const h=m&36?We(c,[c[0],c[1],c[2],m&32&&{paint:{"line-color":Ht(["get","Infrastructure type"],d[5],"cyan"),"line-width":nn(1)}},m&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};l.$set(h)},i(d){i||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(l.$$.fragment,d),i=!1},d(d){d&&(L(t),L(o)),F(e,d),F(n,d),F(l,d)}}}function hc(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m=r[0]&&ul(r),g=r[1]&&cl(r),w=r[2]&&dl(r);return u=new kr({props:{url:`pmtiles://${Lt("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[gc]},$$scope:{ctx:r}}}),{c(){e=$("button"),e.textContent="Traffic",t=C(),m&&m.c(),n=C(),o=$("button"),o.textContent="Level of Service",l=C(),g&&g.c(),i=C(),s=$("button"),s.textContent="Existing cycle infrastructure",a=C(),w&&w.c(),f=C(),T(u.$$.fragment),E(e,"class","secondary"),E(o,"class","secondary"),E(s,"class","secondary")},m(h,y){k(h,e,y),k(h,t,y),m&&m.m(h,y),k(h,n,y),k(h,o,y),k(h,l,y),g&&g.m(h,y),k(h,i,y),k(h,s,y),k(h,a,y),w&&w.m(h,y),k(h,f,y),A(u,h,y),c=!0,_||(d=[X(e,"click",r[6]),X(o,"click",r[7]),X(s,"click",r[8])],_=!0)},p(h,[y]){h[0]?m?(m.p(h,y),y&1&&b(m,1)):(m=ul(h),m.c(),b(m,1),m.m(n.parentNode,n)):m&&(be(),S(m,1,1,()=>{m=null}),ye()),h[1]?g?(g.p(h,y),y&2&&b(g,1)):(g=cl(h),g.c(),b(g,1),g.m(i.parentNode,i)):g&&(be(),S(g,1,1,()=>{g=null}),ye()),h[2]?w?(w.p(h,y),y&4&&b(w,1)):(w=dl(h),w.c(),b(w,1),w.m(f.parentNode,f)):w&&(be(),S(w,1,1,()=>{w=null}),ye());const v={};y&519&&(v.$$scope={dirty:y,ctx:h}),u.$set(v)},i(h){c||(b(m),b(g),b(w),b(u.$$.fragment,h),c=!0)},o(h){S(m),S(g),S(w),S(u.$$.fragment,h),c=!1},d(h){h&&(L(e),L(t),L(n),L(o),L(l),L(i),L(s),L(a),L(f)),m&&m.d(h),g&&g.d(h),w&&w.d(h),F(u,h),_=!1,rt(d)}}}function bc(r,e,t){let n=!1,o=!1,l=!1;return[n,o,l,{colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},{High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"},()=>t(0,n=!n),()=>t(1,o=!o),()=>t(2,l=!l)]}class yc extends ie{constructor(e){super(),se(this,e,bc,hc,re,{})}}function _l(r){let e,t,n,o,l;return t=new ao({props:{colors:r[1],horiz:!0}}),o=new Dt({props:{$$slots:{default:[wc]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment)},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function wc(r){let e;return{c(){e=$("p"),e.innerHTML=`See Scottish data sources for <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
        ,
        <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
        , and
        <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
        .`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function vc(r){let e=r[3].name+"",t;return{c(){t=O(e)},m(n,o){k(n,t,o)},p(n,o){o&8&&e!==(e=n[3].name+"")&&oe(t,e)},d(n){n&&L(t)}}}function $c(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[vc,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function kc(r){let e,t;const n=[Le("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[$c]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new un({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&3?We(n,[n[0],i&2&&{paint:{"circle-color":l[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Lc(r){let e=r[3].name+"",t;return{c(){t=O(e)},m(n,o){k(n,t,o)},p(n,o){o&8&&e!==(e=n[3].name+"")&&oe(t,e)},d(n){n&&L(t)}}}function Sc(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Lc,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Mc(r){let e,t;const n=[Le("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Sc]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new un({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&3?We(n,[n[0],i&2&&{paint:{"circle-color":l[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Cc(r){let e=r[3].name+"",t,n,o=r[3].pupils+"",l,i;return{c(){t=O(e),n=O(" with "),l=O(o),i=O(" pupils")},m(s,a){k(s,t,a),k(s,n,a),k(s,l,a),k(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&oe(t,e),a&8&&o!==(o=s[3].pupils+"")&&oe(l,o)},d(s){s&&(L(t),L(n),L(l),L(i))}}}function Tc(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Cc,({props:n})=>({3:n}),({props:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Ac(r){let e,t;const n=[Le("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[Tc]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new un({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&3?We(n,[n[0],i&2&&{paint:{"circle-color":l[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:l[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Fc(r){let e,t,n,o,l,i,s,a,f,u,c,_=r[0]&&_l(r);return o=new Ke({props:{data:Lt("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[kc]},$$scope:{ctx:r}}}),i=new Ke({props:{data:Lt("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[Mc]},$$scope:{ctx:r}}}),a=new Ke({props:{data:Lt("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[Ac]},$$scope:{ctx:r}}}),{c(){e=$("button"),e.textContent="POIs",t=C(),_&&_.c(),n=C(),T(o.$$.fragment),l=C(),T(i.$$.fragment),s=C(),T(a.$$.fragment),E(e,"class","secondary")},m(d,m){k(d,e,m),k(d,t,m),_&&_.m(d,m),k(d,n,m),A(o,d,m),k(d,l,m),A(i,d,m),k(d,s,m),A(a,d,m),f=!0,u||(c=X(e,"click",r[2]),u=!0)},p(d,[m]){d[0]?_?(_.p(d,m),m&1&&b(_,1)):(_=_l(d),_.c(),b(_,1),_.m(n.parentNode,n)):_&&(be(),S(_,1,1,()=>{_=null}),ye());const g={};m&17&&(g.$$scope={dirty:m,ctx:d}),o.$set(g);const w={};m&17&&(w.$$scope={dirty:m,ctx:d}),i.$set(w);const h={};m&17&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){f||(b(_),b(o.$$.fragment,d),b(i.$$.fragment,d),b(a.$$.fragment,d),f=!0)},o(d){S(_),S(o.$$.fragment,d),S(i.$$.fragment,d),S(a.$$.fragment,d),f=!1},d(d){d&&(L(e),L(t),L(n),L(l),L(s)),_&&_.d(d),F(o,d),F(i,d),F(a,d),u=!1,c()}}}function Ec(r,e,t){let n=!1;return[n,{Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"},()=>t(0,n=!n)]}class Pc extends ie{constructor(e){super(),se(this,e,Ec,Fc,re,{})}}function ml(r){let e,t,n,o,l,i;return e=new Yn({props:{colorScale:r[2],limits:r[3]}}),l=new Dt({props:{$$slots:{default:[Ic]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=C(),n=$("p"),n.textContent="Darker colours are more deprived",o=C(),T(l.$$.fragment)},m(s,a){A(e,s,a),k(s,t,a),k(s,n,a),k(s,o,a),A(l,s,a),i=!0},p(s,a){const f={};a&512&&(f.$$scope={dirty:a,ctx:s}),l.$set(f)},i(s){i||(b(e.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(l.$$.fragment,s),i=!1},d(s){s&&(L(t),L(n),L(o)),F(e,s),F(l,s)}}}function Ic(r){let e;return{c(){e=$("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      . SIMD combines different domains: income; employment; health; education, skills
      and training; geographic access to services; crime; and housing.`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function pl(r){let e,t,n,o,l,i;return e=new Yn({props:{colorScale:r[4],limits:r[5]}}),l=new Dt({props:{$$slots:{default:[jc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=C(),n=$("p"),n.textContent="Darker colours are denser",o=C(),T(l.$$.fragment)},m(s,a){A(e,s,a),k(s,t,a),k(s,n,a),k(s,o,a),A(l,s,a),i=!0},p(s,a){const f={};a&512&&(f.$$scope={dirty:a,ctx:s}),l.$set(f)},i(s){i||(b(e.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(l.$$.fragment,s),i=!1},d(s){s&&(L(t),L(n),L(o)),F(e,s),F(l,s)}}}function jc(r){let e;return{c(){e=$("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      .`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Nc(r){let e,t,n=r[8].id+"",o,l,i=r[8].population.toLocaleString()+"",s,a,f=r[8].imd_rank+"",u,c,_=r[8].imd_percentile+"",d,m;return{c(){e=$("p"),t=O("Data zone "),o=O(n),l=O(`
        has `),s=O(i),a=O(`
        people, and a SIMD rank of `),u=O(f),c=O(", putting it in the "),d=O(_),m=O(`
        percentile.`)},m(g,w){k(g,e,w),p(e,t),p(e,o),p(e,l),p(e,s),p(e,a),p(e,u),p(e,c),p(e,d),p(e,m)},p(g,w){w&256&&n!==(n=g[8].id+"")&&oe(o,n),w&256&&i!==(i=g[8].population.toLocaleString()+"")&&oe(s,i),w&256&&f!==(f=g[8].imd_rank+"")&&oe(u,f),w&256&&_!==(_=g[8].imd_percentile+"")&&oe(d,_)},d(g){g&&L(e)}}}function Oc(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Nc,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&768&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Bc(r){let e,t,n=r[8].id+"",o,l,i=r[8].population.toLocaleString()+"",s,a,f=Math.round(r[8].population/(r[8].area/1e6)).toLocaleString()+"",u,c;return{c(){e=$("p"),t=O("Data zone "),o=O(n),l=O(`
        has `),s=O(i),a=O(`
        people, with a density of `),u=O(f),c=O(" people per square kilometer")},m(_,d){k(_,e,d),p(e,t),p(e,o),p(e,l),p(e,s),p(e,a),p(e,u),p(e,c)},p(_,d){d&256&&n!==(n=_[8].id+"")&&oe(o,n),d&256&&i!==(i=_[8].population.toLocaleString()+"")&&oe(s,i),d&256&&f!==(f=Math.round(_[8].population/(_[8].area/1e6)).toLocaleString()+"")&&oe(u,f)},d(_){_&&L(e)}}}function Rc(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Bc,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&768&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function zc(r){let e,t,n,o,l,i;const s=[Le("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":sn(["get","imd_percentile"],r[3],r[2]),"fill-opacity":ct(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[Oc]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=pe(a,s[d]);e=new Ct({props:a});const f=[Le("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":sn(["/",["get","population"],["/",["get","area"],1e6]],r[5],r[4]),"fill-opacity":ct(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={$$slots:{default:[Rc]},$$scope:{ctx:r}};for(let d=0;d<f.length;d+=1)u=pe(u,f[d]);n=new Ct({props:u});const c=[Le("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=pe(_,c[d]);return l=new xe({props:_}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment)},m(d,m){A(e,d,m),k(d,t,m),A(n,d,m),k(d,o,m),A(l,d,m),i=!0},p(d,m){const g=m&13?We(s,[s[0],s[1],s[2],m&12&&{paint:{"fill-color":sn(["get","imd_percentile"],d[3],d[2]),"fill-opacity":ct(.7,.9)}},m&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};m&512&&(g.$$scope={dirty:m,ctx:d}),e.$set(g);const w=m&50?We(f,[f[0],f[1],f[2],m&48&&{paint:{"fill-color":sn(["/",["get","population"],["/",["get","area"],1e6]],d[5],d[4]),"fill-opacity":ct(.7,.9)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};m&512&&(w.$$scope={dirty:m,ctx:d}),n.$set(w);const h=m&3?We(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};l.$set(h)},i(d){i||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(l.$$.fragment,d),i=!1},d(d){d&&(L(t),L(o)),F(e,d),F(n,d),F(l,d)}}}function Dc(r){let e,t,n,o,l,i,s,a,f,u,c=r[0]&&ml(r),_=r[1]&&pl(r);return s=new kr({props:{url:`pmtiles://${Lt("cnt_layers/population.pmtiles")}`,$$slots:{default:[zc]},$$scope:{ctx:r}}}),{c(){e=$("button"),e.textContent="SIMD",t=C(),c&&c.c(),n=C(),o=$("button"),o.textContent="Population density",l=C(),_&&_.c(),i=C(),T(s.$$.fragment),E(e,"class","secondary"),E(o,"class","secondary")},m(d,m){k(d,e,m),k(d,t,m),c&&c.m(d,m),k(d,n,m),k(d,o,m),k(d,l,m),_&&_.m(d,m),k(d,i,m),A(s,d,m),a=!0,f||(u=[X(e,"click",r[6]),X(o,"click",r[7])],f=!0)},p(d,[m]){d[0]?c?(c.p(d,m),m&1&&b(c,1)):(c=ml(d),c.c(),b(c,1),c.m(n.parentNode,n)):c&&(be(),S(c,1,1,()=>{c=null}),ye()),d[1]?_?(_.p(d,m),m&2&&b(_,1)):(_=pl(d),_.c(),b(_,1),_.m(i.parentNode,i)):_&&(be(),S(_,1,1,()=>{_=null}),ye());const g={};m&515&&(g.$$scope={dirty:m,ctx:d}),s.$set(g)},i(d){a||(b(c),b(_),b(s.$$.fragment,d),a=!0)},o(d){S(c),S(_),S(s.$$.fragment,d),a=!1},d(d){d&&(L(e),L(t),L(n),L(o),L(l),L(i)),c&&c.d(d),_&&_.d(d),F(s,d),f=!1,rt(u)}}}function Uc(r,e,t){let n=!1,o=!1,l=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],i=[0,20,40,60,80,100],s=l.toReversed();return[n,o,l,i,s,[0,4700,13e3,33e3,94e3,198e4],()=>t(0,n=!n),()=>t(1,o=!o)]}class Hc extends ie{constructor(e){super(),se(this,e,Uc,Dc,re,{})}}function gl(r){let e,t,n,o,l,i;return l=new Dt({props:{$$slots:{default:[Gc]},$$scope:{ctx:r}}}),{c(){e=$("div"),t=$("img"),o=C(),T(l.$$.fragment),Je(t.src,n=Bi)||E(t,"src",n),E(t,"alt","National Rail logo")},m(s,a){k(s,e,a),p(e,t),p(e,o),A(l,e,null),i=!0},i(s){i||(b(l.$$.fragment,s),i=!0)},o(s){S(l.$$.fragment,s),i=!1},d(s){s&&L(e),F(l)}}}function Gc(r){let e;return{c(){e=$("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
        according to OpenStreetMap.`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Wc(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=$("p"),n=O(t)},m(o,l){k(o,e,l),p(e,n)},p(o,l){l&4&&t!==(t=(o[2].name??"Unnamed railway station")+"")&&oe(n,t)},d(o){o&&L(e)}}}function qc(r){let e,t;return e=new ht({props:{$$slots:{default:[Wc,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&12&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Jc(r){let e,t;const n=[Le("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let o={$$slots:{default:[qc]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new br({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&1?We(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:l[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Zc(r){let e,t,n,o,l,i,s,a=r[0]&&gl(r);return o=new Ke({props:{data:Lt("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[Jc]},$$scope:{ctx:r}}}),{c(){e=$("button"),e.textContent="Railway stations",t=C(),a&&a.c(),n=C(),T(o.$$.fragment),E(e,"class","secondary")},m(f,u){k(f,e,u),k(f,t,u),a&&a.m(f,u),k(f,n,u),A(o,f,u),l=!0,i||(s=X(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&b(a,1):(a=gl(f),a.c(),b(a,1),a.m(n.parentNode,n)):a&&(be(),S(a,1,1,()=>{a=null}),ye());const c={};u&9&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){l||(b(a),b(o.$$.fragment,f),l=!0)},o(f){S(a),S(o.$$.fragment,f),l=!1},d(f){f&&(L(e),L(t),L(n)),a&&a.d(f),F(o,f),i=!1,s()}}}function Kc(r,e,t){let n=!1;return[n,()=>t(0,n=!n)]}class Yc extends ie{constructor(e){super(),se(this,e,Kc,Zc,re,{})}}function hl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function bl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function yl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function wl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function vl(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function $l(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function kl(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h,y,v,M;e=new Dt({props:{$$slots:{default:[Xc]},$$scope:{ctx:r}}});let j=Te(r[7]),P=[];for(let U=0;U<j.length;U+=1)P[U]=Ll($l(r,j,U));let I=Te(r[8]),R=[];for(let U=0;U<I.length;U+=1)R[U]=Sl(vl(r,I,U));let B=Te(r[9]),D=[];for(let U=0;U<B.length;U+=1)D[U]=Ml(wl(r,B,U));let z=Te(r[10]),N=[];for(let U=0;U<z.length;U+=1)N[U]=Cl(yl(r,z,U));return{c(){T(e.$$.fragment),t=C(),n=$("label"),o=O(`Trip purpose:
    `),l=$("select");for(let U=0;U<P.length;U+=1)P[U].c();i=C(),s=$("label"),a=O(`Scenario:
    `),f=$("select");for(let U=0;U<R.length;U+=1)R[U].c();u=C(),c=$("label"),_=O(`Network type:
    `),d=$("select");for(let U=0;U<D.length;U+=1)D[U].c();m=C(),g=$("label"),w=O(`Color by:
    `),h=$("select");for(let U=0;U<N.length;U+=1)N[U].c();r[0]===void 0&&pn(()=>r[12].call(l)),r[1]===void 0&&pn(()=>r[13].call(f)),r[2]===void 0&&pn(()=>r[14].call(d)),r[3]===void 0&&pn(()=>r[15].call(h))},m(U,G){A(e,U,G),k(U,t,G),k(U,n,G),p(n,o),p(n,l);for(let K=0;K<P.length;K+=1)P[K]&&P[K].m(l,null);$t(l,r[0],!0),k(U,i,G),k(U,s,G),p(s,a),p(s,f);for(let K=0;K<R.length;K+=1)R[K]&&R[K].m(f,null);$t(f,r[1],!0),k(U,u,G),k(U,c,G),p(c,_),p(c,d);for(let K=0;K<D.length;K+=1)D[K]&&D[K].m(d,null);$t(d,r[2],!0),k(U,m,G),k(U,g,G),p(g,w),p(g,h);for(let K=0;K<N.length;K+=1)N[K]&&N[K].m(h,null);$t(h,r[3],!0),y=!0,v||(M=[X(l,"change",r[12]),X(f,"change",r[13]),X(d,"change",r[14]),X(h,"change",r[15])],v=!0)},p(U,G){const K={};if(G[1]&2&&(K.$$scope={dirty:G,ctx:U}),e.$set(K),G[0]&128){j=Te(U[7]);let Z;for(Z=0;Z<j.length;Z+=1){const te=$l(U,j,Z);P[Z]?P[Z].p(te,G):(P[Z]=Ll(te),P[Z].c(),P[Z].m(l,null))}for(;Z<P.length;Z+=1)P[Z].d(1);P.length=j.length}if(G[0]&129&&$t(l,U[0]),G[0]&256){I=Te(U[8]);let Z;for(Z=0;Z<I.length;Z+=1){const te=vl(U,I,Z);R[Z]?R[Z].p(te,G):(R[Z]=Sl(te),R[Z].c(),R[Z].m(f,null))}for(;Z<R.length;Z+=1)R[Z].d(1);R.length=I.length}if(G[0]&258&&$t(f,U[1]),G[0]&512){B=Te(U[9]);let Z;for(Z=0;Z<B.length;Z+=1){const te=wl(U,B,Z);D[Z]?D[Z].p(te,G):(D[Z]=Ml(te),D[Z].c(),D[Z].m(d,null))}for(;Z<D.length;Z+=1)D[Z].d(1);D.length=B.length}if(G[0]&516&&$t(d,U[2]),G[0]&1024){z=Te(U[10]);let Z;for(Z=0;Z<z.length;Z+=1){const te=yl(U,z,Z);N[Z]?N[Z].p(te,G):(N[Z]=Cl(te),N[Z].c(),N[Z].m(h,null))}for(;Z<N.length;Z+=1)N[Z].d(1);N.length=z.length}G[0]&1032&&$t(h,U[3])},i(U){y||(b(e.$$.fragment,U),y=!0)},o(U){S(e.$$.fragment,U),y=!1},d(U){U&&(L(t),L(n),L(i),L(s),L(u),L(c),L(m),L(g)),F(e,U),ot(P,U),ot(R,U),ot(D,U),ot(N,U),v=!1,rt(M)}}}function Xc(r){let e;return{c(){e=$("a"),e.textContent="Data from NPT",E(e,"href","https://nptscot.github.io/manual/#routenetwork"),E(e,"target","_blank")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Ll(r){let e,t=r[19]+"",n;return{c(){e=$("option"),n=O(t),e.__value=r[18],qe(e,e.__value)},m(o,l){k(o,e,l),p(e,n)},p:Y,d(o){o&&L(e)}}}function Sl(r){let e,t=r[19]+"",n;return{c(){e=$("option"),n=O(t),e.__value=r[18],qe(e,e.__value)},m(o,l){k(o,e,l),p(e,n)},p:Y,d(o){o&&L(e)}}}function Ml(r){let e,t=r[19]+"",n;return{c(){e=$("option"),n=O(t),e.__value=r[18],qe(e,e.__value)},m(o,l){k(o,e,l),p(e,n)},p:Y,d(o){o&&L(e)}}}function Cl(r){let e,t=r[19]+"",n;return{c(){e=$("option"),n=O(t),e.__value=r[18],qe(e,e.__value)},m(o,l){k(o,e,l),p(e,n)},p:Y,d(o){o&&L(e)}}}function Tl(r){let e,t,n,o,l=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=$("tr"),t=$("th"),t.textContent=`${r[19]}`,n=C(),o=$("td"),i=O(l),s=C(),a=$("td"),u=O(f),c=C(),_=$("td"),m=O(d),g=C()},m(w,h){k(w,e,h),p(e,t),p(e,n),p(e,o),p(o,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(w,h){h[0]&131072&&l!==(l=w[17][`${w[18]}_fastest_bicycle`].toLocaleString()+"")&&oe(i,l),h[0]&131072&&f!==(f=w[17][`${w[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&oe(u,f),h[0]&131072&&d!==(d=w[17][`${w[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&oe(m,d)},d(w){w&&L(e)}}}function Al(r){let e,t,n,o,l=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=$("tr"),t=$("th"),t.textContent=`${r[19]}`,n=C(),o=$("td"),i=O(l),s=C(),a=$("td"),u=O(f),c=C(),_=$("td"),m=O(d),g=C()},m(w,h){k(w,e,h),p(e,t),p(e,n),p(e,o),p(o,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(w,h){h[0]&131072&&l!==(l=w[17][`${w[18]}_quietest_bicycle`].toLocaleString()+"")&&oe(i,l),h[0]&131072&&f!==(f=w[17][`${w[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&oe(u,f),h[0]&131072&&d!==(d=w[17][`${w[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&oe(m,d)},d(w){w&&L(e)}}}function Vc(r){let e,t,n,o=r[17][r[4]].toLocaleString()+"",l,i,s,a,f=r[17].gradient+"",u,c,_,d,m,g=r[17].quietness+"",w,h,y,v,M,j,P,I,R,B,D,z,N,U,G,K,Z,te=Te(r[7]),H=[];for(let le=0;le<te.length;le+=1)H[le]=Tl(bl(r,te,le));let ve=Te(r[7]),ge=[];for(let le=0;le<ve.length;le+=1)ge[le]=Al(hl(r,ve,le));return{c(){e=$("div"),t=$("p"),n=O("Cyclists: "),l=O(o),i=C(),s=$("p"),a=O("Gradient: "),u=O(f),c=O("%"),_=C(),d=$("p"),m=O("Cycle-friendliness: "),w=O(g),h=O("%"),y=C(),v=$("details"),M=$("summary"),M.textContent="All network details",j=C(),P=$("p"),P.textContent="Fast/Direct network",I=C(),R=$("table"),B=$("tr"),B.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",D=C();for(let le=0;le<H.length;le+=1)H[le].c();z=C(),N=$("p"),N.textContent="Quiet/Indirect network",U=C(),G=$("table"),K=$("tr"),K.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Z=C();for(let le=0;le<ge.length;le+=1)ge[le].c();ae(e,"max-width","30vw"),ae(e,"max-height","60vh"),ae(e,"overflow","auto")},m(le,ue){k(le,e,ue),p(e,t),p(t,n),p(t,l),p(e,i),p(e,s),p(s,a),p(s,u),p(s,c),p(e,_),p(e,d),p(d,m),p(d,w),p(d,h),p(e,y),p(e,v),p(v,M),p(v,j),p(v,P),p(v,I),p(v,R),p(R,B),p(R,D);for(let me=0;me<H.length;me+=1)H[me]&&H[me].m(R,null);p(v,z),p(v,N),p(v,U),p(v,G),p(G,K),p(G,Z);for(let me=0;me<ge.length;me+=1)ge[me]&&ge[me].m(G,null)},p(le,ue){if(ue[0]&131088&&o!==(o=le[17][le[4]].toLocaleString()+"")&&oe(l,o),ue[0]&131072&&f!==(f=le[17].gradient+"")&&oe(u,f),ue[0]&131072&&g!==(g=le[17].quietness+"")&&oe(w,g),ue[0]&131200){te=Te(le[7]);let me;for(me=0;me<te.length;me+=1){const _e=bl(le,te,me);H[me]?H[me].p(_e,ue):(H[me]=Tl(_e),H[me].c(),H[me].m(R,null))}for(;me<H.length;me+=1)H[me].d(1);H.length=te.length}if(ue[0]&131200){ve=Te(le[7]);let me;for(me=0;me<ve.length;me+=1){const _e=hl(le,ve,me);ge[me]?ge[me].p(_e,ue):(ge[me]=Al(_e),ge[me].c(),ge[me].m(G,null))}for(;me<ge.length;me+=1)ge[me].d(1);ge.length=ve.length}},d(le){le&&L(e),ot(H,le),ot(ge,le)}}}function Qc(r){let e,t;return e=new ht({props:{openOn:"click",$$slots:{default:[Vc,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[0]&131088|o[1]&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function xc(r){let e,t;const n=[Le("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Fl(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let o={$$slots:{default:[Qc]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i[0]&112?We(n,[n[0],n[1],i[0]&80&&{paint:{"line-color":l[6],"line-width":Fl(["get",l[4]])}},i[0]&32&&{layout:{visibility:l[5]?"visible":"none"}},n[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function ed(r){let e,t,n,o,l,i,s,a=r[5]&&kl(r);return o=new kr({props:{url:`pmtiles://${Lt("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[xc]},$$scope:{ctx:r}}}),{c(){e=$("button"),e.textContent="Route network",t=C(),a&&a.c(),n=C(),T(o.$$.fragment),E(e,"class","secondary")},m(f,u){k(f,e,u),k(f,t,u),a&&a.m(f,u),k(f,n,u),A(o,f,u),l=!0,i||(s=X(e,"click",r[11]),i=!0)},p(f,u){f[5]?a?(a.p(f,u),u[0]&32&&b(a,1)):(a=kl(f),a.c(),b(a,1),a.m(n.parentNode,n)):a&&(be(),S(a,1,1,()=>{a=null}),ye());const c={};u[0]&112|u[1]&2&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){l||(b(a),b(o.$$.fragment,f),l=!0)},o(f){S(a),S(o.$$.fragment,f),l=!1},d(f){f&&(L(e),L(t),L(n)),a&&a.d(f),F(o,f),i=!1,s()}}}function Fl(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function td(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function nd(r,e,t){let n,o,l=!1,i="all",s="bicycle_go_dutch",a="fastest",f="flow",u=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],m={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};const g=()=>t(5,l=!l);function w(){i=gn(this),t(0,i),t(7,u)}function h(){s=gn(this),t(1,s),t(8,c)}function y(){a=gn(this),t(2,a),t(9,_)}function v(){f=gn(this),t(3,f),t(10,d)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&t(6,o={none:"#304ce7",flow:td(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:sn(["abs",["get","gradient"]],m.limits,m.colorScale)}[f])},[i,s,a,f,n,l,o,u,c,_,d,g,w,h,y,v]}class rd extends ie{constructor(e){super(),se(this,e,nd,ed,re,{},null,[-1,-1])}}function od(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h,y;return l=new Pc({}),s=new Hc({}),f=new Yc({}),c=new Iu({}),d=new yc({}),g=new rd({}),{c(){e=$("div"),t=$("button"),t.innerHTML=`<img src="${zf}" title="Layers" alt="Layers"/>`,n=C(),o=$("div"),T(l.$$.fragment),i=C(),T(s.$$.fragment),a=C(),T(f.$$.fragment),u=C(),T(c.$$.fragment),_=C(),T(d.$$.fragment),m=C(),T(g.$$.fragment),ae(o,"display","flex"),ae(o,"flex-direction","column"),ae(o,"visibility",r[0]?"visible":"collapse"),E(e,"class","pico"),ae(e,"display","flex"),ae(e,"flex-direction","column"),ae(e,"background","grey")},m(v,M){k(v,e,M),p(e,t),p(e,n),p(e,o),A(l,o,null),p(o,i),A(s,o,null),p(o,a),A(f,o,null),p(o,u),A(c,o,null),p(o,_),A(d,o,null),p(o,m),A(g,o,null),w=!0,h||(y=X(t,"click",r[1]),h=!0)},p(v,M){M&1&&ae(o,"visibility",v[0]?"visible":"collapse")},i(v){w||(b(l.$$.fragment,v),b(s.$$.fragment,v),b(f.$$.fragment,v),b(c.$$.fragment,v),b(d.$$.fragment,v),b(g.$$.fragment,v),w=!0)},o(v){S(l.$$.fragment,v),S(s.$$.fragment,v),S(f.$$.fragment,v),S(c.$$.fragment,v),S(d.$$.fragment,v),S(g.$$.fragment,v),w=!1},d(v){v&&L(e),F(l),F(s),F(f),F(c),F(d),F(g),h=!1,y()}}}function ld(r){let e,t;return e=new Lf({props:{defaultStyling:!0,$$slots:{default:[od]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function id(r,e,t){let n=!1;return[n,()=>t(0,n=!n)]}class sd extends ie{constructor(e){super(),se(this,e,id,ld,re,{})}}let q;const xt=new Array(128).fill(void 0);xt.push(void 0,null,!0,!1);function ke(r){return xt[r]}let yt=0,Nn=null;function kn(){return(Nn===null||Nn.byteLength===0)&&(Nn=new Uint8Array(q.memory.buffer)),Nn}const sr=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ad=typeof sr.encodeInto=="function"?function(r,e){return sr.encodeInto(r,e)}:function(r,e){const t=sr.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ut(r,e,t){if(t===void 0){const s=sr.encode(r),a=e(s.length,1)>>>0;return kn().subarray(a,a+s.length).set(s),yt=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=kn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=kn().subarray(o+i,o+n),a=ad(r,s);i+=a.written}return yt=i,o}function $n(r){return r==null}let On=null;function ee(){return(On===null||On.byteLength===0)&&(On=new Int32Array(q.memory.buffer)),On}let Un=xt.length;function fd(r){r<132||(xt[r]=Un,Un=r)}function Xe(r){const e=ke(r);return fd(r),e}const ls=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ls.decode();function at(r,e){return r=r>>>0,ls.decode(kn().subarray(r,r+e))}function He(r){Un===xt.length&&xt.push(xt.length+1);const e=Un;return Un=xt[e],xt[e]=r,e}let Bn=null;function is(){return(Bn===null||Bn.byteLength===0)&&(Bn=new Float64Array(q.memory.buffer)),Bn}let Rn=null;function ud(){return(Rn===null||Rn.byteLength===0)&&(Rn=new BigInt64Array(q.memory.buffer)),Rn}function Yr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=Yr(r[0]));for(let i=1;i<o;i++)l+=", "+Yr(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function El(r,e){const t=e(r.length*1,1)>>>0;return kn().set(r,t/1),yt=r.length,t}function cd(r,e){return r=r>>>0,is().subarray(r/8,r/8+e)}function dd(r,e){return r=r>>>0,kn().subarray(r/1,r/1+e)}function _n(r,e){try{return r.apply(this,e)}catch(t){q.__wbindgen_exn_store(He(t))}}class _d{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();q.__wbg_ltn_free(e)}constructor(e,t,n,o){try{const u=q.__wbindgen_add_to_stack_pointer(-16),c=El(e,q.__wbindgen_malloc),_=yt,d=El(t,q.__wbindgen_malloc),m=yt;var l=$n(o)?0:Ut(o,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;q.ltn_new(u,c,_,d,m,He(n),l,i);var s=ee()[u/4+0],a=ee()[u/4+1],f=ee()[u/4+2];if(f)throw Xe(a);return this.__wbg_ptr=s>>>0,this}finally{q.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getInvertedBoundary(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}getBounds(){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getBounds(o,this.__wbg_ptr);var e=ee()[o/4+0],t=ee()[o/4+1],n=cd(e,t).slice();return q.__wbindgen_free(e,t*8,8),n}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapper(o,this.__wbg_ptr);var e=ee()[o/4+0],t=ee()[o/4+1],n=dd(e,t).slice();return q.__wbindgen_free(e,t*1,1),n}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapperGj(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderModalFilters(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderNeighbourhood(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderAutoBoundaries(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_setNeighbourhoodBoundary(l,this.__wbg_ptr,i,s,He(t));var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),n=yt;q.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),o=yt,l=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;q.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,o,l,i)}setCurrentNeighbourhood(e,t){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_setCurrentNeighbourhood(l,this.__wbg_ptr,i,s,t);var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_addModalFilter(l,this.__wbg_ptr,He(e),i,s);var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const l=q.__wbindgen_add_to_stack_pointer(-16),i=Ut(t,q.__wbindgen_malloc,q.__wbindgen_realloc),s=yt;q.ltn_addManyModalFilters(l,this.__wbg_ptr,He(e),i,s);var n=ee()[l/4+0],o=ee()[l/4+1];if(o)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){q.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_addDiagonalFilter(o,this.__wbg_ptr,e);var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_rotateDiagonalFilter(o,this.__wbg_ptr,e);var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_deleteDiagonalFilter(o,this.__wbg_ptr,e);var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}toggleTravelFlow(e){q.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){q.ltn_undo(this.__wbg_ptr)}redo(){q.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getShortcutsCrossingRoad(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Xe(i);return t=a,n=f,at(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllShortcuts(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toSavefile(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const o=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_loadSavefile(o,this.__wbg_ptr,He(e));var t=ee()[o/4+0],n=ee()[o/4+1];if(n)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,o,l){let i,s;try{const m=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_compareRoute(m,this.__wbg_ptr,e,t,n,o,l);var a=ee()[m/4+0],f=ee()[m/4+1],u=ee()[m/4+2],c=ee()[m/4+3],_=a,d=f;if(c)throw _=0,d=0,Xe(u);return i=_,s=d,at(_,d)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(i,s,1)}}impactToOneDestination(e,t){let n,o;try{const c=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_impactToOneDestination(c,this.__wbg_ptr,e,t);var l=ee()[c/4+0],i=ee()[c/4+1],s=ee()[c/4+2],a=ee()[c/4+3],f=l,u=i;if(a)throw f=0,u=0,Xe(s);return n=f,o=u,at(f,u)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,o,1)}}predictImpact(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_predictImpact(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,n;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getImpactsOnRoad(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Xe(i);return t=a,n=f,at(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(t,n,1)}}getAllIntersections(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllIntersections(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getMovements(u,this.__wbg_ptr,e);var o=ee()[u/4+0],l=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=o,f=l;if(s)throw a=0,f=0,Xe(i);return t=a,n=f,at(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getDemandModel(f,this.__wbg_ptr);var n=ee()[f/4+0],o=ee()[f/4+1],l=ee()[f/4+2],i=ee()[f/4+3],s=n,a=o;if(i)throw s=0,a=0,Xe(l);return e=s,t=a,at(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,t,1)}}}async function md(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function pd(){const r={};return r.wbg={},r.wbg.__wbindgen_string_get=function(e,t){const n=ke(t),o=typeof n=="string"?n:void 0;var l=$n(o)?0:Ut(o,q.__wbindgen_malloc,q.__wbindgen_realloc),i=yt;ee()[e/4+1]=i,ee()[e/4+0]=l},r.wbg.__wbindgen_object_drop_ref=function(e){Xe(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(at(e,t));return He(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=ke(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof ke(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=ke(t),o=typeof n=="number"?n:void 0;is()[e/8+1]=$n(o)?0:o,ee()[e/4+0]=!$n(o)},r.wbg.__wbindgen_is_object=function(e){const t=ke(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return ke(e)in ke(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return He(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return ke(e)===ke(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return He(t)},r.wbg.__wbindgen_string_new=function(e,t){const n=at(e,t);return He(n)},r.wbg.__wbindgen_is_undefined=function(e){return ke(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return ke(e)==ke(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=ke(e);return He(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=ke(e)[ke(t)];return He(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(ke(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(ke(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(ke(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(ke(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(ke(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return He(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=ke(t).stack,o=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),l=yt;ee()[e/4+1]=l,ee()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(at(e,t))}finally{q.__wbindgen_free(n,o,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=ke(e).performance;return He(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return ke(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=ke(e)[t>>>0];return He(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return ke(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof ke(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(at(e,t));return He(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=ke(e).next;return He(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return _n(function(e){const t=ke(e).next();return He(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return ke(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=ke(e).value;return He(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return He(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return _n(function(e,t){const n=Reflect.get(ke(e),ke(t));return He(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return _n(function(e,t){const n=ke(e).call(ke(t));return He(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return _n(function(){const e=self.self;return He(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return _n(function(){const e=window.window;return He(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return _n(function(){const e=globalThis.globalThis;return He(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return _n(function(){const e=global.global;return He(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(ke(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=ke(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(ke(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(ke(e));return He(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=ke(e).buffer;return He(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(ke(e));return He(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){ke(e).set(ke(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return ke(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=ke(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=ke(t),o=typeof n=="bigint"?n:void 0;ud()[e/8+1]=$n(o)?BigInt(0):o,ee()[e/4+0]=!$n(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Yr(ke(t)),o=Ut(n,q.__wbindgen_malloc,q.__wbindgen_realloc),l=yt;ee()[e/4+1]=l,ee()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(at(e,t))},r.wbg.__wbindgen_memory=function(){const e=q.memory;return He(e)},r}function gd(r,e){return q=r.exports,ss.__wbindgen_wasm_module=e,Rn=null,Bn=null,On=null,Nn=null,q}async function ss(r){if(q!==void 0)return q;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=pd();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await md(await r,e);return gd(t,n)}const hd=r=>({}),Pl=r=>({}),bd=r=>({}),Il=r=>({}),yd=r=>({}),jl=r=>({});function wd(r){let e,t,n,o,l,i,s,a;const f=r[1].top,u=Be(f,r,r[0],jl),c=r[1].left,_=Be(c,r,r[0],Il),d=r[1].main,m=Be(d,r,r[0],Pl);return{c(){e=$("div"),t=$("div"),u&&u.c(),n=C(),o=$("div"),l=$("div"),_&&_.c(),i=C(),s=$("div"),m&&m.c(),E(t,"class","top svelte-29q570"),E(l,"class","left svelte-29q570"),E(s,"class","main svelte-29q570"),E(o,"class","content svelte-29q570"),E(e,"class","flex-container svelte-29q570")},m(g,w){k(g,e,w),p(e,t),u&&u.m(t,null),p(e,n),p(e,o),p(o,l),_&&_.m(l,null),p(o,i),p(o,s),m&&m.m(s,null),a=!0},p(g,[w]){u&&u.p&&(!a||w&1)&&Re(u,f,g,g[0],a?De(f,g[0],w,yd):ze(g[0]),jl),_&&_.p&&(!a||w&1)&&Re(_,c,g,g[0],a?De(c,g[0],w,bd):ze(g[0]),Il),m&&m.p&&(!a||w&1)&&Re(m,d,g,g[0],a?De(d,g[0],w,hd):ze(g[0]),Pl)},i(g){a||(b(u,g),b(_,g),b(m,g),a=!0)},o(g){S(u,g),S(_,g),S(m,g),a=!1},d(g){g&&L(e),u&&u.d(g),_&&_.d(g),m&&m.d(g)}}}function vd(r,e,t){let{$$slots:n={},$$scope:o}=e;return r.$$set=l=>{"$$scope"in l&&t(0,o=l.$$scope)},[o,n]}class $d extends ie{constructor(e){super(),se(this,e,vd,wd,re,{})}}const kd=r=>({}),Nl=r=>({}),Ld=r=>({}),Ol=r=>({}),Sd=r=>({}),Bl=r=>({});function Md(r){let e,t,n,o,l,i;const s=r[4].top,a=Be(s,r,r[3],Bl),f=r[4].sidebar,u=Be(f,r,r[3],Ol),c=r[4].map,_=Be(c,r,r[3],Nl);return{c(){e=$("div"),a&&a.c(),t=C(),n=$("div"),u&&u.c(),o=C(),l=$("div"),_&&_.c()},m(d,m){k(d,e,m),a&&a.m(e,null),r[5](e),k(d,t,m),k(d,n,m),u&&u.m(n,null),r[6](n),k(d,o,m),k(d,l,m),_&&_.m(l,null),r[7](l),i=!0},p(d,[m]){a&&a.p&&(!i||m&8)&&Re(a,s,d,d[3],i?De(s,d[3],m,Sd):ze(d[3]),Bl),u&&u.p&&(!i||m&8)&&Re(u,f,d,d[3],i?De(f,d[3],m,Ld):ze(d[3]),Ol),_&&_.p&&(!i||m&8)&&Re(_,c,d,d[3],i?De(c,d[3],m,kd):ze(d[3]),Nl)},i(d){i||(b(a,d),b(u,d),b(_,d),i=!0)},o(d){S(a,d),S(u,d),S(_,d),i=!1},d(d){d&&(L(e),L(t),L(n),L(o),L(l)),a&&a.d(d),r[5](null),u&&u.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function Cd(r,e,t){let n,o,l;V(r,Xr,c=>t(0,n=c)),V(r,Vr,c=>t(1,o=c)),V(r,Qr,c=>t(2,l=c));let{$$slots:i={},$$scope:s}=e;function a(c){Ge[c?"unshift":"push"](()=>{n=c,Xr.set(n)})}function f(c){Ge[c?"unshift":"push"](()=>{o=c,Vr.set(o)})}function u(c){Ge[c?"unshift":"push"](()=>{l=c,Qr.set(l)})}return r.$$set=c=>{"$$scope"in c&&t(3,s=c.$$scope)},[n,o,l,s,i,a,f,u]}class Tt extends ie{constructor(e){super(),se(this,e,Cd,Md,re,{})}}let Xr=St(null),Vr=St(null),Qr=St(null);function Td(r){let e;return{c(){e=O("Back")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Ad(r){let e,t,n,o;return e=new Me({props:{$$slots:{default:[Td]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0,n||(o=X(window,"keydown",r[1]),n=!0)},p(l,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l),n=!1,o()}}}function Fd(r){let e=fn();function t(o){o.key=="Escape"&&(o.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class cn extends ie{constructor(e){super(),se(this,e,Fd,Ad,re,{})}}function xr(r,e,t){let n=new Set(r.toSavefile().features.filter(o=>o.properties.kind=="boundary").map(o=>o.properties.name));for(;;){let o=window.prompt(e,t);if(!o)return null;if(n.has(o))window.alert(`There is already a neighbourhood called ${o}; please pick another name`);else return o}}function Ed(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Pd(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Id(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Me({props:{$$slots:{default:[Ed]},$$scope:{ctx:r}}}),l.$on("click",r[10]),a=new Me({props:{$$slots:{default:[Pd]},$$scope:{ctx:r}}}),a.$on("click",r[11]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),u.textContent="Use an auto-generated boundary",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(_,d){k(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),c=!0},p(_,d){const m={};d&16384&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&16384&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&L(e),F(l),F(a)}}}function jd(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h;return t=new cn({}),t.$on("click",r[7]),{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),o.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,l=C(),i=$("button"),i.textContent="Export to GeoJSON",s=C(),a=$("label"),f=O(`Minimum area (km²)
      `),u=$("input"),c=C(),_=$("label"),d=$("input"),m=O(`
      Remove areas not touching a big road`),E(i,"class","secondary"),E(u,"type","number"),E(u,"min","0"),E(u,"max","1"),E(u,"step","0.01"),E(d,"type","checkbox"),E(e,"slot","sidebar")},m(y,v){k(y,e,v),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),p(a,f),p(a,u),qe(u,r[0]),p(e,c),p(e,_),p(_,d),d.checked=r[1],p(_,m),g=!0,w||(h=[X(i,"click",r[5]),X(u,"input",r[8]),X(d,"change",r[9])],w=!0)},p(y,v){v&1&&lo(u.value)!==y[0]&&qe(u,y[0]),v&2&&(d.checked=y[1])},i(y){g||(b(t.$$.fragment,y),g=!0)},o(y){S(t.$$.fragment,y),g=!1},d(y){y&&L(e),F(t),w=!1,rt(h)}}}function Nd(r){let e,t,n,o;const l=[Le("auto-boundaries-areas"),{filter:r[6](r[0],r[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":ct(.3,.7)}},{hoverCursor:"pointer"}];let i={};for(let f=0;f<l.length;f+=1)i=pe(i,l[f]);e=new Ct({props:i}),e.$on("click",r[4]);const s=[Le("auto-boundaries-severances"),{filter:dc},{manageHoverState:!0},{paint:{"line-color":ct("black","red"),"line-width":3}}];let a={};for(let f=0;f<s.length;f+=1)a=pe(a,s[f]);return n=new xe({props:a}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),o=!0},p(f,u){const c=u&67?We(l,[l[0],{filter:f[6](f[0],f[1])},l[2],l[3],l[4]]):{};e.$set(c);const _={};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),o=!1},d(f){f&&L(t),F(e,f),F(n,f)}}}function Od(r){let e,t,n;return t=new Ke({props:{data:r[3],generateId:!0,$$slots:{default:[Nd]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","map")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&16387&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function Bd(r){let e,t;return e=new Tt({props:{$$slots:{map:[Od],sidebar:[jd],top:[Id]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&16391&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Rd(r,e,t){let n,o,l;V(r,fe,h=>t(2,n=h)),V(r,Hn,h=>t(12,o=h)),V(r,Ve,h=>t(13,l=h));let i=l.renderAutoBoundaries(),s=0,a=!0;function f(h){let y=xr(l,"What do you want to name the neighbourhood?","");if(y)try{let v={type:"Feature",properties:{},geometry:i.features[h.detail.features[0].id].geometry};l.setNeighbourhoodBoundary(y,v),Ln(),l.setCurrentNeighbourhood(y,o),x(fe,n={mode:"neighbourhood"},n)}catch(v){console.log(v),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function u(){mr("auto_boundaries.geojson",JSON.stringify(i,null,"  "))}function c(h,y){let v=["all",cc,[">=",["get","area_km2"],h]];return y&&v.push(["get","touches_big_road"]),v}const _=()=>x(fe,n={mode:"pick-neighbourhood"},n);function d(){s=lo(this.value),t(0,s)}function m(){a=this.checked,t(1,a)}return[s,a,n,i,f,u,c,_,d,m,()=>x(fe,n={mode:"title",firstLoad:!1},n),()=>x(fe,n={mode:"pick-neighbourhood"},n)]}class zd extends ie{constructor(e){super(),se(this,e,Rd,Bd,re,{})}}let as=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],fs=[20,30,40,50,60,70];const hn={mapFeature:{hover:{backgroundColor:"blue"}}};let ar=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"];function Dd(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Ud(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Hd(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Me({props:{$$slots:{default:[Dd]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Me({props:{$$slots:{default:[Ud]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),u.textContent="Debug demand model",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(_,d){k(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),c=!0},p(_,d){const m={};d&65536&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&L(e),F(l),F(a)}}}function Gd(r){let e;return{c(){e=$("p"),e.textContent="Hover on a zone"},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Wd(r){let e,t=r[6].properties.name+"",n,o,l,i,s=r[6].properties.sum_from.toLocaleString()+"",a,f,u,c,_=r[6].properties.sum_to.toLocaleString()+"",d,m,g,w,h=r[6].properties.counts_from[r[3]]+"",y;return{c(){e=$("u"),n=O(t),o=C(),l=$("p"),i=O("Total trips from here: "),a=O(s),f=C(),u=$("p"),c=O("Total trips to here: "),d=O(_),m=C(),g=$("p"),w=O("Total intra-zonal trips starting and ending here: "),y=O(h)},m(v,M){k(v,e,M),p(e,n),k(v,o,M),k(v,l,M),p(l,i),p(l,a),k(v,f,M),k(v,u,M),p(u,c),p(u,d),k(v,m,M),k(v,g,M),p(g,w),p(g,y)},p(v,M){M&64&&t!==(t=v[6].properties.name+"")&&oe(n,t),M&64&&s!==(s=v[6].properties.sum_from.toLocaleString()+"")&&oe(a,s),M&64&&_!==(_=v[6].properties.sum_to.toLocaleString()+"")&&oe(d,_),M&72&&h!==(h=v[6].properties.counts_from[v[3]]+"")&&oe(y,h)},d(v){v&&(L(e),L(o),L(l),L(f),L(u),L(m),L(g))}}}function qd(r){let e,t,n,o,l=r[0].features.length.toLocaleString()+"",i,s,a,f,u,c,_,d,m,g,w=r[1]?"from":"to",h,y,v=r[3]==null?"each zone":"this zone",M,j,P,I,R,B,D,z,N,U;t=new cn({}),t.$on("click",r[9]),I=new Yn({props:{colorScale:ar,limits:r[5]}});function G(te,H){return te[6]&&te[3]!=null?Wd:Gd}let K=G(r),Z=K(r);return{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),i=O(l),s=O(" zones"),a=C(),f=$("label"),u=O(`Trips from
      `),c=$("input"),_=O(`
      Trips to`),d=C(),m=$("p"),g=O("Trips "),h=O(w),y=C(),M=O(v),j=O(":"),P=C(),T(I.$$.fragment),R=C(),B=$("hr"),D=C(),Z.c(),E(c,"type","checkbox"),E(c,"role","switch"),E(e,"slot","sidebar")},m(te,H){k(te,e,H),A(t,e,null),p(e,n),p(e,o),p(o,i),p(o,s),p(e,a),p(e,f),p(f,u),p(f,c),c.checked=r[1],p(f,_),p(e,d),p(e,m),p(m,g),p(m,h),p(m,y),p(m,M),p(m,j),p(e,P),A(I,e,null),p(e,R),p(e,B),p(e,D),Z.m(e,null),z=!0,N||(U=X(c,"change",r[10]),N=!0)},p(te,H){(!z||H&1)&&l!==(l=te[0].features.length.toLocaleString()+"")&&oe(i,l),H&2&&(c.checked=te[1]),(!z||H&2)&&w!==(w=te[1]?"from":"to")&&oe(h,w),(!z||H&8)&&v!==(v=te[3]==null?"each zone":"this zone")&&oe(M,v);const ve={};H&32&&(ve.limits=te[5]),I.$set(ve),K===(K=G(te))&&Z?Z.p(te,H):(Z.d(1),Z=K(te),Z&&(Z.c(),Z.m(e,null)))},i(te){z||(b(t.$$.fragment,te),b(I.$$.fragment,te),z=!0)},o(te){S(t.$$.fragment,te),S(I.$$.fragment,te),z=!1},d(te){te&&L(e),F(t),F(I),Z.d(),N=!1,U()}}}function Jd(r){let e,t,n,o,l;const i=[Le("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":ct(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=pe(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new Ct({props:a}),Ge.push(()=>pt(e,"hovered",s));const f=[Le("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let u={};for(let c=0;c<f.length;c+=1)u=pe(u,f[c]);return o=new xe({props:u}),{c(){T(e.$$.fragment),n=C(),T(o.$$.fragment)},m(c,_){A(e,c,_),k(c,n,_),A(o,c,_),l=!0},p(c,_){const d=_&16?We(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":ct(.5,.1)}},i[2]]):{};!t&&_&4&&(t=!0,d.hovered=c[2],gt(()=>t=!1)),e.$set(d);const m={};o.$set(m)},i(c){l||(b(e.$$.fragment,c),b(o.$$.fragment,c),l=!0)},o(c){S(e.$$.fragment,c),S(o.$$.fragment,c),l=!1},d(c){c&&L(n),F(e,c),F(o,c)}}}function Zd(r){let e,t,n;return t=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[Jd]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","map")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&1&&(i.data=o[0]),l&65556&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function Kd(r){let e,t;return e=new Tt({props:{$$slots:{map:[Zd],sidebar:[qd],top:[Hd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&65791&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Yd(r,e,t){let n,o,l,i,s,a;V(r,fe,v=>t(7,s=v)),V(r,Ve,v=>t(13,a=v));let f=en();try{f=a.getDemandModel()}catch{window.alert("No demand model for this area"),x(fe,s={mode:"pick-neighbourhood"},s)}let u=!1,c=null;function _(v,M){if(v==null){let j=M?"sum_to":"sum_from",P=Math.max(...f.features.map(R=>R.properties[j])),I=d(P);return[I.map(R=>R.toLocaleString()),sn(["get",j],I,ar)]}else{let j=M?"counts_to":"counts_from",P=[...f.features.map(B=>B.properties[j][v])],I=Math.max(...P),R=d(I);return[R.map(B=>B.toLocaleString()),sn(["at",["id"],["literal",P]],R,ar)]}}function d(v){let M=ar.length+1;return Array.from(Array(M).keys()).map(j=>Math.round(v/(M-1)*j))}function m(v){c=v,t(2,c)}const g=()=>x(fe,s={mode:"pick-neighbourhood"},s);function w(){u=this.checked,t(1,u)}const h=()=>x(fe,s={mode:"title",firstLoad:!1},s),y=()=>x(fe,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=c==null?null:c.id),r.$$.dirty&9&&t(6,o=n!=null?f.features[n]:null),r.$$.dirty&10&&t(5,[l,i]=_(n,u),l,(t(4,i),t(3,n),t(1,u),t(2,c)))},[f,u,c,n,i,l,o,s,m,g,w,h,y]}class Xd extends ie{constructor(e){super(),se(this,e,Yd,Kd,re,{})}}function Vd(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Qd(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function xd(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Me({props:{$$slots:{default:[Vd]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new Me({props:{$$slots:{default:[Qd]},$$scope:{ctx:r}}}),a.$on("click",r[9]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),u.textContent="Debug intersections",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(_,d){k(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&L(e),F(l),F(a)}}}function Rl(r){let e,t,n,o,l,i,s;function a(u){r[7](u)}let f={list:r[0].features};return r[1]!==void 0&&(f.idx=r[1]),n=new Lr({props:f}),Ge.push(()=>pt(n,"idx",a)),{c(){e=$("button"),e.textContent="Pick another intersection",t=C(),T(n.$$.fragment),E(e,"class","secondary")},m(u,c){k(u,e,c),k(u,t,c),A(n,u,c),l=!0,i||(s=X(e,"click",r[6]),i=!0)},p(u,c){const _={};c&1&&(_.list=u[0].features),!o&&c&2&&(o=!0,_.idx=u[1],gt(()=>o=!1)),n.$set(_)},i(u){l||(b(n.$$.fragment,u),l=!0)},o(u){S(n.$$.fragment,u),l=!1},d(u){u&&(L(e),L(t)),F(n,u),i=!1,s()}}}function e_(r){let e,t,n,o,l,i;t=new cn({}),t.$on("click",r[5]);let s=r[0].features.length>0&&Rl(r);return{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),o.textContent="Purple intersections have some kind of turn restriction.",l=C(),s&&s.c(),E(e,"slot","sidebar")},m(a,f){k(a,e,f),A(t,e,null),p(e,n),p(e,o),p(e,l),s&&s.m(e,null),i=!0},p(a,f){a[0].features.length>0?s?(s.p(a,f),f&1&&b(s,1)):(s=Rl(a),s.c(),b(s,1),s.m(e,null)):s&&(be(),S(s,1,1,()=>{s=null}),ye())},i(a){i||(b(t.$$.fragment,a),b(s),i=!0)},o(a){S(t.$$.fragment,a),S(s),i=!1},d(a){a&&L(e),F(t),s&&s.d()}}}function t_(r){let e,t;const n=[Le("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new un({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function n_(r){let e,t,n,o;const l=[Le("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<l.length;f+=1)i=pe(i,l[f]);e=new xe({props:i});const s=[Le("debug-movements-fill"),{filter:["==",["id"],r[1]]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=pe(a,s[f]);return n=new Ct({props:a}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),o=!0},p(f,u){const c={};e.$set(c);const _=u&2?We(s,[s[0],{filter:["==",["id"],f[1]]},s[2]]):{};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),o=!1},d(f){f&&L(t),F(e,f),F(n,f)}}}function r_(r){let e,t,n,o,l;return t=new Ke({props:{data:dt(r[2]).getAllIntersections(),generateId:!0,$$slots:{default:[t_]},$$scope:{ctx:r}}}),o=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[n_]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),E(e,"slot","map")},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&4&&(a.data=dt(i[2]).getAllIntersections()),s&1024&&(a.$$scope={dirty:s,ctx:i}),t.$set(a);const f={};s&1&&(f.data=i[0]),s&1026&&(f.$$scope={dirty:s,ctx:i}),o.$set(f)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function o_(r){let e,t;return e=new Tt({props:{$$slots:{map:[r_],sidebar:[e_],top:[xd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1039&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function l_(r,e,t){let n,o;V(r,Ve,d=>t(2,n=d)),V(r,fe,d=>t(3,o=d));let l=en(),i=0;function s(d){t(0,l=n.getMovements(d.detail.features[0].id)),t(1,i=0)}const a=()=>x(fe,o={mode:"pick-neighbourhood"},o),f=()=>t(0,l=en());function u(d){i=d,t(1,i)}return[l,i,n,o,s,a,f,u,()=>x(fe,o={mode:"title",firstLoad:!1},o),()=>x(fe,o={mode:"pick-neighbourhood"},o)]}class i_ extends ie{constructor(e){super(),se(this,e,l_,o_,re,{})}}function s_(r){let e,t,n,o,l,i;const s=[Le("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=pe(a,s[d]);e=new Ct({props:a});const f=[Le("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let u={};for(let d=0;d<f.length;d+=1)u=pe(u,f[d]);n=new Ct({props:u});const c=[Le("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=pe(_,c[d]);return l=new xe({props:_}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment)},m(d,m){A(e,d,m),k(d,t,m),A(n,d,m),k(d,o,m),A(l,d,m),i=!0},p(d,[m]){const g=m&1?We(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const w={};n.$set(w);const h={};l.$set(h)},i(d){i||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(l.$$.fragment,d),i=!1},d(d){d&&(L(t),L(o)),F(e,d),F(n,d),F(l,d)}}}function a_(r,e,t){let n;return V(r,_r,o=>t(0,n=o)),[n]}class Sr extends ie{constructor(e){super(),se(this,e,a_,s_,re,{})}}function f_(r){let e,t;const n=[Le("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new Ct({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}class Mr extends ie{constructor(e){super(),se(this,e,null,f_,re,{})}}const u_=r=>({}),zl=r=>({});function Dl(r){let e;const t=r[7]["line-popup"],n=Be(t,r,r[9],zl);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&512)&&Re(n,t,o,o[9],e?De(t,o[9],l,u_):ze(o[9]),zl)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function c_(r){let e,t,n=r[0]&&Dl(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=Dl(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function d_(r){let e,t,n,o;const l=[Le("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let f=0;f<l.length;f+=1)i=pe(i,l[f]);e=new xe({props:i});const s=[Le("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":ct(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[c_]},$$scope:{ctx:r}};for(let f=0;f<s.length;f+=1)a=pe(a,s[f]);return n=new xe({props:a}),n.$on("click",r[8]),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),o=!0},p(f,[u]){const c=u&84?We(l,[l[0],l[1],{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=u&125?We(s,[s[0],s[1],u&124&&{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":f[5](f[3],f[4].maxShortcuts),"line-opacity":ct(1,.5)}},u&1&&{manageHoverState:f[0]},u&1&&{hoverCursor:f[0]?"pointer":void 0}]):{};u&513&&(_.$$scope={dirty:u,ctx:f}),n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),o=!1},d(f){f&&L(t),F(e,f),F(n,f)}}}function __(r,e,t){let n,o;V(r,Hr,d=>t(2,n=d)),V(r,_r,d=>t(3,o=d));let{$$slots:l={},$$scope:i}=e,s=io("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:f=(d,m)=>{}}=e;function u(d,m){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?sn(["get","speed_mph"],fs,as):m<=2?ct("white","blue"):ct(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",m,"#A32015"],hn.mapFeature.hover.backgroundColor)}function c(d,m,g){return!d||m<=2?nn(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,m,25+g]}const _=d=>a&&f(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&t(0,a=d.interactive),"onClickLine"in d&&t(1,f=d.onClickLine),"$$scope"in d&&t(9,i=d.$$scope)},[a,f,n,o,s,u,c,l,_,i]}class Vn extends ie{constructor(e){super(),se(this,e,__,d_,re,{interactive:0,onClickLine:1})}}function m_(r){let e;const t=r[3].default,n=Be(t,r,r[5],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&32)&&Re(n,t,o,o[5],e?De(t,o[5],l,null):ze(o[5]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function p_(r){let e,t,n,o;const l=[Le("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[m_]},$$scope:{ctx:r}};for(let f=0;f<l.length;f+=1)i=pe(i,l[f]);e=new br({props:i}),e.$on("click",r[4]);const s=[Le("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let f=0;f<s.length;f+=1)a=pe(a,s[f]);return n=new br({props:a}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),o=!0},p(f,u){const c={};u&32&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),o=!1},d(f){f&&L(t),F(e,f),F(n,f)}}}function g_(r){let e,t;return e=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[p_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&32&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function h_(r,e,t){let n,o,l;V(r,Ve,f=>t(1,o=f)),V(r,jt,f=>t(2,l=f));let{$$slots:i={},$$scope:s}=e;function a(f){Ne.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&t(5,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=l>0?o.renderModalFilters():en())},[n,o,l,i,a,s]}class dn extends ie{constructor(e){super(),se(this,e,h_,g_,re,{})}}function b_(r){let e,t;const n=[Le("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new br({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}class Cr extends ie{constructor(e){super(),se(this,e,null,b_,re,{})}}function y_(r){let e;const t=r[3].default,n=Be(t,r,r[4],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16)&&Re(n,t,o,o[4],e?De(t,o[4],l,null):ze(o[4]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function w_(r){let e,t;return e=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[y_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function v_(r,e,t){let n,o;V(r,Ve,a=>t(2,o=a));let{$$slots:l={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&t(1,s=a.input),"$$scope"in a&&t(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||o.renderNeighbourhood()),r.$$.dirty&1&&Oi("neighbourhoodGj",n)},[n,s,o,l,i]}class Qn extends ie{constructor(e){super(),se(this,e,v_,w_,re,{input:1})}}function $_(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function k_(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function L_(r){let e;return{c(){e=O("Editing")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function S_(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;return l=new Me({props:{$$slots:{default:[$_]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new Me({props:{$$slots:{default:[k_]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Me({props:{$$slots:{default:[L_]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),T(c.$$.fragment),_=C(),d=$("li"),d.textContent="Debug mode",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(g,w){k(g,e,w),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),A(c,u,null),p(n,_),p(n,d),m=!0},p(g,w){const h={};w&4096&&(h.$$scope={dirty:w,ctx:g}),l.$set(h);const y={};w&4096&&(y.$$scope={dirty:w,ctx:g}),a.$set(y);const v={};w&4096&&(v.$$scope={dirty:w,ctx:g}),c.$set(v)},i(g){m||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){S(l.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&L(e),F(l),F(a),F(c)}}}function Ul(r){let e,t,n;return{c(){e=$("button"),e.textContent="Ⓧ",E(e,"class","close-btn svelte-khnvno")},m(o,l){k(o,e,l),t||(n=X(e,"click",r[6]),t=!0)},p:Y,d(o){o&&L(e),t=!1,n()}}}function M_(r){let e;return{c(){e=$("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){k(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&L(e)}}}function C_(r){let e,t,n,o,l,i,s;e=new Kn({props:{properties:r[0].feature.properties}});function a(u){r[7](u)}let f={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(f.idx=r[0].movementIdx),l=new Lr({props:f}),Ge.push(()=>pt(l,"idx",a)),{c(){T(e.$$.fragment),t=C(),n=$("h5"),n.textContent="Turn restrictions:",o=C(),T(l.$$.fragment)},m(u,c){A(e,u,c),k(u,t,c),k(u,n,c),k(u,o,c),A(l,u,c),s=!0},p(u,c){const _={};c&1&&(_.properties=u[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=u[0].movements.features),!i&&c&1&&(i=!0,d.idx=u[0].movementIdx,gt(()=>i=!1)),l.$set(d)},i(u){s||(b(e.$$.fragment,u),b(l.$$.fragment,u),s=!0)},o(u){S(e.$$.fragment,u),S(l.$$.fragment,u),s=!1},d(u){u&&(L(t),L(n),L(o)),F(e,u),F(l,u)}}}function T_(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;t=new cn({}),t.$on("click",r[5]);let g=r[0]&&Ul(r);const w=[C_,M_],h=[];function y(v,M){return v[0]?0:1}return _=y(r),d=h[_]=w[_](r),{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("h4"),o.textContent="Roads",l=C(),i=$("p"),i.textContent="Click a road to visit its OSM object.",s=C(),a=$("div"),f=$("h4"),f.textContent="Intersections",u=C(),g&&g.c(),c=C(),d.c(),ae(a,"display","flex"),ae(a,"align-items","start"),ae(a,"justify-content","space-between"),E(e,"slot","sidebar")},m(v,M){k(v,e,M),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),p(a,f),p(a,u),g&&g.m(a,null),p(e,c),h[_].m(e,null),m=!0},p(v,M){v[0]?g?g.p(v,M):(g=Ul(v),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let j=_;_=y(v),_===j?h[_].p(v,M):(be(),S(h[j],1,1,()=>{h[j]=null}),ye(),d=h[_],d?d.p(v,M):(d=h[_]=w[_](v),d.c()),b(d,1),d.m(e,null))},i(v){m||(b(t.$$.fragment,v),b(d),m=!0)},o(v){S(t.$$.fragment,v),S(d),m=!1},d(v){v&&L(e),F(t),g&&g.d(),h[_].d()}}}function A_(r){let e,t;return e=new Kn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function F_(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[A_,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function E_(r){let e,t;return e=new Kn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function P_(r){let e,t,n;return t=new ht({props:{openOn:"hover",$$slots:{default:[E_,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","line-popup")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&6144&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function I_(r){let e,t,n,o,l,i,s,a,f,u;e=new Mr({}),n=new Sr({}),l=new Cr({});const c=[Le("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[F_]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=pe(_,c[d]);return s=new un({props:_}),f=new Vn({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[P_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),T(s.$$.fragment),a=C(),T(f.$$.fragment)},m(d,m){A(e,d,m),k(d,t,m),A(n,d,m),k(d,o,m),A(l,d,m),k(d,i,m),A(s,d,m),k(d,a,m),A(f,d,m),u=!0},p(d,m){const g={};m&4096&&(g.$$scope={dirty:m,ctx:d}),s.$set(g);const w={};m&4096&&(w.$$scope={dirty:m,ctx:d}),f.$set(w)},i(d){u||(b(e.$$.fragment,d),b(n.$$.fragment,d),b(l.$$.fragment,d),b(s.$$.fragment,d),b(f.$$.fragment,d),u=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(l.$$.fragment,d),S(s.$$.fragment,d),S(f.$$.fragment,d),u=!1},d(d){d&&(L(t),L(o),L(i),L(a)),F(e,d),F(n,d),F(l,d),F(s,d),F(f,d)}}}function j_(r){let e,t;return e=new Kn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function N_(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[j_,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function O_(r){let e,t;return e=new Kn({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function B_(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[O_,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function R_(r){var l,i,s;let e,t;const n=[Le("debug-intersections"),{paint:{"circle-radius":Kr(30),"circle-color":hn.mapFeature.hover.backgroundColor,"circle-stroke-color":hn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ct(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(l=r[0])==null?void 0:l.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,ct(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[B_]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)o=pe(o,n[a]);return e=new un({props:o}),e.$on("click",r[3]),{c(){T(e.$$.fragment)},m(a,f){A(e,a,f),t=!0},p(a,f){var c,_,d;const u=f&1?We(n,[n[0],{paint:{"circle-radius":Kr(30),"circle-color":hn.mapFeature.hover.backgroundColor,"circle-stroke-color":hn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ct(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,ct(0,.5)]}},n[2],n[3]]):{};f&4096&&(u.$$scope={dirty:f,ctx:a}),e.$set(u)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){S(e.$$.fragment,a),t=!1},d(a){F(e,a)}}}function Hl(r){let e,t;return e=new Ke({props:{data:r[0].movements,generateId:!0,$$slots:{default:[z_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0].movements),o&4097&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function z_(r){let e,t,n,o;const l=[Le("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<l.length;f+=1)i=pe(i,l[f]);e=new xe({props:i});const s=[Le("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=pe(a,s[f]);return n=new Ct({props:a}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),o=!0},p(f,u){const c={};e.$set(c);const _=u&1?We(s,[s[0],{filter:["==",["id"],f[0].movementIdx]},s[2]]):{};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),o=!1},d(f){f&&L(t),F(e,f),F(n,f)}}}function D_(r){let e,t,n,o,l,i,s,a;t=new Qn({props:{$$slots:{default:[I_]},$$scope:{ctx:r}}}),o=new dn({props:{$$slots:{default:[N_]},$$scope:{ctx:r}}}),i=new Ke({props:{data:dt(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[R_]},$$scope:{ctx:r}}});let f=r[0]&&Hl(r);return{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),l=C(),T(i.$$.fragment),s=C(),f&&f.c(),E(e,"slot","map")},m(u,c){k(u,e,c),A(t,e,null),p(e,n),A(o,e,null),p(e,l),A(i,e,null),p(e,s),f&&f.m(e,null),a=!0},p(u,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),t.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:u}),o.$set(d);const m={};c&2&&(m.data=dt(u[1]).getAllIntersections()),c&4097&&(m.$$scope={dirty:c,ctx:u}),i.$set(m),u[0]?f?(f.p(u,c),c&1&&b(f,1)):(f=Hl(u),f.c(),b(f,1),f.m(e,null)):f&&(be(),S(f,1,1,()=>{f=null}),ye())},i(u){a||(b(t.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(f),a=!0)},o(u){S(t.$$.fragment,u),S(o.$$.fragment,u),S(i.$$.fragment,u),S(f),a=!1},d(u){u&&L(e),F(t),F(o),F(i),f&&f.d()}}}function U_(r){let e,t;return e=new Tt({props:{$$slots:{map:[D_],sidebar:[T_],top:[S_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function H_(r,e,t){let n,o;V(r,Ve,m=>t(1,n=m)),V(r,fe,m=>t(2,o=m));let l=null;function i(m){let g=m.detail.features[0],w=n.getMovements(g.properties.intersection_id);t(0,l={feature:g,movements:w,movementIdx:0})}const s=(m,g)=>window.open(dt(m.properties).way,"_blank"),a=()=>x(fe,o={mode:"neighbourhood"},o),f=()=>t(0,l=null);function u(m){r.$$.not_equal(l.movementIdx,m)&&(l.movementIdx=m,t(0,l))}return[l,n,o,i,s,a,f,u,()=>x(fe,o={mode:"title",firstLoad:!1},o),()=>x(fe,o={mode:"pick-neighbourhood"},o),()=>x(fe,o={mode:"neighbourhood"},o)]}class G_ extends ie{constructor(e){super(),se(this,e,H_,U_,re,{})}}var Pt=63710088e-1,us={centimeters:Pt*100,centimetres:Pt*100,degrees:360/(2*Math.PI),feet:Pt*3.28084,inches:Pt*39.37,kilometers:Pt/1e3,kilometres:Pt/1e3,meters:Pt,metres:Pt,miles:Pt/1609.344,millimeters:Pt*1e3,millimetres:Pt*1e3,nauticalmiles:Pt/1852,radians:1,yards:Pt*1.0936};function W_(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function eo(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gl(r[0])||!Gl(r[1]))throw new Error("coordinates must contain numbers");return W_({type:"Point",coordinates:r},e,t)}function q_(r,e="kilometers"){const t=us[e];if(!t)throw new Error(e+" units is invalid");return r*t}function J_(r,e="kilometers"){const t=us[e];if(!t)throw new Error(e+" units is invalid");return r/t}function to(r){return r%(2*Math.PI)*180/Math.PI}function Wt(r){return r%360*Math.PI/180}function Gl(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Zn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Z_(r){return r.type==="Feature"?r.geometry:r}function cs(r,e,t={}){if(t.final===!0)return K_(r,e);const n=Zn(r),o=Zn(e),l=Wt(n[0]),i=Wt(o[0]),s=Wt(n[1]),a=Wt(o[1]),f=Math.sin(i-l)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return to(Math.atan2(f,u))}function K_(r,e){let t=cs(e,r);return t=(t+180)%360,t}function Y_(r,e,t,n={}){const o=Zn(r),l=Wt(o[0]),i=Wt(o[1]),s=Wt(t),a=J_(e,n.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=to(u),_=to(f);return eo([c,_],n.properties)}function X_(r,e,t={}){var n=Zn(r),o=Zn(e),l=Wt(o[1]-n[1]),i=Wt(o[0]-n[0]),s=Wt(n[1]),a=Wt(o[1]),f=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return q_(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),t.units)}function V_(r,e,t={}){const o=Z_(r).coordinates;let l=0;for(let i=0;i<o.length&&!(e>=l&&i===o.length-1);i++)if(l>=e){const s=e-l;if(s){const a=cs(o[i],o[i-1])-180;return Y_(o[i],s,a,t)}else return eo(o[i])}else l+=X_(o[i],o[i+1],t);return eo(o[o.length-1])}var Q_=V_;function x_(r){let e,t;const n=[Le("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new un({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function em(r){let e,t;return e=new Ke({props:{data:r[0],$$slots:{default:[x_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}let tm=50,nm=100,rm=.01;function om(r,e,t){let{paths:n}=e,o=a(),l=f(),i=c(),s=setInterval(_,nm);Mt(()=>clearInterval(s));function a(){return n.features.map(d=>1/d.properties.directness).reduce((d,m)=>d+m,0)}function f(){return n.features.length==0?[]:Array.from({length:tm},u)}function u(){let d=Math.random()*o,m=0;for(let[g,w]of n.features.entries())if(m+=1/w.properties.directness,d<m)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${o}`)}function c(){return{type:"FeatureCollection",features:l.map(({idx:d,distance:m})=>Q_(n.features[d],m,{units:"kilometers"}))}}function _(){for(let[d,m]of l.entries())m.distance+=rm,m.distance>=n.features[m.idx].properties.length_meters/1e3&&(l[d]=u());t(0,i=c())}return r.$$set=d=>{"paths"in d&&t(1,n=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(o=a(),l=f())},[i,n]}class lm extends ie{constructor(e){super(),se(this,e,om,em,re,{paths:1})}}class im{constructor(e){st(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function sm(r){let e,t,n,o,l;return{c(){e=$("div"),e.textContent="+",t=C(),n=$("img"),l=O(`
    Add diagonal filter`),ae(e,"font-size","200%"),ae(e,"margin-top","-12px"),E(e,"class","icon"),Je(n.src,o="/ltn//filters/diagonal_filter_icon.png")||E(n,"src",o),E(n,"alt","Add diagonal filter"),ae(n,"transform","rotate(135deg)"),E(n,"class","svelte-j2s60j")},m(i,s){k(i,e,s),k(i,t,s),k(i,n,s),k(i,l,s)},p:Y,d(i){i&&(L(e),L(t),L(n),L(l))}}}function am(r){let e;function t(l,i){return l[0].hasRotatedFilter?um:fm}let n=t(r),o=n(r);return{c(){o.c(),e=Ze()},m(l,i){o.m(l,i),k(l,e,i)},p(l,i){n!==(n=t(l))&&(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&L(e),o.d(l)}}}function fm(r){let e,t,n,o,l;return{c(){e=$("div"),e.textContent="↻",t=C(),n=$("img"),l=O(`
      Rotate diagonal filter`),ae(e,"font-size","200%"),ae(e,"padding-bottom","4px"),E(e,"class","icon"),Je(n.src,o="/ltn//filters/diagonal_filter_icon.png")||E(n,"src",o),E(n,"alt","Rotate diagonal filter"),ae(n,"transform","rotate(45deg)"),E(n,"class","svelte-j2s60j")},m(i,s){k(i,e,s),k(i,t,s),k(i,n,s),k(i,l,s)},d(i){i&&(L(e),L(t),L(n),L(l))}}}function um(r){let e,t,n,o,l;return{c(){e=$("div"),e.textContent="❌",t=C(),n=$("img"),l=O(`
      Delete diagonal filter`),E(e,"class","icon"),Je(n.src,o="/ltn//filters/diagonal_filter_icon.png")||E(n,"src",o),E(n,"alt","Remove diagonal filter"),ae(n,"transform","rotate(45deg)"),E(n,"class","svelte-j2s60j")},m(i,s){k(i,e,s),k(i,t,s),k(i,n,s),k(i,l,s)},d(i){i&&(L(e),L(t),L(n),L(l))}}}function cm(r){let e;function t(l,i){return l[0].filter?am:sm}let n=t(r),o=n(r);return{c(){e=$("div"),o.c(),ae(e,"display","flex"),ae(e,"align-items","center")},m(l,i){k(l,e,i),o.m(e,null)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e,null)))},i:Y,o:Y,d(l){l&&L(e),o.d()}}}function dm(r,e,t){let{intersection:n}=e;return r.$$set=o=>{"intersection"in o&&t(0,n=o.intersection)},[n]}class _m extends ie{constructor(e){super(),se(this,e,dm,cm,re,{intersection:0})}}function mm(r){let e,t;return e=new _m({props:{intersection:r[2](r[6])}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&64&&(l.intersection=n[2](n[6])),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function pm(r){let e,t;return e=new If({props:{openOn:"hover",$$slots:{default:[mm,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function gm(r){let e,t;const n=[Le("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":Kr(30),"circle-color":hn.mapFeature.hover.backgroundColor,"circle-opacity":ct(0,.5),"circle-stroke-color":hn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":ct(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[pm]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new un({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s=i&2?We(n,[n[0],n[1],n[2],{interactive:l[1]},n[4],n[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function hm(r,e,t){let{neighbourhood:n=io("neighbourhoodGj")}=e,{onClickIntersection:o=f=>{}}=e,{interactive:l=!1}=e;function i(f){let u=n.features[f];return new im(u)}function s(f){return i(f[0].id)}const a=f=>o(s(f.detail.features));return r.$$set=f=>{"neighbourhood"in f&&t(3,n=f.neighbourhood),"onClickIntersection"in f&&t(0,o=f.onClickIntersection),"interactive"in f&&t(1,l=f.interactive)},[o,l,s,n,a]}class bm extends ie{constructor(e){super(),se(this,e,hm,gm,re,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function Wl(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function ql(r){let e,t,n,o,l,i,s=r[8]+"",a,f,u,c,_;function d(){return r[3](r[7])}return{c(){e=$("button"),t=$("img"),o=C(),l=$("br"),i=C(),a=O(s),f=C(),Je(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||E(t,"src",n),E(t,"width","80"),E(t,"alt",r[8]),E(e,"class","outline"),ae(e,"width","100%"),e.disabled=u=r[0]==r[7]},m(m,g){k(m,e,g),p(e,t),p(e,o),p(e,l),p(e,i),p(e,a),p(e,f),c||(_=X(e,"click",d),c=!0)},p(m,g){r=m,g&1&&u!==(u=r[0]==r[7])&&(e.disabled=u)},d(m){m&&L(e),c=!1,_()}}}function ym(r){let e,t,n,o,l,i,s,a,f,u,c,_,d=r[1][2]+"",m,g,w,h,y,v,M=Te(r[2]),j=[];for(let I=0;I<M.length;I+=1)j[I]=ql(Wl(r,M,I));function P(){return r[4](r[6])}return{c(){e=$("h3"),e.textContent="Choose a modal filter to place on streets",t=C(),n=$("table"),o=$("tr"),l=$("td");for(let I=0;I<j.length;I+=1)j[I].c();i=C(),s=$("td"),a=$("img"),c=C(),_=$("p"),m=O(d),g=C(),w=$("center"),h=$("button"),h.textContent="Confirm",Je(a.src,f=`/ltn//filters/${r[0]}.gif`)||E(a,"src",f),E(a,"height","300"),E(a,"alt",u=r[1][1])},m(I,R){k(I,e,R),k(I,t,R),k(I,n,R),p(n,o),p(o,l);for(let B=0;B<j.length;B+=1)j[B]&&j[B].m(l,null);p(o,i),p(o,s),p(s,a),p(s,c),p(s,_),p(_,m),k(I,g,R),k(I,w,R),p(w,h),y||(v=X(h,"click",P),y=!0)},p(I,R){if(r=I,R&5){M=Te(r[2]);let B;for(B=0;B<M.length;B+=1){const D=Wl(r,M,B);j[B]?j[B].p(D,R):(j[B]=ql(D),j[B].c(),j[B].m(l,null))}for(;B<j.length;B+=1)j[B].d(1);j.length=M.length}R&1&&!Je(a.src,f=`/ltn//filters/${r[0]}.gif`)&&E(a,"src",f),R&2&&u!==(u=r[1][1])&&E(a,"alt",u),R&2&&d!==(d=r[1][2]+"")&&oe(m,d)},d(I){I&&(L(e),L(t),L(n),L(g),L(w)),ot(j,I),y=!1,v()}}}function wm(r){let e,t;return e=new wr({props:{$$slots:{default:[ym,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&4163&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function vm(r,e,t){let n,o;V(r,Gr,f=>t(0,o=f));let l=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=f=>x(Gr,o=f,o),s=f=>dt(f).close();function a(f){Ne.call(this,r,f)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,n=l.find(f=>f[0]==o))},[o,n,l,i,s,a]}class $m extends ie{constructor(e){super(),se(this,e,vm,wm,re,{})}}function Jl(r){let e,t;return e=new Ke({props:{data:r[0],$$slots:{default:[km]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0]),o&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function km(r){let e,t;const n=[Le("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Lm(r){let e,t,n=r[0]&&Jl(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=Jl(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function Sm(r,e,t){let{map:n}=e,o=null;const l=fn();n.on("dragstart",i),n.on("mousemove",s),n.on("mouseup",a),Mt(()=>{n.dragPan.enable(),n.off("dragstart",i),n.off("mousemove",s),n.off("mouseup",a)});function i(){n.dragPan.disable(),t(0,o={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(f){o&&(o.geometry.coordinates.push(f.lngLat.toArray()),t(0,o))}function a(){o&&(l("done",o),t(0,o=null))}return r.$$set=f=>{"map"in f&&t(1,n=f.map)},[o,n]}class Mm extends ie{constructor(e){super(),se(this,e,Sm,Lm,re,{map:1})}}function Cm(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Tm(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Am(r){let e;return{c(){e=$("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Fm(r){let e;return{c(){e=O("View shortcuts")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Em(r){let e;return{c(){e=O("Route")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Pm(r){let e;return{c(){e=O("Impact routing to one destination")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Im(r){let e;return{c(){e=O("Change this boundary")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function jm(r){let e;return{c(){e=O("Debug")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Nm(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h,y,v,M,j,P,I,R,B,D,z,N,U,G;return l=new Me({props:{$$slots:{default:[Cm]},$$scope:{ctx:r}}}),l.$on("click",r[31]),a=new Me({props:{$$slots:{default:[Tm]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new Dt({props:{$$slots:{default:[Am]},$$scope:{ctx:r}}}),h=new Me({props:{$$slots:{default:[Fm]},$$scope:{ctx:r}}}),h.$on("click",r[33]),M=new Me({props:{$$slots:{default:[Em]},$$scope:{ctx:r}}}),M.$on("click",r[34]),I=new Me({props:{$$slots:{default:[Pm]},$$scope:{ctx:r}}}),I.$on("click",r[35]),D=new Me({props:{$$slots:{default:[Im]},$$scope:{ctx:r}}}),D.$on("click",r[36]),U=new Me({props:{$$slots:{default:[jm]},$$scope:{ctx:r}}}),U.$on("click",r[37]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),c=O(`Editing
          `),T(_.$$.fragment),d=C(),m=$("nav"),g=$("ul"),w=$("li"),T(h.$$.fragment),y=C(),v=$("li"),T(M.$$.fragment),j=C(),P=$("li"),T(I.$$.fragment),R=C(),B=$("li"),T(D.$$.fragment),z=C(),N=$("li"),T(U.$$.fragment),E(t,"aria-label","breadcrumb"),E(e,"slot","top"),ae(e,"display","flex"),ae(e,"justify-content","space-between")},m(K,Z){k(K,e,Z),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),p(u,c),A(_,u,null),p(e,d),p(e,m),p(m,g),p(g,w),A(h,w,null),p(g,y),p(g,v),A(M,v,null),p(g,j),p(g,P),A(I,P,null),p(g,R),p(g,B),A(D,B,null),p(g,z),p(g,N),A(U,N,null),G=!0},p(K,Z){const te={};Z[1]&1024&&(te.$$scope={dirty:Z,ctx:K}),l.$set(te);const H={};Z[1]&1024&&(H.$$scope={dirty:Z,ctx:K}),a.$set(H);const ve={};Z[1]&1024&&(ve.$$scope={dirty:Z,ctx:K}),_.$set(ve);const ge={};Z[1]&1024&&(ge.$$scope={dirty:Z,ctx:K}),h.$set(ge);const le={};Z[1]&1024&&(le.$$scope={dirty:Z,ctx:K}),M.$set(le);const ue={};Z[1]&1024&&(ue.$$scope={dirty:Z,ctx:K}),I.$set(ue);const me={};Z[1]&1024&&(me.$$scope={dirty:Z,ctx:K}),D.$set(me);const _e={};Z[1]&1024&&(_e.$$scope={dirty:Z,ctx:K}),U.$set(_e)},i(K){G||(b(l.$$.fragment,K),b(a.$$.fragment,K),b(_.$$.fragment,K),b(h.$$.fragment,K),b(M.$$.fragment,K),b(I.$$.fragment,K),b(D.$$.fragment,K),b(U.$$.fragment,K),G=!0)},o(K){S(l.$$.fragment,K),S(a.$$.fragment,K),S(_.$$.fragment,K),S(h.$$.fragment,K),S(M.$$.fragment,K),S(I.$$.fragment,K),S(D.$$.fragment,K),S(U.$$.fragment,K),G=!1},d(K){K&&L(e),F(l),F(a),F(_),F(h),F(M),F(I),F(D),F(U)}}}function Zl(r){let e;return{c(){e=$("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Kl(r){let e,t;return e=new Yn({props:{colorScale:as,limits:fs}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Om(r){let e,t,n;return{c(){e=O("Undo ("),t=O(r[4]),n=O(")")},m(o,l){k(o,e,l),k(o,t,l),k(o,n,l)},p(o,l){l[0]&16&&oe(t,o[4])},d(o){o&&(L(e),L(t),L(n))}}}function Bm(r){let e;return{c(){e=O("Undo")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Rm(r){let e,t,n;return{c(){e=O("Redo ("),t=O(r[5]),n=O(")")},m(o,l){k(o,e,l),k(o,t,l),k(o,n,l)},p(o,l){l[0]&32&&oe(t,o[5])},d(o){o&&(L(e),L(t),L(n))}}}function zm(r){let e;return{c(){e=O("Redo")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Yl(r){let e,t;return e=new $m({}),e.$on("close",r[30]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Dm(r){let e,t,n,o,l=dt(r[6]).properties.name+"",i,s,a=r[1].area_km2.toFixed(1)+"",f,u,c,_,d,m,g,w,h,y,v,M,j,P,I,R,B,D,z,N,U,G,K,Z,te,H,ve,ge,le,ue,me,_e,Se,Fe,ce,Ae,ft,It,ne,he,Q,Ce,we,$e,W,lt,Oe,Ue,wt,_t=r[8]>0&&Zl(),Ye=r[12]=="speeds"&&Kl();function Xt(Pe,tt){return Pe[4]==0?Bm:Om}let Vt=Xt(r),vt=Vt(r);function er(Pe,tt){return Pe[5]==0?zm:Rm}let At=er(r),Ft=At(r),et=r[3]&&Yl(r);return{c(){e=$("div"),t=$("p"),n=O("Editing neighbourhood "),o=$("u"),i=O(l),s=O(`
      , with an area of `),f=O(a),u=O(" km²"),c=C(),_t&&_t.c(),_=C(),d=$("div"),m=$("button"),g=$("img"),h=O(`
        Add a modal filter`),v=C(),M=$("button"),j=O("Add many modal filters along line"),I=C(),R=$("button"),B=O("Reverse directions"),z=C(),N=$("button"),N.textContent="Change modal filter type",U=C(),G=$("label"),K=$("input"),Z=O(`
      Animate shortcuts`),te=C(),H=$("label"),ve=$("input"),ge=O(`
      Include perimeter roads`),le=C(),ue=$("div"),me=$("label"),_e=O(`Draw roads:
        `),Se=$("select"),Fe=$("option"),Fe.textContent="Worst shortcuts",ce=$("option"),ce.textContent="Cell",Ae=$("option"),Ae.textContent="Edits (either filter or direction)",ft=$("option"),ft.textContent="Speed limit",It=C(),Ye&&Ye.c(),ne=C(),he=$("div"),Q=$("button"),vt.c(),we=C(),$e=$("button"),Ft.c(),lt=C(),et&&et.c(),Je(g.src,w=`/ltn//filters/${r[9]}_icon.gif`)||E(g,"src",w),E(g,"width","30"),E(g,"alt","Add a modal filter"),m.disabled=y=r[0]=="filter",E(m,"data-tooltip","hotkey 1"),M.disabled=P=r[0]=="freehand-filters",E(M,"data-tooltip","hotkey 2"),R.disabled=D=r[0]=="oneway",E(R,"data-tooltip","hotkey 3"),ae(d,"display","flex"),ae(d,"justify-content","space-between"),E(K,"type","checkbox"),E(ve,"type","checkbox"),Fe.__value="shortcuts",qe(Fe,Fe.__value),ce.__value="cells",qe(ce,ce.__value),Ae.__value="edits",qe(Ae,Ae.__value),ft.__value="speeds",qe(ft,ft.__value),r[12]===void 0&&pn(()=>r[29].call(Se)),ae(ue,"border","1px solid black"),ae(ue,"padding","4px"),Q.disabled=Ce=r[4]==0,E(Q,"data-tooltip","Ctrl+Z"),$e.disabled=W=r[5]==0,E($e,"data-tooltip","Ctrl+Y"),ae(he,"display","flex"),ae(he,"justify-content","space-between"),E(e,"slot","sidebar")},m(Pe,tt){k(Pe,e,tt),p(e,t),p(t,n),p(t,o),p(o,i),p(t,s),p(t,f),p(t,u),p(e,c),_t&&_t.m(e,null),p(e,_),p(e,d),p(d,m),p(m,g),p(m,h),p(d,v),p(d,M),p(M,j),p(d,I),p(d,R),p(R,B),p(e,z),p(e,N),p(e,U),p(e,G),p(G,K),K.checked=r[11],p(G,Z),p(e,te),p(e,H),p(H,ve),ve.checked=r[10],p(H,ge),p(e,le),p(e,ue),p(ue,me),p(me,_e),p(me,Se),p(Se,Fe),p(Se,ce),p(Se,Ae),p(Se,ft),$t(Se,r[12],!0),p(ue,It),Ye&&Ye.m(ue,null),p(e,ne),p(e,he),p(he,Q),vt.m(Q,null),p(he,we),p(he,$e),Ft.m($e,null),p(e,lt),et&&et.m(e,null),Oe=!0,Ue||(wt=[X(m,"click",r[23]),X(M,"click",r[24]),X(R,"click",r[25]),X(N,"click",r[26]),X(K,"change",r[27]),X(ve,"change",r[28]),X(ve,"change",r[14]),X(Se,"change",r[29]),X(Q,"click",r[19]),X($e,"click",r[20])],Ue=!0)},p(Pe,tt){(!Oe||tt[0]&64)&&l!==(l=dt(Pe[6]).properties.name+"")&&oe(i,l),(!Oe||tt[0]&2)&&a!==(a=Pe[1].area_km2.toFixed(1)+"")&&oe(f,a),Pe[8]>0?_t||(_t=Zl(),_t.c(),_t.m(e,_)):_t&&(_t.d(1),_t=null),(!Oe||tt[0]&512&&!Je(g.src,w=`/ltn//filters/${Pe[9]}_icon.gif`))&&E(g,"src",w),(!Oe||tt[0]&1&&y!==(y=Pe[0]=="filter"))&&(m.disabled=y),(!Oe||tt[0]&1&&P!==(P=Pe[0]=="freehand-filters"))&&(M.disabled=P),(!Oe||tt[0]&1&&D!==(D=Pe[0]=="oneway"))&&(R.disabled=D),tt[0]&2048&&(K.checked=Pe[11]),tt[0]&1024&&(ve.checked=Pe[10]),tt[0]&4096&&$t(Se,Pe[12]),Pe[12]=="speeds"?Ye?tt[0]&4096&&b(Ye,1):(Ye=Kl(),Ye.c(),b(Ye,1),Ye.m(ue,null)):Ye&&(be(),S(Ye,1,1,()=>{Ye=null}),ye()),Vt===(Vt=Xt(Pe))&&vt?vt.p(Pe,tt):(vt.d(1),vt=Vt(Pe),vt&&(vt.c(),vt.m(Q,null))),(!Oe||tt[0]&16&&Ce!==(Ce=Pe[4]==0))&&(Q.disabled=Ce),At===(At=er(Pe))&&Ft?Ft.p(Pe,tt):(Ft.d(1),Ft=At(Pe),Ft&&(Ft.c(),Ft.m($e,null))),(!Oe||tt[0]&32&&W!==(W=Pe[5]==0))&&($e.disabled=W),Pe[3]?et?(et.p(Pe,tt),tt[0]&8&&b(et,1)):(et=Yl(Pe),et.c(),b(et,1),et.m(e,null)):et&&(be(),S(et,1,1,()=>{et=null}),ye())},i(Pe){Oe||(b(Ye),b(et),Oe=!0)},o(Pe){S(Ye),S(et),Oe=!1},d(Pe){Pe&&L(e),_t&&_t.d(),Ye&&Ye.d(),vt.d(),Ft.d(),et&&et.d(),Ue=!1,rt(wt)}}}function Um(r){let e;return{c(){e=$("p"),e.textContent="Click to change direction"},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Hm(r){let e,t,n,o;return{c(){e=$("div"),t=$("img"),o=O(`
                Click to add modal filter`),Je(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||E(t,"src",n),E(t,"width","20"),E(t,"alt","Add modal filter")},m(l,i){k(l,e,i),p(e,t),p(e,o)},p(l,i){i[0]&512&&!Je(t.src,n=`/ltn//filters/${l[9]}_icon.gif`)&&E(t,"src",n)},d(l){l&&L(e)}}}function Gm(r){let e,t=r[40].shortcuts+"",n,o,l=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",f,u,c,_;function d(w,h){return w[0]=="filter"?Hm:Um}let m=d(r),g=m(r);return{c(){e=$("p"),n=O(t),o=O(" shortcuts through "),i=O(l),s=O(`
              (`),f=O(a),u=O(" mph)"),c=C(),g.c(),_=Ze()},m(w,h){k(w,e,h),p(e,n),p(e,o),p(e,i),p(e,s),p(e,f),p(e,u),k(w,c,h),g.m(w,h),k(w,_,h)},p(w,h){h[1]&512&&t!==(t=w[40].shortcuts+"")&&oe(n,t),h[1]&512&&l!==(l=(w[40].name??"unnamed road")+"")&&oe(i,l),h[1]&512&&a!==(a=Math.round(w[40].speed_mph)+"")&&oe(f,a),m===(m=d(w))&&g?g.p(w,h):(g.d(1),g=m(w),g&&(g.c(),g.m(_.parentNode,_)))},d(w){w&&(L(e),L(c),L(_)),g.d(w)}}}function Wm(r){let e,t,n;return t=new ht({props:{openOn:"hover",$$slots:{default:[Gm,({props:o})=>({40:o}),({props:o})=>[0,o?512:0]]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","line-popup")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l[0]&513|l[1]&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function qm(r){let e,t,n,o,l,i,s,a,f,u;return e=new Mr({}),n=new Sr({}),l=new Cr({}),s=new Vn({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[Wm]},$$scope:{ctx:r}}}),f=new bm({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),T(s.$$.fragment),a=C(),T(f.$$.fragment)},m(c,_){A(e,c,_),k(c,t,_),A(n,c,_),k(c,o,_),A(l,c,_),k(c,i,_),A(s,c,_),k(c,a,_),A(f,c,_),u=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const m={};_[0]&1&&(m.interactive=c[0]=="filter"),_[0]&2&&(m.neighbourhood=c[1]),f.$set(m)},i(c){u||(b(e.$$.fragment,c),b(n.$$.fragment,c),b(l.$$.fragment,c),b(s.$$.fragment,c),b(f.$$.fragment,c),u=!0)},o(c){S(e.$$.fragment,c),S(n.$$.fragment,c),S(l.$$.fragment,c),S(s.$$.fragment,c),S(f.$$.fragment,c),u=!1},d(c){c&&(L(t),L(o),L(i),L(a)),F(e,c),F(n,c),F(l,c),F(s,c),F(f,c)}}}function Xl(r){let e,t;return e=new lm({props:{paths:r[7]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[0]&128&&(l.paths=n[7]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Jm(r){let e;return{c(){e=O("Click to delete")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Zm(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Jm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[1]&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Vl(r){let e,t;return e=new Mm({props:{map:dt(r[2])}}),e.$on("done",r[21]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[0]&4&&(l.map=dt(n[2])),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Km(r){let e,t,n,o,l,i,s;t=new Qn({props:{input:r[1],$$slots:{default:[qm]},$$scope:{ctx:r}}});let a=r[11]&&Xl(r);l=new dn({props:{$$slots:{default:[Zm]},$$scope:{ctx:r}}}),l.$on("click",r[16]);let f=r[0]=="freehand-filters"&&Vl(r);return{c(){e=$("div"),T(t.$$.fragment),n=C(),a&&a.c(),o=C(),T(l.$$.fragment),i=C(),f&&f.c(),E(e,"slot","map")},m(u,c){k(u,e,c),A(t,e,null),p(e,n),a&&a.m(e,null),p(e,o),A(l,e,null),p(e,i),f&&f.m(e,null),s=!0},p(u,c){const _={};c[0]&2&&(_.input=u[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:u}),t.$set(_),u[11]?a?(a.p(u,c),c[0]&2048&&b(a,1)):(a=Xl(u),a.c(),b(a,1),a.m(e,o)):a&&(be(),S(a,1,1,()=>{a=null}),ye());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:u}),l.$set(d),u[0]=="freehand-filters"?f?(f.p(u,c),c[0]&1&&b(f,1)):(f=Vl(u),f.c(),b(f,1),f.m(e,null)):f&&(be(),S(f,1,1,()=>{f=null}),ye())},i(u){s||(b(t.$$.fragment,u),b(a),b(l.$$.fragment,u),b(f),s=!0)},o(u){S(t.$$.fragment,u),S(a),S(l.$$.fragment,u),S(f),s=!1},d(u){u&&L(e),F(t),a&&a.d(),F(l),f&&f.d()}}}function Ym(r){let e,t,n,o;return e=new Tt({props:{$$slots:{map:[Km],sidebar:[Dm],top:[Nm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0,n||(o=X(window,"keydown",r[18]),n=!0)},p(l,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l),n=!1,o()}}}function Xm(r,e,t){let n,o,l,i,s,a,f,u,c;V(r,jt,ce=>t(22,o=ce)),V(r,Gr,ce=>t(9,l=ce)),V(r,Ve,ce=>t(38,i=ce)),V(r,Hn,ce=>t(10,s=ce)),V(r,Yt,ce=>t(2,a=ce)),V(r,vo,ce=>t(11,f=ce)),V(r,_r,ce=>t(12,u=ce)),V(r,fe,ce=>t(13,c=ce));let _="filter",d=!1,m=0,g=0,w,h,y=i.getAllShortcuts();Mt(()=>{a.doubleClickZoom.enable()});function v(ce){t(1,h=i.renderNeighbourhood()),t(6,w=h.features.find(Ae=>Ae.properties.kind=="boundary")),t(4,m=h.undo_length),t(5,g=h.redo_length),t(7,y=i.getAllShortcuts()),Ln()}function M(){i.setCurrentNeighbourhood(w.properties.name,s),x(jt,o++,o)}function j(ce,Ae){_=="filter"?(i.addModalFilter(Ae,l),x(jt,o++,o)):_=="oneway"&&(i.toggleTravelFlow(ce.properties.road),x(jt,o++,o))}function P(ce){let Ae=ce.detail.features[0];i.deleteModalFilter(Ae.properties.road),x(jt,o++,o)}function I(ce){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}ce.hasRotatedFilter?(i.deleteDiagonalFilter(ce),x(jt,o++,o)):ce.filter?(i.rotateDiagonalFilter(ce),x(jt,o++,o)):(i.addDiagonalFilter(ce),x(jt,o++,o))}function R(ce){ce.target.tagName!="INPUT"&&(ce.ctrlKey&&ce.key=="z"&&B(),ce.ctrlKey&&ce.key=="y"&&D(),ce.key=="1"&&t(0,_="filter"),ce.key=="2"&&t(0,_="freehand-filters"),ce.key=="3"&&t(0,_="oneway"))}function B(){i.undo(),x(jt,o++,o)}function D(){i.redo(),x(jt,o++,o)}function z(ce){let Ae=ce.detail;Ae&&(i.addManyModalFilters(Ae,l),x(jt,o++,o)),t(0,_="filter")}const N=()=>t(0,_="filter"),U=()=>t(0,_="freehand-filters"),G=()=>t(0,_="oneway"),K=()=>t(3,d=!0);function Z(){f=this.checked,vo.set(f)}function te(){s=this.checked,Hn.set(s)}function H(){u=gn(this),_r.set(u)}const ve=()=>t(3,d=!1),ge=()=>x(fe,c={mode:"title",firstLoad:!1},c),le=()=>x(fe,c={mode:"pick-neighbourhood"},c),ue=()=>x(fe,c={mode:"view-shortcuts"},c),me=()=>x(fe,c={mode:"route",prevMode:"neighbourhood"},c),_e=()=>x(fe,c={mode:"impact-one-destination"},c),Se=()=>x(fe,c={mode:"set-boundary",name:dt(w).properties.name,existing:w},c),Fe=()=>x(fe,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&v(),r.$$.dirty[0]&2&&t(8,n=h.features.filter(ce=>ce.properties.kind=="cell"&&ce.properties.cell_color=="disconnected").length)},[_,h,a,d,m,g,w,y,n,l,s,f,u,c,M,j,P,I,R,B,D,z,o,N,U,G,K,Z,te,H,ve,ge,le,ue,me,_e,Se,Fe]}class Vm extends ie{constructor(e){super(),se(this,e,Xm,Ym,re,{},null,[-1,-1])}}function Qm(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function xm(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function ep(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Me({props:{$$slots:{default:[Qm]},$$scope:{ctx:r}}}),l.$on("click",r[7]),a=new Me({props:{$$slots:{default:[xm]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),u.textContent="Predict impact",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(_,d){k(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&L(e),F(l),F(a)}}}function tp(r){let e;return{c(){e=O("Pick a different road")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function np(r){let e,t,n,o,l,i,s,a;t=new Me({props:{$$slots:{default:[tp]},$$scope:{ctx:r}}}),t.$on("click",r[5]);function f(c){r[6](c)}let u={list:r[2]};return r[0]!==void 0&&(u.idx=r[0]),o=new Lr({props:u}),Ge.push(()=>pt(o,"idx",f)),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),i=C(),s=$("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,E(e,"slot","sidebar")},m(c,_){k(c,e,_),A(t,e,null),p(e,n),A(o,e,null),p(e,i),p(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),t.$set(d);const m={};!l&&_&1&&(l=!0,m.idx=c[0],gt(()=>l=!1)),o.$set(m)},i(c){a||(b(t.$$.fragment,c),b(o.$$.fragment,c),a=!0)},o(c){S(t.$$.fragment,c),S(o.$$.fragment,c),a=!1},d(c){c&&L(e),F(t),F(o)}}}function rp(r){let e,t;const n=[Le("predict-impact"),{paint:{"line-width":Ht(["get","kind"],{focus:8},5),"line-color":Ht(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Ht(["get","kind"],{focus:1},.5)}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function op(r){let e;return{c(){e=O("A")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function lp(r){let e;return{c(){e=O("B")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function ip(r){let e,t,n,o,l,i,s,a,f;return t=new Ke({props:{data:r[3](r[0]),$$slots:{default:[rp]},$$scope:{ctx:r}}}),o=new yn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[op]},$$scope:{ctx:r}}}),i=new yn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[lp]},$$scope:{ctx:r}}}),a=new dn({}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),l=C(),T(i.$$.fragment),s=C(),T(a.$$.fragment),E(e,"slot","map")},m(u,c){k(u,e,c),A(t,e,null),p(e,n),A(o,e,null),p(e,l),A(i,e,null),p(e,s),A(a,e,null),f=!0},p(u,c){const _={};c&1&&(_.data=u[3](u[0])),c&1024&&(_.$$scope={dirty:c,ctx:u}),t.$set(_);const d={};c&1&&(d.lngLat=u[2][u[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:u}),o.$set(d);const m={};c&1&&(m.lngLat=u[2][u[0]][0].geometry.coordinates[u[2][u[0]][0].geometry.coordinates.length-1]),c&1024&&(m.$$scope={dirty:c,ctx:u}),i.$set(m)},i(u){f||(b(t.$$.fragment,u),b(o.$$.fragment,u),b(i.$$.fragment,u),b(a.$$.fragment,u),f=!0)},o(u){S(t.$$.fragment,u),S(o.$$.fragment,u),S(i.$$.fragment,u),S(a.$$.fragment,u),f=!1},d(u){u&&L(e),F(t),F(o),F(i),F(a)}}}function sp(r){let e,t;return e=new Tt({props:{$$slots:{map:[ip],sidebar:[np],top:[ep]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function ap(r,e,t){let n,o;V(r,Ve,d=>t(9,n=d)),V(r,fe,d=>t(1,o=d));let{road:l}=e;l.properties.kind="focus";let i=n.getImpactsOnRoad(l.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],l]}}const f=()=>x(fe,o={mode:"predict-impact"},o);function u(d){s=d,t(0,s)}const c=()=>x(fe,o={mode:"title",firstLoad:!1},o),_=()=>x(fe,o={mode:"pick-neighbourhood"},o);return r.$$set=d=>{"road"in d&&t(4,l=d.road)},[s,o,i,a,l,f,u,c,_]}class fp extends ie{constructor(e){super(),se(this,e,ap,sp,re,{road:4})}}function up(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function cp(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function dp(r){let e;return{c(){e=O("Editing")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function _p(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;return l=new Me({props:{$$slots:{default:[up]},$$scope:{ctx:r}}}),l.$on("click",r[12]),a=new Me({props:{$$slots:{default:[cp]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Me({props:{$$slots:{default:[dp]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),T(c.$$.fragment),_=C(),d=$("li"),d.textContent="Impact routing to one destination",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(g,w){k(g,e,w),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),A(c,u,null),p(n,_),p(n,d),m=!0},p(g,w){const h={};w&262144&&(h.$$scope={dirty:w,ctx:g}),l.$set(h);const y={};w&262144&&(y.$$scope={dirty:w,ctx:g}),a.$set(y);const v={};w&262144&&(v.$$scope={dirty:w,ctx:g}),c.$set(v)},i(g){m||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){S(l.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&L(e),F(l),F(a),F(c)}}}function mp(r){let e,t,n,o,l,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",f,u;return t=new cn({}),t.$on("click",r[5]),{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),o.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,l=C(),i=$("p"),s=O("Highest ratio is "),f=O(a),E(e,"slot","sidebar")},m(c,_){k(c,e,_),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(i,s),p(i,f),u=!0},p(c,_){(!u||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&oe(f,a)},i(c){u||(b(t.$$.fragment,c),u=!0)},o(c){S(t.$$.fragment,c),u=!1},d(c){c&&L(e),F(t)}}}function pp(r){let e,t;const n=[Le("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new Ct({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function gp(r){let e,t=on(r[17].distance_before)+"",n,o,l=ln(r[17].time_before)+"",i,s,a,f,u=on(r[17].distance_after)+"",c,_,d=ln(r[17].time_after)+"",m,g,w,h,y,v=(r[17].time_after/r[17].time_before).toFixed(1)+"",M;return{c(){e=$("p"),n=O(t),o=O(", "),i=O(l),s=O(" before"),a=C(),f=$("p"),c=O(u),_=O(", "),m=O(d),g=O(" after"),w=C(),h=$("p"),y=O("Time ratio: "),M=O(v)},m(j,P){k(j,e,P),p(e,n),p(e,o),p(e,i),p(e,s),k(j,a,P),k(j,f,P),p(f,c),p(f,_),p(f,m),p(f,g),k(j,w,P),k(j,h,P),p(h,y),p(h,M)},p(j,P){P&131072&&t!==(t=on(j[17].distance_before)+"")&&oe(n,t),P&131072&&l!==(l=ln(j[17].time_before)+"")&&oe(i,l),P&131072&&u!==(u=on(j[17].distance_after)+"")&&oe(c,u),P&131072&&d!==(d=ln(j[17].time_after)+"")&&oe(m,d),P&131072&&v!==(v=(j[17].time_after/j[17].time_before).toFixed(1)+"")&&oe(M,v)},d(j){j&&(L(e),L(a),L(f),L(w),L(h))}}}function hp(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[gp,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&393216&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function bp(r){let e,t,n;const o=[Le("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function l(s){r[9](s)}let i={$$slots:{default:[hp]},$$scope:{ctx:r}};for(let s=0;s<o.length;s+=1)i=pe(i,o[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new xe({props:i}),Ge.push(()=>pt(e,"hovered",l)),e.$on("click",r[10]),{c(){T(e.$$.fragment)},m(s,a){A(e,s,a),n=!0},p(s,a){const f=a&8?We(o,[o[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},o[2]]):{};a&262144&&(f.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,f.hovered=s[0],gt(()=>t=!1)),e.$set(f)},i(s){n||(b(e.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),n=!1},d(s){F(e,s)}}}function yp(r){let e,t;const n=[Le("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Ht(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function wp(r){let e;return{c(){e=O("X")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function vp(r){let e,t,n,o,l,i,s,a,f,u,c,_;t=new Qn({props:{$$slots:{default:[pp]},$$scope:{ctx:r}}}),o=new Ke({props:{data:r[3],generateId:!0,$$slots:{default:[bp]},$$scope:{ctx:r}}}),i=new Ke({props:{data:r[2],$$slots:{default:[yp]},$$scope:{ctx:r}}}),a=new dn({});function d(g){r[11](g)}let m={draggable:!0,$$slots:{default:[wp]},$$scope:{ctx:r}};return r[1]!==void 0&&(m.lngLat=r[1]),u=new yn({props:m}),Ge.push(()=>pt(u,"lngLat",d)),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),l=C(),T(i.$$.fragment),s=C(),T(a.$$.fragment),f=C(),T(u.$$.fragment),E(e,"slot","map")},m(g,w){k(g,e,w),A(t,e,null),p(e,n),A(o,e,null),p(e,l),A(i,e,null),p(e,s),A(a,e,null),p(e,f),A(u,e,null),_=!0},p(g,w){const h={};w&262144&&(h.$$scope={dirty:w,ctx:g}),t.$set(h);const y={};w&8&&(y.data=g[3]),w&262153&&(y.$$scope={dirty:w,ctx:g}),o.$set(y);const v={};w&4&&(v.data=g[2]),w&262144&&(v.$$scope={dirty:w,ctx:g}),i.$set(v);const M={};w&262144&&(M.$$scope={dirty:w,ctx:g}),!c&&w&2&&(c=!0,M.lngLat=g[1],gt(()=>c=!1)),u.$set(M)},i(g){_||(b(t.$$.fragment,g),b(o.$$.fragment,g),b(i.$$.fragment,g),b(a.$$.fragment,g),b(u.$$.fragment,g),_=!0)},o(g){S(t.$$.fragment,g),S(o.$$.fragment,g),S(i.$$.fragment,g),S(a.$$.fragment,g),S(u.$$.fragment,g),_=!1},d(g){g&&L(e),F(t),F(o),F(i),F(a),F(u)}}}function $p(r){let e,t,n,o;return e=new es({}),e.$on("contextmenu",r[7]),n=new Tt({props:{$$slots:{map:[vp],sidebar:[mp],top:[_p]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(l,i){A(e,l,i),k(l,t,i),A(n,l,i),o=!0},p(l,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:l}),n.$set(s)},i(l){o||(b(e.$$.fragment,l),b(n.$$.fragment,l),o=!0)},o(l){S(e.$$.fragment,l),S(n.$$.fragment,l),o=!1},d(l){l&&L(t),F(e,l),F(n,l)}}}function kp(r,e,t){let n,o,l,i,s,a,f;V(r,or,M=>t(1,l=M)),V(r,fe,M=>t(4,i=M)),V(r,Gn,M=>t(14,s=M)),V(r,Wn,M=>t(15,a=M)),V(r,Ve,M=>t(8,f=M));function u(){x(fe,i={mode:"neighbourhood"},i)}let c=null;function _(M){return M?f.compareRoute(new Wr.LngLat(M.properties.pt1_x,M.properties.pt1_y),l,1):en()}function d(M){x(Wn,a=new Wr.LngLat(M.properties.pt1_x,M.properties.pt1_y),a),x(Gn,s=l,s),x(fe,i={mode:"route",prevMode:"impact-one-destination"},i)}function m(M){x(or,l=M.detail.lngLat,l)}function g(M){c=M,t(0,c)}const w=M=>d(M.detail.features[0]);function h(M){l=M,or.set(l)}const y=()=>x(fe,i={mode:"title",firstLoad:!1},i),v=()=>x(fe,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&t(3,n=f.impactToOneDestination(l)),r.$$.dirty&1&&t(2,o=_(c))},[c,l,o,n,i,u,d,m,f,g,w,h,y,v]}class Lp extends ie{constructor(e){super(),se(this,e,kp,$p,re,{})}}function Ql(r,e,t){const n=r.slice();return n[24]=e[t],n}function Sp(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Mp(r){let e;return{c(){e=$("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Cp(r){let e;return{c(){e=O("Route")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Tp(r){let e;return{c(){e=O("Predict impact")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Ap(r){let e;return{c(){e=O("Debug intersections")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Fp(r){let e;return{c(){e=O("Debug demand")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Ep(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h,y,v,M,j,P,I,R;return l=new Me({props:{$$slots:{default:[Sp]},$$scope:{ctx:r}}}),l.$on("click",r[17]),f=new Dt({props:{$$slots:{default:[Mp]},$$scope:{ctx:r}}}),m=new Me({props:{$$slots:{default:[Cp]},$$scope:{ctx:r}}}),m.$on("click",r[18]),h=new Me({props:{$$slots:{default:[Tp]},$$scope:{ctx:r}}}),h.$on("click",r[19]),M=new Me({props:{$$slots:{default:[Ap]},$$scope:{ctx:r}}}),M.$on("click",r[20]),I=new Me({props:{$$slots:{default:[Fp]},$$scope:{ctx:r}}}),I.$on("click",r[21]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),a=O(`Pick neighbourhood
          `),T(f.$$.fragment),u=C(),c=$("nav"),_=$("ul"),d=$("li"),T(m.$$.fragment),g=C(),w=$("li"),T(h.$$.fragment),y=C(),v=$("li"),T(M.$$.fragment),j=C(),P=$("li"),T(I.$$.fragment),E(t,"aria-label","breadcrumb"),E(e,"slot","top"),ae(e,"display","flex"),ae(e,"justify-content","space-between")},m(B,D){k(B,e,D),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),p(s,a),A(f,s,null),p(e,u),p(e,c),p(c,_),p(_,d),A(m,d,null),p(_,g),p(_,w),A(h,w,null),p(_,y),p(_,v),A(M,v,null),p(_,j),p(_,P),A(I,P,null),R=!0},p(B,D){const z={};D&134217728&&(z.$$scope={dirty:D,ctx:B}),l.$set(z);const N={};D&134217728&&(N.$$scope={dirty:D,ctx:B}),f.$set(N);const U={};D&134217728&&(U.$$scope={dirty:D,ctx:B}),m.$set(U);const G={};D&134217728&&(G.$$scope={dirty:D,ctx:B}),h.$set(G);const K={};D&134217728&&(K.$$scope={dirty:D,ctx:B}),M.$set(K);const Z={};D&134217728&&(Z.$$scope={dirty:D,ctx:B}),I.$set(Z)},i(B){R||(b(l.$$.fragment,B),b(f.$$.fragment,B),b(m.$$.fragment,B),b(h.$$.fragment,B),b(M.$$.fragment,B),b(I.$$.fragment,B),R=!0)},o(B){S(l.$$.fragment,B),S(f.$$.fragment,B),S(m.$$.fragment,B),S(h.$$.fragment,B),S(M.$$.fragment,B),S(I.$$.fragment,B),R=!1},d(B){B&&L(e),F(l),F(f),F(m),F(h),F(M),F(I)}}}function Pp(r){let e;return{c(){e=O("Draw a new boundary")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Ip(r){let e;return{c(){e=O("Use an auto-generated boundary")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function jp(r){let e=r[24]+"",t;return{c(){t=O(e)},m(n,o){k(n,t,o)},p(n,o){o&4&&e!==(e=n[24]+"")&&oe(t,e)},d(n){n&&L(t)}}}function xl(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;function g(){return r[14](r[24])}n=new Me({props:{$$slots:{default:[jp]},$$scope:{ctx:r}}}),n.$on("click",g),s=new ts({props:{color:"black"}});function w(){return r[15](r[24])}u=new ns({props:{color:"white"}});function h(){return r[16](r[24])}return{c(){e=$("li"),t=$("span"),T(n.$$.fragment),o=C(),l=$("span"),i=$("button"),T(s.$$.fragment),a=C(),f=$("button"),T(u.$$.fragment),c=C(),E(i,"class","outline icon-btn"),E(i,"aria-label","Rename neighbourhood"),E(f,"class","icon-btn destructive"),E(f,"aria-label","Delete neighbourhood"),ae(l,"display","flex"),ae(l,"gap","16px"),ae(t,"display","flex"),ae(t,"justify-content","space-between")},m(y,v){k(y,e,v),p(e,t),A(n,t,null),p(t,o),p(t,l),p(l,i),A(s,i,null),p(l,a),p(l,f),A(u,f,null),p(e,c),_=!0,d||(m=[X(i,"click",w),X(f,"click",h)],d=!0)},p(y,v){r=y;const M={};v&134217732&&(M.$$scope={dirty:v,ctx:r}),n.$set(M)},i(y){_||(b(n.$$.fragment,y),b(s.$$.fragment,y),b(u.$$.fragment,y),_=!0)},o(y){S(n.$$.fragment,y),S(s.$$.fragment,y),S(u.$$.fragment,y),_=!1},d(y){y&&L(e),F(n),F(s),F(u),d=!1,rt(m)}}}function Np(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h=r[1].modalFilters+"",y,v,M,j,P=r[1].deletedModalFilters+"",I,R,B,D,z=r[1].travelFlows+"",N,U,G,K,Z,te,H,ve,ge;n=new Me({props:{$$slots:{default:[Pp]},$$scope:{ctx:r}}}),n.$on("click",r[8]),i=new Me({props:{$$slots:{default:[Ip]},$$scope:{ctx:r}}}),i.$on("click",r[13]);let le=Te(r[2]),ue=[];for(let _e=0;_e<le.length;_e+=1)ue[_e]=xl(Ql(r,le,_e));const me=_e=>S(ue[_e],1,1,()=>{ue[_e]=null});return{c(){e=$("div"),t=$("div"),T(n.$$.fragment),o=C(),l=$("div"),T(i.$$.fragment),s=C(),a=$("ul");for(let _e=0;_e<ue.length;_e+=1)ue[_e].c();f=C(),u=$("hr"),c=C(),_=$("p"),d=O("Current project: "),m=O(r[3]),g=C(),w=$("p"),y=O(h),v=O(" new modal filter(s) added"),M=C(),j=$("p"),I=O(P),R=O(`
      existing modal filter(s) removed`),B=C(),D=$("p"),N=O(z),U=O(" road segment direction(s) changed"),G=C(),K=$("button"),K.textContent="Export project to GeoJSON",Z=C(),te=$("button"),te.textContent="Debug route-snapper",E(te,"class","secondary"),E(e,"slot","sidebar")},m(_e,Se){k(_e,e,Se),p(e,t),A(n,t,null),p(e,o),p(e,l),A(i,l,null),p(e,s),p(e,a);for(let Fe=0;Fe<ue.length;Fe+=1)ue[Fe]&&ue[Fe].m(a,null);p(e,f),p(e,u),p(e,c),p(e,_),p(_,d),p(_,m),p(e,g),p(e,w),p(w,y),p(w,v),p(e,M),p(e,j),p(j,I),p(j,R),p(e,B),p(e,D),p(D,N),p(D,U),p(e,G),p(e,K),p(e,Z),p(e,te),H=!0,ve||(ge=[X(K,"click",r[9]),X(te,"click",r[10])],ve=!0)},p(_e,Se){const Fe={};Se&134217728&&(Fe.$$scope={dirty:Se,ctx:_e}),n.$set(Fe);const ce={};if(Se&134217728&&(ce.$$scope={dirty:Se,ctx:_e}),i.$set(ce),Se&228){le=Te(_e[2]);let Ae;for(Ae=0;Ae<le.length;Ae+=1){const ft=Ql(_e,le,Ae);ue[Ae]?(ue[Ae].p(ft,Se),b(ue[Ae],1)):(ue[Ae]=xl(ft),ue[Ae].c(),b(ue[Ae],1),ue[Ae].m(a,null))}for(be(),Ae=le.length;Ae<ue.length;Ae+=1)me(Ae);ye()}(!H||Se&8)&&oe(m,_e[3]),(!H||Se&2)&&h!==(h=_e[1].modalFilters+"")&&oe(y,h),(!H||Se&2)&&P!==(P=_e[1].deletedModalFilters+"")&&oe(I,P),(!H||Se&2)&&z!==(z=_e[1].travelFlows+"")&&oe(N,z)},i(_e){if(!H){b(n.$$.fragment,_e),b(i.$$.fragment,_e);for(let Se=0;Se<le.length;Se+=1)b(ue[Se]);H=!0}},o(_e){S(n.$$.fragment,_e),S(i.$$.fragment,_e),ue=ue.filter(Boolean);for(let Se=0;Se<ue.length;Se+=1)S(ue[Se]);H=!1},d(_e){_e&&L(e),F(n),F(i),ot(ue,_e),ve=!1,rt(ge)}}}function Op(r){let e,t=r[23].name+"",n;return{c(){e=$("p"),n=O(t)},m(o,l){k(o,e,l),p(e,n)},p(o,l){l&8388608&&t!==(t=o[23].name+"")&&oe(n,t)},d(o){o&&L(e)}}}function Bp(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Op,({props:n})=>({23:n}),({props:n})=>n?8388608:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&142606336&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Rp(r){let e,t;const n=[Le("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":ct(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[Bp]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new Ct({props:o}),e.$on("click",r[12]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};i&134217728&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function zp(r){let e,t,n,o,l;return t=new Ke({props:{data:r[0],generateId:!0,$$slots:{default:[Rp]},$$scope:{ctx:r}}}),o=new dn({}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),E(e,"slot","map")},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&1&&(a.data=i[0]),s&134217728&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function Dp(r){let e,t;return e=new Tt({props:{$$slots:{map:[zp],sidebar:[Np],top:[Ep]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&134217759&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Up(r){let e=0,t=0,n=0;for(let o of r.features)o.properties.kind=="modal_filter"?e++:o.properties.kind=="deleted_existing_modal_filter"?t++:o.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function Hp(r,e,t){let n,o,l,i,s,a,f;V(r,Ve,D=>t(11,i=D)),V(r,tn,D=>t(3,s=D)),V(r,fe,D=>t(4,a=D)),V(r,Hn,D=>t(22,f=D));function u(D){i.setCurrentNeighbourhood(D,f),x(fe,a={mode:"neighbourhood"},a)}function c(D){window.confirm(`Really delete neighbourhood ${D}? You can't undo this.`)&&(i.deleteNeighbourhoodBoundary(D),Ln(),t(0,n=i.toSavefile()))}function _(D){let z=xr(i,`Rename neighbourhood ${D} to what?`,D);z&&(i.renameNeighbourhoodBoundary(D,z),Ln(),t(0,n=i.toSavefile()))}function d(){let D=xr(i,"What do you want to name the neighbourhood?","");D&&x(fe,a={mode:"set-boundary",name:D,existing:null},a)}function m(){mr(s+".geojson",JSON.stringify(i.toSavefile()))}function g(){mr("debug_route_snapper.geojson",i.toRouteSnapperGj())}const w=D=>u(dt(D.detail.features[0].properties).name),h=()=>x(fe,a={mode:"auto-boundaries"},a),y=D=>u(D),v=D=>_(D),M=D=>c(D),j=()=>x(fe,a={mode:"title",firstLoad:!1},a),P=()=>x(fe,a={mode:"route",prevMode:"pick-neighbourhood"},a),I=()=>x(fe,a={mode:"predict-impact"},a),R=()=>x(fe,a={mode:"debug-intersections"},a),B=()=>x(fe,a={mode:"debug-demand"},a);return r.$$.update=()=>{r.$$.dirty&2048&&t(0,n=i.toSavefile()),r.$$.dirty&1&&t(2,o=n.features.filter(D=>D.properties.kind=="boundary").map(D=>D.properties.name)),r.$$.dirty&1&&t(1,l=Up(n))},[n,l,o,s,a,u,c,_,d,m,g,i,w,h,y,v,M,j,P,I,R,B]}class Gp extends ie{constructor(e){super(),se(this,e,Hp,Dp,re,{})}}function Wp(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function qp(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Jp(r){let e,t,n,o,l,i,s,a,f,u,c;return l=new Me({props:{$$slots:{default:[Wp]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Me({props:{$$slots:{default:[qp]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),u.textContent="Predict impact",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(_,d){k(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(b(l.$$.fragment,_),b(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&L(e),F(l),F(a)}}}function Zp(r){let e,t,n,o,l,i,s,a,f;return t=new cn({}),t.$on("click",r[5]),{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),o.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,l=C(),i=$("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=C(),a=$("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,E(e,"slot","sidebar")},m(u,c){k(u,e,c),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),f=!0},p:Y,i(u){f||(b(t.$$.fragment,u),f=!0)},o(u){S(t.$$.fragment,u),f=!1},d(u){u&&L(e),F(t)}}}function Kp(r){let e,t=r[9].before.toLocaleString()+"",n,o,l=r[9].after.toLocaleString()+"",i,s,a,f,u=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=$("p"),n=O(t),o=O(" before, "),i=O(l),s=O(`
            after`),a=C(),f=$("p"),c=O(u),_=O("%")},m(d,m){k(d,e,m),p(e,n),p(e,o),p(e,i),p(e,s),k(d,a,m),k(d,f,m),p(f,c),p(f,_)},p(d,m){m&512&&t!==(t=d[9].before.toLocaleString()+"")&&oe(n,t),m&512&&l!==(l=d[9].after.toLocaleString()+"")&&oe(i,l),m&512&&u!==(u=Math.round(100*d[9].after/d[9].before)+"")&&oe(c,u)},d(d){d&&(L(e),L(a),L(f))}}}function Yp(r){let e,t;return e=new ht({props:{openOn:"hover",$$slots:{default:[Kp,({props:n})=>({9:n}),({props:n})=>n?512:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1536&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Xp(r){let e,t;const n=[Le("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,ei,r[2].max_count,ti],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[Yp]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&6?We(n,[n[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,ei,l[2].max_count,ti],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,l[1][0],50,l[1][1],100,l[1][2],150,l[1][3],200,l[1][4]]]}},n[2],n[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Vp(r){let e,t,n,o,l;return t=new Ke({props:{data:r[2],generateId:!0,$$slots:{default:[Xp]},$$scope:{ctx:r}}}),o=new dn({}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),E(e,"slot","map")},m(i,s){k(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&L(e),F(t),F(o)}}}function Qp(r){let e,t;return e=new Tt({props:{$$slots:{map:[Vp],sidebar:[Zp],top:[Jp]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1025&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}let ei=3,ti=10;function xp(r,e,t){let n,o;V(r,fe,_=>t(0,n=_)),V(r,Ve,_=>t(8,o=_));let l=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=o.predictImpact();function s(_){x(fe,n={mode:"impact-detail",road:_},n)}return[n,l,i,s,_=>s(_.detail.features[0]),()=>x(fe,n={mode:"pick-neighbourhood"},n),()=>x(fe,n={mode:"title",firstLoad:!1},n),()=>x(fe,n={mode:"pick-neighbourhood"},n)]}class eg extends ie{constructor(e){super(),se(this,e,xp,Qp,re,{})}}function tg(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function ng(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function ni(r){let e,t,n;return t=new Me({props:{$$slots:{default:[rg]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=$("li"),T(t.$$.fragment)},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function rg(r){let e;return{c(){e=O("Editing")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function og(r){let e,t,n,o,l,i,s,a,f,u,c,_;l=new Me({props:{$$slots:{default:[tg]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new Me({props:{$$slots:{default:[ng]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&ni(r);return{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),d&&d.c(),u=C(),c=$("li"),c.textContent="Routing",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(m,g){k(m,e,g),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),d&&d.m(n,null),p(n,u),p(n,c),_=!0},p(m,g){const w={};g&16384&&(w.$$scope={dirty:g,ctx:m}),l.$set(w);const h={};g&16384&&(h.$$scope={dirty:g,ctx:m}),a.$set(h),m[0]=="neighbourhood"?d?(d.p(m,g),g&1&&b(d,1)):(d=ni(m),d.c(),b(d,1),d.m(n,u)):d&&(be(),S(d,1,1,()=>{d=null}),ye())},i(m){_||(b(l.$$.fragment,m),b(a.$$.fragment,m),b(d),_=!0)},o(m){S(l.$$.fragment,m),S(a.$$.fragment,m),S(d),_=!1},d(m){m&&L(e),F(l),F(a),d&&d.d()}}}function ri(r){let e,t,n,o=on(r[4].features[0].properties.distance)+"",l,i,s=ln(r[4].features[0].properties.time)+"",a,f,u,c,_,d=on(r[4].features[1].properties.distance)+"",m,g,w=ln(r[4].features[1].properties.time)+"",h;return{c(){e=$("p"),t=$("span"),t.textContent="Route before",n=O(`
        : `),l=O(o),i=O(", "),a=O(s),f=C(),u=$("p"),c=$("span"),c.textContent="Route after",_=O(`
        : `),m=O(d),g=O(", "),h=O(w),ae(t,"color","red"),ae(c,"color","blue")},m(y,v){k(y,e,v),p(e,t),p(e,n),p(e,l),p(e,i),p(e,a),k(y,f,v),k(y,u,v),p(u,c),p(u,_),p(u,m),p(u,g),p(u,h)},p(y,v){v&16&&o!==(o=on(y[4].features[0].properties.distance)+"")&&oe(l,o),v&16&&s!==(s=ln(y[4].features[0].properties.time)+"")&&oe(a,s),v&16&&d!==(d=on(y[4].features[1].properties.distance)+"")&&oe(m,d),v&16&&w!==(w=ln(y[4].features[1].properties.time)+"")&&oe(h,w)},d(y){y&&(L(e),L(f),L(u))}}}function lg(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w;t=new cn({}),t.$on("click",r[6]);let h=r[4].features.length==2&&ri(r);return{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),o.textContent="Drag markers for a route",l=C(),h&&h.c(),i=C(),s=$("label"),a=O("Slow-down factor for main roads: "),f=O(r[1]),u=C(),c=$("input"),_=C(),d=$("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,E(c,"type","range"),E(c,"min","1.0"),E(c,"max","5.0"),E(c,"step","0.1"),E(e,"slot","sidebar")},m(y,v){k(y,e,v),A(t,e,null),p(e,n),p(e,o),p(e,l),h&&h.m(e,null),p(e,i),p(e,s),p(s,a),p(s,f),p(s,u),p(s,c),qe(c,r[1]),p(e,_),p(e,d),m=!0,g||(w=[X(c,"change",r[10]),X(c,"input",r[10])],g=!0)},p(y,v){y[4].features.length==2?h?h.p(y,v):(h=ri(y),h.c(),h.m(e,i)):h&&(h.d(1),h=null),(!m||v&2)&&oe(f,y[1]),v&2&&qe(c,y[1])},i(y){m||(b(t.$$.fragment,y),m=!0)},o(y){S(t.$$.fragment,y),m=!1},d(y){y&&L(e),F(t),h&&h.d(),g=!1,rt(w)}}}function oi(r){let e,t;return e=new Qn({props:{$$slots:{default:[ig]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function ig(r){let e,t,n,o,l,i,s,a;return e=new Mr({}),n=new Sr({}),l=new Cr({}),s=new Vn({props:{interactive:!1}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),T(s.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),k(f,o,u),A(l,f,u),k(f,i,u),A(s,f,u),a=!0},p:Y,i(f){a||(b(e.$$.fragment,f),b(n.$$.fragment,f),b(l.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),S(l.$$.fragment,f),S(s.$$.fragment,f),a=!1},d(f){f&&(L(t),L(o),L(i)),F(e,f),F(n,f),F(l,f),F(s,f)}}}function sg(r){let e,t;const n=[Le("compare-route"),{paint:{"line-width":10,"line-color":Ht(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function ag(r){let e;return{c(){e=O("A")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function fg(r){let e;return{c(){e=O("B")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function ug(r){let e,t,n,o,l,i,s,a,f,u,c,_,d=r[0]=="neighbourhood"&&oi(r);n=new dn({}),l=new Ke({props:{data:r[4],$$slots:{default:[sg]},$$scope:{ctx:r}}});function m(y){r[8](y)}let g={draggable:!0,$$slots:{default:[ag]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new yn({props:g}),Ge.push(()=>pt(s,"lngLat",m));function w(y){r[9](y)}let h={draggable:!0,$$slots:{default:[fg]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.lngLat=r[2]),u=new yn({props:h}),Ge.push(()=>pt(u,"lngLat",w)),{c(){e=$("div"),d&&d.c(),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),T(s.$$.fragment),f=C(),T(u.$$.fragment),E(e,"slot","map")},m(y,v){k(y,e,v),d&&d.m(e,null),p(e,t),A(n,e,null),p(e,o),A(l,e,null),p(e,i),A(s,e,null),p(e,f),A(u,e,null),_=!0},p(y,v){y[0]=="neighbourhood"?d?v&1&&b(d,1):(d=oi(y),d.c(),b(d,1),d.m(e,t)):d&&(be(),S(d,1,1,()=>{d=null}),ye());const M={};v&16&&(M.data=y[4]),v&16384&&(M.$$scope={dirty:v,ctx:y}),l.$set(M);const j={};v&16384&&(j.$$scope={dirty:v,ctx:y}),!a&&v&8&&(a=!0,j.lngLat=y[3],gt(()=>a=!1)),s.$set(j);const P={};v&16384&&(P.$$scope={dirty:v,ctx:y}),!c&&v&4&&(c=!0,P.lngLat=y[2],gt(()=>c=!1)),u.$set(P)},i(y){_||(b(d),b(n.$$.fragment,y),b(l.$$.fragment,y),b(s.$$.fragment,y),b(u.$$.fragment,y),_=!0)},o(y){S(d),S(n.$$.fragment,y),S(l.$$.fragment,y),S(s.$$.fragment,y),S(u.$$.fragment,y),_=!1},d(y){y&&L(e),d&&d.d(),F(n),F(l),F(s),F(u)}}}function cg(r){let e,t;return e=new Tt({props:{$$slots:{map:[ug],sidebar:[lg],top:[og]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&16447&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function dg(r,e,t){let n,o,l,i,s,a;V(r,fe,h=>t(5,o=h)),V(r,$o,h=>t(1,l=h)),V(r,Gn,h=>t(2,i=h)),V(r,Wn,h=>t(3,s=h)),V(r,Ve,h=>t(7,a=h));let{prevMode:f}=e;function u(){x(fe,o={mode:f},o)}function c(h){s=h,Wn.set(s)}function _(h){i=h,Gn.set(i)}function d(){l=lo(this.value),$o.set(l)}const m=()=>x(fe,o={mode:"title",firstLoad:!1},o),g=()=>x(fe,o={mode:"pick-neighbourhood"},o),w=()=>x(fe,o={mode:"neighbourhood"},o);return r.$$set=h=>{"prevMode"in h&&t(0,f=h.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&t(4,n=a.compareRoute(s,i,l))},[f,l,i,s,n,o,u,a,c,_,d,m,g,w]}class _g extends ie{constructor(e){super(),se(this,e,dg,cg,re,{prevMode:0})}}let Mn=St(null);const Nt=St([]);function ds(r){if(r.length<3)return JSON.parse(Gt(Mn).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Gt(Mn).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:mg}=ji,pg=r=>({}),li=r=>({}),gg=r=>({}),ii=r=>({});function si(r,e,t){const n=r.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function ai(r,e,t){const n=r.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function hg(r){let e,t;const n=r[24]["extra-top"],o=Be(n,r,r[38],li);return{c(){e=$("div"),o&&o.c(),E(e,"slot","top")},m(l,i){k(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i[1]&128)&&Re(o,n,l,l[38],t?De(n,l[38],i,pg):ze(l[38]),li)},i(l){t||(b(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&L(e),o&&o.d(l)}}}function bg(r){let e,t,n,o,l;return{c(){e=$("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=C(),n=$("p"),n.textContent="Keyboard shortcuts:",o=C(),l=$("ul"),l.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){k(i,e,s),k(i,t,s),k(i,n,s),k(i,o,s),k(i,l,s)},p:Y,d(i){i&&(L(e),L(t),L(n),L(o),L(l))}}}function yg(r){let e,t=r[8].length+"",n,o;return{c(){e=O("Undo ("),n=O(t),o=O(")")},m(l,i){k(l,e,i),k(l,n,i),k(l,o,i)},p(l,i){i[0]&256&&t!==(t=l[8].length+"")&&oe(n,t)},d(l){l&&(L(e),L(n),L(o))}}}function wg(r){let e;return{c(){e=O("Undo")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function vg(r){let e;return{c(){e=$("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function $g(r){let e,t,n,o,l,i,s,a,f,u,c,_,d;return c=Ni(r[36][0]),{c(){e=$("fieldset"),t=$("label"),n=$("input"),o=O(`
          Snap to roads`),l=C(),i=$("label"),s=$("input"),a=O(`
          Draw anywhere`),f=C(),u=$("p"),u.textContent="Click to add at least 3 points",E(n,"type","radio"),n.__value="snap",qe(n,n.__value),E(s,"type","radio"),s.__value="free",qe(s,s.__value),c.p(n,s)},m(m,g){k(m,e,g),p(e,t),p(t,n),n.checked=n.__value===r[7],p(t,o),p(e,l),p(e,i),p(i,s),s.checked=s.__value===r[7],p(i,a),k(m,f,g),k(m,u,g),_||(d=[X(n,"change",r[35]),X(s,"change",r[37])],_=!0)},p(m,g){g[0]&128&&(n.checked=n.__value===m[7]),g[0]&128&&(s.checked=s.__value===m[7])},d(m){m&&(L(e),L(f),L(u)),c.r(),_=!1,rt(d)}}}function kg(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m,g,w,h;const y=r[24]["extra-sidebar"],v=Be(y,r,r[38],ii);u=new Dt({props:{$$slots:{default:[bg]},$$scope:{ctx:r}}});function M(D,z){return D[8].length==0?wg:yg}let j=M(r),P=j(r);function I(D,z){return D[5].length<3?$g:vg}let R=I(r),B=R(r);return{c(){e=$("div"),v&&v.c(),t=C(),n=$("div"),o=$("button"),l=O("Finish"),s=C(),a=$("button"),a.textContent="Cancel",f=C(),T(u.$$.fragment),c=C(),_=$("button"),P.c(),m=C(),B.c(),o.disabled=i=r[5].length<3,E(a,"class","secondary"),ae(n,"display","flex"),E(_,"class","secondary"),_.disabled=d=r[8].length==0,E(e,"slot","sidebar")},m(D,z){k(D,e,z),v&&v.m(e,null),p(e,t),p(e,n),p(n,o),p(o,l),p(n,s),p(n,a),p(n,f),A(u,n,null),p(e,c),p(e,_),P.m(_,null),p(e,m),B.m(e,null),g=!0,w||(h=[X(o,"click",function(){Dr(r[0])&&r[0].apply(this,arguments)}),X(a,"click",function(){Dr(r[1])&&r[1].apply(this,arguments)}),X(_,"click",r[11])],w=!0)},p(D,z){r=D,v&&v.p&&(!g||z[1]&128)&&Re(v,y,r,r[38],g?De(y,r[38],z,gg):ze(r[38]),ii),(!g||z[0]&32&&i!==(i=r[5].length<3))&&(o.disabled=i);const N={};z[1]&128&&(N.$$scope={dirty:z,ctx:r}),u.$set(N),j===(j=M(r))&&P?P.p(r,z):(P.d(1),P=j(r),P&&(P.c(),P.m(_,null))),(!g||z[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),R===(R=I(r))&&B?B.p(r,z):(B.d(1),B=R(r),B&&(B.c(),B.m(e,null)))},i(D){g||(b(v,D),b(u.$$.fragment,D),g=!0)},o(D){S(v,D),S(u.$$.fragment,D),g=!1},d(D){D&&L(e),v&&v.d(D),F(u),P.d(),B.d(),w=!1,rt(h)}}}function Lg(r){let e;return{c(){e=$("span"),E(e,"class","dot svelte-1cj4rwq"),mt(e,"snapped-node",r[47].snapped),mt(e,"free-node",!r[47].snapped),mt(e,"hide",r[4])},m(t,n){k(t,e,n)},p(t,n){n[0]&512&&mt(e,"snapped-node",t[47].snapped),n[0]&512&&mt(e,"free-node",!t[47].snapped),n[0]&16&&mt(e,"hide",t[4])},d(t){t&&L(e)}}}function fi(r){let e,t,n;function o(f){r[25](f,r[47])}function l(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[Lg]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new $r({props:a}),Ge.push(()=>pt(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){T(e.$$.fragment)},m(f,u){A(e,f,u),n=!0},p(f,u){r=f;const c={};u[0]&528|u[1]&128&&(c.$$scope={dirty:u,ctx:r}),!t&&u[0]&512&&(t=!0,c.lngLat=r[47].point,gt(()=>t=!1)),e.$set(c)},i(f){n||(b(e.$$.fragment,f),n=!0)},o(f){S(e.$$.fragment,f),n=!1},d(f){F(e,f)}}}function Sg(r){let e;return{c(){e=$("span"),e.textContent=`${r[46]+1}`,E(e,"class","dot svelte-1cj4rwq"),mt(e,"snapped",r[44].snapped)},m(t,n){k(t,e,n)},p(t,n){n[0]&32&&mt(e,"snapped",t[44].snapped)},d(t){t&&L(e)}}}function ui(r){let e,t,n;function o(a){r[29](a,r[44])}function l(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[Sg]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new $r({props:s}),Ge.push(()=>pt(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){T(e.$$.fragment)},m(a,f){A(e,a,f),n=!0},p(a,f){r=a;const u={};f[0]&32|f[1]&128&&(u.$$scope={dirty:f,ctx:r}),!t&&f[0]&32&&(t=!0,u.lngLat=r[44].point,gt(()=>t=!1)),e.$set(u)},i(a){n||(b(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){F(e,a)}}}function Mg(r){let e,t,n,o;const l=[Le("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let f=0;f<l.length;f+=1)i=pe(i,l[f]);e=new xe({props:i});const s=[Le("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let f=0;f<s.length;f+=1)a=pe(a,s[f]);return n=new Ct({props:a}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),o=!0},p(f,u){const c={};e.$set(c);const _={};n.$set(_)},i(f){o||(b(e.$$.fragment,f),b(n.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),o=!1},d(f){f&&L(t),F(e,f),F(n,f)}}}function Cg(r){let e,t;return e=new xe({props:{paint:{"line-color":"black","line-width":3}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Tg(r){let e,t,n,o,l,i,s,a,f;t=new es({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let u=Te(r[9]),c=[];for(let w=0;w<u.length;w+=1)c[w]=fi(ai(r,u,w));const _=w=>S(c[w],1,1,()=>{c[w]=null});let d=Te(r[5]),m=[];for(let w=0;w<d.length;w+=1)m[w]=ui(si(r,d,w));const g=w=>S(m[w],1,1,()=>{m[w]=null});return i=new Ke({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[Mg]},$$scope:{ctx:r}}}),a=new Ke({props:{data:r[10],$$slots:{default:[Cg]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C();for(let w=0;w<c.length;w+=1)c[w].c();o=C();for(let w=0;w<m.length;w+=1)m[w].c();l=C(),T(i.$$.fragment),s=C(),T(a.$$.fragment),E(e,"slot","map")},m(w,h){k(w,e,h),A(t,e,null),p(e,n);for(let y=0;y<c.length;y+=1)c[y]&&c[y].m(e,null);p(e,o);for(let y=0;y<m.length;y+=1)m[y]&&m[y].m(e,null);p(e,l),A(i,e,null),p(e,s),A(a,e,null),f=!0},p(w,h){if(h[0]&918032){u=Te(w[9]);let M;for(M=0;M<u.length;M+=1){const j=ai(w,u,M);c[M]?(c[M].p(j,h),b(c[M],1)):(c[M]=fi(j),c[M].c(),b(c[M],1),c[M].m(e,o))}for(be(),M=u.length;M<c.length;M+=1)_(M);ye()}if(h[0]&2146348){d=Te(w[5]);let M;for(M=0;M<d.length;M+=1){const j=si(w,d,M);m[M]?(m[M].p(j,h),b(m[M],1)):(m[M]=ui(j),m[M].c(),b(m[M],1),m[M].m(e,l))}for(be(),M=d.length;M<m.length;M+=1)g(M);ye()}const y={};h[0]&96&&(y.data=w[16](w[6],w[5])),h[1]&128&&(y.$$scope={dirty:h,ctx:w}),i.$set(y);const v={};h[0]&1024&&(v.data=w[10]),h[1]&128&&(v.$$scope={dirty:h,ctx:w}),a.$set(v)},i(w){if(!f){b(t.$$.fragment,w);for(let h=0;h<u.length;h+=1)b(c[h]);for(let h=0;h<d.length;h+=1)b(m[h]);b(i.$$.fragment,w),b(a.$$.fragment,w),f=!0}},o(w){S(t.$$.fragment,w),c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)S(c[h]);m=m.filter(Boolean);for(let h=0;h<m.length;h+=1)S(m[h]);S(i.$$.fragment,w),S(a.$$.fragment,w),f=!1},d(w){w&&L(e),F(t),ot(c,w),ot(m,w),F(i),F(a)}}}function Ag(r){let e,t,n,o;return e=new Tt({props:{$$slots:{map:[Tg],sidebar:[kg],top:[hg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0,n||(o=X(mg,"keydown",r[20]),n=!0)},p(l,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l),n=!1,o()}}}function Fg(r,e,t){let n,o,l;V(r,Nt,ne=>t(5,o=ne)),V(r,Mn,ne=>t(6,l=ne));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:f}=e,{cancel:u}=e;Mt(()=>{x(Nt,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],m=null,g=!1,w=!1,h=!1;function y(ne){let he=ne.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=he}function v(){let ne=_.pop();t(8,_),ne&&x(Nt,o=ne,o)}function M(){_.length==100&&_.shift(),t(8,_=[..._,JSON.parse(JSON.stringify(o))])}function j(){t(7,c=c=="snap"?"free":"snap"),m&&t(23,m.snapped=c=="snap",m)}function P(ne){o.length>=3||(M(),Nt.update(he=>(he.push({point:ne.detail.lngLat.toArray(),snapped:c=="snap"}),he)))}function I(ne){t(23,m={point:ne.detail.lngLat.toArray(),snapped:c=="snap"})}function R(ne){M(),Nt.update(he=>(he[ne].snapped=!he[ne].snapped,he))}function B(ne){M(),Nt.update(he=>(he.splice(ne,1),he)),t(2,g=!1)}function D(ne,he){try{if(ne)return ds(he)}catch{}return en()}function z(ne,he,Q,Ce){if(Ce||he.length>=3)return en();try{if(ne&&he.length>0&&Q)return JSON.parse(ne.inner.calculateRoute([he[he.length-1],Q]))}catch{}return en()}function N(ne,he,Q){if(Q)return;if(!ne||he.length<3){t(9,d=[]);return}let Ce=[],we=1,$e=JSON.parse(JSON.stringify(he));$e.push($e[0]);for(let W=0;W<$e.length-1;W++){let lt=JSON.parse(ne.inner.getExtraNodes($e[W],$e[W+1]));for(let[Oe,Ue,wt]of lt)Ce.push({point:[Oe,Ue],snapped:wt,insertIdx:we});we++}t(9,d=Ce)}function U(ne){M(),Nt.update(he=>(he.splice(ne.insertIdx,0,{point:ne.point,snapped:ne.snapped}),he)),t(4,h=!0)}function G(ne){Nt.update(he=>(he[ne.insertIdx].point=ne.point,he))}function K(){t(4,h=!1)}function Z(ne){let he=ne.target.tagName,Q=he=="INPUT"||he=="TEXTAREA";ne.key=="Enter"&&!Q||ne.key=="Escape"?(ne.stopPropagation(),o.length>=3?f():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ne.key=="s"&&!Q?j():ne.key=="z"&&ne.ctrlKey&&(ne.stopPropagation(),v())}function te(){M(),t(3,w=!0)}const H=[[]];function ve(ne,he){r.$$.not_equal(he.point,ne)&&(he.point=ne,t(9,d))}const ge=ne=>U(ne),le=ne=>G(ne),ue=ne=>{U(ne),t(4,h=!1)};function me(ne,he){r.$$.not_equal(he.point,ne)&&(he.point=ne,Nt.set(o))}const _e=ne=>R(ne),Se=ne=>B(ne),Fe=()=>t(2,g=!0),ce=()=>t(2,g=!1),Ae=()=>t(3,w=!1);function ft(){c=this.__value,t(7,c)}function It(){c=this.__value,t(7,c)}return r.$$set=ne=>{"map"in ne&&t(22,a=ne.map),"finish"in ne&&t(0,f=ne.finish),"cancel"in ne&&t(1,u=ne.cancel),"$$scope"in ne&&t(38,s=ne.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&N(l,o,h),r.$$.dirty[0]&8388716&&t(10,n=z(l,o,m,g||w)),r.$$.dirty[0]&32&&y(o)},[f,u,g,w,h,o,l,c,_,d,n,v,P,I,R,B,D,U,G,K,Z,te,a,m,i,ve,ge,le,ue,me,_e,Se,Fe,ce,Ae,ft,H,It,s]}class Eg extends ie{constructor(e){super(),se(this,e,Fg,Ag,re,{map:22,finish:0,cancel:1},null,[-1,-1])}}function Pg(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Ig(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function jg(r){let e;return{c(){e=$("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){k(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&L(e)}}}function Ng(r){let e,t,n,o,l;return t=new Me({props:{$$slots:{default:[Og]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=$("li"),T(t.$$.fragment),n=C(),o=$("li"),o.textContent="Changing neighbourhood boundary"},m(i,s){k(i,e,s),A(t,e,null),k(i,n,s),k(i,o,s),l=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(b(t.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),l=!1},d(i){i&&(L(e),L(n),L(o)),F(t)}}}function Og(r){let e;return{c(){e=O("Editing")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function Bg(r){let e,t,n,o,l,i,s,a,f,u,c,_;l=new Me({props:{$$slots:{default:[Pg]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Me({props:{$$slots:{default:[Ig]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[Ng,jg],m=[];function g(w,h){return w[1]?0:1}return u=g(r),c=m[u]=d[u](r),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),c.c(),E(t,"aria-label","breadcrumb"),E(e,"slot","extra-top")},m(w,h){k(w,e,h),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),m[u].m(n,null),_=!0},p(w,h){const y={};h&4096&&(y.$$scope={dirty:h,ctx:w}),l.$set(y);const v={};h&4096&&(v.$$scope={dirty:h,ctx:w}),a.$set(v);let M=u;u=g(w),u===M?m[u].p(w,h):(be(),S(m[M],1,1,()=>{m[M]=null}),ye(),c=m[u],c?c.p(w,h):(c=m[u]=d[u](w),c.c()),b(c,1),c.m(n,null))},i(w){_||(b(l.$$.fragment,w),b(a.$$.fragment,w),b(c),_=!0)},o(w){S(l.$$.fragment,w),S(a.$$.fragment,w),S(c),_=!1},d(w){w&&L(e),F(l),F(a),m[u].d()}}}function Rg(r){let e,t,n,o;return{c(){e=$("div"),t=$("h1"),n=O("Draw your neighbourhood boundary for "),o=O(r[0]),E(e,"slot","extra-sidebar")},m(l,i){k(l,e,i),p(e,t),p(t,n),p(t,o)},p(l,i){i&1&&oe(o,l[0])},d(l){l&&L(e)}}}function zg(r){let e,t;return e=new Eg({props:{map:dt(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[Rg],"extra-top":[Bg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&8&&(l.map=dt(n[3])),o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Dg(r,e,t){let n,o,l,i,s;V(r,fe,g=>t(2,n=g)),V(r,Hn,g=>t(9,o=g)),V(r,Ve,g=>t(10,l=g)),V(r,Nt,g=>t(11,i=g)),V(r,Yt,g=>t(3,s=g));let{name:a}=e,{existing:f}=e;f&&(f.properties.waypoints?x(Nt,i=f.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):x(Nt,i=f.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function u(){if(i.length>=3)try{let g=ds(i);l.setNeighbourhoodBoundary(a,g),Ln(),l.setCurrentNeighbourhood(a,o),x(fe,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),c()}}function c(){f?x(fe,n={mode:"neighbourhood"},n):x(fe,n={mode:"pick-neighbourhood"},n)}const _=()=>x(fe,n={mode:"title",firstLoad:!1},n),d=()=>x(fe,n={mode:"pick-neighbourhood"},n),m=()=>x(fe,n={mode:"neighbourhood"},n);return r.$$set=g=>{"name"in g&&t(0,a=g.name),"existing"in g&&t(1,f=g.existing)},[a,f,n,s,u,c,_,d,m]}class Ug extends ie{constructor(e){super(),se(this,e,Dg,zg,re,{name:0,existing:1})}}const Hg="/ltn/assets/settings-342fb430.svg";function ci(r){let e,t;return e=new wr({props:{$$slots:{default:[Gg]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&67&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Gg(r){let e,t,n,o,l,i,s,a,f,u,c,_,d;return n=new Hf({}),{c(){e=$("h1"),e.textContent="Settings",t=C(),T(n.$$.fragment),o=C(),l=$("label"),i=$("input"),s=O(`
      Road thickness depends on shortcuts`),a=C(),f=$("center"),u=$("button"),u.textContent="Confirm",E(i,"type","checkbox")},m(m,g){k(m,e,g),k(m,t,g),A(n,m,g),k(m,o,g),k(m,l,g),p(l,i),i.checked=r[1],p(l,s),k(m,a,g),k(m,f,g),p(f,u),c=!0,_||(d=[X(i,"change",r[3]),X(u,"click",r[4])],_=!0)},p(m,g){g&2&&(i.checked=m[1])},i(m){c||(b(n.$$.fragment,m),c=!0)},o(m){S(n.$$.fragment,m),c=!1},d(m){m&&(L(e),L(t),L(o),L(l),L(a),L(f)),F(n,m),_=!1,rt(d)}}}function Wg(r){let e,t,n,o,l,i,s=r[0]&&ci(r);return{c(){e=$("button"),e.innerHTML=`<img src="${Hg}" alt="Settings"/>`,t=C(),s&&s.c(),n=Ze(),E(e,"class","outline")},m(a,f){k(a,e,f),k(a,t,f),s&&s.m(a,f),k(a,n,f),o=!0,l||(i=X(e,"click",r[2]),l=!0)},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&b(s,1)):(s=ci(a),s.c(),b(s,1),s.m(n.parentNode,n)):s&&(be(),S(s,1,1,()=>{s=null}),ye())},i(a){o||(b(s),o=!0)},o(a){S(s),o=!1},d(a){a&&(L(e),L(t),L(n)),s&&s.d(a),l=!1,i()}}}function qg(r,e,t){let n;V(r,Hr,f=>t(1,n=f));let o=!1;const l=()=>t(0,o=!0);function i(){n=this.checked,Hr.set(n)}return[o,n,l,i,()=>t(0,o=!1),()=>t(0,o=!1)]}class Jg extends ie{constructor(e){super(),se(this,e,qg,Wg,re,{})}}const Zg=["==",["geometry-type"],"Polygon"],Kg=["==",["geometry-type"],"LineString"],Yg=["==",["geometry-type"],"Point"];function _s(){return{type:"FeatureCollection",features:[]}}function Rr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:ms(r)}}}function ms(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const ps=St(_s()),gs=St(0),Xg=100;class Vg{constructor(e){st(this,"map");st(this,"active");st(this,"eventListenersSuccess");st(this,"eventListenersUpdated");st(this,"eventListenersFailure");st(this,"points");st(this,"cursor");st(this,"hover");st(this,"dragFrom");st(this,"previousStates");st(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});st(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(di(this.points).forEach((n,o)=>{t.push([o+1,df(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});st(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Rr(e.lngLat.toArray()),this.onClick(e),this.finish())});st(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});st(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});st(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});st(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=_s();this.points.forEach((o,l)=>{let i=Rr(o);i.properties.hover=this.hover==l,i.properties.idx=l,e.features.push(i)}),e.features=e.features.concat(di(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),ps.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,gs.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Rr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(ms),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Xg&&this.previousStates.shift()}}function di(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Qg(r){let e,t,n;return{c(){e=O("Undo ("),t=O(r[1]),n=O(")")},m(o,l){k(o,e,l),k(o,t,l),k(o,n,l)},p(o,l){l&2&&oe(t,o[1])},d(o){o&&(L(e),L(t),L(n))}}}function xg(r){let e;return{c(){e=O("Undo")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function e1(r){let e,t,n,o,l,i,s,a,f,u,c;function _(g,w){return g[1]==0?xg:Qg}let d=_(r),m=d(r);return{c(){e=$("div"),t=$("button"),t.textContent="Finish",n=C(),o=$("button"),o.textContent="Cancel",l=C(),i=$("button"),m.c(),a=C(),f=$("ul"),f.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,ae(e,"display","flex"),ae(e,"justify-content","space-between")},m(g,w){k(g,e,w),p(e,t),p(e,n),p(e,o),p(e,l),p(e,i),m.m(i,null),k(g,a,w),k(g,f,w),u||(c=[X(t,"click",r[2]),X(o,"click",r[3]),X(i,"click",r[4])],u=!0)},p(g,[w]){d===(d=_(g))&&m?m.p(g,w):(m.d(1),m=d(g),m&&(m.c(),m.m(i,null))),w&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Y,o:Y,d(g){g&&(L(e),L(a),L(f)),m.d(),u=!1,rt(c)}}}function t1(r,e,t){let n;V(r,gs,a=>t(1,n=a));let{polygonTool:o}=e;const l=()=>o.finish(),i=()=>o.cancel(),s=()=>o.undo();return r.$$set=a=>{"polygonTool"in a&&t(0,o=a.polygonTool)},[o,n,l,i,s]}class n1 extends ie{constructor(e){super(),se(this,e,t1,e1,re,{polygonTool:0})}}let r1=Date.now();function xn(r){return`${r}-${r1++}`}const hs=Symbol.for("svelte-maplibre");function o1(){return io(hs)}function _i(r){return{subscribe:r.subscribe}}function bs({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let o=o1(),l=St(null),i=_i(l),s={...o,[r]:_i(l)};if(e&&(s.popupTarget=i),n){let a=St(null);s.layerEvent=a,o.layerEvent=a}return t&&(s.cluster=St()),Oi(hs,s),{...o,self:l}}function l1(){return bs({key:"source",setCluster:!0})}function i1(r=!0){return bs({key:"layer",setPopupTarget:r,setMouseEvent:r})}function mi(r){let e;return t=>{if(t)for(let n in t){let o=e==null?void 0:e[n],l=t[n];o!==l&&r(n,l,o)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function s1(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function a1(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function pi(r){let e=r[0],t,n,o=gi(r);return{c(){o.c(),t=Ze()},m(l,i){o.m(l,i),k(l,t,i),n=!0},p(l,i){i[0]&1&&re(e,e=l[0])?(be(),S(o,1,1,Y),ye(),o=gi(l),o.c(),b(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(b(o),n=!0)},o(l){S(o),n=!1},d(l){l&&L(t),o.d(l)}}}function gi(r){let e;const t=r[36].default,n=Be(t,r,r[35],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[1]&16)&&Re(n,t,o,o[35],e?De(t,o[35],l,null):ze(o[35]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function f1(r){let e,t,n=r[0]&&pi(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l[0]&1&&b(n,1)):(n=pi(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function u1(r,e,t){let n,o,l,i,s,a,f,u,c,_,d,m,{$$slots:g={},$$scope:w}=e,{id:h=xn("layer")}=e,{source:y=void 0}=e,{sourceLayer:v=void 0}=e,{beforeId:M=void 0}=e,{beforeLayerType:j=void 0}=e,{type:P}=e,{paint:I=void 0}=e,{layout:R=void 0}=e,{filter:B=void 0}=e,{applyToClusters:D=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:N=void 0}=e,{manageHoverState:U=!1}=e,{hovered:G=null}=e,{interactive:K=!0}=e,{hoverCursor:Z=void 0}=e,{eventsIfTopMost:te=!1}=e;const H=fn(),{map:ve,source:ge,self:le,minzoom:ue,maxzoom:me,eventTopMost:_e,layerInfo:Se}=i1();V(r,ve,Q=>t(31,c=Q)),V(r,ge,Q=>t(32,_=Q)),V(r,le,Q=>t(0,u=Q)),V(r,ue,Q=>t(34,m=Q)),V(r,me,Q=>t(33,d=Q)),Mt(()=>{u&&c&&(Se.delete(u),c==null||c.removeLayer(u))});let Fe;function ce(Q){var W,lt;if(!K||!u||!c||te&&_e(Q)!==u)return;let Ce=Q.features??[],we=(lt=(W=Ce[0])==null?void 0:W.properties)==null?void 0:lt.cluster_id,$e={event:Q,map:c,clusterId:we,layer:u,source:s,features:Ce};H(Q.type,$e)}function Ae(Q){var W,lt;if(!K||!u||!c||te&&_e(Q)!==u)return;Z&&(c.getCanvas().style.cursor=Z);let Ce=Q.features??[];t(6,G=Ce[0]??null);let we=(lt=(W=Ce[0])==null?void 0:W.properties)==null?void 0:lt.cluster_id;H("mouseenter",{event:Q,map:c,clusterId:we,layer:u,source:s,features:Ce})}function ft(Q){var W,lt,Oe;if(!K||!c)return;if(te&&_e(Q)!==u){t(6,G=null),U&&Fe!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:v,id:Fe},{hover:!1}),Fe=void 0);return}c.getCanvas().style.cursor=Z;let Ce=Q.features??[],we=(lt=(W=Ce[0])==null?void 0:W.properties)==null?void 0:lt.cluster_id,$e=(Oe=Ce[0])==null?void 0:Oe.id;$e!==Fe&&(U&&(Fe!==void 0&&(c==null||c.setFeatureState({source:s,id:Fe,sourceLayer:v},{hover:!1})),c==null||c.setFeatureState({source:s,id:$e,sourceLayer:v},{hover:!0})),Fe=$e,t(6,G=Ce[0]??null)),H("mousemove",{event:Q,map:c,clusterId:we,layer:u,source:s,features:Ce})}function It(Q){if(!(!K||!u||!c)){if(Z&&(c.getCanvas().style.cursor=""),t(6,G=null),U&&Fe!==void 0){const Ce={source:s,id:Fe,sourceLayer:v};c==null||c.setFeatureState(Ce,{hover:!1}),Fe=void 0}H("mouseleave",{map:c,layer:u,source:s})}}let ne=!0;function he(Q){c&&(c.off("click",Q,ce),c.off("dblclick",Q,ce),c.off("contextmenu",Q,ce),c.off("mouseenter",Q,Ae),c.off("mousemove",Q,ft),c.off("mouseleave",Q,It))}return Mt(()=>{c&&u&&he(u)}),r.$$set=Q=>{"id"in Q&&t(7,h=Q.id),"source"in Q&&t(8,y=Q.source),"sourceLayer"in Q&&t(9,v=Q.sourceLayer),"beforeId"in Q&&t(10,M=Q.beforeId),"beforeLayerType"in Q&&t(11,j=Q.beforeLayerType),"type"in Q&&t(12,P=Q.type),"paint"in Q&&t(13,I=Q.paint),"layout"in Q&&t(14,R=Q.layout),"filter"in Q&&t(15,B=Q.filter),"applyToClusters"in Q&&t(16,D=Q.applyToClusters),"minzoom"in Q&&t(17,z=Q.minzoom),"maxzoom"in Q&&t(18,N=Q.maxzoom),"manageHoverState"in Q&&t(19,U=Q.manageHoverState),"hovered"in Q&&t(6,G=Q.hovered),"interactive"in Q&&t(20,K=Q.interactive),"hoverCursor"in Q&&t(21,Z=Q.hoverCursor),"eventsIfTopMost"in Q&&t(22,te=Q.eventsIfTopMost),"$$scope"in Q&&t(35,w=Q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=a1(D)),r.$$.dirty[0]&1073774592&&t(24,o=s1("all",n,B)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,l=z??m),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,i=N??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=y||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&u!==h&&s){u&&(he(u),Se.delete(u));let Q=M;if(!M&&j){let Ce=c.getStyle().layers,we=typeof j=="function"?j:W=>W.type===j,$e=Ce==null?void 0:Ce.find(we);$e&&(Q=$e.id)}x(le,u=h,u),c.addLayer(cr({id:u,type:P,source:s,"source-layer":v,filter:o,paint:I,layout:R,minzoom:l,maxzoom:i}),Q),t(23,ne=!0),c.on("click",u,ce),c.on("dblclick",u,ce),c.on("contextmenu",u,ce),c.on("mouseenter",u,Ae),c.on("mousemove",u,ft),c.on("mouseleave",u,It)}r.$$.dirty[0]&1048577&&u&&Se.set(u,{interactive:K}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,a=u?mi((Q,Ce)=>c==null?void 0:c.setPaintProperty(u,Q,Ce)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,f=u?mi((Q,Ce)=>c==null?void 0:c.setLayoutProperty(u,Q,Ce)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(I)),r.$$.dirty[0]&134234112&&(f==null||f(R)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&u&&(c==null||c.setLayerZoomRange(u,l,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&u&&(ne?t(23,ne=!1):c==null||c.setFilter(u,o))},[u,ve,ge,le,ue,me,G,h,y,v,M,j,P,I,R,B,D,z,N,U,K,Z,te,ne,o,i,l,f,a,s,n,c,_,d,m,w,g]}class ho extends ie{constructor(e){super(),se(this,e,u1,f1,re,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function c1(r){let e;const t=r[16].default,n=Be(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Re(n,t,o,o[24],e?De(t,o[24],l,null):ze(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function d1(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[c1]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new ho({props:l}),Ge.push(()=>pt(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],gt(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function _1(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=xn("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:h=!1}=e,{hovered:y=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:M=!0}=e;function j(N){y=N,t(0,y)}function P(N){Ne.call(this,r,N)}function I(N){Ne.call(this,r,N)}function R(N){Ne.call(this,r,N)}function B(N){Ne.call(this,r,N)}function D(N){Ne.call(this,r,N)}function z(N){Ne.call(this,r,N)}return r.$$set=N=>{"id"in N&&t(1,l=N.id),"source"in N&&t(2,i=N.source),"sourceLayer"in N&&t(3,s=N.sourceLayer),"beforeId"in N&&t(4,a=N.beforeId),"beforeLayerType"in N&&t(5,f=N.beforeLayerType),"paint"in N&&t(6,u=N.paint),"layout"in N&&t(7,c=N.layout),"filter"in N&&t(8,_=N.filter),"applyToClusters"in N&&t(9,d=N.applyToClusters),"minzoom"in N&&t(10,m=N.minzoom),"maxzoom"in N&&t(11,g=N.maxzoom),"hoverCursor"in N&&t(12,w=N.hoverCursor),"manageHoverState"in N&&t(13,h=N.manageHoverState),"hovered"in N&&t(0,y=N.hovered),"eventsIfTopMost"in N&&t(14,v=N.eventsIfTopMost),"interactive"in N&&t(15,M=N.interactive),"$$scope"in N&&t(24,o=N.$$scope)},[y,l,i,s,a,f,u,c,_,d,m,g,w,h,v,M,n,j,P,I,R,B,D,z,o]}class m1 extends ie{constructor(e){super(),se(this,e,_1,d1,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function p1(r){let e;const t=r[15].default,n=Be(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Re(n,t,o,o[23],e?De(t,o[23],l,null):ze(o[23]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function g1(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[p1]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new ho({props:l}),Ge.push(()=>pt(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],gt(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function h1(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=xn("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:w=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function M(z){h=z,t(0,h)}function j(z){Ne.call(this,r,z)}function P(z){Ne.call(this,r,z)}function I(z){Ne.call(this,r,z)}function R(z){Ne.call(this,r,z)}function B(z){Ne.call(this,r,z)}function D(z){Ne.call(this,r,z)}return r.$$set=z=>{"id"in z&&t(1,l=z.id),"source"in z&&t(2,i=z.source),"sourceLayer"in z&&t(3,s=z.sourceLayer),"beforeId"in z&&t(4,a=z.beforeId),"beforeLayerType"in z&&t(5,f=z.beforeLayerType),"paint"in z&&t(6,u=z.paint),"layout"in z&&t(7,c=z.layout),"filter"in z&&t(8,_=z.filter),"minzoom"in z&&t(9,d=z.minzoom),"maxzoom"in z&&t(10,m=z.maxzoom),"hoverCursor"in z&&t(11,g=z.hoverCursor),"manageHoverState"in z&&t(12,w=z.manageHoverState),"hovered"in z&&t(0,h=z.hovered),"eventsIfTopMost"in z&&t(13,y=z.eventsIfTopMost),"interactive"in z&&t(14,v=z.interactive),"$$scope"in z&&t(23,o=z.$$scope)},[h,l,i,s,a,f,u,c,_,d,m,g,w,y,v,n,M,j,P,I,R,B,D,o]}class b1 extends ie{constructor(e){super(),se(this,e,h1,g1,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function y1(r,e,t,n,o){let l=!1;r.getSource(e)&&(l=!0,r.removeSource(e));const i=()=>{n(e)&&(r.addSource(e,t),o())};if(l){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function w1(r,e,t){Qs().then(()=>{let n=Gt(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function hi(r){let e=r[0],t,n,o=bi(r);return{c(){o.c(),t=Ze()},m(l,i){o.m(l,i),k(l,t,i),n=!0},p(l,i){i&1&&re(e,e=l[0])?(be(),S(o,1,1,Y),ye(),o=bi(l),o.c(),b(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(b(o),n=!0)},o(l){S(o),n=!1},d(l){l&&L(t),o.d(l)}}}function bi(r){let e;const t=r[15].default,n=Be(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Re(n,t,o,o[14],e?De(t,o[14],l,null):ze(o[14]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function v1(r){let e,t,n=r[0]&&hi(r);return{c(){n&&n.c(),e=Ze()},m(o,l){n&&n.m(o,l),k(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&b(n,1)):(n=hi(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(be(),S(n,1,1,()=>{n=null}),ye())},i(o){t||(b(n),t=!0)},o(o){S(n),t=!1},d(o){o&&L(e),n&&n.d(o)}}}function $1(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{id:a=xn("geojson")}=e,{data:f}=e,{generateId:u=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:m=void 0}=e;const{map:g,cluster:w,self:h}=l1();V(r,g,M=>t(13,o=M)),V(r,w,M=>t(16,l=M)),V(r,h,M=>t(0,n=M));let y,v=!0;return Mt(()=>{n&&y&&o&&(w1(g,n,y),x(h,n=null,n),t(11,y=void 0))}),r.$$set=M=>{"id"in M&&t(4,a=M.id),"data"in M&&t(5,f=M.data),"generateId"in M&&t(6,u=M.generateId),"promoteId"in M&&t(7,c=M.promoteId),"filter"in M&&t(8,_=M.filter),"lineMetrics"in M&&t(9,d=M.lineMetrics),"cluster"in M&&t(10,m=M.cluster),"$$scope"in M&&t(14,s=M.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&x(w,l=m,l),r.$$.dirty&12273&&o&&n!==a&&(x(h,n=a,n),y1(o,n,cr({type:"geojson",data:f,filter:_,lineMetrics:d,generateId:u,promoteId:c,cluster:!!m,clusterMinPoints:m==null?void 0:m.minPoints,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius,clusterProperties:m==null?void 0:m.properties}),M=>o&&M===n,()=>{n&&(t(11,y=o==null?void 0:o.getSource(n)),t(12,v=!0))})),r.$$.dirty&8208&&(o==null||o.on("style.load",()=>{t(11,y=o==null?void 0:o.getSource(a))})),r.$$.dirty&6176&&y&&(v?t(12,v=!1):y.setData(f)),r.$$.dirty&3072&&(y==null||y.setClusterOptions(cr({cluster:!!m,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius})))},[n,g,w,h,a,f,u,c,_,d,m,y,v,o,s,i]}class k1 extends ie{constructor(e){super(),se(this,e,$1,v1,re,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function L1(r){let e;const t=r[15].default,n=Be(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Re(n,t,o,o[23],e?De(t,o[23],l,null):ze(o[23]),null)},i(o){e||(b(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function S1(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[L1]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new ho({props:l}),Ge.push(()=>pt(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],gt(()=>t=!1)),e.$set(a)},i(i){n||(b(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function M1(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=xn("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:w=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function M(z){h=z,t(0,h)}function j(z){Ne.call(this,r,z)}function P(z){Ne.call(this,r,z)}function I(z){Ne.call(this,r,z)}function R(z){Ne.call(this,r,z)}function B(z){Ne.call(this,r,z)}function D(z){Ne.call(this,r,z)}return r.$$set=z=>{"id"in z&&t(1,l=z.id),"source"in z&&t(2,i=z.source),"sourceLayer"in z&&t(3,s=z.sourceLayer),"beforeId"in z&&t(4,a=z.beforeId),"beforeLayerType"in z&&t(5,f=z.beforeLayerType),"paint"in z&&t(6,u=z.paint),"layout"in z&&t(7,c=z.layout),"filter"in z&&t(8,_=z.filter),"minzoom"in z&&t(9,d=z.minzoom),"maxzoom"in z&&t(10,m=z.maxzoom),"hoverCursor"in z&&t(11,g=z.hoverCursor),"manageHoverState"in z&&t(12,w=z.manageHoverState),"hovered"in z&&t(0,h=z.hovered),"eventsIfTopMost"in z&&t(13,y=z.eventsIfTopMost),"interactive"in z&&t(14,v=z.interactive),"$$scope"in z&&t(23,o=z.$$scope)},[h,l,i,s,a,f,u,c,_,d,m,g,w,y,v,n,M,j,P,I,R,B,D,o]}class C1 extends ie{constructor(e){super(),se(this,e,M1,S1,re,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function T1(r){let e,t,n,o,l,i;return e=new b1({props:{id:"edit-polygon-fill",filter:Zg,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new C1({props:{id:"edit-polygon-lines",filter:Kg,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),l=new m1({props:{id:"edit-polygon-vertices",filter:Yg,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment)},m(s,a){A(e,s,a),k(s,t,a),A(n,s,a),k(s,o,a),A(l,s,a),i=!0},p:Y,i(s){i||(b(e.$$.fragment,s),b(n.$$.fragment,s),b(l.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(n.$$.fragment,s),S(l.$$.fragment,s),i=!1},d(s){s&&(L(t),L(o)),F(e,s),F(n,s),F(l,s)}}}function A1(r){let e,t;return e=new k1({props:{data:r[0],$$slots:{default:[T1]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function F1(r,e,t){let n;return V(r,ps,o=>t(0,n=o)),[n]}class E1 extends ie{constructor(e){super(),se(this,e,F1,A1,re,{})}}function P1(r){let e,t,n,o,l,i,s;return{c(){e=$("button"),e.textContent="Import current view",t=C(),n=$("i"),n.textContent="or...",o=C(),l=$("button"),l.textContent="Draw an area to import on the map",E(e,"type","button"),E(l,"type","button")},m(a,f){k(a,e,f),k(a,t,f),k(a,n,f),k(a,o,f),k(a,l,f),i||(s=[X(e,"click",r[2]),X(l,"click",r[3])],i=!0)},p:Y,i:Y,o:Y,d(a){a&&(L(e),L(t),L(n),L(o),L(l)),i=!1,rt(s)}}}function I1(r){let e,t;return e=new n1({props:{polygonTool:r[0]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.polygonTool=n[0]),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function j1(r){let e,t,n,o,l,i,s,a,f;const u=[I1,P1],c=[];function _(d,m){return d[0]?0:1}return e=_(r),t=c[e]=u[e](r),{c(){t.c(),n=C(),o=$("label"),l=$("input"),i=O(`Save a copy of the osm.xml
  after importing`),E(l,"type","checkbox")},m(d,m){c[e].m(d,m),k(d,n,m),k(d,o,m),p(o,l),l.checked=r[1],p(o,i),s=!0,a||(f=X(l,"change",r[5]),a=!0)},p(d,[m]){let g=e;e=_(d),e===g?c[e].p(d,m):(be(),S(c[g],1,1,()=>{c[g]=null}),ye(),t=c[e],t?t.p(d,m):(t=c[e]=u[e](d),t.c()),b(t,1),t.m(n.parentNode,n)),m&2&&(l.checked=d[1])},i(d){s||(b(t),s=!0)},o(d){S(t),s=!1},d(d){d&&(L(n),L(o)),c[e].d(d),a=!1,f()}}}function En(r){return[r.lng,r.lat]}function N1(r,e,t){let{map:n}=e;const o=fn();let l=null,i=!1;async function s(_){try{o("loading","Loading from Overpass");let m=await(await fetch(ys(_))).text();i&&mr("osm.xml",m),o("gotXml",{xml:m,boundary:_})}catch(d){o("error",d.toString())}}function a(){let _=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[En(_.getSouthWest()),En(_.getNorthWest()),En(_.getNorthEast()),En(_.getSouthEast()),En(_.getSouthWest())]],type:"Polygon"}}}async function f(){if(n){if(n.getZoom()<13){o("error","Zoom in more to import");return}await s(a())}}function u(){n&&(t(0,l=new Vg(n)),l.startNew(),l.addEventListenerSuccess(async _=>{t(0,l=null),await s(_)}),l.addEventListenerFailure(()=>{t(0,l=null)}))}function c(){i=this.checked,t(1,i)}return r.$$set=_=>{"map"in _&&t(4,n=_.map)},[l,i,f,u,n,c]}class O1 extends ie{constructor(e){super(),se(this,e,N1,j1,re,{map:4})}}function ys(r){let e='poly:"';for(let[n,o]of r.geometry.coordinates[0])e+=`${o} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class ws{constructor(e,t,n,o){st(this,"inner");this.inner=new _d(e,t||new Uint8Array,n,o)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=B1(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=tl(t.properties.counts_from),t.properties.sum_to=tl(t.properties.counts_to);return e}}function B1(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function fr(r){tn.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let[t,n,o]=await R1(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),Ve.set(new ws(new Uint8Array(t),n?new Uint8Array(n):void 0,o,e.study_area_name||void 0)),Gt(Ve).loadSavefile(e),console.timeEnd("load"),vs()}catch(e){window.alert(`Couldn't open project: ${e}`),tn.set("")}}async function R1(r,e){if(e){let t=Lt(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${t}`);let o=await(await mn(t)).arrayBuffer(),l=Lt(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await mn(l)).json(),a=Lt(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let f=null;try{f=await(await mn(a)).arrayBuffer()}catch(u){console.log(`No demand model: ${u}`)}return[o,f,s]}else if(r.study_area_name){let t=Lt(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${t}`);let o=await(await mn(t)).arrayBuffer(),l=Lt(`boundaries/${r.study_area_name}.geojson`),s=await(await mn(l)).json();return[o,null,s]}else{console.log("Grabbing from Overpass");let t=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await mn(ys(t))).arrayBuffer(),null,t]}}function vs(){fe.set({mode:"pick-neighbourhood"}),Mn.set(new mf(Gt(Yt),Gt(Ve).toRouteSnapper(),St(en()),St(!0),St(0))),Gt(Yt).fitBounds(Gt(Ve).getBounds(),{animate:!1}),Wn.set(zr()),Gn.set(zr()),or.set(zr());let r=new URL(window.location.href);r.searchParams.set("project",Gt(tn)),window.history.replaceState(null,"",r.toString())}function zr(){let r=Gt(Ve).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new Wr.LngLat(e,t)}function yi(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function wi(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function z1(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function D1(r){let e,t,n,o,l,i,s,a;return l=new Me({props:{$$slots:{default:[z1]},$$scope:{ctx:r}}}),l.$on("click",r[13]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),s.textContent="New project",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(f,u){k(f,e,u),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),a=!0},p(f,u){const c={};u&16777216&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){a||(b(l.$$.fragment,f),a=!0)},o(f){S(l.$$.fragment,f),a=!1},d(f){f&&L(e),F(l)}}}function vi(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;e=new Ri({props:{loading:r[4]}});let g=Te(r[3]),w=[];for(let h=0;h<g.length;h+=1)w[h]=ki(yi(r,g,h));return c=new O1({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){T(e.$$.fragment),t=C(),n=$("label"),o=O(`Load a built-in area:
        `),l=$("select"),i=$("option");for(let h=0;h<w.length;h+=1)w[h].c();s=C(),a=$("i"),a.textContent="or...",f=C(),u=$("div"),T(c.$$.fragment),i.__value="",qe(i,i.__value),r[2]===void 0&&pn(()=>r[9].call(l))},m(h,y){A(e,h,y),k(h,t,y),k(h,n,y),p(n,o),p(n,l),p(l,i);for(let v=0;v<w.length;v+=1)w[v]&&w[v].m(l,null);$t(l,r[2],!0),k(h,s,y),k(h,a,y),k(h,f,y),k(h,u,y),A(c,u,null),_=!0,d||(m=[X(l,"change",r[9]),X(l,"change",r[10])],d=!0)},p(h,y){const v={};if(y&16&&(v.loading=h[4]),e.$set(v),y&8){g=Te(h[3]);let j;for(j=0;j<g.length;j+=1){const P=yi(h,g,j);w[j]?w[j].p(P,y):(w[j]=ki(P),w[j].c(),w[j].m(l,null))}for(;j<w.length;j+=1)w[j].d(1);w.length=g.length}y&12&&$t(l,h[2]);const M={};y&32&&(M.map=h[5]),c.$set(M)},i(h){_||(b(e.$$.fragment,h),b(c.$$.fragment,h),_=!0)},o(h){S(e.$$.fragment,h),S(c.$$.fragment,h),_=!1},d(h){h&&(L(t),L(n),L(s),L(a),L(f),L(u)),F(e,h),ot(w,h),F(c),d=!1,rt(m)}}}function $i(r){let e,t=r[21]+"",n,o;return{c(){e=$("option"),n=O(t),e.__value=o=r[20],qe(e,e.__value)},m(l,i){k(l,e,i),p(e,n)},p(l,i){i&8&&t!==(t=l[21]+"")&&oe(n,t),i&8&&o!==(o=l[20])&&(e.__value=o,qe(e,e.__value))},d(l){l&&L(e)}}}function ki(r){let e,t,n=Te(r[17]),o=[];for(let l=0;l<n.length;l+=1)o[l]=$i(wi(r,n,l));return{c(){e=$("optgroup");for(let l=0;l<o.length;l+=1)o[l].c();E(e,"label",t=r[16])},m(l,i){k(l,e,i);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(l,i){if(i&8){n=Te(l[17]);let s;for(s=0;s<n.length;s+=1){const a=wi(l,n,s);o[s]?o[s].p(a,i):(o[s]=$i(a),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}i&8&&t!==(t=l[16])&&E(e,"label",t)},d(l){l&&L(e),ot(o,l)}}}function U1(r){let e,t,n,o,l,i,s,a,f,u=r[1]&&vi(r);return{c(){e=$("div"),t=$("div"),n=$("label"),o=O(`Project name:
        `),l=$("input"),i=C(),u&&u.c(),E(l,"type","text"),E(e,"slot","sidebar")},m(c,_){k(c,e,_),p(e,t),p(t,n),p(n,o),p(n,l),qe(l,r[1]),p(e,i),u&&u.m(e,null),s=!0,a||(f=X(l,"input",r[8]),a=!0)},p(c,_){_&2&&l.value!==c[1]&&qe(l,c[1]),c[1]?u?(u.p(c,_),_&2&&b(u,1)):(u=vi(c),u.c(),b(u,1),u.m(e,null)):u&&(be(),S(u,1,1,()=>{u=null}),ye())},i(c){s||(b(u),s=!0)},o(c){S(u),s=!1},d(c){c&&L(e),u&&u.d(),a=!1,f()}}}function H1(r){let e,t,n;return t=new E1({}),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","map")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p:Y,i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function G1(r){let e,t;return e=new Tt({props:{$$slots:{map:[H1],sidebar:[U1],top:[D1]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&16777342&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function W1(r,e,t){let n,o,l,i;V(r,tn,v=>t(14,n=v)),V(r,Ve,v=>t(15,o=v)),V(r,Yt,v=>t(5,l=v)),V(r,fe,v=>t(6,i=v));let s="",a="",f=[],u="";yr(async()=>{let v=await mn(Lt("severance_pbfs/areas.json"));t(3,f=await v.json())});function c(v){t(4,u="Loading OSM");try{x(Ve,o=new ws(new TextEncoder().encode(v.detail.xml),void 0,v.detail.boundary,void 0),o),x(tn,n=`ltn_${s}`,n),vs(),Ln()}catch(M){window.alert(`Couldn't import from Overpass: ${M}`)}t(4,u="")}async function _(){if(a=="")return;let v=`ltn_${s}`;window.localStorage.setItem(v,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),t(4,u=`Loading pre-clipped OSM area ${a}`),await fr(v),t(4,u="")}function d(){s=this.value,t(1,s)}function m(){a=gn(this),t(2,a),t(3,f)}return[_,s,a,f,u,l,i,c,d,m,()=>_(),v=>t(4,u=v.detail),v=>window.alert(v.detail),()=>x(fe,i={mode:"title",firstLoad:!1},i)]}class q1 extends ie{constructor(e){super(),se(this,e,W1,G1,re,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Li(r,e,t){const n=r.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function Si(r,e,t){const n=r.slice();return n[23]=e[t],n}function J1(r){let e;return{c(){e=$("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',E(e,"slot","top")},m(t,n){k(t,e,n)},p:Y,d(t){t&&L(e)}}}function Z1(r){let e;return{c(){e=$("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){k(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&L(e)}}}function K1(r){let e,t,n,o,l,i,s,a,f,u,c,_,d;t=new Me({props:{$$slots:{default:[Y1]},$$scope:{ctx:r}}}),t.$on("click",r[11]);let m=Te(r[2]),g=[];for(let h=0;h<m.length;h+=1)g[h]=Ci(Li(r,m,h));const w=h=>S(g[h],1,1,()=>{g[h]=null});return{c(){e=$("div"),T(t.$$.fragment),n=C(),o=$("p"),o.textContent="Load a saved project:",l=C(),i=$("ul");for(let h=0;h<g.length;h+=1)g[h].c();s=C(),a=$("label"),f=O(`Load a project from a file
        `),u=$("input"),E(u,"type","file")},m(h,y){k(h,e,y),A(t,e,null),k(h,n,y),k(h,o,y),k(h,l,y),k(h,i,y);for(let v=0;v<g.length;v+=1)g[v]&&g[v].m(i,null);k(h,s,y),k(h,a,y),p(a,f),p(a,u),r[15](u),c=!0,_||(d=X(u,"change",r[6]),_=!0)},p(h,y){const v={};if(y&67108864&&(v.$$scope={dirty:y,ctx:h}),t.$set(v),y&900){m=Te(h[2]);let M;for(M=0;M<m.length;M+=1){const j=Li(h,m,M);g[M]?(g[M].p(j,y),b(g[M],1)):(g[M]=Ci(j),g[M].c(),b(g[M],1),g[M].m(i,null))}for(be(),M=m.length;M<g.length;M+=1)w(M);ye()}},i(h){if(!c){b(t.$$.fragment,h);for(let y=0;y<m.length;y+=1)b(g[y]);c=!0}},o(h){S(t.$$.fragment,h),g=g.filter(Boolean);for(let y=0;y<g.length;y+=1)S(g[y]);c=!1},d(h){h&&(L(e),L(n),L(o),L(l),L(i),L(s),L(a)),F(t),ot(g,h),r[15](null),_=!1,d()}}}function Y1(r){let e;return{c(){e=O("New project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function X1(r){let e=r[23].slice(4)+"",t;return{c(){t=O(e)},m(n,o){k(n,t,o)},p(n,o){o&4&&e!==(e=n[23].slice(4)+"")&&oe(t,e)},d(n){n&&L(t)}}}function Mi(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;function g(){return r[12](r[23])}n=new Me({props:{$$slots:{default:[X1]},$$scope:{ctx:r}}}),n.$on("click",g),s=new ts({props:{color:"black"}});function w(){return r[13](r[23])}u=new ns({props:{color:"white"}});function h(){return r[14](r[23])}return{c(){e=$("li"),t=$("span"),T(n.$$.fragment),o=C(),l=$("span"),i=$("button"),T(s.$$.fragment),a=C(),f=$("button"),T(u.$$.fragment),c=C(),E(i,"class","outline icon-btn"),E(i,"aria-label","Rename project"),E(f,"class","icon-btn destructive"),E(f,"aria-label","Delete project"),ae(l,"display","flex"),ae(l,"gap","16px"),ae(t,"display","flex"),ae(t,"justify-content","space-between")},m(y,v){k(y,e,v),p(e,t),A(n,t,null),p(t,o),p(t,l),p(l,i),A(s,i,null),p(l,a),p(l,f),A(u,f,null),p(e,c),_=!0,d||(m=[X(i,"click",w),X(f,"click",h)],d=!0)},p(y,v){r=y;const M={};v&67108868&&(M.$$scope={dirty:v,ctx:r}),n.$set(M)},i(y){_||(b(n.$$.fragment,y),b(s.$$.fragment,y),b(u.$$.fragment,y),_=!0)},o(y){S(n.$$.fragment,y),S(s.$$.fragment,y),S(u.$$.fragment,y),_=!1},d(y){y&&L(e),F(n),F(s),F(u),d=!1,rt(m)}}}function Ci(r){let e,t=(r[19]??"custom area")+"",n,o,l,i,s=Te(r[20]),a=[];for(let u=0;u<s.length;u+=1)a[u]=Mi(Si(r,s,u));const f=u=>S(a[u],1,1,()=>{a[u]=null});return{c(){e=$("u"),n=O(t),o=C();for(let u=0;u<a.length;u+=1)a[u].c();l=Ze()},m(u,c){k(u,e,c),p(e,n),k(u,o,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(u,c);k(u,l,c),i=!0},p(u,c){if((!i||c&4)&&t!==(t=(u[19]??"custom area")+"")&&oe(n,t),c&900){s=Te(u[20]);let _;for(_=0;_<s.length;_+=1){const d=Si(u,s,_);a[_]?(a[_].p(d,c),b(a[_],1)):(a[_]=Mi(d),a[_].c(),b(a[_],1),a[_].m(l.parentNode,l))}for(be(),_=s.length;_<a.length;_+=1)f(_);ye()}},i(u){if(!i){for(let c=0;c<s.length;c+=1)b(a[c]);i=!0}},o(u){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)S(a[c]);i=!1},d(u){u&&(L(e),L(o),L(l)),ot(a,u)}}}function V1(r){let e,t,n,o;const l=[K1,Z1],i=[];function s(a,f){return a[4]&&a[0]?0:1}return t=s(r),n=i[t]=l[t](r),{c(){e=$("div"),n.c(),E(e,"slot","sidebar")},m(a,f){k(a,e,f),i[t].m(e,null),o=!0},p(a,f){let u=t;t=s(a),t===u?i[t].p(a,f):(be(),S(i[u],1,1,()=>{i[u]=null}),ye(),n=i[t],n?n.p(a,f):(n=i[t]=l[t](a),n.c()),b(n,1),n.m(e,null))},i(a){o||(b(n),o=!0)},o(a){S(n),o=!1},d(a){a&&L(e),i[t].d()}}}function Q1(r){let e,t,n,o;return e=new Ri({props:{loading:r[1]}}),n=new Tt({props:{$$slots:{sidebar:[V1],top:[J1]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment)},m(l,i){A(e,l,i),k(l,t,i),A(n,l,i),o=!0},p(l,[i]){const s={};i&2&&(s.loading=l[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(b(e.$$.fragment,l),b(n.$$.fragment,l),o=!0)},o(l){S(e.$$.fragment,l),S(n.$$.fragment,l),o=!1},d(l){l&&L(t),F(e,l),F(n,l)}}}function rr(){let r=new Map,e=[];for(let n=0;n<window.localStorage.length;n++){let o=window.localStorage.key(n);if(o.startsWith("ltn_")){let l="";try{l=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch{}l&&l.length>0?(r.has(l)||r.set(l,[]),r.get(l).push(o)):e.push(o)}}let t=[...r.entries()];return t.sort((n,o)=>n[0].localeCompare(o[0])),t.push(["custom",e]),t}function x1(r,e,t){let n,o,l,i,s;V(r,tn,P=>t(16,n=P)),V(r,Mn,P=>t(17,o=P)),V(r,Ve,P=>t(18,l=P)),V(r,Yt,P=>t(4,i=P)),V(r,fe,P=>t(5,s=P));let{wasmReady:a}=e,{firstLoad:f}=e,u="";if(x(Ve,l=null,l),x(Mn,o=null,o),x(tn,n="",n),f){let I=new URLSearchParams(window.location.search).get("project");I&&(u=`Loading project ${I}`,fr(I))}else{let P=new URL(window.location.href);P.searchParams.delete("project"),window.history.replaceState(null,"",P.toString())}let c=rr(),_;async function d(P){let I="ltn_"+_.files[0].name;t(1,u=`Loading from file ${I}`),window.localStorage.setItem(I,await _.files[0].text()),t(2,c=rr()),await fr(I),t(1,u="")}function m(P){window.confirm(`Really delete project ${P}? You can't undo this.`)&&(window.localStorage.removeItem(P),t(2,c=rr()))}function g(P){let I=window.prompt(`Rename project ${P} to what?`,P);if(I){I.startsWith("ltn_")||(I=`ltn_${I}`);let R=window.localStorage.getItem(P);window.localStorage.setItem(I,R),window.localStorage.removeItem(P),t(2,c=rr())}}async function w(P){t(1,u=`Loading project ${P}`),await fr(P),t(1,u="")}const h=()=>x(fe,s={mode:"new-project"},s),y=P=>w(P),v=P=>g(P),M=P=>m(P);function j(P){Ge[P?"unshift":"push"](()=>{_=P,t(3,_)})}return r.$$set=P=>{"wasmReady"in P&&t(0,a=P.wasmReady),"firstLoad"in P&&t(10,f=P.firstLoad)},[a,u,c,_,i,s,d,m,g,w,f,h,y,v,M,j]}class eh extends ie{constructor(e){super(),se(this,e,x1,Q1,re,{wasmReady:0,firstLoad:10})}}function th(r){let e;return{c(){e=O("Choose project")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function nh(r){let e;return{c(){e=O("Pick neighbourhood")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function rh(r){let e;return{c(){e=O("Editing")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function oh(r){let e,t,n,o,l,i,s,a,f,u,c,_,d,m;return l=new Me({props:{$$slots:{default:[th]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new Me({props:{$$slots:{default:[nh]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Me({props:{$$slots:{default:[rh]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=C(),s=$("li"),T(a.$$.fragment),f=C(),u=$("li"),T(c.$$.fragment),_=C(),d=$("li"),d.textContent="Viewing shortcuts",E(t,"aria-label","breadcrumb"),E(e,"slot","top")},m(g,w){k(g,e,w),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,f),p(n,u),A(c,u,null),p(n,_),p(n,d),m=!0},p(g,w){const h={};w&1024&&(h.$$scope={dirty:w,ctx:g}),l.$set(h);const y={};w&1024&&(y.$$scope={dirty:w,ctx:g}),a.$set(y);const v={};w&1024&&(v.$$scope={dirty:w,ctx:g}),c.$set(v)},i(g){m||(b(l.$$.fragment,g),b(a.$$.fragment,g),b(c.$$.fragment,g),m=!0)},o(g){S(l.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&L(e),F(l),F(a),F(c)}}}function lh(r){let e,t,n,o,l,i,s,a,f,u,c=dt(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,m,g,w,h;function y(M){r[5](M)}let v={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(v.idx=r[0].shortcutIndex),l=new Lr({props:v}),Ge.push(()=>pt(l,"idx",y)),{c(){e=$("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=C(),n=$("button"),n.textContent="Pick a different road",o=C(),T(l.$$.fragment),s=C(),a=$("p"),f=O("This shortcut is "),u=$("b"),_=O(c),d=O("x"),m=O(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(M,j){k(M,e,j),k(M,t,j),k(M,n,j),k(M,o,j),A(l,M,j),k(M,s,j),k(M,a,j),p(a,f),p(a,u),p(u,_),p(u,d),p(a,m),g=!0,w||(h=X(n,"click",r[4]),w=!0)},p(M,j){const P={};j&1&&(P.list=M[0].gj.features),!i&&j&1&&(i=!0,P.idx=M[0].shortcutIndex,gt(()=>i=!1)),l.$set(P),(!g||j&1)&&c!==(c=dt(M[0].gj.features[M[0].shortcutIndex].properties).directness.toFixed(1)+"")&&oe(_,c)},i(M){g||(b(l.$$.fragment,M),g=!0)},o(M){S(l.$$.fragment,M),g=!1},d(M){M&&(L(e),L(t),L(n),L(o),L(s),L(a)),F(l,M),w=!1,h()}}}function ih(r){let e;return{c(){e=$("p"),e.textContent="Click a road to see shortcuts"},m(t,n){k(t,e,n)},p:Y,i:Y,o:Y,d(t){t&&L(e)}}}function sh(r){let e,t,n,o,l,i;t=new cn({}),t.$on("click",r[3]);const s=[ih,lh],a=[];function f(u,c){return u[0].state=="neutral"?0:u[0].state=="chose-road"?1:-1}return~(o=f(r))&&(l=a[o]=s[o](r)),{c(){e=$("div"),T(t.$$.fragment),n=C(),l&&l.c(),E(e,"slot","sidebar")},m(u,c){k(u,e,c),A(t,e,null),p(e,n),~o&&a[o].m(e,null),i=!0},p(u,c){let _=o;o=f(u),o===_?~o&&a[o].p(u,c):(l&&(be(),S(a[_],1,1,()=>{a[_]=null}),ye()),~o?(l=a[o],l?l.p(u,c):(l=a[o]=s[o](u),l.c()),b(l,1),l.m(e,null)):l=null)},i(u){i||(b(t.$$.fragment,u),b(l),i=!0)},o(u){S(t.$$.fragment,u),S(l),i=!1},d(u){u&&L(e),F(t),~o&&a[o].d()}}}function ah(r){let e,t;return e=new Vn({props:{interactive:!1}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function fh(r){let e,t;return e=new Vn({props:{onClickLine:r[2],$$slots:{"line-popup":[ch]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function uh(r){let e,t=r[9].shortcuts+"",n,o,l=(r[9].name??"unnamed road")+"",i;return{c(){e=$("p"),n=O(t),o=O(" shortcuts through "),i=O(l)},m(s,a){k(s,e,a),p(e,n),p(e,o),p(e,i)},p(s,a){a&512&&t!==(t=s[9].shortcuts+"")&&oe(n,t),a&512&&l!==(l=(s[9].name??"unnamed road")+"")&&oe(i,l)},d(s){s&&L(e)}}}function ch(r){let e,t,n;return t=new ht({props:{openOn:"hover",$$slots:{default:[uh,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","line-popup")},m(o,l){k(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(b(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&L(e),F(t)}}}function dh(r){let e,t,n,o,l,i,s,a,f,u;e=new Mr({}),n=new Sr({}),l=new Cr({});const c=[fh,ah],_=[];function d(m,g){return m[0].state=="neutral"?0:m[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),a&&a.c(),f=Ze()},m(m,g){A(e,m,g),k(m,t,g),A(n,m,g),k(m,o,g),A(l,m,g),k(m,i,g),~s&&_[s].m(m,g),k(m,f,g),u=!0},p(m,g){let w=s;s=d(m),s===w?~s&&_[s].p(m,g):(a&&(be(),S(_[w],1,1,()=>{_[w]=null}),ye()),~s?(a=_[s],a?a.p(m,g):(a=_[s]=c[s](m),a.c()),b(a,1),a.m(f.parentNode,f)):a=null)},i(m){u||(b(e.$$.fragment,m),b(n.$$.fragment,m),b(l.$$.fragment,m),b(a),u=!0)},o(m){S(e.$$.fragment,m),S(n.$$.fragment,m),S(l.$$.fragment,m),S(a),u=!1},d(m){m&&(L(t),L(o),L(i),L(f)),F(e,m),F(n,m),F(l,m),~s&&_[s].d(m)}}}function Ti(r){let e,t,n,o,l,i,s,a;return e=new Ke({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[_h]},$$scope:{ctx:r}}}),n=new Ke({props:{data:r[0].roadGj,$$slots:{default:[mh]},$$scope:{ctx:r}}}),l=new yn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[ph]},$$scope:{ctx:r}}}),s=new yn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[gh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),T(s.$$.fragment)},m(f,u){A(e,f,u),k(f,t,u),A(n,f,u),k(f,o,u),A(l,f,u),k(f,i,u),A(s,f,u),a=!0},p(f,u){const c={};u&1&&(c.data=f[0].gj.features[f[0].shortcutIndex]),u&1024&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};u&1&&(_.data=f[0].roadGj),u&1024&&(_.$$scope={dirty:u,ctx:f}),n.$set(_);const d={};u&1&&(d.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[0]),u&1024&&(d.$$scope={dirty:u,ctx:f}),l.$set(d);const m={};u&1&&(m.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[f[0].gj.features[f[0].shortcutIndex].geometry.coordinates.length-1]),u&1024&&(m.$$scope={dirty:u,ctx:f}),s.$set(m)},i(f){a||(b(e.$$.fragment,f),b(n.$$.fragment,f),b(l.$$.fragment,f),b(s.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(n.$$.fragment,f),S(l.$$.fragment,f),S(s.$$.fragment,f),a=!1},d(f){f&&(L(t),L(o),L(i)),F(e,f),F(n,f),F(l,f),F(s,f)}}}function _h(r){let e,t;const n=[Le("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function mh(r){let e,t;const n=[Le("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new xe({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function ph(r){let e;return{c(){e=O("A")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function gh(r){let e;return{c(){e=O("B")},m(t,n){k(t,e,n)},d(t){t&&L(e)}}}function hh(r){let e,t,n,o,l,i;t=new Qn({props:{$$slots:{default:[dh]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Ti(r);return l=new dn({}),{c(){e=$("div"),T(t.$$.fragment),n=C(),s&&s.c(),o=C(),T(l.$$.fragment),E(e,"slot","map")},m(a,f){k(a,e,f),A(t,e,null),p(e,n),s&&s.m(e,null),p(e,o),A(l,e,null),i=!0},p(a,f){const u={};f&1025&&(u.$$scope={dirty:f,ctx:a}),t.$set(u),a[0].state=="chose-road"?s?(s.p(a,f),f&1&&b(s,1)):(s=Ti(a),s.c(),b(s,1),s.m(e,o)):s&&(be(),S(s,1,1,()=>{s=null}),ye())},i(a){i||(b(t.$$.fragment,a),b(s),b(l.$$.fragment,a),i=!0)},o(a){S(t.$$.fragment,a),S(s),S(l.$$.fragment,a),i=!1},d(a){a&&L(e),F(t),s&&s.d(),F(l)}}}function bh(r){let e,t;return e=new Tt({props:{$$slots:{map:[hh],sidebar:[sh],top:[oh]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function yh(r,e,t){let n,o;V(r,fe,_=>t(1,n=_)),V(r,Ve,_=>t(8,o=_));let l={state:"neutral"};function i(_,d){let m=o.getShortcutsCrossingRoad(_.properties.id);if(m.features.length==0){window.alert("No shortcuts here");return}t(0,l={state:"chose-road",roadGj:_,gj:m,shortcutIndex:0})}function s(){x(fe,n={mode:"neighbourhood"},n)}const a=()=>t(0,l={state:"neutral"});function f(_){r.$$.not_equal(l.shortcutIndex,_)&&(l.shortcutIndex=_,t(0,l))}return[l,n,i,s,a,f,()=>x(fe,n={mode:"title",firstLoad:!1},n),()=>x(fe,n={mode:"pick-neighbourhood"},n)]}class wh extends ie{constructor(e){super(),se(this,e,yh,bh,re,{})}}function vh(r){let e,t,n,o,l,i,s,a,f;return o=new Jg({}),{c(){e=$("div"),t=$("button"),t.innerHTML=`<img src="${ra}" style="height: 6vh;" alt="A/B Street logo"/>`,n=C(),T(o.$$.fragment),l=C(),i=$("span"),E(t,"class","outline"),ae(i,"width","100%"),E(e,"slot","top"),E(e,"class","pico"),ae(e,"display","flex")},m(u,c){k(u,e,c),p(e,t),p(e,n),A(o,e,null),p(e,l),p(e,i),r[20](i),s=!0,a||(f=X(t,"click",r[19]),a=!0)},p:Y,i(u){s||(b(o.$$.fragment,u),s=!0)},o(u){S(o.$$.fragment,u),s=!1},d(u){u&&L(e),F(o),r[20](null),a=!1,f()}}}function Ai(r){let e,t,n,o,l,i;return n=new Cu({props:{map:dt(r[6]),maptilerBasemap:r[7]}}),{c(){e=$("button"),e.textContent="Zoom to fit study area",t=C(),T(n.$$.fragment),E(e,"class","secondary")},m(s,a){k(s,e,a),k(s,t,a),A(n,s,a),o=!0,l||(i=X(e,"click",r[11]),l=!0)},p(s,a){const f={};a&64&&(f.map=dt(s[6])),a&128&&(f.maptilerBasemap=s[7]),n.$set(f)},i(s){o||(b(n.$$.fragment,s),o=!0)},o(s){S(n.$$.fragment,s),o=!1},d(s){s&&(L(e),L(t)),F(n,s),l=!1,i()}}}function $h(r){let e,t,n,o,l,i,s=r[5]&&Ai(r);return{c(){e=$("div"),t=$("div"),n=C(),o=$("hr"),l=C(),s&&s.c(),E(e,"class","pico"),E(e,"slot","left")},m(a,f){k(a,e,f),p(e,t),r[18](t),p(e,n),p(e,o),p(e,l),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&b(s,1)):(s=Ai(a),s.c(),b(s,1),s.m(e,null)):s&&(be(),S(s,1,1,()=>{s=null}),ye())},i(a){i||(b(s),i=!0)},o(a){S(s),i=!1},d(a){a&&L(e),r[18](null),s&&s.d()}}}function Fi(r){let e,t;return e=new sd({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function kh(r){let e,t;return e=new q1({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Lh(r){let e,t;return e=new eh({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&16&&(l.wasmReady=n[4]),o&512&&(l.firstLoad=n[9].firstLoad),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Ei(r){let e,t,n,o,l,i;e=new Ke({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[Sh]},$$scope:{ctx:r}}});const s=[Bh,Oh,Nh,jh,Ih,Ph,Eh,Fh,Ah,Th,Ch,Mh],a=[];function f(u,c){return u[9].mode=="pick-neighbourhood"?0:u[9].mode=="set-boundary"?1:u[9].mode=="auto-boundaries"?2:u[9].mode=="neighbourhood"?3:u[9].mode=="view-shortcuts"?4:u[9].mode=="impact-one-destination"?5:u[9].mode=="route"?6:u[9].mode=="predict-impact"?7:u[9].mode=="impact-detail"?8:u[9].mode=="debug-neighbourhood"?9:u[9].mode=="debug-intersections"?10:u[9].mode=="debug-demand"?11:-1}return~(n=f(r))&&(o=a[n]=s[n](r)),{c(){T(e.$$.fragment),t=C(),o&&o.c(),l=Ze()},m(u,c){A(e,u,c),k(u,t,c),~n&&a[n].m(u,c),k(u,l,c),i=!0},p(u,c){const _={};c&32&&(_.data=u[5].getInvertedBoundary()),c&4194304&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);let d=n;n=f(u),n===d?~n&&a[n].p(u,c):(o&&(be(),S(a[d],1,1,()=>{a[d]=null}),ye()),~n?(o=a[n],o?o.p(u,c):(o=a[n]=s[n](u),o.c()),b(o,1),o.m(l.parentNode,l)):o=null)},i(u){i||(b(e.$$.fragment,u),b(o),i=!0)},o(u){S(e.$$.fragment,u),S(o),i=!1},d(u){u&&(L(t),L(l)),F(e,u),~n&&a[n].d(u)}}}function Sh(r){let e,t;const n=[Le("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=pe(o,n[l]);return e=new Ct({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(b(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){F(e,l)}}}function Mh(r){let e,t;return e=new Xd({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Ch(r){let e,t;return e=new i_({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Th(r){let e,t;return e=new G_({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Ah(r){let e,t;return e=new fp({props:{road:r[9].road}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.road=n[9].road),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Fh(r){let e,t;return e=new eg({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Eh(r){let e,t;return e=new _g({props:{prevMode:r[9].prevMode}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.prevMode=n[9].prevMode),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Ph(r){let e,t;return e=new Lp({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Ih(r){let e,t;return e=new wh({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function jh(r){let e,t;return e=new Vm({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Nh(r){let e,t;return e=new zd({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Oh(r){let e,t;return e=new Ug({props:{name:r[9].name,existing:r[9].existing}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&512&&(l.name=n[9].name),o&512&&(l.existing=n[9].existing),e.$set(l)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Bh(r){let e,t;return e=new Gp({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Y,i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){F(e,n)}}}function Rh(r){let e,t,n,o,l,i,s=r[8].startsWith("ltn_cnt/"),a,f,u,c,_,d,m,g,w;e=new ea({}),n=new ta({}),l=new uc({props:{map:r[0],apiKey:qr,country:void 0}});let h=s&&Fi();const y=[Lh,kh],v=[];function M(P,I){return P[9].mode=="title"?0:P[9].mode=="new-project"?1:-1}~(c=M(r))&&(_=v[c]=y[c](r));let j=r[5]&&Ei(r);return g=new Jf({}),{c(){T(e.$$.fragment),t=C(),T(n.$$.fragment),o=C(),T(l.$$.fragment),i=C(),h&&h.c(),a=C(),f=$("div"),u=C(),_&&_.c(),d=C(),j&&j.c(),m=C(),T(g.$$.fragment)},m(P,I){A(e,P,I),k(P,t,I),A(n,P,I),k(P,o,I),A(l,P,I),k(P,i,I),h&&h.m(P,I),k(P,a,I),k(P,f,I),r[15](f),k(P,u,I),~c&&v[c].m(P,I),k(P,d,I),j&&j.m(P,I),k(P,m,I),A(g,P,I),w=!0},p(P,I){const R={};I&1&&(R.map=P[0]),l.$set(R),I&256&&(s=P[8].startsWith("ltn_cnt/")),s?h?I&256&&b(h,1):(h=Fi(),h.c(),b(h,1),h.m(a.parentNode,a)):h&&(be(),S(h,1,1,()=>{h=null}),ye());let B=c;c=M(P),c===B?~c&&v[c].p(P,I):(_&&(be(),S(v[B],1,1,()=>{v[B]=null}),ye()),~c?(_=v[c],_?_.p(P,I):(_=v[c]=y[c](P),_.c()),b(_,1),_.m(d.parentNode,d)):_=null),P[5]?j?(j.p(P,I),I&32&&b(j,1)):(j=Ei(P),j.c(),b(j,1),j.m(m.parentNode,m)):j&&(be(),S(j,1,1,()=>{j=null}),ye())},i(P){w||(b(e.$$.fragment,P),b(n.$$.fragment,P),b(l.$$.fragment,P),b(h),b(_),b(j),b(g.$$.fragment,P),w=!0)},o(P){S(e.$$.fragment,P),S(n.$$.fragment,P),S(l.$$.fragment,P),S(h),S(_),S(j),S(g.$$.fragment,P),w=!1},d(P){P&&(L(t),L(o),L(i),L(a),L(f),L(u),L(d),L(m)),F(e,P),F(n,P),F(l,P),h&&h.d(P),r[15](null),~c&&v[c].d(P),j&&j.d(P),F(g,P)}}}function zh(r){let e,t,n,o;function l(s){r[16](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${qr}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"oneway_arrow",url:na},{id:"national_rail",url:Bi}],$$slots:{default:[Rh]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),t=new xs({props:i}),Ge.push(()=>pt(t,"map",l)),t.$on("error",r[17]),{c(){e=$("div"),T(t.$$.fragment),E(e,"slot","main"),ae(e,"position","relative"),ae(e,"width","100%"),ae(e,"height","100%")},m(s,a){k(s,e,a),A(t,e,null),o=!0},p(s,a){const f={};a&128&&(f.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${qr}`),a&4195129&&(f.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,f.map=s[0],gt(()=>n=!1)),t.$set(f)},i(s){o||(b(t.$$.fragment,s),o=!0)},o(s){S(t.$$.fragment,s),o=!1},d(s){s&&L(e),F(t)}}}function Dh(r){let e,t,n,o,l;return t=new bf({}),o=new $d({props:{$$slots:{main:[zh],left:[$h],top:[vh]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=C(),T(o.$$.fragment),E(e,"class","pico")},m(i,s){k(i,e,s),A(t,e,null),k(i,n,s),A(o,i,s),l=!0},p(i,[s]){const a={};s&4196351&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(b(t.$$.fragment,i),b(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&(L(e),L(n)),F(t),F(o,i)}}}function Uh(r,e,t){let n,o,l,i,s,a,f,u,c,_;V(r,Qr,B=>t(12,n=B)),V(r,Vr,B=>t(13,o=B)),V(r,Xr,B=>t(14,l=B)),V(r,Ve,B=>t(5,i=B)),V(r,Yt,B=>t(6,s=B)),V(r,ko,B=>t(21,a=B)),V(r,Ur,B=>t(7,f=B)),V(r,tn,B=>t(8,u=B)),V(r,fe,B=>t(9,c=B)),V(r,ur,B=>t(10,_=B));let d=!1;yr(async()=>{await ss(),await Di(),t(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(x(ko,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let m=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let w,h,y;function v(B){Ge[B?"unshift":"push"](()=>{y=B,t(3,y),t(12,n)})}function M(B){m=B,t(0,m)}const j=B=>{console.log(B.detail.error)};function P(B){Ge[B?"unshift":"push"](()=>{h=B,t(2,h),t(13,o)})}const I=()=>x(ur,_=!0,_);function R(B){Ge[B?"unshift":"push"](()=>{w=B,t(1,w),t(14,l)})}return r.$$.update=()=>{r.$$.dirty&1&&m&&Yt.set(m),r.$$.dirty&16386&&w&&l&&(t(1,w.innerHTML="",w),w.appendChild(l)),r.$$.dirty&8196&&h&&o&&(t(2,h.innerHTML="",h),h.appendChild(o)),r.$$.dirty&4104&&y&&n&&(t(3,y.innerHTML="",y),y.appendChild(n))},[m,w,h,y,d,i,s,f,u,c,_,g,n,o,l,v,M,j,P,I,R]}class Hh extends ie{constructor(e){super(),se(this,e,Uh,Dh,re,{})}}new Hh({target:document.getElementById("app")});
