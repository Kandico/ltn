var nk=Object.defineProperty;var rk=(r,e,t)=>e in r?nk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var tr=(r,e,t)=>(rk(r,typeof e!="symbol"?e+"":e,t),t);function ik(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function lt(){}function Mt(r,e){for(const t in e)r[t]=e[t];return r}function nw(r){return r()}function W0(){return Object.create(null)}function sr(r){r.forEach(nw)}function ca(r){return typeof r=="function"}function wt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let bd;function Sr(r,e){return r===e?!0:(bd||(bd=document.createElement("a")),bd.href=e,r===bd.href)}function ok(r){return Object.keys(r).length===0}function Lg(r,...e){if(r==null){for(const n of e)n(void 0);return lt}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function hi(r){let e;return Lg(r,t=>e=t)(),e}function st(r,e,t){r.$$.on_destroy.push(Lg(e,t))}function vn(r,e,t,n){if(r){const i=rw(r,e,t,n);return r[0](i)}}function rw(r,e,t,n){return r[1]&&n?Mt(t.ctx.slice(),r[1](n(e))):t.ctx}function bn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function wn(r,e,t,n,i,o){if(i){const u=rw(e,t,n,o);r.p(u,i)}}function xn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function or(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function Z0(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Ig(r){const e={};for(const t in r)e[t]=!0;return e}function Yu(r){return r??""}function an(r,e,t){return r.set(t),e}function qm(r){return r&&ca(r.destroy)?r.destroy:lt}const iw=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function D(r,e){r.appendChild(e)}function W(r,e,t){r.insertBefore(e,t||null)}function G(r){r.parentNode&&r.parentNode.removeChild(r)}function di(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function j(r){return document.createElement(r)}function bs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Te(r){return document.createTextNode(r)}function ne(){return Te(" ")}function rr(){return Te("")}function St(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Pg(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Mf(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function ue(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Hd(r,e){for(const t in e)ue(r,t,e[t])}function sk(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function zg(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function Il(r){return r===""?null:+r}function ak(r){return Array.from(r.childNodes)}function xt(r,e){e=""+e,r.data!==e&&(r.data=e)}function Nn(r,e){r.value=e??""}function Xe(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Ci(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function ia(r){const e=r.querySelector(":checked");return e&&e.__value}function Gt(r,e,t){r.classList.toggle(e,!!t)}function lk(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Nf;function Ef(r){Nf=r}function Jf(){if(!Nf)throw new Error("Function called outside component initialization");return Nf}function ls(r){Jf().$$.on_mount.push(r)}function ei(r){Jf().$$.on_destroy.push(r)}function $s(){const r=Jf();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=lk(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function ap(r,e){return Jf().$$.context.set(r,e),e}function Yf(r){return Jf().$$.context.get(r)}function Sn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Uu=[],_n=[];let Zu=[];const Hm=[],ow=Promise.resolve();let Gm=!1;function sw(){Gm||(Gm=!0,ow.then(lw))}function aw(){return sw(),ow}function Yo(r){Zu.push(r)}function Dn(r){Hm.push(r)}const Cm=new Set;let Ru=0;function lw(){if(Ru!==0)return;const r=Nf;do{try{for(;Ru<Uu.length;){const e=Uu[Ru];Ru++,Ef(e),uk(e.$$)}}catch(e){throw Uu.length=0,Ru=0,e}for(Ef(null),Uu.length=0,Ru=0;_n.length;)_n.pop()();for(let e=0;e<Zu.length;e+=1){const t=Zu[e];Cm.has(t)||(Cm.add(t),t())}Zu.length=0}while(Uu.length);for(;Hm.length;)Hm.pop()();Gm=!1,Cm.clear(),Ef(r)}function uk(r){if(r.fragment!==null){r.update(),sr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Yo)}}function ck(r){const e=[],t=[];Zu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Zu=e}const Pd=new Set;let Tl;function Xt(){Tl={r:0,c:[],p:Tl}}function Kt(){Tl.r||sr(Tl.c),Tl=Tl.p}function N(r,e){r&&r.i&&(Pd.delete(r),r.i(e))}function V(r,e,t,n){if(r&&r.o){if(Pd.has(r))return;Pd.add(r),Tl.c.push(()=>{Pd.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function On(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function fk(r,e){V(r,1,1,()=>{e.delete(r.key)})}function hk(r,e,t,n,i,o,u,s,d,p,g,y){let x=r.length,C=o.length,T=x;const E={};for(;T--;)E[r[T].key]=T;const z=[],I=new Map,L=new Map,B=[];for(T=C;T--;){const H=y(i,o,T),Z=t(H);let _e=u.get(Z);_e?n&&B.push(()=>_e.p(H,e)):(_e=p(Z,H),_e.c()),I.set(Z,z[T]=_e),Z in E&&L.set(Z,Math.abs(T-E[Z]))}const O=new Set,Y=new Set;function q(H){N(H,1),H.m(s,g),u.set(H.key,H),g=H.first,C--}for(;x&&C;){const H=z[C-1],Z=r[x-1],_e=H.key,Ie=Z.key;H===Z?(g=H.first,x--,C--):I.has(Ie)?!u.has(_e)||O.has(_e)?q(H):Y.has(Ie)?x--:L.get(_e)>L.get(Ie)?(Y.add(_e),q(H)):(O.add(Ie),x--):(d(Z,u),x--)}for(;x--;){const H=r[x];I.has(H.key)||d(H,u)}for(;C;)q(z[C-1]);return sr(B),z}function Tn(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],s=e[o];if(s){for(const d in u)d in s||(n[d]=1);for(const d in s)i[d]||(t[d]=s[d],i[d]=1);r[o]=s}else for(const d in u)i[d]=1}for(const u in n)u in t||(t[u]=void 0);return t}function Yi(r){return typeof r=="object"&&r!==null?r:{}}function Rn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ae(r){r&&r.c()}function oe(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),Yo(()=>{const o=r.$$.on_mount.map(nw).filter(ca);r.$$.on_destroy?r.$$.on_destroy.push(...o):sr(o),r.$$.on_mount=[]}),i.forEach(Yo)}function se(r,e){const t=r.$$;t.fragment!==null&&(ck(t.after_update),sr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function dk(r,e){r.$$.dirty[0]===-1&&(Uu.push(r),sw(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ct(r,e,t,n,i,o,u=null,s=[-1]){const d=Nf;Ef(r);const p=r.$$={fragment:null,ctx:[],props:o,update:lt,not_equal:i,bound:W0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:W0(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(y,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[y],p.ctx[y]=T)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](T),g&&dk(r,y)),x}):[],p.update(),g=!0,sr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=ak(e.target);p.fragment&&p.fragment.l(y),y.forEach(G)}else p.fragment&&p.fragment.c();e.intro&&N(r.$$.fragment),oe(r,e.target,e.anchor),lw()}Ef(d)}class Tt{constructor(){tr(this,"$$");tr(this,"$$set")}$destroy(){se(this,1),this.$destroy=lt}$on(e,t){if(!ca(t))return lt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!ok(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const pk="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(pk);const mk="/ltn/assets/arrow-big-up-4ad5891e.png",gk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",_k="/ltn/assets/favicon-a1b7e783.ico",yk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==",uw="/ltn/assets/no_left_turn-dabd0fc9.png",Dg="/ltn/assets/no_right_turn-74f14f9d.png",cw="/ltn/assets/no_straight_turn-b5273de3.png",fw="/ltn/assets/no_u_left_to_right_turn-59028775.png",hw="/ltn/assets/no_u_right_to_left_turn-1ad8fc8a.png",vk="/ltn/assets/logo-97f2d067.svg",dw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function bk(r){let e,t,n,i,o;const u=r[5].default,s=vn(u,r,r[4],null);return{c(){e=j("dialog"),t=j("article"),s&&s.c()},m(d,p){W(d,e,p),D(e,t),s&&s.m(t,null),r[6](e),n=!0,i||(o=[St(e,"click",Mf(r[1])),St(e,"keydown",r[2])],i=!0)},p(d,[p]){s&&s.p&&(!n||p&16)&&wn(s,u,d,d[4],n?bn(u,d[4],p,null):xn(d[4]),null)},i(d){n||(N(s,d),n=!0)},o(d){V(s,d),n=!1},d(d){d&&G(e),s&&s.d(d),r[6](null),i=!1,sr(o)}}}function wk(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function s(g){g.target==u&&t(3,o=!1)}function d(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){_n[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,s,d,o,i,n,p]}class Rg extends Tt{constructor(e){super(),Ct(this,e,wk,bk,wt,{show:3})}}function X0(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function K0(r){let e,t,n=r[1]+"",i,o,u,s=r[2]+"",d,p;return{c(){e=j("tr"),t=j("td"),i=Te(n),o=ne(),u=j("td"),d=Te(s),p=ne()},m(g,y){W(g,e,y),D(e,t),D(t,i),D(e,o),D(e,u),D(u,d),D(e,p)},p(g,y){y&1&&n!==(n=g[1]+"")&&xt(i,n),y&1&&s!==(s=g[2]+"")&&xt(d,s)},d(g){g&&G(e)}}}function xk(r){let e,t,n=On(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=K0(X0(r,n,o));return{c(){e=j("table"),t=j("tbody");for(let o=0;o<i.length;o+=1)i[o].c();ue(e,"class","svelte-lh2o9l")},m(o,u){W(o,e,u),D(e,t);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[u]){if(u&1){n=On(Object.entries(o[0]));let s;for(s=0;s<n.length;s+=1){const d=X0(o,n,s);i[s]?i[s].p(d,u):(i[s]=K0(d),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}},i:lt,o:lt,d(o){o&&G(e),di(i,o)}}}function Ak(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Qf extends Tt{constructor(e){super(),Ct(this,e,Ak,xk,wt,{properties:0})}}function J0(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Y0(r){let e,t,n,i,o=r[4]+"",u,s;return{c(){e=j("div"),t=j("span"),i=ne(),u=Te(o),s=ne(),ue(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Xe(t,"background",r[5]),Xe(e,"display","flex"),Xe(e,"align-items","center"),Xe(e,"gap","6px")},m(d,p){W(d,e,p),D(e,t),D(e,i),D(e,u),D(e,s)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&ue(t,"class",n),p&1&&Xe(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&xt(u,o)},d(d){d&&G(e)}}}function kk(r){let e,t=On(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=Y0(J0(r,t,i));return{c(){e=j("div");for(let i=0;i<n.length;i+=1)n[i].c();Xe(e,"display","grid"),Xe(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Xe(e,"gap","10px")},m(i,o){W(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=On(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const s=J0(i,t,u);n[u]?n[u].p(s,o):(n[u]=Y0(s),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:lt,o:lt,d(i){i&&G(e),di(n,i)}}}function Sk(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=s=>{"labelColors"in s&&t(0,n=s.labelColors),"swatchClass"in s&&t(1,i=s.swatchClass),"itemsPerRow"in s&&t(3,o=s.itemsPerRow)},[n,i,u,o]}class Bg extends Tt{constructor(e){super(),Ct(this,e,Sk,kk,wt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Q0(r,e,t){const n=r.slice();return n[6]=e[t],n}function ey(r,e,t){const n=r.slice();return n[9]=e[t],n}function ty(r){let e,t;return{c(){e=j("span"),t=Te(" "),ue(e,"class","bucket svelte-3plrz9"),Xe(e,"background",r[9])},m(n,i){W(n,e,i),D(e,t)},p(n,i){i&1&&Xe(e,"background",n[9])},d(n){n&&G(e)}}}function ny(r){let e;return{c(){e=j("span"),e.textContent=`${r[6]}`,ue(e,"class","svelte-3plrz9")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function Ck(r){let e,t,n,i,o=On(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=ty(ey(r,o,p));let s=On(r[3]),d=[];for(let p=0;p<s.length;p+=1)d[p]=ny(Q0(r,s,p));return{c(){e=j("div"),t=j("div");for(let p=0;p<u.length;p+=1)u[p].c();n=ne(),i=j("div");for(let p=0;p<d.length;p+=1)d[p].c();ue(t,"class","colors svelte-3plrz9"),ue(i,"class","labels svelte-3plrz9"),ue(e,"class","svelte-3plrz9"),Gt(e,"full-width-bucket-legend",r[2]),Gt(e,"bucketed",r[1].hasOwnProperty("buckets")),Gt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){W(p,e,g),D(e,t);for(let y=0;y<u.length;y+=1)u[y]&&u[y].m(t,null);D(e,n),D(e,i);for(let y=0;y<d.length;y+=1)d[y]&&d[y].m(i,null)},p(p,[g]){if(g&1){o=On(p[0]);let y;for(y=0;y<o.length;y+=1){const x=ey(p,o,y);u[y]?u[y].p(x,g):(u[y]=ty(x),u[y].c(),u[y].m(t,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=o.length}if(g&8){s=On(p[3]);let y;for(y=0;y<s.length;y+=1){const x=Q0(p,s,y);d[y]?d[y].p(x,g):(d[y]=ny(x),d[y].c(),d[y].m(i,null))}for(;y<d.length;y+=1)d[y].d(1);d.length=s.length}g&4&&Gt(e,"full-width-bucket-legend",p[2]),g&2&&Gt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&Gt(e,"limits",p[1].hasOwnProperty("limits"))},i:lt,o:lt,d(p){p&&G(e),di(u,p),di(d,p)}}}function Tk(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,s=[];"limits"in i?s=i.limits:s=i.buckets;let d=s.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,d,o]}class fo extends Tt{constructor(e){super(),Ct(this,e,Tk,Ck,wt,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function lp(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function _r(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}async function Mk(r,e){let t=await fetch(r);if(!t.ok)throw new Error(`${r} not OK: ${t.status}`);let n=t.body.getReader(),i=t.headers.get("Content-Length");if(!i)throw new Error(`No Content-Length header from ${r}`);let o=parseInt(i),u=0,s=[];for(;;){let{done:g,value:y}=await n.read();if(g)break;y&&(s.push(y),u+=y.length,e(100*u/o))}let d=new Uint8Array(u),p=0;for(let g of s)d.set(g,p),p+=g.length;return d}var pw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Fg(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var gw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(pw,function(){var t={},n={};function i(u,s,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function s(c,a,f,m){return new(f||(f=Promise))(function(b,k){function S(U){try{F(m.next(U))}catch(K){k(K)}}function M(U){try{F(m.throw(U))}catch(K){k(K)}}function F(U){var K;U.done?b(U.value):(K=U.value,K instanceof f?K:new f(function(Q){Q(K)})).then(S,M)}F((m=m.apply(c,a||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,a){this.x=c,this.y=a}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,f=c.y-this.y;return a*a+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),f=Math.sin(c),m=f*this.x+a*this.y;return this.x=a*this.x-f*this.y,this.y=m,this},_rotateAround:function(c,a){var f=Math.cos(c),m=Math.sin(c),b=a.y+m*(this.x-a.x)+f*(this.y-a.y);return this.x=a.x+f*(this.x-a.x)-m*(this.y-a.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var y=d(p),x=C;function C(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}C.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var T=d(x);let E,z;function I(){return E==null&&(E=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),E}function L(){if(z==null&&(z=!1,I())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<5*5;m++){const b=4*m;a.fillStyle=`rgb(${b},${b+1},${b+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const f=a.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&f[m]!==m){z=!0;break}}}return z||!1}function B(c,a,f,m){const b=new T(c,a,f,m);return function(k){return b.solve(k)}}const O=B(.25,.1,.25,1);function Y(c,a,f){return Math.min(f,Math.max(a,c))}function q(c,a,f){const m=f-a,b=((c-a)%m+m)%m+a;return b===a?f:b}function H(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}let Z=1;function _e(c,a,f){const m={};for(const b in c)m[b]=a.call(f||this,c[b],b,c);return m}function Ie(c,a,f){const m={};for(const b in c)a.call(f||this,c[b],b,c)&&(m[b]=c[b]);return m}function J(c){return Array.isArray(c)?c.map(J):typeof c=="object"&&c?_e(c,J):c}const fe={};function Ee(c){fe[c]||(typeof console<"u"&&console.warn(c),fe[c]=!0)}function ye(c,a,f){return(f.y-c.y)*(a.x-c.x)>(a.y-c.y)*(f.x-c.x)}function Oe(c){let a=0;for(let f,m,b=0,k=c.length,S=k-1;b<k;S=b++)f=c[b],m=c[S],a+=(m.x-f.x)*(f.y+m.y);return a}function Ue(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let De=null;function xe(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ze(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const k=new VideoFrame(c,{timestamp:0});try{const S=k==null?void 0:k.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const M=S.startsWith("BGR"),F=new Uint8ClampedArray(m*b*4);if(yield k.copyTo(F,function(U,K,Q,le,de){const ge=4*Math.max(-K,0),be=(Math.max(0,Q)-Q)*le*4+ge,Ce=4*le,ze=Math.max(0,K),Ke=Math.max(0,Q);return{rect:{x:ze,y:Ke,width:Math.min(U.width,K+le)-ze,height:Math.min(U.height,Q+de)-Ke},layout:[{offset:be,stride:Ce}]}}(c,a,f,m,b)),M)for(let U=0;U<F.length;U+=4){const K=F[U];F[U]=F[U+2],F[U+2]=K}return F}finally{k.close()}})}let Qe,ct;const dt="AbortError";function Je(){return new Error(dt)}const yt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Et(c){return yt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Ot="global-dispatcher";class Yt extends Error{constructor(a,f,m,b){super(`AJAXError: ${f} (${a}): ${m}`),this.status=a,this.statusText=f,this.url=m,this.body=b}}const tn=()=>Ue(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Qt=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Et(c.url);if(m)return m(c,a);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Ot},a)}if(!(/^file:/.test(f=c.url)||/^file:/.test(tn())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return s(this,void 0,void 0,function*(){const k=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:tn(),signal:b.signal});m.type==="json"&&k.headers.set("Accept","application/json");const S=yield fetch(k);if(!S.ok){const U=yield S.blob();throw new Yt(S.status,S.statusText,m.url,U)}let M;M=m.type==="arrayBuffer"||m.type==="image"?S.arrayBuffer():m.type==="json"?S.json():S.text();const F=yield M;if(b.signal.aborted)throw Je();return{data:F,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}})}(c,a);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Ot},a)}var f;return function(m,b){return new Promise((k,S)=>{const M=new XMLHttpRequest;M.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(M.responseType="arraybuffer");for(const F in m.headers)M.setRequestHeader(F,m.headers[F]);m.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=m.credentials==="include",M.onerror=()=>{S(new Error(M.statusText))},M.onload=()=>{if(!b.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let F=M.response;if(m.type==="json")try{F=JSON.parse(M.response)}catch(U){return void S(U)}k({data:F,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const F=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});S(new Yt(M.status,M.statusText,m.url,F))}},b.signal.addEventListener("abort",()=>{M.abort(),S(Je())}),M.send(m.body)})}(c,a)};function fn(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),f=window.location;return a.protocol===f.protocol&&a.host===f.host}function pn(c,a,f){f[c]&&f[c].indexOf(a)!==-1||(f[c]=f[c]||[],f[c].push(a))}function He(c,a,f){if(f&&f[c]){const m=f[c].indexOf(a);m!==-1&&f[c].splice(m,1)}}class We{constructor(a,f={}){H(this,f),this.type=a}}class mt extends We{constructor(a,f={}){super("error",H({error:a},f))}}class Pt{on(a,f){return this._listeners=this._listeners||{},pn(a,f,this._listeners),this}off(a,f){return He(a,f,this._listeners),He(a,f,this._oneTimeListeners),this}once(a,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},pn(a,f,this._oneTimeListeners),this):new Promise(m=>this.once(a,m))}fire(a,f){typeof a=="string"&&(a=new We(a,f||{}));const m=a.type;if(this.listens(m)){a.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of b)M.call(this,a);const k=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of k)He(m,M,this._oneTimeListeners),M.call(this,a);const S=this._eventedParent;S&&(H(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(a))}else a instanceof mt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,f){return this._eventedParent=a,this._eventedParentData=f,this}}var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Pe(c,a){const f={};for(const m in c)m!=="ref"&&(f[m]=c[m]);return nn.forEach(m=>{m in a&&(f[m]=a[m])}),f}function tt(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let f=0;f<c.length;f++)if(!tt(c[f],a[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const f in c)if(!tt(c[f],a[f]))return!1;return!0}return c===a}function jt(c,a){c.push(a)}function Gn(c,a,f){jt(f,{command:"addSource",args:[c,a[c]]})}function Un(c,a,f){jt(a,{command:"removeSource",args:[c]}),f[c]=!0}function jn(c,a,f,m){Un(c,f,m),Gn(c,a,f)}function Wt(c,a,f){let m;for(m in c[f])if(Object.prototype.hasOwnProperty.call(c[f],m)&&m!=="data"&&!tt(c[f][m],a[f][m]))return!1;for(m in a[f])if(Object.prototype.hasOwnProperty.call(a[f],m)&&m!=="data"&&!tt(c[f][m],a[f][m]))return!1;return!0}function An(c,a,f,m,b,k){c=c||{},a=a||{};for(const S in c)Object.prototype.hasOwnProperty.call(c,S)&&(tt(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}));for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&!Object.prototype.hasOwnProperty.call(c,S)&&(tt(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}))}function ti(c){return c.id}function Bn(c,a){return c[a.id]=a,c}class _t{constructor(a,f,m,b){this.message=(a?`${a}: `:"")+m,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)}}function mr(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}class ar extends Error{constructor(a,f){super(f),this.message=f,this.key=a}}class gi{constructor(a,f=[]){this.parent=a,this.bindings={};for(const[m,b]of f)this.bindings[m]=b}concat(a){return new gi(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Vn={kind:"null"},$e={kind:"number"},pt={kind:"string"},vt={kind:"boolean"},Dt={kind:"color"},rn={kind:"object"},en={kind:"value"},br={kind:"collator"},lr={kind:"formatted"},Se={kind:"padding"},re={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function me(c,a){return{kind:"array",itemType:c,N:a}}function we(c){if(c.kind==="array"){const a=we(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const Ne=[Vn,$e,pt,vt,Dt,lr,rn,me(en),Se,re,ce];function je(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!je(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const f of Ne)if(!je(f,a))return null}}return`Expected ${we(c)} but found ${we(a)} instead.`}function qe(c,a){return a.some(f=>f.kind===c.kind)}function Re(c,a){return a.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function ie(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const Ye=.96422,nt=.82521,it=4/29,ft=6/29,zt=3*ft*ft,on=ft*ft*ft,mn=Math.PI/180,Ln=180/Math.PI;function qn(c){return(c%=360)<0&&(c+=360),c}function Cr([c,a,f,m]){let b,k;const S=In((.2225045*(c=Gr(c))+.7168786*(a=Gr(a))+.0606169*(f=Gr(f)))/1);c===a&&a===f?b=k=S:(b=In((.4360747*c+.3850649*a+.1430804*f)/Ye),k=In((.0139322*c+.0971045*a+.7141733*f)/nt));const M=116*S-16;return[M<0?0:M,500*(b-S),200*(S-k),m]}function Gr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function In(c){return c>on?Math.pow(c,1/3):c/zt+it}function Rr([c,a,f,m]){let b=(c+16)/116,k=isNaN(a)?b:b+a/500,S=isNaN(f)?b:b-f/200;return b=1*Ti(b),k=Ye*Ti(k),S=nt*Ti(S),[ni(3.1338561*k-1.6168667*b-.4906146*S),ni(-.9787684*k+1.9161415*b+.033454*S),ni(.0719453*k-.2289914*b+1.4052427*S),m]}function ni(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ti(c){return c>ft?c*c*c:zt*(c-it)}function Oi(c){return parseInt(c.padEnd(2,c),16)/255}function mi(c,a){return jo(a?c/100:c,0,1)}function jo(c,a,f){return Math.min(Math.max(a,c),f)}function mh(c){return!c.some(Number.isNaN)}const wp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ur{constructor(a,f,m,b=1,k=!0){this.r=a,this.g=f,this.b=m,this.a=b,k||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,f,m,b]))}static parse(a){if(a instanceof ur)return a;if(typeof a!="string")return;const f=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=wp[m];if(b){const[S,M,F]=b;return[S/255,M/255,F/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const S=m.length<6?1:2;let M=1;return[Oi(m.slice(M,M+=S)),Oi(m.slice(M,M+=S)),Oi(m.slice(M,M+=S)),Oi(m.slice(M,M+S)||"ff")]}if(m.startsWith("rgb")){const S=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[M,F,U,K,Q,le,de,ge,be,Ce,ze,Ke]=S,Be=[K||" ",de||" ",Ce].join("");if(Be==="  "||Be==="  /"||Be===",,"||Be===",,,"){const Ve=[U,le,be].join(""),ht=Ve==="%%%"?100:Ve===""?255:0;if(ht){const gt=[jo(+F/ht,0,1),jo(+Q/ht,0,1),jo(+ge/ht,0,1),ze?mi(+ze,Ke):1];if(mh(gt))return gt}}return}}const k=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[S,M,F,U,K,Q,le,de,ge]=k,be=[F||" ",K||" ",le].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Ce=[+M,jo(+U,0,100),jo(+Q,0,100),de?mi(+de,ge):1];if(mh(Ce))return function([ze,Ke,Be,Ve]){function ht(gt){const Ht=(gt+ze/30)%12,sn=Ke*Math.min(Be,1-Be);return Be-sn*Math.max(-1,Math.min(Ht-3,9-Ht,1))}return ze=qn(ze),Ke/=100,Be/=100,[ht(0),ht(8),ht(4),Ve]}(Ce)}}}(a);return f?new ur(...f,!1):void 0}get rgb(){const{r:a,g:f,b:m,a:b}=this,k=b||1/0;return this.overwriteGetter("rgb",[a/k,f/k,m/k,b])}get hcl(){return this.overwriteGetter("hcl",function(a){const[f,m,b,k]=Cr(a),S=Math.sqrt(m*m+b*b);return[Math.round(1e4*S)?qn(Math.atan2(b,m)*Ln):NaN,S,f,k]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cr(this.rgb))}overwriteGetter(a,f){return Object.defineProperty(this,a,{value:f}),f}toString(){const[a,f,m,b]=this.rgb;return`rgba(${[a,f,m].map(k=>Math.round(255*k)).join(",")},${b})`}}ur.black=new ur(0,0,0,1),ur.white=new ur(1,1,1,1),ur.transparent=new ur(0,0,0,0),ur.red=new ur(1,0,0,1);class hc{constructor(a,f,m){this.sensitivity=a?f?"variant":"case":f?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,f){return this.collator.compare(a,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dc{constructor(a,f,m,b,k){this.text=a,this.image=f,this.scale=m,this.fontStack=b,this.textColor=k}}class eo{constructor(a){this.sections=a}static fromString(a){return new eo([new dc(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof eo?a:eo.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class $i{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof $i)return a;if(typeof a=="number")return new $i([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const f of a)if(typeof f!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new $i(a)}}toString(){return JSON.stringify(this.values)}}const Ja=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof ho)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let f=0;f<a.length;f+=2){const m=a[f],b=a[f+1];if(typeof m!="string"||!Ja.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new ho(a)}}toString(){return JSON.stringify(this.values)}}class po{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new po({name:a,available:!1}):null}}function ha(c,a,f,m){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,a,f,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,a,f,m]:[c,a,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ol(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof ur||c instanceof hc||c instanceof eo||c instanceof $i||c instanceof ho||c instanceof po)return!0;if(Array.isArray(c)){for(const a of c)if(!Ol(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!Ol(c[a]))return!1;return!0}return!1}function Wr(c){if(c===null)return Vn;if(typeof c=="string")return pt;if(typeof c=="boolean")return vt;if(typeof c=="number")return $e;if(c instanceof ur)return Dt;if(c instanceof hc)return br;if(c instanceof eo)return lr;if(c instanceof $i)return Se;if(c instanceof ho)return ce;if(c instanceof po)return re;if(Array.isArray(c)){const a=c.length;let f;for(const m of c){const b=Wr(m);if(f){if(f===b)continue;f=en;break}f=b}return me(f||en,a)}return rn}function Ya(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof ur||c instanceof eo||c instanceof $i||c instanceof ho||c instanceof po?c.toString():JSON.stringify(c)}class xs{constructor(a,f){this.type=a,this.value=f}static parse(a,f){if(a.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Ol(a[1]))return f.error("invalid value");const m=a[1];let b=Wr(m);const k=f.expectedType;return b.kind!=="array"||b.N!==0||!k||k.kind!=="array"||typeof k.N=="number"&&k.N!==0||(b=k),new xs(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ir{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const $l={string:pt,number:$e,boolean:vt,object:rn};class to{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");let m,b=1;const k=a[0];if(k==="array"){let M,F;if(a.length>2){const U=a[1];if(typeof U!="string"||!(U in $l)||U==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);M=$l[U],b++}else M=en;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return f.error('The length argument to "array" must be a positive integer literal',2);F=a[2],b++}m=me(M,F)}else{if(!$l[k])throw new Error(`Types doesn't contain name = ${k}`);m=$l[k]}const S=[];for(;b<a.length;b++){const M=f.parse(a[b],b,en);if(!M)return null;S.push(M)}return new to(m,S)}evaluate(a){for(let f=0;f<this.args.length;f++){const m=this.args[f].evaluate(a);if(!je(this.type,Wr(m)))return m;if(f===this.args.length-1)throw new Ir(`Expected value to be of type ${we(this.type)}, but found ${we(Wr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Nl={"to-boolean":vt,"to-color":Dt,"to-number":$e,"to-string":pt};class Uo{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[0];if(!Nl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return f.error("Expected one argument.");const b=Nl[m],k=[];for(let S=1;S<a.length;S++){const M=f.parse(a[S],S,en);if(!M)return null;k.push(M)}return new Uo(b,k)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let f,m;for(const b of this.args){if(f=b.evaluate(a),m=null,f instanceof ur)return f;if(typeof f=="string"){const k=a.parseColor(f);if(k)return k}else if(Array.isArray(f)&&(m=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:ha(f[0],f[1],f[2],f[3]),!m))return new ur(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Ir(m||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const m of this.args){f=m.evaluate(a);const b=$i.parse(f);if(b)return b}throw new Ir(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const m of this.args){f=m.evaluate(a);const b=ho.parse(f);if(b)return b}throw new Ir(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const m of this.args){if(f=m.evaluate(a),f===null)return 0;const b=Number(f);if(!isNaN(b))return b}throw new Ir(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return eo.fromString(Ya(this.args[0].evaluate(a)));case"resolvedImage":return po.fromString(Ya(this.args[0].evaluate(a)));default:return Ya(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Qa=["Unknown","Point","LineString","Polygon"];class cr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let f=this._parseColorCache[a];return f||(f=this._parseColorCache[a]=ur.parse(a)),f}}class jl{constructor(a,f,m=[],b,k=new gi,S=[]){this.registry=a,this.path=m,this.key=m.map(M=>`[${M}]`).join(""),this.scope=k,this.errors=S,this.expectedType=b,this._isConstant=f}parse(a,f,m,b,k={}){return f?this.concat(f,m,b)._parse(a,k):this._parse(a,k)}_parse(a,f){function m(b,k,S){return S==="assert"?new to(k,[b]):S==="coerce"?new Uo(k,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const k=this.registry[b];if(k){let S=k.parse(a,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,F=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||F.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||F.kind!=="value"&&F.kind!=="string")if(M.kind!=="padding"||F.kind!=="value"&&F.kind!=="number"&&F.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||F.kind!=="value"&&F.kind!=="array"){if(this.checkSubtype(M,F))return null}else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"assert")}if(!(S instanceof xs)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const M=new cr;try{S=new xs(S.type,S.evaluate(M))}catch(F){return this.error(F.message),null}}return S}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,f,m){const b=typeof a=="number"?this.path.concat(a):this.path,k=m?this.scope.concat(m):this.scope;return new jl(this.registry,this._isConstant,b,f||null,k,this.errors)}error(a,...f){const m=`${this.key}${f.map(b=>`[${b}]`).join("")}`;this.errors.push(new ar(m,a))}checkSubtype(a,f){const m=je(a,f);return m&&this.error(m),m}}class da{constructor(a,f,m){this.type=br,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=f}static parse(a,f){if(a.length!==2)return f.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return f.error("Collator options argument must be an object.");const b=f.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,vt);if(!b)return null;const k=f.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,vt);if(!k)return null;let S=null;return m.locale&&(S=f.parse(m.locale,1,pt),!S)?null:new da(b,k,S)}evaluate(a){return new hc(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const As=8192;function Ul(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function el(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function xp(c,a){const f=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(f*b*As),Math.round(m*b*As)]}function gh(c,a,f){const m=c[0]-a[0],b=c[1]-a[1],k=c[0]-f[0],S=c[1]-f[1];return m*S-k*b==0&&m*k<=0&&b*S<=0}function Vl(c,a){let f=!1;for(let S=0,M=a.length;S<M;S++){const F=a[S];for(let U=0,K=F.length;U<K-1;U++){if(gh(c,F[U],F[U+1]))return!1;(b=F[U])[1]>(m=c)[1]!=(k=F[U+1])[1]>m[1]&&m[0]<(k[0]-b[0])*(m[1]-b[1])/(k[1]-b[1])+b[0]&&(f=!f)}}var m,b,k;return f}function Ap(c,a){for(let f=0;f<a.length;f++)if(Vl(c,a[f]))return!0;return!1}function _h(c,a,f,m){const b=m[0]-f[0],k=m[1]-f[1],S=(c[0]-f[0])*k-b*(c[1]-f[1]),M=(a[0]-f[0])*k-b*(a[1]-f[1]);return S>0&&M<0||S<0&&M>0}function kp(c,a,f){for(const U of f)for(let K=0;K<U.length-1;++K)if((M=[(S=U[K+1])[0]-(k=U[K])[0],S[1]-k[1]])[0]*(F=[(b=a)[0]-(m=c)[0],b[1]-m[1]])[1]-M[1]*F[0]!=0&&_h(m,b,k,S)&&_h(k,S,m,b))return!0;var m,b,k,S,M,F;return!1}function yh(c,a){for(let f=0;f<c.length;++f)if(!Vl(c[f],a))return!1;for(let f=0;f<c.length-1;++f)if(kp(c[f],c[f+1],a))return!1;return!0}function vh(c,a){for(let f=0;f<a.length;f++)if(yh(c,a[f]))return!0;return!1}function ql(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=[];for(let S=0;S<c[b].length;S++){const M=xp(c[b][S],f);Ul(a,M),k.push(M)}m.push(k)}return m}function bh(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=ql(c[b],a,f);m.push(k)}return m}function wh(c,a,f,m){if(c[0]<f[0]||c[0]>f[2]){const b=.5*m;let k=c[0]-f[0]>b?-m:f[0]-c[0]>b?m:0;k===0&&(k=c[0]-f[2]>b?-m:f[2]-c[0]>b?m:0),c[0]+=k}Ul(a,c)}function Hl(c,a,f,m){const b=Math.pow(2,m.z)*As,k=[m.x*As,m.y*As],S=[];for(const M of c)for(const F of M){const U=[F.x+k[0],F.y+k[1]];wh(U,a,f,b),S.push(U)}return S}function xh(c,a,f,m){const b=Math.pow(2,m.z)*As,k=[m.x*As,m.y*As],S=[];for(const F of c){const U=[];for(const K of F){const Q=[K.x+k[0],K.y+k[1]];Ul(a,Q),U.push(Q)}S.push(U)}if(a[2]-a[0]<=b/2){(M=a)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const F of S)for(const U of F)wh(U,a,f,b)}var M;return S}class js{constructor(a,f){this.type=vt,this.geojson=a,this.geometries=f}static parse(a,f){if(a.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Ol(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const b=[];for(const k of m.features){const{type:S,coordinates:M}=k.geometry;S==="Polygon"&&b.push(M),S==="MultiPolygon"&&b.push(...M)}if(b.length)return new js(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new js(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new js(m,m)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=ql(m.coordinates,k,S),F=Hl(f.geometry(),b,k,S);if(!el(b,k))return!1;for(const U of F)if(!Vl(U,M))return!1}if(m.type==="MultiPolygon"){const M=bh(m.coordinates,k,S),F=Hl(f.geometry(),b,k,S);if(!el(b,k))return!1;for(const U of F)if(!Ap(U,M))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=ql(m.coordinates,k,S),F=xh(f.geometry(),b,k,S);if(!el(b,k))return!1;for(const U of F)if(!yh(U,M))return!1}if(m.type==="MultiPolygon"){const M=bh(m.coordinates,k,S),F=xh(f.geometry(),b,k,S);if(!el(b,k))return!1;for(const U of F)if(!vh(U,M))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Gl{constructor(a,f){this.type=f.type,this.name=a,this.boundExpression=f}static parse(a,f){if(a.length!==2||typeof a[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const m=a[1];return f.scope.has(m)?new Gl(m,f.scope.get(m)):f.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class no{constructor(a,f,m,b){this.name=a,this.type=f,this._evaluate=m,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,f){const m=a[0],b=no.definitions[m];if(!b)return f.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const k=Array.isArray(b)?b[0]:b.type,S=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=S.filter(([U])=>!Array.isArray(U)||U.length===a.length-1);let F=null;for(const[U,K]of M){F=new jl(f.registry,tl,f.path,null,f.scope);const Q=[];let le=!1;for(let de=1;de<a.length;de++){const ge=a[de],be=Array.isArray(U)?U[de-1]:U.type,Ce=F.parse(ge,1+Q.length,be);if(!Ce){le=!0;break}Q.push(Ce)}if(!le)if(Array.isArray(U)&&U.length!==Q.length)F.error(`Expected ${U.length} arguments, but found ${Q.length} instead.`);else{for(let de=0;de<Q.length;de++){const ge=Array.isArray(U)?U[de]:U.type,be=Q[de];F.concat(de+1).checkSubtype(ge,be.type)}if(F.errors.length===0)return new no(m,k,K,Q)}}if(M.length===1)f.errors.push(...F.errors);else{const U=(M.length?M:S).map(([Q])=>{return le=Q,Array.isArray(le)?`(${le.map(we).join(", ")})`:`(${we(le.type)}...)`;var le}).join(" | "),K=[];for(let Q=1;Q<a.length;Q++){const le=f.parse(a[Q],1+K.length);if(!le)return null;K.push(we(le.type))}f.error(`Expected arguments of type ${U}, but found (${K.join(", ")}) instead.`)}return null}static register(a,f){no.definitions=f;for(const m in f)a[m]=no}}function tl(c){if(c instanceof Gl)return tl(c.boundExpression);if(c instanceof no&&c.name==="error"||c instanceof da||c instanceof js)return!1;const a=c instanceof Uo||c instanceof to;let f=!0;return c.eachChild(m=>{f=a?f&&tl(m):f&&m instanceof xs}),!!f&&Wl(c)&&rl(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wl(c){if(c instanceof no&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof js)return!1;let a=!0;return c.eachChild(f=>{a&&!Wl(f)&&(a=!1)}),a}function nl(c){if(c instanceof no&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(f=>{a&&!nl(f)&&(a=!1)}),a}function rl(c,a){if(c instanceof no&&a.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(m=>{f&&!rl(m,a)&&(f=!1)}),f}function il(c,a){const f=c.length-1;let m,b,k=0,S=f,M=0;for(;k<=S;)if(M=Math.floor((k+S)/2),m=c[M],b=c[M+1],m<=a){if(M===f||a<b)return M;k=M+1}else{if(!(m>a))throw new Ir("Input is not a number.");S=M-1}return 0}class ol{constructor(a,f,m){this.type=a,this.input=f,this.labels=[],this.outputs=[];for(const[b,k]of m)this.labels.push(b),this.outputs.push(k)}static parse(a,f){if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");const m=f.parse(a[1],1,$e);if(!m)return null;const b=[];let k=null;f.expectedType&&f.expectedType.kind!=="value"&&(k=f.expectedType);for(let S=1;S<a.length;S+=2){const M=S===1?-1/0:a[S],F=a[S+1],U=S,K=S+1;if(typeof M!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(b.length&&b[b.length-1][0]>=M)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const Q=f.parse(F,K,k);if(!Q)return null;k=k||Q.type,b.push([M,Q])}return new ol(k,m,b)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;return b>=f[k-1]?m[k-1].evaluate(a):m[il(f,b)].evaluate(a)}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Sp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Cp=Ah;function Ah(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}Ah.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var Tp=Sp(Cp);function Us(c,a,f){return c+f*(a-c)}function Zl(c,a,f){return c.map((m,b)=>Us(m,a[b],f))}const Mi={number:Us,color:function(c,a,f,m="rgb"){switch(m){case"rgb":{const[b,k,S,M]=Zl(c.rgb,a.rgb,f);return new ur(b,k,S,M,!1)}case"hcl":{const[b,k,S,M]=c.hcl,[F,U,K,Q]=a.hcl;let le,de;if(isNaN(b)||isNaN(F))isNaN(b)?isNaN(F)?le=NaN:(le=F,S!==1&&S!==0||(de=U)):(le=b,K!==1&&K!==0||(de=k));else{let Ke=F-b;F>b&&Ke>180?Ke-=360:F<b&&b-F>180&&(Ke+=360),le=b+f*Ke}const[ge,be,Ce,ze]=function([Ke,Be,Ve,ht]){return Ke=isNaN(Ke)?0:Ke*mn,Rr([Ve,Math.cos(Ke)*Be,Math.sin(Ke)*Be,ht])}([le,de??Us(k,U,f),Us(S,K,f),Us(M,Q,f)]);return new ur(ge,be,Ce,ze,!1)}case"lab":{const[b,k,S,M]=Rr(Zl(c.lab,a.lab,f));return new ur(b,k,S,M,!1)}}},array:Zl,padding:function(c,a,f){return new $i(Zl(c.values,a.values,f))},variableAnchorOffsetCollection:function(c,a,f){const m=c.values,b=a.values;if(m.length!==b.length)throw new Ir(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const k=[];for(let S=0;S<m.length;S+=2){if(m[S]!==b[S])throw new Ir(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${m[S]}, to[${S}]: ${b[S]}`);k.push(m[S]);const[M,F]=m[S+1],[U,K]=b[S+1];k.push([Us(M,U,f),Us(F,K,f)])}return new ho(k)}};class bi{constructor(a,f,m,b,k){this.type=a,this.operator=f,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[S,M]of k)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(a,f,m,b){let k=0;if(a.name==="exponential")k=er(f,a.base,m,b);else if(a.name==="linear")k=er(f,1,m,b);else if(a.name==="cubic-bezier"){const S=a.controlPoints;k=new Tp(S[0],S[1],S[2],S[3]).solve(er(f,1,m,b))}return k}static parse(a,f){let[m,b,k,...S]=a;if(!Array.isArray(b)||b.length===0)return f.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const U=b[1];if(typeof U!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:U}}else{if(b[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const U=b.slice(1);if(U.length!==4||U.some(K=>typeof K!="number"||K<0||K>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:U}}}if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(k=f.parse(k,2,$e),!k)return null;const M=[];let F=null;m==="interpolate-hcl"||m==="interpolate-lab"?F=Dt:f.expectedType&&f.expectedType.kind!=="value"&&(F=f.expectedType);for(let U=0;U<S.length;U+=2){const K=S[U],Q=S[U+1],le=U+3,de=U+4;if(typeof K!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',le);if(M.length&&M[M.length-1][0]>=K)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',le);const ge=f.parse(Q,de,F);if(!ge)return null;F=F||ge.type,M.push([K,ge])}return ie(F,$e)||ie(F,Dt)||ie(F,Se)||ie(F,ce)||ie(F,me($e))?new bi(F,m,b,k,M):f.error(`Type ${we(F)} is not interpolatable.`)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;if(b>=f[k-1])return m[k-1].evaluate(a);const S=il(f,b),M=bi.interpolationFactor(this.interpolation,b,f[S],f[S+1]),F=m[S].evaluate(a),U=m[S+1].evaluate(a);switch(this.operator){case"interpolate":return Mi[this.type.kind](F,U,M);case"interpolate-hcl":return Mi.color(F,U,M,"hcl");case"interpolate-lab":return Mi.color(F,U,M,"lab")}}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function er(c,a,f,m){const b=m-f,k=c-f;return b===0?0:a===1?k/b:(Math.pow(a,k)-1)/(Math.pow(a,b)-1)}class Xl{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expectected at least one argument.");let m=null;const b=f.expectedType;b&&b.kind!=="value"&&(m=b);const k=[];for(const M of a.slice(1)){const F=f.parse(M,1+k.length,m,void 0,{typeAnnotation:"omit"});if(!F)return null;m=m||F.type,k.push(F)}if(!m)throw new Error("No output type");const S=b&&k.some(M=>je(b,M.type));return new Xl(S?en:m,k)}evaluate(a){let f,m=null,b=0;for(const k of this.args)if(b++,m=k.evaluate(a),m&&m instanceof po&&!m.available&&(f||(f=m.name),m=null,b===this.args.length&&(m=f)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class Kl{constructor(a,f){this.type=f.type,this.bindings=[].concat(a),this.result=f}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const f of this.bindings)a(f[1]);a(this.result)}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let k=1;k<a.length-1;k+=2){const S=a[k];if(typeof S!="string")return f.error(`Expected string, but found ${typeof S} instead.`,k);if(/[^a-zA-Z0-9_]/.test(S))return f.error("Variable names must contain only alphanumeric characters or '_'.",k);const M=f.parse(a[k+1],k+1);if(!M)return null;m.push([S,M])}const b=f.parse(a[a.length-1],a.length-1,f.expectedType,m);return b?new Kl(m,b):null}outputDefined(){return this.result.outputDefined()}}class pc{constructor(a,f,m){this.type=a,this.index=f,this.input=m}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,$e),b=f.parse(a[2],2,me(f.expectedType||en));return m&&b?new pc(b.type.itemType,m,b):null}evaluate(a){const f=this.index.evaluate(a),m=this.input.evaluate(a);if(f<0)throw new Ir(`Array index out of bounds: ${f} < 0.`);if(f>=m.length)throw new Ir(`Array index out of bounds: ${f} > ${m.length-1}.`);if(f!==Math.floor(f))throw new Ir(`Array index must be an integer, but found ${f} instead.`);return m[f]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class mc{constructor(a,f){this.type=vt,this.needle=a,this.haystack=f}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,en),b=f.parse(a[2],2,en);return m&&b?qe(m.type,[vt,pt,$e,Vn,en])?new mc(m,b):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`):null}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!Re(f,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${we(Wr(f))} instead.`);if(!Re(m,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${we(Wr(m))} instead.`);return m.indexOf(f)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Jl{constructor(a,f,m){this.type=$e,this.needle=a,this.haystack=f,this.fromIndex=m}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,en),b=f.parse(a[2],2,en);if(!m||!b)return null;if(!qe(m.type,[vt,pt,$e,Vn,en]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,$e);return k?new Jl(m,b,k):null}return new Jl(m,b)}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!Re(f,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${we(Wr(f))} instead.`);if(!Re(m,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${we(Wr(m))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(a);return m.indexOf(f,b)}return m.indexOf(f)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class gc{constructor(a,f,m,b,k,S){this.inputType=a,this.type=f,this.input=m,this.cases=b,this.outputs=k,this.otherwise=S}static parse(a,f){if(a.length<5)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return f.error("Expected an even number of arguments.");let m,b;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);const k={},S=[];for(let U=2;U<a.length-1;U+=2){let K=a[U];const Q=a[U+1];Array.isArray(K)||(K=[K]);const le=f.concat(U);if(K.length===0)return le.error("Expected at least one branch label.");for(const ge of K){if(typeof ge!="number"&&typeof ge!="string")return le.error("Branch labels must be numbers or strings.");if(typeof ge=="number"&&Math.abs(ge)>Number.MAX_SAFE_INTEGER)return le.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ge=="number"&&Math.floor(ge)!==ge)return le.error("Numeric branch labels must be integer values.");if(m){if(le.checkSubtype(m,Wr(ge)))return null}else m=Wr(ge);if(k[String(ge)]!==void 0)return le.error("Branch labels must be unique.");k[String(ge)]=S.length}const de=f.parse(Q,U,b);if(!de)return null;b=b||de.type,S.push(de)}const M=f.parse(a[1],1,en);if(!M)return null;const F=f.parse(a[a.length-1],a.length-1,b);return F?M.type.kind!=="value"&&f.concat(1).checkSubtype(m,M.type)?null:new gc(m,b,M,k,S,F):null}evaluate(a){const f=this.input.evaluate(a);return(Wr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class _c{constructor(a,f,m){this.type=a,this.branches=f,this.otherwise=m}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return f.error("Expected an odd number of arguments.");let m;f.expectedType&&f.expectedType.kind!=="value"&&(m=f.expectedType);const b=[];for(let S=1;S<a.length-1;S+=2){const M=f.parse(a[S],S,vt);if(!M)return null;const F=f.parse(a[S+1],S+1,m);if(!F)return null;b.push([M,F]),m=m||F.type}const k=f.parse(a[a.length-1],a.length-1,m);if(!k)return null;if(!m)throw new Error("Can't infer output type");return new _c(m,b,k)}evaluate(a){for(const[f,m]of this.branches)if(f.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[f,m]of this.branches)a(f),a(m);a(this.otherwise)}outputDefined(){return this.branches.every(([a,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class Yl{constructor(a,f,m,b){this.type=a,this.input=f,this.beginIndex=m,this.endIndex=b}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,en),b=f.parse(a[2],2,$e);if(!m||!b)return null;if(!qe(m.type,[me(en),pt,en]))return f.error(`Expected first argument to be of type array or string, but found ${we(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,$e);return k?new Yl(m.type,m,b,k):null}return new Yl(m.type,m,b)}evaluate(a){const f=this.input.evaluate(a),m=this.beginIndex.evaluate(a);if(!Re(f,["string","array"]))throw new Ir(`Expected first argument to be of type array or string, but found ${we(Wr(f))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(a);return f.slice(m,b)}return f.slice(m)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function kh(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Sh(c,a,f,m){return m.compare(a,f)===0}function pa(c,a,f){const m=c!=="=="&&c!=="!=";return class _w{constructor(k,S,M){this.type=vt,this.lhs=k,this.rhs=S,this.collator=M,this.hasUntypedArgument=k.type.kind==="value"||S.type.kind==="value"}static parse(k,S){if(k.length!==3&&k.length!==4)return S.error("Expected two or three arguments.");const M=k[0];let F=S.parse(k[1],1,en);if(!F)return null;if(!kh(M,F.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${we(F.type)}'.`);let U=S.parse(k[2],2,en);if(!U)return null;if(!kh(M,U.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${we(U.type)}'.`);if(F.type.kind!==U.type.kind&&F.type.kind!=="value"&&U.type.kind!=="value")return S.error(`Cannot compare types '${we(F.type)}' and '${we(U.type)}'.`);m&&(F.type.kind==="value"&&U.type.kind!=="value"?F=new to(U.type,[F]):F.type.kind!=="value"&&U.type.kind==="value"&&(U=new to(F.type,[U])));let K=null;if(k.length===4){if(F.type.kind!=="string"&&U.type.kind!=="string"&&F.type.kind!=="value"&&U.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(K=S.parse(k[3],3,br),!K)return null}return new _w(F,U,K)}evaluate(k){const S=this.lhs.evaluate(k),M=this.rhs.evaluate(k);if(m&&this.hasUntypedArgument){const F=Wr(S),U=Wr(M);if(F.kind!==U.kind||F.kind!=="string"&&F.kind!=="number")throw new Ir(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${F.kind}, ${U.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const F=Wr(S),U=Wr(M);if(F.kind!=="string"||U.kind!=="string")return a(k,S,M)}return this.collator?f(k,S,M,this.collator.evaluate(k)):a(k,S,M)}eachChild(k){k(this.lhs),k(this.rhs),this.collator&&k(this.collator)}outputDefined(){return!0}}}const Mp=pa("==",function(c,a,f){return a===f},Sh),Ep=pa("!=",function(c,a,f){return a!==f},function(c,a,f,m){return!Sh(0,a,f,m)}),Lp=pa("<",function(c,a,f){return a<f},function(c,a,f,m){return m.compare(a,f)<0}),Ip=pa(">",function(c,a,f){return a>f},function(c,a,f,m){return m.compare(a,f)>0}),Pp=pa("<=",function(c,a,f){return a<=f},function(c,a,f,m){return m.compare(a,f)<=0}),zp=pa(">=",function(c,a,f){return a>=f},function(c,a,f,m){return m.compare(a,f)>=0});class yc{constructor(a,f,m,b,k){this.type=pt,this.number=a,this.locale=f,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=k}static parse(a,f){if(a.length!==3)return f.error("Expected two arguments.");const m=f.parse(a[1],1,$e);if(!m)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return f.error("NumberFormat options argument must be an object.");let k=null;if(b.locale&&(k=f.parse(b.locale,1,pt),!k))return null;let S=null;if(b.currency&&(S=f.parse(b.currency,1,pt),!S))return null;let M=null;if(b["min-fraction-digits"]&&(M=f.parse(b["min-fraction-digits"],1,$e),!M))return null;let F=null;return b["max-fraction-digits"]&&(F=f.parse(b["max-fraction-digits"],1,$e),!F)?null:new yc(m,k,S,M,F)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Ql{constructor(a){this.type=lr,this.sections=a}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return f.error("First argument must be an image or text section.");const b=[];let k=!1;for(let S=1;S<=a.length-1;++S){const M=a[S];if(k&&typeof M=="object"&&!Array.isArray(M)){k=!1;let F=null;if(M["font-scale"]&&(F=f.parse(M["font-scale"],1,$e),!F))return null;let U=null;if(M["text-font"]&&(U=f.parse(M["text-font"],1,me(pt)),!U))return null;let K=null;if(M["text-color"]&&(K=f.parse(M["text-color"],1,Dt),!K))return null;const Q=b[b.length-1];Q.scale=F,Q.font=U,Q.textColor=K}else{const F=f.parse(a[S],1,en);if(!F)return null;const U=F.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,b.push({content:F,scale:null,font:null,textColor:null})}}return new Ql(b)}evaluate(a){return new eo(this.sections.map(f=>{const m=f.content.evaluate(a);return Wr(m)===re?new dc("",m,null,null,null):new dc(Ya(m),null,f.scale?f.scale.evaluate(a):null,f.font?f.font.evaluate(a).join(","):null,f.textColor?f.textColor.evaluate(a):null)}))}eachChild(a){for(const f of this.sections)a(f.content),f.scale&&a(f.scale),f.font&&a(f.font),f.textColor&&a(f.textColor)}outputDefined(){return!1}}class vc{constructor(a){this.type=re,this.input=a}static parse(a,f){if(a.length!==2)return f.error("Expected two arguments.");const m=f.parse(a[1],1,pt);return m?new vc(m):f.error("No image name provided.")}evaluate(a){const f=this.input.evaluate(a),m=po.fromString(f);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(f)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class bc{constructor(a){this.type=$e,this.input=a}static parse(a,f){if(a.length!==2)return f.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=f.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${we(m.type)} instead.`):new bc(m):null}evaluate(a){const f=this.input.evaluate(a);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Ir(`Expected value to be of type string or array, but found ${we(Wr(f))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const ma={"==":Mp,"!=":Ep,">":Ip,"<":Lp,">=":zp,"<=":Pp,array:to,at:pc,boolean:to,case:_c,coalesce:Xl,collator:da,format:Ql,image:vc,in:mc,"index-of":Jl,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:bc,let:Kl,literal:xs,match:gc,number:to,"number-format":yc,object:to,slice:Yl,step:ol,string:to,"to-boolean":Uo,"to-color":Uo,"to-number":Uo,"to-string":Uo,var:Gl,within:js};function Ch(c,[a,f,m,b]){a=a.evaluate(c),f=f.evaluate(c),m=m.evaluate(c);const k=b?b.evaluate(c):1,S=ha(a,f,m,k);if(S)throw new Ir(S);return new ur(a/255,f/255,m/255,k,!1)}function Th(c,a){return c in a}function wc(c,a){const f=a[c];return f===void 0?null:f}function Vs(c){return{type:c}}function Mh(c){return{result:"success",value:c}}function ga(c){return{result:"error",value:c}}function _a(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Eh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function xc(c){return!!c.expression&&c.expression.interpolated}function Jn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function eu(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Dp(c){return c}function Lh(c,a){const f=a.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",b=m||!(m||c.property!==void 0),k=c.type||(xc(a)?"exponential":"interval");if(f||a.type==="padding"){const K=f?ur.parse:$i.parse;(c=mr({},c)).stops&&(c.stops=c.stops.map(Q=>[Q[0],K(Q[1])])),c.default=K(c.default?c.default:a.default)}if(c.colorSpace&&(S=c.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var S;let M,F,U;if(k==="exponential")M=Wn;else if(k==="interval")M=Rp;else if(k==="categorical"){M=Vr,F=Object.create(null);for(const K of c.stops)F[K[0]]=K[1];U=typeof c.stops[0][0]}else{if(k!=="identity")throw new Error(`Unknown function type "${k}"`);M=Ac}if(m){const K={},Q=[];for(let ge=0;ge<c.stops.length;ge++){const be=c.stops[ge],Ce=be[0].zoom;K[Ce]===void 0&&(K[Ce]={zoom:Ce,type:c.type,property:c.property,default:c.default,stops:[]},Q.push(Ce)),K[Ce].stops.push([be[0].value,be[1]])}const le=[];for(const ge of Q)le.push([K[ge].zoom,Lh(K[ge],a)]);const de={name:"linear"};return{kind:"composite",interpolationType:de,interpolationFactor:bi.interpolationFactor.bind(void 0,de),zoomStops:le.map(ge=>ge[0]),evaluate:({zoom:ge},be)=>Wn({stops:le,base:c.base},a,ge).evaluate(ge,be)}}if(b){const K=k==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:K,interpolationFactor:bi.interpolationFactor.bind(void 0,K),zoomStops:c.stops.map(Q=>Q[0]),evaluate:({zoom:Q})=>M(c,a,Q,F,U)}}return{kind:"source",evaluate(K,Q){const le=Q&&Q.properties?Q.properties[c.property]:void 0;return le===void 0?sl(c.default,a.default):M(c,a,le,F,U)}}}function sl(c,a,f){return c!==void 0?c:a!==void 0?a:f!==void 0?f:void 0}function Vr(c,a,f,m,b){return sl(typeof f===b?m[f]:void 0,c.default,a.default)}function Rp(c,a,f){if(Jn(f)!=="number")return sl(c.default,a.default);const m=c.stops.length;if(m===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[m-1][0])return c.stops[m-1][1];const b=il(c.stops.map(k=>k[0]),f);return c.stops[b][1]}function Wn(c,a,f){const m=c.base!==void 0?c.base:1;if(Jn(f)!=="number")return sl(c.default,a.default);const b=c.stops.length;if(b===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[b-1][0])return c.stops[b-1][1];const k=il(c.stops.map(K=>K[0]),f),S=function(K,Q,le,de){const ge=de-le,be=K-le;return ge===0?0:Q===1?be/ge:(Math.pow(Q,be)-1)/(Math.pow(Q,ge)-1)}(f,m,c.stops[k][0],c.stops[k+1][0]),M=c.stops[k][1],F=c.stops[k+1][1],U=Mi[a.type]||Dp;return typeof M.evaluate=="function"?{evaluate(...K){const Q=M.evaluate.apply(void 0,K),le=F.evaluate.apply(void 0,K);if(Q!==void 0&&le!==void 0)return U(Q,le,S,c.colorSpace)}}:U(M,F,S,c.colorSpace)}function Ac(c,a,f){switch(a.type){case"color":f=ur.parse(f);break;case"formatted":f=eo.fromString(f.toString());break;case"resolvedImage":f=po.fromString(f.toString());break;case"padding":f=$i.parse(f);break;default:Jn(f)===a.type||a.type==="enum"&&a.values[f]||(f=void 0)}return sl(f,c.default,a.default)}no.register(ma,{error:[{kind:"error"},[pt],(c,[a])=>{throw new Ir(a.evaluate(c))}],typeof:[pt,[en],(c,[a])=>we(Wr(a.evaluate(c)))],"to-rgba":[me($e,4),[Dt],(c,[a])=>{const[f,m,b,k]=a.evaluate(c).rgb;return[255*f,255*m,255*b,k]}],rgb:[Dt,[$e,$e,$e],Ch],rgba:[Dt,[$e,$e,$e,$e],Ch],has:{type:vt,overloads:[[[pt],(c,[a])=>Th(a.evaluate(c),c.properties())],[[pt,rn],(c,[a,f])=>Th(a.evaluate(c),f.evaluate(c))]]},get:{type:en,overloads:[[[pt],(c,[a])=>wc(a.evaluate(c),c.properties())],[[pt,rn],(c,[a,f])=>wc(a.evaluate(c),f.evaluate(c))]]},"feature-state":[en,[pt],(c,[a])=>wc(a.evaluate(c),c.featureState||{})],properties:[rn,[],c=>c.properties()],"geometry-type":[pt,[],c=>c.geometryType()],id:[en,[],c=>c.id()],zoom:[$e,[],c=>c.globals.zoom],"heatmap-density":[$e,[],c=>c.globals.heatmapDensity||0],"line-progress":[$e,[],c=>c.globals.lineProgress||0],accumulated:[en,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[$e,Vs($e),(c,a)=>{let f=0;for(const m of a)f+=m.evaluate(c);return f}],"*":[$e,Vs($e),(c,a)=>{let f=1;for(const m of a)f*=m.evaluate(c);return f}],"-":{type:$e,overloads:[[[$e,$e],(c,[a,f])=>a.evaluate(c)-f.evaluate(c)],[[$e],(c,[a])=>-a.evaluate(c)]]},"/":[$e,[$e,$e],(c,[a,f])=>a.evaluate(c)/f.evaluate(c)],"%":[$e,[$e,$e],(c,[a,f])=>a.evaluate(c)%f.evaluate(c)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(c,[a,f])=>Math.pow(a.evaluate(c),f.evaluate(c))],sqrt:[$e,[$e],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[$e,[$e],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[$e,[$e],(c,[a])=>Math.log(a.evaluate(c))],log2:[$e,[$e],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[$e,[$e],(c,[a])=>Math.sin(a.evaluate(c))],cos:[$e,[$e],(c,[a])=>Math.cos(a.evaluate(c))],tan:[$e,[$e],(c,[a])=>Math.tan(a.evaluate(c))],asin:[$e,[$e],(c,[a])=>Math.asin(a.evaluate(c))],acos:[$e,[$e],(c,[a])=>Math.acos(a.evaluate(c))],atan:[$e,[$e],(c,[a])=>Math.atan(a.evaluate(c))],min:[$e,Vs($e),(c,a)=>Math.min(...a.map(f=>f.evaluate(c)))],max:[$e,Vs($e),(c,a)=>Math.max(...a.map(f=>f.evaluate(c)))],abs:[$e,[$e],(c,[a])=>Math.abs(a.evaluate(c))],round:[$e,[$e],(c,[a])=>{const f=a.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[$e,[$e],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[$e,[$e],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[vt,[pt,en],(c,[a,f])=>c.properties()[a.value]===f.value],"filter-id-==":[vt,[en],(c,[a])=>c.id()===a.value],"filter-type-==":[vt,[pt],(c,[a])=>c.geometryType()===a.value],"filter-<":[vt,[pt,en],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<b}],"filter-id-<":[vt,[en],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<m}],"filter->":[vt,[pt,en],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>b}],"filter-id->":[vt,[en],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>m}],"filter-<=":[vt,[pt,en],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[vt,[en],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<=m}],"filter->=":[vt,[pt,en],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[vt,[en],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>=m}],"filter-has":[vt,[en],(c,[a])=>a.value in c.properties()],"filter-has-id":[vt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[vt,[me(pt)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[vt,[me(en)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[vt,[pt,me(en)],(c,[a,f])=>f.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[vt,[pt,me(en)],(c,[a,f])=>function(m,b,k,S){for(;k<=S;){const M=k+S>>1;if(b[M]===m)return!0;b[M]>m?S=M-1:k=M+1}return!1}(c.properties()[a.value],f.value,0,f.value.length-1)],all:{type:vt,overloads:[[[vt,vt],(c,[a,f])=>a.evaluate(c)&&f.evaluate(c)],[Vs(vt),(c,a)=>{for(const f of a)if(!f.evaluate(c))return!1;return!0}]]},any:{type:vt,overloads:[[[vt,vt],(c,[a,f])=>a.evaluate(c)||f.evaluate(c)],[Vs(vt),(c,a)=>{for(const f of a)if(f.evaluate(c))return!0;return!1}]]},"!":[vt,[vt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[vt,[pt],(c,[a])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(a.evaluate(c))}],upcase:[pt,[pt],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[pt,[pt],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[pt,Vs(en),(c,a)=>a.map(f=>Ya(f.evaluate(c))).join("")],"resolved-locale":[pt,[br],(c,[a])=>a.evaluate(c).resolvedLocale()]});class wr{constructor(a,f){var m;this.expression=a,this._warningHistory={},this._evaluator=new cr,this._defaultValue=f?(m=f).type==="color"&&eu(m.default)?new ur(0,0,0,0):m.type==="color"?ur.parse(m.default)||null:m.type==="padding"?$i.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._evaluator.globals=a,this._evaluator.feature=f,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(a,f,m,b,k,S){this._evaluator.globals=a,this._evaluator.feature=f||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ir(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function gr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in ma}function qs(c,a){const f=new jl(ma,tl,[],a?function(b){const k={color:Dt,string:pt,number:$e,enum:pt,boolean:vt,formatted:lr,padding:Se,resolvedImage:re,variableAnchorOffsetCollection:ce};return b.type==="array"?me(k[b.value]||en,b.length):k[b.type]}(a):void 0),m=f.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Mh(new wr(m,a)):ga(f.errors)}class tu{constructor(a,f){this.kind=a,this._styleExpression=f,this.isStateDependent=a!=="constant"&&!nl(f.expression)}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}}class kc{constructor(a,f,m,b){this.kind=a,this.zoomStops=m,this._styleExpression=f,this.isStateDependent=a!=="camera"&&!nl(f.expression),this.interpolationType=b}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}interpolationFactor(a,f,m){return this.interpolationType?bi.interpolationFactor(this.interpolationType,a,f,m):0}}function Ih(c,a){const f=qs(c,a);if(f.result==="error")return f;const m=f.value.expression,b=Wl(m);if(!b&&!_a(a))return ga([new ar("","data expressions not supported")]);const k=rl(m,["zoom"]);if(!k&&!Eh(a))return ga([new ar("","zoom expressions not supported")]);const S=ru(m);return S||k?S instanceof ar?ga([S]):S instanceof bi&&!xc(a)?ga([new ar("",'"interpolate" expressions cannot be used with this property')]):Mh(S?new kc(b?"camera":"composite",f.value,S.labels,S instanceof bi?S.interpolation:void 0):new tu(b?"constant":"source",f.value)):ga([new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nu{constructor(a,f){this._parameters=a,this._specification=f,mr(this,Lh(this._parameters,this._specification))}static deserialize(a){return new nu(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function ru(c){let a=null;if(c instanceof Kl)a=ru(c.result);else if(c instanceof Xl){for(const f of c.args)if(a=ru(f),a)break}else(c instanceof ol||c instanceof bi)&&c.input instanceof no&&c.input.name==="zoom"&&(a=c);return a instanceof ar||c.eachChild(f=>{const m=ru(f);m instanceof ar?a=m:!a&&m?a=new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new ar("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function iu(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!iu(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Ph={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ou(c){if(c==null)return{filter:()=>!0,needGeometry:!1};iu(c)||(c=au(c));const a=qs(c,Ph);if(a.result==="error")throw new Error(a.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,m,b)=>a.value.evaluate(f,m,{},b),needGeometry:su(c)}}function zh(c,a){return c<a?-1:c>a?1:0}function su(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(su(c[a]))return!0;return!1}function au(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?Sc(c[1],c[2],"=="):a==="!="?lu(Sc(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Sc(c[1],c[2],a):a==="any"?(f=c.slice(1),["any"].concat(f.map(au))):a==="all"?["all"].concat(c.slice(1).map(au)):a==="none"?["all"].concat(c.slice(1).map(au).map(lu)):a==="in"?Dh(c[1],c.slice(2)):a==="!in"?lu(Dh(c[1],c.slice(2))):a==="has"?Rh(c[1]):a==="!has"?lu(Rh(c[1])):a!=="within"||c;var f}function Sc(c,a,f){switch(c){case"$type":return[`filter-type-${f}`,a];case"$id":return[`filter-id-${f}`,a];default:return[`filter-${f}`,c,a]}}function Dh(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(f=>typeof f!=typeof a[0])?["filter-in-large",c,["literal",a.sort(zh)]]:["filter-in-small",c,["literal",a]]}}function Rh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function lu(c){return["!",c]}function Cc(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let b="[";for(const k of c)b+=`${Cc(k)},`;return`${b}]`}const f=Object.keys(c).sort();let m="{";for(let b=0;b<f.length;b++)m+=`${JSON.stringify(f[b])}:${Cc(c[f[b]])},`;return`${m}}`}function Bp(c){let a="";for(const f of nn)a+=`/${Cc(c[f])}`;return a}function Bh(c){const a=c.value;return a?[new _t(c.key,a,"constants have been deprecated as of v8")]:[]}function Br(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ks(c){if(Array.isArray(c))return c.map(ks);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const f in c)a[f]=ks(c[f]);return a}return Br(c)}function Ei(c){const a=c.key,f=c.value,m=c.valueSpec||{},b=c.objectElementValidators||{},k=c.style,S=c.styleSpec,M=c.validateSpec;let F=[];const U=Jn(f);if(U!=="object")return[new _t(a,f,`object expected, ${U} found`)];for(const K in f){const Q=K.split(".")[0],le=m[Q]||m["*"];let de;if(b[Q])de=b[Q];else if(m[Q])de=M;else if(b["*"])de=b["*"];else{if(!m["*"]){F.push(new _t(a,f[K],`unknown property "${K}"`));continue}de=M}F=F.concat(de({key:(a&&`${a}.`)+K,value:f[K],valueSpec:le,style:k,styleSpec:S,object:f,objectKey:K,validateSpec:M},f))}for(const K in m)b[K]||m[K].required&&m[K].default===void 0&&f[K]===void 0&&F.push(new _t(a,f,`missing required property "${K}"`));return F}function Tc(c){const a=c.value,f=c.valueSpec,m=c.style,b=c.styleSpec,k=c.key,S=c.arrayElementValidator||c.validateSpec;if(Jn(a)!=="array")return[new _t(k,a,`array expected, ${Jn(a)} found`)];if(f.length&&a.length!==f.length)return[new _t(k,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new _t(k,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let M={type:f.value,values:f.values};b.$version<7&&(M.function=f.function),Jn(f.value)==="object"&&(M=f.value);let F=[];for(let U=0;U<a.length;U++)F=F.concat(S({array:a,arrayIndex:U,value:a[U],valueSpec:M,validateSpec:c.validateSpec,style:m,styleSpec:b,key:`${k}[${U}]`}));return F}function uu(c){const a=c.key,f=c.value,m=c.valueSpec;let b=Jn(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new _t(a,f,`number expected, ${b} found`)]:"minimum"in m&&f<m.minimum?[new _t(a,f,`${f} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&f>m.maximum?[new _t(a,f,`${f} is greater than the maximum value ${m.maximum}`)]:[]}function Fh(c){const a=c.valueSpec,f=Br(c.value.type);let m,b,k,S={};const M=f!=="categorical"&&c.value.property===void 0,F=!M,U=Jn(c.value.stops)==="array"&&Jn(c.value.stops[0])==="array"&&Jn(c.value.stops[0][0])==="object",K=Ei({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(de){if(f==="identity")return[new _t(de.key,de.value,'identity function may not have a "stops" property')];let ge=[];const be=de.value;return ge=ge.concat(Tc({key:de.key,value:be,valueSpec:de.valueSpec,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:Q})),Jn(be)==="array"&&be.length===0&&ge.push(new _t(de.key,be,"array must have at least one stop")),ge},default:function(de){return de.validateSpec({key:de.key,value:de.value,valueSpec:a,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec})}}});return f==="identity"&&M&&K.push(new _t(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||K.push(new _t(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!xc(c.valueSpec)&&K.push(new _t(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(F&&!_a(c.valueSpec)?K.push(new _t(c.key,c.value,"property functions not supported")):M&&!Eh(c.valueSpec)&&K.push(new _t(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!U||c.value.property!==void 0||K.push(new _t(c.key,c.value,'"property" property is required')),K;function Q(de){let ge=[];const be=de.value,Ce=de.key;if(Jn(be)!=="array")return[new _t(Ce,be,`array expected, ${Jn(be)} found`)];if(be.length!==2)return[new _t(Ce,be,`array length 2 expected, length ${be.length} found`)];if(U){if(Jn(be[0])!=="object")return[new _t(Ce,be,`object expected, ${Jn(be[0])} found`)];if(be[0].zoom===void 0)return[new _t(Ce,be,"object stop key must have zoom")];if(be[0].value===void 0)return[new _t(Ce,be,"object stop key must have value")];if(k&&k>Br(be[0].zoom))return[new _t(Ce,be[0].zoom,"stop zoom values must appear in ascending order")];Br(be[0].zoom)!==k&&(k=Br(be[0].zoom),b=void 0,S={}),ge=ge.concat(Ei({key:`${Ce}[0]`,value:be[0],valueSpec:{zoom:{}},validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:uu,value:le}}))}else ge=ge.concat(le({key:`${Ce}[0]`,value:be[0],valueSpec:{},validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec},be));return gr(ks(be[1]))?ge.concat([new _t(`${Ce}[1]`,be[1],"expressions are not allowed in function stops.")]):ge.concat(de.validateSpec({key:`${Ce}[1]`,value:be[1],valueSpec:a,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec}))}function le(de,ge){const be=Jn(de.value),Ce=Br(de.value),ze=de.value!==null?de.value:ge;if(m){if(be!==m)return[new _t(de.key,ze,`${be} stop domain type must match previous stop domain type ${m}`)]}else m=be;if(be!=="number"&&be!=="string"&&be!=="boolean")return[new _t(de.key,ze,"stop domain value must be a number, string, or boolean")];if(be!=="number"&&f!=="categorical"){let Ke=`number expected, ${be} found`;return _a(a)&&f===void 0&&(Ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(de.key,ze,Ke)]}return f!=="categorical"||be!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?f!=="categorical"&&be==="number"&&b!==void 0&&Ce<b?[new _t(de.key,ze,"stop domain values must appear in ascending order")]:(b=Ce,f==="categorical"&&Ce in S?[new _t(de.key,ze,"stop domain values must be unique")]:(S[Ce]=!0,[])):[new _t(de.key,ze,`integer expected, found ${Ce}`)]}}function Ss(c){const a=(c.expressionContext==="property"?Ih:qs)(ks(c.value),c.valueSpec);if(a.result==="error")return a.value.map(m=>new _t(`${c.key}${m.key}`,c.value,m.message));const f=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new _t(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!nl(f))return[new _t(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!nl(f))return[new _t(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!rl(f,["zoom","feature-state"]))return[new _t(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Wl(f))return[new _t(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cs(c){const a=c.key,f=c.value,m=c.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(Br(f))===-1&&b.push(new _t(a,f,`expected one of [${m.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(m.values).indexOf(Br(f))===-1&&b.push(new _t(a,f,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function ya(c){return iu(ks(c.value))?Ss(mr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mc(c)}function Mc(c){const a=c.value,f=c.key;if(Jn(a)!=="array")return[new _t(f,a,`array expected, ${Jn(a)} found`)];const m=c.styleSpec;let b,k=[];if(a.length<1)return[new _t(f,a,"filter array must have at least 1 element")];switch(k=k.concat(Cs({key:`${f}[0]`,value:a[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Br(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Br(a[1])==="$type"&&k.push(new _t(f,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&k.push(new _t(f,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=Jn(a[1]),b!=="string"&&k.push(new _t(`${f}[1]`,a[1],`string expected, ${b} found`)));for(let S=2;S<a.length;S++)b=Jn(a[S]),Br(a[1])==="$type"?k=k.concat(Cs({key:`${f}[${S}]`,value:a[S],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&k.push(new _t(`${f}[${S}]`,a[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)k=k.concat(Mc({key:`${f}[${S}]`,value:a[S],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Jn(a[1]),a.length!==2?k.push(new _t(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&k.push(new _t(`${f}[1]`,a[1],`string expected, ${b} found`));break;case"within":b=Jn(a[1]),a.length!==2?k.push(new _t(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="object"&&k.push(new _t(`${f}[1]`,a[1],`object expected, ${b} found`))}return k}function cu(c,a){const f=c.key,m=c.validateSpec,b=c.style,k=c.styleSpec,S=c.value,M=c.objectKey,F=k[`${a}_${c.layerType}`];if(!F)return[];const U=M.match(/^(.*)-transition$/);if(a==="paint"&&U&&F[U[1]]&&F[U[1]].transition)return m({key:f,value:S,valueSpec:k.transition,style:b,styleSpec:k});const K=c.valueSpec||F[M];if(!K)return[new _t(f,S,`unknown property "${M}"`)];let Q;if(Jn(S)==="string"&&_a(K)&&!K.tokens&&(Q=/^{([^}]+)}$/.exec(S)))return[new _t(f,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Q[1])} }\`.`)];const le=[];return c.layerType==="symbol"&&(M==="text-field"&&b&&!b.glyphs&&le.push(new _t(f,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&eu(ks(S))&&Br(S.type)==="identity"&&le.push(new _t(f,S,'"text-font" does not support identity functions'))),le.concat(m({key:c.key,value:S,valueSpec:K,style:b,styleSpec:k,expressionContext:"property",propertyType:a,propertyKey:M}))}function Ec(c){return cu(c,"paint")}function Lc(c){return cu(c,"layout")}function al(c){let a=[];const f=c.value,m=c.key,b=c.style,k=c.styleSpec;f.type||f.ref||a.push(new _t(m,f,'either "type" or "ref" is required'));let S=Br(f.type);const M=Br(f.ref);if(f.id){const F=Br(f.id);for(let U=0;U<c.arrayIndex;U++){const K=b.layers[U];Br(K.id)===F&&a.push(new _t(m,f.id,`duplicate layer id "${f.id}", previously used at line ${K.id.__line__}`))}}if("ref"in f){let F;["type","source","source-layer","filter","layout"].forEach(U=>{U in f&&a.push(new _t(m,f[U],`"${U}" is prohibited for ref layers`))}),b.layers.forEach(U=>{Br(U.id)===M&&(F=U)}),F?F.ref?a.push(new _t(m,f.ref,"ref cannot reference another ref layer")):S=Br(F.type):a.push(new _t(m,f.ref,`ref layer "${M}" not found`))}else if(S!=="background")if(f.source){const F=b.sources&&b.sources[f.source],U=F&&Br(F.type);F?U==="vector"&&S==="raster"?a.push(new _t(m,f.source,`layer "${f.id}" requires a raster source`)):U!=="raster-dem"&&S==="hillshade"?a.push(new _t(m,f.source,`layer "${f.id}" requires a raster-dem source`)):U==="raster"&&S!=="raster"?a.push(new _t(m,f.source,`layer "${f.id}" requires a vector source`)):U!=="vector"||f["source-layer"]?U==="raster-dem"&&S!=="hillshade"?a.push(new _t(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!f.paint||!f.paint["line-gradient"]||U==="geojson"&&F.lineMetrics||a.push(new _t(m,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new _t(m,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new _t(m,f.source,`source "${f.source}" not found`))}else a.push(new _t(m,f,'missing required property "source"'));return a=a.concat(Ei({key:m,value:f,valueSpec:k.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:f.type,valueSpec:k.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:ya,layout:F=>Ei({layer:f,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":U=>Lc(mr({layerType:S},U))}}),paint:F=>Ei({layer:f,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":U=>Ec(mr({layerType:S},U))}})}})),a}function Hs(c){const a=c.value,f=c.key,m=Jn(a);return m!=="string"?[new _t(f,a,`string expected, ${m} found`)]:[]}const Oh={promoteId:function({key:c,value:a}){if(Jn(a)==="string")return Hs({key:c,value:a});{const f=[];for(const m in a)f.push(...Hs({key:`${c}.${m}`,value:a[m]}));return f}}};function $h(c){const a=c.value,f=c.key,m=c.styleSpec,b=c.style,k=c.validateSpec;if(!a.type)return[new _t(f,a,'"type" is required')];const S=Br(a.type);let M;switch(S){case"vector":case"raster":return M=Ei({key:f,value:a,valueSpec:m[`source_${S.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:Oh,validateSpec:k}),M;case"raster-dem":return M=function(F){var U;const K=(U=F.sourceName)!==null&&U!==void 0?U:"",Q=F.value,le=F.styleSpec,de=le.source_raster_dem,ge=F.style;let be=[];const Ce=Jn(Q);if(Q===void 0)return be;if(Ce!=="object")return be.push(new _t("source_raster_dem",Q,`object expected, ${Ce} found`)),be;const ze=Br(Q.encoding)==="custom",Ke=["redFactor","greenFactor","blueFactor","baseShift"],Be=F.value.encoding?`"${F.value.encoding}"`:"Default";for(const Ve in Q)!ze&&Ke.includes(Ve)?be.push(new _t(Ve,Q[Ve],`In "${K}": "${Ve}" is only valid when "encoding" is set to "custom". ${Be} encoding found`)):de[Ve]?be=be.concat(F.validateSpec({key:Ve,value:Q[Ve],valueSpec:de[Ve],validateSpec:F.validateSpec,style:ge,styleSpec:le})):be.push(new _t(Ve,Q[Ve],`unknown property "${Ve}"`));return be}({sourceName:f,value:a,style:c.style,styleSpec:m,validateSpec:k}),M;case"geojson":if(M=Ei({key:f,value:a,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:k,objectElementValidators:Oh}),a.cluster)for(const F in a.clusterProperties){const[U,K]=a.clusterProperties[F],Q=typeof U=="string"?[U,["accumulated"],["get",F]]:U;M.push(...Ss({key:`${f}.${F}.map`,value:K,validateSpec:k,expressionContext:"cluster-map"})),M.push(...Ss({key:`${f}.${F}.reduce`,value:Q,validateSpec:k,expressionContext:"cluster-reduce"}))}return M;case"video":return Ei({key:f,value:a,valueSpec:m.source_video,style:b,validateSpec:k,styleSpec:m});case"image":return Ei({key:f,value:a,valueSpec:m.source_image,style:b,validateSpec:k,styleSpec:m});case"canvas":return[new _t(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cs({key:`${f}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:k,styleSpec:m})}}function Nh(c){const a=c.value,f=c.styleSpec,m=f.light,b=c.style;let k=[];const S=Jn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new _t("light",a,`object expected, ${S} found`)]),k;for(const M in a){const F=M.match(/^(.*)-transition$/);k=k.concat(F&&m[F[1]]&&m[F[1]].transition?c.validateSpec({key:M,value:a[M],valueSpec:f.transition,validateSpec:c.validateSpec,style:b,styleSpec:f}):m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new _t(M,a[M],`unknown property "${M}"`)])}return k}function jh(c){const a=c.value,f=c.styleSpec,m=f.sky,b=c.style,k=Jn(a);if(a===void 0)return[];if(k!=="object")return[new _t("sky",a,`object expected, ${k} found`)];let S=[];for(const M in a)S=S.concat(m[M]?Vo({key:M,value:a[M],valueSpec:m[M],style:b,styleSpec:f}):[new _t(M,a[M],`unknown property "${M}"`)]);return S}function ll(c){const a=c.value,f=c.styleSpec,m=f.terrain,b=c.style;let k=[];const S=Jn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new _t("terrain",a,`object expected, ${S} found`)]),k;for(const M in a)k=k.concat(m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new _t(M,a[M],`unknown property "${M}"`)]);return k}function ul(c){let a=[];const f=c.value,m=c.key;if(Array.isArray(f)){const b=[],k=[];for(const S in f)f[S].id&&b.includes(f[S].id)&&a.push(new _t(m,f,`all the sprites' ids must be unique, but ${f[S].id} is duplicated`)),b.push(f[S].id),f[S].url&&k.includes(f[S].url)&&a.push(new _t(m,f,`all the sprites' URLs must be unique, but ${f[S].url} is duplicated`)),k.push(f[S].url),a=a.concat(Ei({key:`${m}[${S}]`,value:f[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return Hs({key:m,value:f})}const Ni={"*":()=>[],array:Tc,boolean:function(c){const a=c.value,f=c.key,m=Jn(a);return m!=="boolean"?[new _t(f,a,`boolean expected, ${m} found`)]:[]},number:uu,color:function(c){const a=c.key,f=c.value,m=Jn(f);return m!=="string"?[new _t(a,f,`color expected, ${m} found`)]:ur.parse(String(f))?[]:[new _t(a,f,`color expected, "${f}" found`)]},constants:Bh,enum:Cs,filter:ya,function:Fh,layer:al,object:Ei,source:$h,light:Nh,sky:jh,terrain:ll,string:Hs,formatted:function(c){return Hs(c).length===0?[]:Ss(c)},resolvedImage:function(c){return Hs(c).length===0?[]:Ss(c)},padding:function(c){const a=c.key,f=c.value;if(Jn(f)==="array"){if(f.length<1||f.length>4)return[new _t(a,f,`padding requires 1 to 4 values; ${f.length} values found`)];const m={type:"number"};let b=[];for(let k=0;k<f.length;k++)b=b.concat(c.validateSpec({key:`${a}[${k}]`,value:f[k],validateSpec:c.validateSpec,valueSpec:m}));return b}return uu({key:a,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,f=c.value,m=Jn(f),b=c.styleSpec;if(m!=="array"||f.length<1||f.length%2!=0)return[new _t(a,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let k=[];for(let S=0;S<f.length;S+=2)k=k.concat(Cs({key:`${a}[${S}]`,value:f[S],valueSpec:b.layout_symbol["text-anchor"]})),k=k.concat(Tc({key:`${a}[${S+1}]`,value:f[S+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:b}));return k},sprite:ul};function Vo(c){const a=c.value,f=c.valueSpec,m=c.styleSpec;return c.validateSpec=Vo,f.expression&&eu(Br(a))?Fh(c):f.expression&&gr(ks(a))?Ss(c):f.type&&Ni[f.type]?Ni[f.type](c):Ei(mr({},c,{valueSpec:f.type?m[f.type]:f}))}function Ic(c){const a=c.value,f=c.key,m=Hs(c);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new _t(f,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new _t(f,a,'"glyphs" url must include a "{range}" token'))),m}function ko(c,a=he){let f=[];return f=f.concat(Vo({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:Vo,objectElementValidators:{glyphs:Ic,"*":()=>[]}})),c.constants&&(f=f.concat(Bh({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:Vo}))),va(f)}function qo(c){return function(a){return c({...a,validateSpec:Vo})}}function va(c){return[].concat(c).sort((a,f)=>a.line-f.line)}function So(c){return function(...a){return va(c.apply(this,a))}}ko.source=So(qo($h)),ko.sprite=So(qo(ul)),ko.glyphs=So(qo(Ic)),ko.light=So(qo(Nh)),ko.sky=So(qo(jh)),ko.terrain=So(qo(ll)),ko.layer=So(qo(al)),ko.filter=So(qo(ya)),ko.paintProperty=So(qo(Ec)),ko.layoutProperty=So(qo(Lc));const Gs=ko,Fp=Gs.light,Pc=Gs.paintProperty,Op=Gs.layoutProperty;function ba(c,a){let f=!1;if(a&&a.length)for(const m of a)c.fire(new mt(new Error(m.message))),f=!0;return f}class cl{constructor(a,f,m){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const S=new Int32Array(this.arrayBuffer);a=S[0],this.d=(f=S[1])+2*(m=S[2]);for(let F=0;F<this.d*this.d;F++){const U=S[3+F],K=S[3+F+1];b.push(U===K?null:S.subarray(U,K))}const M=S[3+b.length+1];this.keys=S.subarray(S[3+b.length],M),this.bboxes=S.subarray(M),this.insert=this._insertReadonly}else{this.d=f+2*m;for(let S=0;S<this.d*this.d;S++)b.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=a,this.padding=m,this.scale=f/a,this.uid=0;const k=m/f*a;this.min=-k,this.max=a+k}insert(a,f,m,b,k){this._forEachCell(f,m,b,k,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(k)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,f,m,b,k,S){this.cells[k].push(S)}query(a,f,m,b,k){const S=this.min,M=this.max;if(a<=S&&f<=S&&M<=m&&M<=b&&!k)return Array.prototype.slice.call(this.keys);{const F=[];return this._forEachCell(a,f,m,b,this._queryCell,F,{},k),F}}_queryCell(a,f,m,b,k,S,M,F){const U=this.cells[k];if(U!==null){const K=this.keys,Q=this.bboxes;for(let le=0;le<U.length;le++){const de=U[le];if(M[de]===void 0){const ge=4*de;(F?F(Q[ge+0],Q[ge+1],Q[ge+2],Q[ge+3]):a<=Q[ge+2]&&f<=Q[ge+3]&&m>=Q[ge+0]&&b>=Q[ge+1])?(M[de]=!0,S.push(K[de])):M[de]=!1}}}}_forEachCell(a,f,m,b,k,S,M,F){const U=this._convertToCellCoord(a),K=this._convertToCellCoord(f),Q=this._convertToCellCoord(m),le=this._convertToCellCoord(b);for(let de=U;de<=Q;de++)for(let ge=K;ge<=le;ge++){const be=this.d*ge+de;if((!F||F(this._convertFromCellCoord(de),this._convertFromCellCoord(ge),this._convertFromCellCoord(de+1),this._convertFromCellCoord(ge+1)))&&k.call(this,a,f,m,b,be,S,M,F))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,f=3+this.cells.length+1+1;let m=0;for(let S=0;S<this.cells.length;S++)m+=this.cells[S].length;const b=new Int32Array(f+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let k=f;for(let S=0;S<a.length;S++){const M=a[S];b[3+S]=k,b.set(M,k),k+=M.length}return b[3+a.length]=k,b.set(this.keys,k),k+=this.keys.length,b[3+a.length+1]=k,b.set(this.bboxes,k),k+=this.bboxes.length,b.buffer}static serialize(a,f){const m=a.toArrayBuffer();return f&&f.push(m),{buffer:m}}static deserialize(a){return new cl(a.buffer)}}const Ho={};function Zt(c,a,f={}){if(Ho[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),Ho[c]={klass:a,omit:f.omit||[],shallow:f.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",cl),Zt("Color",ur),Zt("Error",Error),Zt("AJAXError",Yt),Zt("ResolvedImage",po),Zt("StylePropertyFunction",nu),Zt("StyleExpression",wr,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",kc),Zt("ZoomConstantExpression",tu),Zt("CompoundExpression",no,{omit:["_evaluate"]});for(const c in ma)ma[c]._classRegistryKey||Zt(`Expression_${c}`,ma[c]);function fu(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function wa(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(fu(c)||xe(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return a&&a.push(f.buffer),f}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const m of c)f.push(wa(m,a));return f}if(typeof c=="object"){const f=c.constructor,m=f._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${f.name}`);if(!Ho[m])throw new Error(`${m} is not registered.`);const b=f.serialize?f.serialize(c,a):{};if(f.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const k in c){if(!c.hasOwnProperty(k)||Ho[m].omit.indexOf(k)>=0)continue;const S=c[k];b[k]=Ho[m].shallow.indexOf(k)>=0?S:wa(S,a)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(b.$name=m),b}throw new Error("can't serialize object of type "+typeof c)}function xa(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||fu(c)||xe(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(xa);if(typeof c=="object"){const a=c.$name||"Object";if(!Ho[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:f}=Ho[a];if(!f)throw new Error(`can't deserialize unregistered class ${a}`);if(f.deserialize)return f.deserialize(c);const m=Object.create(f.prototype);for(const b of Object.keys(c)){if(b==="$name")continue;const k=c[b];m[b]=Ho[a].shallow.indexOf(b)>=0?k:xa(k)}return m}throw new Error("can't deserialize object of type "+typeof c)}class Uh{constructor(){this.first=!0}update(a,f){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=f),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Aa(c){for(const a of c)if(hu(a.charCodeAt(0)))return!0;return!1}function Vh(c){for(const a of c)if(!qh(a.charCodeAt(0)))return!1;return!0}function qh(c){return!(Vt.Arabic(c)||Vt["Arabic Supplement"](c)||Vt["Arabic Extended-A"](c)||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c))}function hu(c){return!(c!==746&&c!==747&&(c<4352||!(Vt["Bopomofo Extended"](c)||Vt.Bopomofo(c)||Vt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Vt["CJK Compatibility Ideographs"](c)||Vt["CJK Compatibility"](c)||Vt["CJK Radicals Supplement"](c)||Vt["CJK Strokes"](c)||!(!Vt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Vt["CJK Unified Ideographs Extension A"](c)||Vt["CJK Unified Ideographs"](c)||Vt["Enclosed CJK Letters and Months"](c)||Vt["Hangul Compatibility Jamo"](c)||Vt["Hangul Jamo Extended-A"](c)||Vt["Hangul Jamo Extended-B"](c)||Vt["Hangul Jamo"](c)||Vt["Hangul Syllables"](c)||Vt.Hiragana(c)||Vt["Ideographic Description Characters"](c)||Vt.Kanbun(c)||Vt["Kangxi Radicals"](c)||Vt["Katakana Phonetic Extensions"](c)||Vt.Katakana(c)&&c!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Vt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](c)||Vt["Unified Canadian Aboriginal Syllabics Extended"](c)||Vt["Vertical Forms"](c)||Vt["Yijing Hexagram Symbols"](c)||Vt["Yi Syllables"](c)||Vt["Yi Radicals"](c))))}function zc(c){return!(hu(c)||function(a){return!!(Vt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Vt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Vt["Letterlike Symbols"](a)||Vt["Number Forms"](a)||Vt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Vt["Control Pictures"](a)&&a!==9251||Vt["Optical Character Recognition"](a)||Vt["Enclosed Alphanumerics"](a)||Vt["Geometric Shapes"](a)||Vt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Vt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Vt["CJK Symbols and Punctuation"](a)||Vt.Katakana(a)||Vt["Private Use Area"](a)||Vt["CJK Compatibility Forms"](a)||Vt["Small Form Variants"](a)||Vt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function du(c){return c>=1424&&c<=2303||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c)}function Hh(c,a){return!(!a&&du(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Vt.Khmer(c))}function $p(c){for(const a of c)if(du(a.charCodeAt(0)))return!0;return!1}const Ts=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Tr{constructor(a,f){this.zoom=a,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uh,this.transition={})}isSupportedScript(a){return function(f,m){for(const b of f)if(!Hh(b.charCodeAt(0),m))return!1;return!0}(a,Ts.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,f=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*f}}}class fl{constructor(a,f){this.property=a,this.value=f,this.expression=function(m,b){if(eu(m))return new nu(m,b);if(gr(m)){const k=Ih(m,b);if(k.result==="error")throw new Error(k.value.map(S=>`${S.key}: ${S.message}`).join(", "));return k.value}{let k=m;return b.type==="color"&&typeof m=="string"?k=ur.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(k=ho.parse(m)):k=$i.parse(m),{kind:"constant",evaluate:()=>k}}}(f===void 0?a.specification.default:f,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,f,m){return this.property.possiblyEvaluate(this,a,f,m)}}class pu{constructor(a){this.property=a,this.value=new fl(a,void 0)}transitioned(a,f){return new Gh(this.property,this.value,f,H({},a.transition,this.transition),a.now)}untransitioned(){return new Gh(this.property,this.value,null,{},0)}}class Dc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return J(this._values[a].value.value)}setValue(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new pu(this._values[a].property)),this._values[a].value=new fl(this._values[a].property,f===null?void 0:J(f))}getTransition(a){return J(this._values[a].transition)}setTransition(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new pu(this._values[a].property)),this._values[a].transition=J(f)||void 0}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m);const b=this.getTransition(f);b!==void 0&&(a[`${f}-transition`]=b)}return a}transitioned(a,f){const m=new Wh(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(a,f._values[b]);return m}untransitioned(){const a=new Wh(this._properties);for(const f of Object.keys(this._values))a._values[f]=this._values[f].untransitioned();return a}}class Gh{constructor(a,f,m,b,k){this.property=a,this.value=f,this.begin=k+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(a,f,m){const b=a.now||0,k=this.value.possiblyEvaluate(a,f,m),S=this.prior;if(S){if(b>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(b<this.begin)return S.possiblyEvaluate(a,f,m);{const M=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,f,m),k,function(F){if(F<=0)return 0;if(F>=1)return 1;const U=F*F,K=U*F;return 4*(F<.5?K:3*(F-U)+K-.75)}(M))}}return k}}class Wh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,f,m){const b=new hl(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Zh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return J(this._values[a].value)}setValue(a,f){this._values[a]=new fl(this._values[a].property,f===null?void 0:J(f))}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m)}return a}possiblyEvaluate(a,f,m){const b=new hl(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}}class Co{constructor(a,f,m){this.property=a,this.value=f,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,f,m,b){return this.property.evaluate(this.value,this.parameters,a,f,m,b)}}class hl{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class un{constructor(a){this.specification=a}possiblyEvaluate(a,f){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(f)}interpolate(a,f,m){const b=Mi[this.specification.type];return b?b(a,f,m):a}}class dn{constructor(a,f){this.specification=a,this.overrides=f}possiblyEvaluate(a,f,m,b){return new Co(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(f,null,{},m,b)}:a.expression,f)}interpolate(a,f,m){if(a.value.kind!=="constant"||f.value.kind!=="constant")return a;if(a.value.value===void 0||f.value.value===void 0)return new Co(this,{kind:"constant",value:void 0},a.parameters);const b=Mi[this.specification.type];if(b){const k=b(a.value.value,f.value.value,m);return new Co(this,{kind:"constant",value:k},a.parameters)}return a}evaluate(a,f,m,b,k,S){return a.kind==="constant"?a.value:a.evaluate(f,m,b,k,S)}}class mu extends dn{possiblyEvaluate(a,f,m,b){if(a.value===void 0)return new Co(this,{kind:"constant",value:void 0},f);if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b),S=a.property.specification.type==="resolvedImage"&&typeof k!="string"?k.name:k,M=this._calculate(S,S,S,f);return new Co(this,{kind:"constant",value:M},f)}if(a.expression.kind==="camera"){const k=this._calculate(a.expression.evaluate({zoom:f.zoom-1}),a.expression.evaluate({zoom:f.zoom}),a.expression.evaluate({zoom:f.zoom+1}),f);return new Co(this,{kind:"constant",value:k},f)}return new Co(this,a.expression,f)}evaluate(a,f,m,b,k,S){if(a.kind==="source"){const M=a.evaluate(f,m,b,k,S);return this._calculate(M,M,M,f)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(f.zoom)-1},m,b),a.evaluate({zoom:Math.floor(f.zoom)},m,b),a.evaluate({zoom:Math.floor(f.zoom)+1},m,b),f):a.value}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class dl{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b);return this._calculate(k,k,k,f)}return this._calculate(a.expression.evaluate(new Tr(Math.floor(f.zoom-1),f)),a.expression.evaluate(new Tr(Math.floor(f.zoom),f)),a.expression.evaluate(new Tr(Math.floor(f.zoom+1),f)),f)}}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class Rc{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){return!!a.expression.evaluate(f,null,{},m,b)}interpolate(){return!1}}class ji{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in a){const m=a[f];m.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new fl(m,void 0),k=this.defaultTransitionablePropertyValues[f]=new pu(m);this.defaultTransitioningPropertyValues[f]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}}}Zt("DataDrivenProperty",dn),Zt("DataConstantProperty",un),Zt("CrossFadedDataDrivenProperty",mu),Zt("CrossFadedProperty",dl),Zt("ColorRampProperty",Rc);const Bc="-transition";class To extends Pt{constructor(a,f){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),f.layout&&(this._unevaluatedLayout=new Zh(f.layout)),f.paint)){this._transitionablePaint=new Dc(f.paint);for(const m in a.paint)this.setPaintProperty(m,a.paint[m],{validate:!1});for(const m in a.layout)this.setLayoutProperty(m,a.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hl(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,f,m={}){f!=null&&this._validate(Op,`layers.${this.id}.layout.${a}`,a,f,m)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,f):this.visibility=f)}getPaintProperty(a){return a.endsWith(Bc)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,f,m={}){if(f!=null&&this._validate(Pc,`layers.${this.id}.paint.${a}`,a,f,m))return!1;if(a.endsWith(Bc))return this._transitionablePaint.setTransition(a.slice(0,-11),f||void 0),!1;{const b=this._transitionablePaint._values[a],k=b.property.specification["property-type"]==="cross-faded-data-driven",S=b.value.isDataDriven(),M=b.value;this._transitionablePaint.setValue(a,f),this._handleSpecialPaintPropertyUpdate(a);const F=this._transitionablePaint._values[a].value;return F.isDataDriven()||S||k||this._handleOverridablePaintPropertyUpdate(a,M,F)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,f,m){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,f){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,f)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Ie(a,(f,m)=>!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length))}_validate(a,f,m,b,k={}){return(!k||k.validate!==!1)&&ba(this,a.call(Gs,{key:f,layerType:this.type,objectKey:m,value:b,styleSpec:he,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const f=this.paint.get(a);if(f instanceof Co&&_a(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Xh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class pl{constructor(a,f){this._structArray=a,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,f){return a._trim(),f&&(a.isTransferred=!0,f.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const f=Object.create(this.prototype);return f.arrayBuffer=a.arrayBuffer,f.length=a.length,f.capacity=a.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(c,a=1){let f=0,m=0;return{members:c.map(b=>{const k=Xh[b.type].BYTES_PER_ELEMENT,S=f=Kh(f,Math.max(a,k)),M=b.components||1;return m=Math.max(m,k),f+=k*M,{name:b.name,type:b.type,components:M,offset:S}}),size:Kh(f,Math.max(m,a)),alignment:a}}function Kh(c,a){return Math.ceil(c/a)*a}class ml extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.int16[b+0]=f,this.int16[b+1]=m,a}}ml.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",ml);class us extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.int16[k+0]=f,this.int16[k+1]=m,this.int16[k+2]=b,a}}us.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",us);class Fc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.int16[S+0]=f,this.int16[S+1]=m,this.int16[S+2]=b,this.int16[S+3]=k,a}}Fc.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Fc);class Oc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const F=6*a;return this.int16[F+0]=f,this.int16[F+1]=m,this.int16[F+2]=b,this.int16[F+3]=k,this.int16[F+4]=S,this.int16[F+5]=M,a}}Oc.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Oc);class $c extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const F=4*a,U=8*a;return this.int16[F+0]=f,this.int16[F+1]=m,this.uint8[U+4]=b,this.uint8[U+5]=k,this.uint8[U+6]=S,this.uint8[U+7]=M,a}}$c.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",$c);class gl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.float32[b+0]=f,this.float32[b+1]=m,a}}gl.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",gl);class gu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,U,K){const Q=this.length;return this.resize(Q+1),this.emplace(Q,a,f,m,b,k,S,M,F,U,K)}emplace(a,f,m,b,k,S,M,F,U,K,Q){const le=10*a;return this.uint16[le+0]=f,this.uint16[le+1]=m,this.uint16[le+2]=b,this.uint16[le+3]=k,this.uint16[le+4]=S,this.uint16[le+5]=M,this.uint16[le+6]=F,this.uint16[le+7]=U,this.uint16[le+8]=K,this.uint16[le+9]=Q,a}}gu.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",gu);class Nc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,U,K,Q,le){const de=this.length;return this.resize(de+1),this.emplace(de,a,f,m,b,k,S,M,F,U,K,Q,le)}emplace(a,f,m,b,k,S,M,F,U,K,Q,le,de){const ge=12*a;return this.int16[ge+0]=f,this.int16[ge+1]=m,this.int16[ge+2]=b,this.int16[ge+3]=k,this.uint16[ge+4]=S,this.uint16[ge+5]=M,this.uint16[ge+6]=F,this.uint16[ge+7]=U,this.int16[ge+8]=K,this.int16[ge+9]=Q,this.int16[ge+10]=le,this.int16[ge+11]=de,a}}Nc.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Nc);class jc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.float32[k+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}jc.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",jc);class cs extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint32[1*a+0]=f,a}}cs.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",cs);class _u extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,U){const K=this.length;return this.resize(K+1),this.emplace(K,a,f,m,b,k,S,M,F,U)}emplace(a,f,m,b,k,S,M,F,U,K){const Q=10*a,le=5*a;return this.int16[Q+0]=f,this.int16[Q+1]=m,this.int16[Q+2]=b,this.int16[Q+3]=k,this.int16[Q+4]=S,this.int16[Q+5]=M,this.uint32[le+3]=F,this.uint16[Q+8]=U,this.uint16[Q+9]=K,a}}_u.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",_u);class _l extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const F=6*a;return this.int16[F+0]=f,this.int16[F+1]=m,this.int16[F+2]=b,this.int16[F+3]=k,this.int16[F+4]=S,this.int16[F+5]=M,a}}_l.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",_l);class yu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b,k)}emplace(a,f,m,b,k,S){const M=4*a,F=8*a;return this.float32[M+0]=f,this.float32[M+1]=m,this.float32[M+2]=b,this.int16[F+6]=k,this.int16[F+7]=S,a}}yu.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",yu);class yl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=12*a,M=3*a;return this.uint8[S+0]=f,this.uint8[S+1]=m,this.float32[M+1]=b,this.float32[M+2]=k,a}}yl.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",yl);class vu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[k+0]=f,this.uint16[k+1]=m,this.uint16[k+2]=b,a}}vu.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",vu);class ka extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be,Ce,ze){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be,Ce,ze)}emplace(a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be,Ce,ze,Ke){const Be=24*a,Ve=12*a,ht=48*a;return this.int16[Be+0]=f,this.int16[Be+1]=m,this.uint16[Be+2]=b,this.uint16[Be+3]=k,this.uint32[Ve+2]=S,this.uint32[Ve+3]=M,this.uint32[Ve+4]=F,this.uint16[Be+10]=U,this.uint16[Be+11]=K,this.uint16[Be+12]=Q,this.float32[Ve+7]=le,this.float32[Ve+8]=de,this.uint8[ht+36]=ge,this.uint8[ht+37]=be,this.uint8[ht+38]=Ce,this.uint32[Ve+10]=ze,this.int16[Be+22]=Ke,a}}ka.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ka);class Ws extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be,Ce,ze,Ke,Be,Ve,ht,gt,Ht,sn,qt,Ut,Bt,Jt){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be,Ce,ze,Ke,Be,Ve,ht,gt,Ht,sn,qt,Ut,Bt,Jt)}emplace(a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be,Ce,ze,Ke,Be,Ve,ht,gt,Ht,sn,qt,Ut,Bt,Jt,Nt){const It=32*a,hn=16*a;return this.int16[It+0]=f,this.int16[It+1]=m,this.int16[It+2]=b,this.int16[It+3]=k,this.int16[It+4]=S,this.int16[It+5]=M,this.int16[It+6]=F,this.int16[It+7]=U,this.uint16[It+8]=K,this.uint16[It+9]=Q,this.uint16[It+10]=le,this.uint16[It+11]=de,this.uint16[It+12]=ge,this.uint16[It+13]=be,this.uint16[It+14]=Ce,this.uint16[It+15]=ze,this.uint16[It+16]=Ke,this.uint16[It+17]=Be,this.uint16[It+18]=Ve,this.uint16[It+19]=ht,this.uint16[It+20]=gt,this.uint16[It+21]=Ht,this.uint16[It+22]=sn,this.uint32[hn+12]=qt,this.float32[hn+13]=Ut,this.float32[hn+14]=Bt,this.uint16[It+30]=Jt,this.uint16[It+31]=Nt,a}}Ws.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Ws);class bu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.float32[1*a+0]=f,a}}bu.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",bu);class wu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[6*a+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}wu.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",wu);class Zs extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=4*a;return this.uint32[2*a+0]=f,this.uint16[k+2]=m,this.uint16[k+3]=b,a}}Zs.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Zs);class Uc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.uint16[b+0]=f,this.uint16[b+1]=m,a}}Uc.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",Uc);class Vc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint16[1*a+0]=f,a}}Vc.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",Vc);class xu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.float32[S+0]=f,this.float32[S+1]=m,this.float32[S+2]=b,this.float32[S+3]=k,a}}xu.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",xu);class Jh extends pl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}Jh.prototype.size=20;class w extends _u{get(a){return new Jh(this,a)}}Zt("CollisionBoxArray",w);class l extends pl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class h extends ka{get(a){return new l(this,a)}}Zt("PlacedSymbolArray",h);class _ extends pl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}_.prototype.size=64;class v extends Ws{get(a){return new _(this,a)}}Zt("SymbolInstanceArray",v);class A extends bu{getoffsetX(a){return this.float32[1*a+0]}}Zt("GlyphOffsetArray",A);class P extends us{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Zt("SymbolLineVertexArray",P);class R extends pl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}R.prototype.size=12;class $ extends wu{get(a){return new R(this,a)}}Zt("TextAnchorOffsetArray",$);class X extends pl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}X.prototype.size=8;class ee extends Zs{get(a){return new X(this,a)}}Zt("FeatureIndexArray",ee);class te extends ml{}class pe extends ml{}class ke extends ml{}class Ae extends Oc{}class Me extends $c{}class ve extends gl{}class Fe extends gu{}class rt extends Nc{}class Le extends jc{}class Ge extends cs{}class ot extends _l{}class at extends yl{}class ut extends vu{}class At extends Uc{}const bt=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rt}=bt;class Ft{constructor(a=[]){this.segments=a}prepareSegment(a,f,m,b){let k=this.segments[this.segments.length-1];return a>Ft.MAX_VERTEX_ARRAY_LENGTH&&Ee(`Max vertices per segment is ${Ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!k||k.vertexLength+a>Ft.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==b)&&(k={vertexOffset:f.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(k.sortKey=b),this.segments.push(k)),k}get(){return this.segments}destroy(){for(const a of this.segments)for(const f in a.vaos)a.vaos[f].destroy()}static simpleSegment(a,f,m,b){return new Ft([{vertexOffset:a,primitiveOffset:f,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function Mn(c,a){return 256*(c=Y(Math.floor(c),0,255))+Y(Math.floor(a),0,255)}Ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Ft);const $t=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gn={exports:{}},En={exports:{}};En.exports=function(c,a){var f,m,b,k,S,M,F,U;for(m=c.length-(f=3&c.length),b=a,S=3432918353,M=461845907,U=0;U<m;)F=255&c.charCodeAt(U)|(255&c.charCodeAt(++U))<<8|(255&c.charCodeAt(++U))<<16|(255&c.charCodeAt(++U))<<24,++U,b=27492+(65535&(k=5*(65535&(b=(b^=F=(65535&(F=(F=(65535&F)*S+(((F>>>16)*S&65535)<<16)&4294967295)<<15|F>>>17))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(F=0,f){case 3:F^=(255&c.charCodeAt(U+2))<<16;case 2:F^=(255&c.charCodeAt(U+1))<<8;case 1:b^=F=(65535&(F=(F=(65535&(F^=255&c.charCodeAt(U)))*S+(((F>>>16)*S&65535)<<16)&4294967295)<<15|F>>>17))*M+(((F>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var Zn=En.exports,kn={exports:{}};kn.exports=function(c,a){for(var f,m=c.length,b=a^m,k=0;m>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24))+((1540483477*(f>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++k;switch(m){case 3:b^=(255&c.charCodeAt(k+2))<<16;case 2:b^=(255&c.charCodeAt(k+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(k)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var Pn=Zn,zn=kn.exports;gn.exports=Pn,gn.exports.murmur3=Pn,gn.exports.murmur2=zn;var Or=d(gn.exports);class fr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,f,m,b){this.ids.push(ro(a)),this.positions.push(f,m,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=ro(a);let m=0,b=this.ids.length-1;for(;m<b;){const S=m+b>>1;this.ids[S]>=f?b=S:m=S+1}const k=[];for(;this.ids[m]===f;)k.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return k}static serialize(a,f){const m=new Float64Array(a.ids),b=new Uint32Array(a.positions);return ri(m,b,0,m.length-1),f&&f.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(a){const f=new fr;return f.ids=a.ids,f.positions=a.positions,f.indexed=!0,f}}function ro(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Or(String(c))}function ri(c,a,f,m){for(;f<m;){const b=c[f+m>>1];let k=f-1,S=m+1;for(;;){do k++;while(c[k]<b);do S--;while(c[S]>b);if(k>=S)break;Pr(c,k,S),Pr(a,3*k,3*S),Pr(a,3*k+1,3*S+1),Pr(a,3*k+2,3*S+2)}S-f<m-S?(ri(c,a,f,S),f=S+1):(ri(c,a,S+1,m),m=S)}}function Pr(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}Zt("FeaturePositionMap",fr);class ii{constructor(a,f){this.gl=a.gl,this.location=f}}class io extends ii{constructor(a,f){super(a,f),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Go extends ii{constructor(a,f){super(a,f),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Ms extends ii{constructor(a,f){super(a,f),this.current=ur.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const vl=new Float32Array(16);function Es(c){return[Mn(255*c.r,255*c.g),Mn(255*c.b,255*c.a)]}class Wo{constructor(a,f,m){this.value=a,this.uniformNames=f.map(b=>`u_${b}`),this.type=m}setUniform(a,f,m){a.set(m.constantOr(this.value))}getBinding(a,f,m){return this.type==="color"?new Ms(a,f):new io(a,f)}}class Zr{constructor(a,f){this.uniformNames=f.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=a.tlbr}setUniform(a,f,m,b){const k=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;k&&a.set(k)}getBinding(a,f,m){return m.substr(0,9)==="u_pattern"?new Go(a,f):new io(a,f)}}class zr{constructor(a,f,m,b){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=f.map(k=>({name:`a_${k}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,f,m,b,k){const S=this.paintVertexArray.length,M=this.expression.evaluate(new Tr(0),f,{},b,[],k);this.paintVertexArray.resize(a),this._setPaintValue(S,a,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(a,f,k)}_setPaintValue(a,f,m){if(this.type==="color"){const b=Es(m);for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,b[0],b[1])}else{for(let b=a;b<f;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mr{constructor(a,f,m,b,k,S){this.expression=a,this.uniformNames=f.map(M=>`u_${M}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(a,f,m,b,k){const S=this.expression.evaluate(new Tr(this.zoom),f,{},b,[],k),M=this.expression.evaluate(new Tr(this.zoom+1),f,{},b,[],k),F=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(F,a,S,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:this.zoom},m,b),S=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(a,f,k,S)}_setPaintValue(a,f,m,b){if(this.type==="color"){const k=Es(m),S=Es(b);for(let M=a;M<f;M++)this.paintVertexArray.emplace(M,k[0],k[1],S[0],S[1])}else{for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,f){const m=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=Y(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,f,m){return new io(a,f)}}class mo{constructor(a,f,m,b,k,S){this.expression=a,this.type=f,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k}populatePaintArray(a,f,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,f.patterns&&f.patterns[this.layerId],m)}updatePaintArray(a,f,m,b,k){this._setPaintValues(a,f,m.patterns&&m.patterns[this.layerId],k)}_setPaintValues(a,f,m,b){if(!b||!m)return;const{min:k,mid:S,max:M}=m,F=b[k],U=b[S],K=b[M];if(F&&U&&K)for(let Q=a;Q<f;Q++)this.zoomInPaintVertexArray.emplace(Q,U.tl[0],U.tl[1],U.br[0],U.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],U.pixelRatio,F.pixelRatio),this.zoomOutPaintVertexArray.emplace(Q,U.tl[0],U.tl[1],U.br[0],U.br[1],K.tl[0],K.tl[1],K.br[0],K.br[1],U.pixelRatio,K.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(a,f,m){this.binders={},this._buffers=[];const b=[];for(const k in a.paint._values){if(!m(k))continue;const S=a.paint.get(k);if(!(S instanceof Co&&_a(S.property.specification)))continue;const M=go(k,a.type),F=S.value,U=S.property.specification.type,K=S.property.useIntegerZoom,Q=S.property.specification["property-type"],le=Q==="cross-faded"||Q==="cross-faded-data-driven";if(F.kind==="constant")this.binders[k]=le?new Zr(F.value,M):new Wo(F.value,M,U),b.push(`/u_${k}`);else if(F.kind==="source"||le){const de=Kr(k,U,"source");this.binders[k]=le?new mo(F,U,K,f,de,a.id):new zr(F,M,U,de),b.push(`/a_${k}`)}else{const de=Kr(k,U,"composite");this.binders[k]=new Mr(F,M,U,K,f,de),b.push(`/z_${k}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const f=this.binders[a];return f instanceof zr||f instanceof Mr?f.maxValue:0}populatePaintArrays(a,f,m,b,k){for(const S in this.binders){const M=this.binders[S];(M instanceof zr||M instanceof Mr||M instanceof mo)&&M.populatePaintArray(a,f,m,b,k)}}setConstantPatternPositions(a,f){for(const m in this.binders){const b=this.binders[m];b instanceof Zr&&b.setConstantPatternPositions(a,f)}}updatePaintArrays(a,f,m,b,k){let S=!1;for(const M in a){const F=f.getPositions(M);for(const U of F){const K=m.feature(U.index);for(const Q in this.binders){const le=this.binders[Q];if((le instanceof zr||le instanceof Mr||le instanceof mo)&&le.expression.isStateDependent===!0){const de=b.paint.get(Q);le.expression=de.value,le.updatePaintArray(U.start,U.end,K,a[M],k),S=!0}}}}return S}defines(){const a=[];for(const f in this.binders){const m=this.binders[f];(m instanceof Wo||m instanceof Zr)&&a.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return a}getBinderAttributes(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof zr||m instanceof Mr)for(let b=0;b<m.paintVertexAttributes.length;b++)a.push(m.paintVertexAttributes[b].name);else if(m instanceof mo)for(let b=0;b<$t.members.length;b++)a.push($t.members[b].name)}return a}getBinderUniforms(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Wo||m instanceof Zr||m instanceof Mr)for(const b of m.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,f){const m=[];for(const b in this.binders){const k=this.binders[b];if(k instanceof Wo||k instanceof Zr||k instanceof Mr){for(const S of k.uniformNames)if(f[S]){const M=k.getBinding(a,f[S],S);m.push({name:S,property:b,binding:M})}}}return m}setUniforms(a,f,m,b){for(const{name:k,property:S,binding:M}of f)this.binders[S].setUniform(M,b,m.get(S),k)}updatePaintBuffers(a){this._buffers=[];for(const f in this.binders){const m=this.binders[f];if(a&&m instanceof mo){const b=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof zr||m instanceof Mr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const f in this.binders){const m=this.binders[f];(m instanceof zr||m instanceof Mr||m instanceof mo)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const f=this.binders[a];(f instanceof zr||f instanceof Mr||f instanceof mo)&&f.destroy()}}}class Dr{constructor(a,f,m=()=>!0){this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new Xr(b,f,m);this.needsUpload=!1,this._featureMap=new fr,this._bufferOffset=0}populatePaintArrays(a,f,m,b,k,S){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(a,f,b,k,S);f.id!==void 0&&this._featureMap.add(f.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,f,m,b){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(a,this._featureMap,f,k,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function go(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function Kr(c,a,f){const m={color:{source:gl,composite:xu},number:{source:bu,composite:gl}},b=function(k){return{"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe}}[k]}(c);return b&&b[f]||m[a][f]}Zt("ConstantBinder",Wo),Zt("CrossFadedConstantBinder",Zr),Zt("SourceExpressionBinder",zr),Zt("CrossFadedCompositeBinder",mo),Zt("CompositeExpressionBinder",Mr),Zt("ProgramConfiguration",Xr,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Dr);const jr=8192,qc=Math.pow(2,14)-1,Yh=-qc-1;function Xs(c){const a=jr/c.extent,f=c.loadGeometry();for(let m=0;m<f.length;m++){const b=f[m];for(let k=0;k<b.length;k++){const S=b[k],M=Math.round(S.x*a),F=Math.round(S.y*a);S.x=Y(M,Yh,qc),S.y=Y(F,Yh,qc),(M<S.x||M>S.x+1||F<S.y||F>S.y+1)&&Ee("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Ks(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Xs(c):[]}}function Au(c,a,f,m,b){c.emplaceBack(2*a+(m+1)/2,2*f+(b+1)/2)}class Ls{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.indexArray=new ut,this.segments=new Ft,this.programConfigurations=new Dr(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){const b=this.layers[0],k=[];let S=null,M=!1;b.type==="circle"&&(S=b.layout.get("circle-sort-key"),M=!S.isConstant());for(const{feature:F,id:U,index:K,sourceLayerIndex:Q}of a){const le=this.layers[0]._featureFilter.needGeometry,de=Ks(F,le);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),de,m))continue;const ge=M?S.evaluate(de,{},m):void 0,be={id:U,properties:F.properties,type:F.type,sourceLayerIndex:Q,index:K,geometry:le?de.geometry:Xs(F),patterns:{},sortKey:ge};k.push(be)}M&&k.sort((F,U)=>F.sortKey-U.sortKey);for(const F of k){const{geometry:U,index:K,sourceLayerIndex:Q}=F,le=a[K].feature;this.addFeature(F,U,K,m),f.featureIndex.insert(le,U,K,Q,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Rt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,f,m,b){for(const k of f)for(const S of k){const M=S.x,F=S.y;if(M<0||M>=jr||F<0||F>=jr)continue;const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),K=U.vertexLength;Au(this.layoutVertexArray,M,F,-1,-1),Au(this.layoutVertexArray,M,F,1,-1),Au(this.layoutVertexArray,M,F,1,1),Au(this.layoutVertexArray,M,F,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{},b)}}function Hc(c,a){for(let f=0;f<c.length;f++)if(Su(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Su(c,a[f]))return!0;return!!ku(c,a)}function Qh(c,a,f){return!!Su(c,a)||!!Np(a,c,f)}function Gc(c,a){if(c.length===1)return v_(a,c[0]);for(let f=0;f<a.length;f++){const m=a[f];for(let b=0;b<m.length;b++)if(Su(c,m[b]))return!0}for(let f=0;f<c.length;f++)if(v_(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(ku(c,a[f]))return!0;return!1}function Wc(c,a,f){if(c.length>1){if(ku(c,a))return!0;for(let m=0;m<a.length;m++)if(Np(a[m],c,f))return!0}for(let m=0;m<c.length;m++)if(Np(c[m],a,f))return!0;return!1}function ku(c,a){if(c.length===0||a.length===0)return!1;for(let f=0;f<c.length-1;f++){const m=c[f],b=c[f+1];for(let k=0;k<a.length-1;k++)if(Zc(m,b,a[k],a[k+1]))return!0}return!1}function Zc(c,a,f,m){return ye(c,f,m)!==ye(a,f,m)&&ye(c,a,f)!==ye(c,a,m)}function Np(c,a,f){const m=f*f;if(a.length===1)return c.distSqr(a[0])<m;for(let b=1;b<a.length;b++)if(y_(c,a[b-1],a[b])<m)return!0;return!1}function y_(c,a,f){const m=a.distSqr(f);if(m===0)return c.distSqr(a);const b=((c.x-a.x)*(f.x-a.x)+(c.y-a.y)*(f.y-a.y))/m;return c.distSqr(b<0?a:b>1?f:f.sub(a)._mult(b)._add(a))}function v_(c,a){let f,m,b,k=!1;for(let S=0;S<c.length;S++){f=c[S];for(let M=0,F=f.length-1;M<f.length;F=M++)m=f[M],b=f[F],m.y>a.y!=b.y>a.y&&a.x<(b.x-m.x)*(a.y-m.y)/(b.y-m.y)+m.x&&(k=!k)}return k}function Su(c,a){let f=!1;for(let m=0,b=c.length-1;m<c.length;b=m++){const k=c[m],S=c[b];k.y>a.y!=S.y>a.y&&a.x<(S.x-k.x)*(a.y-k.y)/(S.y-k.y)+k.x&&(f=!f)}return f}function hx(c,a,f){const m=f[0],b=f[2];if(c.x<m.x&&a.x<m.x||c.x>b.x&&a.x>b.x||c.y<m.y&&a.y<m.y||c.y>b.y&&a.y>b.y)return!1;const k=ye(c,a,f[0]);return k!==ye(c,a,f[1])||k!==ye(c,a,f[2])||k!==ye(c,a,f[3])}function Xc(c,a,f){const m=a.paint.get(c).value;return m.kind==="constant"?m.value:f.programConfigurations.get(a.id).getMaxValue(c)}function ed(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function td(c,a,f,m,b){if(!a[0]&&!a[1])return c;const k=y.convert(a)._mult(b);f==="viewport"&&k._rotate(-m);const S=[];for(let M=0;M<c.length;M++)S.push(c[M].sub(k));return S}let b_,w_;Zt("CircleBucket",Ls,{omit:["layers"]});var dx={get paint(){return w_=w_||new ji({"circle-radius":new dn(he.paint_circle["circle-radius"]),"circle-color":new dn(he.paint_circle["circle-color"]),"circle-blur":new dn(he.paint_circle["circle-blur"]),"circle-opacity":new dn(he.paint_circle["circle-opacity"]),"circle-translate":new un(he.paint_circle["circle-translate"]),"circle-translate-anchor":new un(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new un(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new un(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dn(he.paint_circle["circle-stroke-opacity"])})},get layout(){return b_=b_||new ji({"circle-sort-key":new dn(he.layout_circle["circle-sort-key"])})}},Ui=1e-6,Cu=typeof Float32Array<"u"?Float32Array:Array;function jp(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function x_(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3],M=a[4],F=a[5],U=a[6],K=a[7],Q=a[8],le=a[9],de=a[10],ge=a[11],be=a[12],Ce=a[13],ze=a[14],Ke=a[15],Be=f[0],Ve=f[1],ht=f[2],gt=f[3];return c[0]=Be*m+Ve*M+ht*Q+gt*be,c[1]=Be*b+Ve*F+ht*le+gt*Ce,c[2]=Be*k+Ve*U+ht*de+gt*ze,c[3]=Be*S+Ve*K+ht*ge+gt*Ke,c[4]=(Be=f[4])*m+(Ve=f[5])*M+(ht=f[6])*Q+(gt=f[7])*be,c[5]=Be*b+Ve*F+ht*le+gt*Ce,c[6]=Be*k+Ve*U+ht*de+gt*ze,c[7]=Be*S+Ve*K+ht*ge+gt*Ke,c[8]=(Be=f[8])*m+(Ve=f[9])*M+(ht=f[10])*Q+(gt=f[11])*be,c[9]=Be*b+Ve*F+ht*le+gt*Ce,c[10]=Be*k+Ve*U+ht*de+gt*ze,c[11]=Be*S+Ve*K+ht*ge+gt*Ke,c[12]=(Be=f[12])*m+(Ve=f[13])*M+(ht=f[14])*Q+(gt=f[15])*be,c[13]=Be*b+Ve*F+ht*le+gt*Ce,c[14]=Be*k+Ve*U+ht*de+gt*ze,c[15]=Be*S+Ve*K+ht*ge+gt*Ke,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var Kc,px=x_;function nd(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3];return c[0]=f[0]*m+f[4]*b+f[8]*k+f[12]*S,c[1]=f[1]*m+f[5]*b+f[9]*k+f[13]*S,c[2]=f[2]*m+f[6]*b+f[10]*k+f[14]*S,c[3]=f[3]*m+f[7]*b+f[11]*k+f[15]*S,c}Kc=new Cu(4),Cu!=Float32Array&&(Kc[0]=0,Kc[1]=0,Kc[2]=0,Kc[3]=0);class mx extends To{constructor(a){super(a,dx)}createBucket(a){return new Ls(a)}queryRadius(a){const f=a;return Xc("circle-radius",this,f)+Xc("circle-stroke-width",this,f)+ed(this.paint.get("circle-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M,F){const U=td(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,M),K=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),Q=this.paint.get("circle-pitch-alignment")==="map",le=Q?U:function(ge,be){return ge.map(Ce=>A_(Ce,be))}(U,F),de=Q?K*M:K;for(const ge of b)for(const be of ge){const Ce=Q?be:A_(be,F);let ze=de;const Ke=nd([],[be.x,be.y,0,1],F);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ze*=Ke[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ze*=S.cameraToCenterDistance/Ke[3]),Qh(le,Ce,ze))return!0}return!1}}function A_(c,a){const f=nd([],[c.x,c.y,0,1],a);return new y(f[0]/f[3],f[1]/f[3])}class k_ extends Ls{}let S_;Zt("HeatmapBucket",k_,{omit:["layers"]});var gx={get paint(){return S_=S_||new ji({"heatmap-radius":new dn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new un(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rc(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new un(he.paint_heatmap["heatmap-opacity"])})}};function Up(c,{width:a,height:f},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==a*f*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${a*f*m}`)}else b=new Uint8Array(a*f*m);return c.width=a,c.height=f,c.data=b,c}function C_(c,{width:a,height:f},m){if(a===c.width&&f===c.height)return;const b=Up({},{width:a,height:f},m);Vp(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,f)},m),c.width=a,c.height=f,c.data=b.data}function Vp(c,a,f,m,b,k){if(b.width===0||b.height===0)return a;if(b.width>c.width||b.height>c.height||f.x>c.width-b.width||f.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||m.x>a.width-b.width||m.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,M=a.data;if(S===M)throw new Error("srcData equals dstData, so image is already copied");for(let F=0;F<b.height;F++){const U=((f.y+F)*c.width+f.x)*k,K=((m.y+F)*a.width+m.x)*k;for(let Q=0;Q<b.width*k;Q++)M[K+Q]=S[U+Q]}return a}class Jc{constructor(a,f){Up(this,a,1,f)}resize(a){C_(this,a,1)}clone(){return new Jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Vp(a,f,m,b,k,1)}}class Mo{constructor(a,f){Up(this,a,4,f)}resize(a){C_(this,a,4)}replace(a,f){f?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Mo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Vp(a,f,m,b,k,4)}}function T_(c){const a={},f=c.resolution||256,m=c.clips?c.clips.length:1,b=c.image||new Mo({width:f,height:m});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const k=(S,M,F)=>{a[c.evaluationKey]=F;const U=c.expression.evaluate(a);b.data[S+M+0]=Math.floor(255*U.r/U.a),b.data[S+M+1]=Math.floor(255*U.g/U.a),b.data[S+M+2]=Math.floor(255*U.b/U.a),b.data[S+M+3]=Math.floor(255*U.a)};if(c.clips)for(let S=0,M=0;S<m;++S,M+=4*f)for(let F=0,U=0;F<f;F++,U+=4){const K=F/(f-1),{start:Q,end:le}=c.clips[S];k(M,U,Q*(1-K)+le*K)}else for(let S=0,M=0;S<f;S++,M+=4)k(0,M,S/(f-1));return b}Zt("AlphaImage",Jc),Zt("RGBAImage",Mo);class _x extends To{createBucket(a){return new k_(a)}constructor(a){super(a,gx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=T_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let M_;var yx={get paint(){return M_=M_||new ji({"hillshade-illumination-direction":new un(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new un(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new un(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new un(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new un(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new un(he.paint_hillshade["hillshade-accent-color"])})}};class vx extends To{constructor(a){super(a,yx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const bx=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:wx}=bx;var qp={exports:{}};function rd(c,a,f){f=f||2;var m,b,k,S,M,F,U,K=a&&a.length,Q=K?a[0]*f:c.length,le=E_(c,0,Q,f,!0),de=[];if(!le||le.next===le.prev)return de;if(K&&(le=function(be,Ce,ze,Ke){var Be,Ve,ht,gt=[];for(Be=0,Ve=Ce.length;Be<Ve;Be++)(ht=E_(be,Ce[Be]*Ke,Be<Ve-1?Ce[Be+1]*Ke:be.length,Ke,!1))===ht.next&&(ht.steiner=!0),gt.push(Ex(ht));for(gt.sort(Cx),Be=0;Be<gt.length;Be++)ze=Tx(gt[Be],ze);return ze}(c,a,le,f)),c.length>80*f){m=k=c[0],b=S=c[1];for(var ge=f;ge<Q;ge+=f)(M=c[ge])<m&&(m=M),(F=c[ge+1])<b&&(b=F),M>k&&(k=M),F>S&&(S=F);U=(U=Math.max(k-m,S-b))!==0?32767/U:0}return Yc(le,de,f,m,b,U,0),de}function E_(c,a,f,m,b){var k,S;if(b===Wp(c,a,f,m)>0)for(k=a;k<f;k+=m)S=P_(k,c[k],c[k+1],S);else for(k=f-m;k>=a;k-=m)S=P_(k,c[k],c[k+1],S);return S&&id(S,S.next)&&(ef(S),S=S.next),S}function bl(c,a){if(!c)return c;a||(a=c);var f,m=c;do if(f=!1,m.steiner||!id(m,m.next)&&Hr(m.prev,m,m.next)!==0)m=m.next;else{if(ef(m),(m=a=m.prev)===m.next)break;f=!0}while(f||m!==a);return a}function Yc(c,a,f,m,b,k,S){if(c){!S&&k&&function(K,Q,le,de){var ge=K;do ge.z===0&&(ge.z=Hp(ge.x,ge.y,Q,le,de)),ge.prevZ=ge.prev,ge.nextZ=ge.next,ge=ge.next;while(ge!==K);ge.prevZ.nextZ=null,ge.prevZ=null,function(be){var Ce,ze,Ke,Be,Ve,ht,gt,Ht,sn=1;do{for(ze=be,be=null,Ve=null,ht=0;ze;){for(ht++,Ke=ze,gt=0,Ce=0;Ce<sn&&(gt++,Ke=Ke.nextZ);Ce++);for(Ht=sn;gt>0||Ht>0&&Ke;)gt!==0&&(Ht===0||!Ke||ze.z<=Ke.z)?(Be=ze,ze=ze.nextZ,gt--):(Be=Ke,Ke=Ke.nextZ,Ht--),Ve?Ve.nextZ=Be:be=Be,Be.prevZ=Ve,Ve=Be;ze=Ke}Ve.nextZ=null,sn*=2}while(ht>1)}(ge)}(c,m,b,k);for(var M,F,U=c;c.prev!==c.next;)if(M=c.prev,F=c.next,k?Ax(c,m,b,k):xx(c))a.push(M.i/f|0),a.push(c.i/f|0),a.push(F.i/f|0),ef(c),c=F.next,U=F.next;else if((c=F)===U){S?S===1?Yc(c=kx(bl(c),a,f),a,f,m,b,k,2):S===2&&Sx(c,a,f,m,b,k):Yc(bl(c),a,f,m,b,k,1);break}}}function xx(c){var a=c.prev,f=c,m=c.next;if(Hr(a,f,m)>=0)return!1;for(var b=a.x,k=f.x,S=m.x,M=a.y,F=f.y,U=m.y,K=b<k?b<S?b:S:k<S?k:S,Q=M<F?M<U?M:U:F<U?F:U,le=b>k?b>S?b:S:k>S?k:S,de=M>F?M>U?M:U:F>U?F:U,ge=m.next;ge!==a;){if(ge.x>=K&&ge.x<=le&&ge.y>=Q&&ge.y<=de&&Tu(b,M,k,F,S,U,ge.x,ge.y)&&Hr(ge.prev,ge,ge.next)>=0)return!1;ge=ge.next}return!0}function Ax(c,a,f,m){var b=c.prev,k=c,S=c.next;if(Hr(b,k,S)>=0)return!1;for(var M=b.x,F=k.x,U=S.x,K=b.y,Q=k.y,le=S.y,de=M<F?M<U?M:U:F<U?F:U,ge=K<Q?K<le?K:le:Q<le?Q:le,be=M>F?M>U?M:U:F>U?F:U,Ce=K>Q?K>le?K:le:Q>le?Q:le,ze=Hp(de,ge,a,f,m),Ke=Hp(be,Ce,a,f,m),Be=c.prevZ,Ve=c.nextZ;Be&&Be.z>=ze&&Ve&&Ve.z<=Ke;){if(Be.x>=de&&Be.x<=be&&Be.y>=ge&&Be.y<=Ce&&Be!==b&&Be!==S&&Tu(M,K,F,Q,U,le,Be.x,Be.y)&&Hr(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Ve.x>=de&&Ve.x<=be&&Ve.y>=ge&&Ve.y<=Ce&&Ve!==b&&Ve!==S&&Tu(M,K,F,Q,U,le,Ve.x,Ve.y)&&Hr(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Be&&Be.z>=ze;){if(Be.x>=de&&Be.x<=be&&Be.y>=ge&&Be.y<=Ce&&Be!==b&&Be!==S&&Tu(M,K,F,Q,U,le,Be.x,Be.y)&&Hr(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Ve&&Ve.z<=Ke;){if(Ve.x>=de&&Ve.x<=be&&Ve.y>=ge&&Ve.y<=Ce&&Ve!==b&&Ve!==S&&Tu(M,K,F,Q,U,le,Ve.x,Ve.y)&&Hr(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function kx(c,a,f){var m=c;do{var b=m.prev,k=m.next.next;!id(b,k)&&L_(b,m,m.next,k)&&Qc(b,k)&&Qc(k,b)&&(a.push(b.i/f|0),a.push(m.i/f|0),a.push(k.i/f|0),ef(m),ef(m.next),m=c=k),m=m.next}while(m!==c);return bl(m)}function Sx(c,a,f,m,b,k){var S=c;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Lx(S,M)){var F=I_(S,M);return S=bl(S,S.next),F=bl(F,F.next),Yc(S,a,f,m,b,k,0),void Yc(F,a,f,m,b,k,0)}M=M.next}S=S.next}while(S!==c)}function Cx(c,a){return c.x-a.x}function Tx(c,a){var f=function(b,k){var S,M=k,F=b.x,U=b.y,K=-1/0;do{if(U<=M.y&&U>=M.next.y&&M.next.y!==M.y){var Q=M.x+(U-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(Q<=F&&Q>K&&(K=Q,S=M.x<M.next.x?M:M.next,Q===F))return S}M=M.next}while(M!==k);if(!S)return null;var le,de=S,ge=S.x,be=S.y,Ce=1/0;M=S;do F>=M.x&&M.x>=ge&&F!==M.x&&Tu(U<be?F:K,U,ge,be,U<be?K:F,U,M.x,M.y)&&(le=Math.abs(U-M.y)/(F-M.x),Qc(M,b)&&(le<Ce||le===Ce&&(M.x>S.x||M.x===S.x&&Mx(S,M)))&&(S=M,Ce=le)),M=M.next;while(M!==de);return S}(c,a);if(!f)return a;var m=I_(f,c);return bl(m,m.next),bl(f,f.next)}function Mx(c,a){return Hr(c.prev,c,a.prev)<0&&Hr(a.next,c,c.next)<0}function Hp(c,a,f,m,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Ex(c){var a=c,f=c;do(a.x<f.x||a.x===f.x&&a.y<f.y)&&(f=a),a=a.next;while(a!==c);return f}function Tu(c,a,f,m,b,k,S,M){return(b-S)*(a-M)>=(c-S)*(k-M)&&(c-S)*(m-M)>=(f-S)*(a-M)&&(f-S)*(k-M)>=(b-S)*(m-M)}function Lx(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(f,m){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==m.i&&b.next.i!==m.i&&L_(b,b.next,f,m))return!0;b=b.next}while(b!==f);return!1}(c,a)&&(Qc(c,a)&&Qc(a,c)&&function(f,m){var b=f,k=!1,S=(f.x+m.x)/2,M=(f.y+m.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&S<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(k=!k),b=b.next;while(b!==f);return k}(c,a)&&(Hr(c.prev,c,a.prev)||Hr(c,a.prev,a))||id(c,a)&&Hr(c.prev,c,c.next)>0&&Hr(a.prev,a,a.next)>0)}function Hr(c,a,f){return(a.y-c.y)*(f.x-a.x)-(a.x-c.x)*(f.y-a.y)}function id(c,a){return c.x===a.x&&c.y===a.y}function L_(c,a,f,m){var b=sd(Hr(c,a,f)),k=sd(Hr(c,a,m)),S=sd(Hr(f,m,c)),M=sd(Hr(f,m,a));return b!==k&&S!==M||!(b!==0||!od(c,f,a))||!(k!==0||!od(c,m,a))||!(S!==0||!od(f,c,m))||!(M!==0||!od(f,a,m))}function od(c,a,f){return a.x<=Math.max(c.x,f.x)&&a.x>=Math.min(c.x,f.x)&&a.y<=Math.max(c.y,f.y)&&a.y>=Math.min(c.y,f.y)}function sd(c){return c>0?1:c<0?-1:0}function Qc(c,a){return Hr(c.prev,c,c.next)<0?Hr(c,a,c.next)>=0&&Hr(c,c.prev,a)>=0:Hr(c,a,c.prev)<0||Hr(c,c.next,a)<0}function I_(c,a){var f=new Gp(c.i,c.x,c.y),m=new Gp(a.i,a.x,a.y),b=c.next,k=a.prev;return c.next=a,a.prev=c,f.next=b,b.prev=f,m.next=f,f.prev=m,k.next=m,m.prev=k,m}function P_(c,a,f,m){var b=new Gp(c,a,f);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function ef(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Gp(c,a,f){this.i=c,this.x=a,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(c,a,f,m){for(var b=0,k=a,S=f-m;k<f;k+=m)b+=(c[S]-c[k])*(c[k+1]+c[S+1]),S=k;return b}qp.exports=rd,qp.exports.default=rd,rd.deviation=function(c,a,f,m){var b=a&&a.length,k=Math.abs(Wp(c,0,b?a[0]*f:c.length,f));if(b)for(var S=0,M=a.length;S<M;S++)k-=Math.abs(Wp(c,a[S]*f,S<M-1?a[S+1]*f:c.length,f));var F=0;for(S=0;S<m.length;S+=3){var U=m[S]*f,K=m[S+1]*f,Q=m[S+2]*f;F+=Math.abs((c[U]-c[Q])*(c[K+1]-c[U+1])-(c[U]-c[K])*(c[Q+1]-c[U+1]))}return k===0&&F===0?0:Math.abs((F-k)/k)},rd.flatten=function(c){for(var a=c[0][0].length,f={vertices:[],holes:[],dimensions:a},m=0,b=0;b<c.length;b++){for(var k=0;k<c[b].length;k++)for(var S=0;S<a;S++)f.vertices.push(c[b][k][S]);b>0&&f.holes.push(m+=c[b-1].length)}return f};var z_=d(qp.exports);function Ix(c,a,f,m,b){D_(c,a,f||0,m||c.length-1,b||Px)}function D_(c,a,f,m,b){for(;m>f;){if(m-f>600){var k=m-f+1,S=a-f+1,M=Math.log(k),F=.5*Math.exp(2*M/3),U=.5*Math.sqrt(M*F*(k-F)/k)*(S-k/2<0?-1:1);D_(c,a,Math.max(f,Math.floor(a-S*F/k+U)),Math.min(m,Math.floor(a+(k-S)*F/k+U)),b)}var K=c[a],Q=f,le=m;for(tf(c,f,a),b(c[m],K)>0&&tf(c,f,m);Q<le;){for(tf(c,Q,le),Q++,le--;b(c[Q],K)<0;)Q++;for(;b(c[le],K)>0;)le--}b(c[f],K)===0?tf(c,f,le):tf(c,++le,m),le<=a&&(f=le+1),a<=le&&(m=le-1)}}function tf(c,a,f){var m=c[a];c[a]=c[f],c[f]=m}function Px(c,a){return c<a?-1:c>a?1:0}function Zp(c,a){const f=c.length;if(f<=1)return[c];const m=[];let b,k;for(let S=0;S<f;S++){const M=Oe(c[S]);M!==0&&(c[S].area=Math.abs(M),k===void 0&&(k=M<0),k===M<0?(b&&m.push(b),b=[c[S]]):b.push(c[S]))}if(b&&m.push(b),a>1)for(let S=0;S<m.length;S++)m[S].length<=a||(Ix(m[S],a,1,m[S].length-1,zx),m[S]=m[S].slice(0,a));return m}function zx(c,a){return a.area-c.area}function Xp(c,a,f){const m=f.patternDependencies;let b=!1;for(const k of a){const S=k.paint.get(`${c}-pattern`);S.isConstant()||(b=!0);const M=S.constantOr(null);M&&(b=!0,m[M.to]=!0,m[M.from]=!0)}return b}function Kp(c,a,f,m,b){const k=b.patternDependencies;for(const S of a){const M=S.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let F=M.evaluate({zoom:m-1},f,{},b.availableImages),U=M.evaluate({zoom:m},f,{},b.availableImages),K=M.evaluate({zoom:m+1},f,{},b.availableImages);F=F&&F.name?F.name:F,U=U&&U.name?U.name:U,K=K&&K.name?K.name:K,k[F]=!0,k[U]=!0,k[K]=!0,f.patterns[S.id]={min:F,mid:U,max:K}}}return f}class Jp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new ut,this.indexArray2=new At,this.programConfigurations=new Dr(a.layers,a.zoom),this.segments=new Ft,this.segments2=new Ft,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Xp("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:F,index:U,sourceLayerIndex:K}of a){const Q=this.layers[0]._featureFilter.needGeometry,le=Ks(M,Q);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),le,m))continue;const de=k?b.evaluate(le,{},m,f.availableImages):void 0,ge={id:F,properties:M.properties,type:M.type,sourceLayerIndex:K,index:U,geometry:Q?le.geometry:Xs(M),patterns:{},sortKey:de};S.push(ge)}k&&S.sort((M,F)=>M.sortKey-F.sortKey);for(const M of S){const{geometry:F,index:U,sourceLayerIndex:K}=M;if(this.hasPattern){const Q=Kp("fill",this.layers,M,this.zoom,f);this.patternFeatures.push(Q)}else this.addFeature(M,F,U,m,{});f.featureIndex.insert(a[U].feature,F,U,K,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,wx),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,f,m,b,k){for(const S of Zp(f,500)){let M=0;for(const de of S)M+=de.length;const F=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),U=F.vertexLength,K=[],Q=[];for(const de of S){if(de.length===0)continue;de!==S[0]&&Q.push(K.length/2);const ge=this.segments2.prepareSegment(de.length,this.layoutVertexArray,this.indexArray2),be=ge.vertexLength;this.layoutVertexArray.emplaceBack(de[0].x,de[0].y),this.indexArray2.emplaceBack(be+de.length-1,be),K.push(de[0].x),K.push(de[0].y);for(let Ce=1;Ce<de.length;Ce++)this.layoutVertexArray.emplaceBack(de[Ce].x,de[Ce].y),this.indexArray2.emplaceBack(be+Ce-1,be+Ce),K.push(de[Ce].x),K.push(de[Ce].y);ge.vertexLength+=de.length,ge.primitiveLength+=de.length}const le=z_(K,Q);for(let de=0;de<le.length;de+=3)this.indexArray.emplaceBack(U+le[de],U+le[de+1],U+le[de+2]);F.vertexLength+=M,F.primitiveLength+=le.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}let R_,B_;Zt("FillBucket",Jp,{omit:["layers","patternFeatures"]});var Dx={get paint(){return B_=B_||new ji({"fill-antialias":new un(he.paint_fill["fill-antialias"]),"fill-opacity":new dn(he.paint_fill["fill-opacity"]),"fill-color":new dn(he.paint_fill["fill-color"]),"fill-outline-color":new dn(he.paint_fill["fill-outline-color"]),"fill-translate":new un(he.paint_fill["fill-translate"]),"fill-translate-anchor":new un(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new mu(he.paint_fill["fill-pattern"])})},get layout(){return R_=R_||new ji({"fill-sort-key":new dn(he.layout_fill["fill-sort-key"])})}};class Rx extends To{constructor(a){super(a,Dx)}recalculate(a,f){super.recalculate(a,f);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Jp(a)}queryRadius(){return ed(this.paint.get("fill-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){return Gc(td(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,M),b)}isTileClipped(){return!0}}const Bx=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Fx=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ox}=Bx;var Sa={},$x=p,F_=Mu;function Mu(c,a,f,m,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=b,c.readFields(Nx,this,a)}function Nx(c,a,f){c==1?a.id=f.readVarint():c==2?function(m,b){for(var k=m.readVarint()+m.pos;m.pos<k;){var S=b._keys[m.readVarint()],M=b._values[m.readVarint()];b.properties[S]=M}}(f,a):c==3?a.type=f.readVarint():c==4&&(a._geometry=f.pos)}function jx(c){for(var a,f,m=0,b=0,k=c.length,S=k-1;b<k;S=b++)m+=((f=c[S]).x-(a=c[b]).x)*(a.y+f.y);return m}Mu.types=["Unknown","Point","LineString","Polygon"],Mu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,f=c.readVarint()+c.pos,m=1,b=0,k=0,S=0,M=[];c.pos<f;){if(b<=0){var F=c.readVarint();m=7&F,b=F>>3}if(b--,m===1||m===2)k+=c.readSVarint(),S+=c.readSVarint(),m===1&&(a&&M.push(a),a=[]),a.push(new $x(k,S));else{if(m!==7)throw new Error("unknown command "+m);a&&a.push(a[0].clone())}}return a&&M.push(a),M},Mu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,f=1,m=0,b=0,k=0,S=1/0,M=-1/0,F=1/0,U=-1/0;c.pos<a;){if(m<=0){var K=c.readVarint();f=7&K,m=K>>3}if(m--,f===1||f===2)(b+=c.readSVarint())<S&&(S=b),b>M&&(M=b),(k+=c.readSVarint())<F&&(F=k),k>U&&(U=k);else if(f!==7)throw new Error("unknown command "+f)}return[S,F,M,U]},Mu.prototype.toGeoJSON=function(c,a,f){var m,b,k=this.extent*Math.pow(2,f),S=this.extent*c,M=this.extent*a,F=this.loadGeometry(),U=Mu.types[this.type];function K(de){for(var ge=0;ge<de.length;ge++){var be=de[ge];de[ge]=[360*(be.x+S)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+M)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var Q=[];for(m=0;m<F.length;m++)Q[m]=F[m][0];K(F=Q);break;case 2:for(m=0;m<F.length;m++)K(F[m]);break;case 3:for(F=function(de){var ge=de.length;if(ge<=1)return[de];for(var be,Ce,ze=[],Ke=0;Ke<ge;Ke++){var Be=jx(de[Ke]);Be!==0&&(Ce===void 0&&(Ce=Be<0),Ce===Be<0?(be&&ze.push(be),be=[de[Ke]]):be.push(de[Ke]))}return be&&ze.push(be),ze}(F),m=0;m<F.length;m++)for(b=0;b<F[m].length;b++)K(F[m][b])}F.length===1?F=F[0]:U="Multi"+U;var le={type:"Feature",geometry:{type:U,coordinates:F},properties:this.properties};return"id"in this&&(le.id=this.id),le};var Ux=F_,O_=$_;function $_(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Vx,this,a),this.length=this._features.length}function Vx(c,a,f){c===15?a.version=f.readVarint():c===1?a.name=f.readString():c===5?a.extent=f.readVarint():c===2?a._features.push(f.pos):c===3?a._keys.push(f.readString()):c===4&&a._values.push(function(m){for(var b=null,k=m.readVarint()+m.pos;m.pos<k;){var S=m.readVarint()>>3;b=S===1?m.readString():S===2?m.readFloat():S===3?m.readDouble():S===4?m.readVarint64():S===5?m.readVarint():S===6?m.readSVarint():S===7?m.readBoolean():null}return b}(f))}$_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new Ux(this._pbf,a,this.extent,this._keys,this._values)};var qx=O_;function Hx(c,a,f){if(c===3){var m=new qx(f,f.readVarint()+f.pos);m.length&&(a[m.name]=m)}}Sa.VectorTile=function(c,a){this.layers=c.readFields(Hx,{},a)},Sa.VectorTileFeature=F_,Sa.VectorTileLayer=O_;const Gx=Sa.VectorTileFeature.types,Yp=Math.pow(2,13);function nf(c,a,f,m,b,k,S,M){c.emplaceBack(a,f,2*Math.floor(m*Yp)+S,b*Yp*2,k*Yp*2,Math.round(M))}class Qp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ae,this.centroidVertexArray=new te,this.indexArray=new ut,this.programConfigurations=new Dr(a.layers,a.zoom),this.segments=new Ft,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.features=[],this.hasPattern=Xp("fill-extrusion",this.layers,f);for(const{feature:b,id:k,index:S,sourceLayerIndex:M}of a){const F=this.layers[0]._featureFilter.needGeometry,U=Ks(b,F);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),U,m))continue;const K={id:k,sourceLayerIndex:M,index:S,geometry:F?U.geometry:Xs(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(Kp("fill-extrusion",this.layers,K,this.zoom,f)):this.addFeature(K,K.geometry,S,m,{}),f.featureIndex.insert(b,K.geometry,S,M,this.index,!0)}}addFeatures(a,f,m){for(const b of this.features){const{geometry:k}=b;this.addFeature(b,k,b.index,f,m)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ox),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Fx.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,f,m,b,k){const S={x:0,y:0,vertexCount:0};for(const M of Zp(f,500)){let F=0;for(const ge of M)F+=ge.length;let U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ge of M){if(ge.length===0||Zx(ge))continue;let be=0;for(let Ce=0;Ce<ge.length;Ce++){const ze=ge[Ce];if(Ce>=1){const Ke=ge[Ce-1];if(!Wx(ze,Ke)){U.vertexLength+4>Ft.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Be=ze.sub(Ke)._perp()._unit(),Ve=Ke.dist(ze);be+Ve>32768&&(be=0),nf(this.layoutVertexArray,ze.x,ze.y,Be.x,Be.y,0,0,be),nf(this.layoutVertexArray,ze.x,ze.y,Be.x,Be.y,0,1,be),S.x+=2*ze.x,S.y+=2*ze.y,S.vertexCount+=2,be+=Ve,nf(this.layoutVertexArray,Ke.x,Ke.y,Be.x,Be.y,0,0,be),nf(this.layoutVertexArray,Ke.x,Ke.y,Be.x,Be.y,0,1,be),S.x+=2*Ke.x,S.y+=2*Ke.y,S.vertexCount+=2;const ht=U.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),U.vertexLength+=4,U.primitiveLength+=2}}}}if(U.vertexLength+F>Ft.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),Gx[a.type]!=="Polygon")continue;const K=[],Q=[],le=U.vertexLength;for(const ge of M)if(ge.length!==0){ge!==M[0]&&Q.push(K.length/2);for(let be=0;be<ge.length;be++){const Ce=ge[be];nf(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),S.x+=Ce.x,S.y+=Ce.y,S.vertexCount+=1,K.push(Ce.x),K.push(Ce.y)}}const de=z_(K,Q);for(let ge=0;ge<de.length;ge+=3)this.indexArray.emplaceBack(le+de[ge],le+de[ge+2],le+de[ge+1]);U.primitiveLength+=de.length/3,U.vertexLength+=F}for(let M=0;M<S.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}function Wx(c,a){return c.x===a.x&&(c.x<0||c.x>jr)||c.y===a.y&&(c.y<0||c.y>jr)}function Zx(c){return c.every(a=>a.x<0)||c.every(a=>a.x>jr)||c.every(a=>a.y<0)||c.every(a=>a.y>jr)}let N_;Zt("FillExtrusionBucket",Qp,{omit:["layers","features"]});var Xx={get paint(){return N_=N_||new ji({"fill-extrusion-opacity":new un(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new un(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new un(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mu(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new un(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Kx extends To{constructor(a){super(a,Xx)}createBucket(a){return new Qp(a)}queryRadius(){return ed(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,f,m,b,k,S,M,F){const U=td(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,M),K=this.paint.get("fill-extrusion-height").evaluate(f,m),Q=this.paint.get("fill-extrusion-base").evaluate(f,m),le=function(ge,be,Ce,ze){const Ke=[];for(const Be of ge){const Ve=[Be.x,Be.y,0,1];nd(Ve,Ve,be),Ke.push(new y(Ve[0]/Ve[3],Ve[1]/Ve[3]))}return Ke}(U,F),de=function(ge,be,Ce,ze){const Ke=[],Be=[],Ve=ze[8]*be,ht=ze[9]*be,gt=ze[10]*be,Ht=ze[11]*be,sn=ze[8]*Ce,qt=ze[9]*Ce,Ut=ze[10]*Ce,Bt=ze[11]*Ce;for(const Jt of ge){const Nt=[],It=[];for(const hn of Jt){const ln=hn.x,Fn=hn.y,xr=ze[0]*ln+ze[4]*Fn+ze[12],Er=ze[1]*ln+ze[5]*Fn+ze[13],si=ze[2]*ln+ze[6]*Fn+ze[14],_o=ze[3]*ln+ze[7]*Fn+ze[15],Vi=si+gt,Jr=_o+Ht,_i=xr+sn,xi=Er+qt,qi=si+Ut,Hi=_o+Bt,ai=new y((xr+Ve)/Jr,(Er+ht)/Jr);ai.z=Vi/Jr,Nt.push(ai);const li=new y(_i/Hi,xi/Hi);li.z=qi/Hi,It.push(li)}Ke.push(Nt),Be.push(It)}return[Ke,Be]}(b,Q,K,F);return function(ge,be,Ce){let ze=1/0;Gc(Ce,be)&&(ze=j_(Ce,be[0]));for(let Ke=0;Ke<be.length;Ke++){const Be=be[Ke],Ve=ge[Ke];for(let ht=0;ht<Be.length-1;ht++){const gt=Be[ht],Ht=[gt,Be[ht+1],Ve[ht+1],Ve[ht],gt];Hc(Ce,Ht)&&(ze=Math.min(ze,j_(Ce,Ht)))}}return ze!==1/0&&ze}(de[0],de[1],le)}}function rf(c,a){return c.x*a.x+c.y*a.y}function j_(c,a){if(c.length===1){let f=0;const m=a[f++];let b;for(;!b||m.equals(b);)if(b=a[f++],!b)return 1/0;for(;f<a.length;f++){const k=a[f],S=c[0],M=b.sub(m),F=k.sub(m),U=S.sub(m),K=rf(M,M),Q=rf(M,F),le=rf(F,F),de=rf(U,M),ge=rf(U,F),be=K*le-Q*Q,Ce=(le*de-Q*ge)/be,ze=(K*ge-Q*de)/be,Ke=m.z*(1-Ce-ze)+b.z*Ce+k.z*ze;if(isFinite(Ke))return Ke}return 1/0}{let f=1/0;for(const m of a)f=Math.min(f,m.z);return f}}const Jx=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Yx}=Jx,Qx=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:eA}=Qx,tA=Sa.VectorTileFeature.types,nA=Math.cos(Math.PI/180*37.5),U_=Math.pow(2,14)/.5;class em{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new ve,this.indexArray=new ut,this.programConfigurations=new Dr(a.layers,a.zoom),this.segments=new Ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Xp("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:F,index:U,sourceLayerIndex:K}of a){const Q=this.layers[0]._featureFilter.needGeometry,le=Ks(M,Q);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),le,m))continue;const de=k?b.evaluate(le,{},m):void 0,ge={id:F,properties:M.properties,type:M.type,sourceLayerIndex:K,index:U,geometry:Q?le.geometry:Xs(M),patterns:{},sortKey:de};S.push(ge)}k&&S.sort((M,F)=>M.sortKey-F.sortKey);for(const M of S){const{geometry:F,index:U,sourceLayerIndex:K}=M;if(this.hasPattern){const Q=Kp("line",this.layers,M,this.zoom,f);this.patternFeatures.push(Q)}else this.addFeature(M,F,U,m,{});f.featureIndex.insert(a[U].feature,F,U,K,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,eA)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Yx),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,f,m,b,k){const S=this.layers[0].layout,M=S.get("line-join").evaluate(a,{}),F=S.get("line-cap"),U=S.get("line-miter-limit"),K=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const Q of f)this.addLine(Q,a,M,F,U,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}addLine(a,f,m,b,k,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ze=0;ze<a.length-1;ze++)this.totalDistance+=a[ze].dist(a[ze+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=tA[f.type]==="Polygon";let F=a.length;for(;F>=2&&a[F-1].equals(a[F-2]);)F--;let U=0;for(;U<F-1&&a[U].equals(a[U+1]);)U++;if(F<(M?3:2))return;m==="bevel"&&(k=1.05);const K=this.overscaling<=16?15*jr/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let le,de,ge,be,Ce;this.e1=this.e2=-1,M&&(le=a[F-2],Ce=a[U].sub(le)._unit()._perp());for(let ze=U;ze<F;ze++){if(ge=ze===F-1?M?a[U+1]:void 0:a[ze+1],ge&&a[ze].equals(ge))continue;Ce&&(be=Ce),le&&(de=le),le=a[ze],Ce=ge?ge.sub(le)._unit()._perp():be,be=be||Ce;let Ke=be.add(Ce);Ke.x===0&&Ke.y===0||Ke._unit();const Be=be.x*Ce.x+be.y*Ce.y,Ve=Ke.x*Ce.x+Ke.y*Ce.y,ht=Ve!==0?1/Ve:1/0,gt=2*Math.sqrt(2-2*Ve),Ht=Ve<nA&&de&&ge,sn=be.x*Ce.y-be.y*Ce.x>0;if(Ht&&ze>U){const Bt=le.dist(de);if(Bt>2*K){const Jt=le.sub(le.sub(de)._mult(K/Bt)._round());this.updateDistance(de,Jt),this.addCurrentVertex(Jt,be,0,0,Q),de=Jt}}const qt=de&&ge;let Ut=qt?m:M?"butt":b;if(qt&&Ut==="round"&&(ht<S?Ut="miter":ht<=2&&(Ut="fakeround")),Ut==="miter"&&ht>k&&(Ut="bevel"),Ut==="bevel"&&(ht>2&&(Ut="flipbevel"),ht<k&&(Ut="miter")),de&&this.updateDistance(de,le),Ut==="miter")Ke._mult(ht),this.addCurrentVertex(le,Ke,0,0,Q);else if(Ut==="flipbevel"){if(ht>100)Ke=Ce.mult(-1);else{const Bt=ht*be.add(Ce).mag()/be.sub(Ce).mag();Ke._perp()._mult(Bt*(sn?-1:1))}this.addCurrentVertex(le,Ke,0,0,Q),this.addCurrentVertex(le,Ke.mult(-1),0,0,Q)}else if(Ut==="bevel"||Ut==="fakeround"){const Bt=-Math.sqrt(ht*ht-1),Jt=sn?Bt:0,Nt=sn?0:Bt;if(de&&this.addCurrentVertex(le,be,Jt,Nt,Q),Ut==="fakeround"){const It=Math.round(180*gt/Math.PI/20);for(let hn=1;hn<It;hn++){let ln=hn/It;if(ln!==.5){const xr=ln-.5;ln+=ln*xr*(ln-1)*((1.0904+Be*(Be*(3.55645-1.43519*Be)-3.2452))*xr*xr+(.848013+Be*(.215638*Be-1.06021)))}const Fn=Ce.sub(be)._mult(ln)._add(be)._unit()._mult(sn?-1:1);this.addHalfVertex(le,Fn.x,Fn.y,!1,sn,0,Q)}}ge&&this.addCurrentVertex(le,Ce,-Jt,-Nt,Q)}else if(Ut==="butt")this.addCurrentVertex(le,Ke,0,0,Q);else if(Ut==="square"){const Bt=de?1:-1;this.addCurrentVertex(le,Ke,Bt,Bt,Q)}else Ut==="round"&&(de&&(this.addCurrentVertex(le,be,0,0,Q),this.addCurrentVertex(le,be,1,1,Q,!0)),ge&&(this.addCurrentVertex(le,Ce,-1,-1,Q,!0),this.addCurrentVertex(le,Ce,0,0,Q)));if(Ht&&ze<F-1){const Bt=le.dist(ge);if(Bt>2*K){const Jt=le.add(ge.sub(le)._mult(K/Bt)._round());this.updateDistance(le,Jt),this.addCurrentVertex(Jt,Ce,0,0,Q),le=Jt}}}}addCurrentVertex(a,f,m,b,k,S=!1){const M=f.y*b-f.x,F=-f.y-f.x*b;this.addHalfVertex(a,f.x+f.y*m,f.y-f.x*m,S,!1,m,k),this.addHalfVertex(a,M,F,S,!0,-b,k),this.distance>U_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,f,m,b,k,S))}addHalfVertex({x:a,y:f},m,b,k,S,M,F){const U=.5*(this.lineClips?this.scaledDistance*(U_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(k?1:0),(f<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(M===0?0:M<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const K=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,K),F.primitiveLength++),S?this.e2=K:this.e1=K}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,f){this.distance+=a.dist(f),this.updateScaledDistance()}}let V_,q_;Zt("LineBucket",em,{omit:["layers","patternFeatures"]});var H_={get paint(){return q_=q_||new ji({"line-opacity":new dn(he.paint_line["line-opacity"]),"line-color":new dn(he.paint_line["line-color"]),"line-translate":new un(he.paint_line["line-translate"]),"line-translate-anchor":new un(he.paint_line["line-translate-anchor"]),"line-width":new dn(he.paint_line["line-width"]),"line-gap-width":new dn(he.paint_line["line-gap-width"]),"line-offset":new dn(he.paint_line["line-offset"]),"line-blur":new dn(he.paint_line["line-blur"]),"line-dasharray":new dl(he.paint_line["line-dasharray"]),"line-pattern":new mu(he.paint_line["line-pattern"]),"line-gradient":new Rc(he.paint_line["line-gradient"])})},get layout(){return V_=V_||new ji({"line-cap":new un(he.layout_line["line-cap"]),"line-join":new dn(he.layout_line["line-join"]),"line-miter-limit":new un(he.layout_line["line-miter-limit"]),"line-round-limit":new un(he.layout_line["line-round-limit"]),"line-sort-key":new dn(he.layout_line["line-sort-key"])})}};class rA extends dn{possiblyEvaluate(a,f){return f=new Tr(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(a,f)}evaluate(a,f,m,b){return f=H({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(a,f,m,b)}}let ad;class iA extends To{constructor(a){super(a,H_),this.gradientVersion=0,ad||(ad=new rA(H_.paint.properties["line-width"].specification),ad.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof ol,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,f){super.recalculate(a,f),this.paint._values["line-floorwidth"]=ad.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new em(a)}queryRadius(a){const f=a,m=G_(Xc("line-width",this,f),Xc("line-gap-width",this,f)),b=Xc("line-offset",this,f);return m/2+Math.abs(b)+ed(this.paint.get("line-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){const F=td(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,M),U=M/2*G_(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),K=this.paint.get("line-offset").evaluate(f,m);return K&&(b=function(Q,le){const de=[];for(let ge=0;ge<Q.length;ge++){const be=Q[ge],Ce=[];for(let ze=0;ze<be.length;ze++){const Ke=be[ze-1],Be=be[ze],Ve=be[ze+1],ht=ze===0?new y(0,0):Be.sub(Ke)._unit()._perp(),gt=ze===be.length-1?new y(0,0):Ve.sub(Be)._unit()._perp(),Ht=ht._add(gt)._unit(),sn=Ht.x*gt.x+Ht.y*gt.y;sn!==0&&Ht._mult(1/sn),Ce.push(Ht._mult(le)._add(Be))}de.push(Ce)}return de}(b,K*M)),function(Q,le,de){for(let ge=0;ge<le.length;ge++){const be=le[ge];if(Q.length>=3){for(let Ce=0;Ce<be.length;Ce++)if(Su(Q,be[Ce]))return!0}if(Wc(Q,be,de))return!0}return!1}(F,b,U)}isTileClipped(){return!0}}function G_(c,a){return a>0?a+2*c:c}const oA=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),sA=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const aA=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W_=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lA=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function uA(c,a,f){return c.sections.forEach(m=>{m.text=function(b,k,S){const M=k.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Ts.applyArabicShaping&&(b=Ts.applyArabicShaping(b)),b}(m.text,a,f)}),c}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const of={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var oi=24,Z_=dr,X_=function(c,a,f,m,b){var k,S,M=8*b-m-1,F=(1<<M)-1,U=F>>1,K=-7,Q=f?b-1:0,le=f?-1:1,de=c[a+Q];for(Q+=le,k=de&(1<<-K)-1,de>>=-K,K+=M;K>0;k=256*k+c[a+Q],Q+=le,K-=8);for(S=k&(1<<-K)-1,k>>=-K,K+=m;K>0;S=256*S+c[a+Q],Q+=le,K-=8);if(k===0)k=1-U;else{if(k===F)return S?NaN:1/0*(de?-1:1);S+=Math.pow(2,m),k-=U}return(de?-1:1)*S*Math.pow(2,k-m)},K_=function(c,a,f,m,b,k){var S,M,F,U=8*k-b-1,K=(1<<U)-1,Q=K>>1,le=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=m?0:k-1,ge=m?1:-1,be=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=K):(S=Math.floor(Math.log(a)/Math.LN2),a*(F=Math.pow(2,-S))<1&&(S--,F*=2),(a+=S+Q>=1?le/F:le*Math.pow(2,1-Q))*F>=2&&(S++,F/=2),S+Q>=K?(M=0,S=K):S+Q>=1?(M=(a*F-1)*Math.pow(2,b),S+=Q):(M=a*Math.pow(2,Q-1)*Math.pow(2,b),S=0));b>=8;c[f+de]=255&M,de+=ge,M/=256,b-=8);for(S=S<<b|M,U+=b;U>0;c[f+de]=255&S,de+=ge,S/=256,U-=8);c[f+de-ge]|=128*be};function dr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}dr.Varint=0,dr.Fixed64=1,dr.Bytes=2,dr.Fixed32=5;var tm=4294967296,J_=1/tm,Y_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Js(c){return c.type===dr.Bytes?c.readVarint()+c.pos:c.pos+1}function Eu(c,a,f){return f?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function Q_(c,a,f){var m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));f.realloc(m);for(var b=f.pos-1;b>=c;b--)f.buf[b+m]=f.buf[b]}function cA(c,a){for(var f=0;f<c.length;f++)a.writeVarint(c[f])}function fA(c,a){for(var f=0;f<c.length;f++)a.writeSVarint(c[f])}function hA(c,a){for(var f=0;f<c.length;f++)a.writeFloat(c[f])}function dA(c,a){for(var f=0;f<c.length;f++)a.writeDouble(c[f])}function pA(c,a){for(var f=0;f<c.length;f++)a.writeBoolean(c[f])}function mA(c,a){for(var f=0;f<c.length;f++)a.writeFixed32(c[f])}function gA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed32(c[f])}function _A(c,a){for(var f=0;f<c.length;f++)a.writeFixed64(c[f])}function yA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed64(c[f])}function ld(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Lu(c,a,f){c[f]=a,c[f+1]=a>>>8,c[f+2]=a>>>16,c[f+3]=a>>>24}function e0(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}dr.prototype={destroy:function(){this.buf=null},readFields:function(c,a,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),b=m>>3,k=this.pos;this.type=7&m,c(b,a,this),this.pos===k&&this.skip(m)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=ld(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=e0(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=ld(this.buf,this.pos)+ld(this.buf,this.pos+4)*tm;return this.pos+=8,c},readSFixed64:function(){var c=ld(this.buf,this.pos)+e0(this.buf,this.pos+4)*tm;return this.pos+=8,c},readFloat:function(){var c=X_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=X_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,f,m=this.buf;return a=127&(f=m[this.pos++]),f<128?a:(a|=(127&(f=m[this.pos++]))<<7,f<128?a:(a|=(127&(f=m[this.pos++]))<<14,f<128?a:(a|=(127&(f=m[this.pos++]))<<21,f<128?a:function(b,k,S){var M,F,U=S.buf;if(M=(112&(F=U[S.pos++]))>>4,F<128||(M|=(127&(F=U[S.pos++]))<<3,F<128)||(M|=(127&(F=U[S.pos++]))<<10,F<128)||(M|=(127&(F=U[S.pos++]))<<17,F<128)||(M|=(127&(F=U[S.pos++]))<<24,F<128)||(M|=(1&(F=U[S.pos++]))<<31,F<128))return Eu(b,M,k);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(f=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&Y_?function(f,m,b){return Y_.decode(f.subarray(m,b))}(this.buf,a,c):function(f,m,b){for(var k="",S=m;S<b;){var M,F,U,K=f[S],Q=null,le=K>239?4:K>223?3:K>191?2:1;if(S+le>b)break;le===1?K<128&&(Q=K):le===2?(192&(M=f[S+1]))==128&&(Q=(31&K)<<6|63&M)<=127&&(Q=null):le===3?(F=f[S+2],(192&(M=f[S+1]))==128&&(192&F)==128&&((Q=(15&K)<<12|(63&M)<<6|63&F)<=2047||Q>=55296&&Q<=57343)&&(Q=null)):le===4&&(F=f[S+2],U=f[S+3],(192&(M=f[S+1]))==128&&(192&F)==128&&(192&U)==128&&((Q=(15&K)<<18|(63&M)<<12|(63&F)<<6|63&U)<=65535||Q>=1114112)&&(Q=null)),Q===null?(Q=65533,le=1):Q>65535&&(Q-=65536,k+=String.fromCharCode(Q>>>10&1023|55296),Q=56320|1023&Q),k+=String.fromCharCode(Q),S+=le}return k}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==dr.Bytes)return c.push(this.readVarint(a));var f=Js(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==dr.Bytes)return c.push(this.readSVarint());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==dr.Bytes)return c.push(this.readBoolean());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==dr.Bytes)return c.push(this.readFloat());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==dr.Bytes)return c.push(this.readDouble());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==dr.Bytes)return c.push(this.readFixed32());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==dr.Bytes)return c.push(this.readSFixed32());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==dr.Bytes)return c.push(this.readFixed64());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==dr.Bytes)return c.push(this.readSFixed64());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===dr.Varint)for(;this.buf[this.pos++]>127;);else if(a===dr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===dr.Fixed32)this.pos+=4;else{if(a!==dr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var f=new Uint8Array(a);f.set(this.buf),this.buf=f,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Lu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Lu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Lu(this.buf,-1&c,this.pos),Lu(this.buf,Math.floor(c*J_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Lu(this.buf,-1&c,this.pos),Lu(this.buf,Math.floor(c*J_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,f){var m,b;if(a>=0?(m=a%4294967296|0,b=a/4294967296|0):(b=~(-a/4294967296),4294967295^(m=~(-a%4294967296))?m=m+1|0:(m=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(k,S,M){M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,M.buf[M.pos]=127&(k>>>=7)}(m,0,f),function(k,S){var M=(7&k)<<4;S.buf[S.pos++]|=M|((k>>>=3)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k)))))}(b,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(m,b,k){for(var S,M,F=0;F<b.length;F++){if((S=b.charCodeAt(F))>55295&&S<57344){if(!M){S>56319||F+1===b.length?(m[k++]=239,m[k++]=191,m[k++]=189):M=S;continue}if(S<56320){m[k++]=239,m[k++]=191,m[k++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(m[k++]=239,m[k++]=191,m[k++]=189,M=null);S<128?m[k++]=S:(S<2048?m[k++]=S>>6|192:(S<65536?m[k++]=S>>12|224:(m[k++]=S>>18|240,m[k++]=S>>12&63|128),m[k++]=S>>6&63|128),m[k++]=63&S|128)}return k}(this.buf,c,this.pos);var f=this.pos-a;f>=128&&Q_(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),K_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),K_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var f=0;f<a;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,a){this.pos++;var f=this.pos;c(a,this);var m=this.pos-f;m>=128&&Q_(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,a,f){this.writeTag(c,dr.Bytes),this.writeRawMessage(a,f)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,cA,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,fA,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,pA,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,hA,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,dA,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,mA,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,gA,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,_A,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,yA,a)},writeBytesField:function(c,a){this.writeTag(c,dr.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,dr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,dr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,dr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,dr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,dr.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,dr.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,dr.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,dr.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,dr.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var nm=d(Z_);const rm=3;function vA(c,a,f){c===1&&f.readMessage(bA,a)}function bA(c,a,f){if(c===3){const{id:m,bitmap:b,width:k,height:S,left:M,top:F,advance:U}=f.readMessage(wA,{});a.push({id:m,bitmap:new Jc({width:k+2*rm,height:S+2*rm},b),metrics:{width:k,height:S,left:M,top:F,advance:U}})}}function wA(c,a,f){c===1?a.id=f.readVarint():c===2?a.bitmap=f.readBytes():c===3?a.width=f.readVarint():c===4?a.height=f.readVarint():c===5?a.left=f.readSVarint():c===6?a.top=f.readSVarint():c===7&&(a.advance=f.readVarint())}const t0=rm;function n0(c){let a=0,f=0;for(const S of c)a+=S.w*S.h,f=Math.max(f,S.w);c.sort((S,M)=>M.h-S.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),f),h:1/0}];let b=0,k=0;for(const S of c)for(let M=m.length-1;M>=0;M--){const F=m[M];if(!(S.w>F.w||S.h>F.h)){if(S.x=F.x,S.y=F.y,k=Math.max(k,S.y+S.h),b=Math.max(b,S.x+S.w),S.w===F.w&&S.h===F.h){const U=m.pop();M<m.length&&(m[M]=U)}else S.h===F.h?(F.x+=S.w,F.w-=S.w):S.w===F.w?(F.y+=S.h,F.h-=S.h):(m.push({x:F.x+S.w,y:F.y,w:F.w-S.w,h:S.h}),F.y+=S.h,F.h-=S.h);break}}return{w:b,h:k,fill:a/(b*k)||0}}const oo=1;class im{constructor(a,{pixelRatio:f,version:m,stretchX:b,stretchY:k,content:S}){this.paddedRect=a,this.pixelRatio=f,this.stretchX=b,this.stretchY=k,this.content=S,this.version=m}get tl(){return[this.paddedRect.x+oo,this.paddedRect.y+oo]}get br(){return[this.paddedRect.x+this.paddedRect.w-oo,this.paddedRect.y+this.paddedRect.h-oo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*oo)/this.pixelRatio,(this.paddedRect.h-2*oo)/this.pixelRatio]}}class r0{constructor(a,f){const m={},b={};this.haveRenderCallbacks=[];const k=[];this.addImages(a,m,k),this.addImages(f,b,k);const{w:S,h:M}=n0(k),F=new Mo({width:S||1,height:M||1});for(const U in a){const K=a[U],Q=m[U].paddedRect;Mo.copy(K.data,F,{x:0,y:0},{x:Q.x+oo,y:Q.y+oo},K.data)}for(const U in f){const K=f[U],Q=b[U].paddedRect,le=Q.x+oo,de=Q.y+oo,ge=K.data.width,be=K.data.height;Mo.copy(K.data,F,{x:0,y:0},{x:le,y:de},K.data),Mo.copy(K.data,F,{x:0,y:be-1},{x:le,y:de-1},{width:ge,height:1}),Mo.copy(K.data,F,{x:0,y:0},{x:le,y:de+be},{width:ge,height:1}),Mo.copy(K.data,F,{x:ge-1,y:0},{x:le-1,y:de},{width:1,height:be}),Mo.copy(K.data,F,{x:0,y:0},{x:le+ge,y:de},{width:1,height:be})}this.image=F,this.iconPositions=m,this.patternPositions=b}addImages(a,f,m){for(const b in a){const k=a[b],S={x:0,y:0,w:k.data.width+2*oo,h:k.data.height+2*oo};m.push(S),f[b]=new im(S,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,f){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),f),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),f)}patchUpdatedImage(a,f,m){if(!a||!f||a.version===f.version)return;a.version=f.version;const[b,k]=a.tl;m.update(f.data,void 0,{x:b,y:k})}}var Ca;Zt("ImagePosition",im),Zt("ImageAtlas",r0),u.ah=void 0,(Ca=u.ah||(u.ah={}))[Ca.none=0]="none",Ca[Ca.horizontal=1]="horizontal",Ca[Ca.vertical=2]="vertical",Ca[Ca.horizontalOnly=3]="horizontalOnly";const sf=-17;class af{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,f){const m=new af;return m.scale=a||1,m.fontStack=f,m}static forImage(a){const f=new af;return f.imageName=a,f}}class Iu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,f){const m=new Iu;for(let b=0;b<a.sections.length;b++){const k=a.sections[b];k.image?m.addImageSection(k):m.addTextSection(k,f)}return m}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let f="";for(let m=0;m<a.length;m++){const b=a.charCodeAt(m+1)||null,k=a.charCodeAt(m-1)||null;f+=b&&zc(b)&&!of[a[m+1]]||k&&zc(k)&&!of[a[m-1]]||!of[a[m]]?a[m]:of[a[m]]}return f}(this.text)}trim(){let a=0;for(let m=0;m<this.text.length&&cd[this.text.charCodeAt(m)];m++)a++;let f=this.text.length;for(let m=this.text.length-1;m>=0&&m>=a&&cd[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)}substring(a,f){const m=new Iu;return m.text=this.text.substring(a,f),m.sectionIndex=this.sectionIndex.slice(a,f),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,f)=>Math.max(a,this.sections[f].scale),0)}addTextSection(a,f){this.text+=a.text,this.sections.push(af.forText(a.scale,a.fontStack||f));const m=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(m)}addImageSection(a){const f=a.image?a.image.name:"";if(f.length===0)return void Ee("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(af.forImage(f)),this.sectionIndex.push(this.sections.length-1)):Ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ud(c,a,f,m,b,k,S,M,F,U,K,Q,le,de,ge,be){const Ce=Iu.fromFeature(c,b);let ze;Q===u.ah.vertical&&Ce.verticalizePunctuation();const{processBidirectionalText:Ke,processStyledBidirectionalText:Be}=Ts;if(Ke&&Ce.sections.length===1){ze=[];const gt=Ke(Ce.toString(),om(Ce,U,k,a,m,de,ge));for(const Ht of gt){const sn=new Iu;sn.text=Ht,sn.sections=Ce.sections;for(let qt=0;qt<Ht.length;qt++)sn.sectionIndex.push(0);ze.push(sn)}}else if(Be){ze=[];const gt=Be(Ce.text,Ce.sectionIndex,om(Ce,U,k,a,m,de,ge));for(const Ht of gt){const sn=new Iu;sn.text=Ht[0],sn.sectionIndex=Ht[1],sn.sections=Ce.sections,ze.push(sn)}}else ze=function(gt,Ht){const sn=[],qt=gt.text;let Ut=0;for(const Bt of Ht)sn.push(gt.substring(Ut,Bt)),Ut=Bt;return Ut<qt.length&&sn.push(gt.substring(Ut,qt.length)),sn}(Ce,om(Ce,U,k,a,m,de,ge));const Ve=[],ht={positionedLines:Ve,text:Ce.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:Q,iconsInText:!1,verticalizable:!1};return function(gt,Ht,sn,qt,Ut,Bt,Jt,Nt,It,hn,ln,Fn){let xr=0,Er=sf,si=0,_o=0;const Vi=Nt==="right"?1:Nt==="left"?0:.5;let Jr=0;for(const ai of Ut){ai.trim();const li=ai.getMaxScale(),Li=(li-1)*oi,Gi={positionedGlyphs:[],lineOffset:0};gt.positionedLines[Jr]=Gi;const Ii=Gi.positionedGlyphs;let so=0;if(!ai.length()){Er+=Bt,++Jr;continue}for(let ui=0;ui<ai.length();ui++){const Hn=ai.getSection(ui),Pi=ai.getSectionIndex(ui),Ai=ai.getCharCode(ui);let ci=0,Zo=null,fs=null,hs=null,Ys=oi;const Xo=!(It===u.ah.horizontal||!ln&&!hu(Ai)||ln&&(cd[Ai]||(_i=Ai,Vt.Arabic(_i)||Vt["Arabic Supplement"](_i)||Vt["Arabic Extended-A"](_i)||Vt["Arabic Presentation Forms-A"](_i)||Vt["Arabic Presentation Forms-B"](_i))));if(Hn.imageName){const Lo=qt[Hn.imageName];if(!Lo)continue;hs=Hn.imageName,gt.iconsInText=gt.iconsInText||!0,fs=Lo.paddedRect;const lo=Lo.displaySize;Hn.scale=Hn.scale*oi/Fn,Zo={width:lo[0],height:lo[1],left:oo,top:-t0,advance:Xo?lo[1]:lo[0]},ci=Li+(oi-lo[1]*Hn.scale),Ys=Zo.advance;const Qs=Xo?lo[0]*Hn.scale-oi*li:lo[1]*Hn.scale-oi*li;Qs>0&&Qs>so&&(so=Qs)}else{const Lo=sn[Hn.fontStack],lo=Lo&&Lo[Ai];if(lo&&lo.rect)fs=lo.rect,Zo=lo.metrics;else{const Qs=Ht[Hn.fontStack],hf=Qs&&Qs[Ai];if(!hf)continue;Zo=hf.metrics}ci=(li-Hn.scale)*oi}Xo?(gt.verticalizable=!0,Ii.push({glyph:Ai,imageName:hs,x:xr,y:Er+ci,vertical:Xo,scale:Hn.scale,fontStack:Hn.fontStack,sectionIndex:Pi,metrics:Zo,rect:fs}),xr+=Ys*Hn.scale+hn):(Ii.push({glyph:Ai,imageName:hs,x:xr,y:Er+ci,vertical:Xo,scale:Hn.scale,fontStack:Hn.fontStack,sectionIndex:Pi,metrics:Zo,rect:fs}),xr+=Zo.advance*Hn.scale+hn)}Ii.length!==0&&(si=Math.max(xr-hn,si),kA(Ii,0,Ii.length-1,Vi,so)),xr=0;const ao=Bt*li+so;Gi.lineOffset=Math.max(so,Li),Er+=ao,_o=Math.max(ao,_o),++Jr}var _i;const xi=Er-sf,{horizontalAlign:qi,verticalAlign:Hi}=sm(Jt);(function(ai,li,Li,Gi,Ii,so,ao,ui,Hn){const Pi=(li-Li)*Ii;let Ai=0;Ai=so!==ao?-ui*Gi-sf:(-Gi*Hn+.5)*ao;for(const ci of ai)for(const Zo of ci.positionedGlyphs)Zo.x+=Pi,Zo.y+=Ai})(gt.positionedLines,Vi,qi,Hi,si,_o,Bt,xi,Ut.length),gt.top+=-Hi*xi,gt.bottom=gt.top+xi,gt.left+=-qi*si,gt.right=gt.left+si}(ht,a,f,m,ze,S,M,F,Q,U,le,be),!function(gt){for(const Ht of gt)if(Ht.positionedGlyphs.length!==0)return!1;return!0}(Ve)&&ht}const cd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},xA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function i0(c,a,f,m,b,k){if(a.imageName){const S=m[a.imageName];return S?S.displaySize[0]*a.scale*oi/k+b:0}{const S=f[a.fontStack],M=S&&S[c];return M?M.metrics.advance*a.scale+b:0}}function o0(c,a,f,m){const b=Math.pow(c-a,2);return m?c<a?b/2:2*b:b+Math.abs(f)*f}function AA(c,a,f){let m=0;return c===10&&(m-=1e4),f&&(m+=150),c!==40&&c!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function s0(c,a,f,m,b,k){let S=null,M=o0(a,f,b,k);for(const F of m){const U=o0(a-F.x,f,b,k)+F.badness;U<=M&&(S=F,M=U)}return{index:c,x:a,priorBreak:S,badness:M}}function a0(c){return c?a0(c.priorBreak).concat(c.index):[]}function om(c,a,f,m,b,k,S){if(k!=="point")return[];if(!c)return[];const M=[],F=function(le,de,ge,be,Ce,ze){let Ke=0;for(let Be=0;Be<le.length();Be++){const Ve=le.getSection(Be);Ke+=i0(le.getCharCode(Be),Ve,be,Ce,de,ze)}return Ke/Math.max(1,Math.ceil(Ke/ge))}(c,a,f,m,b,S),U=c.text.indexOf("​")>=0;let K=0;for(let le=0;le<c.length();le++){const de=c.getSection(le),ge=c.getCharCode(le);if(cd[ge]||(K+=i0(ge,de,m,b,a,S)),le<c.length()-1){const be=!((Q=ge)<11904||!(Vt["Bopomofo Extended"](Q)||Vt.Bopomofo(Q)||Vt["CJK Compatibility Forms"](Q)||Vt["CJK Compatibility Ideographs"](Q)||Vt["CJK Compatibility"](Q)||Vt["CJK Radicals Supplement"](Q)||Vt["CJK Strokes"](Q)||Vt["CJK Symbols and Punctuation"](Q)||Vt["CJK Unified Ideographs Extension A"](Q)||Vt["CJK Unified Ideographs"](Q)||Vt["Enclosed CJK Letters and Months"](Q)||Vt["Halfwidth and Fullwidth Forms"](Q)||Vt.Hiragana(Q)||Vt["Ideographic Description Characters"](Q)||Vt["Kangxi Radicals"](Q)||Vt["Katakana Phonetic Extensions"](Q)||Vt.Katakana(Q)||Vt["Vertical Forms"](Q)||Vt["Yi Radicals"](Q)||Vt["Yi Syllables"](Q)));(xA[ge]||be||de.imageName)&&M.push(s0(le+1,K,F,M,AA(ge,c.getCharCode(le+1),be&&U),!1))}}var Q;return a0(s0(c.length(),K,F,M,0,!0))}function sm(c){let a=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:a,verticalAlign:f}}function kA(c,a,f,m,b){if(!m&&!b)return;const k=c[f],S=(c[f].x+k.metrics.advance*k.scale)*m;for(let M=a;M<=f;M++)c[M].x-=S,c[M].y+=b}function SA(c,a,f){const{horizontalAlign:m,verticalAlign:b}=sm(f),k=a[0]-c.displaySize[0]*m,S=a[1]-c.displaySize[1]*b;return{image:c,top:S,bottom:S+c.displaySize[1],left:k,right:k+c.displaySize[0]}}function l0(c,a,f,m,b,k){const S=c.image;let M;if(S.content){const Ce=S.content,ze=S.pixelRatio||1;M=[Ce[0]/ze,Ce[1]/ze,S.displaySize[0]-Ce[2]/ze,S.displaySize[1]-Ce[3]/ze]}const F=a.left*k,U=a.right*k;let K,Q,le,de;f==="width"||f==="both"?(de=b[0]+F-m[3],Q=b[0]+U+m[1]):(de=b[0]+(F+U-S.displaySize[0])/2,Q=de+S.displaySize[0]);const ge=a.top*k,be=a.bottom*k;return f==="height"||f==="both"?(K=b[1]+ge-m[0],le=b[1]+be+m[2]):(K=b[1]+(ge+be-S.displaySize[1])/2,le=K+S.displaySize[1]),{image:S,top:K,right:Q,bottom:le,left:de,collisionPadding:M}}const lf=255,Is=128,Ta=lf*Is;function u0(c,a){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Tr(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=f;let k=0;for(;k<m.length&&m[k]<=c;)k++;k=Math.max(0,k-1);let S=k;for(;S<m.length&&m[S]<c+1;)S++;S=Math.min(m.length-1,S);const M=m[k],F=m[S];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:F,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:F,minSize:f.evaluate(new Tr(M)),maxSize:f.evaluate(new Tr(F)),interpolationType:b}}}function am(c,a,f){let m="never";const b=c.get(a);return b?m=b:c.get(f)&&(m="always"),m}const CA=Sa.VectorTileFeature.types,TA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fd(c,a,f,m,b,k,S,M,F,U,K,Q,le){const de=M?Math.min(Ta,Math.round(M[0])):0,ge=M?Math.min(Ta,Math.round(M[1])):0;c.emplaceBack(a,f,Math.round(32*m),Math.round(32*b),k,S,(de<<1)+(F?1:0),ge,16*U,16*K,256*Q,256*le)}function lm(c,a,f){c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f)}function MA(c){for(const a of c.sections)if($p(a.text))return!0;return!1}class um{constructor(a){this.layoutVertexArray=new rt,this.indexArray=new ut,this.programConfigurations=a,this.segments=new Ft,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Ge,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,f,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,oA.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,sA.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,TA,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",um);class cm{constructor(a,f,m){this.layoutVertexArray=new a,this.layoutAttributes=f,this.indexArray=new m,this.segments=new Ft,this.collisionVertexArray=new at}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,aA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",cm);class Pu{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(S=>S.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jp([]),this.placementViewportMatrix=jp([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=u0(this.zoom,f["text-size"]),this.iconSizeData=u0(this.zoom,f["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),k=m.get("symbol-z-order");this.canOverlap=am(m,"text-overlap","text-allow-overlap")!=="never"||am(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=k!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(k==="viewport-y"||k==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(S=>u.ah[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=a.sourceID}createArrays(){this.text=new um(new Dr(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new um(new Dr(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new A,this.lineVertexArray=new P,this.symbolInstances=new v,this.textAnchorOffsets=new $}calculateGlyphDependencies(a,f,m,b,k){for(let S=0;S<a.length;S++)if(f[a.charCodeAt(S)]=!0,(m||b)&&k){const M=of[a.charAt(S)];M&&(f[M.charCodeAt(0)]=!0)}}populate(a,f,m){const b=this.layers[0],k=b.layout,S=k.get("text-font"),M=k.get("text-field"),F=k.get("icon-image"),U=(M.value.kind!=="constant"||M.value.value instanceof eo&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),K=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,Q=k.get("symbol-sort-key");if(this.features=[],!U&&!K)return;const le=f.iconDependencies,de=f.glyphDependencies,ge=f.availableImages,be=new Tr(this.zoom);for(const{feature:Ce,id:ze,index:Ke,sourceLayerIndex:Be}of a){const Ve=b._featureFilter.needGeometry,ht=Ks(Ce,Ve);if(!b._featureFilter.filter(be,ht,m))continue;let gt,Ht;if(Ve||(ht.geometry=Xs(Ce)),U){const qt=b.getValueAndResolveTokens("text-field",ht,m,ge),Ut=eo.factory(qt),Bt=this.hasRTLText=this.hasRTLText||MA(Ut);(!Bt||Ts.getRTLTextPluginStatus()==="unavailable"||Bt&&Ts.isParsed())&&(gt=uA(Ut,b,ht))}if(K){const qt=b.getValueAndResolveTokens("icon-image",ht,m,ge);Ht=qt instanceof po?qt:po.fromString(qt)}if(!gt&&!Ht)continue;const sn=this.sortFeaturesByKey?Q.evaluate(ht,{},m):void 0;if(this.features.push({id:ze,text:gt,icon:Ht,index:Ke,sourceLayerIndex:Be,geometry:ht.geometry,properties:Ce.properties,type:CA[Ce.type],sortKey:sn}),Ht&&(le[Ht.name]=!0),gt){const qt=S.evaluate(ht,{},m).join(","),Ut=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Bt of gt.sections)if(Bt.image)le[Bt.image.name]=!0;else{const Jt=Aa(gt.toString()),Nt=Bt.fontStack||qt,It=de[Nt]=de[Nt]||{};this.calculateGlyphDependencies(Bt.text,It,Ut,this.allowVerticalPlacement,Jt)}}}k.get("symbol-placement")==="line"&&(this.features=function(Ce){const ze={},Ke={},Be=[];let Ve=0;function ht(qt){Be.push(Ce[qt]),Ve++}function gt(qt,Ut,Bt){const Jt=Ke[qt];return delete Ke[qt],Ke[Ut]=Jt,Be[Jt].geometry[0].pop(),Be[Jt].geometry[0]=Be[Jt].geometry[0].concat(Bt[0]),Jt}function Ht(qt,Ut,Bt){const Jt=ze[Ut];return delete ze[Ut],ze[qt]=Jt,Be[Jt].geometry[0].shift(),Be[Jt].geometry[0]=Bt[0].concat(Be[Jt].geometry[0]),Jt}function sn(qt,Ut,Bt){const Jt=Bt?Ut[0][Ut[0].length-1]:Ut[0][0];return`${qt}:${Jt.x}:${Jt.y}`}for(let qt=0;qt<Ce.length;qt++){const Ut=Ce[qt],Bt=Ut.geometry,Jt=Ut.text?Ut.text.toString():null;if(!Jt){ht(qt);continue}const Nt=sn(Jt,Bt),It=sn(Jt,Bt,!0);if(Nt in Ke&&It in ze&&Ke[Nt]!==ze[It]){const hn=Ht(Nt,It,Bt),ln=gt(Nt,It,Be[hn].geometry);delete ze[Nt],delete Ke[It],Ke[sn(Jt,Be[ln].geometry,!0)]=ln,Be[hn].geometry=null}else Nt in Ke?gt(Nt,It,Bt):It in ze?Ht(Nt,It,Bt):(ht(qt),ze[Nt]=Ve-1,Ke[It]=Ve-1)}return Be.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,ze)=>Ce.sortKey-ze.sortKey)}update(a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,f,this.layers,m),this.icon.programConfigurations.updatePaintArrays(a,f,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,f){const m=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(f[a.segment+1]),k=a.dist(f[a.segment]);const S={};for(let M=a.segment+1;M<f.length;M++)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:b},M<f.length-1&&(b+=f[M+1].dist(f[M]));for(let M=a.segment||0;M>=0;M--)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:k},M>0&&(k+=f[M-1].dist(f[M]));for(let M=0;M<f.length;M++){const F=S[M];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,f,m,b,k,S,M,F,U,K,Q,le){const de=a.indexArray,ge=a.layoutVertexArray,be=a.segments.prepareSegment(4*f.length,ge,de,this.canOverlap?S.sortKey:void 0),Ce=this.glyphOffsetArray.length,ze=be.vertexLength,Ke=this.allowVerticalPlacement&&M===u.ah.vertical?Math.PI/2:0,Be=S.text&&S.text.sections;for(let Ve=0;Ve<f.length;Ve++){const{tl:ht,tr:gt,bl:Ht,br:sn,tex:qt,pixelOffsetTL:Ut,pixelOffsetBR:Bt,minFontScaleX:Jt,minFontScaleY:Nt,glyphOffset:It,isSDF:hn,sectionIndex:ln}=f[Ve],Fn=be.vertexLength,xr=It[1];fd(ge,F.x,F.y,ht.x,xr+ht.y,qt.x,qt.y,m,hn,Ut.x,Ut.y,Jt,Nt),fd(ge,F.x,F.y,gt.x,xr+gt.y,qt.x+qt.w,qt.y,m,hn,Bt.x,Ut.y,Jt,Nt),fd(ge,F.x,F.y,Ht.x,xr+Ht.y,qt.x,qt.y+qt.h,m,hn,Ut.x,Bt.y,Jt,Nt),fd(ge,F.x,F.y,sn.x,xr+sn.y,qt.x+qt.w,qt.y+qt.h,m,hn,Bt.x,Bt.y,Jt,Nt),lm(a.dynamicLayoutVertexArray,F,Ke),de.emplaceBack(Fn,Fn+1,Fn+2),de.emplaceBack(Fn+1,Fn+2,Fn+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),Ve!==f.length-1&&ln===f[Ve+1].sectionIndex||a.programConfigurations.populatePaintArrays(ge.length,S,S.index,{},le,Be&&Be[ln])}a.placedSymbolArray.emplaceBack(F.x,F.y,Ce,this.glyphOffsetArray.length-Ce,ze,U,K,F.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],M,0,!1,0,Q)}_addCollisionDebugVertex(a,f,m,b,k,S){return f.emplaceBack(0,0),a.emplaceBack(m.x,m.y,b,k,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(a,f,m,b,k,S,M){const F=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),U=F.vertexLength,K=k.layoutVertexArray,Q=k.collisionVertexArray,le=M.anchorX,de=M.anchorY;this._addCollisionDebugVertex(K,Q,S,le,de,new y(a,f)),this._addCollisionDebugVertex(K,Q,S,le,de,new y(m,f)),this._addCollisionDebugVertex(K,Q,S,le,de,new y(m,b)),this._addCollisionDebugVertex(K,Q,S,le,de,new y(a,b)),F.vertexLength+=4;const ge=k.indexArray;ge.emplaceBack(U,U+1),ge.emplaceBack(U+1,U+2),ge.emplaceBack(U+2,U+3),ge.emplaceBack(U+3,U),F.primitiveLength+=4}addDebugCollisionBoxes(a,f,m,b){for(let k=a;k<f;k++){const S=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,b?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cm(ot,W_.members,At),this.iconCollisionBox=new cm(ot,W_.members,At);for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(a,f,m,b,k,S,M,F,U){const K={};for(let Q=f;Q<m;Q++){const le=a.get(Q);K.textBox={x1:le.x1,y1:le.y1,x2:le.x2,y2:le.y2,anchorPointX:le.anchorPointX,anchorPointY:le.anchorPointY},K.textFeatureIndex=le.featureIndex;break}for(let Q=b;Q<k;Q++){const le=a.get(Q);K.verticalTextBox={x1:le.x1,y1:le.y1,x2:le.x2,y2:le.y2,anchorPointX:le.anchorPointX,anchorPointY:le.anchorPointY},K.verticalTextFeatureIndex=le.featureIndex;break}for(let Q=S;Q<M;Q++){const le=a.get(Q);K.iconBox={x1:le.x1,y1:le.y1,x2:le.x2,y2:le.y2,anchorPointX:le.anchorPointX,anchorPointY:le.anchorPointY},K.iconFeatureIndex=le.featureIndex;break}for(let Q=F;Q<U;Q++){const le=a.get(Q);K.verticalIconBox={x1:le.x1,y1:le.y1,x2:le.x2,y2:le.y2,anchorPointX:le.anchorPointX,anchorPointY:le.anchorPointY},K.verticalIconFeatureIndex=le.featureIndex;break}return K}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,f){const m=a.placedSymbolArray.get(f),b=m.vertexStartIndex+4*m.numGlyphs;for(let k=m.vertexStartIndex;k<b;k+=4)a.indexArray.emplaceBack(k,k+1,k+2),a.indexArray.emplaceBack(k+1,k+2,k+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(a),m=Math.cos(a),b=[],k=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const F=this.symbolInstances.get(M);b.push(0|Math.round(f*F.anchorX+m*F.anchorY)),k.push(F.featureIndex)}return S.sort((M,F)=>b[M]-b[F]||k[F]-k[M]),S}addToSortKeyRanges(a,f){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===f?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const m=this.symbolInstances.get(f);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,k,S)=>{b>=0&&S.indexOf(b)===k&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let c0,f0;Zt("SymbolBucket",Pu,{omit:["layers","collisionBoxArray","features","compareText"]}),Pu.MAX_GLYPHS=65535,Pu.addDynamicAttributes=lm;var fm={get paint(){return f0=f0||new ji({"icon-opacity":new dn(he.paint_symbol["icon-opacity"]),"icon-color":new dn(he.paint_symbol["icon-color"]),"icon-halo-color":new dn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new dn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new un(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new un(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new dn(he.paint_symbol["text-opacity"]),"text-color":new dn(he.paint_symbol["text-color"],{runtimeType:Dt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new dn(he.paint_symbol["text-halo-color"]),"text-halo-width":new dn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new dn(he.paint_symbol["text-halo-blur"]),"text-translate":new un(he.paint_symbol["text-translate"]),"text-translate-anchor":new un(he.paint_symbol["text-translate-anchor"])})},get layout(){return c0=c0||new ji({"symbol-placement":new un(he.layout_symbol["symbol-placement"]),"symbol-spacing":new un(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new un(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new un(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new un(he.layout_symbol["icon-allow-overlap"]),"icon-overlap":new un(he.layout_symbol["icon-overlap"]),"icon-ignore-placement":new un(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new un(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new un(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new dn(he.layout_symbol["icon-size"]),"icon-text-fit":new un(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new un(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new dn(he.layout_symbol["icon-image"]),"icon-rotate":new dn(he.layout_symbol["icon-rotate"]),"icon-padding":new dn(he.layout_symbol["icon-padding"]),"icon-keep-upright":new un(he.layout_symbol["icon-keep-upright"]),"icon-offset":new dn(he.layout_symbol["icon-offset"]),"icon-anchor":new dn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new un(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new un(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new un(he.layout_symbol["text-rotation-alignment"]),"text-field":new dn(he.layout_symbol["text-field"]),"text-font":new dn(he.layout_symbol["text-font"]),"text-size":new dn(he.layout_symbol["text-size"]),"text-max-width":new dn(he.layout_symbol["text-max-width"]),"text-line-height":new un(he.layout_symbol["text-line-height"]),"text-letter-spacing":new dn(he.layout_symbol["text-letter-spacing"]),"text-justify":new dn(he.layout_symbol["text-justify"]),"text-radial-offset":new dn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new un(he.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new dn(he.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new dn(he.layout_symbol["text-anchor"]),"text-max-angle":new un(he.layout_symbol["text-max-angle"]),"text-writing-mode":new un(he.layout_symbol["text-writing-mode"]),"text-rotate":new dn(he.layout_symbol["text-rotate"]),"text-padding":new un(he.layout_symbol["text-padding"]),"text-keep-upright":new un(he.layout_symbol["text-keep-upright"]),"text-transform":new dn(he.layout_symbol["text-transform"]),"text-offset":new dn(he.layout_symbol["text-offset"]),"text-allow-overlap":new un(he.layout_symbol["text-allow-overlap"]),"text-overlap":new un(he.layout_symbol["text-overlap"]),"text-ignore-placement":new un(he.layout_symbol["text-ignore-placement"]),"text-optional":new un(he.layout_symbol["text-optional"])})}};class h0{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Vn,this.defaultValue=a}evaluate(a){if(a.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(a.formattedSection))return f.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",h0,{omit:["defaultValue"]});class hd extends To{constructor(a){super(a,fm)}recalculate(a,f){if(super.recalculate(a,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const k of m)b.indexOf(k)<0&&b.push(k);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,f,m,b){const k=this.layout.get(a).evaluate(f,{},m,b),S=this._unevaluatedLayout._values[a];return S.isDataDriven()||gr(S.value)||!k?k:function(M,F){return F.replace(/{([^{}]+)}/g,(U,K)=>M&&K in M?String(M[K]):"")}(f.properties,k)}createBucket(a){return new Pu(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of fm.paint.overridableProperties){if(!hd.hasPaintOverride(this.layout,a))continue;const f=this.paint.get(a),m=new h0(f),b=new wr(m,f.property.specification);let k=null;k=f.value.kind==="constant"||f.value.kind==="source"?new tu("source",b):new kc("composite",b,f.value.zoomStops),this.paint._values[a]=new Co(f.property,k,f.parameters)}}_handleOverridablePaintPropertyUpdate(a,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&hd.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,f){const m=a.get("text-field"),b=fm.paint.properties[f];let k=!1;const S=M=>{for(const F of M)if(b.overrides&&b.overrides.hasOverride(F))return void(k=!0)};if(m.value.kind==="constant"&&m.value.value instanceof eo)S(m.value.value.sections);else if(m.value.kind==="source"){const M=U=>{k||(U instanceof xs&&Wr(U.value)===lr?S(U.value.sections):U instanceof Ql?S(U.sections):U.eachChild(M))},F=m.value;F._styleExpression&&M(F._styleExpression.expression)}return k}}let d0;var EA={get paint(){return d0=d0||new ji({"background-color":new un(he.paint_background["background-color"]),"background-pattern":new dl(he.paint_background["background-pattern"]),"background-opacity":new un(he.paint_background["background-opacity"])})}};class LA extends To{constructor(a){super(a,EA)}}let p0;var IA={get paint(){return p0=p0||new ji({"raster-opacity":new un(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new un(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new un(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new un(he.paint_raster["raster-brightness-max"]),"raster-saturation":new un(he.paint_raster["raster-saturation"]),"raster-contrast":new un(he.paint_raster["raster-contrast"]),"raster-resampling":new un(he.paint_raster["raster-resampling"]),"raster-fade-duration":new un(he.paint_raster["raster-fade-duration"])})}};class PA extends To{constructor(a){super(a,IA)}}class zA extends To{constructor(a){super(a,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class DA{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const hm=63710088e-1;class Ma{constructor(a,f){if(isNaN(a)||isNaN(f))throw new Error(`Invalid LngLat object: (${a}, ${f})`);if(this.lng=+a,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ma(q(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const f=Math.PI/180,m=this.lat*f,b=a.lat*f,k=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((a.lng-this.lng)*f);return hm*Math.acos(Math.min(k,1))}static convert(a){if(a instanceof Ma)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ma(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ma(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const m0=2*Math.PI*hm;function g0(c){return m0*Math.cos(c*Math.PI/180)}function _0(c){return(180+c)/360}function y0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function v0(c,a){return c/g0(a)}function dm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class dd{constructor(a,f,m=0){this.x=+a,this.y=+f,this.z=+m}static fromLngLat(a,f=0){const m=Ma.convert(a);return new dd(_0(m.lng),y0(m.lat),v0(f,m.lat))}toLngLat(){return new Ma(360*this.x-180,dm(this.y))}toAltitude(){return this.z*g0(dm(this.y))}meterInMercatorCoordinateUnits(){return 1/m0*(a=dm(this.y),1/Math.cos(a*Math.PI/180));var a}}function b0(c,a,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[c*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class pm{constructor(a,f,m){if(a<0||a>25||m<0||m>=Math.pow(2,a)||f<0||f>=Math.pow(2,a))throw new Error(`x=${f}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=f,this.y=m,this.key=uf(0,a,a,f,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,f,m){const b=(S=this.y,M=this.z,F=b0(256*(k=this.x),256*(S=Math.pow(2,M)-S-1),M),U=b0(256*(k+1),256*(S+1),M),F[0]+","+F[1]+","+U[0]+","+U[1]);var k,S,M,F,U;const K=function(Q,le,de){let ge,be="";for(let Ce=Q;Ce>0;Ce--)ge=1<<Ce-1,be+=(le&ge?1:0)+(de&ge?2:0);return be}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,K).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const f=this.z-a.z;return f>0&&a.x===this.x>>f&&a.y===this.y>>f}getTilePoint(a){const f=Math.pow(2,this.z);return new y((a.x*f-this.x)*jr,(a.y*f-this.y)*jr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class w0{constructor(a,f){this.wrap=a,this.canonical=f,this.key=uf(a,f.z,f.z,f.x,f.y)}}class Eo{constructor(a,f,m,b,k){if(a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=f,this.canonical=new pm(m,+b,+k),this.key=uf(f,a,m,b,k)}clone(){return new Eo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?new Eo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Eo(a,this.wrap,a,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(a,f){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?uf(this.wrap*+f,a,this.canonical.z,this.canonical.x,this.canonical.y):uf(this.wrap*+f,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const f=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>f&&a.canonical.y===this.canonical.y>>f}children(a){if(this.overscaledZ>=a)return[new Eo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new Eo(f,this.wrap,f,m,b),new Eo(f,this.wrap,f,m+1,b),new Eo(f,this.wrap,f,m,b+1),new Eo(f,this.wrap,f,m+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Eo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Eo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new w0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new dd(a.x-this.wrap,a.y))}}function uf(c,a,f,m,b){(c*=2)<0&&(c=-1*c-1);const k=1<<f;return(k*k*c+k*b+m).toString(36)+f.toString(36)+a.toString(36)}Zt("CanonicalTileID",pm),Zt("OverscaledTileID",Eo,{omit:["posMatrix"]});class x0{constructor(a,f,m,b=1,k=1,S=1,M=0){if(this.uid=a,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Ee(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const F=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=k,this.blueFactor=S,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let U=0;U<F;U++)this.data[this._idx(-1,U)]=this.data[this._idx(0,U)],this.data[this._idx(F,U)]=this.data[this._idx(F-1,U)],this.data[this._idx(U,-1)]=this.data[this._idx(U,0)],this.data[this._idx(U,F)]=this.data[this._idx(U,F-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(F,-1)]=this.data[this._idx(F-1,0)],this.data[this._idx(-1,F)]=this.data[this._idx(0,F-1)],this.data[this._idx(F,F)]=this.data[this._idx(F-1,F-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let U=0;U<F;U++)for(let K=0;K<F;K++){const Q=this.get(U,K);Q>this.max&&(this.max=Q),Q<this.min&&(this.min=Q)}}get(a,f){const m=new Uint8Array(this.data.buffer),b=4*this._idx(a,f);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,f){if(a<-1||a>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(a+1)}unpack(a,f,m){return a*this.redFactor+f*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Mo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,f,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=f*this.dim,k=f*this.dim+this.dim,S=m*this.dim,M=m*this.dim+this.dim;switch(f){case-1:b=k-1;break;case 1:k=b+1}switch(m){case-1:S=M-1;break;case 1:M=S+1}const F=-f*this.dim,U=-m*this.dim;for(let K=S;K<M;K++)for(let Q=b;Q<k;Q++)this.data[this._idx(Q,K)]=a.data[this._idx(Q+F,K+U)]}}Zt("DEMData",x0);class A0{constructor(a){this._stringToNumber={},this._numberToString=[];for(let f=0;f<a.length;f++){const m=a[f];this._stringToNumber[m]=f,this._numberToString[f]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class k0{constructor(a,f,m,b,k){this.type="Feature",this._vectorTileFeature=a,a._z=f,a._x=m,a._y=b,this.properties=a.properties,this.id=k}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(a[f]=this[f]);return a}}class S0{constructor(a,f){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new cl(jr,16,0),this.grid3D=new cl(jr,16,0),this.featureIndexArray=new ee,this.promoteId=f}insert(a,f,m,b,k,S){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,k);const F=S?this.grid3D:this.grid;for(let U=0;U<f.length;U++){const K=f[U],Q=[1/0,1/0,-1/0,-1/0];for(let le=0;le<K.length;le++){const de=K[le];Q[0]=Math.min(Q[0],de.x),Q[1]=Math.min(Q[1],de.y),Q[2]=Math.max(Q[2],de.x),Q[3]=Math.max(Q[3],de.y)}Q[0]<jr&&Q[1]<jr&&Q[2]>=0&&Q[3]>=0&&F.insert(M,Q[0],Q[1],Q[2],Q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Sa.VectorTile(new nm(this.rawTileData)).layers,this.sourceLayerCoder=new A0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,f,m,b){this.loadVTLayers();const k=a.params||{},S=jr/a.tileSize/a.scale,M=ou(k.filter),F=a.queryGeometry,U=a.queryPadding*S,K=T0(F),Q=this.grid.query(K.minX-U,K.minY-U,K.maxX+U,K.maxY+U),le=T0(a.cameraQueryGeometry),de=this.grid3D.query(le.minX-U,le.minY-U,le.maxX+U,le.maxY+U,(Ce,ze,Ke,Be)=>function(Ve,ht,gt,Ht,sn){for(const Ut of Ve)if(ht<=Ut.x&&gt<=Ut.y&&Ht>=Ut.x&&sn>=Ut.y)return!0;const qt=[new y(ht,gt),new y(ht,sn),new y(Ht,sn),new y(Ht,gt)];if(Ve.length>2){for(const Ut of qt)if(Su(Ve,Ut))return!0}for(let Ut=0;Ut<Ve.length-1;Ut++)if(hx(Ve[Ut],Ve[Ut+1],qt))return!0;return!1}(a.cameraQueryGeometry,Ce-U,ze-U,Ke+U,Be+U));for(const Ce of de)Q.push(Ce);Q.sort(RA);const ge={};let be;for(let Ce=0;Ce<Q.length;Ce++){const ze=Q[Ce];if(ze===be)continue;be=ze;const Ke=this.featureIndexArray.get(ze);let Be=null;this.loadMatchingFeature(ge,Ke.bucketIndex,Ke.sourceLayerIndex,Ke.featureIndex,M,k.layers,k.availableImages,f,m,b,(Ve,ht,gt)=>(Be||(Be=Xs(Ve)),ht.queryIntersectsFeature(F,Ve,gt,Be,this.z,a.transform,S,a.pixelPosMatrix)))}return ge}loadMatchingFeature(a,f,m,b,k,S,M,F,U,K,Q){const le=this.bucketLayerIDs[f];if(S&&!function(Ce,ze){for(let Ke=0;Ke<Ce.length;Ke++)if(ze.indexOf(Ce[Ke])>=0)return!0;return!1}(S,le))return;const de=this.sourceLayerCoder.decode(m),ge=this.vtLayers[de].feature(b);if(k.needGeometry){const Ce=Ks(ge,!0);if(!k.filter(new Tr(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!k.filter(new Tr(this.tileID.overscaledZ),ge))return;const be=this.getId(ge,de);for(let Ce=0;Ce<le.length;Ce++){const ze=le[Ce];if(S&&S.indexOf(ze)<0)continue;const Ke=F[ze];if(!Ke)continue;let Be={};be&&K&&(Be=K.getState(Ke.sourceLayer||"_geojsonTileLayer",be));const Ve=H({},U[ze]);Ve.paint=C0(Ve.paint,Ke.paint,ge,Be,M),Ve.layout=C0(Ve.layout,Ke.layout,ge,Be,M);const ht=!Q||Q(ge,Ke,Be);if(!ht)continue;const gt=new k0(ge,this.z,this.x,this.y,be);gt.layer=Ve;let Ht=a[ze];Ht===void 0&&(Ht=a[ze]=[]),Ht.push({featureIndex:b,feature:gt,intersectionZ:ht})}}lookupSymbolFeatures(a,f,m,b,k,S,M,F){const U={};this.loadVTLayers();const K=ou(k);for(const Q of a)this.loadMatchingFeature(U,m,b,Q,K,S,M,F,f);return U}hasLayer(a){for(const f of this.bucketLayerIDs)for(const m of f)if(a===m)return!0;return!1}getId(a,f){let m=a.id;return this.promoteId&&(m=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof m=="boolean"&&(m=Number(m))),m}}function C0(c,a,f,m,b){return _e(c,(k,S)=>{const M=a instanceof hl?a.get(S):null;return M&&M.evaluate?M.evaluate(f,m,b):M})}function T0(c){let a=1/0,f=1/0,m=-1/0,b=-1/0;for(const k of c)a=Math.min(a,k.x),f=Math.min(f,k.y),m=Math.max(m,k.x),b=Math.max(b,k.y);return{minX:a,minY:f,maxX:m,maxY:b}}function RA(c,a){return a-c}function M0(c,a,f,m,b){const k=[];for(let S=0;S<c.length;S++){const M=c[S];let F;for(let U=0;U<M.length-1;U++){let K=M[U],Q=M[U+1];K.x<a&&Q.x<a||(K.x<a?K=new y(a,K.y+(a-K.x)/(Q.x-K.x)*(Q.y-K.y))._round():Q.x<a&&(Q=new y(a,K.y+(a-K.x)/(Q.x-K.x)*(Q.y-K.y))._round()),K.y<f&&Q.y<f||(K.y<f?K=new y(K.x+(f-K.y)/(Q.y-K.y)*(Q.x-K.x),f)._round():Q.y<f&&(Q=new y(K.x+(f-K.y)/(Q.y-K.y)*(Q.x-K.x),f)._round()),K.x>=m&&Q.x>=m||(K.x>=m?K=new y(m,K.y+(m-K.x)/(Q.x-K.x)*(Q.y-K.y))._round():Q.x>=m&&(Q=new y(m,K.y+(m-K.x)/(Q.x-K.x)*(Q.y-K.y))._round()),K.y>=b&&Q.y>=b||(K.y>=b?K=new y(K.x+(b-K.y)/(Q.y-K.y)*(Q.x-K.x),b)._round():Q.y>=b&&(Q=new y(K.x+(b-K.y)/(Q.y-K.y)*(Q.x-K.x),b)._round()),F&&K.equals(F[F.length-1])||(F=[K],k.push(F)),F.push(Q)))))}}return k}Zt("FeatureIndex",S0,{omit:["rawTileData","sourceLayerCoder"]});class Ea extends y{constructor(a,f,m,b){super(a,f),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Ea(this.x,this.y,this.angle,this.segment)}}function E0(c,a,f,m,b){if(a.segment===void 0||f===0)return!0;let k=a,S=a.segment+1,M=0;for(;M>-f/2;){if(S--,S<0)return!1;M-=c[S].dist(k),k=c[S]}M+=c[S].dist(c[S+1]),S++;const F=[];let U=0;for(;M<f/2;){const K=c[S],Q=c[S+1];if(!Q)return!1;let le=c[S-1].angleTo(K)-K.angleTo(Q);for(le=Math.abs((le+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:M,angleDelta:le}),U+=le;M-F[0].distance>m;)U-=F.shift().angleDelta;if(U>b)return!1;S++,M+=K.dist(Q)}return!0}function L0(c){let a=0;for(let f=0;f<c.length-1;f++)a+=c[f].dist(c[f+1]);return a}function I0(c,a,f){return c?.6*a*f:0}function P0(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function BA(c,a,f,m,b,k){const S=I0(f,b,k),M=P0(f,m)*k;let F=0;const U=L0(c)/2;for(let K=0;K<c.length-1;K++){const Q=c[K],le=c[K+1],de=Q.dist(le);if(F+de>U){const ge=(U-F)/de,be=Mi.number(Q.x,le.x,ge),Ce=Mi.number(Q.y,le.y,ge),ze=new Ea(be,Ce,le.angleTo(Q),K);return ze._round(),!S||E0(c,ze,M,S,a)?ze:void 0}F+=de}}function FA(c,a,f,m,b,k,S,M,F){const U=I0(m,k,S),K=P0(m,b),Q=K*S,le=c[0].x===0||c[0].x===F||c[0].y===0||c[0].y===F;return a-Q<a/4&&(a=Q+a/4),z0(c,le?a/2*M%a:(K/2+2*k)*S*M%a,a,U,f,Q,le,!1,F)}function z0(c,a,f,m,b,k,S,M,F){const U=k/2,K=L0(c);let Q=0,le=a-f,de=[];for(let ge=0;ge<c.length-1;ge++){const be=c[ge],Ce=c[ge+1],ze=be.dist(Ce),Ke=Ce.angleTo(be);for(;le+f<Q+ze;){le+=f;const Be=(le-Q)/ze,Ve=Mi.number(be.x,Ce.x,Be),ht=Mi.number(be.y,Ce.y,Be);if(Ve>=0&&Ve<F&&ht>=0&&ht<F&&le-U>=0&&le+U<=K){const gt=new Ea(Ve,ht,Ke,ge);gt._round(),m&&!E0(c,gt,k,m,b)||de.push(gt)}}Q+=ze}return M||de.length||S||(de=z0(c,Q/2,f,m,b,k,S,!0,F)),de}Zt("Anchor",Ea);const zu=oo;function D0(c,a,f,m){const b=[],k=c.image,S=k.pixelRatio,M=k.paddedRect.w-2*zu,F=k.paddedRect.h-2*zu,U=c.right-c.left,K=c.bottom-c.top,Q=k.stretchX||[[0,M]],le=k.stretchY||[[0,F]],de=(Bt,Jt)=>Bt+Jt[1]-Jt[0],ge=Q.reduce(de,0),be=le.reduce(de,0),Ce=M-ge,ze=F-be;let Ke=0,Be=ge,Ve=0,ht=be,gt=0,Ht=Ce,sn=0,qt=ze;if(k.content&&m){const Bt=k.content;Ke=pd(Q,0,Bt[0]),Ve=pd(le,0,Bt[1]),Be=pd(Q,Bt[0],Bt[2]),ht=pd(le,Bt[1],Bt[3]),gt=Bt[0]-Ke,sn=Bt[1]-Ve,Ht=Bt[2]-Bt[0]-Be,qt=Bt[3]-Bt[1]-ht}const Ut=(Bt,Jt,Nt,It)=>{const hn=md(Bt.stretch-Ke,Be,U,c.left),ln=gd(Bt.fixed-gt,Ht,Bt.stretch,ge),Fn=md(Jt.stretch-Ve,ht,K,c.top),xr=gd(Jt.fixed-sn,qt,Jt.stretch,be),Er=md(Nt.stretch-Ke,Be,U,c.left),si=gd(Nt.fixed-gt,Ht,Nt.stretch,ge),_o=md(It.stretch-Ve,ht,K,c.top),Vi=gd(It.fixed-sn,qt,It.stretch,be),Jr=new y(hn,Fn),_i=new y(Er,Fn),xi=new y(Er,_o),qi=new y(hn,_o),Hi=new y(ln/S,xr/S),ai=new y(si/S,Vi/S),li=a*Math.PI/180;if(li){const Ii=Math.sin(li),so=Math.cos(li),ao=[so,-Ii,Ii,so];Jr._matMult(ao),_i._matMult(ao),qi._matMult(ao),xi._matMult(ao)}const Li=Bt.stretch+Bt.fixed,Gi=Jt.stretch+Jt.fixed;return{tl:Jr,tr:_i,bl:qi,br:xi,tex:{x:k.paddedRect.x+zu+Li,y:k.paddedRect.y+zu+Gi,w:Nt.stretch+Nt.fixed-Li,h:It.stretch+It.fixed-Gi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:ai,minFontScaleX:Ht/S/U,minFontScaleY:qt/S/K,isSDF:f}};if(m&&(k.stretchX||k.stretchY)){const Bt=R0(Q,Ce,ge),Jt=R0(le,ze,be);for(let Nt=0;Nt<Bt.length-1;Nt++){const It=Bt[Nt],hn=Bt[Nt+1];for(let ln=0;ln<Jt.length-1;ln++)b.push(Ut(It,Jt[ln],hn,Jt[ln+1]))}}else b.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:F+1}));return b}function pd(c,a,f){let m=0;for(const b of c)m+=Math.max(a,Math.min(f,b[1]))-Math.max(a,Math.min(f,b[0]));return m}function R0(c,a,f){const m=[{fixed:-zu,stretch:0}];for(const[b,k]of c){const S=m[m.length-1];m.push({fixed:b-S.stretch,stretch:S.stretch}),m.push({fixed:b-S.stretch,stretch:S.stretch+(k-b)})}return m.push({fixed:a+zu,stretch:f}),m}function md(c,a,f,m){return c/a*f+m}function gd(c,a,f,m){return c-a*f/m}class _d{constructor(a,f,m,b,k,S,M,F,U,K){if(this.boxStartIndex=a.length,U){let Q=S.top,le=S.bottom;const de=S.collisionPadding;de&&(Q-=de[1],le+=de[3]);let ge=le-Q;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{let Q=S.top*M-F[0],le=S.bottom*M+F[2],de=S.left*M-F[3],ge=S.right*M+F[1];const be=S.collisionPadding;if(be&&(de-=be[0]*M,Q-=be[1]*M,ge+=be[2]*M,le+=be[3]*M),K){const Ce=new y(de,Q),ze=new y(ge,Q),Ke=new y(de,le),Be=new y(ge,le),Ve=K*Math.PI/180;Ce._rotate(Ve),ze._rotate(Ve),Ke._rotate(Ve),Be._rotate(Ve),de=Math.min(Ce.x,ze.x,Ke.x,Be.x),ge=Math.max(Ce.x,ze.x,Ke.x,Be.x),Q=Math.min(Ce.y,ze.y,Ke.y,Be.y),le=Math.max(Ce.y,ze.y,Ke.y,Be.y)}a.emplaceBack(f.x,f.y,de,Q,ge,le,m,b,k)}this.boxEndIndex=a.length}}class OA{constructor(a=[],f=$A){if(this.data=a,this.length=this.data.length,this.compare=f,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:f,compare:m}=this,b=f[a];for(;a>0;){const k=a-1>>1,S=f[k];if(m(b,S)>=0)break;f[a]=S,a=k}f[a]=b}_down(a){const{data:f,compare:m}=this,b=this.length>>1,k=f[a];for(;a<b;){let S=1+(a<<1),M=f[S];const F=S+1;if(F<this.length&&m(f[F],M)<0&&(S=F,M=f[F]),m(M,k)>=0)break;f[a]=M,a=S}f[a]=k}}function $A(c,a){return c<a?-1:c>a?1:0}function NA(c,a=1,f=!1){let m=1/0,b=1/0,k=-1/0,S=-1/0;const M=c[0];for(let de=0;de<M.length;de++){const ge=M[de];(!de||ge.x<m)&&(m=ge.x),(!de||ge.y<b)&&(b=ge.y),(!de||ge.x>k)&&(k=ge.x),(!de||ge.y>S)&&(S=ge.y)}const F=Math.min(k-m,S-b);let U=F/2;const K=new OA([],jA);if(F===0)return new y(m,b);for(let de=m;de<k;de+=F)for(let ge=b;ge<S;ge+=F)K.push(new Du(de+U,ge+U,U,c));let Q=function(de){let ge=0,be=0,Ce=0;const ze=de[0];for(let Ke=0,Be=ze.length,Ve=Be-1;Ke<Be;Ve=Ke++){const ht=ze[Ke],gt=ze[Ve],Ht=ht.x*gt.y-gt.x*ht.y;be+=(ht.x+gt.x)*Ht,Ce+=(ht.y+gt.y)*Ht,ge+=3*Ht}return new Du(be/ge,Ce/ge,0,de)}(c),le=K.length;for(;K.length;){const de=K.pop();(de.d>Q.d||!Q.d)&&(Q=de,f&&console.log("found best %d after %d probes",Math.round(1e4*de.d)/1e4,le)),de.max-Q.d<=a||(U=de.h/2,K.push(new Du(de.p.x-U,de.p.y-U,U,c)),K.push(new Du(de.p.x+U,de.p.y-U,U,c)),K.push(new Du(de.p.x-U,de.p.y+U,U,c)),K.push(new Du(de.p.x+U,de.p.y+U,U,c)),le+=4)}return f&&(console.log(`num probes: ${le}`),console.log(`best distance: ${Q.d}`)),Q.p}function jA(c,a){return a.max-c.max}function Du(c,a,f,m){this.p=new y(c,a),this.h=f,this.d=function(b,k){let S=!1,M=1/0;for(let F=0;F<k.length;F++){const U=k[F];for(let K=0,Q=U.length,le=Q-1;K<Q;le=K++){const de=U[K],ge=U[le];de.y>b.y!=ge.y>b.y&&b.x<(ge.x-de.x)*(b.y-de.y)/(ge.y-de.y)+de.x&&(S=!S),M=Math.min(M,y_(b,de,ge))}}return(S?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var wi;u.ap=void 0,(wi=u.ap||(u.ap={}))[wi.center=1]="center",wi[wi.left=2]="left",wi[wi.right=3]="right",wi[wi.top=4]="top",wi[wi.bottom=5]="bottom",wi[wi["top-left"]=6]="top-left",wi[wi["top-right"]=7]="top-right",wi[wi["bottom-left"]=8]="bottom-left",wi[wi["bottom-right"]=9]="bottom-right";const La=7,mm=Number.POSITIVE_INFINITY;function B0(c,a){return a[1]!==mm?function(f,m,b){let k=0,S=0;switch(m=Math.abs(m),b=Math.abs(b),f){case"top-right":case"top-left":case"top":S=b-La;break;case"bottom-right":case"bottom-left":case"bottom":S=-b+La}switch(f){case"top-right":case"bottom-right":case"right":k=-m;break;case"top-left":case"bottom-left":case"left":k=m}return[k,S]}(c,a[0],a[1]):function(f,m){let b=0,k=0;m<0&&(m=0);const S=m/Math.SQRT2;switch(f){case"top-right":case"top-left":k=S-La;break;case"bottom-right":case"bottom-left":k=-S+La;break;case"bottom":k=-m+La;break;case"top":k=m-La}switch(f){case"top-right":case"bottom-right":b=-S;break;case"top-left":case"bottom-left":b=S;break;case"left":b=m;break;case"right":b=-m}return[b,k]}(c,a[0])}function F0(c,a,f){var m;const b=c.layout,k=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},f);if(k){const M=k.values,F=[];for(let U=0;U<M.length;U+=2){const K=F[U]=M[U],Q=M[U+1].map(le=>le*oi);K.startsWith("top")?Q[1]-=La:K.startsWith("bottom")&&(Q[1]+=La),F[U+1]=Q}return new ho(F)}const S=b.get("text-variable-anchor");if(S){let M;M=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},f)*oi,mm]:b.get("text-offset").evaluate(a,{},f).map(U=>U*oi);const F=[];for(const U of S)F.push(U,B0(U,M));return new ho(F)}return null}function gm(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function UA(c,a,f,m,b,k,S,M,F,U,K){let Q=k.textMaxSize.evaluate(a,{});Q===void 0&&(Q=S);const le=c.layers[0].layout,de=le.get("icon-offset").evaluate(a,{},K),ge=$0(f.horizontal),be=S/24,Ce=c.tilePixelRatio*be,ze=c.tilePixelRatio*Q/24,Ke=c.tilePixelRatio*M,Be=c.tilePixelRatio*le.get("symbol-spacing"),Ve=le.get("text-padding")*c.tilePixelRatio,ht=function(It,hn,ln,Fn=1){const xr=It.get("icon-padding").evaluate(hn,{},ln),Er=xr&&xr.values;return[Er[0]*Fn,Er[1]*Fn,Er[2]*Fn,Er[3]*Fn]}(le,a,K,c.tilePixelRatio),gt=le.get("text-max-angle")/180*Math.PI,Ht=le.get("text-rotation-alignment")!=="viewport"&&le.get("symbol-placement")!=="point",sn=le.get("icon-rotation-alignment")==="map"&&le.get("symbol-placement")!=="point",qt=le.get("symbol-placement"),Ut=Be/2,Bt=le.get("icon-text-fit");let Jt;m&&Bt!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(Jt=l0(m,f.vertical,Bt,le.get("icon-text-fit-padding"),de,be)),ge&&(m=l0(m,ge,Bt,le.get("icon-text-fit-padding"),de,be)));const Nt=(It,hn)=>{hn.x<0||hn.x>=jr||hn.y<0||hn.y>=jr||function(ln,Fn,xr,Er,si,_o,Vi,Jr,_i,xi,qi,Hi,ai,li,Li,Gi,Ii,so,ao,ui,Hn,Pi,Ai,ci,Zo){const fs=ln.addToLineVertexArray(Fn,xr);let hs,Ys,Xo,Lo,lo=0,Qs=0,hf=0,V0=0,km=-1,Sm=-1;const ea={};let q0=Or("");if(ln.allowVerticalPlacement&&Er.vertical){const zi=Jr.layout.get("text-rotate").evaluate(Hn,{},ci)+90;Xo=new _d(_i,Fn,xi,qi,Hi,Er.vertical,ai,li,Li,zi),Vi&&(Lo=new _d(_i,Fn,xi,qi,Hi,Vi,Ii,so,Li,zi))}if(si){const zi=Jr.layout.get("icon-rotate").evaluate(Hn,{}),Io=Jr.layout.get("icon-text-fit")!=="none",wl=D0(si,zi,Ai,Io),ps=Vi?D0(Vi,zi,Ai,Io):void 0;Ys=new _d(_i,Fn,xi,qi,Hi,si,Ii,so,!1,zi),lo=4*wl.length;const xl=ln.iconSizeData;let Ps=null;xl.kind==="source"?(Ps=[Is*Jr.layout.get("icon-size").evaluate(Hn,{})],Ps[0]>Ta&&Ee(`${ln.layerIds[0]}: Value for "icon-size" is >= ${lf}. Reduce your "icon-size".`)):xl.kind==="composite"&&(Ps=[Is*Pi.compositeIconSizes[0].evaluate(Hn,{},ci),Is*Pi.compositeIconSizes[1].evaluate(Hn,{},ci)],(Ps[0]>Ta||Ps[1]>Ta)&&Ee(`${ln.layerIds[0]}: Value for "icon-size" is >= ${lf}. Reduce your "icon-size".`)),ln.addSymbols(ln.icon,wl,Ps,ui,ao,Hn,u.ah.none,Fn,fs.lineStartIndex,fs.lineLength,-1,ci),km=ln.icon.placedSymbolArray.length-1,ps&&(Qs=4*ps.length,ln.addSymbols(ln.icon,ps,Ps,ui,ao,Hn,u.ah.vertical,Fn,fs.lineStartIndex,fs.lineLength,-1,ci),Sm=ln.icon.placedSymbolArray.length-1)}const H0=Object.keys(Er.horizontal);for(const zi of H0){const Io=Er.horizontal[zi];if(!hs){q0=Or(Io.text);const ps=Jr.layout.get("text-rotate").evaluate(Hn,{},ci);hs=new _d(_i,Fn,xi,qi,Hi,Io,ai,li,Li,ps)}const wl=Io.positionedLines.length===1;if(hf+=O0(ln,Fn,Io,_o,Jr,Li,Hn,Gi,fs,Er.vertical?u.ah.horizontal:u.ah.horizontalOnly,wl?H0:[zi],ea,km,Pi,ci),wl)break}Er.vertical&&(V0+=O0(ln,Fn,Er.vertical,_o,Jr,Li,Hn,Gi,fs,u.ah.vertical,["vertical"],ea,Sm,Pi,ci));const HA=hs?hs.boxStartIndex:ln.collisionBoxArray.length,GA=hs?hs.boxEndIndex:ln.collisionBoxArray.length,WA=Xo?Xo.boxStartIndex:ln.collisionBoxArray.length,ZA=Xo?Xo.boxEndIndex:ln.collisionBoxArray.length,XA=Ys?Ys.boxStartIndex:ln.collisionBoxArray.length,KA=Ys?Ys.boxEndIndex:ln.collisionBoxArray.length,JA=Lo?Lo.boxStartIndex:ln.collisionBoxArray.length,YA=Lo?Lo.boxEndIndex:ln.collisionBoxArray.length;let ds=-1;const vd=(zi,Io)=>zi&&zi.circleDiameter?Math.max(zi.circleDiameter,Io):Io;ds=vd(hs,ds),ds=vd(Xo,ds),ds=vd(Ys,ds),ds=vd(Lo,ds);const G0=ds>-1?1:0;G0&&(ds*=Zo/oi),ln.glyphOffsetArray.length>=Pu.MAX_GLYPHS&&Ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hn.sortKey!==void 0&&ln.addToSortKeyRanges(ln.symbolInstances.length,Hn.sortKey);const QA=F0(Jr,Hn,ci),[ek,tk]=function(zi,Io){const wl=zi.length,ps=Io==null?void 0:Io.values;if((ps==null?void 0:ps.length)>0)for(let xl=0;xl<ps.length;xl+=2){const Ps=ps[xl+1];zi.emplaceBack(u.ap[ps[xl]],Ps[0],Ps[1])}return[wl,zi.length]}(ln.textAnchorOffsets,QA);ln.symbolInstances.emplaceBack(Fn.x,Fn.y,ea.right>=0?ea.right:-1,ea.center>=0?ea.center:-1,ea.left>=0?ea.left:-1,ea.vertical||-1,km,Sm,q0,HA,GA,WA,ZA,XA,KA,JA,YA,xi,hf,V0,lo,Qs,G0,0,ai,ds,ek,tk)}(c,hn,It,f,m,b,Jt,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,Ce,[Ve,Ve,Ve,Ve],Ht,F,Ke,ht,sn,de,a,k,U,K,S)};if(qt==="line")for(const It of M0(a.geometry,0,0,jr,jr)){const hn=FA(It,Be,gt,f.vertical||ge,m,24,ze,c.overscaling,jr);for(const ln of hn)ge&&VA(c,ge.text,Ut,ln)||Nt(It,ln)}else if(qt==="line-center"){for(const It of a.geometry)if(It.length>1){const hn=BA(It,gt,f.vertical||ge,m,24,ze);hn&&Nt(It,hn)}}else if(a.type==="Polygon")for(const It of Zp(a.geometry,0)){const hn=NA(It,16);Nt(It[0],new Ea(hn.x,hn.y,0))}else if(a.type==="LineString")for(const It of a.geometry)Nt(It,new Ea(It[0].x,It[0].y,0));else if(a.type==="Point")for(const It of a.geometry)for(const hn of It)Nt([hn],new Ea(hn.x,hn.y,0))}function O0(c,a,f,m,b,k,S,M,F,U,K,Q,le,de,ge){const be=function(Ke,Be,Ve,ht,gt,Ht,sn,qt){const Ut=ht.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Bt=[];for(const Jt of Be.positionedLines)for(const Nt of Jt.positionedGlyphs){if(!Nt.rect)continue;const It=Nt.rect||{};let hn=t0+1,ln=!0,Fn=1,xr=0;const Er=(gt||qt)&&Nt.vertical,si=Nt.metrics.advance*Nt.scale/2;if(qt&&Be.verticalizable&&(xr=Jt.lineOffset/2-(Nt.imageName?-(oi-Nt.metrics.width*Nt.scale)/2:(Nt.scale-1)*oi)),Nt.imageName){const ui=sn[Nt.imageName];ln=ui.sdf,Fn=ui.pixelRatio,hn=oo/Fn}const _o=gt?[Nt.x+si,Nt.y]:[0,0];let Vi=gt?[0,0]:[Nt.x+si+Ve[0],Nt.y+Ve[1]-xr],Jr=[0,0];Er&&(Jr=Vi,Vi=[0,0]);const _i=Nt.metrics.isDoubleResolution?2:1,xi=(Nt.metrics.left-hn)*Nt.scale-si+Vi[0],qi=(-Nt.metrics.top-hn)*Nt.scale+Vi[1],Hi=xi+It.w/_i*Nt.scale/Fn,ai=qi+It.h/_i*Nt.scale/Fn,li=new y(xi,qi),Li=new y(Hi,qi),Gi=new y(xi,ai),Ii=new y(Hi,ai);if(Er){const ui=new y(-si,si-sf),Hn=-Math.PI/2,Pi=oi/2-si,Ai=new y(5-sf-Pi,-(Nt.imageName?Pi:0)),ci=new y(...Jr);li._rotateAround(Hn,ui)._add(Ai)._add(ci),Li._rotateAround(Hn,ui)._add(Ai)._add(ci),Gi._rotateAround(Hn,ui)._add(Ai)._add(ci),Ii._rotateAround(Hn,ui)._add(Ai)._add(ci)}if(Ut){const ui=Math.sin(Ut),Hn=Math.cos(Ut),Pi=[Hn,-ui,ui,Hn];li._matMult(Pi),Li._matMult(Pi),Gi._matMult(Pi),Ii._matMult(Pi)}const so=new y(0,0),ao=new y(0,0);Bt.push({tl:li,tr:Li,bl:Gi,br:Ii,tex:It,writingMode:Be.writingMode,glyphOffset:_o,sectionIndex:Nt.sectionIndex,isSDF:ln,pixelOffsetTL:so,pixelOffsetBR:ao,minFontScaleX:0,minFontScaleY:0})}return Bt}(0,f,M,b,k,S,m,c.allowVerticalPlacement),Ce=c.textSizeData;let ze=null;Ce.kind==="source"?(ze=[Is*b.layout.get("text-size").evaluate(S,{})],ze[0]>Ta&&Ee(`${c.layerIds[0]}: Value for "text-size" is >= ${lf}. Reduce your "text-size".`)):Ce.kind==="composite"&&(ze=[Is*de.compositeTextSizes[0].evaluate(S,{},ge),Is*de.compositeTextSizes[1].evaluate(S,{},ge)],(ze[0]>Ta||ze[1]>Ta)&&Ee(`${c.layerIds[0]}: Value for "text-size" is >= ${lf}. Reduce your "text-size".`)),c.addSymbols(c.text,be,ze,M,k,S,U,a,F.lineStartIndex,F.lineLength,le,ge);for(const Ke of K)Q[Ke]=c.text.placedSymbolArray.length-1;return 4*be.length}function $0(c){for(const a in c)return c[a];return null}function VA(c,a,f,m){const b=c.compareText;if(a in b){const k=b[a];for(let S=k.length-1;S>=0;S--)if(m.dist(k[S])<f)return!0}else b[a]=[];return b[a].push(m),!1}const N0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _m{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,m]=new Uint8Array(a,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const k=N0[15&m];if(!k)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(a,2,1),[M]=new Uint32Array(a,4,1);return new _m(M,S,k,a)}constructor(a,f=64,m=Float64Array,b){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const k=N0.indexOf(this.ArrayType),S=2*a*this.ArrayType.BYTES_PER_ELEMENT,M=a*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-M%8)%8;if(k<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+F,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+F),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+F,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+k]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=a)}add(a,f){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=f,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return ym(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,f,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:k,coords:S,nodeSize:M}=this,F=[0,k.length-1,0],U=[];for(;F.length;){const K=F.pop()||0,Q=F.pop()||0,le=F.pop()||0;if(Q-le<=M){for(let Ce=le;Ce<=Q;Ce++){const ze=S[2*Ce],Ke=S[2*Ce+1];ze>=a&&ze<=m&&Ke>=f&&Ke<=b&&U.push(k[Ce])}continue}const de=le+Q>>1,ge=S[2*de],be=S[2*de+1];ge>=a&&ge<=m&&be>=f&&be<=b&&U.push(k[de]),(K===0?a<=ge:f<=be)&&(F.push(le),F.push(de-1),F.push(1-K)),(K===0?m>=ge:b>=be)&&(F.push(de+1),F.push(Q),F.push(1-K))}return U}within(a,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:k,nodeSize:S}=this,M=[0,b.length-1,0],F=[],U=m*m;for(;M.length;){const K=M.pop()||0,Q=M.pop()||0,le=M.pop()||0;if(Q-le<=S){for(let Ce=le;Ce<=Q;Ce++)U0(k[2*Ce],k[2*Ce+1],a,f)<=U&&F.push(b[Ce]);continue}const de=le+Q>>1,ge=k[2*de],be=k[2*de+1];U0(ge,be,a,f)<=U&&F.push(b[de]),(K===0?a-m<=ge:f-m<=be)&&(M.push(le),M.push(de-1),M.push(1-K)),(K===0?a+m>=ge:f+m>=be)&&(M.push(de+1),M.push(Q),M.push(1-K))}return F}}function ym(c,a,f,m,b,k){if(b-m<=f)return;const S=m+b>>1;j0(c,a,S,m,b,k),ym(c,a,f,m,S-1,1-k),ym(c,a,f,S+1,b,1-k)}function j0(c,a,f,m,b,k){for(;b>m;){if(b-m>600){const U=b-m+1,K=f-m+1,Q=Math.log(U),le=.5*Math.exp(2*Q/3),de=.5*Math.sqrt(Q*le*(U-le)/U)*(K-U/2<0?-1:1);j0(c,a,f,Math.max(m,Math.floor(f-K*le/U+de)),Math.min(b,Math.floor(f+(U-K)*le/U+de)),k)}const S=a[2*f+k];let M=m,F=b;for(cf(c,a,m,f),a[2*b+k]>S&&cf(c,a,m,b);M<F;){for(cf(c,a,M,F),M++,F--;a[2*M+k]<S;)M++;for(;a[2*F+k]>S;)F--}a[2*m+k]===S?cf(c,a,m,F):(F++,cf(c,a,F,b)),F<=f&&(m=F+1),f<=F&&(b=F-1)}}function cf(c,a,f,m){vm(c,f,m),vm(a,2*f,2*m),vm(a,2*f+1,2*m+1)}function vm(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}function U0(c,a,f,m){const b=c-f,k=a-m;return b*b+k*k}var bm;u.bd=void 0,(bm=u.bd||(u.bd={})).create="create",bm.load="load",bm.fullLoad="fullLoad";let yd=null,ff=[];const wm=1e3/60,xm="loadTime",Am="fullLoadTime",qA={mark(c){performance.mark(c)},frame(c){const a=c;yd!=null&&ff.push(a-yd),yd=a},clearMetrics(){yd=null,ff=[],performance.clearMeasures(xm),performance.clearMeasures(Am);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(xm,u.bd.create,u.bd.load),performance.measure(Am,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(xm)[0].duration,a=performance.getEntriesByName(Am)[0].duration,f=ff.length,m=1/(ff.reduce((k,S)=>k+S,0)/f/1e3),b=ff.filter(k=>k>wm).reduce((k,S)=>k+(S-wm)/wm,0);return{loadTime:c,fullLoadTime:a,fps:m,percentDroppedFrames:b/(f+b)*100,totalFrames:f}}};u.$=Ft,u.A=Cu,u.B=function(c){if(De==null){const a=c.navigator?c.navigator.userAgent:null;De=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return De},u.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new DA(()=>this.process()),this.subscription=function(f,m,b,k){return f.addEventListener(m,b,!1),{unsubscribe:()=>{f.removeEventListener(m,b,!1)}}}(this.target,"message",f=>this.receive(f)),this.globalScope=Ue(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((f,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:f,reject:m},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const M={id:b,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const k=[],S=Object.assign(Object.assign({},c),{id:b,sourceMapId:this.mapId,origin:location.origin,data:wa(c.data,k)});this.target.postMessage(S,{transfer:k})})}receive(c){const a=c.data,f=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[f];const m=this.abortControllers[f];return delete this.abortControllers[f],void(m&&m.abort())}if(Ue(self)||a.mustQueue)return this.tasks[f]=a,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return s(this,void 0,void 0,function*(){if(a.type==="<response>"){const b=this.resolveRejects[c];return delete this.resolveRejects[c],b?void(a.error?b.reject(xa(a.error)):b.resolve(xa(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=xa(a.data),m=new AbortController;this.abortControllers[c]=m;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,f,m);this.completeTask(c,null,b)}catch(b){this.completeTask(c,b)}})}completeTask(c,a,f){const m=[];delete this.abortControllers[c];const b={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?wa(a):null,data:wa(f,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=un,u.E=Pt,u.F=function(){var c=new Cu(16);return Cu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=Ot,u.H=function(c,a,f){var m,b,k,S,M,F,U,K,Q,le,de,ge,be=f[0],Ce=f[1],ze=f[2];return a===c?(c[12]=a[0]*be+a[4]*Ce+a[8]*ze+a[12],c[13]=a[1]*be+a[5]*Ce+a[9]*ze+a[13],c[14]=a[2]*be+a[6]*Ce+a[10]*ze+a[14],c[15]=a[3]*be+a[7]*Ce+a[11]*ze+a[15]):(b=a[1],k=a[2],S=a[3],M=a[4],F=a[5],U=a[6],K=a[7],Q=a[8],le=a[9],de=a[10],ge=a[11],c[0]=m=a[0],c[1]=b,c[2]=k,c[3]=S,c[4]=M,c[5]=F,c[6]=U,c[7]=K,c[8]=Q,c[9]=le,c[10]=de,c[11]=ge,c[12]=m*be+M*Ce+Q*ze+a[12],c[13]=b*be+F*Ce+le*ze+a[13],c[14]=k*be+U*Ce+de*ze+a[14],c[15]=S*be+K*Ce+ge*ze+a[15]),c},u.I=im,u.J=function(c,a,f){var m=f[0],b=f[1],k=f[2];return c[0]=a[0]*m,c[1]=a[1]*m,c[2]=a[2]*m,c[3]=a[3]*m,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*k,c[9]=a[9]*k,c[10]=a[10]*k,c[11]=a[11]*k,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.K=x_,u.L=function(c,a){const f={};for(let m=0;m<a.length;m++){const b=a[m];b in c&&(f[b]=c[b])}return f},u.M=Ma,u.N=_0,u.O=y0,u.P=y,u.Q=Eo,u.R=Mo,u.S=I,u.T=Dc,u.U=L,u.V=Ze,u.W=jr,u.X=qr,u.Y=dd,u.Z=class extends Fc{},u._=s,u.a=yt,u.a$=function(c,a,f){return c[0]=a[0]*f[0],c[1]=a[1]*f[1],c[2]=a[2]*f[2],c[3]=a[3]*f[3],c},u.a0=pm,u.a1=_t,u.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(f=>{a.onloadstart=()=>{f(a)};for(const m of c){const b=window.document.createElement("source");fn(m)||(a.crossOrigin="Anonymous"),b.src=m,a.appendChild(b)}})},u.a3=function(){return Z++},u.a4=w,u.a5=Pu,u.a6=ou,u.a7=Ks,u.a8=Tr,u.a9=k0,u.aA=J,u.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let f=[];try{if(!tt(c.version,a.version))return[{command:"setStyle",args:[a]}];tt(c.center,a.center)||f.push({command:"setCenter",args:[a.center]}),tt(c.zoom,a.zoom)||f.push({command:"setZoom",args:[a.zoom]}),tt(c.bearing,a.bearing)||f.push({command:"setBearing",args:[a.bearing]}),tt(c.pitch,a.pitch)||f.push({command:"setPitch",args:[a.pitch]}),tt(c.sprite,a.sprite)||f.push({command:"setSprite",args:[a.sprite]}),tt(c.glyphs,a.glyphs)||f.push({command:"setGlyphs",args:[a.glyphs]}),tt(c.transition,a.transition)||f.push({command:"setTransition",args:[a.transition]}),tt(c.light,a.light)||f.push({command:"setLight",args:[a.light]}),tt(c.terrain,a.terrain)||f.push({command:"setTerrain",args:[a.terrain]}),tt(c.sky,a.sky)||f.push({command:"setSky",args:[a.sky]});const m={},b=[];(function(S,M,F,U){let K;for(K in M=M||{},S=S||{})Object.prototype.hasOwnProperty.call(S,K)&&(Object.prototype.hasOwnProperty.call(M,K)||Un(K,F,U));for(K in M)Object.prototype.hasOwnProperty.call(M,K)&&(Object.prototype.hasOwnProperty.call(S,K)?tt(S[K],M[K])||(S[K].type==="geojson"&&M[K].type==="geojson"&&Wt(S,M,K)?jt(F,{command:"setGeoJSONSourceData",args:[K,M[K].data]}):jn(K,M,F,U)):Gn(K,M,F))})(c.sources,a.sources,b,m);const k=[];c.layers&&c.layers.forEach(S=>{"source"in S&&m[S.source]?f.push({command:"removeLayer",args:[S.id]}):k.push(S)}),f=f.concat(b),function(S,M,F){M=M||[];const U=(S=S||[]).map(ti),K=M.map(ti),Q=S.reduce(Bn,{}),le=M.reduce(Bn,{}),de=U.slice(),ge=Object.create(null);let be,Ce,ze,Ke,Be;for(let Ve=0,ht=0;Ve<U.length;Ve++)be=U[Ve],Object.prototype.hasOwnProperty.call(le,be)?ht++:(jt(F,{command:"removeLayer",args:[be]}),de.splice(de.indexOf(be,ht),1));for(let Ve=0,ht=0;Ve<K.length;Ve++)be=K[K.length-1-Ve],de[de.length-1-Ve]!==be&&(Object.prototype.hasOwnProperty.call(Q,be)?(jt(F,{command:"removeLayer",args:[be]}),de.splice(de.lastIndexOf(be,de.length-ht),1)):ht++,Ke=de[de.length-Ve],jt(F,{command:"addLayer",args:[le[be],Ke]}),de.splice(de.length-Ve,0,be),ge[be]=!0);for(let Ve=0;Ve<K.length;Ve++)if(be=K[Ve],Ce=Q[be],ze=le[be],!ge[be]&&!tt(Ce,ze))if(tt(Ce.source,ze.source)&&tt(Ce["source-layer"],ze["source-layer"])&&tt(Ce.type,ze.type)){for(Be in An(Ce.layout,ze.layout,F,be,null,"setLayoutProperty"),An(Ce.paint,ze.paint,F,be,null,"setPaintProperty"),tt(Ce.filter,ze.filter)||jt(F,{command:"setFilter",args:[be,ze.filter]}),tt(Ce.minzoom,ze.minzoom)&&tt(Ce.maxzoom,ze.maxzoom)||jt(F,{command:"setLayerZoomRange",args:[be,ze.minzoom,ze.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?An(Ce[Be],ze[Be],F,be,Be.slice(6),"setPaintProperty"):tt(Ce[Be],ze[Be])||jt(F,{command:"setLayerProperty",args:[be,Be,ze[Be]]}));for(Be in ze)Object.prototype.hasOwnProperty.call(ze,Be)&&!Object.prototype.hasOwnProperty.call(Ce,Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&(Be.indexOf("paint.")===0?An(Ce[Be],ze[Be],F,be,Be.slice(6),"setPaintProperty"):tt(Ce[Be],ze[Be])||jt(F,{command:"setLayerProperty",args:[be,Be,ze[Be]]}))}else jt(F,{command:"removeLayer",args:[be]}),Ke=de[de.lastIndexOf(be)+1],jt(F,{command:"addLayer",args:[ze,Ke]})}(k,a.layers,f)}catch(m){console.warn("Unable to compute style diff:",m),f=[{command:"setStyle",args:[a]}]}return f},u.aC=function(c){const a=[],f=c.id;return f===void 0&&a.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),a},u.aD=function c(a,f){if(Array.isArray(a)){if(!Array.isArray(f)||a.length!==f.length)return!1;for(let m=0;m<a.length;m++)if(!c(a[m],f[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&f!==null){if(typeof f!="object"||Object.keys(a).length!==Object.keys(f).length)return!1;for(const m in a)if(!c(a[m],f[m]))return!1;return!0}return a===f},u.aE=_e,u.aF=Ie,u.aG=class extends ii{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=io,u.aI=class extends ii{constructor(c,a){super(c,a),this.current=vl}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Go,u.aK=class extends ii{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends ii{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=Ms,u.aN=function(c,a,f,m,b,k,S){var M=1/(a-f),F=1/(m-b),U=1/(k-S);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*F,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*U,c[11]=0,c[12]=(a+f)*M,c[13]=(b+m)*F,c[14]=(S+k)*U,c[15]=1,c},u.aO=ur,u.aP=px,u.aQ=class extends yu{},u.aR=lA,u.aS=class extends vu{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=T_,u.aV=te,u.aW=class extends Vc{},u.aX=ut,u.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},u.aZ=function(c,a){var f=c[0],m=c[1],b=c[2],k=c[3],S=c[4],M=c[5],F=c[6],U=c[7],K=c[8],Q=c[9],le=c[10],de=c[11],ge=c[12],be=c[13],Ce=c[14],ze=c[15],Ke=a[0],Be=a[1],Ve=a[2],ht=a[3],gt=a[4],Ht=a[5],sn=a[6],qt=a[7],Ut=a[8],Bt=a[9],Jt=a[10],Nt=a[11],It=a[12],hn=a[13],ln=a[14],Fn=a[15];return Math.abs(f-Ke)<=Ui*Math.max(1,Math.abs(f),Math.abs(Ke))&&Math.abs(m-Be)<=Ui*Math.max(1,Math.abs(m),Math.abs(Be))&&Math.abs(b-Ve)<=Ui*Math.max(1,Math.abs(b),Math.abs(Ve))&&Math.abs(k-ht)<=Ui*Math.max(1,Math.abs(k),Math.abs(ht))&&Math.abs(S-gt)<=Ui*Math.max(1,Math.abs(S),Math.abs(gt))&&Math.abs(M-Ht)<=Ui*Math.max(1,Math.abs(M),Math.abs(Ht))&&Math.abs(F-sn)<=Ui*Math.max(1,Math.abs(F),Math.abs(sn))&&Math.abs(U-qt)<=Ui*Math.max(1,Math.abs(U),Math.abs(qt))&&Math.abs(K-Ut)<=Ui*Math.max(1,Math.abs(K),Math.abs(Ut))&&Math.abs(Q-Bt)<=Ui*Math.max(1,Math.abs(Q),Math.abs(Bt))&&Math.abs(le-Jt)<=Ui*Math.max(1,Math.abs(le),Math.abs(Jt))&&Math.abs(de-Nt)<=Ui*Math.max(1,Math.abs(de),Math.abs(Nt))&&Math.abs(ge-It)<=Ui*Math.max(1,Math.abs(ge),Math.abs(It))&&Math.abs(be-hn)<=Ui*Math.max(1,Math.abs(be),Math.abs(hn))&&Math.abs(Ce-ln)<=Ui*Math.max(1,Math.abs(Ce),Math.abs(ln))&&Math.abs(ze-Fn)<=Ui*Math.max(1,Math.abs(ze),Math.abs(Fn))},u.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,m,b,k)=>{const S=b||k;return a[m]=!S||S.toLowerCase(),""}),a["max-age"]){const f=parseInt(a["max-age"],10);isNaN(f)?delete a["max-age"]:a["max-age"]=f}return a},u.ab=function(c,a){const f=[];for(const m in c)m in a||f.push(m);return f},u.ac=Y,u.ad=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[0],S=a[1],M=a[2],F=a[3],U=a[4],K=a[5],Q=a[6],le=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=k*b+U*m,c[1]=S*b+K*m,c[2]=M*b+Q*m,c[3]=F*b+le*m,c[4]=U*b-k*m,c[5]=K*b-S*m,c[6]=Q*b-M*m,c[7]=le*b-F*m,c},u.ae=function(c){var a=new Cu(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},u.af=nd,u.ag=function(c,a){let f=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:b,minZoom:k,maxZoom:S}=c,M=b?Y(bi.interpolationFactor(b,a,k,S),0,1):0;c.kind==="camera"?m=Mi.number(c.minSize,c.maxSize,M):f=M}return{uSizeT:f,uSize:m}},u.ai=function(c,{uSize:a,uSizeT:f},{lowerSize:m,upperSize:b}){return c.kind==="source"?m/Is:c.kind==="composite"?Mi.number(m/Is,b/Is,f):a},u.aj=lm,u.ak=function(c,a,f,m){const b=a.y-c.y,k=a.x-c.x,S=m.y-f.y,M=m.x-f.x,F=S*k-M*b;if(F===0)return null;const U=(M*(c.y-f.y)-S*(c.x-f.x))/F;return new y(c.x+U*k,c.y+U*b)},u.al=M0,u.am=Hc,u.an=jp,u.ao=oi,u.aq=am,u.ar=function(c,a){var f=a[0],m=a[1],b=a[2],k=a[3],S=a[4],M=a[5],F=a[6],U=a[7],K=a[8],Q=a[9],le=a[10],de=a[11],ge=a[12],be=a[13],Ce=a[14],ze=a[15],Ke=f*M-m*S,Be=f*F-b*S,Ve=f*U-k*S,ht=m*F-b*M,gt=m*U-k*M,Ht=b*U-k*F,sn=K*be-Q*ge,qt=K*Ce-le*ge,Ut=K*ze-de*ge,Bt=Q*Ce-le*be,Jt=Q*ze-de*be,Nt=le*ze-de*Ce,It=Ke*Nt-Be*Jt+Ve*Bt+ht*Ut-gt*qt+Ht*sn;return It?(c[0]=(M*Nt-F*Jt+U*Bt)*(It=1/It),c[1]=(b*Jt-m*Nt-k*Bt)*It,c[2]=(be*Ht-Ce*gt+ze*ht)*It,c[3]=(le*gt-Q*Ht-de*ht)*It,c[4]=(F*Ut-S*Nt-U*qt)*It,c[5]=(f*Nt-b*Ut+k*qt)*It,c[6]=(Ce*Ve-ge*Ht-ze*Be)*It,c[7]=(K*Ht-le*Ve+de*Be)*It,c[8]=(S*Jt-M*Ut+U*sn)*It,c[9]=(m*Ut-f*Jt-k*sn)*It,c[10]=(ge*gt-be*Ve+ze*Ke)*It,c[11]=(Q*Ve-K*gt-de*Ke)*It,c[12]=(M*qt-S*Bt-F*sn)*It,c[13]=(f*Bt-m*qt+b*sn)*It,c[14]=(be*Be-ge*ht-Ce*Ke)*It,c[15]=(K*ht-Q*Be+le*Ke)*It,c):null},u.as=gm,u.at=sm,u.au=_m,u.av=function(){const c={},a=he.$version;for(const f in he.$root){const m=he.$root[f];if(m.required){let b=null;b=f==="version"?a:m.type==="array"?[]:{},b!=null&&(c[f]=b)}}return c},u.aw=Uh,u.ax=tn,u.ay=function(c){c=c.slice();const a=Object.create(null);for(let f=0;f<c.length;f++)a[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=Pe(c[f],a[c[f].ref]));return c},u.az=function(c){if(c.type==="custom")return new zA(c);switch(c.type){case"background":return new LA(c);case"circle":return new mx(c);case"fill":return new Rx(c);case"fill-extrusion":return new Kx(c);case"heatmap":return new _x(c);case"hillshade":return new vx(c);case"line":return new iA(c);case"raster":return new PA(c);case"symbol":return new hd(c)}},u.b=xe,u.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},u.b1=q,u.b2=w0,u.b3=v0,u.b4=function(c,a,f,m,b){var k,S=1/Math.tan(a/2);return c[0]=S/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,b!=null&&b!==1/0?(c[10]=(b+m)*(k=1/(m-b)),c[14]=2*b*m*k):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[4],S=a[5],M=a[6],F=a[7],U=a[8],K=a[9],Q=a[10],le=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=k*b+U*m,c[5]=S*b+K*m,c[6]=M*b+Q*m,c[7]=F*b+le*m,c[8]=U*b-k*m,c[9]=K*b-S*m,c[10]=Q*b-M*m,c[11]=le*b-F*m,c},u.b6=B,u.b7=O,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=Ts,u.ba=class extends us{},u.bb=hm,u.bc=qA,u.be=Yt,u.bf=function(c,a){yt.REGISTERED_PROTOCOLS[c]=a},u.bg=function(c){delete yt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,a){const f={};for(let b=0;b<c.length;b++){const k=a&&a[c[b].id]||Bp(c[b]);a&&(a[c[b].id]=k);let S=f[k];S||(S=f[k]=[]),S.push(c[b])}const m=[];for(const b in f)m.push(f[b]);return m},u.bi=Zt,u.bj=A0,u.bk=S0,u.bl=r0,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=jr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],f=a.layout,m=a._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Tr(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Tr(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Tr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:K}=c.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Tr(U),c.canonical),m["text-size"].possiblyEvaluate(new Tr(K),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:K}=c.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Tr(U),c.canonical),m["icon-size"].possiblyEvaluate(new Tr(K),c.canonical)]}const k=f.get("text-line-height")*oi,S=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",M=f.get("text-keep-upright"),F=f.get("text-size");for(const U of c.bucket.features){const K=f.get("text-font").evaluate(U,{},c.canonical).join(","),Q=F.evaluate(U,{},c.canonical),le=b.layoutTextSize.evaluate(U,{},c.canonical),de=b.layoutIconSize.evaluate(U,{},c.canonical),ge={horizontal:{},vertical:void 0},be=U.text;let Ce,ze=[0,0];if(be){const Ve=be.toString(),ht=f.get("text-letter-spacing").evaluate(U,{},c.canonical)*oi,gt=Vh(Ve)?ht:0,Ht=f.get("text-anchor").evaluate(U,{},c.canonical),sn=F0(a,U,c.canonical);if(!sn){const Nt=f.get("text-radial-offset").evaluate(U,{},c.canonical);ze=Nt?B0(Ht,[Nt*oi,mm]):f.get("text-offset").evaluate(U,{},c.canonical).map(It=>It*oi)}let qt=S?"center":f.get("text-justify").evaluate(U,{},c.canonical);const Ut=f.get("symbol-placement"),Bt=Ut==="point"?f.get("text-max-width").evaluate(U,{},c.canonical)*oi:0,Jt=()=>{c.bucket.allowVerticalPlacement&&Aa(Ve)&&(ge.vertical=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,K,Bt,k,Ht,"left",gt,ze,u.ah.vertical,!0,Ut,le,Q))};if(!S&&sn){const Nt=new Set;if(qt==="auto")for(let hn=0;hn<sn.values.length;hn+=2)Nt.add(gm(sn.values[hn]));else Nt.add(qt);let It=!1;for(const hn of Nt)if(!ge.horizontal[hn])if(It)ge.horizontal[hn]=ge.horizontal[0];else{const ln=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,K,Bt,k,"center",hn,gt,ze,u.ah.horizontal,!1,Ut,le,Q);ln&&(ge.horizontal[hn]=ln,It=ln.positionedLines.length===1)}Jt()}else{qt==="auto"&&(qt=gm(Ht));const Nt=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,K,Bt,k,Ht,qt,gt,ze,u.ah.horizontal,!1,Ut,le,Q);Nt&&(ge.horizontal[qt]=Nt),Jt(),Aa(Ve)&&S&&M&&(ge.vertical=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,K,Bt,k,Ht,qt,gt,ze,u.ah.vertical,!1,Ut,le,Q))}}let Ke=!1;if(U.icon&&U.icon.name){const Ve=c.imageMap[U.icon.name];Ve&&(Ce=SA(c.imagePositions[U.icon.name],f.get("icon-offset").evaluate(U,{},c.canonical),f.get("icon-anchor").evaluate(U,{},c.canonical)),Ke=!!Ve.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ke:c.bucket.sdfIcons!==Ke&&Ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Be=$0(ge.horizontal)||ge.vertical;c.bucket.iconsInText=!!Be&&Be.iconsInText,(Be||Ce)&&UA(c.bucket,U,ge,Ce,c.imageMap,b,le,de,ze,Ke,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=em,u.bo=Jp,u.bp=Qp,u.bq=Sa,u.br=nm,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(L())try{return yield Ze(c,a,f,m,b)}catch{}return function(k,S,M,F,U){const K=k.width,Q=k.height;Qe&&ct||(Qe=new OffscreenCanvas(K,Q),ct=Qe.getContext("2d",{willReadFrequently:!0})),Qe.width=K,Qe.height=Q,ct.drawImage(k,0,0,K,Q);const le=ct.getImageData(S,M,F,U);return ct.clearRect(0,0,K,Q),le.data}(c,a,f,m,b)})},u.bu=x0,u.bv=d,u.bw=p,u.bx=Z_,u.by=qs,u.bz=function(c){return c.message===dt},u.c=Je,u.d=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=H,u.f=c=>new Promise((a,f)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=et})},m.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(b):et}),u.g=Et,u.h=(c,a)=>Qt(H(c,{type:"json"}),a),u.i=Ue,u.j=mt,u.k=We,u.l=(c,a)=>Qt(H(c,{type:"arrayBuffer"}),a),u.m=Qt,u.n=function(c){return new nm(c).readFields(vA,[])},u.o=Jc,u.p=n0,u.q=ji,u.r=Fp,u.s=fn,u.t=ba,u.u=Vt,u.v=he,u.w=Ee,u.x=Gs,u.y=function([c,a,f]){return a+=90,a*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(f),y:c*Math.sin(a)*Math.sin(f),z:c*Math.cos(f)}},u.z=Mi}),i("worker",["./shared"],function(u){class s{constructor(re){this.keyCache={},re&&this.replace(re)}replace(re){this._layerConfigs={},this._layers={},this.update(re,[])}update(re,ce){for(const we of re){this._layerConfigs[we.id]=we;const Ne=this._layers[we.id]=u.az(we);Ne._featureFilter=u.a6(Ne.filter),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of ce)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const me=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const we of me){const Ne=we.map(nt=>this._layers[nt.id]),je=Ne[0];if(je.visibility==="none")continue;const qe=je.source||"";let Re=this.familiesBySource[qe];Re||(Re=this.familiesBySource[qe]={});const ie=je.sourceLayer||"_geojsonTileLayer";let Ye=Re[ie];Ye||(Ye=Re[ie]=[]),Ye.push(Ne)}}}class d{constructor(re){const ce={},me=[];for(const qe in re){const Re=re[qe],ie=ce[qe]={};for(const Ye in Re){const nt=Re[+Ye];if(!nt||nt.bitmap.width===0||nt.bitmap.height===0)continue;const it={x:0,y:0,w:nt.bitmap.width+2,h:nt.bitmap.height+2};me.push(it),ie[Ye]={rect:it,metrics:nt.metrics}}}const{w:we,h:Ne}=u.p(me),je=new u.o({width:we||1,height:Ne||1});for(const qe in re){const Re=re[qe];for(const ie in Re){const Ye=Re[+ie];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const nt=ce[qe][ie].rect;u.o.copy(Ye.bitmap,je,{x:0,y:0},{x:nt.x+1,y:nt.y+1},Ye.bitmap)}}this.image=je,this.positions=ce}}u.bi("GlyphAtlas",d);class p{constructor(re){this.tileID=new u.Q(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[]}parse(re,ce,me,we){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=re,this.collisionBoxArray=new u.a4;const Ne=new u.bj(Object.keys(re.layers).sort()),je=new u.bk(this.tileID,this.promoteId);je.bucketLayerIDs=[];const qe={},Re={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},ie=ce.familiesBySource[this.source];for(const In in ie){const Rr=re.layers[In];if(!Rr)continue;Rr.version===1&&u.w(`Vector tile source "${this.source}" layer "${In}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ni=Ne.encode(In),Ti=[];for(let Oi=0;Oi<Rr.length;Oi++){const mi=Rr.feature(Oi),jo=je.getId(mi,In);Ti.push({feature:mi,id:jo,index:Oi,sourceLayerIndex:ni})}for(const Oi of ie[In]){const mi=Oi[0];mi.source!==this.source&&u.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(g(Oi,this.zoom,me),(qe[mi.id]=mi.createBucket({index:je.bucketLayerIDs.length,layers:Oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ni,sourceID:this.source})).populate(Ti,Re,this.tileID.canonical),je.bucketLayerIDs.push(Oi.map(jo=>jo.id)))}}const Ye=u.aE(Re.glyphDependencies,In=>Object.keys(In).map(Number));this.inFlightDependencies.forEach(In=>In==null?void 0:In.abort()),this.inFlightDependencies=[];let nt=Promise.resolve({});if(Object.keys(Ye).length){const In=new AbortController;this.inFlightDependencies.push(In),nt=we.sendAsync({type:"GG",data:{stacks:Ye,source:this.source,tileID:this.tileID,type:"glyphs"}},In)}const it=Object.keys(Re.iconDependencies);let ft=Promise.resolve({});if(it.length){const In=new AbortController;this.inFlightDependencies.push(In),ft=we.sendAsync({type:"GI",data:{icons:it,source:this.source,tileID:this.tileID,type:"icons"}},In)}const zt=Object.keys(Re.patternDependencies);let on=Promise.resolve({});if(zt.length){const In=new AbortController;this.inFlightDependencies.push(In),on=we.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},In)}const[mn,Ln,qn]=yield Promise.all([nt,ft,on]),Cr=new d(mn),Gr=new u.bl(Ln,qn);for(const In in qe){const Rr=qe[In];Rr instanceof u.a5?(g(Rr.layers,this.zoom,me),u.bm({bucket:Rr,glyphMap:mn,glyphPositions:Cr.positions,imageMap:Ln,imagePositions:Gr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Rr.hasPattern&&(Rr instanceof u.bn||Rr instanceof u.bo||Rr instanceof u.bp)&&(g(Rr.layers,this.zoom,me),Rr.addFeatures(Re,this.tileID.canonical,Gr.patternPositions))}return this.status="done",{buckets:Object.values(qe).filter(In=>!In.isEmpty()),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cr.image,imageAtlas:Gr,glyphMap:this.returnDependencies?mn:null,iconMap:this.returnDependencies?Ln:null,glyphPositions:this.returnDependencies?Cr.positions:null}})}}function g(Se,re,ce){const me=new u.a8(re);for(const we of Se)we.recalculate(me,ce)}class y{constructor(re,ce,me){this.actor=re,this.layerIndex=ce,this.availableImages=me,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(re,ce){return u._(this,void 0,void 0,function*(){const me=yield u.l(re.request,ce);try{return{vectorTile:new u.bq.VectorTile(new u.br(me.data)),rawData:me.data,cacheControl:me.cacheControl,expires:me.expires}}catch(we){const Ne=new Uint8Array(me.data);let je=`Unable to parse the tile at ${re.request.url}, `;throw je+=Ne[0]===31&&Ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.messge}`,new Error(je)}})}loadTile(re){return u._(this,void 0,void 0,function*(){const ce=re.uid,me=!!(re&&re.request&&re.request.collectResourceTiming)&&new u.bs(re.request),we=new p(re);this.loading[ce]=we;const Ne=new AbortController;we.abort=Ne;try{const je=yield this.loadVectorTile(re,Ne);if(delete this.loading[ce],!je)return null;const qe=je.rawData,Re={};je.expires&&(Re.expires=je.expires),je.cacheControl&&(Re.cacheControl=je.cacheControl);const ie={};if(me){const nt=me.finish();nt&&(ie.resourceTiming=JSON.parse(JSON.stringify(nt)))}we.vectorTile=je.vectorTile;const Ye=we.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ce]=we,this.fetching[ce]={rawTileData:qe,cacheControl:Re,resourceTiming:ie};try{const nt=yield Ye;return u.e({rawTileData:qe.slice(0)},nt,Re,ie)}finally{delete this.fetching[ce]}}catch(je){throw delete this.loading[ce],we.status="done",this.loaded[ce]=we,je}})}reloadTile(re){return u._(this,void 0,void 0,function*(){const ce=re.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const me=this.loaded[ce];if(me.showCollisionBoxes=re.showCollisionBoxes,me.status==="parsing"){const we=yield me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ne;if(this.fetching[ce]){const{rawTileData:je,cacheControl:qe,resourceTiming:Re}=this.fetching[ce];delete this.fetching[ce],Ne=u.e({rawTileData:je.slice(0)},we,qe,Re)}else Ne=we;return Ne}if(me.status==="done"&&me.vectorTile)return me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(re){return u._(this,void 0,void 0,function*(){const ce=this.loading,me=re.uid;ce&&ce[me]&&ce[me].abort&&(ce[me].abort.abort(),delete ce[me])})}removeTile(re){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[re.uid]&&delete this.loaded[re.uid]})}}class x{constructor(){this.loaded={}}loadTile(re){return u._(this,void 0,void 0,function*(){const{uid:ce,encoding:me,rawImageData:we,redFactor:Ne,greenFactor:je,blueFactor:qe,baseShift:Re}=re,ie=we.width+2,Ye=we.height+2,nt=u.b(we)?new u.R({width:ie,height:Ye},yield u.bt(we,-1,-1,ie,Ye)):we,it=new u.bu(ce,nt,me,Ne,je,qe,Re);return this.loaded=this.loaded||{},this.loaded[ce]=it,it})}removeTile(re){const ce=this.loaded,me=re.uid;ce&&ce[me]&&delete ce[me]}}function C(Se,re){if(Se.length!==0){T(Se[0],re);for(var ce=1;ce<Se.length;ce++)T(Se[ce],!re)}}function T(Se,re){for(var ce=0,me=0,we=0,Ne=Se.length,je=Ne-1;we<Ne;je=we++){var qe=(Se[we][0]-Se[je][0])*(Se[je][1]+Se[we][1]),Re=ce+qe;me+=Math.abs(ce)>=Math.abs(qe)?ce-Re+qe:qe-Re+ce,ce=Re}ce+me>=0!=!!re&&Se.reverse()}var E=u.bv(function Se(re,ce){var me,we=re&&re.type;if(we==="FeatureCollection")for(me=0;me<re.features.length;me++)Se(re.features[me],ce);else if(we==="GeometryCollection")for(me=0;me<re.geometries.length;me++)Se(re.geometries[me],ce);else if(we==="Feature")Se(re.geometry,ce);else if(we==="Polygon")C(re.coordinates,ce);else if(we==="MultiPolygon")for(me=0;me<re.coordinates.length;me++)C(re.coordinates[me],ce);return re});const z=u.bq.VectorTileFeature.prototype.toGeoJSON;var I={exports:{}},L=u.bw,B=u.bq.VectorTileFeature,O=Y;function Y(Se,re){this.options=re||{},this.features=Se,this.length=Se.length}function q(Se,re){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=re||4096}Y.prototype.feature=function(Se){return new q(this.features[Se],this.options.extent)},q.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var re=0;re<Se.length;re++){for(var ce=Se[re],me=[],we=0;we<ce.length;we++)me.push(new L(ce[we][0],ce[we][1]));this.geometry.push(me)}return this.geometry},q.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,re=1/0,ce=-1/0,me=1/0,we=-1/0,Ne=0;Ne<Se.length;Ne++)for(var je=Se[Ne],qe=0;qe<je.length;qe++){var Re=je[qe];re=Math.min(re,Re.x),ce=Math.max(ce,Re.x),me=Math.min(me,Re.y),we=Math.max(we,Re.y)}return[re,me,ce,we]},q.prototype.toGeoJSON=B.prototype.toGeoJSON;var H=u.bx,Z=O;function _e(Se){var re=new H;return function(ce,me){for(var we in ce.layers)me.writeMessage(3,Ie,ce.layers[we])}(Se,re),re.finish()}function Ie(Se,re){var ce;re.writeVarintField(15,Se.version||1),re.writeStringField(1,Se.name||""),re.writeVarintField(5,Se.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Se.length;ce++)me.feature=Se.feature(ce),re.writeMessage(2,J,me);var we=me.keys;for(ce=0;ce<we.length;ce++)re.writeStringField(3,we[ce]);var Ne=me.values;for(ce=0;ce<Ne.length;ce++)re.writeMessage(4,Ue,Ne[ce])}function J(Se,re){var ce=Se.feature;ce.id!==void 0&&re.writeVarintField(1,ce.id),re.writeMessage(2,fe,Se),re.writeVarintField(3,ce.type),re.writeMessage(4,Oe,ce)}function fe(Se,re){var ce=Se.feature,me=Se.keys,we=Se.values,Ne=Se.keycache,je=Se.valuecache;for(var qe in ce.properties){var Re=ce.properties[qe],ie=Ne[qe];if(Re!==null){ie===void 0&&(me.push(qe),Ne[qe]=ie=me.length-1),re.writeVarint(ie);var Ye=typeof Re;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(Re=JSON.stringify(Re));var nt=Ye+":"+Re,it=je[nt];it===void 0&&(we.push(Re),je[nt]=it=we.length-1),re.writeVarint(it)}}}function Ee(Se,re){return(re<<3)+(7&Se)}function ye(Se){return Se<<1^Se>>31}function Oe(Se,re){for(var ce=Se.loadGeometry(),me=Se.type,we=0,Ne=0,je=ce.length,qe=0;qe<je;qe++){var Re=ce[qe],ie=1;me===1&&(ie=Re.length),re.writeVarint(Ee(1,ie));for(var Ye=me===3?Re.length-1:Re.length,nt=0;nt<Ye;nt++){nt===1&&me!==1&&re.writeVarint(Ee(2,Ye-1));var it=Re[nt].x-we,ft=Re[nt].y-Ne;re.writeVarint(ye(it)),re.writeVarint(ye(ft)),we+=it,Ne+=ft}me===3&&re.writeVarint(Ee(7,1))}}function Ue(Se,re){var ce=typeof Se;ce==="string"?re.writeStringField(1,Se):ce==="boolean"?re.writeBooleanField(7,Se):ce==="number"&&(Se%1!=0?re.writeDoubleField(3,Se):Se<0?re.writeSVarintField(6,Se):re.writeVarintField(5,Se))}I.exports=_e,I.exports.fromVectorTileJs=_e,I.exports.fromGeojsonVt=function(Se,re){re=re||{};var ce={};for(var me in Se)ce[me]=new Z(Se[me].features,re),ce[me].name=me,ce[me].version=re.version,ce[me].extent=re.extent;return _e({layers:ce})},I.exports.GeoJSONWrapper=Z;var De=u.bv(I.exports);const xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},et=Math.fround||(Ze=new Float32Array(1),Se=>(Ze[0]=+Se,Ze[0]));var Ze;const Qe=3,ct=5,dt=6;class Je{constructor(re){this.options=Object.assign(Object.create(xe),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:ce,minZoom:me,maxZoom:we}=this.options;ce&&console.time("total time");const Ne=`prepare ${re.length} points`;ce&&console.time(Ne),this.points=re;const je=[];for(let Re=0;Re<re.length;Re++){const ie=re[Re];if(!ie.geometry)continue;const[Ye,nt]=ie.geometry.coordinates,it=et(Ot(Ye)),ft=et(Yt(nt));je.push(it,ft,1/0,Re,-1,1),this.options.reduce&&je.push(0)}let qe=this.trees[we+1]=this._createTree(je);ce&&console.timeEnd(Ne);for(let Re=we;Re>=me;Re--){const ie=+Date.now();qe=this.trees[Re]=this._createTree(this._cluster(qe,Re)),ce&&console.log("z%d: %d clusters in %dms",Re,qe.numItems,+Date.now()-ie)}return ce&&console.timeEnd("total time"),this}getClusters(re,ce){let me=((re[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,re[1]));let Ne=re[2]===180?180:((re[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)me=-180,Ne=180;else if(me>Ne){const nt=this.getClusters([me,we,180,je],ce),it=this.getClusters([-180,we,Ne,je],ce);return nt.concat(it)}const qe=this.trees[this._limitZoom(ce)],Re=qe.range(Ot(me),Yt(je),Ot(Ne),Yt(we)),ie=qe.data,Ye=[];for(const nt of Re){const it=this.stride*nt;Ye.push(ie[it+ct]>1?yt(ie,it,this.clusterProps):this.points[ie[it+Qe]])}return Ye}getChildren(re){const ce=this._getOriginId(re),me=this._getOriginZoom(re),we="No cluster with the specified id.",Ne=this.trees[me];if(!Ne)throw new Error(we);const je=Ne.data;if(ce*this.stride>=je.length)throw new Error(we);const qe=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Re=Ne.within(je[ce*this.stride],je[ce*this.stride+1],qe),ie=[];for(const Ye of Re){const nt=Ye*this.stride;je[nt+4]===re&&ie.push(je[nt+ct]>1?yt(je,nt,this.clusterProps):this.points[je[nt+Qe]])}if(ie.length===0)throw new Error(we);return ie}getLeaves(re,ce,me){const we=[];return this._appendLeaves(we,re,ce=ce||10,me=me||0,0),we}getTile(re,ce,me){const we=this.trees[this._limitZoom(re)],Ne=Math.pow(2,re),{extent:je,radius:qe}=this.options,Re=qe/je,ie=(me-Re)/Ne,Ye=(me+1+Re)/Ne,nt={features:[]};return this._addTileFeatures(we.range((ce-Re)/Ne,ie,(ce+1+Re)/Ne,Ye),we.data,ce,me,Ne,nt),ce===0&&this._addTileFeatures(we.range(1-Re/Ne,ie,1,Ye),we.data,Ne,me,Ne,nt),ce===Ne-1&&this._addTileFeatures(we.range(0,ie,Re/Ne,Ye),we.data,-1,me,Ne,nt),nt.features.length?nt:null}getClusterExpansionZoom(re){let ce=this._getOriginZoom(re)-1;for(;ce<=this.options.maxZoom;){const me=this.getChildren(re);if(ce++,me.length!==1)break;re=me[0].properties.cluster_id}return ce}_appendLeaves(re,ce,me,we,Ne){const je=this.getChildren(ce);for(const qe of je){const Re=qe.properties;if(Re&&Re.cluster?Ne+Re.point_count<=we?Ne+=Re.point_count:Ne=this._appendLeaves(re,Re.cluster_id,me,we,Ne):Ne<we?Ne++:re.push(qe),re.length===me)break}return Ne}_createTree(re){const ce=new u.au(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<re.length;me+=this.stride)ce.add(re[me],re[me+1]);return ce.finish(),ce.data=re,ce}_addTileFeatures(re,ce,me,we,Ne,je){for(const qe of re){const Re=qe*this.stride,ie=ce[Re+ct]>1;let Ye,nt,it;if(ie)Ye=Et(ce,Re,this.clusterProps),nt=ce[Re],it=ce[Re+1];else{const on=this.points[ce[Re+Qe]];Ye=on.properties;const[mn,Ln]=on.geometry.coordinates;nt=Ot(mn),it=Yt(Ln)}const ft={type:1,geometry:[[Math.round(this.options.extent*(nt*Ne-me)),Math.round(this.options.extent*(it*Ne-we))]],tags:Ye};let zt;zt=ie||this.options.generateId?ce[Re+Qe]:this.points[ce[Re+Qe]].id,zt!==void 0&&(ft.id=zt),je.features.push(ft)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,ce){const{radius:me,extent:we,reduce:Ne,minPoints:je}=this.options,qe=me/(we*Math.pow(2,ce)),Re=re.data,ie=[],Ye=this.stride;for(let nt=0;nt<Re.length;nt+=Ye){if(Re[nt+2]<=ce)continue;Re[nt+2]=ce;const it=Re[nt],ft=Re[nt+1],zt=re.within(Re[nt],Re[nt+1],qe),on=Re[nt+ct];let mn=on;for(const Ln of zt){const qn=Ln*Ye;Re[qn+2]>ce&&(mn+=Re[qn+ct])}if(mn>on&&mn>=je){let Ln,qn=it*on,Cr=ft*on,Gr=-1;const In=((nt/Ye|0)<<5)+(ce+1)+this.points.length;for(const Rr of zt){const ni=Rr*Ye;if(Re[ni+2]<=ce)continue;Re[ni+2]=ce;const Ti=Re[ni+ct];qn+=Re[ni]*Ti,Cr+=Re[ni+1]*Ti,Re[ni+4]=In,Ne&&(Ln||(Ln=this._map(Re,nt,!0),Gr=this.clusterProps.length,this.clusterProps.push(Ln)),Ne(Ln,this._map(Re,ni)))}Re[nt+4]=In,ie.push(qn/mn,Cr/mn,1/0,In,-1,mn),Ne&&ie.push(Gr)}else{for(let Ln=0;Ln<Ye;Ln++)ie.push(Re[nt+Ln]);if(mn>1)for(const Ln of zt){const qn=Ln*Ye;if(!(Re[qn+2]<=ce)){Re[qn+2]=ce;for(let Cr=0;Cr<Ye;Cr++)ie.push(Re[qn+Cr])}}}}return ie}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,ce,me){if(re[ce+ct]>1){const je=this.clusterProps[re[ce+dt]];return me?Object.assign({},je):je}const we=this.points[re[ce+Qe]].properties,Ne=this.options.map(we);return me&&Ne===we?Object.assign({},Ne):Ne}}function yt(Se,re,ce){return{type:"Feature",id:Se[re+Qe],properties:Et(Se,re,ce),geometry:{type:"Point",coordinates:[(me=Se[re],360*(me-.5)),tn(Se[re+1])]}};var me}function Et(Se,re,ce){const me=Se[re+ct],we=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ne=Se[re+dt],je=Ne===-1?{}:Object.assign({},ce[Ne]);return Object.assign(je,{cluster:!0,cluster_id:Se[re+Qe],point_count:me,point_count_abbreviated:we})}function Ot(Se){return Se/360+.5}function Yt(Se){const re=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ce<0?0:ce>1?1:ce}function tn(Se){const re=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Qt(Se,re,ce,me){for(var we,Ne=me,je=ce-re>>1,qe=ce-re,Re=Se[re],ie=Se[re+1],Ye=Se[ce],nt=Se[ce+1],it=re+3;it<ce;it+=3){var ft=fn(Se[it],Se[it+1],Re,ie,Ye,nt);if(ft>Ne)we=it,Ne=ft;else if(ft===Ne){var zt=Math.abs(it-je);zt<qe&&(we=it,qe=zt)}}Ne>me&&(we-re>3&&Qt(Se,re,we,me),Se[we+2]=Ne,ce-we>3&&Qt(Se,we,ce,me))}function fn(Se,re,ce,me,we,Ne){var je=we-ce,qe=Ne-me;if(je!==0||qe!==0){var Re=((Se-ce)*je+(re-me)*qe)/(je*je+qe*qe);Re>1?(ce=we,me=Ne):Re>0&&(ce+=je*Re,me+=qe*Re)}return(je=Se-ce)*je+(qe=re-me)*qe}function pn(Se,re,ce,me){var we={id:Se===void 0?null:Se,type:re,geometry:ce,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ne){var je=Ne.geometry,qe=Ne.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")He(Ne,je);else if(qe==="Polygon"||qe==="MultiLineString")for(var Re=0;Re<je.length;Re++)He(Ne,je[Re]);else if(qe==="MultiPolygon")for(Re=0;Re<je.length;Re++)for(var ie=0;ie<je[Re].length;ie++)He(Ne,je[Re][ie])}(we),we}function He(Se,re){for(var ce=0;ce<re.length;ce+=3)Se.minX=Math.min(Se.minX,re[ce]),Se.minY=Math.min(Se.minY,re[ce+1]),Se.maxX=Math.max(Se.maxX,re[ce]),Se.maxY=Math.max(Se.maxY,re[ce+1])}function We(Se,re,ce,me){if(re.geometry){var we=re.geometry.coordinates,Ne=re.geometry.type,je=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),qe=[],Re=re.id;if(ce.promoteId?Re=re.properties[ce.promoteId]:ce.generateId&&(Re=me||0),Ne==="Point")mt(we,qe);else if(Ne==="MultiPoint")for(var ie=0;ie<we.length;ie++)mt(we[ie],qe);else if(Ne==="LineString")Pt(we,qe,je,!1);else if(Ne==="MultiLineString"){if(ce.lineMetrics){for(ie=0;ie<we.length;ie++)Pt(we[ie],qe=[],je,!1),Se.push(pn(Re,"LineString",qe,re.properties));return}he(we,qe,je,!1)}else if(Ne==="Polygon")he(we,qe,je,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(ie=0;ie<re.geometry.geometries.length;ie++)We(Se,{id:Re,geometry:re.geometry.geometries[ie],properties:re.properties},ce,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ie=0;ie<we.length;ie++){var Ye=[];he(we[ie],Ye,je,!0),qe.push(Ye)}}Se.push(pn(Re,Ne,qe,re.properties))}}function mt(Se,re){re.push(nn(Se[0])),re.push(Pe(Se[1])),re.push(0)}function Pt(Se,re,ce,me){for(var we,Ne,je=0,qe=0;qe<Se.length;qe++){var Re=nn(Se[qe][0]),ie=Pe(Se[qe][1]);re.push(Re),re.push(ie),re.push(0),qe>0&&(je+=me?(we*ie-Re*Ne)/2:Math.sqrt(Math.pow(Re-we,2)+Math.pow(ie-Ne,2))),we=Re,Ne=ie}var Ye=re.length-3;re[2]=1,Qt(re,0,Ye,ce),re[Ye+2]=1,re.size=Math.abs(je),re.start=0,re.end=re.size}function he(Se,re,ce,me){for(var we=0;we<Se.length;we++){var Ne=[];Pt(Se[we],Ne,ce,me),re.push(Ne)}}function nn(Se){return Se/360+.5}function Pe(Se){var re=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ce<0?0:ce>1?1:ce}function tt(Se,re,ce,me,we,Ne,je,qe){if(me/=re,Ne>=(ce/=re)&&je<me)return Se;if(je<ce||Ne>=me)return null;for(var Re=[],ie=0;ie<Se.length;ie++){var Ye=Se[ie],nt=Ye.geometry,it=Ye.type,ft=we===0?Ye.minX:Ye.minY,zt=we===0?Ye.maxX:Ye.maxY;if(ft>=ce&&zt<me)Re.push(Ye);else if(!(zt<ce||ft>=me)){var on=[];if(it==="Point"||it==="MultiPoint")jt(nt,on,ce,me,we);else if(it==="LineString")Gn(nt,on,ce,me,we,!1,qe.lineMetrics);else if(it==="MultiLineString")jn(nt,on,ce,me,we,!1);else if(it==="Polygon")jn(nt,on,ce,me,we,!0);else if(it==="MultiPolygon")for(var mn=0;mn<nt.length;mn++){var Ln=[];jn(nt[mn],Ln,ce,me,we,!0),Ln.length&&on.push(Ln)}if(on.length){if(qe.lineMetrics&&it==="LineString"){for(mn=0;mn<on.length;mn++)Re.push(pn(Ye.id,it,on[mn],Ye.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(on.length===1?(it="LineString",on=on[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=on.length===3?"Point":"MultiPoint"),Re.push(pn(Ye.id,it,on,Ye.tags))}}}return Re.length?Re:null}function jt(Se,re,ce,me,we){for(var Ne=0;Ne<Se.length;Ne+=3){var je=Se[Ne+we];je>=ce&&je<=me&&(re.push(Se[Ne]),re.push(Se[Ne+1]),re.push(Se[Ne+2]))}}function Gn(Se,re,ce,me,we,Ne,je){for(var qe,Re,ie=Un(Se),Ye=we===0?An:ti,nt=Se.start,it=0;it<Se.length-3;it+=3){var ft=Se[it],zt=Se[it+1],on=Se[it+2],mn=Se[it+3],Ln=Se[it+4],qn=we===0?ft:zt,Cr=we===0?mn:Ln,Gr=!1;je&&(qe=Math.sqrt(Math.pow(ft-mn,2)+Math.pow(zt-Ln,2))),qn<ce?Cr>ce&&(Re=Ye(ie,ft,zt,mn,Ln,ce),je&&(ie.start=nt+qe*Re)):qn>me?Cr<me&&(Re=Ye(ie,ft,zt,mn,Ln,me),je&&(ie.start=nt+qe*Re)):Wt(ie,ft,zt,on),Cr<ce&&qn>=ce&&(Re=Ye(ie,ft,zt,mn,Ln,ce),Gr=!0),Cr>me&&qn<=me&&(Re=Ye(ie,ft,zt,mn,Ln,me),Gr=!0),!Ne&&Gr&&(je&&(ie.end=nt+qe*Re),re.push(ie),ie=Un(Se)),je&&(nt+=qe)}var In=Se.length-3;ft=Se[In],zt=Se[In+1],on=Se[In+2],(qn=we===0?ft:zt)>=ce&&qn<=me&&Wt(ie,ft,zt,on),In=ie.length-3,Ne&&In>=3&&(ie[In]!==ie[0]||ie[In+1]!==ie[1])&&Wt(ie,ie[0],ie[1],ie[2]),ie.length&&re.push(ie)}function Un(Se){var re=[];return re.size=Se.size,re.start=Se.start,re.end=Se.end,re}function jn(Se,re,ce,me,we,Ne){for(var je=0;je<Se.length;je++)Gn(Se[je],re,ce,me,we,Ne,!1)}function Wt(Se,re,ce,me){Se.push(re),Se.push(ce),Se.push(me)}function An(Se,re,ce,me,we,Ne){var je=(Ne-re)/(me-re);return Se.push(Ne),Se.push(ce+(we-ce)*je),Se.push(1),je}function ti(Se,re,ce,me,we,Ne){var je=(Ne-ce)/(we-ce);return Se.push(re+(me-re)*je),Se.push(Ne),Se.push(1),je}function Bn(Se,re){for(var ce=[],me=0;me<Se.length;me++){var we,Ne=Se[me],je=Ne.type;if(je==="Point"||je==="MultiPoint"||je==="LineString")we=_t(Ne.geometry,re);else if(je==="MultiLineString"||je==="Polygon"){we=[];for(var qe=0;qe<Ne.geometry.length;qe++)we.push(_t(Ne.geometry[qe],re))}else if(je==="MultiPolygon")for(we=[],qe=0;qe<Ne.geometry.length;qe++){for(var Re=[],ie=0;ie<Ne.geometry[qe].length;ie++)Re.push(_t(Ne.geometry[qe][ie],re));we.push(Re)}ce.push(pn(Ne.id,je,we,Ne.tags))}return ce}function _t(Se,re){var ce=[];ce.size=Se.size,Se.start!==void 0&&(ce.start=Se.start,ce.end=Se.end);for(var me=0;me<Se.length;me+=3)ce.push(Se[me]+re,Se[me+1],Se[me+2]);return ce}function mr(Se,re){if(Se.transformed)return Se;var ce,me,we,Ne=1<<Se.z,je=Se.x,qe=Se.y;for(ce=0;ce<Se.features.length;ce++){var Re=Se.features[ce],ie=Re.geometry,Ye=Re.type;if(Re.geometry=[],Ye===1)for(me=0;me<ie.length;me+=2)Re.geometry.push(ar(ie[me],ie[me+1],re,Ne,je,qe));else for(me=0;me<ie.length;me++){var nt=[];for(we=0;we<ie[me].length;we+=2)nt.push(ar(ie[me][we],ie[me][we+1],re,Ne,je,qe));Re.geometry.push(nt)}}return Se.transformed=!0,Se}function ar(Se,re,ce,me,we,Ne){return[Math.round(ce*(Se*me-we)),Math.round(ce*(re*me-Ne))]}function gi(Se,re,ce,me,we){for(var Ne=re===we.maxZoom?0:we.tolerance/((1<<re)*we.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:me,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},qe=0;qe<Se.length;qe++){je.numFeatures++,Vn(je,Se[qe],Ne,we);var Re=Se[qe].minX,ie=Se[qe].minY,Ye=Se[qe].maxX,nt=Se[qe].maxY;Re<je.minX&&(je.minX=Re),ie<je.minY&&(je.minY=ie),Ye>je.maxX&&(je.maxX=Ye),nt>je.maxY&&(je.maxY=nt)}return je}function Vn(Se,re,ce,me){var we=re.geometry,Ne=re.type,je=[];if(Ne==="Point"||Ne==="MultiPoint")for(var qe=0;qe<we.length;qe+=3)je.push(we[qe]),je.push(we[qe+1]),Se.numPoints++,Se.numSimplified++;else if(Ne==="LineString")$e(je,we,Se,ce,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(qe=0;qe<we.length;qe++)$e(je,we[qe],Se,ce,Ne==="Polygon",qe===0);else if(Ne==="MultiPolygon")for(var Re=0;Re<we.length;Re++){var ie=we[Re];for(qe=0;qe<ie.length;qe++)$e(je,ie[qe],Se,ce,!0,qe===0)}if(je.length){var Ye=re.tags||null;if(Ne==="LineString"&&me.lineMetrics){for(var nt in Ye={},re.tags)Ye[nt]=re.tags[nt];Ye.mapbox_clip_start=we.start/we.size,Ye.mapbox_clip_end=we.end/we.size}var it={geometry:je,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:Ye};re.id!==null&&(it.id=re.id),Se.features.push(it)}}function $e(Se,re,ce,me,we,Ne){var je=me*me;if(me>0&&re.size<(we?je:me))ce.numPoints+=re.length/3;else{for(var qe=[],Re=0;Re<re.length;Re+=3)(me===0||re[Re+2]>je)&&(ce.numSimplified++,qe.push(re[Re]),qe.push(re[Re+1])),ce.numPoints++;we&&function(ie,Ye){for(var nt=0,it=0,ft=ie.length,zt=ft-2;it<ft;zt=it,it+=2)nt+=(ie[it]-ie[zt])*(ie[it+1]+ie[zt+1]);if(nt>0===Ye)for(it=0,ft=ie.length;it<ft/2;it+=2){var on=ie[it],mn=ie[it+1];ie[it]=ie[ft-2-it],ie[it+1]=ie[ft-1-it],ie[ft-2-it]=on,ie[ft-1-it]=mn}}(qe,Ne),Se.push(qe)}}function pt(Se,re){var ce=(re=this.options=function(we,Ne){for(var je in Ne)we[je]=Ne[je];return we}(Object.create(this.options),re)).debug;if(ce&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var me=function(we,Ne){var je=[];if(we.type==="FeatureCollection")for(var qe=0;qe<we.features.length;qe++)We(je,we.features[qe],Ne,qe);else We(je,we.type==="Feature"?we:{geometry:we},Ne);return je}(Se,re);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=function(we,Ne){var je=Ne.buffer/Ne.extent,qe=we,Re=tt(we,1,-1-je,je,0,-1,2,Ne),ie=tt(we,1,1-je,2+je,0,-1,2,Ne);return(Re||ie)&&(qe=tt(we,1,-je,1+je,0,-1,2,Ne)||[],Re&&(qe=Bn(Re,1).concat(qe)),ie&&(qe=qe.concat(Bn(ie,-1)))),qe}(me,re),me.length&&this.splitTile(me,0,0,0),ce&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(Se,re,ce){return 32*((1<<Se)*ce+re)+Se}function Dt(Se,re){return re?Se.properties[re]:Se.id}function rn(Se,re){if(Se==null)return!0;if(Se.type==="Feature")return Dt(Se,re)!=null;if(Se.type==="FeatureCollection"){const ce=new Set;for(const me of Se.features){const we=Dt(me,re);if(we==null||ce.has(we))return!1;ce.add(we)}return!0}return!1}function en(Se,re){const ce=new Map;if(Se!=null)if(Se.type==="Feature")ce.set(Dt(Se,re),Se);else for(const me of Se.features)ce.set(Dt(me,re),me);return ce}pt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pt.prototype.splitTile=function(Se,re,ce,me,we,Ne,je){for(var qe=[Se,re,ce,me],Re=this.options,ie=Re.debug;qe.length;){me=qe.pop(),ce=qe.pop(),re=qe.pop(),Se=qe.pop();var Ye=1<<re,nt=vt(re,ce,me),it=this.tiles[nt];if(!it&&(ie>1&&console.time("creation"),it=this.tiles[nt]=gi(Se,re,ce,me,Re),this.tileCoords.push({z:re,x:ce,y:me}),ie)){ie>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,ce,me,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var ft="z"+re;this.stats[ft]=(this.stats[ft]||0)+1,this.total++}if(it.source=Se,we){if(re===Re.maxZoom||re===we)continue;var zt=1<<we-re;if(ce!==Math.floor(Ne/zt)||me!==Math.floor(je/zt))continue}else if(re===Re.indexMaxZoom||it.numPoints<=Re.indexMaxPoints)continue;if(it.source=null,Se.length!==0){ie>1&&console.time("clipping");var on,mn,Ln,qn,Cr,Gr,In=.5*Re.buffer/Re.extent,Rr=.5-In,ni=.5+In,Ti=1+In;on=mn=Ln=qn=null,Cr=tt(Se,Ye,ce-In,ce+ni,0,it.minX,it.maxX,Re),Gr=tt(Se,Ye,ce+Rr,ce+Ti,0,it.minX,it.maxX,Re),Se=null,Cr&&(on=tt(Cr,Ye,me-In,me+ni,1,it.minY,it.maxY,Re),mn=tt(Cr,Ye,me+Rr,me+Ti,1,it.minY,it.maxY,Re),Cr=null),Gr&&(Ln=tt(Gr,Ye,me-In,me+ni,1,it.minY,it.maxY,Re),qn=tt(Gr,Ye,me+Rr,me+Ti,1,it.minY,it.maxY,Re),Gr=null),ie>1&&console.timeEnd("clipping"),qe.push(on||[],re+1,2*ce,2*me),qe.push(mn||[],re+1,2*ce,2*me+1),qe.push(Ln||[],re+1,2*ce+1,2*me),qe.push(qn||[],re+1,2*ce+1,2*me+1)}}},pt.prototype.getTile=function(Se,re,ce){var me=this.options,we=me.extent,Ne=me.debug;if(Se<0||Se>24)return null;var je=1<<Se,qe=vt(Se,re=(re%je+je)%je,ce);if(this.tiles[qe])return mr(this.tiles[qe],we);Ne>1&&console.log("drilling down to z%d-%d-%d",Se,re,ce);for(var Re,ie=Se,Ye=re,nt=ce;!Re&&ie>0;)ie--,Ye=Math.floor(Ye/2),nt=Math.floor(nt/2),Re=this.tiles[vt(ie,Ye,nt)];return Re&&Re.source?(Ne>1&&console.log("found parent tile z%d-%d-%d",ie,Ye,nt),Ne>1&&console.time("drilling down"),this.splitTile(Re.source,ie,Ye,nt,Se,re,ce),Ne>1&&console.timeEnd("drilling down"),this.tiles[qe]?mr(this.tiles[qe],we):null):null};class br extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(re,ce){return u._(this,void 0,void 0,function*(){const me=re.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!we)return null;const Ne=new class{constructor(qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=qe.length,this._features=qe}feature(qe){return new class{constructor(Re){this._feature=Re,this.extent=u.W,this.type=Re.type,this.properties=Re.tags,"id"in Re&&!isNaN(Re.id)&&(this.id=parseInt(Re.id,10))}loadGeometry(){if(this._feature.type===1){const Re=[];for(const ie of this._feature.geometry)Re.push([new u.P(ie[0],ie[1])]);return Re}{const Re=[];for(const ie of this._feature.geometry){const Ye=[];for(const nt of ie)Ye.push(new u.P(nt[0],nt[1]));Re.push(Ye)}return Re}}toGeoJSON(Re,ie,Ye){return z.call(this,Re,ie,Ye)}}(this._features[qe])}}(we.features);let je=De(Ne);return je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),{vectorTile:Ne,rawData:je.buffer}})}loadData(re){return u._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const me=!!(re&&re.request&&re.request.collectResourceTiming)&&new u.bs(re.request);this._pendingRequest=new AbortController;try{let we=yield this.loadGeoJSON(re,this._pendingRequest);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(E(we,!0),re.filter){const je=u.by(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(Re=>`${Re.key}: ${Re.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(Re=>je.value.evaluate({zoom:0},Re))}}this._geoJSONIndex=re.cluster?new Je(function({superclusterOptions:je,clusterProperties:qe}){if(!qe||!je)return je;const Re={},ie={},Ye={accumulated:null,zoom:0},nt={properties:null},it=Object.keys(qe);for(const ft of it){const[zt,on]=qe[ft],mn=u.by(on),Ln=u.by(typeof zt=="string"?[zt,["accumulated"],["get",ft]]:zt);Re[ft]=mn.value,ie[ft]=Ln.value}return je.map=ft=>{nt.properties=ft;const zt={};for(const on of it)zt[on]=Re[on].evaluate(Ye,nt);return zt},je.reduce=(ft,zt)=>{nt.properties=zt;for(const on of it)Ye.accumulated=ft[on],ft[on]=ie[on].evaluate(Ye,nt)},je}(re)).load(we.features):function(je,qe){return new pt(je,qe)}(we,re.geojsonVtOptions),this.loaded={};const Ne={};if(me){const je=me.finish();je&&(Ne.resourceTiming={},Ne.resourceTiming[re.source]=JSON.parse(JSON.stringify(je)))}return Ne}catch(we){if(delete this._pendingRequest,u.bz(we))return{abandoned:!0};throw we}})}reloadTile(re){const ce=this.loaded;return ce&&ce[re.uid]?super.reloadTile(re):this.loadTile(re)}loadGeoJSON(re,ce){return u._(this,void 0,void 0,function*(){const{promoteId:me}=re;if(re.request){const we=yield u.h(re.request,ce);return this._dataUpdateable=rn(we.data,me)?en(we.data,me):void 0,we.data}if(typeof re.data=="string")try{const we=JSON.parse(re.data);return this._dataUpdateable=rn(we,me)?en(we,me):void 0,we}catch{throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`)}if(!re.dataDiff)throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${re.source}`);return function(we,Ne,je){var qe,Re,ie,Ye;if(Ne.removeAll&&we.clear(),Ne.remove)for(const nt of Ne.remove)we.delete(nt);if(Ne.add)for(const nt of Ne.add){const it=Dt(nt,je);it!=null&&we.set(it,nt)}if(Ne.update)for(const nt of Ne.update){let it=we.get(nt.id);if(it==null)continue;const ft=!nt.removeAllProperties&&(((qe=nt.removeProperties)===null||qe===void 0?void 0:qe.length)>0||((Re=nt.addOrUpdateProperties)===null||Re===void 0?void 0:Re.length)>0);if((nt.newGeometry||nt.removeAllProperties||ft)&&(it=Object.assign({},it),we.set(nt.id,it),ft&&(it.properties=Object.assign({},it.properties))),nt.newGeometry&&(it.geometry=nt.newGeometry),nt.removeAllProperties)it.properties={};else if(((ie=nt.removeProperties)===null||ie===void 0?void 0:ie.length)>0)for(const zt of nt.removeProperties)Object.prototype.hasOwnProperty.call(it.properties,zt)&&delete it.properties[zt];if(((Ye=nt.addOrUpdateProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const{key:zt,value:on}of nt.addOrUpdateProperties)it.properties[zt]=on}}(this._dataUpdateable,re.dataDiff,me),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(re){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(re){return this._geoJSONIndex.getClusterExpansionZoom(re.clusterId)}getClusterChildren(re){return this._geoJSONIndex.getChildren(re.clusterId)}getClusterLeaves(re){return this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset)}}class lr{constructor(re){this.self=re,this.actor=new u.C(re),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,me)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=me},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=ce=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,me)=>this._getDEMWorkerSource(ce,me.source).loadTile(me)),this.actor.registerMessageHandler("RDT",(ce,me)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,me.source).removeTile(me)})),this.actor.registerMessageHandler("GCEZ",(ce,me)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,me.type,me.source).getClusterExpansionZoom(me)})),this.actor.registerMessageHandler("GCC",(ce,me)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,me.type,me.source).getClusterChildren(me)})),this.actor.registerMessageHandler("GCL",(ce,me)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,me.type,me.source).getClusterLeaves(me)})),this.actor.registerMessageHandler("LD",(ce,me)=>this._getWorkerSource(ce,me.type,me.source).loadData(me)),this.actor.registerMessageHandler("LT",(ce,me)=>this._getWorkerSource(ce,me.type,me.source).loadTile(me)),this.actor.registerMessageHandler("RT",(ce,me)=>this._getWorkerSource(ce,me.type,me.source).reloadTile(me)),this.actor.registerMessageHandler("AT",(ce,me)=>this._getWorkerSource(ce,me.type,me.source).abortTile(me)),this.actor.registerMessageHandler("RMT",(ce,me)=>this._getWorkerSource(ce,me.type,me.source).removeTile(me)),this.actor.registerMessageHandler("RS",(ce,me)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][me.type]||!this.workerSources[ce][me.type][me.source])return;const we=this.workerSources[ce][me.type][me.source];delete this.workerSources[ce][me.type][me.source],we.removeSource!==void 0&&we.removeSource(me)})),this.actor.registerMessageHandler("RM",ce=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,me)=>u._(this,void 0,void 0,function*(){this.referrer=me})),this.actor.registerMessageHandler("SRPS",(ce,me)=>this._syncRTLPluginState(ce,me)),this.actor.registerMessageHandler("IS",(ce,me)=>u._(this,void 0,void 0,function*(){this.self.importScripts(me)})),this.actor.registerMessageHandler("SI",(ce,me)=>this._setImages(ce,me)),this.actor.registerMessageHandler("UL",(ce,me)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(me.layers,me.removedIds)})),this.actor.registerMessageHandler("SL",(ce,me)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(me)}))}_setImages(re,ce){return u._(this,void 0,void 0,function*(){this.availableImages[re]=ce;for(const me in this.workerSources[re]){const we=this.workerSources[re][me];for(const Ne in we)we[Ne].availableImages=ce}})}_syncRTLPluginState(re,ce){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(ce.pluginStatus!=="loading")return u.bA.setState(ce),ce;const me=ce.pluginURL;if(this.self.importScripts(me),u.bA.isParsed()){const we={pluginStatus:"loaded",pluginURL:me};return u.bA.setState(we),we}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${me}`)})}_getAvailableImages(re){let ce=this.availableImages[re];return ce||(ce=[]),ce}_getLayerIndex(re){let ce=this.layerIndexes[re];return ce||(ce=this.layerIndexes[re]=new s),ce}_getWorkerSource(re,ce,me){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][ce]||(this.workerSources[re][ce]={}),!this.workerSources[re][ce][me]){const we={sendAsync:(Ne,je)=>(Ne.targetMapId=re,this.actor.sendAsync(Ne,je))};switch(ce){case"vector":this.workerSources[re][ce][me]=new y(we,this._getLayerIndex(re),this._getAvailableImages(re));break;case"geojson":this.workerSources[re][ce][me]=new br(we,this._getLayerIndex(re),this._getAvailableImages(re));break;default:this.workerSources[re][ce][me]=new this.externalWorkerSourceTypes[ce](we,this._getLayerIndex(re),this._getAvailableImages(re))}}return this.workerSources[re][ce][me]}_getDEMWorkerSource(re,ce){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][ce]||(this.demWorkerSources[re][ce]=new x),this.demWorkerSources[re][ce]}}return u.i(self)&&(self.worker=new lr(self)),lr}),i("index",["exports","./shared"],function(u,s){var d="4.1.3";let p,g;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,h)=>{const _=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),h(s.c())})}),getImageData(w,l=0){return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,h.drawImage(w,0,0,w.width,w.height),h},resolveURL:w=>(p||(p=document.createElement("a")),p.href=w,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let h=0;h<l.length;h++)if(l[h]in x.docStyle)return l[h];return l[0]}static create(l,h,_){const v=window.document.createElement(l);return h!==void 0&&(v.className=h),_&&_.appendChild(v),v}static createNS(l,h){return window.document.createElementNS(l,h)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,h){l.style[x.transformProp]=h}static addEventListener(l,h,_,v={}){l.addEventListener(h,_,"passive"in v?v:v.capture)}static removeEventListener(l,h,_,v={}){l.removeEventListener(h,_,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const h=l.getBoundingClientRect();return{x:h.width/l.offsetWidth||1,y:h.height/l.offsetHeight||1,boundingClientRect:h}}static getPoint(l,h,_){const v=h.boundingClientRect;return new s.P((_.clientX-v.left)/h.x-l.clientLeft,(_.clientY-v.top)/h.y-l.clientTop)}static mousePos(l,h){const _=x.getScale(l);return x.getPoint(l,_,h)}static touchPos(l,h){const _=[],v=x.getScale(l);for(let A=0;A<h.length;A++)_.push(x.getPoint(l,v,h[A]));return _}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(w){!z&&E&&(I?L(w):T=w)}};let T,E,z=!1,I=!1;function L(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,E),w.isContextLost())return;C.supported=!0}catch{}w.deleteTexture(l),z=!0}var B;typeof document<"u"&&(E=document.createElement("img"),E.onload=function(){T&&L(T),T=null,I=!0},E.onerror=function(){z=!0,T=null},E.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,h,_,v;w.resetRequestQueue=()=>{l=[],h=0,_=0,v={}},w.addThrottleControl=$=>{const X=_++;return v[X]=$,X},w.removeThrottleControl=$=>{delete v[$],P()},w.getImage=($,X,ee=!0)=>new Promise((te,pe)=>{C.supported&&($.headers||($.headers={}),$.headers.accept="image/webp,*/*"),s.e($,{type:"image"}),l.push({abortController:X,requestParameters:$,supportImageRefresh:ee,state:"queued",onError:ke=>{pe(ke)},onSuccess:ke=>{te(ke)}}),P()});const A=$=>s._(this,void 0,void 0,function*(){$.state="running";const{requestParameters:X,supportImageRefresh:ee,onError:te,onSuccess:pe,abortController:ke}=$,Ae=ee===!1&&!s.i(self)&&!s.g(X.url)&&(!X.headers||Object.keys(X.headers).reduce((Fe,rt)=>Fe&&rt==="accept",!0));h++;const Me=Ae?R(X,ke):s.m(X,ke);try{const Fe=yield Me;delete $.abortController,$.state="completed",Fe.data instanceof HTMLImageElement||s.b(Fe.data)?pe(Fe):Fe.data&&pe({data:yield(ve=Fe.data,typeof createImageBitmap=="function"?s.d(ve):s.f(ve)),cacheControl:Fe.cacheControl,expires:Fe.expires})}catch(Fe){delete $.abortController,te(Fe)}finally{h--,P()}var ve}),P=()=>{const $=(()=>{for(const X of Object.keys(v))if(v[X]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let X=h;X<$&&l.length>0;X++){const ee=l.shift();ee.abortController.signal.aborted?X--:A(ee)}},R=($,X)=>new Promise((ee,te)=>{const pe=new Image,ke=$.url,Ae=$.credentials;Ae&&Ae==="include"?pe.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!s.s(ke))&&(pe.crossOrigin="anonymous"),X.signal.addEventListener("abort",()=>{pe.src="",te(s.c())}),pe.fetchPriority="high",pe.onload=()=>{pe.onerror=pe.onload=null,ee({data:pe})},pe.onerror=()=>{pe.onerror=pe.onload=null,X.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},pe.src=ke})}(B||(B={})),B.resetRequestQueue();class O{constructor(l){this._transformRequestFn=l}transformRequest(l,h){return this._transformRequestFn&&this._transformRequestFn(l,h)||{url:l}}normalizeSpriteURL(l,h,_){const v=function(A){const P=A.match(Y);if(!P)throw new Error(`Unable to parse URL "${A}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(l);return v.path+=`${h}${_}`,function(A){const P=A.params.length?`?${A.params.join("&")}`:"";return`${A.protocol}://${A.authority}${A.path}${P}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function q(w){var l=new s.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var H,Z=function(w,l,h){return w[0]=l[0]-h[0],w[1]=l[1]-h[1],w[2]=l[2]-h[2],w};H=new s.A(3),s.A!=Float32Array&&(H[0]=0,H[1]=0,H[2]=0);var _e=function(w){var l=w[0],h=w[1];return l*l+h*h};function Ie(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const h=[];for(const{id:_,url:v}of w){const A=`${_}${v}`;h.indexOf(A)===-1&&(h.push(A),l.push({id:_,url:v}))}}return l}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class J{constructor(l,h,_,v){this.context=l,this.format=_,this.texture=l.gl.createTexture(),this.update(h,v)}update(l,h,_){const{width:v,height:A}=l,P=!(this.size&&this.size[0]===v&&this.size[1]===A||_),{context:R}=this,{gl:$}=R;if(this.useMipmap=!!(h&&h.useMipmap),$.bindTexture($.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===$.RGBA&&(!h||h.premultiply!==!1)),P)this.size=[v,A],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texImage2D($.TEXTURE_2D,0,this.format,this.format,$.UNSIGNED_BYTE,l):$.texImage2D($.TEXTURE_2D,0,this.format,v,A,0,this.format,$.UNSIGNED_BYTE,l.data);else{const{x:X,y:ee}=_||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texSubImage2D($.TEXTURE_2D,0,X,ee,$.RGBA,$.UNSIGNED_BYTE,l):$.texSubImage2D($.TEXTURE_2D,0,X,ee,v,A,$.RGBA,$.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&$.generateMipmap($.TEXTURE_2D)}bind(l,h,_){const{context:v}=this,{gl:A}=v;A.bindTexture(A.TEXTURE_2D,this.texture),_!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=A.LINEAR),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,_||l),this.filter=l),h!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,h),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function fe(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class Ee extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:h,promiseResolve:_}of this.requestors)_(this._getImagesForIds(h));this.requestors=[]}}getImage(l){const h=this.images[l];if(h&&!h.data&&h.spriteData){const _=h.spriteData;h.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),h.spriteData=null}return h}addImage(l,h){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,h)&&(this.images[l]=h)}_validate(l,h){let _=!0;const v=h.data||h.spriteData;return this._validateStretch(h.stretchX,v&&v.width)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,v&&v.height)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,h){if(!l)return!0;let _=0;for(const v of l){if(v[0]<_||v[1]<v[0]||h<v[1])return!1;_=v[1]}return!0}_validateContent(l,h){if(!l)return!0;if(l.length!==4)return!1;const _=h.spriteData,v=_&&_.width||h.data.width,A=_&&_.height||h.data.height;return!(l[0]<0||v<l[0]||l[1]<0||A<l[1]||l[2]<0||v<l[2]||l[3]<0||A<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,h,_=!0){const v=this.getImage(l);if(_&&(v.data.width!==h.data.width||v.data.height!==h.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=v.version+1,this.images[l]=h,this.updatedImages[l]=!0}removeImage(l){const h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((h,_)=>{let v=!0;if(!this.isLoaded())for(const A of l)this.images[A]||(v=!1);this.isLoaded()||v?h(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:h})})}_getImagesForIds(l){const h={};for(const _ of l){let v=this.getImage(_);v||(this.fire(new s.k("styleimagemissing",{id:_})),v=this.getImage(_)),v?h[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:l,height:h}=this.atlasImage;return{width:l,height:h}}getPattern(l){const h=this.patterns[l],_=this.getImage(l);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},A=new s.I(v,_);this.patterns[l]={bin:v,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new J(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:h,h:_}=s.p(l),v=this.atlasImage;v.resize({width:h||1,height:_||1});for(const A in this.patterns){const{bin:P}=this.patterns[A],R=P.x+1,$=P.y+1,X=this.getImage(A).data,ee=X.width,te=X.height;s.R.copy(X,v,{x:0,y:0},{x:R,y:$},{width:ee,height:te}),s.R.copy(X,v,{x:0,y:te-1},{x:R,y:$-1},{width:ee,height:1}),s.R.copy(X,v,{x:0,y:0},{x:R,y:$+te},{width:ee,height:1}),s.R.copy(X,v,{x:ee-1,y:0},{x:R-1,y:$},{width:1,height:te}),s.R.copy(X,v,{x:0,y:0},{x:R+ee,y:$},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const h of l){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.getImage(h);_||s.w(`Image with ID: "${h}" was not found`),fe(_)&&this.updateImage(h,_)}}}const ye=1e20;function Oe(w,l,h,_,v,A,P,R,$){for(let X=l;X<l+_;X++)Ue(w,h*A+X,A,v,P,R,$);for(let X=h;X<h+v;X++)Ue(w,X*A+l,1,_,P,R,$)}function Ue(w,l,h,_,v,A,P){A[0]=0,P[0]=-ye,P[1]=ye,v[0]=w[l];for(let R=1,$=0,X=0;R<_;R++){v[R]=w[l+R*h];const ee=R*R;do{const te=A[$];X=(v[R]-v[te]+ee-te*te)/(R-te)/2}while(X<=P[$]&&--$>-1);$++,A[$]=R,P[$]=X,P[$+1]=ye}for(let R=0,$=0;R<_;R++){for(;P[$+1]<R;)$++;const X=A[$],ee=R-X;w[l+R*h]=v[X]+ee*ee}}class De{constructor(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,function*(){const h=[];for(const A in l)for(const P of l[A])h.push(this._getAndCacheGlyphsPromise(A,P));const _=yield Promise.all(h),v={};for(const{stack:A,id:P,glyph:R}of _)v[A]||(v[A]={}),v[A][P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return v})}_getAndCacheGlyphsPromise(l,h){return s._(this,void 0,void 0,function*(){let _=this.entries[l];_||(_=this.entries[l]={glyphs:{},requests:{},ranges:{}});let v=_.glyphs[h];if(v!==void 0)return{stack:l,id:h,glyph:v};if(v=this._tinySDF(_,l,h),v)return _.glyphs[h]=v,{stack:l,id:h,glyph:v};const A=Math.floor(h/256);if(256*A>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[A])return{stack:l,id:h,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[A]){const R=De.loadGlyphRange(l,A,this.url,this.requestManager);_.requests[A]=R}const P=yield _.requests[A];for(const R in P)this._doesCharSupportLocalGlyph(+R)||(_.glyphs[+R]=P[+R]);return _.ranges[A]=!0,{stack:l,id:h,glyph:P[h]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](l)||s.u["Hangul Syllables"](l)||s.u.Hiragana(l)||s.u.Katakana(l))}_tinySDF(l,h,_){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(_))return;let A=l.tinySDF;if(!A){let R="400";/bold/i.test(h)?R="900":/medium/i.test(h)?R="500":/light/i.test(h)&&(R="200"),A=l.tinySDF=new De.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:R})}const P=A.draw(String.fromCharCode(_));return{id:_,bitmap:new s.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}De.loadGlyphRange=function(w,l,h,_){return s._(this,void 0,void 0,function*(){const v=256*l,A=v+255,P=_.transformRequest(h.replace("{fontstack}",w).replace("{range}",`${v}-${A}`),"Glyphs"),R=yield s.l(P,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${l}, ${v}-${A}`);const $={};for(const X of s.n(R.data))$[X.id]=X;return $})},De.TinySDF=class{constructor({fontSize:w=24,buffer:l=3,radius:h=8,cutoff:_=.25,fontFamily:v="sans-serif",fontWeight:A="normal",fontStyle:P="normal"}={}){this.buffer=l,this.cutoff=_,this.radius=h;const R=this.size=w+4*l,$=this._createCanvas(R),X=this.ctx=$.getContext("2d",{willReadFrequently:!0});X.font=`${P} ${A} ${w}px ${v}`,X.textBaseline="alphabetic",X.textAlign="left",X.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:_,actualBoundingBoxLeft:v,actualBoundingBoxRight:A}=this.ctx.measureText(w),P=Math.ceil(h),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-v))),$=Math.min(this.size-this.buffer,P+Math.ceil(_)),X=R+2*this.buffer,ee=$+2*this.buffer,te=Math.max(X*ee,0),pe=new Uint8ClampedArray(te),ke={data:pe,width:X,height:ee,glyphWidth:R,glyphHeight:$,glyphTop:P,glyphLeft:0,glyphAdvance:l};if(R===0||$===0)return ke;const{ctx:Ae,buffer:Me,gridInner:ve,gridOuter:Fe}=this;Ae.clearRect(Me,Me,R,$),Ae.fillText(w,Me,Me+P);const rt=Ae.getImageData(Me,Me,R,$);Fe.fill(ye,0,te),ve.fill(0,0,te);for(let Le=0;Le<$;Le++)for(let Ge=0;Ge<R;Ge++){const ot=rt.data[4*(Le*R+Ge)+3]/255;if(ot===0)continue;const at=(Le+Me)*X+Ge+Me;if(ot===1)Fe[at]=0,ve[at]=ye;else{const ut=.5-ot;Fe[at]=ut>0?ut*ut:0,ve[at]=ut<0?ut*ut:0}}Oe(Fe,0,0,X,ee,X,this.f,this.v,this.z),Oe(ve,Me,Me,R,$,X,this.f,this.v,this.z);for(let Le=0;Le<te;Le++){const Ge=Math.sqrt(Fe[Le])-Math.sqrt(ve[Le]);pe[Le]=Math.round(255-255*(Ge/this.radius+this.cutoff))}return ke}};class xe{constructor(){this.specification=s.v.light.position}possiblyEvaluate(l,h){return s.y(l.expression.evaluate(h))}interpolate(l,h,_){return{x:s.z.number(l.x,h.x,_),y:s.z.number(l.y,h.y,_),z:s.z.number(l.z,h.z,_)}}}let et;class Ze extends s.E{constructor(l){super(),et=et||new s.q({anchor:new s.D(s.v.light.anchor),position:new xe,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(et),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h={}){if(!this._validate(s.r,l,h))for(const _ in l){const v=l[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),v):this._transitionable.setValue(_,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,_){return(!_||_.validate!==!1)&&s.t(this,l.call(s.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class Qe{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,h){const _=l.join(",")+String(h);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(l,h)),this.dashEntry[_]}getDashRanges(l,h,_){const v=[];let A=l.length%2==1?-l[l.length-1]*_:0,P=l[0]*_,R=!0;v.push({left:A,right:P,isDash:R,zeroLength:l[0]===0});let $=l[0];for(let X=1;X<l.length;X++){R=!R;const ee=l[X];A=$*_,$+=ee,P=$*_,v.push({left:A,right:P,isDash:R,zeroLength:ee===0})}return v}addRoundDash(l,h,_){const v=h/2;for(let A=-_;A<=_;A++){const P=this.width*(this.nextRow+_+A);let R=0,$=l[R];for(let X=0;X<this.width;X++){X/$.right>1&&($=l[++R]);const ee=Math.abs(X-$.left),te=Math.abs(X-$.right),pe=Math.min(ee,te);let ke;const Ae=A/_*(v+1);if($.isDash){const Me=v-Math.abs(Ae);ke=Math.sqrt(pe*pe+Me*Me)}else ke=v-Math.sqrt(pe*pe+Ae*Ae);this.data[P+X]=Math.max(0,Math.min(255,ke+128))}}}addRegularDash(l){for(let R=l.length-1;R>=0;--R){const $=l[R],X=l[R+1];$.zeroLength?l.splice(R,1):X&&X.isDash===$.isDash&&(X.left=$.left,l.splice(R,1))}const h=l[0],_=l[l.length-1];h.isDash===_.isDash&&(h.left=_.left-this.width,_.right=h.right+this.width);const v=this.width*this.nextRow;let A=0,P=l[A];for(let R=0;R<this.width;R++){R/P.right>1&&(P=l[++A]);const $=Math.abs(R-P.left),X=Math.abs(R-P.right),ee=Math.min($,X);this.data[v+R]=Math.max(0,Math.min(255,(P.isDash?ee:-ee)+128))}}addDash(l,h){const _=h?7:0,v=2*_+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let A=0;for(let R=0;R<l.length;R++)A+=l[R];if(A!==0){const R=this.width/A,$=this.getDashRanges(l,this.width,R);h?this.addRoundDash($,R,_):this.addRegularDash($)}const P={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:A};return this.nextRow+=v,this.dirty=!0,P}bind(l){const h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const ct="maplibre_preloaded_worker_pool";class dt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<dt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ct]}numActive(){return Object.keys(this.active).length}}const Je=Math.floor(y.hardwareConcurrency/2);let yt,Et;function Ot(){return yt||(yt=new dt),yt}dt.workerCount=s.B(globalThis)?Math.max(Math.min(Je,3),1):1;class Yt{constructor(l,h){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=h;const _=this.workerPool.acquire(h);for(let v=0;v<_.length;v++){const A=new s.C(_[v],h);A.name=`Worker ${v}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,h){const _=[];for(const v of this.actors)_.push(v.sendAsync({type:l,data:h}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,h){for(const _ of this.actors)_.registerMessageHandler(l,h)}}function tn(){return Et||(Et=new Yt(Ot(),s.G),Et.registerMessageHandler("GR",(w,l,h)=>s.m(l,h))),Et}function Qt(w,l){const h=s.F();return s.H(h,h,[1,1,0]),s.J(h,h,[.5*w.width,.5*w.height,1]),s.K(h,h,w.calculatePosMatrix(l.toUnwrapped()))}function fn(w,l,h,_,v,A){const P=function(te,pe,ke){if(te)for(const Ae of te){const Me=pe[Ae];if(Me&&Me.source===ke&&Me.type==="fill-extrusion")return!0}else for(const Ae in pe){const Me=pe[Ae];if(Me.source===ke&&Me.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,w.id),R=A.maxPitchScaleFactor(),$=w.tilesIn(_,R,P);$.sort(pn);const X=[];for(const te of $)X.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,h,w._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,v,A,R,Qt(w.transform,te.tileID))});const ee=function(te){const pe={},ke={};for(const Ae of te){const Me=Ae.queryResults,ve=Ae.wrappedTileID,Fe=ke[ve]=ke[ve]||{};for(const rt in Me){const Le=Me[rt],Ge=Fe[rt]=Fe[rt]||{},ot=pe[rt]=pe[rt]||[];for(const at of Le)Ge[at.featureIndex]||(Ge[at.featureIndex]=!0,ot.push(at))}}return pe}(X);for(const te in ee)ee[te].forEach(pe=>{const ke=pe.feature,Ae=w.getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Ae});return ee}function pn(w,l){const h=w.tileID,_=l.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function He(w,l,h){return s._(this,void 0,void 0,function*(){let _=w;if(w.url?_=(yield s.h(l.transformRequest(w.url,"Source"),h)).data:yield y.frameAsync(h),!_)return null;const v=s.L(s.e(_,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(v.vectorLayerIds=_.vector_layers.map(A=>A.id)),v})}class We{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}extend(l){const h=this._sw,_=this._ne;let v,A;if(l instanceof s.M)v=l,A=l;else{if(!(l instanceof We))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(We.convert(l)):this.extend(s.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.M.convert(l)):this;if(v=l._sw,A=l._ne,!v||!A)return this}return h||_?(h.lng=Math.min(v.lng,h.lng),h.lat=Math.min(v.lat,h.lat),_.lng=Math.max(A.lng,_.lng),_.lat=Math.max(A.lat,_.lat)):(this._sw=new s.M(v.lng,v.lat),this._ne=new s.M(A.lng,A.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:_}=s.M.convert(l);let v=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&v}static convert(l){return l instanceof We?l:l&&new We(l)}static fromLngLat(l,h=0){const _=360*h/40075017,v=_/Math.cos(Math.PI/180*l.lat);return new We(new s.M(l.lng-v,l.lat-_),new s.M(l.lng+v,l.lat+_))}}class mt{constructor(l,h,_){this.bounds=We.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),_=Math.floor(s.N(this.bounds.getWest())*h),v=Math.floor(s.O(this.bounds.getNorth())*h),A=Math.ceil(s.N(this.bounds.getEast())*h),P=Math.ceil(s.O(this.bounds.getSouth())*h);return l.x>=_&&l.x<A&&l.y>=v&&l.y<P}}class Pt extends s.E{constructor(l,h,_,v){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(h,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield He(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new mt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(h,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((A,P)=>{l.reloadPromise={resolve:A,reject:P}})}else l.actor=this.dispatcher.getActor(),v="LT";l.abortController=new AbortController;try{const A=yield l.actor.sendAsync({type:v,data:_},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,A)}catch(A){if(delete l.abortController,l.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,h){if(h&&h.resourceTiming&&(l.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&l.setExpiryData(h),l.loadVectorData(h,this.map.painter),l.reloadPromise){const _=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(_.resolve).catch(_.reject)}}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class he extends s.E{constructor(l,h,_,v){super(),this.id=l,this.dispatcher=_,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},h),s.e(this,s.L(h,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield He(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new mt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const _=yield B.getImage(this.map._requestManager.transformRequest(h,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&l.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const v=this.map.painter.context,A=v.gl,P=_.data;l.texture=this.map.painter.getTileTexture(P.width),l.texture?l.texture.update(P,{useMipmap:!0}):(l.texture=new J(v,P,A.RGBA,{useMipmap:!0}),l.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(_){if(delete l.abortController,l.aborted)l.state="unloaded";else if(_)throw l.state="errored",_}})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class nn extends he{constructor(l,h,_,v){super(l,h,_,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(h,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const v=yield B.getImage(_,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){const A=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const P=s.b(A)&&s.S()?A:yield this.readImageNow(A),R={type:this.type,uid:l.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const $=yield l.actor.sendAsync({type:"LDT",data:R});l.dem=$,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}})}readImageNow(l){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const h=l.width+2,_=l.height+2;try{return new s.R({width:h,height:_},yield s.V(l,-1,-1,h,_))}catch{}}return y.getImageData(l,1)})}_getNeighboringTiles(l){const h=l.canonical,_=Math.pow(2,h.z),v=(h.x-1+_)%_,A=h.x===0?l.wrap-1:l.wrap,P=(h.x+1+_)%_,R=h.x+1===_?l.wrap+1:l.wrap,$={};return $[new s.Q(l.overscaledZ,A,h.z,v,h.y).key]={backfilled:!1},$[new s.Q(l.overscaledZ,R,h.z,P,h.y).key]={backfilled:!1},h.y>0&&($[new s.Q(l.overscaledZ,A,h.z,v,h.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,R,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<_&&($[new s.Q(l.overscaledZ,A,h.z,v,h.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,R,h.z,P,h.y+1).key]={backfilled:!1}),$}unloadTile(l){return s._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Pe extends s.E{constructor(l,h,_,v){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(v),this._data=h.data,this._options=s.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const A=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*A,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*A,extent:s.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.W,radius:(h.clusterRadius||50)*A,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,h,_){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:h,offset:_}})}_updateWorkerData(l){return s._(this,void 0,void 0,function*(){const h=s.e({type:this.type},this.workerOptions);l?h.dataDiff=l:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let v=null;_.resourceTiming&&_.resourceTiming[this.id]&&(v=_.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(A,{resourceTiming:v}),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.actor?"RT":"LT";l.actor=this.actor;const _={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const v=yield this.actor.sendAsync({type:h,data:_},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(v,this.map.painter,h==="RT")})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tt=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class jt extends s.E{constructor(l,h,_,v){super(),this.id=l,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h}load(l){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield B.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,l&&(this.coordinates=l),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new s.j(h))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const h=l.map(s.Y.fromLngLat);this.tileID=function(v){let A=1/0,P=1/0,R=-1/0,$=-1/0;for(const pe of v)A=Math.min(A,pe.x),P=Math.min(P,pe.y),R=Math.max(R,pe.x),$=Math.max($,pe.y);const X=Math.max(R-A,$-P),ee=Math.max(0,Math.floor(-Math.log(X)/Math.LN2)),te=Math.pow(2,ee);return new s.a0(ee,Math.floor((A+R)/2*te),Math.floor((P+$)/2*te))}(h),this.minzoom=this.maxzoom=this.tileID.z;const _=h.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,s.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,s.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new J(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Gn extends jt{constructor(l,h,_,v){super(l,h,_,v),this.roundZoom=!0,this.type="video",this.options=h}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const h of l.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield s.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new s.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new J(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let _=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Un extends jt{constructor(l,h,_,v){super(l,h,_,v),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(P=>typeof P!="number"))||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,_=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new J(h,this.canvas,_.RGBA,{premultiply:!0});let v=!1;for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,v=!0)}v&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const jn={},Wt=w=>{switch(w){case"geojson":return Pe;case"image":return jt;case"raster":return he;case"raster-dem":return nn;case"vector":return Pt;case"video":return Gn;case"canvas":return Un}return jn[w]},An="RTLPluginLoaded";class ti extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=tn()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,function*(h,_=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!_)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(An))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Bn=null;function _t(){return Bn||(Bn=new ti),Bn}class mr{constructor(l,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=s.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const h=l+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,h,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,A){const P={};if(!A)return P;for(const R of v){const $=R.layerIds.map(X=>A.getLayer(X)).filter(Boolean);if($.length!==0){R.layers=$,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(X=>$.filter(ee=>ee.id===X)[0]));for(const X of $)P[X.id]=R}}return P}(l.buckets,h.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5){if(this.hasSymbolBuckets=!0,!_)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5&&A.hasRTLText){this.hasRTLText=!0,_t().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const A=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(v).queryRadius(A))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const _ in this.buckets){const v=this.buckets[_];v.uploadPending()&&v.upload(l)}const h=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new J(l,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new J(l,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,h,_,v,A,P,R,$,X,ee){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:A,scale:P,tileSize:this.tileSize,pixelPosMatrix:ee,transform:$,params:R,queryPadding:this.queryPadding*X},l,h,_):{}}querySourceFeatures(l,h){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const v=_.loadVTLayers(),A=h&&h.sourceLayer?h.sourceLayer:"",P=v._geojsonTileLayer||v[A];if(!P)return;const R=s.a6(h&&h.filter),{z:$,x:X,y:ee}=this.tileID.canonical,te={z:$,x:X,y:ee};for(let pe=0;pe<P.length;pe++){const ke=P.feature(pe);if(R.needGeometry){const ve=s.a7(ke,!0);if(!R.filter(new s.a8(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!R.filter(new s.a8(this.tileID.overscaledZ),ke))continue;const Ae=_.getId(ke,A),Me=new s.a9(ke,$,X,ee,Ae);Me.tile=te,l.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const h=this.expirationTime;if(l.cacheControl){const _=s.aa(l.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const _=Date.now();let v=!1;if(this.expirationTime>_)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const A=this.expirationTime-h;A?this.expirationTime=_+Math.max(A,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!h.style.hasLayer(v))continue;const A=this.buckets[v],P=A.layers[0].sourceLayer||"_geojsonTileLayer",R=_[P],$=l[P];if(!R||!$||Object.keys($).length===0)continue;A.update($,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const X=h&&h.style&&h.style.getLayer(v);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=y.now()+l}setDependencies(l,h){const _={};for(const v of h)_[v]=!0;this.dependencies[l]=_}hasDependency(l,h){for(const _ of l){const v=this.dependencies[_];if(v){for(const A of h)if(v[A])return!0}}return!1}}class ar{constructor(l,h){this.max=l,this.onRemove=h,this.reset()}reset(){for(const l in this.data)for(const h of this.data[l])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(l,h,_){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const A={value:h,timeout:void 0};if(_!==void 0&&(A.timeout=setTimeout(()=>{this.remove(l,A)},_)),this.data[v].push(A),this.order.push(v),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value}getByKey(l){const h=this.data[l];return h?h[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,h){if(!this.has(l))return this;const _=l.wrapped().key,v=h===void 0?0:this.data[_].indexOf(h),A=this.data[_][v];return this.data[_].splice(v,1),A.timeout&&clearTimeout(A.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(A.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(l){const h=[];for(const _ in this.data)for(const v of this.data[_])l(v.value)||h.push(v);for(const _ of h)this.remove(_.value.tileID,_)}}class gi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,h,_){const v=String(h);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},s.e(this.stateChanges[l][v],_),this.deletedStates[l]===null){this.deletedStates[l]={};for(const A in this.state[l])A!==v&&(this.deletedStates[l][A]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const A in this.state[l][v])_[A]||(this.deletedStates[l][v][A]=null)}else for(const A in _)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][A]===null&&delete this.deletedStates[l][v][A]}removeFeatureState(l,h,_){if(this.deletedStates[l]===null)return;const v=String(h);if(this.deletedStates[l]=this.deletedStates[l]||{},_&&h!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][_]=null);else if(h!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(_ in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][_]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,h){const _=String(h),v=s.e({},(this.state[l]||{})[_],(this.stateChanges[l]||{})[_]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const A=this.deletedStates[l][h];if(A===null)return{};for(const P in A)delete v[P]}return v}initializeTileState(l,h){l.setFeatureState(this.state,h)}coalesceChanges(l,h){const _={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const A={};for(const P in this.stateChanges[v])this.state[v][P]||(this.state[v][P]={}),s.e(this.state[v][P],this.stateChanges[v][P]),A[P]=this.state[v][P];_[v]=A}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const A={};if(this.deletedStates[v]===null)for(const P in this.state[v])A[P]={},this.state[v][P]={};else for(const P in this.deletedStates[v]){if(this.deletedStates[v][P]===null)this.state[v][P]={};else for(const R of Object.keys(this.deletedStates[v][P]))delete this.state[v][P][R];A[P]=this.state[v][P]}_[v]=_[v]||{},s.e(_[v],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const v in l)l[v].setFeatureState(_,h)}}class Vn extends s.E{constructor(l,h,_){super(),this.id=l,this.dispatcher=_,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,A,P,R)=>{const $=new(Wt(A.type))(v,A,P,R);if($.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${$.id}`);return $})(l,h,_,this),this._tiles={},this._cache=new ar(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gi,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,h,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,h,_)}catch(v){l.state="errored",v.status!==404?this._source.fire(new s.j(v,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const _=this._tiles[h];_.upload(l),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort($e).map(l=>l.key)}getRenderableIds(l){const h=[];for(const _ in this._tiles)this._isIdRenderable(_,l)&&h.push(this._tiles[_]);return l?h.sort((_,v)=>{const A=_.tileID,P=v.tileID,R=new s.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),$=new s.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-P.overscaledZ||$.y-R.y||$.x-R.x}).map(_=>_.tileID.key):h.map(_=>_.tileID).sort($e).map(_=>_.key)}hasRenderableParent(l){const h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,h){return s._(this,void 0,void 0,function*(){const _=this._tiles[l];_&&(_.state!=="loading"&&(_.state=h),yield this._loadTile(_,l,h))})}_tileLoaded(l,h,_){l.timeAdded=y.now(),_==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const h=this.getRenderableIds();for(let v=0;v<h.length;v++){const A=h[v];if(l.neighboringTiles&&l.neighboringTiles[A]){const P=this.getTileByID(A);_(l,P),_(P,l)}}function _(v,A){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let P=A.tileID.canonical.x-v.tileID.canonical.x;const R=A.tileID.canonical.y-v.tileID.canonical.y,$=Math.pow(2,v.tileID.canonical.z),X=A.tileID.key;P===0&&R===0||Math.abs(R)>1||(Math.abs(P)>1&&(Math.abs(P+$)===1?P+=$:Math.abs(P-$)===1&&(P-=$)),A.dem&&v.dem&&(v.dem.backfillBorder(A.dem,P,R),v.neighboringTiles&&v.neighboringTiles[X]&&(v.neighboringTiles[X].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,h,_,v){for(const A in this._tiles){let P=this._tiles[A];if(v[A]||!P.hasData()||P.tileID.overscaledZ<=h||P.tileID.overscaledZ>_)continue;let R=P.tileID;for(;P&&P.tileID.overscaledZ>h+1;){const X=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[X.key],P&&P.hasData()&&(R=X)}let $=R;for(;$.overscaledZ>h;)if($=$.scaledTo($.overscaledZ-1),l[$.key]){v[R.key]=R;break}}}findLoadedParent(l,h){if(l.key in this._loadedParentTiles){const _=this._loadedParentTiles[l.key];return _&&_.tileID.overscaledZ>=h?_:null}for(let _=l.overscaledZ-1;_>=h;_--){const v=l.scaledTo(_),A=this._getLoadedTile(v);if(A)return A}}_getLoadedTile(l){const h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const h=Math.ceil(l.width/this._source.tileSize)+1,_=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(h*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(A)}handleWrapJump(l){const h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){const _={};for(const v in this._tiles){const A=this._tiles[v];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),_[A.tileID.key]=A}this._tiles=_;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,h){if(!this._sourceLoaded||this._paused)return;let _;this.transform=l,this.terrain=h,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(ee=>new s.Q(ee.canonical.z,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y)):(_=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(_=_.filter(ee=>this._source.hasTile(ee)))):_=[];const v=l.coveringZoomLevel(this._source),A=Math.max(v-Vn.maxOverzooming,this._source.minzoom),P=Math.max(v+Vn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const ee={};for(const te of _)if(te.canonical.z>this._source.minzoom){const pe=te.scaledTo(te.canonical.z-1);ee[pe.key]=pe;const ke=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));ee[ke.key]=ke}_=_.concat(Object.values(ee))}const R=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const $=this._updateRetainedTiles(_,v);if(pt(this._source.type)){const ee={},te={},pe=Object.keys($),ke=y.now();for(const Ae of pe){const Me=$[Ae],ve=this._tiles[Ae];if(!ve||ve.fadeEndTime!==0&&ve.fadeEndTime<=ke)continue;const Fe=this.findLoadedParent(Me,A);Fe&&(this._addTile(Fe.tileID),ee[Fe.tileID.key]=Fe.tileID),te[Ae]=Me}this._retainLoadedChildren(te,v,P,$);for(const Ae in ee)$[Ae]||(this._coveredTiles[Ae]=!0,$[Ae]=ee[Ae]);if(h){const Ae={},Me={};for(const ve of _)this._tiles[ve.key].hasData()?Ae[ve.key]=ve:Me[ve.key]=ve;for(const ve in Me){const Fe=Me[ve].children(this._source.maxzoom);this._tiles[Fe[0].key]&&this._tiles[Fe[1].key]&&this._tiles[Fe[2].key]&&this._tiles[Fe[3].key]&&(Ae[Fe[0].key]=$[Fe[0].key]=Fe[0],Ae[Fe[1].key]=$[Fe[1].key]=Fe[1],Ae[Fe[2].key]=$[Fe[2].key]=Fe[2],Ae[Fe[3].key]=$[Fe[3].key]=Fe[3],delete Me[ve])}for(const ve in Me){const Fe=this.findLoadedParent(Me[ve],this._source.minzoom);if(Fe){Ae[Fe.tileID.key]=$[Fe.tileID.key]=Fe.tileID;for(const rt in Ae)Ae[rt].isChildOf(Fe.tileID)&&delete Ae[rt]}}for(const ve in this._tiles)Ae[ve]||(this._coveredTiles[ve]=!0)}}for(const ee in $)this._tiles[ee].clearFadeHold();const X=s.ab(this._tiles,$);for(const ee of X){const te=this._tiles[ee];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(ee)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,h){const _={},v={},A=Math.max(h-Vn.maxOverzooming,this._source.minzoom),P=Math.max(h+Vn.maxUnderzooming,this._source.minzoom),R={};for(const $ of l){const X=this._addTile($);_[$.key]=$,X.hasData()||h<this._source.maxzoom&&(R[$.key]=$)}this._retainLoadedChildren(R,h,P,_);for(const $ of l){let X=this._tiles[$.key];if(X.hasData())continue;if(h+1>this._source.maxzoom){const te=$.children(this._source.maxzoom)[0],pe=this.getTile(te);if(pe&&pe.hasData()){_[te.key]=te;continue}}else{const te=$.children(this._source.maxzoom);if(_[te[0].key]&&_[te[1].key]&&_[te[2].key]&&_[te[3].key])continue}let ee=X.wasRequested();for(let te=$.overscaledZ-1;te>=A;--te){const pe=$.scaledTo(te);if(v[pe.key])break;if(v[pe.key]=!0,X=this.getTile(pe),!X&&ee&&(X=this._addTile(pe)),X){const ke=X.hasData();if((ee||ke)&&(_[pe.key]=pe),ee=X.wasRequested(),ke)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const h=[];let _,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){_=this._loadedParentTiles[v.key];break}h.push(v.key);const A=v.scaledTo(v.overscaledZ-1);if(_=this._getLoadedTile(A),_)break;v=A}for(const A of h)this._loadedParentTiles[A]=_}}_addTile(l){let h=this._tiles[l.key];if(h)return h;h=this._cache.getAndRemove(l),h&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));const _=h;return h||(h=new mr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,l.key,h.state)),h.uses++,this._tiles[l.key]=h,_||this._source.fire(new s.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(l,h){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const _=h.getExpiryTimeout();_&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},_))}_removeTile(l){const h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(l){const h=l.sourceDataType;l.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,h,_){const v=[],A=this.transform;if(!A)return v;const P=_?A.getCameraQueryGeometry(l):l,R=l.map(Ae=>A.pointCoordinate(Ae,this.terrain)),$=P.map(Ae=>A.pointCoordinate(Ae,this.terrain)),X=this.getIds();let ee=1/0,te=1/0,pe=-1/0,ke=-1/0;for(const Ae of $)ee=Math.min(ee,Ae.x),te=Math.min(te,Ae.y),pe=Math.max(pe,Ae.x),ke=Math.max(ke,Ae.y);for(let Ae=0;Ae<X.length;Ae++){const Me=this._tiles[X[Ae]];if(Me.holdingForFade())continue;const ve=Me.tileID,Fe=Math.pow(2,A.zoom-Me.tileID.overscaledZ),rt=h*Me.queryPadding*s.W/Me.tileSize/Fe,Le=[ve.getTilePoint(new s.Y(ee,te)),ve.getTilePoint(new s.Y(pe,ke))];if(Le[0].x-rt<s.W&&Le[0].y-rt<s.W&&Le[1].x+rt>=0&&Le[1].y+rt>=0){const Ge=R.map(at=>ve.getTilePoint(at)),ot=$.map(at=>ve.getTilePoint(at));v.push({tile:Me,tileID:ve,queryGeometry:Ge,cameraQueryGeometry:ot,scale:Fe})}}return v}getVisibleCoordinates(l){const h=this.getRenderableIds(l).map(_=>this._tiles[_].tileID);for(const _ of h)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(pt(this._source.type)){const l=y.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=l)return!0}return!1}setFeatureState(l,h,_){this._state.updateState(l=l||"_geojsonTileLayer",h,_)}removeFeatureState(l,h,_){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,_)}getFeatureState(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)}setDependencies(l,h,_){const v=this._tiles[l];v&&v.setDependencies(h,_)}reloadTilesForDependencies(l,h){for(const _ in this._tiles)this._tiles[_].hasDependency(l,h)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(l,h))}}function $e(w,l){const h=Math.abs(2*w.wrap)-+(w.wrap<0),_=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||_-h||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function pt(w){return w==="raster"||w==="image"||w==="video"}Vn.maxOverzooming=10,Vn.maxUnderzooming=3;class vt{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ac(l,0,1);let h=1,_=this._distances[h];const v=l*this.paddedLength+this.padding;for(;_<v&&h<this._distances.length;)_=this._distances[++h];const A=h-1,P=this._distances[A],R=_-P,$=R>0?(v-P)/R:0;return this.points[A].mult(1-$).add(this.points[h].mult($))}}function Dt(w,l){let h=!0;return w==="always"||w!=="never"&&l!=="never"||(h=!1),h}class rn{constructor(l,h,_){const v=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(h/_);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,_,v,A){this._forEachCell(h,_,v,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(v),this.bboxes.push(A)}insertCircle(l,h,_,v){this._forEachCell(h-v,_-v,h+v,_+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(_),this.circles.push(v)}_insertBoxCell(l,h,_,v,A,P){this.boxCells[A].push(P)}_insertCircleCell(l,h,_,v,A,P){this.circleCells[A].push(P)}_query(l,h,_,v,A,P,R){if(_<0||l>this.width||v<0||h>this.height)return[];const $=[];if(l<=0&&h<=0&&this.width<=_&&this.height<=v){if(A)return[{key:null,x1:l,y1:h,x2:_,y2:v}];for(let X=0;X<this.boxKeys.length;X++)$.push({key:this.boxKeys[X],x1:this.bboxes[4*X],y1:this.bboxes[4*X+1],x2:this.bboxes[4*X+2],y2:this.bboxes[4*X+3]});for(let X=0;X<this.circleKeys.length;X++){const ee=this.circles[3*X],te=this.circles[3*X+1],pe=this.circles[3*X+2];$.push({key:this.circleKeys[X],x1:ee-pe,y1:te-pe,x2:ee+pe,y2:te+pe})}}else this._forEachCell(l,h,_,v,this._queryCell,$,{hitTest:A,overlapMode:P,seenUids:{box:{},circle:{}}},R);return $}query(l,h,_,v){return this._query(l,h,_,v,!1,null)}hitTest(l,h,_,v,A,P){return this._query(l,h,_,v,!0,A,P).length>0}hitTestCircle(l,h,_,v,A){const P=l-_,R=l+_,$=h-_,X=h+_;if(R<0||P>this.width||X<0||$>this.height)return!1;const ee=[];return this._forEachCell(P,$,R,X,this._queryCellCircle,ee,{hitTest:!0,overlapMode:v,circle:{x:l,y:h,radius:_},seenUids:{box:{},circle:{}}},A),ee.length>0}_queryCell(l,h,_,v,A,P,R,$){const{seenUids:X,hitTest:ee,overlapMode:te}=R,pe=this.boxCells[A];if(pe!==null){const Ae=this.bboxes;for(const Me of pe)if(!X.box[Me]){X.box[Me]=!0;const ve=4*Me,Fe=this.boxKeys[Me];if(l<=Ae[ve+2]&&h<=Ae[ve+3]&&_>=Ae[ve+0]&&v>=Ae[ve+1]&&(!$||$(Fe))&&(!ee||!Dt(te,Fe.overlapMode))&&(P.push({key:Fe,x1:Ae[ve],y1:Ae[ve+1],x2:Ae[ve+2],y2:Ae[ve+3]}),ee))return!0}}const ke=this.circleCells[A];if(ke!==null){const Ae=this.circles;for(const Me of ke)if(!X.circle[Me]){X.circle[Me]=!0;const ve=3*Me,Fe=this.circleKeys[Me];if(this._circleAndRectCollide(Ae[ve],Ae[ve+1],Ae[ve+2],l,h,_,v)&&(!$||$(Fe))&&(!ee||!Dt(te,Fe.overlapMode))){const rt=Ae[ve],Le=Ae[ve+1],Ge=Ae[ve+2];if(P.push({key:Fe,x1:rt-Ge,y1:Le-Ge,x2:rt+Ge,y2:Le+Ge}),ee)return!0}}}return!1}_queryCellCircle(l,h,_,v,A,P,R,$){const{circle:X,seenUids:ee,overlapMode:te}=R,pe=this.boxCells[A];if(pe!==null){const Ae=this.bboxes;for(const Me of pe)if(!ee.box[Me]){ee.box[Me]=!0;const ve=4*Me,Fe=this.boxKeys[Me];if(this._circleAndRectCollide(X.x,X.y,X.radius,Ae[ve+0],Ae[ve+1],Ae[ve+2],Ae[ve+3])&&(!$||$(Fe))&&!Dt(te,Fe.overlapMode))return P.push(!0),!0}}const ke=this.circleCells[A];if(ke!==null){const Ae=this.circles;for(const Me of ke)if(!ee.circle[Me]){ee.circle[Me]=!0;const ve=3*Me,Fe=this.circleKeys[Me];if(this._circlesCollide(Ae[ve],Ae[ve+1],Ae[ve+2],X.x,X.y,X.radius)&&(!$||$(Fe))&&!Dt(te,Fe.overlapMode))return P.push(!0),!0}}}_forEachCell(l,h,_,v,A,P,R,$){const X=this._convertToXCellCoord(l),ee=this._convertToYCellCoord(h),te=this._convertToXCellCoord(_),pe=this._convertToYCellCoord(v);for(let ke=X;ke<=te;ke++)for(let Ae=ee;Ae<=pe;Ae++)if(A.call(this,l,h,_,v,this.xCellCount*Ae+ke,P,R,$))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,_,v,A,P){const R=v-l,$=A-h,X=_+P;return X*X>R*R+$*$}_circleAndRectCollide(l,h,_,v,A,P,R){const $=(P-v)/2,X=Math.abs(l-(v+$));if(X>$+_)return!1;const ee=(R-A)/2,te=Math.abs(h-(A+ee));if(te>ee+_)return!1;if(X<=$||te<=ee)return!0;const pe=X-$,ke=te-ee;return pe*pe+ke*ke<=_*_}}function en(w,l,h,_,v){const A=s.F();return l?(s.J(A,A,[1/v,1/v,1]),h||s.ad(A,A,_.angle)):s.K(A,_.labelPlaneMatrix,w),A}function br(w,l,h,_,v){if(l){const A=s.ae(w);return s.J(A,A,[v,v,1]),h||s.ad(A,A,-_.angle),A}return _.glCoordMatrix}function lr(w,l,h){let _;h?(_=[w.x,w.y,h(w.x,w.y),1],s.af(_,_,l)):(_=[w.x,w.y,0,1],ft(_,_,l));const v=_[3];return{point:new s.P(_[0]/v,_[1]/v),signedDistanceFromCamera:v}}function Se(w,l){return .5+w/l*.5}function re(w,l){const h=w[0]/w[3],_=w[1]/w[3];return h>=-l[0]&&h<=l[0]&&_>=-l[1]&&_<=l[1]}function ce(w,l,h,_,v,A,P,R,$,X){const ee=_?w.textSizeData:w.iconSizeData,te=s.ag(ee,h.transform.zoom),pe=[256/h.width*2+1,256/h.height*2+1],ke=_?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;ke.clear();const Ae=w.lineVertexArray,Me=_?w.text.placedSymbolArray:w.icon.placedSymbolArray,ve=h.transform.width/h.transform.height;let Fe=!1;for(let rt=0;rt<Me.length;rt++){const Le=Me.get(rt);if(Le.hidden||Le.writingMode===s.ah.vertical&&!Fe){it(Le.numGlyphs,ke);continue}let Ge;if(Fe=!1,X?(Ge=[Le.anchorX,Le.anchorY,X(Le.anchorX,Le.anchorY),1],s.af(Ge,Ge,l)):(Ge=[Le.anchorX,Le.anchorY,0,1],ft(Ge,Ge,l)),!re(Ge,pe)){it(Le.numGlyphs,ke);continue}const ot=Se(h.transform.cameraToCenterDistance,Ge[3]),at=s.ai(ee,te,Le),ut=P?at/ot:at*ot,At=new s.P(Le.anchorX,Le.anchorY),bt=lr(At,v,X).point,Rt={projections:{},offsets:{}},Ft=Ne(Le,ut,!1,R,l,v,A,w.glyphOffsetArray,Ae,ke,bt,At,Rt,ve,$,X);Fe=Ft.useVertical,(Ft.notEnoughRoom||Fe||Ft.needsFlipping&&Ne(Le,ut,!0,R,l,v,A,w.glyphOffsetArray,Ae,ke,bt,At,Rt,ve,$,X).notEnoughRoom)&&it(Le.numGlyphs,ke)}_?w.text.dynamicLayoutVertexBuffer.updateData(ke):w.icon.dynamicLayoutVertexBuffer.updateData(ke)}function me(w,l,h,_,v,A,P,R,$,X,ee,te,pe){const ke=R.glyphStartIndex+R.numGlyphs,Ae=R.lineStartIndex,Me=R.lineStartIndex+R.lineLength,ve=l.getoffsetX(R.glyphStartIndex),Fe=l.getoffsetX(ke-1),rt=Ye(w*ve,h,_,v,A,P,R.segment,Ae,Me,$,X,ee,te,pe);if(!rt)return null;const Le=Ye(w*Fe,h,_,v,A,P,R.segment,Ae,Me,$,X,ee,te,pe);return Le?{first:rt,last:Le}:null}function we(w,l,h,_){return w===s.ah.horizontal&&Math.abs(h.y-l.y)>Math.abs(h.x-l.x)*_?{useVertical:!0}:(w===s.ah.vertical?l.y<h.y:l.x>h.x)?{needsFlipping:!0}:null}function Ne(w,l,h,_,v,A,P,R,$,X,ee,te,pe,ke,Ae,Me){const ve=l/24,Fe=w.lineOffsetX*ve,rt=w.lineOffsetY*ve;let Le;if(w.numGlyphs>1){const Ge=w.glyphStartIndex+w.numGlyphs,ot=w.lineStartIndex,at=w.lineStartIndex+w.lineLength,ut=me(ve,R,Fe,rt,h,ee,te,w,$,A,pe,Ae,Me);if(!ut)return{notEnoughRoom:!0};const At=lr(ut.first.point,P,Me).point,bt=lr(ut.last.point,P,Me).point;if(_&&!h){const Rt=we(w.writingMode,At,bt,ke);if(Rt)return Rt}Le=[ut.first];for(let Rt=w.glyphStartIndex+1;Rt<Ge-1;Rt++)Le.push(Ye(ve*R.getoffsetX(Rt),Fe,rt,h,ee,te,w.segment,ot,at,$,A,pe,Ae,Me));Le.push(ut.last)}else{if(_&&!h){const ot=lr(te,v,Me).point,at=w.lineStartIndex+w.segment+1,ut=new s.P($.getx(at),$.gety(at)),At=lr(ut,v,Me),bt=At.signedDistanceFromCamera>0?At.point:je(te,ut,ot,1,v,Me),Rt=we(w.writingMode,ot,bt,ke);if(Rt)return Rt}const Ge=Ye(ve*R.getoffsetX(w.glyphStartIndex),Fe,rt,h,ee,te,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,$,A,pe,Ae,Me);if(!Ge)return{notEnoughRoom:!0};Le=[Ge]}for(const Ge of Le)s.aj(X,Ge.point,Ge.angle);return{}}function je(w,l,h,_,v,A){const P=lr(w.add(w.sub(l)._unit()),v,A).point,R=h.sub(P);return h.add(R._mult(_/R.mag()))}function qe(w,l){const{projectionCache:h,lineVertexArray:_,labelPlaneMatrix:v,tileAnchorPoint:A,distanceFromAnchor:P,getElevation:R,previousVertex:$,direction:X,absOffsetX:ee}=l;if(h.projections[w])return h.projections[w];const te=new s.P(_.getx(w),_.gety(w)),pe=lr(te,v,R);if(pe.signedDistanceFromCamera>0)return h.projections[w]=pe.point,pe.point;const ke=w-X;return je(P===0?A:new s.P(_.getx(ke),_.gety(ke)),te,$,ee-P+1,v,R)}function Re(w,l,h){return w._unit()._perp()._mult(l*h)}function ie(w,l,h,_,v,A,P,R){const{projectionCache:$,direction:X}=R;if($.offsets[w])return $.offsets[w];const ee=h.add(l);if(w+X<_||w+X>=v)return $.offsets[w]=ee,ee;const te=qe(w+X,R),pe=Re(te.sub(h),P,X),ke=h.add(pe),Ae=te.add(pe);return $.offsets[w]=s.ak(A,ee,ke,Ae)||ee,$.offsets[w]}function Ye(w,l,h,_,v,A,P,R,$,X,ee,te,pe,ke){const Ae=_?w-l:w+l;let Me=Ae>0?1:-1,ve=0;_&&(Me*=-1,ve=Math.PI),Me<0&&(ve+=Math.PI);let Fe,rt,Le=Me>0?R+P:R+P+1,Ge=v,ot=v,at=0,ut=0;const At=Math.abs(Ae),bt=[];let Rt;for(;at+ut<=At;){if(Le+=Me,Le<R||Le>=$)return null;at+=ut,ot=Ge,rt=Fe;const $t={projectionCache:te,lineVertexArray:X,labelPlaneMatrix:ee,tileAnchorPoint:A,distanceFromAnchor:at,getElevation:ke,previousVertex:ot,direction:Me,absOffsetX:At};if(Ge=qe(Le,$t),h===0)bt.push(ot),Rt=Ge.sub(ot);else{let gn;const En=Ge.sub(ot);gn=En.mag()===0?Re(qe(Le+Me,$t).sub(Ge),h,Me):Re(En,h,Me),rt||(rt=ot.add(gn)),Fe=ie(Le,gn,Ge,R,$,rt,h,$t),bt.push(rt),Rt=Fe.sub(rt)}ut=Rt.mag()}const Ft=Rt._mult((At-at)/ut)._add(rt||ot),Mn=ve+Math.atan2(Ge.y-ot.y,Ge.x-ot.x);return bt.push(Ft),{point:Ft,angle:pe?Mn:0,path:bt}}const nt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function it(w,l){for(let h=0;h<w;h++){const _=l.length;l.resize(_+4),l.float32.set(nt,3*_)}}function ft(w,l,h){const _=l[0],v=l[1];return w[0]=h[0]*_+h[4]*v+h[12],w[1]=h[1]*_+h[5]*v+h[13],w[3]=h[3]*_+h[7]*v+h[15],w}const zt=100;class on{constructor(l,h=new rn(l.width+200,l.height+200,25),_=new rn(l.width+200,l.height+200,25)){this.transform=l,this.grid=h,this.ignoredGrid=_,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+zt,this.screenBottomBoundary=l.height+zt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,h,_,v,A,P){const R=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,P),$=_*R.perspectiveRatio,X=l.x1*$+R.point.x,ee=l.y1*$+R.point.y,te=l.x2*$+R.point.x,pe=l.y2*$+R.point.y;return!this.isInsideGrid(X,ee,te,pe)||h!=="always"&&this.grid.hitTest(X,ee,te,pe,h,A)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[X,ee,te,pe],offscreen:this.isOffscreen(X,ee,te,pe)}}placeCollisionCircles(l,h,_,v,A,P,R,$,X,ee,te,pe,ke,Ae){const Me=[],ve=new s.P(h.anchorX,h.anchorY),Fe=lr(ve,P,Ae),rt=Se(this.transform.cameraToCenterDistance,Fe.signedDistanceFromCamera),Le=(ee?A/rt:A*rt)/s.ao,Ge=lr(ve,R,Ae).point,ot=me(Le,v,h.lineOffsetX*Le,h.lineOffsetY*Le,!1,Ge,ve,h,_,R,{projections:{},offsets:{}},!1,Ae);let at=!1,ut=!1,At=!0;if(ot){const bt=.5*pe*rt+ke,Rt=new s.P(-100,-100),Ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Mn=new vt,$t=ot.first,gn=ot.last;let En=[];for(let Pn=$t.path.length-1;Pn>=1;Pn--)En.push($t.path[Pn]);for(let Pn=1;Pn<gn.path.length;Pn++)En.push(gn.path[Pn]);const Zn=2.5*bt;if($){const Pn=En.map(zn=>lr(zn,$,Ae));En=Pn.some(zn=>zn.signedDistanceFromCamera<=0)?[]:Pn.map(zn=>zn.point)}let kn=[];if(En.length>0){const Pn=En[0].clone(),zn=En[0].clone();for(let Or=1;Or<En.length;Or++)Pn.x=Math.min(Pn.x,En[Or].x),Pn.y=Math.min(Pn.y,En[Or].y),zn.x=Math.max(zn.x,En[Or].x),zn.y=Math.max(zn.y,En[Or].y);kn=Pn.x>=Rt.x&&zn.x<=Ft.x&&Pn.y>=Rt.y&&zn.y<=Ft.y?[En]:zn.x<Rt.x||Pn.x>Ft.x||zn.y<Rt.y||Pn.y>Ft.y?[]:s.al([En],Rt.x,Rt.y,Ft.x,Ft.y)}for(const Pn of kn){Mn.reset(Pn,.25*bt);let zn=0;zn=Mn.length<=.5*bt?1:Math.ceil(Mn.paddedLength/Zn)+1;for(let Or=0;Or<zn;Or++){const fr=Or/Math.max(zn-1,1),ro=Mn.lerp(fr),ri=ro.x+zt,Pr=ro.y+zt;Me.push(ri,Pr,bt,0);const ii=ri-bt,io=Pr-bt,Go=ri+bt,Ms=Pr+bt;if(At=At&&this.isOffscreen(ii,io,Go,Ms),ut=ut||this.isInsideGrid(ii,io,Go,Ms),l!=="always"&&this.grid.hitTestCircle(ri,Pr,bt,l,te)&&(at=!0,!X))return{circles:[],offscreen:!1,collisionDetected:at}}}}return{circles:!X&&at||!ut||rt<this.perspectiveRatioCutoff?[]:Me,offscreen:At,collisionDetected:at}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let _=1/0,v=1/0,A=-1/0,P=-1/0;for(const ee of l){const te=new s.P(ee.x+zt,ee.y+zt);_=Math.min(_,te.x),v=Math.min(v,te.y),A=Math.max(A,te.x),P=Math.max(P,te.y),h.push(te)}const R=this.grid.query(_,v,A,P).concat(this.ignoredGrid.query(_,v,A,P)),$={},X={};for(const ee of R){const te=ee.key;if($[te.bucketInstanceId]===void 0&&($[te.bucketInstanceId]={}),$[te.bucketInstanceId][te.featureIndex])continue;const pe=[new s.P(ee.x1,ee.y1),new s.P(ee.x2,ee.y1),new s.P(ee.x2,ee.y2),new s.P(ee.x1,ee.y2)];s.am(h,pe)&&($[te.bucketInstanceId][te.featureIndex]=!0,X[te.bucketInstanceId]===void 0&&(X[te.bucketInstanceId]=[]),X[te.bucketInstanceId].push(te.featureIndex))}return X}insertCollisionBox(l,h,_,v,A,P){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:A,collisionGroupID:P,overlapMode:h},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,_,v,A,P){const R=_?this.ignoredGrid:this.grid,$={bucketInstanceId:v,featureIndex:A,collisionGroupID:P,overlapMode:h};for(let X=0;X<l.length;X+=4)R.insertCircle($,l[X],l[X+1],l[X+2])}projectAndGetPerspectiveRatio(l,h,_,v){let A;return v?(A=[h,_,v(h,_),1],s.af(A,A,l)):(A=[h,_,0,1],ft(A,A,l)),{point:new s.P((A[0]/A[3]+1)/2*this.transform.width+zt,(-A[1]/A[3]+1)/2*this.transform.height+zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A[3]*.5}}isOffscreen(l,h,_,v){return _<zt||l>=this.screenRightBoundary||v<zt||h>this.screenBottomBoundary}isInsideGrid(l,h,_,v){return _>=0&&l<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=s.an([]);return s.H(l,l,[-100,-100,0]),l}}function mn(w,l,h){return l*(s.W/(w.tileSize*Math.pow(2,h-w.tileID.overscaledZ)))}class Ln{constructor(l,h,_,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):v&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class qn{constructor(l,h,_,v,A){this.text=new Ln(l?l.text:null,h,_,A),this.icon=new Ln(l?l.icon:null,h,v,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cr{constructor(l,h,_){this.text=l,this.icon=h,this.skipFade=_}}class Gr{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class In{constructor(l,h,_,v,A){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=v,this.tileID=A}}class Rr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[l]}}function ni(w,l,h,_,v){const{horizontalAlign:A,verticalAlign:P}=s.at(w);return new s.P(-(A-.5)*l+_[0]*v,-(P-.5)*h+_[1]*v)}function Ti(w,l,h,_,v,A){const{x1:P,x2:R,y1:$,y2:X,anchorPointX:ee,anchorPointY:te}=w,pe=new s.P(l,h);return _&&pe._rotate(v?A:-A),{x1:P+pe.x,y1:$+pe.y,x2:R+pe.x,y2:X+pe.y,anchorPointX:ee,anchorPointY:te}}class Oi{constructor(l,h,_,v,A){this.transform=l.clone(),this.terrain=h,this.collisionIndex=new on(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Rr(v),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,_,v){const A=_.getBucket(h),P=_.latestFeatureIndex;if(!A||!P||h.id!==A.layerIds[0])return;const R=_.collisionBoxArray,$=A.layers[0].layout,X=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),ee=_.tileSize/s.W,te=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),pe=$.get("text-pitch-alignment")==="map",ke=$.get("text-rotation-alignment")==="map",Ae=mn(_,1,this.transform.zoom),Me=en(te,pe,ke,this.transform,Ae);let ve=null;if(pe){const rt=br(te,pe,ke,this.transform,Ae);ve=s.K([],this.transform.labelPlaneMatrix,rt)}this.retainedQueryData[A.bucketInstanceId]=new In(A.bucketInstanceId,P,A.sourceLayerIndex,A.index,_.tileID);const Fe={bucket:A,layout:$,posMatrix:te,textLabelPlaneMatrix:Me,labelToScreenMatrix:ve,scale:X,textPixelRatio:ee,holdingForFade:_.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:s.ag(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(v)for(const rt of A.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ge,symbolInstanceEnd:ot}=rt;l.push({sortKey:Le,symbolInstanceStart:Ge,symbolInstanceEnd:ot,parameters:Fe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(l,h,_,v,A,P,R,$,X,ee,te,pe,ke,Ae,Me,ve){const Fe=s.ap[l.textAnchor],rt=[l.textOffset0,l.textOffset1],Le=ni(Fe,_,v,rt,A),Ge=this.collisionIndex.placeCollisionBox(Ti(h,Le.x,Le.y,P,R,this.transform.angle),te,$,X,ee.predicate,ve);if((!Me||this.collisionIndex.placeCollisionBox(Ti(Me,Le.x,Le.y,P,R,this.transform.angle),te,$,X,ee.predicate,ve).box.length!==0)&&Ge.box.length>0){let ot;if(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(ot=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),pe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[pe.crossTileID]={textOffset:rt,width:_,height:v,anchor:Fe,textBoxScale:A,prevAnchor:ot},this.markUsedJustification(ke,Fe,pe,Ae),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Ae,pe),this.placedOrientations[pe.crossTileID]=Ae),{shift:Le,placedGlyphBoxes:Ge}}}placeLayerBucketPart(l,h,_){const{bucket:v,layout:A,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:$,textPixelRatio:X,holdingForFade:ee,collisionBoxArray:te,partiallyEvaluatedTextSize:pe,collisionGroup:ke}=l.parameters,Ae=A.get("text-optional"),Me=A.get("icon-optional"),ve=s.aq(A,"text-overlap","text-allow-overlap"),Fe=ve==="always",rt=s.aq(A,"icon-overlap","icon-allow-overlap"),Le=rt==="always",Ge=A.get("text-rotation-alignment")==="map",ot=A.get("text-pitch-alignment")==="map",at=A.get("icon-text-fit")!=="none",ut=A.get("symbol-z-order")==="viewport-y",At=Fe&&(Le||!v.hasIconData()||Me),bt=Le&&(Fe||!v.hasTextData()||Ae);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te);const Rt=this.retainedQueryData[v.bucketInstanceId].tileID,Ft=this.terrain?($t,gn)=>this.terrain.getElevation(Rt,$t,gn):null,Mn=($t,gn)=>{var En,Zn;if(h[$t.crossTileID])return;if(ee)return void(this.placements[$t.crossTileID]=new Cr(!1,!1,!1));let kn=!1,Pn=!1,zn=!0,Or=null,fr={box:null,offscreen:null},ro={box:null,offscreen:null},ri=null,Pr=null,ii=null,io=0,Go=0,Ms=0;gn.textFeatureIndex?io=gn.textFeatureIndex:$t.useRuntimeCollisionCircles&&(io=$t.featureIndex),gn.verticalTextFeatureIndex&&(Go=gn.verticalTextFeatureIndex);const vl=gn.textBox;if(vl){const Zr=Xr=>{let Dr=s.ah.horizontal;if(v.allowVerticalPlacement&&!Xr&&this.prevPlacement){const go=this.prevPlacement.placedOrientations[$t.crossTileID];go&&(this.placedOrientations[$t.crossTileID]=go,Dr=go,this.markUsedOrientation(v,Dr,$t))}return Dr},zr=(Xr,Dr)=>{if(v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&gn.verticalTextBox){for(const go of v.writingModes)if(go===s.ah.vertical?(fr=Dr(),ro=fr):fr=Xr(),fr&&fr.box&&fr.box.length)break}else fr=Xr()},Mr=$t.textAnchorOffsetStartIndex,mo=$t.textAnchorOffsetEndIndex;if(mo===Mr){const Xr=(Dr,go)=>{const Kr=this.collisionIndex.placeCollisionBox(Dr,ve,X,P,ke.predicate,Ft);return Kr&&Kr.box&&Kr.box.length&&(this.markUsedOrientation(v,go,$t),this.placedOrientations[$t.crossTileID]=go),Kr};zr(()=>Xr(vl,s.ah.horizontal),()=>{const Dr=gn.verticalTextBox;return v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Dr?Xr(Dr,s.ah.vertical):{box:null,offscreen:null}}),Zr(fr&&fr.box&&fr.box.length)}else{let Xr=s.ap[(Zn=(En=this.prevPlacement)===null||En===void 0?void 0:En.variableOffsets[$t.crossTileID])===null||Zn===void 0?void 0:Zn.anchor];const Dr=(Kr,jr,qc)=>{const Yh=Kr.x2-Kr.x1,Xs=Kr.y2-Kr.y1,Ks=$t.textBoxScale,Au=at&&rt==="never"?jr:null;let Ls={box:[],offscreen:!1},Hc=ve==="never"?1:2,Qh="never";Xr&&Hc++;for(let Gc=0;Gc<Hc;Gc++){for(let Wc=Mr;Wc<mo;Wc++){const ku=v.textAnchorOffsets.get(Wc);if(Xr&&ku.textAnchor!==Xr)continue;const Zc=this.attemptAnchorPlacement(ku,Kr,Yh,Xs,Ks,Ge,ot,X,P,ke,Qh,$t,v,qc,Au,Ft);if(Zc&&(Ls=Zc.placedGlyphBoxes,Ls&&Ls.box&&Ls.box.length))return kn=!0,Or=Zc.shift,Ls}Xr?Xr=null:Qh=ve}return Ls};zr(()=>Dr(vl,gn.iconBox,s.ah.horizontal),()=>{const Kr=gn.verticalTextBox;return v.allowVerticalPlacement&&!(fr&&fr.box&&fr.box.length)&&$t.numVerticalGlyphVertices>0&&Kr?Dr(Kr,gn.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),fr&&(kn=fr.box,zn=fr.offscreen);const go=Zr(fr&&fr.box);if(!kn&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[$t.crossTileID];Kr&&(this.variableOffsets[$t.crossTileID]=Kr,this.markUsedJustification(v,Kr.anchor,$t,go))}}}if(ri=fr,kn=ri&&ri.box&&ri.box.length>0,zn=ri&&ri.offscreen,$t.useRuntimeCollisionCircles){const Zr=v.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),zr=s.ai(v.textSizeData,pe,Zr),Mr=A.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(ve,Zr,v.lineVertexArray,v.glyphOffsetArray,zr,P,R,$,_,ot,ke.predicate,$t.collisionCircleDiameter,Mr,Ft),Pr.circles.length&&Pr.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),kn=Fe||Pr.circles.length>0&&!Pr.collisionDetected,zn=zn&&Pr.offscreen}if(gn.iconFeatureIndex&&(Ms=gn.iconFeatureIndex),gn.iconBox){const Zr=zr=>{const Mr=at&&Or?Ti(zr,Or.x,Or.y,Ge,ot,this.transform.angle):zr;return this.collisionIndex.placeCollisionBox(Mr,rt,X,P,ke.predicate,Ft)};ro&&ro.box&&ro.box.length&&gn.verticalIconBox?(ii=Zr(gn.verticalIconBox),Pn=ii.box.length>0):(ii=Zr(gn.iconBox),Pn=ii.box.length>0),zn=zn&&ii.offscreen}const Es=Ae||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,Wo=Me||$t.numIconVertices===0;if(Es||Wo?Wo?Es||(Pn=Pn&&kn):kn=Pn&&kn:Pn=kn=Pn&&kn,kn&&ri&&ri.box&&this.collisionIndex.insertCollisionBox(ri.box,ve,A.get("text-ignore-placement"),v.bucketInstanceId,ro&&ro.box&&Go?Go:io,ke.ID),Pn&&ii&&this.collisionIndex.insertCollisionBox(ii.box,rt,A.get("icon-ignore-placement"),v.bucketInstanceId,Ms,ke.ID),Pr&&(kn&&this.collisionIndex.insertCollisionCircles(Pr.circles,ve,A.get("text-ignore-placement"),v.bucketInstanceId,io,ke.ID),_)){const Zr=v.bucketInstanceId;let zr=this.collisionCircleArrays[Zr];zr===void 0&&(zr=this.collisionCircleArrays[Zr]=new Gr);for(let Mr=0;Mr<Pr.circles.length;Mr+=4)zr.circles.push(Pr.circles[Mr+0]),zr.circles.push(Pr.circles[Mr+1]),zr.circles.push(Pr.circles[Mr+2]),zr.circles.push(Pr.collisionDetected?1:0)}if($t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new Cr(kn||At,Pn||bt,zn||v.justReloaded),h[$t.crossTileID]=!0};if(ut){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=v.getSortedSymbolIndexes(this.transform.angle);for(let gn=$t.length-1;gn>=0;--gn){const En=$t[gn];Mn(v.symbolInstances.get(En),v.collisionArrays[En])}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)Mn(v.symbolInstances.get($t),v.collisionArrays[$t]);if(_&&v.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[v.bucketInstanceId];s.ar($t.invProjMatrix,P),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,h,_,v){let A;A=v===s.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.as(h)];const P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const R of P)R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=A>=0&&R!==A?0:_.crossTileID)}markUsedOrientation(l,h,_){const v=h===s.ah.horizontal||h===s.ah.horizontalOnly?h:0,A=h===s.ah.vertical?h:0,P=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const R of P)l.text.placedSymbolArray.get(R).placedOrientation=v;_.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(l):1,A=h?h.opacities:{},P=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(const $ in this.placements){const X=this.placements[$],ee=A[$];ee?(this.opacities[$]=new qn(ee,v,X.text,X.icon),_=_||X.text!==ee.text.placed||X.icon!==ee.icon.placed):(this.opacities[$]=new qn(null,v,X.text,X.icon,X.skipFade),_=_||X.text||X.icon)}for(const $ in A){const X=A[$];if(!this.opacities[$]){const ee=new qn(X,v,!1,!1);ee.isHidden()||(this.opacities[$]=ee,_=_||X.text.placed||X.icon.placed)}}for(const $ in P)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=P[$]);for(const $ in R)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=R[$]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const _={};for(const v of h){const A=v.getBucket(l);A&&v.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,_,v.collisionBoxArray)}}updateBucketOpacities(l,h,_){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],A=v.layout,P=new qn(null,0,!1,!1,!0),R=A.get("text-allow-overlap"),$=A.get("icon-allow-overlap"),X=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ee=A.get("text-rotation-alignment")==="map",te=A.get("text-pitch-alignment")==="map",pe=A.get("icon-text-fit")!=="none",ke=new qn(null,0,R&&($||!l.hasIconData()||A.get("icon-optional")),$&&(R||!l.hasTextData()||A.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const Ae=(Me,ve,Fe)=>{for(let rt=0;rt<ve/4;rt++)Me.opacityVertexArray.emplaceBack(Fe);Me.hasVisibleVertices=Me.hasVisibleVertices||Fe!==Ja};for(let Me=0;Me<l.symbolInstances.length;Me++){const ve=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Fe,numVerticalGlyphVertices:rt,crossTileID:Le}=ve;let Ge=this.opacities[Le];h[Le]?Ge=P:Ge||(Ge=ke,this.opacities[Le]=Ge),h[Le]=!0;const ot=ve.numIconVertices>0,at=this.placedOrientations[ve.crossTileID],ut=at===s.ah.vertical,At=at===s.ah.horizontal||at===s.ah.horizontalOnly;if(Fe>0||rt>0){const bt=$i(Ge.text);Ae(l.text,Fe,ut?Ja:bt),Ae(l.text,rt,At?Ja:bt);const Rt=Ge.text.isHidden();[ve.rightJustifiedTextSymbolIndex,ve.centerJustifiedTextSymbolIndex,ve.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(l.text.placedSymbolArray.get($t).hidden=Rt||ut?1:0)}),ve.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(ve.verticalPlacedTextSymbolIndex).hidden=Rt||At?1:0);const Ft=this.variableOffsets[ve.crossTileID];Ft&&this.markUsedJustification(l,Ft.anchor,ve,at);const Mn=this.placedOrientations[ve.crossTileID];Mn&&(this.markUsedJustification(l,"left",ve,Mn),this.markUsedOrientation(l,Mn,ve))}if(ot){const bt=$i(Ge.icon),Rt=!(pe&&ve.verticalPlacedIconSymbolIndex&&ut);ve.placedIconSymbolIndex>=0&&(Ae(l.icon,ve.numIconVertices,Rt?bt:Ja),l.icon.placedSymbolArray.get(ve.placedIconSymbolIndex).hidden=Ge.icon.isHidden()),ve.verticalPlacedIconSymbolIndex>=0&&(Ae(l.icon,ve.numVerticalIconVertices,Rt?Ja:bt),l.icon.placedSymbolArray.get(ve.verticalPlacedIconSymbolIndex).hidden=Ge.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const bt=l.collisionArrays[Me];if(bt){let Rt=new s.P(0,0);if(bt.textBox||bt.verticalTextBox){let Mn=!0;if(X){const $t=this.variableOffsets[Le];$t?(Rt=ni($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),ee&&Rt._rotate(te?this.transform.angle:-this.transform.angle)):Mn=!1}bt.textBox&&mi(l.textCollisionBox.collisionVertexArray,Ge.text.placed,!Mn||ut,Rt.x,Rt.y),bt.verticalTextBox&&mi(l.textCollisionBox.collisionVertexArray,Ge.text.placed,!Mn||At,Rt.x,Rt.y)}const Ft=!!(!At&&bt.verticalIconBox);bt.iconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Ft,pe?Rt.x:0,pe?Rt.y:0),bt.verticalIconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!Ft,pe?Rt.x:0,pe?Rt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function mi(w,l,h,_,v){w.emplaceBack(l?1:0,h?1:0,_||0,v||0),w.emplaceBack(l?1:0,h?1:0,_||0,v||0),w.emplaceBack(l?1:0,h?1:0,_||0,v||0),w.emplaceBack(l?1:0,h?1:0,_||0,v||0)}const jo=Math.pow(2,25),mh=Math.pow(2,24),wp=Math.pow(2,17),ur=Math.pow(2,16),hc=Math.pow(2,9),dc=Math.pow(2,8),eo=Math.pow(2,1);function $i(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,h=Math.floor(127*w.opacity);return h*jo+l*mh+h*wp+l*ur+h*hc+l*dc+h*eo+l}const Ja=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,h,_,v,A){const P=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(P,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((R,$)=>R.sortKey-$.sortKey));this._currentPartIndex<P.length;)if(h.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,A())return!0;return!1}}class po{constructor(l,h,_,v,A,P,R,$){this.placement=new Oi(l,h,P,R,$),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(l,h,_){const v=y.now(),A=()=>!this._forceFullPlacement&&y.now()-v>2;for(;this._currentPlacementIndex>=0;){const P=h[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new ho(P)),this._inProgressLayer.continuePlacement(_[P.source],this.placement,this._showCollisionBoxes,P,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ha=512/s.W/2;class Ol{constructor(l,h,_){this.tileID=l,this.bucketInstanceId=_,this._symbolsByKey={};const v=new Map;for(let A=0;A<h.length;A++){const P=h.get(A),R=P.key,$=v.get(R);$?$.push(P):v.set(R,[P])}for(const[A,P]of v){const R={positions:P.map($=>({x:Math.floor($.anchorX*ha),y:Math.floor($.anchorY*ha)})),crossTileIDs:P.map($=>$.crossTileID)};if(R.positions.length>128){const $=new s.au(R.positions.length,16,Uint16Array);for(const{x:X,y:ee}of R.positions)$.add(X,ee);$.finish(),delete R.positions,R.index=$}this._symbolsByKey[A]=R}}getScaledCoordinates(l,h){const{x:_,y:v,z:A}=this.tileID.canonical,{x:P,y:R,z:$}=h.canonical,X=ha/Math.pow(2,$-A),ee=(R*s.W+l.anchorY)*X,te=v*s.W*ha;return{x:Math.floor((P*s.W+l.anchorX)*X-_*s.W*ha),y:Math.floor(ee-te)}}findMatches(l,h,_){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let A=0;A<l.length;A++){const P=l.get(A);if(P.crossTileID)continue;const R=this._symbolsByKey[P.key];if(!R)continue;const $=this.getScaledCoordinates(P,h);if(R.index){const X=R.index.range($.x-v,$.y-v,$.x+v,$.y+v).sort();for(const ee of X){const te=R.crossTileIDs[ee];if(!_[te]){_[te]=!0,P.crossTileID=te;break}}}else if(R.positions)for(let X=0;X<R.positions.length;X++){const ee=R.positions[X],te=R.crossTileIDs[X];if(Math.abs(ee.x-$.x)<=v&&Math.abs(ee.y-$.y)<=v&&!_[te]){_[te]=!0,P.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ya{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const _ in this.indexes){const v=this.indexes[_],A={};for(const P in v){const R=v[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),A[R.tileID.key]=R}this.indexes[_]=A}this.lng=l}addBucket(l,h,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<h.symbolInstances.length;A++)h.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const P=this.indexes[A];if(Number(A)>l.overscaledZ)for(const R in P){const $=P[R];$.tileID.isChildOf(l)&&$.findMatches(h.symbolInstances,l,v)}else{const R=P[l.scaledTo(Number(A)).key];R&&R.findMatches(h.symbolInstances,l,v)}}for(let A=0;A<h.symbolInstances.length;A++){const P=h.symbolInstances.get(A);P.crossTileID||(P.crossTileID=_.generate(),v[P.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ol(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const _ of h.getCrossTileIDsLists())for(const v of _)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let h=!1;for(const _ in this.indexes){const v=this.indexes[_];for(const A in v)l[v[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,v[A]),delete v[A],h=!0)}return h}}class xs{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,_){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new Ya);let A=!1;const P={};v.handleWrapJump(_);for(const R of h){const $=R.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(R.tileID,$,this.crossTileIDs)&&(A=!0),P[$.bucketInstanceId]=!0)}return v.removeStaleBuckets(P)&&(A=!0),A}pruneUnusedLayers(l){const h={};l.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Ir=(w,l)=>s.t(w,l&&l.filter(h=>h.identifier!=="source.canvas")),$l=s.av();class to extends s.E{constructor(l,h={}){super(),this._rtlPluginLoaded=()=>{for(const _ in this.sourceCaches){const v=this.sourceCaches[_].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[_].reload()}},this.map=l,this.dispatcher=new Yt(Ot(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(_,v)=>this.getGlyphs(_,v)),this.dispatcher.registerMessageHandler("GI",(_,v)=>this.getImages(_,v)),this.imageManager=new Ee,this.imageManager.setEventedParent(this),this.glyphManager=new De(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new xs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ax()),_t().on(An,this._rtlPluginLoaded),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.sourceCaches[_.sourceId];if(!v)return;const A=v.getSource();if(A&&A.vectorLayerIds)for(const P in this._layers){const R=this._layers[P];R.source===A.id&&this._validateLayer(R)}})}loadURL(l,h={},_){this.fire(new s.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const v=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,s.h(v,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,h,_)}).catch(A=>{this._loadStyleRequest=null,A&&this.fire(new s.j(A))})}loadJSON(l,h={},_){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(l,h,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load($l,{validate:!1})}_load(l,h,_){var v;const A=h.transformStyle?h.transformStyle(_,l):l;if(!h.validate||!Ir(this,s.x(A))){this._loaded=!0,this.stylesheet=A;for(const P in A.sources)this.addSource(P,A.sources[P],{validate:!1});A.sprite?this._loadSprite(A.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(A.glyphs),this._createLayers(),this.light=new Ze(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const l=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of l){const _=s.az(h);_.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=_}}_loadSprite(l,h=!1,_=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(A,P,R,$){return s._(this,void 0,void 0,function*(){const X=Ie(A),ee=R>1?"@2x":"",te={},pe={};for(const{id:ke,url:Ae}of X){const Me=P.transformRequest(P.normalizeSpriteURL(Ae,ee,".json"),"SpriteJSON");te[ke]=s.h(Me,$);const ve=P.transformRequest(P.normalizeSpriteURL(Ae,ee,".png"),"SpriteImage");pe[ke]=B.getImage(ve,$)}return yield Promise.all([...Object.values(te),...Object.values(pe)]),function(ke,Ae){return s._(this,void 0,void 0,function*(){const Me={};for(const ve in ke){Me[ve]={};const Fe=y.getImageCanvasContext((yield Ae[ve]).data),rt=(yield ke[ve]).data;for(const Le in rt){const{width:Ge,height:ot,x:at,y:ut,sdf:At,pixelRatio:bt,stretchX:Rt,stretchY:Ft,content:Mn}=rt[Le];Me[ve][Le]={data:null,pixelRatio:bt,sdf:At,stretchX:Rt,stretchY:Ft,content:Mn,spriteData:{width:Ge,height:ot,x:at,y:ut,context:Fe}}}}return Me})}(te,pe)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(A=>{if(this._spriteRequest=null,A)for(const P in A){this._spritesImagesIds[P]=[];const R=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter($=>!($ in A)):[];for(const $ of R)this.imageManager.removeImage($),this._changedImages[$]=!0;for(const $ in A[P]){const X=P==="default"?$:`${P}:${$}`;this._spritesImagesIds[P].push(X),X in this.imageManager.images?this.imageManager.updateImage(X,A[P][$],!1):this.imageManager.addImage(X,A[P][$]),h&&(this._changedImages[X]=!0)}}}).catch(A=>{this._spriteRequest=null,v=A,this.fire(new s.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),_&&_(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(l){const h=this.sourceCaches[l.source];if(!h)return;const _=l.sourceLayer;if(!_)return;const v=h.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.j(new Error(`Source layer "${_}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const h=this._serializedAllLayers();if(!l||l.length===0)return Object.values(h);const _=[];for(const v of l)h[v]&&_.push(h[v]);return _}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const h=Object.keys(this._layers);for(const _ of h){const v=this._layers[_];v.type!=="custom"&&(l[_]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const h=this._changed;if(h){const v=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(v.length||A.length)&&this._updateWorkerLayers(v,A);for(const P in this._updatedSources){const R=this._updatedSources[P];if(R==="reload")this._reloadSource(P);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const _={};for(const v in this.sourceCaches){const A=this.sourceCaches[v];_[v]=A.used,A.used=!1}for(const v of this._order){const A=this._layers[v];A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const v in _){const A=this.sourceCaches[v];!!_[v]!=!!A.used&&A.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,h={}){var _;this._checkLoaded();const v=this.serialize();if(l=h.transformStyle?h.transformStyle(v,l):l,((_=h.validate)===null||_===void 0||_)&&Ir(this,s.x(l)))return!1;(l=s.aA(l)).layers=s.ay(l.layers);const A=s.aB(v,l),P=this._getOperationsToPerform(A);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const R of P.operations)R();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const h=[],_=[];for(const v of l)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":h.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":h.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":h.push(()=>{});break;default:_.push(v.command)}return{operations:h,unimplemented:_}}addImage(l,h){if(this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,h),this._afterImageUpdated(l)}updateImage(l,h){this.imageManager.updateImage(l,h)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,h,_={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.x.source,`sources.${l}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=this.sourceCaches[l]=new Vn(l,h,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===l)return this.fire(new s.j(new Error(`Source "${l}" cannot be removed while layer "${_}" is using it.`)));const h=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],h.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,h){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const _=this.sourceCaches[l].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(h),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,h,_={}){this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new s.j(new Error(`Layer "${v}" already exists on this map.`)));let A;if(l.type==="custom"){if(Ir(this,s.aC(l)))return;A=s.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=s.aA(l),l=s.e(l,{source:v})),this._validate(s.x.layer,`layers.${v}`,l,{arrayIndex:-1},_))return;A=s.az(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:v}})}const P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new s.j(new Error(`Cannot add layer "${v}" before non-existing layer "${h}".`)));else{if(this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=A,this._removedLayers[v]&&A.source&&A.type!=="custom"){const R=this._removedLayers[v];delete this._removedLayers[v],R.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(l,h){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===h)return;const _=this._order.indexOf(l);this._order.splice(_,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new s.j(new Error(`Cannot move layer "${l}" before non-existing layer "${h}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const h=this._layers[l];if(!h)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${l}".`)));h.setEventedParent(null);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,h,_){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===h&&v.maxzoom===_||(h!=null&&(v.minzoom=h),_!=null&&(v.maxzoom=_),this._updateLayer(v)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,h,_={}){this._checkLoaded();const v=this.getLayer(l);if(v){if(!s.aD(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.x.filter,`layers.${v.id}.filter`,h,null,_)||(v.filter=s.aA(h),this._updateLayer(v)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.aA(this.getLayer(l).filter)}setLayoutProperty(l,h,_,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getLayoutProperty(h),_)||(A.setLayoutProperty(h,_,v),this._updateLayer(A)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,h){const _=this.getLayer(l);if(_)return _.getLayoutProperty(h);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,h,_,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getPaintProperty(h),_)||(A.setPaintProperty(h,_,v)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,h){return this.getLayer(l).getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const _=l.source,v=l.sourceLayer,A=this.sourceCaches[_];if(A===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const P=A.getSource().type;P==="geojson"&&v?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||v?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),A.setFeatureState(v,l.id,h)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,h){this._checkLoaded();const _=l.source,v=this.sourceCaches[_];if(v===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const A=v.getSource().type,P=A==="vector"?l.sourceLayer:void 0;A!=="vector"||P?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(P,l.id,h):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const h=l.source,_=l.sourceLayer,v=this.sourceCaches[h];if(v!==void 0)return v.getSource().type!=="vector"||_?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(_,l.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.aE(this.sourceCaches,A=>A.serialize()),h=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,v=this.stylesheet;return s.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:h,terrain:_},A=>A!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const h=P=>this._layers[P].type==="fill-extrusion",_={},v=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(h(R)){_[R]=P;for(const $ of l){const X=$[R];if(X)for(const ee of X)v.push(ee)}}}v.sort((P,R)=>R.intersectionZ-P.intersectionZ);const A=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(h(R))for(let $=v.length-1;$>=0;$--){const X=v[$].feature;if(_[X.layer.id]<P)break;A.push(X),v.pop()}else for(const $ of l){const X=$[R];if(X)for(const ee of X)A.push(ee.feature)}}return A}queryRenderedFeatures(l,h,_){h&&h.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const $=this._layers[R];if(!$)return this.fire(new s.j(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];v[$.source]=!0}}const A=[];h.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const R in this.sourceCaches)h.layers&&!v[R]||A.push(fn(this.sourceCaches[R],this._layers,P,l,h,_));return this.placement&&A.push(function(R,$,X,ee,te,pe,ke){const Ae={},Me=pe.queryRenderedSymbols(ee),ve=[];for(const Fe of Object.keys(Me).map(Number))ve.push(ke[Fe]);ve.sort(pn);for(const Fe of ve){const rt=Fe.featureIndex.lookupSymbolFeatures(Me[Fe.bucketInstanceId],$,Fe.bucketIndex,Fe.sourceLayerIndex,te.filter,te.layers,te.availableImages,R);for(const Le in rt){const Ge=Ae[Le]=Ae[Le]||[],ot=rt[Le];ot.sort((at,ut)=>{const At=Fe.featureSortOrder;if(At){const bt=At.indexOf(at.featureIndex);return At.indexOf(ut.featureIndex)-bt}return ut.featureIndex-at.featureIndex});for(const at of ot)Ge.push(at)}}for(const Fe in Ae)Ae[Fe].forEach(rt=>{const Le=rt.feature,Ge=X[R[Fe].source].getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=Ge});return Ae}(this._layers,P,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,h){h&&h.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",h.filter,null,h);const _=this.sourceCaches[l];return _?function(v,A){const P=v.getRenderableIds().map(X=>v.getTileByID(X)),R=[],$={};for(let X=0;X<P.length;X++){const ee=P[X],te=ee.tileID.canonical.key;$[te]||($[te]=!0,ee.querySourceFeatures(R,A))}return R}(_,h):[]}getLight(){return this.light.getLight()}setLight(l,h={}){this._checkLoaded();const _=this.light.getLight();let v=!1;for(const P in l)if(!s.aD(l[P],_[P])){v=!0;break}if(!v)return;const A={now:y.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(A)}_validate(l,h,_,v,A={}){return(!A||A.validate!==!1)&&Ir(this,l.call(s.x,s.e({key:h,style:this.serialize(),value:_,styleSpec:s.v},v)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),_t().off(An,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const _=this.sourceCaches[h];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const h in this.sourceCaches)this.sourceCaches[h].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,h,_,v,A=!1){let P=!1,R=!1;const $={};for(const X of this._order){const ee=this._layers[X];if(ee.type!=="symbol")continue;if(!$[ee.source]){const pe=this.sourceCaches[ee.source];$[ee.source]=pe.getRenderableIds(!0).map(ke=>pe.getTileByID(ke)).sort((ke,Ae)=>Ae.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Ae.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(ee,$[ee.source],l.center.lng);P=P||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),l.zoom))&&(this.pauseablePlacement=new po(l,this.map.terrain,this._order,A,h,_,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const X of this._order){const ee=this._layers[X];ee.type==="symbol"&&this.placement.updateLayerOpacities(ee,$[ee.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,h){return s._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,h.icons),_})}getGlyphs(l,h){return s._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(h.stacks),v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,h={}){this._checkLoaded(),l&&this._validate(s.x.glyphs,"glyphs",l,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,h,_={},v){this._checkLoaded();const A=[{id:l,url:h}],P=[...Ie(this.stylesheet.sprite),...A];this._validate(s.x.sprite,"sprite",P,null,_)||(this.stylesheet.sprite=P,this._loadSprite(A,!0,v))}removeSprite(l){this._checkLoaded();const h=Ie(this.stylesheet.sprite);if(h.find(_=>_.id===l)){if(this._spritesImagesIds[l])for(const _ of this._spritesImagesIds[l])this.imageManager.removeImage(_),this._changedImages[_]=!0;h.splice(h.findIndex(_=>_.id===l),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ie(this.stylesheet.sprite)}setSprite(l,h={},_){this._checkLoaded(),l&&this._validate(s.x.sprite,"sprite",l,null,h)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,_):(this._unloadSprite(),_&&_(null)))}}var Nl=s.X([{name:"a_pos",type:"Int16",components:2}]),Uo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Qa={prelude:cr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:cr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:cr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:cr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:cr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:cr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:cr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:cr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:cr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:cr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:cr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:cr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:cr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:cr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:cr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:cr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:cr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:cr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:cr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:cr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:cr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:cr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:cr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:cr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:cr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Uo),terrainDepth:cr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Uo),terrainCoords:cr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Uo)};function cr(w,l){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=A?A.concat(v):v,R={};return{fragmentSource:w=w.replace(h,($,X,ee,te,pe)=>(R[pe]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
varying ${ee} ${te} ${pe};
#else
uniform ${ee} ${te} u_${pe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${pe}
    ${ee} ${te} ${pe} = u_${pe};
#endif
`)),vertexSource:l=l.replace(h,($,X,ee,te,pe)=>{const ke=te==="float"?"vec2":"vec4",Ae=pe.match(/color/)?"color":ke;return R[pe]?X==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
uniform lowp float u_${pe}_t;
attribute ${ee} ${ke} a_${pe};
varying ${ee} ${te} ${pe};
#else
uniform ${ee} ${te} u_${pe};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${pe}
    ${pe} = a_${pe};
#else
    ${ee} ${te} ${pe} = u_${pe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pe}
    ${pe} = unpack_mix_${Ae}(a_${pe}, u_${pe}_t);
#else
    ${ee} ${te} ${pe} = u_${pe};
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_${pe}
uniform lowp float u_${pe}_t;
attribute ${ee} ${ke} a_${pe};
#else
uniform ${ee} ${te} u_${pe};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${pe}
    ${ee} ${te} ${pe} = a_${pe};
#else
    ${ee} ${te} ${pe} = u_${pe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${pe}
    ${ee} ${te} ${pe} = unpack_mix_${Ae}(a_${pe}, u_${pe}_t);
#else
    ${ee} ${te} ${pe} = u_${pe};
#endif
`}),staticAttributes:_,staticUniforms:P}}class jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,h,_,v,A,P,R,$,X){this.context=l;let ee=this.boundPaintVertexBuffers.length!==v.length;for(let te=0;!ee&&te<v.length;te++)this.boundPaintVertexBuffers[te]!==v[te]&&(ee=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||ee||this.boundIndexBuffer!==A||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==$||this.boundDynamicVertexBuffer3!==X?this.freshBind(h,_,v,A,P,R,$,X):(l.bindVertexArray.set(this.vao),R&&R.bind(),A&&A.dynamicDraw&&A.bind(),$&&$.bind(),X&&X.bind())}freshBind(l,h,_,v,A,P,R,$){const X=l.numAttributes,ee=this.context,te=ee.gl;this.vao&&this.destroy(),this.vao=ee.createVertexArray(),ee.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=v,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=$,h.enableAttributes(te,l);for(const pe of _)pe.enableAttributes(te,l);P&&P.enableAttributes(te,l),R&&R.enableAttributes(te,l),$&&$.enableAttributes(te,l),h.bind(),h.setVertexAttribPointers(te,l,A);for(const pe of _)pe.bind(),pe.setVertexAttribPointers(te,l,A);P&&(P.bind(),P.setVertexAttribPointers(te,l,A)),v&&v.bind(),R&&(R.bind(),R.setVertexAttribPointers(te,l,A)),$&&($.bind(),$.setVertexAttribPointers(te,l,A)),ee.currentNumAttributes=X}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function da(w){const l=[];for(let h=0;h<w.length;h++){if(w[h]===null)continue;const _=w[h].split(" ");l.push(_.pop())}return l}class As{constructor(l,h,_,v,A,P){const R=l.gl;this.program=R.createProgram();const $=da(h.staticAttributes),X=_?_.getBinderAttributes():[],ee=$.concat(X),te=Qa.prelude.staticUniforms?da(Qa.prelude.staticUniforms):[],pe=h.staticUniforms?da(h.staticUniforms):[],ke=_?_.getBinderUniforms():[],Ae=te.concat(pe).concat(ke),Me=[];for(const at of Ae)Me.indexOf(at)<0&&Me.push(at);const ve=_?_.defines():[];A&&ve.push("#define OVERDRAW_INSPECTOR;"),P&&ve.push("#define TERRAIN3D;");const Fe=ve.concat(Qa.prelude.fragmentSource,h.fragmentSource).join(`
`),rt=ve.concat(Qa.prelude.vertexSource,h.vertexSource).join(`
`),Le=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Le,Fe),R.compileShader(Le),!R.getShaderParameter(Le,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(Le)}`);R.attachShader(this.program,Le);const Ge=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Ge,rt),R.compileShader(Ge),!R.getShaderParameter(Ge,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(Ge)}`);R.attachShader(this.program,Ge),this.attributes={};const ot={};this.numAttributes=ee.length;for(let at=0;at<this.numAttributes;at++)ee[at]&&(R.bindAttribLocation(this.program,at,ee[at]),this.attributes[ee[at]]=at);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(Ge),R.deleteShader(Le);for(let at=0;at<Me.length;at++){const ut=Me[at];if(ut&&!ot[ut]){const At=R.getUniformLocation(this.program,ut);At&&(ot[ut]=At)}}this.fixedUniforms=v(l,ot),this.terrainUniforms=((at,ut)=>({u_depth:new s.aG(at,ut.u_depth),u_terrain:new s.aG(at,ut.u_terrain),u_terrain_dim:new s.aH(at,ut.u_terrain_dim),u_terrain_matrix:new s.aI(at,ut.u_terrain_matrix),u_terrain_unpack:new s.aJ(at,ut.u_terrain_unpack),u_terrain_exaggeration:new s.aH(at,ut.u_terrain_exaggeration)}))(l,ot),this.binderUniforms=_?_.getUniforms(l,ot):[]}draw(l,h,_,v,A,P,R,$,X,ee,te,pe,ke,Ae,Me,ve,Fe,rt){const Le=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(v),l.setColorMode(A),l.setCullFace(P),$){l.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,$.depthTexture),l.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,$.texture);for(const ot in this.terrainUniforms)this.terrainUniforms[ot].set($[ot])}for(const ot in this.fixedUniforms)this.fixedUniforms[ot].set(R[ot]);Me&&Me.setUniforms(l,this.binderUniforms,ke,{zoom:Ae});let Ge=0;switch(h){case Le.LINES:Ge=2;break;case Le.TRIANGLES:Ge=3;break;case Le.LINE_STRIP:Ge=1}for(const ot of pe.get()){const at=ot.vaos||(ot.vaos={});(at[X]||(at[X]=new jl)).bind(l,this,ee,Me?Me.getPaintVertexBuffers():[],te,ot.vertexOffset,ve,Fe,rt),Le.drawElements(h,ot.primitiveLength*Ge,Le.UNSIGNED_SHORT,ot.primitiveOffset*Ge*2)}}}function Ul(w,l,h){const _=1/mn(h,1,l.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),A=h.tileSize*Math.pow(2,l.transform.tileZoom)/v,P=A*(h.tileID.canonical.x+h.tileID.wrap*v),R=A*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[_,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[P>>16,R>>16],u_pixel_coord_lower:[65535&P,65535&R]}}const el=(w,l,h,_)=>{const v=l.style.light,A=v.properties.get("position"),P=[A.x,A.y,A.z],R=function(){var X=new s.A(9);return s.A!=Float32Array&&(X[1]=0,X[2]=0,X[3]=0,X[5]=0,X[6]=0,X[7]=0),X[0]=1,X[4]=1,X[8]=1,X}();v.properties.get("anchor")==="viewport"&&function(X,ee){var te=Math.sin(ee),pe=Math.cos(ee);X[0]=pe,X[1]=te,X[2]=0,X[3]=-te,X[4]=pe,X[5]=0,X[6]=0,X[7]=0,X[8]=1}(R,-l.transform.angle),function(X,ee,te){var pe=ee[0],ke=ee[1],Ae=ee[2];X[0]=pe*te[0]+ke*te[3]+Ae*te[6],X[1]=pe*te[1]+ke*te[4]+Ae*te[7],X[2]=pe*te[2]+ke*te[5]+Ae*te[8]}(P,P,R);const $=v.properties.get("color");return{u_matrix:w,u_lightpos:P,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+h,u_opacity:_}},xp=(w,l,h,_,v,A,P)=>s.e(el(w,l,h,_),Ul(A,l,P),{u_height_factor:-Math.pow(2,v.overscaledZ)/P.tileSize/8}),gh=w=>({u_matrix:w}),Vl=(w,l,h,_)=>s.e(gh(w),Ul(h,l,_)),Ap=(w,l)=>({u_matrix:w,u_world:l}),_h=(w,l,h,_,v)=>s.e(Vl(w,l,h,_),{u_world:v}),kp=(w,l,h,_)=>{const v=w.transform;let A,P;if(_.paint.get("circle-pitch-alignment")==="map"){const R=mn(h,1,v.zoom);A=!0,P=[R,R]}else A=!1,P=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,h,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:P}},yh=(w,l,h)=>{const _=mn(h,1,l.zoom),v=Math.pow(2,l.zoom-h.tileID.overscaledZ),A=h.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[l.pixelsToGLUnits[0]/(_*v),l.pixelsToGLUnits[1]/(_*v)],u_overscale_factor:A}},vh=(w,l,h=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:h}),ql=w=>({u_matrix:w}),bh=(w,l,h,_)=>({u_matrix:w,u_extrude_scale:mn(l,1,h),u_intensity:_});function wh(w,l){const h=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new s.Y(0,_/h).toLngLat().lat,new s.Y(0,(_+1)/h).toLngLat().lat]}const Hl=(w,l,h,_)=>{const v=w.transform;return{u_matrix:tl(w,l,h,_),u_ratio:1/mn(l,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},xh=(w,l,h,_,v)=>s.e(Hl(w,l,h,v),{u_image:0,u_image_height:_}),js=(w,l,h,_,v)=>{const A=w.transform,P=no(l,A);return{u_matrix:tl(w,l,h,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/mn(l,1,A.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[P,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Gl=(w,l,h,_,v,A)=>{const P=w.lineAtlas,R=no(l,w.transform),$=h.layout.get("line-cap")==="round",X=P.getDash(_.from,$),ee=P.getDash(_.to,$),te=X.width*v.fromScale,pe=ee.width*v.toScale;return s.e(Hl(w,l,h,A),{u_patternscale_a:[R/te,-X.height/2],u_patternscale_b:[R/pe,-ee.height/2],u_sdfgamma:P.width/(256*Math.min(te,pe)*w.pixelRatio)/2,u_image:0,u_tex_y_a:X.y,u_tex_y_b:ee.y,u_mix:v.t})};function no(w,l){return 1/mn(w,1,l.tileZoom)}function tl(w,l,h,_){return w.translatePosMatrix(_?_.posMatrix:l.tileID.posMatrix,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Wl=(w,l,h,_,v)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:h,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(P=v.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(A=v.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:nl(v.paint.get("raster-hue-rotate"))};var A,P};function nl(w){w*=Math.PI/180;const l=Math.sin(w),h=Math.cos(w);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const rl=(w,l,h,_,v,A,P,R,$,X)=>{const ee=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:P,u_coord_matrix:R,u_is_text:+$,u_pitch_with_map:+_,u_texsize:X,u_texture:0}},il=(w,l,h,_,v,A,P,R,$,X,ee)=>{const te=v.transform;return s.e(rl(w,l,h,_,v,A,P,R,$,X),{u_gamma_scale:_?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+ee})},ol=(w,l,h,_,v,A,P,R,$,X)=>s.e(il(w,l,h,_,v,A,P,R,!0,$,!0),{u_texsize_icon:X,u_texture_icon:1}),Sp=(w,l,h)=>({u_matrix:w,u_opacity:l,u_color:h}),Cp=(w,l,h,_,v,A)=>s.e(function(P,R,$,X){const ee=$.imageManager.getPattern(P.from.toString()),te=$.imageManager.getPattern(P.to.toString()),{width:pe,height:ke}=$.imageManager.getPixelSize(),Ae=Math.pow(2,X.tileID.overscaledZ),Me=X.tileSize*Math.pow(2,$.transform.tileZoom)/Ae,ve=Me*(X.tileID.canonical.x+X.tileID.wrap*Ae),Fe=Me*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ee.tl,u_pattern_br_a:ee.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[pe,ke],u_mix:R.t,u_pattern_size_a:ee.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/mn(X,1,$.transform.tileZoom),u_pixel_coord_upper:[ve>>16,Fe>>16],u_pixel_coord_lower:[65535&ve,65535&Fe]}}(_,A,h,v),{u_matrix:w,u_opacity:l}),Ah={fillExtrusion:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_opacity:new s.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_height_factor:new s.aH(w,l.u_height_factor),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade),u_opacity:new s.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,l.u_scale_with_map),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_matrix:new s.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_overscale_factor:new s.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_inv_matrix:new s.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_viewport_size:new s.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new s.aM(w,l.u_color),u_matrix:new s.aI(w,l.u_matrix),u_overlay:new s.aG(w,l.u_overlay),u_overlay_scale:new s.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new s.aH(w,l.u_extrude_scale),u_intensity:new s.aH(w,l.u_intensity),u_matrix:new s.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_color_ramp:new s.aG(w,l.u_color_ramp),u_opacity:new s.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_latrange:new s.aL(w,l.u_latrange),u_light:new s.aL(w,l.u_light),u_shadow:new s.aM(w,l.u_shadow),u_highlight:new s.aM(w,l.u_highlight),u_accent:new s.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_dimension:new s.aL(w,l.u_dimension),u_zoom:new s.aH(w,l.u_zoom),u_unpack:new s.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_image:new s.aG(w,l.u_image),u_image_height:new s.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texsize:new s.aL(w,l.u_texsize),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_image:new s.aG(w,l.u_image),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_patternscale_a:new s.aL(w,l.u_patternscale_a),u_patternscale_b:new s.aL(w,l.u_patternscale_b),u_sdfgamma:new s.aH(w,l.u_sdfgamma),u_image:new s.aG(w,l.u_image),u_tex_y_a:new s.aH(w,l.u_tex_y_a),u_tex_y_b:new s.aH(w,l.u_tex_y_b),u_mix:new s.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_tl_parent:new s.aL(w,l.u_tl_parent),u_scale_parent:new s.aH(w,l.u_scale_parent),u_buffer_scale:new s.aH(w,l.u_buffer_scale),u_fade_t:new s.aH(w,l.u_fade_t),u_opacity:new s.aH(w,l.u_opacity),u_image0:new s.aG(w,l.u_image0),u_image1:new s.aG(w,l.u_image1),u_brightness_low:new s.aH(w,l.u_brightness_low),u_brightness_high:new s.aH(w,l.u_brightness_high),u_saturation_factor:new s.aH(w,l.u_saturation_factor),u_contrast_factor:new s.aH(w,l.u_contrast_factor),u_spin_weights:new s.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texsize_icon:new s.aL(w,l.u_texsize_icon),u_texture:new s.aG(w,l.u_texture),u_texture_icon:new s.aG(w,l.u_texture_icon),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_color:new s.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_image:new s.aG(w,l.u_image),u_pattern_tl_a:new s.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,l.u_pattern_br_b),u_texsize:new s.aL(w,l.u_texsize),u_mix:new s.aH(w,l.u_mix),u_pattern_size_a:new s.aL(w,l.u_pattern_size_a),u_pattern_size_b:new s.aL(w,l.u_pattern_size_b),u_scale_a:new s.aH(w,l.u_scale_a),u_scale_b:new s.aH(w,l.u_scale_b),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_terrain_coords_id:new s.aH(w,l.u_terrain_coords_id),u_ele_delta:new s.aH(w,l.u_ele_delta)})};class Tp{constructor(l,h,_){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Us={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Zl{constructor(l,h,_,v){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let _=0;_<this.attributes.length;_++){const v=h.attributes[this.attributes[_].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,h,_){for(let v=0;v<this.attributes.length;v++){const A=this.attributes[v],P=h.attributes[A.name];P!==void 0&&l.vertexAttribPointer(P,A.components,l[Us[A.type]],!1,this.itemSize,A.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Mi=new WeakMap;function bi(w){var l;if(Mi.has(w))return Mi.get(w);{const h=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Mi.set(w,h),h}}class er{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xl extends er{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Kl extends er{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class pc extends er{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class mc extends er{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Jl extends er{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class gc extends er{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class _c extends er{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Yl extends er{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class kh extends er{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class Sh extends er{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class pa extends er{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class Mp extends er{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ep extends er{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Lp extends er{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Ip extends er{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Pp extends er{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class zp extends er{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class yc extends er{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Ql extends er{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class vc extends er{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class bc extends er{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ma extends er{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ch extends er{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Th extends er{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class wc extends er{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Vs extends er{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Mh extends er{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ga extends er{getDefault(){return null}set(l){var h;if(l===this.current&&!this.dirty)return;const _=this.gl;bi(_)?_.bindVertexArray(l):(h=_.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class _a extends er{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Eh extends er{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class xc extends er{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Jn extends er{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class eu extends Jn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Dp extends Jn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Lh extends Jn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class sl{constructor(l,h,_,v,A){this.context=l,this.width=h,this.height=_;const P=l.gl,R=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new eu(l,R),v)this.depthAttachment=A?new Lh(l,R):new Dp(l,R);else if(A)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class Vr{constructor(l,h,_){this.blendFunction=l,this.blendColor=h,this.mask=_}}Vr.Replace=[1,0],Vr.disabled=new Vr(Vr.Replace,s.aO.transparent,[!1,!1,!1,!1]),Vr.unblended=new Vr(Vr.Replace,s.aO.transparent,[!0,!0,!0,!0]),Vr.alphaBlended=new Vr([1,771],s.aO.transparent,[!0,!0,!0,!0]);class Rp{constructor(l){var h,_;if(this.gl=l,this.clearColor=new Xl(this),this.clearDepth=new Kl(this),this.clearStencil=new pc(this),this.colorMask=new mc(this),this.depthMask=new Jl(this),this.stencilMask=new gc(this),this.stencilFunc=new _c(this),this.stencilOp=new Yl(this),this.stencilTest=new kh(this),this.depthRange=new Sh(this),this.depthTest=new pa(this),this.depthFunc=new Mp(this),this.blend=new Ep(this),this.blendFunc=new Lp(this),this.blendColor=new Ip(this),this.blendEquation=new Pp(this),this.cullFace=new zp(this),this.cullFaceSide=new yc(this),this.frontFace=new Ql(this),this.program=new vc(this),this.activeTexture=new bc(this),this.viewport=new ma(this),this.bindFramebuffer=new Ch(this),this.bindRenderbuffer=new Th(this),this.bindTexture=new wc(this),this.bindVertexBuffer=new Vs(this),this.bindElementBuffer=new Mh(this),this.bindVertexArray=new ga(this),this.pixelStoreUnpack=new _a(this),this.pixelStoreUnpackPremultiplyAlpha=new Eh(this),this.pixelStoreUnpackFlipY=new xc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),bi(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=l.RGBA16F)!==null&&h!==void 0?h:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(_=l.RGB16F)!==null&&_!==void 0?_:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h){return new Tp(this,l,h)}createVertexBuffer(l,h,_){return new Zl(this,l,h,_)}createRenderbuffer(l,h,_){const v=this.gl,A=v.createRenderbuffer();return this.bindRenderbuffer.set(A),v.renderbufferStorage(v.RENDERBUFFER,l,h,_),this.bindRenderbuffer.set(null),A}createFramebuffer(l,h,_,v){return new sl(this,l,h,_,v)}clear({color:l,depth:h,stencil:_}){const v=this.gl;let A=0;l&&(A|=v.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(A|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),_!==void 0&&(A|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),v.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.aD(l.blendFunction,Vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return bi(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var h;return bi(this.gl)?this.gl.deleteVertexArray(l):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Wn{constructor(l,h,_){this.func=l,this.mask=h,this.range=_}}Wn.ReadOnly=!1,Wn.ReadWrite=!0,Wn.disabled=new Wn(519,Wn.ReadOnly,[0,1]);const Ac=7680;class wr{constructor(l,h,_,v,A,P){this.test=l,this.ref=h,this.mask=_,this.fail=v,this.depthFail=A,this.pass=P}}wr.disabled=new wr({func:519,mask:0},0,0,Ac,Ac,Ac);class gr{constructor(l,h,_){this.enable=l,this.mode=h,this.frontFace=_}}let qs;function tu(w,l,h,_,v,A,P){const R=w.context,$=R.gl,X=w.useProgram("collisionBox"),ee=[];let te=0,pe=0;for(let Le=0;Le<_.length;Le++){const Ge=_[Le],ot=l.getTile(Ge),at=ot.getBucket(h);if(!at)continue;let ut=Ge.posMatrix;v[0]===0&&v[1]===0||(ut=w.translatePosMatrix(Ge.posMatrix,ot,v,A));const At=P?at.textCollisionBox:at.iconCollisionBox,bt=at.collisionCircleArray;if(bt.length>0){const Rt=s.F(),Ft=ut;s.aP(Rt,at.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(Rt,Rt,at.placementViewportMatrix),ee.push({circleArray:bt,circleOffset:pe,transform:Ft,invTransform:Rt,coord:Ge}),te+=bt.length/4,pe=te}At&&X.draw(R,$.LINES,Wn.disabled,wr.disabled,w.colorModeForRenderPass(),gr.disabled,yh(ut,w.transform,ot),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ge),h.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,null,w.transform.zoom,null,null,At.collisionVertexBuffer)}if(!P||!ee.length)return;const ke=w.useProgram("collisionCircle"),Ae=new s.aQ;Ae.resize(4*te),Ae._trim();let Me=0;for(const Le of ee)for(let Ge=0;Ge<Le.circleArray.length/4;Ge++){const ot=4*Ge,at=Le.circleArray[ot+0],ut=Le.circleArray[ot+1],At=Le.circleArray[ot+2],bt=Le.circleArray[ot+3];Ae.emplace(Me++,at,ut,At,bt,0),Ae.emplace(Me++,at,ut,At,bt,1),Ae.emplace(Me++,at,ut,At,bt,2),Ae.emplace(Me++,at,ut,At,bt,3)}(!qs||qs.length<2*te)&&(qs=function(Le){const Ge=2*Le,ot=new s.aS;ot.resize(Ge),ot._trim();for(let at=0;at<Ge;at++){const ut=6*at;ot.uint16[ut+0]=4*at+0,ot.uint16[ut+1]=4*at+1,ot.uint16[ut+2]=4*at+2,ot.uint16[ut+3]=4*at+2,ot.uint16[ut+4]=4*at+3,ot.uint16[ut+5]=4*at+0}return ot}(te));const ve=R.createIndexBuffer(qs,!0),Fe=R.createVertexBuffer(Ae,s.aR.members,!0);for(const Le of ee){const Ge={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(rt=w.transform).cameraToCenterDistance,u_viewport_size:[rt.width,rt.height]};ke.draw(R,$.TRIANGLES,Wn.disabled,wr.disabled,w.colorModeForRenderPass(),gr.disabled,Ge,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Le.coord),h.id,Fe,ve,s.$.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,w.transform.zoom,null,null,null)}var rt;Fe.destroy(),ve.destroy()}gr.disabled=new gr(!1,1029,2305),gr.backCCW=new gr(!0,1029,2305);const kc=s.an(new Float32Array(16));function Ih(w,l,h,_,v,A){const{horizontalAlign:P,verticalAlign:R}=s.at(w);return new s.P((-(P-.5)*l/v+_[0])*A,(-(R-.5)*h/v+_[1])*A)}function nu(w,l,h,_,v,A,P,R,$,X,ee){const te=w.text.placedSymbolArray,pe=w.text.dynamicLayoutVertexArray,ke=w.icon.dynamicLayoutVertexArray,Ae={};pe.clear();for(let Me=0;Me<te.length;Me++){const ve=te.get(Me),Fe=ve.hidden||!ve.crossTileID||w.allowVerticalPlacement&&!ve.placedOrientation?null:_[ve.crossTileID];if(Fe){const rt=new s.P(ve.anchorX,ve.anchorY),Le=lr(rt,h?P:A,ee),Ge=Se(v.cameraToCenterDistance,Le.signedDistanceFromCamera);let ot=s.ai(w.textSizeData,$,ve)*Ge/s.ao;h&&(ot*=w.tilePixelRatio/R);const{width:at,height:ut,anchor:At,textOffset:bt,textBoxScale:Rt}=Fe,Ft=Ih(At,at,ut,bt,Rt,ot),Mn=h?lr(rt.add(Ft),A,ee).point:Le.point.add(l?Ft.rotate(-v.angle):Ft),$t=w.allowVerticalPlacement&&ve.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let gn=0;gn<ve.numGlyphs;gn++)s.aj(pe,Mn,$t);X&&ve.associatedIconIndex>=0&&(Ae[ve.associatedIconIndex]={shiftedAnchor:Mn,angle:$t})}else it(ve.numGlyphs,pe)}if(X){ke.clear();const Me=w.icon.placedSymbolArray;for(let ve=0;ve<Me.length;ve++){const Fe=Me.get(ve);if(Fe.hidden)it(Fe.numGlyphs,ke);else{const rt=Ae[ve];if(rt)for(let Le=0;Le<Fe.numGlyphs;Le++)s.aj(ke,rt.shiftedAnchor,rt.angle);else it(Fe.numGlyphs,ke)}}w.icon.dynamicLayoutVertexBuffer.updateData(ke)}w.text.dynamicLayoutVertexBuffer.updateData(pe)}function ru(w,l,h){return h.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function iu(w,l,h,_,v,A,P,R,$,X,ee,te){const pe=w.context,ke=pe.gl,Ae=w.transform,Me=R==="map",ve=$==="map",Fe=R!=="viewport"&&h.layout.get("symbol-placement")!=="point",rt=Me&&!ve&&!Fe,Le=!h.layout.get("symbol-sort-key").isConstant();let Ge=!1;const ot=w.depthModeForSublayer(0,Wn.ReadOnly),at=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ut=[];for(const At of _){const bt=l.getTile(At),Rt=bt.getBucket(h);if(!Rt)continue;const Ft=v?Rt.text:Rt.icon;if(!Ft||!Ft.segments.get().length||!Ft.hasVisibleVertices)continue;const Mn=Ft.programConfigurations.get(h.id),$t=v||Rt.sdfIcons,gn=v?Rt.textSizeData:Rt.iconSizeData,En=ve||Ae.pitch!==0,Zn=w.useProgram(ru($t,v,Rt),Mn),kn=s.ag(gn,Ae.zoom),Pn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(At);let zn,Or,fr,ro,ri=[0,0],Pr=null;if(v)Or=bt.glyphAtlasTexture,fr=ke.LINEAR,zn=bt.glyphAtlasTexture.size,Rt.iconsInText&&(ri=bt.imageAtlasTexture.size,Pr=bt.imageAtlasTexture,ro=En||w.options.rotating||w.options.zooming||gn.kind==="composite"||gn.kind==="camera"?ke.LINEAR:ke.NEAREST);else{const Xr=h.layout.get("icon-size").constantOr(0)!==1||Rt.iconsNeedLinear;Or=bt.imageAtlasTexture,fr=$t||w.options.rotating||w.options.zooming||Xr||En?ke.LINEAR:ke.NEAREST,zn=bt.imageAtlasTexture.size}const ii=mn(bt,1,w.transform.zoom),io=en(At.posMatrix,ve,Me,w.transform,ii),Go=br(At.posMatrix,ve,Me,w.transform,ii),Ms=at&&Rt.hasTextData(),vl=h.layout.get("icon-text-fit")!=="none"&&Ms&&Rt.hasIconData();if(Fe){const Xr=w.style.map.terrain?(go,Kr)=>w.style.map.terrain.getElevation(At,go,Kr):null,Dr=h.layout.get("text-rotation-alignment")==="map";ce(Rt,At.posMatrix,w,v,io,Go,ve,X,Dr,Xr)}const Es=w.translatePosMatrix(At.posMatrix,bt,A,P),Wo=Fe||v&&at||vl?kc:io,Zr=w.translatePosMatrix(Go,bt,A,P,!0),zr=$t&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mr;Mr=$t?Rt.iconsInText?ol(gn.kind,kn,rt,ve,w,Es,Wo,Zr,zn,ri):il(gn.kind,kn,rt,ve,w,Es,Wo,Zr,v,zn,!0):rl(gn.kind,kn,rt,ve,w,Es,Wo,Zr,v,zn);const mo={program:Zn,buffers:Ft,uniformValues:Mr,atlasTexture:Or,atlasTextureIcon:Pr,atlasInterpolation:fr,atlasInterpolationIcon:ro,isSDF:$t,hasHalo:zr};if(Le&&Rt.canOverlap){Ge=!0;const Xr=Ft.segments.get();for(const Dr of Xr)ut.push({segments:new s.$([Dr]),sortKey:Dr.sortKey,state:mo,terrainData:Pn})}else ut.push({segments:Ft.segments,sortKey:0,state:mo,terrainData:Pn})}Ge&&ut.sort((At,bt)=>At.sortKey-bt.sortKey);for(const At of ut){const bt=At.state;if(pe.activeTexture.set(ke.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,ke.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(pe.activeTexture.set(ke.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,ke.CLAMP_TO_EDGE)),bt.isSDF){const Rt=bt.uniformValues;bt.hasHalo&&(Rt.u_is_halo=1,Ph(bt.buffers,At.segments,h,w,bt.program,ot,ee,te,Rt,At.terrainData)),Rt.u_is_halo=0}Ph(bt.buffers,At.segments,h,w,bt.program,ot,ee,te,bt.uniformValues,At.terrainData)}}function Ph(w,l,h,_,v,A,P,R,$,X){const ee=_.context;v.draw(ee,ee.gl.TRIANGLES,A,P,R,gr.disabled,$,X,h.id,w.layoutVertexBuffer,w.indexBuffer,l,h.paint,_.transform.zoom,w.programConfigurations.get(h.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function ou(w,l,h,_,v){if(!h||!_||!_.imageAtlas)return;const A=_.imageAtlas.patternPositions;let P=A[h.to.toString()],R=A[h.from.toString()];if(!P&&R&&(P=R),!R&&P&&(R=P),!P||!R){const $=v.getPaintProperty(l);P=A[$],R=A[$]}P&&R&&w.setConstantPatternPositions(P,R)}function zh(w,l,h,_,v,A,P){const R=w.context.gl,$="fill-pattern",X=h.paint.get($),ee=X&&X.constantOr(1),te=h.getCrossfadeParameters();let pe,ke,Ae,Me,ve;P?(ke=ee&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",pe=R.LINES):(ke=ee?"fillPattern":"fill",pe=R.TRIANGLES);const Fe=X.constantOr(null);for(const rt of _){const Le=l.getTile(rt);if(ee&&!Le.patternsLoaded())continue;const Ge=Le.getBucket(h);if(!Ge)continue;const ot=Ge.programConfigurations.get(h.id),at=w.useProgram(ke,ot),ut=w.style.map.terrain&&w.style.map.terrain.getTerrainData(rt);ee&&(w.context.activeTexture.set(R.TEXTURE0),Le.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),ot.updatePaintBuffers(te)),ou(ot,$,Fe,Le,h);const At=ut?rt:null,bt=w.translatePosMatrix(At?At.posMatrix:rt.posMatrix,Le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(P){Me=Ge.indexBuffer2,ve=Ge.segments2;const Rt=[R.drawingBufferWidth,R.drawingBufferHeight];Ae=ke==="fillOutlinePattern"&&ee?_h(bt,w,te,Le,Rt):Ap(bt,Rt)}else Me=Ge.indexBuffer,ve=Ge.segments,Ae=ee?Vl(bt,w,te,Le):gh(bt);at.draw(w.context,pe,v,w.stencilModeForClipping(rt),A,gr.disabled,Ae,ut,h.id,Ge.layoutVertexBuffer,Me,ve,h.paint,w.transform.zoom,ot)}}function su(w,l,h,_,v,A,P){const R=w.context,$=R.gl,X="fill-extrusion-pattern",ee=h.paint.get(X),te=ee.constantOr(1),pe=h.getCrossfadeParameters(),ke=h.paint.get("fill-extrusion-opacity"),Ae=ee.constantOr(null);for(const Me of _){const ve=l.getTile(Me),Fe=ve.getBucket(h);if(!Fe)continue;const rt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Me),Le=Fe.programConfigurations.get(h.id),Ge=w.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Le);te&&(w.context.activeTexture.set($.TEXTURE0),ve.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Le.updatePaintBuffers(pe)),ou(Le,X,Ae,ve,h);const ot=w.translatePosMatrix(Me.posMatrix,ve,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),at=h.paint.get("fill-extrusion-vertical-gradient"),ut=te?xp(ot,w,at,ke,Me,pe,ve):el(ot,w,at,ke);Ge.draw(R,R.gl.TRIANGLES,v,A,P,gr.backCCW,ut,rt,h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,h.paint,w.transform.zoom,Le,w.style.map.terrain&&Fe.centroidVertexBuffer)}}function au(w,l,h,_,v,A,P){const R=w.context,$=R.gl,X=h.fbo;if(!X)return;const ee=w.useProgram("hillshade"),te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);R.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,X.colorAttachment.get()),ee.draw(R,$.TRIANGLES,v,A,P,gr.disabled,((pe,ke,Ae,Me)=>{const ve=Ae.paint.get("hillshade-shadow-color"),Fe=Ae.paint.get("hillshade-highlight-color"),rt=Ae.paint.get("hillshade-accent-color");let Le=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Le-=pe.transform.angle);const Ge=!pe.options.moving;return{u_matrix:Me?Me.posMatrix:pe.transform.calculatePosMatrix(ke.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:wh(0,ke.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),Le],u_shadow:ve,u_highlight:Fe,u_accent:rt}})(w,h,_,te?l:null),te,_.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function Sc(w,l,h,_,v,A){const P=w.context,R=P.gl,$=l.dem;if($&&$.data){const X=$.dim,ee=$.stride,te=$.getPixels();if(P.activeTexture.set(R.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(ee),l.demTexture){const ke=l.demTexture;ke.update(te,{premultiply:!1}),ke.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else l.demTexture=new J(P,te,R.RGBA,{premultiply:!1}),l.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);P.activeTexture.set(R.TEXTURE0);let pe=l.fbo;if(!pe){const ke=new J(P,{width:X,height:X,data:null},R.RGBA);ke.bind(R.LINEAR,R.CLAMP_TO_EDGE),pe=l.fbo=P.createFramebuffer(X,X,!0,!1),pe.colorAttachment.set(ke.texture)}P.bindFramebuffer.set(pe.framebuffer),P.viewport.set([0,0,X,X]),w.useProgram("hillshadePrepare").draw(P,R.TRIANGLES,_,v,A,gr.disabled,((ke,Ae)=>{const Me=Ae.stride,ve=s.F();return s.aN(ve,0,s.W,-s.W,0,0,1),s.H(ve,ve,[0,-s.W,0]),{u_matrix:ve,u_image:1,u_dimension:[Me,Me],u_zoom:ke.overscaledZ,u_unpack:Ae.getUnpackVector()}})(l.tileID,$),null,h.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Dh(w,l,h,_,v,A){const P=_.paint.get("raster-fade-duration");if(!A&&P>0){const R=y.now(),$=(R-w.timeAdded)/P,X=l?(R-l.timeAdded)/P:-1,ee=h.getSource(),te=v.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),pe=!l||Math.abs(l.tileID.overscaledZ-te)>Math.abs(w.tileID.overscaledZ-te),ke=pe&&w.refreshedUponExpiration?1:s.ac(pe?$:1-X,0,1);return w.refreshedUponExpiration&&$>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ke}:{opacity:ke,mix:0}}return{opacity:1,mix:0}}const Rh=new s.aO(1,0,0,1),lu=new s.aO(0,1,0,1),Cc=new s.aO(0,0,1,1),Bp=new s.aO(1,0,1,1),Bh=new s.aO(0,1,1,1);function Br(w,l,h,_){Ei(w,0,l+h/2,w.transform.width,h,_)}function ks(w,l,h,_){Ei(w,l-h/2,0,h,w.transform.height,_)}function Ei(w,l,h,_,v,A){const P=w.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(l*w.pixelRatio,h*w.pixelRatio,_*w.pixelRatio,v*w.pixelRatio),P.clear({color:A}),R.disable(R.SCISSOR_TEST)}function Tc(w,l,h){const _=w.context,v=_.gl,A=h.posMatrix,P=w.useProgram("debug"),R=Wn.disabled,$=wr.disabled,X=w.colorModeForRenderPass(),ee="$debug",te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(h);_.activeTexture.set(v.TEXTURE0);const pe=l.getTileByID(h.key).latestRawTileData,ke=Math.floor((pe&&pe.byteLength||0)/1024),Ae=l.getTile(h).tileSize,Me=512/Math.min(Ae,512)*(h.overscaledZ/w.transform.zoom)*.5;let ve=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ve+=` => ${h.overscaledZ}`),function(Fe,rt){Fe.initDebugOverlayCanvas();const Le=Fe.debugOverlayCanvas,Ge=Fe.context.gl,ot=Fe.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,Le.width,Le.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(rt,5,5),ot.strokeText(rt,5,5),Fe.debugOverlayTexture.update(Le),Fe.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(w,`${ve} ${ke}kB`),P.draw(_,v.TRIANGLES,R,$,Vr.alphaBlended,gr.disabled,vh(A,s.aO.transparent,Me),null,ee,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),P.draw(_,v.LINE_STRIP,R,$,X,gr.disabled,vh(A,s.aO.red),te,ee,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function uu(w,l,h){const _=w.context,v=_.gl,A=w.colorModeForRenderPass(),P=new Wn(v.LEQUAL,Wn.ReadWrite,w.depthRangeFor3D),R=w.useProgram("terrain"),$=l.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,w.width,w.height]);for(const X of h){const ee=w.renderToTexture.getTexture(X),te=l.getTerrainData(X.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,ee.texture);const pe={u_matrix:w.transform.calculatePosMatrix(X.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};R.draw(_,v.TRIANGLES,P,wr.disabled,A,gr.backCCW,pe,te,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}class Fh{constructor(l,h){this.context=new Rp(l),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Vn.maxUnderzooming+Vn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xs}resize(l,h,_){if(this.width=Math.floor(l*_),this.height=Math.floor(h*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,h=new s.aV;h.emplaceBack(0,0),h.emplaceBack(s.W,0),h.emplaceBack(0,s.W),h.emplaceBack(s.W,s.W),this.tileExtentBuffer=l.createVertexBuffer(h,Nl.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const _=new s.aV;_.emplaceBack(0,0),_.emplaceBack(s.W,0),_.emplaceBack(0,s.W),_.emplaceBack(s.W,s.W),this.debugBuffer=l.createVertexBuffer(_,Nl.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const v=new s.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(s.W,0,s.W,0),v.emplaceBack(0,s.W,0,s.W),v.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=l.createVertexBuffer(v,tt.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const A=new s.aV;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(A,Nl.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const P=new s.aW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);const R=new s.aX;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(R);const $=this.context.gl;this.stencilClearMode=new wr({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO)}clearStencil(){const l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=s.F();s.aN(_,0,this.width,this.height,0,0,1),s.J(_,_,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,Wn.disabled,this.stencilClearMode,Vr.disabled,gr.disabled,ql(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,h){if(this.currentStencilSource===l.source||!l.isTileClipped()||!h||!h.length)return;this.currentStencilSource=l.source;const _=this.context,v=_.gl;this.nextStencilID+h.length>256&&this.clearStencil(),_.setColorMode(Vr.disabled),_.setDepthMode(Wn.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of h){const R=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);A.draw(_,v.TRIANGLES,Wn.disabled,new wr({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),Vr.disabled,gr.disabled,ql(P.posMatrix),$,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new wr({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){const h=this.context.gl;return new wr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,_=l.sort((P,R)=>R.overscaledZ-P.overscaledZ),v=_[_.length-1].overscaledZ,A=_[0].overscaledZ-v+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const P={};for(let R=0;R<A;R++)P[R+v]=new wr({func:h.GEQUAL,mask:255},R+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=A,[P,_]}return[{[v]:wr.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Vr([l.CONSTANT_COLOR,l.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vr.unblended:Vr.alphaBlended}depthModeForSublayer(l,h,_){if(!this.opaquePassEnabledForLayer())return Wn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Wn(_||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.sourceCaches,A={},P={},R={};for(const $ in v){const X=v[$];X.used&&X.prepare(this.context),A[$]=X.getVisibleCoordinates(),P[$]=A[$].slice().reverse(),R[$]=X.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<_.length;$++)if(this.style._layers[_[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of _){const X=this.style._layers[$];if(!X.hasOffscreenPass()||X.isHidden(this.transform.zoom))continue;const ee=P[X.source];(X.type==="custom"||ee.length)&&this.renderLayer(this,v[X.source],X,ee)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[_[this.currentLayer]],X=v[$.source],ee=A[$.source];this._renderTileClippingMasks($,ee),this.renderLayer(this,X,$,ee)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const $=this.style._layers[_[this.currentLayer]],X=v[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($))continue;const ee=($.type==="symbol"?R:P)[$.source];this._renderTileClippingMasks($,A[$.source]),this.renderLayer(this,X,$,ee)}if(this.options.showTileBoundaries){const $=function(X,ee){let te=null;const pe=Object.values(X._layers).flatMap(ve=>ve.source&&!ve.isHidden(ee)?[X.sourceCaches[ve.source]]:[]),ke=pe.filter(ve=>ve.getSource().type==="vector"),Ae=pe.filter(ve=>ve.getSource().type!=="vector"),Me=ve=>{(!te||te.getSource().maxzoom<ve.getSource().maxzoom)&&(te=ve)};return ke.forEach(ve=>Me(ve)),te||Ae.forEach(ve=>Me(ve)),te}(this.style,this.transform.zoom);$&&function(X,ee,te){for(let pe=0;pe<te.length;pe++)Tc(X,ee,te[pe])}(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const X=$.transform.padding;Br($,$.transform.height-(X.top||0),3,Rh),Br($,X.bottom||0,3,lu),ks($,X.left||0,3,Cc),ks($,$.transform.width-(X.right||0),3,Bp);const ee=$.transform.centerPoint;(function(te,pe,ke,Ae){Ei(te,pe-1,ke-10,2,20,Ae),Ei(te,pe-10,ke-1,20,2,Ae)})($,ee.x,$.transform.height-ee.y,Bh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,_=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=l?!s.aY(h,_):!s.aZ(h,_)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(s.a_(h,_),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,P){const R=A.context,$=R.gl,X=Vr.unblended,ee=new Wn($.LEQUAL,Wn.ReadWrite,[0,1]),te=P.getTerrainMesh(),pe=P.sourceCache.getRenderableTiles(),ke=A.useProgram("terrainDepth");R.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:s.aO.transparent,depth:1});for(const Ae of pe){const Me=P.getTerrainData(Ae.tileID),ve={u_matrix:A.transform.calculatePosMatrix(Ae.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};ke.draw(R,$.TRIANGLES,ee,wr.disabled,X,gr.backCCW,ve,Me,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,P){const R=A.context,$=R.gl,X=Vr.unblended,ee=new Wn($.LEQUAL,Wn.ReadWrite,[0,1]),te=P.getTerrainMesh(),pe=P.getCoordsTexture(),ke=P.sourceCache.getRenderableTiles(),Ae=A.useProgram("terrainCoords");R.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:s.aO.transparent,depth:1}),P.coordsIndex=[];for(const Me of ke){const ve=P.getTerrainData(Me.tileID);R.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,pe.texture);const Fe={u_matrix:A.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};Ae.draw(R,$.TRIANGLES,ee,wr.disabled,X,gr.backCCW,Fe,ve,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),P.coordsIndex.push(Me.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}renderLayer(l,h,_,v){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(v||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(A,P,R,$,X){if(A.renderPass!=="translucent")return;const ee=wr.disabled,te=A.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(pe,ke,Ae,Me,ve,Fe,rt){const Le=ke.transform,Ge=ve==="map",ot=Fe==="map";for(const at of pe){const ut=Me.getTile(at),At=ut.getBucket(Ae);if(!At||!At.text||!At.text.segments.get().length)continue;const bt=s.ag(At.textSizeData,Le.zoom),Rt=mn(ut,1,ke.transform.zoom),Ft=en(at.posMatrix,ot,Ge,ke.transform,Rt),Mn=Ae.layout.get("icon-text-fit")!=="none"&&At.hasIconData();if(bt){const $t=Math.pow(2,Le.zoom-ut.tileID.overscaledZ);nu(At,Ge,ot,rt,Le,Ft,at.posMatrix,$t,bt,Mn,ke.style.map.terrain?(gn,En)=>ke.style.map.terrain.getElevation(at,gn,En):null)}}}($,A,R,P,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),X),R.paint.get("icon-opacity").constantOr(1)!==0&&iu(A,P,R,$,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),ee,te),R.paint.get("text-opacity").constantOr(1)!==0&&iu(A,P,R,$,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),ee,te),P.map.showCollisionBoxes&&(tu(A,P,R,$,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),!0),tu(A,P,R,$,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),!1))})(l,h,_,v,this.style.placement.variableOffsets);break;case"circle":(function(A,P,R,$){if(A.renderPass!=="translucent")return;const X=R.paint.get("circle-opacity"),ee=R.paint.get("circle-stroke-width"),te=R.paint.get("circle-stroke-opacity"),pe=!R.layout.get("circle-sort-key").isConstant();if(X.constantOr(1)===0&&(ee.constantOr(1)===0||te.constantOr(1)===0))return;const ke=A.context,Ae=ke.gl,Me=A.depthModeForSublayer(0,Wn.ReadOnly),ve=wr.disabled,Fe=A.colorModeForRenderPass(),rt=[];for(let Le=0;Le<$.length;Le++){const Ge=$[Le],ot=P.getTile(Ge),at=ot.getBucket(R);if(!at)continue;const ut=at.programConfigurations.get(R.id),At=A.useProgram("circle",ut),bt=at.layoutVertexBuffer,Rt=at.indexBuffer,Ft=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ge),Mn={programConfiguration:ut,program:At,layoutVertexBuffer:bt,indexBuffer:Rt,uniformValues:kp(A,Ge,ot,R),terrainData:Ft};if(pe){const $t=at.segments.get();for(const gn of $t)rt.push({segments:new s.$([gn]),sortKey:gn.sortKey,state:Mn})}else rt.push({segments:at.segments,sortKey:0,state:Mn})}pe&&rt.sort((Le,Ge)=>Le.sortKey-Ge.sortKey);for(const Le of rt){const{programConfiguration:Ge,program:ot,layoutVertexBuffer:at,indexBuffer:ut,uniformValues:At,terrainData:bt}=Le.state;ot.draw(ke,Ae.TRIANGLES,Me,ve,Fe,gr.disabled,At,bt,R.id,at,ut,Le.segments,R.paint,A.transform.zoom,Ge)}})(l,h,_,v);break;case"heatmap":(function(A,P,R,$){if(R.paint.get("heatmap-opacity")!==0)if(A.renderPass==="offscreen"){const X=A.context,ee=X.gl,te=wr.disabled,pe=new Vr([ee.ONE,ee.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(ke,Ae,Me){const ve=ke.gl;ke.activeTexture.set(ve.TEXTURE1),ke.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Fe=Me.heatmapFbo;if(Fe)ve.bindTexture(ve.TEXTURE_2D,Fe.colorAttachment.get()),ke.bindFramebuffer.set(Fe.framebuffer);else{const rt=ve.createTexture();ve.bindTexture(ve.TEXTURE_2D,rt),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MAG_FILTER,ve.LINEAR),Fe=Me.heatmapFbo=ke.createFramebuffer(Ae.width/4,Ae.height/4,!1,!1),function(Le,Ge,ot,at){var ut,At;const bt=Le.gl,Rt=(ut=Le.HALF_FLOAT)!==null&&ut!==void 0?ut:bt.UNSIGNED_BYTE,Ft=(At=Le.RGBA16F)!==null&&At!==void 0?At:bt.RGBA;bt.texImage2D(bt.TEXTURE_2D,0,Ft,Ge.width/4,Ge.height/4,0,bt.RGBA,Rt,null),at.colorAttachment.set(ot)}(ke,Ae,rt,Fe)}})(X,A,R),X.clear({color:s.aO.transparent});for(let ke=0;ke<$.length;ke++){const Ae=$[ke];if(P.hasRenderableParent(Ae))continue;const Me=P.getTile(Ae),ve=Me.getBucket(R);if(!ve)continue;const Fe=ve.programConfigurations.get(R.id),rt=A.useProgram("heatmap",Fe),{zoom:Le}=A.transform;rt.draw(X,ee.TRIANGLES,Wn.disabled,te,pe,gr.disabled,bh(Ae.posMatrix,Me,Le,R.paint.get("heatmap-intensity")),null,R.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,R.paint,A.transform.zoom,Fe)}X.viewport.set([0,0,A.width,A.height])}else A.renderPass==="translucent"&&(A.context.setColorMode(A.colorModeForRenderPass()),function(X,ee){const te=X.context,pe=te.gl,ke=ee.heatmapFbo;if(!ke)return;te.activeTexture.set(pe.TEXTURE0),pe.bindTexture(pe.TEXTURE_2D,ke.colorAttachment.get()),te.activeTexture.set(pe.TEXTURE1);let Ae=ee.colorRampTexture;Ae||(Ae=ee.colorRampTexture=new J(te,ee.colorRamp,pe.RGBA)),Ae.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),X.useProgram("heatmapTexture").draw(te,pe.TRIANGLES,Wn.disabled,wr.disabled,X.colorModeForRenderPass(),gr.disabled,((Me,ve,Fe,rt)=>{const Le=s.F();s.aN(Le,0,Me.width,Me.height,0,0,1);const Ge=Me.context.gl;return{u_matrix:Le,u_world:[Ge.drawingBufferWidth,Ge.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ve.paint.get("heatmap-opacity")}})(X,ee),null,ee.id,X.viewportBuffer,X.quadTriangleIndexBuffer,X.viewportSegments,ee.paint,X.transform.zoom)}(A,R))})(l,h,_,v);break;case"line":(function(A,P,R,$){if(A.renderPass!=="translucent")return;const X=R.paint.get("line-opacity"),ee=R.paint.get("line-width");if(X.constantOr(1)===0||ee.constantOr(1)===0)return;const te=A.depthModeForSublayer(0,Wn.ReadOnly),pe=A.colorModeForRenderPass(),ke=R.paint.get("line-dasharray"),Ae=R.paint.get("line-pattern"),Me=Ae.constantOr(1),ve=R.paint.get("line-gradient"),Fe=R.getCrossfadeParameters(),rt=Me?"linePattern":ke?"lineSDF":ve?"lineGradient":"line",Le=A.context,Ge=Le.gl;let ot=!0;for(const at of $){const ut=P.getTile(at);if(Me&&!ut.patternsLoaded())continue;const At=ut.getBucket(R);if(!At)continue;const bt=At.programConfigurations.get(R.id),Rt=A.context.program.get(),Ft=A.useProgram(rt,bt),Mn=ot||Ft.program!==Rt,$t=A.style.map.terrain&&A.style.map.terrain.getTerrainData(at),gn=Ae.constantOr(null);if(gn&&ut.imageAtlas){const kn=ut.imageAtlas,Pn=kn.patternPositions[gn.to.toString()],zn=kn.patternPositions[gn.from.toString()];Pn&&zn&&bt.setConstantPatternPositions(Pn,zn)}const En=$t?at:null,Zn=Me?js(A,ut,R,Fe,En):ke?Gl(A,ut,R,ke,Fe,En):ve?xh(A,ut,R,At.lineClipsArray.length,En):Hl(A,ut,R,En);if(Me)Le.activeTexture.set(Ge.TEXTURE0),ut.imageAtlasTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE),bt.updatePaintBuffers(Fe);else if(ke&&(Mn||A.lineAtlas.dirty))Le.activeTexture.set(Ge.TEXTURE0),A.lineAtlas.bind(Le);else if(ve){const kn=At.gradients[R.id];let Pn=kn.texture;if(R.gradientVersion!==kn.version){let zn=256;if(R.stepInterpolant){const Or=P.getSource().maxzoom,fr=at.canonical.z===Or?Math.ceil(1<<A.transform.maxZoom-at.canonical.z):1;zn=s.ac(s.aT(At.maxLineLength/s.W*1024*fr),256,Le.maxTextureSize)}kn.gradient=s.aU({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:kn.gradient||void 0,clips:At.lineClipsArray}),kn.texture?kn.texture.update(kn.gradient):kn.texture=new J(Le,kn.gradient,Ge.RGBA),kn.version=R.gradientVersion,Pn=kn.texture}Le.activeTexture.set(Ge.TEXTURE0),Pn.bind(R.stepInterpolant?Ge.NEAREST:Ge.LINEAR,Ge.CLAMP_TO_EDGE)}Ft.draw(Le,Ge.TRIANGLES,te,A.stencilModeForClipping(at),pe,gr.disabled,Zn,$t,R.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,R.paint,A.transform.zoom,bt,At.layoutVertexBuffer2),ot=!1}})(l,h,_,v);break;case"fill":(function(A,P,R,$){const X=R.paint.get("fill-color"),ee=R.paint.get("fill-opacity");if(ee.constantOr(1)===0)return;const te=A.colorModeForRenderPass(),pe=R.paint.get("fill-pattern"),ke=A.opaquePassEnabledForLayer()&&!pe.constantOr(1)&&X.constantOr(s.aO.transparent).a===1&&ee.constantOr(0)===1?"opaque":"translucent";if(A.renderPass===ke){const Ae=A.depthModeForSublayer(1,A.renderPass==="opaque"?Wn.ReadWrite:Wn.ReadOnly);zh(A,P,R,$,Ae,te,!1)}if(A.renderPass==="translucent"&&R.paint.get("fill-antialias")){const Ae=A.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,Wn.ReadOnly);zh(A,P,R,$,Ae,te,!0)}})(l,h,_,v);break;case"fill-extrusion":(function(A,P,R,$){const X=R.paint.get("fill-extrusion-opacity");if(X!==0&&A.renderPass==="translucent"){const ee=new Wn(A.context.gl.LEQUAL,Wn.ReadWrite,A.depthRangeFor3D);if(X!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))su(A,P,R,$,ee,wr.disabled,Vr.disabled),su(A,P,R,$,ee,A.stencilModeFor3D(),A.colorModeForRenderPass());else{const te=A.colorModeForRenderPass();su(A,P,R,$,ee,wr.disabled,te)}}})(l,h,_,v);break;case"hillshade":(function(A,P,R,$){if(A.renderPass!=="offscreen"&&A.renderPass!=="translucent")return;const X=A.context,ee=A.depthModeForSublayer(0,Wn.ReadOnly),te=A.colorModeForRenderPass(),[pe,ke]=A.renderPass==="translucent"?A.stencilConfigForOverlap($):[{},$];for(const Ae of ke){const Me=P.getTile(Ae);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&A.renderPass==="offscreen"?Sc(A,Me,R,ee,wr.disabled,te):A.renderPass==="translucent"&&au(A,Ae,Me,R,ee,pe[Ae.overscaledZ],te)}X.viewport.set([0,0,A.width,A.height])})(l,h,_,v);break;case"raster":(function(A,P,R,$){if(A.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!$.length)return;const X=A.context,ee=X.gl,te=P.getSource(),pe=A.useProgram("raster"),ke=A.colorModeForRenderPass(),[Ae,Me]=te instanceof jt?[{},$]:A.stencilConfigForOverlap($),ve=Me[Me.length-1].overscaledZ,Fe=!A.options.moving;for(const rt of Me){const Le=A.depthModeForSublayer(rt.overscaledZ-ve,R.paint.get("raster-opacity")===1?Wn.ReadWrite:Wn.ReadOnly,ee.LESS),Ge=P.getTile(rt);Ge.registerFadeDuration(R.paint.get("raster-fade-duration"));const ot=P.findLoadedParent(rt,0),at=Dh(Ge,ot,P,R,A.transform,A.style.map.terrain);let ut,At;const bt=R.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR;X.activeTexture.set(ee.TEXTURE0),Ge.texture.bind(bt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),X.activeTexture.set(ee.TEXTURE1),ot?(ot.texture.bind(bt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),ut=Math.pow(2,ot.tileID.overscaledZ-Ge.tileID.overscaledZ),At=[Ge.tileID.canonical.x*ut%1,Ge.tileID.canonical.y*ut%1]):Ge.texture.bind(bt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST);const Rt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(rt),Ft=Rt?rt:null,Mn=Ft?Ft.posMatrix:A.transform.calculatePosMatrix(rt.toUnwrapped(),Fe),$t=Wl(Mn,At||[0,0],ut||1,at,R);te instanceof jt?pe.draw(X,ee.TRIANGLES,Le,wr.disabled,ke,gr.disabled,$t,Rt,R.id,te.boundsBuffer,A.quadTriangleIndexBuffer,te.boundsSegments):pe.draw(X,ee.TRIANGLES,Le,Ae[rt.overscaledZ],ke,gr.disabled,$t,Rt,R.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments)}})(l,h,_,v);break;case"background":(function(A,P,R,$){const X=R.paint.get("background-color"),ee=R.paint.get("background-opacity");if(ee===0)return;const te=A.context,pe=te.gl,ke=A.transform,Ae=ke.tileSize,Me=R.paint.get("background-pattern");if(A.isPatternMissing(Me))return;const ve=!Me&&X.a===1&&ee===1&&A.opaquePassEnabledForLayer()?"opaque":"translucent";if(A.renderPass!==ve)return;const Fe=wr.disabled,rt=A.depthModeForSublayer(0,ve==="opaque"?Wn.ReadWrite:Wn.ReadOnly),Le=A.colorModeForRenderPass(),Ge=A.useProgram(Me?"backgroundPattern":"background"),ot=$||ke.coveringTiles({tileSize:Ae,terrain:A.style.map.terrain});Me&&(te.activeTexture.set(pe.TEXTURE0),A.imageManager.bind(A.context));const at=R.getCrossfadeParameters();for(const ut of ot){const At=$?ut.posMatrix:A.transform.calculatePosMatrix(ut.toUnwrapped()),bt=Me?Cp(At,ee,A,Me,{tileID:ut,tileSize:Ae},at):Sp(At,ee,X),Rt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ut);Ge.draw(te,pe.TRIANGLES,rt,Fe,Le,gr.disabled,bt,Rt,R.id,A.tileExtentBuffer,A.quadTriangleIndexBuffer,A.tileExtentSegments)}})(l,0,_,v);break;case"custom":(function(A,P,R){const $=A.context,X=R.implementation;if(A.renderPass==="offscreen"){const ee=X.prerender;ee&&(A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),ee.call(X,$.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState())}else if(A.renderPass==="translucent"){A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),$.setStencilMode(wr.disabled);const ee=X.renderingMode==="3d"?new Wn(A.context.gl.LEQUAL,Wn.ReadWrite,A.depthRangeFor3D):A.depthModeForSublayer(0,Wn.ReadOnly);$.setDepthMode(ee),X.render($.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState(),$.bindFramebuffer.set(null)}})(l,0,_)}}translatePosMatrix(l,h,_,v,A){if(!_[0]&&!_[1])return l;const P=A?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(P){const X=Math.sin(P),ee=Math.cos(P);_=[_[0]*ee-_[1]*X,_[0]*X+_[1]*ee]}const R=[A?_[0]:mn(h,_[0],this.transform.zoom),A?_[1]:mn(h,_[1],this.transform.zoom),0],$=new Float32Array(16);return s.H($,l,R),$}saveTileTexture(l){const h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const h=this.imageManager.getPattern(l.from.toString()),_=this.imageManager.getPattern(l.to.toString());return!h||!_}useProgram(l,h){this.cache=this.cache||{};const _=l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new As(this.context,Qa[l],h,Ah[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new J(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:h}=this.context.gl;return this.width!==l||this.height!==h}}class Ss{constructor(l,h){this.points=l,this.planes=h}static fromInvProjectionMatrix(l,h,_){const v=Math.pow(2,_),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const $=1/(R=s.af([],R,l))[3]/h*v;return s.a$(R,R,[$,$,1/R[3],$])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const $=function(pe,ke){var Ae=ke[0],Me=ke[1],ve=ke[2],Fe=Ae*Ae+Me*Me+ve*ve;return Fe>0&&(Fe=1/Math.sqrt(Fe)),pe[0]=ke[0]*Fe,pe[1]=ke[1]*Fe,pe[2]=ke[2]*Fe,pe}([],function(pe,ke,Ae){var Me=ke[0],ve=ke[1],Fe=ke[2],rt=Ae[0],Le=Ae[1],Ge=Ae[2];return pe[0]=ve*Ge-Fe*Le,pe[1]=Fe*rt-Me*Ge,pe[2]=Me*Le-ve*rt,pe}([],Z([],A[R[0]],A[R[1]]),Z([],A[R[2]],A[R[1]]))),X=-((ee=$)[0]*(te=A[R[1]])[0]+ee[1]*te[1]+ee[2]*te[2]);var ee,te;return $.concat(X)});return new Ss(A,P)}}class Cs{constructor(l,h){this.min=l,this.max=h,this.center=function(_,v,A){return _[0]=.5*v[0],_[1]=.5*v[1],_[2]=.5*v[2],_}([],function(_,v,A){return _[0]=v[0]+A[0],_[1]=v[1]+A[1],_[2]=v[2]+A[2],_}([],this.min,this.max))}quadrant(l){const h=[l%2==0,l<2],_=q(this.min),v=q(this.max);for(let A=0;A<h.length;A++)_[A]=h[A]?this.min[A]:this.center[A],v[A]=h[A]?this.center[A]:this.max[A];return v[2]=this.max[2],new Cs(_,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let v=0;v<l.planes.length;v++){const A=l.planes[v];let P=0;for(let R=0;R<h.length;R++)s.b0(A,h[R])>=0&&P++;if(P===0)return 0;P!==h.length&&(_=!1)}if(_)return 2;for(let v=0;v<3;v++){let A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let R=0;R<l.points.length;R++){const $=l.points[R][v]-this.min[v];A=Math.min(A,$),P=Math.max(P,$)}if(P<0||A>this.max[v]-this.min[v])return 0}return 1}}class ya{constructor(l=0,h=0,_=0,v=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=_,this.right=v}interpolate(l,h,_){return h.top!=null&&l.top!=null&&(this.top=s.z.number(l.top,h.top,_)),h.bottom!=null&&l.bottom!=null&&(this.bottom=s.z.number(l.bottom,h.bottom,_)),h.left!=null&&l.left!=null&&(this.left=s.z.number(l.left,h.left,_)),h.right!=null&&l.right!=null&&(this.right=s.z.number(l.right,h.right,_)),this}getCenter(l,h){const _=s.ac((this.left+l-this.right)/2,0,l),v=s.ac((this.top+h-this.bottom)/2,0,h);return new s.P(_,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ya(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Mc=85.051129;class cu{constructor(l,h,_,v,A){this.tileSize=512,this._renderWorldCopies=A===void 0||!!A,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ya,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new cu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const h=-s.b1(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var _=new s.A(4);return s.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,v,A){var P=v[0],R=v[1],$=v[2],X=v[3],ee=Math.sin(A),te=Math.cos(A);_[0]=P*te+$*ee,_[1]=R*te+X*ee,_[2]=P*-ee+$*te,_[3]=R*-ee+X*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=s.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,_){this._unmodified=!1,this._edgeInsets.interpolate(l,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new s.b2(0,l)];if(this._renderWorldCopies){const _=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),A=this.pointCoordinate(new s.P(this.width,this.height)),P=this.pointCoordinate(new s.P(0,this.height)),R=Math.floor(Math.min(_.x,v.x,A.x,P.x)),$=Math.floor(Math.max(_.x,v.x,A.x,P.x)),X=1;for(let ee=R-X;ee<=$+X;ee++)ee!==0&&h.push(new s.b2(ee,l))}return h}coveringTiles(l){var h,_;let v=this.coveringZoomLevel(l);const A=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),R=s.Y.fromLngLat(this.center),$=Math.pow(2,v),X=[$*P.x,$*P.y,0],ee=[$*R.x,$*R.y,0],te=Ss.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let pe=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(pe=v);const ke=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,Ae=Le=>({aabb:new Cs([Le*$,0,0],[(Le+1)*$,$,0]),zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Me=[],ve=[],Fe=v,rt=l.reparseOverscaled?A:v;if(this._renderWorldCopies)for(let Le=1;Le<=3;Le++)Me.push(Ae(-Le)),Me.push(Ae(Le));for(Me.push(Ae(0));Me.length>0;){const Le=Me.pop(),Ge=Le.x,ot=Le.y;let at=Le.fullyVisible;if(!at){const Ft=Le.aabb.intersects(te);if(Ft===0)continue;at=Ft===2}const ut=l.terrain?X:ee,At=Le.aabb.distanceX(ut),bt=Le.aabb.distanceY(ut),Rt=Math.max(Math.abs(At),Math.abs(bt));if(Le.zoom===Fe||Rt>ke+(1<<Fe-Le.zoom)-2&&Le.zoom>=pe){const Ft=Fe-Le.zoom,Mn=X[0]-.5-(Ge<<Ft),$t=X[1]-.5-(ot<<Ft);ve.push({tileID:new s.Q(Le.zoom===Fe?rt:Le.zoom,Le.wrap,Le.zoom,Ge,ot),distanceSq:_e([ee[0]-.5-Ge,ee[1]-.5-ot]),tileDistanceToCamera:Math.sqrt(Mn*Mn+$t*$t)})}else for(let Ft=0;Ft<4;Ft++){const Mn=(Ge<<1)+Ft%2,$t=(ot<<1)+(Ft>>1),gn=Le.zoom+1;let En=Le.aabb.quadrant(Ft);if(l.terrain){const Zn=new s.Q(gn,Le.wrap,gn,Mn,$t),kn=l.terrain.getMinMaxElevation(Zn),Pn=(h=kn.minElevation)!==null&&h!==void 0?h:this.elevation,zn=(_=kn.maxElevation)!==null&&_!==void 0?_:this.elevation;En=new Cs([En.min[0],En.min[1],Pn],[En.max[0],En.max[1],zn])}Me.push({aabb:En,zoom:gn,x:Mn,y:$t,wrap:Le.wrap,fullyVisible:at})}}return ve.sort((Le,Ge)=>Le.distanceSq-Ge.distanceSq).map(Le=>Le.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=s.ac(l.lat,-85.051129,Mc);return new s.P(s.N(l.lng)*this.worldSize,s.O(h)*this.worldSize)}unproject(l){return new s.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const h=this.elevation,_=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,l),A=l.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-A))return;const P=_+h-A,R=Math.cos(this._pitch)*this.cameraToCenterDistance/P/s.b3(1,v.lat),$=this.scaleZoom(R/this.tileSize);this._elevation=A,this._center=v,this.zoom=$}setLocationAtPoint(l,h){const _=this.pointCoordinate(h),v=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(l),P=new s.Y(A.x-(_.x-v.x),A.y-(_.y-v.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,h){return h?this.coordinatePoint(this.locationCoordinate(l),h.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,h){return this.coordinateLocation(this.pointCoordinate(l,h))}locationCoordinate(l){return s.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,h){if(h){const pe=h.pointCoordinate(l);if(pe!=null)return pe}const _=[l.x,l.y,0,1],v=[l.x,l.y,1,1];s.af(_,_,this.pixelMatrixInverse),s.af(v,v,this.pixelMatrixInverse);const A=_[3],P=v[3],R=_[1]/A,$=v[1]/P,X=_[2]/A,ee=v[2]/P,te=X===ee?0:(0-X)/(ee-X);return new s.Y(s.z.number(_[0]/A,v[0]/P,te)/this.worldSize,s.z.number(R,$,te)/this.worldSize)}coordinatePoint(l,h=0,_=this.pixelMatrix){const v=[l.x*this.worldSize,l.y*this.worldSize,h,1];return s.af(v,v,_),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new We().extend(this.pointLocation(new s.P(0,l))).extend(this.pointLocation(new s.P(this.width,l))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new We([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Mc])}calculatePosMatrix(l,h=!1){const _=l.key,v=h?this._alignedPosMatrixCache:this._posMatrixCache;if(v[_])return v[_];const A=l.canonical,P=this.worldSize/this.zoomScale(A.z),R=A.x+Math.pow(2,A.z)*l.wrap,$=s.an(new Float64Array(16));return s.H($,$,[R*P,A.y*P,0]),s.J($,$,[P/s.W,P/s.W,1]),s.K($,h?this.alignedProjMatrix:this.projMatrix,$),v[_]=new Float32Array($),v[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,h){h=s.ac(+h,this.minZoom,this.maxZoom);const _={center:new s.M(l.lng,l.lat),zoom:h};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const Le=179.9999999999;v=[-Le,Le]}const A=this.tileSize*this.zoomScale(_.zoom);let P=0,R=A,$=0,X=A,ee=0,te=0;const{x:pe,y:ke}=this.size;if(this.latRange){const Le=this.latRange;P=s.O(Le[1])*A,R=s.O(Le[0])*A,R-P<ke&&(ee=ke/(R-P))}v&&($=s.b1(s.N(v[0])*A,0,A),X=s.b1(s.N(v[1])*A,0,A),X<$&&(X+=A),X-$<pe&&(te=pe/(X-$)));const{x:Ae,y:Me}=this.project.call({worldSize:A},l);let ve,Fe;const rt=Math.max(te||0,ee||0);if(rt){const Le=new s.P(te?(X+$)/2:Ae,ee?(R+P)/2:Me);return _.center=this.unproject.call({worldSize:A},Le).wrap(),_.zoom+=this.scaleZoom(rt),_}if(this.latRange){const Le=ke/2;Me-Le<P&&(Fe=P+Le),Me+Le>R&&(Fe=R-Le)}if(v){const Le=($+X)/2;let Ge=Ae;this._renderWorldCopies&&(Ge=s.b1(Ae,Le-A/2,Le+A/2));const ot=pe/2;Ge-ot<$&&(ve=$+ot),Ge+ot>X&&(ve=X-ot)}if(ve!==void 0||Fe!==void 0){const Le=new s.P(ve??Ae,Fe??Me);_.center=this.unproject.call({worldSize:A},Le).wrap()}return _}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:h,zoom:_}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=_,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let v=s.an(new Float64Array(16));s.J(v,v,[this.width/2,-this.height/2,1]),s.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=s.an(new Float64Array(16)),s.J(v,v,[1,-1,1]),s.H(v,v,[-1,-1,0]),s.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const A=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),R=A-P*this._pixelPerMeter/Math.cos(this._pitch),$=P<0?R:A,X=Math.PI/2+this._pitch,ee=this._fov*(.5+l.y/this.height),te=Math.sin(ee)*$/Math.sin(s.ac(Math.PI-X-ee,.01,Math.PI-.01)),pe=this.getHorizon(),ke=2*Math.atan(pe/this.cameraToCenterDistance)*(.5+l.y/(2*pe)),Ae=Math.sin(ke)*$/Math.sin(s.ac(Math.PI-X-ke,.01,Math.PI-.01)),Me=Math.min(te,Ae),ve=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+$),Fe=this.height/50;v=new Float64Array(16),s.b4(v,this._fov,this.width/this.height,Fe,ve),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,s.J(v,v,[1,-1,1]),s.H(v,v,[0,0,-this.cameraToCenterDistance]),s.b5(v,v,this._pitch),s.ad(v,v,this.angle),s.H(v,v,[-h,-_,0]),this.mercatorMatrix=s.J([],v,[this.worldSize,this.worldSize,this.worldSize]),s.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,v),s.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=s.ar([],v),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,v);const rt=this.width%2/2,Le=this.height%2/2,Ge=Math.cos(this.angle),ot=Math.sin(this.angle),at=h-Math.round(h)+Ge*rt+ot*Le,ut=_-Math.round(_)+Ge*Le+ot*rt,At=new Float64Array(v);if(s.H(At,At,[at>.5?at-1:at,ut>.5?ut-1:ut,0]),this.alignedProjMatrix=At,v=s.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new s.P(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}getCameraQueryGeometry(l){const h=this.getCameraPoint();if(l.length===1)return[l[0],h];{let _=h.x,v=h.y,A=h.x,P=h.y;for(const R of l)_=Math.min(_,R.x),v=Math.min(v,R.y),A=Math.max(A,R.x),P=Math.max(P,R.y);return[new s.P(_,v),new s.P(A,v),new s.P(A,P),new s.P(_,P),new s.P(_,v)]}}lngLatToCameraDepth(l,h){const _=this.locationCoordinate(l),v=[_.x*this.worldSize,_.y*this.worldSize,h,1];return s.af(v,v,this.projMatrix),v[2]/v[3]}}function Ec(w,l){let h,_=!1,v=null,A=null;const P=()=>{v=null,_&&(w.apply(A,h),v=setTimeout(P,l),_=!1)};return(...R)=>(_=!0,A=this,h=R,v||P(),v)}class Lc{constructor(l){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let _;return h.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(_=v)}),(_&&_[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Ec(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const h=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,v=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,v),P=Math.round(h.lng*A)/A,R=Math.round(h.lat*A)/A,$=this._map.getBearing(),X=this._map.getPitch();let ee="";if(ee+=l?`/${P}/${R}/${_}`:`${_}/${R}/${P}`,($||X)&&(ee+="/"+Math.round(10*$)/10),X&&(ee+=`/${Math.round(X)}`),this._hashName){const te=this._hashName;let pe=!1;const ke=window.location.hash.slice(1).split("&").map(Ae=>{const Me=Ae.split("=")[0];return Me===te?(pe=!0,`${Me}=${ee}`):Ae}).filter(Ae=>Ae);return pe||ke.push(`${te}=${ee}`),`#${ke.join("&")}`}return`#${ee}`}}const al={linearity:.3,easing:s.b6(0,0,.3,1)},Hs=s.e({deceleration:2500,maxSpeed:1400},al),Oh=s.e({deceleration:20,maxSpeed:1400},al),$h=s.e({deceleration:1e3,maxSpeed:360},al),Nh=s.e({deceleration:1e3,maxSpeed:90},al);class jh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=y.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)h.zoom+=A.zoomDelta||0,h.bearing+=A.bearingDelta||0,h.pitch+=A.pitchDelta||0,A.panDelta&&h.pan._add(A.panDelta),A.around&&(h.around=A.around),A.pinchAround&&(h.pinchAround=A.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const A=ul(h.pan.mag(),_,s.e({},Hs,l||{}));v.offset=h.pan.mult(A.amount/h.pan.mag()),v.center=this._map.transform.center,ll(v,A)}if(h.zoom){const A=ul(h.zoom,_,Oh);v.zoom=this._map.transform.zoom+A.amount,ll(v,A)}if(h.bearing){const A=ul(h.bearing,_,$h);v.bearing=this._map.transform.bearing+s.ac(A.amount,-179,179),ll(v,A)}if(h.pitch){const A=ul(h.pitch,_,Nh);v.pitch=this._map.transform.pitch+A.amount,ll(v,A)}if(v.zoom||v.bearing){const A=h.pinchAround===void 0?h.around:h.pinchAround;v.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function ll(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function ul(w,l,h){const{maxSpeed:_,linearity:v,deceleration:A}=h,P=s.ac(w*v/(l/1e3),-_,_),R=Math.abs(P)/(A*v);return{easing:h.easing,duration:1e3*R,amount:P*(R/2)}}class Ni extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,_,v={}){const A=x.mousePos(h.getCanvas(),_),P=h.unproject(A);super(l,s.e({point:A,lngLat:P,originalEvent:_},v)),this._defaultPrevented=!1,this.target=h}}class Vo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,_){const v=l==="touchend"?_.changedTouches:_.touches,A=x.touchPos(h.getCanvasContainer(),v),P=A.map($=>h.unproject($)),R=A.reduce(($,X,ee,te)=>$.add(X.div(te.length)),new s.P(0,0));super(l,{points:A,point:R,lngLats:P,lngLat:h.unproject(R),originalEvent:_}),this._defaultPrevented=!1}}class Ic extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class ko{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Ic(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new Ni(l.type,this._map,l))}mouseup(l){this._map.fire(new Ni(l.type,this._map,l))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Ni(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ni(l.type,this._map,l))}mouseover(l){this._map.fire(new Ni(l.type,this._map,l))}mouseout(l){this._map.fire(new Ni(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Vo(l.type,this._map,l))}touchmove(l){this._map.fire(new Vo(l.type,this._map,l))}touchend(l){this._map.fire(new Vo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Vo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ni(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ni("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ni(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class va{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(s.P.convert(l),this._map.terrain)}}class So{constructor(l,h){this._map=l,this._tr=new va(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const _=h;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=_,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(v.x,_.x),P=Math.max(v.x,_.x),R=Math.min(v.y,_.y),$=Math.max(v.y,_.y);x.setTransform(this._box,`translate(${A}px,${R}px)`),this._box.style.width=P-A+"px",this._box.style.height=$-R+"px"}mouseupWindow(l,h){if(!this._active||l.button!==0)return;const _=this._startPos,v=h;if(this.reset(),x.suppressClick(),_.x!==v.x||_.y!==v.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(_,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new s.k(l,{originalEvent:h}))}}function Gs(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const h={};for(let _=0;_<w.length;_++)h[w[_].identifier]=l[_];return h}class Fp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(v){const A=new s.P(0,0);for(const P of v)A._add(P);return A.div(v.length)}(h),this.touches=Gs(_,h)))}touchmove(l,h,_){if(this.aborted||!this.centroid)return;const v=Gs(_,h);for(const A in this.touches){const P=v[A];(!P||P.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(l,h,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Pc{constructor(l){this.singleTap=new Fp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,h,_){this.singleTap.touchstart(l,h,_)}touchmove(l,h,_){this.singleTap.touchmove(l,h,_)}touchend(l,h,_){const v=this.singleTap.touchend(l,h,_);if(v){const A=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(v)<30;if(A&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Op{constructor(l){this._tr=new va(l),this._zoomIn=new Pc({numTouches:1,numTaps:2}),this._zoomOut=new Pc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,_){this._zoomIn.touchstart(l,h,_),this._zoomOut.touchstart(l,h,_)}touchmove(l,h,_){this._zoomIn.touchmove(l,h,_),this._zoomOut.touchmove(l,h,_)}touchend(l,h,_){const v=this._zoomIn.touchend(l,h,_),A=this._zoomOut.touchend(l,h,_),P=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(v)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ba{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const h=this._moveFunction(...l);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(l,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,h){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=h.length?h[0]:h;return!this._moved&&v.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(_,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const cl={0:1,2:2};class Ho{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const h=x.mouseButton(l);this._eventButton=h}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(h,_){const v=cl[_];return h.buttons===void 0||(h.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class Zt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const fu=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},wa=({enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:h=.8})=>{const _=new Ho({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new ba({clickTolerance:l,move:(v,A)=>({bearingDelta:(A.x-v.x)*h}),moveStateManager:_,enable:w,assignEvents:fu})},xa=({enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:h=-.5})=>{const _=new Ho({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new ba({clickTolerance:l,move:(v,A)=>({pitchDelta:(A.y-v.y)*h}),moveStateManager:_,enable:w,assignEvents:fu})};class Uh{constructor(l,h){this._clickTolerance=l.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,h,_){return this._calculateTransform(l,h,_)}touchmove(l,h,_){if(this._active&&!(_.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,h,_)}touchend(l,h,_){this._calculateTransform(l,h,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,_){_.length>0&&(this._active=!0);const v=Gs(_,h),A=new s.P(0,0),P=new s.P(0,0);let R=0;for(const X in v){const ee=v[X],te=this._touches[X];te&&(A._add(ee),P._add(ee.sub(te)),R++,v[X]=ee)}if(this._touches=v,R<this.minTouchs()||!P.mag())return;const $=P.div(R);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(R),panDelta:$}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,_){if(!this._firstTwoTouches)return;l.preventDefault();const[v,A]=this._firstTwoTouches,P=Aa(_,h,v),R=Aa(_,h,A);if(!P||!R)return;const $=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],$,l)}touchend(l,h,_){if(!this._firstTwoTouches)return;const[v,A]=this._firstTwoTouches,P=Aa(_,h,v),R=Aa(_,h,A);P&&R||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Aa(w,l,h){for(let _=0;_<w.length;_++)if(w[_].identifier===h)return l[_]}function Vh(w,l){return Math.log(w/l)/Math.LN2}class qh extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Vh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vh(this._distance,_),pinchAround:h}}}function hu(w,l){return 180*w.angleWith(l)/Math.PI}class zc extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h,_){const v=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hu(this._vector,v),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,_=hu(l,this._startVector);return Math.abs(_)<h}}function du(w){return Math.abs(w.y)>Math.abs(w.x)}class Hh extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,h,_){super.touchstart(l,h,_),this._currentTouchCount=_.length}_start(l){this._lastPoints=l,du(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),A=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,A,_.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(l,h,_){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,A=h.mag()>=2;if(!v&&!A)return;if(!v||!A)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const P=l.y>0==h.y>0;return du(l)&&du(h)&&P}}const $p={panStep:100,bearingStep:15,pitchStep:10};class Ts{constructor(l){this._tr=new va(l);const h=$p;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,_=0,v=0,A=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(_=0,v=0),{cameraAnimation:R=>{const $=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Tr,zoom:h?Math.round($.zoom)+h*(l.shiftKey?2:1):$.zoom,bearing:$.bearing+_*this._bearingStep,pitch:$.pitch+v*this._pitchStep,offset:[-A*this._panStep,-P*this._panStep],center:$.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tr(w){return w*(2-w)}const fl=4.000244140625;class pu{constructor(l,h){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=l,this._tr=new va(l),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=y.now(),v=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,h!==0&&h%fl==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=x.mousePos(this._map.getCanvas(),l),_=this._tr;this._around=h.y>_.transform.height/2-_.transform.getHorizon()?s.M.convert(this._aroundCenter?_.center:_.unproject(h)):s.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>fl?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&$!==0&&($=1/$);const X=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(X*$))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,_=this._startZoom,v=this._easing;let A,P=!1;if(this._type==="wheel"&&_&&v){const R=Math.min((y.now()-this._lastWheelEventTime)/200,1),$=v(R);A=s.z.number(_,h,$),R<1?this._frameId||(this._frameId=!0):P=!0}else A=h,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:A-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=s.b7;if(this._prevEase){const _=this._prevEase,v=(y.now()-_.start)/_.duration,A=_.easing(v+.01)-_.easing(v),P=.27/Math.sqrt(A*A+1e-4)*.01,R=Math.sqrt(.0729-P*P);h=s.b6(P,R,.25,1)}return this._prevEase={start:y.now(),duration:l,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Dc{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gh{constructor(l){this._tr=new va(l),this.reset()}reset(){this._active=!1}dblclick(l,h){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(){this._tap=new Pc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,h,_){if(!this._swipePoint)if(this._tapTime){const v=h[0],A=l.timeStamp-this._tapTime<500,P=this._tapPoint.dist(v)<30;A&&P?_.length>0&&(this._swipePoint=v,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(l,h,_)}touchmove(l,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const v=h[0],A=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,h,_)}touchend(l,h,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const v=this._tap.touchend(l,h,_);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zh{constructor(l,h,_){this._el=l,this._mousePan=h,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Co{constructor(l,h,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class hl{constructor(l,h,_,v){this._el=l,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class un{constructor(l,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=h,this._container.appendChild(v);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=_,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const dn=w=>w.zoom||w.drag||w.pitch||w.rotate;class mu extends s.k{}function dl(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Rc{constructor(l,h){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,A)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=v.type==="renderFrame"?void 0:v,R={needsRenderFrame:!1},$={},X={},ee=v.touches,te=ee?this._getMapTouches(ee):void 0,pe=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),v);for(const{handlerName:Me,handler:ve,allowed:Fe}of this._handlers){if(!ve.isEnabled())continue;let rt;this._blockedByActive(X,Fe,Me)?ve.reset():ve[A||v.type]&&(rt=ve[A||v.type](v,pe,te),this.mergeHandlerResult(R,$,rt,Me,P),rt&&rt.needsRenderFrame&&this._triggerRenderFrame()),(rt||ve.isActive())&&(X[Me]=ve)}const ke={};for(const Me in this._previousActiveHandlers)X[Me]||(ke[Me]=P);this._previousActiveHandlers=X,(Object.keys(ke).length||dl(R))&&(this._changes.push([R,$,ke]),this._triggerRenderFrame()),(Object.keys(X).length||dl(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ae}=R;Ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ae(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jh(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,A,P]of this._listeners)x.addEventListener(v,A,v===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[l,h,_]of this._listeners)x.removeEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new ko(h,l));const v=h.boxZoom=new So(h,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const A=h.cooperativeGestures=new un(h,l.cooperativeGestures);this._add("cooperativeGestures",A),l.cooperativeGestures&&A.enable();const P=new Op(h),R=new Gh(h);h.doubleClickZoom=new Dc(R,P),this._add("tapZoom",P),this._add("clickZoom",R),l.interactive&&l.doubleClickZoom&&h.doubleClickZoom.enable();const $=new Wh;this._add("tapDragZoom",$);const X=h.touchPitch=new Hh(h);this._add("touchPitch",X),l.interactive&&l.touchPitch&&h.touchPitch.enable(l.touchPitch);const ee=wa(l),te=xa(l);h.dragRotate=new Co(l,ee,te),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),l.interactive&&l.dragRotate&&h.dragRotate.enable();const pe=(({enable:rt,clickTolerance:Le})=>{const Ge=new Ho({checkCorrectEvent:ot=>x.mouseButton(ot)===0&&!ot.ctrlKey});return new ba({clickTolerance:Le,move:(ot,at)=>({around:at,panDelta:at.sub(ot)}),activateOnStart:!0,moveStateManager:Ge,enable:rt,assignEvents:fu})})(l),ke=new Uh(l,h);h.dragPan=new Zh(_,pe,ke),this._add("mousePan",pe),this._add("touchPan",ke,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&h.dragPan.enable(l.dragPan);const Ae=new zc,Me=new qh;h.touchZoomRotate=new hl(_,Me,Ae,$),this._add("touchRotate",Ae,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&h.touchZoomRotate.enable(l.touchZoomRotate);const ve=h.scrollZoom=new pu(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ve,["mousePan"]),l.interactive&&l.scrollZoom&&h.scrollZoom.enable(l.scrollZoom);const Fe=h.keyboard=new Ts(h);this._add("keyboard",Fe),l.interactive&&l.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new qo(h))}_add(l,h,_){this._handlers.push({handlerName:l,handler:h,allowed:_}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dn(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,h,_){for(const v in l)if(v!==_&&(!h||h.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const h=[];for(const _ of l)this._el.contains(_.target)&&h.push(_);return h}mergeHandlerResult(l,h,_,v,A){if(!_)return;s.e(l,_);const P={handlerName:v,originalEvent:_.originalEvent||A};_.zoomDelta!==void 0&&(h.zoom=P),_.panDelta!==void 0&&(h.drag=P),_.pitchDelta!==void 0&&(h.pitch=P),_.bearingDelta!==void 0&&(h.rotate=P)}_applyChanges(){const l={},h={},_={};for(const[v,A,P]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),s.e(h,A),s.e(_,P);this._updateMapTransform(l,h,_),this._changes=[]}_updateMapTransform(l,h,_){const v=this._map,A=v._getTransformForUpdate(),P=v.terrain;if(!(dl(l)||P&&this._terrainMovement))return this._fireEvents(h,_,!0);let{panDelta:R,zoomDelta:$,bearingDelta:X,pitchDelta:ee,around:te,pinchAround:pe}=l;pe!==void 0&&(te=pe),v._stop(!0),te=te||v.transform.centerPoint;const ke=A.pointLocation(R?te.sub(R):te);X&&(A.bearing+=X),ee&&(A.pitch+=ee),$&&(A.zoom+=$),P?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?A.center=A.pointLocation(A.centerPoint.sub(R)):A.setLocationAtPoint(ke,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,A.setLocationAtPoint(ke,te),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,A.recalculateZoom(v.terrain)})):A.setLocationAtPoint(ke,te),v._applyUpdatedTransform(A),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,_,!0)}_fireEvents(l,h,_){const v=dn(this._eventsInProgress),A=dn(l),P={};for(const ee in l){const{originalEvent:te}=l[ee];this._eventsInProgress[ee]||(P[`${ee}start`]=te),this._eventsInProgress[ee]=l[ee]}!v&&A&&this._fireEvent("movestart",A.originalEvent);for(const ee in P)this._fireEvent(ee,P[ee]);A&&this._fireEvent("move",A.originalEvent);for(const ee in l){const{originalEvent:te}=l[ee];this._fireEvent(ee,te)}const R={};let $;for(const ee in this._eventsInProgress){const{handlerName:te,originalEvent:pe}=this._eventsInProgress[ee];this._handlersById[te].isActive()||(delete this._eventsInProgress[ee],$=h[te]||pe,R[`${ee}end`]=$)}for(const ee in R)this._fireEvent(ee,R[ee]);const X=dn(this._eventsInProgress);if(_&&(v||A)&&!X){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=pe=>pe!==0&&-this._bearingSnap<pe&&pe<this._bearingSnap;!ee||!ee.essential&&y.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:$})),te(this._map.getBearing())&&this._map.resetNorth()):(te(ee.bearing||this._map.getBearing())&&(ee.bearing=0),ee.freezeElevation=!0,this._map.easeTo(ee,{originalEvent:$})),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new s.k(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new mu("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ji extends s.E{constructor(l,h){super(),this._renderFrameCallback=()=>{const _=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,_){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},h),_)}panTo(l,h,_){return this.easeTo(s.e({center:l},h),_)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,_){return this.easeTo(s.e({zoom:l},h),_)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,_){return this.easeTo(s.e({bearing:l},h),_)}resetNorth(l,h){return this.rotateTo(0,s.e({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=We.convert(l);const _=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),_,h)}_cameraForBoxAndBearing(l,h,_,v){const A={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const Ft=v.padding;v.padding={top:Ft,bottom:Ft,right:Ft,left:Ft}}v.padding=s.e(A,v.padding);const P=this.transform,R=P.padding,$=new We(l,h),X=P.project($.getNorthWest()),ee=P.project($.getNorthEast()),te=P.project($.getSouthEast()),pe=P.project($.getSouthWest()),ke=s.b8(-_),Ae=X.rotate(ke),Me=ee.rotate(ke),ve=te.rotate(ke),Fe=pe.rotate(ke),rt=new s.P(Math.max(Ae.x,Me.x,Fe.x,ve.x),Math.max(Ae.y,Me.y,Fe.y,ve.y)),Le=new s.P(Math.min(Ae.x,Me.x,Fe.x,ve.x),Math.min(Ae.y,Me.y,Fe.y,ve.y)),Ge=rt.sub(Le),ot=(P.width-(R.left+R.right+v.padding.left+v.padding.right))/Ge.x,at=(P.height-(R.top+R.bottom+v.padding.top+v.padding.bottom))/Ge.y;if(at<0||ot<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ut=Math.min(P.scaleZoom(P.scale*Math.min(ot,at)),v.maxZoom),At=s.P.convert(v.offset),bt=new s.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(s.b8(_)),Rt=At.add(bt).mult(P.scale/P.zoomScale(ut));return{center:P.unproject(X.add(te).div(2).sub(Rt)),zoom:ut,bearing:_}}fitBounds(l,h,_){return this._fitInternal(this.cameraForBounds(l,h),h,_)}fitScreenCoordinates(l,h,_,v,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(l)),this.transform.pointLocation(s.P.convert(h)),_,v),v,A)}_fitInternal(l,h,_){return l?(delete(h=s.e(l,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(l,h){this.stop();const _=this._getTransformForUpdate();let v=!1,A=!1,P=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(v=!0,_.zoom=+l.zoom),l.center!==void 0&&(_.center=s.M.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(A=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(P=!0,_.pitch=+l.pitch),l.padding==null||_.isPaddingEqual(l.padding)||(_.padding=l.padding),this._applyUpdatedTransform(_),this.fire(new s.k("movestart",h)).fire(new s.k("move",h)),v&&this.fire(new s.k("zoomstart",h)).fire(new s.k("zoom",h)).fire(new s.k("zoomend",h)),A&&this.fire(new s.k("rotatestart",h)).fire(new s.k("rotate",h)).fire(new s.k("rotateend",h)),P&&this.fire(new s.k("pitchstart",h)).fire(new s.k("pitch",h)).fire(new s.k("pitchend",h)),this.fire(new s.k("moveend",h))}calculateCameraOptionsFromTo(l,h,_,v=0){const A=s.Y.fromLngLat(l,h),P=s.Y.fromLngLat(_,v),R=P.x-A.x,$=P.y-A.y,X=P.z-A.z,ee=Math.hypot(R,$,X);if(ee===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(R,$),pe=this.transform.scaleZoom(this.transform.cameraToCenterDistance/ee/this.transform.tileSize),ke=180*Math.atan2(R,-$)/Math.PI;let Ae=180*Math.acos(te/ee)/Math.PI;return Ae=X<0?90-Ae:90+Ae,{center:P.toLngLat(),zoom:pe,pitch:Ae,bearing:ke}}easeTo(l,h){var _;this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.b7},l)).animate===!1||!l.essential&&y.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),A=this.getZoom(),P=this.getBearing(),R=this.getPitch(),$=this.getPadding(),X="bearing"in l?this._normalizeBearing(l.bearing,P):P,ee="pitch"in l?+l.pitch:R,te="padding"in l?l.padding:v.padding,pe=s.P.convert(l.offset);let ke=v.centerPoint.add(pe);const Ae=v.pointLocation(ke),{center:Me,zoom:ve}=v.getConstrained(s.M.convert(l.center||Ae),(_=l.zoom)!==null&&_!==void 0?_:A);this._normalizeCenter(Me);const Fe=v.project(Ae),rt=v.project(Me).sub(Fe),Le=v.zoomScale(ve-A);let Ge,ot;l.around&&(Ge=s.M.convert(l.around),ot=v.locationPoint(Ge));const at={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==A,this._rotating=this._rotating||P!==X,this._pitching=this._pitching||ee!==R,this._padding=!v.isPaddingEqual(te),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,at),this.terrain&&this._prepareElevation(Me),this._ease(ut=>{if(this._zooming&&(v.zoom=s.z.number(A,ve,ut)),this._rotating&&(v.bearing=s.z.number(P,X,ut)),this._pitching&&(v.pitch=s.z.number(R,ee,ut)),this._padding&&(v.interpolatePadding($,te,ut),ke=v.centerPoint.add(pe)),this.terrain&&!l.freezeElevation&&this._updateElevation(ut),Ge)v.setLocationAtPoint(Ge,ot);else{const At=v.zoomScale(v.zoom-A),bt=ve>A?Math.min(2,Le):Math.max(.5,Le),Rt=Math.pow(bt,1-ut),Ft=v.unproject(Fe.add(rt.mult(ut*Rt)).mult(At));v.setLocationAtPoint(v.renderWorldCopies?Ft.wrap():Ft,ke)}this._applyUpdatedTransform(v),this._fireMoveEvents(h)},ut=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,ut)},l),this}_prepareEase(l,h,_={}){this._moving=!0,h||_.moving||this.fire(new s.k("movestart",l)),this._zooming&&!_.zooming&&this.fire(new s.k("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new s.k("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new s.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&h!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(_-(h-(_*l+this._elevationStart))/(1-l)),this._elevationTarget=h}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const h=l.clone(),{center:_,zoom:v,pitch:A,bearing:P,elevation:R}=this.transformCameraUpdate(h);_&&(h.center=_),v!==void 0&&(h.zoom=v),A!==void 0&&(h.pitch=A),P!==void 0&&(h.bearing=P),R!==void 0&&(h.elevation=R),this.transform.apply(h)}_fireMoveEvents(l){this.fire(new s.k("move",l)),this._zooming&&this.fire(new s.k("zoom",l)),this._rotating&&this.fire(new s.k("rotate",l)),this._pitching&&this.fire(new s.k("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const _=this._zooming,v=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.k("zoomend",l)),v&&this.fire(new s.k("rotateend",l)),A&&this.fire(new s.k("pitchend",l)),this.fire(new s.k("moveend",l))}flyTo(l,h){var _;if(!l.essential&&y.prefersReducedMotion){const Zn=s.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Zn,h)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},l);const v=this._getTransformForUpdate(),A=this.getZoom(),P=this.getBearing(),R=this.getPitch(),$=this.getPadding(),X="bearing"in l?this._normalizeBearing(l.bearing,P):P,ee="pitch"in l?+l.pitch:R,te="padding"in l?l.padding:v.padding,pe=s.P.convert(l.offset);let ke=v.centerPoint.add(pe);const Ae=v.pointLocation(ke),{center:Me,zoom:ve}=v.getConstrained(s.M.convert(l.center||Ae),(_=l.zoom)!==null&&_!==void 0?_:A);this._normalizeCenter(Me);const Fe=v.zoomScale(ve-A),rt=v.project(Ae),Le=v.project(Me).sub(rt);let Ge=l.curve;const ot=Math.max(v.width,v.height),at=ot/Fe,ut=Le.mag();if("minZoom"in l){const Zn=s.ac(Math.min(l.minZoom,A,ve),v.minZoom,v.maxZoom),kn=ot/v.zoomScale(Zn-A);Ge=Math.sqrt(kn/ut*2)}const At=Ge*Ge;function bt(Zn){const kn=(at*at-ot*ot+(Zn?-1:1)*At*At*ut*ut)/(2*(Zn?at:ot)*At*ut);return Math.log(Math.sqrt(kn*kn+1)-kn)}function Rt(Zn){return(Math.exp(Zn)-Math.exp(-Zn))/2}function Ft(Zn){return(Math.exp(Zn)+Math.exp(-Zn))/2}const Mn=bt(!1);let $t=function(Zn){return Ft(Mn)/Ft(Mn+Ge*Zn)},gn=function(Zn){return ot*((Ft(Mn)*(Rt(kn=Mn+Ge*Zn)/Ft(kn))-Rt(Mn))/At)/ut;var kn},En=(bt(!0)-Mn)/Ge;if(Math.abs(ut)<1e-6||!isFinite(En)){if(Math.abs(ot-at)<1e-6)return this.easeTo(l,h);const Zn=at<ot?-1:1;En=Math.abs(Math.log(at/ot))/Ge,gn=function(){return 0},$t=function(kn){return Math.exp(Zn*Ge*kn)}}return l.duration="duration"in l?+l.duration:1e3*En/("screenSpeed"in l?+l.screenSpeed/Ge:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=P!==X,this._pitching=ee!==R,this._padding=!v.isPaddingEqual(te),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Me),this._ease(Zn=>{const kn=Zn*En,Pn=1/$t(kn);v.zoom=Zn===1?ve:A+v.scaleZoom(Pn),this._rotating&&(v.bearing=s.z.number(P,X,Zn)),this._pitching&&(v.pitch=s.z.number(R,ee,Zn)),this._padding&&(v.interpolatePadding($,te,Zn),ke=v.centerPoint.add(pe)),this.terrain&&!l.freezeElevation&&this._updateElevation(Zn);const zn=Zn===1?Me:v.unproject(rt.add(Le.mult(gn(kn))).mult(Pn));v.setLocationAtPoint(v.renderWorldCopies?zn.wrap():zn,ke),this._applyUpdatedTransform(v),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,h)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,h,_){_.animate===!1||_.duration===0?(l(1),h()):(this._easeStart=y.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,h){l=s.b1(l,-180,180);const _=Math.abs(l-h);return Math.abs(l-360-h)<_&&(l-=360),Math.abs(l+360-h)<_&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const _=l.lng-h.center.lng;l.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const Bc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class To{constructor(l=Bc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,h){const _=this._map._getUIString(`AttributionControl.${h}`);l.title=_,l.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style.sourceCaches;for(const v in h){const A=h[v];if(A.used||A.usedForTerrain){const P=A.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,A)=>v.length-A.length),l=l.filter((v,A)=>{for(let P=A+1;P<l.length;P++)if(l[P].indexOf(v)>=0)return!1;return!0});const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Xh{constructor(l={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const _=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const h=x.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class pl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const v of _)if(v.id===l)return void(v.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fr=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class qr extends s.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,h){this.sourceCache.update(l,h),this._renderableTilesKeys=[];const _={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))_[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),s.aN(v.posMatrix,0,s.W,0,s.W,0,1),this._tiles[v.key]=new mr(v,this.tileSize));for(const v in this._tiles)_[v]||delete this._tiles[v]}freeRtt(l){for(const h in this._tiles){const _=this._tiles[h];(!l||_.tileID.equals(l)||_.tileID.isChildOf(l)||l.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const h={};for(const _ of this._renderableTilesKeys){const v=this._tiles[_].tileID;if(v.canonical.equals(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16),s.aN(A.posMatrix,0,s.W,0,s.W,0,1),h[_]=A}else if(v.canonical.isChildOf(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const P=v.canonical.z-l.canonical.z,R=v.canonical.x-(v.canonical.x>>P<<P),$=v.canonical.y-(v.canonical.y>>P<<P),X=s.W>>P;s.aN(A.posMatrix,0,X,0,X,0,1),s.H(A.posMatrix,A.posMatrix,[-R*X,-$*X,0]),h[_]=A}else if(l.canonical.isChildOf(v.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const P=l.canonical.z-v.canonical.z,R=l.canonical.x-(l.canonical.x>>P<<P),$=l.canonical.y-(l.canonical.y>>P<<P),X=s.W>>P;s.aN(A.posMatrix,0,s.W,0,s.W,0,1),s.H(A.posMatrix,A.posMatrix,[R*X,$*X,0]),s.J(A.posMatrix,A.posMatrix,[1/2**P,1/2**P,0]),h[_]=A}}return h}getSourceTile(l,h){const _=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>_.maxzoom&&(v=_.maxzoom),v<_.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!A||!A.dem)&&h)for(;v>=_.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(l.scaledTo(v--).key);return A}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=l)}}class Kh{constructor(l,h,_){this.painter=l,this.sourceCache=new qr(h),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,h,_,v=s.W){var A;if(!(h>=0&&h<v&&_>=0&&_<v))return 0;const P=this.getTerrainData(l),R=(A=P.tile)===null||A===void 0?void 0:A.dem;if(!R)return 0;const $=function(Ae,Me,ve){var Fe=Me[0],rt=Me[1];return Ae[0]=ve[0]*Fe+ve[4]*rt+ve[12],Ae[1]=ve[1]*Fe+ve[5]*rt+ve[13],Ae}([],[h/v*s.W,_/v*s.W],P.u_terrain_matrix),X=[$[0]*R.dim,$[1]*R.dim],ee=Math.floor(X[0]),te=Math.floor(X[1]),pe=X[0]-ee,ke=X[1]-te;return R.get(ee,te)*(1-pe)*(1-ke)+R.get(ee+1,te)*pe*(1-ke)+R.get(ee,te+1)*(1-pe)*ke+R.get(ee+1,te+1)*pe*ke}getElevationForLngLatZoom(l,h){const{tileID:_,mercatorX:v,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(l,h);return this.getElevation(_,v%s.W,A%s.W,s.W)}getElevation(l,h,_,v=s.W){return this.getDEMElevation(l,h,_,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,A=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new J(v,A,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new J(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const h=this.sourceCache.getSourceTile(l,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const v=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new J(v,h.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),h.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const _=h&&h+h.tileID.key+l.key;if(_&&!this._demMatrixCache[_]){const v=this.sourceCache.sourceCache._source.maxzoom;let A=l.canonical.z-h.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?A=l.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=l.canonical.x-(l.canonical.x>>A<<A),R=l.canonical.y-(l.canonical.y>>A<<A),$=s.b9(new Float64Array(16),[1/(s.W<<A),1/(s.W<<A),0]);s.H($,$,[P*s.W,R*s.W,0]),this._demMatrixCache[l.key]={matrix:$,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(l){const h=this.painter,_=h.width/devicePixelRatio,v=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new J(h.context,{width:_,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new J(h.context,{width:_,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(_,v,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,_,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,P=0;A<this._coordsTextureSize;A++)for(let R=0;R<this._coordsTextureSize;R++,P+=4)h[P+0]=255&R,h[P+1]=255&A,h[P+2]=R>>8<<4|A>>8,h[P+3]=0;const _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),v=new J(l,_,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),_=this.painter.context,v=_.gl,A=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(A,R-P-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const $=h[0]+(h[2]>>4<<8),X=h[1]+((15&h[2])<<8),ee=this.coordsIndex[255-h[3]],te=ee&&this.sourceCache.getTileByID(ee);if(!te)return null;const pe=this._coordsTextureSize,ke=(1<<te.tileID.canonical.z)*pe;return new s.Y((te.tileID.canonical.x*pe+$)/ke+te.tileID.wrap,(te.tileID.canonical.y*pe+X)/ke,this.getElevation(te.tileID,$,X,pe))}depthAtPoint(l){const h=new Uint8Array(4),_=this.painter.context,v=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,h=new s.ba,_=new s.aX,v=this.meshSize,A=s.W/v,P=v*v;for(let te=0;te<=v;te++)for(let pe=0;pe<=v;pe++)h.emplaceBack(pe*A,te*A,0);for(let te=0;te<P;te+=v+1)for(let pe=0;pe<v;pe++)_.emplaceBack(pe+te,v+pe+te+1,v+pe+te+2),_.emplaceBack(pe+te,v+pe+te+2,pe+te+1);const R=h.length,$=R+2*(v+1);for(const te of[0,1])for(let pe=0;pe<=v;pe++)for(const ke of[0,1])h.emplaceBack(pe*A,te*s.W,ke);for(let te=0;te<2*v;te+=2)_.emplaceBack($+te,$+te+1,$+te+3),_.emplaceBack($+te,$+te+3,$+te+2),_.emplaceBack(R+te,R+te+3,R+te+1),_.emplaceBack(R+te,R+te+2,R+te+3);const X=h.length,ee=X+2*(v+1);for(const te of[0,1])for(let pe=0;pe<=v;pe++)for(const ke of[0,1])h.emplaceBack(te*s.W,pe*A,ke);for(let te=0;te<2*v;te+=2)_.emplaceBack(X+te,X+te+1,X+te+3),_.emplaceBack(X+te,X+te+3,X+te+2),_.emplaceBack(ee+te,ee+te+3,ee+te+1),_.emplaceBack(ee+te,ee+te+2,ee+te+3);return this._mesh={indexBuffer:l.createIndexBuffer(_),vertexBuffer:l.createVertexBuffer(h,Fr.members),segments:s.$.simpleSegment(0,0,h.length,_.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*s.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,h){var _;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,h);return(_=this.getMinMaxElevation(v).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(l){const h=this.getTerrainData(l).tile,_={minElevation:null,maxElevation:null};return h&&h.dem&&(_.minElevation=h.dem.min*this.exaggeration,_.maxElevation=h.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(l,h){const _=s.Y.fromLngLat(l.wrap()),v=(1<<h)*s.W,A=_.x*v,P=_.y*v,R=Math.floor(A/s.W),$=Math.floor(P/s.W);return{tileID:new s.Q(h,0,h,R,$),mercatorX:A,mercatorY:P}}}class ml{constructor(l,h,_){this._context=l,this._size=h,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new J(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(_.texture),{id:l,fbo:h,texture:_,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>l.id!==h),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const us={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Fc{constructor(l,h){this.painter=l,this.terrain=h,this.pool=new ml(l.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(_=>!l._layers[_].isHidden(h)),this._coordsDescendingInv={};for(const _ in l.sourceCaches){this._coordsDescendingInv[_]={};const v=l.sourceCaches[_].getVisibleCoordinates();for(const A of v){const P=this.terrain.sourceCache.getTerrainCoords(A);for(const R in P)this._coordsDescendingInv[_][R]||(this._coordsDescendingInv[_][R]=[]),this._coordsDescendingInv[_][R].push(P[R])}}this._coordsDescendingInvStr={};for(const _ of l._order){const v=l._layers[_],A=v.source;if(us[v.type]&&!this._coordsDescendingInvStr[A]){this._coordsDescendingInvStr[A]={};for(const P in this._coordsDescendingInv[A])this._coordsDescendingInvStr[A][P]=this._coordsDescendingInv[A][P].map(R=>R.key).sort().join()}}for(const _ of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const A=this._coordsDescendingInvStr[v][_.tileID.key];A&&A!==_.rttCoords[v]&&(_.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const h=l.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(us[h]&&(this._prevType&&us[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(us[this._prevType]||us[h]&&v){this._prevType=h;const A=this._stacks.length-1,P=this._stacks[A]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(uu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[A]){const X=this.pool.getObjectForId(R.rtt[A].id);if(X.stamp===R.rtt[A].stamp){this.pool.useObject(X);continue}}const $=this.pool.getOrCreateFreeObject();this.pool.useObject($),this.pool.stampObject($),R.rtt[A]={id:$.id,stamp:$.stamp},_.context.bindFramebuffer.set($.fbo.framebuffer),_.context.clear({color:s.aO.transparent,stencil:0}),_.currentStencilSource=void 0;for(let X=0;X<P.length;X++){const ee=_.style._layers[P[X]],te=ee.source?this._coordsDescendingInv[ee.source][R.tileID.key]:[R.tileID];_.context.viewport.set([0,0,$.fbo.width,$.fbo.height]),_._renderTileClippingMasks(ee,te),_.renderLayer(_,_.style.sourceCaches[ee.source],ee,te),ee.source&&(R.rttCoords[ee.source]=this._coordsDescendingInvStr[ee.source][R.tileID.key])}}return uu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),us[h]}return!1}}const Oc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$c=d,gl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Bc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},gu=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class jc{constructor(l,h,_=!1){this.mousedown=P=>{this.startMouse(s.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),x.mousePos(this.element,P)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,x.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),A=l.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=wa({clickTolerance:v,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:R,bearingDegreesPerPixelMoved:$=.8})=>{const X=new Zt;return new ba({clickTolerance:R,move:(ee,te)=>({bearingDelta:(te.x-ee.x)*$}),moveStateManager:X,enable:P,assignEvents:gu})})({clickTolerance:v,enable:!0}),this.map=l,_&&(this.mousePitch=xa({clickTolerance:A,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:R,pitchDegreesPerPixelMoved:$=-.5})=>{const X=new Zt;return new ba({clickTolerance:R,move:(ee,te)=>({pitchDelta:(te.y-ee.y)*$}),moveStateManager:X,enable:P,assignEvents:gu})})({clickTolerance:A,enable:!0})),x.addEventListener(h,"mousedown",this.mousedown),x.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(h,"touchcancel",this.reset)}startMouse(l,h){this.mouseRotate.dragStart(l,h),this.mousePitch&&this.mousePitch.dragStart(l,h),x.disableDrag()}startTouch(l,h){this.touchRotate.dragStart(l,h),this.touchPitch&&this.touchPitch.dragStart(l,h),x.disableDrag()}moveMouse(l,h){const _=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,h)||{};if(v&&_.setBearing(_.getBearing()+v),this.mousePitch){const{pitchDelta:A}=this.mousePitch.dragMove(l,h)||{};A&&_.setPitch(_.getPitch()+A)}}moveTouch(l,h){const _=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,h)||{};if(v&&_.setBearing(_.getBearing()+v),this.touchPitch){const{pitchDelta:A}=this.touchPitch.dragMove(l,h)||{};A&&_.setPitch(_.getPitch()+A)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let cs;function _u(w,l,h){const _=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),l){const v=new s.M(w.lng-360,w.lat),A=new s.M(w.lng+360,w.lat),P=h.locationPoint(w).distSqr(l);h.locationPoint(v).distSqr(l)<P?w=v:h.locationPoint(A).distSqr(l)<P&&(w=A)}for(;Math.abs(w.lng-h.center.lng)>180;){const v=h.locationPoint(w);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;w.lng>h.center.lng?w.lng-=360:w.lng+=360}return w.lng!==_.lng&&h.locationPoint(w).y>h.height/2-h.getHorizon()?w:_}const _l={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yu(w,l,h){const _=w.classList;for(const v in _l)_.remove(`maplibregl-${h}-anchor-${v}`);_.add(`maplibregl-${h}-anchor-${l}`)}class yl extends s.E{constructor(l){if(super(),this._onKeyPress=h=>{const _=h.code,v=h.charCode||h.keyCode;_!=="Space"&&_!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=h=>{const _=h.originalEvent.target,v=this._element;this._popup&&(_===v||v.contains(_))&&this.togglePopup()},this._update=h=>{var _;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?_u(this._lngLat,this._flatPos,this._map.transform):(_=this._lngLat)===null||_===void 0?void 0:_.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${_l[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${A}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const h=x.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${_}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const A=x.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const P=x.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const R=x.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Fe of $){const rt=x.createNS("http://www.w3.org/2000/svg","ellipse");rt.setAttributeNS(null,"opacity","0.04"),rt.setAttributeNS(null,"cx","10.5"),rt.setAttributeNS(null,"cy","5.80029008"),rt.setAttributeNS(null,"rx",Fe.rx),rt.setAttributeNS(null,"ry",Fe.ry),R.appendChild(rt)}const X=x.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"fill",this._color);const ee=x.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),X.appendChild(ee);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const pe=x.createNS("http://www.w3.org/2000/svg","path");pe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(pe);const ke=x.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ke.setAttributeNS(null,"fill","#FFFFFF");const Ae=x.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=x.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const ve=x.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#FFFFFF"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Me),Ae.appendChild(ve),P.appendChild(R),P.appendChild(X),P.appendChild(te),P.appendChild(ke),P.appendChild(Ae),h.appendChild(P),h.setAttributeNS(null,"height",_*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),yu(this._element,this._anchor,"marker"),l&&l.className)for(const h of l.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var h,_;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,A=v.terrain.depthAtPoint(this._pos),P=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,P)-A<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/v.transform._pixelPerMeter,$=Math.sin(v.getPitch()*Math.PI/180)*R,X=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),ee=v.transform.lngLatToCameraDepth(this._lngLat,P+$)-X>.006;!((_=this._popup)===null||_===void 0)&&_.isOpen()&&ee&&this._popup.remove(),this._element.style.opacity=ee?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,h){return l===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const vu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ka=0,Ws=!1;const bu={maxWidth:100,unit:"metric"};function wu(w,l,h){const _=h&&h.maxWidth||100,v=w._container.clientHeight/2,A=w.unproject([0,v]),P=w.unproject([_,v]),R=A.distanceTo(P);if(h&&h.unit==="imperial"){const $=3.2808*R;$>5280?Zs(l,_,$/5280,w._getUIString("ScaleControl.Miles")):Zs(l,_,$,w._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Zs(l,_,R/1852,w._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Zs(l,_,R/1e3,w._getUIString("ScaleControl.Kilometers")):Zs(l,_,R,w._getUIString("ScaleControl.Meters"))}function Zs(w,l,h,_){const v=function(A){const P=Math.pow(10,`${Math.floor(A)}`.length-1);let R=A/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function($){const X=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*X)/X}(R),P*R}(h);w.style.width=l*(v/h)+"px",w.innerHTML=`${v}&nbsp;${_}`}const Uc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xu(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-w),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const l=s.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return xu(new s.P(0,0))}const Jh=d;u.AJAXError=s.be,u.Evented=s.E,u.LngLat=s.M,u.MercatorCoordinate=s.Y,u.Point=s.P,u.addProtocol=s.bf,u.config=s.a,u.removeProtocol=s.bg,u.AttributionControl=To,u.BoxZoomHandler=So,u.CanvasSource=Un,u.CooperativeGesturesHandler=un,u.DoubleClickZoomHandler=Dc,u.DragPanHandler=Zh,u.DragRotateHandler=Co,u.EdgeInsets=ya,u.FullscreenControl=class extends s.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var l;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=h==null?void 0:h.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Pe,u.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const h=new s.M(l.coords.longitude,l.coords.latitude),_=l.coords.accuracy,v=this._map.getBearing(),A=s.e({bearing:v},this.options.fitBoundsOptions),P=We.fromLngLat(h,_);this._map.fitBounds(P,A,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const h=new s.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Ws)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new yl({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},vu,w)}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function*(l=!1){if(cs!==void 0&&!l)return cs;if(window.navigator.permissions===void 0)return cs=!!window.navigator.geolocation,cs;try{cs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{cs=!!window.navigator.geolocation}return cs})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ka=0,Ws=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),h=w.coords;return l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),h=w.getNorthEast(),_=l.distanceTo(h),v=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ka--,Ws=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ka++,ka>1?(w={maximumAge:6e5,timeout:0},Ws=!0):(w=this.options.positionOptions,Ws=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Lc,u.ImageSource=jt,u.KeyboardHandler=Ts,u.LngLatBounds=We,u.LogoControl=Xh,u.Map=class extends ji{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},gl,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new cu(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new pl,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Oc,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=B.addThrottleControl(()=>this.isMoving()),this._requestManager=new O(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const h=Ec(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{l?h(_):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Rc(this,w),this._hash=w.hash&&new Lc(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new To(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Xh,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=w.onAdd(this);this._controls.push(w);const _=this._controlPositions[l];return l.indexOf("bottom")!==-1?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,h,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,h,_)}resize(w){var l;const h=this._containerDimensions(),_=h[0],v=h[1],A=this._getClampedPixelRatio(_,v);if(this._resizeCanvas(_,v,A),this.painter.resize(_,v,A),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const $=this._getClampedPixelRatio(_,v);this._resizeCanvas(_,v,$),this.painter.resize(_,v,$)}this.transform.resize(_,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(_,v);const P=!this._moving;return P&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),P&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:h,1:_}=this._maxCanvasSize,v=this.getPixelRatio(),A=w*v,P=l*v;return Math.min(A>h?h/A:1,P>_?_/P:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(We.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,h){if(w==="mouseenter"||w==="mouseover"){let _=!1;return{layer:l,listener:h,delegates:{mousemove:A=>{const P=this.getLayer(l)?this.queryRenderedFeatures(A.point,{layers:[l]}):[];P.length?_||(_=!0,h.call(this,new Ni(w,this,A.originalEvent,{features:P}))):_=!1},mouseout:()=>{_=!1}}}}if(w==="mouseleave"||w==="mouseout"){let _=!1;return{layer:l,listener:h,delegates:{mousemove:P=>{(this.getLayer(l)?this.queryRenderedFeatures(P.point,{layers:[l]}):[]).length?_=!0:_&&(_=!1,h.call(this,new Ni(w,this,P.originalEvent)))},mouseout:P=>{_&&(_=!1,h.call(this,new Ni(w,this,P.originalEvent)))}}}}{const _=v=>{const A=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];A.length&&(v.features=A,h.call(this,v),delete v.features)};return{layer:l,listener:h,delegates:{[w]:_}}}}on(w,l,h){if(h===void 0)return super.on(w,l);const _=this._createDelegatedListener(w,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(_);for(const v in _.delegates)this.on(v,_.delegates[v]);return this}once(w,l,h){if(h===void 0)return super.once(w,l);const _=this._createDelegatedListener(w,l,h);for(const v in _.delegates)this.once(v,_.delegates[v]);return this}off(w,l,h){return h===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(_=>{const v=this._delegatedListeners[w];for(let A=0;A<v.length;A++){const P=v[A];if(P.layer===l&&P.listener===h){for(const R in P.delegates)this.off(R,P.delegates[R]);return v.splice(A,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let h;const _=w instanceof s.P||Array.isArray(w),v=_?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(_?{}:w)||{},v instanceof s.P||typeof v[0]=="number")h=[s.P.convert(v)];else{const A=s.P.convert(v[0]),P=s.P.convert(v[1]);h=[A,new s.P(P.x,A.y),P,new s.P(A.x,P.y),A]}return this.style.queryRenderedFeatures(h,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const h=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new to(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,h):this.style.loadJSON(w,l,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new to(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const h=this._requestManager.transformRequest(w,"Style");s.h(h,new AbortController).then(_=>{this._updateDiff(_.data,l)}).catch(_=>{_&&this.fire(new s.j(_))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(h){s.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const h in this.style._layers){const _=this.style._layers[h];_.type==="hillshade"&&_.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Kh(this.painter,l,w),this.painter.renderToTexture=new Fc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const h=w[l]._tiles;for(const _ in h){const v=h[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,h={}){const{pixelRatio:_=1,sdf:v=!1,stretchX:A,stretchY:P,content:R}=h;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:X,data:ee}=l,te=l;return this.style.addImage(w,{data:new s.R({width:$,height:X},new Uint8Array(ee)),pixelRatio:_,stretchX:A,stretchY:P,content:R,sdf:v,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:$,height:X,data:ee}=y.getImageData(l);this.style.addImage(w,{data:new s.R({width:$,height:X},ee),pixelRatio:_,stretchX:A,stretchY:P,content:R,sdf:v,version:0})}}updateImage(w,l){const h=this.style.getImage(w);if(!h)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof HTMLImageElement||s.b(l)?y.getImageData(l):l,{width:v,height:A,data:P}=_;if(v===void 0||A===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||A!==h.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(l instanceof HTMLImageElement||s.b(l));return h.data.replace(P,R),this.style.updateImage(w,h),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return B.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,h){return this.style.setLayerZoomRange(w,l,h),this._update(!0)}setFilter(w,l,h={}){return this.style.setFilter(w,l,h),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,h,_={}){return this.style.setPaintProperty(w,l,h,_),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,h,_={}){return this.style.setLayoutProperty(w,l,h,_),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,h,_=>{_||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,h=>{h||this._update(!0)}),this}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),_=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],_);const v=this._controlContainer=x.create("div","maplibregl-control-container",w),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{A[P]=x.create("div",`maplibregl-ctrl-${P} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,h){this._canvas.width=Math.floor(h*w),this._canvas.height=Math.floor(h*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{l={requestedAttributes:w},_&&(l.statusMessage=_.statusMessage,l.type=_.type)},{once:!0});const h=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!h){const _="Failed to initialize WebGL";throw l?(l.message=_,new Error(JSON.stringify(l))):new Error(_)}this.painter=new Fh(h,this.transform),C.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,A=y.now();this.style.zoomHistory.update(v,A);const P=new s.a8(v,{now:A,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=P.crossFadingFactor();R===1&&R===this._crossFadingFactor||(h=!0,this._crossFadingFactor=R),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),B.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return $c}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Ni,u.MapTouchEvent=Vo,u.MapWheelEvent=Ic,u.Marker=yl,u.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),h=l===this._map.getMaxZoom(),_=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,h)=>{const _=this._map._getUIString(`NavigationControl.${h}`);l.title=_,l.setAttribute("aria-label",_)},this.options=s.e({},Nc,w),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const h=x.create("button",w,this._container);return h.type="button",h.addEventListener("click",l),h}},u.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?_u(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!l)return;const _=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const A=xu(this.options.offset);if(!v){const R=this._container.offsetWidth,$=this._container.offsetHeight;let X;X=_.y+A.bottom.y<$?["top"]:_.y>this._map.transform.height-$?["bottom"]:[],_.x<R/2?X.push("left"):_.x>this._map.transform.width-R/2&&X.push("right"),v=X.length===0?"bottom":X.join("-")}let P=_.add(A[v]);this.options.subpixelPositioning||(P=P.round()),x.setTransform(this._container,`${_l[v]} translate(${P.x}px,${P.y}px)`),yu(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Uc),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),h=document.createElement("body");let _;for(h.innerHTML=w;_=h.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Vc);w&&w.focus()}},u.RasterDEMTileSource=nn,u.RasterTileSource=he,u.ScaleControl=class{constructor(w){this._onMove=()=>{wu(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,wu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},bu),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=pu,u.Style=to,u.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Hh,u.TwoFingersTouchRotateHandler=zc,u.TwoFingersTouchZoomHandler=qh,u.TwoFingersTouchZoomRotateHandler=hl,u.VectorTileSource=Pt,u.VideoSource=Gn,u.addSourceType=(w,l)=>s._(void 0,void 0,void 0,function*(){if(Wt(w))throw new Error(`A source type called "${w}" already exists.`);((h,_)=>{jn[h]=_})(w,l)}),u.clearPrewarmedResources=function(){const w=yt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(ct),yt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return _t().getRTLTextPluginStatus()},u.getVersion=function(){return Jh},u.getWorkerCount=function(){return dt.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(w){return tn().broadcast("IS",w)},u.prewarm=function(){Ot().acquire(ct)},u.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},u.setRTLTextPlugin=function(w,l){return _t().setRTLTextPlugin(w,l)},u.setWorkerCount=function(w){dt.workerCount=w},u.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(gw);var sa=gw.exports;const Qr=mw(sa),Ek=ik({__proto__:null,default:Qr},[sa]);let cn;const yw=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&yw.decode();let Af=null;function Lf(){return(Af===null||Af.byteLength===0)&&(Af=new Uint8Array(cn.memory.buffer)),Af}function Ko(r,e){return r=r>>>0,yw.decode(Lf().subarray(r,r+e))}const ra=new Array(128).fill(void 0);ra.push(void 0,null,!0,!1);let If=ra.length;function Yr(r){If===ra.length&&ra.push(ra.length+1);const e=If;return If=ra[e],ra[e]=r,e}function Xn(r){return ra[r]}function Lk(r){r<132||(ra[r]=If,If=r)}function Vu(r){const e=Xn(r);return Lk(r),e}function Tm(r){return r==null}let kf=null;function Ik(){return(kf===null||kf.byteLength===0)&&(kf=new Float64Array(cn.memory.buffer)),kf}let Sf=null;function nr(){return(Sf===null||Sf.byteLength===0)&&(Sf=new Int32Array(cn.memory.buffer)),Sf}let za=0;const zd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Pk=typeof zd.encodeInto=="function"?function(r,e){return zd.encodeInto(r,e)}:function(r,e){const t=zd.encode(r);return e.set(t),{read:r.length,written:t.length}};function wd(r,e,t){if(t===void 0){const s=zd.encode(r),d=e(s.length,1)>>>0;return Lf().subarray(d,d+s.length).set(s),za=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Lf();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Lf().subarray(i+u,i+n),d=Pk(r,s);u+=d.written}return za=u,i}function Wm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Wm(r[0]));for(let u=1;u<i;u++)o+=", "+Wm(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function zk(r,e){const t=e(r.length*1,1)>>>0;return Lf().set(r,t/1),za=r.length,t}function Mm(r,e){try{return r.apply(this,e)}catch(t){cn.__wbindgen_exn_store(Yr(t))}}class Gd{static __wrap(e){e=e>>>0;const t=Object.create(Gd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();cn.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=cn.__wbindgen_add_to_stack_pointer(-16),u=zk(e,cn.__wbindgen_malloc),s=za;cn.jsroutesnapper_new(o,u,s);var t=nr()[o/4+0],n=nr()[o/4+1],i=nr()[o/4+2];if(i)throw Vu(n);return Gd.__wrap(t)}finally{cn.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){cn.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Yr(e))}setAreaMode(){cn.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=nr()[o/4+0],i=nr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=nr()[n/4+0],t=nr()[n/4+1];let i;return e!==0&&(i=Ko(e,t).slice(),cn.__wbindgen_free(e,t*1)),i}finally{cn.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=nr()[o/4+0],i=nr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(e,t,1)}}toggleSnapMode(){cn.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return cn.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){cn.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return cn.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return cn.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){cn.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_editExisting(i,this.__wbg_ptr,Yr(e));var t=nr()[i/4+0],n=nr()[i/4+1];if(n)throw Vu(t)}finally{cn.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=nr()[o/4+0],i=nr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=nr()[o/4+0],i=nr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,Yr(e));var i=nr()[g/4+0],o=nr()[g/4+1],u=nr()[g/4+2],s=nr()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Vu(u);return t=d,n=p,Ko(d,p)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){cn.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){cn.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,Yr(e));var i=nr()[g/4+0],o=nr()[g/4+1],u=nr()[g/4+2],s=nr()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Vu(u);return t=d,n=p,Ko(d,p)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const y=cn.__wbindgen_add_to_stack_pointer(-16);cn.jsroutesnapper_getExtraNodes(y,this.__wbg_ptr,Yr(e),Yr(t));var o=nr()[y/4+0],u=nr()[y/4+1],s=nr()[y/4+2],d=nr()[y/4+3],p=o,g=u;if(d)throw p=0,g=0,Vu(s);return n=p,i=g,Ko(p,g)}finally{cn.__wbindgen_add_to_stack_pointer(16),cn.__wbindgen_free(n,i,1)}}}async function Dk(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Rk(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ko(e,t);return Yr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Vu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ko(e,t));return Yr(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Xn(t),i=typeof n=="number"?n:void 0;Ik()[e/8+1]=Tm(i)?0:i,nr()[e/4+0]=!Tm(i)},r.wbg.__wbindgen_is_object=function(e){const t=Xn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Xn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Xn(e)in Xn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Xn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Xn(e)==Xn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Xn(t),i=typeof n=="string"?n:void 0;var o=Tm(i)?0:wd(i,cn.__wbindgen_malloc,cn.__wbindgen_realloc),u=za;nr()[e/4+1]=u,nr()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Xn(t)),i=wd(n,cn.__wbindgen_malloc,cn.__wbindgen_realloc),o=za;nr()[e/4+1]=o,nr()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Xn(e);return Yr(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Xn(e)[Xn(t)];return Yr(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Yr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Xn(t).stack,i=wd(n,cn.__wbindgen_malloc,cn.__wbindgen_realloc),o=za;nr()[e/4+1]=o,nr()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ko(e,t))}finally{cn.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Xn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Xn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Xn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Xn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Xn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Xn(e)[t>>>0];return Yr(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Xn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Xn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Xn(e).next;return Yr(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Mm(function(e){const t=Xn(e).next();return Yr(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Xn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Xn(e).value;return Yr(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Yr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Mm(function(e,t){const n=Reflect.get(Xn(e),Xn(t));return Yr(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Mm(function(e,t){const n=Xn(e).call(Xn(t));return Yr(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Xn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Xn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Xn(e).buffer;return Yr(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Xn(e));return Yr(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Xn(e).set(Xn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Xn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Xn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Wm(Xn(t)),i=wd(n,cn.__wbindgen_malloc,cn.__wbindgen_realloc),o=za;nr()[e/4+1]=o,nr()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ko(e,t))},r.wbg.__wbindgen_memory=function(){const e=cn.memory;return Yr(e)},r}function Bk(r,e){return cn=r.exports,vw.__wbindgen_wasm_module=e,kf=null,Sf=null,Af=null,cn}async function vw(r){if(cn!==void 0)return cn;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Rk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Dk(await r,e);return Bk(t,n)}var Zi=63710088e-1,Og={centimeters:Zi*100,centimetres:Zi*100,degrees:Zi/111325,feet:Zi*3.28084,inches:Zi*39.37,kilometers:Zi/1e3,kilometres:Zi/1e3,meters:Zi,metres:Zi,miles:Zi/1609.344,millimeters:Zi*1e3,millimetres:Zi*1e3,nauticalmiles:Zi/1852,radians:1,yards:Zi*1.0936},Fk={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Zi,yards:1.0936133},Zm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function is(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ok(r,e,t){switch(r){case"Point":return yo(e).geometry;case"LineString":return Qo(e).geometry;case"Polygon":return $g(e).geometry;case"MultiPoint":return ww(e).geometry;case"MultiLineString":return bw(e).geometry;case"MultiPolygon":return xw(e).geometry;default:throw new Error(r+" is invalid")}}function yo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wd(r[0])||!Wd(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return is(n,e,t)}function $k(r,e,t){return t===void 0&&(t={}),Pl(r.map(function(n){return yo(n,e)}),t)}function $g(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return is(s,e,t)}function Nk(r,e,t){return t===void 0&&(t={}),Pl(r.map(function(n){return $g(n,e)}),t)}function Qo(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return is(n,e,t)}function jk(r,e,t){return t===void 0&&(t={}),Pl(r.map(function(n){return Qo(n,e)}),t)}function Pl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function bw(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return is(n,e,t)}function ww(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return is(n,e,t)}function xw(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return is(n,e,t)}function Uk(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return is(n,e,t)}function Vk(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Ng(r,e){e===void 0&&(e="kilometers");var t=Og[e];if(!t)throw new Error(e+" units is invalid");return r*t}function up(r,e){e===void 0&&(e="kilometers");var t=Og[e];if(!t)throw new Error(e+" units is invalid");return r/t}function qk(r,e){return jf(up(r,e))}function Hk(r){var e=r%360;return e<0&&(e+=360),e}function jf(r){var e=r%(2*Math.PI);return e*180/Math.PI}function es(r){var e=r%360;return e*Math.PI/180}function Gk(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Ng(up(r,e),t)}function Wk(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Zm[e];if(!n)throw new Error("invalid original units");var i=Zm[t];if(!i)throw new Error("invalid final units");return r/n*i}function Wd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function jg(r){return!!r&&r.constructor===Object}function Zk(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Wd(e))throw new Error("bbox must only contain numbers")})}function Xk(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Kk=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Zm,bearingToAzimuth:Hk,convertArea:Wk,convertLength:Gk,degreesToRadians:es,earthRadius:Zi,factors:Og,feature:is,featureCollection:Pl,geometry:Ok,geometryCollection:Uk,isNumber:Wd,isObject:jg,lengthToDegrees:qk,lengthToRadians:up,lineString:Qo,lineStrings:jk,multiLineString:bw,multiPoint:ww,multiPolygon:xw,point:yo,points:$k,polygon:$g,polygons:Nk,radiansToDegrees:jf,radiansToLength:Ng,round:Vk,unitsFactors:Fk,validateBBox:Zk,validateId:Xk},Symbol.toStringTag,{value:"Module"}));function Uf(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Qu(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function eh(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,y=0,x,C=r.type,T=C==="FeatureCollection",E=C==="Feature",z=T?r.features.length:1,I=0;I<z;I++){p=T?r.features[I].geometry:E?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var L=0;L<s;L++){var B=0,O=0;if(u=x?p.geometries[L]:p,u!==null){d=u.coordinates;var Y=u.type;switch(g=t&&(Y==="Polygon"||Y==="MultiPolygon")?1:0,Y){case null:break;case"Point":if(e(d,y,I,B,O)===!1)return!1;y++,B++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,I,B,O)===!1)return!1;y++,Y==="MultiPoint"&&B++}Y==="LineString"&&B++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,I,B,O)===!1)return!1;y++}Y==="MultiLineString"&&B++,Y==="Polygon"&&O++}Y==="Polygon"&&B++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,I,B,O)===!1)return!1;y++}O++}B++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(eh(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Jk(r,e,t,n){var i=t;return eh(r,function(o,u,s,d,p){u===0&&t===void 0?i=o:i=e(i,o,u,s,d,p)},n),i}function Aw(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Yk(r,e,t){var n=t;return Aw(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Zd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Qk(r,e,t){var n=t;return Zd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function e3(r){var e=[];return eh(r,function(t){e.push(t)}),e}function Ug(r,e){var t,n,i,o,u,s,d,p,g,y,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",E=C?r.features.length:1;for(t=0;t<E;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,y=C?r.features[t].id:T?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function t3(r,e,t){var n=t;return Ug(r,function(i,o,u,s,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,s,d)}),n}function cc(r,e){Ug(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(is(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],y={type:d,coordinates:g};if(e(is(y,i),n,p)===!1)return!1}})}function n3(r,e,t){var n=t;return cc(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function kw(r,e){cc(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var s,d=0,p=0,g=0;if(eh(t,function(y,x,C,T,E){if(s===void 0||n>d||T>p||E>g){s=y,d=n,p=T,g=E,o=0;return}var z=Qo([s,y],t.properties);if(e(z,n,i,E,o)===!1)return!1;o++,s=y})===!1)return!1}}})}function r3(r,e,t){var n=t,i=!1;return kw(r,function(o,u,s,d,p){i===!1&&t===void 0?n=o:n=e(n,o,u,s,d,p),i=!0}),n}function Sw(r,e){if(!r)throw new Error("geojson is required");cc(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<u.length;s++)if(e(Qo(u[s],t.properties),n,i,s)===!1)return!1;break}}})}function i3(r,e,t){var n=t;return Sw(r,function(i,o,u,s){o===0&&t===void 0?n=i:n=e(n,i,o,u,s)}),n}function o3(r,e){if(e=e||{},!jg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Qo([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Qo([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Qo([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Qo([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function s3(r,e){if(e=e||{},!jg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":return yo(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),yo(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),yo(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),yo(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),yo(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),yo(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const a3=Object.freeze(Object.defineProperty({__proto__:null,coordAll:e3,coordEach:eh,coordReduce:Jk,featureEach:Zd,featureReduce:Qk,findPoint:s3,findSegment:o3,flattenEach:cc,flattenReduce:n3,geomEach:Ug,geomReduce:t3,lineEach:Sw,lineReduce:i3,propEach:Aw,propReduce:Yk,segmentEach:kw,segmentReduce:r3},Symbol.toStringTag,{value:"Module"}));function Cw(r,e,t){if(t===void 0&&(t={}),t.final===!0)return l3(r,e);var n=Uf(r),i=Uf(e),o=es(n[0]),u=es(i[0]),s=es(n[1]),d=es(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return jf(Math.atan2(p,g))}function l3(r,e){var t=Cw(e,r);return t=(t+180)%360,t}function df(r,e,t){t===void 0&&(t={});var n=Uf(r),i=Uf(e),o=es(i[1]-n[1]),u=es(i[0]-n[0]),s=es(n[1]),d=es(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return Ng(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function ry(r,e,t,n){n===void 0&&(n={});var i=Uf(r),o=es(i[0]),u=es(i[1]),s=es(t),d=up(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),y=jf(g),x=jf(p);return yo([y,x],n.properties)}function iy(r){if(!r)throw new Error("geojson is required");var e=[];return cc(r,function(t){u3(t,e)}),Pl(e)}function u3(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Qu(n);break;case"LineString":t=[Qu(n)]}t.forEach(function(i){var o=c3(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function c3(r,e){var t=[];return r.reduce(function(n,i){var o=Qo([n,i],e);return o.bbox=f3(n,i),t.push(o),i}),t}function f3(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,s=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[u,s,d,p]}var Vg={exports:{}},Tw={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(pw,function(){function t(L,B,O,Y,q){(function H(Z,_e,Ie,J,fe){for(;J>Ie;){if(J-Ie>600){var Ee=J-Ie+1,ye=_e-Ie+1,Oe=Math.log(Ee),Ue=.5*Math.exp(2*Oe/3),De=.5*Math.sqrt(Oe*Ue*(Ee-Ue)/Ee)*(ye-Ee/2<0?-1:1),xe=Math.max(Ie,Math.floor(_e-ye*Ue/Ee+De)),et=Math.min(J,Math.floor(_e+(Ee-ye)*Ue/Ee+De));H(Z,_e,xe,et,fe)}var Ze=Z[_e],Qe=Ie,ct=J;for(n(Z,Ie,_e),fe(Z[J],Ze)>0&&n(Z,Ie,J);Qe<ct;){for(n(Z,Qe,ct),Qe++,ct--;fe(Z[Qe],Ze)<0;)Qe++;for(;fe(Z[ct],Ze)>0;)ct--}fe(Z[Ie],Ze)===0?n(Z,Ie,ct):n(Z,++ct,J),ct<=_e&&(Ie=ct+1),_e<=ct&&(J=ct-1)}})(L,B,O||0,Y||L.length-1,q||i)}function n(L,B,O){var Y=L[B];L[B]=L[O],L[O]=Y}function i(L,B){return L<B?-1:L>B?1:0}var o=function(L){L===void 0&&(L=9),this._maxEntries=Math.max(4,L),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(L,B,O){if(!O)return B.indexOf(L);for(var Y=0;Y<B.length;Y++)if(O(L,B[Y]))return Y;return-1}function s(L,B){d(L,0,L.children.length,B,L)}function d(L,B,O,Y,q){q||(q=z(null)),q.minX=1/0,q.minY=1/0,q.maxX=-1/0,q.maxY=-1/0;for(var H=B;H<O;H++){var Z=L.children[H];p(q,L.leaf?Y(Z):Z)}return q}function p(L,B){return L.minX=Math.min(L.minX,B.minX),L.minY=Math.min(L.minY,B.minY),L.maxX=Math.max(L.maxX,B.maxX),L.maxY=Math.max(L.maxY,B.maxY),L}function g(L,B){return L.minX-B.minX}function y(L,B){return L.minY-B.minY}function x(L){return(L.maxX-L.minX)*(L.maxY-L.minY)}function C(L){return L.maxX-L.minX+(L.maxY-L.minY)}function T(L,B){return L.minX<=B.minX&&L.minY<=B.minY&&B.maxX<=L.maxX&&B.maxY<=L.maxY}function E(L,B){return B.minX<=L.maxX&&B.minY<=L.maxY&&B.maxX>=L.minX&&B.maxY>=L.minY}function z(L){return{children:L,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function I(L,B,O,Y,q){for(var H=[B,O];H.length;)if(!((O=H.pop())-(B=H.pop())<=Y)){var Z=B+Math.ceil((O-B)/Y/2)*Y;t(L,Z,B,O,q),H.push(B,Z,Z,O)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(L){var B=this.data,O=[];if(!E(L,B))return O;for(var Y=this.toBBox,q=[];B;){for(var H=0;H<B.children.length;H++){var Z=B.children[H],_e=B.leaf?Y(Z):Z;E(L,_e)&&(B.leaf?O.push(Z):T(L,_e)?this._all(Z,O):q.push(Z))}B=q.pop()}return O},o.prototype.collides=function(L){var B=this.data;if(!E(L,B))return!1;for(var O=[];B;){for(var Y=0;Y<B.children.length;Y++){var q=B.children[Y],H=B.leaf?this.toBBox(q):q;if(E(L,H)){if(B.leaf||T(L,H))return!0;O.push(q)}}B=O.pop()}return!1},o.prototype.load=function(L){if(!L||!L.length)return this;if(L.length<this._minEntries){for(var B=0;B<L.length;B++)this.insert(L[B]);return this}var O=this._build(L.slice(),0,L.length-1,0);if(this.data.children.length)if(this.data.height===O.height)this._splitRoot(this.data,O);else{if(this.data.height<O.height){var Y=this.data;this.data=O,O=Y}this._insert(O,this.data.height-O.height-1,!0)}else this.data=O;return this},o.prototype.insert=function(L){return L&&this._insert(L,this.data.height-1),this},o.prototype.clear=function(){return this.data=z([]),this},o.prototype.remove=function(L,B){if(!L)return this;for(var O,Y,q,H=this.data,Z=this.toBBox(L),_e=[],Ie=[];H||_e.length;){if(H||(H=_e.pop(),Y=_e[_e.length-1],O=Ie.pop(),q=!0),H.leaf){var J=u(L,H.children,B);if(J!==-1)return H.children.splice(J,1),_e.push(H),this._condense(_e),this}q||H.leaf||!T(H,Z)?Y?(O++,H=Y.children[O],q=!1):H=null:(_e.push(H),Ie.push(O),O=0,Y=H,H=H.children[0])}return this},o.prototype.toBBox=function(L){return L},o.prototype.compareMinX=function(L,B){return L.minX-B.minX},o.prototype.compareMinY=function(L,B){return L.minY-B.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(L){return this.data=L,this},o.prototype._all=function(L,B){for(var O=[];L;)L.leaf?B.push.apply(B,L.children):O.push.apply(O,L.children),L=O.pop();return B},o.prototype._build=function(L,B,O,Y){var q,H=O-B+1,Z=this._maxEntries;if(H<=Z)return s(q=z(L.slice(B,O+1)),this.toBBox),q;Y||(Y=Math.ceil(Math.log(H)/Math.log(Z)),Z=Math.ceil(H/Math.pow(Z,Y-1))),(q=z([])).leaf=!1,q.height=Y;var _e=Math.ceil(H/Z),Ie=_e*Math.ceil(Math.sqrt(Z));I(L,B,O,Ie,this.compareMinX);for(var J=B;J<=O;J+=Ie){var fe=Math.min(J+Ie-1,O);I(L,J,fe,_e,this.compareMinY);for(var Ee=J;Ee<=fe;Ee+=_e){var ye=Math.min(Ee+_e-1,fe);q.children.push(this._build(L,Ee,ye,Y-1))}}return s(q,this.toBBox),q},o.prototype._chooseSubtree=function(L,B,O,Y){for(;Y.push(B),!B.leaf&&Y.length-1!==O;){for(var q=1/0,H=1/0,Z=void 0,_e=0;_e<B.children.length;_e++){var Ie=B.children[_e],J=x(Ie),fe=(Ee=L,ye=Ie,(Math.max(ye.maxX,Ee.maxX)-Math.min(ye.minX,Ee.minX))*(Math.max(ye.maxY,Ee.maxY)-Math.min(ye.minY,Ee.minY))-J);fe<H?(H=fe,q=J<q?J:q,Z=Ie):fe===H&&J<q&&(q=J,Z=Ie)}B=Z||B.children[0]}var Ee,ye;return B},o.prototype._insert=function(L,B,O){var Y=O?L:this.toBBox(L),q=[],H=this._chooseSubtree(Y,this.data,B,q);for(H.children.push(L),p(H,Y);B>=0&&q[B].children.length>this._maxEntries;)this._split(q,B),B--;this._adjustParentBBoxes(Y,q,B)},o.prototype._split=function(L,B){var O=L[B],Y=O.children.length,q=this._minEntries;this._chooseSplitAxis(O,q,Y);var H=this._chooseSplitIndex(O,q,Y),Z=z(O.children.splice(H,O.children.length-H));Z.height=O.height,Z.leaf=O.leaf,s(O,this.toBBox),s(Z,this.toBBox),B?L[B-1].children.push(Z):this._splitRoot(O,Z)},o.prototype._splitRoot=function(L,B){this.data=z([L,B]),this.data.height=L.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(L,B,O){for(var Y,q,H,Z,_e,Ie,J,fe=1/0,Ee=1/0,ye=B;ye<=O-B;ye++){var Oe=d(L,0,ye,this.toBBox),Ue=d(L,ye,O,this.toBBox),De=(q=Oe,H=Ue,Z=void 0,_e=void 0,Ie=void 0,J=void 0,Z=Math.max(q.minX,H.minX),_e=Math.max(q.minY,H.minY),Ie=Math.min(q.maxX,H.maxX),J=Math.min(q.maxY,H.maxY),Math.max(0,Ie-Z)*Math.max(0,J-_e)),xe=x(Oe)+x(Ue);De<fe?(fe=De,Y=ye,Ee=xe<Ee?xe:Ee):De===fe&&xe<Ee&&(Ee=xe,Y=ye)}return Y||O-B},o.prototype._chooseSplitAxis=function(L,B,O){var Y=L.leaf?this.compareMinX:g,q=L.leaf?this.compareMinY:y;this._allDistMargin(L,B,O,Y)<this._allDistMargin(L,B,O,q)&&L.children.sort(Y)},o.prototype._allDistMargin=function(L,B,O,Y){L.children.sort(Y);for(var q=this.toBBox,H=d(L,0,B,q),Z=d(L,O-B,O,q),_e=C(H)+C(Z),Ie=B;Ie<O-B;Ie++){var J=L.children[Ie];p(H,L.leaf?q(J):J),_e+=C(H)}for(var fe=O-B-1;fe>=B;fe--){var Ee=L.children[fe];p(Z,L.leaf?q(Ee):Ee),_e+=C(Z)}return _e},o.prototype._adjustParentBBoxes=function(L,B,O){for(var Y=O;Y>=0;Y--)p(B[Y],L)},o.prototype._condense=function(L){for(var B=L.length-1,O=void 0;B>=0;B--)L[B].children.length===0?B>0?(O=L[B-1].children).splice(O.indexOf(L[B]),1):this.clear():s(L[B],this.toBBox)},o})})(Tw);var h3=Tw.exports;const d3=Fg(Kk),p3=Fg(a3);function Mw(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,y=0,x,C=r.type,T=C==="FeatureCollection",E=C==="Feature",z=T?r.features.length:1,I=0;I<z;I++){p=T?r.features[I].geometry:E?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var L=0;L<s;L++){var B=0,O=0;if(u=x?p.geometries[L]:p,u!==null){d=u.coordinates;var Y=u.type;switch(g=t&&(Y==="Polygon"||Y==="MultiPolygon")?1:0,Y){case null:break;case"Point":if(e(d,y,I,B,O)===!1)return!1;y++,B++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,I,B,O)===!1)return!1;y++,Y==="MultiPoint"&&B++}Y==="LineString"&&B++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,I,B,O)===!1)return!1;y++}Y==="MultiLineString"&&B++,Y==="Polygon"&&O++}Y==="Polygon"&&B++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,I,B,O)===!1)return!1;y++}O++}B++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Mw(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ew(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Mw(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var m3=Ew;const g3=Object.freeze(Object.defineProperty({__proto__:null,bbox:Ew,default:m3},Symbol.toStringTag,{value:"Module"})),_3=Fg(g3);var zs=h3,Lw=d3,Iw=p3,Bu=_3.default,y3=Iw.featureEach;Iw.coordEach;Lw.polygon;var oy=Lw.featureCollection;function Pw(r){var e=new zs(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Bu(t),zs.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Bu(i),n.push(i)}):y3(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Bu(i),n.push(i)}),zs.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Bu(t),zs.prototype.remove.call(this,t,n)},e.clear=function(){return zs.prototype.clear.call(this)},e.search=function(t){var n=zs.prototype.search.call(this,this.toBBox(t));return oy(n)},e.collides=function(t){return zs.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=zs.prototype.all.call(this);return oy(t)},e.toJSON=function(){return zs.prototype.toJSON.call(this)},e.fromJSON=function(t){return zs.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Bu(t);else if(t.type==="FeatureCollection")n=Bu(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Vg.exports=Pw;Vg.exports.default=Pw;var v3=Vg.exports;const b3=mw(v3);function w3(r,e){var t={},n=[];if(r.type==="LineString"&&(r=is(r)),e.type==="LineString"&&(e=is(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=sy(r,e);return i&&n.push(i),Pl(n)}var o=b3();return o.load(iy(e)),Zd(iy(r),function(u){Zd(o.search(u),function(s){var d=sy(u,s);if(d){var p=Qu(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),Pl(n)}function sy(r,e){var t=Qu(r),n=Qu(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],s=t[1][1],d=n[0][0],p=n[0][1],g=n[1][0],y=n[1][1],x=(y-p)*(u-i)-(g-d)*(s-o),C=(g-d)*(o-p)-(y-p)*(i-d),T=(u-i)*(o-p)-(s-o)*(i-d);if(x===0)return null;var E=C/x,z=T/x;if(E>=0&&E<=1&&z>=0&&z<=1){var I=i+E*(u-i),L=o+E*(s-o);return yo([I,L])}return null}function x3(r,e,t){t===void 0&&(t={});var n=yo([1/0,1/0],{dist:1/0}),i=0;return cc(r,function(o){for(var u=Qu(o),s=0;s<u.length-1;s++){var d=yo(u[s]);d.properties.dist=df(e,d,t);var p=yo(u[s+1]);p.properties.dist=df(e,p,t);var g=df(d,p,t),y=Math.max(d.properties.dist,p.properties.dist),x=Cw(d,p),C=ry(e,y,x+90,t),T=ry(e,y,x-90,t),E=w3(Qo([C.geometry.coordinates,T.geometry.coordinates]),Qo([d.geometry.coordinates,p.geometry.coordinates])),z=null;E.features.length>0&&(z=E.features[0],z.properties.dist=df(e,z,t),z.properties.location=i+df(d,z,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=s,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=s+1,n.properties.location=i+g),z&&z.properties.dist<n.properties.dist&&(n=z,n.properties.index=s),i+=g}}),n}const A3=30;class k3{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const s=[u.point.x-A3,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Gd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Fu=[];function Dd(r,e){return{subscribe:Cn(r,e).subscribe}}function Cn(r,e=lt){let t;const n=new Set;function i(s){if(wt(r,s)&&(r=s,t)){const d=!Fu.length;for(const p of n)p[1](),Fu.push(p,r);if(d){for(let p=0;p<Fu.length;p+=2)Fu[p][0](Fu[p+1]);Fu.length=0}}}function o(s){i(s(r))}function u(s,d=lt){const p=[s,d];return n.add(p),n.size===1&&(t=e(i,o)||lt),s(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}function zw(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return Dd(t,(u,s)=>{let d=!1;const p=[];let g=0,y=lt;const x=()=>{if(g)return;y();const T=e(n?p[0]:p,u,s);o?u(T):y=ca(T)?T:lt},C=i.map((T,E)=>Lg(T,z=>{p[E]=z,g&=~(1<<E),d&&x()},()=>{g|=1<<E}));return d=!0,x(),function(){sr(C),y(),d=!1}})}var bo="top",os="bottom",ss="right",wo="left",qg="auto",th=[bo,os,ss,wo],ec="start",Vf="end",S3="clippingParents",Dw="viewport",pf="popper",C3="reference",ay=th.reduce(function(r,e){return r.concat([e+"-"+ec,e+"-"+Vf])},[]),Rw=[].concat(th,[qg]).reduce(function(r,e){return r.concat([e,e+"-"+ec,e+"-"+Vf])},[]),T3="beforeRead",M3="read",E3="afterRead",L3="beforeMain",I3="main",P3="afterMain",z3="beforeWrite",D3="write",R3="afterWrite",B3=[T3,M3,E3,L3,I3,P3,z3,D3,R3];function Fs(r){return r?(r.nodeName||"").toLowerCase():null}function No(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function zl(r){var e=No(r).Element;return r instanceof e||r instanceof Element}function ns(r){var e=No(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Hg(r){if(typeof ShadowRoot>"u")return!1;var e=No(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function F3(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];!ns(o)||!Fs(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(u){var s=i[u];s===!1?o.removeAttribute(u):o.setAttribute(u,s===!0?"":s)}))})}function O3(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),s=u.reduce(function(d,p){return d[p]="",d},{});!ns(i)||!Fs(i)||(Object.assign(i.style,s),Object.keys(o).forEach(function(d){i.removeAttribute(d)}))})}}const Bw={name:"applyStyles",enabled:!0,phase:"write",fn:F3,effect:O3,requires:["computeStyles"]};function Bs(r){return r.split("-")[0]}var Ll=Math.max,Xd=Math.min,tc=Math.round;function Xm(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Fw(){return!/^((?!chrome|android).)*safari/i.test(Xm())}function nc(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=r.getBoundingClientRect(),i=1,o=1;e&&ns(r)&&(i=r.offsetWidth>0&&tc(n.width)/r.offsetWidth||1,o=r.offsetHeight>0&&tc(n.height)/r.offsetHeight||1);var u=zl(r)?No(r):window,s=u.visualViewport,d=!Fw()&&t,p=(n.left+(d&&s?s.offsetLeft:0))/i,g=(n.top+(d&&s?s.offsetTop:0))/o,y=n.width/i,x=n.height/o;return{width:y,height:x,top:g,right:p+y,bottom:g+x,left:p,x:p,y:g}}function Gg(r){var e=nc(r),t=r.offsetWidth,n=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:n}}function Ow(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Hg(t)){var n=e;do{if(n&&r.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function aa(r){return No(r).getComputedStyle(r)}function $3(r){return["table","td","th"].indexOf(Fs(r))>=0}function Ua(r){return((zl(r)?r.ownerDocument:r.document)||window.document).documentElement}function cp(r){return Fs(r)==="html"?r:r.assignedSlot||r.parentNode||(Hg(r)?r.host:null)||Ua(r)}function ly(r){return!ns(r)||aa(r).position==="fixed"?null:r.offsetParent}function N3(r){var e=/firefox/i.test(Xm()),t=/Trident/i.test(Xm());if(t&&ns(r)){var n=aa(r);if(n.position==="fixed")return null}var i=cp(r);for(Hg(i)&&(i=i.host);ns(i)&&["html","body"].indexOf(Fs(i))<0;){var o=aa(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function nh(r){for(var e=No(r),t=ly(r);t&&$3(t)&&aa(t).position==="static";)t=ly(t);return t&&(Fs(t)==="html"||Fs(t)==="body"&&aa(t).position==="static")?e:t||N3(r)||e}function Wg(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Pf(r,e,t){return Ll(r,Xd(e,t))}function j3(r,e,t){var n=Pf(r,e,t);return n>t?t:n}function $w(){return{top:0,right:0,bottom:0,left:0}}function Nw(r){return Object.assign({},$w(),r)}function jw(r,e){return e.reduce(function(t,n){return t[n]=r,t},{})}var U3=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Nw(typeof e!="number"?e:jw(e,th))};function V3(r){var e,t=r.state,n=r.name,i=r.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,s=Bs(t.placement),d=Wg(s),p=[wo,ss].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!u)){var y=U3(i.padding,t),x=Gg(o),C=d==="y"?bo:wo,T=d==="y"?os:ss,E=t.rects.reference[g]+t.rects.reference[d]-u[d]-t.rects.popper[g],z=u[d]-t.rects.reference[d],I=nh(o),L=I?d==="y"?I.clientHeight||0:I.clientWidth||0:0,B=E/2-z/2,O=y[C],Y=L-x[g]-y[T],q=L/2-x[g]/2+B,H=Pf(O,q,Y),Z=d;t.modifiersData[n]=(e={},e[Z]=H,e.centerOffset=H-q,e)}}function q3(r){var e=r.state,t=r.options,n=t.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||Ow(e.elements.popper,i)&&(e.elements.arrow=i))}const H3={name:"arrow",enabled:!0,phase:"main",fn:V3,effect:q3,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function rc(r){return r.split("-")[1]}var G3={top:"auto",right:"auto",bottom:"auto",left:"auto"};function W3(r,e){var t=r.x,n=r.y,i=e.devicePixelRatio||1;return{x:tc(t*i)/i||0,y:tc(n*i)/i||0}}function uy(r){var e,t=r.popper,n=r.popperRect,i=r.placement,o=r.variation,u=r.offsets,s=r.position,d=r.gpuAcceleration,p=r.adaptive,g=r.roundOffsets,y=r.isFixed,x=u.x,C=x===void 0?0:x,T=u.y,E=T===void 0?0:T,z=typeof g=="function"?g({x:C,y:E}):{x:C,y:E};C=z.x,E=z.y;var I=u.hasOwnProperty("x"),L=u.hasOwnProperty("y"),B=wo,O=bo,Y=window;if(p){var q=nh(t),H="clientHeight",Z="clientWidth";if(q===No(t)&&(q=Ua(t),aa(q).position!=="static"&&s==="absolute"&&(H="scrollHeight",Z="scrollWidth")),q=q,i===bo||(i===wo||i===ss)&&o===Vf){O=os;var _e=y&&q===Y&&Y.visualViewport?Y.visualViewport.height:q[H];E-=_e-n.height,E*=d?1:-1}if(i===wo||(i===bo||i===os)&&o===Vf){B=ss;var Ie=y&&q===Y&&Y.visualViewport?Y.visualViewport.width:q[Z];C-=Ie-n.width,C*=d?1:-1}}var J=Object.assign({position:s},p&&G3),fe=g===!0?W3({x:C,y:E},No(t)):{x:C,y:E};if(C=fe.x,E=fe.y,d){var Ee;return Object.assign({},J,(Ee={},Ee[O]=L?"0":"",Ee[B]=I?"0":"",Ee.transform=(Y.devicePixelRatio||1)<=1?"translate("+C+"px, "+E+"px)":"translate3d("+C+"px, "+E+"px, 0)",Ee))}return Object.assign({},J,(e={},e[O]=L?E+"px":"",e[B]=I?C+"px":"",e.transform="",e))}function Z3(r){var e=r.state,t=r.options,n=t.gpuAcceleration,i=n===void 0?!0:n,o=t.adaptive,u=o===void 0?!0:o,s=t.roundOffsets,d=s===void 0?!0:s,p={placement:Bs(e.placement),variation:rc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,uy(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,uy(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const X3={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Z3,data:{}};var xd={passive:!0};function K3(r){var e=r.state,t=r.instance,n=r.options,i=n.scroll,o=i===void 0?!0:i,u=n.resize,s=u===void 0?!0:u,d=No(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,xd)}),s&&d.addEventListener("resize",t.update,xd),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,xd)}),s&&d.removeEventListener("resize",t.update,xd)}}const J3={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:K3,data:{}};var Y3={left:"right",right:"left",bottom:"top",top:"bottom"};function Rd(r){return r.replace(/left|right|bottom|top/g,function(e){return Y3[e]})}var Q3={start:"end",end:"start"};function cy(r){return r.replace(/start|end/g,function(e){return Q3[e]})}function Zg(r){var e=No(r),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function Xg(r){return nc(Ua(r)).left+Zg(r).scrollLeft}function e4(r,e){var t=No(r),n=Ua(r),i=t.visualViewport,o=n.clientWidth,u=n.clientHeight,s=0,d=0;if(i){o=i.width,u=i.height;var p=Fw();(p||!p&&e==="fixed")&&(s=i.offsetLeft,d=i.offsetTop)}return{width:o,height:u,x:s+Xg(r),y:d}}function t4(r){var e,t=Ua(r),n=Zg(r),i=(e=r.ownerDocument)==null?void 0:e.body,o=Ll(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=Ll(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-n.scrollLeft+Xg(r),d=-n.scrollTop;return aa(i||t).direction==="rtl"&&(s+=Ll(t.clientWidth,i?i.clientWidth:0)-o),{width:o,height:u,x:s,y:d}}function Kg(r){var e=aa(r),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function Uw(r){return["html","body","#document"].indexOf(Fs(r))>=0?r.ownerDocument.body:ns(r)&&Kg(r)?r:Uw(cp(r))}function zf(r,e){var t;e===void 0&&(e=[]);var n=Uw(r),i=n===((t=r.ownerDocument)==null?void 0:t.body),o=No(n),u=i?[o].concat(o.visualViewport||[],Kg(n)?n:[]):n,s=e.concat(u);return i?s:s.concat(zf(cp(u)))}function Km(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function n4(r,e){var t=nc(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function fy(r,e,t){return e===Dw?Km(e4(r,t)):zl(e)?n4(e,t):Km(t4(Ua(r)))}function r4(r){var e=zf(cp(r)),t=["absolute","fixed"].indexOf(aa(r).position)>=0,n=t&&ns(r)?nh(r):r;return zl(n)?e.filter(function(i){return zl(i)&&Ow(i,n)&&Fs(i)!=="body"}):[]}function i4(r,e,t,n){var i=e==="clippingParents"?r4(r):[].concat(e),o=[].concat(i,[t]),u=o[0],s=o.reduce(function(d,p){var g=fy(r,p,n);return d.top=Ll(g.top,d.top),d.right=Xd(g.right,d.right),d.bottom=Xd(g.bottom,d.bottom),d.left=Ll(g.left,d.left),d},fy(r,u,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Vw(r){var e=r.reference,t=r.element,n=r.placement,i=n?Bs(n):null,o=n?rc(n):null,u=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,d;switch(i){case bo:d={x:u,y:e.y-t.height};break;case os:d={x:u,y:e.y+e.height};break;case ss:d={x:e.x+e.width,y:s};break;case wo:d={x:e.x-t.width,y:s};break;default:d={x:e.x,y:e.y}}var p=i?Wg(i):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case ec:d[p]=d[p]-(e[g]/2-t[g]/2);break;case Vf:d[p]=d[p]+(e[g]/2-t[g]/2);break}}return d}function qf(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?r.placement:n,o=t.strategy,u=o===void 0?r.strategy:o,s=t.boundary,d=s===void 0?S3:s,p=t.rootBoundary,g=p===void 0?Dw:p,y=t.elementContext,x=y===void 0?pf:y,C=t.altBoundary,T=C===void 0?!1:C,E=t.padding,z=E===void 0?0:E,I=Nw(typeof z!="number"?z:jw(z,th)),L=x===pf?C3:pf,B=r.rects.popper,O=r.elements[T?L:x],Y=i4(zl(O)?O:O.contextElement||Ua(r.elements.popper),d,g,u),q=nc(r.elements.reference),H=Vw({reference:q,element:B,strategy:"absolute",placement:i}),Z=Km(Object.assign({},B,H)),_e=x===pf?Z:q,Ie={top:Y.top-_e.top+I.top,bottom:_e.bottom-Y.bottom+I.bottom,left:Y.left-_e.left+I.left,right:_e.right-Y.right+I.right},J=r.modifiersData.offset;if(x===pf&&J){var fe=J[i];Object.keys(Ie).forEach(function(Ee){var ye=[ss,os].indexOf(Ee)>=0?1:-1,Oe=[bo,os].indexOf(Ee)>=0?"y":"x";Ie[Ee]+=fe[Oe]*ye})}return Ie}function o4(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=t.boundary,o=t.rootBoundary,u=t.padding,s=t.flipVariations,d=t.allowedAutoPlacements,p=d===void 0?Rw:d,g=rc(n),y=g?s?ay:ay.filter(function(T){return rc(T)===g}):th,x=y.filter(function(T){return p.indexOf(T)>=0});x.length===0&&(x=y);var C=x.reduce(function(T,E){return T[E]=qf(r,{placement:E,boundary:i,rootBoundary:o,padding:u})[Bs(E)],T},{});return Object.keys(C).sort(function(T,E){return C[T]-C[E]})}function s4(r){if(Bs(r)===qg)return[];var e=Rd(r);return[cy(r),e,cy(e)]}function a4(r){var e=r.state,t=r.options,n=r.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!0:u,d=t.fallbackPlacements,p=t.padding,g=t.boundary,y=t.rootBoundary,x=t.altBoundary,C=t.flipVariations,T=C===void 0?!0:C,E=t.allowedAutoPlacements,z=e.options.placement,I=Bs(z),L=I===z,B=d||(L||!T?[Rd(z)]:s4(z)),O=[z].concat(B).reduce(function(Je,yt){return Je.concat(Bs(yt)===qg?o4(e,{placement:yt,boundary:g,rootBoundary:y,padding:p,flipVariations:T,allowedAutoPlacements:E}):yt)},[]),Y=e.rects.reference,q=e.rects.popper,H=new Map,Z=!0,_e=O[0],Ie=0;Ie<O.length;Ie++){var J=O[Ie],fe=Bs(J),Ee=rc(J)===ec,ye=[bo,os].indexOf(fe)>=0,Oe=ye?"width":"height",Ue=qf(e,{placement:J,boundary:g,rootBoundary:y,altBoundary:x,padding:p}),De=ye?Ee?ss:wo:Ee?os:bo;Y[Oe]>q[Oe]&&(De=Rd(De));var xe=Rd(De),et=[];if(o&&et.push(Ue[fe]<=0),s&&et.push(Ue[De]<=0,Ue[xe]<=0),et.every(function(Je){return Je})){_e=J,Z=!1;break}H.set(J,et)}if(Z)for(var Ze=T?3:1,Qe=function(yt){var Et=O.find(function(Ot){var Yt=H.get(Ot);if(Yt)return Yt.slice(0,yt).every(function(tn){return tn})});if(Et)return _e=Et,"break"},ct=Ze;ct>0;ct--){var dt=Qe(ct);if(dt==="break")break}e.placement!==_e&&(e.modifiersData[n]._skip=!0,e.placement=_e,e.reset=!0)}}const l4={name:"flip",enabled:!0,phase:"main",fn:a4,requiresIfExists:["offset"],data:{_skip:!1}};function hy(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function dy(r){return[bo,ss,os,wo].some(function(e){return r[e]>=0})}function u4(r){var e=r.state,t=r.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,u=qf(e,{elementContext:"reference"}),s=qf(e,{altBoundary:!0}),d=hy(u,n),p=hy(s,i,o),g=dy(d),y=dy(p);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":y})}const c4={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:u4};function f4(r,e,t){var n=Bs(r),i=[wo,bo].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,u=o[0],s=o[1];return u=u||0,s=(s||0)*i,[wo,ss].indexOf(n)>=0?{x:s,y:u}:{x:u,y:s}}function h4(r){var e=r.state,t=r.options,n=r.name,i=t.offset,o=i===void 0?[0,0]:i,u=Rw.reduce(function(g,y){return g[y]=f4(y,e.rects,o),g},{}),s=u[e.placement],d=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=p),e.modifiersData[n]=u}const d4={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:h4};function p4(r){var e=r.state,t=r.name;e.modifiersData[t]=Vw({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const m4={name:"popperOffsets",enabled:!0,phase:"read",fn:p4,data:{}};function g4(r){return r==="x"?"y":"x"}function _4(r){var e=r.state,t=r.options,n=r.name,i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!1:u,d=t.boundary,p=t.rootBoundary,g=t.altBoundary,y=t.padding,x=t.tether,C=x===void 0?!0:x,T=t.tetherOffset,E=T===void 0?0:T,z=qf(e,{boundary:d,rootBoundary:p,padding:y,altBoundary:g}),I=Bs(e.placement),L=rc(e.placement),B=!L,O=Wg(I),Y=g4(O),q=e.modifiersData.popperOffsets,H=e.rects.reference,Z=e.rects.popper,_e=typeof E=="function"?E(Object.assign({},e.rects,{placement:e.placement})):E,Ie=typeof _e=="number"?{mainAxis:_e,altAxis:_e}:Object.assign({mainAxis:0,altAxis:0},_e),J=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,fe={x:0,y:0};if(q){if(o){var Ee,ye=O==="y"?bo:wo,Oe=O==="y"?os:ss,Ue=O==="y"?"height":"width",De=q[O],xe=De+z[ye],et=De-z[Oe],Ze=C?-Z[Ue]/2:0,Qe=L===ec?H[Ue]:Z[Ue],ct=L===ec?-Z[Ue]:-H[Ue],dt=e.elements.arrow,Je=C&&dt?Gg(dt):{width:0,height:0},yt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:$w(),Et=yt[ye],Ot=yt[Oe],Yt=Pf(0,H[Ue],Je[Ue]),tn=B?H[Ue]/2-Ze-Yt-Et-Ie.mainAxis:Qe-Yt-Et-Ie.mainAxis,Qt=B?-H[Ue]/2+Ze+Yt+Ot+Ie.mainAxis:ct+Yt+Ot+Ie.mainAxis,fn=e.elements.arrow&&nh(e.elements.arrow),pn=fn?O==="y"?fn.clientTop||0:fn.clientLeft||0:0,He=(Ee=J==null?void 0:J[O])!=null?Ee:0,We=De+tn-He-pn,mt=De+Qt-He,Pt=Pf(C?Xd(xe,We):xe,De,C?Ll(et,mt):et);q[O]=Pt,fe[O]=Pt-De}if(s){var he,nn=O==="x"?bo:wo,Pe=O==="x"?os:ss,tt=q[Y],jt=Y==="y"?"height":"width",Gn=tt+z[nn],Un=tt-z[Pe],jn=[bo,wo].indexOf(I)!==-1,Wt=(he=J==null?void 0:J[Y])!=null?he:0,An=jn?Gn:tt-H[jt]-Z[jt]-Wt+Ie.altAxis,ti=jn?tt+H[jt]+Z[jt]-Wt-Ie.altAxis:Un,Bn=C&&jn?j3(An,tt,ti):Pf(C?An:Gn,tt,C?ti:Un);q[Y]=Bn,fe[Y]=Bn-tt}e.modifiersData[n]=fe}}const y4={name:"preventOverflow",enabled:!0,phase:"main",fn:_4,requiresIfExists:["offset"]};function v4(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function b4(r){return r===No(r)||!ns(r)?Zg(r):v4(r)}function w4(r){var e=r.getBoundingClientRect(),t=tc(e.width)/r.offsetWidth||1,n=tc(e.height)/r.offsetHeight||1;return t!==1||n!==1}function x4(r,e,t){t===void 0&&(t=!1);var n=ns(e),i=ns(e)&&w4(e),o=Ua(e),u=nc(r,i,t),s={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(n||!n&&!t)&&((Fs(e)!=="body"||Kg(o))&&(s=b4(e)),ns(e)?(d=nc(e,!0),d.x+=e.clientLeft,d.y+=e.clientTop):o&&(d.x=Xg(o))),{x:u.left+s.scrollLeft-d.x,y:u.top+s.scrollTop-d.y,width:u.width,height:u.height}}function A4(r){var e=new Map,t=new Set,n=[];r.forEach(function(o){e.set(o.name,o)});function i(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(s){if(!t.has(s)){var d=e.get(s);d&&i(d)}}),n.push(o)}return r.forEach(function(o){t.has(o.name)||i(o)}),n}function k4(r){var e=A4(r);return B3.reduce(function(t,n){return t.concat(e.filter(function(i){return i.phase===n}))},[])}function S4(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function C4(r){var e=r.reduce(function(t,n){var i=t[n.name];return t[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var py={placement:"bottom",modifiers:[],strategy:"absolute"};function my(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function T4(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?py:i;return function(s,d,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},py,o),modifiersData:{},elements:{reference:s,popper:d},attributes:{},styles:{}},y=[],x=!1,C={state:g,setOptions:function(I){var L=typeof I=="function"?I(g.options):I;E(),g.options=Object.assign({},o,g.options,L),g.scrollParents={reference:zl(s)?zf(s):s.contextElement?zf(s.contextElement):[],popper:zf(d)};var B=k4(C4([].concat(n,g.options.modifiers)));return g.orderedModifiers=B.filter(function(O){return O.enabled}),T(),C.update()},forceUpdate:function(){if(!x){var I=g.elements,L=I.reference,B=I.popper;if(my(L,B)){g.rects={reference:x4(L,nh(B),g.options.strategy==="fixed"),popper:Gg(B)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(Ie){return g.modifiersData[Ie.name]=Object.assign({},Ie.data)});for(var O=0;O<g.orderedModifiers.length;O++){if(g.reset===!0){g.reset=!1,O=-1;continue}var Y=g.orderedModifiers[O],q=Y.fn,H=Y.options,Z=H===void 0?{}:H,_e=Y.name;typeof q=="function"&&(g=q({state:g,options:Z,name:_e,instance:C})||g)}}}},update:S4(function(){return new Promise(function(z){C.forceUpdate(),z(g)})}),destroy:function(){E(),x=!0}};if(!my(s,d))return C;C.setOptions(p).then(function(z){!x&&p.onFirstUpdate&&p.onFirstUpdate(z)});function T(){g.orderedModifiers.forEach(function(z){var I=z.name,L=z.options,B=L===void 0?{}:L,O=z.effect;if(typeof O=="function"){var Y=O({state:g,name:I,instance:C,options:B}),q=function(){};y.push(Y||q)}})}function E(){y.forEach(function(z){return z()}),y=[]}return C}}var M4=[J3,m4,X3,Bw,d4,l4,y4,H3,c4],E4=T4({defaultModifiers:M4}),L4="tippy-box",qw="tippy-content",I4="tippy-backdrop",Hw="tippy-arrow",Gw="tippy-svg-arrow",kl={passive:!0,capture:!0},Ww=function(){return document.body};function Em(r,e,t){if(Array.isArray(r)){var n=r[e];return n??(Array.isArray(t)?t[e]:t)}return r}function Jg(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Zw(r,e){return typeof r=="function"?r.apply(void 0,e):r}function gy(r,e){if(e===0)return r;var t;return function(n){clearTimeout(t),t=setTimeout(function(){r(n)},e)}}function P4(r){return r.split(/\s+/).filter(Boolean)}function qu(r){return[].concat(r)}function _y(r,e){r.indexOf(e)===-1&&r.push(e)}function z4(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function D4(r){return r.split("-")[0]}function Kd(r){return[].slice.call(r)}function yy(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function Df(){return document.createElement("div")}function fp(r){return["Element","Fragment"].some(function(e){return Jg(r,e)})}function R4(r){return Jg(r,"NodeList")}function B4(r){return Jg(r,"MouseEvent")}function F4(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function O4(r){return fp(r)?[r]:R4(r)?Kd(r):Array.isArray(r)?r:Kd(document.querySelectorAll(r))}function Lm(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function vy(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function $4(r){var e,t=qu(r),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function N4(r,e){var t=e.clientX,n=e.clientY;return r.every(function(i){var o=i.popperRect,u=i.popperState,s=i.props,d=s.interactiveBorder,p=D4(u.placement),g=u.modifiersData.offset;if(!g)return!0;var y=p==="bottom"?g.top.y:0,x=p==="top"?g.bottom.y:0,C=p==="right"?g.left.x:0,T=p==="left"?g.right.x:0,E=o.top-n+y>d,z=n-o.bottom-x>d,I=o.left-t+C>d,L=t-o.right-T>d;return E||z||I||L})}function Im(r,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){r[n](i,t)})}function by(r,e){for(var t=e;t;){var n;if(r.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Rs={isTouch:!1},wy=0;function j4(){Rs.isTouch||(Rs.isTouch=!0,window.performance&&document.addEventListener("mousemove",Xw))}function Xw(){var r=performance.now();r-wy<20&&(Rs.isTouch=!1,document.removeEventListener("mousemove",Xw)),wy=r}function U4(){var r=document.activeElement;if(F4(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function V4(){document.addEventListener("touchstart",j4,kl),window.addEventListener("blur",U4)}var q4=typeof window<"u"&&typeof document<"u",H4=q4?!!window.msCrypto:!1,G4={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},W4={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},_s=Object.assign({appendTo:Ww,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},G4,W4),Z4=Object.keys(_s),X4=function(e){var t=Object.keys(e);t.forEach(function(n){_s[n]=e[n]})};function Kw(r){var e=r.plugins||[],t=e.reduce(function(n,i){var o=i.name,u=i.defaultValue;if(o){var s;n[o]=r[o]!==void 0?r[o]:(s=_s[o])!=null?s:u}return n},{});return Object.assign({},r,t)}function K4(r,e){var t=e?Object.keys(Kw(Object.assign({},_s,{plugins:e}))):Z4,n=t.reduce(function(i,o){var u=(r.getAttribute("data-tippy-"+o)||"").trim();if(!u)return i;if(o==="content")i[o]=u;else try{i[o]=JSON.parse(u)}catch{i[o]=u}return i},{});return n}function xy(r,e){var t=Object.assign({},e,{content:Zw(e.content,[r])},e.ignoreAttributes?{}:K4(r,e.plugins));return t.aria=Object.assign({},_s.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var J4=function(){return"innerHTML"};function Jm(r,e){r[J4()]=e}function Ay(r){var e=Df();return r===!0?e.className=Hw:(e.className=Gw,fp(r)?e.appendChild(r):Jm(e,r)),e}function ky(r,e){fp(e.content)?(Jm(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Jm(r,e.content):r.textContent=e.content)}function Ym(r){var e=r.firstElementChild,t=Kd(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(qw)}),arrow:t.find(function(n){return n.classList.contains(Hw)||n.classList.contains(Gw)}),backdrop:t.find(function(n){return n.classList.contains(I4)})}}function Jw(r){var e=Df(),t=Df();t.className=L4,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Df();n.className=qw,n.setAttribute("data-state","hidden"),ky(n,r.props),e.appendChild(t),t.appendChild(n),i(r.props,r.props);function i(o,u){var s=Ym(e),d=s.box,p=s.content,g=s.arrow;u.theme?d.setAttribute("data-theme",u.theme):d.removeAttribute("data-theme"),typeof u.animation=="string"?d.setAttribute("data-animation",u.animation):d.removeAttribute("data-animation"),u.inertia?d.setAttribute("data-inertia",""):d.removeAttribute("data-inertia"),d.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?d.setAttribute("role",u.role):d.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&ky(p,r.props),u.arrow?g?o.arrow!==u.arrow&&(d.removeChild(g),d.appendChild(Ay(u.arrow))):d.appendChild(Ay(u.arrow)):g&&d.removeChild(g)}return{popper:e,onUpdate:i}}Jw.$$tippy=!0;var Y4=1,Ad=[],Pm=[];function Q4(r,e){var t=xy(r,Object.assign({},_s,Kw(yy(e)))),n,i,o,u=!1,s=!1,d=!1,p=!1,g,y,x,C=[],T=gy(We,t.interactiveDebounce),E,z=Y4++,I=null,L=z4(t.plugins),B={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},O={id:z,reference:r,popper:Df(),popperInstance:I,props:t,state:B,plugins:L,clearDelayTimeouts:An,setProps:ti,setContent:Bn,show:_t,hide:mr,hideWithInteractivity:ar,enable:jn,disable:Wt,unmount:gi,destroy:Vn};if(!t.render)return O;var Y=t.render(O),q=Y.popper,H=Y.onUpdate;q.setAttribute("data-tippy-root",""),q.id="tippy-"+O.id,O.popper=q,r._tippy=O,q._tippy=O;var Z=L.map(function($e){return $e.fn(O)}),_e=r.hasAttribute("aria-expanded");return fn(),Ze(),De(),xe("onCreate",[O]),t.showOnCreate&&Gn(),q.addEventListener("mouseenter",function(){O.props.interactive&&O.state.isVisible&&O.clearDelayTimeouts()}),q.addEventListener("mouseleave",function(){O.props.interactive&&O.props.trigger.indexOf("mouseenter")>=0&&ye().addEventListener("mousemove",T)}),O;function Ie(){var $e=O.props.touch;return Array.isArray($e)?$e:[$e,0]}function J(){return Ie()[0]==="hold"}function fe(){var $e;return!!(($e=O.props.render)!=null&&$e.$$tippy)}function Ee(){return E||r}function ye(){var $e=Ee().parentNode;return $e?$4($e):document}function Oe(){return Ym(q)}function Ue($e){return O.state.isMounted&&!O.state.isVisible||Rs.isTouch||g&&g.type==="focus"?0:Em(O.props.delay,$e?0:1,_s.delay)}function De($e){$e===void 0&&($e=!1),q.style.pointerEvents=O.props.interactive&&!$e?"":"none",q.style.zIndex=""+O.props.zIndex}function xe($e,pt,vt){if(vt===void 0&&(vt=!0),Z.forEach(function(rn){rn[$e]&&rn[$e].apply(rn,pt)}),vt){var Dt;(Dt=O.props)[$e].apply(Dt,pt)}}function et(){var $e=O.props.aria;if($e.content){var pt="aria-"+$e.content,vt=q.id,Dt=qu(O.props.triggerTarget||r);Dt.forEach(function(rn){var en=rn.getAttribute(pt);if(O.state.isVisible)rn.setAttribute(pt,en?en+" "+vt:vt);else{var br=en&&en.replace(vt,"").trim();br?rn.setAttribute(pt,br):rn.removeAttribute(pt)}})}}function Ze(){if(!(_e||!O.props.aria.expanded)){var $e=qu(O.props.triggerTarget||r);$e.forEach(function(pt){O.props.interactive?pt.setAttribute("aria-expanded",O.state.isVisible&&pt===Ee()?"true":"false"):pt.removeAttribute("aria-expanded")})}}function Qe(){ye().removeEventListener("mousemove",T),Ad=Ad.filter(function($e){return $e!==T})}function ct($e){if(!(Rs.isTouch&&(d||$e.type==="mousedown"))){var pt=$e.composedPath&&$e.composedPath()[0]||$e.target;if(!(O.props.interactive&&by(q,pt))){if(qu(O.props.triggerTarget||r).some(function(vt){return by(vt,pt)})){if(Rs.isTouch||O.state.isVisible&&O.props.trigger.indexOf("click")>=0)return}else xe("onClickOutside",[O,$e]);O.props.hideOnClick===!0&&(O.clearDelayTimeouts(),O.hide(),s=!0,setTimeout(function(){s=!1}),O.state.isMounted||Et())}}}function dt(){d=!0}function Je(){d=!1}function yt(){var $e=ye();$e.addEventListener("mousedown",ct,!0),$e.addEventListener("touchend",ct,kl),$e.addEventListener("touchstart",Je,kl),$e.addEventListener("touchmove",dt,kl)}function Et(){var $e=ye();$e.removeEventListener("mousedown",ct,!0),$e.removeEventListener("touchend",ct,kl),$e.removeEventListener("touchstart",Je,kl),$e.removeEventListener("touchmove",dt,kl)}function Ot($e,pt){tn($e,function(){!O.state.isVisible&&q.parentNode&&q.parentNode.contains(q)&&pt()})}function Yt($e,pt){tn($e,pt)}function tn($e,pt){var vt=Oe().box;function Dt(rn){rn.target===vt&&(Im(vt,"remove",Dt),pt())}if($e===0)return pt();Im(vt,"remove",y),Im(vt,"add",Dt),y=Dt}function Qt($e,pt,vt){vt===void 0&&(vt=!1);var Dt=qu(O.props.triggerTarget||r);Dt.forEach(function(rn){rn.addEventListener($e,pt,vt),C.push({node:rn,eventType:$e,handler:pt,options:vt})})}function fn(){J()&&(Qt("touchstart",He,{passive:!0}),Qt("touchend",mt,{passive:!0})),P4(O.props.trigger).forEach(function($e){if($e!=="manual")switch(Qt($e,He),$e){case"mouseenter":Qt("mouseleave",mt);break;case"focus":Qt(H4?"focusout":"blur",Pt);break;case"focusin":Qt("focusout",Pt);break}})}function pn(){C.forEach(function($e){var pt=$e.node,vt=$e.eventType,Dt=$e.handler,rn=$e.options;pt.removeEventListener(vt,Dt,rn)}),C=[]}function He($e){var pt,vt=!1;if(!(!O.state.isEnabled||he($e)||s)){var Dt=((pt=g)==null?void 0:pt.type)==="focus";g=$e,E=$e.currentTarget,Ze(),!O.state.isVisible&&B4($e)&&Ad.forEach(function(rn){return rn($e)}),$e.type==="click"&&(O.props.trigger.indexOf("mouseenter")<0||u)&&O.props.hideOnClick!==!1&&O.state.isVisible?vt=!0:Gn($e),$e.type==="click"&&(u=!vt),vt&&!Dt&&Un($e)}}function We($e){var pt=$e.target,vt=Ee().contains(pt)||q.contains(pt);if(!($e.type==="mousemove"&&vt)){var Dt=jt().concat(q).map(function(rn){var en,br=rn._tippy,lr=(en=br.popperInstance)==null?void 0:en.state;return lr?{popperRect:rn.getBoundingClientRect(),popperState:lr,props:t}:null}).filter(Boolean);N4(Dt,$e)&&(Qe(),Un($e))}}function mt($e){var pt=he($e)||O.props.trigger.indexOf("click")>=0&&u;if(!pt){if(O.props.interactive){O.hideWithInteractivity($e);return}Un($e)}}function Pt($e){O.props.trigger.indexOf("focusin")<0&&$e.target!==Ee()||O.props.interactive&&$e.relatedTarget&&q.contains($e.relatedTarget)||Un($e)}function he($e){return Rs.isTouch?J()!==$e.type.indexOf("touch")>=0:!1}function nn(){Pe();var $e=O.props,pt=$e.popperOptions,vt=$e.placement,Dt=$e.offset,rn=$e.getReferenceClientRect,en=$e.moveTransition,br=fe()?Ym(q).arrow:null,lr=rn?{getBoundingClientRect:rn,contextElement:rn.contextElement||Ee()}:r,Se={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(me){var we=me.state;if(fe()){var Ne=Oe(),je=Ne.box;["placement","reference-hidden","escaped"].forEach(function(qe){qe==="placement"?je.setAttribute("data-placement",we.placement):we.attributes.popper["data-popper-"+qe]?je.setAttribute("data-"+qe,""):je.removeAttribute("data-"+qe)}),we.attributes.popper={}}}},re=[{name:"offset",options:{offset:Dt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!en}},Se];fe()&&br&&re.push({name:"arrow",options:{element:br,padding:3}}),re.push.apply(re,(pt==null?void 0:pt.modifiers)||[]),O.popperInstance=E4(lr,q,Object.assign({},pt,{placement:vt,onFirstUpdate:x,modifiers:re}))}function Pe(){O.popperInstance&&(O.popperInstance.destroy(),O.popperInstance=null)}function tt(){var $e=O.props.appendTo,pt,vt=Ee();O.props.interactive&&$e===Ww||$e==="parent"?pt=vt.parentNode:pt=Zw($e,[vt]),pt.contains(q)||pt.appendChild(q),O.state.isMounted=!0,nn()}function jt(){return Kd(q.querySelectorAll("[data-tippy-root]"))}function Gn($e){O.clearDelayTimeouts(),$e&&xe("onTrigger",[O,$e]),yt();var pt=Ue(!0),vt=Ie(),Dt=vt[0],rn=vt[1];Rs.isTouch&&Dt==="hold"&&rn&&(pt=rn),pt?n=setTimeout(function(){O.show()},pt):O.show()}function Un($e){if(O.clearDelayTimeouts(),xe("onUntrigger",[O,$e]),!O.state.isVisible){Et();return}if(!(O.props.trigger.indexOf("mouseenter")>=0&&O.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf($e.type)>=0&&u)){var pt=Ue(!1);pt?i=setTimeout(function(){O.state.isVisible&&O.hide()},pt):o=requestAnimationFrame(function(){O.hide()})}}function jn(){O.state.isEnabled=!0}function Wt(){O.hide(),O.state.isEnabled=!1}function An(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function ti($e){if(!O.state.isDestroyed){xe("onBeforeUpdate",[O,$e]),pn();var pt=O.props,vt=xy(r,Object.assign({},pt,yy($e),{ignoreAttributes:!0}));O.props=vt,fn(),pt.interactiveDebounce!==vt.interactiveDebounce&&(Qe(),T=gy(We,vt.interactiveDebounce)),pt.triggerTarget&&!vt.triggerTarget?qu(pt.triggerTarget).forEach(function(Dt){Dt.removeAttribute("aria-expanded")}):vt.triggerTarget&&r.removeAttribute("aria-expanded"),Ze(),De(),H&&H(pt,vt),O.popperInstance&&(nn(),jt().forEach(function(Dt){requestAnimationFrame(Dt._tippy.popperInstance.forceUpdate)})),xe("onAfterUpdate",[O,$e])}}function Bn($e){O.setProps({content:$e})}function _t(){var $e=O.state.isVisible,pt=O.state.isDestroyed,vt=!O.state.isEnabled,Dt=Rs.isTouch&&!O.props.touch,rn=Em(O.props.duration,0,_s.duration);if(!($e||pt||vt||Dt)&&!Ee().hasAttribute("disabled")&&(xe("onShow",[O],!1),O.props.onShow(O)!==!1)){if(O.state.isVisible=!0,fe()&&(q.style.visibility="visible"),De(),yt(),O.state.isMounted||(q.style.transition="none"),fe()){var en=Oe(),br=en.box,lr=en.content;Lm([br,lr],0)}x=function(){var re;if(!(!O.state.isVisible||p)){if(p=!0,q.offsetHeight,q.style.transition=O.props.moveTransition,fe()&&O.props.animation){var ce=Oe(),me=ce.box,we=ce.content;Lm([me,we],rn),vy([me,we],"visible")}et(),Ze(),_y(Pm,O),(re=O.popperInstance)==null||re.forceUpdate(),xe("onMount",[O]),O.props.animation&&fe()&&Yt(rn,function(){O.state.isShown=!0,xe("onShown",[O])})}},tt()}}function mr(){var $e=!O.state.isVisible,pt=O.state.isDestroyed,vt=!O.state.isEnabled,Dt=Em(O.props.duration,1,_s.duration);if(!($e||pt||vt)&&(xe("onHide",[O],!1),O.props.onHide(O)!==!1)){if(O.state.isVisible=!1,O.state.isShown=!1,p=!1,u=!1,fe()&&(q.style.visibility="hidden"),Qe(),Et(),De(!0),fe()){var rn=Oe(),en=rn.box,br=rn.content;O.props.animation&&(Lm([en,br],Dt),vy([en,br],"hidden"))}et(),Ze(),O.props.animation?fe()&&Ot(Dt,O.unmount):O.unmount()}}function ar($e){ye().addEventListener("mousemove",T),_y(Ad,T),T($e)}function gi(){O.state.isVisible&&O.hide(),O.state.isMounted&&(Pe(),jt().forEach(function($e){$e._tippy.unmount()}),q.parentNode&&q.parentNode.removeChild(q),Pm=Pm.filter(function($e){return $e!==O}),O.state.isMounted=!1,xe("onHidden",[O]))}function Vn(){O.state.isDestroyed||(O.clearDelayTimeouts(),O.unmount(),pn(),delete r._tippy,O.state.isDestroyed=!0,xe("onDestroy",[O]))}}function rh(r,e){e===void 0&&(e={});var t=_s.plugins.concat(e.plugins||[]);V4();var n=Object.assign({},e,{plugins:t}),i=O4(r),o=i.reduce(function(u,s){var d=s&&Q4(s,n);return d&&u.push(d),u},[]);return fp(r)?o[0]:o}rh.defaultProps=_s;rh.setDefaultProps=X4;rh.currentInput=Rs;Object.assign({},Bw,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});rh.setDefaultProps({render:Jw});class eS{constructor(){tr(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty — nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new zm(n,1,Bd);for(const[o,u]of tS(n))for(const{projectKey:s,projectName:d}of u){let p=window.localStorage.getItem(s);if(!p){console.warn(`Project features not found for ${s}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=d,console.log(`migrating project ${s}`);let y=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${s} -> ${i.projectKey(y)}`),window.localStorage.removeItem(s)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new zm(n,2,Bd);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new zm(e,this.storedSchemaVersion,Bd)}}const Bd=Symbol("internal_method_token");class zm{constructor(e,t,n){tr(this,"appFocus");tr(this,"dbSchemaVersion");if(n!==Bd)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t="My neighbourhood",i=this.project(e).features.filter(s=>{var d;return((d=s.properties)==null?void 0:d.kind)=="boundary"}),o=t,u=1;for(;i.some(s=>{var d;return((d=s.properties)==null?void 0:d.name)==o});)u++,o=`${t} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.allProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}allProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function tS(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,s,d]=o.split("/");e.has(s)||e.set(s,[]),e.get(s).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),s=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:s})):t.push({projectKey:o,projectName:s})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const nS=r=>({}),Sy=r=>({}),rS=r=>({}),Cy=r=>({});function Ty(r){let e,t,n;return t=new Bl({props:{$$slots:{default:[iS]},$$scope:{ctx:r}}}),{c(){e=j("span"),ae(t.$$.fragment),Xe(e,"margin-left","auto")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o&128&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function iS(r){let e,t;const n=r[4].help,i=vn(n,r,r[7],Cy);return{c(){e=j("div"),i&&i.c(),ue(e,"class","context-layer-help-content")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&wn(i,n,o,o[7],t?bn(n,o[7],u,rS):xn(o[7]),Cy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function My(r){let e,t;const n=r[4].legend,i=vn(n,r,r[7],Sy);return{c(){e=j("div"),i&&i.c(),ue(e,"class","legend svelte-14vnnlu")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&wn(i,n,o,o[7],t?bn(n,o[7],u,nS):xn(o[7]),Sy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function oS(r){let e,t,n,i,o,u,s,d,p,g,y=r[3].help&&Ty(r),x=r[0]&&r[3].legend&&My(r);return{c(){e=j("button"),t=j("input"),n=ne(),i=Te(r[1]),o=ne(),y&&y.c(),u=ne(),x&&x.c(),s=rr(),Xe(t,"aspect-ratio","1.0"),ue(t,"type","checkbox"),ue(e,"class","context-control svelte-14vnnlu")},m(C,T){W(C,e,T),D(e,t),t.checked=r[0],D(e,n),D(e,i),D(e,o),y&&y.m(e,null),W(C,u,T),x&&x.m(C,T),W(C,s,T),d=!0,p||(g=[St(t,"change",r[5]),St(t,"change",function(){ca(r[2])&&r[2].apply(this,arguments)}),St(e,"click",r[6])],p=!0)},p(C,[T]){r=C,T&1&&(t.checked=r[0]),(!d||T&2)&&xt(i,r[1]),r[3].help?y?(y.p(r,T),T&8&&N(y,1)):(y=Ty(r),y.c(),N(y,1),y.m(e,null)):y&&(Xt(),V(y,1,1,()=>{y=null}),Kt()),r[0]&&r[3].legend?x?(x.p(r,T),T&9&&N(x,1)):(x=My(r),x.c(),N(x,1),x.m(s.parentNode,s)):x&&(Xt(),V(x,1,1,()=>{x=null}),Kt())},i(C){d||(N(y),N(x),d=!0)},o(C){V(y),V(x),d=!1},d(C){C&&(G(e),G(u),G(s)),y&&y.d(),x&&x.d(C),p=!1,sr(g)}}}function sS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Ig(n);let{label:u}=e,{show:s=!1}=e,{onChange:d=()=>{}}=e;function p(){s=this.checked,t(0,s)}const g=()=>{t(0,s=!s),d()};return r.$$set=y=>{"label"in y&&t(1,u=y.label),"show"in y&&t(0,s=y.show),"onChange"in y&&t(2,d=y.onChange),"$$scope"in y&&t(7,i=y.$$scope)},[s,u,d,o,n,p,g,i]}class rs extends Tt{constructor(e){super(),Ct(this,e,sS,oS,wt,{label:1,show:0,onChange:2})}}let aS=Date.now();function Va(r){return`${r}-${aS++}`}const Yg=Symbol.for("svelte-maplibre");function qa(){return Yf(Yg)}function lS(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(s=>{var d;return(d=r.get(s.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function uS(){let r=new Map;return ap(Yg,{map:Cn(null),source:Dd(null),layer:Dd(null),popupTarget:Dd(null),cluster:Cn(),loadedImages:Cn(new Set),minzoom:Cn(0),maxzoom:Cn(24),layerEvent:Cn(null),layerInfo:r,eventTopMost:lS(r),markerClickManager:new hS})}function Ey(r){return{subscribe:r.subscribe}}function Qg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=qa(),o=Cn(null),u=Ey(o),s={...i,[r]:Ey(o)};if(e&&(s.popupTarget=u),n){let d=Cn(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=Cn()),ap(Yg,s),{...i,self:o}}function Yw(){return Qg({key:"source",setCluster:!0})}function Qw(r=!0){return Qg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function cS(){return Qg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function fS(r){return"layerType"in r&&r.layerType==="deckgl"}class hS{constructor(){tr(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Ly(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function dS(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function pS(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Kn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Ba=mS;function mS(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],s=r[u];s!=null&&(e[u]=s)}return e}}}function Iy(r){let e=r[0],t,n,i=Py(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&wt(e,e=o[0])?(Xt(),V(i,1,1,lt),Kt(),i=Py(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Py(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function gS(r){let e,t,n=r[0]&&Iy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Iy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function _S(r,e,t){let n,i,o,u,s,d,p,g,y,x,C,T,{$$slots:E={},$$scope:z}=e,{id:I=Va("layer")}=e,{source:L=void 0}=e,{sourceLayer:B=void 0}=e,{beforeId:O=void 0}=e,{beforeLayerType:Y=void 0}=e,{type:q}=e,{paint:H=void 0}=e,{layout:Z=void 0}=e,{filter:_e=void 0}=e,{applyToClusters:Ie=void 0}=e,{minzoom:J=void 0}=e,{maxzoom:fe=void 0}=e,{manageHoverState:Ee=!1}=e,{hovered:ye=null}=e,{interactive:Oe=!0}=e,{hoverCursor:Ue=void 0}=e,{eventsIfTopMost:De=!1}=e;const xe=$s(),{map:et,source:Ze,self:Qe,minzoom:ct,maxzoom:dt,eventTopMost:Je,layerInfo:yt}=Qw();st(r,et,He=>t(31,y=He)),st(r,Ze,He=>t(32,x=He)),st(r,Qe,He=>t(0,g=He)),st(r,ct,He=>t(34,T=He)),st(r,dt,He=>t(33,C=He)),ei(()=>{g&&y&&(yt.delete(g),y==null||y.removeLayer(g))});let Et;function Ot(He){var he,nn;if(!Oe||!g||!y||De&&Je(He)!==g)return;let We=He.features??[],mt=(nn=(he=We[0])==null?void 0:he.properties)==null?void 0:nn.cluster_id,Pt={event:He,map:y,clusterId:mt,layer:g,source:s,features:We};xe(He.type,Pt)}function Yt(He){var he,nn;if(!Oe||!g||!y||De&&Je(He)!==g)return;Ue&&(y.getCanvas().style.cursor=Ue);let We=He.features??[];t(6,ye=We[0]??null);let mt=(nn=(he=We[0])==null?void 0:he.properties)==null?void 0:nn.cluster_id;xe("mouseenter",{event:He,map:y,clusterId:mt,layer:g,source:s,features:We})}function tn(He){var he,nn,Pe;if(!Oe||!y)return;if(De&&Je(He)!==g){t(6,ye=null),Ee&&Et!==void 0&&(y==null||y.setFeatureState({source:s,sourceLayer:B,id:Et},{hover:!1}),Et=void 0);return}y.getCanvas().style.cursor=Ue;let We=He.features??[],mt=(nn=(he=We[0])==null?void 0:he.properties)==null?void 0:nn.cluster_id,Pt=(Pe=We[0])==null?void 0:Pe.id;Pt!==Et&&(Ee&&(Et!==void 0&&(y==null||y.setFeatureState({source:s,id:Et,sourceLayer:B},{hover:!1})),y==null||y.setFeatureState({source:s,id:Pt,sourceLayer:B},{hover:!0})),Et=Pt,t(6,ye=We[0]??null)),xe("mousemove",{event:He,map:y,clusterId:mt,layer:g,source:s,features:We})}function Qt(He){if(!(!Oe||!g||!y)){if(Ue&&(y.getCanvas().style.cursor=""),t(6,ye=null),Ee&&Et!==void 0){const We={source:s,id:Et,sourceLayer:B};y==null||y.setFeatureState(We,{hover:!1}),Et=void 0}xe("mouseleave",{map:y,layer:g,source:s})}}let fn=!0;function pn(He){y&&(y.off("click",He,Ot),y.off("dblclick",He,Ot),y.off("contextmenu",He,Ot),y.off("mouseenter",He,Yt),y.off("mousemove",He,tn),y.off("mouseleave",He,Qt))}return ei(()=>{y&&g&&pn(g)}),r.$$set=He=>{"id"in He&&t(7,I=He.id),"source"in He&&t(8,L=He.source),"sourceLayer"in He&&t(9,B=He.sourceLayer),"beforeId"in He&&t(10,O=He.beforeId),"beforeLayerType"in He&&t(11,Y=He.beforeLayerType),"type"in He&&t(12,q=He.type),"paint"in He&&t(13,H=He.paint),"layout"in He&&t(14,Z=He.layout),"filter"in He&&t(15,_e=He.filter),"applyToClusters"in He&&t(16,Ie=He.applyToClusters),"minzoom"in He&&t(17,J=He.minzoom),"maxzoom"in He&&t(18,fe=He.maxzoom),"manageHoverState"in He&&t(19,Ee=He.manageHoverState),"hovered"in He&&t(6,ye=He.hovered),"interactive"in He&&t(20,Oe=He.interactive),"hoverCursor"in He&&t(21,Ue=He.hoverCursor),"eventsIfTopMost"in He&&t(22,De=He.eventsIfTopMost),"$$scope"in He&&t(35,z=He.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=pS(Ie)),r.$$.dirty[0]&1073774592&&t(24,i=dS("all",n,_e)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=J??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=fe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=L||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&g!==I&&s){g&&(pn(g),yt.delete(g));let He=O;if(!O&&Y){let We=y.getStyle().layers,mt=typeof Y=="function"?Y:he=>he.type===Y,Pt=We==null?void 0:We.find(mt);Pt&&(He=Pt.id)}an(Qe,g=I,g),y.addLayer(Ba({id:g,type:q,source:s,"source-layer":B,filter:i,paint:H,layout:Z,minzoom:o,maxzoom:u}),He),t(23,fn=!0),y.on("click",g,Ot),y.on("dblclick",g,Ot),y.on("contextmenu",g,Ot),y.on("mouseenter",g,Yt),y.on("mousemove",g,tn),y.on("mouseleave",g,Qt)}r.$$.dirty[0]&1048577&&g&&yt.set(g,{interactive:Oe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Ly((He,We)=>{y!=null&&y.style._loaded?y.setPaintProperty(g,He,We):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(g,He,We))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Ly((He,We)=>{y!=null&&y.style._loaded?y.setLayoutProperty(g,He,We):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(g,He,We))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(H)),r.$$.dirty[0]&134234112&&(p==null||p(Z)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(y==null||y.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(fn?t(23,fn=!1):y==null||y.setFilter(g,i))},[g,et,Ze,Qe,ct,dt,ye,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,Oe,Ue,De,fn,i,u,o,p,d,s,n,y,x,C,T,z,E]}let ih=class extends Tt{constructor(e){super(),Ct(this,e,_S,gS,wt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function yS(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function vS(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[yS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ih({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function bS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Va("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:E=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:I=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:B=!1}=e,{interactive:O=!0}=e;function Y(fe){L=fe,t(0,L)}function q(fe){Sn.call(this,r,fe)}function H(fe){Sn.call(this,r,fe)}function Z(fe){Sn.call(this,r,fe)}function _e(fe){Sn.call(this,r,fe)}function Ie(fe){Sn.call(this,r,fe)}function J(fe){Sn.call(this,r,fe)}return r.$$set=fe=>{"id"in fe&&t(1,o=fe.id),"source"in fe&&t(2,u=fe.source),"sourceLayer"in fe&&t(3,s=fe.sourceLayer),"beforeId"in fe&&t(4,d=fe.beforeId),"beforeLayerType"in fe&&t(5,p=fe.beforeLayerType),"paint"in fe&&t(6,g=fe.paint),"layout"in fe&&t(7,y=fe.layout),"filter"in fe&&t(8,x=fe.filter),"applyToClusters"in fe&&t(9,C=fe.applyToClusters),"minzoom"in fe&&t(10,T=fe.minzoom),"maxzoom"in fe&&t(11,E=fe.maxzoom),"hoverCursor"in fe&&t(12,z=fe.hoverCursor),"manageHoverState"in fe&&t(13,I=fe.manageHoverState),"hovered"in fe&&t(0,L=fe.hovered),"eventsIfTopMost"in fe&&t(14,B=fe.eventsIfTopMost),"interactive"in fe&&t(15,O=fe.interactive),"$$scope"in fe&&t(24,i=fe.$$scope)},[L,o,u,s,d,p,g,y,x,C,T,E,z,I,B,O,n,Y,q,H,Z,_e,Ie,J,i]}let Rl=class extends Tt{constructor(e){super(),Ct(this,e,bS,vS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function wS(r){let e,t;const n=r[7].default,i=vn(n,r,r[6],null);return{c(){e=j("div"),i&&i.c(),ue(e,"class",r[1]),Gt(e,"maplibregl-ctrl",r[0])},m(o,u){W(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,null):xn(o[6]),null),(!t||u&2)&&ue(e,"class",o[1]),(!t||u&3)&&Gt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o),r[8](null)}}}function xS(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:s="top-right"}=e,{class:d=void 0}=e;const{map:p}=qa();st(r,p,C=>t(5,n=C));let g,y={onAdd(){return g},onRemove(){var C;(C=g==null?void 0:g.parentNode)==null||C.removeChild(g)}};ei(()=>{n==null||n.removeControl(y)});function x(C){_n[C?"unshift":"push"](()=>{g=C,t(2,g)})}return r.$$set=C=>{"defaultStyling"in C&&t(0,u=C.defaultStyling),"position"in C&&t(4,s=C.position),"class"in C&&t(1,d=C.class),"$$scope"in C&&t(6,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(y,s)},[u,d,g,p,s,n,o,i,x]}class Qm extends Tt{constructor(e){super(),Ct(this,e,xS,wS,wt,{defaultStyling:0,position:4,class:1})}}function AS(r){let e,t,n,i,o,u;const s=r[5].default,d=vn(s,r,r[4],null);return{c(){e=j("button"),t=j("div"),d&&d.c(),ue(t,"class",n=Yu(r[3])+" svelte-1s83zbq"),Gt(t,"maplibregl-ctrl-icon",r[0]),Gt(t,"ctrl-btn-center",r[1]),ue(e,"type","button"),ue(e,"title",r[2])},m(p,g){W(p,e,g),D(e,t),d&&d.m(t,null),i=!0,o||(u=St(e,"click",r[6]),o=!0)},p(p,[g]){d&&d.p&&(!i||g&16)&&wn(d,s,p,p[4],i?bn(s,p[4],g,null):xn(p[4]),null),(!i||g&8&&n!==(n=Yu(p[3])+" svelte-1s83zbq"))&&ue(t,"class",n),(!i||g&9)&&Gt(t,"maplibregl-ctrl-icon",p[0]),(!i||g&10)&&Gt(t,"ctrl-btn-center",p[1]),(!i||g&4)&&ue(e,"title",p[2])},i(p){i||(N(d,p),i=!0)},o(p){V(d,p),i=!1},d(p){p&&G(e),d&&d.d(p),o=!1,u()}}}function kS(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:s=void 0}=e,{class:d=void 0}=e;function p(g){Sn.call(this,r,g)}return r.$$set=g=>{"icon"in g&&t(0,o=g.icon),"center"in g&&t(1,u=g.center),"title"in g&&t(2,s=g.title),"class"in g&&t(3,d=g.class),"$$scope"in g&&t(4,i=g.$$scope)},[o,u,s,d,i,n,p]}class e2 extends Tt{constructor(e){super(),Ct(this,e,kS,AS,wt,{icon:0,center:1,title:2,class:3})}}function SS(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[1],null);return{c(){e=j("div"),o&&o.c(),ue(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,s){W(u,e,s),o&&o.m(e,null),n=!0},p(u,[s]){o&&o.p&&(!n||s&2)&&wn(o,i,u,u[1],n?bn(i,u[1],s,null):xn(u[1]),null),(!n||s&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&ue(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&G(e),o&&o.d(u)}}}function CS(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class t2 extends Tt{constructor(e){super(),Ct(this,e,CS,SS,wt,{class:0})}}function TS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function MS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[TS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ih({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function ES(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Va("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:E=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:B=!0}=e;function O(J){I=J,t(0,I)}function Y(J){Sn.call(this,r,J)}function q(J){Sn.call(this,r,J)}function H(J){Sn.call(this,r,J)}function Z(J){Sn.call(this,r,J)}function _e(J){Sn.call(this,r,J)}function Ie(J){Sn.call(this,r,J)}return r.$$set=J=>{"id"in J&&t(1,o=J.id),"source"in J&&t(2,u=J.source),"sourceLayer"in J&&t(3,s=J.sourceLayer),"beforeId"in J&&t(4,d=J.beforeId),"beforeLayerType"in J&&t(5,p=J.beforeLayerType),"paint"in J&&t(6,g=J.paint),"layout"in J&&t(7,y=J.layout),"filter"in J&&t(8,x=J.filter),"minzoom"in J&&t(9,C=J.minzoom),"maxzoom"in J&&t(10,T=J.maxzoom),"hoverCursor"in J&&t(11,E=J.hoverCursor),"manageHoverState"in J&&t(12,z=J.manageHoverState),"hovered"in J&&t(0,I=J.hovered),"eventsIfTopMost"in J&&t(13,L=J.eventsIfTopMost),"interactive"in J&&t(14,B=J.interactive),"$$scope"in J&&t(23,i=J.$$scope)},[I,o,u,s,d,p,g,y,x,C,T,E,z,L,B,n,O,Y,q,H,Z,_e,Ie,i]}let Ki=class extends Tt{constructor(e){super(),Ct(this,e,ES,MS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function LS(r,e,t){let n;const{map:i}=qa();st(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,s=null;return ei(()=>{n!=null&&n.loaded()&&s&&n.removeControl(s)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!s){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,s=new Qr.FullscreenControl({container:d})),n.addControl(s,o)}},[i,o,u,s,n]}class IS extends Tt{constructor(e){super(),Ct(this,e,LS,null,wt,{position:1,container:2})}}function n2(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function r2(r,e,t){aw().then(()=>{let n=hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function zy(r){let e=r[0],t,n,i=Dy(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&wt(e,e=o[0])?(Xt(),V(i,1,1,lt),Kt(),i=Dy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Dy(r){let e;const t=r[19].default,n=vn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&wn(n,t,i,i[18],e?bn(t,i[18],o,null):xn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function PS(r){let e,t,n=r[0]&&zy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=zy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function zS(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=Va("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:y=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e,{maxzoom:E=void 0}=e,{attribution:z=void 0}=e,{buffer:I=void 0}=e,{tolerance:L=void 0}=e;const{map:B,cluster:O,self:Y}=Yw();st(r,B,Z=>t(17,i=Z)),st(r,O,Z=>t(20,o=Z)),st(r,Y,Z=>t(0,n=Z));let q,H=!0;return ei(()=>{n&&q&&i&&(r2(B,n,q),an(Y,n=null,n),t(15,q=void 0))}),r.$$set=Z=>{"id"in Z&&t(4,d=Z.id),"data"in Z&&t(5,p=Z.data),"generateId"in Z&&t(6,g=Z.generateId),"promoteId"in Z&&t(7,y=Z.promoteId),"filter"in Z&&t(8,x=Z.filter),"lineMetrics"in Z&&t(9,C=Z.lineMetrics),"cluster"in Z&&t(10,T=Z.cluster),"maxzoom"in Z&&t(11,E=Z.maxzoom),"attribution"in Z&&t(12,z=Z.attribution),"buffer"in Z&&t(13,I=Z.buffer),"tolerance"in Z&&t(14,L=Z.tolerance),"$$scope"in Z&&t(18,s=Z.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&an(O,o=T,o),r.$$.dirty&196593&&i&&n!==d&&(an(Y,n=d,n),n2(i,n,Ba({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:y,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties,maxzoom:E,attribution:z,buffer:I,tolerance:L}),Z=>i&&Z===n,()=>{n&&(t(15,q=i==null?void 0:i.getSource(n)),t(16,H=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,q=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&q&&(H?t(16,H=!1):q.setData(p)),r.$$.dirty&33792&&(q==null||q.setClusterOptions(Ba({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,B,O,Y,d,p,g,y,x,C,T,E,z,I,L,q,H,i,s,u]}let yr=class extends Tt{constructor(e){super(),Ct(this,e,zS,PS,wt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function DS(r,e,t){let n;const{map:i}=qa();st(r,i,x=>t(8,n=x));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:s=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:y=null}=e;return ei(()=>{n!=null&&n.loaded()&&y&&n.removeControl(y)}),r.$$set=x=>{"position"in x&&t(2,o=x.position),"positionOptions"in x&&t(3,u=x.positionOptions),"fitBoundsOptions"in x&&t(4,s=x.fitBoundsOptions),"trackUserLocation"in x&&t(5,d=x.trackUserLocation),"showAccuracyCircle"in x&&t(6,p=x.showAccuracyCircle),"showUserLocation"in x&&t(7,g=x.showUserLocation),"control"in x&&t(1,y=x.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!y&&(t(1,y=new Qr.GeolocateControl({positionOptions:u,fitBoundsOptions:s,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:g})),n.addControl(y,o))},[i,y,o,u,s,d,p,g,n]}class RS extends Tt{constructor(e){super(),Ct(this,e,DS,null,wt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function BS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function FS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"heatmap",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[BS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ih({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function OS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Va("heatmap")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:E=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:B=!0}=e;function O(J){I=J,t(0,I)}function Y(J){Sn.call(this,r,J)}function q(J){Sn.call(this,r,J)}function H(J){Sn.call(this,r,J)}function Z(J){Sn.call(this,r,J)}function _e(J){Sn.call(this,r,J)}function Ie(J){Sn.call(this,r,J)}return r.$$set=J=>{"id"in J&&t(1,o=J.id),"source"in J&&t(2,u=J.source),"sourceLayer"in J&&t(3,s=J.sourceLayer),"beforeId"in J&&t(4,d=J.beforeId),"beforeLayerType"in J&&t(5,p=J.beforeLayerType),"paint"in J&&t(6,g=J.paint),"layout"in J&&t(7,y=J.layout),"filter"in J&&t(8,x=J.filter),"minzoom"in J&&t(9,C=J.minzoom),"maxzoom"in J&&t(10,T=J.maxzoom),"hoverCursor"in J&&t(11,E=J.hoverCursor),"manageHoverState"in J&&t(12,z=J.manageHoverState),"hovered"in J&&t(0,I=J.hovered),"eventsIfTopMost"in J&&t(13,L=J.eventsIfTopMost),"interactive"in J&&t(14,B=J.interactive),"$$scope"in J&&t(23,i=J.$$scope)},[I,o,u,s,d,p,g,y,x,C,T,E,z,L,B,n,O,Y,q,H,Z,_e,Ie,i]}class $S extends Tt{constructor(e){super(),Ct(this,e,OS,FS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function NS(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:s=void 0}=e,d=new Set;const{map:p,source:g}=Qw();return st(r,p,y=>t(6,n=y)),st(r,g,y=>t(7,i=y)),r.$$set=y=>{"data"in y&&t(2,o=y.data),"idCol"in y&&t(3,u=y.idCol),"sourceLayer"in y&&t(4,s=y.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let y=new Set;for(const x of o){const C=x[u];if(!C)continue;d.delete(C),y.add(C);const T={id:C,source:i,sourceLayer:s},E=n.getFeatureState(T);let z=!1;for(const I of Object.keys(x))if(E[I]!==x[I]){z=!0;break}z&&n.setFeatureState(T,x)}for(const x of d){const C={id:x,source:i,sourceLayer:s},T=n.getFeatureState(C);for(const E of Object.keys(T))n.removeFeatureState(C,E)}t(5,d=y)}},[p,g,o,u,s,d,n,i]}class jS extends Tt{constructor(e){super(),Ct(this,e,NS,null,wt,{data:2,idCol:3,sourceLayer:4})}}function US(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function VS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[US]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ih({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function qS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Va("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:E=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:B=!0}=e;function O(J){I=J,t(0,I)}function Y(J){Sn.call(this,r,J)}function q(J){Sn.call(this,r,J)}function H(J){Sn.call(this,r,J)}function Z(J){Sn.call(this,r,J)}function _e(J){Sn.call(this,r,J)}function Ie(J){Sn.call(this,r,J)}return r.$$set=J=>{"id"in J&&t(1,o=J.id),"source"in J&&t(2,u=J.source),"sourceLayer"in J&&t(3,s=J.sourceLayer),"beforeId"in J&&t(4,d=J.beforeId),"beforeLayerType"in J&&t(5,p=J.beforeLayerType),"paint"in J&&t(6,g=J.paint),"layout"in J&&t(7,y=J.layout),"filter"in J&&t(8,x=J.filter),"minzoom"in J&&t(9,C=J.minzoom),"maxzoom"in J&&t(10,T=J.maxzoom),"hoverCursor"in J&&t(11,E=J.hoverCursor),"manageHoverState"in J&&t(12,z=J.manageHoverState),"hovered"in J&&t(0,I=J.hovered),"eventsIfTopMost"in J&&t(13,L=J.eventsIfTopMost),"interactive"in J&&t(14,B=J.interactive),"$$scope"in J&&t(23,i=J.$$scope)},[I,o,u,s,d,p,g,y,x,C,T,E,z,L,B,n,O,Y,q,H,Z,_e,Ie,i]}let hr=class extends Tt{constructor(e){super(),Ct(this,e,qS,VS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function HS(r,e,t){let n;const i=$s();let{layer:o=void 0}=e;const{map:u}=qa();st(r,u,g=>t(2,n=g));function s(g){i(g.type,{...g,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ei(()=>{if(n)if(o)for(const g of d)n.off(g,o,s);else for(const g of p)n.off(g,s)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of d)n.on(g,o,s);else for(const g of p)n.on(g,s)},[u,o,n]}class e_ extends Tt{constructor(e){super(),Ct(this,e,HS,null,wt,{layer:1})}}function GS(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,s=`${t}/${o}/${u}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(s+=`/${Math.round(d*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function WS(r){return r.replace("#","").split("/").map(parseFloat)}var Ou=t_;function t_(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?Ry(r,e):{}.toString.call(r)=="[object Set]"?Ry(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?XS(r,e):ZS(r,e)}function ZS(r,e){return r.toString()===e.toString()}function Ry(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!t_(r[n],e[n]))return!1;return!0}function XS(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&t_(r[o],e[o])))return!1}return!0}function KS(r,e,t){let n;const{map:i}=qa();st(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:s=!0}=e,{visualizePitch:d=!1}=e,p=null;return ei(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,s=g.showZoom),"visualizePitch"in g&&t(4,d=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new Qr.NavigationControl({showCompass:u,showZoom:s,visualizePitch:d})),n.addControl(p,o))},[i,o,u,s,d,p,n]}class i2 extends Tt{constructor(e){super(),Ct(this,e,KS,null,wt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function JS(r,e,t){let n;const{map:i}=qa();st(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:s="metric"}=e,d=null;return ei(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,s=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new Qr.ScaleControl({maxWidth:u,unit:s})),n.addControl(d,o))},[i,o,u,s,d,n]}class o2 extends Tt{constructor(e){super(),Ct(this,e,JS,null,wt,{position:1,maxWidth:2,unit:3})}}const{window:YS}=iw,QS=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),By=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function Fy(r){let e,t,n=r[3]&&Oy(r);const i=r[46].default,o=vn(i,r,r[45],By);return{c(){n&&n.c(),e=ne(),o&&o.c()},m(u,s){n&&n.m(u,s),W(u,e,s),o&&o.m(u,s),t=!0},p(u,s){u[3]?n?(n.p(u,s),s[0]&8&&N(n,1)):(n=Oy(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt()),o&&o.p&&(!t||s[0]&112|s[1]&16384)&&wn(o,i,u,u[45],t?bn(i,u[45],s,QS):xn(u[45]),By)},i(u){t||(N(n),N(o,u),t=!0)},o(u){V(n),V(o,u),t=!1},d(u){u&&G(e),n&&n.d(u),o&&o.d(u)}}}function Oy(r){let e,t,n,i,o,u,s,d;return e=new i2({props:{position:r[7]}}),n=new RS({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new IS({props:{position:r[7]}}),s=new o2({props:{position:r[7]}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),W(p,i,g),oe(o,p,g),W(p,u,g),oe(s,p,g),d=!0},p(p,g){const y={};g[0]&128&&(y.position=p[7]),e.$set(y);const x={};g[0]&128&&(x.position=p[7]),n.$set(x);const C={};g[0]&128&&(C.position=p[7]),o.$set(C);const T={};g[0]&128&&(T.position=p[7]),s.$set(T)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(G(t),G(i),G(u)),se(e,p),se(n,p),se(o,p),se(s,p)}}}function e5(r){let e,t,n,i,o,u=r[4]&&r[0]&&Fy(r);return{c(){e=j("div"),u&&u.c(),ue(e,"class",t=Yu(r[2])+" svelte-p00lfq"),ue(e,"data-testid","map-container"),Gt(e,"expand-map",!r[2])},m(s,d){W(s,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[St(YS,"hashchange",r[11]),qm(r[10].call(null,e))],i=!0)},p(s,d){s[4]&&s[0]?u?(u.p(s,d),d[0]&17&&N(u,1)):(u=Fy(s),u.c(),N(u,1),u.m(e,null)):u&&(Xt(),V(u,1,1,()=>{u=null}),Kt()),(!n||d[0]&4&&t!==(t=Yu(s[2])+" svelte-p00lfq"))&&ue(e,"class",t),(!n||d[0]&4)&&Gt(e,"expand-map",!s[2])},i(s){n||(N(u),n=!0)},o(s){V(u),n=!1},d(s){s&&G(e),u&&u.d(),r[47](null),i=!1,sr(o)}}}function t5(r,e,t){let n,i,o,u,{$$slots:s={},$$scope:d}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:y=void 0}=e,{style:x}=e,{diffStyleUpdates:C=!1}=e,{center:T=void 0}=e,{zoom:E=void 0}=e,{pitch:z=0}=e,{bearing:I=0}=e,{bounds:L=void 0}=e,{hash:B=!1}=e,{updateHash:O=Pe=>{window.history.replaceState(window.history.state,"",Pe)}}=e,{loaded:Y=!1}=e,{minZoom:q=0}=e,{maxZoom:H=22}=e,{minPitch:Z=0}=e,{maxPitch:_e=60}=e,{renderWorldCopies:Ie=void 0}=e,{dragPan:J=void 0}=e,{dragRotate:fe=void 0}=e,{pitchWithRotate:Ee=void 0}=e,{antialias:ye=void 0}=e,{zoomOnDoubleClick:Oe=!0}=e,{locale:Ue=void 0}=e,{interactive:De=!0}=e,{attributionControl:xe=!0}=e,{cooperativeGestures:et=!1}=e,{preserveDrawingBuffer:Ze=!1}=e,{maxBounds:Qe=void 0}=e,{images:ct=[]}=e,{standardControls:dt=!1}=e,{filterLayers:Je=void 0}=e,{transformRequest:yt=void 0}=e;const Et=$s(),{map:Ot,loadedImages:Yt}=uS();st(r,Ot,Pe=>t(4,o=Pe)),st(r,Yt,Pe=>t(5,u=Pe));let tn=new Set;async function Qt(Pe,tt=!1){if(o&&!(!o.loaded()&&!tt))if("url"in Pe){tn.add(Pe.id);try{let jt=await o.loadImage(Pe.url);o==null||o.addImage(Pe.id,jt.data,Pe.options),u.add(Pe.id),Yt.set(u)}catch(jt){Et("error",jt)}finally{tn.delete(Pe.id)}}else o.addImage(Pe.id,Pe.data,Pe.options),u.add(Pe.id),Yt.set(u)}let fn,pn,He,We;function mt(Pe){return he(),an(Ot,o=new Qr.Map(Ba({container:Pe,style:x,locale:Ue,center:T,zoom:E,pitch:z,bearing:I,minZoom:q,maxZoom:H,minPitch:Z,maxPitch:_e,renderWorldCopies:Ie,dragPan:J,dragRotate:fe,pitchWithRotate:Ee,antialias:ye,interactive:De,preserveDrawingBuffer:Ze,maxBounds:Qe,bounds:L,attributionControl:xe,transformRequest:yt,cooperativeGestures:et})),o),o.on("load",tt=>{tt.target.getContainer().setAttribute("data-testid","map"),tt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,Y=!0),Et("load",o)}),o.on("error",tt=>Et("error",{...tt,map:o})),o.on("movestart",tt=>Et("movestart",{...tt,map:o})),o.on("moveend",tt=>{if(t(12,T=tt.target.getCenter()),t(13,E=tt.target.getZoom()),t(14,z=tt.target.getPitch()),t(15,I=tt.target.getBearing()),t(16,L=tt.target.getBounds()),Et("moveend",{...tt,map:o}),B){let jt=new URL(window.location.href.replace(/(#.+)?$/,GS(o)));O(jt)}}),o.on("click",tt=>Et("click",{...tt,map:o})),o.on("dblclick",tt=>Et("dblclick",{...tt,map:o})),o.on("contextmenu",tt=>Et("contextmenu",{...tt,map:o})),o.on("zoomstart",tt=>Et("zoomstart",{...tt,map:o})),o.on("zoom",tt=>{Et("zoom",{...tt,map:o})}),o.on("zoomend",tt=>{Et("zoomend",{...tt,map:o})}),o.on("style.load",()=>{if(o){const tt=o.getStyle();if(t(42,fn=tt.layers.map(jt=>jt.id)),t(43,pn=Object.keys(tt.sources)),We)for(const[jt,Gn]of Object.entries(We))o.addSource(jt,Gn);if(He)for(const jt of He)o.addLayer(jt);for(const jt of ct)Qt(jt,!0)}}),o.on("styledata",tt=>{if(o&&Je){const jt=o.getStyle().layers;if(jt)for(let Gn of jt)Je(Gn)||o.setLayoutProperty(Gn.id,"visibility","none")}Et("styledata",{...tt,map:o})}),{destroy(){t(0,Y=!1),o==null||o.remove(),an(Ot,o=null,o)}}}let Pt=x;function he(){if(B){let Pe=WS(window.location.hash);Pe.length>=3&&(t(13,E=Pe[0]),t(12,T=[Pe[2],Pe[1]])),Pe.length==5&&(t(15,I=Pe[3]),t(14,z=Pe[4]))}}function nn(Pe){_n[Pe?"unshift":"push"](()=>{g=Pe,t(1,g)})}return r.$$set=Pe=>{"map"in Pe&&t(17,p=Pe.map),"mapContainer"in Pe&&t(1,g=Pe.mapContainer),"class"in Pe&&t(2,y=Pe.class),"style"in Pe&&t(18,x=Pe.style),"diffStyleUpdates"in Pe&&t(19,C=Pe.diffStyleUpdates),"center"in Pe&&t(12,T=Pe.center),"zoom"in Pe&&t(13,E=Pe.zoom),"pitch"in Pe&&t(14,z=Pe.pitch),"bearing"in Pe&&t(15,I=Pe.bearing),"bounds"in Pe&&t(16,L=Pe.bounds),"hash"in Pe&&t(20,B=Pe.hash),"updateHash"in Pe&&t(21,O=Pe.updateHash),"loaded"in Pe&&t(0,Y=Pe.loaded),"minZoom"in Pe&&t(22,q=Pe.minZoom),"maxZoom"in Pe&&t(23,H=Pe.maxZoom),"minPitch"in Pe&&t(24,Z=Pe.minPitch),"maxPitch"in Pe&&t(25,_e=Pe.maxPitch),"renderWorldCopies"in Pe&&t(26,Ie=Pe.renderWorldCopies),"dragPan"in Pe&&t(27,J=Pe.dragPan),"dragRotate"in Pe&&t(28,fe=Pe.dragRotate),"pitchWithRotate"in Pe&&t(29,Ee=Pe.pitchWithRotate),"antialias"in Pe&&t(30,ye=Pe.antialias),"zoomOnDoubleClick"in Pe&&t(31,Oe=Pe.zoomOnDoubleClick),"locale"in Pe&&t(32,Ue=Pe.locale),"interactive"in Pe&&t(33,De=Pe.interactive),"attributionControl"in Pe&&t(34,xe=Pe.attributionControl),"cooperativeGestures"in Pe&&t(35,et=Pe.cooperativeGestures),"preserveDrawingBuffer"in Pe&&t(36,Ze=Pe.preserveDrawingBuffer),"maxBounds"in Pe&&t(37,Qe=Pe.maxBounds),"images"in Pe&&t(38,ct=Pe.images),"standardControls"in Pe&&t(3,dt=Pe.standardControls),"filterLayers"in Pe&&t(39,Je=Pe.filterLayers),"transformRequest"in Pe&&t(40,yt=Pe.transformRequest),"$$scope"in Pe&&t(45,d=Pe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof dt=="boolean"?void 0:dt),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Ou(x,Pt)){const Pe=o.getStyle();if(fn&&(He=Pe.layers.filter(tt=>!fn.includes(tt.id))),pn){const tt=Object.keys(Pe.sources).filter(jt=>!pn.includes(jt));We={};for(const jt of tt)We[jt]=Pe.sources[jt]}t(44,Pt=x),o.setStyle(x,{diff:C}),an(Yt,u=new Set,u),t(41,tn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&Y&&o!=null&&o.loaded())for(let Pe of ct)!u.has(Pe.id)&&!tn.has(Pe.id)&&!o.hasImage(Pe.id)&&Qt(Pe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=ct.every(Pe=>u.has(Pe.id))),r.$$.dirty[0]&61456&&o){let Pe={};T!=null&&!Ou(T,o==null?void 0:o.getCenter())&&(Pe.center=T),E!=null&&!Ou(E,o==null?void 0:o.getZoom())&&(Pe.zoom=E),I!=null&&!Ou(I,o==null?void 0:o.getBearing())&&(Pe.bearing=I),z!=null&&!Ou(z,o==null?void 0:o.getPitch())&&(Pe.pitch=z),Object.keys(Pe).length&&o.easeTo(Pe)}r.$$.dirty[0]&65552&&L&&!Ou(L,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(L)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(Oe?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[Y,g,y,dt,o,u,i,n,Ot,Yt,mt,he,T,E,z,I,L,p,x,C,B,O,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De,xe,et,Ze,Qe,ct,Je,yt,tn,fn,pn,Pt,d,s,nn]}class n5 extends Tt{constructor(e){super(),Ct(this,e,t5,e5,wt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const r5=r=>({marker:r&8}),$y=r=>({marker:r[3]});function i5(r){let e,t,n,i,o,u,s;const d=r[19].default,p=vn(d,r,r[18],$y);return{c(){e=j("div"),p&&p.c(),ue(e,"tabindex",t=r[1]?0:void 0),ue(e,"role",n=r[1]?"button":void 0),Xe(e,"z-index",r[2])},m(g,y){W(g,e,y),p&&p.m(e,null),o=!0,u||(s=[qm(r[7].call(null,e)),qm(i=o5.call(null,e,r[0])),St(e,"click",Mf(r[20])),St(e,"dblclick",Mf(r[21])),St(e,"contextmenu",Mf(Pg(r[22]))),St(e,"mouseenter",r[23]),St(e,"mouseleave",r[24]),St(e,"mousemove",r[25]),St(e,"keydown",r[8])],u=!0)},p(g,[y]){p&&p.p&&(!o||y&262152)&&wn(p,d,g,g[18],o?bn(d,g[18],y,r5):xn(g[18]),$y),(!o||y&2&&t!==(t=g[1]?0:void 0))&&ue(e,"tabindex",t),(!o||y&2&&n!==(n=g[1]?"button":void 0))&&ue(e,"role",n),i&&ca(i.update)&&y&1&&i.update.call(null,g[0]),y&4&&Xe(e,"z-index",g[2])},i(g){o||(N(p,g),o=!0)},o(g){V(p,g),o=!1},d(g){g&&G(e),p&&p.d(g),u=!1,sr(s)}}}function o5(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function s5(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:y=!0}=e,{asButton:x=!1}=e,{draggable:C=!1}=e,{feature:T=null}=e,{offset:E=void 0}=e,{zIndex:z=void 0}=e,{rotation:I=0}=e,{opacity:L=1}=e;const B=$s(),{map:O,layerEvent:Y,self:q,markerClickManager:H}=cS();st(r,O,xe=>t(27,o=xe)),st(r,Y,xe=>t(26,n=xe)),st(r,q,xe=>t(3,i=xe));function Z(xe){an(q,i=new Qr.Marker({element:xe,rotation:I,draggable:C,offset:E,opacity:L.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const et=()=>J("dragstart"),Ze=()=>{_e(),J("drag")},Qe=()=>{_e(),J("dragend")};return C&&(i.on("dragstart",et),i.on("drag",Ze),i.on("dragend",Qe)),{destroy(){C&&(i==null||i.off("dragstart",et),i==null||i.off("drag",Ze),i==null||i.off("dragend",Qe)),t(11,d=void 0),i==null||i.remove()}}}function _e(){let xe=i==null?void 0:i.getLngLat();xe&&(Array.isArray(p)?t(10,p=[xe.lng,xe.lat]):p&&"lon"in p?t(10,p={lon:xe.lng,lat:xe.lat}):t(10,p=xe))}function Ie(xe){xe.key===" "&&(xe.preventDefault(),xe.stopPropagation(),J("click"))}function J(xe){if(!y)return;let et=i==null?void 0:i.getLngLat();if(!et)return;const Ze=[et.lng,et.lat];let Qe={map:o,marker:i,lngLat:Ze,features:[{type:"Feature",properties:(T==null?void 0:T.properties)??{},geometry:{type:"Point",coordinates:Ze}}]};(xe==="click"||xe==="contextmenu")&&H.handleClick(Qe),an(Y,n={...Qe,layerType:"marker",type:xe},n),B(xe,Qe)}const fe=()=>J("click"),Ee=()=>J("dblclick"),ye=()=>{J("contextmenu")},Oe=()=>{J("mouseenter")},Ue=()=>{J("mouseleave")},De=()=>J("mousemove");return r.$$set=xe=>{"marker"in xe&&t(11,d=xe.marker),"lngLat"in xe&&t(10,p=xe.lngLat),"class"in xe&&t(0,g=xe.class),"interactive"in xe&&t(12,y=xe.interactive),"asButton"in xe&&t(1,x=xe.asButton),"draggable"in xe&&t(13,C=xe.draggable),"feature"in xe&&t(14,T=xe.feature),"offset"in xe&&t(15,E=xe.offset),"zIndex"in xe&&t(2,z=xe.zIndex),"rotation"in xe&&t(16,I=xe.rotation),"opacity"in xe&&t(17,L=xe.opacity),"$$scope"in xe&&t(18,s=xe.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(E??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(I)),r.$$.dirty&131080&&(i==null||i.setOpacity(L.toString()))},[g,x,z,i,O,Y,q,Z,Ie,J,p,d,y,C,T,E,I,L,s,u,fe,Ee,ye,Oe,Ue,De]}class hp extends Tt{constructor(e){super(),Ct(this,e,s5,i5,wt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const a5=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Ny=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function jy(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof Qr.Marker)&&Uy(r);return{c(){e=j("div"),n&&n.c()},m(o,u){W(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var s;(s=o[4])!=null&&s.length||o[3]instanceof Qr.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=Uy(o),n.c(),N(n,1),n.m(e,null)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(o){t||(N(n),t=!0)},o(o){V(n),t=!1},d(o){o&&G(e),n&&n.d(),r[32](null)}}}function Uy(r){let e;const t=r[30].default,n=vn(t,r,r[29],Ny);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,a5):xn(i[29]),Ny)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function l5(r){let e,t,n=r[9].default&&jy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=jy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function u5(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const y=Ig(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:E=!1}=e,{openOn:z="click"}=e,{openIfTopMost:I=!0}=e,{focusAfterOpen:L=!0}=e,{anchor:B=void 0}=e,{offset:O=void 0}=e,{popupClass:Y=void 0}=e,{maxWidth:q=void 0}=e,{lngLat:H=void 0}=e,{html:Z=void 0}=e,{open:_e=!1}=e;const Ie=$s(),{map:J,popupTarget:fe,layerEvent:Ee,layer:ye,eventTopMost:Oe,markerClickManager:Ue}=qa();st(r,J,he=>t(2,o=he)),st(r,fe,he=>t(3,s=he)),st(r,Ee,he=>t(28,u=he)),st(r,ye,he=>t(35,d=he));const De=["click","dblclick","contextmenu"];let xe,et=!1,Ze;function Qe(){if(!xe)return;let he=xe.getElement();!he||he===Ze||(Ze=he,z==="hover"&&(Ze.style.pointerEvents="none"),Ze.addEventListener("mouseenter",()=>{t(24,et=!0)},{passive:!0}),Ze.addEventListener("mouseleave",()=>{t(24,et=!1)},{passive:!0}),Ze.addEventListener("click",()=>{T&&t(0,_e=!1)},{passive:!0}))}ls(()=>{if(o)return o.on("click",pn),o.on("contextmenu",pn),Ue.add(He),typeof s=="string"&&(o.on("click",s,Et),o.on("dblclick",s,Et),o.on("contextmenu",s,Et),o.on("mousemove",s,fn),o.on("mouseleave",s,Qt),o.on("touchstart",s,Yt),o.on("touchend",s,tn)),()=>{o!=null&&o.loaded()&&(xe==null||xe.remove(),o.off("click",pn),o.off("contextmenu",pn),Ue.remove(He),s instanceof Qr.Marker?s.getPopup()===xe&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Et),o.off("dblclick",s,Et),o.off("contextmenu",s,Et),o.off("mousemove",s,fn),o.off("mouseleave",s,Qt),o.off("touchstart",s,Yt),o.off("touchend",s,tn)))}});function ct(he){return I?!("marker"in he)&&!fS(he)&&Oe(he)!==d:!1}let dt=null,Je="normal";function yt(he){"layerType"in he&&he.layerType==="deckgl"?(t(10,H=he.coordinate),t(4,dt=he.object?[he.object]:null)):(t(10,H=he.lngLat),t(4,dt=he.features??[]))}function Et(he){he.type!==z||ct(he)||(yt(he),setTimeout(()=>t(0,_e=!0)))}let Ot=null;function Yt(he){Ot=he.point}function tn(he){if(!Ot||z!=="hover")return;let nn=Ot.dist(he.point);Ot=null,nn<3&&(t(10,H=he.lngLat),t(4,dt=he.features??[]),xe.isOpen()?t(25,Je="justOpened"):(t(25,Je="opening"),t(0,_e=!0)))}function Qt(he){z!=="hover"||Ot||Je!=="normal"||(t(0,_e=!1),t(4,dt=null))}function fn(he){if(!(z!=="hover"||Ot||Je!=="normal")){if(ct(he)){t(0,_e=!1),t(4,dt=null);return}t(0,_e=!0),t(4,dt=he.features??[]),t(10,H=he.lngLat)}}function pn(he){if(Je==="justOpened"){t(25,Je="normal");return}if(!C)return;let nn=[Ze,s instanceof Qr.Marker?s==null?void 0:s.getElement():null];_e&&xe.isOpen()&&!nn.some(Pe=>Pe==null?void 0:Pe.contains(he.originalEvent.target))&&(he.type==="contextmenu"&&z==="contextmenu"||he.type!=="contextmenu")&&t(0,_e=!1)}function He(he){C&&_e&&xe.isOpen()&&he.marker!==s&&t(0,_e=!1)}ei(()=>{o&&(xe!=null&&xe.isOpen())&&xe.remove()});let We;const mt=()=>t(0,_e=!1);function Pt(he){_n[he?"unshift":"push"](()=>{We=he,t(1,We)})}return r.$$set=he=>{"closeButton"in he&&t(11,x=he.closeButton),"closeOnClickOutside"in he&&t(12,C=he.closeOnClickOutside),"closeOnClickInside"in he&&t(13,T=he.closeOnClickInside),"closeOnMove"in he&&t(14,E=he.closeOnMove),"openOn"in he&&t(15,z=he.openOn),"openIfTopMost"in he&&t(16,I=he.openIfTopMost),"focusAfterOpen"in he&&t(17,L=he.focusAfterOpen),"anchor"in he&&t(18,B=he.anchor),"offset"in he&&t(19,O=he.offset),"popupClass"in he&&t(20,Y=he.popupClass),"maxWidth"in he&&t(21,q=he.maxWidth),"lngLat"in he&&t(10,H=he.lngLat),"html"in he&&t(22,Z=he.html),"open"in he&&t(0,_e=he.open),"$$scope"in he&&t(29,g=he.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(xe||(t(23,xe=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:E,focusAfterOpen:L,maxWidth:q,className:Y,anchor:B,offset:O})),Ze=xe.getElement(),xe.on("open",()=>{t(0,_e=!0),Qe(),Ie("open",xe)}),xe.on("close",()=>{t(0,_e=!1),Ie("close",xe)}),xe.on("hover",()=>{Ie("hover",xe)}))),r.$$.dirty[0]&8421384&&xe&&s instanceof Qr.Marker&&(z==="click"?s.setPopup(xe):s.getPopup()===xe&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&De.includes(z)&&(u==null?void 0:u.type)===z&&(Et(u),an(Ee,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=z==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&z==="hover"&&Ee&&(i&&u&&yt(u),t(0,_e=(i||et)??!1)),r.$$.dirty[0]&12582914&&(We?xe.setDOMContent(We):Z&&xe.setHTML(Z)),r.$$.dirty[0]&8389632&&H&&xe.setLngLat(H),r.$$.dirty[0]&41943045&&o){let he=xe.isOpen();_e&&!he?(xe.addTo(o),Je==="opening"&&t(25,Je="justOpened")):!_e&&he&&xe.remove()}},[_e,We,o,s,dt,J,fe,Ee,ye,y,H,x,C,T,E,z,I,L,B,O,Y,q,Z,xe,et,Je,i,n,u,g,p,mt,Pt]}let s2=class extends Tt{constructor(e){super(),Ct(this,e,u5,l5,wt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Xu=Math.pow,Xi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{s(t.next(d))}catch(p){i(p)}},u=d=>{try{s(t.throw(d))}catch(p){i(p)}},s=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);s((t=t.apply(r,e)).next())}),$o=Uint8Array,Wu=Uint16Array,c5=Int32Array,a2=new $o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l2=new $o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),f5=new $o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u2=function(r,e){for(var t=new Wu(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new c5(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},c2=u2(a2,2),f2=c2.b,h5=c2.r;f2[28]=258,h5[258]=28;var d5=u2(l2,0),p5=d5.b,eg=new Wu(32768);for(pr=0;pr<32768;++pr)ta=(pr&43690)>>1|(pr&21845)<<1,ta=(ta&52428)>>2|(ta&13107)<<2,ta=(ta&61680)>>4|(ta&3855)<<4,eg[pr]=((ta&65280)>>8|(ta&255)<<8)>>1;var ta,pr,Rf=function(r,e,t){for(var n=r.length,i=0,o=new Wu(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Wu(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var s;if(t){s=new Wu(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],y=u[r[i]-1]++<<g,x=y|(1<<g)-1;y<=x;++y)s[eg[y]>>d]=p}else for(s=new Wu(n),i=0;i<n;++i)r[i]&&(s[i]=eg[u[r[i]-1]++]>>15-r[i]);return s},oh=new $o(288);for(pr=0;pr<144;++pr)oh[pr]=8;var pr;for(pr=144;pr<256;++pr)oh[pr]=9;var pr;for(pr=256;pr<280;++pr)oh[pr]=7;var pr;for(pr=280;pr<288;++pr)oh[pr]=8;var pr,h2=new $o(32);for(pr=0;pr<32;++pr)h2[pr]=5;var pr,m5=Rf(oh,9,1),g5=Rf(h2,5,1),Dm=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ms=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Rm=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},_5=function(r){return(r+7)/8|0},y5=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new $o(t-e);return n.set(r.subarray(e,t)),n},v5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Bo=function(r,e,t){var n=new Error(e||v5[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Bo),!t)throw n;return n},n_=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new $o(0);var u=!t||e.i!=2,s=e.i;t||(t=new $o(i*3));var d=function(Qt){var fn=t.length;if(Qt>fn){var pn=new $o(Math.max(fn*2,Qt));pn.set(t),t=pn}},p=e.f||0,g=e.p||0,y=e.b||0,x=e.l,C=e.d,T=e.m,E=e.n,z=i*8;do{if(!x){p=ms(r,g,1);var I=ms(r,g+1,3);if(g+=3,I)if(I==1)x=m5,C=g5,T=9,E=5;else if(I==2){var Y=ms(r,g,31)+257,q=ms(r,g+10,15)+4,H=Y+ms(r,g+5,31)+1;g+=14;for(var Z=new $o(H),_e=new $o(19),Ie=0;Ie<q;++Ie)_e[f5[Ie]]=ms(r,g+Ie*3,7);g+=q*3;for(var J=Dm(_e),fe=(1<<J)-1,Ee=Rf(_e,J,1),Ie=0;Ie<H;){var ye=Ee[ms(r,g,fe)];g+=ye&15;var L=ye>>4;if(L<16)Z[Ie++]=L;else{var Oe=0,Ue=0;for(L==16?(Ue=3+ms(r,g,3),g+=2,Oe=Z[Ie-1]):L==17?(Ue=3+ms(r,g,7),g+=3):L==18&&(Ue=11+ms(r,g,127),g+=7);Ue--;)Z[Ie++]=Oe}}var De=Z.subarray(0,Y),xe=Z.subarray(Y);T=Dm(De),E=Dm(xe),x=Rf(De,T,1),C=Rf(xe,E,1)}else Bo(1);else{var L=_5(g)+4,B=r[L-4]|r[L-3]<<8,O=L+B;if(O>i){s&&Bo(0);break}u&&d(y+B),t.set(r.subarray(L,O),y),e.b=y+=B,e.p=g=O*8,e.f=p;continue}if(g>z){s&&Bo(0);break}}u&&d(y+131072);for(var et=(1<<T)-1,Ze=(1<<E)-1,Qe=g;;Qe=g){var Oe=x[Rm(r,g)&et],ct=Oe>>4;if(g+=Oe&15,g>z){s&&Bo(0);break}if(Oe||Bo(2),ct<256)t[y++]=ct;else if(ct==256){Qe=g,x=null;break}else{var dt=ct-254;if(ct>264){var Ie=ct-257,Je=a2[Ie];dt=ms(r,g,(1<<Je)-1)+f2[Ie],g+=Je}var yt=C[Rm(r,g)&Ze],Et=yt>>4;yt||Bo(3),g+=yt&15;var xe=p5[Et];if(Et>3){var Je=l2[Et];xe+=Rm(r,g)&(1<<Je)-1,g+=Je}if(g>z){s&&Bo(0);break}u&&d(y+131072);var Ot=y+dt;if(y<xe){var Yt=o-xe,tn=Math.min(xe,Ot);for(Yt+y<0&&Bo(3);y<tn;++y)t[y]=n[Yt+y]}for(;y<Ot;y+=4)t[y]=t[y-xe],t[y+1]=t[y+1-xe],t[y+2]=t[y+2-xe],t[y+3]=t[y+3-xe];y=Ot}}e.l=x,e.p=Qe,e.b=y,e.f=p,x&&(p=1,e.m=T,e.d=C,e.n=E)}while(!p);return y==t.length?t:y5(t,0,y)},b5=new $o(0),w5=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Bo(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},x5=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},A5=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Bo(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Bo(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function k5(r,e){return n_(r,{i:2},e&&e.out,e&&e.dictionary)}function S5(r,e){var t=w5(r);return t+8>r.length&&Bo(6,"invalid gzip data"),n_(r.subarray(t,-8),{i:2},e&&e.out||new $o(x5(r)),e&&e.dictionary)}function C5(r,e){return n_(r.subarray(A5(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function tg(r,e){return r[0]==31&&r[1]==139&&r[2]==8?S5(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?k5(r,e):C5(r,e)}var T5=typeof TextDecoder<"u"&&new TextDecoder,M5=0;try{T5.decode(b5,{stream:!0}),M5=1}catch{}var d2=(r,e)=>r*Xu(2,e),mf=(r,e)=>Math.floor(r/Xu(2,e)),Jd=(r,e)=>d2(r.getUint16(e+1,!0),8)+r.getUint8(e),p2=(r,e)=>d2(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),E5=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=Jd(n,i+1);if(e!==o)return e-o;const u=Jd(n,i+4);return t!==u?t-u:0},L5=(r,e,t,n)=>{const i=m2(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},Vy=(r,e,t,n)=>{const i=m2(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},m2=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,s=E5(e,t,n,r,u*17);if(s>0)i=u+1;else if(s<0)o=u-1;else return[p2(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},I5=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,g2=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Jd(r,e*17+1),y:Jd(r,e*17+4),offset:p2(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},qy=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(g2(t,n));return P5(e)},P5=r=>{r.sort(I5);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=mf(i.offset,8)&255,t[n*17+9]=mf(i.offset,16)&255,t[n*17+10]=mf(i.offset,24)&255,t[n*17+11]=mf(i.offset,32)&255,t[n*17+12]=mf(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},z5=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=g2(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:s}}return null};function D5(r){return Xi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let s=0;u.compression==="gzip"&&(s=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,y=0,x=0,C=-180,T=-85,E=180,z=85;if(u.bounds){const L=u.bounds.split(",");C=+L[0],T=+L[1],E=+L[2],z=+L[3]}if(u.center){const L=u.center.split(",");g=+L[0],y=+L[1],x=+L[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:d,maxZoom:p,minLon:C,minLat:T,maxLon:E,maxLat:z,centerZoom:x,centerLon:g,centerLat:y,etag:e.etag}})}function R5(r,e,t,n,i,o,u){return Xi(this,null,function*(){let s=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(s=qy(s));const d=Vy(new DataView(s),n,i,o);if(d){let y=(yield e.getBytes(d.offset,d.length,u)).data;const x=new DataView(y);return x.getUint8(0)===31&&x.getUint8(1)===139&&(y=tg(new Uint8Array(y))),{data:y}}const p=z5(new DataView(s),{z:n,x:i,y:o});if(p){const g=L5(new DataView(s),p.z,p.x,p.y);if(g){let y=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(y=qy(y));const x=Vy(new DataView(y),n,i,o);if(x){let T=(yield e.getBytes(x.offset,x.length,u)).data;const E=new DataView(T);return E.getUint8(0)===31&&E.getUint8(1)===139&&(T=tg(new Uint8Array(T))),{data:T}}}}})}var _2={getHeader:D5,getZxy:R5},B5=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},F5=class{constructor(){this.tilev4=(r,e)=>Xi(this,null,function*(){if(r.type==="json"){const y=r.url.substr(10);let x=this.tiles.get(y);x||(x=new Hy(y),this.tiles.set(y,x));const C=yield x.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new Hy(i),this.tiles.set(i,o));const u=n[2],s=n[3],d=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+s,+d,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=B5(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function $u(r,e){return(e>>>0)*4294967296+(r>>>0)}function O5(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return $u(r,i);throw new Error("Expected varint not more than 10 bytes")}function gf(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,O5(n,r))}function $5(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var N5=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function j5(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Xu(2,r)-1||t>Xu(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=N5[r],i=Xu(2,r);let o=0,u=0,s=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,u=(d[1]&p)>0?1:0,s+=p*p*(3*o^u),$5(p,d,o,u),p=p/2;return n+s}function y2(r,e){return Xi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return tg(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var U5=127;function V5(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var q5=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Xi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let s;this.mustReload&&(s="reload");let d=yield fetch(this.url,{signal:o,cache:s,headers:u});if(r===0&&d.status===416){const x=d.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const C=+x.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${C-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new ng(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function gs(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Xu(2,32)+n}function H5(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:gs(t,8),rootDirectoryLength:gs(t,16),jsonMetadataOffset:gs(t,24),jsonMetadataLength:gs(t,32),leafDirectoryOffset:gs(t,40),leafDirectoryLength:gs(t,48),tileDataOffset:gs(t,56),tileDataLength:gs(t,64),numAddressedTiles:gs(t,72),numTileEntries:gs(t,80),numTileContents:gs(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function v2(r){const e={buf:new Uint8Array(r),pos:0},t=gf(e),n=[];let i=0;for(let o=0;o<t;o++){const u=gf(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=gf(e);for(let o=0;o<t;o++)n[o].length=gf(e);for(let o=0;o<t;o++){const u=gf(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function G5(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ng=class extends Error{};function W5(r,e){return Xi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(G5(t.data)<3)return[yield _2.getHeader(r)];const i=t.data.slice(0,U5),o=H5(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=v2(yield e(u,o.internalCompression));return[o,[s,d.length,d]]})}function Z5(r,e,t,n,i){return Xi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),s=v2(u);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var X5=class{constructor(r=100,e=!0,t=y2){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Xi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{W5(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Xi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{Z5(r,this.decompress,e,t,n).then(p=>{s(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Xi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{s(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Xi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},Hy=class{constructor(r,e,t){typeof r=="string"?this.source=new q5(r):this.source=r,t?this.decompress=t:this.decompress=y2,e?this.cache=e:this.cache=new X5}getHeader(){return Xi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Xi(this,null,function*(){const i=j5(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return _2.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,u,s,o),g=V5(p,i);if(g){if(g.runLength>0){const y=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(y.data,o.tileCompression),cacheControl:y.cacheControl,expires:y.expires}}u=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Xi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof ng)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Xi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Xi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ng)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function K5(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function J5(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[K5]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ih({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function Y5(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Va("symbol")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:E=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:I=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:B=!1}=e,{interactive:O=!0}=e;function Y(fe){L=fe,t(0,L)}function q(fe){Sn.call(this,r,fe)}function H(fe){Sn.call(this,r,fe)}function Z(fe){Sn.call(this,r,fe)}function _e(fe){Sn.call(this,r,fe)}function Ie(fe){Sn.call(this,r,fe)}function J(fe){Sn.call(this,r,fe)}return r.$$set=fe=>{"id"in fe&&t(1,o=fe.id),"source"in fe&&t(2,u=fe.source),"sourceLayer"in fe&&t(3,s=fe.sourceLayer),"beforeId"in fe&&t(4,d=fe.beforeId),"beforeLayerType"in fe&&t(5,p=fe.beforeLayerType),"paint"in fe&&t(6,g=fe.paint),"layout"in fe&&t(7,y=fe.layout),"filter"in fe&&t(8,x=fe.filter),"applyToClusters"in fe&&t(9,C=fe.applyToClusters),"minzoom"in fe&&t(10,T=fe.minzoom),"maxzoom"in fe&&t(11,E=fe.maxzoom),"hoverCursor"in fe&&t(12,z=fe.hoverCursor),"manageHoverState"in fe&&t(13,I=fe.manageHoverState),"hovered"in fe&&t(0,L=fe.hovered),"eventsIfTopMost"in fe&&t(14,B=fe.eventsIfTopMost),"interactive"in fe&&t(15,O=fe.interactive),"$$scope"in fe&&t(24,i=fe.$$scope)},[L,o,u,s,d,p,g,y,x,C,T,E,z,I,B,O,n,Y,q,H,Z,_e,Ie,J,i]}class ic extends Tt{constructor(e){super(),Ct(this,e,Y5,J5,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Gy(r){let e=r[0],t,n,i=Wy(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&wt(e,e=o[0])?(Xt(),V(i,1,1,lt),Kt(),i=Wy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Wy(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Q5(r){let e,t,n=r[0]&&Gy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Gy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function eC(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:s=Va("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:y=null}=e,{scheme:x=null}=e,{attribution:C=null}=e,{minzoom:T=null}=e,{maxzoom:E=null}=e,{volatile:z=null}=e;if(d&&d.includes("pmtiles://")&&!Qr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let O=new F5;Qr.addProtocol("pmtiles",O.tile)}const{map:I,self:L}=Yw();st(r,I,O=>t(13,i=O)),st(r,L,O=>t(0,n=O));let B;return ei(()=>{n&&i&&(r2(I,n,B),an(L,n=null,n),B=void 0)}),r.$$set=O=>{"id"in O&&t(3,s=O.id),"url"in O&&t(4,d=O.url),"tiles"in O&&t(5,p=O.tiles),"promoteId"in O&&t(6,g=O.promoteId),"bounds"in O&&t(7,y=O.bounds),"scheme"in O&&t(8,x=O.scheme),"attribution"in O&&t(9,C=O.attribution),"minzoom"in O&&t(10,T=O.minzoom),"maxzoom"in O&&t(11,E=O.maxzoom),"volatile"in O&&t(12,z=O.volatile),"$$scope"in O&&t(14,u=O.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==s&&(an(L,n=s,n),n2(i,n,Ba({type:"vector",url:d,tiles:p,promoteId:g,bounds:y,scheme:x,attribution:C,minzoom:T,maxzoom:E,volatile:z}),O=>i&&O===n,()=>{n&&(B=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{B=i==null?void 0:i.getSource(s)}))},[n,I,L,s,d,p,g,y,x,C,T,E,z,i,u,o]}class sh extends Tt{constructor(e){super(),Ct(this,e,eC,Q5,wt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}let Fd=Cn(!0);function tC(r){let e,t;return e=new Ki({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function nC(r){let e,t;return e=new yr({props:{data:r[1],$$slots:{default:[tC]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function rC(r,e,t){let n;return st(r,Fd,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class iC extends Tt{constructor(e){super(),Ct(this,e,rC,nC,wt,{})}}function oC(r){let e,t;return e=new hp({props:{lngLat:r[0],$$slots:{default:[aC]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function sC(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[lC]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new hp({props:o}),_n.push(()=>Rn(e,"lngLat",i)),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,s){const d={};s&16&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.lngLat=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function aC(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=j("span"),i&&i.c(),ue(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function lC(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=j("span"),i&&i.c(),ue(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function uC(r){let e,t,n,i;const o=[sC,oC],u=[];function s(d,p){return d[1]?0:1}return e=s(r),t=u[e]=o[e](r),{c(){t.c(),n=rr()},m(d,p){u[e].m(d,p),W(d,n,p),i=!0},p(d,[p]){let g=e;e=s(d),e===g?u[e].p(d,p):(Xt(),V(u[g],1,1,()=>{u[g]=null}),Kt(),t=u[e],t?t.p(d,p):(t=u[e]=o[e](d),t.c()),N(t,1),t.m(n.parentNode,n))},i(d){i||(N(t),i=!0)},o(d){V(t),i=!1},d(d){d&&G(n),u[e].d(d)}}}function cC(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function s(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,s,i]}class Dl extends Tt{constructor(e){super(),Ct(this,e,cC,uC,wt,{lngLat:0,draggable:1})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const fC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Zy=fC;function Xy(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Bm(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=Mt(n,t[i]);return{c(){e=bs(r[11]),Hd(e,n)},m(i,o){W(i,e,o)},p(i,o){Hd(e,n=Tn(t,[o&32&&i[12]]))},d(i){i&&G(e)}}}function Ky(r){let e=r[11],t,n=r[11]&&Bm(r);return{c(){n&&n.c(),t=rr()},m(i,o){n&&n.m(i,o),W(i,t,o)},p(i,o){i[11]?e?wt(e,i[11])?(n.d(1),n=Bm(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Bm(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&G(t),n&&n.d(i)}}}function hC(r){let e,t,n,i,o,u=On(r[5]),s=[];for(let x=0;x<u.length;x+=1)s[x]=Ky(Xy(r,u,x));const d=r[10].default,p=vn(d,r,r[9],null);let g=[Zy,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],y={};for(let x=0;x<g.length;x+=1)y=Mt(y,g[x]);return{c(){e=bs("svg");for(let x=0;x<s.length;x+=1)s[x].c();t=rr(),p&&p.c(),Hd(e,y)},m(x,C){W(x,e,C);for(let T=0;T<s.length;T+=1)s[T]&&s[T].m(e,null);D(e,t),p&&p.m(e,null),o=!0},p(x,[C]){if(C&32){u=On(x[5]);let T;for(T=0;T<u.length;T+=1){const E=Xy(x,u,T);s[T]?s[T].p(E,C):(s[T]=Ky(E),s[T].c(),s[T].m(e,t))}for(;T<s.length;T+=1)s[T].d(1);s.length=u.length}p&&p.p&&(!o||C&512)&&wn(p,d,x,x[9],o?bn(d,x[9],C,null):xn(x[9]),null),Hd(e,y=Tn(g,[Zy,C&128&&x[7],(!o||C&4)&&{width:x[2]},(!o||C&4)&&{height:x[2]},(!o||C&2)&&{stroke:x[1]},(!o||C&28&&n!==(n=x[4]?Number(x[3])*24/Number(x[2]):x[3]))&&{"stroke-width":n},(!o||C&257&&i!==(i=x[6]("lucide-icon","lucide",x[0]?`lucide-${x[0]}`:"",x[8].class)))&&{class:i}]))},i(x){o||(N(p,x),o=!0)},o(x){V(p,x),o=!1},d(x){x&&G(e),di(s,x),p&&p.d(x)}}}function dC(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=Z0(e,n),{$$slots:o={},$$scope:u}=e,{name:s=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:y=!1}=e,{iconNode:x=[]}=e;const C=(...T)=>T.filter((E,z,I)=>!!E&&I.indexOf(E)===z).join(" ");return r.$$set=T=>{t(8,e=Mt(Mt({},e),or(T))),t(7,i=Z0(e,n)),"name"in T&&t(0,s=T.name),"color"in T&&t(1,d=T.color),"size"in T&&t(2,p=T.size),"strokeWidth"in T&&t(3,g=T.strokeWidth),"absoluteStrokeWidth"in T&&t(4,y=T.absoluteStrokeWidth),"iconNode"in T&&t(5,x=T.iconNode),"$$scope"in T&&t(9,u=T.$$scope)},e=or(e),[s,d,p,g,y,x,C,i,e,u,o]}class pC extends Tt{constructor(e){super(),Ct(this,e,dC,hC,wt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Qi=pC;function mC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function gC(r){let e,t;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[mC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function _C(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class yC extends Tt{constructor(e){super(),Ct(this,e,_C,gC,wt,{})}}const vC=yC;function bC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function wC(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[bC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function xC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class AC extends Tt{constructor(e){super(),Ct(this,e,xC,wC,wt,{})}}const kC=AC;function SC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function CC(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[SC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function TC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class MC extends Tt{constructor(e){super(),Ct(this,e,TC,CC,wt,{})}}const EC=MC;function LC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function IC(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[LC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function PC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class zC extends Tt{constructor(e){super(),Ct(this,e,PC,IC,wt,{})}}const DC=zC;function RC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function BC(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[RC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function FC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class OC extends Tt{constructor(e){super(),Ct(this,e,FC,BC,wt,{})}}const $C=OC;function NC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function jC(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[NC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function UC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class VC extends Tt{constructor(e){super(),Ct(this,e,UC,jC,wt,{})}}const qC=VC;function HC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function GC(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[HC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function WC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class ZC extends Tt{constructor(e){super(),Ct(this,e,WC,GC,wt,{})}}const b2=ZC;function XC(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function KC(r){let e,t;const n=[{name:"globe"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[XC]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function JC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class YC extends Tt{constructor(e){super(),Ct(this,e,JC,KC,wt,{})}}const QC=YC;function eT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function tT(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[eT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function nT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class rT extends Tt{constructor(e){super(),Ct(this,e,nT,tT,wt,{})}}const iT=rT;function oT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function sT(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[oT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function aT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class lT extends Tt{constructor(e){super(),Ct(this,e,aT,sT,wt,{})}}const uT=lT;function cT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function fT(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[cT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function hT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class dT extends Tt{constructor(e){super(),Ct(this,e,hT,fT,wt,{})}}const w2=dT;function pT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function mT(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[pT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function gT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class _T extends Tt{constructor(e){super(),Ct(this,e,gT,mT,wt,{})}}const r_=_T;function yT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function vT(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[yT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function bT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class wT extends Tt{constructor(e){super(),Ct(this,e,bT,vT,wt,{})}}const x2=wT;function xT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function AT(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[xT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function kT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class ST extends Tt{constructor(e){super(),Ct(this,e,kT,AT,wt,{})}}const CT=ST;function TT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function MT(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[TT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function ET(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class LT extends Tt{constructor(e){super(),Ct(this,e,ET,MT,wt,{})}}const dp=LT;function IT(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function PT(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[IT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Qi({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&3?Tn(n,[n[0],u&2&&Yi(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function zT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=Mt(Mt({},e),or(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=or(e),[o,e,n,i]}class DT extends Tt{constructor(e){super(),Ct(this,e,zT,PT,wt,{})}}const RT=DT;function BT(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[5],null);return{c(){e=j("h2"),e.textContent="Help",t=ne(),o&&o.c()},m(u,s){W(u,e,s),W(u,t,s),o&&o.m(u,s),n=!0},p(u,s){o&&o.p&&(!n||s&32)&&wn(o,i,u,u[5],n?bn(i,u[5],s,null):xn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&(G(e),G(t)),o&&o.d(u)}}}function FT(r){let e,t,n,i,o,u,s,d;t=new kC({props:{color:r[0]}});function p(y){r[4](y)}let g={$$slots:{default:[BT]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new Rg({props:g}),_n.push(()=>Rn(i,"show",p)),{c(){e=j("button"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),ue(e,"class","icon-btn help svelte-14uxddv"),ue(e,"title","Help")},m(y,x){W(y,e,x),oe(t,e,null),W(y,n,x),oe(i,y,x),u=!0,s||(d=St(e,"click",Mf(r[3])),s=!0)},p(y,[x]){const C={};x&1&&(C.color=y[0]),t.$set(C);const T={};x&32&&(T.$$scope={dirty:x,ctx:y}),!o&&x&2&&(o=!0,T.show=y[1],Dn(()=>o=!1)),i.$set(T)},i(y){u||(N(t.$$.fragment,y),N(i.$$.fragment,y),u=!0)},o(y){V(t.$$.fragment,y),V(i.$$.fragment,y),u=!1},d(y){y&&(G(e),G(n)),se(t),se(i,y),s=!1,d()}}}function OT(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const s=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,s,d,i]}class Bl extends Tt{constructor(e){super(),Ct(this,e,OT,FT,wt,{color:0})}}function $T(r){let e,t,n,i;const o=r[1].default,u=vn(o,r,r[0],null);return{c(){e=j("a"),u&&u.c(),ue(e,"href","#")},m(s,d){W(s,e,d),u&&u.m(e,null),t=!0,n||(i=St(e,"click",Pg(r[2])),n=!0)},p(s,[d]){u&&u.p&&(!t||d&1)&&wn(u,o,s,s[0],t?bn(o,s[0],d,null):xn(s[0]),null)},i(s){t||(N(u,s),t=!0)},o(s){V(u,s),t=!1},d(s){s&&G(e),u&&u.d(s),n=!1,i()}}}function NT(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Sn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class pp extends Tt{constructor(e){super(),Ct(this,e,NT,$T,wt,{})}}function Jy(r){let e,t,n,i,o=r[1]!=null&&Yy(r);return{c(){e=j("div"),t=j("div"),n=Te(r[0]),i=ne(),o&&o.c(),ue(t,"class","background svelte-s4mabc"),ue(e,"class","cover svelte-s4mabc")},m(u,s){W(u,e,s),D(e,t),D(t,n),D(t,i),o&&o.m(t,null)},p(u,s){s&1&&xt(n,u[0]),u[1]!=null?o?o.p(u,s):(o=Yy(u),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(u){u&&G(e),o&&o.d()}}}function Yy(r){let e;function t(o,u){return o[1]==100?UT:jT}let n=t(r),i=n(r);return{c(){e=j("div"),i.c()},m(o,u){W(o,e,u),i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&G(e),i.d()}}}function jT(r){let e;return{c(){e=j("progress"),e.value=r[1],ue(e,"max","100"),Xe(e,"width","100%")},m(t,n){W(t,e,n)},p(t,n){n&2&&(e.value=t[1])},d(t){t&&G(e)}}}function UT(r){let e;return{c(){e=j("progress"),Xe(e,"width","100%")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function VT(r){let e,t=r[0]&&Jy(r);return{c(){t&&t.c(),e=rr()},m(n,i){t&&t.m(n,i),W(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=Jy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:lt,o:lt,d(n){n&&G(e),t&&t.d(n)}}}function qT(r,e,t){let{loading:n}=e,{progress:i=null}=e,o,u;return r.$$set=s=>{"loading"in s&&t(0,n=s.loading),"progress"in s&&t(1,i=s.progress)},r.$$.update=()=>{if(r.$$.dirty&13){if(n&&!o)t(2,o=Date.now()),t(3,u=n);else if(!n&&o){const s=Date.now()-o;console.log(`Loading "${u}" took ${s}ms`),t(2,o=void 0)}}},[n,i,o,u]}class oc extends Tt{constructor(e){super(),Ct(this,e,qT,VT,wt,{loading:0,progress:1})}}function vr(r){var e;switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return((e=hi(aM))==null?void 0:e.project_name)||"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return hi(Ia)||"Editing";case"view-shortcuts":return"Shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function HT(r){let e,t=vr(r[0].mode)+"",n;return{c(){e=j("span"),n=Te(t),ue(e,"class","page-title svelte-1o8s136")},m(i,o){W(i,e,o),D(e,n)},p(i,o){o&1&&t!==(t=vr(i[0].mode)+"")&&xt(n,t)},d(i){i&&G(e)}}}function GT(r){let e;const t=r[2].default,n=vn(t,r,r[4],null),i=n||HT(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&16)&&wn(n,t,o,o[4],e?bn(t,o[4],u,null):xn(o[4]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){V(i,o),e=!1},d(o){i&&i.d(o)}}}function WT(r){let e,t;return e=new pp({props:{$$slots:{default:[GT]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&17&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ZT(r,e,t){let n;st(r,Qn,d=>t(1,n=d));let{$$slots:i={},$$scope:o}=e,{mode:u}=e;const s=()=>an(Qn,n=u,n);return r.$$set=d=>{"mode"in d&&t(0,u=d.mode),"$$scope"in d&&t(4,o=d.$$scope)},[u,n,i,s,o]}class $n extends Tt{constructor(e){super(),Ct(this,e,ZT,WT,wt,{mode:0})}}function XT(r){let e,t,n,i,o,u=r[0]+1+"",s,d,p=r[1].length+"",g,y,x,C,T,E,z;return{c(){e=j("div"),t=j("button"),n=Te("Previous"),o=ne(),s=Te(u),d=Te(" / "),g=Te(p),y=ne(),x=j("button"),C=Te("Next"),t.disabled=i=r[0]==0,ue(t,"data-tippy-content","Left"),x.disabled=T=r[0]==r[1].length-1,ue(x,"data-tippy-content","Right"),Xe(e,"display","flex"),Xe(e,"justify-content","space-between"),Xe(e,"align-items","center")},m(I,L){W(I,e,L),D(e,t),D(t,n),D(e,o),D(e,s),D(e,d),D(e,g),D(e,y),D(e,x),D(x,C),E||(z=[St(window,"keydown",r[2]),St(t,"click",r[3]),St(x,"click",r[4])],E=!0)},p(I,[L]){L&1&&i!==(i=I[0]==0)&&(t.disabled=i),L&1&&u!==(u=I[0]+1+"")&&xt(s,u),L&2&&p!==(p=I[1].length+"")&&xt(g,p),L&3&&T!==(T=I[0]==I[1].length-1)&&(x.disabled=T)},i:lt,o:lt,d(I){I&&G(e),E=!1,sr(z)}}}function KT(r,e,t){let n;st(r,as,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;ls(()=>{n==null||n.keyboard.disable(),c_()}),ei(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),s()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function s(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,s,d]}class mp extends Tt{constructor(e){super(),Ct(this,e,KT,XT,wt,{list:1,idx:0})}}function JT(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:YT}=iw;function QT(r){let e,t;return e=new qC({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function eM(r){let e,t;return e=new $C({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function Qy(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L;return z=zg(r[9][0]),{c(){e=j("div"),t=Te(`Click the map to see street view
      `),n=j("br"),i=ne(),o=j("br"),u=ne(),s=j("b"),s.textContent="Street view source",d=ne(),p=j("label"),g=j("input"),y=Te(`
        Google Street View`),x=ne(),C=j("label"),T=j("input"),E=Te(`
        Bing Streetside`),ue(g,"type","radio"),g.__value="google",Nn(g,g.__value),ue(g,"class","svelte-1kgc7zz"),ue(p,"class","svelte-1kgc7zz"),ue(T,"type","radio"),T.__value="bing",Nn(T,T.__value),ue(T,"class","svelte-1kgc7zz"),ue(C,"class","svelte-1kgc7zz"),ue(e,"class","street-view-control-source svelte-1kgc7zz"),Gt(e,"expanded",r[0]),z.p(g,T)},m(B,O){W(B,e,O),D(e,t),D(e,n),D(e,i),D(e,o),D(e,u),D(e,s),D(e,d),D(e,p),D(p,g),g.checked=g.__value===r[1],D(p,y),D(e,x),D(e,C),D(C,T),T.checked=T.__value===r[1],D(C,E),I||(L=[St(g,"change",r[8]),St(T,"change",r[10])],I=!0)},p(B,O){O&2&&(g.checked=g.__value===B[1]),O&2&&(T.checked=T.__value===B[1]),O&1&&Gt(e,"expanded",B[0])},d(B){B&&G(e),z.r(),I=!1,sr(L)}}}function tM(r){let e,t,n,i,o,u,s,d,p;const g=[eM,QT],y=[];function x(T,E){return T[0]?0:1}n=x(r),i=y[n]=g[n](r);let C=r[0]&&Qy(r);return{c(){e=j("button"),t=j("div"),i.c(),o=ne(),C&&C.c(),u=rr(),ue(t,"class","ltn-map-btn"),ue(e,"title","Street view")},m(T,E){W(T,e,E),D(e,t),y[n].m(t,null),W(T,o,E),C&&C.m(T,E),W(T,u,E),s=!0,d||(p=St(e,"click",r[7]),d=!0)},p(T,E){let z=n;n=x(T),n!==z&&(Xt(),V(y[z],1,1,()=>{y[z]=null}),Kt(),i=y[n],i||(i=y[n]=g[n](T),i.c()),N(i,1),i.m(t,null)),T[0]?C?C.p(T,E):(C=Qy(T),C.c(),C.m(u.parentNode,u)):C&&(C.d(1),C=null)},i(T){s||(N(i),s=!0)},o(T){V(i),s=!1},d(T){T&&(G(e),G(o),G(u)),y[n].d(),C&&C.d(T),d=!1,p()}}}function nM(r){let e,t,n,i;return e=new e2({props:{$$slots:{default:[tM]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0,n||(i=St(YT,"keydown",r[4]),n=!0)},p(o,[u]){const s={};u&16387&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o),n=!1,i()}}}function rM(r,e,t){let n;st(r,Fd,I=>t(12,n=I));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,s="google",d=[];function p(){an(Fd,n=!1,n),i.on("click",y),i.getCanvas().style.cursor="crosshair";for(let I of JT(i,o))d.push([I,i.getPaintProperty(I,"line-color")]),i.setPaintProperty(I,"line-color","cyan")}function g(){an(Fd,n=!0,n),i.off("click",y),i.getCanvas().style.cursor="inherit";for(let[I,L]of d)i.setPaintProperty(I,"line-color",L);d=[]}ei(g);function y(I){let L=I.lngLat.lng,B=I.lngLat.lat;s=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${L}&cbp=11,0,0,0,0`,"_blank"):s=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${L}&style=x`,"_blank")}function x(I){!n&&I.key=="Escape"&&(I.stopPropagation(),g())}const C=[[]],T=()=>{t(0,u=!u),u?p():g()};function E(){s=this.__value,t(1,s)}function z(){s=this.__value,t(1,s)}return r.$$set=I=>{"map"in I&&t(5,i=I.map),"maptilerBasemap"in I&&t(6,o=I.maptilerBasemap)},[u,s,p,g,x,i,o,T,E,C,z]}class iM extends Tt{constructor(e){super(),Ct(this,e,rM,nM,wt,{map:5,maptilerBasemap:6})}}function yn(r,e=!0){return{id:r,beforeId:oM(r),eventsIfTopMost:e}}function oM(r){let e=hi(as);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=e1.length-1;i>=0;i--){let o=e1[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Fm=r=>r,Om=r=>r;const e1=[Fm(Om("Background")),"neighbourhood-boundaries",Fm("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Om("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19-heatmap","context-stats19-points",Om("Road labels"),Fm("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let A2=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],k2=[20,30,40,50,60,70],Fl=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],ah=Fl,lh=[0,20,40,60,80,100],sc=Fl.toReversed(),Od=Fl.toReversed(),i_=[0,.25,.5,1,1.5,2],o_=["#F8E4AF","#9ECC4E","#00BB44","#4ACD8B","#B9E9E9"],s_=Fl.toReversed(),a_=Fl.toReversed(),uh=[0,20,40,60,80,100],ch=Fl,l_=[1,2,3,4,5],u_=Fl.toReversed();function S2(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const sM="#0C793A",vo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function c_(){rh("[data-tippy-content]")}function na(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Fa(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Oa(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function ac(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function Yd(r){if(!r)return"custom area";let e=hi(xo);return e=="cnt"||e=="england"?Qd(r,"LAD_"):r}function C2(r){let e=hi(Ha).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;lp(n,JSON.stringify(e))}function rg(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function ig(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function t1(r){return r.reduce((e,t)=>e+t,0)}function Qd(r,e){return r.startsWith(e)?r.slice(e.length):r}function n1(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}async function gp(){await new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(r)})})}const T2="MZEJTanw3WpxRvt7qDfo";let as=Cn(null),xo=Cn("global"),Os=Cn(void 0),aM=zw(Os,r=>{if(r)return hi(Ha).project(r)}),Ia=Cn(void 0),M2=new eS,Ha=zw(xo,r=>M2.projectStorage(r)),r1=Cn(!0),ep=Cn(!1),kr=Cn(null),fc=Cn({population_density:[0,1,2,3,4,5],collision_density:[0,1,2,3,4,5],poi_density:[0,1,2,3,4,5]}),Bf=Cn(new sa.LngLat(0,0)),Ff=Cn(new sa.LngLat(0,0)),kd=Cn(new sa.LngLat(0,0)),i1=Cn(1),Di=Cn(1),Qn=Cn({mode:"title",firstLoad:!0}),Of=Cn(!1),og=Cn("streets-v2"),sg=Cn("walk_cycle_only"),o1=Cn(!1),ag=Cn(!0),tp=Cn(!0),np=Cn("shortcuts"),lg=Cn(!1),ug=Cn(!0),s1=Cn(500);function Hf(){const r=hi(Os);try{hi(Ha).saveProject(r,hi(kr).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let cg=Cn(!1);function ys(r){return hi(cg)?`/${r}`:r.startsWith("cnt/")?`https://assets.cnt.scot/prod/${Qd(r,"cnt/")}`:r.startsWith("england/")?`https://assets.od2net.org/ltn/prod/${r}`:`https://assets.od2net.org/${r}`}function fg(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const s=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*s;return new sa.LngLat(u,d)}const t=(n=hi(as))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(hi(r))||r.set(e(t))}function lM(r){let e;return{c(){e=j("h1"),e.textContent="The Low-Traffic Neighbourhood (LTN) tool, v2"},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function uM(r){let e;return{c(){e=j("h1"),e.textContent="The Connected Neighbourhoods Tool"},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function cM(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T;function E(L,B){return L[1]=="cnt"?uM:lM}let z=E(r),I=z(r);return{c(){I.c(),e=ne(),t=j("p"),t.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,n=ne(),i=j("ul"),i.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,o=ne(),u=j("p"),u.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the tool’s development, particular thanks to:`,s=ne(),d=j("ul"),d.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li> <li><a href="https://github.com/TFCx" target="_blank">Jean-David Génevaux</a></li>',p=ne(),g=j("p"),g.textContent="This tool would not be possible without:",y=ne(),x=j("ul"),x.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',C=ne(),T=j("p"),T.textContent="Some road signs images © Crown copyright."},m(L,B){I.m(L,B),W(L,e,B),W(L,t,B),W(L,n,B),W(L,i,B),W(L,o,B),W(L,u,B),W(L,s,B),W(L,d,B),W(L,p,B),W(L,g,B),W(L,y,B),W(L,x,B),W(L,C,B),W(L,T,B)},p(L,B){z!==(z=E(L))&&(I.d(1),I=z(L),I&&(I.c(),I.m(e.parentNode,e)))},d(L){L&&(G(e),G(t),G(n),G(i),G(o),G(u),G(s),G(d),G(p),G(g),G(y),G(x),G(C),G(T)),I.d(L)}}}function fM(r){let e,t,n;function i(u){r[2](u)}let o={$$slots:{default:[cM]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Rg({props:o}),_n.push(()=>Rn(e,"show",i)),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&10&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function hM(r,e,t){let n,i;st(r,ep,u=>t(0,n=u)),st(r,xo,u=>t(1,i=u));function o(u){n=u,ep.set(n)}return[n,i,o]}class dM extends Tt{constructor(e){super(),Ct(this,e,hM,fM,wt,{})}}function pM(r){let e;return{c(){e=j("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function mM(r){let e,t;const n=[yn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":na(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s=u&1?Tn(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function gM(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Bus routes",$$slots:{help:[pM]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new rs({props:s}),_n.push(()=>Rn(e,"show",u)),i=new sh({props:{url:`pmtiles://${ys("cnt/layers/bus_routes.pmtiles")}`,$$slots:{default:[mM]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment)},m(d,p){oe(e,d,p),W(d,n,p),oe(i,d,p),o=!0},p(d,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Dn(()=>t=!1)),e.$set(g);const y={};p&5&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),se(e,d),se(i,d)}}}function _M(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class yM extends Tt{constructor(e){super(),Ct(this,e,_M,gM,wt,{})}}var vM=Object.defineProperty,E2=r=>{throw TypeError(r)},bM=(r,e,t)=>e in r?vM(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Do=(r,e,t)=>bM(r,typeof e!="symbol"?e+"":e,t),L2=(r,e,t)=>e.has(r)||E2("Cannot "+t),yi=(r,e,t)=>(L2(r,e,"read from private field"),t?t.call(r):e.get(r)),a1=(r,e,t)=>e.has(r)?E2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),l1=(r,e,t,n)=>(L2(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function $r(){}function wM(r,e){for(const t in e)r[t]=e[t];return r}function I2(r){return r()}function u1(){return Object.create(null)}function fa(r){r.forEach(I2)}function P2(r){return typeof r=="function"}function Ga(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Sd;function Ji(r,e){return r===e?!0:(Sd||(Sd=document.createElement("a")),Sd.href=e,r===Sd.href)}function xM(r){return Object.keys(r).length===0}function AM(r,e,t,n){if(r){const i=z2(r,e,t,n);return r[0](i)}}function z2(r,e,t,n){return r[1]&&n?wM(t.ctx.slice(),r[1](n(e))):t.ctx}function kM(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function SM(r,e,t,n,i,o){if(i){const u=z2(e,t,n,o);r.p(u,i)}}function CM(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function c1(r){return r??""}function ir(r,e){r.appendChild(e)}function Ur(r,e,t){r.insertBefore(e,t||null)}function Nr(r){r.parentNode&&r.parentNode.removeChild(r)}function Ar(r){return document.createElement(r)}function ws(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function $a(r){return document.createTextNode(r)}function Fo(){return $a(" ")}function TM(){return $a("")}function co(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function MM(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Lt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function EM(r){return Array.from(r.childNodes)}function Gf(r,e){e=""+e,r.data!==e&&(r.data=e)}function f1(r,e){r.value=e??""}function ts(r,e,t){r.classList.toggle(e,!!t)}function LM(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Wf;function $f(r){Wf=r}function D2(){if(!Wf)throw new Error("Function called outside component initialization");return Wf}function IM(r){D2().$$.on_destroy.push(r)}function PM(){const r=D2();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=LM(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function h1(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Hu=[],hg=[];let Ku=[];const d1=[],zM=Promise.resolve();let dg=!1;function DM(){dg||(dg=!0,zM.then(R2))}function pg(r){Ku.push(r)}const $m=new Set;let Nu=0;function R2(){if(Nu!==0)return;const r=Wf;do{try{for(;Nu<Hu.length;){const e=Hu[Nu];Nu++,$f(e),RM(e.$$)}}catch(e){throw Hu.length=0,Nu=0,e}for($f(null),Hu.length=0,Nu=0;hg.length;)hg.pop()();for(let e=0;e<Ku.length;e+=1){const t=Ku[e];$m.has(t)||($m.add(t),t())}Ku.length=0}while(Hu.length);for(;d1.length;)d1.pop()();dg=!1,$m.clear(),$f(r)}function RM(r){if(r.fragment!==null){r.update(),fa(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(pg)}}function BM(r){const e=[],t=[];Ku.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ku=e}const $d=new Set;let Ml;function Nd(){Ml={r:0,c:[],p:Ml}}function jd(){Ml.r||fa(Ml.c),Ml=Ml.p}function fi(r,e){r&&r.i&&($d.delete(r),r.i(e))}function Si(r,e,t,n){if(r&&r.o){if($d.has(r))return;$d.add(r),Ml.c.push(()=>{$d.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function p1(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function FM(r,e){Si(r,1,1,()=>{e.delete(r.key)})}function OM(r,e,t,n,i,o,u,s,d,p,g,y){let x=r.length,C=o.length,T=x;const E={};for(;T--;)E[r[T].key]=T;const z=[],I=new Map,L=new Map,B=[];for(T=C;T--;){const H=y(i,o,T),Z=t(H);let _e=u.get(Z);_e?B.push(()=>_e.p(H,e)):(_e=p(Z,H),_e.c()),I.set(Z,z[T]=_e),Z in E&&L.set(Z,Math.abs(T-E[Z]))}const O=new Set,Y=new Set;function q(H){fi(H,1),H.m(s,g),u.set(H.key,H),g=H.first,C--}for(;x&&C;){const H=z[C-1],Z=r[x-1],_e=H.key,Ie=Z.key;H===Z?(g=H.first,x--,C--):I.has(Ie)?!u.has(_e)||O.has(_e)?q(H):Y.has(Ie)?x--:L.get(_e)>L.get(Ie)?(Y.add(_e),q(H)):(O.add(Ie),x--):(d(Z,u),x--)}for(;x--;){const H=r[x];I.has(H.key)||d(H,u)}for(;C;)q(z[C-1]);return fa(B),z}function Na(r){r&&r.c()}function la(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),pg(()=>{const o=r.$$.on_mount.map(I2).filter(P2);r.$$.on_destroy?r.$$.on_destroy.push(...o):fa(o),r.$$.on_mount=[]}),i.forEach(pg)}function ua(r,e){const t=r.$$;t.fragment!==null&&(BM(t.after_update),fa(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function $M(r,e){r.$$.dirty[0]===-1&&(Hu.push(r),DM(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Wa(r,e,t,n,i,o,u=null,s=[-1]){const d=Wf;$f(r);const p=r.$$={fragment:null,ctx:[],props:o,update:$r,not_equal:i,bound:u1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:u1(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(y,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[y],p.ctx[y]=T)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](T),g&&$M(r,y)),x}):[],p.update(),g=!0,fa(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=EM(e.target);p.fragment&&p.fragment.l(y),y.forEach(Nr)}else p.fragment&&p.fragment.c();e.intro&&fi(r.$$.fragment),la(r,e.target,e.anchor),R2()}$f(d)}class Za{constructor(){Do(this,"$$"),Do(this,"$$set")}$destroy(){ua(this,1),this.$destroy=$r}$on(e,t){if(!P2(t))return $r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!xM(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const NM="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(NM);function jM(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),Lt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Lt(e,"viewBox","0 0 14 14"),Lt(e,"width","13"),Lt(e,"height","13"),Lt(e,"class","svelte-en2qvf")},m(n,i){Ur(n,e,i),ir(e,t)},p:$r,i:$r,o:$r,d(n){n&&Nr(e)}}}class B2 extends Za{constructor(e){super(),Wa(this,e,null,jM,Ga,{})}}function UM(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),Lt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Lt(e,"viewBox","0 0 30 30"),Lt(e,"fill","none"),Lt(e,"xmlns","http://www.w3.org/2000/svg"),Lt(e,"class","svelte-d2loi5")},m(n,i){Ur(n,e,i),ir(e,t)},p:$r,i:$r,o:$r,d(n){n&&Nr(e)}}}class F2 extends Za{constructor(e){super(),Wa(this,e,null,UM,Ga,{})}}function VM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"area.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"area.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function qM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"reverse.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"reverse.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function HM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"poi.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"poi.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function GM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"postal_code.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"postal_code.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function WM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"street.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"street.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function ZM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"road.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"road.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function XM(r){let e,t;return{c(){e=Ar("img"),Ji(e.src,t=r[3]+"housenumber.svg")||Lt(e,"src",t),Lt(e,"alt",r[6]),Lt(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ji(e.src,t=n[3]+"housenumber.svg")&&Lt(e,"src",t),i&64&&Lt(e,"alt",n[6])},d(n){n&&Nr(e)}}}function KM(r){let e,t,n,i;return{c(){e=Ar("img"),Ji(e.src,t=r[5])||Lt(e,"src",t),Lt(e,"alt",r[4]),Lt(e,"class","svelte-ltkwvy")},m(o,u){Ur(o,e,u),n||(i=co(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Ji(e.src,t=o[5])&&Lt(e,"src",t),u&16&&Lt(e,"alt",o[4])},d(o){o&&Nr(e),n=!1,i()}}}function m1(r){let e,t;return{c(){e=Ar("span"),t=$a(r[6]),Lt(e,"class","secondary svelte-ltkwvy")},m(n,i){Ur(n,e,i),ir(e,t)},p(n,i){i&64&&Gf(t,n[6])},d(n){n&&Nr(e)}}}function JM(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,E,z=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",I,L,B;function O(Z,_e){return _e&1&&(t=null),_e&1&&(n=null),_e&1&&(i=null),_e&1&&(o=null),Z[5]?KM:Z[0].address?XM:(t==null&&(t=!!Z[0].id.startsWith("road.")),t?ZM:(n==null&&(n=!!Z[0].id.startsWith("address.")),n?WM:(i==null&&(i=!!Z[0].id.startsWith("postal_code.")),i?GM:(o==null&&(o=!!Z[0].id.startsWith("poi.")),o?HM:Z[7]?qM:VM))))}let Y=O(r,-1),q=Y(r),H=C&&m1(r);return{c(){e=Ar("li"),q.c(),u=Fo(),s=Ar("span"),d=Ar("span"),p=Ar("span"),y=$a(g),x=Fo(),H&&H.c(),T=Fo(),E=Ar("span"),I=$a(z),Lt(p,"class","primary svelte-ltkwvy"),Lt(d,"class","svelte-ltkwvy"),Lt(E,"class","line2 svelte-ltkwvy"),Lt(s,"class","texts svelte-ltkwvy"),Lt(e,"tabindex","0"),Lt(e,"data-selected",r[1]),Lt(e,"class","svelte-ltkwvy"),ts(e,"selected",r[1])},m(Z,_e){Ur(Z,e,_e),q.m(e,null),ir(e,u),ir(e,s),ir(s,d),ir(d,p),ir(p,y),ir(d,x),H&&H.m(d,null),ir(s,T),ir(s,E),ir(E,I),L||(B=[co(e,"mouseenter",r[12]),co(e,"focus",r[13])],L=!0)},p(Z,[_e]){Y===(Y=O(Z,_e))&&q?q.p(Z,_e):(q.d(1),q=Y(Z),q&&(q.c(),q.m(e,u))),_e&1&&g!==(g=(Z[7]?Z[0].place_name:Z[0].place_name.replace(/,.*/,""))+"")&&Gf(y,g),_e&37&&(C=Z[2]==="always"||Z[2]!=="never"&&!Z[0].address&&!Z[0].id.startsWith("road.")&&!Z[0].id.startsWith("address.")&&!Z[0].id.startsWith("postal_code.")&&(!Z[0].id.startsWith("poi.")||!Z[5])&&!Z[7]),C?H?H.p(Z,_e):(H=m1(Z),H.c(),H.m(d,null)):H&&(H.d(1),H=null),_e&1&&z!==(z=(Z[7]?"":Z[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Gf(I,z),_e&2&&Lt(e,"data-selected",Z[1]),_e&2&&ts(e,"selected",Z[1])},i:$r,o:$r,d(Z){Z&&Nr(e),q.d(),H&&H.d(),L=!1,fa(B)}}}function YM(r,e,t){var n;let i,o,{feature:u}=e,{selected:s=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const y=(n=u.properties)==null?void 0:n.categories;let x,C,T=0,E=u.place_type[0]==="reverse";function z(){C&&p.add(C),t(10,T++,T)}function I(O){h1.call(this,r,O)}function L(O){h1.call(this,r,O)}const B=()=>z();return r.$$set=O=>{"feature"in O&&t(0,u=O.feature),"selected"in O&&t(1,s=O.selected),"showPlaceType"in O&&t(2,d=O.showPlaceType),"missingIconsCache"in O&&t(9,p=O.missingIconsCache),"iconsBaseUrl"in O&&t(3,g=O.iconsBaseUrl)},r.$$.update=()=>{var O,Y,q,H;if(r.$$.dirty&3640)do t(11,i--,i),t(4,x=y==null?void 0:y[i]),t(5,C=x?g+x.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||p.has(C)));r.$$.dirty&1&&t(6,o=((Y=(O=u.properties)==null?void 0:O.categories)==null?void 0:Y.join(", "))??((H=(q=u.properties)==null?void 0:q.place_type_name)==null?void 0:H[0])??u.place_type[0])},t(11,i=(y==null?void 0:y.length)??0),[u,s,d,g,x,C,o,E,z,p,T,i,I,L,B]}class QM extends Za{constructor(e){super(),Wa(this,e,YM,JM,Ga,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function eE(r){let e;return{c(){e=Ar("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Lt(e,"class","svelte-7cmwmc")},m(t,n){Ur(t,e,n)},p:$r,i:$r,o:$r,d(t){t&&Nr(e)}}}class tE extends Za{constructor(e){super(),Wa(this,e,null,eE,Ga,{})}}function nE(r){let e,t,n;return{c(){e=ws("svg"),t=ws("path"),Lt(t,"stroke-width","4"),Lt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Lt(t,"class","svelte-gzo3ar"),Lt(e,"width",n=r[0]==="list"?20:void 0),Lt(e,"viewBox","0 0 70 85"),Lt(e,"fill","none"),Lt(e,"class","svelte-gzo3ar"),ts(e,"in-map",r[0]!=="list"),ts(e,"list-icon",r[0]==="list")},m(i,o){Ur(i,e,o),ir(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&Lt(e,"width",n),o&1&&ts(e,"in-map",i[0]!=="list"),o&1&&ts(e,"list-icon",i[0]==="list")},i:$r,o:$r,d(i){i&&Nr(e)}}}function rE(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class iE extends Za{constructor(e){super(),Wa(this,e,rE,nE,Ga,{displayIn:0})}}function oE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),Lt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Lt(e,"viewBox","0 0 60.006 21.412"),Lt(e,"width","14"),Lt(e,"height","20"),Lt(e,"class","svelte-en2qvf")},m(n,i){Ur(n,e,i),ir(e,t)},p:$r,i:$r,o:$r,d(n){n&&Nr(e)}}}class sE extends Za{constructor(e){super(),Wa(this,e,null,oE,Ga,{})}}function aE(r){let e,t,n;return{c(){e=ws("svg"),t=ws("circle"),n=ws("path"),Lt(t,"cx","4.789"),Lt(t,"cy","4.787"),Lt(t,"r","3.85"),Lt(t,"class","svelte-1aq105l"),Lt(n,"d","M12.063 12.063 7.635 7.635"),Lt(n,"class","svelte-1aq105l"),Lt(e,"xmlns","http://www.w3.org/2000/svg"),Lt(e,"width","13"),Lt(e,"height","13"),Lt(e,"viewBox","0 0 13 13"),Lt(e,"class","svelte-1aq105l")},m(i,o){Ur(i,e,o),ir(e,t),ir(e,n)},p:$r,i:$r,o:$r,d(i){i&&Nr(e)}}}class lE extends Za{constructor(e){super(),Wa(this,e,null,aE,Ga,{})}}function uE(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function rp(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let _f;async function cE(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(_f&&i.cachedLocationExpiry&&_f.time+i.cachedLocationExpiry>Date.now()){if(!_f.coords)break e;return _f.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(_f={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const fE=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,g1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,_1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,y1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,v1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,b1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function hE(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i}° ${u}, ${o}° ${s}`);const p=Math.floor(i),g=Math.floor(o),y=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=w1(y,3).toFixed(3).padStart(6,"0"),T=w1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),d=`${p}° ${C}' ${u}, ${g}° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(y),T=Math.floor(x);let E=((y-C)*60).toFixed(1).padStart(4,"0"),z=((x-T)*60).toFixed(1).padStart(4,"0");const I=C.toString().padStart(2,"0"),L=T.toString().padStart(2,"0");E.endsWith(".0")&&z.endsWith(".0")&&(E=E.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),d=`${p}° ${I}' ${E}" ${u}, ${g}° ${L}' ${z}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function w1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function f_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(fE.test(r))throw new Error("invalid coordinate value");if(g1.test(r))if(s=g1.exec(r),d=yf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(_1.test(r))if(s=_1.exec(r),d=yf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(y1.test(r))if(s=y1.exec(r),d=yf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(v1.test(r))if(s=v1.exec(r),d=yf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(b1.test(r)){if(s=b1.exec(r),d=yf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let y,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const I=Math.floor(r.length/2);y=g.substring(0,I).trim(),x=g.substring(I).trim()}else{let I;T.length%2==1?I=Math.floor(T.length/2):I=T.length/2-1;let L=0;if(I==0)L=g.indexOf(T[0]),y=g.substring(0,L).trim(),x=g.substring(L+1).trim();else{let B=0,O=0;for(;B<=I;)L=g.indexOf(T[B],O),O=L+1,B++;y=g.substring(0,L).trim(),x=g.substring(L+1).trim()}}const E=y.split(".");if(E.length==2&&E[1]==0&&E[1].length!=2)throw new Error("invalid coordinates format");const z=x.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:y,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:dE,toCoordinateFormat:hE})}else throw new Error("coordinates pattern match failed")}function yf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function x1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function dE(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return x1(this.decimalLatitude,Number(e[0]))&&x1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const pE=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});f_.to=pE;const mE=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],gE={decimalLatitude:40.123,decimalLongitude:-74.123},_E=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],yE=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function vE(){const r=[];return mE.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...gE})}),[...r,..._E,...yE]}const bE=vE();f_.formats=bE.map(r=>r.verbatimCoordinates);const wE=f_;function A1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function k1(r){let e,t;return e=new tE({}),{c(){Na(e.$$.fragment)},m(n,i){la(e,n,i),t=!0},i(n){t||(fi(e.$$.fragment,n),t=!0)},o(n){Si(e.$$.fragment,n),t=!1},d(n){ua(e,n)}}}function S1(r){let e,t,n,i,o;return t=new sE({}),{c(){e=Ar("button"),Na(t.$$.fragment),Lt(e,"type","button"),Lt(e,"title",r[9]),Lt(e,"class","svelte-bz0zu3"),ts(e,"active",r[0])},m(u,s){Ur(u,e,s),la(t,e,null),n=!0,i||(o=co(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&Lt(e,"title",u[9]),(!n||s[0]&1)&&ts(e,"active",u[0])},i(u){n||(fi(t.$$.fragment,u),n=!0)},o(u){Si(t.$$.fragment,u),n=!1},d(u){u&&Nr(e),ua(t),i=!1,o()}}}function xE(r){let e,t=[],n=new Map,i,o,u,s=p1(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=A1(r,s,p),y=d(g);n.set(y,t[p]=C1(y,g))}return{c(){e=Ar("ul");for(let p=0;p<t.length;p+=1)t[p].c();Lt(e,"class","options svelte-bz0zu3")},m(p,g){Ur(p,e,g);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(u=[co(e,"mouseleave",r[73]),co(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=p1(p[14]),Nd(),t=OM(t,g,d,1,p,s,n,e,FM,C1,null,A1),jd())},i(p){if(!i){for(let g=0;g<s.length;g+=1)fi(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Si(t[g]);i=!1},d(p){p&&Nr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,fa(u)}}}function AE(r){let e,t,n,i,o,u;return t=new F2({}),{c(){e=Ar("div"),Na(t.$$.fragment),n=Fo(),i=Ar("div"),o=$a(r[7]),Lt(i,"class","svelte-bz0zu3"),Lt(e,"class","no-results svelte-bz0zu3")},m(s,d){Ur(s,e,d),la(t,e,null),ir(e,n),ir(e,i),ir(i,o),u=!0},p(s,d){(!u||d[0]&128)&&Gf(o,s[7])},i(s){u||(fi(t.$$.fragment,s),u=!0)},o(s){Si(t.$$.fragment,s),u=!1},d(s){s&&Nr(e),ua(t)}}}function kE(r){let e="",t;return{c(){t=$a(e)},m(n,i){Ur(n,t,i)},p:$r,i:$r,o:$r,d(n){n&&Nr(t)}}}function SE(r){let e,t,n,i,o,u,s,d,p,g,y;return t=new F2({}),d=new B2({}),{c(){e=Ar("div"),Na(t.$$.fragment),n=Fo(),i=Ar("div"),o=$a(r[6]),u=Fo(),s=Ar("button"),Na(d.$$.fragment),Lt(i,"class","svelte-bz0zu3"),Lt(s,"class","svelte-bz0zu3"),Lt(e,"class","error svelte-bz0zu3")},m(x,C){Ur(x,e,C),la(t,e,null),ir(e,n),ir(e,i),ir(i,o),ir(e,u),ir(e,s),la(d,s,null),p=!0,g||(y=co(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&Gf(o,x[6])},i(x){p||(fi(t.$$.fragment,x),fi(d.$$.fragment,x),p=!0)},o(x){Si(t.$$.fragment,x),Si(d.$$.fragment,x),p=!1},d(x){x&&Nr(e),ua(t),ua(d),g=!1,y()}}}function C1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new QM({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=TM(),Na(n.$$.fragment),this.first=t},m(s,d){Ur(s,t,d),la(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(fi(n.$$.fragment,s),i=!0)},o(s){Si(n.$$.fragment,s),i=!1},d(s){s&&Nr(t),ua(n,s)}}}function CE(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q=!1;o=new lE({}),y=new B2({});let H=r[19]&&k1(),Z=r[5]==="button"&&S1(r);const _e=r[61].default,Ie=AM(_e,r,r[60],null),J=[SE,kE,AE,xE],fe=[];function Ee(ye,Oe){var Ue,De;return ye[18]?0:ye[16]?((Ue=ye[14])==null?void 0:Ue.length)===0?2:ye[16]&&(De=ye[14])!=null&&De.length?3:-1:1}return~(z=Ee(r))&&(I=fe[z]=J[z](r)),{c(){e=Fo(),t=Ar("form"),n=Ar("div"),i=Ar("button"),Na(o.$$.fragment),u=Fo(),s=Ar("input"),d=Fo(),p=Ar("div"),g=Ar("button"),Na(y.$$.fragment),x=Fo(),H&&H.c(),C=Fo(),Z&&Z.c(),T=Fo(),Ie&&Ie.c(),E=Fo(),I&&I.c(),Lt(i,"class","search-button svelte-bz0zu3"),Lt(i,"type","button"),Lt(s,"placeholder",r[8]),Lt(s,"aria-label",r[8]),Lt(s,"class","svelte-bz0zu3"),Lt(g,"type","button"),Lt(g,"title",r[3]),Lt(g,"class","svelte-bz0zu3"),Lt(p,"class","clear-button-container svelte-bz0zu3"),ts(p,"displayable",r[1]!==""),Lt(n,"class","input-group svelte-bz0zu3"),Lt(t,"tabindex","0"),Lt(t,"class",L=c1(r[2])+" svelte-bz0zu3"),ts(t,"can-collapse",r[4]&&r[1]==="")},m(ye,Oe){Ur(ye,e,Oe),Ur(ye,t,Oe),ir(t,n),ir(n,i),la(o,i,null),ir(n,u),ir(n,s),r[63](s),f1(s,r[1]),ir(n,d),ir(n,p),ir(p,g),la(y,g,null),ir(p,x),H&&H.m(p,null),ir(n,C),Z&&Z.m(n,null),ir(n,T),Ie&&Ie.m(n,null),ir(t,E),~z&&fe[z].m(t,null),B=!0,O||(Y=[co(i,"click",r[62]),co(s,"input",r[64]),co(s,"focus",r[65]),co(s,"blur",r[66]),co(s,"keydown",r[22]),co(s,"input",r[67]),co(g,"click",r[68]),co(t,"submit",MM(r[21]))],O=!0)},p(ye,Oe){(!B||Oe[0]&256)&&Lt(s,"placeholder",ye[8]),(!B||Oe[0]&256)&&Lt(s,"aria-label",ye[8]),Oe[0]&2&&s.value!==ye[1]&&f1(s,ye[1]),(!B||Oe[0]&8)&&Lt(g,"title",ye[3]),ye[19]?H?Oe[0]&524288&&fi(H,1):(H=k1(),H.c(),fi(H,1),H.m(p,null)):H&&(Nd(),Si(H,1,1,()=>{H=null}),jd()),(!B||Oe[0]&2)&&ts(p,"displayable",ye[1]!==""),ye[5]==="button"?Z?(Z.p(ye,Oe),Oe[0]&32&&fi(Z,1)):(Z=S1(ye),Z.c(),fi(Z,1),Z.m(n,T)):Z&&(Nd(),Si(Z,1,1,()=>{Z=null}),jd()),Ie&&Ie.p&&(!B||Oe[1]&536870912)&&SM(Ie,_e,ye,ye[60],B?kM(_e,ye[60],Oe,null):CM(ye[60]),null);let Ue=z;z=Ee(ye),z===Ue?~z&&fe[z].p(ye,Oe):(I&&(Nd(),Si(fe[Ue],1,1,()=>{fe[Ue]=null}),jd()),~z?(I=fe[z],I?I.p(ye,Oe):(I=fe[z]=J[z](ye),I.c()),fi(I,1),I.m(t,null)):I=null),(!B||Oe[0]&4&&L!==(L=c1(ye[2])+" svelte-bz0zu3"))&&Lt(t,"class",L),(!B||Oe[0]&22)&&ts(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){B||(fi(q),fi(o.$$.fragment,ye),fi(y.$$.fragment,ye),fi(H),fi(Z),fi(Ie,ye),fi(I),B=!0)},o(ye){Si(q),Si(o.$$.fragment,ye),Si(y.$$.fragment,ye),Si(H),Si(Z),Si(Ie,ye),Si(I),B=!1},d(ye){ye&&(Nr(e),Nr(t)),ua(o),r[63](null),ua(y),H&&H.d(),Z&&Z.d(),Ie&&Ie.d(ye),~z&&fe[z].d(),O=!1,fa(Y)}}}function TE(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:E=200}=e,{enableReverse:z="never"}=e,{errorMessage:I="Something went wrong…"}=e,{filter:L=()=>!0}=e,{flyTo:B=!0}=e,{fuzzyMatch:O=!0}=e,{language:Y=void 0}=e,{limit:q=void 0}=e,{mapController:H=void 0}=e,{minLength:Z=2}=e,{noResultsMessage:_e="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ie="Search"}=e,{proximity:J=[{type:"server-geolocation"}]}=e,{reverseActive:fe=z==="always"}=e,{reverseButtonTitle:Ee="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:Oe="full-geometry"}=e,{showPlaceType:Ue="if-needed"}=e,{showResultsWhileTyping:De=!0}=e,{selectFirst:xe=!0}=e,{flyToSelected:et=!1}=e,{markerOnSelected:Ze=!0}=e,{types:Qe=void 0}=e,{exhaustiveReverseGeocoding:ct=!1}=e,{excludeTypes:dt=!1}=e,{zoom:Je=s}=e,{apiUrl:yt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Et={}}=e,{iconsBaseUrl:Ot="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Yt=()=>{}}=e;function tn(){Pe.focus()}function Qt(){Pe.blur()}function fn(ie,Ye=!0,nt=!1){t(1,ye=ie),Ye?(t(15,tt=-1),_t()):(vt(!nt,nt),setTimeout(()=>{Pe.focus(),Pe.select()}))}function pn(){t(14,mt=void 0),t(56,he=void 0),t(15,tt=-1)}function He(){t(55,Pt=[]),t(56,he=void 0)}let We=!1,mt,Pt,he,nn="",Pe,tt=-1,jt,Gn=[],Un,jn,Wt,An;const ti=new Set,Bn=PM();IM(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function _t(ie){if(jn&&(clearTimeout(jn),jn=void 0),tt>-1&&mt)t(56,he=mt[tt]),t(1,ye=he.place_type[0]==="reverse"?he.place_name:he.place_name.replace(/,.*/,"")),t(18,jt=void 0),t(55,Pt=void 0),t(15,tt=-1);else if(ye){const Ye=ie||!mr(ye);ar(ye,{exact:!0}).then(()=>{t(55,Pt=mt),t(56,he=void 0),Ye&&gi()}).catch(nt=>t(18,jt=nt))}}function mr(ie){try{return wE(ie,6)}catch{return!1}}async function ar(ie,{byId:Ye=!1,exact:nt=!1}={}){t(18,jt=void 0),Un==null||Un.abort();const it=new AbortController;t(19,Un=it);try{const ft=mr(ie),zt=new URLSearchParams;if(Y!==void 0&&zt.set("language",Array.isArray(Y)?Y.join(","):Y??""),Qe&&zt.set("types",Qe.join(",")),dt&&zt.set("excludeTypes",String(dt)),g&&zt.set("bbox",g.map(qn=>qn.toFixed(6)).join(",")),T&&zt.set("country",Array.isArray(T)?T.join(","):T),!Ye&&!ft){const qn=await cE(H,J,it);qn&&zt.set("proximity",qn),(nt||!De)&&zt.set("autocomplete","false"),zt.set("fuzzyMatch",String(O))}q!==void 0&&(ct||!ft||(Qe==null?void 0:Qe.length)===1)&&zt.set("limit",String(q)),zt.set("key",p),Yt(zt);const on=yt+"/"+encodeURIComponent(ft?ft.decimalLongitude+","+ft.decimalLatitude:ie)+".json?"+zt.toString();if(on===nn){Ye?(t(14,mt=void 0),t(56,he=Gn[0])):t(14,mt=Gn);return}nn=on;const mn=await fetch(on,{signal:it.signal,...Et});if(!mn.ok)throw new Error(await mn.text());const Ln=await mn.json();Bn("response",{url:on,featureCollection:Ln}),Ye?(t(14,mt=void 0),t(56,he=Ln.features[0]),Gn=[he]):(t(14,mt=Ln.features.filter(L)),ft&&mt.unshift({type:"Feature",properties:{},id:"reverse_"+ft.decimalLongitude+"_"+ft.decimalLatitude,text:ft.decimalLatitude+", "+ft.decimalLongitude,place_name:ft.decimalLatitude+", "+ft.decimalLongitude,place_type:["reverse"],center:[ft.decimalLongitude,ft.decimalLatitude],bbox:[ft.decimalLongitude,ft.decimalLatitude,ft.decimalLongitude,ft.decimalLatitude],geometry:{type:"Point",coordinates:[ft.decimalLongitude,ft.decimalLatitude]}}),Gn=mt,ft&&Pe.focus())}catch(ft){if(ft&&typeof ft=="object"&&"name"in ft&&ft.name==="AbortError")return;throw ft}finally{it===Un&&t(19,Un=void 0)}}function gi(){var ie;if(!(Pt!=null&&Pt.length)||!B)return;const Ye=[180,90,-180,-90],nt=!Pt.some(ft=>!ft.matching_text);let it;for(const ft of Pt){const zt=Vn(ft);if(it=it===void 0?zt:zt===void 0?it:Math.max(it,zt),nt||!ft.matching_text)for(const on of[0,1,2,3])Ye[on]=Math[on<2?"min":"max"](Ye[on],((ie=ft.bbox)==null?void 0:ie[on])??ft.center[on%2])}H&&Pt.length>0&&(he&&Ye[0]===Ye[2]&&Ye[1]===Ye[3]?H.flyTo(he.center,Vn(he)):H.fitBounds(rp(Ye),50,it))}function Vn(ie){var Ye;if(!ie.bbox||ie.bbox[0]!==ie.bbox[2]&&ie.bbox[1]!==ie.bbox[3])return;const nt=ie.id.replace(/\..*/,"");return(Array.isArray((Ye=ie.properties)==null?void 0:Ye.categories)?ie.properties.categories.reduce((it,ft)=>{const zt=Je[nt+"."+ft];return it===void 0?zt:zt===void 0?it:Math.max(it,zt)},void 0):void 0)??Je[nt]}function $e(ie){t(0,fe=z==="always"),t(14,mt=void 0),t(56,he=void 0),t(15,tt=-1),fn(ie[1].toFixed(6)+", "+uE(ie[0],[-180,180],!0).toFixed(6),!1,!0)}function pt(ie){if(!mt)return;let Ye=ie.key==="ArrowDown"?1:ie.key==="ArrowUp"?-1:0;Ye&&(tt===(xe?0:-1)&&Ye===-1&&t(15,tt=mt.length),t(15,tt+=Ye),tt>=mt.length&&t(15,tt=-1),tt<0&&xe&&t(15,tt=0),ie.preventDefault())}function vt(ie=!0,Ye=!1){if(t(18,jt=void 0),De||Ye){if(jn&&clearTimeout(jn),ye.length<Z)return;const nt=ye;jn=window.setTimeout(()=>{ar(nt).catch(it=>t(18,jt=it))},ie?E:0)}else t(14,mt=void 0),t(18,jt=void 0)}function Dt(ie){t(56,he=ie),t(1,ye=ie.place_name),t(15,tt=-1)}const rn=()=>Pe.focus();function en(ie){hg[ie?"unshift":"push"](()=>{Pe=ie,t(17,Pe)})}function br(){ye=this.value,t(1,ye),t(13,We),t(28,x)}const lr=()=>t(13,We=!0),Se=()=>t(13,We=!1),re=()=>vt(),ce=()=>{t(1,ye=""),Pe.focus()},me=()=>t(0,fe=!fe),we=()=>t(18,jt=void 0),Ne=ie=>t(15,tt=ie),je=ie=>Dt(ie),qe=()=>{xe||t(15,tt=-1)},Re=()=>{};return r.$$set=ie=>{"class"in ie&&t(2,d=ie.class),"apiKey"in ie&&t(26,p=ie.apiKey),"bbox"in ie&&t(27,g=ie.bbox),"clearButtonTitle"in ie&&t(3,y=ie.clearButtonTitle),"clearOnBlur"in ie&&t(28,x=ie.clearOnBlur),"collapsed"in ie&&t(4,C=ie.collapsed),"country"in ie&&t(29,T=ie.country),"debounceSearch"in ie&&t(30,E=ie.debounceSearch),"enableReverse"in ie&&t(5,z=ie.enableReverse),"errorMessage"in ie&&t(6,I=ie.errorMessage),"filter"in ie&&t(31,L=ie.filter),"flyTo"in ie&&t(32,B=ie.flyTo),"fuzzyMatch"in ie&&t(33,O=ie.fuzzyMatch),"language"in ie&&t(34,Y=ie.language),"limit"in ie&&t(35,q=ie.limit),"mapController"in ie&&t(36,H=ie.mapController),"minLength"in ie&&t(37,Z=ie.minLength),"noResultsMessage"in ie&&t(7,_e=ie.noResultsMessage),"placeholder"in ie&&t(8,Ie=ie.placeholder),"proximity"in ie&&t(38,J=ie.proximity),"reverseActive"in ie&&t(0,fe=ie.reverseActive),"reverseButtonTitle"in ie&&t(9,Ee=ie.reverseButtonTitle),"searchValue"in ie&&t(1,ye=ie.searchValue),"pickedResultStyle"in ie&&t(39,Oe=ie.pickedResultStyle),"showPlaceType"in ie&&t(10,Ue=ie.showPlaceType),"showResultsWhileTyping"in ie&&t(40,De=ie.showResultsWhileTyping),"selectFirst"in ie&&t(11,xe=ie.selectFirst),"flyToSelected"in ie&&t(41,et=ie.flyToSelected),"markerOnSelected"in ie&&t(42,Ze=ie.markerOnSelected),"types"in ie&&t(43,Qe=ie.types),"exhaustiveReverseGeocoding"in ie&&t(44,ct=ie.exhaustiveReverseGeocoding),"excludeTypes"in ie&&t(45,dt=ie.excludeTypes),"zoom"in ie&&t(46,Je=ie.zoom),"apiUrl"in ie&&t(47,yt=ie.apiUrl),"fetchParameters"in ie&&t(48,Et=ie.fetchParameters),"iconsBaseUrl"in ie&&t(12,Ot=ie.iconsBaseUrl),"adjustUrlQuery"in ie&&t(49,Yt=ie.adjustUrlQuery),"$$scope"in ie&&t(60,u=ie.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,fe=z==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Wt=We),x&&!We&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<Z&&(t(56,he=void 0),t(14,mt=void 0),t(18,jt=void 0),t(55,Pt=mt)),r.$$.dirty[1]&33554688&&Oe!=="marker-only"&&he&&!he.address&&he.geometry.type==="Point"&&he.place_type[0]!=="reverse"&&ar(he.id,{byId:!0}).catch(ie=>t(18,jt=ie)),r.$$.dirty[1]&100663330&&(H&&he&&he.id!==An&&B&&(!he.bbox||he.bbox[0]===he.bbox[2]&&he.bbox[1]===he.bbox[3]?H.flyTo(he.center,Vn(he)):H.fitBounds(rp(he.bbox),50,Vn(he)),t(14,mt=void 0),t(55,Pt=void 0),t(15,tt=-1)),t(57,An=he==null?void 0:he.id)),r.$$.dirty[0]&18432&&xe&&mt!=null&&mt.length&&t(15,tt=0),r.$$.dirty[0]&2&&t(15,tt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Pt!==mt&&t(55,Pt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&H&&H.setEventHandler(ie=>{switch(ie.type){case"mapClick":fe&&$e(ie.coordinates);break;case"markerClick":{const Ye=mt==null?void 0:mt.find(nt=>nt.id===ie.id);Ye&&Dt(Ye)}break;case"markerMouseEnter":Pt&&t(15,tt=Wt?(mt==null?void 0:mt.findIndex(Ye=>Ye.id===ie.id))??-1:-1);break;case"markerMouseLeave":Pt&&t(15,tt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=mt==null?void 0:mt[tt]),r.$$.dirty[1]&134218786&&H&&i&&B&&et&&H.flyTo(i.center,Vn(i)),r.$$.dirty[1]&256&&t(59,n=Oe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ze||H==null||H.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&H&&Ze&&!Pt&&(H.setFeatures(i?[i]:void 0,void 0,n),H.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&H&&H.setFeatures(Pt,he,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Pt&&H&&H.setSelectedMarker(tt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&H){const ie=mr(ye);H.setReverseMarker(ie?[ie.decimalLongitude,ie.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Bn("select",{feature:i}),r.$$.dirty[1]&33554432&&Bn("pick",{feature:he}),r.$$.dirty[0]&81920&&Bn("optionsvisibilitychange",{optionsVisible:Wt&&!!mt}),r.$$.dirty[0]&16384&&Bn("featureslisted",{features:mt}),r.$$.dirty[1]&16777216&&Bn("featuresmarked",{features:Pt}),r.$$.dirty[0]&1&&Bn("reversetoggle",{reverse:fe}),r.$$.dirty[0]&2&&Bn("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&H&&H.indicateReverse(fe)},[fe,ye,d,y,C,z,I,_e,Ie,Ee,Ue,xe,Ot,We,mt,tt,Wt,Pe,jt,Un,ti,_t,pt,vt,Dt,s,p,g,x,T,E,L,B,O,Y,q,H,Z,J,Oe,De,et,Ze,Qe,ct,dt,Je,yt,Et,Yt,tn,Qt,fn,pn,He,Pt,he,An,i,n,u,o,rn,en,br,lr,Se,re,ce,me,we,Ne,je,qe,Re]}let ME=class extends Za{constructor(r){super(),Wa(this,r,TE,CE,Ga,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Zf(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function h_(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return Zf({type:"Polygon",coordinates:r},e,t)}function Xf(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function O2(r,e,t={}){return Zf({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function EE(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(p){return function(g){return d([p,g])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var ja=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function LE(r,e){return r>e?1:r<e?-1:0}function Pa(r,e,t){for(var n=new ja(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Nm(r,e,t,n){var i=new ja(r,e);if(t===null)return i.left=i.right=null,i;t=Pa(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function T1(r,e,t){var n=null,i=null;if(e){e=Pa(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function IE(r,e,t){return e===null?r:(r===null||(e=Pa(r.key,e,t),e.left=r),e)}function mg(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&mg(r.left,o,!1,n,i),r.right&&mg(r.right,o,!0,n,i)}}var d_=function(){function r(e){e===void 0&&(e=LE),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Nm(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new ja(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Pa(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Pa(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Pa(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Pa(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Pa(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,s=this._root,d;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),d=u(s.key,t),d>0)break;if(u(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return zE(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&yg(e,t,0,i-1,o),this._root===null)this._root=gg(e,t,0,i),this._size=i;else{var u=DE(this.toList(),PE(e,t),o);i=this._size+i,this._root=_g({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return mg(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=T1(e,this._root,i),u=o.left,s=o.right;i(e,t)<0?s=Nm(t,n,s,i):u=Nm(t,n,u,i),this._root=IE(u,s,i)},r.prototype.split=function(e){return T1(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return EE(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function gg(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],s=e[o],d=new ja(u,s);return d.left=gg(r,e,t,o),d.right=gg(r,e,o+1,n),d}return null}function PE(r,e){for(var t=new ja(null,null),n=t,i=0;i<r.length;i++)n=n.next=new ja(r[i],e[i]);return n.next=null,t.next}function zE(r){for(var e=r,t=[],n=!1,i=new ja(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function _g(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=_g(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=_g(r,i+1,t),u}return null}function DE(r,e,t){for(var n=new ja(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function yg(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,s=n+1;;){do u++;while(i(r[u],o)<0);do s--;while(i(r[s],o)>0);if(u>=s)break;var d=r[u];r[u]=r[s],r[s]=d,d=e[u],e[u]=e[s],e[s]=d}yg(r,e,t,s,i),yg(r,e,s+1,n,i)}}const oa=11102230246251565e-32,Wi=134217729,RE=(3+8*oa)*oa;function jm(r,e,t,n,i){let o,u,s,d,p=e[0],g=n[0],y=0,x=0;g>p==g>-p?(o=p,p=e[++y]):(o=g,g=n[++x]);let C=0;if(y<r&&x<t)for(g>p==g>-p?(u=p+o,s=o-(u-p),p=e[++y]):(u=g+o,s=o-(u-g),g=n[++x]),o=u,s!==0&&(i[C++]=s);y<r&&x<t;)g>p==g>-p?(u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++y]):(u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x]),o=u,s!==0&&(i[C++]=s);for(;y<r;)u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++y],o=u,s!==0&&(i[C++]=s);for(;x<t;)u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x],o=u,s!==0&&(i[C++]=s);return(o!==0||C===0)&&(i[C++]=o),C}function BE(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function fh(r){return new Float64Array(r)}const FE=(3+16*oa)*oa,OE=(2+12*oa)*oa,$E=(9+64*oa)*oa*oa,ju=fh(4),M1=fh(8),E1=fh(12),L1=fh(16),uo=fh(4);function NE(r,e,t,n,i,o,u){let s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q,H,Z;const _e=r-i,Ie=t-i,J=e-o,fe=n-o;O=_e*fe,x=Wi*_e,C=x-(x-_e),T=_e-C,x=Wi*fe,E=x-(x-fe),z=fe-E,Y=T*z-(O-C*E-T*E-C*z),q=J*Ie,x=Wi*J,C=x-(x-J),T=J-C,x=Wi*Ie,E=x-(x-Ie),z=Ie-E,H=T*z-(q-C*E-T*E-C*z),I=Y-H,y=Y-I,ju[0]=Y-(I+y)+(y-H),L=O+I,y=L-O,B=O-(L-y)+(I-y),I=B-q,y=B-I,ju[1]=B-(I+y)+(y-q),Z=L+I,y=Z-L,ju[2]=L-(Z-y)+(I-y),ju[3]=Z;let Ee=BE(4,ju),ye=OE*u;if(Ee>=ye||-Ee>=ye||(y=r-_e,s=r-(_e+y)+(y-i),y=t-Ie,p=t-(Ie+y)+(y-i),y=e-J,d=e-(J+y)+(y-o),y=n-fe,g=n-(fe+y)+(y-o),s===0&&d===0&&p===0&&g===0)||(ye=$E*u+RE*Math.abs(Ee),Ee+=_e*g+fe*s-(J*p+Ie*d),Ee>=ye||-Ee>=ye))return Ee;O=s*fe,x=Wi*s,C=x-(x-s),T=s-C,x=Wi*fe,E=x-(x-fe),z=fe-E,Y=T*z-(O-C*E-T*E-C*z),q=d*Ie,x=Wi*d,C=x-(x-d),T=d-C,x=Wi*Ie,E=x-(x-Ie),z=Ie-E,H=T*z-(q-C*E-T*E-C*z),I=Y-H,y=Y-I,uo[0]=Y-(I+y)+(y-H),L=O+I,y=L-O,B=O-(L-y)+(I-y),I=B-q,y=B-I,uo[1]=B-(I+y)+(y-q),Z=L+I,y=Z-L,uo[2]=L-(Z-y)+(I-y),uo[3]=Z;const Oe=jm(4,ju,4,uo,M1);O=_e*g,x=Wi*_e,C=x-(x-_e),T=_e-C,x=Wi*g,E=x-(x-g),z=g-E,Y=T*z-(O-C*E-T*E-C*z),q=J*p,x=Wi*J,C=x-(x-J),T=J-C,x=Wi*p,E=x-(x-p),z=p-E,H=T*z-(q-C*E-T*E-C*z),I=Y-H,y=Y-I,uo[0]=Y-(I+y)+(y-H),L=O+I,y=L-O,B=O-(L-y)+(I-y),I=B-q,y=B-I,uo[1]=B-(I+y)+(y-q),Z=L+I,y=Z-L,uo[2]=L-(Z-y)+(I-y),uo[3]=Z;const Ue=jm(Oe,M1,4,uo,E1);O=s*g,x=Wi*s,C=x-(x-s),T=s-C,x=Wi*g,E=x-(x-g),z=g-E,Y=T*z-(O-C*E-T*E-C*z),q=d*p,x=Wi*d,C=x-(x-d),T=d-C,x=Wi*p,E=x-(x-p),z=p-E,H=T*z-(q-C*E-T*E-C*z),I=Y-H,y=Y-I,uo[0]=Y-(I+y)+(y-H),L=O+I,y=L-O,B=O-(L-y)+(I-y),I=B-q,y=B-I,uo[1]=B-(I+y)+(y-q),Z=L+I,y=Z-L,uo[2]=L-(Z-y)+(I-y),uo[3]=Z;const De=jm(Ue,E1,4,uo,L1);return L1[De-1]}function jE(r,e,t,n,i,o){const u=(e-o)*(t-i),s=(r-i)*(n-o),d=u-s,p=Math.abs(u+s);return Math.abs(d)>=FE*p?d:-NE(r,e,t,n,i,o,p)}const vf=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,vg=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Da=Number.EPSILON;Da===void 0&&(Da=Math.pow(2,-52));const UE=Da*Da,I1=(r,e)=>{if(-Da<r&&r<Da&&-Da<e&&e<Da)return 0;const t=r-e;return t*t<UE*r*e?0:r<e?-1:1};class VE{constructor(){this.reset()}reset(){this.xRounder=new P1,this.yRounder=new P1}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class P1{constructor(){this.tree=new d_,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&I1(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&I1(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const Kf=new VE,Ud=(r,e)=>r.x*e.y-r.y*e.x,$2=(r,e)=>r.x*e.x+r.y*e.y,z1=(r,e,t)=>{const n=jE(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},ip=r=>Math.sqrt($2(r,r)),qE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Ud(i,n)/ip(i)/ip(n)},HE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return $2(i,n)/ip(i)/ip(n)},D1=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},R1=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},GE=(r,e,t,n)=>{if(e.x===0)return R1(t,n,r.x);if(n.x===0)return R1(r,e,t.x);if(e.y===0)return D1(t,n,r.y);if(n.y===0)return D1(r,e,t.y);const i=Ud(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=Ud(o,e)/i,s=Ud(o,n)/i,d=r.x+s*e.x,p=t.x+u*n.x,g=r.y+s*e.y,y=t.y+u*n.y,x=(d+p)/2,C=(g+y)/2;return{x,y:C}};class Jo{static compare(e,t){const n=Jo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ra.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:qE(this.point,e.point,o.point),cosine:HE(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:s}=t.get(i),{sine:d,cosine:p}=t.get(o);return u>=0&&d>=0?s<p?1:s>p?-1:0:u<0&&d<0?s<p?-1:s>p?1:0:d<u?-1:d>u?1:0}}}let WE=0;class Ra{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const s=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(d<s&&d<p)return 1;if(d>s&&d>p)return-1;const y=e.comparePoint(t.leftSE.point);if(y<0)return 1;if(y>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(n>i){if(s<d&&s<g)return-1;if(s>d&&s>g)return 1;const y=t.comparePoint(e.leftSE.point);if(y!==0)return y;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s<d)return-1;if(s>d)return 1;if(o<u){const y=t.comparePoint(e.rightSE.point);if(y!==0)return y}if(o>u){const y=e.comparePoint(t.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(o!==u){const y=p-s,x=o-n,C=g-d,T=u-i;if(y>x&&C<T)return 1;if(y<x&&C>T)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++WE,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const s=Jo.comparePoints(e,t);if(s<0)i=e,o=t,u=1;else if(s>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Jo(i,!0),p=new Jo(o,!1);return new Ra(d,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const s=(e.x-t.x)/i.x,d=t.y+s*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=vg(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,s=e.leftSE.point,d=e.rightSE.point,p=vf(t,s)&&this.comparePoint(s)===0,g=vf(n,o)&&e.comparePoint(o)===0,y=vf(t,d)&&this.comparePoint(d)===0,x=vf(n,u)&&e.comparePoint(u)===0;if(g&&p)return x&&!y?u:!x&&y?d:null;if(g)return y&&o.x===d.x&&o.y===d.y?null:o;if(p)return x&&u.x===s.x&&u.y===s.y?null:s;if(x&&y)return null;if(x)return u;if(y)return d;const C=GE(o,this.vector(),s,e.vector());return C===null||!vf(i,C)?null:Kf.round(C.x,C.y)}split(e){const t=[],n=e.events!==void 0,i=new Jo(e,!0),o=new Jo(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const s=new Ra(i,u,this.rings.slice(),this.windings.slice());return Jo.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Jo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Ra.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const s=n.rings[o],d=n.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,d=this.rings.length;s<d;s++){const p=this.rings[s],g=this.windings[s],y=t.indexOf(p);y===-1?(t.push(p),n.push(g)):n[y]+=g}const o=[],u=[];for(let s=0,d=t.length;s<d;s++){if(n[s]===0)continue;const p=t[s],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const y=o.indexOf(p.poly);y!==-1&&o.splice(y,1)}}for(let s=0,d=o.length;s<d;s++){const p=o[s].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(vs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===vs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${vs.type}`)}return this._isInResult}}class B1{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Kf.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,s=e.length;u<s;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=Kf.round(e[u][0],e[u][1]);d.x===o.x&&d.y===o.y||(this.segments.push(Ra.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Ra.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class ZE{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new B1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new B1(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class F1{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new ZE(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class op{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,s=o.leftSE,d=o.rightSE;const p=[s],g=s.point,y=[];for(;u=s,s=d,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const E=p[0].point,z=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${E.x}, ${E.y}]. Last matching segment found ends at [${z.x}, ${z.y}].`)}if(x.length===1){d=x[0].otherSE;break}let C=null;for(let E=0,z=y.length;E<z;E++)if(y[E].point===s.point){C=E;break}if(C!==null){const E=y.splice(C)[0],z=p.splice(E.index);z.unshift(z[0].otherSE),t.push(new op(z.reverse()));continue}y.push({index:p.length,point:s.point});const T=s.getLeftmostComparator(u);d=x.sort(T)[0].otherSE;break}t.push(new op(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const y=this.events[p].point,x=this.events[p+1].point;z1(y,e,x)!==0&&(t.push(y),e=y)}if(t.length===1)return null;const n=t[0],i=t[1];z1(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,d=[];for(let p=u;p!=s;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];Jo.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class O1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class XE{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new O1(o));else{const u=o.enclosingRing();u.poly||t.push(new O1(u)),u.poly.addInterior(o)}}return t}}class KE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ra.compare;this.queue=e,this.tree=new d_(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,s,d;for(;s===void 0;)o=this.tree.prev(o),o===null?s=null:o.key.consumedBy===void 0&&(s=o.key);for(;d===void 0;)u=this.tree.next(u),u===null?d=null:u.key.consumedBy===void 0&&(d=u.key);if(e.isLeft){let p=null;if(s){const y=s.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(p=y),!s.isAnEndpoint(y))){const x=this._splitSafely(s,y);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}let g=null;if(d){const y=d.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(g=y),!d.isAnEndpoint(y))){const x=this._splitSafely(d,y);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}if(p!==null||g!==null){let y=null;p===null?y=g:g===null?y=p:y=Jo.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const x=t.split(y);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&d){const p=s.getIntersection(d);if(p!==null){if(!s.isAnEndpoint(p)){const g=this._splitSafely(s,p);for(let y=0,x=g.length;y<x;y++)n.push(g[y])}if(!d.isAnEndpoint(p)){const g=this._splitSafely(d,p);for(let y=0,x=g.length;y<x;y++)n.push(g[y])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const $1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,JE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class YE{run(e,t,n){vs.type=e,Kf.reset();const i=[new F1(t,!0)];for(let g=0,y=n.length;g<y;g++)i.push(new F1(n[g],!1));if(vs.numMultiPolys=i.length,vs.type==="difference"){const g=i[0];let y=1;for(;y<i.length;)vg(i[y].bbox,g.bbox)!==null?y++:i.splice(y,1)}if(vs.type==="intersection")for(let g=0,y=i.length;g<y;g++){const x=i[g];for(let C=g+1,T=i.length;C<T;C++)if(vg(x.bbox,i[C].bbox)===null)return[]}const o=new d_(Jo.compare);for(let g=0,y=i.length;g<y;g++){const x=i[g].getSweepEvents();for(let C=0,T=x.length;C<T;C++)if(o.insert(x[C]),o.size>$1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new KE(o);let s=o.size,d=o.pop();for(;d;){const g=d.key;if(o.size===s){const x=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(o.size>$1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>JE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const y=u.process(g);for(let x=0,C=y.length;x<C;x++){const T=y[x];T.consumedBy===void 0&&o.insert(T)}s=o.size,d=o.pop()}Kf.reset();const p=op.factory(u.segments);return new XE(p).getGeom()}}const vs=new YE,QE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return vs.run("union",r,t)},eL=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return vs.run("intersection",r,t)},tL=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return vs.run("xor",r,t)},nL=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return vs.run("difference",r,t)};var N2={union:QE,intersection:eL,xor:tL,difference:nL};function j2(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,y=0,x,C=r.type,T=C==="FeatureCollection",E=C==="Feature",z=T?r.features.length:1,I=0;I<z;I++){p=T?r.features[I].geometry:E?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var L=0;L<s;L++){var B=0,O=0;if(u=x?p.geometries[L]:p,u!==null){d=u.coordinates;var Y=u.type;switch(g=0,Y){case null:break;case"Point":if(e(d,y,I,B,O)===!1)return!1;y++,B++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,I,B,O)===!1)return!1;y++,Y==="MultiPoint"&&B++}Y==="LineString"&&B++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],y,I,B,O)===!1)return!1;y++}Y==="MultiLineString"&&B++,Y==="Polygon"&&O++}Y==="Polygon"&&B++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],y,I,B,O)===!1)return!1;y++}O++}B++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(j2(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p_(r,e){var t,n,i,o,u,s,d,p,g,y,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",E=C?r.features.length:1;for(t=0;t<E;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,y=C?r.features[t].id:T?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function rL(r,e){p_(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Zf(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],y={type:d,coordinates:g};if(e(Zf(y,i),n,p)===!1)return!1}})}function iL(r,e={}){const t=[];if(p_(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=N2.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?h_(n[0],e.properties):O2(n,e.properties)}var U2=iL;function oL(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return j2(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var N1=oL;function sL(r){const e=[];if(p_(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=N2.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?h_(n[0],t):O2(n,t)}var aL=sL;function lL(r){if(!r)throw new Error("geojson is required");var e=[];return rL(r,function(t){e.push(t)}),Xf(e)}var uL=lL;function j1(r,e){const t=aL(Xf([h_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=rp(N1(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,s=uL(r);if(s.features.length>1&&(o||u))for(const d of s.features){const p=rp(N1(d));if(u&&p[0]<-180+i)for(const g of d.geometry.coordinates)for(const y of g)y[0]+=360-i;if(o&&p[2]>180-i)for(const g of d.geometry.coordinates)for(const y of g)y[0]-=360-i}e(Xf([s.features.length<2?r:U2(s)??r,t]))}const U1={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Cd="mtlr-gc-full-geom",V1="mtlr-gc-full-geom-fill",q1="mtlr-gc-full-geom-line";function V2(r,e,t=!0,n=!0,i={},o={},u=U1){let s;const d=[];let p,g,y;function x(){if(!r.loaded){r.once("load",x);return}const z=u?u===!0?U1:u:void 0;if(!(z!=null&&z.fill)&&!(z!=null&&z.line))return;const I=r.getSource(Cd);if(I)I.setData(y??Xf([]));else if(y)r.addSource(Cd,{type:"geojson",data:y});else return;!r.getLayer(V1)&&z!=null&&z.fill&&r.addLayer({...z==null?void 0:z.fill,id:V1,type:"fill",source:Cd}),!r.getLayer(q1)&&z!=null&&z.line&&r.addLayer({...z==null?void 0:z.line,id:q1,type:"line",source:Cd})}function C(z){y=z,x()}r.on("styledata",()=>{setTimeout(()=>{y&&x()})});const T=z=>{s==null||s({type:"mapClick",coordinates:[z.lngLat.lng,z.lngLat.lat]})};function E(z=!1){if(!e)throw new Error;const I=document.createElement("div");return z&&I.classList.add("marker-interactive"),new iE({props:{displayIn:"maplibre"},target:I}),new e.Marker({element:I,offset:[1,-13]})}return{setEventHandler(z){z?(s=z,r.on("click",T)):(s=void 0,r.off("click",T))},flyTo(z,I){r.flyTo({center:z,...I?{zoom:I}:{},...i})},fitBounds(z,I,L){r.fitBounds([[z[0],z[1]],[z[2],z[3]]],{padding:I,...L?{maxZoom:L}:{},...o})},indicateReverse(z){r.getCanvasContainer().style.cursor=z?"crosshair":""},setReverseMarker(z){!e||!t||(g?z?g.setLngLat(z):(g.remove(),g=void 0):z&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):E()).setLngLat(z).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(z,I,L){for(const B of d)B.remove();if(d.length=0,C(void 0),!!e){if(I){let B=!1;if(I.geometry.type==="GeometryCollection"){const O=I.geometry.geometries.filter(Y=>Y.type==="Polygon"||Y.type==="MultiPolygon");e:if(O.length>0){const Y=U2(Xf(O.map(q=>Zf(q))));if(!Y)break e;j1({...I,geometry:Y.geometry},C),B=!0}else{const Y=I.geometry.geometries.filter(q=>q.type==="LineString"||q.type==="MultiLineString");Y.length>0&&(C({...I,geometry:{type:"GeometryCollection",geometries:Y}}),B=!0)}}if(!B){if(I.geometry.type==="Polygon"||I.geometry.type==="MultiPolygon")j1(I,C);else if(I.geometry.type==="LineString"||I.geometry.type==="MultiLineString"){C(I);return}}if(!L&&I.geometry.type!=="Point")return;if(t instanceof Function){const O=t(r,I);O&&d.push(O)}else t&&d.push(typeof t=="object"?new e.Marker(t):E().setLngLat(I.center).addTo(r))}if(n)for(const B of z??[]){if(B===I)continue;let O;if(n instanceof Function){if(O=n(r,B),!O)continue}else O=(typeof n=="object"?new e.Marker(n):E(!0)).setLngLat(B.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(B.place_type[0]==="reverse"?B.place_name:B.place_name.replace(/,.*/,""))).addTo(r);const Y=O.getElement();Y.addEventListener("click",q=>{q.stopPropagation(),s==null||s({type:"markerClick",id:B.id})}),Y.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:B.id}),O.togglePopup()}),Y.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:B.id}),O.togglePopup()}),d.push(O)}}},setSelectedMarker(z){p&&p.getElement().classList.toggle("marker-selected",!1),p=z>-1?d[z]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const z=r.getCenter();return[r.getZoom(),z.lng,z.lat]}}}function cL(r,e,t){var n,i;class o{constructor(z,I){Do(this,"type"),Do(this,"target"),this.type=I,this.target=z}}class u extends o{constructor(z,I){super(z,"select"),Do(this,"feature"),Object.assign(this,I)}}class s extends o{constructor(z,I){super(z,"featureslisted"),Do(this,"features"),this.features=I}}class d extends o{constructor(z,I){super(z,"featuresmarked"),Do(this,"features"),this.features=I}}class p extends o{constructor(z,I){super(z,"optionsvisibilitychange"),Do(this,"optionsVisible"),this.optionsVisible=I}}class g extends o{constructor(z,I){super(z,"pick"),Do(this,"feature"),this.feature=I}}class y extends o{constructor(z,I){super(z,"querychange"),Do(this,"query"),this.query=I}}class x extends o{constructor(z,I,L){super(z,"response"),Do(this,"url"),Do(this,"featureCollection"),this.url=I,this.featureCollection=L}}class C extends o{constructor(z,I){super(z,"reversetoggle"),Do(this,"reverse"),this.reverse=I}}class T extends r{constructor(z={}){super(),a1(this,n),a1(this,i),l1(this,i,z)}onAddInt(z){const I=document.createElement("div");I.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:L,showResultMarkers:B,flyTo:O,fullGeometryStyle:Y,...q}=yi(this,i),H=typeof O=="boolean"?{}:O,Z={mapController:V2(z,e,L,B,H,H,Y),flyTo:O===void 0?!0:!!O,apiKey:"",...t==null?void 0:t(z,I),...q};if(!Z.apiKey)throw new Error("no apiKey provided");return l1(this,n,new ME({target:I,props:Z})),yi(this,n).$on("select",_e=>{this.fire(new u(this,_e.detail))}),yi(this,n).$on("pick",_e=>{this.fire(new g(this,_e.detail.feature))}),yi(this,n).$on("featureslisted",_e=>{this.fire(new s(this,_e.detail.features))}),yi(this,n).$on("featuresmarked",_e=>{this.fire(new d(this,_e.detail.features))}),yi(this,n).$on("response",_e=>{this.fire(new x(this,_e.detail.url,_e.detail.featureCollection))}),yi(this,n).$on("optionsvisibilitychange",_e=>{this.fire(new p(this,_e.detail.optionsVisible))}),yi(this,n).$on("reversetoggle",_e=>{this.fire(new C(this,_e.detail.reverse))}),yi(this,n).$on("querychange",_e=>{this.fire(new y(this,_e.detail.query))}),I}on(z,I){return super.on(z,I)}once(z,I){return super.once(z,I)}off(z,I){return super.off(z,I)}listens(z){return super.listens(z)}setOptions(z){var I;Object.assign(yi(this,i),z);const{marker:L,showResultMarkers:B,flyTo:O,fullGeometryStyle:Y,...q}=yi(this,i);(I=yi(this,n))==null||I.$set(q)}setQuery(z,I=!0){var L;(L=yi(this,n))==null||L.setQuery(z,I)}clearMap(){var z;(z=yi(this,n))==null||z.clearMap()}clearList(){var z;(z=yi(this,n))==null||z.clearList()}setReverseMode(z){var I;(I=yi(this,n))==null||I.$set({reverseActive:z})}focus(){var z;(z=yi(this,n))==null||z.focus()}blur(){var z;(z=yi(this,n))==null||z.blur()}onRemove(){var z;(z=yi(this,n))==null||z.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:T,events:{SelectEvent:u,FeaturesListedEvent:s,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:y,ResponseEvent:x,ReverseToggleEvent:C}}}const{MapLibreBasedGeocodingControl:pF,events:Xa}=cL(sa.Evented,Ek);Xa.SelectEvent;Xa.FeaturesListedEvent;Xa.FeaturesMarkedEvent;Xa.OptionsVisibilityChangeEvent;Xa.PickEvent;Xa.QueryChangeEvent;Xa.ResponseEvent;Xa.ReverseToggleEvent;function fL(r){let e,t;return{c(){e=bs("svg"),t=bs("path"),ue(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ue(e,"viewBox","0 0 14 14"),ue(e,"width","13"),ue(e,"height","13"),ue(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),D(e,t)},p:lt,i:lt,o:lt,d(n){n&&G(e)}}}class q2 extends Tt{constructor(e){super(),Ct(this,e,null,fL,wt,{})}}function hL(r){let e,t;return{c(){e=bs("svg"),t=bs("path"),ue(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ue(e,"viewBox","0 0 30 30"),ue(e,"fill","none"),ue(e,"xmlns","http://www.w3.org/2000/svg"),ue(e,"class","svelte-d2loi5")},m(n,i){W(n,e,i),D(e,t)},p:lt,i:lt,o:lt,d(n){n&&G(e)}}}class H2 extends Tt{constructor(e){super(),Ct(this,e,null,hL,wt,{})}}function dL(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"area.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"area.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function pL(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"reverse.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"reverse.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function mL(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"poi.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"poi.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function gL(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"postal_code.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"postal_code.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function _L(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"street.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"street.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function yL(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"road.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"road.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function vL(r){let e,t;return{c(){e=j("img"),Sr(e.src,t=r[3]+"housenumber.svg")||ue(e,"src",t),ue(e,"alt",r[6]),ue(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"housenumber.svg")&&ue(e,"src",t),i&64&&ue(e,"alt",n[6])},d(n){n&&G(e)}}}function bL(r){let e,t,n,i;return{c(){e=j("img"),Sr(e.src,t=r[5])||ue(e,"src",t),ue(e,"alt",r[4]),ue(e,"class","svelte-ltkwvy")},m(o,u){W(o,e,u),n||(i=St(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Sr(e.src,t=o[5])&&ue(e,"src",t),u&16&&ue(e,"alt",o[4])},d(o){o&&G(e),n=!1,i()}}}function H1(r){let e,t;return{c(){e=j("span"),t=Te(r[6]),ue(e,"class","secondary svelte-ltkwvy")},m(n,i){W(n,e,i),D(e,t)},p(n,i){i&64&&xt(t,n[6])},d(n){n&&G(e)}}}function wL(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,E,z=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",I,L,B;function O(Z,_e){return _e&1&&(t=null),_e&1&&(n=null),_e&1&&(i=null),_e&1&&(o=null),Z[5]?bL:Z[0].address?vL:(t==null&&(t=!!Z[0].id.startsWith("road.")),t?yL:(n==null&&(n=!!Z[0].id.startsWith("address.")),n?_L:(i==null&&(i=!!Z[0].id.startsWith("postal_code.")),i?gL:(o==null&&(o=!!Z[0].id.startsWith("poi.")),o?mL:Z[7]?pL:dL))))}let Y=O(r,-1),q=Y(r),H=C&&H1(r);return{c(){e=j("li"),q.c(),u=ne(),s=j("span"),d=j("span"),p=j("span"),y=Te(g),x=ne(),H&&H.c(),T=ne(),E=j("span"),I=Te(z),ue(p,"class","primary svelte-ltkwvy"),ue(d,"class","svelte-ltkwvy"),ue(E,"class","line2 svelte-ltkwvy"),ue(s,"class","texts svelte-ltkwvy"),ue(e,"tabindex","0"),ue(e,"data-selected",r[1]),ue(e,"class","svelte-ltkwvy"),Gt(e,"selected",r[1])},m(Z,_e){W(Z,e,_e),q.m(e,null),D(e,u),D(e,s),D(s,d),D(d,p),D(p,y),D(d,x),H&&H.m(d,null),D(s,T),D(s,E),D(E,I),L||(B=[St(e,"mouseenter",r[12]),St(e,"focus",r[13])],L=!0)},p(Z,[_e]){Y===(Y=O(Z,_e))&&q?q.p(Z,_e):(q.d(1),q=Y(Z),q&&(q.c(),q.m(e,u))),_e&1&&g!==(g=(Z[7]?Z[0].place_name:Z[0].place_name.replace(/,.*/,""))+"")&&xt(y,g),_e&37&&(C=Z[2]==="always"||Z[2]!=="never"&&!Z[0].address&&!Z[0].id.startsWith("road.")&&!Z[0].id.startsWith("address.")&&!Z[0].id.startsWith("postal_code.")&&(!Z[0].id.startsWith("poi.")||!Z[5])&&!Z[7]),C?H?H.p(Z,_e):(H=H1(Z),H.c(),H.m(d,null)):H&&(H.d(1),H=null),_e&1&&z!==(z=(Z[7]?"":Z[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&xt(I,z),_e&2&&ue(e,"data-selected",Z[1]),_e&2&&Gt(e,"selected",Z[1])},i:lt,o:lt,d(Z){Z&&G(e),q.d(),H&&H.d(),L=!1,sr(B)}}}function xL(r,e,t){var B;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:s}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const g=(B=o.properties)==null?void 0:B.categories;let y,x,C=0,T=o.place_type[0]==="reverse";function E(){x&&d.add(x),t(10,C++,C)}function z(O){Sn.call(this,r,O)}function I(O){Sn.call(this,r,O)}const L=()=>E();return r.$$set=O=>{"feature"in O&&t(0,o=O.feature),"selected"in O&&t(1,u=O.selected),"showPlaceType"in O&&t(2,s=O.showPlaceType),"missingIconsCache"in O&&t(9,d=O.missingIconsCache),"iconsBaseUrl"in O&&t(3,p=O.iconsBaseUrl)},r.$$.update=()=>{var O,Y,q,H;if(r.$$.dirty&3640)do t(11,n--,n),t(4,y=g==null?void 0:g[n]),t(5,x=y?p+y.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!x||d.has(x)));r.$$.dirty&1&&t(6,i=((Y=(O=o.properties)==null?void 0:O.categories)==null?void 0:Y.join(", "))??((H=(q=o.properties)==null?void 0:q.place_type_name)==null?void 0:H[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,s,p,y,x,i,T,E,d,C,n,z,I,L]}class AL extends Tt{constructor(e){super(),Ct(this,e,xL,wL,wt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function kL(r){let e;return{c(){e=j("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ue(e,"class","svelte-7cmwmc")},m(t,n){W(t,e,n)},p:lt,i:lt,o:lt,d(t){t&&G(e)}}}class SL extends Tt{constructor(e){super(),Ct(this,e,null,kL,wt,{})}}function CL(r){let e,t;return{c(){e=bs("svg"),t=bs("path"),ue(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ue(e,"viewBox","0 0 60.006 21.412"),ue(e,"width","14"),ue(e,"height","20"),ue(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),D(e,t)},p:lt,i:lt,o:lt,d(n){n&&G(e)}}}class TL extends Tt{constructor(e){super(),Ct(this,e,null,CL,wt,{})}}function ML(r){let e,t,n;return{c(){e=bs("svg"),t=bs("circle"),n=bs("path"),ue(t,"cx","4.789"),ue(t,"cy","4.787"),ue(t,"r","3.85"),ue(t,"class","svelte-1aq105l"),ue(n,"d","M12.063 12.063 7.635 7.635"),ue(n,"class","svelte-1aq105l"),ue(e,"xmlns","http://www.w3.org/2000/svg"),ue(e,"width","13"),ue(e,"height","13"),ue(e,"viewBox","0 0 13 13"),ue(e,"class","svelte-1aq105l")},m(i,o){W(i,e,o),D(e,t),D(e,n)},p:lt,i:lt,o:lt,d(i){i&&G(e)}}}class EL extends Tt{constructor(e){super(),Ct(this,e,null,ML,wt,{})}}function LL(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function G1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let bf;async function IL(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(bf&&i.cachedLocationExpiry&&bf.time+i.cachedLocationExpiry>Date.now()){if(!bf.coords)break e;return bf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(bf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const PL=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,W1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Z1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,X1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,K1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,J1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function zL(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i}° ${u}, ${o}° ${s}`);const p=Math.floor(i),g=Math.floor(o),y=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=Y1(y,3).toFixed(3).padStart(6,"0"),T=Y1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),d=`${p}° ${C}' ${u}, ${g}° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(y),T=Math.floor(x);let E=((y-C)*60).toFixed(1).padStart(4,"0"),z=((x-T)*60).toFixed(1).padStart(4,"0");const I=C.toString().padStart(2,"0"),L=T.toString().padStart(2,"0");E.endsWith(".0")&&z.endsWith(".0")&&(E=E.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),d=`${p}° ${I}' ${E}" ${u}, ${g}° ${L}' ${z}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function Y1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function m_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(PL.test(r))throw new Error("invalid coordinate value");if(W1.test(r))if(s=W1.exec(r),d=wf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(Z1.test(r))if(s=Z1.exec(r),d=wf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(X1.test(r))if(s=X1.exec(r),d=wf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(K1.test(r))if(s=K1.exec(r),d=wf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(J1.test(r)){if(s=J1.exec(r),d=wf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let y,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const I=Math.floor(r.length/2);y=g.substring(0,I).trim(),x=g.substring(I).trim()}else{let I;T.length%2==1?I=Math.floor(T.length/2):I=T.length/2-1;let L=0;if(I==0)L=g.indexOf(T[0]),y=g.substring(0,L).trim(),x=g.substring(L+1).trim();else{let B=0,O=0;for(;B<=I;)L=g.indexOf(T[B],O),O=L+1,B++;y=g.substring(0,L).trim(),x=g.substring(L+1).trim()}}const E=y.split(".");if(E.length==2&&E[1]==0&&E[1].length!=2)throw new Error("invalid coordinates format");const z=x.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:y,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:DL,toCoordinateFormat:zL})}else throw new Error("coordinates pattern match failed")}function wf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function Q1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function DL(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return Q1(this.decimalLatitude,Number(e[0]))&&Q1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const RL=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});m_.to=RL;const BL=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],FL={decimalLatitude:40.123,decimalLongitude:-74.123},OL=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],$L=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function NL(){const r=[];return BL.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...FL})}),[...r,...OL,...$L]}const jL=NL();m_.formats=jL.map(r=>r.verbatimCoordinates);const UL=m_;function ev(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function tv(r){let e,t;return e=new SL({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function nv(r){let e,t,n,i,o;return t=new TL({}),{c(){e=j("button"),ae(t.$$.fragment),ue(e,"type","button"),ue(e,"title",r[9]),ue(e,"class","svelte-bz0zu3"),Gt(e,"active",r[0])},m(u,s){W(u,e,s),oe(t,e,null),n=!0,i||(o=St(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&ue(e,"title",u[9]),(!n||s[0]&1)&&Gt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){V(t.$$.fragment,u),n=!1},d(u){u&&G(e),se(t),i=!1,o()}}}function VL(r){let e,t=[],n=new Map,i,o,u,s=On(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=ev(r,s,p),y=d(g);n.set(y,t[p]=rv(y,g))}return{c(){e=j("ul");for(let p=0;p<t.length;p+=1)t[p].c();ue(e,"class","options svelte-bz0zu3")},m(p,g){W(p,e,g);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(u=[St(e,"mouseleave",r[73]),St(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=On(p[14]),Xt(),t=hk(t,g,d,1,p,s,n,e,fk,rv,null,ev),Kt())},i(p){if(!i){for(let g=0;g<s.length;g+=1)N(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)V(t[g]);i=!1},d(p){p&&G(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,sr(u)}}}function qL(r){let e,t,n,i,o,u;return t=new H2({}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("div"),o=Te(r[7]),ue(i,"class","svelte-bz0zu3"),ue(e,"class","no-results svelte-bz0zu3")},m(s,d){W(s,e,d),oe(t,e,null),D(e,n),D(e,i),D(i,o),u=!0},p(s,d){(!u||d[0]&128)&&xt(o,s[7])},i(s){u||(N(t.$$.fragment,s),u=!0)},o(s){V(t.$$.fragment,s),u=!1},d(s){s&&G(e),se(t)}}}function HL(r){let e="",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p:lt,i:lt,o:lt,d(n){n&&G(t)}}}function GL(r){let e,t,n,i,o,u,s,d,p,g,y;return t=new H2({}),d=new q2({}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("div"),o=Te(r[6]),u=ne(),s=j("button"),ae(d.$$.fragment),ue(i,"class","svelte-bz0zu3"),ue(s,"class","svelte-bz0zu3"),ue(e,"class","error svelte-bz0zu3")},m(x,C){W(x,e,C),oe(t,e,null),D(e,n),D(e,i),D(i,o),D(e,u),D(e,s),oe(d,s,null),p=!0,g||(y=St(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&xt(o,x[6])},i(x){p||(N(t.$$.fragment,x),N(d.$$.fragment,x),p=!0)},o(x){V(t.$$.fragment,x),V(d.$$.fragment,x),p=!1},d(x){x&&G(e),se(t),se(d),g=!1,y()}}}function rv(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new AL({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=rr(),ae(n.$$.fragment),this.first=t},m(s,d){W(s,t,d),oe(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(N(n.$$.fragment,s),i=!0)},o(s){V(n.$$.fragment,s),i=!1},d(s){s&&G(t),se(n,s)}}}function WL(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q=!1;o=new EL({}),y=new q2({});let H=r[19]&&tv(),Z=r[5]==="button"&&nv(r);const _e=r[61].default,Ie=vn(_e,r,r[60],null),J=[GL,HL,qL,VL],fe=[];function Ee(ye,Oe){var Ue,De;return ye[18]?0:ye[16]?((Ue=ye[14])==null?void 0:Ue.length)===0?2:ye[16]&&((De=ye[14])!=null&&De.length)?3:-1:1}return~(z=Ee(r))&&(I=fe[z]=J[z](r)),{c(){e=ne(),t=j("form"),n=j("div"),i=j("button"),ae(o.$$.fragment),u=ne(),s=j("input"),d=ne(),p=j("div"),g=j("button"),ae(y.$$.fragment),x=ne(),H&&H.c(),C=ne(),Z&&Z.c(),T=ne(),Ie&&Ie.c(),E=ne(),I&&I.c(),ue(i,"class","search-button svelte-bz0zu3"),ue(i,"type","button"),ue(s,"placeholder",r[8]),ue(s,"aria-label",r[8]),ue(s,"class","svelte-bz0zu3"),ue(g,"type","button"),ue(g,"title",r[3]),ue(g,"class","svelte-bz0zu3"),ue(p,"class","clear-button-container svelte-bz0zu3"),Gt(p,"displayable",r[1]!==""),ue(n,"class","input-group svelte-bz0zu3"),ue(t,"tabindex","0"),ue(t,"class",L=Yu(r[2])+" svelte-bz0zu3"),Gt(t,"can-collapse",r[4]&&r[1]==="")},m(ye,Oe){W(ye,e,Oe),W(ye,t,Oe),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),r[63](s),Nn(s,r[1]),D(n,d),D(n,p),D(p,g),oe(y,g,null),D(p,x),H&&H.m(p,null),D(n,C),Z&&Z.m(n,null),D(n,T),Ie&&Ie.m(n,null),D(t,E),~z&&fe[z].m(t,null),B=!0,O||(Y=[St(i,"click",r[62]),St(s,"input",r[64]),St(s,"focus",r[65]),St(s,"blur",r[66]),St(s,"keydown",r[22]),St(s,"input",r[67]),St(g,"click",r[68]),St(t,"submit",Pg(r[21]))],O=!0)},p(ye,Oe){(!B||Oe[0]&256)&&ue(s,"placeholder",ye[8]),(!B||Oe[0]&256)&&ue(s,"aria-label",ye[8]),Oe[0]&2&&s.value!==ye[1]&&Nn(s,ye[1]),(!B||Oe[0]&8)&&ue(g,"title",ye[3]),ye[19]?H?Oe[0]&524288&&N(H,1):(H=tv(),H.c(),N(H,1),H.m(p,null)):H&&(Xt(),V(H,1,1,()=>{H=null}),Kt()),(!B||Oe[0]&2)&&Gt(p,"displayable",ye[1]!==""),ye[5]==="button"?Z?(Z.p(ye,Oe),Oe[0]&32&&N(Z,1)):(Z=nv(ye),Z.c(),N(Z,1),Z.m(n,T)):Z&&(Xt(),V(Z,1,1,()=>{Z=null}),Kt()),Ie&&Ie.p&&(!B||Oe[1]&536870912)&&wn(Ie,_e,ye,ye[60],B?bn(_e,ye[60],Oe,null):xn(ye[60]),null);let Ue=z;z=Ee(ye),z===Ue?~z&&fe[z].p(ye,Oe):(I&&(Xt(),V(fe[Ue],1,1,()=>{fe[Ue]=null}),Kt()),~z?(I=fe[z],I?I.p(ye,Oe):(I=fe[z]=J[z](ye),I.c()),N(I,1),I.m(t,null)):I=null),(!B||Oe[0]&4&&L!==(L=Yu(ye[2])+" svelte-bz0zu3"))&&ue(t,"class",L),(!B||Oe[0]&22)&&Gt(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){B||(N(q),N(o.$$.fragment,ye),N(y.$$.fragment,ye),N(H),N(Z),N(Ie,ye),N(I),B=!0)},o(ye){V(q),V(o.$$.fragment,ye),V(y.$$.fragment,ye),V(H),V(Z),V(Ie,ye),V(I),B=!1},d(ye){ye&&(G(e),G(t)),se(o),r[63](null),se(y),H&&H.d(),Z&&Z.d(),Ie&&Ie.d(ye),~z&&fe[z].d(),O=!1,sr(Y)}}}function ZL(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:E=200}=e,{enableReverse:z="never"}=e,{errorMessage:I="Something went wrong…"}=e,{filter:L=()=>!0}=e,{flyTo:B=!0}=e,{fuzzyMatch:O=!0}=e,{language:Y=void 0}=e,{limit:q=void 0}=e,{mapController:H=void 0}=e,{minLength:Z=2}=e,{noResultsMessage:_e="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ie="Search"}=e,{proximity:J=[{type:"server-geolocation"}]}=e,{reverseActive:fe=z==="always"}=e,{reverseButtonTitle:Ee="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:Oe="full-geometry"}=e,{showPlaceType:Ue="if-needed"}=e,{showResultsWhileTyping:De=!0}=e,{selectFirst:xe=!0}=e,{flyToSelected:et=!1}=e,{markerOnSelected:Ze=!0}=e,{types:Qe=void 0}=e,{exhaustiveReverseGeocoding:ct=!1}=e,{excludeTypes:dt=!1}=e,{zoom:Je=s}=e,{apiUrl:yt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Et={}}=e,{iconsBaseUrl:Ot="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Yt=()=>{}}=e;function tn(){Pe.focus()}function Qt(){Pe.blur()}function fn(ie,Ye=!0,nt=!1){t(1,ye=ie),Ye?(t(15,tt=-1),_t()):(vt(!nt,nt),setTimeout(()=>{Pe.focus(),Pe.select()}))}function pn(){t(14,mt=void 0),t(56,he=void 0),t(15,tt=-1)}function He(){t(55,Pt=[]),t(56,he=void 0)}let We=!1,mt,Pt,he,nn="",Pe,tt=-1,jt,Gn=[],Un,jn,Wt,An;const ti=new Set,Bn=$s();ei(()=>{H&&(H.setEventHandler(void 0),H.indicateReverse(!1),H.setSelectedMarker(-1),H.setFeatures(void 0,void 0,!1))});function _t(ie){if(jn&&(clearTimeout(jn),jn=void 0),tt>-1&&mt)t(56,he=mt[tt]),t(1,ye=he.place_type[0]==="reverse"?he.place_name:he.place_name.replace(/,.*/,"")),t(18,jt=void 0),t(55,Pt=void 0),t(15,tt=-1);else if(ye){const Ye=ie||!mr(ye);ar(ye,{exact:!0}).then(()=>{t(55,Pt=mt),t(56,he=void 0),Ye&&gi()}).catch(nt=>t(18,jt=nt))}}function mr(ie){try{return UL(ie,6)}catch{return!1}}async function ar(ie,{byId:Ye=!1,exact:nt=!1}={}){t(18,jt=void 0),Un==null||Un.abort();const it=new AbortController;t(19,Un=it);try{const ft=mr(ie),zt=new URLSearchParams;if(Y!==void 0&&zt.set("language",Array.isArray(Y)?Y.join(","):Y??""),Qe&&zt.set("types",Qe.join(",")),dt&&zt.set("excludeTypes",String(dt)),g&&zt.set("bbox",g.map(qn=>qn.toFixed(6)).join(",")),T&&zt.set("country",Array.isArray(T)?T.join(","):T),!Ye&&!ft){const qn=await IL(H,J,it);qn&&zt.set("proximity",qn),(nt||!De)&&zt.set("autocomplete","false"),zt.set("fuzzyMatch",String(O))}q!==void 0&&(ct||!ft||(Qe==null?void 0:Qe.length)===1)&&zt.set("limit",String(q)),zt.set("key",p),Yt(zt);const on=yt+"/"+encodeURIComponent(ft?ft.decimalLongitude+","+ft.decimalLatitude:ie)+".json?"+zt.toString();if(on===nn){Ye?(t(14,mt=void 0),t(56,he=Gn[0])):t(14,mt=Gn);return}nn=on;const mn=await fetch(on,{signal:it.signal,...Et});if(!mn.ok)throw new Error(await mn.text());const Ln=await mn.json();Bn("response",{url:on,featureCollection:Ln}),Ye?(t(14,mt=void 0),t(56,he=Ln.features[0]),Gn=[he]):(t(14,mt=Ln.features.filter(L)),ft&&mt.unshift({type:"Feature",properties:{},id:"reverse_"+ft.decimalLongitude+"_"+ft.decimalLatitude,text:ft.decimalLatitude+", "+ft.decimalLongitude,place_name:ft.decimalLatitude+", "+ft.decimalLongitude,place_type:["reverse"],center:[ft.decimalLongitude,ft.decimalLatitude],bbox:[ft.decimalLongitude,ft.decimalLatitude,ft.decimalLongitude,ft.decimalLatitude],geometry:{type:"Point",coordinates:[ft.decimalLongitude,ft.decimalLatitude]}}),Gn=mt,ft&&Pe.focus())}catch(ft){if(ft&&typeof ft=="object"&&"name"in ft&&ft.name==="AbortError")return;throw ft}finally{it===Un&&t(19,Un=void 0)}}function gi(){var it;if(!(Pt!=null&&Pt.length)||!B)return;const ie=[180,90,-180,-90],Ye=!Pt.some(ft=>!ft.matching_text);let nt;for(const ft of Pt){const zt=Vn(ft);if(nt=nt===void 0?zt:zt===void 0?nt:Math.max(nt,zt),Ye||!ft.matching_text)for(const on of[0,1,2,3])ie[on]=Math[on<2?"min":"max"](ie[on],((it=ft.bbox)==null?void 0:it[on])??ft.center[on%2])}H&&Pt.length>0&&(he&&ie[0]===ie[2]&&ie[1]===ie[3]?H.flyTo(he.center,Vn(he)):H.fitBounds(G1(ie),50,nt))}function Vn(ie){var nt;if(!ie.bbox||ie.bbox[0]!==ie.bbox[2]&&ie.bbox[1]!==ie.bbox[3])return;const Ye=ie.id.replace(/\..*/,"");return(Array.isArray((nt=ie.properties)==null?void 0:nt.categories)?ie.properties.categories.reduce((it,ft)=>{const zt=Je[Ye+"."+ft];return it===void 0?zt:zt===void 0?it:Math.max(it,zt)},void 0):void 0)??Je[Ye]}function $e(ie){t(0,fe=z==="always"),t(14,mt=void 0),t(56,he=void 0),t(15,tt=-1),fn(ie[1].toFixed(6)+", "+LL(ie[0],[-180,180],!0).toFixed(6),!1,!0)}function pt(ie){if(!mt)return;let Ye=ie.key==="ArrowDown"?1:ie.key==="ArrowUp"?-1:0;Ye&&(tt===(xe?0:-1)&&Ye===-1&&t(15,tt=mt.length),t(15,tt+=Ye),tt>=mt.length&&t(15,tt=-1),tt<0&&xe&&t(15,tt=0),ie.preventDefault())}function vt(ie=!0,Ye=!1){if(t(18,jt=void 0),De||Ye){if(jn&&clearTimeout(jn),ye.length<Z)return;const nt=ye;jn=window.setTimeout(()=>{ar(nt).catch(it=>t(18,jt=it))},ie?E:0)}else t(14,mt=void 0),t(18,jt=void 0)}function Dt(ie){t(56,he=ie),t(1,ye=ie.place_name),t(15,tt=-1)}const rn=()=>Pe.focus();function en(ie){_n[ie?"unshift":"push"](()=>{Pe=ie,t(17,Pe)})}function br(){ye=this.value,t(1,ye),t(13,We),t(28,x)}const lr=()=>t(13,We=!0),Se=()=>t(13,We=!1),re=()=>vt(),ce=()=>{t(1,ye=""),Pe.focus()},me=()=>t(0,fe=!fe),we=()=>t(18,jt=void 0),Ne=ie=>t(15,tt=ie),je=ie=>Dt(ie),qe=()=>{xe||t(15,tt=-1)},Re=()=>{};return r.$$set=ie=>{"class"in ie&&t(2,d=ie.class),"apiKey"in ie&&t(26,p=ie.apiKey),"bbox"in ie&&t(27,g=ie.bbox),"clearButtonTitle"in ie&&t(3,y=ie.clearButtonTitle),"clearOnBlur"in ie&&t(28,x=ie.clearOnBlur),"collapsed"in ie&&t(4,C=ie.collapsed),"country"in ie&&t(29,T=ie.country),"debounceSearch"in ie&&t(30,E=ie.debounceSearch),"enableReverse"in ie&&t(5,z=ie.enableReverse),"errorMessage"in ie&&t(6,I=ie.errorMessage),"filter"in ie&&t(31,L=ie.filter),"flyTo"in ie&&t(32,B=ie.flyTo),"fuzzyMatch"in ie&&t(33,O=ie.fuzzyMatch),"language"in ie&&t(34,Y=ie.language),"limit"in ie&&t(35,q=ie.limit),"mapController"in ie&&t(36,H=ie.mapController),"minLength"in ie&&t(37,Z=ie.minLength),"noResultsMessage"in ie&&t(7,_e=ie.noResultsMessage),"placeholder"in ie&&t(8,Ie=ie.placeholder),"proximity"in ie&&t(38,J=ie.proximity),"reverseActive"in ie&&t(0,fe=ie.reverseActive),"reverseButtonTitle"in ie&&t(9,Ee=ie.reverseButtonTitle),"searchValue"in ie&&t(1,ye=ie.searchValue),"pickedResultStyle"in ie&&t(39,Oe=ie.pickedResultStyle),"showPlaceType"in ie&&t(10,Ue=ie.showPlaceType),"showResultsWhileTyping"in ie&&t(40,De=ie.showResultsWhileTyping),"selectFirst"in ie&&t(11,xe=ie.selectFirst),"flyToSelected"in ie&&t(41,et=ie.flyToSelected),"markerOnSelected"in ie&&t(42,Ze=ie.markerOnSelected),"types"in ie&&t(43,Qe=ie.types),"exhaustiveReverseGeocoding"in ie&&t(44,ct=ie.exhaustiveReverseGeocoding),"excludeTypes"in ie&&t(45,dt=ie.excludeTypes),"zoom"in ie&&t(46,Je=ie.zoom),"apiUrl"in ie&&t(47,yt=ie.apiUrl),"fetchParameters"in ie&&t(48,Et=ie.fetchParameters),"iconsBaseUrl"in ie&&t(12,Ot=ie.iconsBaseUrl),"adjustUrlQuery"in ie&&t(49,Yt=ie.adjustUrlQuery),"$$scope"in ie&&t(60,u=ie.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,fe=z==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Wt=We),x&&!We&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<Z&&(t(56,he=void 0),t(14,mt=void 0),t(18,jt=void 0),t(55,Pt=mt)),r.$$.dirty[1]&33554688&&Oe!=="marker-only"&&he&&!he.address&&he.geometry.type==="Point"&&he.place_type[0]!=="reverse"&&ar(he.id,{byId:!0}).catch(ie=>t(18,jt=ie)),r.$$.dirty[1]&100663330&&(H&&he&&he.id!==An&&B&&(!he.bbox||he.bbox[0]===he.bbox[2]&&he.bbox[1]===he.bbox[3]?H.flyTo(he.center,Vn(he)):H.fitBounds(G1(he.bbox),50,Vn(he)),t(14,mt=void 0),t(55,Pt=void 0),t(15,tt=-1)),t(57,An=he==null?void 0:he.id)),r.$$.dirty[0]&18432&&xe&&mt!=null&&mt.length&&t(15,tt=0),r.$$.dirty[0]&2&&t(15,tt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Pt!==mt&&t(55,Pt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&H&&H.setEventHandler(ie=>{switch(ie.type){case"mapClick":fe&&$e(ie.coordinates);break;case"markerClick":{const Ye=mt==null?void 0:mt.find(nt=>nt.id===ie.id);Ye&&Dt(Ye)}break;case"markerMouseEnter":Pt&&t(15,tt=Wt?(mt==null?void 0:mt.findIndex(Ye=>Ye.id===ie.id))??-1:-1);break;case"markerMouseLeave":Pt&&t(15,tt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=mt==null?void 0:mt[tt]),r.$$.dirty[1]&134218786&&H&&i&&B&&et&&H.flyTo(i.center,Vn(i)),r.$$.dirty[1]&256&&t(59,n=Oe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ze||H==null||H.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&H&&Ze&&!Pt&&(H.setFeatures(i?[i]:void 0,void 0,n),H.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&H&&H.setFeatures(Pt,he,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Pt&&H&&H.setSelectedMarker(tt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&H){const ie=mr(ye);H.setReverseMarker(ie?[ie.decimalLongitude,ie.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Bn("select",{feature:i}),r.$$.dirty[1]&33554432&&Bn("pick",{feature:he}),r.$$.dirty[0]&81920&&Bn("optionsvisibilitychange",{optionsVisible:Wt&&!!mt}),r.$$.dirty[0]&16384&&Bn("featureslisted",{features:mt}),r.$$.dirty[1]&16777216&&Bn("featuresmarked",{features:Pt}),r.$$.dirty[0]&1&&Bn("reversetoggle",{reverse:fe}),r.$$.dirty[0]&2&&Bn("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&H&&H.indicateReverse(fe)},[fe,ye,d,y,C,z,I,_e,Ie,Ee,Ue,xe,Ot,We,mt,tt,Wt,Pe,jt,Un,ti,_t,pt,vt,Dt,s,p,g,x,T,E,L,B,O,Y,q,H,Z,J,Oe,De,et,Ze,Qe,ct,dt,Je,yt,Et,Yt,tn,Qt,fn,pn,He,Pt,he,An,i,n,u,o,rn,en,br,lr,Se,re,ce,me,we,Ne,je,qe,Re]}class XL extends Tt{constructor(e){super(),Ct(this,e,ZL,WL,wt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function iv(r){let e,t,n;return t=new XL({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"class","svelte-ixhnie")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function KL(r){let e,t,n=r[2]&&iv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=iv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function JL(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?V2(p,Qr,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,s,o]}class YL extends Tt{constructor(e){super(),Ct(this,e,JL,KL,wt,{apiKey:0,map:4,country:1})}}const QL=Symbol.for("svelte-maplibre");function eI(){return Yf(QL)}function tI(r){return"layerType"in r&&r.layerType==="deckgl"}const nI=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),ov=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function sv(r){let e,t,n=(r[4]||r[3]instanceof Qr.Marker)&&av(r);return{c(){e=j("div"),n&&n.c()},m(i,o){W(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof Qr.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=av(i),n.c(),N(n,1),n.m(e,null)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(),r[32](null)}}}function av(r){let e;const t=r[30].default,n=vn(t,r,r[29],ov);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,nI):xn(i[29]),ov)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function rI(r){let e,t,n=r[9].default&&sv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=sv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function iI(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const y=Ig(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:E=!1}=e,{openOn:z="click"}=e,{openIfTopMost:I=!0}=e,{focusAfterOpen:L=!0}=e,{anchor:B=void 0}=e,{offset:O=void 0}=e,{popupClass:Y=void 0}=e,{maxWidth:q=void 0}=e,{lngLat:H=void 0}=e,{html:Z=void 0}=e,{open:_e=!1}=e;const Ie=$s(),{map:J,popupTarget:fe,layerEvent:Ee,layer:ye,eventTopMost:Oe}=eI();st(r,J,We=>t(2,o=We)),st(r,fe,We=>t(3,s=We)),st(r,Ee,We=>t(28,u=We)),st(r,ye,We=>t(35,d=We));const Ue=["click","dblclick","contextmenu"];let De,xe=!1,et;function Ze(){if(!De)return;let We=De.getElement();!We||We===et||(et=We,z==="hover"&&(et.style.pointerEvents="none"),et.addEventListener("mouseenter",()=>{t(24,xe=!0)},{passive:!0}),et.addEventListener("mouseleave",()=>{t(24,xe=!1)},{passive:!0}),et.addEventListener("click",()=>{T&&t(0,_e=!1)},{passive:!0}))}ls(()=>{if(o)return o.on("click",Qt),o.on("contextmenu",Qt),typeof s=="string"&&(o.on("click",s,Je),o.on("dblclick",s,Je),o.on("contextmenu",s,Je),o.on("mousemove",s,tn),o.on("mouseleave",s,Yt),o.on("touchstart",s,Et),o.on("touchend",s,Ot)),()=>{o!=null&&o.loaded()&&(De==null||De.remove(),o.off("click",Qt),o.off("contextmenu",Qt),s instanceof Qr.Marker?s.getPopup()===De&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Je),o.off("dblclick",s,Je),o.off("contextmenu",s,Je),o.off("mousemove",s,tn),o.off("mouseleave",s,Yt),o.off("touchstart",s,Et),o.off("touchend",s,Ot)))}});function Qe(We){return I?!("marker"in We)&&!tI(We)&&Oe(We)!==d:!1}let ct=null,dt="normal";function Je(We){We.type===z&&(Qe(We)||("layerType"in We?We.layerType==="deckgl"?(t(10,H=We.coordinate),t(4,ct=We.object?[We.object]:null)):(t(10,H=We.lngLat),t(4,ct=We.features??[])):(t(10,H=We.lngLat),t(4,ct=We.features??[])),setTimeout(()=>t(0,_e=!0))))}let yt=null;function Et(We){yt=We.point}function Ot(We){if(!yt||z!=="hover")return;let mt=yt.dist(We.point);yt=null,mt<3&&(t(10,H=We.lngLat),t(4,ct=We.features??[]),De.isOpen()?t(25,dt="justOpened"):(t(25,dt="opening"),t(0,_e=!0)))}function Yt(We){z!=="hover"||yt||dt!=="normal"||(t(0,_e=!1),t(4,ct=null))}function tn(We){if(!(z!=="hover"||yt||dt!=="normal")){if(Qe(We)){t(0,_e=!1),t(4,ct=null);return}t(0,_e=!0),t(4,ct=We.features??[]),t(10,H=We.lngLat)}}function Qt(We){if(dt==="justOpened"){t(25,dt="normal");return}if(!C)return;let mt=[et,s instanceof Qr.Marker?s==null?void 0:s.getElement():null];_e&&De.isOpen()&&!mt.some(Pt=>Pt==null?void 0:Pt.contains(We.originalEvent.target))&&(We.type==="contextmenu"&&z==="contextmenu"||We.type!=="contextmenu")&&t(0,_e=!1)}ei(()=>{o&&(De!=null&&De.isOpen())&&De.remove()});let fn;const pn=()=>t(0,_e=!1);function He(We){_n[We?"unshift":"push"](()=>{fn=We,t(1,fn)})}return r.$$set=We=>{"closeButton"in We&&t(11,x=We.closeButton),"closeOnClickOutside"in We&&t(12,C=We.closeOnClickOutside),"closeOnClickInside"in We&&t(13,T=We.closeOnClickInside),"closeOnMove"in We&&t(14,E=We.closeOnMove),"openOn"in We&&t(15,z=We.openOn),"openIfTopMost"in We&&t(16,I=We.openIfTopMost),"focusAfterOpen"in We&&t(17,L=We.focusAfterOpen),"anchor"in We&&t(18,B=We.anchor),"offset"in We&&t(19,O=We.offset),"popupClass"in We&&t(20,Y=We.popupClass),"maxWidth"in We&&t(21,q=We.maxWidth),"lngLat"in We&&t(10,H=We.lngLat),"html"in We&&t(22,Z=We.html),"open"in We&&t(0,_e=We.open),"$$scope"in We&&t(29,g=We.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(De||(t(23,De=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:E,focusAfterOpen:L,maxWidth:q,className:Y,anchor:B,offset:O})),et=De.getElement(),De.on("open",()=>{t(0,_e=!0),Ze(),Ie("open",De)}),De.on("close",()=>{t(0,_e=!1),Ie("close",De)}),De.on("hover",()=>{Ie("hover",De)}))),r.$$.dirty[0]&8421384&&De&&s instanceof Qr.Marker&&(z==="click"?s.setPopup(De):s.getPopup()===De&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ue.includes(z)&&(u==null?void 0:u.type)===z&&(Je(u),an(Ee,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=z==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&z==="hover"&&Ee&&(i&&u&&(u.layerType==="deckgl"?(t(10,H=u.coordinate),t(4,ct=u.object?[u.object]:null)):(t(10,H=u.lngLat),t(4,ct=u.features??[]))),t(0,_e=(i||xe)??!1)),r.$$.dirty[0]&12582914&&(fn?De.setDOMContent(fn):Z&&De.setHTML(Z)),r.$$.dirty[0]&8389632&&H&&De.setLngLat(H),r.$$.dirty[0]&41943045&&o){let We=De.isOpen();_e&&!We?(De.addTo(o),dt==="opening"&&t(25,dt="justOpened")):!_e&&We&&De.remove()}},[_e,fn,o,s,ct,J,fe,Ee,ye,y,H,x,C,T,E,z,I,L,B,O,Y,q,Z,De,xe,dt,i,n,u,g,p,pn,He]}class oI extends Tt{constructor(e){super(),Ct(this,e,iI,rI,wt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const sI=r=>({props:r&8}),lv=r=>({props:uI(r[3])});function aI(r){let e;const t=r[1].default,n=vn(t,r,r[2],lv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&wn(n,t,i,i[2],e?bn(t,i[2],o,sI):xn(i[2]),lv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function lI(r){let e,t;return e=new oI({props:{openOn:r[0],$$slots:{default:[aI,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function uI(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function cI(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class pi extends Tt{constructor(e){super(),Ct(this,e,cI,lI,wt,{openOn:0})}}function Oo(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function Bi(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Fi(){return{type:"FeatureCollection",features:[]}}function uv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function cv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function fv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function hv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function dv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function pv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function fI(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function mv(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Te(t),e.__value=r[18],Nn(e,e.__value)},m(i,o){W(i,e,o),D(e,n)},p:lt,d(i){i&&G(e)}}}function gv(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Te(t),e.__value=r[18],Nn(e,e.__value)},m(i,o){W(i,e,o),D(e,n)},p:lt,d(i){i&&G(e)}}}function _v(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Te(t),e.__value=r[18],Nn(e,e.__value)},m(i,o){W(i,e,o),D(e,n)},p:lt,d(i){i&&G(e)}}}function yv(r){let e,t=r[19]+"",n;return{c(){e=j("option"),n=Te(t),e.__value=r[18],Nn(e,e.__value)},m(i,o){W(i,e,o),D(e,n)},p:lt,d(i){i&&G(e)}}}function hI(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B=On(r[7]),O=[];for(let J=0;J<B.length;J+=1)O[J]=mv(pv(r,B,J));let Y=On(r[8]),q=[];for(let J=0;J<Y.length;J+=1)q[J]=gv(dv(r,Y,J));let H=On(r[9]),Z=[];for(let J=0;J<H.length;J+=1)Z[J]=_v(hv(r,H,J));let _e=On(r[10]),Ie=[];for(let J=0;J<_e.length;J+=1)Ie[J]=yv(fv(r,_e,J));return{c(){e=j("div"),t=j("label"),n=Te(`Trip purpose:
      `),i=j("select");for(let J=0;J<O.length;J+=1)O[J].c();o=ne(),u=j("label"),s=Te(`Scenario:
      `),d=j("select");for(let J=0;J<q.length;J+=1)q[J].c();p=ne(),g=j("label"),y=Te(`Network type:
      `),x=j("select");for(let J=0;J<Z.length;J+=1)Z[J].c();C=ne(),T=j("label"),E=Te(`Color by:
      `),z=j("select");for(let J=0;J<Ie.length;J+=1)Ie[J].c();r[0]===void 0&&Yo(()=>r[11].call(i)),r[1]===void 0&&Yo(()=>r[12].call(d)),r[2]===void 0&&Yo(()=>r[13].call(x)),r[3]===void 0&&Yo(()=>r[14].call(z)),ue(e,"slot","legend")},m(J,fe){W(J,e,fe),D(e,t),D(t,n),D(t,i);for(let Ee=0;Ee<O.length;Ee+=1)O[Ee]&&O[Ee].m(i,null);Ci(i,r[0],!0),D(e,o),D(e,u),D(u,s),D(u,d);for(let Ee=0;Ee<q.length;Ee+=1)q[Ee]&&q[Ee].m(d,null);Ci(d,r[1],!0),D(e,p),D(e,g),D(g,y),D(g,x);for(let Ee=0;Ee<Z.length;Ee+=1)Z[Ee]&&Z[Ee].m(x,null);Ci(x,r[2],!0),D(e,C),D(e,T),D(T,E),D(T,z);for(let Ee=0;Ee<Ie.length;Ee+=1)Ie[Ee]&&Ie[Ee].m(z,null);Ci(z,r[3],!0),I||(L=[St(i,"change",r[11]),St(d,"change",r[12]),St(x,"change",r[13]),St(z,"change",r[14])],I=!0)},p(J,fe){if(fe[0]&128){B=On(J[7]);let Ee;for(Ee=0;Ee<B.length;Ee+=1){const ye=pv(J,B,Ee);O[Ee]?O[Ee].p(ye,fe):(O[Ee]=mv(ye),O[Ee].c(),O[Ee].m(i,null))}for(;Ee<O.length;Ee+=1)O[Ee].d(1);O.length=B.length}if(fe[0]&129&&Ci(i,J[0]),fe[0]&256){Y=On(J[8]);let Ee;for(Ee=0;Ee<Y.length;Ee+=1){const ye=dv(J,Y,Ee);q[Ee]?q[Ee].p(ye,fe):(q[Ee]=gv(ye),q[Ee].c(),q[Ee].m(d,null))}for(;Ee<q.length;Ee+=1)q[Ee].d(1);q.length=Y.length}if(fe[0]&258&&Ci(d,J[1]),fe[0]&512){H=On(J[9]);let Ee;for(Ee=0;Ee<H.length;Ee+=1){const ye=hv(J,H,Ee);Z[Ee]?Z[Ee].p(ye,fe):(Z[Ee]=_v(ye),Z[Ee].c(),Z[Ee].m(x,null))}for(;Ee<Z.length;Ee+=1)Z[Ee].d(1);Z.length=H.length}if(fe[0]&516&&Ci(x,J[2]),fe[0]&1024){_e=On(J[10]);let Ee;for(Ee=0;Ee<_e.length;Ee+=1){const ye=fv(J,_e,Ee);Ie[Ee]?Ie[Ee].p(ye,fe):(Ie[Ee]=yv(ye),Ie[Ee].c(),Ie[Ee].m(z,null))}for(;Ee<Ie.length;Ee+=1)Ie[Ee].d(1);Ie.length=_e.length}fe[0]&1032&&Ci(z,J[3])},d(J){J&&G(e),di(O,J),di(q,J),di(Z,J),di(Ie,J),I=!1,sr(L)}}}function vv(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,y,x,C=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",T,E;return{c(){e=j("tr"),t=j("th"),t.textContent=`${r[19]}`,n=ne(),i=j("td"),u=Te(o),s=ne(),d=j("td"),g=Te(p),y=ne(),x=j("td"),T=Te(C),E=ne()},m(z,I){W(z,e,I),D(e,t),D(e,n),D(e,i),D(i,u),D(e,s),D(e,d),D(d,g),D(e,y),D(e,x),D(x,T),D(e,E)},p(z,I){I[0]&131072&&o!==(o=z[17][`${z[18]}_fastest_bicycle`].toLocaleString()+"")&&xt(u,o),I[0]&131072&&p!==(p=z[17][`${z[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&xt(g,p),I[0]&131072&&C!==(C=z[17][`${z[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&xt(T,C)},d(z){z&&G(e)}}}function bv(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,y,x,C=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",T,E;return{c(){e=j("tr"),t=j("th"),t.textContent=`${r[19]}`,n=ne(),i=j("td"),u=Te(o),s=ne(),d=j("td"),g=Te(p),y=ne(),x=j("td"),T=Te(C),E=ne()},m(z,I){W(z,e,I),D(e,t),D(e,n),D(e,i),D(i,u),D(e,s),D(e,d),D(d,g),D(e,y),D(e,x),D(x,T),D(e,E)},p(z,I){I[0]&131072&&o!==(o=z[17][`${z[18]}_quietest_bicycle`].toLocaleString()+"")&&xt(u,o),I[0]&131072&&p!==(p=z[17][`${z[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&xt(g,p),I[0]&131072&&C!==(C=z[17][`${z[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&xt(T,C)},d(z){z&&G(e)}}}function dI(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,s,d,p=r[17].gradient+"",g,y,x,C,T,E=r[17].quietness+"",z,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De=On(r[7]),xe=[];for(let Qe=0;Qe<De.length;Qe+=1)xe[Qe]=vv(cv(r,De,Qe));let et=On(r[7]),Ze=[];for(let Qe=0;Qe<et.length;Qe+=1)Ze[Qe]=bv(uv(r,et,Qe));return{c(){e=j("div"),t=j("p"),n=Te("Cyclists: "),o=Te(i),u=ne(),s=j("p"),d=Te("Gradient: "),g=Te(p),y=Te("%"),x=ne(),C=j("p"),T=Te("Cycle-friendliness: "),z=Te(E),I=Te("%"),L=ne(),B=j("details"),O=j("summary"),O.textContent="All network details",Y=ne(),q=j("p"),q.textContent="Fast/Direct network",H=ne(),Z=j("table"),_e=j("tr"),_e.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ie=ne();for(let Qe=0;Qe<xe.length;Qe+=1)xe[Qe].c();J=ne(),fe=j("p"),fe.textContent="Quiet/Indirect network",Ee=ne(),ye=j("table"),Oe=j("tr"),Oe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ue=ne();for(let Qe=0;Qe<Ze.length;Qe+=1)Ze[Qe].c();Xe(e,"max-width","30vw"),Xe(e,"max-height","60vh"),Xe(e,"overflow","auto")},m(Qe,ct){W(Qe,e,ct),D(e,t),D(t,n),D(t,o),D(e,u),D(e,s),D(s,d),D(s,g),D(s,y),D(e,x),D(e,C),D(C,T),D(C,z),D(C,I),D(e,L),D(e,B),D(B,O),D(B,Y),D(B,q),D(B,H),D(B,Z),D(Z,_e),D(Z,Ie);for(let dt=0;dt<xe.length;dt+=1)xe[dt]&&xe[dt].m(Z,null);D(B,J),D(B,fe),D(B,Ee),D(B,ye),D(ye,Oe),D(ye,Ue);for(let dt=0;dt<Ze.length;dt+=1)Ze[dt]&&Ze[dt].m(ye,null)},p(Qe,ct){if(ct[0]&131088&&i!==(i=Qe[17][Qe[4]].toLocaleString()+"")&&xt(o,i),ct[0]&131072&&p!==(p=Qe[17].gradient+"")&&xt(g,p),ct[0]&131072&&E!==(E=Qe[17].quietness+"")&&xt(z,E),ct[0]&131200){De=On(Qe[7]);let dt;for(dt=0;dt<De.length;dt+=1){const Je=cv(Qe,De,dt);xe[dt]?xe[dt].p(Je,ct):(xe[dt]=vv(Je),xe[dt].c(),xe[dt].m(Z,null))}for(;dt<xe.length;dt+=1)xe[dt].d(1);xe.length=De.length}if(ct[0]&131200){et=On(Qe[7]);let dt;for(dt=0;dt<et.length;dt+=1){const Je=uv(Qe,et,dt);Ze[dt]?Ze[dt].p(Je,ct):(Ze[dt]=bv(Je),Ze[dt].c(),Ze[dt].m(ye,null))}for(;dt<Ze.length;dt+=1)Ze[dt].d(1);Ze.length=et.length}},d(Qe){Qe&&G(e),di(xe,Qe),di(Ze,Qe)}}}function pI(r){let e,t;return e=new pi({props:{openOn:"click",$$slots:{default:[dI,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function mI(r){let e,t;const n=[yn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":wv(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[pI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s=u[0]&112?Tn(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":wv(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function gI(r){let e,t,n,i,o;function u(d){r[15](d)}let s={label:"Estimated cycling demand",$$slots:{legend:[hI],help:[fI]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new rs({props:s}),_n.push(()=>Rn(e,"show",u)),i=new sh({props:{url:`pmtiles://${ys("cnt/layers/route_network.pmtiles")}`,$$slots:{default:[mI]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment)},m(d,p){oe(e,d,p),W(d,n,p),oe(i,d,p),o=!0},p(d,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,g.show=d[5],Dn(()=>t=!1)),e.$set(g);const y={};p[0]&112|p[1]&2&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),se(e,d),se(i,d)}}}function wv(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function _I(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function yI(r,e,t){let n,i,o=!1,u="all",s="bicycle_go_dutch",d="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],y=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],x=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],C=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],T={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function E(){u=ia(this),t(0,u),t(7,g)}function z(){s=ia(this),t(1,s),t(8,y)}function I(){d=ia(this),t(2,d),t(9,x)}function L(){p=ia(this),t(3,p),t(10,C)}function B(O){o=O,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${s}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:_I(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Bi(["abs",["get","gradient"]],T.limits,T.colorScale)}[p])},[u,s,d,p,n,o,i,g,y,x,C,E,z,I,L,B]}class vI extends Tt{constructor(e){super(),Ct(this,e,yI,gI,wt,{},null,[-1,-1])}}function bI(r){let e,t,n;return t=new Bg({props:{labelColors:r[5]}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","legend")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p:lt,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function wI(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function xI(r){let e,t,n;return t=new fo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","legend")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p:lt,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function AI(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function kI(r){let e,t,n;return t=new fo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","legend")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p:lt,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function SI(r){let e;return{c(){e=j("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function CI(r){let e,t,n,i,o,u;const s=[yn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Oo(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":na(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let C=0;C<s.length;C+=1)d=Mt(d,s[C]);e=new hr({props:d});const p=[yn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Oo(["get","Level of Service"],r[4],"cyan"),"line-width":na(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let C=0;C<p.length;C+=1)g=Mt(g,p[C]);n=new hr({props:g});const y=[yn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Oo(["get","Infrastructure type"],r[5],"cyan"),"line-width":na(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={};for(let C=0;C<y.length;C+=1)x=Mt(x,y[C]);return o=new hr({props:x}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment)},m(C,T){oe(e,C,T),W(C,t,T),oe(n,C,T),W(C,i,T),oe(o,C,T),u=!0},p(C,T){const E=T&9?Tn(s,[s[0],s[1],s[2],T&8&&{paint:{"line-color":Oo(["get","Traffic volume category"],{"0 to 1999":C[3].colorScale[0],"2000 to 3999":C[3].colorScale[1],"4000+":C[3].colorScale[2]},"cyan"),"line-width":na(0)}},T&1&&{layout:{visibility:C[0]?"visible":"none"}}]):{};e.$set(E);const z=T&18?Tn(p,[p[0],p[1],T&16&&{paint:{"line-color":Oo(["get","Level of Service"],C[4],"cyan"),"line-width":na(1)}},T&2&&{layout:{visibility:C[1]?"visible":"none"}}]):{};n.$set(z);const I=T&36?Tn(y,[y[0],y[1],y[2],T&32&&{paint:{"line-color":Oo(["get","Infrastructure type"],C[5],"cyan"),"line-width":na(1)}},T&4&&{layout:{visibility:C[2]?"visible":"none"}}]):{};o.$set(I)},i(C){u||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),u=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),u=!1},d(C){C&&(G(t),G(i)),se(e,C),se(n,C),se(o,C)}}}function TI(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E;function z(q){r[6](q)}let I={label:"Existing cycling infrastructure",$$slots:{help:[wI],legend:[bI]},$$scope:{ctx:r}};r[2]!==void 0&&(I.show=r[2]),e=new rs({props:I}),_n.push(()=>Rn(e,"show",z));function L(q){r[7](q)}let B={label:"Cycling safety Level of Service",$$slots:{help:[AI],legend:[xI]},$$scope:{ctx:r}};r[1]!==void 0&&(B.show=r[1]),i=new rs({props:B}),_n.push(()=>Rn(i,"show",L)),s=new vI({});function O(q){r[8](q)}let Y={label:"Estimated traffic",$$slots:{help:[SI],legend:[kI]},$$scope:{ctx:r}};return r[0]!==void 0&&(Y.show=r[0]),y=new rs({props:Y}),_n.push(()=>Rn(y,"show",O)),T=new sh({props:{url:`pmtiles://${ys("cnt/layers/cbd.pmtiles")}`,$$slots:{default:[CI]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment),u=ne(),ae(s.$$.fragment),d=ne(),p=j("div"),p.textContent="Other",g=ne(),ae(y.$$.fragment),C=ne(),ae(T.$$.fragment),ue(p,"class","layer-group")},m(q,H){oe(e,q,H),W(q,n,H),oe(i,q,H),W(q,u,H),oe(s,q,H),W(q,d,H),W(q,p,H),W(q,g,H),oe(y,q,H),W(q,C,H),oe(T,q,H),E=!0},p(q,[H]){const Z={};H&512&&(Z.$$scope={dirty:H,ctx:q}),!t&&H&4&&(t=!0,Z.show=q[2],Dn(()=>t=!1)),e.$set(Z);const _e={};H&512&&(_e.$$scope={dirty:H,ctx:q}),!o&&H&2&&(o=!0,_e.show=q[1],Dn(()=>o=!1)),i.$set(_e);const Ie={};H&512&&(Ie.$$scope={dirty:H,ctx:q}),!x&&H&1&&(x=!0,Ie.show=q[0],Dn(()=>x=!1)),y.$set(Ie);const J={};H&519&&(J.$$scope={dirty:H,ctx:q}),T.$set(J)},i(q){E||(N(e.$$.fragment,q),N(i.$$.fragment,q),N(s.$$.fragment,q),N(y.$$.fragment,q),N(T.$$.fragment,q),E=!0)},o(q){V(e.$$.fragment,q),V(i.$$.fragment,q),V(s.$$.fragment,q),V(y.$$.fragment,q),V(T.$$.fragment,q),E=!1},d(q){q&&(G(n),G(u),G(d),G(p),G(g),G(C)),se(e,q),se(i,q),se(s,q),se(y,q),se(T,q)}}}function MI(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(x){o=x,t(2,o)}function g(x){i=x,t(1,i)}function y(x){n=x,t(0,n)}return[n,i,o,u,s,d,p,g,y]}class EI extends Tt{constructor(e){super(),Ct(this,e,MI,TI,wt,{})}}function LI(r){let e,t,n;return t=new Bg({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","legend")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p:lt,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function II(r){let e;return{c(){e=j("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function xv(r){let e,t;return e=new yr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[DI]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function PI(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&xt(t,e)},d(n){n&&G(t)}}}function zI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[PI,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function DI(r){let e,t;const n=[yn("context-pois"),{paint:{"circle-color":Oo(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[zI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Rl({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s=u&5?Tn(n,[n[0],u&4&&{paint:{"circle-color":Oo(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function RI(r){let e,t,n,i,o;function u(p){r[3](p)}let s={label:"POIs",$$slots:{help:[II],legend:[LI]},$$scope:{ctx:r}};r[0]!==void 0&&(s.show=r[0]),e=new rs({props:s}),_n.push(()=>Rn(e,"show",u));let d=r[1]&&xv(r);return{c(){ae(e.$$.fragment),n=ne(),d&&d.c(),i=rr()},m(p,g){oe(e,p,g),W(p,n,g),d&&d.m(p,g),W(p,i,g),o=!0},p(p,[g]){const y={};g&32&&(y.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,y.show=p[0],Dn(()=>t=!1)),e.$set(y),p[1]?d?(d.p(p,g),g&2&&N(d,1)):(d=xv(p),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Xt(),V(d,1,1,()=>{d=null}),Kt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(G(n),G(i)),se(e,p),d&&d.d(p)}}}function BI(r,e,t){let n;st(r,kr,s=>t(1,n=s));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99",Recreation:"#f0027f"};function u(s){i=s,t(0,i)}return[i,n,o,u]}class FI extends Tt{constructor(e){super(),Ct(this,e,BI,RI,wt,{})}}function OI(r){let e,t,n,i,o;return t=new fo({props:{colorScale:ah.toReversed(),labels:{buckets:S2(lh).toReversed()}}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("div"),i.innerHTML="<span>Less deprived</span> <span>More deprived</span>",Xe(i,"display","flex"),Xe(i,"justify-content","space-between"),ue(e,"slot","legend")},m(u,s){W(u,e,s),oe(t,e,null),D(e,n),D(e,i),o=!0},p:lt,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),se(t)}}}function $I(r){let e;return{c(){e=j("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function NI(r){let e,t,n,i,o;return t=new fo({props:{colorScale:sc,labels:{limits:r[3].population_density}}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("div"),i.innerHTML="<span>Less dense</span> <span>people / km²</span> <span>More dense</span>",Xe(i,"display","flex"),Xe(i,"justify-content","space-between"),ue(e,"slot","legend")},m(u,s){W(u,e,s),oe(t,e,null),D(e,n),D(e,i),o=!0},p(u,s){const d={};s&8&&(d.labels={limits:u[3].population_density}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),se(t)}}}function jI(r){let e;return{c(){e=j("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function UI(r){let e,t,n,i,o;return t=new fo({props:{colorScale:ch.toReversed(),labels:{limits:uh.toReversed().map(YI)}}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Xe(i,"display","flex"),Xe(i,"justify-content","space-between"),ue(e,"slot","legend")},m(u,s){W(u,e,s),oe(t,e,null),D(e,n),D(e,i),o=!0},p:lt,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),se(t)}}}function VI(r){let e;return{c(){e=j("p"),e.textContent="Show households from the Scottish census with at least one car.",ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function qI(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",s,d,p=r[10].imd_rank+"",g,y,x=r[10].imd_percentile+"",C,T;return{c(){e=j("p"),t=Te("Data zone "),i=Te(n),o=Te(`
        has `),s=Te(u),d=Te(`
        people, and a SIMD rank of `),g=Te(p),y=Te(`, making it less deprived
        than `),C=Te(x),T=Te("% of data zones.")},m(E,z){W(E,e,z),D(e,t),D(e,i),D(e,o),D(e,s),D(e,d),D(e,g),D(e,y),D(e,C),D(e,T)},p(E,z){z&1024&&n!==(n=E[10].id+"")&&xt(i,n),z&1024&&u!==(u=E[10].population.toLocaleString()+"")&&xt(s,u),z&1024&&p!==(p=E[10].imd_rank+"")&&xt(g,p),z&1024&&x!==(x=E[10].imd_percentile+"")&&xt(C,x)},d(E){E&&G(e)}}}function HI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[qI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function GI(r){let e,t,n=r[10].id+"",i,o,u=ac(r[10].households_with_cars_or_vans,r[10].total_households)+"",s,d,p=r[10].total_households.toLocaleString()+"",g,y;return{c(){e=j("p"),t=Te("In data zone "),i=Te(n),o=ne(),s=Te(u),d=Te(" of approximately "),g=Te(p),y=Te(`
        households have at least one car or van.`)},m(x,C){W(x,e,C),D(e,t),D(e,i),D(e,o),D(e,s),D(e,d),D(e,g),D(e,y)},p(x,C){C&1024&&n!==(n=x[10].id+"")&&xt(i,n),C&1024&&u!==(u=ac(x[10].households_with_cars_or_vans,x[10].total_households)+"")&&xt(s,u),C&1024&&p!==(p=x[10].total_households.toLocaleString()+"")&&xt(g,p)},d(x){x&&G(e)}}}function WI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[GI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ZI(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",s,d,p=Math.round(r[10].population/(r[10].area/1e6)).toLocaleString()+"",g,y;return{c(){e=j("p"),t=Te("Data zone "),i=Te(n),o=Te(`
        has `),s=Te(u),d=Te(`
        people, with a density of `),g=Te(p),y=Te(" people per square kilometer")},m(x,C){W(x,e,C),D(e,t),D(e,i),D(e,o),D(e,s),D(e,d),D(e,g),D(e,y)},p(x,C){C&1024&&n!==(n=x[10].id+"")&&xt(i,n),C&1024&&u!==(u=x[10].population.toLocaleString()+"")&&xt(s,u),C&1024&&p!==(p=Math.round(x[10].population/(x[10].area/1e6)).toLocaleString()+"")&&xt(g,p)},d(x){x&&G(e)}}}function XI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[ZI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function KI(r){let e,t,n,i,o,u,s,d;const p=[yn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["get","imd_percentile"],lh,ah),"fill-opacity":Kn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[HI]},$$scope:{ctx:r}};for(let I=0;I<p.length;I+=1)g=Mt(g,p[I]);e=new Ki({props:g});const y=[yn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],uh,ch),"fill-opacity":Kn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={$$slots:{default:[WI]},$$scope:{ctx:r}};for(let I=0;I<y.length;I+=1)x=Mt(x,y[I]);n=new Ki({props:x});const C=[yn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["/",["get","population"],["/",["get","area"],1e6]],r[3].population_density,sc),"fill-opacity":Kn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let T={$$slots:{default:[XI]},$$scope:{ctx:r}};for(let I=0;I<C.length;I+=1)T=Mt(T,C[I]);o=new Ki({props:T});const E=[yn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let z={};for(let I=0;I<E.length;I+=1)z=Mt(z,E[I]);return s=new hr({props:z}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment)},m(I,L){oe(e,I,L),W(I,t,L),oe(n,I,L),W(I,i,L),oe(o,I,L),W(I,u,L),oe(s,I,L),d=!0},p(I,L){const B=L&1?Tn(p,[p[0],p[1],p[2],p[3],{layout:{visibility:I[0]?"visible":"none"}}]):{};L&2048&&(B.$$scope={dirty:L,ctx:I}),e.$set(B);const O=L&4?Tn(y,[y[0],y[1],y[2],y[3],{layout:{visibility:I[2]?"visible":"none"}}]):{};L&2048&&(O.$$scope={dirty:L,ctx:I}),n.$set(O);const Y=L&10?Tn(C,[C[0],C[1],C[2],L&8&&{paint:{"fill-color":Bi(["/",["get","population"],["/",["get","area"],1e6]],I[3].population_density,sc),"fill-opacity":Kn(.7,.9)}},L&2&&{layout:{visibility:I[1]?"visible":"none"}}]):{};L&2048&&(Y.$$scope={dirty:L,ctx:I}),o.$set(Y);const q=L&7?Tn(E,[E[0],E[1],E[2],{layout:{visibility:I[0]||I[1]||I[2]?"visible":"none"}}]):{};s.$set(q)},i(I){d||(N(e.$$.fragment,I),N(n.$$.fragment,I),N(o.$$.fragment,I),N(s.$$.fragment,I),d=!0)},o(I){V(e.$$.fragment,I),V(n.$$.fragment,I),V(o.$$.fragment,I),V(s.$$.fragment,I),d=!1},d(I){I&&(G(t),G(i),G(u)),se(e,I),se(n,I),se(o,I),se(s,I)}}}function JI(r){let e,t,n,i,o,u,s,d,p,g,y;function x(L){r[5](L)}let C={label:"SIMD",onChange:r[4],$$slots:{help:[$I],legend:[OI]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new rs({props:C}),_n.push(()=>Rn(e,"show",x));function T(L){r[7](L)}let E={label:"Population density",onChange:r[6],$$slots:{help:[jI],legend:[NI]},$$scope:{ctx:r}};r[1]!==void 0&&(E.show=r[1]),i=new rs({props:E}),_n.push(()=>Rn(i,"show",T));function z(L){r[9](L)}let I={label:"Car ownership",onChange:r[8],$$slots:{help:[VI],legend:[UI]},$$scope:{ctx:r}};return r[2]!==void 0&&(I.show=r[2]),s=new rs({props:I}),_n.push(()=>Rn(s,"show",z)),g=new sh({props:{url:`pmtiles://${ys("cnt/layers/population.pmtiles")}`,$$slots:{default:[KI]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment),u=ne(),ae(s.$$.fragment),p=ne(),ae(g.$$.fragment)},m(L,B){oe(e,L,B),W(L,n,B),oe(i,L,B),W(L,u,B),oe(s,L,B),W(L,p,B),oe(g,L,B),y=!0},p(L,[B]){const O={};B&7&&(O.onChange=L[4]),B&2048&&(O.$$scope={dirty:B,ctx:L}),!t&&B&1&&(t=!0,O.show=L[0],Dn(()=>t=!1)),e.$set(O);const Y={};B&7&&(Y.onChange=L[6]),B&2056&&(Y.$$scope={dirty:B,ctx:L}),!o&&B&2&&(o=!0,Y.show=L[1],Dn(()=>o=!1)),i.$set(Y);const q={};B&7&&(q.onChange=L[8]),B&2048&&(q.$$scope={dirty:B,ctx:L}),!d&&B&4&&(d=!0,q.show=L[2],Dn(()=>d=!1)),s.$set(q);const H={};B&2063&&(H.$$scope={dirty:B,ctx:L}),g.$set(H)},i(L){y||(N(e.$$.fragment,L),N(i.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),y=!0)},o(L){V(e.$$.fragment,L),V(i.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),y=!1},d(L){L&&(G(n),G(u),G(p)),se(e,L),se(i,L),se(s,L),se(g,L)}}}const YI=r=>`${r}%`;function QI(r,e,t){let n;st(r,fc,C=>t(3,n=C));let i=!1,o=!1,u=!1;const s=()=>{i&&(t(1,o=!1),t(2,u=!1))};function d(C){i=C,t(0,i)}const p=()=>{o&&(t(0,i=!1),t(2,u=!1))};function g(C){o=C,t(1,o)}const y=()=>{u&&(t(0,i=!1),t(1,o=!1))};function x(C){u=C,t(2,u)}return[i,o,u,n,s,d,p,g,y,x]}class e6 extends Tt{constructor(e){super(),Ct(this,e,QI,JI,wt,{})}}function t6(r){let e;return{c(){e=j("div"),e.innerHTML=`<img src="${dw}" alt="National Rail logo"/>
    Station`,ue(e,"slot","legend"),Xe(e,"display","flex"),Xe(e,"gap","8px"),Xe(e,"align-items","center")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function n6(r){let e;return{c(){e=j("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function r6(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=j("p"),n=Te(t)},m(i,o){W(i,e,o),D(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&xt(n,t)},d(i){i&&G(e)}}}function i6(r){let e,t;return e=new pi({props:{$$slots:{default:[r6,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function o6(r){let e,t;const n=[yn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[i6]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new ic({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s=u&1?Tn(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function s6(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Railway stations",$$slots:{help:[n6],legend:[t6]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new rs({props:s}),_n.push(()=>Rn(e,"show",u)),i=new yr({props:{data:ys("cnt/layers/railways.geojson"),generateId:!0,$$slots:{default:[o6]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment)},m(d,p){oe(e,d,p),W(d,n,p),oe(i,d,p),o=!0},p(d,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Dn(()=>t=!1)),e.$set(g);const y={};p&9&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),se(e,d),se(i,d)}}}function a6(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class l6 extends Tt{constructor(e){super(),Ct(this,e,a6,s6,wt,{})}}function u6(r){let e;return{c(){e=j("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.</p>`,ue(e,"slot","help")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function c6(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q,H;return O=new Bg({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=j("div"),t=j("fieldset"),n=j("label"),i=j("input"),o=Te(`
        Pedestrians`),u=ne(),s=j("label"),d=j("input"),p=Te(`
        Cyclists`),g=ne(),y=j("fieldset"),x=j("label"),C=Te(`From
        `),T=j("input"),E=ne(),z=j("label"),I=Te(`To
        `),L=j("input"),B=ne(),ae(O.$$.fragment),ue(i,"type","checkbox"),ue(i,"class","svelte-rvrx5w"),ue(d,"type","checkbox"),ue(d,"class","svelte-rvrx5w"),Xe(t,"display","flex"),Xe(t,"gap","3em"),ue(t,"class","svelte-rvrx5w"),ue(T,"type","number"),ue(T,"min",2017),ue(T,"max",2023),ue(T,"class","svelte-rvrx5w"),ue(L,"type","number"),ue(L,"min",2017),ue(L,"max",2023),ue(L,"class","svelte-rvrx5w"),ue(y,"class","year-filter svelte-rvrx5w"),ue(e,"slot","legend")},m(Z,_e){W(Z,e,_e),D(e,t),D(t,n),D(n,i),i.checked=r[1].pedestrians,D(n,o),D(t,u),D(t,s),D(s,d),d.checked=r[1].cyclists,D(s,p),D(e,g),D(e,y),D(y,x),D(x,C),D(x,T),Nn(T,r[1].minYear),D(y,E),D(y,z),D(z,I),D(z,L),Nn(L,r[1].maxYear),D(e,B),oe(O,e,null),Y=!0,q||(H=[St(i,"change",r[7]),St(d,"change",r[8]),St(T,"input",r[9]),St(L,"input",r[10])],q=!0)},p(Z,_e){_e&2&&(i.checked=Z[1].pedestrians),_e&2&&(d.checked=Z[1].cyclists),_e&2&&Il(T.value)!==Z[1].minYear&&Nn(T,Z[1].minYear),_e&2&&Il(L.value)!==Z[1].maxYear&&Nn(L,Z[1].maxYear)},i(Z){Y||(N(O.$$.fragment,Z),Y=!0)},o(Z){V(O.$$.fragment,Z),Y=!1},d(Z){Z&&G(e),se(O),q=!1,sr(H)}}}function Av(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=j("p"),t=Te("Pedestrian location: "),n=j("b"),o=Te(i)},m(u,s){W(u,e,s),D(e,t),D(e,n),D(n,o)},p(u,s){s&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&xt(o,i)},d(u){u&&G(e)}}}function kv(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=j("p"),t=Te("Pedestrian movement: "),n=j("b"),o=Te(i)},m(u,s){W(u,e,s),D(e,t),D(e,n),D(n,o)},p(u,s){s&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&xt(o,i)},d(u){u&&G(e)}}}function f6(r){let e,t,n,i=r[12].year+"",o,u,s,d,p,g=r[5][r[12].severity]+"",y,x,C,T,E,z=Sv(r[12])+"",I,L,B,O,Y,q=r[12].pedestrian_location&&Av(r),H=r[12].pedestrian_movement&&kv(r);return{c(){e=j("p"),t=Te("Year: "),n=j("b"),o=Te(i),u=ne(),s=j("p"),d=Te("Severity: "),p=j("b"),y=Te(g),x=ne(),C=j("p"),T=Te("Casualties: "),E=j("b"),I=Te(z),L=ne(),q&&q.c(),B=ne(),H&&H.c(),O=ne(),Y=j("p"),Y.textContent="Click to open full report in CycleStreets"},m(Z,_e){W(Z,e,_e),D(e,t),D(e,n),D(n,o),W(Z,u,_e),W(Z,s,_e),D(s,d),D(s,p),D(p,y),W(Z,x,_e),W(Z,C,_e),D(C,T),D(C,E),D(E,I),W(Z,L,_e),q&&q.m(Z,_e),W(Z,B,_e),H&&H.m(Z,_e),W(Z,O,_e),W(Z,Y,_e)},p(Z,_e){_e&4096&&i!==(i=Z[12].year+"")&&xt(o,i),_e&4096&&g!==(g=Z[5][Z[12].severity]+"")&&xt(y,g),_e&4096&&z!==(z=Sv(Z[12])+"")&&xt(I,z),Z[12].pedestrian_location?q?q.p(Z,_e):(q=Av(Z),q.c(),q.m(B.parentNode,B)):q&&(q.d(1),q=null),Z[12].pedestrian_movement?H?H.p(Z,_e):(H=kv(Z),H.c(),H.m(O.parentNode,O)):H&&(H.d(1),H=null)},d(Z){Z&&(G(e),G(u),G(s),G(x),G(C),G(L),G(B),G(O),G(Y)),q&&q.d(Z),H&&H.d(Z)}}}function h6(r){let e,t;return e=new pi({props:{$$slots:{default:[f6,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function d6(r){let e,t,n,i;const o=[yn("context-stats19-heatmap"),{sourceLayer:"stats19"},{maxzoom:13},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{paint:{"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,15]}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new $S({props:u});const s=[yn("context-stats19-points"),{sourceLayer:"stats19"},{minzoom:13},{paint:{"circle-color":Bi(["get","severity"],[1,2,3],[bg,wg,xg]),"circle-opacity":.9,"circle-radius":13,"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let d={$$slots:{default:[h6]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new Rl({props:d}),n.$on("click",m6),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y=g&7?Tn(o,[o[0],o[1],o[2],g&6&&{filter:p[2](p[1])},g&1&&{layout:{visibility:p[0]?"visible":"none"}},o[5]]):{};e.$set(y);const x=g&7?Tn(s,[s[0],s[1],s[2],g&0&&{paint:{"circle-color":Bi(["get","severity"],[1,2,3],[bg,wg,xg]),"circle-opacity":.9,"circle-radius":13,"circle-stroke-color":"black","circle-stroke-width":.1}},g&6&&{filter:p[2](p[1])},g&1&&{layout:{visibility:p[0]?"visible":"none"}},s[6]]):{};g&8192&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function p6(r){let e,t,n,i,o;function u(d){r[11](d)}let s={label:"Collisions",$$slots:{legend:[c6],help:[u6]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new rs({props:s}),_n.push(()=>Rn(e,"show",u)),i=new sh({props:{url:`pmtiles://${ys("cnt/layers/stats19.pmtiles")}`,$$slots:{default:[d6]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment)},m(d,p){oe(e,d,p),W(d,n,p),oe(i,d,p),o=!0},p(d,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],Dn(()=>t=!1)),e.$set(g);const y={};p&8195&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),se(e,d),se(i,d)}}}let bg="#080C54",wg="#1F9EB7",xg="#CDE594";function Sv(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function m6(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function g6(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(E){let z=["any"];return i.pedestrians&&z.push(["get","pedestrian"]),i.cyclists&&z.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],z]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:xg,Serious:wg,Fatal:bg};function g(){i.pedestrians=this.checked,t(1,i)}function y(){i.cyclists=this.checked,t(1,i)}function x(){i.minYear=Il(this.value),t(1,i)}function C(){i.maxYear=Il(this.value),t(1,i)}function T(E){n=E,t(0,n)}return[n,i,o,u,s,d,p,g,y,x,C,T]}class _6 extends Tt{constructor(e){super(),Ct(this,e,g6,p6,wt,{})}}function Cv(r){let e;return{c(){e=Te("Layers")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Tv(r){let e,t,n,i,o;function u(p){r[6](p)}let s={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(s.show=r[2]),e=new rs({props:s}),_n.push(()=>Rn(e,"show",u));let d=r[3]=="cnt"&&Mv();return{c(){ae(e.$$.fragment),n=ne(),d&&d.c(),i=rr()},m(p,g){oe(e,p,g),W(p,n,g),d&&d.m(p,g),W(p,i,g),o=!0},p(p,g){const y={};!t&&g&4&&(t=!0,y.show=p[2],Dn(()=>t=!1)),e.$set(y),p[3]=="cnt"?d?g&8&&N(d,1):(d=Mv(),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Xt(),V(d,1,1,()=>{d=null}),Kt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(G(n),G(i)),se(e,p),d&&d.d(p)}}}function Mv(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L;return n=new e6({}),o=new FI({}),s=new _6({}),y=new l6({}),C=new yM({}),I=new EI({}),{c(){e=j("div"),e.textContent="Metrics",t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment),d=ne(),p=j("div"),p.textContent="Public transport integration",g=ne(),ae(y.$$.fragment),x=ne(),ae(C.$$.fragment),T=ne(),E=j("div"),E.textContent="Active travel",z=ne(),ae(I.$$.fragment),ue(e,"class","layer-group"),ue(p,"class","layer-group"),ue(E,"class","layer-group")},m(B,O){W(B,e,O),W(B,t,O),oe(n,B,O),W(B,i,O),oe(o,B,O),W(B,u,O),oe(s,B,O),W(B,d,O),W(B,p,O),W(B,g,O),oe(y,B,O),W(B,x,O),oe(C,B,O),W(B,T,O),W(B,E,O),W(B,z,O),oe(I,B,O),L=!0},i(B){L||(N(n.$$.fragment,B),N(o.$$.fragment,B),N(s.$$.fragment,B),N(y.$$.fragment,B),N(C.$$.fragment,B),N(I.$$.fragment,B),L=!0)},o(B){V(n.$$.fragment,B),V(o.$$.fragment,B),V(s.$$.fragment,B),V(y.$$.fragment,B),V(C.$$.fragment,B),V(I.$$.fragment,B),L=!1},d(B){B&&(G(e),G(t),G(i),G(u),G(d),G(p),G(g),G(x),G(T),G(E),G(z)),se(n,B),se(o,B),se(s,B),se(y,B),se(C,B),se(I,B)}}}function y6(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O;i=new uT({props:{color:"#333"}});let Y=r[0]&&Cv(),q=r[1]&&Tv(r);return{c(){e=j("div"),t=j("button"),n=j("div"),ae(i.$$.fragment),o=ne(),Y&&Y.c(),s=ne(),d=j("div"),q&&q.c(),p=ne(),g=j("div"),y=j("span"),y.textContent="Basemap",x=ne(),C=j("select"),T=j("option"),T.textContent="MapTiler Dataviz",E=j("option"),E.textContent="MapTiler Streets",z=j("option"),z.textContent="MapTiler Satellite",I=j("option"),I.textContent="OS Open Zoomstack",Xe(n,"display","flex"),Xe(n,"gap","12px"),Xe(n,"color","#333"),Xe(n,"align-items","center"),Xe(n,"justify-content","center"),ue(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1skef0p"),ue(t,"aria-label","Layers"),Xe(y,"font-size","20px"),Xe(y,"margin-left","8px"),Xe(y,"margin-top","4px"),T.__value="dataviz",Nn(T,T.__value),E.__value="streets-v2",Nn(E,E.__value),z.__value="hybrid",Nn(z,z.__value),I.__value="uk-openzoomstack-light",Nn(I,I.__value),Xe(C,"width","auto"),Xe(C,"font-size","20px"),Xe(C,"margin","8px"),Xe(C,"padding","8px"),Xe(C,"text-overflow","ellipsis"),r[4]===void 0&&Yo(()=>r[7].call(C)),ue(g,"class","context-control"),ue(d,"class","contextual-layer-controls svelte-1skef0p"),Xe(d,"flex-direction","column"),Xe(d,"display",r[0]?"flex":"none"),ue(e,"class","pico contextual-layers svelte-1skef0p"),Xe(e,"display","flex"),Xe(e,"flex-direction","column"),Xe(e,"border-radius","5px"),Xe(e,"width",r[0]?"300px":"auto")},m(H,Z){W(H,e,Z),D(e,t),D(t,n),oe(i,n,null),D(n,o),Y&&Y.m(n,null),D(e,s),D(e,d),q&&q.m(d,null),D(d,p),D(d,g),D(g,y),D(g,x),D(g,C),D(C,T),D(C,E),D(C,z),D(C,I),Ci(C,r[4],!0),L=!0,B||(O=[St(t,"click",r[5]),St(C,"change",r[7])],B=!0)},p(H,Z){H[0]?Y||(Y=Cv(),Y.c(),Y.m(n,null)):Y&&(Y.d(1),Y=null),(!L||Z&1&&u!==(u="show-layers-button icon-btn "+(H[0]?"expanded":"")+" svelte-1skef0p"))&&ue(t,"class",u),H[1]?q?(q.p(H,Z),Z&2&&N(q,1)):(q=Tv(H),q.c(),N(q,1),q.m(d,p)):q&&(Xt(),V(q,1,1,()=>{q=null}),Kt()),Z&16&&Ci(C,H[4]),Z&1&&Xe(d,"display",H[0]?"flex":"none"),Z&1&&Xe(e,"width",H[0]?"300px":"auto")},i(H){L||(N(i.$$.fragment,H),N(q),L=!0)},o(H){V(i.$$.fragment,H),V(q),L=!1},d(H){H&&G(e),se(i),Y&&Y.d(),q&&q.d(),B=!1,sr(O)}}}function v6(r){let e,t;return e=new Qm({props:{defaultStyling:!0,$$slots:{default:[y6]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function b6(r,e,t){let n,i,o,u;st(r,kr,y=>t(1,n=y)),st(r,tp,y=>t(2,i=y)),st(r,xo,y=>t(3,o=y)),st(r,og,y=>t(4,u=y));let s=!1;const d=()=>t(0,s=!s);function p(y){i=y,tp.set(i)}function g(){u=ia(this),og.set(u)}return[s,n,i,o,u,d,p,g]}class w6 extends Tt{constructor(e){super(),Ct(this,e,b6,v6,wt,{})}}let kt;function x6(r){const e=kt.__externref_table_alloc();return kt.__wbindgen_export_2.set(e,r),e}function Al(r,e){try{return r.apply(this,e)}catch(t){const n=x6(t);kt.__wbindgen_exn_store(n)}}const G2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&G2.decode();let Cf=null;function Ju(){return(Cf===null||Cf.byteLength===0)&&(Cf=new Uint8Array(kt.memory.buffer)),Cf}function Lr(r,e){return r=r>>>0,G2.decode(Ju().subarray(r,r+e))}let ki=0;const Vd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},A6=typeof Vd.encodeInto=="function"?function(r,e){return Vd.encodeInto(r,e)}:function(r,e){const t=Vd.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ro(r,e,t){if(t===void 0){const s=Vd.encode(r),d=e(s.length,1)>>>0;return Ju().subarray(d,d+s.length).set(s),ki=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Ju();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Ju().subarray(i+u,i+n),d=A6(r,s);u+=d.written,i=t(i,n,u,1)>>>0}return ki=u,i}let Sl=null;function Ds(){return(Sl===null||Sl.buffer.detached===!0||Sl.buffer.detached===void 0&&Sl.buffer!==kt.memory.buffer)&&(Sl=new DataView(kt.memory.buffer)),Sl}function Gu(r){return r==null}function Ag(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Ag(r[0]));for(let u=1;u<i;u++)o+=", "+Ag(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t&&t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ev(r,e){const t=e(r.length*1,1)>>>0;return Ju().set(r,t/1),ki=r.length,t}function Yn(r){const e=kt.__wbindgen_export_2.get(r);return kt.__externref_table_dealloc(r),e}let Tf=null;function k6(){return(Tf===null||Tf.byteLength===0)&&(Tf=new Float64Array(kt.memory.buffer)),Tf}function S6(r,e){return r=r>>>0,k6().subarray(r/8,r/8+e)}function C6(r,e){return r=r>>>0,Ju().subarray(r/1,r/1+e)}const Lv=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>kt.__wbg_ltn_free(r>>>0,1));class T6{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lv.unregister(this),e}free(){const e=this.__destroy_into_raw();kt.__wbg_ltn_free(e,0)}constructor(e,t,n,i,o,u,s){const d=Ev(e,kt.__wbindgen_malloc),p=ki,g=Ev(t,kt.__wbindgen_malloc),y=ki,x=Ro(i,kt.__wbindgen_malloc,kt.__wbindgen_realloc),C=ki;var T=Gu(o)?0:Ro(o,kt.__wbindgen_malloc,kt.__wbindgen_realloc),E=ki;const z=Ro(u,kt.__wbindgen_malloc,kt.__wbindgen_realloc),I=ki,L=kt.ltn_new(d,p,g,y,n,x,C,T,E,z,I,s);if(L[2])throw Yn(L[1]);return this.__wbg_ptr=L[0]>>>0,Lv.register(this,this.__wbg_ptr,this),this}getInvertedBoundary(){let e,t;try{const o=kt.ltn_getInvertedBoundary(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}getBounds(){const e=kt.ltn_getBounds(this.__wbg_ptr);var t=S6(e[0],e[1]).slice();return kt.__wbindgen_free(e[0],e[1]*8,8),t}toRouteSnapper(){const e=kt.ltn_toRouteSnapper(this.__wbg_ptr);var t=C6(e[0],e[1]).slice();return kt.__wbindgen_free(e[0],e[1]*1,1),t}toRouteSnapperGj(){let e,t;try{const o=kt.ltn_toRouteSnapperGj(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const o=kt.ltn_renderModalFilters(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const o=kt.ltn_renderTurnRestrictions(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const o=kt.ltn_renderNeighbourhood(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const o=kt.ltn_generatedBoundaries(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const u=kt.ltn_generateMergedBoundary(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{kt.__wbindgen_free(t,n,1)}}extractWaypointsFromRing(e){let t,n;try{const u=kt.ltn_extractWaypointsFromRing(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{kt.__wbindgen_free(t,n,1)}}setCurrentNeighbourhoodBoundary(e,t){const n=Ro(e,kt.__wbindgen_malloc,kt.__wbindgen_realloc),i=ki,o=kt.ltn_setCurrentNeighbourhoodBoundary(this.__wbg_ptr,n,i,t);if(o[1])throw Yn(o[0])}deleteNeighbourhoodBoundary(e){const t=Ro(e,kt.__wbindgen_malloc,kt.__wbindgen_realloc),n=ki;kt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Ro(e,kt.__wbindgen_malloc,kt.__wbindgen_realloc),i=ki,o=Ro(t,kt.__wbindgen_malloc,kt.__wbindgen_realloc),u=ki;kt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){const t=Ro(e,kt.__wbindgen_malloc,kt.__wbindgen_realloc),n=ki,i=kt.ltn_setCurrentNeighbourhood(this.__wbg_ptr,t,n);if(i[1])throw Yn(i[0])}addModalFilter(e,t){const n=Ro(t,kt.__wbindgen_malloc,kt.__wbindgen_realloc),i=ki,o=kt.ltn_addModalFilter(this.__wbg_ptr,e,n,i);if(o[1])throw Yn(o[0])}addManyModalFilters(e,t){const n=Ro(t,kt.__wbindgen_malloc,kt.__wbindgen_realloc),i=ki,o=kt.ltn_addManyModalFilters(this.__wbg_ptr,e,n,i);if(o[1])throw Yn(o[0])}deleteModalFilter(e){kt.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){const t=kt.ltn_addDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}rotateDiagonalFilter(e){const t=kt.ltn_rotateDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}deleteDiagonalFilter(e){const t=kt.ltn_deleteDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}addTurnRestriction(e,t){const n=kt.ltn_addTurnRestriction(this.__wbg_ptr,e,t);if(n[1])throw Yn(n[0])}deleteTurnRestriction(e,t,n){const i=kt.ltn_deleteTurnRestriction(this.__wbg_ptr,e,t,n);if(i[1])throw Yn(i[0])}getTurnRestrictionTargets(e){let t,n;try{const u=kt.ltn_getTurnRestrictionTargets(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{kt.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){kt.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){const t=kt.ltn_toggleMainRoad(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}reclassifyRoadsAlongLine(e,t,n){const i=kt.ltn_reclassifyRoadsAlongLine(this.__wbg_ptr,e,t,n);if(i[1])throw Yn(i[0])}eraseAllMainRoads(){const e=kt.ltn_eraseAllMainRoads(this.__wbg_ptr);if(e[1])throw Yn(e[0])}undo(){const e=kt.ltn_undo(this.__wbg_ptr);if(e[1])throw Yn(e[0])}redo(){const e=kt.ltn_redo(this.__wbg_ptr);if(e[1])throw Yn(e[0])}getShortcutsCrossingRoad(e){let t,n;try{const u=kt.ltn_getShortcutsCrossingRoad(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{kt.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const o=kt.ltn_getAllShortcuts(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const o=kt.ltn_toSavefile(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}loadSavefile(e){const t=kt.ltn_loadSavefile(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}compareRoute(e,t,n,i,o){let u,s;try{const g=kt.ltn_compareRoute(this.__wbg_ptr,e,t,n,i,o);var d=g[0],p=g[1];if(g[3])throw d=0,p=0,Yn(g[2]);return u=d,s=p,Lr(d,p)}finally{kt.__wbindgen_free(u,s,1)}}impactToOneDestination(e,t){let n,i;try{const s=kt.ltn_impactToOneDestination(this.__wbg_ptr,e,t);var o=s[0],u=s[1];if(s[3])throw o=0,u=0,Yn(s[2]);return n=o,i=u,Lr(o,u)}finally{kt.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const u=kt.ltn_predictImpact(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{kt.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const s=kt.ltn_getImpactsOnRoad(this.__wbg_ptr,e,t);var o=s[0],u=s[1];if(s[3])throw o=0,u=0,Yn(s[2]);return n=o,i=u,Lr(o,u)}finally{kt.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const o=kt.ltn_getAllNeighbourhoods(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const o=kt.ltn_getAllIntersections(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const u=kt.ltn_getMovements(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{kt.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const o=kt.ltn_getDemandModel(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const o=kt.ltn_getPOIs(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}getMetricBuckets(){let e,t;try{const o=kt.ltn_getMetricBuckets(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{kt.__wbindgen_free(e,t,1)}}}async function M6(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function E6(){const r={};return r.wbg={},r.wbg.__wbg_buffer_0e2c274546535a84=function(e){return e.buffer},r.wbg.__wbg_call_3a8ceff4c9f12325=function(){return Al(function(e,t){return e.call(t)},arguments)},r.wbg.__wbg_debug_809501eb69aeeef4=function(e){console.debug(e)},r.wbg.__wbg_done_60e5165eca70220e=function(e){return e.done},r.wbg.__wbg_entries_85a648a6a5215287=function(e){return Object.entries(e)},r.wbg.__wbg_error_1c3d6d32fc1361cc=function(e){console.error(e)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,i;try{n=e,i=t,console.error(Lr(e,t))}finally{kt.__wbindgen_free(n,i,1)}},r.wbg.__wbg_get_9c5338635800e15f=function(){return Al(function(e,t){return Reflect.get(e,t)},arguments)},r.wbg.__wbg_get_d749e505e6746136=function(e,t){return e[t>>>0]},r.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},r.wbg.__wbg_globalThis_d0fa1c7e1465604c=function(){return Al(function(){return globalThis.globalThis},arguments)},r.wbg.__wbg_global_23a7926f0ad701bc=function(){return Al(function(){return global.global},arguments)},r.wbg.__wbg_info_26a1a6efb20c9f43=function(e){console.info(e)},r.wbg.__wbg_instanceof_ArrayBuffer_c632aa9cfefb45b9=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_instanceof_Map_212855790ec94f3b=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},r.wbg.__wbg_instanceof_Uint8Array_aa04d9da2a05b974=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_isArray_b7133b5e9a258525=function(e){return Array.isArray(e)},r.wbg.__wbg_isSafeInteger_f6d409cd7a7eb81d=function(e){return Number.isSafeInteger(e)},r.wbg.__wbg_iterator_0210e004ec06fb30=function(){return Symbol.iterator},r.wbg.__wbg_length_bc129fab12fd2a9c=function(e){return e.length},r.wbg.__wbg_length_ee1bca74ed444cce=function(e){return e.length},r.wbg.__wbg_log_91785a95194156ea=function(e){console.log(e)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_new_cf66b35fe5443282=function(e){return new Uint8Array(e)},r.wbg.__wbg_newnoargs_1143e0b74be16ea9=function(e,t){return new Function(Lr(e,t))},r.wbg.__wbg_next_4d092fa9da3ba108=function(e){return e.next},r.wbg.__wbg_next_7b79803d4b7a1b68=function(){return Al(function(e){return e.next()},arguments)},r.wbg.__wbg_now_882dd9fbc163f00d=function(e){return e.now()},r.wbg.__wbg_performance_686bdd9b0415bed6=function(e){return e.performance},r.wbg.__wbg_self_3a2c444cba620c12=function(){return Al(function(){return self.self},arguments)},r.wbg.__wbg_set_2611eb16b9ac5ca9=function(e,t,n){e.set(t,n>>>0)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const n=t.stack,i=Ro(n,kt.__wbindgen_malloc,kt.__wbindgen_realloc),o=ki;Ds().setInt32(e+4*1,o,!0),Ds().setInt32(e+4*0,i,!0)},r.wbg.__wbg_value_fdfbba27b1fcaf65=function(e){return e.value},r.wbg.__wbg_warn_8fc67512df65ef55=function(e){console.warn(e)},r.wbg.__wbg_window_a27f90073150a6bf=function(){return Al(function(){return window.window},arguments)},r.wbg.__wbindgen_bigint_from_i64=function(e){return e},r.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=t,i=typeof n=="bigint"?n:void 0;Ds().setBigInt64(e+8*1,Gu(i)?BigInt(0):i,!0),Ds().setInt32(e+4*0,!Gu(i),!0)},r.wbg.__wbindgen_boolean_get=function(e){const t=e;return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_debug_string=function(e,t){const n=Ag(t),i=Ro(n,kt.__wbindgen_malloc,kt.__wbindgen_realloc),o=ki;Ds().setInt32(e+4*1,o,!0),Ds().setInt32(e+4*0,i,!0)},r.wbg.__wbindgen_error_new=function(e,t){return new Error(Lr(e,t))},r.wbg.__wbindgen_in=function(e,t){return e in t},r.wbg.__wbindgen_init_externref_table=function(){const e=kt.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},r.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},r.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return e===void 0},r.wbg.__wbindgen_jsval_eq=function(e,t){return e===t},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},r.wbg.__wbindgen_memory=function(){return kt.memory},r.wbg.__wbindgen_number_get=function(e,t){const n=t,i=typeof n=="number"?n:void 0;Ds().setFloat64(e+8*1,Gu(i)?0:i,!0),Ds().setInt32(e+4*0,!Gu(i),!0)},r.wbg.__wbindgen_string_get=function(e,t){const n=t,i=typeof n=="string"?n:void 0;var o=Gu(i)?0:Ro(i,kt.__wbindgen_malloc,kt.__wbindgen_realloc),u=ki;Ds().setInt32(e+4*1,u,!0),Ds().setInt32(e+4*0,o,!0)},r.wbg.__wbindgen_string_new=function(e,t){return Lr(e,t)},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Lr(e,t))},r}function L6(r,e){return kt=r.exports,W2.__wbindgen_wasm_module=e,Sl=null,Tf=null,Cf=null,kt.__wbindgen_start(),kt}async function W2(r){if(kt!==void 0)return kt;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("backend_bg.wasm",self.location));const e=E6();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await M6(await r,e);return L6(t,n)}const I6=r=>({}),Iv=r=>({}),P6=r=>({}),Pv=r=>({}),z6=r=>({}),zv=r=>({});function D6(r){let e,t,n,i,o,u,s,d;const p=r[1].top,g=vn(p,r,r[0],zv),y=r[1].left,x=vn(y,r,r[0],Pv),C=r[1].main,T=vn(C,r,r[0],Iv);return{c(){e=j("div"),t=j("div"),g&&g.c(),n=ne(),i=j("div"),o=j("div"),x&&x.c(),u=ne(),s=j("div"),T&&T.c(),ue(t,"class","top svelte-29q570"),ue(o,"class","left svelte-29q570"),ue(s,"class","main svelte-29q570"),ue(i,"class","content svelte-29q570"),ue(e,"class","flex-container svelte-29q570")},m(E,z){W(E,e,z),D(e,t),g&&g.m(t,null),D(e,n),D(e,i),D(i,o),x&&x.m(o,null),D(i,u),D(i,s),T&&T.m(s,null),d=!0},p(E,[z]){g&&g.p&&(!d||z&1)&&wn(g,p,E,E[0],d?bn(p,E[0],z,z6):xn(E[0]),zv),x&&x.p&&(!d||z&1)&&wn(x,y,E,E[0],d?bn(y,E[0],z,P6):xn(E[0]),Pv),T&&T.p&&(!d||z&1)&&wn(T,C,E,E[0],d?bn(C,E[0],z,I6):xn(E[0]),Iv)},i(E){d||(N(g,E),N(x,E),N(T,E),d=!0)},o(E){V(g,E),V(x,E),V(T,E),d=!1},d(E){E&&G(e),g&&g.d(E),x&&x.d(E),T&&T.d(E)}}}function R6(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class B6 extends Tt{constructor(e){super(),Ct(this,e,R6,D6,wt,{})}}const F6=r=>({}),Dv=r=>({}),O6=r=>({}),Rv=r=>({}),$6=r=>({}),Bv=r=>({});function N6(r){let e,t,n,i,o,u;const s=r[4].top,d=vn(s,r,r[3],Bv),p=r[4].sidebar,g=vn(p,r,r[3],Rv),y=r[4].map,x=vn(y,r,r[3],Dv);return{c(){e=j("div"),d&&d.c(),t=ne(),n=j("div"),g&&g.c(),i=ne(),o=j("div"),x&&x.c()},m(C,T){W(C,e,T),d&&d.m(e,null),r[5](e),W(C,t,T),W(C,n,T),g&&g.m(n,null),r[6](n),W(C,i,T),W(C,o,T),x&&x.m(o,null),r[7](o),u=!0},p(C,[T]){d&&d.p&&(!u||T&8)&&wn(d,s,C,C[3],u?bn(s,C[3],T,$6):xn(C[3]),Bv),g&&g.p&&(!u||T&8)&&wn(g,p,C,C[3],u?bn(p,C[3],T,O6):xn(C[3]),Rv),x&&x.p&&(!u||T&8)&&wn(x,y,C,C[3],u?bn(y,C[3],T,F6):xn(C[3]),Dv)},i(C){u||(N(d,C),N(g,C),N(x,C),u=!0)},o(C){V(d,C),V(g,C),V(x,C),u=!1},d(C){C&&(G(e),G(t),G(n),G(i),G(o)),d&&d.d(C),r[5](null),g&&g.d(C),r[6](null),x&&x.d(C),r[7](null)}}}function j6(r,e,t){let n,i,o;st(r,kg,y=>t(0,n=y)),st(r,Sg,y=>t(1,i=y)),st(r,Cg,y=>t(2,o=y));let{$$slots:u={},$$scope:s}=e;function d(y){_n[y?"unshift":"push"](()=>{n=y,kg.set(n)})}function p(y){_n[y?"unshift":"push"](()=>{i=y,Sg.set(i)})}function g(y){_n[y?"unshift":"push"](()=>{o=y,Cg.set(o)})}return r.$$set=y=>{"$$scope"in y&&t(3,s=y.$$scope)},[n,i,o,s,u,d,p,g]}class Ao extends Tt{constructor(e){super(),Ct(this,e,j6,N6,wt,{})}}let kg=Cn(null),Sg=Cn(null),Cg=Cn(null);const U6="/ltn/assets/streets-v2-style-b76f3b8b.json";function V6(r){let e;return{c(){e=Te("Back")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function q6(r){let e,t,n,i;return e=new pp({props:{$$slots:{default:[V6]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0,n||(i=St(window,"keydown",r[2]),n=!0)},p(o,[u]){const s={};u&16&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o),n=!1,i()}}}function H6(r,e,t){let n;st(r,Qn,s=>t(1,n=s));let{mode:i}=e;function o(s){s.key=="Escape"&&(s.stopPropagation(),an(Qn,n=i,n))}const u=()=>an(Qn,n=i,n);return r.$$set=s=>{"mode"in s&&t(0,i=s.mode)},[i,n,o,u]}class Ns extends Tt{constructor(e){super(),Ct(this,e,H6,q6,wt,{mode:0})}}let sp=Cn(null);function Fv(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function Ov(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function G6(r){let e,t=r[6].length+"",n,i;return{c(){e=Te("Undo ("),n=Te(t),i=Te(")")},m(o,u){W(o,e,u),W(o,n,u),W(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&xt(n,t)},d(o){o&&(G(e),G(n),G(i))}}}function W6(r){let e;return{c(){e=Te("Undo")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function Z6(r){let e;return{c(){e=j("span"),ue(e,"class","dot svelte-11yzwwb"),Gt(e,"snapped-node",r[40].snapped),Gt(e,"free-node",!r[40].snapped),Gt(e,"hide",r[4])},m(t,n){W(t,e,n)},p(t,n){n[0]&128&&Gt(e,"snapped-node",t[40].snapped),n[0]&128&&Gt(e,"free-node",!t[40].snapped),n[0]&16&&Gt(e,"hide",t[4])},d(t){t&&G(e)}}}function $v(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function s(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[Z6]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new hp({props:d}),_n.push(()=>Rn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",s),{c(){ae(e.$$.fragment)},m(p,g){oe(e,p,g),n=!0},p(p,g){r=p;const y={};g[0]&144|g[1]&4096&&(y.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,y.lngLat=r[40].point,Dn(()=>t=!1)),e.$set(y)},i(p){n||(N(e.$$.fragment,p),n=!0)},o(p){V(e.$$.fragment,p),n=!1},d(p){se(e,p)}}}function X6(r){let e;return{c(){e=j("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Xe(e,"padding-right","0"),Xe(e,"padding-left","20px"),Xe(e,"margin","0")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function K6(r){let e,t,n,i;return n=new s2({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[X6]},$$scope:{ctx:r}}}),{c(){e=j("span"),e.textContent=`${r[39]+1}`,t=ne(),ae(n.$$.fragment),ue(e,"class","dot svelte-11yzwwb"),Gt(e,"snapped",r[37].snapped)},m(o,u){W(o,e,u),W(o,t,u),oe(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Gt(e,"snapped",o[37].snapped);const s={};u[1]&4096&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(G(e),G(t)),se(n,o)}}}function Nv(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let s={draggable:!0,zIndex:1,$$slots:{default:[K6]},$$scope:{ctx:r}};return r[37].point!==void 0&&(s.lngLat=r[37].point),e=new hp({props:s}),_n.push(()=>Rn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){ae(e.$$.fragment)},m(d,p){oe(e,d,p),n=!0},p(d,p){r=d;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,Dn(()=>t=!1)),e.$set(g)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){V(e.$$.fragment,d),n=!1},d(d){se(e,d)}}}function J6(r){let e,t,n,i;const o=[yn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new hr({props:u});const s=[yn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new Ki({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function Y6(r){let e,t;const n=[yn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function Q6(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q;function H(Ue,De){return Ue[6].length==0?W6:G6}let Z=H(r),_e=Z(r);x=new e_({}),x.$on("click",r[10]),x.$on("mousemove",r[11]);let Ie=On(r[7]),J=[];for(let Ue=0;Ue<Ie.length;Ue+=1)J[Ue]=$v(Ov(r,Ie,Ue));const fe=Ue=>V(J[Ue],1,1,()=>{J[Ue]=null});let Ee=On(r[0]),ye=[];for(let Ue=0;Ue<Ee.length;Ue+=1)ye[Ue]=Nv(Fv(r,Ee,Ue));const Oe=Ue=>V(ye[Ue],1,1,()=>{ye[Ue]=null});return z=new yr({props:{data:r[1]||Fi(),generateId:!0,$$slots:{default:[J6]},$$scope:{ctx:r}}}),L=new yr({props:{data:r[8],$$slots:{default:[Y6]},$$scope:{ctx:r}}}),O=zg(r[22][0]),{c(){e=j("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=ne(),n=j("div"),i=j("label"),o=j("input"),s=Te(`
    Snap boundary to roads`),d=ne(),p=j("button"),_e.c(),y=ne(),ae(x.$$.fragment),C=ne();for(let Ue=0;Ue<J.length;Ue+=1)J[Ue].c();T=ne();for(let Ue=0;Ue<ye.length;Ue+=1)ye[Ue].c();E=ne(),ae(z.$$.fragment),I=ne(),ae(L.$$.fragment),o.disabled=u=r[0].length>=3,ue(o,"type","checkbox"),o.__value="snap",Nn(o,o.__value),ue(p,"class","secondary"),p.disabled=g=r[6].length==0,Xe(n,"display","flex"),Xe(n,"gap","16px"),O.p(o)},m(Ue,De){W(Ue,e,De),W(Ue,t,De),W(Ue,n,De),D(n,i),D(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),D(i,s),D(n,d),D(n,p),_e.m(p,null),W(Ue,y,De),oe(x,Ue,De),W(Ue,C,De);for(let xe=0;xe<J.length;xe+=1)J[xe]&&J[xe].m(Ue,De);W(Ue,T,De);for(let xe=0;xe<ye.length;xe+=1)ye[xe]&&ye[xe].m(Ue,De);W(Ue,E,De),oe(z,Ue,De),W(Ue,I,De),oe(L,Ue,De),B=!0,Y||(q=[St(o,"change",r[21]),St(p,"click",r[9])],Y=!0)},p(Ue,De){if((!B||De[0]&1&&u!==(u=Ue[0].length>=3))&&(o.disabled=u),De[0]&32&&(o.checked=~(Ue[5]||[]).indexOf(o.__value)),Z===(Z=H(Ue))&&_e?_e.p(Ue,De):(_e.d(1),_e=Z(Ue),_e&&(_e.c(),_e.m(p,null))),(!B||De[0]&64&&g!==(g=Ue[6].length==0))&&(p.disabled=g),De[0]&114832){Ie=On(Ue[7]);let Ze;for(Ze=0;Ze<Ie.length;Ze+=1){const Qe=Ov(Ue,Ie,Ze);J[Ze]?(J[Ze].p(Qe,De),N(J[Ze],1)):(J[Ze]=$v(Qe),J[Ze].c(),N(J[Ze],1),J[Ze].m(T.parentNode,T))}for(Xt(),Ze=Ie.length;Ze<J.length;Ze+=1)fe(Ze);Kt()}if(De[0]&143373){Ee=On(Ue[0]);let Ze;for(Ze=0;Ze<Ee.length;Ze+=1){const Qe=Fv(Ue,Ee,Ze);ye[Ze]?(ye[Ze].p(Qe,De),N(ye[Ze],1)):(ye[Ze]=Nv(Qe),ye[Ze].c(),N(ye[Ze],1),ye[Ze].m(E.parentNode,E))}for(Xt(),Ze=Ee.length;Ze<ye.length;Ze+=1)Oe(Ze);Kt()}const xe={};De[0]&2&&(xe.data=Ue[1]||Fi()),De[1]&4096&&(xe.$$scope={dirty:De,ctx:Ue}),z.$set(xe);const et={};De[0]&256&&(et.data=Ue[8]),De[1]&4096&&(et.$$scope={dirty:De,ctx:Ue}),L.$set(et)},i(Ue){if(!B){N(x.$$.fragment,Ue);for(let De=0;De<Ie.length;De+=1)N(J[De]);for(let De=0;De<Ee.length;De+=1)N(ye[De]);N(z.$$.fragment,Ue),N(L.$$.fragment,Ue),B=!0}},o(Ue){V(x.$$.fragment,Ue),J=J.filter(Boolean);for(let De=0;De<J.length;De+=1)V(J[De]);ye=ye.filter(Boolean);for(let De=0;De<ye.length;De+=1)V(ye[De]);V(z.$$.fragment,Ue),V(L.$$.fragment,Ue),B=!1},d(Ue){Ue&&(G(e),G(t),G(n),G(y),G(C),G(T),G(E),G(I)),_e.d(),se(x,Ue),di(J,Ue),di(ye,Ue),se(z,Ue),se(L,Ue),O.r(),Y=!1,sr(q)}}}function e8(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function t8(r,e,t){let n,i;st(r,sp,Je=>t(20,i=Je));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:s=void 0}=e;ei(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],g=[],y=null,x=!1,C=!1,T=!1;function E(Je){let yt=Je.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=yt}function z(){let Je=p.pop();t(6,p),Je&&t(0,u=Je)}function I(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function L(Je){u.length>=3||(I(),u.push({point:Je.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function B(Je){t(19,y={point:Je.detail.lngLat.toArray(),snapped:d=="snap"})}function O(Je){I(),t(0,u[Je].snapped=!u[Je].snapped,u),t(0,u)}function Y(Je){I(),u.splice(Je,1),t(0,u),t(2,x=!1)}function q(Je,yt,Et,Ot){if(Ot||yt.length>=3)return Fi();try{if(Je&&yt.length>0&&Et)return JSON.parse(Je.inner.calculateRoute([yt[yt.length-1],Et]))}catch{}return Fi()}function H(Je,yt,Et){if(Et)return;if(!Je||yt.length<3){t(7,g=[]);return}let Ot=[],Yt=1,tn=JSON.parse(JSON.stringify(yt));tn.push(tn[0]);for(let Qt=0;Qt<tn.length-1;Qt++){let fn=JSON.parse(Je.inner.getExtraNodes(tn[Qt],tn[Qt+1]));for(let[pn,He,We]of fn)Ot.push({point:[pn,He],snapped:We,insertIdx:Yt});Yt++}t(7,g=Ot)}function Z(Je){I(),u.splice(Je.insertIdx,0,{point:Je.point,snapped:Je.snapped}),t(0,u),t(4,T=!0)}function _e(Je){t(0,u[Je.insertIdx].point=Je.point,u),t(0,u)}function Ie(){t(4,T=!1)}function J(){I(),t(3,C=!0)}const fe=[[]];function Ee(){d=sk(fe[0],this.__value,this.checked),t(5,d)}function ye(Je,yt){r.$$.not_equal(yt.point,Je)&&(yt.point=Je,t(7,g))}const Oe=Je=>Z(Je),Ue=Je=>_e(Je),De=Je=>{Z(Je),t(4,T=!1)};function xe(Je,yt){r.$$.not_equal(yt.point,Je)&&(yt.point=Je,t(0,u))}const et=Je=>O(Je),Ze=Je=>Y(Je),Qe=()=>t(2,x=!0),ct=()=>t(2,x=!1),dt=()=>t(3,C=!1);return r.$$set=Je=>{"map"in Je&&t(18,o=Je.map),"waypoints"in Je&&t(0,u=Je.waypoints),"drawnShapeOut"in Je&&t(1,s=Je.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,s=e8(i,u))}catch(Je){console.log("error drawing shape",Je),t(1,s=void 0)}r.$$.dirty[0]&1048593&&H(i,u,T),r.$$.dirty[0]&1572877&&t(8,n=q(i,u,y,x||C)),r.$$.dirty[0]&1&&E(u)},[u,s,x,C,T,d,p,g,n,z,L,B,O,Y,Z,_e,Ie,J,o,y,i,Ee,fe,ye,Oe,Ue,De,xe,et,Ze,Qe,ct,dt]}class Z2 extends Tt{constructor(e){super(),Ct(this,e,t8,Q6,wt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function jv(r,e,t){const n=r.slice();return n[4]=e[t],n[6]=t,n}function Uv(r){let e,t,n,i,o,u,s;return o=new vC({props:{strokeWidth:"4px",size:"14px"}}),{c(){e=j("div"),t=j("div"),n=ne(),i=j("div"),ae(o.$$.fragment),u=ne(),ue(t,"class","bucket-color svelte-lqjxv2"),Xe(t,"background",r[4]),ue(i,"class","bucket-indicator svelte-lqjxv2"),ue(e,"class","bucket svelte-lqjxv2"),Gt(e,"selected",r[6]==r[1])},m(d,p){W(d,e,p),D(e,t),D(e,n),D(e,i),oe(o,i,null),D(e,u),s=!0},p(d,p){p&1&&Xe(t,"background",d[4]),(!s||p&2)&&Gt(e,"selected",d[6]==d[1])},i(d){s||(N(o.$$.fragment,d),s=!0)},o(d){V(o.$$.fragment,d),s=!1},d(d){d&&G(e),se(o)}}}function n8(r){let e,t,n=On(r[0]),i=[];for(let u=0;u<n.length;u+=1)i[u]=Uv(jv(r,n,u));const o=u=>V(i[u],1,1,()=>{i[u]=null});return{c(){e=j("div");for(let u=0;u<i.length;u+=1)i[u].c();ue(e,"class","colors svelte-lqjxv2")},m(u,s){W(u,e,s);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null);t=!0},p(u,[s]){if(s&3){n=On(u[0]);let d;for(d=0;d<n.length;d+=1){const p=jv(u,n,d);i[d]?(i[d].p(p,s),N(i[d],1)):(i[d]=Uv(p),i[d].c(),N(i[d],1),i[d].m(e,null))}for(Xt(),d=n.length;d<i.length;d+=1)o(d);Kt()}},i(u){if(!t){for(let s=0;s<n.length;s+=1)N(i[s]);t=!0}},o(u){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)V(i[s]);t=!1},d(u){u&&G(e),di(i,u)}}}function r8(r,e){let t=0;for(let n of r.slice(1,-1)){if(e<n)break;t++}return t}function i8(r,e,t){let n,{colorScale:i}=e,{limits:o}=e,{value:u}=e;return r.$$set=s=>{"colorScale"in s&&t(0,i=s.colorScale),"limits"in s&&t(2,o=s.limits),"value"in s&&t(3,u=s.value)},r.$$.update=()=>{r.$$.dirty&12&&t(1,n=r8(o,u))},[i,n,o,u]}class Cl extends Tt{constructor(e){super(),Ct(this,e,i8,n8,wt,{colorScale:0,limits:2,value:3})}}function Vv(r){let e,t,n,i,o,u,s,d=1+Math.floor(r[0].properties.simd/20)+"",p,g,y,x,C,T,E,z,I=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",L,B,O,Y,q,H,Z,_e,Ie,J=ac(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",fe,Ee,ye,Oe,Ue,De,xe,et,Ze,Qe=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",ct,dt,Je,yt,Et,Ot,Yt,tn,Qt,fn=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",pn,He,We,mt,Pt,he,nn,Pe,tt,jt=r[0].properties.combined_score+"",Gn,Un,jn;return i=new Cl({props:{colorScale:ah.toReversed(),limits:lh,value:100-r[0].properties.simd}}),T=new Cl({props:{colorScale:sc,limits:r[2].population_density,value:r[0].properties.population/r[0].properties.area_km2}}),Z=new Cl({props:{colorScale:ch.toReversed(),limits:uh,value:100*(1-r[0].properties.households_with_cars_or_vans/r[0].properties.total_households)}}),xe=new Cl({props:{colorScale:a_,limits:r[2].poi_density,value:r[0].properties.number_pois/r[0].properties.area_km2}}),Yt=new Cl({props:{colorScale:s_,limits:r[2].collision_density,value:r[0].properties.number_stats19_collisions/r[0].properties.area_km2}}),nn=new Cl({props:{colorScale:u_,limits:l_,value:r[0].properties.combined_score}}),{c(){e=j("tr"),t=j("th"),n=Te(`SIMD
        `),ae(i.$$.fragment),o=ne(),u=j("td"),s=Te("quintile "),p=Te(d),g=ne(),y=j("tr"),x=j("th"),C=Te(`Population density
        `),ae(T.$$.fragment),E=ne(),z=j("td"),L=Te(I),B=Te(" people / km²"),O=ne(),Y=j("tr"),q=j("th"),H=Te(`Car ownership
        `),ae(Z.$$.fragment),_e=ne(),Ie=j("td"),fe=Te(J),Ee=Te(" of households"),ye=ne(),Oe=j("tr"),Ue=j("th"),De=Te(`POI density
        `),ae(xe.$$.fragment),et=ne(),Ze=j("td"),ct=Te(Qe),dt=Te(" / km²"),Je=ne(),yt=j("tr"),Et=j("th"),Ot=Te(`Collision density
        `),ae(Yt.$$.fragment),tn=ne(),Qt=j("td"),pn=Te(fn),He=Te(" / km²"),We=ne(),mt=j("tr"),Pt=j("th"),he=Te(`Overall prioritisation score
        `),ae(nn.$$.fragment),Pe=ne(),tt=j("td"),Gn=Te(jt),Un=Te(" / 5")},m(Wt,An){W(Wt,e,An),D(e,t),D(t,n),oe(i,t,null),D(e,o),D(e,u),D(u,s),D(u,p),W(Wt,g,An),W(Wt,y,An),D(y,x),D(x,C),oe(T,x,null),D(y,E),D(y,z),D(z,L),D(z,B),W(Wt,O,An),W(Wt,Y,An),D(Y,q),D(q,H),oe(Z,q,null),D(Y,_e),D(Y,Ie),D(Ie,fe),D(Ie,Ee),W(Wt,ye,An),W(Wt,Oe,An),D(Oe,Ue),D(Ue,De),oe(xe,Ue,null),D(Oe,et),D(Oe,Ze),D(Ze,ct),D(Ze,dt),W(Wt,Je,An),W(Wt,yt,An),D(yt,Et),D(Et,Ot),oe(Yt,Et,null),D(yt,tn),D(yt,Qt),D(Qt,pn),D(Qt,He),W(Wt,We,An),W(Wt,mt,An),D(mt,Pt),D(Pt,he),oe(nn,Pt,null),D(mt,Pe),D(mt,tt),D(tt,Gn),D(tt,Un),jn=!0},p(Wt,An){const ti={};An&1&&(ti.value=100-Wt[0].properties.simd),i.$set(ti),(!jn||An&1)&&d!==(d=1+Math.floor(Wt[0].properties.simd/20)+"")&&xt(p,d);const Bn={};An&4&&(Bn.limits=Wt[2].population_density),An&1&&(Bn.value=Wt[0].properties.population/Wt[0].properties.area_km2),T.$set(Bn),(!jn||An&1)&&I!==(I=Math.round(Wt[0].properties.population/Wt[0].properties.area_km2).toLocaleString()+"")&&xt(L,I);const _t={};An&1&&(_t.value=100*(1-Wt[0].properties.households_with_cars_or_vans/Wt[0].properties.total_households)),Z.$set(_t),(!jn||An&1)&&J!==(J=ac(Wt[0].properties.households_with_cars_or_vans,Wt[0].properties.total_households)+"")&&xt(fe,J);const mr={};An&4&&(mr.limits=Wt[2].poi_density),An&1&&(mr.value=Wt[0].properties.number_pois/Wt[0].properties.area_km2),xe.$set(mr),(!jn||An&1)&&Qe!==(Qe=(Wt[0].properties.number_pois/Wt[0].properties.area_km2).toFixed(1)+"")&&xt(ct,Qe);const ar={};An&4&&(ar.limits=Wt[2].collision_density),An&1&&(ar.value=Wt[0].properties.number_stats19_collisions/Wt[0].properties.area_km2),Yt.$set(ar),(!jn||An&1)&&fn!==(fn=(Wt[0].properties.number_stats19_collisions/Wt[0].properties.area_km2).toFixed(1)+"")&&xt(pn,fn);const gi={};An&1&&(gi.value=Wt[0].properties.combined_score),nn.$set(gi),(!jn||An&1)&&jt!==(jt=Wt[0].properties.combined_score+"")&&xt(Gn,jt)},i(Wt){jn||(N(i.$$.fragment,Wt),N(T.$$.fragment,Wt),N(Z.$$.fragment,Wt),N(xe.$$.fragment,Wt),N(Yt.$$.fragment,Wt),N(nn.$$.fragment,Wt),jn=!0)},o(Wt){V(i.$$.fragment,Wt),V(T.$$.fragment,Wt),V(Z.$$.fragment,Wt),V(xe.$$.fragment,Wt),V(Yt.$$.fragment,Wt),V(nn.$$.fragment,Wt),jn=!1},d(Wt){Wt&&(G(e),G(g),G(y),G(O),G(Y),G(ye),G(Oe),G(Je),G(yt),G(We),G(mt)),se(i),se(T),se(Z),se(xe),se(Yt),se(nn)}}}function o8(r){let e,t,n,i,o,u,s,d=r[0].properties.area_km2.toFixed(1)+"",p,g,y,x;o=new Cl({props:{colorScale:o_,limits:i_,value:r[0].properties.area_km2}});let C=r[1]=="cnt"&&Vv(r);return{c(){e=j("table"),t=j("tr"),n=j("th"),i=Te(`Area
      `),ae(o.$$.fragment),u=ne(),s=j("td"),p=Te(d),g=Te(" km²"),y=ne(),C&&C.c(),ue(e,"class","svelte-1kpsyee")},m(T,E){W(T,e,E),D(e,t),D(t,n),D(n,i),oe(o,n,null),D(t,u),D(t,s),D(s,p),D(s,g),D(e,y),C&&C.m(e,null),x=!0},p(T,[E]){const z={};E&1&&(z.value=T[0].properties.area_km2),o.$set(z),(!x||E&1)&&d!==(d=T[0].properties.area_km2.toFixed(1)+"")&&xt(p,d),T[1]=="cnt"?C?(C.p(T,E),E&2&&N(C,1)):(C=Vv(T),C.c(),N(C,1),C.m(e,null)):C&&(Xt(),V(C,1,1,()=>{C=null}),Kt())},i(T){x||(N(o.$$.fragment,T),N(C),x=!0)},o(T){V(o.$$.fragment,T),V(C),x=!1},d(T){T&&G(e),se(o),C&&C.d()}}}function s8(r,e,t){let n,i;st(r,xo,u=>t(1,n=u)),st(r,fc,u=>t(2,i=u));let{neighbourhoodBoundary:o}=e;return r.$$set=u=>{"neighbourhoodBoundary"in u&&t(0,o=u.neighbourhoodBoundary)},[o,n,i]}class X2 extends Tt{constructor(e){super(),Ct(this,e,s8,o8,wt,{neighbourhoodBoundary:0})}}function K2(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function a8(r){let e,t,n,i,o,u,s,d;return e=new fo({props:{colorScale:u_,labels:{buckets:l_}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.innerHTML="<span>Least important</span> <span>Most important</span>",i=ne(),o=j("br"),u=ne(),s=j("p"),s.textContent="This score averages the other five metrics, on the 1-5 scale.",ue(n,"class","sub-labels svelte-3xhwrh")},m(p,g){oe(e,p,g),W(p,t,g),W(p,n,g),W(p,i,g),W(p,o,g),W(p,u,g),W(p,s,g),d=!0},p:lt,i(p){d||(N(e.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),d=!1},d(p){p&&(G(t),G(n),G(i),G(o),G(u),G(s)),se(e,p)}}}function l8(r){let e,t,n,i;return e=new fo({props:{colorScale:a_,labels:{limits:r[1].poi_density}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.textContent="POIs / km²",Xe(n,"text-align","center")},m(o,u){oe(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].poi_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),se(e,o)}}}function u8(r){let e,t,n,i;return e=new fo({props:{colorScale:s_,labels:{limits:r[1].collision_density}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.textContent="collisions / km²",Xe(n,"text-align","center")},m(o,u){oe(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].collision_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),se(e,o)}}}function c8(r){let e,t,n,i;return e=new fo({props:{colorScale:ah.toReversed(),labels:{buckets:S2(lh).toReversed()}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.innerHTML="<span>Less deprived</span> <span>More deprived</span>",ue(n,"class","sub-labels svelte-3xhwrh")},m(o,u){oe(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:lt,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),se(e,o)}}}function f8(r){let e,t,n,i;return e=new fo({props:{colorScale:ch.toReversed(),labels:{limits:uh.toReversed().map(m8)}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Xe(n,"display","flex"),Xe(n,"justify-content","space-between")},m(o,u){oe(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:lt,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),se(e,o)}}}function h8(r){let e,t,n,i;return e=new fo({props:{colorScale:sc,labels:{limits:r[1].population_density}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.innerHTML="<span>Less dense</span> <span>people / km²</span> <span>More dense</span>",ue(n,"class","sub-labels svelte-3xhwrh")},m(o,u){oe(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].population_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),se(e,o)}}}function d8(r){let e,t,n,i;return e=new fo({props:{colorScale:o_,labels:{limits:i_}}}),{c(){ae(e.$$.fragment),t=ne(),n=j("div"),n.innerHTML="<span></span> <span>km²</span> <span></span>",ue(n,"class","sub-labels svelte-3xhwrh")},m(o,u){oe(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:lt,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),se(e,o)}}}function p8(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B;const O=[d8,h8,f8,c8,u8,l8,a8],Y=[];function q(H,Z){return H[0]=="area"?0:H[0]=="population_density"?1:H[0]=="car_ownership"?2:H[0]=="simd"?3:H[0]=="stats19"?4:H[0]=="pois"?5:H[0]=="combined"?6:-1}return~(T=q(r))&&(E=Y[T]=O[T](r)),{c(){e=j("div"),t=j("label"),t.textContent="Metric",n=ne(),i=j("select"),o=j("option"),o.textContent="None",u=j("option"),u.textContent="Area",s=j("option"),s.textContent="SIMD",d=j("option"),d.textContent="Population density",p=j("option"),p.textContent="Car ownership",g=j("option"),g.textContent="Points of interest",y=j("option"),y.textContent="Collisions",x=j("option"),x.textContent="Overall prioritisation score",C=ne(),E&&E.c(),z=rr(),Xe(t,"margin","0"),Xe(t,"padding","0"),ue(t,"for","prioritization-selection"),o.__value="none",Nn(o,o.__value),u.__value="area",Nn(u,u.__value),s.__value="simd",Nn(s,s.__value),d.__value="population_density",Nn(d,d.__value),p.__value="car_ownership",Nn(p,p.__value),g.__value="pois",Nn(g,g.__value),y.__value="stats19",Nn(y,y.__value),x.__value="combined",Nn(x,x.__value),ue(i,"id","prioritization-selection"),r[0]===void 0&&Yo(()=>r[2].call(i)),Xe(e,"display","flex"),Xe(e,"gap","16px"),Xe(e,"align-items","center"),Xe(e,"width","fit-content")},m(H,Z){W(H,e,Z),D(e,t),D(e,n),D(e,i),D(i,o),D(i,u),D(i,s),D(i,d),D(i,p),D(i,g),D(i,y),D(i,x),Ci(i,r[0],!0),W(H,C,Z),~T&&Y[T].m(H,Z),W(H,z,Z),I=!0,L||(B=St(i,"change",r[2]),L=!0)},p(H,[Z]){Z&1&&Ci(i,H[0]);let _e=T;T=q(H),T===_e?~T&&Y[T].p(H,Z):(E&&(Xt(),V(Y[_e],1,1,()=>{Y[_e]=null}),Kt()),~T?(E=Y[T],E?E.p(H,Z):(E=Y[T]=O[T](H),E.c()),N(E,1),E.m(z.parentNode,z)):E=null)},i(H){I||(N(E),I=!0)},o(H){V(E),I=!1},d(H){H&&(G(e),G(C),G(z)),~T&&Y[T].d(H),L=!1,B()}}}const m8=r=>`${r}%`;function g8(r,e,t){let n,i;st(r,xo,d=>t(3,n=d)),st(r,fc,d=>t(1,i=d));let{selectedPrioritization:o}=e;function u(){let d=new URL(window.location.href).searchParams.get("prioritisationMetric");d=="area"?t(0,o="area"):d=="population_density"?t(0,o="population_density"):d=="simd"?t(0,o="simd"):d=="stats19"?t(0,o="stats19"):d=="pois"?t(0,o="pois"):d=="car_ownership"?t(0,o="car_ownership"):d=="combined"&&t(0,o="combined")}n=="cnt"?u():o="none";function s(){o=ia(this),t(0,o)}return r.$$set=d=>{"selectedPrioritization"in d&&t(0,o=d.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const d=new URL(window.location.href);o=="none"?d.searchParams.delete("prioritisationMetric"):d.searchParams.set("prioritisationMetric",o),history.replaceState({},"",d)}},[o,i,s]}class J2 extends Tt{constructor(e){super(),Ct(this,e,g8,p8,wt,{selectedPrioritization:0})}}function Y2(r,e,t){return{none:r.none,area:Bi(["get","area_km2"],i_,o_),car_ownership:Bi(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],uh,ch),population_density:Bi(["/",["get","population"],["get","area_km2"]],t.population_density,sc),pois:Bi(["/",["get","number_pois"],["get","area_km2"]],t.poi_density,a_),simd:Bi(["get","simd"],lh,ah),stats19:Bi(["/",["get","number_stats19_collisions"],["get","area_km2"]],t.collision_density,s_),combined:Bi(["get","combined_score"],l_,u_)}[e]}function _8(r){let e,t,n,i,o,u,s,d,p,g,y=vr(r[8].mode)+"",x,C;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),x=Te(y),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(T,E){W(T,e,E),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),D(g,x),C=!0},p(T,E){(!C||E[0]&256)&&y!==(y=vr(T[8].mode)+"")&&xt(x,y)},i(T){C||(N(o.$$.fragment,T),N(d.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(d.$$.fragment,T),C=!1},d(T){T&&G(e),se(o),se(d)}}}function qv(r){let e,t,n,i,o,u,s;function d(g){r[20](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new J2({props:p}),_n.push(()=>Rn(o,"selectedPrioritization",d)),{c(){e=j("h3"),e.textContent="Prioritisation",t=ne(),n=j("p"),n.textContent=`Compare the prioritisation or individual metrics across candidate
        neighbourhoods.`,i=ne(),ae(o.$$.fragment)},m(g,y){W(g,e,y),W(g,t,y),W(g,n,y),W(g,i,y),oe(o,g,y),s=!0},p(g,y){const x={};!u&&y[0]&16&&(u=!0,x.selectedPrioritization=g[4],Dn(()=>u=!1)),o.$set(x)},i(g){s||(N(o.$$.fragment,g),s=!0)},o(g){V(o.$$.fragment,g),s=!1},d(g){g&&(G(e),G(t),G(n),G(i)),se(o,g)}}}function Hv(r){let e;return{c(){e=j("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function y8(r){let e,t,n,i,o,u,s,d;function p(x){r[23](x)}function g(x){r[24](x)}let y={map:_r(r[10])};return r[6]!==void 0&&(y.waypoints=r[6]),r[1]!==void 0&&(y.drawnShapeOut=r[1]),n=new Z2({props:y}),_n.push(()=>Rn(n,"waypoints",p)),_n.push(()=>Rn(n,"drawnShapeOut",g)),{c(){e=j("div"),e.innerHTML='<h3 class="svelte-iaefgo">1. Draw your neighbourhood</h3>',t=ne(),ae(n.$$.fragment),u=ne(),s=j("div"),s.innerHTML=`<h3 class="svelte-iaefgo">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,ue(e,"class","step svelte-iaefgo"),Gt(e,"active",!r[7]),Gt(e,"complete",r[7]),ue(s,"class","step svelte-iaefgo"),Xe(s,"margin-top","16px"),Gt(s,"active",r[7]),Gt(s,"complete",r[5].size>1)},m(x,C){W(x,e,C),W(x,t,C),oe(n,x,C),W(x,u,C),W(x,s,C),d=!0},p(x,C){(!d||C[0]&128)&&Gt(e,"active",!x[7]),(!d||C[0]&128)&&Gt(e,"complete",x[7]);const T={};C[0]&1024&&(T.map=_r(x[10])),!i&&C[0]&64&&(i=!0,T.waypoints=x[6],Dn(()=>i=!1)),!o&&C[0]&2&&(o=!0,T.drawnShapeOut=x[1],Dn(()=>o=!1)),n.$set(T),(!d||C[0]&128)&&Gt(s,"active",x[7]),(!d||C[0]&32)&&Gt(s,"complete",x[5].size>1)},i(x){d||(N(n.$$.fragment,x),d=!0)},o(x){V(n.$$.fragment,x),d=!1},d(x){x&&(G(e),G(t),G(u),G(s)),se(n,x)}}}function v8(r){let e,t,n;return{c(){e=j("div"),e.innerHTML=`<h3 class="svelte-iaefgo">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=ne(),n=j("div"),n.innerHTML='<h3 class="svelte-iaefgo">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',ue(e,"class","step svelte-iaefgo"),Gt(e,"active",!r[7]),Gt(e,"complete",r[7]),ue(n,"class","step svelte-iaefgo"),Gt(n,"active",r[7]),Gt(n,"complete",r[5].size>1)},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o[0]&128&&Gt(e,"active",!i[7]),o[0]&128&&Gt(e,"complete",i[7]),o[0]&128&&Gt(n,"active",i[7]),o[0]&32&&Gt(n,"complete",i[5].size>1)},i:lt,o:lt,d(i){i&&(G(e),G(t),G(n))}}}function b8(r){let e;function t(o,u){if(o[0]=="choose-area")return A8;if(o[0]=="draw-area")return x8}let n=t(r),i=n&&n(r);return{c(){e=j("span"),i&&i.c(),Xe(e,"text-align","center")},m(o,u){W(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:lt,o:lt,d(o){o&&G(e),i&&i.d()}}}function w8(r){let e,t;return e=new X2({props:{neighbourhoodBoundary:r[7]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function x8(r){let e;function t(o,u){return o[6].length<3?S8:k8}let n=t(r),i=n(r);return{c(){i.c(),e=rr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i.d(o)}}}function A8(r){let e;return{c(){e=Te("Empty so far. Click a colored area to get started.")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function k8(r){let e;return{c(){e=Te(`Not a valid shape yet — try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function S8(r){let e;return{c(){e=Te(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function C8(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De,xe,et,Ze,Qe,ct,dt,Je,yt,Et,Ot,Yt;t=new Ns({props:{mode:{mode:"pick-neighbourhood"}}});let tn=r[9]=="cnt"&&qv(r),Qt=r[4]=="none"&&Hv();y=new x2({}),E=new r_({});const fn=[v8,y8],pn=[];function He(he,nn){return he[0]=="choose-area"?0:he[0]=="draw-area"?1:-1}~(L=He(r))&&(B=pn[L]=fn[L](r)),Ee=new dp({});const We=[w8,b8],mt=[];function Pt(he,nn){return he[7]?0:1}return Ze=Pt(r),Qe=mt[Ze]=We[Ze](r),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),tn&&tn.c(),i=ne(),Qt&&Qt.c(),o=ne(),u=j("hr"),s=ne(),d=j("div"),p=j("div"),g=j("button"),ae(y.$$.fragment),x=Te(`
          Choose area`),C=Te(`
        or
        `),T=j("button"),ae(E.$$.fragment),z=Te(`
          Draw area`),I=ne(),B&&B.c(),O=ne(),Y=j("div"),Y.innerHTML='<h3 class="svelte-iaefgo">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',q=ne(),H=j("div"),Z=j("button"),_e=Te("Create neighborhood"),J=ne(),fe=j("button"),ae(Ee.$$.fragment),ye=Te(" Start over"),Ue=ne(),De=j("h3"),De.textContent="Your neighbourhood overall",xe=ne(),et=j("div"),Qe.c(),ct=ne(),dt=j("hr"),Je=ne(),yt=j("button"),yt.textContent="Export metrics to GeoJSON",Gt(g,"active",r[0]=="choose-area"),Gt(T,"active",r[0]=="draw-area"),ue(p,"class","tool-palette svelte-iaefgo"),Xe(p,"display","flex"),Xe(p,"align-items","center"),Xe(p,"gap","16px"),ue(Y,"class","step svelte-iaefgo"),Gt(Y,"active",r[7]),Z.disabled=Ie=!r[7],ue(fe,"class","destructive"),Xe(fe,"display","flex"),Xe(fe,"gap","8px"),Xe(fe,"align-items","center"),fe.disabled=Oe=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Xe(H,"display","flex"),Xe(H,"gap","16px"),Xe(H,"justify-content","space-between"),Xe(H,"margin-bottom","16px"),ue(et,"class","neighbourhood-boundary-summary svelte-iaefgo"),ue(yt,"class","secondary"),ue(e,"slot","sidebar")},m(he,nn){W(he,e,nn),oe(t,e,null),D(e,n),tn&&tn.m(e,null),D(e,i),Qt&&Qt.m(e,null),D(e,o),D(e,u),D(e,s),D(e,d),D(d,p),D(p,g),oe(y,g,null),D(g,x),D(p,C),D(p,T),oe(E,T,null),D(T,z),D(d,I),~L&&pn[L].m(d,null),D(d,O),D(d,Y),D(d,q),D(d,H),D(H,Z),D(Z,_e),D(H,J),D(H,fe),oe(Ee,fe,null),D(fe,ye),D(d,Ue),D(d,De),D(d,xe),D(d,et),mt[Ze].m(et,null),D(e,ct),D(e,dt),D(e,Je),D(e,yt),Et=!0,Ot||(Yt=[St(g,"click",r[21]),St(T,"click",r[22]),St(Z,"click",r[25]),St(fe,"click",r[16]),St(yt,"click",r[13])],Ot=!0)},p(he,nn){he[9]=="cnt"?tn?(tn.p(he,nn),nn[0]&512&&N(tn,1)):(tn=qv(he),tn.c(),N(tn,1),tn.m(e,i)):tn&&(Xt(),V(tn,1,1,()=>{tn=null}),Kt()),he[4]=="none"?Qt||(Qt=Hv(),Qt.c(),Qt.m(e,o)):Qt&&(Qt.d(1),Qt=null),(!Et||nn[0]&1)&&Gt(g,"active",he[0]=="choose-area"),(!Et||nn[0]&1)&&Gt(T,"active",he[0]=="draw-area");let Pe=L;L=He(he),L===Pe?~L&&pn[L].p(he,nn):(B&&(Xt(),V(pn[Pe],1,1,()=>{pn[Pe]=null}),Kt()),~L?(B=pn[L],B?B.p(he,nn):(B=pn[L]=fn[L](he),B.c()),N(B,1),B.m(d,O)):B=null),(!Et||nn[0]&128)&&Gt(Y,"active",he[7]),(!Et||nn[0]&128&&Ie!==(Ie=!he[7]))&&(Z.disabled=Ie),(!Et||nn[0]&193&&Oe!==(Oe=!(he[7]||he[0]=="draw-area"&&he[6].length>0)))&&(fe.disabled=Oe);let tt=Ze;Ze=Pt(he),Ze===tt?mt[Ze].p(he,nn):(Xt(),V(mt[tt],1,1,()=>{mt[tt]=null}),Kt(),Qe=mt[Ze],Qe?Qe.p(he,nn):(Qe=mt[Ze]=We[Ze](he),Qe.c()),N(Qe,1),Qe.m(et,null))},i(he){Et||(N(t.$$.fragment,he),N(tn),N(y.$$.fragment,he),N(E.$$.fragment,he),N(B),N(Ee.$$.fragment,he),N(Qe),Et=!0)},o(he){V(t.$$.fragment,he),V(tn),V(y.$$.fragment,he),V(E.$$.fragment,he),V(B),V(Ee.$$.fragment,he),V(Qe),Et=!1},d(he){he&&G(e),se(t),tn&&tn.d(),Qt&&Qt.d(),se(y),se(E),~L&&pn[L].d(),se(Ee),mt[Ze].d(),Ot=!1,sr(Yt)}}}function Gv(r){let e,t;return e=new yr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[T8]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function T8(r){let e,t,n,i;const o=[yn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new hr({props:u});const s=[yn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8}}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new hr({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function Wv(r){let e,t;return e=new yr({props:{data:r[3],generateId:!0,$$slots:{default:[B8]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function Zv(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[D8,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741840|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function M8(r){let e,t,n,i,o=r[30].combined_score+"",u;return{c(){e=j("b"),e.textContent="Combined score",t=ne(),n=j("br"),i=ne(),u=Te(o)},m(s,d){W(s,e,d),W(s,t,d),W(s,n,d),W(s,i,d),W(s,u,d)},p(s,d){d[0]&1073741824&&o!==(o=s[30].combined_score+"")&&xt(u,o)},d(s){s&&(G(e),G(t),G(n),G(i),G(u))}}}function E8(r){let e,t,n,i,o=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",u,s;return{c(){e=j("b"),e.textContent="Points of interest",t=ne(),n=j("br"),i=ne(),u=Te(o),s=Te(" / km²")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_pois/d[30].area_km2).toFixed(1)+"")&&xt(u,o)},d(d){d&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function L8(r){let e,t,n,i,o=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",u,s;return{c(){e=j("b"),e.textContent="Pedestrian and cyclist collisions",t=ne(),n=j("br"),i=ne(),u=Te(o),s=Te(` /
                km²`)},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_stats19_collisions/d[30].area_km2).toFixed(1)+"")&&xt(u,o)},d(d){d&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function I8(r){let e,t,n,i,o=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",u,s;return{c(){e=j("b"),e.textContent="Population density",t=ne(),n=j("br"),i=ne(),u=Te(o),s=Te(`
                people / km²`)},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p[0]&1073741824&&o!==(o=Math.round(d[30].population/d[30].area_km2).toLocaleString()+"")&&xt(u,o)},d(d){d&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function P8(r){let e,t,n,i,o=ac(r[30].households_with_cars_or_vans,r[30].total_households)+"",u,s,d=r[30].total_households.toLocaleString()+"",p,g;return{c(){e=j("b"),e.textContent="Car or van ownership",t=ne(),n=j("br"),i=ne(),u=Te(o),s=Te(" of approximately "),p=Te(d),g=Te(`
                households have at least one car or van.`)},m(y,x){W(y,e,x),W(y,t,x),W(y,n,x),W(y,i,x),W(y,u,x),W(y,s,x),W(y,p,x),W(y,g,x)},p(y,x){x[0]&1073741824&&o!==(o=ac(y[30].households_with_cars_or_vans,y[30].total_households)+"")&&xt(u,o),x[0]&1073741824&&d!==(d=y[30].total_households.toLocaleString()+"")&&xt(p,d)},d(y){y&&(G(e),G(t),G(n),G(i),G(u),G(s),G(p),G(g))}}}function z8(r){let e,t,n=r[30].area_km2.toFixed(1)+"",i,o;return{c(){e=j("b"),e.textContent="Area:",t=ne(),i=Te(n),o=Te(" km²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&1073741824&&n!==(n=u[30].area_km2.toFixed(1)+"")&&xt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function D8(r){let e;function t(o,u){if(o[4]=="none"||o[4]=="area")return z8;if(o[4]=="car_ownership")return P8;if(o[4]=="population_density")return I8;if(o[4]=="stats19")return L8;if(o[4]=="pois")return E8;if(o[4]=="combined")return M8}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i&&i.d(o)}}}function R8(r){let e,t,n=r[4]!="simd"&&Zv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&N(n,1)):(n=Zv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function B8(r){let e,t,n,i;const o=[yn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[R8]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new Ki({props:u}),e.$on("click",r[11]);const s=[yn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new hr({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y=g[0]&49168?Tn(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g[0]&16|g[1]&1&&(y.$$scope={dirty:g,ctx:p}),e.$set(y);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function F8(r){let e,t,n,i=r[7]&&Gv(r),o=r[0]=="choose-area"&&Wv(r);return{c(){e=j("div"),i&&i.c(),t=ne(),o&&o.c(),ue(e,"slot","map")},m(u,s){W(u,e,s),i&&i.m(e,null),D(e,t),o&&o.m(e,null),n=!0},p(u,s){u[7]?i?(i.p(u,s),s[0]&128&&N(i,1)):(i=Gv(u),i.c(),N(i,1),i.m(e,t)):i&&(Xt(),V(i,1,1,()=>{i=null}),Kt()),u[0]=="choose-area"?o?(o.p(u,s),s[0]&1&&N(o,1)):(o=Wv(u),o.c(),N(o,1),o.m(e,null)):o&&(Xt(),V(o,1,1,()=>{o=null}),Kt())},i(u){n||(N(i),N(o),n=!0)},o(u){V(i),V(o),n=!1},d(u){u&&G(e),i&&i.d(),o&&o.d()}}}function O8(r){let e,t,n,i;return e=new oc({props:{loading:r[2]}}),n=new Ao({props:{$$slots:{map:[F8],sidebar:[C8],top:[_8]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,u){const s={};u[0]&4&&(s.loading=o[2]),e.$set(s);const d={};u[0]&2043|u[1]&1&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function $8(r,e,t){let n,i,o,u,s,d,p,g;st(r,fc,De=>t(26,n=De)),st(r,Qn,De=>t(8,i=De)),st(r,Ia,De=>t(27,o=De)),st(r,kr,De=>t(19,u=De)),st(r,Os,De=>t(28,s=De)),st(r,Ha,De=>t(29,d=De)),st(r,xo,De=>t(9,p=De)),st(r,as,De=>t(10,g=De));let y="Generating severance boundaries...",x=Fi(),C="choose-area",T=p=="cnt"?"combined":"none",E=null,z=new Map,I=[],L,B=null,O=null;ls(async()=>{await gp(),t(3,x=u.generatedBoundaries()),t(2,y="")});function Y(De){let xe=De.detail.features[0].id,et=x.features[xe],Ze=new Map(z);if(Ze.has(xe)?Ze.delete(xe):Ze.set(xe,et),Ze.size===0)t(17,E=null),t(5,z=Ze);else if(Ze.size===1)t(17,E=Ze.values().next().value),t(5,z=Ze);else{let Qe={type:"FeatureCollection",features:Array.from(Ze.values())};try{t(17,E=u.generateMergedBoundary(Qe)),t(5,z=Ze)}catch(ct){console.log(`error merging boundaries: ${ct}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${ct}`)}}}function q(De){var Ze;let xe=d.nextAvailableNeighbourhoodName(s),et=K2(u,"What do you want to name the neighbourhood?",xe);if(et)try{const Qe={};C=="draw-area"&&((Ze=L==null?void 0:L.properties)!=null&&Ze.waypoints)&&(Qe.waypoints=L.properties.waypoints);let ct={type:"Feature",properties:Qe,geometry:De.geometry};u.setCurrentNeighbourhoodBoundary(et,ct),an(Ia,o=et,o),Hf(),an(Qn,i={mode:"neighbourhood"},i)}catch(Qe){window.alert(`Sorry, this boundary is invalid: ${Qe}`)}}function H(){lp("auto_boundaries.geojson",JSON.stringify(x,null,"  "))}function Z(De){return Y2({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},De,n)}function _e(De){return{none:Kn(.3,.5),area:Kn(.7,.9),car_ownership:Kn(.7,.9),population_density:Kn(.7,.9),pois:Kn(.7,.9),simd:Kn(.7,.9),stats19:Kn(.7,.9),combined:Kn(.7,.9)}[De]}function Ie(){t(17,E=null),z.clear(),t(5,z),t(6,I=[]),t(18,B=null),t(7,O=null)}function J(De){T=De,t(4,T)}const fe=()=>t(0,C="choose-area"),Ee=()=>t(0,C="draw-area");function ye(De){I=De,t(6,I)}function Oe(De){L=De,t(1,L)}const Ue=()=>q(_r(O));return r.$$.update=()=>{if(r.$$.dirty[0]&524290){let De=null;if(L&&L.geometry.coordinates[0].length>3){let xe={type:"FeatureCollection",features:[L]};try{De=u.generateMergedBoundary(xe)}catch(et){console.log(`error merging boundaries: ${et}`)}}t(18,B=De)}r.$$.dirty[0]&393217&&(C=="draw-area"?t(7,O=B):t(7,O=E))},[C,L,y,x,T,z,I,O,i,p,g,Y,q,H,Z,_e,Ie,E,B,u,J,fe,Ee,ye,Oe,Ue]}class N8 extends Tt{constructor(e){super(),Ct(this,e,$8,O8,wt,{},null,[-1,-1])}}const j8="/ltn/assets/bus_gate_icon-5ea86d80.gif",U8="/ltn/assets/bus_gate-fc08b133.gif",V8="/ltn/assets/no_entry_icon-a9bfd826.gif",q8="/ltn/assets/no_entry-6857cf3d.gif",H8="/ltn/assets/school_street_icon-38e9058e.gif",G8="/ltn/assets/school_street-a0b77e20.gif",W8="/ltn/assets/walk_cycle_only_icon-4c8b48c0.gif",Z8="/ltn/assets/walk_cycle_only-03bfc59f.gif",vi=class vi{constructor(e,t,n,i,o){tr(this,"filterType");tr(this,"label");tr(this,"description");tr(this,"imageUrl");tr(this,"iconUrl");this.filterType=e,this.label=t,this.description=n,this.imageUrl=i,this.iconUrl=o}get iconURL(){return this.iconUrl}get largeImageURL(){return this.imageUrl}static getFilter(e){switch(e){case"walk_cycle_only":return vi.walkCycleOnly;case"no_entry":return vi.noEntry;case"bus_gate":return vi.busGate;case"school_street":return vi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};tr(vi,"walkCycleOnly",new vi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.",Z8,W8)),tr(vi,"noEntry",new vi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.",q8,V8)),tr(vi,"busGate",new vi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.",U8,j8)),tr(vi,"schoolStreet",new vi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.",G8,H8)),tr(vi,"allTypes",[vi.walkCycleOnly,vi.noEntry,vi.busGate,vi.schoolStreet]);let Ri=vi;function X8(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T=vr(r[7].mode)+"",E,z;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),y=new $n({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),ae(y.$$.fragment),x=ne(),C=j("li"),E=Te(T),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(I,L){W(I,e,L),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),oe(y,g,null),D(n,x),D(n,C),D(C,E),z=!0},p(I,L){(!z||L&128)&&T!==(T=vr(I[7].mode)+"")&&xt(E,T)},i(I){z||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(y.$$.fragment,I),z=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(y.$$.fragment,I),z=!1},d(I){I&&G(e),se(o),se(d),se(y)}}}function K8(r){let e;return{c(){e=j("p"),e.textContent="Hover on a zone"},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function J8(r){let e,t=r[6].properties.name+"",n,i,o,u,s=r[6].properties.sum_from.toLocaleString()+"",d,p,g,y,x=r[6].properties.sum_to.toLocaleString()+"",C,T,E,z,I=r[6].properties.counts_from[r[3]]+"",L;return{c(){e=j("u"),n=Te(t),i=ne(),o=j("p"),u=Te("Total trips from here: "),d=Te(s),p=ne(),g=j("p"),y=Te("Total trips to here: "),C=Te(x),T=ne(),E=j("p"),z=Te("Total intra-zonal trips starting and ending here: "),L=Te(I)},m(B,O){W(B,e,O),D(e,n),W(B,i,O),W(B,o,O),D(o,u),D(o,d),W(B,p,O),W(B,g,O),D(g,y),D(g,C),W(B,T,O),W(B,E,O),D(E,z),D(E,L)},p(B,O){O&64&&t!==(t=B[6].properties.name+"")&&xt(n,t),O&64&&s!==(s=B[6].properties.sum_from.toLocaleString()+"")&&xt(d,s),O&64&&x!==(x=B[6].properties.sum_to.toLocaleString()+"")&&xt(C,x),O&72&&I!==(I=B[6].properties.counts_from[B[3]]+"")&&xt(L,I)},d(B){B&&(G(e),G(i),G(o),G(p),G(g),G(T),G(E))}}}function Y8(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",s,d,p,g,y,x,C,T,E,z,I=r[1]?"from":"to",L,B,O=r[3]==null?"each zone":"this zone",Y,q,H,Z,_e,Ie,J,fe,Ee,ye;t=new Ns({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),Z=new fo({props:{colorScale:Od,labels:{limits:r[5]}}});function Oe(xe,et){return xe[6]&&xe[3]!=null?J8:K8}let Ue=Oe(r),De=Ue(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("p"),o=Te("Trips begin and end in "),s=Te(u),d=Te(" zones"),p=ne(),g=j("label"),y=Te(`Trips from
      `),x=j("input"),C=Te(`
      Trips to`),T=ne(),E=j("p"),z=Te("Trips "),L=Te(I),B=ne(),Y=Te(O),q=Te(":"),H=ne(),ae(Z.$$.fragment),_e=ne(),Ie=j("hr"),J=ne(),De.c(),ue(x,"type","checkbox"),ue(x,"role","switch"),ue(e,"slot","sidebar")},m(xe,et){W(xe,e,et),oe(t,e,null),D(e,n),D(e,i),D(i,o),D(i,s),D(i,d),D(e,p),D(e,g),D(g,y),D(g,x),x.checked=r[1],D(g,C),D(e,T),D(e,E),D(E,z),D(E,L),D(E,B),D(E,Y),D(E,q),D(e,H),oe(Z,e,null),D(e,_e),D(e,Ie),D(e,J),De.m(e,null),fe=!0,Ee||(ye=St(x,"change",r[9]),Ee=!0)},p(xe,et){(!fe||et&1)&&u!==(u=xe[0].features.length.toLocaleString()+"")&&xt(s,u),et&2&&(x.checked=xe[1]),(!fe||et&2)&&I!==(I=xe[1]?"from":"to")&&xt(L,I),(!fe||et&8)&&O!==(O=xe[3]==null?"each zone":"this zone")&&xt(Y,O);const Ze={};et&32&&(Ze.labels={limits:xe[5]}),Z.$set(Ze),Ue===(Ue=Oe(xe))&&De?De.p(xe,et):(De.d(1),De=Ue(xe),De&&(De.c(),De.m(e,null)))},i(xe){fe||(N(t.$$.fragment,xe),N(Z.$$.fragment,xe),fe=!0)},o(xe){V(t.$$.fragment,xe),V(Z.$$.fragment,xe),fe=!1},d(xe){xe&&G(e),se(t),se(Z),De.d(),Ee=!1,ye()}}}function Q8(r){let e,t,n,i,o;const u=[yn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Kn(.5,.1)}},{manageHoverState:!0}];function s(y){r[8](y)}let d={};for(let y=0;y<u.length;y+=1)d=Mt(d,u[y]);r[2]!==void 0&&(d.hovered=r[2]),e=new Ki({props:d}),_n.push(()=>Rn(e,"hovered",s));const p=[yn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let y=0;y<p.length;y+=1)g=Mt(g,p[y]);return i=new hr({props:g}),{c(){ae(e.$$.fragment),n=ne(),ae(i.$$.fragment)},m(y,x){oe(e,y,x),W(y,n,x),oe(i,y,x),o=!0},p(y,x){const C=x&16?Tn(u,[u[0],{paint:{"fill-color":y[4],"fill-opacity":Kn(.5,.1)}},u[2]]):{};!t&&x&4&&(t=!0,C.hovered=y[2],Dn(()=>t=!1)),e.$set(C);const T={};i.$set(T)},i(y){o||(N(e.$$.fragment,y),N(i.$$.fragment,y),o=!0)},o(y){V(e.$$.fragment,y),V(i.$$.fragment,y),o=!1},d(y){y&&G(n),se(e,y),se(i,y)}}}function eP(r){let e,t,n;return t=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[Q8]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","map")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function tP(r){let e,t;return e=new Ao({props:{$$slots:{map:[eP],sidebar:[Y8],top:[X8]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function nP(r,e,t){let n,i,o,u,s,d;st(r,Qn,z=>t(7,s=z)),st(r,kr,z=>t(10,d=z));let p=Fi();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),an(Qn,s={mode:"pick-neighbourhood"},s)}let g=!1,y=null;function x(z,I){if(z==null){let L=I?"sum_to":"sum_from",B=Math.max(...p.features.map(Y=>Y.properties[L])),O=C(B);return[O,Bi(["get",L],O,Od)]}else{let L=I?"counts_to":"counts_from",B=[...p.features.map(q=>q.properties[L][z])],O=Math.max(...B),Y=C(O);return[Y,Bi(["at",["id"],["literal",B]],Y,Od)]}}function C(z){let I=Od.length+1;return Array.from(Array(I).keys()).map(L=>Math.round(z/(I-1)*L))}function T(z){y=z,t(2,y)}function E(){g=this.checked,t(1,g)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=y==null?null:y.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=x(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,y)))},[p,g,y,n,u,o,i,s,T,E]}class rP extends Tt{constructor(e){super(),Ct(this,e,nP,tP,wt,{})}}function iP(r){let e,t,n,i,o,u,s,d,p,g,y=vr(r[4].mode)+"",x,C;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),x=Te(y),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(T,E){W(T,e,E),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),D(g,x),C=!0},p(T,E){(!C||E&16)&&y!==(y=vr(T[4].mode)+"")&&xt(x,y)},i(T){C||(N(o.$$.fragment,T),N(d.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(d.$$.fragment,T),C=!1},d(T){T&&G(e),se(o),se(d)}}}function Xv(r){let e,t,n,i,o,u,s;function d(g){r[7](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new mp({props:p}),_n.push(()=>Rn(n,"idx",d)),{c(){e=j("button"),e.textContent="Pick another intersection",t=ne(),ae(n.$$.fragment),ue(e,"class","secondary")},m(g,y){W(g,e,y),W(g,t,y),oe(n,g,y),o=!0,u||(s=St(e,"click",r[6]),u=!0)},p(g,y){const x={};y&2&&(x.list=g[1].features),!i&&y&4&&(i=!0,x.idx=g[2],Dn(()=>i=!1)),n.$set(x)},i(g){o||(N(n.$$.fragment,g),o=!0)},o(g){V(n.$$.fragment,g),o=!1},d(g){g&&(G(e),G(t)),se(n,g),u=!1,s()}}}function Kv(r){let e,t;return{c(){e=j("a"),t=Te("Open OSM"),ue(e,"href",r[0]),ue(e,"target","_blank")},m(n,i){W(n,e,i),D(e,t)},p(n,i){i&1&&ue(e,"href",n[0])},d(n){n&&G(e)}}}function oP(r){let e,t,n,i,o,u,s;t=new Ns({props:{mode:{mode:"pick-neighbourhood"}}});let d=r[1].features.length>0&&Xv(r),p=r[0]&&Kv(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=ne(),d&&d.c(),u=ne(),p&&p.c(),ue(e,"slot","sidebar")},m(g,y){W(g,e,y),oe(t,e,null),D(e,n),D(e,i),D(e,o),d&&d.m(e,null),D(e,u),p&&p.m(e,null),s=!0},p(g,y){g[1].features.length>0?d?(d.p(g,y),y&2&&N(d,1)):(d=Xv(g),d.c(),N(d,1),d.m(e,u)):d&&(Xt(),V(d,1,1,()=>{d=null}),Kt()),g[0]?p?p.p(g,y):(p=Kv(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){s||(N(t.$$.fragment,g),N(d),s=!0)},o(g){V(t.$$.fragment,g),V(d),s=!1},d(g){g&&G(e),se(t),d&&d.d(),p&&p.d()}}}function sP(r){let e,t;const n=[yn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Rl({props:i}),e.$on("click",r[5]),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function aP(r){let e,t,n,i;const o=[yn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new hr({props:u});const s=[yn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new Ki({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x=g&4?Tn(s,[s[0],{filter:["==",["id"],p[2]]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function lP(r){let e,t,n,i,o;return t=new yr({props:{data:_r(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[sP]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[1],generateId:!0,$$slots:{default:[aP]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),ue(e,"slot","map")},m(u,s){W(u,e,s),oe(t,e,null),D(e,n),oe(i,e,null),o=!0},p(u,s){const d={};s&8&&(d.data=_r(u[3]).getAllIntersections()),s&256&&(d.$$scope={dirty:s,ctx:u}),t.$set(d);const p={};s&2&&(p.data=u[1]),s&260&&(p.$$scope={dirty:s,ctx:u}),i.$set(p)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&G(e),se(t),se(i)}}}function uP(r){let e,t;return e=new Ao({props:{$$slots:{map:[lP],sidebar:[oP],top:[iP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function cP(r,e,t){let n,i;st(r,kr,y=>t(3,n=y)),st(r,Qn,y=>t(4,i=y));let o=null,u=Fi(),s=0;function d(y){t(0,o=y.detail.features[0].properties.osm),t(1,u=n.getMovements(y.detail.features[0].id)),t(2,s=0)}const p=()=>t(1,u=Fi());function g(y){s=y,t(2,s)}return[o,u,s,n,i,d,p,g]}class fP extends Tt{constructor(e){super(),Ct(this,e,cP,uP,wt,{})}}function hP(r){let e,t,n,i;const o=[yn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":qd(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new Ki({props:u});const s=[yn("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Td(1),"icon-offset":Jv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":qd(),"icon-halo-color":"black","icon-opacity":Yv(),"icon-halo-width":Td(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new ic({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,[g]){const y=g&1?Tn(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(y);const x=g&2?Tn(s,[s[0],s[1],g&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Td(1),"icon-offset":Jv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},g&0&&{paint:{"icon-color":qd(),"icon-halo-color":"black","icon-opacity":Yv(),"icon-halo-width":Td(1.5),"icon-halo-blur":0}},s[4],s[5]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function Td(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function Jv(r){return[0,-50*r]}function Yv(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function dP(r,e,t){let n,i;return st(r,np,o=>t(0,n=o)),st(r,ag,o=>t(1,i=o)),[n,i]}class _p extends Tt{constructor(e){super(),Ct(this,e,dP,hP,wt,{})}}function pP(r){let e,t;const n=[yn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}class yp extends Tt{constructor(e){super(),Ct(this,e,null,pP,wt,{})}}const mP=r=>({}),Qv=r=>({}),gP=r=>({}),eb=r=>({});function tb(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],eb);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,gP):xn(i[10]),eb)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function _P(r){let e,t,n=r[0]&&tb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=tb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function nb(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Qv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,mP):xn(i[10]),Qv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function yP(r){let e,t,n=r[0]&&nb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=nb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function vP(r){let e,t,n,i,o,u,s,d;const p=[yn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let I=0;I<p.length;I+=1)g=Mt(g,p[I]);e=new hr({props:g});const y=[yn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Kn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let x={$$slots:{default:[_P]},$$scope:{ctx:r}};for(let I=0;I<y.length;I+=1)x=Mt(x,y[I]);n=new hr({props:x}),n.$on("click",r[8]);const C=[yn("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let T={};for(let I=0;I<C.length;I+=1)T=Mt(T,C[I]);o=new hr({props:T});const E=[yn("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Kn("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":Kn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let z={$$slots:{default:[yP]},$$scope:{ctx:r}};for(let I=0;I<E.length;I+=1)z=Mt(z,E[I]);return s=new hr({props:z}),s.$on("click",r[9]),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment)},m(I,L){oe(e,I,L),W(I,t,L),oe(n,I,L),W(I,i,L),oe(o,I,L),W(I,u,L),oe(s,I,L),d=!0},p(I,[L]){const B=L&84?Tn(p,[p[0],p[1],{paint:{"line-width":I[6](I[2],I[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(B);const O=L&125?Tn(y,[y[0],y[1],L&124&&{paint:{"line-width":I[6](I[2],I[4].maxShortcuts,0),"line-color":I[5](I[3],I[4].maxShortcuts),"line-opacity":Kn(1,.5)}},y[3],y[4],L&1&&{manageHoverState:I[0]},L&1&&{hoverCursor:I[0]?"pointer":void 0}]):{};L&1025&&(O.$$scope={dirty:L,ctx:I}),n.$set(O);const Y=L&84?Tn(C,[C[0],C[1],{paint:{"line-width":I[6](I[2],I[4].maxShortcuts,6),"line-color":"black"}},C[3]]):{};o.$set(Y);const q=L&85?Tn(E,[E[0],E[1],L&84&&{paint:{"line-width":I[6](I[2],I[4].maxShortcuts,4),"line-color":Kn("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":Kn(1,.5)}},E[3],E[4],L&1&&{manageHoverState:I[0]},L&1&&{hoverCursor:I[0]?"pointer":void 0}]):{};L&1025&&(q.$$scope={dirty:L,ctx:I}),s.$set(q)},i(I){d||(N(e.$$.fragment,I),N(n.$$.fragment,I),N(o.$$.fragment,I),N(s.$$.fragment,I),d=!0)},o(I){V(e.$$.fragment,I),V(n.$$.fragment,I),V(o.$$.fragment,I),V(s.$$.fragment,I),d=!1},d(I){I&&(G(t),G(i),G(u)),se(e,I),se(n,I),se(o,I),se(s,I)}}}function bP(r,e,t){let n,i;st(r,lg,T=>t(2,n=T)),st(r,np,T=>t(3,i=T));let{$$slots:o={},$$scope:u}=e,s=Yf("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(T,E)=>{}}=e;function g(T,E){return T=="cells"?qd():T=="edits"?Kn(["case",["get","edited"],sM,"white"],vo.mapFeature.hover.backgroundColor):T=="speeds"?Bi(["get","speed_mph"],k2,A2):E<=2?Kn("white","blue"):(console.assert(T=="shortcuts"),Kn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",E,"#A32015"],vo.mapFeature.hover.backgroundColor))}function y(T,E,z){return!T||E<=2?na(z):["interpolate",["linear"],["get","shortcuts"],0,5+z,E,25+z]}const x=T=>d&&p(T.detail.features[0],T.detail.event.lngLat),C=T=>d&&p(T.detail.features[0],T.detail.event.lngLat);return r.$$set=T=>{"interactive"in T&&t(0,d=T.interactive),"onClickLine"in T&&t(1,p=T.onClickLine),"$$scope"in T&&t(10,u=T.$$scope)},[d,p,n,i,s,g,y,o,x,C,u]}class hh extends Tt{constructor(e){super(),Ct(this,e,bP,vP,wt,{interactive:0,onClickLine:1})}}function wP(r){let e;const t=r[7].default,n=vn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&wn(n,t,i,i[9],e?bn(t,i[9],o,null):xn(i[9]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function xP(r){let e,t,n;const i=[yn("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(s){r[8](s)}let u={$$slots:{default:[wP]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=Mt(u,i[s]);return r[1]!==void 0&&(u.hovered=r[1]),e=new ic({props:u}),_n.push(()=>Rn(e,"hovered",o)),e.$on("click",function(){ca(r[0])&&r[0].apply(this,arguments)}),{c(){ae(e.$$.fragment)},m(s,d){oe(e,s,d),n=!0},p(s,d){r=s;const p=d&16?Tn(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],Dn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){se(e,s)}}}function AP(r){let e,t;const n=[yn("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function kP(r){let e,t,n,i;return e=new yr({props:{data:r[2],generateId:!0,$$slots:{default:[xP]},$$scope:{ctx:r}}}),n=new yr({props:{data:r[3],$$slots:{default:[AP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.data=o[2]),u&531&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&8&&(d.data=o[3]),u&512&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function SP(r,e,t){let n,i,o,u,s;st(r,kr,C=>t(5,o=C)),st(r,Di,C=>t(6,u=C)),st(r,tp,C=>t(4,s=C));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,y=null;function x(C){y=C,t(1,y)}return r.$$set=C=>{"onClickTurnRestriction"in C&&t(0,g=C.onClickTurnRestriction),"$$scope"in C&&t(9,p=C.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=y==null?Fi():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(y.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(y.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():Fi())},[g,y,i,n,s,o,u,d,x,p]}class CP extends Tt{constructor(e){super(),Ct(this,e,SP,kP,wt,{onClickTurnRestriction:0})}}const TP=r=>({}),rb=r=>({}),MP=r=>({}),ib=r=>({});function EP(r){let e;const t=r[7]["modal-filter"],n=vn(t,r,r[8],ib);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,MP):xn(i[8]),ib)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function LP(r){let e,t,n,i;const o=[yn("modal-filters"),{interactive:r[2]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},{minzoom:Md},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[EP]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new ic({props:u}),e.$on("click",function(){ca(r[0])&&r[0].apply(this,arguments)});const s=[yn("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Md},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new ic({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){r=p;const y=g&20?Tn(o,[o[0],g&4&&{interactive:r[2]},g&16&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Md},o[4],o[5]]):{};g&256&&(y.$$scope={dirty:g,ctx:r}),e.$set(y);const x=g&0?Tn(s,[s[0],s[1],{minzoom:Md},s[3],s[4]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function IP(r){let e;const t=r[7]["turn-restriction"],n=vn(t,r,r[8],rb);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,TP):xn(i[8]),rb)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function PP(r){let e,t,n,i;return e=new yr({props:{data:r[3],generateId:!0,$$slots:{default:[LP]},$$scope:{ctx:r}}}),n=new CP({props:{onClickTurnRestriction:r[1],$$slots:{default:[IP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,[u]){const s={};u&8&&(s.data=o[3]),u&277&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&2&&(d.onClickTurnRestriction=o[1]),u&256&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}let Md=13;function zP(r,e,t){let n,i,o,u;st(r,kr,x=>t(5,i=x)),st(r,Di,x=>t(6,o=x)),st(r,tp,x=>t(4,u=x));let{$$slots:s={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e,{interactive:y}=e;return r.$$set=x=>{"onClickModalFilter"in x&&t(0,p=x.onClickModalFilter),"onClickTurnRestriction"in x&&t(1,g=x.onClickTurnRestriction),"interactive"in x&&t(2,y=x.interactive),"$$scope"in x&&t(8,d=x.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&t(3,n=o>0?i.renderModalFilters():Fi())},[p,g,y,n,u,i,o,s,d]}class Ka extends Tt{constructor(e){super(),Ct(this,e,zP,PP,wt,{onClickModalFilter:0,onClickTurnRestriction:1,interactive:2})}}function DP(r){let e,t;const n=[yn("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new ic({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}class vp extends Tt{constructor(e){super(),Ct(this,e,null,DP,wt,{})}}function RP(r){let e;const t=r[3].default,n=vn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&wn(n,t,i,i[4],e?bn(t,i[4],o,null):xn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function BP(r){let e,t;return e=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[RP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function FP(r,e,t){let n,i;st(r,kr,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:s=null}=e;return r.$$set=d=>{"input"in d&&t(1,s=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||i.renderNeighbourhood()),r.$$.dirty&1&&ap("neighbourhoodGj",n)},[n,s,i,o,u]}class dh extends Tt{constructor(e){super(),Ct(this,e,FP,BP,wt,{input:1})}}function qd(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function OP(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T=vr(r[2].mode)+"",E,z;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),y=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),ae(y.$$.fragment),x=ne(),C=j("li"),E=Te(T),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(I,L){W(I,e,L),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),oe(y,g,null),D(n,x),D(n,C),D(C,E),z=!0},p(I,L){(!z||L&4)&&T!==(T=vr(I[2].mode)+"")&&xt(E,T)},i(I){z||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(y.$$.fragment,I),z=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(y.$$.fragment,I),z=!1},d(I){I&&G(e),se(o),se(d),se(y)}}}function ob(r){let e,t,n;return{c(){e=j("button"),e.textContent="Ⓧ",ue(e,"class","close-btn svelte-khnvno")},m(i,o){W(i,e,o),t||(n=St(e,"click",r[5]),t=!0)},p:lt,d(i){i&&G(e),t=!1,n()}}}function $P(r){let e;return{c(){e=j("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){W(t,e,n)},p:lt,i:lt,o:lt,d(t){t&&G(e)}}}function NP(r){let e,t,n,i,o,u,s;e=new Qf({props:{properties:r[0].feature.properties}});function d(g){r[6](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new mp({props:p}),_n.push(()=>Rn(o,"idx",d)),{c(){ae(e.$$.fragment),t=ne(),n=j("h5"),n.textContent="Turn restrictions:",i=ne(),ae(o.$$.fragment)},m(g,y){oe(e,g,y),W(g,t,y),W(g,n,y),W(g,i,y),oe(o,g,y),s=!0},p(g,y){const x={};y&1&&(x.properties=g[0].feature.properties),e.$set(x);const C={};y&1&&(C.list=g[0].movements.features),!u&&y&1&&(u=!0,C.idx=g[0].movementIdx,Dn(()=>u=!1)),o.$set(C)},i(g){s||(N(e.$$.fragment,g),N(o.$$.fragment,g),s=!0)},o(g){V(e.$$.fragment,g),V(o.$$.fragment,g),s=!1},d(g){g&&(G(t),G(n),G(i)),se(e,g),se(o,g)}}}function jP(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T;t=new Ns({props:{mode:{mode:"neighbourhood"}}});let E=r[0]&&ob(r);const z=[NP,$P],I=[];function L(B,O){return B[0]?0:1}return x=L(r),C=I[x]=z[x](r),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("h4"),i.textContent="Roads",o=ne(),u=j("p"),u.textContent="Click a road to visit its OSM object.",s=ne(),d=j("div"),p=j("h4"),p.textContent="Intersections",g=ne(),E&&E.c(),y=ne(),C.c(),Xe(d,"display","flex"),Xe(d,"align-items","start"),Xe(d,"justify-content","space-between"),ue(e,"slot","sidebar")},m(B,O){W(B,e,O),oe(t,e,null),D(e,n),D(e,i),D(e,o),D(e,u),D(e,s),D(e,d),D(d,p),D(d,g),E&&E.m(d,null),D(e,y),I[x].m(e,null),T=!0},p(B,O){B[0]?E?E.p(B,O):(E=ob(B),E.c(),E.m(d,null)):E&&(E.d(1),E=null);let Y=x;x=L(B),x===Y?I[x].p(B,O):(Xt(),V(I[Y],1,1,()=>{I[Y]=null}),Kt(),C=I[x],C?C.p(B,O):(C=I[x]=z[x](B),C.c()),N(C,1),C.m(e,null))},i(B){T||(N(t.$$.fragment,B),N(C),T=!0)},o(B){V(t.$$.fragment,B),V(C),T=!1},d(B){B&&G(e),se(t),E&&E.d(),I[x].d()}}}function UP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function VP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[UP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function qP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function HP(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[qP,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","line-popup")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function GP(r){let e,t,n,i,o,u,s,d,p,g;e=new yp({}),n=new _p({}),o=new vp({});const y=[yn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let x={$$slots:{default:[VP]},$$scope:{ctx:r}};for(let C=0;C<y.length;C+=1)x=Mt(x,y[C]);return s=new Rl({props:x}),p=new hh({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[HP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment),d=ne(),ae(p.$$.fragment)},m(C,T){oe(e,C,T),W(C,t,T),oe(n,C,T),W(C,i,T),oe(o,C,T),W(C,u,T),oe(s,C,T),W(C,d,T),oe(p,C,T),g=!0},p(C,T){const E={};T&256&&(E.$$scope={dirty:T,ctx:C}),s.$set(E);const z={};T&256&&(z.$$scope={dirty:T,ctx:C}),p.$set(z)},i(C){g||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(s.$$.fragment,C),N(p.$$.fragment,C),g=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),V(s.$$.fragment,C),V(p.$$.fragment,C),g=!1},d(C){C&&(G(t),G(i),G(u),G(d)),se(e,C),se(n,C),se(o,C),se(s,C),se(p,C)}}}function WP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ZP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[WP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function XP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function KP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[XP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function JP(r){var o,u,s;let e,t;const n=[yn("debug-intersections"),{paint:{"circle-radius":rg(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Kn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:s.intersection_id)??-1],.3,Kn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[KP]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=Mt(i,n[d]);return e=new Rl({props:i}),e.$on("click",r[3]),{c(){ae(e.$$.fragment)},m(d,p){oe(e,d,p),t=!0},p(d,p){var y,x,C;const g=p&1?Tn(n,[n[0],{paint:{"circle-radius":rg(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Kn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((C=(x=(y=d[0])==null?void 0:y.feature)==null?void 0:x.properties)==null?void 0:C.intersection_id)??-1],.3,Kn(0,.5)]}},n[2],n[3]]):{};p&256&&(g.$$scope={dirty:p,ctx:d}),e.$set(g)},i(d){t||(N(e.$$.fragment,d),t=!0)},o(d){V(e.$$.fragment,d),t=!1},d(d){se(e,d)}}}function sb(r){let e,t;return e=new yr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[YP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function YP(r){let e,t,n,i;const o=[yn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new hr({props:u});const s=[yn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new Ki({props:d}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y={};e.$set(y);const x=g&1?Tn(s,[s[0],{filter:["==",["id"],p[0].movementIdx]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function QP(r){let e,t,n,i,o,u,s,d;t=new dh({props:{$$slots:{default:[GP]},$$scope:{ctx:r}}}),i=new Ka({props:{interactive:!0,$$slots:{default:[ZP]},$$scope:{ctx:r}}}),u=new yr({props:{data:_r(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[JP]},$$scope:{ctx:r}}});let p=r[0]&&sb(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),o=ne(),ae(u.$$.fragment),s=ne(),p&&p.c(),ue(e,"slot","map")},m(g,y){W(g,e,y),oe(t,e,null),D(e,n),oe(i,e,null),D(e,o),oe(u,e,null),D(e,s),p&&p.m(e,null),d=!0},p(g,y){const x={};y&256&&(x.$$scope={dirty:y,ctx:g}),t.$set(x);const C={};y&256&&(C.$$scope={dirty:y,ctx:g}),i.$set(C);const T={};y&2&&(T.data=_r(g[1]).getAllIntersections()),y&257&&(T.$$scope={dirty:y,ctx:g}),u.$set(T),g[0]?p?(p.p(g,y),y&1&&N(p,1)):(p=sb(g),p.c(),N(p,1),p.m(e,null)):p&&(Xt(),V(p,1,1,()=>{p=null}),Kt())},i(g){d||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(u.$$.fragment,g),N(p),d=!0)},o(g){V(t.$$.fragment,g),V(i.$$.fragment,g),V(u.$$.fragment,g),V(p),d=!1},d(g){g&&G(e),se(t),se(i),se(u),p&&p.d()}}}function ez(r){let e,t;return e=new Ao({props:{$$slots:{map:[QP],sidebar:[jP],top:[OP]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function tz(r,e,t){let n,i;st(r,kr,g=>t(1,n=g)),st(r,Qn,g=>t(2,i=g));let o=null;function u(g){let y=g.detail.features[0],x=n.getMovements(y.properties.intersection_id);t(0,o={feature:y,movements:x,movementIdx:0})}const s=(g,y)=>window.open(_r(g.properties).way,"_blank"),d=()=>t(0,o=null);function p(g){r.$$.not_equal(o.movementIdx,g)&&(o.movementIdx=g,t(0,o))}return[o,n,i,u,s,d,p]}class nz extends Tt{constructor(e){super(),Ct(this,e,tz,ez,wt,{})}}const rz="/ltn/assets/eraser-894c4bbc.svg",iz="/ltn/assets/paintbrush-511a1297.svg",ab="/ltn/assets/one_way_left-9368d5dd.svg",oz="/ltn/assets/traffic_1-a90740ec.svg";var Po=63710088e-1,sz={centimeters:Po*100,centimetres:Po*100,degrees:360/(2*Math.PI),feet:Po*3.28084,inches:Po*39.37,kilometers:Po/1e3,kilometres:Po/1e3,meters:Po,metres:Po,miles:Po/1609.344,millimeters:Po*1e3,millimetres:Po*1e3,nauticalmiles:Po/1852,radians:1,yards:Po*1.0936};function az(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Tg(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!lb(r[0])||!lb(r[1]))throw new Error("coordinates must contain numbers");return az({type:"Point",coordinates:r},e,t)}function lz(r,e="kilometers"){const t=sz[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Mg(r){return r%(2*Math.PI)*180/Math.PI}function El(r){return r%360*Math.PI/180}function lb(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Eg(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function uz(r){return r.type==="Feature"?r.geometry:r}function Q2(r,e,t={}){if(t.final===!0)return cz(r,e);const n=Eg(r),i=Eg(e),o=El(n[0]),u=El(i[0]),s=El(n[1]),d=El(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return Mg(Math.atan2(p,g))}function cz(r,e){let t=Q2(e,r);return t=(t+180)%360,t}function fz(r,e,t,n={}){const i=Eg(r),o=El(i[0]),u=El(i[1]),s=El(t),d=lz(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),y=Mg(g),x=Mg(p);return Tg([y,x],n.properties)}var zo=63710088e-1,hz={centimeters:zo*100,centimetres:zo*100,degrees:360/(2*Math.PI),feet:zo*3.28084,inches:zo*39.37,kilometers:zo/1e3,kilometres:zo/1e3,meters:zo,metres:zo,miles:zo/1609.344,millimeters:zo*1e3,millimetres:zo*1e3,nauticalmiles:zo/1852,radians:1,yards:zo*1.0936};function dz(r,e="kilometers"){const t=hz[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Ed(r){return r%360*Math.PI/180}function ub(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ex(r,e,t={}){var n=ub(r),i=ub(e),o=Ed(i[1]-n[1]),u=Ed(i[0]-n[0]),s=Ed(n[1]),d=Ed(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return dz(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}var pz=ex;function mz(r,e,t={}){const i=uz(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const s=e-o;if(s){const d=Q2(i[u],i[u-1])-180;return fz(i[u],s,d,t)}else return Tg(i[u])}else o+=ex(i[u],i[u+1],t);return Tg(i[i.length-1])}var gz=mz;function _z(r){let e,t;const n=[yn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Rl({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function yz(r){let e,t;return e=new yr({props:{data:r[0],$$slots:{default:[_z]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}let vz=50,bz=100,wz=.01;function xz(r,e,t){let{paths:n}=e,i=d(),o=p(),u=y(),s=setInterval(x,bz);ei(()=>clearInterval(s));function d(){return n.features.map(C=>1/C.properties.directness).reduce((C,T)=>C+T,0)}function p(){return n.features.length==0?[]:Array.from({length:vz},g)}function g(){let C=Math.random()*i,T=0;for(let[E,z]of n.features.entries())if(T+=1/z.properties.directness,C<T)return{idx:E,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function y(){return{type:"FeatureCollection",features:o.map(({idx:C,distance:T})=>gz(n.features[C],T,{units:"kilometers"}))}}function x(){for(let[C,T]of o.entries())T.distance+=wz,T.distance>=n.features[T.idx].properties.length_meters/1e3&&(o[C]=g());t(0,u=y())}return r.$$set=C=>{"paths"in C&&t(1,n=C.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[u,n]}class Az extends Tt{constructor(e){super(),Ct(this,e,xz,yz,wt,{paths:1})}}class kz{constructor(e){tr(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}const g_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==";function Sz(r){let e,t,n,i,o;return{c(){e=j("div"),e.textContent="+",t=ne(),n=j("img"),o=Te(`
    Add diagonal filter`),Xe(e,"font-size","200%"),Xe(e,"margin-top","-12px"),ue(e,"class","icon"),Sr(n.src,i=g_)||ue(n,"src",i),ue(n,"alt","Add diagonal filter"),Xe(n,"transform","rotate(135deg)"),ue(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},p:lt,d(u){u&&(G(e),G(t),G(n),G(o))}}}function Cz(r){let e;function t(o,u){return o[0].hasRotatedFilter?Mz:Tz}let n=t(r),i=n(r);return{c(){i.c(),e=rr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i.d(o)}}}function Tz(r){let e,t,n,i,o;return{c(){e=j("div"),e.textContent="↻",t=ne(),n=j("img"),o=Te(`
      Rotate diagonal filter`),Xe(e,"font-size","200%"),Xe(e,"padding-bottom","4px"),ue(e,"class","icon"),Sr(n.src,i=g_)||ue(n,"src",i),ue(n,"alt","Rotate diagonal filter"),Xe(n,"transform","rotate(45deg)"),ue(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(G(e),G(t),G(n),G(o))}}}function Mz(r){let e,t,n,i,o;return{c(){e=j("div"),e.textContent="❌",t=ne(),n=j("img"),o=Te(`
      Delete diagonal filter`),ue(e,"class","icon"),Sr(n.src,i=g_)||ue(n,"src",i),ue(n,"alt","Remove diagonal filter"),Xe(n,"transform","rotate(45deg)"),ue(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(G(e),G(t),G(n),G(o))}}}function Ez(r){let e;function t(o,u){return o[0].filter?Cz:Sz}let n=t(r),i=n(r);return{c(){e=j("div"),i.c(),Xe(e,"display","flex"),Xe(e,"align-items","center")},m(o,u){W(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:lt,o:lt,d(o){o&&G(e),i.d()}}}function Lz(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class Iz extends Tt{constructor(e){super(),Ct(this,e,Lz,Ez,wt,{intersection:0})}}function Pz(r){let e,t;return e=new Iz({props:{intersection:r[2](r[6])}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function zz(r){let e,t;return e=new s2({props:{openOn:"hover",$$slots:{default:[Pz,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function Dz(r){let e,t;const n=[yn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":rg(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-opacity":Kn(0,.5),"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Kn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[zz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Rl({props:i}),e.$on("click",r[4]),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,[u]){const s=u&2?Tn(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function Rz(r,e,t){let{neighbourhood:n=Yf("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new kz(g)}function s(p){return u(p[0].id)}const d=p=>i(s(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,s,n,d]}class Bz extends Tt{constructor(e){super(),Ct(this,e,Rz,Dz,wt,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function cb(r,e,t){const n=r.slice();return n[6]=e[t],n}function fb(r){let e,t,n,i,o,u,s=r[6].label+"",d,p,g,y,x;function C(){return r[3](r[6])}return{c(){e=j("button"),t=j("img"),i=ne(),o=j("br"),u=ne(),d=Te(s),p=ne(),Sr(t.src,n=r[6].iconURL)||ue(t,"src",n),ue(t,"width","80"),ue(t,"alt",r[6].label),ue(e,"class","outline"),Xe(e,"width","100%"),e.disabled=g=r[1]==r[6].filterType},m(T,E){W(T,e,E),D(e,t),D(e,i),D(e,o),D(e,u),D(e,d),D(e,p),y||(x=St(e,"click",C),y=!0)},p(T,E){r=T,E&2&&g!==(g=r[1]==r[6].filterType)&&(e.disabled=g)},d(T){T&&G(e),y=!1,x()}}}function Fz(r){let e,t,n,i,o,u,s,d,p,g,y,x,C=r[2].description+"",T,E,z,I,L,B,O=On(Ri.allTypes),Y=[];for(let q=0;q<O.length;q+=1)Y[q]=fb(cb(r,O,q));return{c(){e=j("h3"),e.textContent="Choose a modal filter to place on streets",t=ne(),n=j("table"),i=j("tr"),o=j("td");for(let q=0;q<Y.length;q+=1)Y[q].c();u=ne(),s=j("td"),d=j("img"),y=ne(),x=j("p"),T=Te(C),E=ne(),z=j("center"),I=j("button"),I.textContent="Confirm",Sr(d.src,p=r[2].largeImageURL)||ue(d,"src",p),ue(d,"height","300"),ue(d,"alt",g=r[2].label)},m(q,H){W(q,e,H),W(q,t,H),W(q,n,H),D(n,i),D(i,o);for(let Z=0;Z<Y.length;Z+=1)Y[Z]&&Y[Z].m(o,null);D(i,u),D(i,s),D(s,d),D(s,y),D(s,x),D(x,T),W(q,E,H),W(q,z,H),D(z,I),L||(B=St(I,"click",r[4]),L=!0)},p(q,H){if(H&2){O=On(Ri.allTypes);let Z;for(Z=0;Z<O.length;Z+=1){const _e=cb(q,O,Z);Y[Z]?Y[Z].p(_e,H):(Y[Z]=fb(_e),Y[Z].c(),Y[Z].m(o,null))}for(;Z<Y.length;Z+=1)Y[Z].d(1);Y.length=O.length}H&4&&!Sr(d.src,p=q[2].largeImageURL)&&ue(d,"src",p),H&4&&g!==(g=q[2].label)&&ue(d,"alt",g),H&4&&C!==(C=q[2].description+"")&&xt(T,C)},d(q){q&&(G(e),G(t),G(n),G(E),G(z)),di(Y,q),L=!1,B()}}}function Oz(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[Fz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Rg({props:o}),_n.push(()=>Rn(e,"show",i)),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&519&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function $z(r,e,t){let n,i;st(r,sg,p=>t(1,i=p));let{show:o}=e;const u=p=>an(sg,i=p.filterType,i),s=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=Ri.allTypes.find(p=>p.filterType==i))},[o,i,n,u,s,d]}class Nz extends Tt{constructor(e){super(),Ct(this,e,$z,Oz,wt,{show:0})}}function hb(r){let e,t;return e=new yr({props:{data:r[0],$$slots:{default:[jz]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function jz(r){let e,t;const n=[yn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function Uz(r){let e,t,n=r[0]&&hb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=hb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function Vz(r,e,t){let{map:n}=e,i=null;const o=$s();n.on("dragstart",u),n.on("mousemove",s),n.on("mouseup",d),ei(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",s),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(p){if(i){let g=p.lngLat.toArray(),y=i.geometry.coordinates.at(-1);if(y&&pz(y,g)*1e3<.5)return;i.geometry.coordinates.push(g),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function d(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class tx extends Tt{constructor(e){super(),Ct(this,e,Vz,Uz,wt,{map:1})}}function qz(r){let e;return{c(){e=j("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function db(r){let e,t,n;return t=new $n({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[Hz]},$$scope:{ctx:r}}}),{c(){e=j("li"),ae(t.$$.fragment)},m(i,o){W(i,e,o),oe(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function Hz(r){let e;return{c(){e=Te("Debug")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Gz(r){let e,t,n,i,o,u,s,d,p,g,y=vr(r[14].mode)+"",x,C,T,E,z,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),T=new Bl({props:{$$slots:{default:[qz]},$$scope:{ctx:r}}}),B=new $n({props:{mode:{mode:"view-shortcuts"}}}),q=new $n({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),_e=new $n({props:{mode:{mode:"predict-impact",prevMode:"neighbourhood"}}}),fe=new $n({props:{mode:{mode:"impact-one-destination"}}}),Oe=new $n({props:{mode:{mode:"set-boundary",name:_r(r[7]).properties.name,existing:_r(r[7])}}});let xe=r[15]&&db(r);return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),x=Te(y),C=ne(),ae(T.$$.fragment),E=ne(),z=j("nav"),I=j("ul"),L=j("li"),ae(B.$$.fragment),O=ne(),Y=j("li"),ae(q.$$.fragment),H=ne(),Z=j("li"),ae(_e.$$.fragment),Ie=ne(),J=j("li"),ae(fe.$$.fragment),Ee=ne(),ye=j("li"),ae(Oe.$$.fragment),Ue=ne(),xe&&xe.c(),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top"),Xe(e,"display","flex"),Xe(e,"justify-content","space-between")},m(et,Ze){W(et,e,Ze),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),D(g,x),D(g,C),oe(T,g,null),D(e,E),D(e,z),D(z,I),D(I,L),oe(B,L,null),D(I,O),D(I,Y),oe(q,Y,null),D(I,H),D(I,Z),oe(_e,Z,null),D(I,Ie),D(I,J),oe(fe,J,null),D(I,Ee),D(I,ye),oe(Oe,ye,null),D(I,Ue),xe&&xe.m(I,null),De=!0},p(et,Ze){(!De||Ze[0]&16384)&&y!==(y=vr(et[14].mode)+"")&&xt(x,y);const Qe={};Ze[1]&4194304&&(Qe.$$scope={dirty:Ze,ctx:et}),T.$set(Qe);const ct={};Ze[0]&128&&(ct.mode={mode:"set-boundary",name:_r(et[7]).properties.name,existing:_r(et[7])}),Oe.$set(ct),et[15]?xe?Ze[0]&32768&&N(xe,1):(xe=db(et),xe.c(),N(xe,1),xe.m(I,null)):xe&&(Xt(),V(xe,1,1,()=>{xe=null}),Kt())},i(et){De||(N(o.$$.fragment,et),N(d.$$.fragment,et),N(T.$$.fragment,et),N(B.$$.fragment,et),N(q.$$.fragment,et),N(_e.$$.fragment,et),N(fe.$$.fragment,et),N(Oe.$$.fragment,et),N(xe),De=!0)},o(et){V(o.$$.fragment,et),V(d.$$.fragment,et),V(T.$$.fragment,et),V(B.$$.fragment,et),V(q.$$.fragment,et),V(_e.$$.fragment,et),V(fe.$$.fragment,et),V(Oe.$$.fragment,et),V(xe),De=!1},d(et){et&&G(e),se(o),se(d),se(T),se(B),se(q),se(_e),se(fe),se(Oe),xe&&xe.d()}}}function Wz(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De;return g=new x2({}),z=new w2({}),q=new DC({}),fe=new dp({}),{c(){e=j("h3"),e.textContent="Reclassify main roads",t=ne(),n=j("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=ne(),o=j("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`,u=ne(),s=j("div"),d=j("button"),p=j("div"),ae(g.$$.fragment),y=ne(),x=j("span"),x.textContent="Toggle segment or pan map",C=ne(),T=j("button"),E=j("div"),ae(z.$$.fragment),I=ne(),L=j("span"),L.textContent="Mark as main along a line",B=ne(),O=j("button"),Y=j("div"),ae(q.$$.fragment),H=ne(),Z=j("span"),Z.textContent="Erase main classification",_e=ne(),Ie=j("button"),J=j("div"),ae(fe.$$.fragment),Ee=ne(),ye=j("span"),ye.textContent="Erase all main roads",Xe(p,"display","flex"),Xe(p,"align-items","center"),Xe(p,"gap","8px"),ue(d,"data-tippy-content","Click a road to reclassify it"),Gt(d,"active",!r[0].freehand),Gt(d,"outline",r[0].freehand),Xe(E,"display","flex"),Xe(E,"align-items","center"),Xe(E,"gap","8px"),ue(T,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Gt(T,"active",r[0].freehand&&r[0].isMain),Gt(T,"outline",!(r[0].freehand&&r[0].isMain)),Xe(Y,"display","flex"),Xe(Y,"align-items","center"),Xe(Y,"gap","8px"),ue(O,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Gt(O,"active",r[0].freehand&&!r[0].isMain),Gt(O,"outline",!(r[0].freehand&&!r[0].isMain)),Xe(J,"display","flex"),Xe(J,"align-items","center"),Xe(J,"gap","8px"),Gt(Ie,"outline",!0),ue(s,"class","classification-buttons svelte-b4nchc"),Xe(s,"display","flex"),Xe(s,"flex-direction","column"),Xe(s,"gap","8px"),Xe(s,"justify-content","left")},m(xe,et){W(xe,e,et),W(xe,t,et),W(xe,n,et),W(xe,i,et),W(xe,o,et),W(xe,u,et),W(xe,s,et),D(s,d),D(d,p),oe(g,p,null),D(p,y),D(p,x),D(s,C),D(s,T),D(T,E),oe(z,E,null),D(E,I),D(E,L),D(s,B),D(s,O),D(O,Y),oe(q,Y,null),D(Y,H),D(Y,Z),D(s,_e),D(s,Ie),D(Ie,J),oe(fe,J,null),D(J,Ee),D(J,ye),Oe=!0,Ue||(De=[St(d,"click",r[41]),St(T,"click",r[42]),St(O,"click",r[43]),St(Ie,"click",r[28])],Ue=!0)},p(xe,et){(!Oe||et[0]&1)&&Gt(d,"active",!xe[0].freehand),(!Oe||et[0]&1)&&Gt(d,"outline",xe[0].freehand),(!Oe||et[0]&1)&&Gt(T,"active",xe[0].freehand&&xe[0].isMain),(!Oe||et[0]&1)&&Gt(T,"outline",!(xe[0].freehand&&xe[0].isMain)),(!Oe||et[0]&1)&&Gt(O,"active",xe[0].freehand&&!xe[0].isMain),(!Oe||et[0]&1)&&Gt(O,"outline",!(xe[0].freehand&&!xe[0].isMain))},i(xe){Oe||(N(g.$$.fragment,xe),N(z.$$.fragment,xe),N(q.$$.fragment,xe),N(fe.$$.fragment,xe),Oe=!0)},o(xe){V(g.$$.fragment,xe),V(z.$$.fragment,xe),V(q.$$.fragment,xe),V(fe.$$.fragment,xe),Oe=!1},d(xe){xe&&(G(e),G(t),G(n),G(i),G(o),G(u),G(s)),se(g),se(z),se(q),se(fe),Ue=!1,sr(De)}}}function Zz(r){let e,t,n;return{c(){e=j("h3"),e.textContent="Restrict turns",t=ne(),n=j("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:lt,i:lt,o:lt,d(i){i&&(G(e),G(t),G(n))}}}function Xz(r){let e,t,n;return{c(){e=j("h3"),e.textContent="Toggle one-way",t=ne(),n=j("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:lt,i:lt,o:lt,d(i){i&&(G(e),G(t),G(n))}}}function Kz(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L;function B(Y){r[37](Y)}let O={};return r[4]!==void 0&&(O.show=r[4]),o=new Nz({props:O}),_n.push(()=>Rn(o,"show",B)),C=new w2({}),{c(){e=j("h3"),e.textContent="Add modal filter",t=ne(),n=j("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=ne(),ae(o.$$.fragment),s=ne(),d=j("div"),p=j("button"),p.textContent="Change modal filter type",g=ne(),y=j("button"),x=j("div"),ae(C.$$.fragment),T=ne(),E=j("span"),E.textContent="Add along a line",ue(p,"class","outline"),Xe(x,"display","flex"),Xe(x,"align-items","center"),Xe(x,"gap","8px"),ue(y,"data-tippy-content","Add many modal filters along a line"),Gt(y,"active",r[0].freehand),Gt(y,"outline",!r[0].freehand),Xe(d,"display","flex"),Xe(d,"gap","8px"),Xe(d,"align-items","leading"),Xe(d,"flex-direction","column"),Xe(d,"width","fit-content")},m(Y,q){W(Y,e,q),W(Y,t,q),W(Y,n,q),W(Y,i,q),oe(o,Y,q),W(Y,s,q),W(Y,d,q),D(d,p),D(d,g),D(d,y),D(y,x),oe(C,x,null),D(x,T),D(x,E),z=!0,I||(L=[St(p,"click",r[38]),St(y,"click",function(){ca(r[0].freehand?r[39]:r[40])&&(r[0].freehand?r[39]:r[40]).apply(this,arguments)})],I=!0)},p(Y,q){r=Y;const H={};!u&&q[0]&16&&(u=!0,H.show=r[4],Dn(()=>u=!1)),o.$set(H),(!z||q[0]&1)&&Gt(y,"active",r[0].freehand),(!z||q[0]&1)&&Gt(y,"outline",!r[0].freehand)},i(Y){z||(N(o.$$.fragment,Y),N(C.$$.fragment,Y),z=!0)},o(Y){V(o.$$.fragment,Y),V(C.$$.fragment,Y),z=!1},d(Y){Y&&(G(e),G(t),G(n),G(i),G(s),G(d)),se(o,Y),se(C),I=!1,sr(L)}}}function pb(r){let e;return{c(){e=j("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function mb(r){let e,t;return e=new fo({props:{colorScale:A2,labels:{limits:k2}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function Jz(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De,xe,et,Ze,Qe,ct,dt,Je,yt,Et,Ot,Yt,tn,Qt,fn,pn,He,We,mt,Pt,he,nn,Pe,tt,jt,Gn,Un,jn,Wt,An,ti,Bn,_t,mr,ar;L=new RT({}),H=new CT({});const gi=[Kz,Xz,Zz,Wz],Vn=[];function $e(Dt,rn){return Dt[0].kind=="filter"?0:Dt[0].kind=="oneway"?1:Dt[0].kind=="turn_restriction"?2:Dt[0].kind=="main-roads"?3:-1}~(fe=$e(r))&&(Ee=Vn[fe]=gi[fe](r));let pt=r[9]>0&&pb(),vt=r[13]=="speeds"&&mb();return Bn=new X2({props:{neighbourhoodBoundary:_r(r[7])}}),{c(){e=j("div"),t=j("h2"),t.textContent="Editing tools",n=ne(),i=j("div"),o=j("div"),u=j("button"),s=j("img"),p=ne(),g=j("button"),g.innerHTML=`<div style="height: 100%; width: 100%; position: relative;"><img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${ab}" alt="Reverse directions"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${ab}" alt="Reverse directions"/></div>`,y=ne(),x=j("button"),x.innerHTML=`<img src="${Dg}" alt="Restrict turns"/>`,C=ne(),T=j("button"),T.innerHTML=`<img src="${oz}" alt="Change main/minor roads"/>`,E=ne(),z=j("div"),I=j("button"),ae(L.$$.fragment),Y=ne(),q=j("button"),ae(H.$$.fragment),Ie=ne(),J=j("div"),Ee&&Ee.c(),ye=ne(),pt&&pt.c(),Oe=ne(),Ue=j("h2"),Ue.textContent="Map style",De=ne(),xe=j("label"),et=j("input"),Ze=Te(`
      Animate shortcuts`),Qe=j("span"),ct=Te("1"),dt=ne(),Je=j("label"),yt=j("input"),Et=Te(`
      Show entries into cells`),Ot=j("span"),Yt=Te("2"),tn=ne(),Qt=j("label"),fn=j("input"),pn=Te(`
      Road thickness depends on shortcuts`),He=j("span"),We=Te("1"),mt=ne(),Pt=j("label"),he=j("span"),he.textContent="Draw roads:",nn=ne(),Pe=j("select"),tt=j("option"),tt.textContent="Worst shortcuts",jt=j("option"),jt.textContent="Cell",Gn=j("option"),Gn.textContent="Edits (either filter or direction)",Un=j("option"),Un.textContent="Speed limit",jn=ne(),vt&&vt.c(),Wt=ne(),An=j("h2"),An.textContent="Neighbourhood stats",ti=ne(),ae(Bn.$$.fragment),Sr(s.src,d=_r(Ri.getFilter(r[10])).iconURL)||ue(s,"src",d),ue(s,"alt","Add a modal filter"),ue(u,"class","icon-btn"),ue(u,"data-tippy-content","Add a modal filter (hotkey 1)"),Gt(u,"active",r[0].kind=="filter"),ue(g,"class","icon-btn"),ue(g,"data-tippy-content","Toggle one-way (hotkey 2)"),Gt(g,"active",r[0].kind=="oneway"),ue(x,"class","icon-btn"),ue(x,"data-tippy-content","Restrict turns (hotkey 3)"),Gt(x,"active",r[0].kind=="turn_restriction"),ue(T,"class","icon-btn"),ue(T,"data-tippy-content","Reclassify main roads (hotkey 4)"),Gt(T,"active",r[0].kind=="main-roads"),Xe(o,"height","50px"),Xe(o,"display","flex"),Xe(o,"justify-content","left"),Xe(o,"gap","6px"),ue(I,"class","outline icon-btn"),I.disabled=B=r[5]==0,ue(I,"data-tippy-content",O=r[5]==0?"Undo Ctrl+Z":`Undo (${r[5]}) Ctrl+Z`),ue(q,"class","outline icon-btn"),q.disabled=Z=r[6]==0,ue(q,"data-tippy-content",_e=r[6]==0?"Redo Ctrl+Y":`Redo (${r[6]}) Ctrl+Y`),Xe(z,"height","50px"),Xe(z,"display","flex"),Xe(z,"justify-content","right"),Xe(z,"gap","6px"),ue(i,"class","tool-palette"),Xe(i,"display","flex"),Xe(i,"justify-content","space-between"),Xe(i,"flex-wrap","wrap"),Xe(i,"gap","6px"),Xe(J,"min-height","200px"),Xe(J,"padding-bottom","16px"),Xe(J,"border-bottom","solid var(--pico-muted-border-color) 1px"),ue(et,"type","checkbox"),ue(Qe,"class","footnote-ref svelte-b4nchc"),ue(Qe,"data-tippy-content",yb),ue(yt,"type","checkbox"),ue(Ot,"class","footnote-ref svelte-b4nchc"),ue(Ot,"data-tippy-content",y7),ue(fn,"type","checkbox"),ue(He,"class","footnote-ref svelte-b4nchc"),ue(He,"data-tippy-content",yb),Xe(he,"text-wrap","nowrap"),tt.__value="shortcuts",Nn(tt,tt.__value),jt.__value="cells",Nn(jt,jt.__value),Gn.__value="edits",Nn(Gn,Gn.__value),Un.__value="speeds",Nn(Un,Un.__value),Xe(Pe,"margin","0"),Xe(Pe,"padding","8px"),Xe(Pe,"width","auto"),r[13]===void 0&&Yo(()=>r[47].call(Pe)),Xe(Pt,"display","flex"),Xe(Pt,"align-items","center"),Xe(Pt,"gap","8px"),Xe(Pt,"flex-wrap","wrap"),ue(e,"slot","sidebar")},m(Dt,rn){W(Dt,e,rn),D(e,t),D(e,n),D(e,i),D(i,o),D(o,u),D(u,s),D(o,p),D(o,g),D(o,y),D(o,x),D(o,C),D(o,T),D(i,E),D(i,z),D(z,I),oe(L,I,null),D(z,Y),D(z,q),oe(H,q,null),D(e,Ie),D(e,J),~fe&&Vn[fe].m(J,null),D(e,ye),pt&&pt.m(e,null),D(e,Oe),D(e,Ue),D(e,De),D(e,xe),D(xe,et),et.checked=r[3],D(xe,Ze),D(xe,Qe),D(Qe,ct),D(e,dt),D(e,Je),D(Je,yt),yt.checked=r[11],D(Je,Et),D(Je,Ot),D(Ot,Yt),D(e,tn),D(e,Qt),D(Qt,fn),fn.checked=r[12],D(Qt,pn),D(Qt,He),D(He,We),D(e,mt),D(e,Pt),D(Pt,he),D(Pt,nn),D(Pt,Pe),D(Pe,tt),D(Pe,jt),D(Pe,Gn),D(Pe,Un),Ci(Pe,r[13],!0),D(e,jn),vt&&vt.m(e,null),D(e,Wt),D(e,An),D(e,ti),oe(Bn,e,null),_t=!0,mr||(ar=[St(u,"click",r[33]),St(g,"click",r[34]),St(x,"click",r[35]),St(T,"click",r[36]),St(I,"click",r[24]),St(q,"click",r[25]),St(et,"change",r[44]),St(yt,"change",r[45]),St(fn,"change",r[46]),St(Pe,"change",r[47])],mr=!0)},p(Dt,rn){(!_t||rn[0]&1024&&!Sr(s.src,d=_r(Ri.getFilter(Dt[10])).iconURL))&&ue(s,"src",d),(!_t||rn[0]&1)&&Gt(u,"active",Dt[0].kind=="filter"),(!_t||rn[0]&1)&&Gt(g,"active",Dt[0].kind=="oneway"),(!_t||rn[0]&1)&&Gt(x,"active",Dt[0].kind=="turn_restriction"),(!_t||rn[0]&1)&&Gt(T,"active",Dt[0].kind=="main-roads"),(!_t||rn[0]&32&&B!==(B=Dt[5]==0))&&(I.disabled=B),(!_t||rn[0]&32&&O!==(O=Dt[5]==0?"Undo Ctrl+Z":`Undo (${Dt[5]}) Ctrl+Z`))&&ue(I,"data-tippy-content",O),(!_t||rn[0]&64&&Z!==(Z=Dt[6]==0))&&(q.disabled=Z),(!_t||rn[0]&64&&_e!==(_e=Dt[6]==0?"Redo Ctrl+Y":`Redo (${Dt[6]}) Ctrl+Y`))&&ue(q,"data-tippy-content",_e);let en=fe;fe=$e(Dt),fe===en?~fe&&Vn[fe].p(Dt,rn):(Ee&&(Xt(),V(Vn[en],1,1,()=>{Vn[en]=null}),Kt()),~fe?(Ee=Vn[fe],Ee?Ee.p(Dt,rn):(Ee=Vn[fe]=gi[fe](Dt),Ee.c()),N(Ee,1),Ee.m(J,null)):Ee=null),Dt[9]>0?pt||(pt=pb(),pt.c(),pt.m(e,Oe)):pt&&(pt.d(1),pt=null),rn[0]&8&&(et.checked=Dt[3]),rn[0]&2048&&(yt.checked=Dt[11]),rn[0]&4096&&(fn.checked=Dt[12]),rn[0]&8192&&Ci(Pe,Dt[13]),Dt[13]=="speeds"?vt?rn[0]&8192&&N(vt,1):(vt=mb(),vt.c(),N(vt,1),vt.m(e,Wt)):vt&&(Xt(),V(vt,1,1,()=>{vt=null}),Kt());const br={};rn[0]&128&&(br.neighbourhoodBoundary=_r(Dt[7])),Bn.$set(br)},i(Dt){_t||(N(L.$$.fragment,Dt),N(H.$$.fragment,Dt),N(Ee),N(vt),N(Bn.$$.fragment,Dt),_t=!0)},o(Dt){V(L.$$.fragment,Dt),V(H.$$.fragment,Dt),V(Ee),V(vt),V(Bn.$$.fragment,Dt),_t=!1},d(Dt){Dt&&G(e),se(L),se(H),~fe&&Vn[fe].d(),pt&&pt.d(),vt&&vt.d(),se(Bn),mr=!1,sr(ar)}}}function Yz(r){let e,t,n=(r[52].name??"unnamed road")+"",i,o,u=Math.round(r[52].speed_mph)+"",s,d;return{c(){e=j("p"),t=Te("Main road: "),i=Te(n),o=Te(`
                (`),s=Te(u),d=Te(" mph)")},m(p,g){W(p,e,g),D(e,t),D(e,i),D(e,o),D(e,s),D(e,d)},p(p,g){g[1]&2097152&&n!==(n=(p[52].name??"unnamed road")+"")&&xt(i,n),g[1]&2097152&&u!==(u=Math.round(p[52].speed_mph)+"")&&xt(s,u)},d(p){p&&G(e)}}}function Qz(r){let e,t=r[52].shortcuts+"",n,i,o=(r[52].name??"unnamed road")+"",u,s,d=Math.round(r[52].speed_mph)+"",p,g;return{c(){e=j("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o),s=Te(`
                (`),p=Te(d),g=Te(" mph)")},m(y,x){W(y,e,x),D(e,n),D(e,i),D(e,u),D(e,s),D(e,p),D(e,g)},p(y,x){x[1]&2097152&&t!==(t=y[52].shortcuts+"")&&xt(n,t),x[1]&2097152&&o!==(o=(y[52].name??"unnamed road")+"")&&xt(u,o),x[1]&2097152&&d!==(d=Math.round(y[52].speed_mph)+"")&&xt(p,d)},d(y){y&&G(e)}}}function e7(r){let e;return{c(){e=j("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function t7(r){let e;return{c(){e=j("p"),e.textContent="Click to designate a main road or not"},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function n7(r){let e;return{c(){e=j("p"),e.textContent="Click to change direction"},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function r7(r){let e,t,n,i;return{c(){e=j("div"),t=j("img"),i=Te(`
                Click to add modal filter`),Sr(t.src,n=_r(Ri.getFilter(r[10])).iconURL)||ue(t,"src",n),ue(t,"width","20"),ue(t,"alt","Add modal filter")},m(o,u){W(o,e,u),D(e,t),D(e,i)},p(o,u){u[0]&1024&&!Sr(t.src,n=_r(Ri.getFilter(o[10])).iconURL)&&ue(t,"src",n)},d(o){o&&G(e)}}}function i7(r){let e,t;function n(p,g){if(p[52].kind=="interior_road")return Qz;if(p[52].kind=="main_road")return Yz}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return r7;if(p[0].kind=="oneway")return n7;if(p[0].kind=="main-roads"&&!p[0].freehand)return t7;if(p[0].kind=="turn_restriction")return e7}let s=u(r),d=s&&s(r);return{c(){o&&o.c(),e=ne(),d&&d.c(),t=rr()},m(p,g){o&&o.m(p,g),W(p,e,g),d&&d.m(p,g),W(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(G(e),G(t)),o&&o.d(p),d&&d.d(p)}}}function o7(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[i7,({props:i})=>({52:i}),({props:i})=>[0,i?2097152:0]]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","line-popup")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o[0]&1025|o[1]&6291456&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function s7(r){let e,t,n,i,o,u,s,d,p,g;return e=new yp({}),n=new _p({}),o=new vp({}),s=new hh({props:{interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&!r[0].freehand||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[17],$$slots:{"line-popup":[o7]},$$scope:{ctx:r}}}),p=new Bz({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[22]}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment),d=ne(),ae(p.$$.fragment)},m(y,x){oe(e,y,x),W(y,t,x),oe(n,y,x),W(y,i,x),oe(o,y,x),W(y,u,x),oe(s,y,x),W(y,d,x),oe(p,y,x),g=!0},p(y,x){const C={};x[0]&1&&(C.interactive=y[0].kind=="filter"&&!y[0].freehand||y[0].kind=="oneway"||y[0].kind=="main-roads"&&!y[0].freehand||y[0].kind=="turn_restriction"&&y[0].from_road_id==null),x[0]&1025|x[1]&4194304&&(C.$$scope={dirty:x,ctx:y}),s.$set(C);const T={};x[0]&1&&(T.interactive=y[0].kind=="filter"),x[0]&2&&(T.neighbourhood=y[1]),p.$set(T)},i(y){g||(N(e.$$.fragment,y),N(n.$$.fragment,y),N(o.$$.fragment,y),N(s.$$.fragment,y),N(p.$$.fragment,y),g=!0)},o(y){V(e.$$.fragment,y),V(n.$$.fragment,y),V(o.$$.fragment,y),V(s.$$.fragment,y),V(p.$$.fragment,y),g=!1},d(y){y&&(G(t),G(i),G(u),G(d)),se(e,y),se(n,y),se(o,y),se(s,y),se(p,y)}}}function gb(r){let e,t;return e=new Az({props:{paths:r[8]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&256&&(o.paths=n[8]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function a7(r){let e;return{c(){e=Te("Click to delete filter")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function l7(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[a7]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","modal-filter")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o[1]&4194304&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function u7(r){let e;return{c(){e=Te("Click to delete turn restriction")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function c7(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[u7]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","turn-restriction")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o[1]&4194304&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function f7(r){let e,t;return e=new tx({props:{map:_r(r[2])}}),e.$on("done",r[31]),e.$on("progress",r[32]),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=_r(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function h7(r){let e,t;return e=new tx({props:{map:_r(r[2])}}),e.$on("done",r[26]),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=_r(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function _b(r){let e,t;return e=new yr({props:{data:r[0].possible_targets||Fi(),generateId:!0,$$slots:{default:[m7]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Fi()),i[0]&1|i[1]&4194304&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function d7(r){let e,t,n,i,o=r[0].from_road_name+"",u,s,d=(r[52].name||"unnamed road")+"",p;return{c(){e=j("div"),t=j("img"),i=Te(`

              Create a turn restriction from `),u=Te(o),s=Te(" to "),p=Te(d),Sr(t.src,n=r[29][r[52].kind])||ue(t,"src",n),ue(t,"width","20"),ue(t,"alt","Add turn restriction")},m(g,y){W(g,e,y),D(e,t),D(e,i),D(e,u),D(e,s),D(e,p)},p(g,y){y[1]&2097152&&!Sr(t.src,n=g[29][g[52].kind])&&ue(t,"src",n),y[0]&1&&o!==(o=g[0].from_road_name+"")&&xt(u,o),y[1]&2097152&&d!==(d=(g[52].name||"unnamed road")+"")&&xt(p,d)},d(g){g&&G(e)}}}function p7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[d7,({props:n})=>({52:n}),({props:n})=>[0,n?2097152:0]]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&6291456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function m7(r){let e,t;const n=[yn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Kn(.5,1),"line-width":na(1)}}];let i={$$slots:{default:[p7]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),e.$on("click",r[19]),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};u[0]&1|u[1]&4194304&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function g7(r){let e,t,n,i,o,u,s,d,p,g,y,x;t=new e_({}),t.$on("click",r[18]),i=new dh({props:{input:r[1],$$slots:{default:[s7]},$$scope:{ctx:r}}});let C=r[3]&&gb(r);s=new Ka({props:{onClickModalFilter:r[20],onClickTurnRestriction:r[21],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[c7],"modal-filter":[l7]},$$scope:{ctx:r}}});const T=[h7,f7],E=[];function z(L,B){return L[0].kind=="filter"&&L[0].freehand?0:L[0].kind=="main-roads"&&L[0].freehand?1:-1}~(p=z(r))&&(g=E[p]=T[p](r));let I=r[0].kind=="turn_restriction"&&_b(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),o=ne(),C&&C.c(),u=ne(),ae(s.$$.fragment),d=ne(),g&&g.c(),y=ne(),I&&I.c(),ue(e,"slot","map")},m(L,B){W(L,e,B),oe(t,e,null),D(e,n),oe(i,e,null),D(e,o),C&&C.m(e,null),D(e,u),oe(s,e,null),D(e,d),~p&&E[p].m(e,null),D(e,y),I&&I.m(e,null),x=!0},p(L,B){const O={};B[0]&2&&(O.input=L[1]),B[0]&1027|B[1]&4194304&&(O.$$scope={dirty:B,ctx:L}),i.$set(O),L[3]?C?(C.p(L,B),B[0]&8&&N(C,1)):(C=gb(L),C.c(),N(C,1),C.m(e,u)):C&&(Xt(),V(C,1,1,()=>{C=null}),Kt());const Y={};B[0]&1&&(Y.interactive=L[0].kind=="filter"),B[1]&4194304&&(Y.$$scope={dirty:B,ctx:L}),s.$set(Y);let q=p;p=z(L),p===q?~p&&E[p].p(L,B):(g&&(Xt(),V(E[q],1,1,()=>{E[q]=null}),Kt()),~p?(g=E[p],g?g.p(L,B):(g=E[p]=T[p](L),g.c()),N(g,1),g.m(e,y)):g=null),L[0].kind=="turn_restriction"?I?(I.p(L,B),B[0]&1&&N(I,1)):(I=_b(L),I.c(),N(I,1),I.m(e,null)):I&&(Xt(),V(I,1,1,()=>{I=null}),Kt())},i(L){x||(N(t.$$.fragment,L),N(i.$$.fragment,L),N(C),N(s.$$.fragment,L),N(g),N(I),x=!0)},o(L){V(t.$$.fragment,L),V(i.$$.fragment,L),V(C),V(s.$$.fragment,L),V(g),V(I),x=!1},d(L){L&&G(e),se(t),se(i),C&&C.d(),se(s),~p&&E[p].d(),I&&I.d()}}}function _7(r){let e,t,n,i;return e=new Ao({props:{$$slots:{map:[g7],sidebar:[Jz],top:[Gz]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0,n||(i=St(window,"keydown",r[23]),n=!0)},p(o,u){const s={};u[0]&65535|u[1]&4194304&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o),n=!1,i()}}}let yb="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",y7="Cells are the colored area reachable without travelling along a main road.";function v7(r,e,t){let n,i,o,u,s,d,p,g,y,x,C;st(r,Di,Pe=>t(30,i=Pe)),st(r,kr,Pe=>t(49,o=Pe)),st(r,sg,Pe=>t(10,u=Pe)),st(r,as,Pe=>t(2,s=Pe)),st(r,o1,Pe=>t(3,d=Pe)),st(r,ag,Pe=>t(11,p=Pe)),st(r,lg,Pe=>t(12,g=Pe)),st(r,np,Pe=>t(13,y=Pe)),st(r,Qn,Pe=>t(14,x=Pe)),st(r,Of,Pe=>t(15,C=Pe));function T(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Fi()}}let E={kind:"filter",freehand:!1},z=!1,I=0,L=0,B,O,Y=Fi(),q=0;ls(()=>{c_()}),ei(()=>{s.doubleClickZoom.enable()});function H(Pe){t(1,O=o.renderNeighbourhood()),t(7,B=O.features.find(tt=>tt.properties.kind=="boundary")),t(5,I=O.undo_length),t(6,L=O.redo_length),Hf()}function Z(Pe,tt){i==q||!tt||(t(8,Y=o.getAllShortcuts()),q=i)}function _e(Pe,tt){E.kind=="filter"?(o.addModalFilter(tt,u),an(Di,i++,i)):E.kind=="oneway"?(o.toggleTravelFlow(Pe.properties.road),an(Di,i++,i)):E.kind=="main-roads"&&!E.freehand?(o.toggleMainRoad(Pe.properties.road),an(Di,i++,i)):E.kind=="turn_restriction"&&(t(0,E.from_road_id=Pe.properties.road,E),t(0,E.from_road_name=Pe.properties.name||"unnamed road",E),t(0,E.possible_targets=o.getTurnRestrictionTargets(Pe.properties.road),E))}function Ie(Pe){E.kind=="turn_restriction"&&(s.queryRenderedFeatures(Pe.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,E=T()))}function J(Pe){if(E.kind=="turn_restriction"&&E.from_road_id!=null){let tt=Pe.detail.features[0].properties.road;o.addTurnRestriction(E.from_road_id,tt),an(Di,i++,i)}t(0,E=T())}function fe(Pe){let tt=Pe.detail.features[0];o.deleteModalFilter(tt.properties.road),an(Di,i++,i)}function Ee(Pe){let tt=Pe.detail.features[0];o.deleteTurnRestriction(tt.properties.intersection,tt.properties.from_road,tt.properties.to_road),an(Di,i++,i)}function ye(Pe){if(E.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${E.kind}`);return}Pe.hasRotatedFilter?(o.deleteDiagonalFilter(Pe),an(Di,i++,i)):Pe.filter?(o.rotateDiagonalFilter(Pe),an(Di,i++,i)):(o.addDiagonalFilter(Pe),an(Di,i++,i))}function Oe(Pe){Pe.target.tagName!="INPUT"&&(Pe.ctrlKey&&Pe.key=="z"&&Ue(),Pe.ctrlKey&&Pe.key=="y"&&De(),Pe.key=="1"&&t(0,E={kind:"filter",freehand:!1}),Pe.key=="2"&&t(0,E={kind:"oneway"}),Pe.key=="3"&&t(0,E=T()),Pe.key=="4"&&t(0,E={kind:"main-roads",freehand:!1,isMain:!1}))}function Ue(){o.undo(),an(Di,i++,i)}function De(){o.redo(),an(Di,i++,i)}function xe(Pe){let tt=Pe.detail;tt&&(o.addManyModalFilters(tt,u),an(Di,i++,i)),t(0,E={kind:"filter",freehand:!1})}function et(Pe,tt){if(E.kind!="main-roads"){console.assert(!1,"cant paint line unless in main-roads mode");return}let jt=Pe.detail;jt&&(o.reclassifyRoadsAlongLine(jt,E.isMain,tt),an(Di,i++,i))}function Ze(){o.eraseAllMainRoads(),an(Di,i++,i)}let Qe={left:uw,right:Dg,straight:cw,u_left_to_right:hw,u_right_to_left:fw};const ct=Pe=>et(Pe,!0),dt=Pe=>et(Pe,!1),Je=()=>t(0,E={kind:"filter",freehand:!1}),yt=()=>t(0,E={kind:"oneway"}),Et=()=>t(0,E=T()),Ot=()=>t(0,E={kind:"main-roads",freehand:!1,isMain:!1});function Yt(Pe){z=Pe,t(4,z)}const tn=()=>t(4,z=!0),Qt=()=>t(0,E={kind:"filter",freehand:!1}),fn=()=>t(0,E={kind:"filter",freehand:!0}),pn=()=>{t(0,E={kind:"main-roads",freehand:!1,isMain:!0})},He=()=>{t(0,E={kind:"main-roads",freehand:!0,isMain:!0})},We=()=>{t(0,E={kind:"main-roads",freehand:!0,isMain:!1})};function mt(){d=this.checked,o1.set(d)}function Pt(){p=this.checked,ag.set(p)}function he(){g=this.checked,lg.set(g)}function nn(){y=ia(this),np.set(y)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(E.kind=="oneway"||E.kind=="main-roads"?s.doubleClickZoom.disable():s.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(E.kind=="filter"&&E.freehand||E.kind=="main-roads"&&E.freehand&&E.isMain?s.getCanvas().style.cursor=`url(${iz}) 8 22, cell`:E.kind=="main-roads"&&E.freehand&&!E.isMain?s.getCanvas().style.cursor=`url(${rz}) 8 22, cell`:s.getCanvas().style.cursor=""),r.$$.dirty[0]&1073741824&&H(),r.$$.dirty[0]&1073741832&&Z(i,d),r.$$.dirty[0]&2&&t(9,n=O.features.filter(Pe=>Pe.properties.kind=="cell"&&Pe.properties.cell_color=="disconnected").length)},[E,O,s,d,z,I,L,B,Y,n,u,p,g,y,x,C,T,_e,Ie,J,fe,Ee,ye,Oe,Ue,De,xe,et,Ze,Qe,i,ct,dt,Je,yt,Et,Ot,Yt,tn,Qt,fn,pn,He,We,mt,Pt,he,nn]}class b7 extends Tt{constructor(e){super(),Ct(this,e,v7,_7,wt,{},null,[-1,-1])}}function vb(r){let e,t,n;return t=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("li"),ae(t.$$.fragment)},m(i,o){W(i,e,o),oe(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function w7(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E=vr(r[5].mode)+"",z,I;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}});let L=r[0]=="neighbourhood"&&vb();return x=new $n({props:{mode:{mode:"predict-impact",prevMode:r[0]}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),L&&L.c(),g=ne(),y=j("li"),ae(x.$$.fragment),C=ne(),T=j("li"),z=Te(E),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(B,O){W(B,e,O),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),L&&L.m(n,null),D(n,g),D(n,y),oe(x,y,null),D(n,C),D(n,T),D(T,z),I=!0},p(B,O){B[0]=="neighbourhood"?L?O&1&&N(L,1):(L=vb(),L.c(),N(L,1),L.m(n,g)):L&&(Xt(),V(L,1,1,()=>{L=null}),Kt());const Y={};O&1&&(Y.mode={mode:"predict-impact",prevMode:B[0]}),x.$set(Y),(!I||O&32)&&E!==(E=vr(B[5].mode)+"")&&xt(z,E)},i(B){I||(N(o.$$.fragment,B),N(d.$$.fragment,B),N(L),N(x.$$.fragment,B),I=!0)},o(B){V(o.$$.fragment,B),V(d.$$.fragment,B),V(L),V(x.$$.fragment,B),I=!1},d(B){B&&G(e),se(o),se(d),L&&L.d(),se(x)}}}function bb(r){let e,t,n,i,o,u,s;function d(C){r[10](C)}let p={list:r[2]};r[3]!==void 0&&(p.idx=r[3]),e=new mp({props:p}),_n.push(()=>Rn(e,"idx",d));let g=r[2][r[3]].count>1&&wb(r),y=r[2][r[3]].before==null&&xb(),x=r[2][r[3]].after==null&&Ab();return{c(){ae(e.$$.fragment),n=ne(),g&&g.c(),i=ne(),y&&y.c(),o=ne(),x&&x.c(),u=rr()},m(C,T){oe(e,C,T),W(C,n,T),g&&g.m(C,T),W(C,i,T),y&&y.m(C,T),W(C,o,T),x&&x.m(C,T),W(C,u,T),s=!0},p(C,T){const E={};T&4&&(E.list=C[2]),!t&&T&8&&(t=!0,E.idx=C[3],Dn(()=>t=!1)),e.$set(E),C[2][C[3]].count>1?g?g.p(C,T):(g=wb(C),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),C[2][C[3]].before==null?y||(y=xb(),y.c(),y.m(o.parentNode,o)):y&&(y.d(1),y=null),C[2][C[3]].after==null?x||(x=Ab(),x.c(),x.m(u.parentNode,u)):x&&(x.d(1),x=null)},i(C){s||(N(e.$$.fragment,C),s=!0)},o(C){V(e.$$.fragment,C),s=!1},d(C){C&&(G(n),G(i),G(o),G(u)),se(e,C),g&&g.d(C),y&&y.d(C),x&&x.d(C)}}}function wb(r){let e,t,n=r[2][r[3]].count.toLocaleString()+"",i,o,u,s;return{c(){e=j("p"),t=Te(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Te(n),o=Te(` trips between the
          same points.`),u=ne(),s=j("i"),s.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){W(d,e,p),D(e,t),D(e,i),D(e,o),W(d,u,p),W(d,s,p)},p(d,p){p&12&&n!==(n=d[2][d[3]].count.toLocaleString()+"")&&xt(i,n)},d(d){d&&(G(e),G(u),G(s))}}}function xb(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Xe(e,"color","red")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Ab(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Xe(e,"color","blue")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function x7(r){let e,t,n,i,o=r[1].before.toLocaleString()+"",u,s,d,p,g=r[1].after.toLocaleString()+"",y,x,C,T,E=Math.round(100*r[1].after/r[1].before)+"",z,I,L,B;t=new Ns({props:{mode:{mode:"predict-impact",prevMode:r[0]}}});let O=r[2].length>0&&bb(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("p"),u=Te(o),s=Te(` routes cross here
      `),d=j("span"),d.textContent="before your changes",p=Te(`
      , and `),y=Te(g),x=ne(),C=j("span"),C.textContent="after your changes",T=Te(`
      . That's
      `),z=Te(E),I=Te("% of the original traffic."),L=ne(),O&&O.c(),Xe(d,"color","red"),Xe(C,"color","blue"),ue(e,"slot","sidebar")},m(Y,q){W(Y,e,q),oe(t,e,null),D(e,n),D(e,i),D(i,u),D(i,s),D(i,d),D(i,p),D(i,y),D(i,x),D(i,C),D(i,T),D(i,z),D(i,I),D(e,L),O&&O.m(e,null),B=!0},p(Y,q){const H={};q&1&&(H.mode={mode:"predict-impact",prevMode:Y[0]}),t.$set(H),(!B||q&2)&&o!==(o=Y[1].before.toLocaleString()+"")&&xt(u,o),(!B||q&2)&&g!==(g=Y[1].after.toLocaleString()+"")&&xt(y,g),(!B||q&2)&&E!==(E=Math.round(100*Y[1].after/Y[1].before)+"")&&xt(z,E),Y[2].length>0?O?(O.p(Y,q),q&4&&N(O,1)):(O=bb(Y),O.c(),N(O,1),O.m(e,null)):O&&(Xt(),V(O,1,1,()=>{O=null}),Kt())},i(Y){B||(N(t.$$.fragment,Y),N(O),B=!0)},o(Y){V(t.$$.fragment,Y),V(O),B=!1},d(Y){Y&&G(e),se(t),O&&O.d()}}}function kb(r){let e,t,n,i,o,u;return e=new yr({props:{data:r[6](r[3]),$$slots:{default:[A7]},$$scope:{ctx:r}}}),n=new Dl({props:{lngLat:r[7](r[3]),$$slots:{default:[k7]},$$scope:{ctx:r}}}),o=new Dl({props:{lngLat:r[8](r[3]),$$slots:{default:[S7]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment)},m(s,d){oe(e,s,d),W(s,t,d),oe(n,s,d),W(s,i,d),oe(o,s,d),u=!0},p(s,d){const p={};d&8&&(p.data=s[6](s[3])),d&8192&&(p.$$scope={dirty:d,ctx:s}),e.$set(p);const g={};d&8&&(g.lngLat=s[7](s[3])),d&8192&&(g.$$scope={dirty:d,ctx:s}),n.$set(g);const y={};d&8&&(y.lngLat=s[8](s[3])),d&8192&&(y.$$scope={dirty:d,ctx:s}),o.$set(y)},i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),se(e,s),se(n,s),se(o,s)}}}function A7(r){let e,t;const n=[yn("predict-impact"),{paint:{"line-width":Oo(["get","kind"],{focus:8},5),"line-color":Oo(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Oo(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function k7(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function S7(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function C7(r){let e,t,n,i,o=r[2].length>0&&kb(r);return n=new Ka({props:{interactive:!1}}),{c(){e=j("div"),o&&o.c(),t=ne(),ae(n.$$.fragment),ue(e,"slot","map")},m(u,s){W(u,e,s),o&&o.m(e,null),D(e,t),oe(n,e,null),i=!0},p(u,s){u[2].length>0?o?(o.p(u,s),s&4&&N(o,1)):(o=kb(u),o.c(),N(o,1),o.m(e,t)):o&&(Xt(),V(o,1,1,()=>{o=null}),Kt())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){V(o),V(n.$$.fragment,u),i=!1},d(u){u&&G(e),o&&o.d(),se(n)}}}function T7(r){let e,t,n,i;return e=new oc({props:{loading:r[4]}}),n=new Ao({props:{$$slots:{map:[C7],sidebar:[x7],top:[w7]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,[u]){const s={};u&16&&(s.loading=o[4]),e.$set(s);const d={};u&8239&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function M7(r,e,t){let n,i,o;st(r,Qn,z=>t(5,n=z)),st(r,ug,z=>t(11,i=z)),st(r,kr,z=>t(12,o=z));let{road:u}=e,{prevPrevMode:s}=e,d=u.properties;d.kind="focus";let p=[],g=0,y="Finding changes to this road";ls(async()=>{await gp(),t(2,p=o.getImpactsOnRoad(d.id,i)),t(4,y=""),p.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),an(Qn,n={mode:"predict-impact",prevMode:s},n))});function x(z){return{type:"FeatureCollection",features:[p[z].before,p[z].after,u].filter(I=>I!=null)}}function C(z){return p[z].before!=null?p[z].before.geometry.coordinates[0]:p[z].after.geometry.coordinates[0]}function T(z){let I=p[z].before!=null?p[z].before.geometry.coordinates:p[z].after.geometry.coordinates;return I[I.length-1]}function E(z){g=z,t(3,g)}return r.$$set=z=>{"road"in z&&t(9,u=z.road),"prevPrevMode"in z&&t(0,s=z.prevPrevMode)},[s,d,p,g,y,n,x,C,T,u,E]}class E7 extends Tt{constructor(e){super(),Ct(this,e,M7,T7,wt,{road:9,prevPrevMode:0})}}function L7(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T=vr(r[6].mode)+"",E,z;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),y=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),ae(y.$$.fragment),x=ne(),C=j("li"),E=Te(T),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(I,L){W(I,e,L),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),oe(y,g,null),D(n,x),D(n,C),D(C,E),z=!0},p(I,L){(!z||L&64)&&T!==(T=vr(I[6].mode)+"")&&xt(E,T)},i(I){z||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(y.$$.fragment,I),z=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(y.$$.fragment,I),z=!1},d(I){I&&G(e),se(o),se(d),se(y)}}}function I7(r){let e;return{c(){e=j("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function P7(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function z7(r){let e,t=Fa(r[4].properties.distance)+"",n,i,o=Oa(r[4].properties.time)+"",u;return{c(){e=j("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),D(e,n),D(e,i),D(e,u)},p(s,d){d&16&&t!==(t=Fa(s[4].properties.distance)+"")&&xt(n,t),d&16&&o!==(o=Oa(s[4].properties.time)+"")&&xt(u,o)},d(s){s&&G(e)}}}function D7(r){let e;return{c(){e=j("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function R7(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function B7(r){let e,t=Fa(r[3].properties.distance)+"",n,i,o=Oa(r[3].properties.time)+"",u;return{c(){e=j("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),D(e,n),D(e,i),D(e,u)},p(s,d){d&8&&t!==(t=Fa(s[3].properties.distance)+"")&&xt(n,t),d&8&&o!==(o=Oa(s[3].properties.time)+"")&&xt(u,o)},d(s){s&&G(e)}}}function F7(r){let e,t,n,i,o,u,s,d,p,g,y;t=new Ns({props:{mode:{mode:"neighbourhood"}}});function x(L,B){return L[4]?z7:L[3]?P7:I7}let C=x(r),T=C(r);function E(L,B){return L[3]?B7:L[4]?R7:D7}let z=E(r),I=z(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=ne(),u=j("u"),u.textContent="Route before changes",s=ne(),T.c(),d=ne(),p=j("u"),p.textContent="Route after changes",g=ne(),I.c(),Xe(u,"color","red"),Xe(p,"color","blue"),ue(e,"slot","sidebar")},m(L,B){W(L,e,B),oe(t,e,null),D(e,n),D(e,i),D(e,o),D(e,u),D(e,s),T.m(e,null),D(e,d),D(e,p),D(e,g),I.m(e,null),y=!0},p(L,B){C===(C=x(L))&&T?T.p(L,B):(T.d(1),T=C(L),T&&(T.c(),T.m(e,d))),z===(z=E(L))&&I?I.p(L,B):(I.d(1),I=z(L),I&&(I.c(),I.m(e,null)))},i(L){y||(N(t.$$.fragment,L),y=!0)},o(L){V(t.$$.fragment,L),y=!1},d(L){L&&G(e),se(t),T.d(),I.d()}}}function O7(r){let e,t;const n=[yn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function $7(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=j("p"),t=Te("Time ratio: "),i=Te(n)},m(o,u){W(o,e,u),D(e,t),D(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&xt(i,n)},d(o){o&&G(e)}}}function N7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[$7,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function j7(r){let e,t,n;const i=[yn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[10](s)}let u={$$slots:{default:[N7]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=Mt(u,i[s]);return r[0]!==void 0&&(u.hovered=r[0]),e=new hr({props:u}),_n.push(()=>Rn(e,"hovered",o)),e.$on("click",r[11]),{c(){ae(e.$$.fragment)},m(s,d){oe(e,s,d),n=!0},p(s,d){const p=d&32?Tn(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&131072&&(p.$$scope={dirty:d,ctx:s}),!t&&d&1&&(t=!0,p.hovered=s[0],Dn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){se(e,s)}}}function U7(r){let e,t;const n=[yn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Oo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function V7(r){let e;return{c(){e=Te("X")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function q7(r){let e,t,n,i,o,u,s,d,p,g,y,x;t=new dh({props:{$$slots:{default:[O7]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[5],generateId:!0,$$slots:{default:[j7]},$$scope:{ctx:r}}}),u=new yr({props:{data:r[1],$$slots:{default:[U7]},$$scope:{ctx:r}}}),d=new Ka({props:{interactive:!1}});function C(E){r[12](E)}let T={draggable:!0,$$slots:{default:[V7]},$$scope:{ctx:r}};return r[2]!==void 0&&(T.lngLat=r[2]),g=new Dl({props:T}),_n.push(()=>Rn(g,"lngLat",C)),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),o=ne(),ae(u.$$.fragment),s=ne(),ae(d.$$.fragment),p=ne(),ae(g.$$.fragment),ue(e,"slot","map")},m(E,z){W(E,e,z),oe(t,e,null),D(e,n),oe(i,e,null),D(e,o),oe(u,e,null),D(e,s),oe(d,e,null),D(e,p),oe(g,e,null),x=!0},p(E,z){const I={};z&131072&&(I.$$scope={dirty:z,ctx:E}),t.$set(I);const L={};z&32&&(L.data=E[5]),z&131105&&(L.$$scope={dirty:z,ctx:E}),i.$set(L);const B={};z&2&&(B.data=E[1]),z&131072&&(B.$$scope={dirty:z,ctx:E}),u.$set(B);const O={};z&131072&&(O.$$scope={dirty:z,ctx:E}),!y&&z&4&&(y=!0,O.lngLat=E[2],Dn(()=>y=!1)),g.$set(O)},i(E){x||(N(t.$$.fragment,E),N(i.$$.fragment,E),N(u.$$.fragment,E),N(d.$$.fragment,E),N(g.$$.fragment,E),x=!0)},o(E){V(t.$$.fragment,E),V(i.$$.fragment,E),V(u.$$.fragment,E),V(d.$$.fragment,E),V(g.$$.fragment,E),x=!1},d(E){E&&G(e),se(t),se(i),se(u),se(d),se(g)}}}function H7(r){let e,t,n,i;return e=new e_({}),e.$on("contextmenu",r[8]),n=new Ao({props:{$$slots:{map:[q7],sidebar:[F7],top:[L7]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,[u]){const s={};u&131199&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function G7(r,e,t){let n,i,o,u,s,d,p,g,y;st(r,kd,B=>t(2,s=B)),st(r,Qn,B=>t(6,d=B)),st(r,Ff,B=>t(13,p=B)),st(r,Bf,B=>t(14,g=B)),st(r,kr,B=>t(9,y=B));let x=null;ls(()=>{setTimeout(()=>{s&&fg(kd)},10)});function C(B){return B?y.compareRoute(new sa.LngLat(B.properties.pt1_x,B.properties.pt1_y),s,1):Fi()}function T(B){an(Bf,g=new sa.LngLat(B.properties.pt1_x,B.properties.pt1_y),g),an(Ff,p=s,p),an(Qn,d={mode:"route",prevMode:"impact-one-destination"},d)}function E(B){an(kd,s=B.detail.lngLat,s)}function z(B){x=B,t(0,x)}const I=B=>T(B.detail.features[0]);function L(B){s=B,kd.set(s)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=y.impactToOneDestination(s)),r.$$.dirty&1&&t(1,i=C(x)),r.$$.dirty&2&&t(4,o=i.features.find(B=>B.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find(B=>B.properties.kind=="after"))},[x,i,s,u,o,n,d,T,E,y,z,I,L]}class W7 extends Tt{constructor(e){super(),Ct(this,e,G7,H7,wt,{})}}function Sb(r,e,t){const n=r.slice();return n[28]=e[t].properties.name,n}function Z7(r){let e;return{c(){e=j("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function Cb(r){let e,t,n;return t=new $n({props:{mode:{mode:"debug-intersections"}}}),{c(){e=j("li"),ae(t.$$.fragment)},m(i,o){W(i,e,o),oe(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function X7(r){let e,t,n,i,o,u,s,d=vr(r[5].mode)+"",p,g,y,x,C,T,E,z,I,L,B,O,Y;o=new $n({props:{mode:{mode:"title"}}}),y=new Bl({props:{$$slots:{default:[Z7]},$$scope:{ctx:r}}}),z=new $n({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),B=new $n({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}});let q=r[8]&&Cb();return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),p=Te(d),g=ne(),ae(y.$$.fragment),x=ne(),C=j("nav"),T=j("ul"),E=j("li"),ae(z.$$.fragment),I=ne(),L=j("li"),ae(B.$$.fragment),O=ne(),q&&q.c(),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top"),Xe(e,"display","flex"),Xe(e,"justify-content","space-between")},m(H,Z){W(H,e,Z),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),D(s,p),D(s,g),oe(y,s,null),D(e,x),D(e,C),D(C,T),D(T,E),oe(z,E,null),D(T,I),D(T,L),oe(B,L,null),D(T,O),q&&q.m(T,null),Y=!0},p(H,Z){(!Y||Z[0]&32)&&d!==(d=vr(H[5].mode)+"")&&xt(p,d);const _e={};Z[1]&1&&(_e.$$scope={dirty:Z,ctx:H}),y.$set(_e),H[8]?q?Z[0]&256&&N(q,1):(q=Cb(),q.c(),N(q,1),q.m(T,null)):q&&(Xt(),V(q,1,1,()=>{q=null}),Kt())},i(H){Y||(N(o.$$.fragment,H),N(y.$$.fragment,H),N(z.$$.fragment,H),N(B.$$.fragment,H),N(q),Y=!0)},o(H){V(o.$$.fragment,H),V(y.$$.fragment,H),V(z.$$.fragment,H),V(B.$$.fragment,H),V(q),Y=!1},d(H){H&&G(e),se(o),se(y),se(z),se(B),q&&q.d()}}}function K7(r){let e=r[28]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i[0]&1&&e!==(e=n[28]+"")&&xt(t,e)},d(n){n&&G(t)}}}function Tb(r){let e,t,n,i,o,u,s,d,p,g,y,x,C;function T(){return r[19](r[28])}n=new pp({props:{$$slots:{default:[K7]},$$scope:{ctx:r}}}),n.$on("click",T),s=new r_({props:{color:"black"}});function E(){return r[20](r[28])}g=new dp({props:{color:"white"}});function z(){return r[21](r[28])}function I(){return r[22](r[28])}return{c(){var L;e=j("li"),t=j("h3"),ae(n.$$.fragment),i=ne(),o=j("span"),u=j("button"),ae(s.$$.fragment),d=ne(),p=j("button"),ae(g.$$.fragment),ue(u,"class","outline icon-btn"),ue(u,"title","Rename neighbourhood"),ue(p,"class","icon-btn destructive"),ue(p,"title","Delete neighbourhood"),ue(o,"class","actions"),ue(e,"class","actionable-cell svelte-qhjp0j"),Gt(e,"highlighted",((L=r[3])==null?void 0:L.properties.name)==r[28]||r[2]==r[28])},m(L,B){W(L,e,B),D(e,t),oe(n,t,null),D(e,i),D(e,o),D(o,u),oe(s,u,null),D(o,d),D(o,p),oe(g,p,null),y=!0,x||(C=[St(u,"click",E),St(p,"click",z),St(e,"mouseenter",I),St(e,"mouseleave",r[23])],x=!0)},p(L,B){var Y;r=L;const O={};B[0]&1|B[1]&1&&(O.$$scope={dirty:B,ctx:r}),n.$set(O),(!y||B[0]&13)&&Gt(e,"highlighted",((Y=r[3])==null?void 0:Y.properties.name)==r[28]||r[2]==r[28])},i(L){y||(N(n.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),y=!0)},o(L){V(n.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),y=!1},d(L){L&&G(e),se(n),se(s),se(g),x=!1,sr(C)}}}function J7(r){let e,t,n;return e=new EC({}),{c(){ae(e.$$.fragment),t=Te(`
          Add a new neighbourhood`)},m(i,o){oe(e,i,o),W(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){V(e.$$.fragment,i),n=!1},d(i){i&&G(t),se(e,i)}}}function Mb(r){let e,t,n,i,o,u,s,d,p;function g(x){r[24](x)}let y={};return r[1]!==void 0&&(y.selectedPrioritization=r[1]),o=new J2({props:y}),_n.push(()=>Rn(o,"selectedPrioritization",g)),{c(){e=j("h3"),e.textContent="Prioritisation",t=ne(),n=j("p"),n.textContent=`Compare the prioritisation or individual metrics across your
        neighbourhoods.`,i=ne(),ae(o.$$.fragment),s=ne(),d=j("hr")},m(x,C){W(x,e,C),W(x,t,C),W(x,n,C),W(x,i,C),oe(o,x,C),W(x,s,C),W(x,d,C),p=!0},p(x,C){const T={};!u&&C[0]&2&&(u=!0,T.selectedPrioritization=x[1],Dn(()=>u=!1)),o.$set(T)},i(x){p||(N(o.$$.fragment,x),p=!0)},o(x){V(o.$$.fragment,x),p=!1},d(x){x&&(G(e),G(t),G(n),G(i),G(s),G(d)),se(o,x)}}}function Eb(r){let e,t,n;return{c(){e=j("button"),e.textContent="Debug route-snapper",ue(e,"class","secondary")},m(i,o){W(i,e,o),t||(n=St(e,"click",r[12]),t=!0)},p:lt,d(i){i&&G(e),t=!1,n()}}}function Y7(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L=r[4].modalFilters+"",B,O,Y,q,H=r[4].deletedModalFilters+"",Z,_e,Ie,J,fe=r[4].travelFlows+"",Ee,ye,Oe,Ue,De,xe;s=new b2({});let et=On(r[0].features),Ze=[];for(let Je=0;Je<et.length;Je+=1)Ze[Je]=Tb(Sb(r,et,Je));const Qe=Je=>V(Ze[Je],1,1,()=>{Ze[Je]=null});T=new $n({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[J7]},$$scope:{ctx:r}}});let ct=r[6]=="cnt"&&Mb(r),dt=r[8]&&Eb(r);return{c(){e=j("div"),t=j("div"),n=j("h2"),n.textContent="Neighbourhoods",i=ne(),o=j("button"),u=j("div"),ae(s.$$.fragment),d=ne(),p=j("span"),p.textContent="Export",g=ne(),y=j("ul");for(let Je=0;Je<Ze.length;Je+=1)Ze[Je].c();x=ne(),C=j("li"),ae(T.$$.fragment),E=ne(),ct&&ct.c(),z=ne(),I=j("p"),B=Te(L),O=Te(" new modal filter(s) added"),Y=ne(),q=j("p"),Z=Te(H),_e=Te(`
      existing modal filter(s) removed`),Ie=ne(),J=j("p"),Ee=Te(fe),ye=Te(" road segment direction(s) changed"),Oe=ne(),dt&&dt.c(),Xe(p,"margin-right","2px"),Xe(u,"display","flex"),Xe(u,"align-items","center"),Xe(u,"gap","8px"),Xe(u,"color","black"),ue(o,"class","outline"),Xe(o,"margin-right","8px"),ue(o,"title","Download project as GeoJSON"),Xe(t,"display","flex"),Xe(t,"justify-content","space-between"),Xe(t,"align-items","center"),Xe(t,"gap","16px"),ue(y,"class","navigable-list"),ue(e,"slot","sidebar")},m(Je,yt){W(Je,e,yt),D(e,t),D(t,n),D(t,i),D(t,o),D(o,u),oe(s,u,null),D(u,d),D(u,p),D(e,g),D(e,y);for(let Et=0;Et<Ze.length;Et+=1)Ze[Et]&&Ze[Et].m(y,null);D(y,x),D(y,C),oe(T,C,null),D(e,E),ct&&ct.m(e,null),D(e,z),D(e,I),D(I,B),D(I,O),D(e,Y),D(e,q),D(q,Z),D(q,_e),D(e,Ie),D(e,J),D(J,Ee),D(J,ye),D(e,Oe),dt&&dt.m(e,null),Ue=!0,De||(xe=St(o,"click",r[18]),De=!0)},p(Je,yt){if(yt[0]&3597){et=On(Je[0].features);let Ot;for(Ot=0;Ot<et.length;Ot+=1){const Yt=Sb(Je,et,Ot);Ze[Ot]?(Ze[Ot].p(Yt,yt),N(Ze[Ot],1)):(Ze[Ot]=Tb(Yt),Ze[Ot].c(),N(Ze[Ot],1),Ze[Ot].m(y,x))}for(Xt(),Ot=et.length;Ot<Ze.length;Ot+=1)Qe(Ot);Kt()}const Et={};yt[1]&1&&(Et.$$scope={dirty:yt,ctx:Je}),T.$set(Et),Je[6]=="cnt"?ct?(ct.p(Je,yt),yt[0]&64&&N(ct,1)):(ct=Mb(Je),ct.c(),N(ct,1),ct.m(e,z)):ct&&(Xt(),V(ct,1,1,()=>{ct=null}),Kt()),(!Ue||yt[0]&16)&&L!==(L=Je[4].modalFilters+"")&&xt(B,L),(!Ue||yt[0]&16)&&H!==(H=Je[4].deletedModalFilters+"")&&xt(Z,H),(!Ue||yt[0]&16)&&fe!==(fe=Je[4].travelFlows+"")&&xt(Ee,fe),Je[8]?dt?dt.p(Je,yt):(dt=Eb(Je),dt.c(),dt.m(e,null)):dt&&(dt.d(1),dt=null)},i(Je){if(!Ue){N(s.$$.fragment,Je);for(let yt=0;yt<et.length;yt+=1)N(Ze[yt]);N(T.$$.fragment,Je),N(ct),Ue=!0}},o(Je){V(s.$$.fragment,Je),Ze=Ze.filter(Boolean);for(let yt=0;yt<Ze.length;yt+=1)V(Ze[yt]);V(T.$$.fragment,Je),V(ct),Ue=!1},d(Je){Je&&G(e),se(s),di(Ze,Je),se(T),ct&&ct.d(),dt&&dt.d(),De=!1,xe()}}}function Q7(r){let e,t,n=(r[27].number_pois/r[27].area_km2).toFixed(1)+"",i,o;return{c(){e=j("b"),e.textContent="Points of interest:",t=ne(),i=Te(n),o=Te(" / km²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=(u[27].number_pois/u[27].area_km2).toFixed(1)+"")&&xt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function eD(r){let e,t,n=(r[27].number_stats19_collisions/r[27].area_km2).toFixed(1)+"",i,o;return{c(){e=j("b"),e.textContent="Pedestrian and cyclist collisions:",t=ne(),i=Te(n),o=Te(" / km²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=(u[27].number_stats19_collisions/u[27].area_km2).toFixed(1)+"")&&xt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function tD(r){let e,t,n=Math.round(r[27].population/r[27].area_km2).toLocaleString()+"",i,o;return{c(){e=j("b"),e.textContent="Population density:",t=ne(),i=Te(n),o=Te(` people
            / km²`)},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=Math.round(u[27].population/u[27].area_km2).toLocaleString()+"")&&xt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function nD(r){let e,t=r[27].name+"",n,i,o;function u(p,g){if(p[1]=="population_density")return tD;if(p[1]=="stats19")return eD;if(p[1]=="pois")return Q7}let s=u(r),d=s&&s(r);return{c(){e=j("h2"),n=Te(t),i=ne(),d&&d.c(),o=rr()},m(p,g){W(p,e,g),D(e,n),W(p,i,g),d&&d.m(p,g),W(p,o,g)},p(p,g){g[0]&134217728&&t!==(t=p[27].name+"")&&xt(n,t),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(G(e),G(i),G(o)),d&&d.d(p)}}}function rD(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[nD,({props:n})=>({27:n}),({props:n})=>[n?134217728:0]]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&134217730|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function iD(r){let e,t,n,i,o,u,s,d,p;e=new jS({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},yn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let y={};for(let I=0;I<g.length;I+=1)y=Mt(y,g[I]);n=new hr({props:y});const x=[{filter:["==",["get","kind"],"boundary"]},yn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let C={};for(let I=0;I<x.length;I+=1)C=Mt(C,x[I]);o=new hr({props:C});const T=[yn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function E(I){r[16](I)}let z={$$slots:{default:[rD]},$$scope:{ctx:r}};for(let I=0;I<T.length;I+=1)z=Mt(z,T[I]);return r[3]!==void 0&&(z.hovered=r[3]),s=new Ki({props:z}),_n.push(()=>Rn(s,"hovered",E)),s.$on("click",r[17]),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment)},m(I,L){oe(e,I,L),W(I,t,L),oe(n,I,L),W(I,i,L),oe(o,I,L),W(I,u,L),oe(s,I,L),p=!0},p(I,L){const B={};L[0]&4&&(B.data=I[2]?[{name:I[2],highlight:"yes"}]:[]),e.$set(B);const O={};n.$set(O);const Y={};o.$set(Y);const q=L[0]&24578?Tn(T,[T[0],T[1],{paint:{"fill-color":I[13](I[1]),"fill-opacity":I[14](I[1])}},T[3],T[4]]):{};L[0]&2|L[1]&1&&(q.$$scope={dirty:L,ctx:I}),!d&&L[0]&8&&(d=!0,q.hovered=I[3],Dn(()=>d=!1)),s.$set(q)},i(I){p||(N(e.$$.fragment,I),N(n.$$.fragment,I),N(o.$$.fragment,I),N(s.$$.fragment,I),p=!0)},o(I){V(e.$$.fragment,I),V(n.$$.fragment,I),V(o.$$.fragment,I),V(s.$$.fragment,I),p=!1},d(I){I&&(G(t),G(i),G(u)),se(e,I),se(n,I),se(o,I),se(s,I)}}}function oD(r){let e,t,n,i,o;return t=new yr({props:{data:r[0],promoteId:"name",$$slots:{default:[iD]},$$scope:{ctx:r}}}),i=new Ka({props:{interactive:!1}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),ue(e,"slot","map")},m(u,s){W(u,e,s),oe(t,e,null),D(e,n),oe(i,e,null),o=!0},p(u,s){const d={};s[0]&1&&(d.data=u[0]),s[0]&14|s[1]&1&&(d.$$scope={dirty:s,ctx:u}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&G(e),se(t),se(i)}}}function sD(r){let e,t;return e=new Ao({props:{$$slots:{map:[oD],sidebar:[Y7],top:[X7]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i[0]&511|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function aD(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function lD(r,e,t){let n,i,o,u,s,d,p,g,y;st(r,fc,ye=>t(25,o=ye)),st(r,kr,ye=>t(15,u=ye)),st(r,Ia,ye=>t(26,s=ye)),st(r,Qn,ye=>t(5,d=ye)),st(r,xo,ye=>t(6,p=ye)),st(r,Os,ye=>t(7,g=ye)),st(r,Of,ye=>t(8,y=ye));let x=p=="cnt"?"combined":"none",C=null,T=null;an(Ia,s=void 0,s);function E(ye){u.setCurrentNeighbourhood(ye),an(Ia,s=ye,s),an(Qn,d={mode:"neighbourhood"},d)}function z(ye){window.confirm(`Really delete neighbourhood ${ye}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(ye),console.assert(!Ia),Hf(),t(0,n=u.getAllNeighbourhoods()))}function I(ye){let Oe=K2(u,`Rename neighbourhood ${ye} to what?`,ye);Oe&&(u.renameNeighbourhoodBoundary(ye,Oe),an(Ia,s=Oe,s),Hf(),t(0,n=u.getAllNeighbourhoods()))}function L(){lp("debug_route_snapper.geojson",u.toRouteSnapperGj())}function B(ye){let Oe=vo.mapFeature.hover.backgroundColor,Ue=Y2({none:Oe},ye,o);return["case",["==",["feature-state","highlight"],"yes"],Oe,Ue]}function O(ye){let Oe=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],Oe,Kn(.3,Oe)],area:Kn(.7,.9),population_density:Kn(.7,.9),simd:Kn(.7,.9),stats19:Kn(.7,.9),pois:Kn(.7,.9),car_ownership:Kn(.7,.9),combined:Kn(.7,.9)}[ye]}function Y(ye){T=ye,t(3,T)}const q=ye=>E(_r(ye.detail.features[0].properties).name),H=()=>C2(_r(g)),Z=ye=>E(ye),_e=ye=>I(ye),Ie=ye=>z(ye),J=ye=>t(2,C=ye),fe=()=>t(2,C=null);function Ee(ye){x=ye,t(1,x)}return r.$$.update=()=>{r.$$.dirty[0]&32768&&t(0,n=u.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,i=aD(n)),r.$$.dirty[0]&1&&n.features.length==0&&an(Qn,d={mode:"add-neighbourhood"},d)},[n,x,C,T,i,d,p,g,y,E,z,I,L,B,O,u,Y,q,H,Z,_e,Ie,J,fe,Ee]}class uD extends Tt{constructor(e){super(),Ct(this,e,lD,sD,wt,{},null,[-1,-1])}}function Lb(r){let e,t,n;return t=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("li"),ae(t.$$.fragment)},m(i,o){W(i,e,o),oe(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function cD(r){let e,t,n,i,o,u,s,d,p,g,y,x=vr(r[4].mode)+"",C,T;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}});let E=r[0]=="neighbourhood"&&Lb();return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),E&&E.c(),g=ne(),y=j("li"),C=Te(x),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(z,I){W(z,e,I),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),E&&E.m(n,null),D(n,g),D(n,y),D(y,C),T=!0},p(z,I){z[0]=="neighbourhood"?E?I&1&&N(E,1):(E=Lb(),E.c(),N(E,1),E.m(n,g)):E&&(Xt(),V(E,1,1,()=>{E=null}),Kt()),(!T||I&16)&&x!==(x=vr(z[4].mode)+"")&&xt(C,x)},i(z){T||(N(o.$$.fragment,z),N(d.$$.fragment,z),N(E),T=!0)},o(z){V(o.$$.fragment,z),V(d.$$.fragment,z),V(E),T=!1},d(z){z&&G(e),se(o),se(d),E&&E.d()}}}function fD(r){let e;return{c(){e=Te("Explore the origin/destination demand data used")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function hD(r){let e,t,n,i;return n=new Bl({props:{$$slots:{default:[mD]},$$scope:{ctx:r}}}),{c(){e=j("b"),e.textContent="About the fake origin/destination data",t=ne(),ae(n.$$.fragment)},m(o,u){W(o,e,u),W(o,t,u),oe(n,o,u),i=!0},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(G(e),G(t)),se(n,o)}}}function dD(r){let e,t,n,i;return n=new Bl({props:{$$slots:{default:[gD]},$$scope:{ctx:r}}}),{c(){e=j("span"),e.textContent="About the 2021 home to work data",t=ne(),ae(n.$$.fragment)},m(o,u){W(o,e,u),W(o,t,u),oe(n,o,u),i=!0},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(G(e),G(t)),se(n,o)}}}function pD(r){let e,t,n,i;return n=new Bl({props:{$$slots:{default:[_D]},$$scope:{ctx:r}}}),{c(){e=j("span"),e.textContent="About the 2011 home to work data",t=ne(),ae(n.$$.fragment)},m(o,u){W(o,e,u),W(o,t,u),oe(n,o,u),i=!0},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(G(e),G(t)),se(n,o)}}}function mD(r){let e;return{c(){e=j("p"),e.innerHTML=`This region has no available origin/destination data about travel
            patterns, so a <b>completely random</b> small set of trips are
            modelled. Contact Dustin at
            <a href="mailto:dabreegster@gmail.com">dabreegster@gmail.com</a> to set
            up real data in your region.`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function gD(r){let e;return{c(){e=j("p"),e.innerHTML=`This region uses the <a href="https://www.nomisweb.co.uk/sources/census_2021_od" target="_blank">ODWP01EW</a>
            census dataset, with trips from home to work. It was taken during COVID-19,
            so
            <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/methodologies/userguidetocensus2021origindestinationdataenglandandwales" target="_blank">workplace travel patterns have major caveats</a>. Trips to work are just one purpose, representing a small percent
            of all trips and with strong spatial biases. This dataset does not
            distinguish by trip mode, so trips could be made by driving, public
            transit, cycling, walking, etc.`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function _D(r){let e;return{c(){e=j("p"),e.innerHTML=`This region uses preprocessed census data from the <a href="https://nptscot.github.io/data/" target="_blank">NPT project</a>. The data is very outdated. Trips to work are just one purpose,
            representing a small percent of all trips and with strong spatial
            biases.`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function yD(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,ye,Oe,Ue,De;t=new Ns({props:{mode:{mode:r[0]}}}),u=new $n({props:{mode:{mode:"debug-demand"},$$slots:{default:[fD]},$$scope:{ctx:r}}});const xe=[pD,dD,hD],et=[];function Ze(Qe,ct){return Qe[6]=="cnt"?0:Qe[6]=="england"?1:2}return p=Ze(r),g=et[p]=xe[p](r),Ee=new fo({props:{colorScale:r[7],labels:{limits:["0%","50%","same","150%","200%"]}}}),Oe=zg(r[14][0]),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("p"),o=Te(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),ae(u.$$.fragment),s=ne(),d=j("div"),g.c(),y=ne(),x=j("hr"),C=ne(),T=j("fieldset"),E=j("label"),z=j("input"),I=Te(`
        Calculate quickly`),L=ne(),B=j("label"),O=j("input"),Y=Te(`
        Calculate more accurately`),q=ne(),H=j("p"),H.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,Z=ne(),_e=j("label"),Ie=Te(`Only show roads with at least this many daily trips before or after
      `),J=j("input"),fe=ne(),ae(Ee.$$.fragment),Xe(d,"display","flex"),ue(z,"type","radio"),z.__value="fast",Nn(z,z.__value),ue(O,"type","radio"),O.__value="accurate",Nn(O,O.__value),ue(J,"type","number"),ue(J,"min",0),ue(e,"slot","sidebar"),Oe.p(z,O)},m(Qe,ct){W(Qe,e,ct),oe(t,e,null),D(e,n),D(e,i),D(i,o),oe(u,i,null),D(e,s),D(e,d),et[p].m(d,null),D(e,y),D(e,x),D(e,C),D(e,T),D(T,E),D(E,z),z.checked=z.__value===r[3],D(E,I),D(T,L),D(T,B),D(B,O),O.checked=O.__value===r[3],D(B,Y),D(e,q),D(e,H),D(e,Z),D(e,_e),D(_e,Ie),D(_e,J),Nn(J,r[5]),D(e,fe),oe(Ee,e,null),ye=!0,Ue||(De=[St(z,"change",r[13]),St(z,"change",r[10]),St(O,"change",r[15]),St(O,"change",r[10]),St(J,"input",r[16])],Ue=!0)},p(Qe,ct){const dt={};ct&1&&(dt.mode={mode:Qe[0]}),t.$set(dt);const Je={};ct&1048576&&(Je.$$scope={dirty:ct,ctx:Qe}),u.$set(Je);let yt=p;p=Ze(Qe),p!==yt&&(Xt(),V(et[yt],1,1,()=>{et[yt]=null}),Kt(),g=et[p],g||(g=et[p]=xe[p](Qe),g.c()),N(g,1),g.m(d,null)),ct&8&&(z.checked=z.__value===Qe[3]),ct&8&&(O.checked=O.__value===Qe[3]),ct&32&&Il(J.value)!==Qe[5]&&Nn(J,Qe[5])},i(Qe){ye||(N(t.$$.fragment,Qe),N(u.$$.fragment,Qe),N(g),N(Ee.$$.fragment,Qe),ye=!0)},o(Qe){V(t.$$.fragment,Qe),V(u.$$.fragment,Qe),V(g),V(Ee.$$.fragment,Qe),ye=!1},d(Qe){Qe&&G(e),se(t),se(u),et[p].d(),se(Ee),Oe.r(),Ue=!1,sr(De)}}}function vD(r){let e,t;const n=[yn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function bD(r){let e,t=r[19].before.toLocaleString()+"",n,i,o=r[19].after.toLocaleString()+"",u,s,d,p,g=Math.round(100*r[19].after/r[19].before)+"",y,x;return{c(){e=j("p"),n=Te(t),i=Te(" before, "),u=Te(o),s=Te(`
            after`),d=ne(),p=j("p"),y=Te(g),x=Te("%")},m(C,T){W(C,e,T),D(e,n),D(e,i),D(e,u),D(e,s),W(C,d,T),W(C,p,T),D(p,y),D(p,x)},p(C,T){T&524288&&t!==(t=C[19].before.toLocaleString()+"")&&xt(n,t),T&524288&&o!==(o=C[19].after.toLocaleString()+"")&&xt(u,o),T&524288&&g!==(g=Math.round(100*C[19].after/C[19].before)+"")&&xt(y,g)},d(C){C&&(G(e),G(d),G(p))}}}function wD(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[bD,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&1572864&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function xD(r){let e,t,n,i;const o=[yn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ld,r[2].max_count,1.5*Id],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=Mt(u,o[p]);e=new hr({props:u});const s=[yn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ld,r[2].max_count,Id],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[7][0],50,r[7][1],100,r[7][2],150,r[7][3],200,r[7][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[wD]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)d=Mt(d,s[p]);return n=new hr({props:d}),n.$on("click",r[12]),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),i=!0},p(p,g){const y=g&36?Tn(o,[o[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&4&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ld,p[2].max_count,1.5*Id],"line-color":"black"}}]):{};e.$set(y);const x=g&164?Tn(s,[s[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&132&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ld,p[2].max_count,Id],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[7][0],50,p[7][1],100,p[7][2],150,p[7][3],200,p[7][4]]]}},s[3],s[4]]):{};g&1048576&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),se(e,p),se(n,p)}}}function AD(r){let e,t,n,i,o,u,s;return t=new yr({props:{data:r[8],$$slots:{default:[vD]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[2],generateId:!0,$$slots:{default:[xD]},$$scope:{ctx:r}}}),u=new Ka({props:{interactive:!1}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),ae(i.$$.fragment),o=ne(),ae(u.$$.fragment),ue(e,"slot","map")},m(d,p){W(d,e,p),oe(t,e,null),D(e,n),oe(i,e,null),D(e,o),oe(u,e,null),s=!0},p(d,p){const g={};p&1048576&&(g.$$scope={dirty:p,ctx:d}),t.$set(g);const y={};p&4&&(y.data=d[2]),p&1048612&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){s||(N(t.$$.fragment,d),N(i.$$.fragment,d),N(u.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(i.$$.fragment,d),V(u.$$.fragment,d),s=!1},d(d){d&&G(e),se(t),se(i),se(u)}}}function kD(r){let e,t,n,i;return e=new oc({props:{loading:r[1]}}),n=new Ao({props:{$$slots:{map:[AD],sidebar:[yD],top:[cD]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&1048701&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}let Ld=3,Id=10;function SD(r,e,t){let n,i,o,u,s;st(r,ug,q=>t(11,n=q)),st(r,kr,q=>t(17,i=q)),st(r,Qn,q=>t(4,o=q)),st(r,s1,q=>t(5,u=q)),st(r,xo,q=>t(6,s=q));let{prevMode:d}=e,p=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],g="",y={type:"FeatureCollection",features:[],max_count:1},x=i.getAllNeighbourhoods();function C(q){an(Qn,o={mode:"impact-detail",road:q,prevPrevMode:d},o)}async function T(q){t(1,g="Calculating impact"),await gp(),t(2,y=i.predictImpact(q)),t(1,g="")}let E=n?"fast":"accurate";function z(){an(ug,n=E=="fast",n)}const I=[[]],L=q=>C(q.detail.features[0]);function B(){E=this.__value,t(3,E)}function O(){E=this.__value,t(3,E)}function Y(){u=Il(this.value),s1.set(u)}return r.$$set=q=>{"prevMode"in q&&t(0,d=q.prevMode)},r.$$.update=()=>{r.$$.dirty&2048&&T(n)},[d,g,y,E,o,u,s,p,x,C,z,n,L,B,I,O,Y]}class CD extends Tt{constructor(e){super(),Ct(this,e,SD,kD,wt,{prevMode:0})}}function Ib(r){let e,t,n;return t=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("li"),ae(t.$$.fragment)},m(i,o){W(i,e,o),oe(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function TD(r){let e,t,n,i,o,u,s,d,p,g,y,x=vr(r[7].mode)+"",C,T;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}});let E=r[0]=="neighbourhood"&&Ib();return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),E&&E.c(),g=ne(),y=j("li"),C=Te(x),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(z,I){W(z,e,I),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),E&&E.m(n,null),D(n,g),D(n,y),D(y,C),T=!0},p(z,I){z[0]=="neighbourhood"?E?I&1&&N(E,1):(E=Ib(),E.c(),N(E,1),E.m(n,g)):E&&(Xt(),V(E,1,1,()=>{E=null}),Kt()),(!T||I&128)&&x!==(x=vr(z[7].mode)+"")&&xt(C,x)},i(z){T||(N(o.$$.fragment,z),N(d.$$.fragment,z),N(E),T=!0)},o(z){V(o.$$.fragment,z),V(d.$$.fragment,z),V(E),T=!1},d(z){z&&G(e),se(o),se(d),E&&E.d()}}}function MD(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function ED(r){let e,t=Fa(r[6].properties.distance)+"",n,i,o=Oa(r[6].properties.time)+"",u;return{c(){e=j("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),D(e,n),D(e,i),D(e,u)},p(s,d){d&64&&t!==(t=Fa(s[6].properties.distance)+"")&&xt(n,t),d&64&&o!==(o=Oa(s[6].properties.time)+"")&&xt(u,o)},d(s){s&&G(e)}}}function LD(r){let e;return{c(){e=j("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function ID(r){let e,t=Fa(r[5].properties.distance)+"",n,i,o=Oa(r[5].properties.time)+"",u;return{c(){e=j("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),D(e,n),D(e,i),D(e,u)},p(s,d){d&32&&t!==(t=Fa(s[5].properties.distance)+"")&&xt(n,t),d&32&&o!==(o=Oa(s[5].properties.time)+"")&&xt(u,o)},d(s){s&&G(e)}}}function PD(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L,B,O,Y;t=new Ns({props:{mode:{mode:r[0]}}});function q(fe,Ee){return fe[6]?ED:MD}let H=q(r),Z=H(r);function _e(fe,Ee){return fe[5]?ID:LD}let Ie=_e(r),J=Ie(r);return{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("p"),i.textContent="Drag markers for a route",o=ne(),u=j("u"),u.textContent="Route before changes",s=ne(),Z.c(),d=ne(),p=j("u"),p.textContent="Route after changes",g=ne(),J.c(),y=ne(),x=j("label"),C=Te("Slow-down factor for main roads: "),T=Te(r[2]),E=ne(),z=j("input"),I=ne(),L=j("i"),L.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Xe(u,"color","red"),Xe(p,"color","blue"),ue(z,"type","range"),ue(z,"min","1.0"),ue(z,"max","5.0"),ue(z,"step","0.1"),ue(e,"slot","sidebar")},m(fe,Ee){W(fe,e,Ee),oe(t,e,null),D(e,n),D(e,i),D(e,o),D(e,u),D(e,s),Z.m(e,null),D(e,d),D(e,p),D(e,g),J.m(e,null),D(e,y),D(e,x),D(x,C),D(x,T),D(x,E),D(x,z),Nn(z,r[2]),D(e,I),D(e,L),B=!0,O||(Y=[St(z,"change",r[11]),St(z,"input",r[11])],O=!0)},p(fe,Ee){const ye={};Ee&1&&(ye.mode={mode:fe[0]}),t.$set(ye),H===(H=q(fe))&&Z?Z.p(fe,Ee):(Z.d(1),Z=H(fe),Z&&(Z.c(),Z.m(e,d))),Ie===(Ie=_e(fe))&&J?J.p(fe,Ee):(J.d(1),J=Ie(fe),J&&(J.c(),J.m(e,y))),(!B||Ee&4)&&xt(T,fe[2]),Ee&4&&Nn(z,fe[2])},i(fe){B||(N(t.$$.fragment,fe),B=!0)},o(fe){V(t.$$.fragment,fe),B=!1},d(fe){fe&&G(e),se(t),Z.d(),J.d(),O=!1,sr(Y)}}}function Pb(r){let e,t;return e=new dh({props:{$$slots:{default:[zD]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function zD(r){let e,t,n,i,o,u,s,d;return e=new yp({}),n=new _p({}),o=new vp({}),s=new hh({props:{interactive:!1}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),W(p,i,g),oe(o,p,g),W(p,u,g),oe(s,p,g),d=!0},p:lt,i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(G(t),G(i),G(u)),se(e,p),se(n,p),se(o,p),se(s,p)}}}function DD(r){let e,t;const n=[yn("compare-route"),{paint:{"line-width":10,"line-color":Oo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function RD(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function BD(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function FD(r){let e,t,n,i,o,u,s,d,p,g,y,x,C=r[0]=="neighbourhood"&&Pb(r);n=new Ka({props:{interactive:!1}}),o=new yr({props:{data:r[1],$$slots:{default:[DD]},$$scope:{ctx:r}}});function T(L){r[9](L)}let E={draggable:!0,$$slots:{default:[RD]},$$scope:{ctx:r}};r[4]!==void 0&&(E.lngLat=r[4]),s=new Dl({props:E}),_n.push(()=>Rn(s,"lngLat",T));function z(L){r[10](L)}let I={draggable:!0,$$slots:{default:[BD]},$$scope:{ctx:r}};return r[3]!==void 0&&(I.lngLat=r[3]),g=new Dl({props:I}),_n.push(()=>Rn(g,"lngLat",z)),{c(){e=j("div"),C&&C.c(),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment),p=ne(),ae(g.$$.fragment),ue(e,"slot","map")},m(L,B){W(L,e,B),C&&C.m(e,null),D(e,t),oe(n,e,null),D(e,i),oe(o,e,null),D(e,u),oe(s,e,null),D(e,p),oe(g,e,null),x=!0},p(L,B){L[0]=="neighbourhood"?C?B&1&&N(C,1):(C=Pb(L),C.c(),N(C,1),C.m(e,t)):C&&(Xt(),V(C,1,1,()=>{C=null}),Kt());const O={};B&2&&(O.data=L[1]),B&4096&&(O.$$scope={dirty:B,ctx:L}),o.$set(O);const Y={};B&4096&&(Y.$$scope={dirty:B,ctx:L}),!d&&B&16&&(d=!0,Y.lngLat=L[4],Dn(()=>d=!1)),s.$set(Y);const q={};B&4096&&(q.$$scope={dirty:B,ctx:L}),!y&&B&8&&(y=!0,q.lngLat=L[3],Dn(()=>y=!1)),g.$set(q)},i(L){x||(N(C),N(n.$$.fragment,L),N(o.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),x=!0)},o(L){V(C),V(n.$$.fragment,L),V(o.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),x=!1},d(L){L&&G(e),C&&C.d(),se(n),se(o),se(s),se(g)}}}function OD(r){let e,t;return e=new Ao({props:{$$slots:{map:[FD],sidebar:[PD],top:[TD]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function $D(r,e,t){let n,i,o,u,s,d,p,g;st(r,i1,E=>t(2,u=E)),st(r,Ff,E=>t(3,s=E)),st(r,Bf,E=>t(4,d=E)),st(r,kr,E=>t(8,p=E)),st(r,Qn,E=>t(7,g=E));let{prevMode:y}=e;ls(()=>{setTimeout(()=>{fg(Bf),fg(Ff)},10)});function x(E){d=E,Bf.set(d)}function C(E){s=E,Ff.set(s)}function T(){u=Il(this.value),i1.set(u)}return r.$$set=E=>{"prevMode"in E&&t(0,y=E.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=p.compareRoute(d,s,u)),r.$$.dirty&2&&t(6,i=n.features.find(E=>E.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(E=>E.properties.kind=="after"))},[y,n,u,s,d,o,i,g,p,x,C,T]}class ND extends Tt{constructor(e){super(),Ct(this,e,$D,OD,wt,{prevMode:0})}}function jD(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T=vr(r[2].mode)+"",E,z;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),y=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),ae(y.$$.fragment),x=ne(),C=j("li"),E=Te(T),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(I,L){W(I,e,L),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),oe(y,g,null),D(n,x),D(n,C),D(C,E),z=!0},p(I,L){(!z||L&4)&&T!==(T=vr(I[2].mode)+"")&&xt(E,T)},i(I){z||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(y.$$.fragment,I),z=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(y.$$.fragment,I),z=!1},d(I){I&&G(e),se(o),se(d),se(y)}}}function UD(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I,L;t=new Ns({props:{mode:{mode:"neighbourhood"}}});function B(q){r[8](q)}function O(q){r[9](q)}let Y={map:_r(r[3])};return r[0]!==void 0&&(Y.waypoints=r[0]),r[1]!==void 0&&(Y.drawnShapeOut=r[1]),u=new Z2({props:Y}),_n.push(()=>Rn(u,"waypoints",B)),_n.push(()=>Rn(u,"drawnShapeOut",O)),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),i=j("h1"),i.textContent="Adjust boundary",o=ne(),ae(u.$$.fragment),p=ne(),g=j("div"),y=j("button"),x=Te("Finish"),T=ne(),E=j("button"),E.textContent="Cancel",y.disabled=C=r[0].length<3,ue(E,"class","secondary"),Xe(g,"display","flex"),Xe(g,"gap","16px"),ue(e,"slot","sidebar")},m(q,H){W(q,e,H),oe(t,e,null),D(e,n),D(e,i),D(e,o),oe(u,e,null),D(e,p),D(e,g),D(g,y),D(y,x),D(g,T),D(g,E),z=!0,I||(L=[St(y,"click",r[4]),St(E,"click",r[5])],I=!0)},p(q,H){const Z={};H&8&&(Z.map=_r(q[3])),!s&&H&1&&(s=!0,Z.waypoints=q[0],Dn(()=>s=!1)),!d&&H&2&&(d=!0,Z.drawnShapeOut=q[1],Dn(()=>d=!1)),u.$set(Z),(!z||H&1&&C!==(C=q[0].length<3))&&(y.disabled=C)},i(q){z||(N(t.$$.fragment,q),N(u.$$.fragment,q),z=!0)},o(q){V(t.$$.fragment,q),V(u.$$.fragment,q),z=!1},d(q){q&&G(e),se(t),se(u),I=!1,sr(L)}}}function VD(r){let e,t;return e=new Ao({props:{$$slots:{sidebar:[UD],top:[jD]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&4111&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function qD(r,e,t){let n,i,o;st(r,Qn,E=>t(2,n=E)),st(r,kr,E=>t(11,i=E)),st(r,as,E=>t(3,o=E));let{name:u}=e,{existing:s}=e,d=[],p,g=s.properties.waypoints;if(!g){let E={type:"LineString",coordinates:s.geometry.coordinates[1]};g=i.extractWaypointsFromRing(E)}d=g.map(E=>({point:[E.lon,E.lat],snapped:E.snapped}));function y(){if(p)try{i.setCurrentNeighbourhoodBoundary(u,p),Hf(),an(Qn,n={mode:"neighbourhood"},n)}catch(E){window.alert(`Sorry, this boundary is invalid: ${E}`),x()}}function x(){an(Qn,n={mode:"neighbourhood"},n)}function C(E){d=E,t(0,d)}function T(E){p=E,t(1,p)}return r.$$set=E=>{"name"in E&&t(6,u=E.name),"existing"in E&&t(7,s=E.existing)},[d,p,n,o,y,x,u,s,C,T]}class HD extends Tt{constructor(e){super(),Ct(this,e,qD,VD,wt,{name:6,existing:7})}}const GD=["==",["geometry-type"],"Polygon"],WD=["==",["geometry-type"],"LineString"],ZD=["==",["geometry-type"],"Point"];function nx(){return{type:"FeatureCollection",features:[]}}function Um(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:rx(r)}}}function rx(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const ix=Cn(nx()),ox=Cn(0),XD=100;class KD{constructor(e){tr(this,"map");tr(this,"active");tr(this,"eventListenersSuccess");tr(this,"eventListenersUpdated");tr(this,"eventListenersFailure");tr(this,"points");tr(this,"cursor");tr(this,"hover");tr(this,"dragFrom");tr(this,"previousStates");tr(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});tr(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(zb(this.points).forEach((n,i)=>{t.push([i+1,x3(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});tr(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Um(e.lngLat.toArray()),this.onClick(e),this.finish())});tr(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});tr(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});tr(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});tr(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=nx();this.points.forEach((i,o)=>{let u=Um(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(zb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),ix.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,ox.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Um(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(rx),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>XD&&this.previousStates.shift()}}function zb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function JD(r){let e,t,n;return{c(){e=Te("Undo ("),t=Te(r[1]),n=Te(")")},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o&2&&xt(t,i[1])},d(i){i&&(G(e),G(t),G(n))}}}function YD(r){let e;return{c(){e=Te("Undo")},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function QD(r){let e,t,n,i,o,u,s,d,p,g,y;function x(E,z){return E[1]==0?YD:JD}let C=x(r),T=C(r);return{c(){e=j("div"),t=j("button"),t.textContent="Finish",n=ne(),i=j("button"),i.textContent="Cancel",o=ne(),u=j("button"),T.c(),d=ne(),p=j("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=s=r[1]==0,Xe(e,"display","flex"),Xe(e,"justify-content","space-between")},m(E,z){W(E,e,z),D(e,t),D(e,n),D(e,i),D(e,o),D(e,u),T.m(u,null),W(E,d,z),W(E,p,z),g||(y=[St(t,"click",r[2]),St(i,"click",r[3]),St(u,"click",r[4])],g=!0)},p(E,[z]){C===(C=x(E))&&T?T.p(E,z):(T.d(1),T=C(E),T&&(T.c(),T.m(u,null))),z&2&&s!==(s=E[1]==0)&&(u.disabled=s)},i:lt,o:lt,d(E){E&&(G(e),G(d),G(p)),T.d(),g=!1,sr(y)}}}function eR(r,e,t){let n;st(r,ox,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),s=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,s]}class tR extends Tt{constructor(e){super(),Ct(this,e,eR,QD,wt,{polygonTool:0})}}let nR=Date.now();function ph(r){return`${r}-${nR++}`}const sx=Symbol.for("svelte-maplibre");function rR(){return Yf(sx)}function Db(r){return{subscribe:r.subscribe}}function ax({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=rR(),o=Cn(null),u=Db(o),s={...i,[r]:Db(o)};if(e&&(s.popupTarget=u),n){let d=Cn(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=Cn()),ap(sx,s),{...i,self:o}}function iR(){return ax({key:"source",setCluster:!0})}function oR(r=!0){return ax({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Rb(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function sR(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function aR(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Bb(r){let e=r[0],t,n,i=Fb(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&wt(e,e=o[0])?(Xt(),V(i,1,1,lt),Kt(),i=Fb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Fb(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function lR(r){let e,t,n=r[0]&&Bb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Bb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function uR(r,e,t){let n,i,o,u,s,d,p,g,y,x,C,T,{$$slots:E={},$$scope:z}=e,{id:I=ph("layer")}=e,{source:L=void 0}=e,{sourceLayer:B=void 0}=e,{beforeId:O=void 0}=e,{beforeLayerType:Y=void 0}=e,{type:q}=e,{paint:H=void 0}=e,{layout:Z=void 0}=e,{filter:_e=void 0}=e,{applyToClusters:Ie=void 0}=e,{minzoom:J=void 0}=e,{maxzoom:fe=void 0}=e,{manageHoverState:Ee=!1}=e,{hovered:ye=null}=e,{interactive:Oe=!0}=e,{hoverCursor:Ue=void 0}=e,{eventsIfTopMost:De=!1}=e;const xe=$s(),{map:et,source:Ze,self:Qe,minzoom:ct,maxzoom:dt,eventTopMost:Je,layerInfo:yt}=oR();st(r,et,He=>t(31,y=He)),st(r,Ze,He=>t(32,x=He)),st(r,Qe,He=>t(0,g=He)),st(r,ct,He=>t(34,T=He)),st(r,dt,He=>t(33,C=He)),ei(()=>{g&&y&&(yt.delete(g),y==null||y.removeLayer(g))});let Et;function Ot(He){var he,nn;if(!Oe||!g||!y||De&&Je(He)!==g)return;let We=He.features??[],mt=(nn=(he=We[0])==null?void 0:he.properties)==null?void 0:nn.cluster_id,Pt={event:He,map:y,clusterId:mt,layer:g,source:s,features:We};xe(He.type,Pt)}function Yt(He){var he,nn;if(!Oe||!g||!y||De&&Je(He)!==g)return;Ue&&(y.getCanvas().style.cursor=Ue);let We=He.features??[];t(6,ye=We[0]??null);let mt=(nn=(he=We[0])==null?void 0:he.properties)==null?void 0:nn.cluster_id;xe("mouseenter",{event:He,map:y,clusterId:mt,layer:g,source:s,features:We})}function tn(He){var he,nn,Pe;if(!Oe||!y)return;if(De&&Je(He)!==g){t(6,ye=null),Ee&&Et!==void 0&&(y==null||y.setFeatureState({source:s,sourceLayer:B,id:Et},{hover:!1}),Et=void 0);return}y.getCanvas().style.cursor=Ue;let We=He.features??[],mt=(nn=(he=We[0])==null?void 0:he.properties)==null?void 0:nn.cluster_id,Pt=(Pe=We[0])==null?void 0:Pe.id;Pt!==Et&&(Ee&&(Et!==void 0&&(y==null||y.setFeatureState({source:s,id:Et,sourceLayer:B},{hover:!1})),y==null||y.setFeatureState({source:s,id:Pt,sourceLayer:B},{hover:!0})),Et=Pt,t(6,ye=We[0]??null)),xe("mousemove",{event:He,map:y,clusterId:mt,layer:g,source:s,features:We})}function Qt(He){if(!(!Oe||!g||!y)){if(Ue&&(y.getCanvas().style.cursor=""),t(6,ye=null),Ee&&Et!==void 0){const We={source:s,id:Et,sourceLayer:B};y==null||y.setFeatureState(We,{hover:!1}),Et=void 0}xe("mouseleave",{map:y,layer:g,source:s})}}let fn=!0;function pn(He){y&&(y.off("click",He,Ot),y.off("dblclick",He,Ot),y.off("contextmenu",He,Ot),y.off("mouseenter",He,Yt),y.off("mousemove",He,tn),y.off("mouseleave",He,Qt))}return ei(()=>{y&&g&&pn(g)}),r.$$set=He=>{"id"in He&&t(7,I=He.id),"source"in He&&t(8,L=He.source),"sourceLayer"in He&&t(9,B=He.sourceLayer),"beforeId"in He&&t(10,O=He.beforeId),"beforeLayerType"in He&&t(11,Y=He.beforeLayerType),"type"in He&&t(12,q=He.type),"paint"in He&&t(13,H=He.paint),"layout"in He&&t(14,Z=He.layout),"filter"in He&&t(15,_e=He.filter),"applyToClusters"in He&&t(16,Ie=He.applyToClusters),"minzoom"in He&&t(17,J=He.minzoom),"maxzoom"in He&&t(18,fe=He.maxzoom),"manageHoverState"in He&&t(19,Ee=He.manageHoverState),"hovered"in He&&t(6,ye=He.hovered),"interactive"in He&&t(20,Oe=He.interactive),"hoverCursor"in He&&t(21,Ue=He.hoverCursor),"eventsIfTopMost"in He&&t(22,De=He.eventsIfTopMost),"$$scope"in He&&t(35,z=He.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=aR(Ie)),r.$$.dirty[0]&1073774592&&t(24,i=sR("all",n,_e)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=J??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=fe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=L||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&g!==I&&s){g&&(pn(g),yt.delete(g));let He=O;if(!O&&Y){let We=y.getStyle().layers,mt=typeof Y=="function"?Y:he=>he.type===Y,Pt=We==null?void 0:We.find(mt);Pt&&(He=Pt.id)}an(Qe,g=I,g),y.addLayer(Ba({id:g,type:q,source:s,"source-layer":B,filter:i,paint:H,layout:Z,minzoom:o,maxzoom:u}),He),t(23,fn=!0),y.on("click",g,Ot),y.on("dblclick",g,Ot),y.on("contextmenu",g,Ot),y.on("mouseenter",g,Yt),y.on("mousemove",g,tn),y.on("mouseleave",g,Qt)}r.$$.dirty[0]&1048577&&g&&yt.set(g,{interactive:Oe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Rb((He,We)=>y==null?void 0:y.setPaintProperty(g,He,We)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Rb((He,We)=>y==null?void 0:y.setLayoutProperty(g,He,We)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(H)),r.$$.dirty[0]&134234112&&(p==null||p(Z)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(y==null||y.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(fn?t(23,fn=!1):y==null||y.setFilter(g,i))},[g,et,Ze,Qe,ct,dt,ye,I,L,B,O,Y,q,H,Z,_e,Ie,J,fe,Ee,Oe,Ue,De,fn,i,u,o,p,d,s,n,y,x,C,T,z,E]}class __ extends Tt{constructor(e){super(),Ct(this,e,uR,lR,wt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function cR(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function fR(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[cR]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new __({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function hR(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ph("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:E=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:I=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:B=!1}=e,{interactive:O=!0}=e;function Y(fe){L=fe,t(0,L)}function q(fe){Sn.call(this,r,fe)}function H(fe){Sn.call(this,r,fe)}function Z(fe){Sn.call(this,r,fe)}function _e(fe){Sn.call(this,r,fe)}function Ie(fe){Sn.call(this,r,fe)}function J(fe){Sn.call(this,r,fe)}return r.$$set=fe=>{"id"in fe&&t(1,o=fe.id),"source"in fe&&t(2,u=fe.source),"sourceLayer"in fe&&t(3,s=fe.sourceLayer),"beforeId"in fe&&t(4,d=fe.beforeId),"beforeLayerType"in fe&&t(5,p=fe.beforeLayerType),"paint"in fe&&t(6,g=fe.paint),"layout"in fe&&t(7,y=fe.layout),"filter"in fe&&t(8,x=fe.filter),"applyToClusters"in fe&&t(9,C=fe.applyToClusters),"minzoom"in fe&&t(10,T=fe.minzoom),"maxzoom"in fe&&t(11,E=fe.maxzoom),"hoverCursor"in fe&&t(12,z=fe.hoverCursor),"manageHoverState"in fe&&t(13,I=fe.manageHoverState),"hovered"in fe&&t(0,L=fe.hovered),"eventsIfTopMost"in fe&&t(14,B=fe.eventsIfTopMost),"interactive"in fe&&t(15,O=fe.interactive),"$$scope"in fe&&t(24,i=fe.$$scope)},[L,o,u,s,d,p,g,y,x,C,T,E,z,I,B,O,n,Y,q,H,Z,_e,Ie,J,i]}class dR extends Tt{constructor(e){super(),Ct(this,e,hR,fR,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function pR(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function mR(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[pR]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new __({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function gR(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ph("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:E=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:B=!0}=e;function O(J){I=J,t(0,I)}function Y(J){Sn.call(this,r,J)}function q(J){Sn.call(this,r,J)}function H(J){Sn.call(this,r,J)}function Z(J){Sn.call(this,r,J)}function _e(J){Sn.call(this,r,J)}function Ie(J){Sn.call(this,r,J)}return r.$$set=J=>{"id"in J&&t(1,o=J.id),"source"in J&&t(2,u=J.source),"sourceLayer"in J&&t(3,s=J.sourceLayer),"beforeId"in J&&t(4,d=J.beforeId),"beforeLayerType"in J&&t(5,p=J.beforeLayerType),"paint"in J&&t(6,g=J.paint),"layout"in J&&t(7,y=J.layout),"filter"in J&&t(8,x=J.filter),"minzoom"in J&&t(9,C=J.minzoom),"maxzoom"in J&&t(10,T=J.maxzoom),"hoverCursor"in J&&t(11,E=J.hoverCursor),"manageHoverState"in J&&t(12,z=J.manageHoverState),"hovered"in J&&t(0,I=J.hovered),"eventsIfTopMost"in J&&t(13,L=J.eventsIfTopMost),"interactive"in J&&t(14,B=J.interactive),"$$scope"in J&&t(23,i=J.$$scope)},[I,o,u,s,d,p,g,y,x,C,T,E,z,L,B,n,O,Y,q,H,Z,_e,Ie,i]}class _R extends Tt{constructor(e){super(),Ct(this,e,gR,mR,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function yR(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function vR(r,e,t){aw().then(()=>{let n=hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Ob(r){let e=r[0],t,n,i=$b(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&wt(e,e=o[0])?(Xt(),V(i,1,1,lt),Kt(),i=$b(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function $b(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function bR(r){let e,t,n=r[0]&&Ob(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Ob(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function wR(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=ph("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:y=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e;const{map:E,cluster:z,self:I}=iR();st(r,E,O=>t(13,i=O)),st(r,z,O=>t(16,o=O)),st(r,I,O=>t(0,n=O));let L,B=!0;return ei(()=>{n&&L&&i&&(vR(E,n,L),an(I,n=null,n),t(11,L=void 0))}),r.$$set=O=>{"id"in O&&t(4,d=O.id),"data"in O&&t(5,p=O.data),"generateId"in O&&t(6,g=O.generateId),"promoteId"in O&&t(7,y=O.promoteId),"filter"in O&&t(8,x=O.filter),"lineMetrics"in O&&t(9,C=O.lineMetrics),"cluster"in O&&t(10,T=O.cluster),"$$scope"in O&&t(14,s=O.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&an(z,o=T,o),r.$$.dirty&12273&&i&&n!==d&&(an(I,n=d,n),yR(i,n,Ba({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:y,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties}),O=>i&&O===n,()=>{n&&(t(11,L=i==null?void 0:i.getSource(n)),t(12,B=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,L=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&L&&(B?t(12,B=!1):L.setData(p)),r.$$.dirty&3072&&(L==null||L.setClusterOptions(Ba({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,E,z,I,d,p,g,y,x,C,T,L,B,i,s,u]}class xR extends Tt{constructor(e){super(),Ct(this,e,wR,bR,wt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function AR(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function kR(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[AR]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new __({props:o}),_n.push(()=>Rn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function SR(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ph("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:y=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:E=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:B=!0}=e;function O(J){I=J,t(0,I)}function Y(J){Sn.call(this,r,J)}function q(J){Sn.call(this,r,J)}function H(J){Sn.call(this,r,J)}function Z(J){Sn.call(this,r,J)}function _e(J){Sn.call(this,r,J)}function Ie(J){Sn.call(this,r,J)}return r.$$set=J=>{"id"in J&&t(1,o=J.id),"source"in J&&t(2,u=J.source),"sourceLayer"in J&&t(3,s=J.sourceLayer),"beforeId"in J&&t(4,d=J.beforeId),"beforeLayerType"in J&&t(5,p=J.beforeLayerType),"paint"in J&&t(6,g=J.paint),"layout"in J&&t(7,y=J.layout),"filter"in J&&t(8,x=J.filter),"minzoom"in J&&t(9,C=J.minzoom),"maxzoom"in J&&t(10,T=J.maxzoom),"hoverCursor"in J&&t(11,E=J.hoverCursor),"manageHoverState"in J&&t(12,z=J.manageHoverState),"hovered"in J&&t(0,I=J.hovered),"eventsIfTopMost"in J&&t(13,L=J.eventsIfTopMost),"interactive"in J&&t(14,B=J.interactive),"$$scope"in J&&t(23,i=J.$$scope)},[I,o,u,s,d,p,g,y,x,C,T,E,z,L,B,n,O,Y,q,H,Z,_e,Ie,i]}class CR extends Tt{constructor(e){super(),Ct(this,e,SR,kR,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function TR(r){let e,t,n,i,o,u;return e=new _R({props:{id:"edit-polygon-fill",filter:GD,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new CR({props:{id:"edit-polygon-lines",filter:WD,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new dR({props:{id:"edit-polygon-vertices",filter:ZD,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment)},m(s,d){oe(e,s,d),W(s,t,d),oe(n,s,d),W(s,i,d),oe(o,s,d),u=!0},p:lt,i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),se(e,s),se(n,s),se(o,s)}}}function MR(r){let e,t;return e=new xR({props:{data:r[0],$$slots:{default:[TR]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ER(r,e,t){let n;return st(r,ix,i=>t(0,n=i)),[n]}class LR extends Tt{constructor(e){super(),Ct(this,e,ER,MR,wt,{})}}function IR(r){let e,t,n,i,o,u,s;return{c(){e=j("button"),e.textContent="Import current view",t=ne(),n=j("i"),n.textContent="or...",i=ne(),o=j("button"),o.textContent="Draw an area to import on the map",ue(e,"type","button"),ue(o,"type","button")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,o,p),u||(s=[St(e,"click",r[2]),St(o,"click",r[3])],u=!0)},p:lt,i:lt,o:lt,d(d){d&&(G(e),G(t),G(n),G(i),G(o)),u=!1,sr(s)}}}function PR(r){let e,t;return e=new tR({props:{polygonTool:r[0]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function zR(r){let e,t,n,i,o,u,s,d,p;const g=[PR,IR],y=[];function x(C,T){return C[0]?0:1}return e=x(r),t=y[e]=g[e](r),{c(){t.c(),n=ne(),i=j("label"),o=j("input"),u=Te(`Save a copy of the osm.xml
  after importing`),ue(o,"type","checkbox")},m(C,T){y[e].m(C,T),W(C,n,T),W(C,i,T),D(i,o),o.checked=r[1],D(i,u),s=!0,d||(p=St(o,"change",r[5]),d=!0)},p(C,[T]){let E=e;e=x(C),e===E?y[e].p(C,T):(Xt(),V(y[E],1,1,()=>{y[E]=null}),Kt(),t=y[e],t?t.p(C,T):(t=y[e]=g[e](C),t.c()),N(t,1),t.m(n.parentNode,n)),T&2&&(o.checked=C[1])},i(C){s||(N(t),s=!0)},o(C){V(t),s=!1},d(C){C&&(G(n),G(i)),y[e].d(C),d=!1,p()}}}function xf(r){return[r.lng,r.lat]}function DR(r,e,t){let{map:n}=e;const i=$s();let o=null,u=!1;async function s(x){try{i("loading","Loading from Overpass");let T=await(await fetch(lx(x))).text();u&&lp("osm.xml",T),i("gotXml",{xml:T,boundary:x})}catch(C){i("error",C.toString())}}function d(){let x=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[xf(x.getSouthWest()),xf(x.getNorthWest()),xf(x.getNorthEast()),xf(x.getSouthEast()),xf(x.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await s(d())}}function g(){n&&(t(0,o=new KD(n)),o.startNew(),o.addEventListenerSuccess(async x=>{t(0,o=null),await s(x)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function y(){u=this.checked,t(1,u)}return r.$$set=x=>{"map"in x&&t(4,n=x.map)},[o,u,p,g,n,y]}class RR extends Tt{constructor(e){super(),Ct(this,e,DR,zR,wt,{map:4})}}function lx(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class ux{constructor(e,t,n,i,o,u,s){tr(this,"inner");this.inner=new T6(e||new Uint8Array,t||new Uint8Array,n,i,o,u,s)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setCurrentNeighbourhoodBoundary(e,t){this.inner.setCurrentNeighbourhoodBoundary(e,t)}extractWaypointsFromRing(e){let t=this.inner.extractWaypointsFromRing(e);return JSON.parse(t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}reclassifyRoadsAlongLine(e,t,n){this.inner.reclassifyRoadsAlongLine(e,t,n)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=t1(t.properties.counts_from),t.properties.sum_to=t1(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}getMetricBuckets(){try{return JSON.parse(this.inner.getMetricBuckets())}catch{return null}}eraseAllMainRoads(){this.inner.eraseAllMainRoads()}}let lc=Cn(""),uc=Cn(null);async function bp(r){let e=hi(Ha).project(r);try{console.time("get input files");let{osmBuffer:t,boundary:n,mapModelBuffer:i}=await BR(e);console.timeEnd("get input files"),lc.set("Download finished, setting up project"),uc.set(100),await gp(),console.time("load"),kr.set(new ux(i?new Uint8Array(i):void 0,t?new Uint8Array(t):void 0,n,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),hi(kr).loadSavefile(e),Os.set(r),console.timeEnd("load"),cx(r)}catch(t){window.alert(`Couldn't open project: ${t}`),Os.set(void 0)}lc.set(""),uc.set(null)}async function BR(r){if(r.app_focus=="cnt")return{mapModelBuffer:await Vm(ys(`cnt/maps_v1/${r.study_area_name}.bin.gz`))};if(r.app_focus=="england")return{mapModelBuffer:await Vm(ys(`england/maps_v1/${r.study_area_name}.bin.gz`))};if(r.study_area_name){let e=await Vm(ys(`severance_pbfs/${r.study_area_name}.pbf`)),n=await(await ig(ys(`boundaries/${r.study_area_name}.geojson`))).json();return{osmBuffer:e,boundary:n}}else{lc.set("Grabbing OSM data from Overpass"),uc.set(100);let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await ig(lx(e))).arrayBuffer(),boundary:e}}}async function Vm(r){return console.log(`Grabbing ${r}`),lc.set(`Downloading ${r}`),await Mk(r,e=>uc.set(e))}function cx(r){sp.set(new k3(hi(as),hi(kr).toRouteSnapper(),Cn(Fi()),Cn(!0),Cn(0))),hi(as).fitBounds(hi(kr).getBounds(),{duration:500});let e=hi(kr).getMetricBuckets();e&&fc.set(e);let t=new URL(window.location.href);t.searchParams.set("project",r),window.history.replaceState(null,"",t.toString())}function Nb(r,e,t){const n=r.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function jb(r,e,t){const n=r.slice();return n[23]=e[t][0],n[24]=e[t][1],n}function FR(r){let e,t,n,i,o,u,s,d=vr(r[5].mode)+"",p,g;return o=new $n({props:{mode:{mode:"title"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),p=Te(d),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(y,x){W(y,e,x),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),D(s,p),g=!0},p(y,x){(!g||x&32)&&d!==(d=vr(y[5].mode)+"")&&xt(p,d)},i(y){g||(N(o.$$.fragment,y),g=!0)},o(y){V(o.$$.fragment,y),g=!1},d(y){y&&G(e),se(o)}}}function Ub(r){let e,t,n,i,o,u,s,d,p,g,y,x,C=On(r[3]),T=[];for(let E=0;E<C.length;E+=1)T[E]=qb(Nb(r,C,E));return p=new RR({props:{map:r[8]}}),p.$on("gotXml",r[9]),p.$on("loading",r[13]),p.$on("error",r[14]),{c(){e=j("label"),t=Te(`Load a built-in area:
        `),n=j("select"),i=j("option");for(let E=0;E<T.length;E+=1)T[E].c();o=ne(),u=j("i"),u.textContent="or...",s=ne(),d=j("div"),ae(p.$$.fragment),i.__value="",Nn(i,i.__value),r[2]===void 0&&Yo(()=>r[11].call(n))},m(E,z){W(E,e,z),D(e,t),D(e,n),D(n,i);for(let I=0;I<T.length;I+=1)T[I]&&T[I].m(n,null);Ci(n,r[2],!0),W(E,o,z),W(E,u,z),W(E,s,z),W(E,d,z),oe(p,d,null),g=!0,y||(x=[St(n,"change",r[11]),St(n,"change",r[12])],y=!0)},p(E,z){if(z&8){C=On(E[3]);let L;for(L=0;L<C.length;L+=1){const B=Nb(E,C,L);T[L]?T[L].p(B,z):(T[L]=qb(B),T[L].c(),T[L].m(n,null))}for(;L<T.length;L+=1)T[L].d(1);T.length=C.length}z&12&&Ci(n,E[2]);const I={};z&256&&(I.map=E[8]),p.$set(I)},i(E){g||(N(p.$$.fragment,E),g=!0)},o(E){V(p.$$.fragment,E),g=!1},d(E){E&&(G(e),G(o),G(u),G(s),G(d)),di(T,E),se(p),y=!1,sr(x)}}}function Vb(r){let e,t=r[24]+"",n,i;return{c(){e=j("option"),n=Te(t),e.__value=i=r[23],Nn(e,e.__value)},m(o,u){W(o,e,u),D(e,n)},p(o,u){u&8&&t!==(t=o[24]+"")&&xt(n,t),u&8&&i!==(i=o[23])&&(e.__value=i,Nn(e,e.__value))},d(o){o&&G(e)}}}function qb(r){let e,t,n=On(r[20]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Vb(jb(r,n,o));return{c(){e=j("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();ue(e,"label",t=r[19])},m(o,u){W(o,e,u);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(e,null)},p(o,u){if(u&8){n=On(o[20]);let s;for(s=0;s<n.length;s+=1){const d=jb(o,n,s);i[s]?i[s].p(d,u):(i[s]=Vb(d),i[s].c(),i[s].m(e,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}u&8&&t!==(t=o[19])&&ue(e,"label",t)},d(o){o&&G(e),di(i,o)}}}function OR(r){let e,t,n,i,o,u,s,d,p,g=r[1]&&Ub(r);return{c(){e=j("div"),t=j("div"),n=j("label"),i=Te(`Project name:
        `),o=j("input"),u=ne(),g&&g.c(),ue(o,"type","text"),ue(e,"slot","sidebar")},m(y,x){W(y,e,x),D(e,t),D(t,n),D(n,i),D(n,o),Nn(o,r[1]),D(e,u),g&&g.m(e,null),s=!0,d||(p=St(o,"input",r[10]),d=!0)},p(y,x){x&2&&o.value!==y[1]&&Nn(o,y[1]),y[1]?g?(g.p(y,x),x&2&&N(g,1)):(g=Ub(y),g.c(),N(g,1),g.m(e,null)):g&&(Xt(),V(g,1,1,()=>{g=null}),Kt())},i(y){s||(N(g),s=!0)},o(y){V(g),s=!1},d(y){y&&G(e),g&&g.d(),d=!1,p()}}}function $R(r){let e,t,n;return t=new LR({}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","map")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p:lt,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function NR(r){let e,t,n,i,o,u;return e=new oc({props:{loading:r[4],progress:100}}),n=new oc({props:{loading:r[6],progress:r[7]}}),o=new Ao({props:{$$slots:{map:[$R],sidebar:[OR],top:[FR]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment)},m(s,d){oe(e,s,d),W(s,t,d),oe(n,s,d),W(s,i,d),oe(o,s,d),u=!0},p(s,[d]){const p={};d&16&&(p.loading=s[4]),e.$set(p);const g={};d&64&&(g.loading=s[6]),d&128&&(g.progress=s[7]),n.$set(g);const y={};d&134218046&&(y.$$scope={dirty:d,ctx:s}),o.$set(y)},i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),se(e,s),se(n,s),se(o,s)}}}function jR(r,e,t){let n,i,o,u,s,d,p,g;st(r,Qn,q=>t(5,n=q)),st(r,Ha,q=>t(15,i=q)),st(r,Os,q=>t(16,o=q)),st(r,kr,q=>t(17,u=q)),st(r,xo,q=>t(18,s=q)),st(r,lc,q=>t(6,d=q)),st(r,uc,q=>t(7,p=q)),st(r,as,q=>t(8,g=q));let y="",x=null,C=[],T="";ls(async()=>{let q=await ig(ys("severance_pbfs/areas.json"));t(3,C=await q.json())});async function E(q){t(4,T="Loading OSM");try{let H;an(kr,u=new ux(void 0,new TextEncoder().encode(q.detail.xml),q.detail.boundary,s,H,y,i.dbSchemaVersion),u);const Z=i.createProject(u.toSavefile());an(Os,o=Z,o),cx(Z),an(Qn,n={mode:"add-neighbourhood"},n)}catch(H){window.alert(`Couldn't import from Overpass: ${H}`)}t(4,T="")}async function z(){if(!x)return;let q;try{q=i.createEmptyProject(y,x)}catch(H){t(2,x=null),window.alert(`Couldn't create project: ${H}`);return}await bp(q),an(Qn,n={mode:"add-neighbourhood"},n)}function I(){y=this.value,t(1,y)}function L(){x=ia(this),t(2,x),t(3,C)}return[z,y,x,C,T,n,d,p,g,E,I,L,()=>z(),q=>t(4,T=q.detail),q=>window.alert(q.detail)]}class UR extends Tt{constructor(e){super(),Ct(this,e,jR,NR,wt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const VR="/ltn/assets/boundaries-2701bb3b.geojson",qR="/ltn/assets/boundaries-2d4b0f31.geojson";function Hb(r,e,t){const n=r.slice();return n[11]=e[t],n}function Gb(r){let e,t=r[11]+"",n,i;return{c(){e=j("option"),n=Te(t),e.__value=i=r[11],Nn(e,e.__value)},m(o,u){W(o,e,u),D(e,n)},p(o,u){u&2&&t!==(t=o[11]+"")&&xt(n,t),u&2&&i!==(i=o[11])&&(e.__value=i,Nn(e,e.__value))},d(o){o&&G(e)}}}function HR(r){let e,t,n=r[10].name+"",i;return{c(){e=j("p"),t=Te("Click to start a new project in "),i=Te(n)},m(o,u){W(o,e,u),D(e,t),D(e,i)},p(o,u){u&1024&&n!==(n=o[10].name+"")&&xt(i,n)},d(o){o&&G(e)}}}function GR(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[HR,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&17408&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function WR(r){let e,t,n,i;return e=new Ki({props:{paint:{"fill-color":vo.mapFeature.hover.backgroundColor,"fill-outline-color":vo.mapFeature.hover.backgroundColor,"fill-opacity":Kn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[GR]},$$scope:{ctx:r}}}),e.$on("click",r[3]),n=new hr({props:{paint:{"line-color":vo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,u){const s={};u&16384&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function ZR(r){let e,t,n,i,o,u,s,d,p,g=On(r[1]),y=[];for(let x=0;x<g.length;x+=1)y[x]=Gb(Hb(r,g,x));return u=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[WR]},$$scope:{ctx:r}}}),{c(){e=j("p"),e.textContent="Choose a boundary below or on the map to begin:",t=ne(),n=j("select"),i=j("option");for(let x=0;x<y.length;x+=1)y[x].c();o=ne(),ae(u.$$.fragment),i.__value="",Nn(i,i.__value),Xe(n,"width","90%"),r[2]===void 0&&Yo(()=>r[6].call(n))},m(x,C){W(x,e,C),W(x,t,C),W(x,n,C),D(n,i);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(n,null);Ci(n,r[2],!0),W(x,o,C),oe(u,x,C),s=!0,d||(p=[St(n,"change",r[6]),St(n,"change",r[4])],d=!0)},p(x,[C]){if(C&2){g=On(x[1]);let E;for(E=0;E<g.length;E+=1){const z=Hb(x,g,E);y[E]?y[E].p(z,C):(y[E]=Gb(z),y[E].c(),y[E].m(n,null))}for(;E<y.length;E+=1)y[E].d(1);y.length=g.length}C&6&&Ci(n,x[2]);const T={};C&1&&(T.data=x[0]),C&16384&&(T.$$scope={dirty:C,ctx:x}),u.$set(T)},i(x){s||(N(u.$$.fragment,x),s=!0)},o(x){V(u.$$.fragment,x),s=!1},d(x){x&&(G(e),G(t),G(n),G(o)),di(y,x),se(u,x),d=!1,sr(p)}}}function XR(r,e,t){let n,i;st(r,Qn,C=>t(7,n=C)),st(r,Ha,C=>t(8,i=C));let{boundariesUrl:o}=e,u={type:"FeatureCollection",features:[]},s=[],d="";ls(async()=>{let C=await fetch(o);t(0,u=await C.json());for(let T of u.features)s.push(T.properties.name);s.sort(),t(1,s)});function p(C){let T=C.detail.features[0].properties;g(`${T.kind}_${T.name}`)}async function g(C){let T,E=!1;for(;!E;){let z=T||i.nextAvailableProjectName(Yd(C));if(T=window.prompt(`Please pick a project name to create in ${Yd(C)}`,z),T===null)return;if(T=T.trim(),T===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}try{let I=i.createEmptyProject(T,C);await bp(I),an(Qn,n={mode:"add-neighbourhood"},n),E=!0}catch(I){window.alert(I)}}}function y(){d&&g(`LAD_${d}`)}function x(){d=ia(this),t(2,d),t(1,s)}return r.$$set=C=>{"boundariesUrl"in C&&t(5,o=C.boundariesUrl)},[u,s,d,p,y,o,x]}class fx extends Tt{constructor(e){super(),Ct(this,e,XR,ZR,wt,{boundariesUrl:5})}}function KR(r){let e;return{c(){e=j("p"),e.innerHTML=`The LTN tool can be used anywhere in the world. Some regions have extra
      datasets. If you&#39;d like to specialize the tool, please email Dustin at <a href="mailto:dabreegster@gmail.com">dabreegster@gmail.com</a>.`},m(t,n){W(t,e,n)},p:lt,d(t){t&&G(e)}}}function JR(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I;return n=new QC({props:{color:"black"}}),T=new Bl({props:{$$slots:{default:[KR]},$$scope:{ctx:r}}}),{c(){e=j("span"),t=j("button"),ae(n.$$.fragment),o=ne(),u=j("button"),s=j("span"),p=ne(),g=j("button"),y=j("span"),C=ne(),ae(T.$$.fragment),ue(t,"class","outline icon-btn"),ue(t,"data-tippy-content","Global version"),t.disabled=i=r[0]=="global",ue(s,"class","fi fi-gb-sct"),ue(u,"class","outline icon-btn"),ue(u,"data-tippy-content","Scotland"),u.disabled=d=r[0]=="cnt",ue(y,"class","fi fi-gb-eng"),ue(g,"class","outline icon-btn"),ue(g,"data-tippy-content","England"),g.disabled=x=r[0]=="england",Xe(e,"display","flex"),Xe(e,"flex-direction","row"),Xe(e,"height","80%"),Xe(e,"gap","4px")},m(L,B){W(L,e,B),D(e,t),oe(n,t,null),D(e,o),D(e,u),D(u,s),D(e,p),D(e,g),D(g,y),D(e,C),oe(T,e,null),E=!0,z||(I=[St(t,"click",r[1]),St(u,"click",r[2]),St(g,"click",r[3])],z=!0)},p(L,[B]){(!E||B&1&&i!==(i=L[0]=="global"))&&(t.disabled=i),(!E||B&1&&d!==(d=L[0]=="cnt"))&&(u.disabled=d),(!E||B&1&&x!==(x=L[0]=="england"))&&(g.disabled=x);const O={};B&16&&(O.$$scope={dirty:B,ctx:L}),T.$set(O)},i(L){E||(N(n.$$.fragment,L),N(T.$$.fragment,L),E=!0)},o(L){V(n.$$.fragment,L),V(T.$$.fragment,L),E=!1},d(L){L&&G(e),se(n),se(T),z=!1,sr(I)}}}function YR(r,e,t){let n;return st(r,xo,s=>t(0,n=s)),ls(c_),[n,()=>window.location.href=".",()=>window.location.href="cnt.html",()=>window.location.href="england.html"]}class QR extends Tt{constructor(e){super(),Ct(this,e,YR,JR,wt,{})}}function eB(r){let e,t,n,i,o,u;return{c(){e=j("label"),t=j("strong"),t.textContent="Load a project from a file",n=ne(),i=j("input"),ue(i,"type","file"),Xe(e,"margin-top","16px")},m(s,d){W(s,e,d),D(e,t),D(e,n),D(e,i),r[2](i),o||(u=St(i,"change",r[1]),o=!0)},p:lt,i:lt,o:lt,d(s){s&&G(e),r[2](null),o=!1,u()}}}function tB(r,e,t){let n;st(r,Qn,s=>t(3,n=s));let i;async function o(s){let d=i.files[0].name,p=await i.files[0].text(),g=JSON.parse(p),y,x,C;g.app_focus&&(console.assert(g.app_focus=="global"||g.app_focus=="cnt"||g.app_focus=="england"),y=g.app_focus),g.study_area_name&&(x=g.study_area_name),g.project_name&&(C=g.project_name),(!g.app_focus||!g.project_name)&&(g.study_area_name&&g.study_area_name.startsWith("LAD_")?(y="cnt",C=n1(Qd(d,`ltn_cnt_${g.study_area_name}_`),".geojson")):(y="global",C=n1(Qd(d,"ltn_"),".geojson"))),C=C,y=y;let T=M2.projectStorage(y);C=T.nextAvailableProjectName(C),g.project_name=C,g.app_focus=y,g.study_area_name=x;let E=T.createProject(g);await bp(E),an(Qn,n={mode:"pick-neighbourhood"},n)}function u(s){_n[s?"unshift":"push"](()=>{i=s,t(0,i)})}return[i,o,u]}class nB extends Tt{constructor(e){super(),Ct(this,e,tB,eB,wt,{})}}function Wb(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function Zb(r,e,t){const n=r.slice();return n[25]=e[t].projectID,n[26]=e[t].projectName,n}function rB(r){let e,t,n,i,o=vr(r[2].mode)+"",u;return{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),u=Te(o),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(s,d){W(s,e,d),D(e,t),D(t,n),D(n,i),D(i,u)},p(s,d){d&4&&o!==(o=vr(s[2].mode)+"")&&xt(u,o)},d(s){s&&G(e)}}}function iB(r){let e;return{c(){e=j("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){W(t,e,n)},p:lt,i:lt,o:lt,d(t){t&&G(e)}}}function oB(r){let e,t,n,i,o,u,s,d,p,g,y;const x=[aB,sB],C=[];function T(B,O){return B[4]=="cnt"?0:1}e=T(r),t=C[e]=x[e](r);let E=r[1].length>0&&Xb(r);const z=[fB,cB,uB],I=[];function L(B,O){return B[4]=="global"?0:B[4]=="cnt"?1:B[4]=="england"?2:-1}return~(s=L(r))&&(d=I[s]=z[s](r)),g=new nB({}),{c(){t.c(),n=ne(),E&&E.c(),i=ne(),o=j("h2"),o.textContent="Start a new project",u=ne(),d&&d.c(),p=ne(),ae(g.$$.fragment)},m(B,O){C[e].m(B,O),W(B,n,O),E&&E.m(B,O),W(B,i,O),W(B,o,O),W(B,u,O),~s&&I[s].m(B,O),W(B,p,O),oe(g,B,O),y=!0},p(B,O){let Y=e;e=T(B),e!==Y&&(Xt(),V(C[Y],1,1,()=>{C[Y]=null}),Kt(),t=C[e],t||(t=C[e]=x[e](B),t.c()),N(t,1),t.m(n.parentNode,n)),B[1].length>0?E?(E.p(B,O),O&2&&N(E,1)):(E=Xb(B),E.c(),N(E,1),E.m(i.parentNode,i)):E&&(Xt(),V(E,1,1,()=>{E=null}),Kt());let q=s;s=L(B),s===q?~s&&I[s].p(B,O):(d&&(Xt(),V(I[q],1,1,()=>{I[q]=null}),Kt()),~s?(d=I[s],d?d.p(B,O):(d=I[s]=z[s](B),d.c()),N(d,1),d.m(p.parentNode,p)):d=null)},i(B){y||(N(t),N(E),N(d),N(g.$$.fragment,B),y=!0)},o(B){V(t),V(E),V(d),V(g.$$.fragment,B),y=!1},d(B){B&&(G(n),G(i),G(o),G(u),G(p)),C[e].d(B),E&&E.d(B),~s&&I[s].d(B),se(g,B)}}}function sB(r){let e,t,n,i,o;return i=new QR({}),{c(){e=j("div"),t=j("h1"),t.textContent="The LTN Tool",n=ne(),ae(i.$$.fragment),Xe(e,"display","flex"),Xe(e,"justify-content","space-between"),Xe(e,"align-items","center")},m(u,s){W(u,e,s),D(e,t),D(e,n),oe(i,e,null),o=!0},i(u){o||(N(i.$$.fragment,u),o=!0)},o(u){V(i.$$.fragment,u),o=!1},d(u){u&&G(e),se(i)}}}function aB(r){let e;return{c(){e=j("h1"),e.textContent="The Connected Neighbourhoods Tool"},m(t,n){W(t,e,n)},i:lt,o:lt,d(t){t&&G(e)}}}function Xb(r){let e,t,n,i,o=On(r[1]),u=[];for(let d=0;d<o.length;d+=1)u[d]=Jb(Wb(r,o,d));const s=d=>V(u[d],1,1,()=>{u[d]=null});return{c(){e=j("h2"),e.textContent="Your projects",t=ne(),n=j("div");for(let d=0;d<u.length;d+=1)u[d].c();ue(n,"class","project-list svelte-s5f8l2")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(d,p){if(p&898){o=On(d[1]);let g;for(g=0;g<o.length;g+=1){const y=Wb(d,o,g);u[g]?(u[g].p(y,p),N(u[g],1)):(u[g]=Jb(y),u[g].c(),N(u[g],1),u[g].m(n,null))}for(Xt(),g=o.length;g<u.length;g+=1)s(g);Kt()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)N(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)V(u[p]);i=!1},d(d){d&&(G(e),G(t),G(n)),di(u,d)}}}function lB(r){let e=r[26]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&2&&e!==(e=n[26]+"")&&xt(t,e)},d(n){n&&G(t)}}}function Kb(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z;function I(){return r[10](r[25])}n=new pp({props:{$$slots:{default:[lB]},$$scope:{ctx:r}}}),n.$on("click",I),s=new b2({props:{color:"black"}});function L(){return r[11](r[25])}g=new r_({props:{color:"black"}});function B(){return r[12](r[25],r[26])}C=new dp({props:{color:"white"}});function O(){return r[13](r[25],r[26])}return{c(){e=j("li"),t=j("h3"),ae(n.$$.fragment),i=ne(),o=j("span"),u=j("button"),ae(s.$$.fragment),d=ne(),p=j("button"),ae(g.$$.fragment),y=ne(),x=j("button"),ae(C.$$.fragment),ue(u,"class","outline icon-btn"),ue(u,"title","Download project as GeoJSON"),ue(p,"class","outline icon-btn"),ue(p,"title","Rename project"),ue(x,"class","icon-btn destructive"),ue(x,"title","Delete project"),ue(o,"class","actions"),ue(e,"class","actionable-cell svelte-s5f8l2")},m(Y,q){W(Y,e,q),D(e,t),oe(n,t,null),D(e,i),D(e,o),D(o,u),oe(s,u,null),D(o,d),D(o,p),oe(g,p,null),D(o,y),D(o,x),oe(C,x,null),T=!0,E||(z=[St(u,"click",L),St(p,"click",B),St(x,"click",O)],E=!0)},p(Y,q){r=Y;const H={};q&536870914&&(H.$$scope={dirty:q,ctx:r}),n.$set(H)},i(Y){T||(N(n.$$.fragment,Y),N(s.$$.fragment,Y),N(g.$$.fragment,Y),N(C.$$.fragment,Y),T=!0)},o(Y){V(n.$$.fragment,Y),V(s.$$.fragment,Y),V(g.$$.fragment,Y),V(C.$$.fragment,Y),T=!1},d(Y){Y&&G(e),se(n),se(s),se(g),se(C),E=!1,sr(z)}}}function Jb(r){let e,t=Yd(r[21])+"",n,i,o,u,s,d=On(r[22]),p=[];for(let y=0;y<d.length;y+=1)p[y]=Kb(Zb(r,d,y));const g=y=>V(p[y],1,1,()=>{p[y]=null});return{c(){e=j("h3"),n=Te(t),i=ne(),o=j("ul");for(let y=0;y<p.length;y+=1)p[y].c();u=ne(),ue(e,"class","study-area-name svelte-s5f8l2"),ue(o,"class","navigable-list")},m(y,x){W(y,e,x),D(e,n),W(y,i,x),W(y,o,x);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(o,null);D(o,u),s=!0},p(y,x){if((!s||x&2)&&t!==(t=Yd(y[21])+"")&&xt(n,t),x&898){d=On(y[22]);let C;for(C=0;C<d.length;C+=1){const T=Zb(y,d,C);p[C]?(p[C].p(T,x),N(p[C],1)):(p[C]=Kb(T),p[C].c(),N(p[C],1),p[C].m(o,u))}for(Xt(),C=d.length;C<p.length;C+=1)g(C);Kt()}},i(y){if(!s){for(let x=0;x<d.length;x+=1)N(p[x]);s=!0}},o(y){p=p.filter(Boolean);for(let x=0;x<p.length;x+=1)V(p[x]);s=!1},d(y){y&&(G(e),G(i),G(o)),di(p,y)}}}function uB(r){let e,t;return e=new fx({props:{boundariesUrl:qR}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function cB(r){let e,t;return e=new fx({props:{boundariesUrl:VR}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function fB(r){let e,t,n;return{c(){e=j("button"),e.textContent="New project"},m(i,o){W(i,e,o),t||(n=St(e,"click",r[14]),t=!0)},p:lt,i:lt,o:lt,d(i){i&&G(e),t=!1,n()}}}function hB(r){let e,t,n,i;const o=[oB,iB],u=[];function s(d,p){return d[3]&&d[0]?0:1}return t=s(r),n=u[t]=o[t](r),{c(){e=j("div"),n.c(),ue(e,"slot","sidebar")},m(d,p){W(d,e,p),u[t].m(e,null),i=!0},p(d,p){let g=t;t=s(d),t===g?u[t].p(d,p):(Xt(),V(u[g],1,1,()=>{u[g]=null}),Kt(),n=u[t],n?n.p(d,p):(n=u[t]=o[t](d),n.c()),N(n,1),n.m(e,null))},i(d){i||(N(n),i=!0)},o(d){V(n),i=!1},d(d){d&&G(e),u[t].d()}}}function dB(r){let e,t,n,i;return e=new oc({props:{loading:r[5],progress:r[6]}}),n=new Ao({props:{$$slots:{sidebar:[hB],top:[rB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,[u]){const s={};u&32&&(s.loading=o[5]),u&64&&(s.progress=o[6]),e.$set(s);const d={};u&536870943&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function pB(r,e,t){let n,i,o,u,s,d,p,g,y,x;st(r,Qn,Z=>t(2,n=Z)),st(r,Ha,Z=>t(15,i=Z)),st(r,as,Z=>t(3,o=Z)),st(r,xo,Z=>t(4,u=Z)),st(r,r1,Z=>t(16,s=Z)),st(r,Os,Z=>t(17,d=Z)),st(r,sp,Z=>t(18,p=Z)),st(r,kr,Z=>t(19,g=Z)),st(r,lc,Z=>t(5,y=Z)),st(r,uc,Z=>t(6,x=Z));let{wasmReady:C}=e;if(an(kr,g=null,g),an(sp,p=null,p),an(Os,d=void 0,d),s){let _e=new URLSearchParams(window.location.search).get("project");_e&&E(_e),an(r1,s=!1,s)}else{let Z=new URL(window.location.href);Z.searchParams.delete("project"),window.history.replaceState(null,"",Z.toString())}if(o&&!s){let Z=[-180,-90,180,90];u=="cnt"?Z=[-8.943,54.631,-.901,59.489]:u=="england"&&(Z=[-5.96,49.89,2.31,55.94]),o.fitBounds(Z,{duration:500})}let T=i.studyAreaProjects();function E(Z){let _e=Z;try{L(_e)}catch{console.error(`Error trying to fetch project from URL: ${_e}`)}}function z(Z,_e){window.confirm(`Really delete project ${_e}? You can't undo this.`)&&(i.removeProject(Z),t(1,T=i.studyAreaProjects()))}function I(Z,_e){let Ie=window.prompt(`Rename project ${_e} to what?`,_e);if(Ie){try{i.renameProject(Z,Ie)}catch(J){window.alert(`Couldn't rename project: ${J}`)}t(1,T=i.studyAreaProjects())}}async function L(Z){await bp(Z),an(Qn,n={mode:"pick-neighbourhood"},n)}const B=Z=>L(Z),O=Z=>C2(Z),Y=(Z,_e)=>I(Z,_e),q=(Z,_e)=>z(Z,_e),H=()=>an(Qn,n={mode:"new-project"},n);return r.$$set=Z=>{"wasmReady"in Z&&t(0,C=Z.wasmReady)},[C,T,n,o,u,y,x,z,I,L,B,O,Y,q,H]}class mB extends Tt{constructor(e){super(),Ct(this,e,pB,dB,wt,{wasmReady:0})}}function gB(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T=vr(r[1].mode)+"",E,z;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),y=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=j("div"),t=j("nav"),n=j("ul"),i=j("li"),ae(o.$$.fragment),u=ne(),s=j("li"),ae(d.$$.fragment),p=ne(),g=j("li"),ae(y.$$.fragment),x=ne(),C=j("li"),E=Te(T),ue(t,"aria-label","breadcrumb"),ue(e,"slot","top")},m(I,L){W(I,e,L),D(e,t),D(t,n),D(n,i),oe(o,i,null),D(n,u),D(n,s),oe(d,s,null),D(n,p),D(n,g),oe(y,g,null),D(n,x),D(n,C),D(C,E),z=!0},p(I,L){(!z||L&2)&&T!==(T=vr(I[1].mode)+"")&&xt(E,T)},i(I){z||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(y.$$.fragment,I),z=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(y.$$.fragment,I),z=!1},d(I){I&&G(e),se(o),se(d),se(y)}}}function _B(r){let e,t,n,i,o,u,s,d,p,g,y=_r(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",x,C,T,E,z,I;function L(O){r[4](O)}let B={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(B.idx=r[0].shortcutIndex),o=new mp({props:B}),_n.push(()=>Rn(o,"idx",L)),{c(){e=j("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ne(),n=j("button"),n.textContent="Pick a different road",i=ne(),ae(o.$$.fragment),s=ne(),d=j("p"),p=Te("This shortcut is "),g=j("b"),x=Te(y),C=Te("x"),T=Te(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(O,Y){W(O,e,Y),W(O,t,Y),W(O,n,Y),W(O,i,Y),oe(o,O,Y),W(O,s,Y),W(O,d,Y),D(d,p),D(d,g),D(g,x),D(g,C),D(d,T),E=!0,z||(I=St(n,"click",r[3]),z=!0)},p(O,Y){const q={};Y&1&&(q.list=O[0].gj.features),!u&&Y&1&&(u=!0,q.idx=O[0].shortcutIndex,Dn(()=>u=!1)),o.$set(q),(!E||Y&1)&&y!==(y=_r(O[0].gj.features[O[0].shortcutIndex].properties).directness.toFixed(1)+"")&&xt(x,y)},i(O){E||(N(o.$$.fragment,O),E=!0)},o(O){V(o.$$.fragment,O),E=!1},d(O){O&&(G(e),G(t),G(n),G(i),G(s),G(d)),se(o,O),z=!1,I()}}}function yB(r){let e;return{c(){e=j("p"),e.textContent="Click a road to see shortcuts"},m(t,n){W(t,e,n)},p:lt,i:lt,o:lt,d(t){t&&G(e)}}}function vB(r){let e,t,n,i,o,u;t=new Ns({props:{mode:{mode:"neighbourhood"}}});const s=[yB,_B],d=[];function p(g,y){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=s[i](r)),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),o&&o.c(),ue(e,"slot","sidebar")},m(g,y){W(g,e,y),oe(t,e,null),D(e,n),~i&&d[i].m(e,null),u=!0},p(g,y){let x=i;i=p(g),i===x?~i&&d[i].p(g,y):(o&&(Xt(),V(d[x],1,1,()=>{d[x]=null}),Kt()),~i?(o=d[i],o?o.p(g,y):(o=d[i]=s[i](g),o.c()),N(o,1),o.m(e,null)):o=null)},i(g){u||(N(t.$$.fragment,g),N(o),u=!0)},o(g){V(t.$$.fragment,g),V(o),u=!1},d(g){g&&G(e),se(t),~i&&d[i].d()}}}function bB(r){let e,t;return e=new hh({props:{interactive:!1}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function wB(r){let e,t;return e=new hh({props:{onClickLine:r[2],$$slots:{"line-popup":[SB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function xB(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=j("p"),t=Te("Main road: "),i=Te(n)},m(o,u){W(o,e,u),D(e,t),D(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&xt(i,n)},d(o){o&&G(e)}}}function AB(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=j("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o)},m(s,d){W(s,e,d),D(e,n),D(e,i),D(e,u)},p(s,d){d&64&&t!==(t=s[6].shortcuts+"")&&xt(n,t),d&64&&o!==(o=(s[6].name??"unnamed road")+"")&&xt(u,o)},d(s){s&&G(e)}}}function kB(r){let e;function t(o,u){if(o[6].kind=="interior_road")return AB;if(o[6].kind=="main_road")return xB}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i&&i.d(o)}}}function SB(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[kB,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"slot","line-popup")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function CB(r){let e,t,n,i,o,u,s,d,p,g;e=new yp({}),n=new _p({}),o=new vp({});const y=[wB,bB],x=[];function C(T,E){return T[0].state=="neutral"?0:T[0].state=="chose-road"?1:-1}return~(s=C(r))&&(d=x[s]=y[s](r)),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),d&&d.c(),p=rr()},m(T,E){oe(e,T,E),W(T,t,E),oe(n,T,E),W(T,i,E),oe(o,T,E),W(T,u,E),~s&&x[s].m(T,E),W(T,p,E),g=!0},p(T,E){let z=s;s=C(T),s===z?~s&&x[s].p(T,E):(d&&(Xt(),V(x[z],1,1,()=>{x[z]=null}),Kt()),~s?(d=x[s],d?d.p(T,E):(d=x[s]=y[s](T),d.c()),N(d,1),d.m(p.parentNode,p)):d=null)},i(T){g||(N(e.$$.fragment,T),N(n.$$.fragment,T),N(o.$$.fragment,T),N(d),g=!0)},o(T){V(e.$$.fragment,T),V(n.$$.fragment,T),V(o.$$.fragment,T),V(d),g=!1},d(T){T&&(G(t),G(i),G(u),G(p)),se(e,T),se(n,T),se(o,T),~s&&x[s].d(T)}}}function Yb(r){let e,t,n,i,o,u,s,d;return e=new yr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[TB]},$$scope:{ctx:r}}}),n=new yr({props:{data:r[0].roadGj,$$slots:{default:[MB]},$$scope:{ctx:r}}}),o=new Dl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[EB]},$$scope:{ctx:r}}}),s=new Dl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[LB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment),i=ne(),ae(o.$$.fragment),u=ne(),ae(s.$$.fragment)},m(p,g){oe(e,p,g),W(p,t,g),oe(n,p,g),W(p,i,g),oe(o,p,g),W(p,u,g),oe(s,p,g),d=!0},p(p,g){const y={};g&1&&(y.data=p[0].gj.features[p[0].shortcutIndex]),g&128&&(y.$$scope={dirty:g,ctx:p}),e.$set(y);const x={};g&1&&(x.data=p[0].roadGj),g&128&&(x.$$scope={dirty:g,ctx:p}),n.$set(x);const C={};g&1&&(C.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&128&&(C.$$scope={dirty:g,ctx:p}),o.$set(C);const T={};g&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&128&&(T.$$scope={dirty:g,ctx:p}),s.$set(T)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(G(t),G(i),G(u)),se(e,p),se(n,p),se(o,p),se(s,p)}}}function TB(r){let e,t;const n=[yn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function MB(r){let e,t;const n=[yn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new hr({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function EB(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function LB(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function IB(r){let e,t,n,i,o,u;t=new dh({props:{$$slots:{default:[CB]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Yb(r);return o=new Ka({props:{interactive:!1}}),{c(){e=j("div"),ae(t.$$.fragment),n=ne(),s&&s.c(),i=ne(),ae(o.$$.fragment),ue(e,"slot","map")},m(d,p){W(d,e,p),oe(t,e,null),D(e,n),s&&s.m(e,null),D(e,i),oe(o,e,null),u=!0},p(d,p){const g={};p&129&&(g.$$scope={dirty:p,ctx:d}),t.$set(g),d[0].state=="chose-road"?s?(s.p(d,p),p&1&&N(s,1)):(s=Yb(d),s.c(),N(s,1),s.m(e,i)):s&&(Xt(),V(s,1,1,()=>{s=null}),Kt())},i(d){u||(N(t.$$.fragment,d),N(s),N(o.$$.fragment,d),u=!0)},o(d){V(t.$$.fragment,d),V(s),V(o.$$.fragment,d),u=!1},d(d){d&&G(e),se(t),s&&s.d(),se(o)}}}function PB(r){let e,t;return e=new Ao({props:{$$slots:{map:[IB],sidebar:[vB],top:[gB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function zB(r,e,t){let n,i;st(r,kr,p=>t(5,n=p)),st(r,Qn,p=>t(1,i=p));let o={state:"neutral"};function u(p,g){let y=n.getShortcutsCrossingRoad(p.properties.id);if(y.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:p,gj:y,shortcutIndex:0})}const s=()=>t(0,o={state:"neutral"});function d(p){r.$$.not_equal(o.shortcutIndex,p)&&(o.shortcutIndex=p,t(0,o))}return[o,i,u,s,d]}class DB extends Tt{constructor(e){super(),Ct(this,e,zB,PB,wt,{})}}function RB(r){let e,t,n,i,o,u;return{c(){e=j("div"),t=j("button"),t.innerHTML=`<img src="${vk}" style="height: 32px;" alt="A/B Street logo"/>`,n=ne(),i=j("span"),ue(t,"class","outline"),Xe(i,"width","100%"),ue(e,"slot","top"),ue(e,"class","pico"),Xe(e,"display","flex"),Xe(e,"align-items","center"),Xe(e,"gap","8px")},m(s,d){W(s,e,d),D(e,t),D(e,n),D(e,i),r[24](i),o||(u=St(t,"click",r[23]),o=!0)},p:lt,d(s){s&&G(e),r[24](null),o=!1,u()}}}function BB(r){let e,t;return{c(){e=j("div"),t=j("div"),ue(e,"class","pico"),ue(e,"slot","left")},m(n,i){W(n,e,i),D(e,t),r[22](t)},p:lt,d(n){n&&G(e),r[22](null)}}}function Qb(r){let e,t,n;function i(u){r[20](u)}let o={style:r[7],hash:!0,bounds:r[6],maxZoom:19,images:[{id:Ri.walkCycleOnly.filterType,url:Ri.walkCycleOnly.iconURL},{id:Ri.noEntry.filterType,url:Ri.noEntry.iconURL},{id:Ri.busGate.filterType,url:Ri.busGate.iconURL},{id:Ri.schoolStreet.filterType,url:Ri.schoolStreet.iconURL},{id:"diagonal_filter",url:yk},{id:"no_straight_turn",url:cw},{id:"no_left_turn",url:uw},{id:"no_right_turn",url:Dg},{id:"no_u_left_to_right_turn",url:hw},{id:"no_u_right_to_left_turn",url:fw},{id:"oneway_arrow",url:gk},{id:"border_entry_arrow",url:mk,options:{sdf:!0}},{id:"national_rail",url:dw}],$$slots:{default:[rF]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new n5({props:o}),_n.push(()=>Rn(e,"map",i)),e.$on("error",r[21]),{c(){ae(e.$$.fragment)},m(u,s){oe(e,u,s),n=!0},p(u,s){const d={};s&128&&(d.style=u[7]),s&64&&(d.bounds=u[6]),s&268438329&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.map=u[0],Dn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){se(e,u)}}}function ew(r){let e,t,n,i;return e=new Qm({props:{position:"top-left",$$slots:{default:[$B]},$$scope:{ctx:r}}}),n=new Qm({props:{position:"top-left",$$slots:{default:[jB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment),t=ne(),ae(n.$$.fragment)},m(o,u){oe(e,o,u),W(o,t,u),oe(n,o,u),i=!0},p(o,u){const s={};u&268435456&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&268435984&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),se(e,o),se(n,o)}}}function FB(r){let e,t,n;return t=new iT({}),{c(){e=j("div"),ae(t.$$.fragment),ue(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){W(i,e,o),oe(t,e,null),n=!0},p:lt,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),se(t)}}}function OB(r){let e,t;return e=new e2({props:{title:"Zoom to fit study area",$$slots:{default:[FB]},$$scope:{ctx:r}}}),e.$on("click",r[18]),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function $B(r){let e,t;return e=new t2({props:{$$slots:{default:[OB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function NB(r){let e,t;return e=new iM({props:{map:_r(r[9]),maptilerBasemap:r[4]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&512&&(o.map=_r(n[9])),i&16&&(o.maptilerBasemap=n[4]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function jB(r){let e,t;return e=new t2({props:{$$slots:{default:[NB]},$$scope:{ctx:r}}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&268435984&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function UB(r){let e,t;return e=new UR({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function VB(r){let e,t;return e=new mB({props:{wasmReady:r[5]}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&32&&(o.wasmReady=n[5]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function tw(r){let e,t,n,i,o,u;e=new yr({props:{data:r[8].getInvertedBoundary(),$$slots:{default:[qB]},$$scope:{ctx:r}}});const s=[nF,tF,eF,QB,YB,JB,KB,XB,ZB,WB,GB,HB],d=[];function p(g,y){return g[11].mode=="pick-neighbourhood"?0:g[11].mode=="set-boundary"?1:g[11].mode=="add-neighbourhood"?2:g[11].mode=="neighbourhood"?3:g[11].mode=="view-shortcuts"?4:g[11].mode=="impact-one-destination"?5:g[11].mode=="route"?6:g[11].mode=="predict-impact"?7:g[11].mode=="impact-detail"?8:g[11].mode=="debug-neighbourhood"?9:g[11].mode=="debug-intersections"?10:g[11].mode=="debug-demand"?11:-1}return~(n=p(r))&&(i=d[n]=s[n](r)),{c(){ae(e.$$.fragment),t=ne(),i&&i.c(),o=rr()},m(g,y){oe(e,g,y),W(g,t,y),~n&&d[n].m(g,y),W(g,o,y),u=!0},p(g,y){const x={};y&256&&(x.data=g[8].getInvertedBoundary()),y&268435456&&(x.$$scope={dirty:y,ctx:g}),e.$set(x);let C=n;n=p(g),n===C?~n&&d[n].p(g,y):(i&&(Xt(),V(d[C],1,1,()=>{d[C]=null}),Kt()),~n?(i=d[n],i?i.p(g,y):(i=d[n]=s[n](g),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(g){u||(N(e.$$.fragment,g),N(i),u=!0)},o(g){V(e.$$.fragment,g),V(i),u=!1},d(g){g&&(G(t),G(o)),se(e,g),~n&&d[n].d(g)}}}function qB(r){let e,t;const n=[yn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Mt(i,n[o]);return e=new Ki({props:i}),{c(){ae(e.$$.fragment)},m(o,u){oe(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){se(e,o)}}}function HB(r){let e,t;return e=new rP({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function GB(r){let e,t;return e=new fP({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function WB(r){let e,t;return e=new nz({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function ZB(r){let e,t;return e=new E7({props:{road:r[11].road,prevPrevMode:r[11].prevPrevMode}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.road=n[11].road),i&2048&&(o.prevPrevMode=n[11].prevPrevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function XB(r){let e,t;return e=new CD({props:{prevMode:r[11].prevMode}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.prevMode=n[11].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function KB(r){let e,t;return e=new ND({props:{prevMode:r[11].prevMode}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.prevMode=n[11].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function JB(r){let e,t;return e=new W7({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function YB(r){let e,t;return e=new DB({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function QB(r){let e,t;return e=new b7({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function eF(r){let e,t;return e=new N8({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function tF(r){let e,t;return e=new HD({props:{name:r[11].name,existing:r[11].existing}}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.name=n[11].name),i&2048&&(o.existing=n[11].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function nF(r){let e,t;return e=new uD({}),{c(){ae(e.$$.fragment)},m(n,i){oe(e,n,i),t=!0},p:lt,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){se(e,n)}}}function rF(r){let e,t,n,i,o,u,s,d,p,g,y,x,C,T,E,z,I;e=new i2({props:{showCompass:!1}});let L=r[8]&&ew(r);i=new YL({props:{map:r[0],apiKey:T2,country:void 0}}),u=new o2({});const B=[VB,UB],O=[];function Y(H,Z){return H[11].mode=="title"?0:H[11].mode=="new-project"?1:-1}~(g=Y(r))&&(y=O[g]=B[g](r)),C=new w6({});let q=r[8]&&tw(r);return z=new iC({}),{c(){ae(e.$$.fragment),t=ne(),L&&L.c(),n=ne(),ae(i.$$.fragment),o=ne(),ae(u.$$.fragment),s=ne(),d=j("div"),p=ne(),y&&y.c(),x=ne(),ae(C.$$.fragment),T=ne(),q&&q.c(),E=ne(),ae(z.$$.fragment)},m(H,Z){oe(e,H,Z),W(H,t,Z),L&&L.m(H,Z),W(H,n,Z),oe(i,H,Z),W(H,o,Z),oe(u,H,Z),W(H,s,Z),W(H,d,Z),r[19](d),W(H,p,Z),~g&&O[g].m(H,Z),W(H,x,Z),oe(C,H,Z),W(H,T,Z),q&&q.m(H,Z),W(H,E,Z),oe(z,H,Z),I=!0},p(H,Z){H[8]?L?(L.p(H,Z),Z&256&&N(L,1)):(L=ew(H),L.c(),N(L,1),L.m(n.parentNode,n)):L&&(Xt(),V(L,1,1,()=>{L=null}),Kt());const _e={};Z&1&&(_e.map=H[0]),i.$set(_e);let Ie=g;g=Y(H),g===Ie?~g&&O[g].p(H,Z):(y&&(Xt(),V(O[Ie],1,1,()=>{O[Ie]=null}),Kt()),~g?(y=O[g],y?y.p(H,Z):(y=O[g]=B[g](H),y.c()),N(y,1),y.m(x.parentNode,x)):y=null),H[8]?q?(q.p(H,Z),Z&256&&N(q,1)):(q=tw(H),q.c(),N(q,1),q.m(E.parentNode,E)):q&&(Xt(),V(q,1,1,()=>{q=null}),Kt())},i(H){I||(N(e.$$.fragment,H),N(L),N(i.$$.fragment,H),N(u.$$.fragment,H),N(y),N(C.$$.fragment,H),N(q),N(z.$$.fragment,H),I=!0)},o(H){V(e.$$.fragment,H),V(L),V(i.$$.fragment,H),V(u.$$.fragment,H),V(y),V(C.$$.fragment,H),V(q),V(z.$$.fragment,H),I=!1},d(H){H&&(G(t),G(n),G(o),G(s),G(d),G(p),G(x),G(T),G(E)),se(e,H),L&&L.d(H),se(i,H),se(u,H),r[19](null),~g&&O[g].d(H),se(C,H),q&&q.d(H),se(z,H)}}}function iF(r){let e,t,n=r[7]&&Qb(r);return{c(){e=j("div"),n&&n.c(),ue(e,"slot","main"),Xe(e,"position","relative"),Xe(e,"width","100%"),Xe(e,"height","100%")},m(i,o){W(i,e,o),n&&n.m(e,null),t=!0},p(i,o){i[7]?n?(n.p(i,o),o&128&&N(n,1)):(n=Qb(i),n.c(),N(n,1),n.m(e,null)):n&&(Xt(),V(n,1,1,()=>{n=null}),Kt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d()}}}function oF(r){let e,t,n,i,o,u,s,d,p;return i=new dM({}),s=new B6({props:{$$slots:{main:[iF],left:[BB],top:[RB]},$$scope:{ctx:r}}}),{c(){e=j("link"),t=ne(),n=j("div"),ae(i.$$.fragment),o=ne(),u=j("div"),ae(s.$$.fragment),ue(e,"rel","icon"),ue(e,"type","image/x-icon"),ue(e,"href",_k),ue(n,"class","pico"),ue(u,"class",d="app-focus-"+r[10])},m(g,y){D(document.head,e),W(g,t,y),W(g,n,y),oe(i,n,null),W(g,o,y),W(g,u,y),oe(s,u,null),p=!0},p(g,[y]){const x={};y&268442623&&(x.$$scope={dirty:y,ctx:g}),s.$set(x),(!p||y&1024&&d!==(d="app-focus-"+g[10]))&&ue(u,"class",d)},i(g){p||(N(i.$$.fragment,g),N(s.$$.fragment,g),p=!0)},o(g){V(i.$$.fragment,g),V(s.$$.fragment,g),p=!1},d(g){g&&(G(t),G(n),G(o),G(u)),G(e),se(i),se(s)}}}function sF(r,e,t){let n,i,o,u,s,d,p,g,y,x,C;st(r,og,Oe=>t(4,n=Oe)),st(r,Cg,Oe=>t(15,i=Oe)),st(r,Sg,Oe=>t(16,o=Oe)),st(r,kg,Oe=>t(17,u=Oe)),st(r,kr,Oe=>t(8,s=Oe)),st(r,as,Oe=>t(9,d=Oe)),st(r,Of,Oe=>t(25,p=Oe)),st(r,cg,Oe=>t(26,g=Oe)),st(r,xo,Oe=>t(10,y=Oe)),st(r,Qn,Oe=>t(11,x=Oe)),st(r,ep,Oe=>t(12,C=Oe));let{appFocus:T}=e;xo.set(T);let E=!1;ls(async()=>{await W2(),await vw(),t(5,E=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(an(cg,g=!0,g),console.log("Using local asset files"))}catch{}let Oe=new URLSearchParams(window.location.search).get("dev");Oe==="true"||Oe===""?an(Of,p=!0,p):(console.assert(Oe===null||Oe=="false",`unknown dev mode value: ${Oe}, should be "true", "false", or empty`),an(Of,p=!1,p))});let z=null;function I(Oe){d.fitBounds(s.getBounds(),{animate:Oe})}let L,B,O,Y;T=="cnt"&&(Y=[-8.943,54.631,-.901,59.489]);let q=null;async function H(Oe){Oe=="streets-v2"?t(7,q=U6):t(7,q=`https://api.maptiler.com/maps/${Oe}/style.json?key=${T2}`)}const Z=()=>I(!0);function _e(Oe){_n[Oe?"unshift":"push"](()=>{O=Oe,t(3,O),t(15,i)})}function Ie(Oe){z=Oe,t(0,z)}const J=Oe=>{console.log(Oe.detail.error)};function fe(Oe){_n[Oe?"unshift":"push"](()=>{B=Oe,t(2,B),t(16,o)})}const Ee=()=>an(ep,C=!0,C);function ye(Oe){_n[Oe?"unshift":"push"](()=>{L=Oe,t(1,L),t(17,u)})}return r.$$set=Oe=>{"appFocus"in Oe&&t(14,T=Oe.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&z&&(z.keyboard.disableRotation(),z.dragRotate.disable(),z.touchZoomRotate.disableRotation(),as.set(z)),r.$$.dirty&131074&&L&&u&&(t(1,L.innerHTML="",L),L.appendChild(u)),r.$$.dirty&65540&&B&&o&&(t(2,B.innerHTML="",B),B.appendChild(o)),r.$$.dirty&32776&&O&&i&&(t(3,O.innerHTML="",O),O.appendChild(i)),r.$$.dirty&16&&H(n)},[z,L,B,O,n,E,Y,q,s,d,y,x,C,I,T,i,o,u,Z,_e,Ie,J,fe,Ee,ye]}class mF extends Tt{constructor(e){super(),Ct(this,e,sF,oF,wt,{appFocus:14})}}export{mF as A};
