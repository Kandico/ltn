var NS=Object.defineProperty;var RS=(e,t,n)=>t in e?NS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Un=(e,t,n)=>(RS(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();function Ae(){}function yr(e,t){for(const n in t)e[n]=t[n];return e}function Xb(e){return e()}function jv(){return Object.create(null)}function ro(e){e.forEach(Xb)}function bg(e){return typeof e=="function"}function Ye(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}let Pm;function jn(e,t){return e===t?!0:(Pm||(Pm=document.createElement("a")),Pm.href=t,e===Pm.href)}function zS(e){return Object.keys(e).length===0}function Yb(e,...t){if(e==null){for(const i of t)i(void 0);return Ae}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Ta(e){let t;return Yb(e,n=>t=n)(),t}function we(e,t,n){e.$$.on_destroy.push(Yb(t,n))}function ir(e,t,n,i){if(e){const r=Kb(e,t,n,i);return e[0](r)}}function Kb(e,t,n,i){return e[1]&&i?yr(n.ctx.slice(),e[1](i(t))):n.ctx}function rr(e,t,n,i){if(e[2]&&i){const r=e[2](i(n));if(t.dirty===void 0)return r;if(typeof r=="object"){const a=[],h=Math.max(t.dirty.length,r.length);for(let u=0;u<h;u+=1)a[u]=t.dirty[u]|r[u];return a}return t.dirty|r}return t.dirty}function or(e,t,n,i,r,a){if(r){const h=Kb(t,n,i,a);e.p(h,r)}}function sr(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let i=0;i<n;i++)t[i]=-1;return t}return-1}function OS(e){const t={};for(const n in e)t[n]=!0;return t}function $m(e){return e??""}function Xe(e,t,n){return e.set(n),t}function ry(e){return e&&bg(e.destroy)?e.destroy:Ae}const FS=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ct(e,t){e.appendChild(t)}function xt(e,t,n){e.insertBefore(t,n||null)}function vt(e){e.parentNode&&e.parentNode.removeChild(e)}function ff(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function gt(e){return document.createElement(e)}function Ul(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function de(e){return document.createTextNode(e)}function Xt(){return de(" ")}function Oo(){return de("")}function Ge(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function BS(e){return function(t){return t.preventDefault(),e.call(this,t)}}function Mt(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function VS(e){return Array.from(e.childNodes)}function yi(e,t){t=""+t,e.data!==t&&(e.data=t)}function La(e,t){e.value=t??""}function si(e,t,n,i){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function Xm(e,t,n){for(let i=0;i<e.options.length;i+=1){const r=e.options[i];if(r.__value===t){r.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function Jb(e){const t=e.querySelector(":checked");return t&&t.__value}function rl(e,t,n){e.classList.toggle(t,!!n)}function US(e,t,{bubbles:n=!1,cancelable:i=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:i})}let Zp;function Bp(e){Zp=e}function pd(){if(!Zp)throw new Error("Function called outside component initialization");return Zp}function xg(e){pd().$$.on_mount.push(e)}function na(e){pd().$$.on_destroy.push(e)}function Ac(){const e=pd();return(t,n,{cancelable:i=!1}={})=>{const r=e.$$.callbacks[t];if(r){const a=US(t,n,{cancelable:i});return r.slice().forEach(h=>{h.call(e,a)}),!a.defaultPrevented}return!0}}function Qb(e,t){return pd().$$.context.set(e,t),t}function GS(e){return pd().$$.context.get(e)}function ii(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(i=>i.call(this,t))}const zh=[],Or=[];let Vh=[];const oy=[],tx=Promise.resolve();let sy=!1;function ex(){sy||(sy=!0,tx.then(nx))}function jS(){return ex(),tx}function Wp(e){Vh.push(e)}function gc(e){oy.push(e)}const $_=new Set;let Ah=0;function nx(){if(Ah!==0)return;const e=Zp;do{try{for(;Ah<zh.length;){const t=zh[Ah];Ah++,Bp(t),qS(t.$$)}}catch(t){throw zh.length=0,Ah=0,t}for(Bp(null),zh.length=0,Ah=0;Or.length;)Or.pop()();for(let t=0;t<Vh.length;t+=1){const n=Vh[t];$_.has(n)||($_.add(n),n())}Vh.length=0}while(zh.length);for(;oy.length;)oy.pop()();sy=!1,$_.clear(),Bp(e)}function qS(e){if(e.fragment!==null){e.update(),ro(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Wp)}}function ZS(e){const t=[],n=[];Vh.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),Vh=t}const Gm=new Set;let mc;function ti(){mc={r:0,c:[],p:mc}}function ei(){mc.r||ro(mc.c),mc=mc.p}function pt(e,t){e&&e.i&&(Gm.delete(e),e.i(t))}function yt(e,t,n,i){if(e&&e.o){if(Gm.has(e))return;Gm.add(e),mc.c.push(()=>{Gm.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}function ps(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function WS(e,t){yt(e,1,1,()=>{t.delete(e.key)})}function HS(e,t,n,i,r,a,h,u,_,w,S,E){let M=e.length,k=a.length,D=M;const F={};for(;D--;)F[e[D].key]=D;const q=[],X=new Map,B=new Map,U=[];for(D=k;D--;){const ut=E(r,a,D),St=n(ut);let lt=h.get(St);lt?i&&U.push(()=>lt.p(ut,t)):(lt=w(St,ut),lt.c()),X.set(St,q[D]=lt),St in F&&B.set(St,Math.abs(D-F[St]))}const W=new Set,Q=new Set;function ht(ut){pt(ut,1),ut.m(u,S),h.set(ut.key,ut),S=ut.first,k--}for(;M&&k;){const ut=q[k-1],St=e[M-1],lt=ut.key,zt=St.key;ut===St?(S=ut.first,M--,k--):X.has(zt)?!h.has(lt)||W.has(lt)?ht(ut):Q.has(zt)?M--:B.get(lt)>B.get(zt)?(Q.add(lt),ht(ut)):(W.add(zt),M--):(_(St,h),M--)}for(;M--;){const ut=e[M];X.has(ut.key)||_(ut,h)}for(;k;)ht(q[k-1]);return ro(U),q}function ix(e,t){const n={},i={},r={$$scope:1};let a=e.length;for(;a--;){const h=e[a],u=t[a];if(u){for(const _ in h)_ in u||(i[_]=1);for(const _ in u)r[_]||(n[_]=u[_],r[_]=1);e[a]=u}else for(const _ in h)r[_]=1}for(const h in i)h in n||(n[h]=void 0);return n}function _c(e,t,n){const i=e.$$.props[t];i!==void 0&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function Wt(e){e&&e.c()}function jt(e,t,n){const{fragment:i,after_update:r}=e.$$;i&&i.m(t,n),Wp(()=>{const a=e.$$.on_mount.map(Xb).filter(bg);e.$$.on_destroy?e.$$.on_destroy.push(...a):ro(a),e.$$.on_mount=[]}),r.forEach(Wp)}function qt(e,t){const n=e.$$;n.fragment!==null&&(ZS(n.after_update),ro(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function $S(e,t){e.$$.dirty[0]===-1&&(zh.push(e),ex(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function en(e,t,n,i,r,a,h=null,u=[-1]){const _=Zp;Bp(e);const w=e.$$={fragment:null,ctx:[],props:a,update:Ae,not_equal:r,bound:jv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:jv(),dirty:u,skip_bound:!1,root:t.target||_.$$.root};h&&h(w.root);let S=!1;if(w.ctx=n?n(e,t.props||{},(E,M,...k)=>{const D=k.length?k[0]:M;return w.ctx&&r(w.ctx[E],w.ctx[E]=D)&&(!w.skip_bound&&w.bound[E]&&w.bound[E](D),S&&$S(e,E)),M}):[],w.update(),S=!0,ro(w.before_update),w.fragment=i?i(w.ctx):!1,t.target){if(t.hydrate){const E=VS(t.target);w.fragment&&w.fragment.l(E),E.forEach(vt)}else w.fragment&&w.fragment.c();t.intro&&pt(e.$$.fragment),jt(e,t.target,t.anchor),nx()}Bp(_)}class nn{constructor(){Un(this,"$$");Un(this,"$$set")}$destroy(){qt(this,1),this.$destroy=Ae}$on(t,n){if(!bg(n))return Ae;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!zS(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const XS="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(XS);let ce;const Ol=new Array(128).fill(void 0);Ol.push(void 0,null,!0,!1);function pn(e){return Ol[e]}let Wo=0,Mp=null;function Uh(){return(Mp===null||Mp.byteLength===0)&&(Mp=new Uint8Array(ce.memory.buffer)),Mp}const jm=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},YS=typeof jm.encodeInto=="function"?function(e,t){return jm.encodeInto(e,t)}:function(e,t){const n=jm.encode(e);return t.set(n),{read:e.length,written:n.length}};function Ea(e,t,n){if(n===void 0){const u=jm.encode(e),_=t(u.length,1)>>>0;return Uh().subarray(_,_+u.length).set(u),Wo=u.length,_}let i=e.length,r=t(i,1)>>>0;const a=Uh();let h=0;for(;h<i;h++){const u=e.charCodeAt(h);if(u>127)break;a[r+h]=u}if(h!==i){h!==0&&(e=e.slice(h)),r=n(r,i,i=h+e.length*3,1)>>>0;const u=Uh().subarray(r+h,r+i),_=YS(e,u);h+=_.written}return Wo=h,r}function Oh(e){return e==null}let Pp=null;function Je(){return(Pp===null||Pp.byteLength===0)&&(Pp=new Int32Array(ce.memory.buffer)),Pp}let Vp=Ol.length;function KS(e){e<132||(Ol[e]=Vp,Vp=e)}function ls(e){const t=pn(e);return KS(e),t}const rx=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&rx.decode();function Ys(e,t){return e=e>>>0,rx.decode(Uh().subarray(e,e+t))}function oi(e){Vp===Ol.length&&Ol.push(Ol.length+1);const t=Vp;return Vp=Ol[t],Ol[t]=e,t}let kp=null;function ox(){return(kp===null||kp.byteLength===0)&&(kp=new Float64Array(ce.memory.buffer)),kp}let Ap=null;function JS(){return(Ap===null||Ap.byteLength===0)&&(Ap=new BigInt64Array(ce.memory.buffer)),Ap}function ay(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){const r=e.length;let a="[";r>0&&(a+=ay(e[0]));for(let h=1;h<r;h++)a+=", "+ay(e[h]);return a+="]",a}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(n.length>1)i=n[1];else return toString.call(e);if(i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}function QS(e,t){const n=t(e.length*1,1)>>>0;return Uh().set(e,n/1),Wo=e.length,n}function tI(e,t){return e=e>>>0,ox().subarray(e/8,e/8+t)}function eI(e,t){return e=e>>>0,Uh().subarray(e/1,e/1+t)}function dc(e,t){try{return e.apply(this,t)}catch(n){ce.__wbindgen_exn_store(oi(n))}}class sx{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();ce.__wbg_ltn_free(t)}constructor(t,n){try{const _=ce.__wbindgen_add_to_stack_pointer(-16),w=QS(t,ce.__wbindgen_malloc),S=Wo;var i=Oh(n)?0:Ea(n,ce.__wbindgen_malloc,ce.__wbindgen_realloc),r=Wo;ce.ltn_new(_,w,S,i,r);var a=Je()[_/4+0],h=Je()[_/4+1],u=Je()[_/4+2];if(u)throw ls(h);return this.__wbg_ptr=a>>>0,this}finally{ce.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let t,n;try{const w=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_getInvertedBoundary(w,this.__wbg_ptr);var i=Je()[w/4+0],r=Je()[w/4+1],a=Je()[w/4+2],h=Je()[w/4+3],u=i,_=r;if(h)throw u=0,_=0,ls(a);return t=u,n=_,Ys(u,_)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(t,n,1)}}getBounds(){try{const r=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_getBounds(r,this.__wbg_ptr);var t=Je()[r/4+0],n=Je()[r/4+1],i=tI(t,n).slice();return ce.__wbindgen_free(t,n*8,8),i}finally{ce.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const r=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_toRouteSnapper(r,this.__wbg_ptr);var t=Je()[r/4+0],n=Je()[r/4+1],i=eI(t,n).slice();return ce.__wbindgen_free(t,n*1,1),i}finally{ce.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let t,n;try{const w=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_toRouteSnapperGj(w,this.__wbg_ptr);var i=Je()[w/4+0],r=Je()[w/4+1],a=Je()[w/4+2],h=Je()[w/4+3],u=i,_=r;if(h)throw u=0,_=0,ls(a);return t=u,n=_,Ys(u,_)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(t,n,1)}}renderModalFilters(){let t,n;try{const w=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_renderModalFilters(w,this.__wbg_ptr);var i=Je()[w/4+0],r=Je()[w/4+1],a=Je()[w/4+2],h=Je()[w/4+3],u=i,_=r;if(h)throw u=0,_=0,ls(a);return t=u,n=_,Ys(u,_)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(t,n,1)}}renderNeighbourhood(){let t,n;try{const w=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_renderNeighbourhood(w,this.__wbg_ptr);var i=Je()[w/4+0],r=Je()[w/4+1],a=Je()[w/4+2],h=Je()[w/4+3],u=i,_=r;if(h)throw u=0,_=0,ls(a);return t=u,n=_,Ys(u,_)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(t,n){try{const a=ce.__wbindgen_add_to_stack_pointer(-16),h=Ea(t,ce.__wbindgen_malloc,ce.__wbindgen_realloc),u=Wo;ce.ltn_setNeighbourhoodBoundary(a,this.__wbg_ptr,h,u,oi(n));var i=Je()[a/4+0],r=Je()[a/4+1];if(r)throw ls(i)}finally{ce.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(t){const n=Ea(t,ce.__wbindgen_malloc,ce.__wbindgen_realloc),i=Wo;ce.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,i)}renameNeighbourhoodBoundary(t,n){const i=Ea(t,ce.__wbindgen_malloc,ce.__wbindgen_realloc),r=Wo,a=Ea(n,ce.__wbindgen_malloc,ce.__wbindgen_realloc),h=Wo;ce.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,i,r,a,h)}setCurrentNeighbourhood(t){try{const r=ce.__wbindgen_add_to_stack_pointer(-16),a=Ea(t,ce.__wbindgen_malloc,ce.__wbindgen_realloc),h=Wo;ce.ltn_setCurrentNeighbourhood(r,this.__wbg_ptr,a,h);var n=Je()[r/4+0],i=Je()[r/4+1];if(i)throw ls(n)}finally{ce.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(t,n){try{const a=ce.__wbindgen_add_to_stack_pointer(-16),h=Ea(n,ce.__wbindgen_malloc,ce.__wbindgen_realloc),u=Wo;ce.ltn_addModalFilter(a,this.__wbg_ptr,oi(t),h,u);var i=Je()[a/4+0],r=Je()[a/4+1];if(r)throw ls(i)}finally{ce.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(t,n){try{const a=ce.__wbindgen_add_to_stack_pointer(-16),h=Ea(n,ce.__wbindgen_malloc,ce.__wbindgen_realloc),u=Wo;ce.ltn_addManyModalFilters(a,this.__wbg_ptr,oi(t),h,u);var i=Je()[a/4+0],r=Je()[a/4+1];if(r)throw ls(i)}finally{ce.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(t){ce.ltn_deleteModalFilter(this.__wbg_ptr,t)}toggleDirection(t){ce.ltn_toggleDirection(this.__wbg_ptr,t)}undo(){ce.ltn_undo(this.__wbg_ptr)}redo(){ce.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(t){let n,i;try{const S=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_getShortcutsCrossingRoad(S,this.__wbg_ptr,t);var r=Je()[S/4+0],a=Je()[S/4+1],h=Je()[S/4+2],u=Je()[S/4+3],_=r,w=a;if(u)throw _=0,w=0,ls(h);return n=_,i=w,Ys(_,w)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(n,i,1)}}toSavefile(){let t,n;try{const w=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_toSavefile(w,this.__wbg_ptr);var i=Je()[w/4+0],r=Je()[w/4+1],a=Je()[w/4+2],h=Je()[w/4+3],u=i,_=r;if(h)throw u=0,_=0,ls(a);return t=u,n=_,Ys(u,_)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(t,n,1)}}loadSavefile(t){try{const r=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_loadSavefile(r,this.__wbg_ptr,oi(t));var n=Je()[r/4+0],i=Je()[r/4+1];if(i)throw ls(n)}finally{ce.__wbindgen_add_to_stack_pointer(16)}}compareRoute(t,n,i,r){let a,h;try{const k=ce.__wbindgen_add_to_stack_pointer(-16);ce.ltn_compareRoute(k,this.__wbg_ptr,t,n,i,r);var u=Je()[k/4+0],_=Je()[k/4+1],w=Je()[k/4+2],S=Je()[k/4+3],E=u,M=_;if(S)throw E=0,M=0,ls(w);return a=E,h=M,Ys(E,M)}finally{ce.__wbindgen_add_to_stack_pointer(16),ce.__wbindgen_free(a,h,1)}}}async function nI(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function iI(){const e={};return e.wbg={},e.wbg.__wbindgen_string_get=function(t,n){const i=pn(n),r=typeof i=="string"?i:void 0;var a=Oh(r)?0:Ea(r,ce.__wbindgen_malloc,ce.__wbindgen_realloc),h=Wo;Je()[t/4+1]=h,Je()[t/4+0]=a},e.wbg.__wbindgen_object_drop_ref=function(t){ls(t)},e.wbg.__wbindgen_error_new=function(t,n){const i=new Error(Ys(t,n));return oi(i)},e.wbg.__wbindgen_boolean_get=function(t){const n=pn(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_is_bigint=function(t){return typeof pn(t)=="bigint"},e.wbg.__wbindgen_bigint_from_i64=function(t){return oi(t)},e.wbg.__wbindgen_jsval_eq=function(t,n){return pn(t)===pn(n)},e.wbg.__wbindgen_bigint_from_u64=function(t){const n=BigInt.asUintN(64,t);return oi(n)},e.wbg.__wbindgen_number_get=function(t,n){const i=pn(n),r=typeof i=="number"?i:void 0;ox()[t/8+1]=Oh(r)?0:r,Je()[t/4+0]=!Oh(r)},e.wbg.__wbindgen_is_object=function(t){const n=pn(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_in=function(t,n){return pn(t)in pn(n)},e.wbg.__wbindgen_string_new=function(t,n){const i=Ys(t,n);return oi(i)},e.wbg.__wbindgen_is_undefined=function(t){return pn(t)===void 0},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return pn(t)==pn(n)},e.wbg.__wbindgen_object_clone_ref=function(t){const n=pn(t);return oi(n)},e.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(t,n){const i=pn(t)[pn(n)];return oi(i)},e.wbg.__wbg_debug_34c9290896ec9856=function(t){console.debug(pn(t))},e.wbg.__wbg_error_e60eff06f24ab7a4=function(t){console.error(pn(t))},e.wbg.__wbg_info_d7d58472d0bab115=function(t){console.info(pn(t))},e.wbg.__wbg_log_a4530b4fe289336f=function(t){console.log(pn(t))},e.wbg.__wbg_warn_f260f49434e45e62=function(t){console.warn(pn(t))},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return oi(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const i=pn(n).stack,r=Ea(i,ce.__wbindgen_malloc,ce.__wbindgen_realloc),a=Wo;Je()[t/4+1]=a,Je()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let i,r;try{i=t,r=n,console.error(Ys(t,n))}finally{ce.__wbindgen_free(i,r,1)}},e.wbg.__wbg_performance_3f3012faa4463882=function(t){const n=pn(t).performance;return oi(n)},e.wbg.__wbg_now_2fd65358804c9485=function(t){return pn(t).now()},e.wbg.__wbg_get_f01601b5a68d10e3=function(t,n){const i=pn(t)[n>>>0];return oi(i)},e.wbg.__wbg_length_1009b1af0c481d7b=function(t){return pn(t).length},e.wbg.__wbindgen_is_function=function(t){return typeof pn(t)=="function"},e.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(t,n){const i=new Function(Ys(t,n));return oi(i)},e.wbg.__wbg_next_9b877f231f476d01=function(t){const n=pn(t).next;return oi(n)},e.wbg.__wbg_next_6529ee0cca8d57ed=function(){return dc(function(t){const n=pn(t).next();return oi(n)},arguments)},e.wbg.__wbg_done_5fe336b092d60cf2=function(t){return pn(t).done},e.wbg.__wbg_value_0c248a78fdc8e19f=function(t){const n=pn(t).value;return oi(n)},e.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return oi(Symbol.iterator)},e.wbg.__wbg_get_7b48513de5dc5ea4=function(){return dc(function(t,n){const i=Reflect.get(pn(t),pn(n));return oi(i)},arguments)},e.wbg.__wbg_call_90c26b09837aba1c=function(){return dc(function(t,n){const i=pn(t).call(pn(n));return oi(i)},arguments)},e.wbg.__wbg_self_f0e34d89f33b99fd=function(){return dc(function(){const t=self.self;return oi(t)},arguments)},e.wbg.__wbg_window_d3b084224f4774d7=function(){return dc(function(){const t=window.window;return oi(t)},arguments)},e.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return dc(function(){const t=globalThis.globalThis;return oi(t)},arguments)},e.wbg.__wbg_global_35dfdd59a4da3e74=function(){return dc(function(){const t=global.global;return oi(t)},arguments)},e.wbg.__wbg_isArray_74fb723e24f76012=function(t){return Array.isArray(pn(t))},e.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(t){let n;try{n=pn(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(t){return Number.isSafeInteger(pn(t))},e.wbg.__wbg_entries_9e2e2aa45aa5094a=function(t){const n=Object.entries(pn(t));return oi(n)},e.wbg.__wbg_buffer_a448f833075b71ba=function(t){const n=pn(t).buffer;return oi(n)},e.wbg.__wbg_new_8f67e318f15d7254=function(t){const n=new Uint8Array(pn(t));return oi(n)},e.wbg.__wbg_set_2357bf09366ee480=function(t,n,i){pn(t).set(pn(n),i>>>0)},e.wbg.__wbg_length_1d25fa9e4ac21ce7=function(t){return pn(t).length},e.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(t){let n;try{n=pn(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_bigint_get_as_i64=function(t,n){const i=pn(n),r=typeof i=="bigint"?i:void 0;JS()[t/8+1]=Oh(r)?BigInt(0):r,Je()[t/4+0]=!Oh(r)},e.wbg.__wbindgen_debug_string=function(t,n){const i=ay(pn(n)),r=Ea(i,ce.__wbindgen_malloc,ce.__wbindgen_realloc),a=Wo;Je()[t/4+1]=a,Je()[t/4+0]=r},e.wbg.__wbindgen_throw=function(t,n){throw new Error(Ys(t,n))},e.wbg.__wbindgen_memory=function(){const t=ce.memory;return oi(t)},e}function rI(e,t){return ce=e.exports,ax.__wbindgen_wasm_module=t,Ap=null,kp=null,Pp=null,Mp=null,ce}async function ax(e){if(ce!==void 0)return ce;typeof e>"u"&&(e="/ltn/assets/backend_bg.wasm");const t=iI();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await nI(await e,t);return rI(n,i)}var lx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ux(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function cx(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}),n}var hx={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.0.2/LICENSE.txt
 */(function(e,t){(function(n,i){e.exports=i()})(lx,function(){var n={},i={};function r(h,u,_){if(i[h]=_,h==="index"){var w="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",S={};return i.shared(S),i.index(n,S),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([w],{type:"text/javascript"}))),n}}r("shared",["exports"],function(h){function u(l,o,c,p){return new(c||(c=Promise))(function(m,b){function x(A){try{T(p.next(A))}catch(R){b(R)}}function I(A){try{T(p.throw(A))}catch(R){b(R)}}function T(A){var R;A.done?m(A.value):(R=A.value,R instanceof c?R:new c(function(z){z(R)})).then(x,I)}T((p=p.apply(l,o||[])).next())})}function _(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}typeof SuppressedError=="function"&&SuppressedError;var w=S;function S(l,o){this.x=l,this.y=o}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(l){return this.clone()._add(l)},sub:function(l){return this.clone()._sub(l)},multByPoint:function(l){return this.clone()._multByPoint(l)},divByPoint:function(l){return this.clone()._divByPoint(l)},mult:function(l){return this.clone()._mult(l)},div:function(l){return this.clone()._div(l)},rotate:function(l){return this.clone()._rotate(l)},rotateAround:function(l,o){return this.clone()._rotateAround(l,o)},matMult:function(l){return this.clone()._matMult(l)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(l){return this.x===l.x&&this.y===l.y},dist:function(l){return Math.sqrt(this.distSqr(l))},distSqr:function(l){var o=l.x-this.x,c=l.y-this.y;return o*o+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(l){return Math.atan2(this.y-l.y,this.x-l.x)},angleWith:function(l){return this.angleWithSep(l.x,l.y)},angleWithSep:function(l,o){return Math.atan2(this.x*o-this.y*l,this.x*l+this.y*o)},_matMult:function(l){var o=l[2]*this.x+l[3]*this.y;return this.x=l[0]*this.x+l[1]*this.y,this.y=o,this},_add:function(l){return this.x+=l.x,this.y+=l.y,this},_sub:function(l){return this.x-=l.x,this.y-=l.y,this},_mult:function(l){return this.x*=l,this.y*=l,this},_div:function(l){return this.x/=l,this.y/=l,this},_multByPoint:function(l){return this.x*=l.x,this.y*=l.y,this},_divByPoint:function(l){return this.x/=l.x,this.y/=l.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var l=this.y;return this.y=this.x,this.x=-l,this},_rotate:function(l){var o=Math.cos(l),c=Math.sin(l),p=c*this.x+o*this.y;return this.x=o*this.x-c*this.y,this.y=p,this},_rotateAround:function(l,o){var c=Math.cos(l),p=Math.sin(l),m=o.y+p*(this.x-o.x)+c*(this.y-o.y);return this.x=o.x+c*(this.x-o.x)-p*(this.y-o.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(l){return l instanceof S?l:Array.isArray(l)?new S(l[0],l[1]):l};var E=_(w),M=k;function k(l,o,c,p){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=c,this.p2y=p}k.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var c=l,p=0;p<8;p++){var m=this.sampleCurveX(c)-l;if(Math.abs(m)<o)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=m/b}var x=0,I=1;for(c=l,p=0;p<20&&(m=this.sampleCurveX(c),!(Math.abs(m-l)<o));p++)l>m?x=c:I=c,c=.5*(I-x)+x;return c},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var D=_(M);let F,q;function X(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function B(){if(q==null&&(q=!1,X())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let p=0;p<5*5;p++){const m=4*p;o.fillStyle=`rgb(${m},${m+1},${m+2})`,o.fillRect(p%5,Math.floor(p/5),1,1)}const c=o.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&c[p]!==p){q=!0;break}}}return q||!1}function U(l,o,c,p){const m=new D(l,o,c,p);return function(b){return m.solve(b)}}const W=U(.25,.1,.25,1);function Q(l,o,c){return Math.min(c,Math.max(o,l))}function ht(l,o,c){const p=c-o,m=((l-o)%p+p)%p+o;return m===o?c:m}function ut(l,...o){for(const c of o)for(const p in c)l[p]=c[p];return l}let St=1;function lt(l,o,c){const p={};for(const m in l)p[m]=o.call(c||this,l[m],m,l);return p}function zt(l,o,c){const p={};for(const m in l)o.call(c||this,l[m],m,l)&&(p[m]=l[m]);return p}function wt(l){return Array.isArray(l)?l.map(wt):typeof l=="object"&&l?lt(l,wt):l}const _t={};function te(l){_t[l]||(typeof console<"u"&&console.warn(l),_t[l]=!0)}function Pt(l,o,c){return(c.y-l.y)*(o.x-l.x)>(o.y-l.y)*(c.x-l.x)}function oe(l){let o=0;for(let c,p,m=0,b=l.length,x=b-1;m<b;x=m++)c=l[m],p=l[x],o+=(p.x-c.x)*(c.y+p.y);return o}function Gt(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let ie=null;function Ee(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}const an="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function cn(l,o,c,p,m){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(l,{timestamp:0});try{const x=b==null?void 0:b.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const I=x.startsWith("BGR"),T=new Uint8ClampedArray(p*m*4);if(yield b.copyTo(T,function(A,R,z,j,H){const Y=4*Math.max(-R,0),tt=(Math.max(0,z)-z)*j*4+Y,ot=4*j,dt=Math.max(0,R),Dt=Math.max(0,z);return{rect:{x:dt,y:Dt,width:Math.min(A.width,R+j)-dt,height:Math.min(A.height,z+H)-Dt},layout:[{offset:tt,stride:ot}]}}(l,o,c,p,m)),I)for(let A=0;A<T.length;A+=4){const R=T[A];T[A]=T[A+2],T[A+2]=R}return T}finally{b.close()}})}let je,Oe;const wn="AbortError";function In(){return new Error(wn)}const Sn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Bn(l){return Sn.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}const Vn="global-dispatcher";class ne extends Error{constructor(o,c,p,m){super(`AJAXError: ${c} (${o}): ${p}`),this.status=o,this.statusText=c,this.url=p,this.body=m}}const Ie=()=>Gt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fe=function(l,o){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){const p=Bn(l.url);if(p)return p(l,o);if(Gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:l,targetMapId:Vn},o)}if(!(/^file:/.test(c=l.url)||/^file:/.test(Ie())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,m){return u(this,void 0,void 0,function*(){const b=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:Ie(),signal:m.signal});p.type==="json"&&b.headers.set("Accept","application/json");const x=yield fetch(b);if(!x.ok){const A=yield x.blob();throw new ne(x.status,x.statusText,p.url,A)}const I=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text(),T=yield I;if(m.signal.aborted)throw In();return{data:T,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(l,o);if(Gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:l,mustQueue:!0,targetMapId:Vn},o)}var c;return function(p,m){return new Promise((b,x)=>{const I=new XMLHttpRequest;I.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(I.responseType="arraybuffer");for(const T in p.headers)I.setRequestHeader(T,p.headers[T]);p.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=p.credentials==="include",I.onerror=()=>{x(new Error(I.statusText))},I.onload=()=>{if(!m.signal.aborted)if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){let T=I.response;if(p.type==="json")try{T=JSON.parse(I.response)}catch(A){return void x(A)}b({data:T,cacheControl:I.getResponseHeader("Cache-Control"),expires:I.getResponseHeader("Expires")})}else{const T=new Blob([I.response],{type:I.getResponseHeader("Content-Type")});x(new ne(I.status,I.statusText,p.url,T))}},m.signal.addEventListener("abort",()=>{I.abort(),x(In())}),I.send(p.body)})}(l,o)};function zn(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;const o=new URL(l),c=window.location;return o.protocol===c.protocol&&o.host===c.host}function Ki(l,o,c){c[l]&&c[l].indexOf(o)!==-1||(c[l]=c[l]||[],c[l].push(o))}function Tt(l,o,c){if(c&&c[l]){const p=c[l].indexOf(o);p!==-1&&c[l].splice(p,1)}}class We{constructor(o,c={}){ut(this,c),this.type=o}}class Le extends We{constructor(o,c={}){super("error",ut({error:o},c))}}class Ji{on(o,c){return this._listeners=this._listeners||{},Ki(o,c,this._listeners),this}off(o,c){return Tt(o,c,this._listeners),Tt(o,c,this._oneTimeListeners),this}once(o,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Ki(o,c,this._oneTimeListeners),this):new Promise(p=>this.once(o,p))}fire(o,c){typeof o=="string"&&(o=new We(o,c||{}));const p=o.type;if(this.listens(p)){o.target=this;const m=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of m)I.call(this,o);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of b)Tt(p,I,this._oneTimeListeners),I.call(this,o);const x=this._eventedParent;x&&(ut(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(o))}else o instanceof Le&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,c){return this._eventedParent=o,this._eventedParentData=c,this}}var Bt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ar(l,o){const c={};for(const p in l)p!=="ref"&&(c[p]=l[p]);return yn.forEach(p=>{p in o&&(c[p]=o[p])}),c}function dn(l,o){if(Array.isArray(l)){if(!Array.isArray(o)||l.length!==o.length)return!1;for(let c=0;c<l.length;c++)if(!dn(l[c],o[c]))return!1;return!0}if(typeof l=="object"&&l!==null&&o!==null){if(typeof o!="object"||Object.keys(l).length!==Object.keys(o).length)return!1;for(const c in l)if(!dn(l[c],o[c]))return!1;return!0}return l===o}function mi(l,o){l.push(o)}function Dr(l,o,c){mi(c,{command:"addSource",args:[l,o[l]]})}function vs(l,o,c){mi(o,{command:"removeSource",args:[l]}),c[l]=!0}function Us(l,o,c,p){vs(l,c,p),Dr(l,o,c)}function Ga(l,o,c){let p;for(p in l[c])if(Object.prototype.hasOwnProperty.call(l[c],p)&&p!=="data"&&!dn(l[c][p],o[c][p]))return!1;for(p in o[c])if(Object.prototype.hasOwnProperty.call(o[c],p)&&p!=="data"&&!dn(l[c][p],o[c][p]))return!1;return!0}function Gr(l,o,c,p,m,b){l=l||{},o=o||{};for(const x in l)Object.prototype.hasOwnProperty.call(l,x)&&(dn(l[x],o[x])||c.push({command:b,args:[p,x,o[x],m]}));for(const x in o)Object.prototype.hasOwnProperty.call(o,x)&&!Object.prototype.hasOwnProperty.call(l,x)&&(dn(l[x],o[x])||c.push({command:b,args:[p,x,o[x],m]}))}function _l(l){return l.id}function bs(l,o){return l[o.id]=o,l}class se{constructor(o,c,p,m){this.message=(o?`${o}: `:"")+p,m&&(this.identifier=m),c!=null&&c.__line__&&(this.line=c.__line__)}}function es(l,...o){for(const c of o)for(const p in c)l[p]=c[p];return l}class oo extends Error{constructor(o,c){super(c),this.message=c,this.key=o}}class yl{constructor(o,c=[]){this.parent=o,this.bindings={};for(const[p,m]of c)this.bindings[p]=m}concat(o){return new yl(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const Qi={kind:"null"},ue={kind:"number"},ln={kind:"string"},on={kind:"boolean"},Ri={kind:"color"},ns={kind:"object"},rn={kind:"value"},_a={kind:"collator"},Vi={kind:"formatted"},st={kind:"padding"},G={kind:"resolvedImage"},Z={kind:"variableAnchorOffsetCollection"};function K(l,o){return{kind:"array",itemType:l,N:o}}function nt(l){if(l.kind==="array"){const o=nt(l.itemType);return typeof l.N=="number"?`array<${o}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${o}>`}return l.kind}const Et=[Qi,ue,ln,on,Ri,Vi,ns,K(rn),st,G,Z];function J(l,o){if(o.kind==="error")return null;if(l.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!J(l.itemType,o.itemType))&&(typeof l.N!="number"||l.N===o.N))return null}else{if(l.kind===o.kind)return null;if(l.kind==="value"){for(const c of Et)if(!J(c,o))return null}}return`Expected ${nt(l)} but found ${nt(o)} instead.`}function Ct(l,o){return o.some(c=>c.kind===l.kind)}function mt(l,o){return o.some(c=>c==="null"?l===null:c==="array"?Array.isArray(l):c==="object"?l&&!Array.isArray(l)&&typeof l=="object":c===typeof l)}function At(l,o){return l.kind==="array"&&o.kind==="array"?l.itemType.kind===o.itemType.kind&&typeof l.N=="number":l.kind===o.kind}const Vt=.96422,Ht=.82521,$t=4/29,Pe=6/29,Ne=3*Pe*Pe,Ke=Pe*Pe*Pe,Qe=Math.PI/180,Tn=180/Math.PI;function Hn(l){return(l%=360)<0&&(l+=360),l}function gi([l,o,c,p]){let m,b;const x=hn((.2225045*(l=tr(l))+.7168786*(o=tr(o))+.0606169*(c=tr(c)))/1);l===o&&o===c?m=b=x:(m=hn((.4360747*l+.3850649*o+.1430804*c)/Vt),b=hn((.0139322*l+.0971045*o+.7141733*c)/Ht));const I=116*x-16;return[I<0?0:I,500*(m-x),200*(x-b),p]}function tr(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function hn(l){return l>Ke?Math.pow(l,1/3):l/Ne+$t}function Ci([l,o,c,p]){let m=(l+16)/116,b=isNaN(o)?m:m+o/500,x=isNaN(c)?m:m-c/200;return m=1*so(m),b=Vt*so(b),x=Ht*so(x),[lr(3.1338561*b-1.6168667*m-.4906146*x),lr(-.9787684*b+1.9161415*m+.033454*x),lr(.0719453*b-.2289914*m+1.4052427*x),p]}function lr(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function so(l){return l>Pe?l*l*l:Ne*(l-$t)}function wo(l){return parseInt(l.padEnd(2,l),16)/255}function wr(l,o){return Gs(o?l/100:l,0,1)}function Gs(l,o,c){return Math.min(Math.max(o,l),c)}function Id(l){return!l.some(Number.isNaN)}const jg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qn{constructor(o,c,p,m=1,b=!0){this.r=o,this.g=c,this.b=p,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[o,c,p,m]))}static parse(o){if(o instanceof qn)return o;if(typeof o!="string")return;const c=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const m=jg[p];if(m){const[x,I,T]=m;return[x/255,I/255,T/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let I=1;return[wo(p.slice(I,I+=x)),wo(p.slice(I,I+=x)),wo(p.slice(I,I+=x)),wo(p.slice(I,I+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[I,T,A,R,z,j,H,Y,tt,ot,dt,Dt]=x,bt=[R||" ",H||" ",ot].join("");if(bt==="  "||bt==="  /"||bt===",,"||bt===",,,"){const Lt=[A,j,tt].join(""),Yt=Lt==="%%%"?100:Lt===""?255:0;if(Yt){const Jt=[Gs(+T/Yt,0,1),Gs(+z/Yt,0,1),Gs(+Y/Yt,0,1),dt?wr(+dt,Dt):1];if(Id(Jt))return Jt}}return}}const b=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[x,I,T,A,R,z,j,H,Y]=b,tt=[T||" ",R||" ",j].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const ot=[+I,Gs(+A,0,100),Gs(+z,0,100),H?wr(+H,Y):1];if(Id(ot))return function([dt,Dt,bt,Lt]){function Yt(Jt){const ve=(Jt+dt/30)%12,Me=Dt*Math.min(bt,1-bt);return bt-Me*Math.max(-1,Math.min(ve-3,9-ve,1))}return dt=Hn(dt),Dt/=100,bt/=100,[Yt(0),Yt(8),Yt(4),Lt]}(ot)}}}(o);return c?new qn(...c,!1):void 0}get rgb(){const{r:o,g:c,b:p,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[o/b,c/b,p/b,m])}get hcl(){return this.overwriteGetter("hcl",function(o){const[c,p,m,b]=gi(o),x=Math.sqrt(p*p+m*m);return[Math.round(1e4*x)?Hn(Math.atan2(m,p)*Tn):NaN,x,c,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",gi(this.rgb))}overwriteGetter(o,c){return Object.defineProperty(this,o,{value:c}),c}toString(){const[o,c,p,m]=this.rgb;return`rgba(${[o,c,p].map(b=>Math.round(255*b)).join(",")},${m})`}}qn.black=new qn(0,0,0,1),qn.white=new qn(1,1,1,1),qn.transparent=new qn(0,0,0,0),qn.red=new qn(1,0,0,1);class Sf{constructor(o,c,p){this.sensitivity=o?c?"variant":"case":c?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,c){return this.collator.compare(o,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class If{constructor(o,c,p,m,b){this.text=o,this.image=c,this.scale=p,this.fontStack=m,this.textColor=b}}class Fo{constructor(o){this.sections=o}static fromString(o){return new Fo([new If(o,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof Fo?o:Fo.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class So{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof So)return o;if(typeof o=="number")return new So([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const c of o)if(typeof c!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new So(o)}}toString(){return JSON.stringify(this.values)}}const Gu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class is{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof is)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let c=0;c<o.length;c+=2){const p=o[c],m=o[c+1];if(typeof p!="string"||!Gu.has(p)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new is(o)}}toString(){return JSON.stringify(this.values)}}class rs{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new rs({name:o,available:!1}):null}}function eu(l,o,c,p){return typeof l=="number"&&l>=0&&l<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof c=="number"&&c>=0&&c<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[l,o,c,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[l,o,c,p]:[l,o,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fc(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof qn||l instanceof Sf||l instanceof Fo||l instanceof So||l instanceof is||l instanceof rs)return!0;if(Array.isArray(l)){for(const o of l)if(!Fc(o))return!1;return!0}if(typeof l=="object"){for(const o in l)if(!Fc(l[o]))return!1;return!0}return!1}function er(l){if(l===null)return Qi;if(typeof l=="string")return ln;if(typeof l=="boolean")return on;if(typeof l=="number")return ue;if(l instanceof qn)return Ri;if(l instanceof Sf)return _a;if(l instanceof Fo)return Vi;if(l instanceof So)return st;if(l instanceof is)return Z;if(l instanceof rs)return G;if(Array.isArray(l)){const o=l.length;let c;for(const p of l){const m=er(p);if(c){if(c===m)continue;c=rn;break}c=m}return K(c||rn,o)}return ns}function ju(l){const o=typeof l;return l===null?"":o==="string"||o==="number"||o==="boolean"?String(l):l instanceof qn||l instanceof Fo||l instanceof So||l instanceof is||l instanceof rs?l.toString():JSON.stringify(l)}class ja{constructor(o,c){this.type=o,this.value=c}static parse(o,c){if(o.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Fc(o[1]))return c.error("invalid value");const p=o[1];let m=er(p);const b=c.expectedType;return m.kind!=="array"||m.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(m=b),new ja(m,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class xi{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Bc={string:ln,number:ue,boolean:on,object:ns};class Bo{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");let p,m=1;const b=o[0];if(b==="array"){let I,T;if(o.length>2){const A=o[1];if(typeof A!="string"||!(A in Bc)||A==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);I=Bc[A],m++}else I=rn;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return c.error('The length argument to "array" must be a positive integer literal',2);T=o[2],m++}p=K(I,T)}else{if(!Bc[b])throw new Error(`Types doesn't contain name = ${b}`);p=Bc[b]}const x=[];for(;m<o.length;m++){const I=c.parse(o[m],m,rn);if(!I)return null;x.push(I)}return new Bo(p,x)}evaluate(o){for(let c=0;c<this.args.length;c++){const p=this.args[c].evaluate(o);if(!J(this.type,er(p)))return p;if(c===this.args.length-1)throw new xi(`Expected value to be of type ${nt(this.type)}, but found ${nt(er(p))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const Vc={"to-boolean":on,"to-color":Ri,"to-number":ue,"to-string":ln};class js{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const p=o[0];if(!Vc[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&o.length!==2)return c.error("Expected one argument.");const m=Vc[p],b=[];for(let x=1;x<o.length;x++){const I=c.parse(o[x],x,rn);if(!I)return null;b.push(I)}return new js(m,b)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let c,p;for(const m of this.args){if(c=m.evaluate(o),p=null,c instanceof qn)return c;if(typeof c=="string"){const b=o.parseColor(c);if(b)return b}else if(Array.isArray(c)&&(p=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:eu(c[0],c[1],c[2],c[3]),!p))return new qn(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new xi(p||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const p of this.args){c=p.evaluate(o);const m=So.parse(c);if(m)return m}throw new xi(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const p of this.args){c=p.evaluate(o);const m=is.parse(c);if(m)return m}throw new xi(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const p of this.args){if(c=p.evaluate(o),c===null)return 0;const m=Number(c);if(!isNaN(m))return m}throw new xi(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Fo.fromString(ju(this.args[0].evaluate(o)));case"resolvedImage":return rs.fromString(ju(this.args[0].evaluate(o)));default:return ju(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const qu=["Unknown","Point","LineString","Polygon"];class Zn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let c=this._parseColorCache[o];return c||(c=this._parseColorCache[o]=qn.parse(o)),c}}class Uc{constructor(o,c,p=[],m,b=new yl,x=[]){this.registry=o,this.path=p,this.key=p.map(I=>`[${I}]`).join(""),this.scope=b,this.errors=x,this.expectedType=m,this._isConstant=c}parse(o,c,p,m,b={}){return c?this.concat(c,p,m)._parse(o,b):this._parse(o,b)}_parse(o,c){function p(m,b,x){return x==="assert"?new Bo(b,[m]):x==="coerce"?new js(b,[m]):m}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=o[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let x=b.parse(o,this);if(!x)return null;if(this.expectedType){const I=this.expectedType,T=x.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||T.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(I.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array")if(I.kind!=="variableAnchorOffsetCollection"||T.kind!=="value"&&T.kind!=="array"){if(this.checkSubtype(I,T))return null}else x=p(x,I,c.typeAnnotation||"coerce");else x=p(x,I,c.typeAnnotation||"coerce");else x=p(x,I,c.typeAnnotation||"coerce");else x=p(x,I,c.typeAnnotation||"assert")}if(!(x instanceof ja)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const I=new Zn;try{x=new ja(x.type,x.evaluate(I))}catch(T){return this.error(T.message),null}}return x}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,c,p){const m=typeof o=="number"?this.path.concat(o):this.path,b=p?this.scope.concat(p):this.scope;return new Uc(this.registry,this._isConstant,m,c||null,b,this.errors)}error(o,...c){const p=`${this.key}${c.map(m=>`[${m}]`).join("")}`;this.errors.push(new oo(p,o))}checkSubtype(o,c){const p=J(o,c);return p&&this.error(p),p}}class nu{constructor(o,c,p){this.type=_a,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=c}static parse(o,c){if(o.length!==2)return c.error("Expected one argument.");const p=o[1];if(typeof p!="object"||Array.isArray(p))return c.error("Collator options argument must be an object.");const m=c.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,on);if(!m)return null;const b=c.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,on);if(!b)return null;let x=null;return p.locale&&(x=c.parse(p.locale,1,ln),!x)?null:new nu(m,b,x)}evaluate(o){return new Sf(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}const qa=8192;function Gc(l,o){l[0]=Math.min(l[0],o[0]),l[1]=Math.min(l[1],o[1]),l[2]=Math.max(l[2],o[0]),l[3]=Math.max(l[3],o[1])}function Zu(l,o){return!(l[0]<=o[0]||l[2]>=o[2]||l[1]<=o[1]||l[3]>=o[3])}function qg(l,o){const c=(180+l[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,m=Math.pow(2,o.z);return[Math.round(c*m*qa),Math.round(p*m*qa)]}function Ed(l,o,c){const p=l[0]-o[0],m=l[1]-o[1],b=l[0]-c[0],x=l[1]-c[1];return p*x-b*m==0&&p*b<=0&&m*x<=0}function jc(l,o){let c=!1;for(let x=0,I=o.length;x<I;x++){const T=o[x];for(let A=0,R=T.length;A<R-1;A++){if(Ed(l,T[A],T[A+1]))return!1;(m=T[A])[1]>(p=l)[1]!=(b=T[A+1])[1]>p[1]&&p[0]<(b[0]-m[0])*(p[1]-m[1])/(b[1]-m[1])+m[0]&&(c=!c)}}var p,m,b;return c}function Zg(l,o){for(let c=0;c<o.length;c++)if(jc(l,o[c]))return!0;return!1}function Cd(l,o,c,p){const m=p[0]-c[0],b=p[1]-c[1],x=(l[0]-c[0])*b-m*(l[1]-c[1]),I=(o[0]-c[0])*b-m*(o[1]-c[1]);return x>0&&I<0||x<0&&I>0}function Wg(l,o,c){for(const A of c)for(let R=0;R<A.length-1;++R)if((I=[(x=A[R+1])[0]-(b=A[R])[0],x[1]-b[1]])[0]*(T=[(m=o)[0]-(p=l)[0],m[1]-p[1]])[1]-I[1]*T[0]!=0&&Cd(p,m,b,x)&&Cd(b,x,p,m))return!0;var p,m,b,x,I,T;return!1}function Td(l,o){for(let c=0;c<l.length;++c)if(!jc(l[c],o))return!1;for(let c=0;c<l.length-1;++c)if(Wg(l[c],l[c+1],o))return!1;return!0}function Ld(l,o){for(let c=0;c<o.length;c++)if(Td(l,o[c]))return!0;return!1}function qc(l,o,c){const p=[];for(let m=0;m<l.length;m++){const b=[];for(let x=0;x<l[m].length;x++){const I=qg(l[m][x],c);Gc(o,I),b.push(I)}p.push(b)}return p}function Md(l,o,c){const p=[];for(let m=0;m<l.length;m++){const b=qc(l[m],o,c);p.push(b)}return p}function Pd(l,o,c,p){if(l[0]<c[0]||l[0]>c[2]){const m=.5*p;let b=l[0]-c[0]>m?-p:c[0]-l[0]>m?p:0;b===0&&(b=l[0]-c[2]>m?-p:c[2]-l[0]>m?p:0),l[0]+=b}Gc(o,l)}function Zc(l,o,c,p){const m=Math.pow(2,p.z)*qa,b=[p.x*qa,p.y*qa],x=[];for(const I of l)for(const T of I){const A=[T.x+b[0],T.y+b[1]];Pd(A,o,c,m),x.push(A)}return x}function kd(l,o,c,p){const m=Math.pow(2,p.z)*qa,b=[p.x*qa,p.y*qa],x=[];for(const T of l){const A=[];for(const R of T){const z=[R.x+b[0],R.y+b[1]];Gc(o,z),A.push(z)}x.push(A)}if(o[2]-o[0]<=m/2){(I=o)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const T of x)for(const A of T)Pd(A,o,c,m)}var I;return x}class vl{constructor(o,c){this.type=on,this.geojson=o,this.geometries=c}static parse(o,c){if(o.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Fc(o[1])){const p=o[1];if(p.type==="FeatureCollection"){const m=[];for(const b of p.features){const{type:x,coordinates:I}=b.geometry;x==="Polygon"&&m.push(I),x==="MultiPolygon"&&m.push(...I)}if(m.length)return new vl(p,{type:"MultiPolygon",coordinates:m})}else if(p.type==="Feature"){const m=p.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new vl(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new vl(p,p)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(c,p){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(p.type==="Polygon"){const I=qc(p.coordinates,b,x),T=Zc(c.geometry(),m,b,x);if(!Zu(m,b))return!1;for(const A of T)if(!jc(A,I))return!1}if(p.type==="MultiPolygon"){const I=Md(p.coordinates,b,x),T=Zc(c.geometry(),m,b,x);if(!Zu(m,b))return!1;for(const A of T)if(!Zg(A,I))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(c,p){const m=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(p.type==="Polygon"){const I=qc(p.coordinates,b,x),T=kd(c.geometry(),m,b,x);if(!Zu(m,b))return!1;for(const A of T)if(!Td(A,I))return!1}if(p.type==="MultiPolygon"){const I=Md(p.coordinates,b,x),T=kd(c.geometry(),m,b,x);if(!Zu(m,b))return!1;for(const A of T)if(!Ld(A,I))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Wc{constructor(o,c){this.type=c.type,this.name=o,this.boundExpression=c}static parse(o,c){if(o.length!==2||typeof o[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const p=o[1];return c.scope.has(p)?new Wc(p,c.scope.get(p)):c.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class Vo{constructor(o,c,p,m){this.name=o,this.type=c,this._evaluate=p,this.args=m}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,c){const p=o[0],m=Vo.definitions[p];if(!m)return c.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,x=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,I=x.filter(([A])=>!Array.isArray(A)||A.length===o.length-1);let T=null;for(const[A,R]of I){T=new Uc(c.registry,Wu,c.path,null,c.scope);const z=[];let j=!1;for(let H=1;H<o.length;H++){const Y=o[H],tt=Array.isArray(A)?A[H-1]:A.type,ot=T.parse(Y,1+z.length,tt);if(!ot){j=!0;break}z.push(ot)}if(!j)if(Array.isArray(A)&&A.length!==z.length)T.error(`Expected ${A.length} arguments, but found ${z.length} instead.`);else{for(let H=0;H<z.length;H++){const Y=Array.isArray(A)?A[H]:A.type,tt=z[H];T.concat(H+1).checkSubtype(Y,tt.type)}if(T.errors.length===0)return new Vo(p,b,R,z)}}if(I.length===1)c.errors.push(...T.errors);else{const A=(I.length?I:x).map(([z])=>{return j=z,Array.isArray(j)?`(${j.map(nt).join(", ")})`:`(${nt(j.type)}...)`;var j}).join(" | "),R=[];for(let z=1;z<o.length;z++){const j=c.parse(o[z],1+R.length);if(!j)return null;R.push(nt(j.type))}c.error(`Expected arguments of type ${A}, but found (${R.join(", ")}) instead.`)}return null}static register(o,c){Vo.definitions=c;for(const p in c)o[p]=Vo}}function Wu(l){if(l instanceof Wc)return Wu(l.boundExpression);if(l instanceof Vo&&l.name==="error"||l instanceof nu||l instanceof vl)return!1;const o=l instanceof js||l instanceof Bo;let c=!0;return l.eachChild(p=>{c=o?c&&Wu(p):c&&p instanceof ja}),!!c&&Hc(l)&&$u(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Hc(l){if(l instanceof Vo&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof vl)return!1;let o=!0;return l.eachChild(c=>{o&&!Hc(c)&&(o=!1)}),o}function Hu(l){if(l instanceof Vo&&l.name==="feature-state")return!1;let o=!0;return l.eachChild(c=>{o&&!Hu(c)&&(o=!1)}),o}function $u(l,o){if(l instanceof Vo&&o.indexOf(l.name)>=0)return!1;let c=!0;return l.eachChild(p=>{c&&!$u(p,o)&&(c=!1)}),c}function Xu(l,o){const c=l.length-1;let p,m,b=0,x=c,I=0;for(;b<=x;)if(I=Math.floor((b+x)/2),p=l[I],m=l[I+1],p<=o){if(I===c||o<m)return I;b=I+1}else{if(!(p>o))throw new xi("Input is not a number.");x=I-1}return 0}class Yu{constructor(o,c,p){this.type=o,this.input=c,this.labels=[],this.outputs=[];for(const[m,b]of p)this.labels.push(m),this.outputs.push(b)}static parse(o,c){if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");const p=c.parse(o[1],1,ue);if(!p)return null;const m=[];let b=null;c.expectedType&&c.expectedType.kind!=="value"&&(b=c.expectedType);for(let x=1;x<o.length;x+=2){const I=x===1?-1/0:o[x],T=o[x+1],A=x,R=x+1;if(typeof I!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(m.length&&m[m.length-1][0]>=I)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const z=c.parse(T,R,b);if(!z)return null;b=b||z.type,m.push([I,z])}return new Yu(b,p,m)}evaluate(o){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return p[0].evaluate(o);const b=c.length;return m>=c[b-1]?p[b-1].evaluate(o):p[Xu(c,m)].evaluate(o)}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Hg(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var $g=Ad;function Ad(l,o,c,p){this.cx=3*l,this.bx=3*(c-l)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=l,this.p1y=o,this.p2x=c,this.p2y=p}Ad.prototype={sampleCurveX:function(l){return((this.ax*l+this.bx)*l+this.cx)*l},sampleCurveY:function(l){return((this.ay*l+this.by)*l+this.cy)*l},sampleCurveDerivativeX:function(l){return(3*this.ax*l+2*this.bx)*l+this.cx},solveCurveX:function(l,o){if(o===void 0&&(o=1e-6),l<0)return 0;if(l>1)return 1;for(var c=l,p=0;p<8;p++){var m=this.sampleCurveX(c)-l;if(Math.abs(m)<o)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=m/b}var x=0,I=1;for(c=l,p=0;p<20&&(m=this.sampleCurveX(c),!(Math.abs(m-l)<o));p++)l>m?x=c:I=c,c=.5*(I-x)+x;return c},solve:function(l,o){return this.sampleCurveY(this.solveCurveX(l,o))}};var Xg=Hg($g);function bl(l,o,c){return l+c*(o-l)}function $c(l,o,c){return l.map((p,m)=>bl(p,o[m],c))}const ao={number:bl,color:function(l,o,c,p="rgb"){switch(p){case"rgb":{const[m,b,x,I]=$c(l.rgb,o.rgb,c);return new qn(m,b,x,I,!1)}case"hcl":{const[m,b,x,I]=l.hcl,[T,A,R,z]=o.hcl;let j,H;if(isNaN(m)||isNaN(T))isNaN(m)?isNaN(T)?j=NaN:(j=T,x!==1&&x!==0||(H=A)):(j=m,R!==1&&R!==0||(H=b));else{let Dt=T-m;T>m&&Dt>180?Dt-=360:T<m&&m-T>180&&(Dt+=360),j=m+c*Dt}const[Y,tt,ot,dt]=function([Dt,bt,Lt,Yt]){return Dt=isNaN(Dt)?0:Dt*Qe,Ci([Lt,Math.cos(Dt)*bt,Math.sin(Dt)*bt,Yt])}([j,H??bl(b,A,c),bl(x,R,c),bl(I,z,c)]);return new qn(Y,tt,ot,dt,!1)}case"lab":{const[m,b,x,I]=Ci($c(l.lab,o.lab,c));return new qn(m,b,x,I,!1)}}},array:$c,padding:function(l,o,c){return new So($c(l.values,o.values,c))},variableAnchorOffsetCollection:function(l,o,c){const p=l.values,m=o.values;if(p.length!==m.length)throw new xi(`Cannot interpolate values of different length. from: ${l.toString()}, to: ${o.toString()}`);const b=[];for(let x=0;x<p.length;x+=2){if(p[x]!==m[x])throw new xi(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${m[x]}`);b.push(p[x]);const[I,T]=p[x+1],[A,R]=m[x+1];b.push([bl(I,A,c),bl(T,R,c)])}return new is(b)}};class jr{constructor(o,c,p,m,b){this.type=o,this.operator=c,this.interpolation=p,this.input=m,this.labels=[],this.outputs=[];for(const[x,I]of b)this.labels.push(x),this.outputs.push(I)}static interpolationFactor(o,c,p,m){let b=0;if(o.name==="exponential")b=On(c,o.base,p,m);else if(o.name==="linear")b=On(c,1,p,m);else if(o.name==="cubic-bezier"){const x=o.controlPoints;b=new Xg(x[0],x[1],x[2],x[3]).solve(On(c,1,p,m))}return b}static parse(o,c){let[p,m,b,...x]=o;if(!Array.isArray(m)||m.length===0)return c.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const A=m[1];if(typeof A!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if(m[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const A=m.slice(1);if(A.length!==4||A.some(R=>typeof R!="number"||R<0||R>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:A}}}if(o.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(b=c.parse(b,2,ue),!b)return null;const I=[];let T=null;p==="interpolate-hcl"||p==="interpolate-lab"?T=Ri:c.expectedType&&c.expectedType.kind!=="value"&&(T=c.expectedType);for(let A=0;A<x.length;A+=2){const R=x[A],z=x[A+1],j=A+3,H=A+4;if(typeof R!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(I.length&&I[I.length-1][0]>=R)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const Y=c.parse(z,H,T);if(!Y)return null;T=T||Y.type,I.push([R,Y])}return At(T,ue)||At(T,Ri)||At(T,st)||At(T,Z)||At(T,K(ue))?new jr(T,p,m,b,I):c.error(`Type ${nt(T)} is not interpolatable.`)}evaluate(o){const c=this.labels,p=this.outputs;if(c.length===1)return p[0].evaluate(o);const m=this.input.evaluate(o);if(m<=c[0])return p[0].evaluate(o);const b=c.length;if(m>=c[b-1])return p[b-1].evaluate(o);const x=Xu(c,m),I=jr.interpolationFactor(this.interpolation,m,c[x],c[x+1]),T=p[x].evaluate(o),A=p[x+1].evaluate(o);switch(this.operator){case"interpolate":return ao[this.type.kind](T,A,I);case"interpolate-hcl":return ao.color(T,A,I,"hcl");case"interpolate-lab":return ao.color(T,A,I,"lab")}}eachChild(o){o(this.input);for(const c of this.outputs)o(c)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function On(l,o,c,p){const m=p-c,b=l-c;return m===0?0:o===1?b/m:(Math.pow(o,b)-1)/(Math.pow(o,m)-1)}class Xc{constructor(o,c){this.type=o,this.args=c}static parse(o,c){if(o.length<2)return c.error("Expectected at least one argument.");let p=null;const m=c.expectedType;m&&m.kind!=="value"&&(p=m);const b=[];for(const I of o.slice(1)){const T=c.parse(I,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!T)return null;p=p||T.type,b.push(T)}if(!p)throw new Error("No output type");const x=m&&b.some(I=>J(m,I.type));return new Xc(x?rn:p,b)}evaluate(o){let c,p=null,m=0;for(const b of this.args)if(m++,p=b.evaluate(o),p&&p instanceof rs&&!p.available&&(c||(c=p.name),p=null,m===this.args.length&&(p=c)),p!==null)break;return p}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}class Yc{constructor(o,c){this.type=c.type,this.bindings=[].concat(o),this.result=c}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const c of this.bindings)o(c[1]);o(this.result)}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const p=[];for(let b=1;b<o.length-1;b+=2){const x=o[b];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,b);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);const I=c.parse(o[b+1],b+1);if(!I)return null;p.push([x,I])}const m=c.parse(o[o.length-1],o.length-1,c.expectedType,p);return m?new Yc(p,m):null}outputDefined(){return this.result.outputDefined()}}class Ef{constructor(o,c,p){this.type=o,this.index=c,this.input=p}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,ue),m=c.parse(o[2],2,K(c.expectedType||rn));return p&&m?new Ef(m.type.itemType,p,m):null}evaluate(o){const c=this.index.evaluate(o),p=this.input.evaluate(o);if(c<0)throw new xi(`Array index out of bounds: ${c} < 0.`);if(c>=p.length)throw new xi(`Array index out of bounds: ${c} > ${p.length-1}.`);if(c!==Math.floor(c))throw new xi(`Array index must be an integer, but found ${c} instead.`);return p[c]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class Cf{constructor(o,c){this.type=on,this.needle=o,this.haystack=c}static parse(o,c){if(o.length!==3)return c.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,rn),m=c.parse(o[2],2,rn);return p&&m?Ct(p.type,[on,ln,ue,Qi,rn])?new Cf(p,m):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${nt(p.type)} instead`):null}evaluate(o){const c=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!p)return!1;if(!mt(c,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${nt(er(c))} instead.`);if(!mt(p,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${nt(er(p))} instead.`);return p.indexOf(c)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class Kc{constructor(o,c,p){this.type=ue,this.needle=o,this.haystack=c,this.fromIndex=p}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,rn),m=c.parse(o[2],2,rn);if(!p||!m)return null;if(!Ct(p.type,[on,ln,ue,Qi,rn]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${nt(p.type)} instead`);if(o.length===4){const b=c.parse(o[3],3,ue);return b?new Kc(p,m,b):null}return new Kc(p,m)}evaluate(o){const c=this.needle.evaluate(o),p=this.haystack.evaluate(o);if(!mt(c,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${nt(er(c))} instead.`);if(!mt(p,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${nt(er(p))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(o);return p.indexOf(c,m)}return p.indexOf(c)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class Tf{constructor(o,c,p,m,b,x){this.inputType=o,this.type=c,this.input=p,this.cases=m,this.outputs=b,this.otherwise=x}static parse(o,c){if(o.length<5)return c.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return c.error("Expected an even number of arguments.");let p,m;c.expectedType&&c.expectedType.kind!=="value"&&(m=c.expectedType);const b={},x=[];for(let A=2;A<o.length-1;A+=2){let R=o[A];const z=o[A+1];Array.isArray(R)||(R=[R]);const j=c.concat(A);if(R.length===0)return j.error("Expected at least one branch label.");for(const Y of R){if(typeof Y!="number"&&typeof Y!="string")return j.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return j.error("Numeric branch labels must be integer values.");if(p){if(j.checkSubtype(p,er(Y)))return null}else p=er(Y);if(b[String(Y)]!==void 0)return j.error("Branch labels must be unique.");b[String(Y)]=x.length}const H=c.parse(z,A,m);if(!H)return null;m=m||H.type,x.push(H)}const I=c.parse(o[1],1,rn);if(!I)return null;const T=c.parse(o[o.length-1],o.length-1,m);return T?I.type.kind!=="value"&&c.concat(1).checkSubtype(p,I.type)?null:new Tf(p,m,I,b,x,T):null}evaluate(o){const c=this.input.evaluate(o);return(er(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class Lf{constructor(o,c,p){this.type=o,this.branches=c,this.otherwise=p}static parse(o,c){if(o.length<4)return c.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return c.error("Expected an odd number of arguments.");let p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const m=[];for(let x=1;x<o.length-1;x+=2){const I=c.parse(o[x],x,on);if(!I)return null;const T=c.parse(o[x+1],x+1,p);if(!T)return null;m.push([I,T]),p=p||T.type}const b=c.parse(o[o.length-1],o.length-1,p);if(!b)return null;if(!p)throw new Error("Can't infer output type");return new Lf(p,m,b)}evaluate(o){for(const[c,p]of this.branches)if(c.evaluate(o))return p.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[c,p]of this.branches)o(c),o(p);o(this.otherwise)}outputDefined(){return this.branches.every(([o,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Jc{constructor(o,c,p,m){this.type=o,this.input=c,this.beginIndex=p,this.endIndex=m}static parse(o,c){if(o.length<=2||o.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const p=c.parse(o[1],1,rn),m=c.parse(o[2],2,ue);if(!p||!m)return null;if(!Ct(p.type,[K(rn),ln,rn]))return c.error(`Expected first argument to be of type array or string, but found ${nt(p.type)} instead`);if(o.length===4){const b=c.parse(o[3],3,ue);return b?new Jc(p.type,p,m,b):null}return new Jc(p.type,p,m)}evaluate(o){const c=this.input.evaluate(o),p=this.beginIndex.evaluate(o);if(!mt(c,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${nt(er(c))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(o);return c.slice(p,m)}return c.slice(p)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function Dd(l,o){return l==="=="||l==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Nd(l,o,c,p){return p.compare(o,c)===0}function iu(l,o,c){const p=l!=="=="&&l!=="!=";return class fx{constructor(b,x,I){this.type=on,this.lhs=b,this.rhs=x,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||x.type.kind==="value"}static parse(b,x){if(b.length!==3&&b.length!==4)return x.error("Expected two or three arguments.");const I=b[0];let T=x.parse(b[1],1,rn);if(!T)return null;if(!Dd(I,T.type))return x.concat(1).error(`"${I}" comparisons are not supported for type '${nt(T.type)}'.`);let A=x.parse(b[2],2,rn);if(!A)return null;if(!Dd(I,A.type))return x.concat(2).error(`"${I}" comparisons are not supported for type '${nt(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return x.error(`Cannot compare types '${nt(T.type)}' and '${nt(A.type)}'.`);p&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Bo(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Bo(T.type,[A])));let R=null;if(b.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(R=x.parse(b[3],3,_a),!R)return null}return new fx(T,A,R)}evaluate(b){const x=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const T=er(x),A=er(I);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new xi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const T=er(x),A=er(I);if(T.kind!=="string"||A.kind!=="string")return o(b,x,I)}return this.collator?c(b,x,I,this.collator.evaluate(b)):o(b,x,I)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Yg=iu("==",function(l,o,c){return o===c},Nd),Kg=iu("!=",function(l,o,c){return o!==c},function(l,o,c,p){return!Nd(0,o,c,p)}),Jg=iu("<",function(l,o,c){return o<c},function(l,o,c,p){return p.compare(o,c)<0}),Qg=iu(">",function(l,o,c){return o>c},function(l,o,c,p){return p.compare(o,c)>0}),t_=iu("<=",function(l,o,c){return o<=c},function(l,o,c,p){return p.compare(o,c)<=0}),e_=iu(">=",function(l,o,c){return o>=c},function(l,o,c,p){return p.compare(o,c)>=0});class Mf{constructor(o,c,p,m,b){this.type=ln,this.number=o,this.locale=c,this.currency=p,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(o,c){if(o.length!==3)return c.error("Expected two arguments.");const p=c.parse(o[1],1,ue);if(!p)return null;const m=o[2];if(typeof m!="object"||Array.isArray(m))return c.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=c.parse(m.locale,1,ln),!b))return null;let x=null;if(m.currency&&(x=c.parse(m.currency,1,ln),!x))return null;let I=null;if(m["min-fraction-digits"]&&(I=c.parse(m["min-fraction-digits"],1,ue),!I))return null;let T=null;return m["max-fraction-digits"]&&(T=c.parse(m["max-fraction-digits"],1,ue),!T)?null:new Mf(p,b,x,I,T)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class Qc{constructor(o){this.type=Vi,this.sections=o}static parse(o,c){if(o.length<2)return c.error("Expected at least one argument.");const p=o[1];if(!Array.isArray(p)&&typeof p=="object")return c.error("First argument must be an image or text section.");const m=[];let b=!1;for(let x=1;x<=o.length-1;++x){const I=o[x];if(b&&typeof I=="object"&&!Array.isArray(I)){b=!1;let T=null;if(I["font-scale"]&&(T=c.parse(I["font-scale"],1,ue),!T))return null;let A=null;if(I["text-font"]&&(A=c.parse(I["text-font"],1,K(ln)),!A))return null;let R=null;if(I["text-color"]&&(R=c.parse(I["text-color"],1,Ri),!R))return null;const z=m[m.length-1];z.scale=T,z.font=A,z.textColor=R}else{const T=c.parse(o[x],1,rn);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:T,scale:null,font:null,textColor:null})}}return new Qc(m)}evaluate(o){return new Fo(this.sections.map(c=>{const p=c.content.evaluate(o);return er(p)===G?new If("",p,null,null,null):new If(ju(p),null,c.scale?c.scale.evaluate(o):null,c.font?c.font.evaluate(o).join(","):null,c.textColor?c.textColor.evaluate(o):null)}))}eachChild(o){for(const c of this.sections)o(c.content),c.scale&&o(c.scale),c.font&&o(c.font),c.textColor&&o(c.textColor)}outputDefined(){return!1}}class Pf{constructor(o){this.type=G,this.input=o}static parse(o,c){if(o.length!==2)return c.error("Expected two arguments.");const p=c.parse(o[1],1,ln);return p?new Pf(p):c.error("No image name provided.")}evaluate(o){const c=this.input.evaluate(o),p=rs.fromString(c);return p&&o.availableImages&&(p.available=o.availableImages.indexOf(c)>-1),p}eachChild(o){o(this.input)}outputDefined(){return!1}}class kf{constructor(o){this.type=ue,this.input=o}static parse(o,c){if(o.length!==2)return c.error(`Expected 1 argument, but found ${o.length-1} instead.`);const p=c.parse(o[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${nt(p.type)} instead.`):new kf(p):null}evaluate(o){const c=this.input.evaluate(o);if(typeof c=="string"||Array.isArray(c))return c.length;throw new xi(`Expected value to be of type string or array, but found ${nt(er(c))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const ru={"==":Yg,"!=":Kg,">":Qg,"<":Jg,">=":e_,"<=":t_,array:Bo,at:Ef,boolean:Bo,case:Lf,coalesce:Xc,collator:nu,format:Qc,image:Pf,in:Cf,"index-of":Kc,interpolate:jr,"interpolate-hcl":jr,"interpolate-lab":jr,length:kf,let:Yc,literal:ja,match:Tf,number:Bo,"number-format":Mf,object:Bo,slice:Jc,step:Yu,string:Bo,"to-boolean":js,"to-color":js,"to-number":js,"to-string":js,var:Wc,within:vl};function Rd(l,[o,c,p,m]){o=o.evaluate(l),c=c.evaluate(l),p=p.evaluate(l);const b=m?m.evaluate(l):1,x=eu(o,c,p,b);if(x)throw new xi(x);return new qn(o/255,c/255,p/255,b,!1)}function zd(l,o){return l in o}function Af(l,o){const c=o[l];return c===void 0?null:c}function xl(l){return{type:l}}function Od(l){return{result:"success",value:l}}function ou(l){return{result:"error",value:l}}function su(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function Fd(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function Df(l){return!!l.expression&&l.expression.interpolated}function kn(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function th(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function n_(l){return l}function Bd(l,o){const c=o.type==="color",p=l.stops&&typeof l.stops[0][0]=="object",m=p||!(p||l.property!==void 0),b=l.type||(Df(o)?"exponential":"interval");if(c||o.type==="padding"){const R=c?qn.parse:So.parse;(l=es({},l)).stops&&(l.stops=l.stops.map(z=>[z[0],R(z[1])])),l.default=R(l.default?l.default:o.default)}if(l.colorSpace&&(x=l.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var x;let I,T,A;if(b==="exponential")I=Ln;else if(b==="interval")I=i_;else if(b==="categorical"){I=Ui,T=Object.create(null);for(const R of l.stops)T[R[0]]=R[1];A=typeof l.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);I=Nf}if(p){const R={},z=[];for(let Y=0;Y<l.stops.length;Y++){const tt=l.stops[Y],ot=tt[0].zoom;R[ot]===void 0&&(R[ot]={zoom:ot,type:l.type,property:l.property,default:l.default,stops:[]},z.push(ot)),R[ot].stops.push([tt[0].value,tt[1]])}const j=[];for(const Y of z)j.push([R[Y].zoom,Bd(R[Y],o)]);const H={name:"linear"};return{kind:"composite",interpolationType:H,interpolationFactor:jr.interpolationFactor.bind(void 0,H),zoomStops:j.map(Y=>Y[0]),evaluate:({zoom:Y},tt)=>Ln({stops:j,base:l.base},o,Y).evaluate(Y,tt)}}if(m){const R=b==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:jr.interpolationFactor.bind(void 0,R),zoomStops:l.stops.map(z=>z[0]),evaluate:({zoom:z})=>I(l,o,z,T,A)}}return{kind:"source",evaluate(R,z){const j=z&&z.properties?z.properties[l.property]:void 0;return j===void 0?Ku(l.default,o.default):I(l,o,j,T,A)}}}function Ku(l,o,c){return l!==void 0?l:o!==void 0?o:c!==void 0?c:void 0}function Ui(l,o,c,p,m){return Ku(typeof c===m?p[c]:void 0,l.default,o.default)}function i_(l,o,c){if(kn(c)!=="number")return Ku(l.default,o.default);const p=l.stops.length;if(p===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[p-1][0])return l.stops[p-1][1];const m=Xu(l.stops.map(b=>b[0]),c);return l.stops[m][1]}function Ln(l,o,c){const p=l.base!==void 0?l.base:1;if(kn(c)!=="number")return Ku(l.default,o.default);const m=l.stops.length;if(m===1||c<=l.stops[0][0])return l.stops[0][1];if(c>=l.stops[m-1][0])return l.stops[m-1][1];const b=Xu(l.stops.map(R=>R[0]),c),x=function(R,z,j,H){const Y=H-j,tt=R-j;return Y===0?0:z===1?tt/Y:(Math.pow(z,tt)-1)/(Math.pow(z,Y)-1)}(c,p,l.stops[b][0],l.stops[b+1][0]),I=l.stops[b][1],T=l.stops[b+1][1],A=ao[o.type]||n_;return typeof I.evaluate=="function"?{evaluate(...R){const z=I.evaluate.apply(void 0,R),j=T.evaluate.apply(void 0,R);if(z!==void 0&&j!==void 0)return A(z,j,x,l.colorSpace)}}:A(I,T,x,l.colorSpace)}function Nf(l,o,c){switch(o.type){case"color":c=qn.parse(c);break;case"formatted":c=Fo.fromString(c.toString());break;case"resolvedImage":c=rs.fromString(c.toString());break;case"padding":c=So.parse(c);break;default:kn(c)===o.type||o.type==="enum"&&o.values[c]||(c=void 0)}return Ku(c,l.default,o.default)}Vo.register(ru,{error:[{kind:"error"},[ln],(l,[o])=>{throw new xi(o.evaluate(l))}],typeof:[ln,[rn],(l,[o])=>nt(er(o.evaluate(l)))],"to-rgba":[K(ue,4),[Ri],(l,[o])=>{const[c,p,m,b]=o.evaluate(l).rgb;return[255*c,255*p,255*m,b]}],rgb:[Ri,[ue,ue,ue],Rd],rgba:[Ri,[ue,ue,ue,ue],Rd],has:{type:on,overloads:[[[ln],(l,[o])=>zd(o.evaluate(l),l.properties())],[[ln,ns],(l,[o,c])=>zd(o.evaluate(l),c.evaluate(l))]]},get:{type:rn,overloads:[[[ln],(l,[o])=>Af(o.evaluate(l),l.properties())],[[ln,ns],(l,[o,c])=>Af(o.evaluate(l),c.evaluate(l))]]},"feature-state":[rn,[ln],(l,[o])=>Af(o.evaluate(l),l.featureState||{})],properties:[ns,[],l=>l.properties()],"geometry-type":[ln,[],l=>l.geometryType()],id:[rn,[],l=>l.id()],zoom:[ue,[],l=>l.globals.zoom],"heatmap-density":[ue,[],l=>l.globals.heatmapDensity||0],"line-progress":[ue,[],l=>l.globals.lineProgress||0],accumulated:[rn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[ue,xl(ue),(l,o)=>{let c=0;for(const p of o)c+=p.evaluate(l);return c}],"*":[ue,xl(ue),(l,o)=>{let c=1;for(const p of o)c*=p.evaluate(l);return c}],"-":{type:ue,overloads:[[[ue,ue],(l,[o,c])=>o.evaluate(l)-c.evaluate(l)],[[ue],(l,[o])=>-o.evaluate(l)]]},"/":[ue,[ue,ue],(l,[o,c])=>o.evaluate(l)/c.evaluate(l)],"%":[ue,[ue,ue],(l,[o,c])=>o.evaluate(l)%c.evaluate(l)],ln2:[ue,[],()=>Math.LN2],pi:[ue,[],()=>Math.PI],e:[ue,[],()=>Math.E],"^":[ue,[ue,ue],(l,[o,c])=>Math.pow(o.evaluate(l),c.evaluate(l))],sqrt:[ue,[ue],(l,[o])=>Math.sqrt(o.evaluate(l))],log10:[ue,[ue],(l,[o])=>Math.log(o.evaluate(l))/Math.LN10],ln:[ue,[ue],(l,[o])=>Math.log(o.evaluate(l))],log2:[ue,[ue],(l,[o])=>Math.log(o.evaluate(l))/Math.LN2],sin:[ue,[ue],(l,[o])=>Math.sin(o.evaluate(l))],cos:[ue,[ue],(l,[o])=>Math.cos(o.evaluate(l))],tan:[ue,[ue],(l,[o])=>Math.tan(o.evaluate(l))],asin:[ue,[ue],(l,[o])=>Math.asin(o.evaluate(l))],acos:[ue,[ue],(l,[o])=>Math.acos(o.evaluate(l))],atan:[ue,[ue],(l,[o])=>Math.atan(o.evaluate(l))],min:[ue,xl(ue),(l,o)=>Math.min(...o.map(c=>c.evaluate(l)))],max:[ue,xl(ue),(l,o)=>Math.max(...o.map(c=>c.evaluate(l)))],abs:[ue,[ue],(l,[o])=>Math.abs(o.evaluate(l))],round:[ue,[ue],(l,[o])=>{const c=o.evaluate(l);return c<0?-Math.round(-c):Math.round(c)}],floor:[ue,[ue],(l,[o])=>Math.floor(o.evaluate(l))],ceil:[ue,[ue],(l,[o])=>Math.ceil(o.evaluate(l))],"filter-==":[on,[ln,rn],(l,[o,c])=>l.properties()[o.value]===c.value],"filter-id-==":[on,[rn],(l,[o])=>l.id()===o.value],"filter-type-==":[on,[ln],(l,[o])=>l.geometryType()===o.value],"filter-<":[on,[ln,rn],(l,[o,c])=>{const p=l.properties()[o.value],m=c.value;return typeof p==typeof m&&p<m}],"filter-id-<":[on,[rn],(l,[o])=>{const c=l.id(),p=o.value;return typeof c==typeof p&&c<p}],"filter->":[on,[ln,rn],(l,[o,c])=>{const p=l.properties()[o.value],m=c.value;return typeof p==typeof m&&p>m}],"filter-id->":[on,[rn],(l,[o])=>{const c=l.id(),p=o.value;return typeof c==typeof p&&c>p}],"filter-<=":[on,[ln,rn],(l,[o,c])=>{const p=l.properties()[o.value],m=c.value;return typeof p==typeof m&&p<=m}],"filter-id-<=":[on,[rn],(l,[o])=>{const c=l.id(),p=o.value;return typeof c==typeof p&&c<=p}],"filter->=":[on,[ln,rn],(l,[o,c])=>{const p=l.properties()[o.value],m=c.value;return typeof p==typeof m&&p>=m}],"filter-id->=":[on,[rn],(l,[o])=>{const c=l.id(),p=o.value;return typeof c==typeof p&&c>=p}],"filter-has":[on,[rn],(l,[o])=>o.value in l.properties()],"filter-has-id":[on,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[on,[K(ln)],(l,[o])=>o.value.indexOf(l.geometryType())>=0],"filter-id-in":[on,[K(rn)],(l,[o])=>o.value.indexOf(l.id())>=0],"filter-in-small":[on,[ln,K(rn)],(l,[o,c])=>c.value.indexOf(l.properties()[o.value])>=0],"filter-in-large":[on,[ln,K(rn)],(l,[o,c])=>function(p,m,b,x){for(;b<=x;){const I=b+x>>1;if(m[I]===p)return!0;m[I]>p?x=I-1:b=I+1}return!1}(l.properties()[o.value],c.value,0,c.value.length-1)],all:{type:on,overloads:[[[on,on],(l,[o,c])=>o.evaluate(l)&&c.evaluate(l)],[xl(on),(l,o)=>{for(const c of o)if(!c.evaluate(l))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],(l,[o,c])=>o.evaluate(l)||c.evaluate(l)],[xl(on),(l,o)=>{for(const c of o)if(c.evaluate(l))return!0;return!1}]]},"!":[on,[on],(l,[o])=>!o.evaluate(l)],"is-supported-script":[on,[ln],(l,[o])=>{const c=l.globals&&l.globals.isSupportedScript;return!c||c(o.evaluate(l))}],upcase:[ln,[ln],(l,[o])=>o.evaluate(l).toUpperCase()],downcase:[ln,[ln],(l,[o])=>o.evaluate(l).toLowerCase()],concat:[ln,xl(rn),(l,o)=>o.map(c=>ju(c.evaluate(l))).join("")],"resolved-locale":[ln,[_a],(l,[o])=>o.evaluate(l).resolvedLocale()]});class ui{constructor(o,c){var p;this.expression=o,this._warningHistory={},this._evaluator=new Zn,this._defaultValue=c?(p=c).type==="color"&&th(p.default)?new qn(0,0,0,0):p.type==="color"?qn.parse(p.default)||null:p.type==="padding"?So.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?is.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(o,c,p,m,b,x){return this._evaluator.globals=o,this._evaluator.feature=c,this._evaluator.featureState=p,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(o,c,p,m,b,x){this._evaluator.globals=o,this._evaluator.feature=c||null,this._evaluator.featureState=p||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=x||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(I.message)),this._defaultValue}}}function ni(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in ru}function wl(l,o){const c=new Uc(ru,Wu,[],o?function(m){const b={color:Ri,string:ln,number:ue,enum:ln,boolean:on,formatted:Vi,padding:st,resolvedImage:G,variableAnchorOffsetCollection:Z};return m.type==="array"?K(b[m.value]||rn,m.length):b[m.type]}(o):void 0),p=c.parse(l,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Od(new ui(p,o)):ou(c.errors)}class eh{constructor(o,c){this.kind=o,this._styleExpression=c,this.isStateDependent=o!=="constant"&&!Hu(c.expression)}evaluateWithoutErrorHandling(o,c,p,m,b,x){return this._styleExpression.evaluateWithoutErrorHandling(o,c,p,m,b,x)}evaluate(o,c,p,m,b,x){return this._styleExpression.evaluate(o,c,p,m,b,x)}}class Rf{constructor(o,c,p,m){this.kind=o,this.zoomStops=p,this._styleExpression=c,this.isStateDependent=o!=="camera"&&!Hu(c.expression),this.interpolationType=m}evaluateWithoutErrorHandling(o,c,p,m,b,x){return this._styleExpression.evaluateWithoutErrorHandling(o,c,p,m,b,x)}evaluate(o,c,p,m,b,x){return this._styleExpression.evaluate(o,c,p,m,b,x)}interpolationFactor(o,c,p){return this.interpolationType?jr.interpolationFactor(this.interpolationType,o,c,p):0}}function Vd(l,o){const c=wl(l,o);if(c.result==="error")return c;const p=c.value.expression,m=Hc(p);if(!m&&!su(o))return ou([new oo("","data expressions not supported")]);const b=$u(p,["zoom"]);if(!b&&!Fd(o))return ou([new oo("","zoom expressions not supported")]);const x=ih(p);return x||b?x instanceof oo?ou([x]):x instanceof jr&&!Df(o)?ou([new oo("",'"interpolate" expressions cannot be used with this property')]):Od(x?new Rf(m?"camera":"composite",c.value,x.labels,x instanceof jr?x.interpolation:void 0):new eh(m?"constant":"source",c.value)):ou([new oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nh{constructor(o,c){this._parameters=o,this._specification=c,es(this,Bd(this._parameters,this._specification))}static deserialize(o){return new nh(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function ih(l){let o=null;if(l instanceof Yc)o=ih(l.result);else if(l instanceof Xc){for(const c of l.args)if(o=ih(c),o)break}else(l instanceof Yu||l instanceof jr)&&l.input instanceof Vo&&l.input.name==="zoom"&&(o=l);return o instanceof oo||l.eachChild(c=>{const p=ih(c);p instanceof oo?o=p:!o&&p?o=new oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&p&&o!==p&&(o=new oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function rh(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const o of l.slice(1))if(!rh(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const Ud={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function oh(l){if(l==null)return{filter:()=>!0,needGeometry:!1};rh(l)||(l=ah(l));const o=wl(l,Ud);if(o.result==="error")throw new Error(o.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,p,m)=>o.value.evaluate(c,p,{},m),needGeometry:sh(l)}}function Gd(l,o){return l<o?-1:l>o?1:0}function sh(l){if(!Array.isArray(l))return!1;if(l[0]==="within")return!0;for(let o=1;o<l.length;o++)if(sh(l[o]))return!0;return!1}function ah(l){if(!l)return!0;const o=l[0];return l.length<=1?o!=="any":o==="=="?zf(l[1],l[2],"=="):o==="!="?lh(zf(l[1],l[2],"==")):o==="<"||o===">"||o==="<="||o===">="?zf(l[1],l[2],o):o==="any"?(c=l.slice(1),["any"].concat(c.map(ah))):o==="all"?["all"].concat(l.slice(1).map(ah)):o==="none"?["all"].concat(l.slice(1).map(ah).map(lh)):o==="in"?jd(l[1],l.slice(2)):o==="!in"?lh(jd(l[1],l.slice(2))):o==="has"?qd(l[1]):o==="!has"?lh(qd(l[1])):o!=="within"||l;var c}function zf(l,o,c){switch(l){case"$type":return[`filter-type-${c}`,o];case"$id":return[`filter-id-${c}`,o];default:return[`filter-${c}`,l,o]}}function jd(l,o){if(o.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(c=>typeof c!=typeof o[0])?["filter-in-large",l,["literal",o.sort(Gd)]]:["filter-in-small",l,["literal",o]]}}function qd(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function lh(l){return["!",l]}function Of(l){const o=typeof l;if(o==="number"||o==="boolean"||o==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let m="[";for(const b of l)m+=`${Of(b)},`;return`${m}]`}const c=Object.keys(l).sort();let p="{";for(let m=0;m<c.length;m++)p+=`${JSON.stringify(c[m])}:${Of(l[c[m]])},`;return`${p}}`}function r_(l){let o="";for(const c of yn)o+=`/${Of(l[c])}`;return o}function Zd(l){const o=l.value;return o?[new se(l.key,o,"constants have been deprecated as of v8")]:[]}function Ti(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Za(l){if(Array.isArray(l))return l.map(Za);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const o={};for(const c in l)o[c]=Za(l[c]);return o}return Ti(l)}function lo(l){const o=l.key,c=l.value,p=l.valueSpec||{},m=l.objectElementValidators||{},b=l.style,x=l.styleSpec,I=l.validateSpec;let T=[];const A=kn(c);if(A!=="object")return[new se(o,c,`object expected, ${A} found`)];for(const R in c){const z=R.split(".")[0],j=p[z]||p["*"];let H;if(m[z])H=m[z];else if(p[z])H=I;else if(m["*"])H=m["*"];else{if(!p["*"]){T.push(new se(o,c[R],`unknown property "${R}"`));continue}H=I}T=T.concat(H({key:(o&&`${o}.`)+R,value:c[R],valueSpec:j,style:b,styleSpec:x,object:c,objectKey:R,validateSpec:I},c))}for(const R in p)m[R]||p[R].required&&p[R].default===void 0&&c[R]===void 0&&T.push(new se(o,c,`missing required property "${R}"`));return T}function Ff(l){const o=l.value,c=l.valueSpec,p=l.style,m=l.styleSpec,b=l.key,x=l.arrayElementValidator||l.validateSpec;if(kn(o)!=="array")return[new se(b,o,`array expected, ${kn(o)} found`)];if(c.length&&o.length!==c.length)return[new se(b,o,`array length ${c.length} expected, length ${o.length} found`)];if(c["min-length"]&&o.length<c["min-length"])return[new se(b,o,`array length at least ${c["min-length"]} expected, length ${o.length} found`)];let I={type:c.value,values:c.values};m.$version<7&&(I.function=c.function),kn(c.value)==="object"&&(I=c.value);let T=[];for(let A=0;A<o.length;A++)T=T.concat(x({array:o,arrayIndex:A,value:o[A],valueSpec:I,validateSpec:l.validateSpec,style:p,styleSpec:m,key:`${b}[${A}]`}));return T}function uh(l){const o=l.key,c=l.value,p=l.valueSpec;let m=kn(c);return m==="number"&&c!=c&&(m="NaN"),m!=="number"?[new se(o,c,`number expected, ${m} found`)]:"minimum"in p&&c<p.minimum?[new se(o,c,`${c} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&c>p.maximum?[new se(o,c,`${c} is greater than the maximum value ${p.maximum}`)]:[]}function Wd(l){const o=l.valueSpec,c=Ti(l.value.type);let p,m,b,x={};const I=c!=="categorical"&&l.value.property===void 0,T=!I,A=kn(l.value.stops)==="array"&&kn(l.value.stops[0])==="array"&&kn(l.value.stops[0][0])==="object",R=lo({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(H){if(c==="identity")return[new se(H.key,H.value,'identity function may not have a "stops" property')];let Y=[];const tt=H.value;return Y=Y.concat(Ff({key:H.key,value:tt,valueSpec:H.valueSpec,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:z})),kn(tt)==="array"&&tt.length===0&&Y.push(new se(H.key,tt,"array must have at least one stop")),Y},default:function(H){return H.validateSpec({key:H.key,value:H.value,valueSpec:o,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec})}}});return c==="identity"&&I&&R.push(new se(l.key,l.value,'missing required property "property"')),c==="identity"||l.value.stops||R.push(new se(l.key,l.value,'missing required property "stops"')),c==="exponential"&&l.valueSpec.expression&&!Df(l.valueSpec)&&R.push(new se(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(T&&!su(l.valueSpec)?R.push(new se(l.key,l.value,"property functions not supported")):I&&!Fd(l.valueSpec)&&R.push(new se(l.key,l.value,"zoom functions not supported"))),c!=="categorical"&&!A||l.value.property!==void 0||R.push(new se(l.key,l.value,'"property" property is required')),R;function z(H){let Y=[];const tt=H.value,ot=H.key;if(kn(tt)!=="array")return[new se(ot,tt,`array expected, ${kn(tt)} found`)];if(tt.length!==2)return[new se(ot,tt,`array length 2 expected, length ${tt.length} found`)];if(A){if(kn(tt[0])!=="object")return[new se(ot,tt,`object expected, ${kn(tt[0])} found`)];if(tt[0].zoom===void 0)return[new se(ot,tt,"object stop key must have zoom")];if(tt[0].value===void 0)return[new se(ot,tt,"object stop key must have value")];if(b&&b>Ti(tt[0].zoom))return[new se(ot,tt[0].zoom,"stop zoom values must appear in ascending order")];Ti(tt[0].zoom)!==b&&(b=Ti(tt[0].zoom),m=void 0,x={}),Y=Y.concat(lo({key:`${ot}[0]`,value:tt[0],valueSpec:{zoom:{}},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:uh,value:j}}))}else Y=Y.concat(j({key:`${ot}[0]`,value:tt[0],valueSpec:{},validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec},tt));return ni(Za(tt[1]))?Y.concat([new se(`${ot}[1]`,tt[1],"expressions are not allowed in function stops.")]):Y.concat(H.validateSpec({key:`${ot}[1]`,value:tt[1],valueSpec:o,validateSpec:H.validateSpec,style:H.style,styleSpec:H.styleSpec}))}function j(H,Y){const tt=kn(H.value),ot=Ti(H.value),dt=H.value!==null?H.value:Y;if(p){if(tt!==p)return[new se(H.key,dt,`${tt} stop domain type must match previous stop domain type ${p}`)]}else p=tt;if(tt!=="number"&&tt!=="string"&&tt!=="boolean")return[new se(H.key,dt,"stop domain value must be a number, string, or boolean")];if(tt!=="number"&&c!=="categorical"){let Dt=`number expected, ${tt} found`;return su(o)&&c===void 0&&(Dt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new se(H.key,dt,Dt)]}return c!=="categorical"||tt!=="number"||isFinite(ot)&&Math.floor(ot)===ot?c!=="categorical"&&tt==="number"&&m!==void 0&&ot<m?[new se(H.key,dt,"stop domain values must appear in ascending order")]:(m=ot,c==="categorical"&&ot in x?[new se(H.key,dt,"stop domain values must be unique")]:(x[ot]=!0,[])):[new se(H.key,dt,`integer expected, found ${ot}`)]}}function Wa(l){const o=(l.expressionContext==="property"?Vd:wl)(Za(l.value),l.valueSpec);if(o.result==="error")return o.value.map(p=>new se(`${l.key}${p.key}`,l.value,p.message));const c=o.value.expression||o.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!c.outputDefined())return[new se(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!Hu(c))return[new se(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!Hu(c))return[new se(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!$u(c,["zoom","feature-state"]))return[new se(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!Hc(c))return[new se(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ha(l){const o=l.key,c=l.value,p=l.valueSpec,m=[];return Array.isArray(p.values)?p.values.indexOf(Ti(c))===-1&&m.push(new se(o,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(Ti(c))===-1&&m.push(new se(o,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),m}function au(l){return rh(Za(l.value))?Wa(es({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ch(l)}function ch(l){const o=l.value,c=l.key;if(kn(o)!=="array")return[new se(c,o,`array expected, ${kn(o)} found`)];const p=l.styleSpec;let m,b=[];if(o.length<1)return[new se(c,o,"filter array must have at least 1 element")];switch(b=b.concat(Ha({key:`${c}[0]`,value:o[0],valueSpec:p.filter_operator,style:l.style,styleSpec:l.styleSpec})),Ti(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&Ti(o[1])==="$type"&&b.push(new se(c,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&b.push(new se(c,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(m=kn(o[1]),m!=="string"&&b.push(new se(`${c}[1]`,o[1],`string expected, ${m} found`)));for(let x=2;x<o.length;x++)m=kn(o[x]),Ti(o[1])==="$type"?b=b.concat(Ha({key:`${c}[${x}]`,value:o[x],valueSpec:p.geometry_type,style:l.style,styleSpec:l.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new se(`${c}[${x}]`,o[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)b=b.concat(ch({key:`${c}[${x}]`,value:o[x],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":m=kn(o[1]),o.length!==2?b.push(new se(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new se(`${c}[1]`,o[1],`string expected, ${m} found`));break;case"within":m=kn(o[1]),o.length!==2?b.push(new se(c,o,`filter array for "${o[0]}" operator must have 2 elements`)):m!=="object"&&b.push(new se(`${c}[1]`,o[1],`object expected, ${m} found`))}return b}function Bf(l,o){const c=l.key,p=l.validateSpec,m=l.style,b=l.styleSpec,x=l.value,I=l.objectKey,T=b[`${o}_${l.layerType}`];if(!T)return[];const A=I.match(/^(.*)-transition$/);if(o==="paint"&&A&&T[A[1]]&&T[A[1]].transition)return p({key:c,value:x,valueSpec:b.transition,style:m,styleSpec:b});const R=l.valueSpec||T[I];if(!R)return[new se(c,x,`unknown property "${I}"`)];let z;if(kn(x)==="string"&&su(R)&&!R.tokens&&(z=/^{([^}]+)}$/.exec(x)))return[new se(c,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const j=[];return l.layerType==="symbol"&&(I==="text-field"&&m&&!m.glyphs&&j.push(new se(c,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&th(Za(x))&&Ti(x.type)==="identity"&&j.push(new se(c,x,'"text-font" does not support identity functions'))),j.concat(p({key:l.key,value:x,valueSpec:R,style:m,styleSpec:b,expressionContext:"property",propertyType:o,propertyKey:I}))}function Vf(l){return Bf(l,"paint")}function Ju(l){return Bf(l,"layout")}function Hd(l){let o=[];const c=l.value,p=l.key,m=l.style,b=l.styleSpec;c.type||c.ref||o.push(new se(p,c,'either "type" or "ref" is required'));let x=Ti(c.type);const I=Ti(c.ref);if(c.id){const T=Ti(c.id);for(let A=0;A<l.arrayIndex;A++){const R=m.layers[A];Ti(R.id)===T&&o.push(new se(p,c.id,`duplicate layer id "${c.id}", previously used at line ${R.id.__line__}`))}}if("ref"in c){let T;["type","source","source-layer","filter","layout"].forEach(A=>{A in c&&o.push(new se(p,c[A],`"${A}" is prohibited for ref layers`))}),m.layers.forEach(A=>{Ti(A.id)===I&&(T=A)}),T?T.ref?o.push(new se(p,c.ref,"ref cannot reference another ref layer")):x=Ti(T.type):o.push(new se(p,c.ref,`ref layer "${I}" not found`))}else if(x!=="background")if(c.source){const T=m.sources&&m.sources[c.source],A=T&&Ti(T.type);T?A==="vector"&&x==="raster"?o.push(new se(p,c.source,`layer "${c.id}" requires a raster source`)):A!=="raster-dem"&&x==="hillshade"?o.push(new se(p,c.source,`layer "${c.id}" requires a raster-dem source`)):A==="raster"&&x!=="raster"?o.push(new se(p,c.source,`layer "${c.id}" requires a vector source`)):A!=="vector"||c["source-layer"]?A==="raster-dem"&&x!=="hillshade"?o.push(new se(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||A==="geojson"&&T.lineMetrics||o.push(new se(p,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new se(p,c,`layer "${c.id}" must specify a "source-layer"`)):o.push(new se(p,c.source,`source "${c.source}" not found`))}else o.push(new se(p,c,'missing required property "source"'));return o=o.concat(lo({key:p,value:c,valueSpec:b.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${p}.type`,value:c.type,valueSpec:b.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:c,objectKey:"type"}),filter:au,layout:T=>lo({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":A=>Ju(es({layerType:x},A))}}),paint:T=>lo({layer:c,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":A=>Vf(es({layerType:x},A))}})}})),o}function Sl(l){const o=l.value,c=l.key,p=kn(o);return p!=="string"?[new se(c,o,`string expected, ${p} found`)]:[]}const $d={promoteId:function({key:l,value:o}){if(kn(o)==="string")return Sl({key:l,value:o});{const c=[];for(const p in o)c.push(...Sl({key:`${l}.${p}`,value:o[p]}));return c}}};function Xd(l){const o=l.value,c=l.key,p=l.styleSpec,m=l.style,b=l.validateSpec;if(!o.type)return[new se(c,o,'"type" is required')];const x=Ti(o.type);let I;switch(x){case"vector":case"raster":return I=lo({key:c,value:o,valueSpec:p[`source_${x.replace("-","_")}`],style:l.style,styleSpec:p,objectElementValidators:$d,validateSpec:b}),I;case"raster-dem":return I=function(T){var A;const R=(A=T.sourceName)!==null&&A!==void 0?A:"",z=T.value,j=T.styleSpec,H=j.source_raster_dem,Y=T.style;let tt=[];const ot=kn(z);if(z===void 0)return tt;if(ot!=="object")return tt.push(new se("source_raster_dem",z,`object expected, ${ot} found`)),tt;const dt=Ti(z.encoding)==="custom",Dt=["redFactor","greenFactor","blueFactor","baseShift"],bt=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const Lt in z)!dt&&Dt.includes(Lt)?tt.push(new se(Lt,z[Lt],`In "${R}": "${Lt}" is only valid when "encoding" is set to "custom". ${bt} encoding found`)):H[Lt]?tt=tt.concat(T.validateSpec({key:Lt,value:z[Lt],valueSpec:H[Lt],validateSpec:T.validateSpec,style:Y,styleSpec:j})):tt.push(new se(Lt,z[Lt],`unknown property "${Lt}"`));return tt}({sourceName:c,value:o,style:l.style,styleSpec:p,validateSpec:b}),I;case"geojson":if(I=lo({key:c,value:o,valueSpec:p.source_geojson,style:m,styleSpec:p,validateSpec:b,objectElementValidators:$d}),o.cluster)for(const T in o.clusterProperties){const[A,R]=o.clusterProperties[T],z=typeof A=="string"?[A,["accumulated"],["get",T]]:A;I.push(...Wa({key:`${c}.${T}.map`,value:R,validateSpec:b,expressionContext:"cluster-map"})),I.push(...Wa({key:`${c}.${T}.reduce`,value:z,validateSpec:b,expressionContext:"cluster-reduce"}))}return I;case"video":return lo({key:c,value:o,valueSpec:p.source_video,style:m,validateSpec:b,styleSpec:p});case"image":return lo({key:c,value:o,valueSpec:p.source_image,style:m,validateSpec:b,styleSpec:p});case"canvas":return[new se(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ha({key:`${c}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,validateSpec:b,styleSpec:p})}}function Yd(l){const o=l.value,c=l.styleSpec,p=c.light,m=l.style;let b=[];const x=kn(o);if(o===void 0)return b;if(x!=="object")return b=b.concat([new se("light",o,`object expected, ${x} found`)]),b;for(const I in o){const T=I.match(/^(.*)-transition$/);b=b.concat(T&&p[T[1]]&&p[T[1]].transition?l.validateSpec({key:I,value:o[I],valueSpec:c.transition,validateSpec:l.validateSpec,style:m,styleSpec:c}):p[I]?l.validateSpec({key:I,value:o[I],valueSpec:p[I],validateSpec:l.validateSpec,style:m,styleSpec:c}):[new se(I,o[I],`unknown property "${I}"`)])}return b}function Qu(l){const o=l.value,c=l.styleSpec,p=c.sky,m=l.style,b=kn(o);if(o===void 0)return[];if(b!=="object")return[new se("sky",o,`object expected, ${b} found`)];let x=[];for(const I in o)x=x.concat(p[I]?Il({key:I,value:o[I],valueSpec:p[I],style:m,styleSpec:c}):[new se(I,o[I],`unknown property "${I}"`)]);return x}function tc(l){const o=l.value,c=l.styleSpec,p=c.terrain,m=l.style;let b=[];const x=kn(o);if(o===void 0)return b;if(x!=="object")return b=b.concat([new se("terrain",o,`object expected, ${x} found`)]),b;for(const I in o)b=b.concat(p[I]?l.validateSpec({key:I,value:o[I],valueSpec:p[I],validateSpec:l.validateSpec,style:m,styleSpec:c}):[new se(I,o[I],`unknown property "${I}"`)]);return b}function Io(l){let o=[];const c=l.value,p=l.key;if(Array.isArray(c)){const m=[],b=[];for(const x in c)c[x].id&&m.includes(c[x].id)&&o.push(new se(p,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),m.push(c[x].id),c[x].url&&b.includes(c[x].url)&&o.push(new se(p,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),b.push(c[x].url),o=o.concat(lo({key:`${p}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return o}return Sl({key:p,value:c})}const lu={"*":()=>[],array:Ff,boolean:function(l){const o=l.value,c=l.key,p=kn(o);return p!=="boolean"?[new se(c,o,`boolean expected, ${p} found`)]:[]},number:uh,color:function(l){const o=l.key,c=l.value,p=kn(c);return p!=="string"?[new se(o,c,`color expected, ${p} found`)]:qn.parse(String(c))?[]:[new se(o,c,`color expected, "${c}" found`)]},constants:Zd,enum:Ha,filter:au,function:Wd,layer:Hd,object:lo,source:Xd,light:Yd,sky:Qu,terrain:tc,string:Sl,formatted:function(l){return Sl(l).length===0?[]:Wa(l)},resolvedImage:function(l){return Sl(l).length===0?[]:Wa(l)},padding:function(l){const o=l.key,c=l.value;if(kn(c)==="array"){if(c.length<1||c.length>4)return[new se(o,c,`padding requires 1 to 4 values; ${c.length} values found`)];const p={type:"number"};let m=[];for(let b=0;b<c.length;b++)m=m.concat(l.validateSpec({key:`${o}[${b}]`,value:c[b],validateSpec:l.validateSpec,valueSpec:p}));return m}return uh({key:o,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(l){const o=l.key,c=l.value,p=kn(c),m=l.styleSpec;if(p!=="array"||c.length<1||c.length%2!=0)return[new se(o,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let x=0;x<c.length;x+=2)b=b.concat(Ha({key:`${o}[${x}]`,value:c[x],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(Ff({key:`${o}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:m}));return b},sprite:Io};function Il(l){const o=l.value,c=l.valueSpec,p=l.styleSpec;return l.validateSpec=Il,c.expression&&th(Ti(o))?Wd(l):c.expression&&ni(Za(o))?Wa(l):c.type&&lu[c.type]?lu[c.type](l):lo(es({},l,{valueSpec:c.type?p[c.type]:c}))}function Kd(l){const o=l.value,c=l.key,p=Sl(l);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new se(c,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new se(c,o,'"glyphs" url must include a "{range}" token'))),p}function xs(l,o=Bt){let c=[];return c=c.concat(Il({key:"",value:l,valueSpec:o.$root,styleSpec:o,style:l,validateSpec:Il,objectElementValidators:{glyphs:Kd,"*":()=>[]}})),l.constants&&(c=c.concat(Zd({key:"constants",value:l.constants,style:l,styleSpec:o,validateSpec:Il}))),Uf(c)}function Eo(l){return function(o){return l({...o,validateSpec:Il})}}function Uf(l){return[].concat(l).sort((o,c)=>o.line-c.line)}function os(l){return function(...o){return Uf(l.apply(this,o))}}xs.source=os(Eo(Xd)),xs.sprite=os(Eo(Io)),xs.glyphs=os(Eo(Kd)),xs.light=os(Eo(Yd)),xs.sky=os(Eo(Qu)),xs.terrain=os(Eo(tc)),xs.layer=os(Eo(Hd)),xs.filter=os(Eo(au)),xs.paintProperty=os(Eo(Vf)),xs.layoutProperty=os(Eo(Ju));const ec=xs,Gf=ec.light,o_=ec.paintProperty,nc=ec.layoutProperty;function Jd(l,o){let c=!1;if(o&&o.length)for(const p of o)l.fire(new Le(new Error(p.message))),c=!0;return c}class El{constructor(o,c,p){const m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const x=new Int32Array(this.arrayBuffer);o=x[0],this.d=(c=x[1])+2*(p=x[2]);for(let T=0;T<this.d*this.d;T++){const A=x[3+T],R=x[3+T+1];m.push(A===R?null:x.subarray(A,R))}const I=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=c+2*p;for(let x=0;x<this.d*this.d;x++)m.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=o,this.padding=p,this.scale=c/o,this.uid=0;const b=p/c*o;this.min=-b,this.max=o+b}insert(o,c,p,m,b){this._forEachCell(c,p,m,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,c,p,m,b,x){this.cells[b].push(x)}query(o,c,p,m,b){const x=this.min,I=this.max;if(o<=x&&c<=x&&I<=p&&I<=m&&!b)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(o,c,p,m,this._queryCell,T,{},b),T}}_queryCell(o,c,p,m,b,x,I,T){const A=this.cells[b];if(A!==null){const R=this.keys,z=this.bboxes;for(let j=0;j<A.length;j++){const H=A[j];if(I[H]===void 0){const Y=4*H;(T?T(z[Y+0],z[Y+1],z[Y+2],z[Y+3]):o<=z[Y+2]&&c<=z[Y+3]&&p>=z[Y+0]&&m>=z[Y+1])?(I[H]=!0,x.push(R[H])):I[H]=!1}}}}_forEachCell(o,c,p,m,b,x,I,T){const A=this._convertToCellCoord(o),R=this._convertToCellCoord(c),z=this._convertToCellCoord(p),j=this._convertToCellCoord(m);for(let H=A;H<=z;H++)for(let Y=R;Y<=j;Y++){const tt=this.d*Y+H;if((!T||T(this._convertFromCellCoord(H),this._convertFromCellCoord(Y),this._convertFromCellCoord(H+1),this._convertFromCellCoord(Y+1)))&&b.call(this,o,c,p,m,tt,x,I,T))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,c=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const m=new Int32Array(c+p+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;let b=c;for(let x=0;x<o.length;x++){const I=o[x];m[3+x]=b,m.set(I,b),b+=I.length}return m[3+o.length]=b,m.set(this.keys,b),b+=this.keys.length,m[3+o.length+1]=b,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer}static serialize(o,c){const p=o.toArrayBuffer();return c&&c.push(p),{buffer:p}}static deserialize(o){return new El(o.buffer)}}const ya={};function xe(l,o,c={}){if(ya[l])throw new Error(`${l} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:l,writeable:!1}),ya[l]={klass:o,omit:c.omit||[],shallow:c.shallow||[]}}xe("Object",Object),xe("TransferableGridIndex",El),xe("Color",qn),xe("Error",Error),xe("AJAXError",ne),xe("ResolvedImage",rs),xe("StylePropertyFunction",nh),xe("StyleExpression",ui,{omit:["_evaluator"]}),xe("ZoomDependentExpression",Rf),xe("ZoomConstantExpression",eh),xe("CompoundExpression",Vo,{omit:["_evaluate"]});for(const l in ru)ru[l]._classRegistryKey||xe(`Expression_${l}`,ru[l]);function jf(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function uu(l,o){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error)return l;if(jf(l)||Ee(l))return o&&o.push(l),l;if(ArrayBuffer.isView(l)){const c=l;return o&&o.push(c.buffer),c}if(l instanceof ImageData)return o&&o.push(l.data.buffer),l;if(Array.isArray(l)){const c=[];for(const p of l)c.push(uu(p,o));return c}if(typeof l=="object"){const c=l.constructor,p=c._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!ya[p])throw new Error(`${p} is not registered.`);const m=c.serialize?c.serialize(l,o):{};if(c.serialize){if(o&&m===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in l){if(!l.hasOwnProperty(b)||ya[p].omit.indexOf(b)>=0)continue;const x=l[b];m[b]=ya[p].shallow.indexOf(b)>=0?x:uu(x,o)}l instanceof Error&&(m.message=l.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(m.$name=p),m}throw new Error("can't serialize object of type "+typeof l)}function ic(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||jf(l)||Ee(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(ic);if(typeof l=="object"){const o=l.$name||"Object";if(!ya[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:c}=ya[o];if(!c)throw new Error(`can't deserialize unregistered class ${o}`);if(c.deserialize)return c.deserialize(l);const p=Object.create(c.prototype);for(const m of Object.keys(l)){if(m==="$name")continue;const b=l[m];p[m]=ya[o].shallow.indexOf(m)>=0?b:ic(b)}return p}throw new Error("can't deserialize object of type "+typeof l)}class hh{constructor(){this.first=!0}update(o,c){const p=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=c),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=p,!0))}}const _e={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function fh(l){for(const o of l)if(ph(o.charCodeAt(0)))return!0;return!1}function Qd(l){for(const o of l)if(!tm(o.charCodeAt(0)))return!1;return!0}function tm(l){return!(_e.Arabic(l)||_e["Arabic Supplement"](l)||_e["Arabic Extended-A"](l)||_e["Arabic Presentation Forms-A"](l)||_e["Arabic Presentation Forms-B"](l))}function ph(l){return!(l!==746&&l!==747&&(l<4352||!(_e["Bopomofo Extended"](l)||_e.Bopomofo(l)||_e["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||_e["CJK Compatibility Ideographs"](l)||_e["CJK Compatibility"](l)||_e["CJK Radicals Supplement"](l)||_e["CJK Strokes"](l)||!(!_e["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||_e["CJK Unified Ideographs Extension A"](l)||_e["CJK Unified Ideographs"](l)||_e["Enclosed CJK Letters and Months"](l)||_e["Hangul Compatibility Jamo"](l)||_e["Hangul Jamo Extended-A"](l)||_e["Hangul Jamo Extended-B"](l)||_e["Hangul Jamo"](l)||_e["Hangul Syllables"](l)||_e.Hiragana(l)||_e["Ideographic Description Characters"](l)||_e.Kanbun(l)||_e["Kangxi Radicals"](l)||_e["Katakana Phonetic Extensions"](l)||_e.Katakana(l)&&l!==12540||!(!_e["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!_e["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||_e["Unified Canadian Aboriginal Syllabics"](l)||_e["Unified Canadian Aboriginal Syllabics Extended"](l)||_e["Vertical Forms"](l)||_e["Yijing Hexagram Symbols"](l)||_e["Yi Syllables"](l)||_e["Yi Radicals"](l))))}function dh(l){return!(ph(l)||function(o){return!!(_e["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||_e["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||_e["Letterlike Symbols"](o)||_e["Number Forms"](o)||_e["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||_e["Control Pictures"](o)&&o!==9251||_e["Optical Character Recognition"](o)||_e["Enclosed Alphanumerics"](o)||_e["Geometric Shapes"](o)||_e["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||_e["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||_e["CJK Symbols and Punctuation"](o)||_e.Katakana(o)||_e["Private Use Area"](o)||_e["CJK Compatibility Forms"](o)||_e["Small Form Variants"](o)||_e["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(l))}function qf(l){return l>=1424&&l<=2303||_e["Arabic Presentation Forms-A"](l)||_e["Arabic Presentation Forms-B"](l)}function s_(l,o){return!(!o&&qf(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||_e.Khmer(l))}function em(l){for(const o of l)if(qf(o.charCodeAt(0)))return!0;return!1}const Cl=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}setMethods(l){this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ci{constructor(o,c){this.zoom=o,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hh,this.transition={})}isSupportedScript(o){return function(c,p){for(const m of c)if(!s_(m.charCodeAt(0),p))return!1;return!0}(o,Cl.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,c=o-Math.floor(o),p=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*c}}}class rc{constructor(o,c){this.property=o,this.value=c,this.expression=function(p,m){if(th(p))return new nh(p,m);if(ni(p)){const b=Vd(p,m);if(b.result==="error")throw new Error(b.value.map(x=>`${x.key}: ${x.message}`).join(", "));return b.value}{let b=p;return m.type==="color"&&typeof p=="string"?b=qn.parse(p):m.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(b=is.parse(p)):b=So.parse(p),{kind:"constant",evaluate:()=>b}}}(c===void 0?o.specification.default:c,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,c,p){return this.property.possiblyEvaluate(this,o,c,p)}}class mh{constructor(o){this.property=o,this.value=new rc(o,void 0)}transitioned(o,c){return new im(this.property,this.value,c,ut({},o.transition,this.transition),o.now)}untransitioned(){return new im(this.property,this.value,null,{},0)}}class nm{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return wt(this._values[o].value.value)}setValue(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new mh(this._values[o].property)),this._values[o].value=new rc(this._values[o].property,c===null?void 0:wt(c))}getTransition(o){return wt(this._values[o].transition)}setTransition(o,c){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new mh(this._values[o].property)),this._values[o].transition=wt(c)||void 0}serialize(){const o={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(o[c]=p);const m=this.getTransition(c);m!==void 0&&(o[`${c}-transition`]=m)}return o}transitioned(o,c){const p=new Zf(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].transitioned(o,c._values[m]);return p}untransitioned(){const o=new Zf(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].untransitioned();return o}}class im{constructor(o,c,p,m,b){this.property=o,this.value=c,this.begin=b+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=p)}possiblyEvaluate(o,c,p){const m=o.now||0,b=this.value.possiblyEvaluate(o,c,p),x=this.prior;if(x){if(m>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(m<this.begin)return x.possiblyEvaluate(o,c,p);{const I=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(o,c,p),b,function(T){if(T<=0)return 0;if(T>=1)return 1;const A=T*T,R=A*T;return 4*(T<.5?R:3*(T-A)+R-.75)}(I))}}return b}}class Zf{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,c,p){const m=new oc(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(o,c,p);return m}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class rm{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return wt(this._values[o].value)}setValue(o,c){this._values[o]=new rc(this._values[o].property,c===null?void 0:wt(c))}serialize(){const o={};for(const c of Object.keys(this._values)){const p=this.getValue(c);p!==void 0&&(o[c]=p)}return o}possiblyEvaluate(o,c,p){const m=new oc(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].possiblyEvaluate(o,c,p);return m}}class ws{constructor(o,c,p){this.property=o,this.value=c,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,c,p,m){return this.property.evaluate(this.value,this.parameters,o,c,p,m)}}class oc{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class ke{constructor(o){this.specification=o}possiblyEvaluate(o,c){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(c)}interpolate(o,c,p){const m=ao[this.specification.type];return m?m(o,c,p):o}}class qe{constructor(o,c){this.specification=o,this.overrides=c}possiblyEvaluate(o,c,p,m){return new ws(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(c,null,{},p,m)}:o.expression,c)}interpolate(o,c,p){if(o.value.kind!=="constant"||c.value.kind!=="constant")return o;if(o.value.value===void 0||c.value.value===void 0)return new ws(this,{kind:"constant",value:void 0},o.parameters);const m=ao[this.specification.type];if(m){const b=m(o.value.value,c.value.value,p);return new ws(this,{kind:"constant",value:b},o.parameters)}return o}evaluate(o,c,p,m,b,x){return o.kind==="constant"?o.value:o.evaluate(c,p,m,b,x)}}class cu extends qe{possiblyEvaluate(o,c,p,m){if(o.value===void 0)return new ws(this,{kind:"constant",value:void 0},c);if(o.expression.kind==="constant"){const b=o.expression.evaluate(c,null,{},p,m),x=o.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,I=this._calculate(x,x,x,c);return new ws(this,{kind:"constant",value:I},c)}if(o.expression.kind==="camera"){const b=this._calculate(o.expression.evaluate({zoom:c.zoom-1}),o.expression.evaluate({zoom:c.zoom}),o.expression.evaluate({zoom:c.zoom+1}),c);return new ws(this,{kind:"constant",value:b},c)}return new ws(this,o.expression,c)}evaluate(o,c,p,m,b,x){if(o.kind==="source"){const I=o.evaluate(c,p,m,b,x);return this._calculate(I,I,I,c)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(c.zoom)-1},p,m),o.evaluate({zoom:Math.floor(c.zoom)},p,m),o.evaluate({zoom:Math.floor(c.zoom)+1},p,m),c):o.value}_calculate(o,c,p,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:p,to:c}}interpolate(o){return o}}class Wf{constructor(o){this.specification=o}possiblyEvaluate(o,c,p,m){if(o.value!==void 0){if(o.expression.kind==="constant"){const b=o.expression.evaluate(c,null,{},p,m);return this._calculate(b,b,b,c)}return this._calculate(o.expression.evaluate(new ci(Math.floor(c.zoom-1),c)),o.expression.evaluate(new ci(Math.floor(c.zoom),c)),o.expression.evaluate(new ci(Math.floor(c.zoom+1),c)),c)}}_calculate(o,c,p,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:c}:{from:p,to:c}}interpolate(o){return o}}class Hf{constructor(o){this.specification=o}possiblyEvaluate(o,c,p,m){return!!o.expression.evaluate(c,null,{},p,m)}interpolate(){return!1}}class uo{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in o){const p=o[c];p.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new rc(p,void 0),b=this.defaultTransitionablePropertyValues[c]=new mh(p);this.defaultTransitioningPropertyValues[c]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate({})}}}xe("DataDrivenProperty",qe),xe("DataConstantProperty",ke),xe("CrossFadedDataDrivenProperty",cu),xe("CrossFadedProperty",Wf),xe("ColorRampProperty",Hf);const $f="-transition";class Ss extends Ji{constructor(o,c){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),c.layout&&(this._unevaluatedLayout=new rm(c.layout)),c.paint)){this._transitionablePaint=new nm(c.paint);for(const p in o.paint)this.setPaintProperty(p,o.paint[p],{validate:!1});for(const p in o.layout)this.setLayoutProperty(p,o.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new oc(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,c,p={}){c!=null&&this._validate(nc,`layers.${this.id}.layout.${o}`,o,c,p)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,c):this.visibility=c)}getPaintProperty(o){return o.endsWith($f)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,c,p={}){if(c!=null&&this._validate(o_,`layers.${this.id}.paint.${o}`,o,c,p))return!1;if(o.endsWith($f))return this._transitionablePaint.setTransition(o.slice(0,-11),c||void 0),!1;{const m=this._transitionablePaint._values[o],b=m.property.specification["property-type"]==="cross-faded-data-driven",x=m.value.isDataDriven(),I=m.value;this._transitionablePaint.setValue(o,c),this._handleSpecialPaintPropertyUpdate(o);const T=this._transitionablePaint._values[o].value;return T.isDataDriven()||x||b||this._handleOverridablePaintPropertyUpdate(o,I,T)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,c,p){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,c){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,c)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),zt(o,(c,p)=>!(c===void 0||p==="layout"&&!Object.keys(c).length||p==="paint"&&!Object.keys(c).length))}_validate(o,c,p,m,b={}){return(!b||b.validate!==!1)&&Jd(this,o.call(ec,{key:c,layerType:this.type,objectKey:p,value:m,styleSpec:Bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const c=this.paint.get(o);if(c instanceof ws&&su(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const a_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sc{constructor(o,c){this._structArray=o,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,c){return o._trim(),c&&(o.isTransferred=!0,c.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const c=Object.create(this.prototype);return c.arrayBuffer=o.arrayBuffer,c.length=o.length,c.capacity=o.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gi(l,o=1){let c=0,p=0;return{members:l.map(m=>{const b=a_[m.type].BYTES_PER_ELEMENT,x=c=om(c,Math.max(o,b)),I=m.components||1;return p=Math.max(p,b),c+=b*I,{name:m.name,type:m.type,components:I,offset:x}}),size:om(c,Math.max(p,o)),alignment:o}}function om(l,o){return Math.ceil(l/o)*o}class qs extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c){const p=this.length;return this.resize(p+1),this.emplace(p,o,c)}emplace(o,c,p){const m=2*o;return this.int16[m+0]=c,this.int16[m+1]=p,o}}qs.prototype.bytesPerElement=4,xe("StructArrayLayout2i4",qs);class gh extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const b=3*o;return this.int16[b+0]=c,this.int16[b+1]=p,this.int16[b+2]=m,o}}gh.prototype.bytesPerElement=6,xe("StructArrayLayout3i6",gh);class Xf extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,p,m)}emplace(o,c,p,m,b){const x=4*o;return this.int16[x+0]=c,this.int16[x+1]=p,this.int16[x+2]=m,this.int16[x+3]=b,o}}Xf.prototype.bytesPerElement=8,xe("StructArrayLayout4i8",Xf);class Yf extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,p,m,b,x)}emplace(o,c,p,m,b,x,I){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=p,this.int16[T+2]=m,this.int16[T+3]=b,this.int16[T+4]=x,this.int16[T+5]=I,o}}Yf.prototype.bytesPerElement=12,xe("StructArrayLayout2i4i12",Yf);class Kf extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,p,m,b,x)}emplace(o,c,p,m,b,x,I){const T=4*o,A=8*o;return this.int16[T+0]=c,this.int16[T+1]=p,this.uint8[A+4]=m,this.uint8[A+5]=b,this.uint8[A+6]=x,this.uint8[A+7]=I,o}}Kf.prototype.bytesPerElement=8,xe("StructArrayLayout2i4ub8",Kf);class hu extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c){const p=this.length;return this.resize(p+1),this.emplace(p,o,c)}emplace(o,c,p){const m=2*o;return this.float32[m+0]=c,this.float32[m+1]=p,o}}hu.prototype.bytesPerElement=8,xe("StructArrayLayout2f8",hu);class Jf extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x,I,T,A,R){const z=this.length;return this.resize(z+1),this.emplace(z,o,c,p,m,b,x,I,T,A,R)}emplace(o,c,p,m,b,x,I,T,A,R,z){const j=10*o;return this.uint16[j+0]=c,this.uint16[j+1]=p,this.uint16[j+2]=m,this.uint16[j+3]=b,this.uint16[j+4]=x,this.uint16[j+5]=I,this.uint16[j+6]=T,this.uint16[j+7]=A,this.uint16[j+8]=R,this.uint16[j+9]=z,o}}Jf.prototype.bytesPerElement=20,xe("StructArrayLayout10ui20",Jf);class Qf extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x,I,T,A,R,z,j){const H=this.length;return this.resize(H+1),this.emplace(H,o,c,p,m,b,x,I,T,A,R,z,j)}emplace(o,c,p,m,b,x,I,T,A,R,z,j,H){const Y=12*o;return this.int16[Y+0]=c,this.int16[Y+1]=p,this.int16[Y+2]=m,this.int16[Y+3]=b,this.uint16[Y+4]=x,this.uint16[Y+5]=I,this.uint16[Y+6]=T,this.uint16[Y+7]=A,this.int16[Y+8]=R,this.int16[Y+9]=z,this.int16[Y+10]=j,this.int16[Y+11]=H,o}}Qf.prototype.bytesPerElement=24,xe("StructArrayLayout4i4ui4i24",Qf);class va extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const b=3*o;return this.float32[b+0]=c,this.float32[b+1]=p,this.float32[b+2]=m,o}}va.prototype.bytesPerElement=12,xe("StructArrayLayout3f12",va);class _h extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint32[1*o+0]=c,o}}_h.prototype.bytesPerElement=4,xe("StructArrayLayout1ul4",_h);class ac extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x,I,T,A){const R=this.length;return this.resize(R+1),this.emplace(R,o,c,p,m,b,x,I,T,A)}emplace(o,c,p,m,b,x,I,T,A,R){const z=10*o,j=5*o;return this.int16[z+0]=c,this.int16[z+1]=p,this.int16[z+2]=m,this.int16[z+3]=b,this.int16[z+4]=x,this.int16[z+5]=I,this.uint32[j+3]=T,this.uint16[z+8]=A,this.uint16[z+9]=R,o}}ac.prototype.bytesPerElement=20,xe("StructArrayLayout6i1ul2ui20",ac);class yh extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x){const I=this.length;return this.resize(I+1),this.emplace(I,o,c,p,m,b,x)}emplace(o,c,p,m,b,x,I){const T=6*o;return this.int16[T+0]=c,this.int16[T+1]=p,this.int16[T+2]=m,this.int16[T+3]=b,this.int16[T+4]=x,this.int16[T+5]=I,o}}yh.prototype.bytesPerElement=12,xe("StructArrayLayout2i2i2i12",yh);class lc extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b){const x=this.length;return this.resize(x+1),this.emplace(x,o,c,p,m,b)}emplace(o,c,p,m,b,x){const I=4*o,T=8*o;return this.float32[I+0]=c,this.float32[I+1]=p,this.float32[I+2]=m,this.int16[T+6]=b,this.int16[T+7]=x,o}}lc.prototype.bytesPerElement=16,xe("StructArrayLayout2f1f2i16",lc);class tp extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,p,m)}emplace(o,c,p,m,b){const x=12*o,I=3*o;return this.uint8[x+0]=c,this.uint8[x+1]=p,this.float32[I+1]=m,this.float32[I+2]=b,o}}tp.prototype.bytesPerElement=12,xe("StructArrayLayout2ub2f12",tp);class Tl extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const b=3*o;return this.uint16[b+0]=c,this.uint16[b+1]=p,this.uint16[b+2]=m,o}}Tl.prototype.bytesPerElement=6,xe("StructArrayLayout3ui6",Tl);class Ll extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt,ot,dt){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt,ot,dt)}emplace(o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt,ot,dt,Dt){const bt=24*o,Lt=12*o,Yt=48*o;return this.int16[bt+0]=c,this.int16[bt+1]=p,this.uint16[bt+2]=m,this.uint16[bt+3]=b,this.uint32[Lt+2]=x,this.uint32[Lt+3]=I,this.uint32[Lt+4]=T,this.uint16[bt+10]=A,this.uint16[bt+11]=R,this.uint16[bt+12]=z,this.float32[Lt+7]=j,this.float32[Lt+8]=H,this.uint8[Yt+36]=Y,this.uint8[Yt+37]=tt,this.uint8[Yt+38]=ot,this.uint32[Lt+10]=dt,this.int16[bt+22]=Dt,o}}Ll.prototype.bytesPerElement=48,xe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ll);class ep extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt,ot,dt,Dt,bt,Lt,Yt,Jt,ve,Me,ye,ge,he,Ce){const fe=this.length;return this.resize(fe+1),this.emplace(fe,o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt,ot,dt,Dt,bt,Lt,Yt,Jt,ve,Me,ye,ge,he,Ce)}emplace(o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt,ot,dt,Dt,bt,Lt,Yt,Jt,ve,Me,ye,ge,he,Ce,fe){const re=32*o,Be=16*o;return this.int16[re+0]=c,this.int16[re+1]=p,this.int16[re+2]=m,this.int16[re+3]=b,this.int16[re+4]=x,this.int16[re+5]=I,this.int16[re+6]=T,this.int16[re+7]=A,this.uint16[re+8]=R,this.uint16[re+9]=z,this.uint16[re+10]=j,this.uint16[re+11]=H,this.uint16[re+12]=Y,this.uint16[re+13]=tt,this.uint16[re+14]=ot,this.uint16[re+15]=dt,this.uint16[re+16]=Dt,this.uint16[re+17]=bt,this.uint16[re+18]=Lt,this.uint16[re+19]=Yt,this.uint16[re+20]=Jt,this.uint16[re+21]=ve,this.uint16[re+22]=Me,this.uint32[Be+12]=ye,this.float32[Be+13]=ge,this.float32[Be+14]=he,this.uint16[re+30]=Ce,this.uint16[re+31]=fe,o}}ep.prototype.bytesPerElement=64,xe("StructArrayLayout8i15ui1ul2f2ui64",ep);class uc extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.float32[1*o+0]=c,o}}uc.prototype.bytesPerElement=4,xe("StructArrayLayout1f4",uc);class Ml extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const b=3*o;return this.uint16[6*o+0]=c,this.float32[b+1]=p,this.float32[b+2]=m,o}}Ml.prototype.bytesPerElement=12,xe("StructArrayLayout1ui2f12",Ml);class np extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c,p){const m=this.length;return this.resize(m+1),this.emplace(m,o,c,p)}emplace(o,c,p,m){const b=4*o;return this.uint32[2*o+0]=c,this.uint16[b+2]=p,this.uint16[b+3]=m,o}}np.prototype.bytesPerElement=8,xe("StructArrayLayout1ul2ui8",np);class ip extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,c){const p=this.length;return this.resize(p+1),this.emplace(p,o,c)}emplace(o,c,p){const m=2*o;return this.uint16[m+0]=c,this.uint16[m+1]=p,o}}ip.prototype.bytesPerElement=4,xe("StructArrayLayout2ui4",ip);class vh extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const c=this.length;return this.resize(c+1),this.emplace(c,o)}emplace(o,c){return this.uint16[1*o+0]=c,o}}vh.prototype.bytesPerElement=2,xe("StructArrayLayout1ui2",vh);class rp extends Li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,c,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,o,c,p,m)}emplace(o,c,p,m,b){const x=4*o;return this.float32[x+0]=c,this.float32[x+1]=p,this.float32[x+2]=m,this.float32[x+3]=b,o}}rp.prototype.bytesPerElement=16,xe("StructArrayLayout4f16",rp);class y extends sc{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class s extends ac{get(o){return new y(this,o)}}xe("CollisionBoxArray",s);class f extends sc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}f.prototype.size=48;class d extends Ll{get(o){return new f(this,o)}}xe("PlacedSymbolArray",d);class g extends sc{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}g.prototype.size=64;class v extends ep{get(o){return new g(this,o)}}xe("SymbolInstanceArray",v);class C extends uc{getoffsetX(o){return this.float32[1*o+0]}}xe("GlyphOffsetArray",C);class L extends gh{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}xe("SymbolLineVertexArray",L);class P extends sc{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}P.prototype.size=12;class N extends Ml{get(o){return new P(this,o)}}xe("TextAnchorOffsetArray",N);class O extends sc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}O.prototype.size=8;class V extends np{get(o){return new O(this,o)}}xe("FeatureIndexArray",V);class $ extends qs{}class it extends qs{}class rt extends qs{}class at extends Yf{}class et extends Kf{}class It extends hu{}class Rt extends Jf{}class ft extends Qf{}class kt extends va{}class Ut extends _h{}class Ft extends yh{}class Kt extends tp{}class ee extends Tl{}class Qt extends ip{}const ae=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Se}=ae;class Ue{constructor(o=[]){this.segments=o}prepareSegment(o,c,p,m){let b=this.segments[this.segments.length-1];return o>Ue.MAX_VERTEX_ARRAY_LENGTH&&te(`Max vertices per segment is ${Ue.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!b||b.vertexLength+o>Ue.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==m)&&(b={vertexOffset:c.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},m!==void 0&&(b.sortKey=m),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const o of this.segments)for(const c in o.vaos)o.vaos[c].destroy()}static simpleSegment(o,c,p,m){return new Ue([{vertexOffset:o,primitiveOffset:c,vertexLength:p,primitiveLength:m,vaos:{},sortKey:0}])}}function me(l,o){return 256*(l=Q(Math.floor(l),0,255))+Q(Math.floor(o),0,255)}Ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xe("SegmentVector",Ue);const Ve=Gi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Te={exports:{}},hi={exports:{}};hi.exports=function(l,o){var c,p,m,b,x,I,T,A;for(p=l.length-(c=3&l.length),m=o,x=3432918353,I=461845907,A=0;A<p;)T=255&l.charCodeAt(A)|(255&l.charCodeAt(++A))<<8|(255&l.charCodeAt(++A))<<16|(255&l.charCodeAt(++A))<<24,++A,m=27492+(65535&(b=5*(65535&(m=(m^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*I+(((T>>>16)*I&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(T=0,c){case 3:T^=(255&l.charCodeAt(A+2))<<16;case 2:T^=(255&l.charCodeAt(A+1))<<8;case 1:m^=T=(65535&(T=(T=(65535&(T^=255&l.charCodeAt(A)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*I+(((T>>>16)*I&65535)<<16)&4294967295}return m^=l.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0};var vn=hi.exports,fn={exports:{}};fn.exports=function(l,o){for(var c,p=l.length,m=o^p,b=0;p>=4;)c=1540483477*(65535&(c=255&l.charCodeAt(b)|(255&l.charCodeAt(++b))<<8|(255&l.charCodeAt(++b))<<16|(255&l.charCodeAt(++b))<<24))+((1540483477*(c>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++b;switch(p){case 3:m^=(255&l.charCodeAt(b+2))<<16;case 2:m^=(255&l.charCodeAt(b+1))<<8;case 1:m=1540483477*(65535&(m^=255&l.charCodeAt(b)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};var bn=vn,ji=fn.exports;Te.exports=bn,Te.exports.murmur3=bn,Te.exports.murmur2=ji;var $n=_(Te.exports);class co{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,c,p,m){this.ids.push(Sr(o)),this.positions.push(c,p,m)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Sr(o);let p=0,m=this.ids.length-1;for(;p<m;){const x=p+m>>1;this.ids[x]>=c?m=x:p=x+1}const b=[];for(;this.ids[p]===c;)b.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return b}static serialize(o,c){const p=new Float64Array(o.ids),m=new Uint32Array(o.positions);return Mi(p,m,0,p.length-1),c&&c.push(p.buffer,m.buffer),{ids:p,positions:m}}static deserialize(o){const c=new co;return c.ids=o.ids,c.positions=o.positions,c.indexed=!0,c}}function Sr(l){const o=+l;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:$n(String(l))}function Mi(l,o,c,p){for(;c<p;){const m=l[c+p>>1];let b=c-1,x=p+1;for(;;){do b++;while(l[b]<m);do x--;while(l[x]>m);if(b>=x)break;qr(l,b,x),qr(o,3*b,3*x),qr(o,3*b+1,3*x+1),qr(o,3*b+2,3*x+2)}x-c<p-x?(Mi(l,o,c,x),c=x+1):(Mi(l,o,x+1,p),p=x)}}function qr(l,o,c){const p=l[o];l[o]=l[c],l[c]=p}xe("FeaturePositionMap",co);class Zr{constructor(o,c){this.gl=o.gl,this.location=c}}class ss extends Zr{constructor(o,c){super(o,c),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class $a extends Zr{constructor(o,c){super(o,c),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class fu extends Zr{constructor(o,c){super(o,c),this.current=qn.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const pu=new Float32Array(16);function Xa(l){return[me(255*l.r,255*l.g),me(255*l.b,255*l.a)]}class ur{constructor(o,c,p){this.value=o,this.uniformNames=c.map(m=>`u_${m}`),this.type=p}setUniform(o,c,p){o.set(p.constantOr(this.value))}getBinding(o,c,p){return this.type==="color"?new fu(o,c):new ss(o,c)}}class qi{constructor(o,c){this.uniformNames=c.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=o.tlbr}setUniform(o,c,p,m){const b=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&o.set(b)}getBinding(o,c,p){return p.substr(0,9)==="u_pattern"?new $a(o,c):new ss(o,c)}}class Pi{constructor(o,c,p,m){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=c.map(b=>({name:`a_${b}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(o,c,p,m,b){const x=this.paintVertexArray.length,I=this.expression.evaluate(new ci(0),c,{},m,[],b);this.paintVertexArray.resize(o),this._setPaintValue(x,o,I)}updatePaintArray(o,c,p,m){const b=this.expression.evaluate({zoom:0},p,m);this._setPaintValue(o,c,b)}_setPaintValue(o,c,p){if(this.type==="color"){const m=Xa(p);for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,m[0],m[1])}else{for(let m=o;m<c;m++)this.paintVertexArray.emplace(m,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ho{constructor(o,c,p,m,b,x){this.expression=o,this.uniformNames=c.map(I=>`u_${I}_t`),this.type=p,this.useIntegerZoom=m,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=c.map(I=>({name:`a_${I}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(o,c,p,m,b){const x=this.expression.evaluate(new ci(this.zoom),c,{},m,[],b),I=this.expression.evaluate(new ci(this.zoom+1),c,{},m,[],b),T=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(T,o,x,I)}updatePaintArray(o,c,p,m){const b=this.expression.evaluate({zoom:this.zoom},p,m),x=this.expression.evaluate({zoom:this.zoom+1},p,m);this._setPaintValue(o,c,b,x)}_setPaintValue(o,c,p,m){if(this.type==="color"){const b=Xa(p),x=Xa(m);for(let I=o;I<c;I++)this.paintVertexArray.emplace(I,b[0],b[1],x[0],x[1])}else{for(let b=o;b<c;b++)this.paintVertexArray.emplace(b,p,m);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(m))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,c){const p=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,m=Q(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);o.set(m)}getBinding(o,c,p){return new ss(o,c)}}class fi{constructor(o,c,p,m,b,x){this.expression=o,this.type=c,this.useIntegerZoom=p,this.zoom=m,this.layerId=x,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(o,c,p){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,c.patterns&&c.patterns[this.layerId],p)}updatePaintArray(o,c,p,m,b){this._setPaintValues(o,c,p.patterns&&p.patterns[this.layerId],b)}_setPaintValues(o,c,p,m){if(!m||!p)return;const{min:b,mid:x,max:I}=p,T=m[b],A=m[x],R=m[I];if(T&&A&&R)for(let z=o;z<c;z++)this.zoomInPaintVertexArray.emplace(z,A.tl[0],A.tl[1],A.br[0],A.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],A.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,A.tl[0],A.tl[1],A.br[0],A.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],A.pixelRatio,R.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Ve.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Ve.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class cr{constructor(o,c,p){this.binders={},this._buffers=[];const m=[];for(const b in o.paint._values){if(!p(b))continue;const x=o.paint.get(b);if(!(x instanceof ws&&su(x.property.specification)))continue;const I=hr(b,o.type),T=x.value,A=x.property.specification.type,R=x.property.useIntegerZoom,z=x.property.specification["property-type"],j=z==="cross-faded"||z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[b]=j?new qi(T.value,I):new ur(T.value,I,A),m.push(`/u_${b}`);else if(T.kind==="source"||j){const H=sm(b,A,"source");this.binders[b]=j?new fi(T,A,R,c,H,o.id):new Pi(T,I,A,H),m.push(`/a_${b}`)}else{const H=sm(b,A,"composite");this.binders[b]=new ho(T,I,A,R,c,H),m.push(`/z_${b}`)}}this.cacheKey=m.sort().join("")}getMaxValue(o){const c=this.binders[o];return c instanceof Pi||c instanceof ho?c.maxValue:0}populatePaintArrays(o,c,p,m,b){for(const x in this.binders){const I=this.binders[x];(I instanceof Pi||I instanceof ho||I instanceof fi)&&I.populatePaintArray(o,c,p,m,b)}}setConstantPatternPositions(o,c){for(const p in this.binders){const m=this.binders[p];m instanceof qi&&m.setConstantPatternPositions(o,c)}}updatePaintArrays(o,c,p,m,b){let x=!1;for(const I in o){const T=c.getPositions(I);for(const A of T){const R=p.feature(A.index);for(const z in this.binders){const j=this.binders[z];if((j instanceof Pi||j instanceof ho||j instanceof fi)&&j.expression.isStateDependent===!0){const H=m.paint.get(z);j.expression=H.value,j.updatePaintArray(A.start,A.end,R,o[I],b),x=!0}}}}return x}defines(){const o=[];for(const c in this.binders){const p=this.binders[c];(p instanceof ur||p instanceof qi)&&o.push(...p.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return o}getBinderAttributes(){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof Pi||p instanceof ho)for(let m=0;m<p.paintVertexAttributes.length;m++)o.push(p.paintVertexAttributes[m].name);else if(p instanceof fi)for(let m=0;m<Ve.members.length;m++)o.push(Ve.members[m].name)}return o}getBinderUniforms(){const o=[];for(const c in this.binders){const p=this.binders[c];if(p instanceof ur||p instanceof qi||p instanceof ho)for(const m of p.uniformNames)o.push(m)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,c){const p=[];for(const m in this.binders){const b=this.binders[m];if(b instanceof ur||b instanceof qi||b instanceof ho){for(const x of b.uniformNames)if(c[x]){const I=b.getBinding(o,c[x],x);p.push({name:x,property:m,binding:I})}}}return p}setUniforms(o,c,p,m){for(const{name:b,property:x,binding:I}of c)this.binders[x].setUniform(I,m,p.get(x),b)}updatePaintBuffers(o){this._buffers=[];for(const c in this.binders){const p=this.binders[c];if(o&&p instanceof fi){const m=o.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(p instanceof Pi||p instanceof ho)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(o){for(const c in this.binders){const p=this.binders[c];(p instanceof Pi||p instanceof ho||p instanceof fi)&&p.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const c=this.binders[o];(c instanceof Pi||c instanceof ho||c instanceof fi)&&c.destroy()}}}class Ir{constructor(o,c,p=()=>!0){this.programConfigurations={};for(const m of o)this.programConfigurations[m.id]=new cr(m,c,p);this.needsUpload=!1,this._featureMap=new co,this._bufferOffset=0}populatePaintArrays(o,c,p,m,b,x){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(o,c,m,b,x);c.id!==void 0&&this._featureMap.add(c.id,p,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,c,p,m){for(const b of p)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,c,b,m)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function hr(l,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${o}-`,"").replace(/-/g,"_")]}function sm(l,o,c){const p={color:{source:hu,composite:rp},number:{source:uc,composite:hu}},m=function(b){return{"line-pattern":{source:Rt,composite:Rt},"fill-pattern":{source:Rt,composite:Rt},"fill-extrusion-pattern":{source:Rt,composite:Rt}}[b]}(l);return m&&m[c]||p[o][c]}xe("ConstantBinder",ur),xe("CrossFadedConstantBinder",qi),xe("SourceExpressionBinder",Pi),xe("CrossFadedCompositeBinder",fi),xe("CompositeExpressionBinder",ho),xe("ProgramConfiguration",cr,{omit:["_buffers"]}),xe("ProgramConfigurationSet",Ir);const zi=8192,op=Math.pow(2,14)-1,am=-op-1;function Pl(l){const o=zi/l.extent,c=l.loadGeometry();for(let p=0;p<c.length;p++){const m=c[p];for(let b=0;b<m.length;b++){const x=m[b],I=Math.round(x.x*o),T=Math.round(x.y*o);x.x=Q(I,am,op),x.y=Q(T,am,op),(I<x.x||I>x.x+1||T<x.y||T>x.y+1)&&te("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function kl(l,o){return{type:l.type,id:l.id,properties:l.properties,geometry:o?Pl(l):[]}}function ba(l,o,c,p,m){l.emplaceBack(2*o+(p+1)/2,2*c+(m+1)/2)}class bh{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new it,this.indexArray=new ee,this.segments=new Ue,this.programConfigurations=new Ir(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){const m=this.layers[0],b=[];let x=null,I=!1;m.type==="circle"&&(x=m.layout.get("circle-sort-key"),I=!x.isConstant());for(const{feature:T,id:A,index:R,sourceLayerIndex:z}of o){const j=this.layers[0]._featureFilter.needGeometry,H=kl(T,j);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),H,p))continue;const Y=I?x.evaluate(H,{},p):void 0,tt={id:A,properties:T.properties,type:T.type,sourceLayerIndex:z,index:R,geometry:j?H.geometry:Pl(T),patterns:{},sortKey:Y};b.push(tt)}I&&b.sort((T,A)=>T.sortKey-A.sortKey);for(const T of b){const{geometry:A,index:R,sourceLayerIndex:z}=T,j=o[R].feature;this.addFeature(T,A,R,p),c.featureIndex.insert(j,A,R,z,this.index)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Se),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,c,p,m){for(const b of c)for(const x of b){const I=x.x,T=x.y;if(I<0||I>=zi||T<0||T>=zi)continue;const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),R=A.vertexLength;ba(this.layoutVertexArray,I,T,-1,-1),ba(this.layoutVertexArray,I,T,1,-1),ba(this.layoutVertexArray,I,T,1,1),ba(this.layoutVertexArray,I,T,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,{},m)}}function sp(l,o){for(let c=0;c<l.length;c++)if(wh(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(wh(l,o[c]))return!0;return!!cc(l,o)}function lm(l,o,c){return!!wh(l,o)||!!l_(o,l,c)}function xh(l,o){if(l.length===1)return m0(o,l[0]);for(let c=0;c<o.length;c++){const p=o[c];for(let m=0;m<p.length;m++)if(wh(l,p[m]))return!0}for(let c=0;c<l.length;c++)if(m0(o,l[c]))return!0;for(let c=0;c<o.length;c++)if(cc(l,o[c]))return!0;return!1}function um(l,o,c){if(l.length>1){if(cc(l,o))return!0;for(let p=0;p<o.length;p++)if(l_(o[p],l,c))return!0}for(let p=0;p<l.length;p++)if(l_(l[p],o,c))return!0;return!1}function cc(l,o){if(l.length===0||o.length===0)return!1;for(let c=0;c<l.length-1;c++){const p=l[c],m=l[c+1];for(let b=0;b<o.length-1;b++)if(jw(p,m,o[b],o[b+1]))return!0}return!1}function jw(l,o,c,p){return Pt(l,c,p)!==Pt(o,c,p)&&Pt(l,o,c)!==Pt(l,o,p)}function l_(l,o,c){const p=c*c;if(o.length===1)return l.distSqr(o[0])<p;for(let m=1;m<o.length;m++)if(d0(l,o[m-1],o[m])<p)return!0;return!1}function d0(l,o,c){const p=o.distSqr(c);if(p===0)return l.distSqr(o);const m=((l.x-o.x)*(c.x-o.x)+(l.y-o.y)*(c.y-o.y))/p;return l.distSqr(m<0?o:m>1?c:c.sub(o)._mult(m)._add(o))}function m0(l,o){let c,p,m,b=!1;for(let x=0;x<l.length;x++){c=l[x];for(let I=0,T=c.length-1;I<c.length;T=I++)p=c[I],m=c[T],p.y>o.y!=m.y>o.y&&o.x<(m.x-p.x)*(o.y-p.y)/(m.y-p.y)+p.x&&(b=!b)}return b}function wh(l,o){let c=!1;for(let p=0,m=l.length-1;p<l.length;m=p++){const b=l[p],x=l[m];b.y>o.y!=x.y>o.y&&o.x<(x.x-b.x)*(o.y-b.y)/(x.y-b.y)+b.x&&(c=!c)}return c}function qw(l,o,c){const p=c[0],m=c[2];if(l.x<p.x&&o.x<p.x||l.x>m.x&&o.x>m.x||l.y<p.y&&o.y<p.y||l.y>m.y&&o.y>m.y)return!1;const b=Pt(l,o,c[0]);return b!==Pt(l,o,c[1])||b!==Pt(l,o,c[2])||b!==Pt(l,o,c[3])}function ap(l,o,c){const p=o.paint.get(l).value;return p.kind==="constant"?p.value:c.programConfigurations.get(o.id).getMaxValue(l)}function cm(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function hm(l,o,c,p,m){if(!o[0]&&!o[1])return l;const b=E.convert(o)._mult(m);c==="viewport"&&b._rotate(-p);const x=[];for(let I=0;I<l.length;I++)x.push(l[I].sub(b));return x}let g0,_0;xe("CircleBucket",bh,{omit:["layers"]});var Zw={get paint(){return _0=_0||new uo({"circle-radius":new qe(Bt.paint_circle["circle-radius"]),"circle-color":new qe(Bt.paint_circle["circle-color"]),"circle-blur":new qe(Bt.paint_circle["circle-blur"]),"circle-opacity":new qe(Bt.paint_circle["circle-opacity"]),"circle-translate":new ke(Bt.paint_circle["circle-translate"]),"circle-translate-anchor":new ke(Bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ke(Bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ke(Bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qe(Bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qe(Bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qe(Bt.paint_circle["circle-stroke-opacity"])})},get layout(){return g0=g0||new uo({"circle-sort-key":new qe(Bt.layout_circle["circle-sort-key"])})}},Co=1e-6,Sh=typeof Float32Array<"u"?Float32Array:Array;function u_(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function y0(l,o,c){var p=o[0],m=o[1],b=o[2],x=o[3],I=o[4],T=o[5],A=o[6],R=o[7],z=o[8],j=o[9],H=o[10],Y=o[11],tt=o[12],ot=o[13],dt=o[14],Dt=o[15],bt=c[0],Lt=c[1],Yt=c[2],Jt=c[3];return l[0]=bt*p+Lt*I+Yt*z+Jt*tt,l[1]=bt*m+Lt*T+Yt*j+Jt*ot,l[2]=bt*b+Lt*A+Yt*H+Jt*dt,l[3]=bt*x+Lt*R+Yt*Y+Jt*Dt,l[4]=(bt=c[4])*p+(Lt=c[5])*I+(Yt=c[6])*z+(Jt=c[7])*tt,l[5]=bt*m+Lt*T+Yt*j+Jt*ot,l[6]=bt*b+Lt*A+Yt*H+Jt*dt,l[7]=bt*x+Lt*R+Yt*Y+Jt*Dt,l[8]=(bt=c[8])*p+(Lt=c[9])*I+(Yt=c[10])*z+(Jt=c[11])*tt,l[9]=bt*m+Lt*T+Yt*j+Jt*ot,l[10]=bt*b+Lt*A+Yt*H+Jt*dt,l[11]=bt*x+Lt*R+Yt*Y+Jt*Dt,l[12]=(bt=c[12])*p+(Lt=c[13])*I+(Yt=c[14])*z+(Jt=c[15])*tt,l[13]=bt*m+Lt*T+Yt*j+Jt*ot,l[14]=bt*b+Lt*A+Yt*H+Jt*dt,l[15]=bt*x+Lt*R+Yt*Y+Jt*Dt,l}Math.hypot||(Math.hypot=function(){for(var l=0,o=arguments.length;o--;)l+=arguments[o]*arguments[o];return Math.sqrt(l)});var lp,Ww=y0;function fm(l,o,c){var p=o[0],m=o[1],b=o[2],x=o[3];return l[0]=c[0]*p+c[4]*m+c[8]*b+c[12]*x,l[1]=c[1]*p+c[5]*m+c[9]*b+c[13]*x,l[2]=c[2]*p+c[6]*m+c[10]*b+c[14]*x,l[3]=c[3]*p+c[7]*m+c[11]*b+c[15]*x,l}lp=new Sh(4),Sh!=Float32Array&&(lp[0]=0,lp[1]=0,lp[2]=0,lp[3]=0);class Hw extends Ss{constructor(o){super(o,Zw)}createBucket(o){return new bh(o)}queryRadius(o){const c=o;return ap("circle-radius",this,c)+ap("circle-stroke-width",this,c)+cm(this.paint.get("circle-translate"))}queryIntersectsFeature(o,c,p,m,b,x,I,T){const A=hm(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,I),R=this.paint.get("circle-radius").evaluate(c,p)+this.paint.get("circle-stroke-width").evaluate(c,p),z=this.paint.get("circle-pitch-alignment")==="map",j=z?A:function(Y,tt){return Y.map(ot=>v0(ot,tt))}(A,T),H=z?R*I:R;for(const Y of m)for(const tt of Y){const ot=z?tt:v0(tt,T);let dt=H;const Dt=fm([],[tt.x,tt.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?dt*=Dt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(dt*=x.cameraToCenterDistance/Dt[3]),lm(j,ot,dt))return!0}return!1}}function v0(l,o){const c=fm([],[l.x,l.y,0,1],o);return new E(c[0]/c[3],c[1]/c[3])}class b0 extends bh{}let x0;xe("HeatmapBucket",b0,{omit:["layers"]});var $w={get paint(){return x0=x0||new uo({"heatmap-radius":new qe(Bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qe(Bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ke(Bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hf(Bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ke(Bt.paint_heatmap["heatmap-opacity"])})}};function c_(l,{width:o,height:c},p,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==o*c*p)throw new RangeError(`mismatched image size. expected: ${m.length} but got: ${o*c*p}`)}else m=new Uint8Array(o*c*p);return l.width=o,l.height=c,l.data=m,l}function w0(l,{width:o,height:c},p){if(o===l.width&&c===l.height)return;const m=c_({},{width:o,height:c},p);h_(l,m,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,o),height:Math.min(l.height,c)},p),l.width=o,l.height=c,l.data=m.data}function h_(l,o,c,p,m,b){if(m.width===0||m.height===0)return o;if(m.width>l.width||m.height>l.height||c.x>l.width-m.width||c.y>l.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>o.width||m.height>o.height||p.x>o.width-m.width||p.y>o.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const x=l.data,I=o.data;if(x===I)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<m.height;T++){const A=((c.y+T)*l.width+c.x)*b,R=((p.y+T)*o.width+p.x)*b;for(let z=0;z<m.width*b;z++)I[R+z]=x[A+z]}return o}class up{constructor(o,c){c_(this,o,1,c)}resize(o){w0(this,o,1)}clone(){return new up({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,p,m,b){h_(o,c,p,m,b,1)}}class Is{constructor(o,c){c_(this,o,4,c)}resize(o){w0(this,o,4)}replace(o,c){c?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new Is({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,c,p,m,b){h_(o,c,p,m,b,4)}}function S0(l){const o={},c=l.resolution||256,p=l.clips?l.clips.length:1,m=l.image||new Is({width:c,height:p});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const b=(x,I,T)=>{o[l.evaluationKey]=T;const A=l.expression.evaluate(o);m.data[x+I+0]=Math.floor(255*A.r/A.a),m.data[x+I+1]=Math.floor(255*A.g/A.a),m.data[x+I+2]=Math.floor(255*A.b/A.a),m.data[x+I+3]=Math.floor(255*A.a)};if(l.clips)for(let x=0,I=0;x<p;++x,I+=4*c)for(let T=0,A=0;T<c;T++,A+=4){const R=T/(c-1),{start:z,end:j}=l.clips[x];b(I,A,z*(1-R)+j*R)}else for(let x=0,I=0;x<c;x++,I+=4)b(0,I,x/(c-1));return m}xe("AlphaImage",up),xe("RGBAImage",Is);class Xw extends Ss{createBucket(o){return new b0(o)}constructor(o){super(o,$w),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=S0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let I0;var Yw={get paint(){return I0=I0||new uo({"hillshade-illumination-direction":new ke(Bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ke(Bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ke(Bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ke(Bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ke(Bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ke(Bt.paint_hillshade["hillshade-accent-color"])})}};class Kw extends Ss{constructor(o){super(o,Yw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Jw=Gi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qw}=Jw;var f_={exports:{}};function pm(l,o,c){c=c||2;var p,m,b,x,I,T,A,R=o&&o.length,z=R?o[0]*c:l.length,j=E0(l,0,z,c,!0),H=[];if(!j||j.next===j.prev)return H;if(R&&(j=function(tt,ot,dt,Dt){var bt,Lt,Yt,Jt=[];for(bt=0,Lt=ot.length;bt<Lt;bt++)(Yt=E0(tt,ot[bt]*Dt,bt<Lt-1?ot[bt+1]*Dt:tt.length,Dt,!1))===Yt.next&&(Yt.steiner=!0),Jt.push(a2(Yt));for(Jt.sort(r2),bt=0;bt<Jt.length;bt++)dt=o2(Jt[bt],dt);return dt}(l,o,j,c)),l.length>80*c){p=b=l[0],m=x=l[1];for(var Y=c;Y<z;Y+=c)(I=l[Y])<p&&(p=I),(T=l[Y+1])<m&&(m=T),I>b&&(b=I),T>x&&(x=T);A=(A=Math.max(b-p,x-m))!==0?32767/A:0}return cp(j,H,c,p,m,A,0),H}function E0(l,o,c,p,m){var b,x;if(m===m_(l,o,c,p)>0)for(b=o;b<c;b+=p)x=L0(b,l[b],l[b+1],x);else for(b=c-p;b>=o;b-=p)x=L0(b,l[b],l[b+1],x);return x&&dm(x,x.next)&&(fp(x),x=x.next),x}function hc(l,o){if(!l)return l;o||(o=l);var c,p=l;do if(c=!1,p.steiner||!dm(p,p.next)&&Zi(p.prev,p,p.next)!==0)p=p.next;else{if(fp(p),(p=o=p.prev)===p.next)break;c=!0}while(c||p!==o);return o}function cp(l,o,c,p,m,b,x){if(l){!x&&b&&function(R,z,j,H){var Y=R;do Y.z===0&&(Y.z=p_(Y.x,Y.y,z,j,H)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==R);Y.prevZ.nextZ=null,Y.prevZ=null,function(tt){var ot,dt,Dt,bt,Lt,Yt,Jt,ve,Me=1;do{for(dt=tt,tt=null,Lt=null,Yt=0;dt;){for(Yt++,Dt=dt,Jt=0,ot=0;ot<Me&&(Jt++,Dt=Dt.nextZ);ot++);for(ve=Me;Jt>0||ve>0&&Dt;)Jt!==0&&(ve===0||!Dt||dt.z<=Dt.z)?(bt=dt,dt=dt.nextZ,Jt--):(bt=Dt,Dt=Dt.nextZ,ve--),Lt?Lt.nextZ=bt:tt=bt,bt.prevZ=Lt,Lt=bt;dt=Dt}Lt.nextZ=null,Me*=2}while(Yt>1)}(Y)}(l,p,m,b);for(var I,T,A=l;l.prev!==l.next;)if(I=l.prev,T=l.next,b?e2(l,p,m,b):t2(l))o.push(I.i/c|0),o.push(l.i/c|0),o.push(T.i/c|0),fp(l),l=T.next,A=T.next;else if((l=T)===A){x?x===1?cp(l=n2(hc(l),o,c),o,c,p,m,b,2):x===2&&i2(l,o,c,p,m,b):cp(hc(l),o,c,p,m,b,1);break}}}function t2(l){var o=l.prev,c=l,p=l.next;if(Zi(o,c,p)>=0)return!1;for(var m=o.x,b=c.x,x=p.x,I=o.y,T=c.y,A=p.y,R=m<b?m<x?m:x:b<x?b:x,z=I<T?I<A?I:A:T<A?T:A,j=m>b?m>x?m:x:b>x?b:x,H=I>T?I>A?I:A:T>A?T:A,Y=p.next;Y!==o;){if(Y.x>=R&&Y.x<=j&&Y.y>=z&&Y.y<=H&&Ih(m,I,b,T,x,A,Y.x,Y.y)&&Zi(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function e2(l,o,c,p){var m=l.prev,b=l,x=l.next;if(Zi(m,b,x)>=0)return!1;for(var I=m.x,T=b.x,A=x.x,R=m.y,z=b.y,j=x.y,H=I<T?I<A?I:A:T<A?T:A,Y=R<z?R<j?R:j:z<j?z:j,tt=I>T?I>A?I:A:T>A?T:A,ot=R>z?R>j?R:j:z>j?z:j,dt=p_(H,Y,o,c,p),Dt=p_(tt,ot,o,c,p),bt=l.prevZ,Lt=l.nextZ;bt&&bt.z>=dt&&Lt&&Lt.z<=Dt;){if(bt.x>=H&&bt.x<=tt&&bt.y>=Y&&bt.y<=ot&&bt!==m&&bt!==x&&Ih(I,R,T,z,A,j,bt.x,bt.y)&&Zi(bt.prev,bt,bt.next)>=0||(bt=bt.prevZ,Lt.x>=H&&Lt.x<=tt&&Lt.y>=Y&&Lt.y<=ot&&Lt!==m&&Lt!==x&&Ih(I,R,T,z,A,j,Lt.x,Lt.y)&&Zi(Lt.prev,Lt,Lt.next)>=0))return!1;Lt=Lt.nextZ}for(;bt&&bt.z>=dt;){if(bt.x>=H&&bt.x<=tt&&bt.y>=Y&&bt.y<=ot&&bt!==m&&bt!==x&&Ih(I,R,T,z,A,j,bt.x,bt.y)&&Zi(bt.prev,bt,bt.next)>=0)return!1;bt=bt.prevZ}for(;Lt&&Lt.z<=Dt;){if(Lt.x>=H&&Lt.x<=tt&&Lt.y>=Y&&Lt.y<=ot&&Lt!==m&&Lt!==x&&Ih(I,R,T,z,A,j,Lt.x,Lt.y)&&Zi(Lt.prev,Lt,Lt.next)>=0)return!1;Lt=Lt.nextZ}return!0}function n2(l,o,c){var p=l;do{var m=p.prev,b=p.next.next;!dm(m,b)&&C0(m,p,p.next,b)&&hp(m,b)&&hp(b,m)&&(o.push(m.i/c|0),o.push(p.i/c|0),o.push(b.i/c|0),fp(p),fp(p.next),p=l=b),p=p.next}while(p!==l);return hc(p)}function i2(l,o,c,p,m,b){var x=l;do{for(var I=x.next.next;I!==x.prev;){if(x.i!==I.i&&l2(x,I)){var T=T0(x,I);return x=hc(x,x.next),T=hc(T,T.next),cp(x,o,c,p,m,b,0),void cp(T,o,c,p,m,b,0)}I=I.next}x=x.next}while(x!==l)}function r2(l,o){return l.x-o.x}function o2(l,o){var c=function(m,b){var x,I=b,T=m.x,A=m.y,R=-1/0;do{if(A<=I.y&&A>=I.next.y&&I.next.y!==I.y){var z=I.x+(A-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(z<=T&&z>R&&(R=z,x=I.x<I.next.x?I:I.next,z===T))return x}I=I.next}while(I!==b);if(!x)return null;var j,H=x,Y=x.x,tt=x.y,ot=1/0;I=x;do T>=I.x&&I.x>=Y&&T!==I.x&&Ih(A<tt?T:R,A,Y,tt,A<tt?R:T,A,I.x,I.y)&&(j=Math.abs(A-I.y)/(T-I.x),hp(I,m)&&(j<ot||j===ot&&(I.x>x.x||I.x===x.x&&s2(x,I)))&&(x=I,ot=j)),I=I.next;while(I!==H);return x}(l,o);if(!c)return o;var p=T0(c,l);return hc(p,p.next),hc(c,c.next)}function s2(l,o){return Zi(l.prev,l,o.prev)<0&&Zi(o.next,l,l.next)<0}function p_(l,o,c,p,m){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-c)*m|0)|l<<8))|l<<4))|l<<2))|l<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-p)*m|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function a2(l){var o=l,c=l;do(o.x<c.x||o.x===c.x&&o.y<c.y)&&(c=o),o=o.next;while(o!==l);return c}function Ih(l,o,c,p,m,b,x,I){return(m-x)*(o-I)>=(l-x)*(b-I)&&(l-x)*(p-I)>=(c-x)*(o-I)&&(c-x)*(b-I)>=(m-x)*(p-I)}function l2(l,o){return l.next.i!==o.i&&l.prev.i!==o.i&&!function(c,p){var m=c;do{if(m.i!==c.i&&m.next.i!==c.i&&m.i!==p.i&&m.next.i!==p.i&&C0(m,m.next,c,p))return!0;m=m.next}while(m!==c);return!1}(l,o)&&(hp(l,o)&&hp(o,l)&&function(c,p){var m=c,b=!1,x=(c.x+p.x)/2,I=(c.y+p.y)/2;do m.y>I!=m.next.y>I&&m.next.y!==m.y&&x<(m.next.x-m.x)*(I-m.y)/(m.next.y-m.y)+m.x&&(b=!b),m=m.next;while(m!==c);return b}(l,o)&&(Zi(l.prev,l,o.prev)||Zi(l,o.prev,o))||dm(l,o)&&Zi(l.prev,l,l.next)>0&&Zi(o.prev,o,o.next)>0)}function Zi(l,o,c){return(o.y-l.y)*(c.x-o.x)-(o.x-l.x)*(c.y-o.y)}function dm(l,o){return l.x===o.x&&l.y===o.y}function C0(l,o,c,p){var m=gm(Zi(l,o,c)),b=gm(Zi(l,o,p)),x=gm(Zi(c,p,l)),I=gm(Zi(c,p,o));return m!==b&&x!==I||!(m!==0||!mm(l,c,o))||!(b!==0||!mm(l,p,o))||!(x!==0||!mm(c,l,p))||!(I!==0||!mm(c,o,p))}function mm(l,o,c){return o.x<=Math.max(l.x,c.x)&&o.x>=Math.min(l.x,c.x)&&o.y<=Math.max(l.y,c.y)&&o.y>=Math.min(l.y,c.y)}function gm(l){return l>0?1:l<0?-1:0}function hp(l,o){return Zi(l.prev,l,l.next)<0?Zi(l,o,l.next)>=0&&Zi(l,l.prev,o)>=0:Zi(l,o,l.prev)<0||Zi(l,l.next,o)<0}function T0(l,o){var c=new d_(l.i,l.x,l.y),p=new d_(o.i,o.x,o.y),m=l.next,b=o.prev;return l.next=o,o.prev=l,c.next=m,m.prev=c,p.next=c,c.prev=p,b.next=p,p.prev=b,p}function L0(l,o,c,p){var m=new d_(l,o,c);return p?(m.next=p.next,m.prev=p,p.next.prev=m,p.next=m):(m.prev=m,m.next=m),m}function fp(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function d_(l,o,c){this.i=l,this.x=o,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function m_(l,o,c,p){for(var m=0,b=o,x=c-p;b<c;b+=p)m+=(l[x]-l[b])*(l[b+1]+l[x+1]),x=b;return m}f_.exports=pm,f_.exports.default=pm,pm.deviation=function(l,o,c,p){var m=o&&o.length,b=Math.abs(m_(l,0,m?o[0]*c:l.length,c));if(m)for(var x=0,I=o.length;x<I;x++)b-=Math.abs(m_(l,o[x]*c,x<I-1?o[x+1]*c:l.length,c));var T=0;for(x=0;x<p.length;x+=3){var A=p[x]*c,R=p[x+1]*c,z=p[x+2]*c;T+=Math.abs((l[A]-l[z])*(l[R+1]-l[A+1])-(l[A]-l[R])*(l[z+1]-l[A+1]))}return b===0&&T===0?0:Math.abs((T-b)/b)},pm.flatten=function(l){for(var o=l[0][0].length,c={vertices:[],holes:[],dimensions:o},p=0,m=0;m<l.length;m++){for(var b=0;b<l[m].length;b++)for(var x=0;x<o;x++)c.vertices.push(l[m][b][x]);m>0&&c.holes.push(p+=l[m-1].length)}return c};var M0=_(f_.exports);function u2(l,o,c,p,m){P0(l,o,c||0,p||l.length-1,m||c2)}function P0(l,o,c,p,m){for(;p>c;){if(p-c>600){var b=p-c+1,x=o-c+1,I=Math.log(b),T=.5*Math.exp(2*I/3),A=.5*Math.sqrt(I*T*(b-T)/b)*(x-b/2<0?-1:1);P0(l,o,Math.max(c,Math.floor(o-x*T/b+A)),Math.min(p,Math.floor(o+(b-x)*T/b+A)),m)}var R=l[o],z=c,j=p;for(pp(l,c,o),m(l[p],R)>0&&pp(l,c,p);z<j;){for(pp(l,z,j),z++,j--;m(l[z],R)<0;)z++;for(;m(l[j],R)>0;)j--}m(l[c],R)===0?pp(l,c,j):pp(l,++j,p),j<=o&&(c=j+1),o<=j&&(p=j-1)}}function pp(l,o,c){var p=l[o];l[o]=l[c],l[c]=p}function c2(l,o){return l<o?-1:l>o?1:0}function g_(l,o){const c=l.length;if(c<=1)return[l];const p=[];let m,b;for(let x=0;x<c;x++){const I=oe(l[x]);I!==0&&(l[x].area=Math.abs(I),b===void 0&&(b=I<0),b===I<0?(m&&p.push(m),m=[l[x]]):m.push(l[x]))}if(m&&p.push(m),o>1)for(let x=0;x<p.length;x++)p[x].length<=o||(u2(p[x],o,1,p[x].length-1,h2),p[x]=p[x].slice(0,o));return p}function h2(l,o){return o.area-l.area}function __(l,o,c){const p=c.patternDependencies;let m=!1;for(const b of o){const x=b.paint.get(`${l}-pattern`);x.isConstant()||(m=!0);const I=x.constantOr(null);I&&(m=!0,p[I.to]=!0,p[I.from]=!0)}return m}function y_(l,o,c,p,m){const b=m.patternDependencies;for(const x of o){const I=x.paint.get(`${l}-pattern`).value;if(I.kind!=="constant"){let T=I.evaluate({zoom:p-1},c,{},m.availableImages),A=I.evaluate({zoom:p},c,{},m.availableImages),R=I.evaluate({zoom:p+1},c,{},m.availableImages);T=T&&T.name?T.name:T,A=A&&A.name?A.name:A,R=R&&R.name?R.name:R,b[T]=!0,b[A]=!0,b[R]=!0,c.patterns[x.id]={min:T,mid:A,max:R}}}return c}class v_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rt,this.indexArray=new ee,this.indexArray2=new Qt,this.programConfigurations=new Ir(o.layers,o.zoom),this.segments=new Ue,this.segments2=new Ue,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){this.hasPattern=__("fill",this.layers,c);const m=this.layers[0].layout.get("fill-sort-key"),b=!m.isConstant(),x=[];for(const{feature:I,id:T,index:A,sourceLayerIndex:R}of o){const z=this.layers[0]._featureFilter.needGeometry,j=kl(I,z);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),j,p))continue;const H=b?m.evaluate(j,{},p,c.availableImages):void 0,Y={id:T,properties:I.properties,type:I.type,sourceLayerIndex:R,index:A,geometry:z?j.geometry:Pl(I),patterns:{},sortKey:H};x.push(Y)}b&&x.sort((I,T)=>I.sortKey-T.sortKey);for(const I of x){const{geometry:T,index:A,sourceLayerIndex:R}=I;if(this.hasPattern){const z=y_("fill",this.layers,I,this.zoom,c);this.patternFeatures.push(z)}else this.addFeature(I,T,A,p,{});c.featureIndex.insert(o[A].feature,T,A,R,this.index)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}addFeatures(o,c,p){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Qw),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,c,p,m,b){for(const x of g_(c,500)){let I=0;for(const H of x)I+=H.length;const T=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),A=T.vertexLength,R=[],z=[];for(const H of x){if(H.length===0)continue;H!==x[0]&&z.push(R.length/2);const Y=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),tt=Y.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(tt+H.length-1,tt),R.push(H[0].x),R.push(H[0].y);for(let ot=1;ot<H.length;ot++)this.layoutVertexArray.emplaceBack(H[ot].x,H[ot].y),this.indexArray2.emplaceBack(tt+ot-1,tt+ot),R.push(H[ot].x),R.push(H[ot].y);Y.vertexLength+=H.length,Y.primitiveLength+=H.length}const j=M0(R,z);for(let H=0;H<j.length;H+=3)this.indexArray.emplaceBack(A+j[H],A+j[H+1],A+j[H+2]);T.vertexLength+=I,T.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,b,m)}}let k0,A0;xe("FillBucket",v_,{omit:["layers","patternFeatures"]});var f2={get paint(){return A0=A0||new uo({"fill-antialias":new ke(Bt.paint_fill["fill-antialias"]),"fill-opacity":new qe(Bt.paint_fill["fill-opacity"]),"fill-color":new qe(Bt.paint_fill["fill-color"]),"fill-outline-color":new qe(Bt.paint_fill["fill-outline-color"]),"fill-translate":new ke(Bt.paint_fill["fill-translate"]),"fill-translate-anchor":new ke(Bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new cu(Bt.paint_fill["fill-pattern"])})},get layout(){return k0=k0||new uo({"fill-sort-key":new qe(Bt.layout_fill["fill-sort-key"])})}};class p2 extends Ss{constructor(o){super(o,f2)}recalculate(o,c){super.recalculate(o,c);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new v_(o)}queryRadius(){return cm(this.paint.get("fill-translate"))}queryIntersectsFeature(o,c,p,m,b,x,I){return xh(hm(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,I),m)}isTileClipped(){return!0}}const d2=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),m2=Gi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:g2}=d2;var du={},_2=w,D0=Eh;function Eh(l,o,c,p,m){this.properties={},this.extent=c,this.type=0,this._pbf=l,this._geometry=-1,this._keys=p,this._values=m,l.readFields(y2,this,o)}function y2(l,o,c){l==1?o.id=c.readVarint():l==2?function(p,m){for(var b=p.readVarint()+p.pos;p.pos<b;){var x=m._keys[p.readVarint()],I=m._values[p.readVarint()];m.properties[x]=I}}(c,o):l==3?o.type=c.readVarint():l==4&&(o._geometry=c.pos)}function v2(l){for(var o,c,p=0,m=0,b=l.length,x=b-1;m<b;x=m++)p+=((c=l[x]).x-(o=l[m]).x)*(o.y+c.y);return p}Eh.types=["Unknown","Point","LineString","Polygon"],Eh.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var o,c=l.readVarint()+l.pos,p=1,m=0,b=0,x=0,I=[];l.pos<c;){if(m<=0){var T=l.readVarint();p=7&T,m=T>>3}if(m--,p===1||p===2)b+=l.readSVarint(),x+=l.readSVarint(),p===1&&(o&&I.push(o),o=[]),o.push(new _2(b,x));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&I.push(o),I},Eh.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var o=l.readVarint()+l.pos,c=1,p=0,m=0,b=0,x=1/0,I=-1/0,T=1/0,A=-1/0;l.pos<o;){if(p<=0){var R=l.readVarint();c=7&R,p=R>>3}if(p--,c===1||c===2)(m+=l.readSVarint())<x&&(x=m),m>I&&(I=m),(b+=l.readSVarint())<T&&(T=b),b>A&&(A=b);else if(c!==7)throw new Error("unknown command "+c)}return[x,T,I,A]},Eh.prototype.toGeoJSON=function(l,o,c){var p,m,b=this.extent*Math.pow(2,c),x=this.extent*l,I=this.extent*o,T=this.loadGeometry(),A=Eh.types[this.type];function R(H){for(var Y=0;Y<H.length;Y++){var tt=H[Y];H[Y]=[360*(tt.x+x)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(tt.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(p=0;p<T.length;p++)z[p]=T[p][0];R(T=z);break;case 2:for(p=0;p<T.length;p++)R(T[p]);break;case 3:for(T=function(H){var Y=H.length;if(Y<=1)return[H];for(var tt,ot,dt=[],Dt=0;Dt<Y;Dt++){var bt=v2(H[Dt]);bt!==0&&(ot===void 0&&(ot=bt<0),ot===bt<0?(tt&&dt.push(tt),tt=[H[Dt]]):tt.push(H[Dt]))}return tt&&dt.push(tt),dt}(T),p=0;p<T.length;p++)for(m=0;m<T[p].length;m++)R(T[p][m])}T.length===1?T=T[0]:A="Multi"+A;var j={type:"Feature",geometry:{type:A,coordinates:T},properties:this.properties};return"id"in this&&(j.id=this.id),j};var b2=D0,N0=R0;function R0(l,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(x2,this,o),this.length=this._features.length}function x2(l,o,c){l===15?o.version=c.readVarint():l===1?o.name=c.readString():l===5?o.extent=c.readVarint():l===2?o._features.push(c.pos):l===3?o._keys.push(c.readString()):l===4&&o._values.push(function(p){for(var m=null,b=p.readVarint()+p.pos;p.pos<b;){var x=p.readVarint()>>3;m=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}return m}(c))}R0.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var o=this._pbf.readVarint()+this._pbf.pos;return new b2(this._pbf,o,this.extent,this._keys,this._values)};var w2=N0;function S2(l,o,c){if(l===3){var p=new w2(c,c.readVarint()+c.pos);p.length&&(o[p.name]=p)}}du.VectorTile=function(l,o){this.layers=l.readFields(S2,{},o)},du.VectorTileFeature=D0,du.VectorTileLayer=N0;const I2=du.VectorTileFeature.types,b_=Math.pow(2,13);function dp(l,o,c,p,m,b,x,I){l.emplaceBack(o,c,2*Math.floor(p*b_)+x,m*b_*2,b*b_*2,Math.round(I))}class x_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new at,this.centroidVertexArray=new $,this.indexArray=new ee,this.programConfigurations=new Ir(o.layers,o.zoom),this.segments=new Ue,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){this.features=[],this.hasPattern=__("fill-extrusion",this.layers,c);for(const{feature:m,id:b,index:x,sourceLayerIndex:I}of o){const T=this.layers[0]._featureFilter.needGeometry,A=kl(m,T);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),A,p))continue;const R={id:b,sourceLayerIndex:I,index:x,geometry:T?A.geometry:Pl(m),properties:m.properties,type:m.type,patterns:{}};this.hasPattern?this.features.push(y_("fill-extrusion",this.layers,R,this.zoom,c)):this.addFeature(R,R.geometry,x,p,{}),c.featureIndex.insert(m,R.geometry,x,I,this.index,!0)}}addFeatures(o,c,p){for(const m of this.features){const{geometry:b}=m;this.addFeature(m,b,m.index,c,p)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,g2),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,m2.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,c,p,m,b){const x={x:0,y:0,vertexCount:0};for(const I of g_(c,500)){let T=0;for(const Y of I)T+=Y.length;let A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Y of I){if(Y.length===0||C2(Y))continue;let tt=0;for(let ot=0;ot<Y.length;ot++){const dt=Y[ot];if(ot>=1){const Dt=Y[ot-1];if(!E2(dt,Dt)){A.vertexLength+4>Ue.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const bt=dt.sub(Dt)._perp()._unit(),Lt=Dt.dist(dt);tt+Lt>32768&&(tt=0),dp(this.layoutVertexArray,dt.x,dt.y,bt.x,bt.y,0,0,tt),dp(this.layoutVertexArray,dt.x,dt.y,bt.x,bt.y,0,1,tt),x.x+=2*dt.x,x.y+=2*dt.y,x.vertexCount+=2,tt+=Lt,dp(this.layoutVertexArray,Dt.x,Dt.y,bt.x,bt.y,0,0,tt),dp(this.layoutVertexArray,Dt.x,Dt.y,bt.x,bt.y,0,1,tt),x.x+=2*Dt.x,x.y+=2*Dt.y,x.vertexCount+=2;const Yt=A.vertexLength;this.indexArray.emplaceBack(Yt,Yt+2,Yt+1),this.indexArray.emplaceBack(Yt+1,Yt+2,Yt+3),A.vertexLength+=4,A.primitiveLength+=2}}}}if(A.vertexLength+T>Ue.MAX_VERTEX_ARRAY_LENGTH&&(A=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),I2[o.type]!=="Polygon")continue;const R=[],z=[],j=A.vertexLength;for(const Y of I)if(Y.length!==0){Y!==I[0]&&z.push(R.length/2);for(let tt=0;tt<Y.length;tt++){const ot=Y[tt];dp(this.layoutVertexArray,ot.x,ot.y,0,0,1,1,0),x.x+=ot.x,x.y+=ot.y,x.vertexCount+=1,R.push(ot.x),R.push(ot.y)}}const H=M0(R,z);for(let Y=0;Y<H.length;Y+=3)this.indexArray.emplaceBack(j+H[Y],j+H[Y+2],j+H[Y+1]);A.primitiveLength+=H.length/3,A.vertexLength+=T}for(let I=0;I<x.vertexCount;I++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,b,m)}}function E2(l,o){return l.x===o.x&&(l.x<0||l.x>zi)||l.y===o.y&&(l.y<0||l.y>zi)}function C2(l){return l.every(o=>o.x<0)||l.every(o=>o.x>zi)||l.every(o=>o.y<0)||l.every(o=>o.y>zi)}let z0;xe("FillExtrusionBucket",x_,{omit:["layers","features"]});var T2={get paint(){return z0=z0||new uo({"fill-extrusion-opacity":new ke(Bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qe(Bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ke(Bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ke(Bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new cu(Bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qe(Bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qe(Bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ke(Bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class L2 extends Ss{constructor(o){super(o,T2)}createBucket(o){return new x_(o)}queryRadius(){return cm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,c,p,m,b,x,I,T){const A=hm(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,I),R=this.paint.get("fill-extrusion-height").evaluate(c,p),z=this.paint.get("fill-extrusion-base").evaluate(c,p),j=function(Y,tt,ot,dt){const Dt=[];for(const bt of Y){const Lt=[bt.x,bt.y,0,1];fm(Lt,Lt,tt),Dt.push(new E(Lt[0]/Lt[3],Lt[1]/Lt[3]))}return Dt}(A,T),H=function(Y,tt,ot,dt){const Dt=[],bt=[],Lt=dt[8]*tt,Yt=dt[9]*tt,Jt=dt[10]*tt,ve=dt[11]*tt,Me=dt[8]*ot,ye=dt[9]*ot,ge=dt[10]*ot,he=dt[11]*ot;for(const Ce of Y){const fe=[],re=[];for(const Be of Ce){const De=Be.x,mn=Be.y,pi=dt[0]*De+dt[4]*mn+dt[12],_i=dt[1]*De+dt[5]*mn+dt[13],pr=dt[2]*De+dt[6]*mn+dt[14],as=dt[3]*De+dt[7]*mn+dt[15],To=pr+Jt,nr=as+ve,Nr=pi+Me,Hr=_i+ye,Lo=pr+ge,Mo=as+he,dr=new E((pi+Lt)/nr,(_i+Yt)/nr);dr.z=To/nr,fe.push(dr);const mr=new E(Nr/Mo,Hr/Mo);mr.z=Lo/Mo,re.push(mr)}Dt.push(fe),bt.push(re)}return[Dt,bt]}(m,z,R,T);return function(Y,tt,ot){let dt=1/0;xh(ot,tt)&&(dt=O0(ot,tt[0]));for(let Dt=0;Dt<tt.length;Dt++){const bt=tt[Dt],Lt=Y[Dt];for(let Yt=0;Yt<bt.length-1;Yt++){const Jt=bt[Yt],ve=[Jt,bt[Yt+1],Lt[Yt+1],Lt[Yt],Jt];sp(ot,ve)&&(dt=Math.min(dt,O0(ot,ve)))}}return dt!==1/0&&dt}(H[0],H[1],j)}}function mp(l,o){return l.x*o.x+l.y*o.y}function O0(l,o){if(l.length===1){let c=0;const p=o[c++];let m;for(;!m||p.equals(m);)if(m=o[c++],!m)return 1/0;for(;c<o.length;c++){const b=o[c],x=l[0],I=m.sub(p),T=b.sub(p),A=x.sub(p),R=mp(I,I),z=mp(I,T),j=mp(T,T),H=mp(A,I),Y=mp(A,T),tt=R*j-z*z,ot=(j*H-z*Y)/tt,dt=(R*Y-z*H)/tt,Dt=p.z*(1-ot-dt)+m.z*ot+b.z*dt;if(isFinite(Dt))return Dt}return 1/0}{let c=1/0;for(const p of o)c=Math.min(c,p.z);return c}}const M2=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:P2}=M2,k2=Gi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:A2}=k2,D2=du.VectorTileFeature.types,N2=Math.cos(Math.PI/180*37.5),F0=Math.pow(2,14)/.5;class w_{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(c=>c.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new et,this.layoutVertexArray2=new It,this.indexArray=new ee,this.programConfigurations=new Ir(o.layers,o.zoom),this.segments=new Ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(o,c,p){this.hasPattern=__("line",this.layers,c);const m=this.layers[0].layout.get("line-sort-key"),b=!m.isConstant(),x=[];for(const{feature:I,id:T,index:A,sourceLayerIndex:R}of o){const z=this.layers[0]._featureFilter.needGeometry,j=kl(I,z);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),j,p))continue;const H=b?m.evaluate(j,{},p):void 0,Y={id:T,properties:I.properties,type:I.type,sourceLayerIndex:R,index:A,geometry:z?j.geometry:Pl(I),patterns:{},sortKey:H};x.push(Y)}b&&x.sort((I,T)=>I.sortKey-T.sortKey);for(const I of x){const{geometry:T,index:A,sourceLayerIndex:R}=I;if(this.hasPattern){const z=y_("line",this.layers,I,this.zoom,c);this.patternFeatures.push(z)}else this.addFeature(I,T,A,p,{});c.featureIndex.insert(o[A].feature,T,A,R,this.index)}}update(o,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,c,this.stateDependentLayers,p)}addFeatures(o,c,p){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,A2)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,P2),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,c,p,m,b){const x=this.layers[0].layout,I=x.get("line-join").evaluate(o,{}),T=x.get("line-cap"),A=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const z of c)this.addLine(z,o,I,T,A,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,p,b,m)}addLine(o,c,p,m,b,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let dt=0;dt<o.length-1;dt++)this.totalDistance+=o[dt].dist(o[dt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=D2[c.type]==="Polygon";let T=o.length;for(;T>=2&&o[T-1].equals(o[T-2]);)T--;let A=0;for(;A<T-1&&o[A].equals(o[A+1]);)A++;if(T<(I?3:2))return;p==="bevel"&&(b=1.05);const R=this.overscaling<=16?15*zi/(512*this.overscaling):0,z=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let j,H,Y,tt,ot;this.e1=this.e2=-1,I&&(j=o[T-2],ot=o[A].sub(j)._unit()._perp());for(let dt=A;dt<T;dt++){if(Y=dt===T-1?I?o[A+1]:void 0:o[dt+1],Y&&o[dt].equals(Y))continue;ot&&(tt=ot),j&&(H=j),j=o[dt],ot=Y?Y.sub(j)._unit()._perp():tt,tt=tt||ot;let Dt=tt.add(ot);Dt.x===0&&Dt.y===0||Dt._unit();const bt=tt.x*ot.x+tt.y*ot.y,Lt=Dt.x*ot.x+Dt.y*ot.y,Yt=Lt!==0?1/Lt:1/0,Jt=2*Math.sqrt(2-2*Lt),ve=Lt<N2&&H&&Y,Me=tt.x*ot.y-tt.y*ot.x>0;if(ve&&dt>A){const he=j.dist(H);if(he>2*R){const Ce=j.sub(j.sub(H)._mult(R/he)._round());this.updateDistance(H,Ce),this.addCurrentVertex(Ce,tt,0,0,z),H=Ce}}const ye=H&&Y;let ge=ye?p:I?"butt":m;if(ye&&ge==="round"&&(Yt<x?ge="miter":Yt<=2&&(ge="fakeround")),ge==="miter"&&Yt>b&&(ge="bevel"),ge==="bevel"&&(Yt>2&&(ge="flipbevel"),Yt<b&&(ge="miter")),H&&this.updateDistance(H,j),ge==="miter")Dt._mult(Yt),this.addCurrentVertex(j,Dt,0,0,z);else if(ge==="flipbevel"){if(Yt>100)Dt=ot.mult(-1);else{const he=Yt*tt.add(ot).mag()/tt.sub(ot).mag();Dt._perp()._mult(he*(Me?-1:1))}this.addCurrentVertex(j,Dt,0,0,z),this.addCurrentVertex(j,Dt.mult(-1),0,0,z)}else if(ge==="bevel"||ge==="fakeround"){const he=-Math.sqrt(Yt*Yt-1),Ce=Me?he:0,fe=Me?0:he;if(H&&this.addCurrentVertex(j,tt,Ce,fe,z),ge==="fakeround"){const re=Math.round(180*Jt/Math.PI/20);for(let Be=1;Be<re;Be++){let De=Be/re;if(De!==.5){const pi=De-.5;De+=De*pi*(De-1)*((1.0904+bt*(bt*(3.55645-1.43519*bt)-3.2452))*pi*pi+(.848013+bt*(.215638*bt-1.06021)))}const mn=ot.sub(tt)._mult(De)._add(tt)._unit()._mult(Me?-1:1);this.addHalfVertex(j,mn.x,mn.y,!1,Me,0,z)}}Y&&this.addCurrentVertex(j,ot,-Ce,-fe,z)}else if(ge==="butt")this.addCurrentVertex(j,Dt,0,0,z);else if(ge==="square"){const he=H?1:-1;this.addCurrentVertex(j,Dt,he,he,z)}else ge==="round"&&(H&&(this.addCurrentVertex(j,tt,0,0,z),this.addCurrentVertex(j,tt,1,1,z,!0)),Y&&(this.addCurrentVertex(j,ot,-1,-1,z,!0),this.addCurrentVertex(j,ot,0,0,z)));if(ve&&dt<T-1){const he=j.dist(Y);if(he>2*R){const Ce=j.add(Y.sub(j)._mult(R/he)._round());this.updateDistance(j,Ce),this.addCurrentVertex(Ce,ot,0,0,z),j=Ce}}}}addCurrentVertex(o,c,p,m,b,x=!1){const I=c.y*m-c.x,T=-c.y-c.x*m;this.addHalfVertex(o,c.x+c.y*p,c.y-c.x*p,x,!1,p,b),this.addHalfVertex(o,I,T,x,!0,-m,b),this.distance>F0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,c,p,m,b,x))}addHalfVertex({x:o,y:c},p,m,b,x,I,T){const A=.5*(this.lineClips?this.scaledDistance*(F0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(b?1:0),(c<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*m)+128,1+(I===0?0:I<0?-1:1)|(63&A)<<2,A>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),T.primitiveLength++),x?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,c){this.distance+=o.dist(c),this.updateScaledDistance()}}let B0,V0;xe("LineBucket",w_,{omit:["layers","patternFeatures"]});var U0={get paint(){return V0=V0||new uo({"line-opacity":new qe(Bt.paint_line["line-opacity"]),"line-color":new qe(Bt.paint_line["line-color"]),"line-translate":new ke(Bt.paint_line["line-translate"]),"line-translate-anchor":new ke(Bt.paint_line["line-translate-anchor"]),"line-width":new qe(Bt.paint_line["line-width"]),"line-gap-width":new qe(Bt.paint_line["line-gap-width"]),"line-offset":new qe(Bt.paint_line["line-offset"]),"line-blur":new qe(Bt.paint_line["line-blur"]),"line-dasharray":new Wf(Bt.paint_line["line-dasharray"]),"line-pattern":new cu(Bt.paint_line["line-pattern"]),"line-gradient":new Hf(Bt.paint_line["line-gradient"])})},get layout(){return B0=B0||new uo({"line-cap":new ke(Bt.layout_line["line-cap"]),"line-join":new qe(Bt.layout_line["line-join"]),"line-miter-limit":new ke(Bt.layout_line["line-miter-limit"]),"line-round-limit":new ke(Bt.layout_line["line-round-limit"]),"line-sort-key":new qe(Bt.layout_line["line-sort-key"])})}};class R2 extends qe{possiblyEvaluate(o,c){return c=new ci(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(o,c)}evaluate(o,c,p,m){return c=ut({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(o,c,p,m)}}let _m;class z2 extends Ss{constructor(o){super(o,U0),this.gradientVersion=0,_m||(_m=new R2(U0.paint.properties["line-width"].specification),_m.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Yu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,c){super.recalculate(o,c),this.paint._values["line-floorwidth"]=_m.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new w_(o)}queryRadius(o){const c=o,p=G0(ap("line-width",this,c),ap("line-gap-width",this,c)),m=ap("line-offset",this,c);return p/2+Math.abs(m)+cm(this.paint.get("line-translate"))}queryIntersectsFeature(o,c,p,m,b,x,I){const T=hm(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,I),A=I/2*G0(this.paint.get("line-width").evaluate(c,p),this.paint.get("line-gap-width").evaluate(c,p)),R=this.paint.get("line-offset").evaluate(c,p);return R&&(m=function(z,j){const H=[];for(let Y=0;Y<z.length;Y++){const tt=z[Y],ot=[];for(let dt=0;dt<tt.length;dt++){const Dt=tt[dt-1],bt=tt[dt],Lt=tt[dt+1],Yt=dt===0?new E(0,0):bt.sub(Dt)._unit()._perp(),Jt=dt===tt.length-1?new E(0,0):Lt.sub(bt)._unit()._perp(),ve=Yt._add(Jt)._unit(),Me=ve.x*Jt.x+ve.y*Jt.y;Me!==0&&ve._mult(1/Me),ot.push(ve._mult(j)._add(bt))}H.push(ot)}return H}(m,R*I)),function(z,j,H){for(let Y=0;Y<j.length;Y++){const tt=j[Y];if(z.length>=3){for(let ot=0;ot<tt.length;ot++)if(wh(z,tt[ot]))return!0}if(um(z,tt,H))return!0}return!1}(T,m,A)}isTileClipped(){return!0}}function G0(l,o){return o>0?o+2*l:l}const O2=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),F2=Gi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const B2=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Gi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const j0=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),V2=Gi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function U2(l,o,c){return l.sections.forEach(p=>{p.text=function(m,b,x){const I=b.layout.get("text-transform").evaluate(x,{});return I==="uppercase"?m=m.toLocaleUpperCase():I==="lowercase"&&(m=m.toLocaleLowerCase()),Cl.applyArabicShaping&&(m=Cl.applyArabicShaping(m)),m}(p.text,o,c)}),l}Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const gp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var fr=24,q0=Xn,Z0=function(l,o,c,p,m){var b,x,I=8*m-p-1,T=(1<<I)-1,A=T>>1,R=-7,z=c?m-1:0,j=c?-1:1,H=l[o+z];for(z+=j,b=H&(1<<-R)-1,H>>=-R,R+=I;R>0;b=256*b+l[o+z],z+=j,R-=8);for(x=b&(1<<-R)-1,b>>=-R,R+=p;R>0;x=256*x+l[o+z],z+=j,R-=8);if(b===0)b=1-A;else{if(b===T)return x?NaN:1/0*(H?-1:1);x+=Math.pow(2,p),b-=A}return(H?-1:1)*x*Math.pow(2,b-p)},W0=function(l,o,c,p,m,b){var x,I,T,A=8*b-m-1,R=(1<<A)-1,z=R>>1,j=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=p?0:b-1,Y=p?1:-1,tt=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,x=R):(x=Math.floor(Math.log(o)/Math.LN2),o*(T=Math.pow(2,-x))<1&&(x--,T*=2),(o+=x+z>=1?j/T:j*Math.pow(2,1-z))*T>=2&&(x++,T/=2),x+z>=R?(I=0,x=R):x+z>=1?(I=(o*T-1)*Math.pow(2,m),x+=z):(I=o*Math.pow(2,z-1)*Math.pow(2,m),x=0));m>=8;l[c+H]=255&I,H+=Y,I/=256,m-=8);for(x=x<<m|I,A+=m;A>0;l[c+H]=255&x,H+=Y,x/=256,A-=8);l[c+H-Y]|=128*tt};function Xn(l){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(l)?l:new Uint8Array(l||0),this.pos=0,this.type=0,this.length=this.buf.length}Xn.Varint=0,Xn.Fixed64=1,Xn.Bytes=2,Xn.Fixed32=5;var S_=4294967296,H0=1/S_,$0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Al(l){return l.type===Xn.Bytes?l.readVarint()+l.pos:l.pos+1}function Ch(l,o,c){return c?4294967296*o+(l>>>0):4294967296*(o>>>0)+(l>>>0)}function X0(l,o,c){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));c.realloc(p);for(var m=c.pos-1;m>=l;m--)c.buf[m+p]=c.buf[m]}function G2(l,o){for(var c=0;c<l.length;c++)o.writeVarint(l[c])}function j2(l,o){for(var c=0;c<l.length;c++)o.writeSVarint(l[c])}function q2(l,o){for(var c=0;c<l.length;c++)o.writeFloat(l[c])}function Z2(l,o){for(var c=0;c<l.length;c++)o.writeDouble(l[c])}function W2(l,o){for(var c=0;c<l.length;c++)o.writeBoolean(l[c])}function H2(l,o){for(var c=0;c<l.length;c++)o.writeFixed32(l[c])}function $2(l,o){for(var c=0;c<l.length;c++)o.writeSFixed32(l[c])}function X2(l,o){for(var c=0;c<l.length;c++)o.writeFixed64(l[c])}function Y2(l,o){for(var c=0;c<l.length;c++)o.writeSFixed64(l[c])}function ym(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+16777216*l[o+3]}function Th(l,o,c){l[c]=o,l[c+1]=o>>>8,l[c+2]=o>>>16,l[c+3]=o>>>24}function Y0(l,o){return(l[o]|l[o+1]<<8|l[o+2]<<16)+(l[o+3]<<24)}Xn.prototype={destroy:function(){this.buf=null},readFields:function(l,o,c){for(c=c||this.length;this.pos<c;){var p=this.readVarint(),m=p>>3,b=this.pos;this.type=7&p,l(m,o,this),this.pos===b&&this.skip(p)}return o},readMessage:function(l,o){return this.readFields(l,o,this.readVarint()+this.pos)},readFixed32:function(){var l=ym(this.buf,this.pos);return this.pos+=4,l},readSFixed32:function(){var l=Y0(this.buf,this.pos);return this.pos+=4,l},readFixed64:function(){var l=ym(this.buf,this.pos)+ym(this.buf,this.pos+4)*S_;return this.pos+=8,l},readSFixed64:function(){var l=ym(this.buf,this.pos)+Y0(this.buf,this.pos+4)*S_;return this.pos+=8,l},readFloat:function(){var l=Z0(this.buf,this.pos,!0,23,4);return this.pos+=4,l},readDouble:function(){var l=Z0(this.buf,this.pos,!0,52,8);return this.pos+=8,l},readVarint:function(l){var o,c,p=this.buf;return o=127&(c=p[this.pos++]),c<128?o:(o|=(127&(c=p[this.pos++]))<<7,c<128?o:(o|=(127&(c=p[this.pos++]))<<14,c<128?o:(o|=(127&(c=p[this.pos++]))<<21,c<128?o:function(m,b,x){var I,T,A=x.buf;if(I=(112&(T=A[x.pos++]))>>4,T<128||(I|=(127&(T=A[x.pos++]))<<3,T<128)||(I|=(127&(T=A[x.pos++]))<<10,T<128)||(I|=(127&(T=A[x.pos++]))<<17,T<128)||(I|=(127&(T=A[x.pos++]))<<24,T<128)||(I|=(1&(T=A[x.pos++]))<<31,T<128))return Ch(m,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(c=p[this.pos]))<<28,l,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var l=this.readVarint();return l%2==1?(l+1)/-2:l/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var l=this.readVarint()+this.pos,o=this.pos;return this.pos=l,l-o>=12&&$0?function(c,p,m){return $0.decode(c.subarray(p,m))}(this.buf,o,l):function(c,p,m){for(var b="",x=p;x<m;){var I,T,A,R=c[x],z=null,j=R>239?4:R>223?3:R>191?2:1;if(x+j>m)break;j===1?R<128&&(z=R):j===2?(192&(I=c[x+1]))==128&&(z=(31&R)<<6|63&I)<=127&&(z=null):j===3?(T=c[x+2],(192&(I=c[x+1]))==128&&(192&T)==128&&((z=(15&R)<<12|(63&I)<<6|63&T)<=2047||z>=55296&&z<=57343)&&(z=null)):j===4&&(T=c[x+2],A=c[x+3],(192&(I=c[x+1]))==128&&(192&T)==128&&(192&A)==128&&((z=(15&R)<<18|(63&I)<<12|(63&T)<<6|63&A)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,j=1):z>65535&&(z-=65536,b+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),b+=String.fromCharCode(z),x+=j}return b}(this.buf,o,l)},readBytes:function(){var l=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,l);return this.pos=l,o},readPackedVarint:function(l,o){if(this.type!==Xn.Bytes)return l.push(this.readVarint(o));var c=Al(this);for(l=l||[];this.pos<c;)l.push(this.readVarint(o));return l},readPackedSVarint:function(l){if(this.type!==Xn.Bytes)return l.push(this.readSVarint());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readSVarint());return l},readPackedBoolean:function(l){if(this.type!==Xn.Bytes)return l.push(this.readBoolean());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readBoolean());return l},readPackedFloat:function(l){if(this.type!==Xn.Bytes)return l.push(this.readFloat());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readFloat());return l},readPackedDouble:function(l){if(this.type!==Xn.Bytes)return l.push(this.readDouble());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readDouble());return l},readPackedFixed32:function(l){if(this.type!==Xn.Bytes)return l.push(this.readFixed32());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readFixed32());return l},readPackedSFixed32:function(l){if(this.type!==Xn.Bytes)return l.push(this.readSFixed32());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed32());return l},readPackedFixed64:function(l){if(this.type!==Xn.Bytes)return l.push(this.readFixed64());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readFixed64());return l},readPackedSFixed64:function(l){if(this.type!==Xn.Bytes)return l.push(this.readSFixed64());var o=Al(this);for(l=l||[];this.pos<o;)l.push(this.readSFixed64());return l},skip:function(l){var o=7&l;if(o===Xn.Varint)for(;this.buf[this.pos++]>127;);else if(o===Xn.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Xn.Fixed32)this.pos+=4;else{if(o!==Xn.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(l,o){this.writeVarint(l<<3|o)},realloc:function(l){for(var o=this.length||16;o<this.pos+l;)o*=2;if(o!==this.length){var c=new Uint8Array(o);c.set(this.buf),this.buf=c,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(l){this.realloc(4),Th(this.buf,l,this.pos),this.pos+=4},writeSFixed32:function(l){this.realloc(4),Th(this.buf,l,this.pos),this.pos+=4},writeFixed64:function(l){this.realloc(8),Th(this.buf,-1&l,this.pos),Th(this.buf,Math.floor(l*H0),this.pos+4),this.pos+=8},writeSFixed64:function(l){this.realloc(8),Th(this.buf,-1&l,this.pos),Th(this.buf,Math.floor(l*H0),this.pos+4),this.pos+=8},writeVarint:function(l){(l=+l||0)>268435455||l<0?function(o,c){var p,m;if(o>=0?(p=o%4294967296|0,m=o/4294967296|0):(m=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,m=m+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,x,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(p,0,c),function(b,x){var I=(7&b)<<4;x.buf[x.pos++]|=I|((b>>>=3)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b|((b>>>=7)?128:0),b&&(x.buf[x.pos++]=127&b)))))}(m,c)}(l,this):(this.realloc(4),this.buf[this.pos++]=127&l|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=127&(l>>>=7)|(l>127?128:0),l<=127||(this.buf[this.pos++]=l>>>7&127))))},writeSVarint:function(l){this.writeVarint(l<0?2*-l-1:2*l)},writeBoolean:function(l){this.writeVarint(!!l)},writeString:function(l){l=String(l),this.realloc(4*l.length),this.pos++;var o=this.pos;this.pos=function(p,m,b){for(var x,I,T=0;T<m.length;T++){if((x=m.charCodeAt(T))>55295&&x<57344){if(!I){x>56319||T+1===m.length?(p[b++]=239,p[b++]=191,p[b++]=189):I=x;continue}if(x<56320){p[b++]=239,p[b++]=191,p[b++]=189,I=x;continue}x=I-55296<<10|x-56320|65536,I=null}else I&&(p[b++]=239,p[b++]=191,p[b++]=189,I=null);x<128?p[b++]=x:(x<2048?p[b++]=x>>6|192:(x<65536?p[b++]=x>>12|224:(p[b++]=x>>18|240,p[b++]=x>>12&63|128),p[b++]=x>>6&63|128),p[b++]=63&x|128)}return b}(this.buf,l,this.pos);var c=this.pos-o;c>=128&&X0(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeFloat:function(l){this.realloc(4),W0(this.buf,l,this.pos,!0,23,4),this.pos+=4},writeDouble:function(l){this.realloc(8),W0(this.buf,l,this.pos,!0,52,8),this.pos+=8},writeBytes:function(l){var o=l.length;this.writeVarint(o),this.realloc(o);for(var c=0;c<o;c++)this.buf[this.pos++]=l[c]},writeRawMessage:function(l,o){this.pos++;var c=this.pos;l(o,this);var p=this.pos-c;p>=128&&X0(c,p,this),this.pos=c-1,this.writeVarint(p),this.pos+=p},writeMessage:function(l,o,c){this.writeTag(l,Xn.Bytes),this.writeRawMessage(o,c)},writePackedVarint:function(l,o){o.length&&this.writeMessage(l,G2,o)},writePackedSVarint:function(l,o){o.length&&this.writeMessage(l,j2,o)},writePackedBoolean:function(l,o){o.length&&this.writeMessage(l,W2,o)},writePackedFloat:function(l,o){o.length&&this.writeMessage(l,q2,o)},writePackedDouble:function(l,o){o.length&&this.writeMessage(l,Z2,o)},writePackedFixed32:function(l,o){o.length&&this.writeMessage(l,H2,o)},writePackedSFixed32:function(l,o){o.length&&this.writeMessage(l,$2,o)},writePackedFixed64:function(l,o){o.length&&this.writeMessage(l,X2,o)},writePackedSFixed64:function(l,o){o.length&&this.writeMessage(l,Y2,o)},writeBytesField:function(l,o){this.writeTag(l,Xn.Bytes),this.writeBytes(o)},writeFixed32Field:function(l,o){this.writeTag(l,Xn.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(l,o){this.writeTag(l,Xn.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(l,o){this.writeTag(l,Xn.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(l,o){this.writeTag(l,Xn.Fixed64),this.writeSFixed64(o)},writeVarintField:function(l,o){this.writeTag(l,Xn.Varint),this.writeVarint(o)},writeSVarintField:function(l,o){this.writeTag(l,Xn.Varint),this.writeSVarint(o)},writeStringField:function(l,o){this.writeTag(l,Xn.Bytes),this.writeString(o)},writeFloatField:function(l,o){this.writeTag(l,Xn.Fixed32),this.writeFloat(o)},writeDoubleField:function(l,o){this.writeTag(l,Xn.Fixed64),this.writeDouble(o)},writeBooleanField:function(l,o){this.writeVarintField(l,!!o)}};var I_=_(q0);const E_=3;function K2(l,o,c){l===1&&c.readMessage(J2,o)}function J2(l,o,c){if(l===3){const{id:p,bitmap:m,width:b,height:x,left:I,top:T,advance:A}=c.readMessage(Q2,{});o.push({id:p,bitmap:new up({width:b+2*E_,height:x+2*E_},m),metrics:{width:b,height:x,left:I,top:T,advance:A}})}}function Q2(l,o,c){l===1?o.id=c.readVarint():l===2?o.bitmap=c.readBytes():l===3?o.width=c.readVarint():l===4?o.height=c.readVarint():l===5?o.left=c.readSVarint():l===6?o.top=c.readSVarint():l===7&&(o.advance=c.readVarint())}const K0=E_;function J0(l){let o=0,c=0;for(const x of l)o+=x.w*x.h,c=Math.max(c,x.w);l.sort((x,I)=>I.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),c),h:1/0}];let m=0,b=0;for(const x of l)for(let I=p.length-1;I>=0;I--){const T=p[I];if(!(x.w>T.w||x.h>T.h)){if(x.x=T.x,x.y=T.y,b=Math.max(b,x.y+x.h),m=Math.max(m,x.x+x.w),x.w===T.w&&x.h===T.h){const A=p.pop();I<p.length&&(p[I]=A)}else x.h===T.h?(T.x+=x.w,T.w-=x.w):x.w===T.w?(T.y+=x.h,T.h-=x.h):(p.push({x:T.x+x.w,y:T.y,w:T.w-x.w,h:x.h}),T.y+=x.h,T.h-=x.h);break}}return{w:m,h:b,fill:o/(m*b)||0}}const Uo=1;class C_{constructor(o,{pixelRatio:c,version:p,stretchX:m,stretchY:b,content:x}){this.paddedRect=o,this.pixelRatio=c,this.stretchX=m,this.stretchY=b,this.content=x,this.version=p}get tl(){return[this.paddedRect.x+Uo,this.paddedRect.y+Uo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Uo,this.paddedRect.y+this.paddedRect.h-Uo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Uo)/this.pixelRatio,(this.paddedRect.h-2*Uo)/this.pixelRatio]}}class Q0{constructor(o,c){const p={},m={};this.haveRenderCallbacks=[];const b=[];this.addImages(o,p,b),this.addImages(c,m,b);const{w:x,h:I}=J0(b),T=new Is({width:x||1,height:I||1});for(const A in o){const R=o[A],z=p[A].paddedRect;Is.copy(R.data,T,{x:0,y:0},{x:z.x+Uo,y:z.y+Uo},R.data)}for(const A in c){const R=c[A],z=m[A].paddedRect,j=z.x+Uo,H=z.y+Uo,Y=R.data.width,tt=R.data.height;Is.copy(R.data,T,{x:0,y:0},{x:j,y:H},R.data),Is.copy(R.data,T,{x:0,y:tt-1},{x:j,y:H-1},{width:Y,height:1}),Is.copy(R.data,T,{x:0,y:0},{x:j,y:H+tt},{width:Y,height:1}),Is.copy(R.data,T,{x:Y-1,y:0},{x:j-1,y:H},{width:1,height:tt}),Is.copy(R.data,T,{x:0,y:0},{x:j+Y,y:H},{width:1,height:tt})}this.image=T,this.iconPositions=p,this.patternPositions=m}addImages(o,c,p){for(const m in o){const b=o[m],x={x:0,y:0,w:b.data.width+2*Uo,h:b.data.height+2*Uo};p.push(x),c[m]=new C_(x,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(o,c){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in o.updatedImages)this.patchUpdatedImage(this.iconPositions[p],o.getImage(p),c),this.patchUpdatedImage(this.patternPositions[p],o.getImage(p),c)}patchUpdatedImage(o,c,p){if(!o||!c||o.version===c.version)return;o.version=c.version;const[m,b]=o.tl;p.update(c.data,void 0,{x:m,y:b})}}var mu;xe("ImagePosition",C_),xe("ImageAtlas",Q0),h.ah=void 0,(mu=h.ah||(h.ah={}))[mu.none=0]="none",mu[mu.horizontal=1]="horizontal",mu[mu.vertical=2]="vertical",mu[mu.horizontalOnly=3]="horizontalOnly";const _p=-17;class yp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,c){const p=new yp;return p.scale=o||1,p.fontStack=c,p}static forImage(o){const c=new yp;return c.imageName=o,c}}class Lh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,c){const p=new Lh;for(let m=0;m<o.sections.length;m++){const b=o.sections[m];b.image?p.addImageSection(b):p.addTextSection(b,c)}return p}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let c="";for(let p=0;p<o.length;p++){const m=o.charCodeAt(p+1)||null,b=o.charCodeAt(p-1)||null;c+=m&&dh(m)&&!gp[o[p+1]]||b&&dh(b)&&!gp[o[p-1]]||!gp[o[p]]?o[p]:gp[o[p]]}return c}(this.text)}trim(){let o=0;for(let p=0;p<this.text.length&&bm[this.text.charCodeAt(p)];p++)o++;let c=this.text.length;for(let p=this.text.length-1;p>=0&&p>=o&&bm[this.text.charCodeAt(p)];p--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)}substring(o,c){const p=new Lh;return p.text=this.text.substring(o,c),p.sectionIndex=this.sectionIndex.slice(o,c),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,c)=>Math.max(o,this.sections[c].scale),0)}addTextSection(o,c){this.text+=o.text,this.sections.push(yp.forText(o.scale,o.fontStack||c));const p=this.sections.length-1;for(let m=0;m<o.text.length;++m)this.sectionIndex.push(p)}addImageSection(o){const c=o.image?o.image.name:"";if(c.length===0)return void te("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(yp.forImage(c)),this.sectionIndex.push(this.sections.length-1)):te("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vm(l,o,c,p,m,b,x,I,T,A,R,z,j,H,Y,tt){const ot=Lh.fromFeature(l,m);let dt;z===h.ah.vertical&&ot.verticalizePunctuation();const{processBidirectionalText:Dt,processStyledBidirectionalText:bt}=Cl;if(Dt&&ot.sections.length===1){dt=[];const Jt=Dt(ot.toString(),T_(ot,A,b,o,p,H,Y));for(const ve of Jt){const Me=new Lh;Me.text=ve,Me.sections=ot.sections;for(let ye=0;ye<ve.length;ye++)Me.sectionIndex.push(0);dt.push(Me)}}else if(bt){dt=[];const Jt=bt(ot.text,ot.sectionIndex,T_(ot,A,b,o,p,H,Y));for(const ve of Jt){const Me=new Lh;Me.text=ve[0],Me.sectionIndex=ve[1],Me.sections=ot.sections,dt.push(Me)}}else dt=function(Jt,ve){const Me=[],ye=Jt.text;let ge=0;for(const he of ve)Me.push(Jt.substring(ge,he)),ge=he;return ge<ye.length&&Me.push(Jt.substring(ge,ye.length)),Me}(ot,T_(ot,A,b,o,p,H,Y));const Lt=[],Yt={positionedLines:Lt,text:ot.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Jt,ve,Me,ye,ge,he,Ce,fe,re,Be,De,mn){let pi=0,_i=_p,pr=0,as=0;const To=fe==="right"?1:fe==="left"?0:.5;let nr=0;for(const dr of ge){dr.trim();const mr=dr.getMaxScale(),fo=(mr-1)*fr,Po={positionedGlyphs:[],lineOffset:0};Jt.positionedLines[nr]=Po;const po=Po.positionedGlyphs;let Go=0;if(!dr.length()){_i+=he,++nr;continue}for(let gr=0;gr<dr.length();gr++){const En=dr.getSection(gr),mo=dr.getSectionIndex(gr),$r=dr.getCharCode(gr);let _r=0,Zs=null,xa=null,wa=null,Dl=fr;const Ws=!(re===h.ah.horizontal||!De&&!ph($r)||De&&(bm[$r]||(Nr=$r,_e.Arabic(Nr)||_e["Arabic Supplement"](Nr)||_e["Arabic Extended-A"](Nr)||_e["Arabic Presentation Forms-A"](Nr)||_e["Arabic Presentation Forms-B"](Nr))));if(En.imageName){const Cs=ye[En.imageName];if(!Cs)continue;wa=En.imageName,Jt.iconsInText=Jt.iconsInText||!0,xa=Cs.paddedRect;const qo=Cs.displaySize;En.scale=En.scale*fr/mn,Zs={width:qo[0],height:qo[1],left:Uo,top:-K0,advance:Ws?qo[1]:qo[0]},_r=fo+(fr-qo[1]*En.scale),Dl=Zs.advance;const Nl=Ws?qo[0]*En.scale-fr*mr:qo[1]*En.scale-fr*mr;Nl>0&&Nl>Go&&(Go=Nl)}else{const Cs=Me[En.fontStack],qo=Cs&&Cs[$r];if(qo&&qo.rect)xa=qo.rect,Zs=qo.metrics;else{const Nl=ve[En.fontStack],Sp=Nl&&Nl[$r];if(!Sp)continue;Zs=Sp.metrics}_r=(mr-En.scale)*fr}Ws?(Jt.verticalizable=!0,po.push({glyph:$r,imageName:wa,x:pi,y:_i+_r,vertical:Ws,scale:En.scale,fontStack:En.fontStack,sectionIndex:mo,metrics:Zs,rect:xa}),pi+=Dl*En.scale+Be):(po.push({glyph:$r,imageName:wa,x:pi,y:_i+_r,vertical:Ws,scale:En.scale,fontStack:En.fontStack,sectionIndex:mo,metrics:Zs,rect:xa}),pi+=Zs.advance*En.scale+Be)}po.length!==0&&(pr=Math.max(pi-Be,pr),nS(po,0,po.length-1,To,Go)),pi=0;const jo=he*mr+Go;Po.lineOffset=Math.max(Go,fo),_i+=jo,as=Math.max(jo,as),++nr}var Nr;const Hr=_i-_p,{horizontalAlign:Lo,verticalAlign:Mo}=L_(Ce);(function(dr,mr,fo,Po,po,Go,jo,gr,En){const mo=(mr-fo)*po;let $r=0;$r=Go!==jo?-gr*Po-_p:(-Po*En+.5)*jo;for(const _r of dr)for(const Zs of _r.positionedGlyphs)Zs.x+=mo,Zs.y+=$r})(Jt.positionedLines,To,Lo,Mo,pr,as,he,Hr,ge.length),Jt.top+=-Mo*Hr,Jt.bottom=Jt.top+Hr,Jt.left+=-Lo*pr,Jt.right=Jt.left+pr}(Yt,o,c,p,dt,x,I,T,z,A,j,tt),!function(Jt){for(const ve of Jt)if(ve.positionedGlyphs.length!==0)return!1;return!0}(Lt)&&Yt}const bm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function tv(l,o,c,p,m,b){if(o.imageName){const x=p[o.imageName];return x?x.displaySize[0]*o.scale*fr/b+m:0}{const x=c[o.fontStack],I=x&&x[l];return I?I.metrics.advance*o.scale+m:0}}function ev(l,o,c,p){const m=Math.pow(l-o,2);return p?l<o?m/2:2*m:m+Math.abs(c)*c}function eS(l,o,c){let p=0;return l===10&&(p-=1e4),c&&(p+=150),l!==40&&l!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function nv(l,o,c,p,m,b){let x=null,I=ev(o,c,m,b);for(const T of p){const A=ev(o-T.x,c,m,b)+T.badness;A<=I&&(x=T,I=A)}return{index:l,x:o,priorBreak:x,badness:I}}function iv(l){return l?iv(l.priorBreak).concat(l.index):[]}function T_(l,o,c,p,m,b,x){if(b!=="point")return[];if(!l)return[];const I=[],T=function(j,H,Y,tt,ot,dt){let Dt=0;for(let bt=0;bt<j.length();bt++){const Lt=j.getSection(bt);Dt+=tv(j.getCharCode(bt),Lt,tt,ot,H,dt)}return Dt/Math.max(1,Math.ceil(Dt/Y))}(l,o,c,p,m,x),A=l.text.indexOf("​")>=0;let R=0;for(let j=0;j<l.length();j++){const H=l.getSection(j),Y=l.getCharCode(j);if(bm[Y]||(R+=tv(Y,H,p,m,o,x)),j<l.length()-1){const tt=!((z=Y)<11904||!(_e["Bopomofo Extended"](z)||_e.Bopomofo(z)||_e["CJK Compatibility Forms"](z)||_e["CJK Compatibility Ideographs"](z)||_e["CJK Compatibility"](z)||_e["CJK Radicals Supplement"](z)||_e["CJK Strokes"](z)||_e["CJK Symbols and Punctuation"](z)||_e["CJK Unified Ideographs Extension A"](z)||_e["CJK Unified Ideographs"](z)||_e["Enclosed CJK Letters and Months"](z)||_e["Halfwidth and Fullwidth Forms"](z)||_e.Hiragana(z)||_e["Ideographic Description Characters"](z)||_e["Kangxi Radicals"](z)||_e["Katakana Phonetic Extensions"](z)||_e.Katakana(z)||_e["Vertical Forms"](z)||_e["Yi Radicals"](z)||_e["Yi Syllables"](z)));(tS[Y]||tt||H.imageName)&&I.push(nv(j+1,R,T,I,eS(Y,l.getCharCode(j+1),tt&&A),!1))}}var z;return iv(nv(l.length(),R,T,I,0,!0))}function L_(l){let o=.5,c=.5;switch(l){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:o,verticalAlign:c}}function nS(l,o,c,p,m){if(!p&&!m)return;const b=l[c],x=(l[c].x+b.metrics.advance*b.scale)*p;for(let I=o;I<=c;I++)l[I].x-=x,l[I].y+=m}function iS(l,o,c){const{horizontalAlign:p,verticalAlign:m}=L_(c),b=o[0]-l.displaySize[0]*p,x=o[1]-l.displaySize[1]*m;return{image:l,top:x,bottom:x+l.displaySize[1],left:b,right:b+l.displaySize[0]}}function rv(l,o,c,p,m,b){const x=l.image;let I;if(x.content){const ot=x.content,dt=x.pixelRatio||1;I=[ot[0]/dt,ot[1]/dt,x.displaySize[0]-ot[2]/dt,x.displaySize[1]-ot[3]/dt]}const T=o.left*b,A=o.right*b;let R,z,j,H;c==="width"||c==="both"?(H=m[0]+T-p[3],z=m[0]+A+p[1]):(H=m[0]+(T+A-x.displaySize[0])/2,z=H+x.displaySize[0]);const Y=o.top*b,tt=o.bottom*b;return c==="height"||c==="both"?(R=m[1]+Y-p[0],j=m[1]+tt+p[2]):(R=m[1]+(Y+tt-x.displaySize[1])/2,j=R+x.displaySize[1]),{image:x,top:R,right:z,bottom:j,left:H,collisionPadding:I}}const vp=255,Ya=128,gu=vp*Ya;function ov(l,o){const{expression:c}=o;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new ci(l+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:m}=c;let b=0;for(;b<p.length&&p[b]<=l;)b++;b=Math.max(0,b-1);let x=b;for(;x<p.length&&p[x]<l+1;)x++;x=Math.min(p.length-1,x);const I=p[b],T=p[x];return c.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:T,interpolationType:m}:{kind:"camera",minZoom:I,maxZoom:T,minSize:c.evaluate(new ci(I)),maxSize:c.evaluate(new ci(T)),interpolationType:m}}}function M_(l,o,c){let p="never";const m=l.get(o);return m?p=m:l.get(c)&&(p="always"),p}const rS=du.VectorTileFeature.types,oS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xm(l,o,c,p,m,b,x,I,T,A,R,z,j){const H=I?Math.min(gu,Math.round(I[0])):0,Y=I?Math.min(gu,Math.round(I[1])):0;l.emplaceBack(o,c,Math.round(32*p),Math.round(32*m),b,x,(H<<1)+(T?1:0),Y,16*A,16*R,256*z,256*j)}function P_(l,o,c){l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c),l.emplaceBack(o.x,o.y,c)}function sS(l){for(const o of l.sections)if(em(o.text))return!0;return!1}class k_{constructor(o){this.layoutVertexArray=new ft,this.indexArray=new ee,this.programConfigurations=o,this.segments=new Ue,this.dynamicLayoutVertexArray=new kt,this.opacityVertexArray=new Ut,this.hasVisibleVertices=!1,this.placedSymbolArray=new d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,c,p,m){this.isEmpty()||(p&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,O2.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,F2.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,oS,!0),this.opacityVertexBuffer.itemSize=1),(p||m)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xe("SymbolBuffers",k_);class A_{constructor(o,c,p){this.layoutVertexArray=new o,this.layoutAttributes=c,this.indexArray=new p,this.segments=new Ue,this.collisionVertexArray=new Kt}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,B2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xe("CollisionBuffers",A_);class Mh{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(x=>x.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=u_([]),this.placementViewportMatrix=u_([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ov(this.zoom,c["text-size"]),this.iconSizeData=ov(this.zoom,c["icon-size"]);const p=this.layers[0].layout,m=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=M_(p,"text-overlap","text-allow-overlap")!=="never"||M_(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!m.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(x=>h.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=o.sourceID}createArrays(){this.text=new k_(new Ir(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new k_(new Ir(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new C,this.lineVertexArray=new L,this.symbolInstances=new v,this.textAnchorOffsets=new N}calculateGlyphDependencies(o,c,p,m,b){for(let x=0;x<o.length;x++)if(c[o.charCodeAt(x)]=!0,(p||m)&&b){const I=gp[o.charAt(x)];I&&(c[I.charCodeAt(0)]=!0)}}populate(o,c,p){const m=this.layers[0],b=m.layout,x=b.get("text-font"),I=b.get("text-field"),T=b.get("icon-image"),A=(I.value.kind!=="constant"||I.value.value instanceof Fo&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),R=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=b.get("symbol-sort-key");if(this.features=[],!A&&!R)return;const j=c.iconDependencies,H=c.glyphDependencies,Y=c.availableImages,tt=new ci(this.zoom);for(const{feature:ot,id:dt,index:Dt,sourceLayerIndex:bt}of o){const Lt=m._featureFilter.needGeometry,Yt=kl(ot,Lt);if(!m._featureFilter.filter(tt,Yt,p))continue;let Jt,ve;if(Lt||(Yt.geometry=Pl(ot)),A){const ye=m.getValueAndResolveTokens("text-field",Yt,p,Y),ge=Fo.factory(ye);sS(ge)&&(this.hasRTLText=!0),(!this.hasRTLText||Cl.getRTLTextPluginStatus()==="unavailable"||this.hasRTLText&&Cl.isParsed())&&(Jt=U2(ge,m,Yt))}if(R){const ye=m.getValueAndResolveTokens("icon-image",Yt,p,Y);ve=ye instanceof rs?ye:rs.fromString(ye)}if(!Jt&&!ve)continue;const Me=this.sortFeaturesByKey?z.evaluate(Yt,{},p):void 0;if(this.features.push({id:dt,text:Jt,icon:ve,index:Dt,sourceLayerIndex:bt,geometry:Yt.geometry,properties:ot.properties,type:rS[ot.type],sortKey:Me}),ve&&(j[ve.name]=!0),Jt){const ye=x.evaluate(Yt,{},p).join(","),ge=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ah.vertical)>=0;for(const he of Jt.sections)if(he.image)j[he.image.name]=!0;else{const Ce=fh(Jt.toString()),fe=he.fontStack||ye,re=H[fe]=H[fe]||{};this.calculateGlyphDependencies(he.text,re,ge,this.allowVerticalPlacement,Ce)}}}b.get("symbol-placement")==="line"&&(this.features=function(ot){const dt={},Dt={},bt=[];let Lt=0;function Yt(ye){bt.push(ot[ye]),Lt++}function Jt(ye,ge,he){const Ce=Dt[ye];return delete Dt[ye],Dt[ge]=Ce,bt[Ce].geometry[0].pop(),bt[Ce].geometry[0]=bt[Ce].geometry[0].concat(he[0]),Ce}function ve(ye,ge,he){const Ce=dt[ge];return delete dt[ge],dt[ye]=Ce,bt[Ce].geometry[0].shift(),bt[Ce].geometry[0]=he[0].concat(bt[Ce].geometry[0]),Ce}function Me(ye,ge,he){const Ce=he?ge[0][ge[0].length-1]:ge[0][0];return`${ye}:${Ce.x}:${Ce.y}`}for(let ye=0;ye<ot.length;ye++){const ge=ot[ye],he=ge.geometry,Ce=ge.text?ge.text.toString():null;if(!Ce){Yt(ye);continue}const fe=Me(Ce,he),re=Me(Ce,he,!0);if(fe in Dt&&re in dt&&Dt[fe]!==dt[re]){const Be=ve(fe,re,he),De=Jt(fe,re,bt[Be].geometry);delete dt[fe],delete Dt[re],Dt[Me(Ce,bt[De].geometry,!0)]=De,bt[Be].geometry=null}else fe in Dt?Jt(fe,re,he):re in dt?ve(fe,re,he):(Yt(ye),dt[fe]=Lt-1,Dt[re]=Lt-1)}return bt.filter(ye=>ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ot,dt)=>ot.sortKey-dt.sortKey)}update(o,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,c,this.layers,p),this.icon.programConfigurations.updatePaintArrays(o,c,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,c){const p=this.lineVertexArray.length;if(o.segment!==void 0){let m=o.dist(c[o.segment+1]),b=o.dist(c[o.segment]);const x={};for(let I=o.segment+1;I<c.length;I++)x[I]={x:c[I].x,y:c[I].y,tileUnitDistanceFromAnchor:m},I<c.length-1&&(m+=c[I+1].dist(c[I]));for(let I=o.segment||0;I>=0;I--)x[I]={x:c[I].x,y:c[I].y,tileUnitDistanceFromAnchor:b},I>0&&(b+=c[I-1].dist(c[I]));for(let I=0;I<c.length;I++){const T=x[I];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(o,c,p,m,b,x,I,T,A,R,z,j){const H=o.indexArray,Y=o.layoutVertexArray,tt=o.segments.prepareSegment(4*c.length,Y,H,this.canOverlap?x.sortKey:void 0),ot=this.glyphOffsetArray.length,dt=tt.vertexLength,Dt=this.allowVerticalPlacement&&I===h.ah.vertical?Math.PI/2:0,bt=x.text&&x.text.sections;for(let Lt=0;Lt<c.length;Lt++){const{tl:Yt,tr:Jt,bl:ve,br:Me,tex:ye,pixelOffsetTL:ge,pixelOffsetBR:he,minFontScaleX:Ce,minFontScaleY:fe,glyphOffset:re,isSDF:Be,sectionIndex:De}=c[Lt],mn=tt.vertexLength,pi=re[1];xm(Y,T.x,T.y,Yt.x,pi+Yt.y,ye.x,ye.y,p,Be,ge.x,ge.y,Ce,fe),xm(Y,T.x,T.y,Jt.x,pi+Jt.y,ye.x+ye.w,ye.y,p,Be,he.x,ge.y,Ce,fe),xm(Y,T.x,T.y,ve.x,pi+ve.y,ye.x,ye.y+ye.h,p,Be,ge.x,he.y,Ce,fe),xm(Y,T.x,T.y,Me.x,pi+Me.y,ye.x+ye.w,ye.y+ye.h,p,Be,he.x,he.y,Ce,fe),P_(o.dynamicLayoutVertexArray,T,Dt),H.emplaceBack(mn,mn+1,mn+2),H.emplaceBack(mn+1,mn+2,mn+3),tt.vertexLength+=4,tt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(re[0]),Lt!==c.length-1&&De===c[Lt+1].sectionIndex||o.programConfigurations.populatePaintArrays(Y.length,x,x.index,{},j,bt&&bt[De])}o.placedSymbolArray.emplaceBack(T.x,T.y,ot,this.glyphOffsetArray.length-ot,dt,A,R,T.segment,p?p[0]:0,p?p[1]:0,m[0],m[1],I,0,!1,0,z)}_addCollisionDebugVertex(o,c,p,m,b,x){return c.emplaceBack(0,0),o.emplaceBack(p.x,p.y,m,b,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(o,c,p,m,b,x,I){const T=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),A=T.vertexLength,R=b.layoutVertexArray,z=b.collisionVertexArray,j=I.anchorX,H=I.anchorY;this._addCollisionDebugVertex(R,z,x,j,H,new E(o,c)),this._addCollisionDebugVertex(R,z,x,j,H,new E(p,c)),this._addCollisionDebugVertex(R,z,x,j,H,new E(p,m)),this._addCollisionDebugVertex(R,z,x,j,H,new E(o,m)),T.vertexLength+=4;const Y=b.indexArray;Y.emplaceBack(A,A+1),Y.emplaceBack(A+1,A+2),Y.emplaceBack(A+2,A+3),Y.emplaceBack(A+3,A),T.primitiveLength+=4}addDebugCollisionBoxes(o,c,p,m){for(let b=o;b<c;b++){const x=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,m?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new A_(Ft,j0.members,Qt),this.iconCollisionBox=new A_(Ft,j0.members,Qt);for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(o,c,p,m,b,x,I,T,A){const R={};for(let z=c;z<p;z++){const j=o.get(z);R.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.textFeatureIndex=j.featureIndex;break}for(let z=m;z<b;z++){const j=o.get(z);R.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.verticalTextFeatureIndex=j.featureIndex;break}for(let z=x;z<I;z++){const j=o.get(z);R.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.iconFeatureIndex=j.featureIndex;break}for(let z=T;z<A;z++){const j=o.get(z);R.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},R.verticalIconFeatureIndex=j.featureIndex;break}return R}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const p=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,c){const p=o.placedSymbolArray.get(c),m=p.vertexStartIndex+4*p.numGlyphs;for(let b=p.vertexStartIndex;b<m;b+=4)o.indexArray.emplaceBack(b,b+1,b+2),o.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(o),p=Math.cos(o),m=[],b=[],x=[];for(let I=0;I<this.symbolInstances.length;++I){x.push(I);const T=this.symbolInstances.get(I);m.push(0|Math.round(c*T.anchorX+p*T.anchorY)),b.push(T.featureIndex)}return x.sort((I,T)=>m[I]-m[T]||b[T]-b[I]),x}addToSortKeyRanges(o,c){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===c?p.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const p=this.symbolInstances.get(c);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((m,b,x)=>{m>=0&&x.indexOf(m)===b&&this.addIndicesForPlacedSymbol(this.text,m)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let sv,av;xe("SymbolBucket",Mh,{omit:["layers","collisionBoxArray","features","compareText"]}),Mh.MAX_GLYPHS=65535,Mh.addDynamicAttributes=P_;var D_={get paint(){return av=av||new uo({"icon-opacity":new qe(Bt.paint_symbol["icon-opacity"]),"icon-color":new qe(Bt.paint_symbol["icon-color"]),"icon-halo-color":new qe(Bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new qe(Bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qe(Bt.paint_symbol["icon-halo-blur"]),"icon-translate":new ke(Bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ke(Bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new qe(Bt.paint_symbol["text-opacity"]),"text-color":new qe(Bt.paint_symbol["text-color"],{runtimeType:Ri,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new qe(Bt.paint_symbol["text-halo-color"]),"text-halo-width":new qe(Bt.paint_symbol["text-halo-width"]),"text-halo-blur":new qe(Bt.paint_symbol["text-halo-blur"]),"text-translate":new ke(Bt.paint_symbol["text-translate"]),"text-translate-anchor":new ke(Bt.paint_symbol["text-translate-anchor"])})},get layout(){return sv=sv||new uo({"symbol-placement":new ke(Bt.layout_symbol["symbol-placement"]),"symbol-spacing":new ke(Bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ke(Bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qe(Bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ke(Bt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ke(Bt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ke(Bt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ke(Bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ke(Bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ke(Bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new qe(Bt.layout_symbol["icon-size"]),"icon-text-fit":new ke(Bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ke(Bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new qe(Bt.layout_symbol["icon-image"]),"icon-rotate":new qe(Bt.layout_symbol["icon-rotate"]),"icon-padding":new qe(Bt.layout_symbol["icon-padding"]),"icon-keep-upright":new ke(Bt.layout_symbol["icon-keep-upright"]),"icon-offset":new qe(Bt.layout_symbol["icon-offset"]),"icon-anchor":new qe(Bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ke(Bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ke(Bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ke(Bt.layout_symbol["text-rotation-alignment"]),"text-field":new qe(Bt.layout_symbol["text-field"]),"text-font":new qe(Bt.layout_symbol["text-font"]),"text-size":new qe(Bt.layout_symbol["text-size"]),"text-max-width":new qe(Bt.layout_symbol["text-max-width"]),"text-line-height":new ke(Bt.layout_symbol["text-line-height"]),"text-letter-spacing":new qe(Bt.layout_symbol["text-letter-spacing"]),"text-justify":new qe(Bt.layout_symbol["text-justify"]),"text-radial-offset":new qe(Bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ke(Bt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qe(Bt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qe(Bt.layout_symbol["text-anchor"]),"text-max-angle":new ke(Bt.layout_symbol["text-max-angle"]),"text-writing-mode":new ke(Bt.layout_symbol["text-writing-mode"]),"text-rotate":new qe(Bt.layout_symbol["text-rotate"]),"text-padding":new ke(Bt.layout_symbol["text-padding"]),"text-keep-upright":new ke(Bt.layout_symbol["text-keep-upright"]),"text-transform":new qe(Bt.layout_symbol["text-transform"]),"text-offset":new qe(Bt.layout_symbol["text-offset"]),"text-allow-overlap":new ke(Bt.layout_symbol["text-allow-overlap"]),"text-overlap":new ke(Bt.layout_symbol["text-overlap"]),"text-ignore-placement":new ke(Bt.layout_symbol["text-ignore-placement"]),"text-optional":new ke(Bt.layout_symbol["text-optional"])})}};class lv{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:Qi,this.defaultValue=o}evaluate(o){if(o.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(o.formattedSection))return c.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xe("FormatSectionOverride",lv,{omit:["defaultValue"]});class wm extends Ss{constructor(o){super(o,D_)}recalculate(o,c){if(super.recalculate(o,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const m=[];for(const b of p)m.indexOf(b)<0&&m.push(b);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,c,p,m){const b=this.layout.get(o).evaluate(c,{},p,m),x=this._unevaluatedLayout._values[o];return x.isDataDriven()||ni(x.value)||!b?b:function(I,T){return T.replace(/{([^{}]+)}/g,(A,R)=>I&&R in I?String(I[R]):"")}(c.properties,b)}createBucket(o){return new Mh(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of D_.paint.overridableProperties){if(!wm.hasPaintOverride(this.layout,o))continue;const c=this.paint.get(o),p=new lv(c),m=new ui(p,c.property.specification);let b=null;b=c.value.kind==="constant"||c.value.kind==="source"?new eh("source",m):new Rf("composite",m,c.value.zoomStops),this.paint._values[o]=new ws(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(o,c,p){return!(!this.layout||c.isDataDriven()||p.isDataDriven())&&wm.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,c){const p=o.get("text-field"),m=D_.paint.properties[c];let b=!1;const x=I=>{for(const T of I)if(m.overrides&&m.overrides.hasOverride(T))return void(b=!0)};if(p.value.kind==="constant"&&p.value.value instanceof Fo)x(p.value.value.sections);else if(p.value.kind==="source"){const I=A=>{b||(A instanceof ja&&er(A.value)===Vi?x(A.value.sections):A instanceof Qc?x(A.sections):A.eachChild(I))},T=p.value;T._styleExpression&&I(T._styleExpression.expression)}return b}}let uv;var aS={get paint(){return uv=uv||new uo({"background-color":new ke(Bt.paint_background["background-color"]),"background-pattern":new Wf(Bt.paint_background["background-pattern"]),"background-opacity":new ke(Bt.paint_background["background-opacity"])})}};class lS extends Ss{constructor(o){super(o,aS)}}let cv;var uS={get paint(){return cv=cv||new uo({"raster-opacity":new ke(Bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ke(Bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ke(Bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ke(Bt.paint_raster["raster-brightness-max"]),"raster-saturation":new ke(Bt.paint_raster["raster-saturation"]),"raster-contrast":new ke(Bt.paint_raster["raster-contrast"]),"raster-resampling":new ke(Bt.paint_raster["raster-resampling"]),"raster-fade-duration":new ke(Bt.paint_raster["raster-fade-duration"])})}};class cS extends Ss{constructor(o){super(o,uS)}}class hS extends Ss{constructor(o){super(o,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class fS{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const N_=63710088e-1;class _u{constructor(o,c){if(isNaN(o)||isNaN(c))throw new Error(`Invalid LngLat object: (${o}, ${c})`);if(this.lng=+o,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _u(ht(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const c=Math.PI/180,p=this.lat*c,m=o.lat*c,b=Math.sin(p)*Math.sin(m)+Math.cos(p)*Math.cos(m)*Math.cos((o.lng-this.lng)*c);return N_*Math.acos(Math.min(b,1))}static convert(o){if(o instanceof _u)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new _u(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new _u(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const hv=2*Math.PI*N_;function fv(l){return hv*Math.cos(l*Math.PI/180)}function pv(l){return(180+l)/360}function dv(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function mv(l,o){return l/fv(o)}function R_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}class Sm{constructor(o,c,p=0){this.x=+o,this.y=+c,this.z=+p}static fromLngLat(o,c=0){const p=_u.convert(o);return new Sm(pv(p.lng),dv(p.lat),mv(c,p.lat))}toLngLat(){return new _u(360*this.x-180,R_(this.y))}toAltitude(){return this.z*fv(R_(this.y))}meterInMercatorCoordinateUnits(){return 1/hv*(o=R_(this.y),1/Math.cos(o*Math.PI/180));var o}}function gv(l,o,c){var p=2*Math.PI*6378137/256/Math.pow(2,c);return[l*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}class z_{constructor(o,c,p){if(o<0||o>25||p<0||p>=Math.pow(2,o)||c<0||c>=Math.pow(2,o))throw new Error(`x=${c}, y=${p}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=c,this.y=p,this.key=bp(0,o,o,c,p)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,c,p){const m=(x=this.y,I=this.z,T=gv(256*(b=this.x),256*(x=Math.pow(2,I)-x-1),I),A=gv(256*(b+1),256*(x+1),I),T[0]+","+T[1]+","+A[0]+","+A[1]);var b,x,I,T,A;const R=function(z,j,H){let Y,tt="";for(let ot=z;ot>0;ot--)Y=1<<ot-1,tt+=(j&Y?1:0)+(H&Y?2:0);return tt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,m)}isChildOf(o){const c=this.z-o.z;return c>0&&o.x===this.x>>c&&o.y===this.y>>c}getTilePoint(o){const c=Math.pow(2,this.z);return new E((o.x*c-this.x)*zi,(o.y*c-this.y)*zi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _v{constructor(o,c){this.wrap=o,this.canonical=c,this.key=bp(o,c.z,c.z,c.x,c.y)}}class Es{constructor(o,c,p,m,b){if(o<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${p}`);this.overscaledZ=o,this.wrap=c,this.canonical=new z_(p,+m,+b),this.key=bp(c,o,p,m,b)}clone(){return new Es(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-o;return o>this.canonical.z?new Es(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Es(o,this.wrap,o,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(o,c){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-o;return o>this.canonical.z?bp(this.wrap*+c,o,this.canonical.z,this.canonical.x,this.canonical.y):bp(this.wrap*+c,o,o,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const c=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>c&&o.canonical.y===this.canonical.y>>c}children(o){if(this.overscaledZ>=o)return[new Es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,p=2*this.canonical.x,m=2*this.canonical.y;return[new Es(c,this.wrap,c,p,m),new Es(c,this.wrap,c,p+1,m),new Es(c,this.wrap,c,p,m+1),new Es(c,this.wrap,c,p+1,m+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Es(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _v(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new Sm(o.x-this.wrap,o.y))}}function bp(l,o,c,p,m){(l*=2)<0&&(l=-1*l-1);const b=1<<c;return(b*b*l+b*m+p).toString(36)+c.toString(36)+o.toString(36)}xe("CanonicalTileID",z_),xe("OverscaledTileID",Es,{omit:["posMatrix"]});class yv{constructor(o,c,p,m=1,b=1,x=1,I=0){if(this.uid=o,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void te(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const T=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=m,this.greenFactor=b,this.blueFactor=x,this.baseShift=I;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let A=0;A<T;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(T,A)]=this.data[this._idx(T-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,T)]=this.data[this._idx(A,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let A=0;A<T;A++)for(let R=0;R<T;R++){const z=this.get(A,R);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(o,c){const p=new Uint8Array(this.data.buffer),m=4*this._idx(o,c);return this.unpack(p[m],p[m+1],p[m+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,c){if(o<-1||o>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(o+1)}unpack(o,c,p){return o*this.redFactor+c*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Is({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,c,p){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let m=c*this.dim,b=c*this.dim+this.dim,x=p*this.dim,I=p*this.dim+this.dim;switch(c){case-1:m=b-1;break;case 1:b=m+1}switch(p){case-1:x=I-1;break;case 1:I=x+1}const T=-c*this.dim,A=-p*this.dim;for(let R=x;R<I;R++)for(let z=m;z<b;z++)this.data[this._idx(z,R)]=o.data[this._idx(z+T,R+A)]}}xe("DEMData",yv);class vv{constructor(o){this._stringToNumber={},this._numberToString=[];for(let c=0;c<o.length;c++){const p=o[c];this._stringToNumber[p]=c,this._numberToString[c]=p}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class bv{constructor(o,c,p,m,b){this.type="Feature",this._vectorTileFeature=o,o._z=c,o._x=p,o._y=m,this.properties=o.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(o[c]=this[c]);return o}}class xv{constructor(o,c){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new El(zi,16,0),this.grid3D=new El(zi,16,0),this.featureIndexArray=new V,this.promoteId=c}insert(o,c,p,m,b,x){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,m,b);const T=x?this.grid3D:this.grid;for(let A=0;A<c.length;A++){const R=c[A],z=[1/0,1/0,-1/0,-1/0];for(let j=0;j<R.length;j++){const H=R[j];z[0]=Math.min(z[0],H.x),z[1]=Math.min(z[1],H.y),z[2]=Math.max(z[2],H.x),z[3]=Math.max(z[3],H.y)}z[0]<zi&&z[1]<zi&&z[2]>=0&&z[3]>=0&&T.insert(I,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new du.VectorTile(new I_(this.rawTileData)).layers,this.sourceLayerCoder=new vv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,c,p,m){this.loadVTLayers();const b=o.params||{},x=zi/o.tileSize/o.scale,I=oh(b.filter),T=o.queryGeometry,A=o.queryPadding*x,R=Sv(T),z=this.grid.query(R.minX-A,R.minY-A,R.maxX+A,R.maxY+A),j=Sv(o.cameraQueryGeometry),H=this.grid3D.query(j.minX-A,j.minY-A,j.maxX+A,j.maxY+A,(ot,dt,Dt,bt)=>function(Lt,Yt,Jt,ve,Me){for(const ge of Lt)if(Yt<=ge.x&&Jt<=ge.y&&ve>=ge.x&&Me>=ge.y)return!0;const ye=[new E(Yt,Jt),new E(Yt,Me),new E(ve,Me),new E(ve,Jt)];if(Lt.length>2){for(const ge of ye)if(wh(Lt,ge))return!0}for(let ge=0;ge<Lt.length-1;ge++)if(qw(Lt[ge],Lt[ge+1],ye))return!0;return!1}(o.cameraQueryGeometry,ot-A,dt-A,Dt+A,bt+A));for(const ot of H)z.push(ot);z.sort(pS);const Y={};let tt;for(let ot=0;ot<z.length;ot++){const dt=z[ot];if(dt===tt)continue;tt=dt;const Dt=this.featureIndexArray.get(dt);let bt=null;this.loadMatchingFeature(Y,Dt.bucketIndex,Dt.sourceLayerIndex,Dt.featureIndex,I,b.layers,b.availableImages,c,p,m,(Lt,Yt,Jt)=>(bt||(bt=Pl(Lt)),Yt.queryIntersectsFeature(T,Lt,Jt,bt,this.z,o.transform,x,o.pixelPosMatrix)))}return Y}loadMatchingFeature(o,c,p,m,b,x,I,T,A,R,z){const j=this.bucketLayerIDs[c];if(x&&!function(ot,dt){for(let Dt=0;Dt<ot.length;Dt++)if(dt.indexOf(ot[Dt])>=0)return!0;return!1}(x,j))return;const H=this.sourceLayerCoder.decode(p),Y=this.vtLayers[H].feature(m);if(b.needGeometry){const ot=kl(Y,!0);if(!b.filter(new ci(this.tileID.overscaledZ),ot,this.tileID.canonical))return}else if(!b.filter(new ci(this.tileID.overscaledZ),Y))return;const tt=this.getId(Y,H);for(let ot=0;ot<j.length;ot++){const dt=j[ot];if(x&&x.indexOf(dt)<0)continue;const Dt=T[dt];if(!Dt)continue;let bt={};tt&&R&&(bt=R.getState(Dt.sourceLayer||"_geojsonTileLayer",tt));const Lt=ut({},A[dt]);Lt.paint=wv(Lt.paint,Dt.paint,Y,bt,I),Lt.layout=wv(Lt.layout,Dt.layout,Y,bt,I);const Yt=!z||z(Y,Dt,bt);if(!Yt)continue;const Jt=new bv(Y,this.z,this.x,this.y,tt);Jt.layer=Lt;let ve=o[dt];ve===void 0&&(ve=o[dt]=[]),ve.push({featureIndex:m,feature:Jt,intersectionZ:Yt})}}lookupSymbolFeatures(o,c,p,m,b,x,I,T){const A={};this.loadVTLayers();const R=oh(b);for(const z of o)this.loadMatchingFeature(A,p,m,z,R,x,I,T,c);return A}hasLayer(o){for(const c of this.bucketLayerIDs)for(const p of c)if(o===p)return!0;return!1}getId(o,c){let p=o.id;return this.promoteId&&(p=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof p=="boolean"&&(p=Number(p))),p}}function wv(l,o,c,p,m){return lt(l,(b,x)=>{const I=o instanceof oc?o.get(x):null;return I&&I.evaluate?I.evaluate(c,p,m):I})}function Sv(l){let o=1/0,c=1/0,p=-1/0,m=-1/0;for(const b of l)o=Math.min(o,b.x),c=Math.min(c,b.y),p=Math.max(p,b.x),m=Math.max(m,b.y);return{minX:o,minY:c,maxX:p,maxY:m}}function pS(l,o){return o-l}function Iv(l,o,c,p,m){const b=[];for(let x=0;x<l.length;x++){const I=l[x];let T;for(let A=0;A<I.length-1;A++){let R=I[A],z=I[A+1];R.x<o&&z.x<o||(R.x<o?R=new E(o,R.y+(o-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x<o&&(z=new E(o,R.y+(o-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y<c&&z.y<c||(R.y<c?R=new E(R.x+(c-R.y)/(z.y-R.y)*(z.x-R.x),c)._round():z.y<c&&(z=new E(R.x+(c-R.y)/(z.y-R.y)*(z.x-R.x),c)._round()),R.x>=p&&z.x>=p||(R.x>=p?R=new E(p,R.y+(p-R.x)/(z.x-R.x)*(z.y-R.y))._round():z.x>=p&&(z=new E(p,R.y+(p-R.x)/(z.x-R.x)*(z.y-R.y))._round()),R.y>=m&&z.y>=m||(R.y>=m?R=new E(R.x+(m-R.y)/(z.y-R.y)*(z.x-R.x),m)._round():z.y>=m&&(z=new E(R.x+(m-R.y)/(z.y-R.y)*(z.x-R.x),m)._round()),T&&R.equals(T[T.length-1])||(T=[R],b.push(T)),T.push(z)))))}}return b}xe("FeatureIndex",xv,{omit:["rawTileData","sourceLayerCoder"]});class yu extends E{constructor(o,c,p,m){super(o,c),this.angle=p,m!==void 0&&(this.segment=m)}clone(){return new yu(this.x,this.y,this.angle,this.segment)}}function Ev(l,o,c,p,m){if(o.segment===void 0||c===0)return!0;let b=o,x=o.segment+1,I=0;for(;I>-c/2;){if(x--,x<0)return!1;I-=l[x].dist(b),b=l[x]}I+=l[x].dist(l[x+1]),x++;const T=[];let A=0;for(;I<c/2;){const R=l[x],z=l[x+1];if(!z)return!1;let j=l[x-1].angleTo(R)-R.angleTo(z);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:I,angleDelta:j}),A+=j;I-T[0].distance>p;)A-=T.shift().angleDelta;if(A>m)return!1;x++,I+=R.dist(z)}return!0}function Cv(l){let o=0;for(let c=0;c<l.length-1;c++)o+=l[c].dist(l[c+1]);return o}function Tv(l,o,c){return l?.6*o*c:0}function Lv(l,o){return Math.max(l?l.right-l.left:0,o?o.right-o.left:0)}function dS(l,o,c,p,m,b){const x=Tv(c,m,b),I=Lv(c,p)*b;let T=0;const A=Cv(l)/2;for(let R=0;R<l.length-1;R++){const z=l[R],j=l[R+1],H=z.dist(j);if(T+H>A){const Y=(A-T)/H,tt=ao.number(z.x,j.x,Y),ot=ao.number(z.y,j.y,Y),dt=new yu(tt,ot,j.angleTo(z),R);return dt._round(),!x||Ev(l,dt,I,x,o)?dt:void 0}T+=H}}function mS(l,o,c,p,m,b,x,I,T){const A=Tv(p,b,x),R=Lv(p,m),z=R*x,j=l[0].x===0||l[0].x===T||l[0].y===0||l[0].y===T;return o-z<o/4&&(o=z+o/4),Mv(l,j?o/2*I%o:(R/2+2*b)*x*I%o,o,A,c,z,j,!1,T)}function Mv(l,o,c,p,m,b,x,I,T){const A=b/2,R=Cv(l);let z=0,j=o-c,H=[];for(let Y=0;Y<l.length-1;Y++){const tt=l[Y],ot=l[Y+1],dt=tt.dist(ot),Dt=ot.angleTo(tt);for(;j+c<z+dt;){j+=c;const bt=(j-z)/dt,Lt=ao.number(tt.x,ot.x,bt),Yt=ao.number(tt.y,ot.y,bt);if(Lt>=0&&Lt<T&&Yt>=0&&Yt<T&&j-A>=0&&j+A<=R){const Jt=new yu(Lt,Yt,Dt,Y);Jt._round(),p&&!Ev(l,Jt,b,p,m)||H.push(Jt)}}z+=dt}return I||H.length||x||(H=Mv(l,z/2,c,p,m,b,x,!0,T)),H}xe("Anchor",yu);const Ph=Uo;function Pv(l,o,c,p){const m=[],b=l.image,x=b.pixelRatio,I=b.paddedRect.w-2*Ph,T=b.paddedRect.h-2*Ph,A=l.right-l.left,R=l.bottom-l.top,z=b.stretchX||[[0,I]],j=b.stretchY||[[0,T]],H=(he,Ce)=>he+Ce[1]-Ce[0],Y=z.reduce(H,0),tt=j.reduce(H,0),ot=I-Y,dt=T-tt;let Dt=0,bt=Y,Lt=0,Yt=tt,Jt=0,ve=ot,Me=0,ye=dt;if(b.content&&p){const he=b.content;Dt=Im(z,0,he[0]),Lt=Im(j,0,he[1]),bt=Im(z,he[0],he[2]),Yt=Im(j,he[1],he[3]),Jt=he[0]-Dt,Me=he[1]-Lt,ve=he[2]-he[0]-bt,ye=he[3]-he[1]-Yt}const ge=(he,Ce,fe,re)=>{const Be=Em(he.stretch-Dt,bt,A,l.left),De=Cm(he.fixed-Jt,ve,he.stretch,Y),mn=Em(Ce.stretch-Lt,Yt,R,l.top),pi=Cm(Ce.fixed-Me,ye,Ce.stretch,tt),_i=Em(fe.stretch-Dt,bt,A,l.left),pr=Cm(fe.fixed-Jt,ve,fe.stretch,Y),as=Em(re.stretch-Lt,Yt,R,l.top),To=Cm(re.fixed-Me,ye,re.stretch,tt),nr=new E(Be,mn),Nr=new E(_i,mn),Hr=new E(_i,as),Lo=new E(Be,as),Mo=new E(De/x,pi/x),dr=new E(pr/x,To/x),mr=o*Math.PI/180;if(mr){const po=Math.sin(mr),Go=Math.cos(mr),jo=[Go,-po,po,Go];nr._matMult(jo),Nr._matMult(jo),Lo._matMult(jo),Hr._matMult(jo)}const fo=he.stretch+he.fixed,Po=Ce.stretch+Ce.fixed;return{tl:nr,tr:Nr,bl:Lo,br:Hr,tex:{x:b.paddedRect.x+Ph+fo,y:b.paddedRect.y+Ph+Po,w:fe.stretch+fe.fixed-fo,h:re.stretch+re.fixed-Po},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mo,pixelOffsetBR:dr,minFontScaleX:ve/x/A,minFontScaleY:ye/x/R,isSDF:c}};if(p&&(b.stretchX||b.stretchY)){const he=kv(z,ot,Y),Ce=kv(j,dt,tt);for(let fe=0;fe<he.length-1;fe++){const re=he[fe],Be=he[fe+1];for(let De=0;De<Ce.length-1;De++)m.push(ge(re,Ce[De],Be,Ce[De+1]))}}else m.push(ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:T+1}));return m}function Im(l,o,c){let p=0;for(const m of l)p+=Math.max(o,Math.min(c,m[1]))-Math.max(o,Math.min(c,m[0]));return p}function kv(l,o,c){const p=[{fixed:-Ph,stretch:0}];for(const[m,b]of l){const x=p[p.length-1];p.push({fixed:m-x.stretch,stretch:x.stretch}),p.push({fixed:m-x.stretch,stretch:x.stretch+(b-m)})}return p.push({fixed:o+Ph,stretch:c}),p}function Em(l,o,c,p){return l/o*c+p}function Cm(l,o,c,p){return l-o*c/p}class Tm{constructor(o,c,p,m,b,x,I,T,A,R){if(this.boxStartIndex=o.length,A){let z=x.top,j=x.bottom;const H=x.collisionPadding;H&&(z-=H[1],j+=H[3]);let Y=j-z;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let z=x.top*I-T[0],j=x.bottom*I+T[2],H=x.left*I-T[3],Y=x.right*I+T[1];const tt=x.collisionPadding;if(tt&&(H-=tt[0]*I,z-=tt[1]*I,Y+=tt[2]*I,j+=tt[3]*I),R){const ot=new E(H,z),dt=new E(Y,z),Dt=new E(H,j),bt=new E(Y,j),Lt=R*Math.PI/180;ot._rotate(Lt),dt._rotate(Lt),Dt._rotate(Lt),bt._rotate(Lt),H=Math.min(ot.x,dt.x,Dt.x,bt.x),Y=Math.max(ot.x,dt.x,Dt.x,bt.x),z=Math.min(ot.y,dt.y,Dt.y,bt.y),j=Math.max(ot.y,dt.y,Dt.y,bt.y)}o.emplaceBack(c.x,c.y,H,z,Y,j,p,m,b)}this.boxEndIndex=o.length}}class gS{constructor(o=[],c=_S){if(this.data=o,this.length=this.data.length,this.compare=c,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const o=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:c,compare:p}=this,m=c[o];for(;o>0;){const b=o-1>>1,x=c[b];if(p(m,x)>=0)break;c[o]=x,o=b}c[o]=m}_down(o){const{data:c,compare:p}=this,m=this.length>>1,b=c[o];for(;o<m;){let x=1+(o<<1),I=c[x];const T=x+1;if(T<this.length&&p(c[T],I)<0&&(x=T,I=c[T]),p(I,b)>=0)break;c[o]=I,o=x}c[o]=b}}function _S(l,o){return l<o?-1:l>o?1:0}function yS(l,o=1,c=!1){let p=1/0,m=1/0,b=-1/0,x=-1/0;const I=l[0];for(let H=0;H<I.length;H++){const Y=I[H];(!H||Y.x<p)&&(p=Y.x),(!H||Y.y<m)&&(m=Y.y),(!H||Y.x>b)&&(b=Y.x),(!H||Y.y>x)&&(x=Y.y)}const T=Math.min(b-p,x-m);let A=T/2;const R=new gS([],vS);if(T===0)return new E(p,m);for(let H=p;H<b;H+=T)for(let Y=m;Y<x;Y+=T)R.push(new kh(H+A,Y+A,A,l));let z=function(H){let Y=0,tt=0,ot=0;const dt=H[0];for(let Dt=0,bt=dt.length,Lt=bt-1;Dt<bt;Lt=Dt++){const Yt=dt[Dt],Jt=dt[Lt],ve=Yt.x*Jt.y-Jt.x*Yt.y;tt+=(Yt.x+Jt.x)*ve,ot+=(Yt.y+Jt.y)*ve,Y+=3*ve}return new kh(tt/Y,ot/Y,0,H)}(l),j=R.length;for(;R.length;){const H=R.pop();(H.d>z.d||!z.d)&&(z=H,c&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,j)),H.max-z.d<=o||(A=H.h/2,R.push(new kh(H.p.x-A,H.p.y-A,A,l)),R.push(new kh(H.p.x+A,H.p.y-A,A,l)),R.push(new kh(H.p.x-A,H.p.y+A,A,l)),R.push(new kh(H.p.x+A,H.p.y+A,A,l)),j+=4)}return c&&(console.log(`num probes: ${j}`),console.log(`best distance: ${z.d}`)),z.p}function vS(l,o){return o.max-l.max}function kh(l,o,c,p){this.p=new E(l,o),this.h=c,this.d=function(m,b){let x=!1,I=1/0;for(let T=0;T<b.length;T++){const A=b[T];for(let R=0,z=A.length,j=z-1;R<z;j=R++){const H=A[R],Y=A[j];H.y>m.y!=Y.y>m.y&&m.x<(Y.x-H.x)*(m.y-H.y)/(Y.y-H.y)+H.x&&(x=!x),I=Math.min(I,d0(m,H,Y))}}return(x?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var Wr;h.ap=void 0,(Wr=h.ap||(h.ap={}))[Wr.center=1]="center",Wr[Wr.left=2]="left",Wr[Wr.right=3]="right",Wr[Wr.top=4]="top",Wr[Wr.bottom=5]="bottom",Wr[Wr["top-left"]=6]="top-left",Wr[Wr["top-right"]=7]="top-right",Wr[Wr["bottom-left"]=8]="bottom-left",Wr[Wr["bottom-right"]=9]="bottom-right";const vu=7,O_=Number.POSITIVE_INFINITY;function Av(l,o){return o[1]!==O_?function(c,p,m){let b=0,x=0;switch(p=Math.abs(p),m=Math.abs(m),c){case"top-right":case"top-left":case"top":x=m-vu;break;case"bottom-right":case"bottom-left":case"bottom":x=-m+vu}switch(c){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,x]}(l,o[0],o[1]):function(c,p){let m=0,b=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(c){case"top-right":case"top-left":b=x-vu;break;case"bottom-right":case"bottom-left":b=-x+vu;break;case"bottom":b=-p+vu;break;case"top":b=p-vu}switch(c){case"top-right":case"bottom-right":m=-x;break;case"top-left":case"bottom-left":m=x;break;case"left":m=p;break;case"right":m=-p}return[m,b]}(l,o[0])}function Dv(l,o,c){var p;const m=l.layout,b=(p=m.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(o,{},c);if(b){const I=b.values,T=[];for(let A=0;A<I.length;A+=2){const R=T[A]=I[A],z=I[A+1].map(j=>j*fr);R.startsWith("top")?z[1]-=vu:R.startsWith("bottom")&&(z[1]+=vu),T[A+1]=z}return new is(T)}const x=m.get("text-variable-anchor");if(x){let I;I=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[m.get("text-radial-offset").evaluate(o,{},c)*fr,O_]:m.get("text-offset").evaluate(o,{},c).map(A=>A*fr);const T=[];for(const A of x)T.push(A,Av(A,I));return new is(T)}return null}function F_(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bS(l,o,c,p,m,b,x,I,T,A,R){let z=b.textMaxSize.evaluate(o,{});z===void 0&&(z=x);const j=l.layers[0].layout,H=j.get("icon-offset").evaluate(o,{},R),Y=Rv(c.horizontal),tt=x/24,ot=l.tilePixelRatio*tt,dt=l.tilePixelRatio*z/24,Dt=l.tilePixelRatio*I,bt=l.tilePixelRatio*j.get("symbol-spacing"),Lt=j.get("text-padding")*l.tilePixelRatio,Yt=function(re,Be,De,mn=1){const pi=re.get("icon-padding").evaluate(Be,{},De),_i=pi&&pi.values;return[_i[0]*mn,_i[1]*mn,_i[2]*mn,_i[3]*mn]}(j,o,R,l.tilePixelRatio),Jt=j.get("text-max-angle")/180*Math.PI,ve=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Me=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",ye=j.get("symbol-placement"),ge=bt/2,he=j.get("icon-text-fit");let Ce;p&&he!=="none"&&(l.allowVerticalPlacement&&c.vertical&&(Ce=rv(p,c.vertical,he,j.get("icon-text-fit-padding"),H,tt)),Y&&(p=rv(p,Y,he,j.get("icon-text-fit-padding"),H,tt)));const fe=(re,Be)=>{Be.x<0||Be.x>=zi||Be.y<0||Be.y>=zi||function(De,mn,pi,_i,pr,as,To,nr,Nr,Hr,Lo,Mo,dr,mr,fo,Po,po,Go,jo,gr,En,mo,$r,_r,Zs){const xa=De.addToLineVertexArray(mn,pi);let wa,Dl,Ws,Cs,qo=0,Nl=0,Sp=0,Bv=0,W_=-1,H_=-1;const Rl={};let Vv=$n("");if(De.allowVerticalPlacement&&_i.vertical){const go=nr.layout.get("text-rotate").evaluate(En,{},_r)+90;Ws=new Tm(Nr,mn,Hr,Lo,Mo,_i.vertical,dr,mr,fo,go),To&&(Cs=new Tm(Nr,mn,Hr,Lo,Mo,To,po,Go,fo,go))}if(pr){const go=nr.layout.get("icon-rotate").evaluate(En,{}),Ts=nr.layout.get("icon-text-fit")!=="none",fc=Pv(pr,go,$r,Ts),Ia=To?Pv(To,go,$r,Ts):void 0;Dl=new Tm(Nr,mn,Hr,Lo,Mo,pr,po,Go,!1,go),qo=4*fc.length;const pc=De.iconSizeData;let Ka=null;pc.kind==="source"?(Ka=[Ya*nr.layout.get("icon-size").evaluate(En,{})],Ka[0]>gu&&te(`${De.layerIds[0]}: Value for "icon-size" is >= ${vp}. Reduce your "icon-size".`)):pc.kind==="composite"&&(Ka=[Ya*mo.compositeIconSizes[0].evaluate(En,{},_r),Ya*mo.compositeIconSizes[1].evaluate(En,{},_r)],(Ka[0]>gu||Ka[1]>gu)&&te(`${De.layerIds[0]}: Value for "icon-size" is >= ${vp}. Reduce your "icon-size".`)),De.addSymbols(De.icon,fc,Ka,gr,jo,En,h.ah.none,mn,xa.lineStartIndex,xa.lineLength,-1,_r),W_=De.icon.placedSymbolArray.length-1,Ia&&(Nl=4*Ia.length,De.addSymbols(De.icon,Ia,Ka,gr,jo,En,h.ah.vertical,mn,xa.lineStartIndex,xa.lineLength,-1,_r),H_=De.icon.placedSymbolArray.length-1)}const Uv=Object.keys(_i.horizontal);for(const go of Uv){const Ts=_i.horizontal[go];if(!wa){Vv=$n(Ts.text);const Ia=nr.layout.get("text-rotate").evaluate(En,{},_r);wa=new Tm(Nr,mn,Hr,Lo,Mo,Ts,dr,mr,fo,Ia)}const fc=Ts.positionedLines.length===1;if(Sp+=Nv(De,mn,Ts,as,nr,fo,En,Po,xa,_i.vertical?h.ah.horizontal:h.ah.horizontalOnly,fc?Uv:[go],Rl,W_,mo,_r),fc)break}_i.vertical&&(Bv+=Nv(De,mn,_i.vertical,as,nr,fo,En,Po,xa,h.ah.vertical,["vertical"],Rl,H_,mo,_r));const SS=wa?wa.boxStartIndex:De.collisionBoxArray.length,IS=wa?wa.boxEndIndex:De.collisionBoxArray.length,ES=Ws?Ws.boxStartIndex:De.collisionBoxArray.length,CS=Ws?Ws.boxEndIndex:De.collisionBoxArray.length,TS=Dl?Dl.boxStartIndex:De.collisionBoxArray.length,LS=Dl?Dl.boxEndIndex:De.collisionBoxArray.length,MS=Cs?Cs.boxStartIndex:De.collisionBoxArray.length,PS=Cs?Cs.boxEndIndex:De.collisionBoxArray.length;let Sa=-1;const Mm=(go,Ts)=>go&&go.circleDiameter?Math.max(go.circleDiameter,Ts):Ts;Sa=Mm(wa,Sa),Sa=Mm(Ws,Sa),Sa=Mm(Dl,Sa),Sa=Mm(Cs,Sa);const Gv=Sa>-1?1:0;Gv&&(Sa*=Zs/fr),De.glyphOffsetArray.length>=Mh.MAX_GLYPHS&&te("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),En.sortKey!==void 0&&De.addToSortKeyRanges(De.symbolInstances.length,En.sortKey);const kS=Dv(nr,En,_r),[AS,DS]=function(go,Ts){const fc=go.length,Ia=Ts==null?void 0:Ts.values;if((Ia==null?void 0:Ia.length)>0)for(let pc=0;pc<Ia.length;pc+=2){const Ka=Ia[pc+1];go.emplaceBack(h.ap[Ia[pc]],Ka[0],Ka[1])}return[fc,go.length]}(De.textAnchorOffsets,kS);De.symbolInstances.emplaceBack(mn.x,mn.y,Rl.right>=0?Rl.right:-1,Rl.center>=0?Rl.center:-1,Rl.left>=0?Rl.left:-1,Rl.vertical||-1,W_,H_,Vv,SS,IS,ES,CS,TS,LS,MS,PS,Hr,Sp,Bv,qo,Nl,Gv,0,dr,Sa,AS,DS)}(l,Be,re,c,p,m,Ce,l.layers[0],l.collisionBoxArray,o.index,o.sourceLayerIndex,l.index,ot,[Lt,Lt,Lt,Lt],ve,T,Dt,Yt,Me,H,o,b,A,R,x)};if(ye==="line")for(const re of Iv(o.geometry,0,0,zi,zi)){const Be=mS(re,bt,Jt,c.vertical||Y,p,24,dt,l.overscaling,zi);for(const De of Be)Y&&xS(l,Y.text,ge,De)||fe(re,De)}else if(ye==="line-center"){for(const re of o.geometry)if(re.length>1){const Be=dS(re,Jt,c.vertical||Y,p,24,dt);Be&&fe(re,Be)}}else if(o.type==="Polygon")for(const re of g_(o.geometry,0)){const Be=yS(re,16);fe(re[0],new yu(Be.x,Be.y,0))}else if(o.type==="LineString")for(const re of o.geometry)fe(re,new yu(re[0].x,re[0].y,0));else if(o.type==="Point")for(const re of o.geometry)for(const Be of re)fe([Be],new yu(Be.x,Be.y,0))}function Nv(l,o,c,p,m,b,x,I,T,A,R,z,j,H,Y){const tt=function(Dt,bt,Lt,Yt,Jt,ve,Me,ye){const ge=Yt.layout.get("text-rotate").evaluate(ve,{})*Math.PI/180,he=[];for(const Ce of bt.positionedLines)for(const fe of Ce.positionedGlyphs){if(!fe.rect)continue;const re=fe.rect||{};let Be=K0+1,De=!0,mn=1,pi=0;const _i=(Jt||ye)&&fe.vertical,pr=fe.metrics.advance*fe.scale/2;if(ye&&bt.verticalizable&&(pi=Ce.lineOffset/2-(fe.imageName?-(fr-fe.metrics.width*fe.scale)/2:(fe.scale-1)*fr)),fe.imageName){const gr=Me[fe.imageName];De=gr.sdf,mn=gr.pixelRatio,Be=Uo/mn}const as=Jt?[fe.x+pr,fe.y]:[0,0];let To=Jt?[0,0]:[fe.x+pr+Lt[0],fe.y+Lt[1]-pi],nr=[0,0];_i&&(nr=To,To=[0,0]);const Nr=fe.metrics.isDoubleResolution?2:1,Hr=(fe.metrics.left-Be)*fe.scale-pr+To[0],Lo=(-fe.metrics.top-Be)*fe.scale+To[1],Mo=Hr+re.w/Nr*fe.scale/mn,dr=Lo+re.h/Nr*fe.scale/mn,mr=new E(Hr,Lo),fo=new E(Mo,Lo),Po=new E(Hr,dr),po=new E(Mo,dr);if(_i){const gr=new E(-pr,pr-_p),En=-Math.PI/2,mo=fr/2-pr,$r=new E(5-_p-mo,-(fe.imageName?mo:0)),_r=new E(...nr);mr._rotateAround(En,gr)._add($r)._add(_r),fo._rotateAround(En,gr)._add($r)._add(_r),Po._rotateAround(En,gr)._add($r)._add(_r),po._rotateAround(En,gr)._add($r)._add(_r)}if(ge){const gr=Math.sin(ge),En=Math.cos(ge),mo=[En,-gr,gr,En];mr._matMult(mo),fo._matMult(mo),Po._matMult(mo),po._matMult(mo)}const Go=new E(0,0),jo=new E(0,0);he.push({tl:mr,tr:fo,bl:Po,br:po,tex:re,writingMode:bt.writingMode,glyphOffset:as,sectionIndex:fe.sectionIndex,isSDF:De,pixelOffsetTL:Go,pixelOffsetBR:jo,minFontScaleX:0,minFontScaleY:0})}return he}(0,c,I,m,b,x,p,l.allowVerticalPlacement),ot=l.textSizeData;let dt=null;ot.kind==="source"?(dt=[Ya*m.layout.get("text-size").evaluate(x,{})],dt[0]>gu&&te(`${l.layerIds[0]}: Value for "text-size" is >= ${vp}. Reduce your "text-size".`)):ot.kind==="composite"&&(dt=[Ya*H.compositeTextSizes[0].evaluate(x,{},Y),Ya*H.compositeTextSizes[1].evaluate(x,{},Y)],(dt[0]>gu||dt[1]>gu)&&te(`${l.layerIds[0]}: Value for "text-size" is >= ${vp}. Reduce your "text-size".`)),l.addSymbols(l.text,tt,dt,I,b,x,A,o,T.lineStartIndex,T.lineLength,j,Y);for(const Dt of R)z[Dt]=l.text.placedSymbolArray.length-1;return 4*tt.length}function Rv(l){for(const o in l)return l[o];return null}function xS(l,o,c,p){const m=l.compareText;if(o in m){const b=m[o];for(let x=b.length-1;x>=0;x--)if(p.dist(b[x])<c)return!0}else m[o]=[];return m[o].push(p),!1}const zv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class B_{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,p]=new Uint8Array(o,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const m=p>>4;if(m!==1)throw new Error(`Got v${m} data when expected v1.`);const b=zv[15&p];if(!b)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(o,2,1),[I]=new Uint32Array(o,4,1);return new B_(I,x,b,o)}constructor(o,c=64,p=Float64Array,m){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=p,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const b=zv.indexOf(this.ArrayType),x=2*o*this.ArrayType.BYTES_PER_ELEMENT,I=o*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-I%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${p}.`);m&&m instanceof ArrayBuffer?(this.data=m,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+T,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+x+I+T),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+I+T,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=o)}add(o,c){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=o,this.coords[this._pos++]=c,p}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return V_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,c,p,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:x,nodeSize:I}=this,T=[0,b.length-1,0],A=[];for(;T.length;){const R=T.pop()||0,z=T.pop()||0,j=T.pop()||0;if(z-j<=I){for(let ot=j;ot<=z;ot++){const dt=x[2*ot],Dt=x[2*ot+1];dt>=o&&dt<=p&&Dt>=c&&Dt<=m&&A.push(b[ot])}continue}const H=j+z>>1,Y=x[2*H],tt=x[2*H+1];Y>=o&&Y<=p&&tt>=c&&tt<=m&&A.push(b[H]),(R===0?o<=Y:c<=tt)&&(T.push(j),T.push(H-1),T.push(1-R)),(R===0?p>=Y:m>=tt)&&(T.push(H+1),T.push(z),T.push(1-R))}return A}within(o,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:b,nodeSize:x}=this,I=[0,m.length-1,0],T=[],A=p*p;for(;I.length;){const R=I.pop()||0,z=I.pop()||0,j=I.pop()||0;if(z-j<=x){for(let ot=j;ot<=z;ot++)Fv(b[2*ot],b[2*ot+1],o,c)<=A&&T.push(m[ot]);continue}const H=j+z>>1,Y=b[2*H],tt=b[2*H+1];Fv(Y,tt,o,c)<=A&&T.push(m[H]),(R===0?o-p<=Y:c-p<=tt)&&(I.push(j),I.push(H-1),I.push(1-R)),(R===0?o+p>=Y:c+p>=tt)&&(I.push(H+1),I.push(z),I.push(1-R))}return T}}function V_(l,o,c,p,m,b){if(m-p<=c)return;const x=p+m>>1;Ov(l,o,x,p,m,b),V_(l,o,c,p,x-1,1-b),V_(l,o,c,x+1,m,1-b)}function Ov(l,o,c,p,m,b){for(;m>p;){if(m-p>600){const A=m-p+1,R=c-p+1,z=Math.log(A),j=.5*Math.exp(2*z/3),H=.5*Math.sqrt(z*j*(A-j)/A)*(R-A/2<0?-1:1);Ov(l,o,c,Math.max(p,Math.floor(c-R*j/A+H)),Math.min(m,Math.floor(c+(A-R)*j/A+H)),b)}const x=o[2*c+b];let I=p,T=m;for(xp(l,o,p,c),o[2*m+b]>x&&xp(l,o,p,m);I<T;){for(xp(l,o,I,T),I++,T--;o[2*I+b]<x;)I++;for(;o[2*T+b]>x;)T--}o[2*p+b]===x?xp(l,o,p,T):(T++,xp(l,o,T,m)),T<=c&&(p=T+1),c<=T&&(m=T-1)}}function xp(l,o,c,p){U_(l,c,p),U_(o,2*c,2*p),U_(o,2*c+1,2*p+1)}function U_(l,o,c){const p=l[o];l[o]=l[c],l[c]=p}function Fv(l,o,c,p){const m=l-c,b=o-p;return m*m+b*b}var G_;h.bc=void 0,(G_=h.bc||(h.bc={})).create="create",G_.load="load",G_.fullLoad="fullLoad";let Lm=null,wp=[];const j_=1e3/60,q_="loadTime",Z_="fullLoadTime",wS={mark(l){performance.mark(l)},frame(l){const o=l;Lm!=null&&wp.push(o-Lm),Lm=o},clearMetrics(){Lm=null,wp=[],performance.clearMeasures(q_),performance.clearMeasures(Z_);for(const l in h.bc)performance.clearMarks(h.bc[l])},getPerformanceMetrics(){performance.measure(q_,h.bc.create,h.bc.load),performance.measure(Z_,h.bc.create,h.bc.fullLoad);const l=performance.getEntriesByName(q_)[0].duration,o=performance.getEntriesByName(Z_)[0].duration,c=wp.length,p=1/(wp.reduce((b,x)=>b+x,0)/c/1e3),m=wp.filter(b=>b>j_).reduce((b,x)=>b+(x-j_)/j_,0);return{loadTime:l,fullLoadTime:o,fps:p,percentDroppedFrames:m/(c+m)*100,totalFrames:c}}};h.$=Ue,h.A=Sh,h.B=function(l){if(ie==null){const o=l.navigator?l.navigator.userAgent:null;ie=!!l.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ie},h.C=class{constructor(l,o){this.target=l,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new fS(()=>this.process()),this.subscription=function(c,p,m,b){return c.addEventListener(p,m,!1),{unsubscribe:()=>{c.removeEventListener(p,m,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=Gt(self)?l:window}registerMessageHandler(l,o){this.messageHandlers[l]=o}sendAsync(l,o){return new Promise((c,p)=>{const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[m]={resolve:c,reject:p},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[m];const I={id:m,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(I)},{once:!0});const b=[],x=Object.assign(Object.assign({},l),{id:m,sourceMapId:this.mapId,origin:location.origin,data:uu(l.data,b)});this.target.postMessage(x,{transfer:b})})}receive(l){const o=l.data,c=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[c];const p=this.abortControllers[c];return delete this.abortControllers[c],void(p&&p.abort())}if(Gt(self)||o.mustQueue)return this.tasks[c]=o,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,o)}}process(){if(this.taskQueue.length===0)return;const l=this.taskQueue.shift(),o=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(l,o)}processTask(l,o){return u(this,void 0,void 0,function*(){if(o.type==="<response>"){const m=this.resolveRejects[l];return delete this.resolveRejects[l],m?void(o.error?m.reject(ic(o.error)):m.resolve(ic(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=ic(o.data),p=new AbortController;this.abortControllers[l]=p;try{const m=yield this.messageHandlers[o.type](o.sourceMapId,c,p);this.completeTask(l,null,m)}catch(m){this.completeTask(l,m)}})}completeTask(l,o,c){const p=[];delete this.abortControllers[l];const m={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?uu(o):null,data:uu(c,p)};this.target.postMessage(m,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.D=ke,h.E=Ji,h.F=function(){var l=new Sh(16);return Sh!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},h.G=Vn,h.H=function(l,o,c){var p,m,b,x,I,T,A,R,z,j,H,Y,tt=c[0],ot=c[1],dt=c[2];return o===l?(l[12]=o[0]*tt+o[4]*ot+o[8]*dt+o[12],l[13]=o[1]*tt+o[5]*ot+o[9]*dt+o[13],l[14]=o[2]*tt+o[6]*ot+o[10]*dt+o[14],l[15]=o[3]*tt+o[7]*ot+o[11]*dt+o[15]):(m=o[1],b=o[2],x=o[3],I=o[4],T=o[5],A=o[6],R=o[7],z=o[8],j=o[9],H=o[10],Y=o[11],l[0]=p=o[0],l[1]=m,l[2]=b,l[3]=x,l[4]=I,l[5]=T,l[6]=A,l[7]=R,l[8]=z,l[9]=j,l[10]=H,l[11]=Y,l[12]=p*tt+I*ot+z*dt+o[12],l[13]=m*tt+T*ot+j*dt+o[13],l[14]=b*tt+A*ot+H*dt+o[14],l[15]=x*tt+R*ot+Y*dt+o[15]),l},h.I=C_,h.J=function(l,o,c){var p=c[0],m=c[1],b=c[2];return l[0]=o[0]*p,l[1]=o[1]*p,l[2]=o[2]*p,l[3]=o[3]*p,l[4]=o[4]*m,l[5]=o[5]*m,l[6]=o[6]*m,l[7]=o[7]*m,l[8]=o[8]*b,l[9]=o[9]*b,l[10]=o[10]*b,l[11]=o[11]*b,l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},h.K=y0,h.L=function(l,o){const c={};for(let p=0;p<o.length;p++){const m=o[p];m in l&&(c[m]=l[m])}return c},h.M=_u,h.N=pv,h.O=dv,h.P=E,h.Q=Es,h.R=Is,h.S=X,h.T=nm,h.U=B,h.V=cn,h.W=zi,h.X=Gi,h.Y=Sm,h.Z=class extends Xf{},h._=u,h.a=Sn,h.a$=function(l,o){return l[0]*o[0]+l[1]*o[1]+l[2]*o[2]+l[3]*o[3]},h.a0=z_,h.a1=se,h.a2=l=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(c=>{o.onloadstart=()=>{c(o)};for(const p of l){const m=window.document.createElement("source");zn(p)||(o.crossOrigin="Anonymous"),m.src=p,o.appendChild(m)}})},h.a3=function(){return St++},h.a4=s,h.a5=Mh,h.a6=oh,h.a7=kl,h.a8=ci,h.a9=bv,h.aA=wt,h.aB=function(l,o){if(!l)return[{command:"setStyle",args:[o]}];let c=[];try{if(!dn(l.version,o.version))return[{command:"setStyle",args:[o]}];dn(l.center,o.center)||c.push({command:"setCenter",args:[o.center]}),dn(l.zoom,o.zoom)||c.push({command:"setZoom",args:[o.zoom]}),dn(l.bearing,o.bearing)||c.push({command:"setBearing",args:[o.bearing]}),dn(l.pitch,o.pitch)||c.push({command:"setPitch",args:[o.pitch]}),dn(l.sprite,o.sprite)||c.push({command:"setSprite",args:[o.sprite]}),dn(l.glyphs,o.glyphs)||c.push({command:"setGlyphs",args:[o.glyphs]}),dn(l.transition,o.transition)||c.push({command:"setTransition",args:[o.transition]}),dn(l.light,o.light)||c.push({command:"setLight",args:[o.light]}),dn(l.terrain,o.terrain)||c.push({command:"setTerrain",args:[o.terrain]}),dn(l.sky,o.sky)||c.push({command:"setSky",args:[o.sky]});const p={},m=[];(function(x,I,T,A){let R;for(R in I=I||{},x=x||{})Object.prototype.hasOwnProperty.call(x,R)&&(Object.prototype.hasOwnProperty.call(I,R)||vs(R,T,A));for(R in I)Object.prototype.hasOwnProperty.call(I,R)&&(Object.prototype.hasOwnProperty.call(x,R)?dn(x[R],I[R])||(x[R].type==="geojson"&&I[R].type==="geojson"&&Ga(x,I,R)?mi(T,{command:"setGeoJSONSourceData",args:[R,I[R].data]}):Us(R,I,T,A)):Dr(R,I,T))})(l.sources,o.sources,m,p);const b=[];l.layers&&l.layers.forEach(x=>{"source"in x&&p[x.source]?c.push({command:"removeLayer",args:[x.id]}):b.push(x)}),c=c.concat(m),function(x,I,T){I=I||[];const A=(x=x||[]).map(_l),R=I.map(_l),z=x.reduce(bs,{}),j=I.reduce(bs,{}),H=A.slice(),Y=Object.create(null);let tt,ot,dt,Dt,bt;for(let Lt=0,Yt=0;Lt<A.length;Lt++)tt=A[Lt],Object.prototype.hasOwnProperty.call(j,tt)?Yt++:(mi(T,{command:"removeLayer",args:[tt]}),H.splice(H.indexOf(tt,Yt),1));for(let Lt=0,Yt=0;Lt<R.length;Lt++)tt=R[R.length-1-Lt],H[H.length-1-Lt]!==tt&&(Object.prototype.hasOwnProperty.call(z,tt)?(mi(T,{command:"removeLayer",args:[tt]}),H.splice(H.lastIndexOf(tt,H.length-Yt),1)):Yt++,Dt=H[H.length-Lt],mi(T,{command:"addLayer",args:[j[tt],Dt]}),H.splice(H.length-Lt,0,tt),Y[tt]=!0);for(let Lt=0;Lt<R.length;Lt++)if(tt=R[Lt],ot=z[tt],dt=j[tt],!Y[tt]&&!dn(ot,dt))if(dn(ot.source,dt.source)&&dn(ot["source-layer"],dt["source-layer"])&&dn(ot.type,dt.type)){for(bt in Gr(ot.layout,dt.layout,T,tt,null,"setLayoutProperty"),Gr(ot.paint,dt.paint,T,tt,null,"setPaintProperty"),dn(ot.filter,dt.filter)||mi(T,{command:"setFilter",args:[tt,dt.filter]}),dn(ot.minzoom,dt.minzoom)&&dn(ot.maxzoom,dt.maxzoom)||mi(T,{command:"setLayerZoomRange",args:[tt,dt.minzoom,dt.maxzoom]}),ot)Object.prototype.hasOwnProperty.call(ot,bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&(bt.indexOf("paint.")===0?Gr(ot[bt],dt[bt],T,tt,bt.slice(6),"setPaintProperty"):dn(ot[bt],dt[bt])||mi(T,{command:"setLayerProperty",args:[tt,bt,dt[bt]]}));for(bt in dt)Object.prototype.hasOwnProperty.call(dt,bt)&&!Object.prototype.hasOwnProperty.call(ot,bt)&&bt!=="layout"&&bt!=="paint"&&bt!=="filter"&&bt!=="metadata"&&bt!=="minzoom"&&bt!=="maxzoom"&&(bt.indexOf("paint.")===0?Gr(ot[bt],dt[bt],T,tt,bt.slice(6),"setPaintProperty"):dn(ot[bt],dt[bt])||mi(T,{command:"setLayerProperty",args:[tt,bt,dt[bt]]}))}else mi(T,{command:"removeLayer",args:[tt]}),Dt=H[H.lastIndexOf(tt)+1],mi(T,{command:"addLayer",args:[dt,Dt]})}(b,o.layers,c)}catch(p){console.warn("Unable to compute style diff:",p),c=[{command:"setStyle",args:[o]}]}return c},h.aC=function(l){const o=[],c=l.id;return c===void 0&&o.push({message:`layers.${c}: missing required property "id"`}),l.render===void 0&&o.push({message:`layers.${c}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&o.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),o},h.aD=function l(o,c){if(Array.isArray(o)){if(!Array.isArray(c)||o.length!==c.length)return!1;for(let p=0;p<o.length;p++)if(!l(o[p],c[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&c!==null){if(typeof c!="object"||Object.keys(o).length!==Object.keys(c).length)return!1;for(const p in o)if(!l(o[p],c[p]))return!1;return!0}return o===c},h.aE=lt,h.aF=zt,h.aG=class extends Zr{constructor(l,o){super(l,o),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},h.aH=ss,h.aI=class extends Zr{constructor(l,o){super(l,o),this.current=pu}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let o=1;o<16;o++)if(l[o]!==this.current[o]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},h.aJ=$a,h.aK=class extends Zr{constructor(l,o){super(l,o),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},h.aL=class extends Zr{constructor(l,o){super(l,o),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},h.aM=fu,h.aN=function(l,o,c,p,m,b,x){var I=1/(o-c),T=1/(p-m),A=1/(b-x);return l[0]=-2*I,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*T,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*A,l[11]=0,l[12]=(o+c)*I,l[13]=(m+p)*T,l[14]=(x+b)*A,l[15]=1,l},h.aO=qn,h.aP=Ww,h.aQ=class extends lc{},h.aR=V2,h.aS=class extends Tl{},h.aT=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},h.aU=S0,h.aV=$,h.aW=class extends vh{},h.aX=ee,h.aY=function(l,o){var c=l[0],p=l[1],m=l[2],b=l[3],x=l[4],I=l[5],T=l[6],A=l[7],R=l[8],z=l[9],j=l[10],H=l[11],Y=l[12],tt=l[13],ot=l[14],dt=l[15],Dt=o[0],bt=o[1],Lt=o[2],Yt=o[3],Jt=o[4],ve=o[5],Me=o[6],ye=o[7],ge=o[8],he=o[9],Ce=o[10],fe=o[11],re=o[12],Be=o[13],De=o[14],mn=o[15];return Math.abs(c-Dt)<=Co*Math.max(1,Math.abs(c),Math.abs(Dt))&&Math.abs(p-bt)<=Co*Math.max(1,Math.abs(p),Math.abs(bt))&&Math.abs(m-Lt)<=Co*Math.max(1,Math.abs(m),Math.abs(Lt))&&Math.abs(b-Yt)<=Co*Math.max(1,Math.abs(b),Math.abs(Yt))&&Math.abs(x-Jt)<=Co*Math.max(1,Math.abs(x),Math.abs(Jt))&&Math.abs(I-ve)<=Co*Math.max(1,Math.abs(I),Math.abs(ve))&&Math.abs(T-Me)<=Co*Math.max(1,Math.abs(T),Math.abs(Me))&&Math.abs(A-ye)<=Co*Math.max(1,Math.abs(A),Math.abs(ye))&&Math.abs(R-ge)<=Co*Math.max(1,Math.abs(R),Math.abs(ge))&&Math.abs(z-he)<=Co*Math.max(1,Math.abs(z),Math.abs(he))&&Math.abs(j-Ce)<=Co*Math.max(1,Math.abs(j),Math.abs(Ce))&&Math.abs(H-fe)<=Co*Math.max(1,Math.abs(H),Math.abs(fe))&&Math.abs(Y-re)<=Co*Math.max(1,Math.abs(Y),Math.abs(re))&&Math.abs(tt-Be)<=Co*Math.max(1,Math.abs(tt),Math.abs(Be))&&Math.abs(ot-De)<=Co*Math.max(1,Math.abs(ot),Math.abs(De))&&Math.abs(dt-mn)<=Co*Math.max(1,Math.abs(dt),Math.abs(mn))},h.aZ=function(l,o){return l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[4]=o[4],l[5]=o[5],l[6]=o[6],l[7]=o[7],l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15],l},h.a_=function(l,o,c){return l[0]=o[0]*c[0],l[1]=o[1]*c[1],l[2]=o[2]*c[2],l[3]=o[3]*c[3],l},h.aa=function(l){const o={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,p,m,b)=>{const x=m||b;return o[p]=!x||x.toLowerCase(),""}),o["max-age"]){const c=parseInt(o["max-age"],10);isNaN(c)?delete o["max-age"]:o["max-age"]=c}return o},h.ab=function(l,o){const c=[];for(const p in l)p in o||c.push(p);return c},h.ac=Q,h.ad=function(l,o,c){var p=Math.sin(c),m=Math.cos(c),b=o[0],x=o[1],I=o[2],T=o[3],A=o[4],R=o[5],z=o[6],j=o[7];return o!==l&&(l[8]=o[8],l[9]=o[9],l[10]=o[10],l[11]=o[11],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[0]=b*m+A*p,l[1]=x*m+R*p,l[2]=I*m+z*p,l[3]=T*m+j*p,l[4]=A*m-b*p,l[5]=R*m-x*p,l[6]=z*m-I*p,l[7]=j*m-T*p,l},h.ae=function(l){var o=new Sh(16);return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=l[6],o[7]=l[7],o[8]=l[8],o[9]=l[9],o[10]=l[10],o[11]=l[11],o[12]=l[12],o[13]=l[13],o[14]=l[14],o[15]=l[15],o},h.af=fm,h.ag=function(l,o){let c=0,p=0;if(l.kind==="constant")p=l.layoutSize;else if(l.kind!=="source"){const{interpolationType:m,minZoom:b,maxZoom:x}=l,I=m?Q(jr.interpolationFactor(m,o,b,x),0,1):0;l.kind==="camera"?p=ao.number(l.minSize,l.maxSize,I):c=I}return{uSizeT:c,uSize:p}},h.ai=function(l,{uSize:o,uSizeT:c},{lowerSize:p,upperSize:m}){return l.kind==="source"?p/Ya:l.kind==="composite"?ao.number(p/Ya,m/Ya,c):o},h.aj=P_,h.ak=function(l,o,c,p){const m=o.y-l.y,b=o.x-l.x,x=p.y-c.y,I=p.x-c.x,T=x*b-I*m;if(T===0)return null;const A=(I*(l.y-c.y)-x*(l.x-c.x))/T;return new E(l.x+A*b,l.y+A*m)},h.al=Iv,h.am=sp,h.an=u_,h.ao=fr,h.aq=M_,h.ar=function(l,o){var c=o[0],p=o[1],m=o[2],b=o[3],x=o[4],I=o[5],T=o[6],A=o[7],R=o[8],z=o[9],j=o[10],H=o[11],Y=o[12],tt=o[13],ot=o[14],dt=o[15],Dt=c*I-p*x,bt=c*T-m*x,Lt=c*A-b*x,Yt=p*T-m*I,Jt=p*A-b*I,ve=m*A-b*T,Me=R*tt-z*Y,ye=R*ot-j*Y,ge=R*dt-H*Y,he=z*ot-j*tt,Ce=z*dt-H*tt,fe=j*dt-H*ot,re=Dt*fe-bt*Ce+Lt*he+Yt*ge-Jt*ye+ve*Me;return re?(l[0]=(I*fe-T*Ce+A*he)*(re=1/re),l[1]=(m*Ce-p*fe-b*he)*re,l[2]=(tt*ve-ot*Jt+dt*Yt)*re,l[3]=(j*Jt-z*ve-H*Yt)*re,l[4]=(T*ge-x*fe-A*ye)*re,l[5]=(c*fe-m*ge+b*ye)*re,l[6]=(ot*Lt-Y*ve-dt*bt)*re,l[7]=(R*ve-j*Lt+H*bt)*re,l[8]=(x*Ce-I*ge+A*Me)*re,l[9]=(p*ge-c*Ce-b*Me)*re,l[10]=(Y*Jt-tt*Lt+dt*Dt)*re,l[11]=(z*Lt-R*Jt-H*Dt)*re,l[12]=(I*ye-x*he-T*Me)*re,l[13]=(c*he-p*ye+m*Me)*re,l[14]=(tt*bt-Y*Yt-ot*Dt)*re,l[15]=(R*Yt-z*bt+j*Dt)*re,l):null},h.as=F_,h.at=L_,h.au=B_,h.av=function(){const l={},o=Bt.$version;for(const c in Bt.$root){const p=Bt.$root[c];if(p.required){let m=null;m=c==="version"?o:p.type==="array"?[]:{},m!=null&&(l[c]=m)}}return l},h.aw=hh,h.ax=Ie,h.ay=function(l){l=l.slice();const o=Object.create(null);for(let c=0;c<l.length;c++)o[l[c].id]=l[c];for(let c=0;c<l.length;c++)"ref"in l[c]&&(l[c]=ar(l[c],o[l[c].ref]));return l},h.az=function(l){if(l.type==="custom")return new hS(l);switch(l.type){case"background":return new lS(l);case"circle":return new Hw(l);case"fill":return new p2(l);case"fill-extrusion":return new L2(l);case"heatmap":return new Xw(l);case"hillshade":return new Kw(l);case"line":return new z2(l);case"raster":return new cS(l);case"symbol":return new wm(l)}},h.b=Ee,h.b0=ht,h.b1=_v,h.b2=mv,h.b3=function(l,o,c,p,m){var b,x=1/Math.tan(o/2);return l[0]=x/c,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=x,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,m!=null&&m!==1/0?(l[10]=(m+p)*(b=1/(p-m)),l[14]=2*m*p*b):(l[10]=-1,l[14]=-2*p),l},h.b4=function(l,o,c){var p=Math.sin(c),m=Math.cos(c),b=o[4],x=o[5],I=o[6],T=o[7],A=o[8],R=o[9],z=o[10],j=o[11];return o!==l&&(l[0]=o[0],l[1]=o[1],l[2]=o[2],l[3]=o[3],l[12]=o[12],l[13]=o[13],l[14]=o[14],l[15]=o[15]),l[4]=b*m+A*p,l[5]=x*m+R*p,l[6]=I*m+z*p,l[7]=T*m+j*p,l[8]=A*m-b*p,l[9]=R*m-x*p,l[10]=z*m-I*p,l[11]=j*m-T*p,l},h.b5=U,h.b6=W,h.b7=function(l){return l*Math.PI/180},h.b8=function(l,o){return l[0]=o[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=o[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=o[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},h.b9=class extends gh{},h.ba=N_,h.bb=wS,h.bd=ne,h.be=function(l,o){Sn.REGISTERED_PROTOCOLS[l]=o},h.bf=function(l){delete Sn.REGISTERED_PROTOCOLS[l]},h.bg=function(l,o){const c={};for(let m=0;m<l.length;m++){const b=o&&o[l[m].id]||r_(l[m]);o&&(o[l[m].id]=b);let x=c[b];x||(x=c[b]=[]),x.push(l[m])}const p=[];for(const m in c)p.push(c[m]);return p},h.bh=xe,h.bi=vv,h.bj=xv,h.bk=Q0,h.bl=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=zi/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;const o=l.bucket.layers[0],c=o.layout,p=o._unevaluatedLayout._values,m={layoutIconSize:p["icon-size"].possiblyEvaluate(new ci(l.bucket.zoom+1),l.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new ci(l.bucket.zoom+1),l.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new ci(18))};if(l.bucket.textSizeData.kind==="composite"){const{minZoom:A,maxZoom:R}=l.bucket.textSizeData;m.compositeTextSizes=[p["text-size"].possiblyEvaluate(new ci(A),l.canonical),p["text-size"].possiblyEvaluate(new ci(R),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){const{minZoom:A,maxZoom:R}=l.bucket.iconSizeData;m.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new ci(A),l.canonical),p["icon-size"].possiblyEvaluate(new ci(R),l.canonical)]}const b=c.get("text-line-height")*fr,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",I=c.get("text-keep-upright"),T=c.get("text-size");for(const A of l.bucket.features){const R=c.get("text-font").evaluate(A,{},l.canonical).join(","),z=T.evaluate(A,{},l.canonical),j=m.layoutTextSize.evaluate(A,{},l.canonical),H=m.layoutIconSize.evaluate(A,{},l.canonical),Y={horizontal:{},vertical:void 0},tt=A.text;let ot,dt=[0,0];if(tt){const Lt=tt.toString(),Yt=c.get("text-letter-spacing").evaluate(A,{},l.canonical)*fr,Jt=Qd(Lt)?Yt:0,ve=c.get("text-anchor").evaluate(A,{},l.canonical),Me=Dv(o,A,l.canonical);if(!Me){const fe=c.get("text-radial-offset").evaluate(A,{},l.canonical);dt=fe?Av(ve,[fe*fr,O_]):c.get("text-offset").evaluate(A,{},l.canonical).map(re=>re*fr)}let ye=x?"center":c.get("text-justify").evaluate(A,{},l.canonical);const ge=c.get("symbol-placement"),he=ge==="point"?c.get("text-max-width").evaluate(A,{},l.canonical)*fr:0,Ce=()=>{l.bucket.allowVerticalPlacement&&fh(Lt)&&(Y.vertical=vm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,R,he,b,ve,"left",Jt,dt,h.ah.vertical,!0,ge,j,z))};if(!x&&Me){const fe=new Set;if(ye==="auto")for(let Be=0;Be<Me.values.length;Be+=2)fe.add(F_(Me.values[Be]));else fe.add(ye);let re=!1;for(const Be of fe)if(!Y.horizontal[Be])if(re)Y.horizontal[Be]=Y.horizontal[0];else{const De=vm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,R,he,b,"center",Be,Jt,dt,h.ah.horizontal,!1,ge,j,z);De&&(Y.horizontal[Be]=De,re=De.positionedLines.length===1)}Ce()}else{ye==="auto"&&(ye=F_(ve));const fe=vm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,R,he,b,ve,ye,Jt,dt,h.ah.horizontal,!1,ge,j,z);fe&&(Y.horizontal[ye]=fe),Ce(),fh(Lt)&&x&&I&&(Y.vertical=vm(tt,l.glyphMap,l.glyphPositions,l.imagePositions,R,he,b,ve,ye,Jt,dt,h.ah.vertical,!1,ge,j,z))}}let Dt=!1;if(A.icon&&A.icon.name){const Lt=l.imageMap[A.icon.name];Lt&&(ot=iS(l.imagePositions[A.icon.name],c.get("icon-offset").evaluate(A,{},l.canonical),c.get("icon-anchor").evaluate(A,{},l.canonical)),Dt=!!Lt.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=Dt:l.bucket.sdfIcons!==Dt&&te("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Lt.pixelRatio!==l.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}const bt=Rv(Y.horizontal)||Y.vertical;l.bucket.iconsInText=!!bt&&bt.iconsInText,(bt||ot)&&bS(l.bucket,A,Y,ot,l.imageMap,m,j,H,dt,Dt,l.canonical)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},h.bm=w_,h.bn=v_,h.bo=x_,h.bp=du,h.bq=I_,h.br=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},h.bs=function(l,o,c,p,m){return u(this,void 0,void 0,function*(){if(B())try{return yield cn(l,o,c,p,m)}catch{}return function(b,x,I,T,A){const R=b.width,z=b.height;je&&Oe||(je=new OffscreenCanvas(R,z),Oe=je.getContext("2d",{willReadFrequently:!0})),je.width=R,je.height=z,Oe.drawImage(b,0,0,R,z);const j=Oe.getImageData(x,I,T,A);return Oe.clearRect(0,0,R,z),j.data}(l,o,c,p,m)})},h.bt=yv,h.bu=_,h.bv=w,h.bw=q0,h.bx=wl,h.by=function(l){return l.message===wn},h.bz=Cl,h.c=In,h.d=l=>u(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(o)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),h.e=ut,h.f=l=>new Promise((o,c)=>{const p=new Image;p.onload=()=>{o(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=an})},p.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const m=new Blob([new Uint8Array(l)],{type:"image/png"});p.src=l.byteLength?URL.createObjectURL(m):an}),h.g=Bn,h.h=(l,o)=>Fe(ut(l,{type:"json"}),o),h.i=Gt,h.j=Le,h.k=We,h.l=(l,o)=>Fe(ut(l,{type:"arrayBuffer"}),o),h.m=Fe,h.n=function(l){return new I_(l).readFields(K2,[])},h.o=up,h.p=J0,h.q=uo,h.r=Gf,h.s=zn,h.t=Jd,h.u=_e,h.v=Bt,h.w=te,h.x=ec,h.y=function([l,o,c]){return o+=90,o*=Math.PI/180,c*=Math.PI/180,{x:l*Math.cos(o)*Math.sin(c),y:l*Math.sin(o)*Math.sin(c),z:l*Math.cos(c)}},h.z=ao}),r("worker",["./shared"],function(h){class u{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,Z){for(const nt of G){this._layerConfigs[nt.id]=nt;const Et=this._layers[nt.id]=h.az(nt);Et._featureFilter=h.a6(Et.filter),this.keyCache[nt.id]&&delete this.keyCache[nt.id]}for(const nt of Z)delete this.keyCache[nt],delete this._layerConfigs[nt],delete this._layers[nt];this.familiesBySource={};const K=h.bg(Object.values(this._layerConfigs),this.keyCache);for(const nt of K){const Et=nt.map(Ht=>this._layers[Ht.id]),J=Et[0];if(J.visibility==="none")continue;const Ct=J.source||"";let mt=this.familiesBySource[Ct];mt||(mt=this.familiesBySource[Ct]={});const At=J.sourceLayer||"_geojsonTileLayer";let Vt=mt[At];Vt||(Vt=mt[At]=[]),Vt.push(Et)}}}class _{constructor(G){const Z={},K=[];for(const Ct in G){const mt=G[Ct],At=Z[Ct]={};for(const Vt in mt){const Ht=mt[+Vt];if(!Ht||Ht.bitmap.width===0||Ht.bitmap.height===0)continue;const $t={x:0,y:0,w:Ht.bitmap.width+2,h:Ht.bitmap.height+2};K.push($t),At[Vt]={rect:$t,metrics:Ht.metrics}}}const{w:nt,h:Et}=h.p(K),J=new h.o({width:nt||1,height:Et||1});for(const Ct in G){const mt=G[Ct];for(const At in mt){const Vt=mt[+At];if(!Vt||Vt.bitmap.width===0||Vt.bitmap.height===0)continue;const Ht=Z[Ct][At].rect;h.o.copy(Vt.bitmap,J,{x:0,y:0},{x:Ht.x+1,y:Ht.y+1},Vt.bitmap)}}this.image=J,this.positions=Z}}h.bh("GlyphAtlas",_);class w{constructor(G){this.tileID=new h.Q(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId,this.inFlightDependencies=[]}parse(G,Z,K,nt){return h._(this,void 0,void 0,function*(){this.status="parsing",this.data=G,this.collisionBoxArray=new h.a4;const Et=new h.bi(Object.keys(G.layers).sort()),J=new h.bj(this.tileID,this.promoteId);J.bucketLayerIDs=[];const Ct={},mt={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:K},At=Z.familiesBySource[this.source];for(const hn in At){const Ci=G.layers[hn];if(!Ci)continue;Ci.version===1&&h.w(`Vector tile source "${this.source}" layer "${hn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const lr=Et.encode(hn),so=[];for(let wo=0;wo<Ci.length;wo++){const wr=Ci.feature(wo),Gs=J.getId(wr,hn);so.push({feature:wr,id:Gs,index:wo,sourceLayerIndex:lr})}for(const wo of At[hn]){const wr=wo[0];wr.source!==this.source&&h.w(`layer.source = ${wr.source} does not equal this.source = ${this.source}`),wr.minzoom&&this.zoom<Math.floor(wr.minzoom)||wr.maxzoom&&this.zoom>=wr.maxzoom||wr.visibility!=="none"&&(S(wo,this.zoom,K),(Ct[wr.id]=wr.createBucket({index:J.bucketLayerIDs.length,layers:wo,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:lr,sourceID:this.source})).populate(so,mt,this.tileID.canonical),J.bucketLayerIDs.push(wo.map(Gs=>Gs.id)))}}const Vt=h.aE(mt.glyphDependencies,hn=>Object.keys(hn).map(Number));this.inFlightDependencies.forEach(hn=>hn==null?void 0:hn.abort()),this.inFlightDependencies=[];let Ht=Promise.resolve({});if(Object.keys(Vt).length){const hn=new AbortController;this.inFlightDependencies.push(hn),Ht=nt.sendAsync({type:"getGlyphs",data:{stacks:Vt,source:this.source,tileID:this.tileID,type:"glyphs"}},hn)}const $t=Object.keys(mt.iconDependencies);let Pe=Promise.resolve({});if($t.length){const hn=new AbortController;this.inFlightDependencies.push(hn),Pe=nt.sendAsync({type:"getImages",data:{icons:$t,source:this.source,tileID:this.tileID,type:"icons"}},hn)}const Ne=Object.keys(mt.patternDependencies);let Ke=Promise.resolve({});if(Ne.length){const hn=new AbortController;this.inFlightDependencies.push(hn),Ke=nt.sendAsync({type:"getImages",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"patterns"}},hn)}const[Qe,Tn,Hn]=yield Promise.all([Ht,Pe,Ke]),gi=new _(Qe),tr=new h.bk(Tn,Hn);for(const hn in Ct){const Ci=Ct[hn];Ci instanceof h.a5?(S(Ci.layers,this.zoom,K),h.bl({bucket:Ci,glyphMap:Qe,glyphPositions:gi.positions,imageMap:Tn,imagePositions:tr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ci.hasPattern&&(Ci instanceof h.bm||Ci instanceof h.bn||Ci instanceof h.bo)&&(S(Ci.layers,this.zoom,K),Ci.addFeatures(mt,this.tileID.canonical,tr.patternPositions))}return this.status="done",{buckets:Object.values(Ct).filter(hn=>!hn.isEmpty()),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:gi.image,imageAtlas:tr,glyphMap:this.returnDependencies?Qe:null,iconMap:this.returnDependencies?Tn:null,glyphPositions:this.returnDependencies?gi.positions:null}})}}function S(st,G,Z){const K=new h.a8(G);for(const nt of st)nt.recalculate(K,Z)}class E{constructor(G,Z,K){this.actor=G,this.layerIndex=Z,this.availableImages=K,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(G,Z){return h._(this,void 0,void 0,function*(){const K=yield h.l(G.request,Z);try{return{vectorTile:new h.bp.VectorTile(new h.bq(K.data)),rawData:K.data,cacheControl:K.cacheControl,expires:K.expires}}catch(nt){const Et=new Uint8Array(K.data);let J=`Unable to parse the tile at ${G.request.url}, `;throw J+=Et[0]===31&&Et[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${nt.messge}`,new Error(J)}})}loadTile(G){return h._(this,void 0,void 0,function*(){const Z=G.uid,K=!!(G&&G.request&&G.request.collectResourceTiming)&&new h.br(G.request),nt=new w(G);this.loading[Z]=nt;const Et=new AbortController;nt.abort=Et;try{const J=yield this.loadVectorTile(G,Et);if(delete this.loading[Z],!J)return null;const Ct=J.rawData,mt={};J.expires&&(mt.expires=J.expires),J.cacheControl&&(mt.cacheControl=J.cacheControl);const At={};if(K){const Ht=K.finish();Ht&&(At.resourceTiming=JSON.parse(JSON.stringify(Ht)))}nt.vectorTile=J.vectorTile;const Vt=nt.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Z]=nt,this.fetching[Z]={rawTileData:Ct,cacheControl:mt,resourceTiming:At};try{const Ht=yield Vt;return h.e({rawTileData:Ct.slice(0)},Ht,mt,At)}finally{delete this.fetching[Z]}}catch(J){throw delete this.loading[Z],nt.status="done",this.loaded[Z]=nt,J}})}reloadTile(G){return h._(this,void 0,void 0,function*(){const Z=G.uid;if(!this.loaded||!this.loaded[Z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const K=this.loaded[Z];if(K.showCollisionBoxes=G.showCollisionBoxes,K.status==="parsing"){const nt=yield K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor);let Et;if(this.fetching[Z]){const{rawTileData:J,cacheControl:Ct,resourceTiming:mt}=this.fetching[Z];delete this.fetching[Z],Et=h.e({rawTileData:J.slice(0)},nt,Ct,mt)}else Et=nt;return Et}if(K.status==="done"&&K.vectorTile)return K.parse(K.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(G){return h._(this,void 0,void 0,function*(){const Z=this.loading,K=G.uid;Z&&Z[K]&&Z[K].abort&&(Z[K].abort.abort(),delete Z[K])})}removeTile(G){return h._(this,void 0,void 0,function*(){this.loaded&&this.loaded[G.uid]&&delete this.loaded[G.uid]})}}class M{constructor(){this.loaded={}}loadTile(G){return h._(this,void 0,void 0,function*(){const{uid:Z,encoding:K,rawImageData:nt,redFactor:Et,greenFactor:J,blueFactor:Ct,baseShift:mt}=G,At=nt.width+2,Vt=nt.height+2,Ht=h.b(nt)?new h.R({width:At,height:Vt},yield h.bs(nt,-1,-1,At,Vt)):nt,$t=new h.bt(Z,Ht,K,Et,J,Ct,mt);return this.loaded=this.loaded||{},this.loaded[Z]=$t,$t})}removeTile(G){const Z=this.loaded,K=G.uid;Z&&Z[K]&&delete Z[K]}}function k(st,G){if(st.length!==0){D(st[0],G);for(var Z=1;Z<st.length;Z++)D(st[Z],!G)}}function D(st,G){for(var Z=0,K=0,nt=0,Et=st.length,J=Et-1;nt<Et;J=nt++){var Ct=(st[nt][0]-st[J][0])*(st[J][1]+st[nt][1]),mt=Z+Ct;K+=Math.abs(Z)>=Math.abs(Ct)?Z-mt+Ct:Ct-mt+Z,Z=mt}Z+K>=0!=!!G&&st.reverse()}var F=h.bu(function st(G,Z){var K,nt=G&&G.type;if(nt==="FeatureCollection")for(K=0;K<G.features.length;K++)st(G.features[K],Z);else if(nt==="GeometryCollection")for(K=0;K<G.geometries.length;K++)st(G.geometries[K],Z);else if(nt==="Feature")st(G.geometry,Z);else if(nt==="Polygon")k(G.coordinates,Z);else if(nt==="MultiPolygon")for(K=0;K<G.coordinates.length;K++)k(G.coordinates[K],Z);return G});const q=h.bp.VectorTileFeature.prototype.toGeoJSON;var X={exports:{}},B=h.bv,U=h.bp.VectorTileFeature,W=Q;function Q(st,G){this.options=G||{},this.features=st,this.length=st.length}function ht(st,G){this.id=typeof st.id=="number"?st.id:void 0,this.type=st.type,this.rawGeometry=st.type===1?[st.geometry]:st.geometry,this.properties=st.tags,this.extent=G||4096}Q.prototype.feature=function(st){return new ht(this.features[st],this.options.extent)},ht.prototype.loadGeometry=function(){var st=this.rawGeometry;this.geometry=[];for(var G=0;G<st.length;G++){for(var Z=st[G],K=[],nt=0;nt<Z.length;nt++)K.push(new B(Z[nt][0],Z[nt][1]));this.geometry.push(K)}return this.geometry},ht.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var st=this.geometry,G=1/0,Z=-1/0,K=1/0,nt=-1/0,Et=0;Et<st.length;Et++)for(var J=st[Et],Ct=0;Ct<J.length;Ct++){var mt=J[Ct];G=Math.min(G,mt.x),Z=Math.max(Z,mt.x),K=Math.min(K,mt.y),nt=Math.max(nt,mt.y)}return[G,K,Z,nt]},ht.prototype.toGeoJSON=U.prototype.toGeoJSON;var ut=h.bw,St=W;function lt(st){var G=new ut;return function(Z,K){for(var nt in Z.layers)K.writeMessage(3,zt,Z.layers[nt])}(st,G),G.finish()}function zt(st,G){var Z;G.writeVarintField(15,st.version||1),G.writeStringField(1,st.name||""),G.writeVarintField(5,st.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<st.length;Z++)K.feature=st.feature(Z),G.writeMessage(2,wt,K);var nt=K.keys;for(Z=0;Z<nt.length;Z++)G.writeStringField(3,nt[Z]);var Et=K.values;for(Z=0;Z<Et.length;Z++)G.writeMessage(4,Gt,Et[Z])}function wt(st,G){var Z=st.feature;Z.id!==void 0&&G.writeVarintField(1,Z.id),G.writeMessage(2,_t,st),G.writeVarintField(3,Z.type),G.writeMessage(4,oe,Z)}function _t(st,G){var Z=st.feature,K=st.keys,nt=st.values,Et=st.keycache,J=st.valuecache;for(var Ct in Z.properties){var mt=Z.properties[Ct],At=Et[Ct];if(mt!==null){At===void 0&&(K.push(Ct),Et[Ct]=At=K.length-1),G.writeVarint(At);var Vt=typeof mt;Vt!=="string"&&Vt!=="boolean"&&Vt!=="number"&&(mt=JSON.stringify(mt));var Ht=Vt+":"+mt,$t=J[Ht];$t===void 0&&(nt.push(mt),J[Ht]=$t=nt.length-1),G.writeVarint($t)}}}function te(st,G){return(G<<3)+(7&st)}function Pt(st){return st<<1^st>>31}function oe(st,G){for(var Z=st.loadGeometry(),K=st.type,nt=0,Et=0,J=Z.length,Ct=0;Ct<J;Ct++){var mt=Z[Ct],At=1;K===1&&(At=mt.length),G.writeVarint(te(1,At));for(var Vt=K===3?mt.length-1:mt.length,Ht=0;Ht<Vt;Ht++){Ht===1&&K!==1&&G.writeVarint(te(2,Vt-1));var $t=mt[Ht].x-nt,Pe=mt[Ht].y-Et;G.writeVarint(Pt($t)),G.writeVarint(Pt(Pe)),nt+=$t,Et+=Pe}K===3&&G.writeVarint(te(7,1))}}function Gt(st,G){var Z=typeof st;Z==="string"?G.writeStringField(1,st):Z==="boolean"?G.writeBooleanField(7,st):Z==="number"&&(st%1!=0?G.writeDoubleField(3,st):st<0?G.writeSVarintField(6,st):G.writeVarintField(5,st))}X.exports=lt,X.exports.fromVectorTileJs=lt,X.exports.fromGeojsonVt=function(st,G){G=G||{};var Z={};for(var K in st)Z[K]=new St(st[K].features,G),Z[K].name=K,Z[K].version=G.version,Z[K].extent=G.extent;return lt({layers:Z})},X.exports.GeoJSONWrapper=St;var ie=h.bu(X.exports);const Ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:st=>st},an=Math.fround||(cn=new Float32Array(1),st=>(cn[0]=+st,cn[0]));var cn;const je=3,Oe=5,wn=6;class In{constructor(G){this.options=Object.assign(Object.create(Ee),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:Z,minZoom:K,maxZoom:nt}=this.options;Z&&console.time("total time");const Et=`prepare ${G.length} points`;Z&&console.time(Et),this.points=G;const J=[];for(let mt=0;mt<G.length;mt++){const At=G[mt];if(!At.geometry)continue;const[Vt,Ht]=At.geometry.coordinates,$t=an(Vn(Vt)),Pe=an(ne(Ht));J.push($t,Pe,1/0,mt,-1,1),this.options.reduce&&J.push(0)}let Ct=this.trees[nt+1]=this._createTree(J);Z&&console.timeEnd(Et);for(let mt=nt;mt>=K;mt--){const At=+Date.now();Ct=this.trees[mt]=this._createTree(this._cluster(Ct,mt)),Z&&console.log("z%d: %d clusters in %dms",mt,Ct.numItems,+Date.now()-At)}return Z&&console.timeEnd("total time"),this}getClusters(G,Z){let K=((G[0]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,G[1]));let Et=G[2]===180?180:((G[2]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)K=-180,Et=180;else if(K>Et){const Ht=this.getClusters([K,nt,180,J],Z),$t=this.getClusters([-180,nt,Et,J],Z);return Ht.concat($t)}const Ct=this.trees[this._limitZoom(Z)],mt=Ct.range(Vn(K),ne(J),Vn(Et),ne(nt)),At=Ct.data,Vt=[];for(const Ht of mt){const $t=this.stride*Ht;Vt.push(At[$t+Oe]>1?Sn(At,$t,this.clusterProps):this.points[At[$t+je]])}return Vt}getChildren(G){const Z=this._getOriginId(G),K=this._getOriginZoom(G),nt="No cluster with the specified id.",Et=this.trees[K];if(!Et)throw new Error(nt);const J=Et.data;if(Z*this.stride>=J.length)throw new Error(nt);const Ct=this.options.radius/(this.options.extent*Math.pow(2,K-1)),mt=Et.within(J[Z*this.stride],J[Z*this.stride+1],Ct),At=[];for(const Vt of mt){const Ht=Vt*this.stride;J[Ht+4]===G&&At.push(J[Ht+Oe]>1?Sn(J,Ht,this.clusterProps):this.points[J[Ht+je]])}if(At.length===0)throw new Error(nt);return At}getLeaves(G,Z,K){const nt=[];return this._appendLeaves(nt,G,Z=Z||10,K=K||0,0),nt}getTile(G,Z,K){const nt=this.trees[this._limitZoom(G)],Et=Math.pow(2,G),{extent:J,radius:Ct}=this.options,mt=Ct/J,At=(K-mt)/Et,Vt=(K+1+mt)/Et,Ht={features:[]};return this._addTileFeatures(nt.range((Z-mt)/Et,At,(Z+1+mt)/Et,Vt),nt.data,Z,K,Et,Ht),Z===0&&this._addTileFeatures(nt.range(1-mt/Et,At,1,Vt),nt.data,Et,K,Et,Ht),Z===Et-1&&this._addTileFeatures(nt.range(0,At,mt/Et,Vt),nt.data,-1,K,Et,Ht),Ht.features.length?Ht:null}getClusterExpansionZoom(G){let Z=this._getOriginZoom(G)-1;for(;Z<=this.options.maxZoom;){const K=this.getChildren(G);if(Z++,K.length!==1)break;G=K[0].properties.cluster_id}return Z}_appendLeaves(G,Z,K,nt,Et){const J=this.getChildren(Z);for(const Ct of J){const mt=Ct.properties;if(mt&&mt.cluster?Et+mt.point_count<=nt?Et+=mt.point_count:Et=this._appendLeaves(G,mt.cluster_id,K,nt,Et):Et<nt?Et++:G.push(Ct),G.length===K)break}return Et}_createTree(G){const Z=new h.au(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<G.length;K+=this.stride)Z.add(G[K],G[K+1]);return Z.finish(),Z.data=G,Z}_addTileFeatures(G,Z,K,nt,Et,J){for(const Ct of G){const mt=Ct*this.stride,At=Z[mt+Oe]>1;let Vt,Ht,$t;if(At)Vt=Bn(Z,mt,this.clusterProps),Ht=Z[mt],$t=Z[mt+1];else{const Ke=this.points[Z[mt+je]];Vt=Ke.properties;const[Qe,Tn]=Ke.geometry.coordinates;Ht=Vn(Qe),$t=ne(Tn)}const Pe={type:1,geometry:[[Math.round(this.options.extent*(Ht*Et-K)),Math.round(this.options.extent*($t*Et-nt))]],tags:Vt};let Ne;Ne=At||this.options.generateId?Z[mt+je]:this.points[Z[mt+je]].id,Ne!==void 0&&(Pe.id=Ne),J.features.push(Pe)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,Z){const{radius:K,extent:nt,reduce:Et,minPoints:J}=this.options,Ct=K/(nt*Math.pow(2,Z)),mt=G.data,At=[],Vt=this.stride;for(let Ht=0;Ht<mt.length;Ht+=Vt){if(mt[Ht+2]<=Z)continue;mt[Ht+2]=Z;const $t=mt[Ht],Pe=mt[Ht+1],Ne=G.within(mt[Ht],mt[Ht+1],Ct),Ke=mt[Ht+Oe];let Qe=Ke;for(const Tn of Ne){const Hn=Tn*Vt;mt[Hn+2]>Z&&(Qe+=mt[Hn+Oe])}if(Qe>Ke&&Qe>=J){let Tn,Hn=$t*Ke,gi=Pe*Ke,tr=-1;const hn=((Ht/Vt|0)<<5)+(Z+1)+this.points.length;for(const Ci of Ne){const lr=Ci*Vt;if(mt[lr+2]<=Z)continue;mt[lr+2]=Z;const so=mt[lr+Oe];Hn+=mt[lr]*so,gi+=mt[lr+1]*so,mt[lr+4]=hn,Et&&(Tn||(Tn=this._map(mt,Ht,!0),tr=this.clusterProps.length,this.clusterProps.push(Tn)),Et(Tn,this._map(mt,lr)))}mt[Ht+4]=hn,At.push(Hn/Qe,gi/Qe,1/0,hn,-1,Qe),Et&&At.push(tr)}else{for(let Tn=0;Tn<Vt;Tn++)At.push(mt[Ht+Tn]);if(Qe>1)for(const Tn of Ne){const Hn=Tn*Vt;if(!(mt[Hn+2]<=Z)){mt[Hn+2]=Z;for(let gi=0;gi<Vt;gi++)At.push(mt[Hn+gi])}}}}return At}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,Z,K){if(G[Z+Oe]>1){const J=this.clusterProps[G[Z+wn]];return K?Object.assign({},J):J}const nt=this.points[G[Z+je]].properties,Et=this.options.map(nt);return K&&Et===nt?Object.assign({},Et):Et}}function Sn(st,G,Z){return{type:"Feature",id:st[G+je],properties:Bn(st,G,Z),geometry:{type:"Point",coordinates:[(K=st[G],360*(K-.5)),Ie(st[G+1])]}};var K}function Bn(st,G,Z){const K=st[G+Oe],nt=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,Et=st[G+wn],J=Et===-1?{}:Object.assign({},Z[Et]);return Object.assign(J,{cluster:!0,cluster_id:st[G+je],point_count:K,point_count_abbreviated:nt})}function Vn(st){return st/360+.5}function ne(st){const G=Math.sin(st*Math.PI/180),Z=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Z<0?0:Z>1?1:Z}function Ie(st){const G=(180-360*st)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function Fe(st,G,Z,K){for(var nt,Et=K,J=Z-G>>1,Ct=Z-G,mt=st[G],At=st[G+1],Vt=st[Z],Ht=st[Z+1],$t=G+3;$t<Z;$t+=3){var Pe=zn(st[$t],st[$t+1],mt,At,Vt,Ht);if(Pe>Et)nt=$t,Et=Pe;else if(Pe===Et){var Ne=Math.abs($t-J);Ne<Ct&&(nt=$t,Ct=Ne)}}Et>K&&(nt-G>3&&Fe(st,G,nt,K),st[nt+2]=Et,Z-nt>3&&Fe(st,nt,Z,K))}function zn(st,G,Z,K,nt,Et){var J=nt-Z,Ct=Et-K;if(J!==0||Ct!==0){var mt=((st-Z)*J+(G-K)*Ct)/(J*J+Ct*Ct);mt>1?(Z=nt,K=Et):mt>0&&(Z+=J*mt,K+=Ct*mt)}return(J=st-Z)*J+(Ct=G-K)*Ct}function Ki(st,G,Z,K){var nt={id:st===void 0?null:st,type:G,geometry:Z,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Et){var J=Et.geometry,Ct=Et.type;if(Ct==="Point"||Ct==="MultiPoint"||Ct==="LineString")Tt(Et,J);else if(Ct==="Polygon"||Ct==="MultiLineString")for(var mt=0;mt<J.length;mt++)Tt(Et,J[mt]);else if(Ct==="MultiPolygon")for(mt=0;mt<J.length;mt++)for(var At=0;At<J[mt].length;At++)Tt(Et,J[mt][At])}(nt),nt}function Tt(st,G){for(var Z=0;Z<G.length;Z+=3)st.minX=Math.min(st.minX,G[Z]),st.minY=Math.min(st.minY,G[Z+1]),st.maxX=Math.max(st.maxX,G[Z]),st.maxY=Math.max(st.maxY,G[Z+1])}function We(st,G,Z,K){if(G.geometry){var nt=G.geometry.coordinates,Et=G.geometry.type,J=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Ct=[],mt=G.id;if(Z.promoteId?mt=G.properties[Z.promoteId]:Z.generateId&&(mt=K||0),Et==="Point")Le(nt,Ct);else if(Et==="MultiPoint")for(var At=0;At<nt.length;At++)Le(nt[At],Ct);else if(Et==="LineString")Ji(nt,Ct,J,!1);else if(Et==="MultiLineString"){if(Z.lineMetrics){for(At=0;At<nt.length;At++)Ji(nt[At],Ct=[],J,!1),st.push(Ki(mt,"LineString",Ct,G.properties));return}Bt(nt,Ct,J,!1)}else if(Et==="Polygon")Bt(nt,Ct,J,!0);else{if(Et!=="MultiPolygon"){if(Et==="GeometryCollection"){for(At=0;At<G.geometry.geometries.length;At++)We(st,{id:mt,geometry:G.geometry.geometries[At],properties:G.properties},Z,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(At=0;At<nt.length;At++){var Vt=[];Bt(nt[At],Vt,J,!0),Ct.push(Vt)}}st.push(Ki(mt,Et,Ct,G.properties))}}function Le(st,G){G.push(yn(st[0])),G.push(ar(st[1])),G.push(0)}function Ji(st,G,Z,K){for(var nt,Et,J=0,Ct=0;Ct<st.length;Ct++){var mt=yn(st[Ct][0]),At=ar(st[Ct][1]);G.push(mt),G.push(At),G.push(0),Ct>0&&(J+=K?(nt*At-mt*Et)/2:Math.sqrt(Math.pow(mt-nt,2)+Math.pow(At-Et,2))),nt=mt,Et=At}var Vt=G.length-3;G[2]=1,Fe(G,0,Vt,Z),G[Vt+2]=1,G.size=Math.abs(J),G.start=0,G.end=G.size}function Bt(st,G,Z,K){for(var nt=0;nt<st.length;nt++){var Et=[];Ji(st[nt],Et,Z,K),G.push(Et)}}function yn(st){return st/360+.5}function ar(st){var G=Math.sin(st*Math.PI/180),Z=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return Z<0?0:Z>1?1:Z}function dn(st,G,Z,K,nt,Et,J,Ct){if(K/=G,Et>=(Z/=G)&&J<K)return st;if(J<Z||Et>=K)return null;for(var mt=[],At=0;At<st.length;At++){var Vt=st[At],Ht=Vt.geometry,$t=Vt.type,Pe=nt===0?Vt.minX:Vt.minY,Ne=nt===0?Vt.maxX:Vt.maxY;if(Pe>=Z&&Ne<K)mt.push(Vt);else if(!(Ne<Z||Pe>=K)){var Ke=[];if($t==="Point"||$t==="MultiPoint")mi(Ht,Ke,Z,K,nt);else if($t==="LineString")Dr(Ht,Ke,Z,K,nt,!1,Ct.lineMetrics);else if($t==="MultiLineString")Us(Ht,Ke,Z,K,nt,!1);else if($t==="Polygon")Us(Ht,Ke,Z,K,nt,!0);else if($t==="MultiPolygon")for(var Qe=0;Qe<Ht.length;Qe++){var Tn=[];Us(Ht[Qe],Tn,Z,K,nt,!0),Tn.length&&Ke.push(Tn)}if(Ke.length){if(Ct.lineMetrics&&$t==="LineString"){for(Qe=0;Qe<Ke.length;Qe++)mt.push(Ki(Vt.id,$t,Ke[Qe],Vt.tags));continue}$t!=="LineString"&&$t!=="MultiLineString"||(Ke.length===1?($t="LineString",Ke=Ke[0]):$t="MultiLineString"),$t!=="Point"&&$t!=="MultiPoint"||($t=Ke.length===3?"Point":"MultiPoint"),mt.push(Ki(Vt.id,$t,Ke,Vt.tags))}}}return mt.length?mt:null}function mi(st,G,Z,K,nt){for(var Et=0;Et<st.length;Et+=3){var J=st[Et+nt];J>=Z&&J<=K&&(G.push(st[Et]),G.push(st[Et+1]),G.push(st[Et+2]))}}function Dr(st,G,Z,K,nt,Et,J){for(var Ct,mt,At=vs(st),Vt=nt===0?Gr:_l,Ht=st.start,$t=0;$t<st.length-3;$t+=3){var Pe=st[$t],Ne=st[$t+1],Ke=st[$t+2],Qe=st[$t+3],Tn=st[$t+4],Hn=nt===0?Pe:Ne,gi=nt===0?Qe:Tn,tr=!1;J&&(Ct=Math.sqrt(Math.pow(Pe-Qe,2)+Math.pow(Ne-Tn,2))),Hn<Z?gi>Z&&(mt=Vt(At,Pe,Ne,Qe,Tn,Z),J&&(At.start=Ht+Ct*mt)):Hn>K?gi<K&&(mt=Vt(At,Pe,Ne,Qe,Tn,K),J&&(At.start=Ht+Ct*mt)):Ga(At,Pe,Ne,Ke),gi<Z&&Hn>=Z&&(mt=Vt(At,Pe,Ne,Qe,Tn,Z),tr=!0),gi>K&&Hn<=K&&(mt=Vt(At,Pe,Ne,Qe,Tn,K),tr=!0),!Et&&tr&&(J&&(At.end=Ht+Ct*mt),G.push(At),At=vs(st)),J&&(Ht+=Ct)}var hn=st.length-3;Pe=st[hn],Ne=st[hn+1],Ke=st[hn+2],(Hn=nt===0?Pe:Ne)>=Z&&Hn<=K&&Ga(At,Pe,Ne,Ke),hn=At.length-3,Et&&hn>=3&&(At[hn]!==At[0]||At[hn+1]!==At[1])&&Ga(At,At[0],At[1],At[2]),At.length&&G.push(At)}function vs(st){var G=[];return G.size=st.size,G.start=st.start,G.end=st.end,G}function Us(st,G,Z,K,nt,Et){for(var J=0;J<st.length;J++)Dr(st[J],G,Z,K,nt,Et,!1)}function Ga(st,G,Z,K){st.push(G),st.push(Z),st.push(K)}function Gr(st,G,Z,K,nt,Et){var J=(Et-G)/(K-G);return st.push(Et),st.push(Z+(nt-Z)*J),st.push(1),J}function _l(st,G,Z,K,nt,Et){var J=(Et-Z)/(nt-Z);return st.push(G+(K-G)*J),st.push(Et),st.push(1),J}function bs(st,G){for(var Z=[],K=0;K<st.length;K++){var nt,Et=st[K],J=Et.type;if(J==="Point"||J==="MultiPoint"||J==="LineString")nt=se(Et.geometry,G);else if(J==="MultiLineString"||J==="Polygon"){nt=[];for(var Ct=0;Ct<Et.geometry.length;Ct++)nt.push(se(Et.geometry[Ct],G))}else if(J==="MultiPolygon")for(nt=[],Ct=0;Ct<Et.geometry.length;Ct++){for(var mt=[],At=0;At<Et.geometry[Ct].length;At++)mt.push(se(Et.geometry[Ct][At],G));nt.push(mt)}Z.push(Ki(Et.id,J,nt,Et.tags))}return Z}function se(st,G){var Z=[];Z.size=st.size,st.start!==void 0&&(Z.start=st.start,Z.end=st.end);for(var K=0;K<st.length;K+=3)Z.push(st[K]+G,st[K+1],st[K+2]);return Z}function es(st,G){if(st.transformed)return st;var Z,K,nt,Et=1<<st.z,J=st.x,Ct=st.y;for(Z=0;Z<st.features.length;Z++){var mt=st.features[Z],At=mt.geometry,Vt=mt.type;if(mt.geometry=[],Vt===1)for(K=0;K<At.length;K+=2)mt.geometry.push(oo(At[K],At[K+1],G,Et,J,Ct));else for(K=0;K<At.length;K++){var Ht=[];for(nt=0;nt<At[K].length;nt+=2)Ht.push(oo(At[K][nt],At[K][nt+1],G,Et,J,Ct));mt.geometry.push(Ht)}}return st.transformed=!0,st}function oo(st,G,Z,K,nt,Et){return[Math.round(Z*(st*K-nt)),Math.round(Z*(G*K-Et))]}function yl(st,G,Z,K,nt){for(var Et=G===nt.maxZoom?0:nt.tolerance/((1<<G)*nt.extent),J={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:K,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ct=0;Ct<st.length;Ct++){J.numFeatures++,Qi(J,st[Ct],Et,nt);var mt=st[Ct].minX,At=st[Ct].minY,Vt=st[Ct].maxX,Ht=st[Ct].maxY;mt<J.minX&&(J.minX=mt),At<J.minY&&(J.minY=At),Vt>J.maxX&&(J.maxX=Vt),Ht>J.maxY&&(J.maxY=Ht)}return J}function Qi(st,G,Z,K){var nt=G.geometry,Et=G.type,J=[];if(Et==="Point"||Et==="MultiPoint")for(var Ct=0;Ct<nt.length;Ct+=3)J.push(nt[Ct]),J.push(nt[Ct+1]),st.numPoints++,st.numSimplified++;else if(Et==="LineString")ue(J,nt,st,Z,!1,!1);else if(Et==="MultiLineString"||Et==="Polygon")for(Ct=0;Ct<nt.length;Ct++)ue(J,nt[Ct],st,Z,Et==="Polygon",Ct===0);else if(Et==="MultiPolygon")for(var mt=0;mt<nt.length;mt++){var At=nt[mt];for(Ct=0;Ct<At.length;Ct++)ue(J,At[Ct],st,Z,!0,Ct===0)}if(J.length){var Vt=G.tags||null;if(Et==="LineString"&&K.lineMetrics){for(var Ht in Vt={},G.tags)Vt[Ht]=G.tags[Ht];Vt.mapbox_clip_start=nt.start/nt.size,Vt.mapbox_clip_end=nt.end/nt.size}var $t={geometry:J,type:Et==="Polygon"||Et==="MultiPolygon"?3:Et==="LineString"||Et==="MultiLineString"?2:1,tags:Vt};G.id!==null&&($t.id=G.id),st.features.push($t)}}function ue(st,G,Z,K,nt,Et){var J=K*K;if(K>0&&G.size<(nt?J:K))Z.numPoints+=G.length/3;else{for(var Ct=[],mt=0;mt<G.length;mt+=3)(K===0||G[mt+2]>J)&&(Z.numSimplified++,Ct.push(G[mt]),Ct.push(G[mt+1])),Z.numPoints++;nt&&function(At,Vt){for(var Ht=0,$t=0,Pe=At.length,Ne=Pe-2;$t<Pe;Ne=$t,$t+=2)Ht+=(At[$t]-At[Ne])*(At[$t+1]+At[Ne+1]);if(Ht>0===Vt)for($t=0,Pe=At.length;$t<Pe/2;$t+=2){var Ke=At[$t],Qe=At[$t+1];At[$t]=At[Pe-2-$t],At[$t+1]=At[Pe-1-$t],At[Pe-2-$t]=Ke,At[Pe-1-$t]=Qe}}(Ct,Et),st.push(Ct)}}function ln(st,G){var Z=(G=this.options=function(nt,Et){for(var J in Et)nt[J]=Et[J];return nt}(Object.create(this.options),G)).debug;if(Z&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var K=function(nt,Et){var J=[];if(nt.type==="FeatureCollection")for(var Ct=0;Ct<nt.features.length;Ct++)We(J,nt.features[Ct],Et,Ct);else We(J,nt.type==="Feature"?nt:{geometry:nt},Et);return J}(st,G);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),K=function(nt,Et){var J=Et.buffer/Et.extent,Ct=nt,mt=dn(nt,1,-1-J,J,0,-1,2,Et),At=dn(nt,1,1-J,2+J,0,-1,2,Et);return(mt||At)&&(Ct=dn(nt,1,-J,1+J,0,-1,2,Et)||[],mt&&(Ct=bs(mt,1).concat(Ct)),At&&(Ct=Ct.concat(bs(At,-1)))),Ct}(K,G),K.length&&this.splitTile(K,0,0,0),Z&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function on(st,G,Z){return 32*((1<<st)*Z+G)+st}function Ri(st,G){return G?st.properties[G]:st.id}function ns(st,G){if(st==null)return!0;if(st.type==="Feature")return Ri(st,G)!=null;if(st.type==="FeatureCollection"){const Z=new Set;for(const K of st.features){const nt=Ri(K,G);if(nt==null||Z.has(nt))return!1;Z.add(nt)}return!0}return!1}function rn(st,G){const Z=new Map;if(st!=null)if(st.type==="Feature")Z.set(Ri(st,G),st);else for(const K of st.features)Z.set(Ri(K,G),K);return Z}ln.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ln.prototype.splitTile=function(st,G,Z,K,nt,Et,J){for(var Ct=[st,G,Z,K],mt=this.options,At=mt.debug;Ct.length;){K=Ct.pop(),Z=Ct.pop(),G=Ct.pop(),st=Ct.pop();var Vt=1<<G,Ht=on(G,Z,K),$t=this.tiles[Ht];if(!$t&&(At>1&&console.time("creation"),$t=this.tiles[Ht]=yl(st,G,Z,K,mt),this.tileCoords.push({z:G,x:Z,y:K}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,Z,K,$t.numFeatures,$t.numPoints,$t.numSimplified),console.timeEnd("creation"));var Pe="z"+G;this.stats[Pe]=(this.stats[Pe]||0)+1,this.total++}if($t.source=st,nt){if(G===mt.maxZoom||G===nt)continue;var Ne=1<<nt-G;if(Z!==Math.floor(Et/Ne)||K!==Math.floor(J/Ne))continue}else if(G===mt.indexMaxZoom||$t.numPoints<=mt.indexMaxPoints)continue;if($t.source=null,st.length!==0){At>1&&console.time("clipping");var Ke,Qe,Tn,Hn,gi,tr,hn=.5*mt.buffer/mt.extent,Ci=.5-hn,lr=.5+hn,so=1+hn;Ke=Qe=Tn=Hn=null,gi=dn(st,Vt,Z-hn,Z+lr,0,$t.minX,$t.maxX,mt),tr=dn(st,Vt,Z+Ci,Z+so,0,$t.minX,$t.maxX,mt),st=null,gi&&(Ke=dn(gi,Vt,K-hn,K+lr,1,$t.minY,$t.maxY,mt),Qe=dn(gi,Vt,K+Ci,K+so,1,$t.minY,$t.maxY,mt),gi=null),tr&&(Tn=dn(tr,Vt,K-hn,K+lr,1,$t.minY,$t.maxY,mt),Hn=dn(tr,Vt,K+Ci,K+so,1,$t.minY,$t.maxY,mt),tr=null),At>1&&console.timeEnd("clipping"),Ct.push(Ke||[],G+1,2*Z,2*K),Ct.push(Qe||[],G+1,2*Z,2*K+1),Ct.push(Tn||[],G+1,2*Z+1,2*K),Ct.push(Hn||[],G+1,2*Z+1,2*K+1)}}},ln.prototype.getTile=function(st,G,Z){var K=this.options,nt=K.extent,Et=K.debug;if(st<0||st>24)return null;var J=1<<st,Ct=on(st,G=(G%J+J)%J,Z);if(this.tiles[Ct])return es(this.tiles[Ct],nt);Et>1&&console.log("drilling down to z%d-%d-%d",st,G,Z);for(var mt,At=st,Vt=G,Ht=Z;!mt&&At>0;)At--,Vt=Math.floor(Vt/2),Ht=Math.floor(Ht/2),mt=this.tiles[on(At,Vt,Ht)];return mt&&mt.source?(Et>1&&console.log("found parent tile z%d-%d-%d",At,Vt,Ht),Et>1&&console.time("drilling down"),this.splitTile(mt.source,At,Vt,Ht,st,G,Z),Et>1&&console.timeEnd("drilling down"),this.tiles[Ct]?es(this.tiles[Ct],nt):null):null};class _a extends E{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(G,Z){return h._(this,void 0,void 0,function*(){const K=G.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const nt=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!nt)return null;const Et=new class{constructor(Ct){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.W,this.length=Ct.length,this._features=Ct}feature(Ct){return new class{constructor(mt){this._feature=mt,this.extent=h.W,this.type=mt.type,this.properties=mt.tags,"id"in mt&&!isNaN(mt.id)&&(this.id=parseInt(mt.id,10))}loadGeometry(){if(this._feature.type===1){const mt=[];for(const At of this._feature.geometry)mt.push([new h.P(At[0],At[1])]);return mt}{const mt=[];for(const At of this._feature.geometry){const Vt=[];for(const Ht of At)Vt.push(new h.P(Ht[0],Ht[1]));mt.push(Vt)}return mt}}toGeoJSON(mt,At,Vt){return q.call(this,mt,At,Vt)}}(this._features[Ct])}}(nt.features);let J=ie(Et);return J.byteOffset===0&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),{vectorTile:Et,rawData:J.buffer}})}loadData(G){var Z;return h._(this,void 0,void 0,function*(){(Z=this._pendingRequest)===null||Z===void 0||Z.abort();const K=!!(G&&G.request&&G.request.collectResourceTiming)&&new h.br(G.request);this._pendingRequest=new AbortController;try{let nt=yield this.loadGeoJSON(G,this._pendingRequest);if(delete this._pendingRequest,typeof nt!="object")throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(F(nt,!0),G.filter){const J=h.bx(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(J.result==="error")throw new Error(J.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));nt={type:"FeatureCollection",features:nt.features.filter(mt=>J.value.evaluate({zoom:0},mt))}}this._geoJSONIndex=G.cluster?new In(function({superclusterOptions:J,clusterProperties:Ct}){if(!Ct||!J)return J;const mt={},At={},Vt={accumulated:null,zoom:0},Ht={properties:null},$t=Object.keys(Ct);for(const Pe of $t){const[Ne,Ke]=Ct[Pe],Qe=h.bx(Ke),Tn=h.bx(typeof Ne=="string"?[Ne,["accumulated"],["get",Pe]]:Ne);mt[Pe]=Qe.value,At[Pe]=Tn.value}return J.map=Pe=>{Ht.properties=Pe;const Ne={};for(const Ke of $t)Ne[Ke]=mt[Ke].evaluate(Vt,Ht);return Ne},J.reduce=(Pe,Ne)=>{Ht.properties=Ne;for(const Ke of $t)Vt.accumulated=Pe[Ke],Pe[Ke]=At[Ke].evaluate(Vt,Ht)},J}(G)).load(nt.features):function(J,Ct){return new ln(J,Ct)}(nt,G.geojsonVtOptions),this.loaded={};const Et={};if(K){const J=K.finish();J&&(Et.resourceTiming={},Et.resourceTiming[G.source]=JSON.parse(JSON.stringify(J)))}return Et}catch(nt){if(delete this._pendingRequest,h.by(nt))return{abandoned:!0};throw nt}})}reloadTile(G){const Z=this.loaded;return Z&&Z[G.uid]?super.reloadTile(G):this.loadTile(G)}loadGeoJSON(G,Z){return h._(this,void 0,void 0,function*(){const{promoteId:K}=G;if(G.request){const nt=yield h.h(G.request,Z);return this._dataUpdateable=ns(nt.data,K)?rn(nt.data,K):void 0,nt.data}if(typeof G.data=="string")try{const nt=JSON.parse(G.data);return this._dataUpdateable=ns(nt,K)?rn(nt,K):void 0,nt}catch{throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`)}if(!G.dataDiff)throw new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${G.source}`);return function(nt,Et,J){var Ct,mt,At,Vt;if(Et.removeAll&&nt.clear(),Et.remove)for(const Ht of Et.remove)nt.delete(Ht);if(Et.add)for(const Ht of Et.add){const $t=Ri(Ht,J);$t!=null&&nt.set($t,Ht)}if(Et.update)for(const Ht of Et.update){let $t=nt.get(Ht.id);if($t==null)continue;const Pe=!Ht.removeAllProperties&&(((Ct=Ht.removeProperties)===null||Ct===void 0?void 0:Ct.length)>0||((mt=Ht.addOrUpdateProperties)===null||mt===void 0?void 0:mt.length)>0);if((Ht.newGeometry||Ht.removeAllProperties||Pe)&&($t=Object.assign({},$t),nt.set(Ht.id,$t),Pe&&($t.properties=Object.assign({},$t.properties))),Ht.newGeometry&&($t.geometry=Ht.newGeometry),Ht.removeAllProperties)$t.properties={};else if(((At=Ht.removeProperties)===null||At===void 0?void 0:At.length)>0)for(const Ne of Ht.removeProperties)Object.prototype.hasOwnProperty.call($t.properties,Ne)&&delete $t.properties[Ne];if(((Vt=Ht.addOrUpdateProperties)===null||Vt===void 0?void 0:Vt.length)>0)for(const{key:Ne,value:Ke}of Ht.addOrUpdateProperties)$t.properties[Ne]=Ke}}(this._dataUpdateable,G.dataDiff,K),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(G){return h._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(G){return this._geoJSONIndex.getClusterExpansionZoom(G.clusterId)}getClusterChildren(G){return this._geoJSONIndex.getChildren(G.clusterId)}getClusterLeaves(G){return this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset)}}class Vi{constructor(G){this.self=G,this.actor=new h.C(G),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Z,K)=>{if(this.externalWorkerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.externalWorkerSourceTypes[Z]=K},this.self.addProtocol=h.be,this.self.removeProtocol=h.bf,this.self.registerRTLTextPlugin=Z=>{if(h.bz.isParsed())throw new Error("RTL text plugin already registered.");h.bz.setMethods(Z)},this.actor.registerMessageHandler("loadDEMTile",(Z,K)=>this._getDEMWorkerSource(Z,K.source).loadTile(K)),this.actor.registerMessageHandler("removeDEMTile",(Z,K)=>h._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Z,K.source).removeTile(K)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(Z,K)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,K.type,K.source).getClusterExpansionZoom(K)})),this.actor.registerMessageHandler("getClusterChildren",(Z,K)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,K.type,K.source).getClusterChildren(K)})),this.actor.registerMessageHandler("getClusterLeaves",(Z,K)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,K.type,K.source).getClusterLeaves(K)})),this.actor.registerMessageHandler("loadData",(Z,K)=>this._getWorkerSource(Z,K.type,K.source).loadData(K)),this.actor.registerMessageHandler("loadTile",(Z,K)=>this._getWorkerSource(Z,K.type,K.source).loadTile(K)),this.actor.registerMessageHandler("reloadTile",(Z,K)=>this._getWorkerSource(Z,K.type,K.source).reloadTile(K)),this.actor.registerMessageHandler("abortTile",(Z,K)=>this._getWorkerSource(Z,K.type,K.source).abortTile(K)),this.actor.registerMessageHandler("removeTile",(Z,K)=>this._getWorkerSource(Z,K.type,K.source).removeTile(K)),this.actor.registerMessageHandler("removeSource",(Z,K)=>h._(this,void 0,void 0,function*(){if(!this.workerSources[Z]||!this.workerSources[Z][K.type]||!this.workerSources[Z][K.type][K.source])return;const nt=this.workerSources[Z][K.type][K.source];delete this.workerSources[Z][K.type][K.source],nt.removeSource!==void 0&&nt.removeSource(K)})),this.actor.registerMessageHandler("setReferrer",(Z,K)=>h._(this,void 0,void 0,function*(){this.referrer=K})),this.actor.registerMessageHandler("syncRTLPluginState",(Z,K)=>this._syncRTLPluginState(Z,K)),this.actor.registerMessageHandler("importScript",(Z,K)=>h._(this,void 0,void 0,function*(){this.self.importScripts(K)})),this.actor.registerMessageHandler("setImages",(Z,K)=>this._setImages(Z,K)),this.actor.registerMessageHandler("updateLayers",(Z,K)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(Z).update(K.layers,K.removedIds)})),this.actor.registerMessageHandler("setLayers",(Z,K)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(Z).replace(K)}))}_setImages(G,Z){return h._(this,void 0,void 0,function*(){this.availableImages[G]=Z;for(const K in this.workerSources[G]){const nt=this.workerSources[G][K];for(const Et in nt)nt[Et].availableImages=Z}})}_syncRTLPluginState(G,Z){return h._(this,void 0,void 0,function*(){h.bz.setState(Z);const K=h.bz.getPluginURL();if(Z.pluginStatus==="loaded"&&!h.bz.isParsed()&&K!=null){this.self.importScripts(K);const nt=h.bz.isParsed();if(nt)return nt;throw new Error(`RTL Text Plugin failed to import scripts from ${K}`)}return!1})}_getAvailableImages(G){let Z=this.availableImages[G];return Z||(Z=[]),Z}_getLayerIndex(G){let Z=this.layerIndexes[G];return Z||(Z=this.layerIndexes[G]=new u),Z}_getWorkerSource(G,Z,K){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][Z]||(this.workerSources[G][Z]={}),!this.workerSources[G][Z][K]){const nt={sendAsync:(Et,J)=>(Et.targetMapId=G,this.actor.sendAsync(Et,J))};switch(Z){case"vector":this.workerSources[G][Z][K]=new E(nt,this._getLayerIndex(G),this._getAvailableImages(G));break;case"geojson":this.workerSources[G][Z][K]=new _a(nt,this._getLayerIndex(G),this._getAvailableImages(G));break;default:this.workerSources[G][Z][K]=new this.externalWorkerSourceTypes[Z](nt,this._getLayerIndex(G),this._getAvailableImages(G))}}return this.workerSources[G][Z][K]}_getDEMWorkerSource(G,Z){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][Z]||(this.demWorkerSources[G][Z]=new M),this.demWorkerSources[G][Z]}}return h.i(self)&&(self.worker=new Vi(self)),Vi}),r("index",["exports","./shared"],function(h,u){var _="4.0.2";let w,S;const E={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((s,f)=>{const d=requestAnimationFrame(s);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(d),f(u.c())})}),getImageData(y,s=0){return this.getImageCanvasContext(y).getImageData(-s,-s,y.width+2*s,y.height+2*s)},getImageCanvasContext(y){const s=window.document.createElement("canvas"),f=s.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return s.width=y.width,s.height=y.height,f.drawImage(y,0,0,y.width,y.height),f},resolveURL:y=>(w||(w=document.createElement("a")),w.href=y,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class M{static testProp(s){if(!M.docStyle)return s[0];for(let f=0;f<s.length;f++)if(s[f]in M.docStyle)return s[f];return s[0]}static create(s,f,d){const g=window.document.createElement(s);return f!==void 0&&(g.className=f),d&&d.appendChild(g),g}static createNS(s,f){return window.document.createElementNS(s,f)}static disableDrag(){M.docStyle&&M.selectProp&&(M.userSelect=M.docStyle[M.selectProp],M.docStyle[M.selectProp]="none")}static enableDrag(){M.docStyle&&M.selectProp&&(M.docStyle[M.selectProp]=M.userSelect)}static setTransform(s,f){s.style[M.transformProp]=f}static addEventListener(s,f,d,g={}){s.addEventListener(f,d,"passive"in g?g:g.capture)}static removeEventListener(s,f,d,g={}){s.removeEventListener(f,d,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",M.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",M.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",M.suppressClickInternal,!0)},0)}static getScale(s){const f=s.getBoundingClientRect();return{x:f.width/s.offsetWidth||1,y:f.height/s.offsetHeight||1,boundingClientRect:f}}static getPoint(s,f,d){const g=f.boundingClientRect;return new u.P((d.clientX-g.left)/f.x-s.clientLeft,(d.clientY-g.top)/f.y-s.clientTop)}static mousePos(s,f){const d=M.getScale(s);return M.getPoint(s,d,f)}static touchPos(s,f){const d=[],g=M.getScale(s);for(let v=0;v<f.length;v++)d.push(M.getPoint(s,g,f[v]));return d}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}M.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,M.selectProp=M.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),M.transformProp=M.testProp(["transform","WebkitTransform"]);const k={supported:!1,testSupport:function(y){!q&&F&&(X?B(y):D=y)}};let D,F,q=!1,X=!1;function B(y){const s=y.createTexture();y.bindTexture(y.TEXTURE_2D,s);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,F),y.isContextLost())return;k.supported=!0}catch{}y.deleteTexture(s),q=!0}var U,W;typeof document<"u"&&(F=document.createElement("img"),F.onload=function(){D&&B(D),D=null,X=!0},F.onerror=function(){q=!0,D=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let s,f,d,g;y.resetRequestQueue=()=>{s=[],f=0,d=0,g={}},y.addThrottleControl=P=>{const N=d++;return g[N]=P,N},y.removeThrottleControl=P=>{delete g[P],C()},y.getImage=(P,N,O=!0)=>new Promise((V,$)=>{k.supported&&(P.headers||(P.headers={}),P.headers.accept="image/webp,*/*"),u.e(P,{type:"image"}),s.push({abortController:N,requestParameters:P,supportImageRefresh:O,state:"queued",onError:it=>{$(it)},onSuccess:it=>{V(it)}}),C()});const v=P=>u._(this,void 0,void 0,function*(){P.state="running";const{requestParameters:N,supportImageRefresh:O,onError:V,onSuccess:$,abortController:it}=P,rt=O===!1&&!u.i(self)&&!u.g(N.url)&&(!N.headers||Object.keys(N.headers).reduce((It,Rt)=>It&&Rt==="accept",!0));f++;const at=rt?L(N,it):u.m(N,it);try{const It=yield at;delete P.abortController,P.state="completed",It.data instanceof HTMLImageElement||u.b(It.data)?$(It):It.data&&$({data:yield(et=It.data,typeof createImageBitmap=="function"?u.d(et):u.f(et)),cacheControl:It.cacheControl,expires:It.expires})}catch(It){delete P.abortController,V(It)}finally{f--,C()}var et}),C=()=>{const P=(()=>{for(const N of Object.keys(g))if(g[N]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let N=f;N<P&&s.length>0;N++){const O=s.shift();O.abortController.signal.aborted?N--:v(O)}},L=(P,N)=>new Promise((O,V)=>{const $=new Image,it=P.url,rt=P.credentials;rt&&rt==="include"?$.crossOrigin="use-credentials":(rt&&rt==="same-origin"||!u.s(it))&&($.crossOrigin="anonymous"),N.signal.addEventListener("abort",()=>{$.src="",V(u.c())}),$.fetchPriority="high",$.onload=()=>{$.onerror=$.onload=null,O({data:$})},$.onerror=()=>{$.onerror=$.onload=null,N.signal.aborted||V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},$.src=it})}(U||(U={})),U.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(W||(W={}));class Q{constructor(s){this._transformRequestFn=s}transformRequest(s,f){return this._transformRequestFn&&this._transformRequestFn(s,f)||{url:s}}normalizeSpriteURL(s,f,d){const g=function(v){const C=v.match(ht);if(!C)throw new Error(`Unable to parse URL "${v}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(s);return g.path+=`${f}${d}`,function(v){const C=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${C}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ut(y){var s=new u.A(3);return s[0]=y[0],s[1]=y[1],s[2]=y[2],s}var St,lt=function(y,s,f){return y[0]=s[0]-f[0],y[1]=s[1]-f[1],y[2]=s[2]-f[2],y};St=new u.A(3),u.A!=Float32Array&&(St[0]=0,St[1]=0,St[2]=0);var zt=function(y){var s=y[0],f=y[1];return s*s+f*f};function wt(y){const s=[];if(typeof y=="string")s.push({id:"default",url:y});else if(y&&y.length>0){const f=[];for(const{id:d,url:g}of y){const v=`${d}${g}`;f.indexOf(v)===-1&&(f.push(v),s.push({id:d,url:g}))}}return s}(function(){var y=new u.A(2);u.A!=Float32Array&&(y[0]=0,y[1]=0)})();class _t{constructor(s,f,d,g){this.context=s,this.format=d,this.texture=s.gl.createTexture(),this.update(f,g)}update(s,f,d){const{width:g,height:v}=s,C=!(this.size&&this.size[0]===g&&this.size[1]===v||d),{context:L}=this,{gl:P}=L;if(this.useMipmap=!!(f&&f.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),L.pixelStoreUnpackFlipY.set(!1),L.pixelStoreUnpack.set(1),L.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!f||f.premultiply!==!1)),C)this.size=[g,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||u.b(s)?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,s):P.texImage2D(P.TEXTURE_2D,0,this.format,g,v,0,this.format,P.UNSIGNED_BYTE,s.data);else{const{x:N,y:O}=d||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||u.b(s)?P.texSubImage2D(P.TEXTURE_2D,0,N,O,P.RGBA,P.UNSIGNED_BYTE,s):P.texSubImage2D(P.TEXTURE_2D,0,N,O,g,v,P.RGBA,P.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)}bind(s,f,d){const{context:g}=this,{gl:v}=g;v.bindTexture(v.TEXTURE_2D,this.texture),d!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,d||s),this.filter=s),f!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,f),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function te(y){const{userImage:s}=y;return!!(s&&s.render&&s.render())&&(y.data.replace(new Uint8Array(s.data.buffer)),!0)}class Pt extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:f,promiseResolve:d}of this.requestors)d(this._getImagesForIds(f));this.requestors=[]}}getImage(s){const f=this.images[s];if(f&&!f.data&&f.spriteData){const d=f.spriteData;f.data=new u.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),f.spriteData=null}return f}addImage(s,f){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,f)&&(this.images[s]=f)}_validate(s,f){let d=!0;const g=f.data||f.spriteData;return this._validateStretch(f.stretchX,g&&g.width)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "stretchX" value`))),d=!1),this._validateStretch(f.stretchY,g&&g.height)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "stretchY" value`))),d=!1),this._validateContent(f.content,f)||(this.fire(new u.j(new Error(`Image "${s}" has invalid "content" value`))),d=!1),d}_validateStretch(s,f){if(!s)return!0;let d=0;for(const g of s){if(g[0]<d||g[1]<g[0]||f<g[1])return!1;d=g[1]}return!0}_validateContent(s,f){if(!s)return!0;if(s.length!==4)return!1;const d=f.spriteData,g=d&&d.width||f.data.width,v=d&&d.height||f.data.height;return!(s[0]<0||g<s[0]||s[1]<0||v<s[1]||s[2]<0||g<s[2]||s[3]<0||v<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,f,d=!0){const g=this.getImage(s);if(d&&(g.data.width!==f.data.width||g.data.height!==f.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=g.version+1,this.images[s]=f,this.updatedImages[s]=!0}removeImage(s){const f=this.images[s];delete this.images[s],delete this.patterns[s],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((f,d)=>{let g=!0;if(!this.isLoaded())for(const v of s)this.images[v]||(g=!1);this.isLoaded()||g?f(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:f})})}_getImagesForIds(s){const f={};for(const d of s){let g=this.getImage(d);g||(this.fire(new u.k("styleimagemissing",{id:d})),g=this.getImage(d)),g?f[d]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:u.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:s,height:f}=this.atlasImage;return{width:s,height:f}}getPattern(s){const f=this.patterns[s],d=this.getImage(s);if(!d)return null;if(f&&f.position.version===d.version)return f.position;if(f)f.position.version=d.version;else{const g={w:d.data.width+2,h:d.data.height+2,x:0,y:0},v=new u.I(g,d);this.patterns[s]={bin:g,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const f=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _t(s,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:f,h:d}=u.p(s),g=this.atlasImage;g.resize({width:f||1,height:d||1});for(const v in this.patterns){const{bin:C}=this.patterns[v],L=C.x+1,P=C.y+1,N=this.getImage(v).data,O=N.width,V=N.height;u.R.copy(N,g,{x:0,y:0},{x:L,y:P},{width:O,height:V}),u.R.copy(N,g,{x:0,y:V-1},{x:L,y:P-1},{width:O,height:1}),u.R.copy(N,g,{x:0,y:0},{x:L,y:P+V},{width:O,height:1}),u.R.copy(N,g,{x:O-1,y:0},{x:L-1,y:P},{width:1,height:V}),u.R.copy(N,g,{x:0,y:0},{x:L+O,y:P},{width:1,height:V})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const f of s){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const d=this.getImage(f);d||u.w(`Image with ID: "${f}" was not found`),te(d)&&this.updateImage(f,d)}}}const oe=1e20;function Gt(y,s,f,d,g,v,C,L,P){for(let N=s;N<s+d;N++)ie(y,f*v+N,v,g,C,L,P);for(let N=f;N<f+g;N++)ie(y,N*v+s,1,d,C,L,P)}function ie(y,s,f,d,g,v,C){v[0]=0,C[0]=-oe,C[1]=oe,g[0]=y[s];for(let L=1,P=0,N=0;L<d;L++){g[L]=y[s+L*f];const O=L*L;do{const V=v[P];N=(g[L]-g[V]+O-V*V)/(L-V)/2}while(N<=C[P]&&--P>-1);P++,v[P]=L,C[P]=N,C[P+1]=oe}for(let L=0,P=0;L<d;L++){for(;C[P+1]<L;)P++;const N=v[P],O=L-N;y[s+L*f]=g[N]+O*O}}class Ee{constructor(s,f){this.requestManager=s,this.localIdeographFontFamily=f,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return u._(this,void 0,void 0,function*(){const f=[];for(const v in s)for(const C of s[v])f.push(this._getAndCacheGlyphsPromise(v,C));const d=yield Promise.all(f),g={};for(const{stack:v,id:C,glyph:L}of d)g[v]||(g[v]={}),g[v][C]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics};return g})}_getAndCacheGlyphsPromise(s,f){return u._(this,void 0,void 0,function*(){let d=this.entries[s];d||(d=this.entries[s]={glyphs:{},requests:{},ranges:{}});let g=d.glyphs[f];if(g!==void 0)return{stack:s,id:f,glyph:g};if(g=this._tinySDF(d,s,f),g)return d.glyphs[f]=g,{stack:s,id:f,glyph:g};const v=Math.floor(f/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[v])return{stack:s,id:f,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[v]){const L=Ee.loadGlyphRange(s,v,this.url,this.requestManager);d.requests[v]=L}const C=yield d.requests[v];for(const L in C)this._doesCharSupportLocalGlyph(+L)||(d.glyphs[+L]=C[+L]);return d.ranges[v]=!0,{stack:s,id:f,glyph:C[f]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(u.u["CJK Unified Ideographs"](s)||u.u["Hangul Syllables"](s)||u.u.Hiragana(s)||u.u.Katakana(s))}_tinySDF(s,f,d){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(d))return;let v=s.tinySDF;if(!v){let L="400";/bold/i.test(f)?L="900":/medium/i.test(f)?L="500":/light/i.test(f)&&(L="200"),v=s.tinySDF=new Ee.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:L})}const C=v.draw(String.fromCharCode(d));return{id:d,bitmap:new u.o({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ee.loadGlyphRange=function(y,s,f,d){return u._(this,void 0,void 0,function*(){const g=256*s,v=g+255,C=d.transformRequest(f.replace("{fontstack}",y).replace("{range}",`${g}-${v}`),W.Glyphs),L=yield u.l(C,new AbortController);if(!L||!L.data)throw new Error(`Could not load glyph range. range: ${s}, ${g}-${v}`);const P={};for(const N of u.n(L.data))P[N.id]=N;return P})},Ee.TinySDF=class{constructor({fontSize:y=24,buffer:s=3,radius:f=8,cutoff:d=.25,fontFamily:g="sans-serif",fontWeight:v="normal",fontStyle:C="normal"}={}){this.buffer=s,this.cutoff=d,this.radius=f;const L=this.size=y+4*s,P=this._createCanvas(L),N=this.ctx=P.getContext("2d",{willReadFrequently:!0});N.font=`${C} ${v} ${y}px ${g}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(L*L),this.gridInner=new Float64Array(L*L),this.f=new Float64Array(L),this.z=new Float64Array(L+1),this.v=new Uint16Array(L)}_createCanvas(y){const s=document.createElement("canvas");return s.width=s.height=y,s}draw(y){const{width:s,actualBoundingBoxAscent:f,actualBoundingBoxDescent:d,actualBoundingBoxLeft:g,actualBoundingBoxRight:v}=this.ctx.measureText(y),C=Math.ceil(f),L=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-g))),P=Math.min(this.size-this.buffer,C+Math.ceil(d)),N=L+2*this.buffer,O=P+2*this.buffer,V=Math.max(N*O,0),$=new Uint8ClampedArray(V),it={data:$,width:N,height:O,glyphWidth:L,glyphHeight:P,glyphTop:C,glyphLeft:0,glyphAdvance:s};if(L===0||P===0)return it;const{ctx:rt,buffer:at,gridInner:et,gridOuter:It}=this;rt.clearRect(at,at,L,P),rt.fillText(y,at,at+C);const Rt=rt.getImageData(at,at,L,P);It.fill(oe,0,V),et.fill(0,0,V);for(let ft=0;ft<P;ft++)for(let kt=0;kt<L;kt++){const Ut=Rt.data[4*(ft*L+kt)+3]/255;if(Ut===0)continue;const Ft=(ft+at)*N+kt+at;if(Ut===1)It[Ft]=0,et[Ft]=oe;else{const Kt=.5-Ut;It[Ft]=Kt>0?Kt*Kt:0,et[Ft]=Kt<0?Kt*Kt:0}}Gt(It,0,0,N,O,N,this.f,this.v,this.z),Gt(et,at,at,L,P,N,this.f,this.v,this.z);for(let ft=0;ft<V;ft++){const kt=Math.sqrt(It[ft])-Math.sqrt(et[ft]);$[ft]=Math.round(255-255*(kt/this.radius+this.cutoff))}return it}};class an{constructor(){this.specification=u.v.light.position}possiblyEvaluate(s,f){return u.y(s.expression.evaluate(f))}interpolate(s,f,d){return{x:u.z.number(s.x,f.x,d),y:u.z.number(s.y,f.y,d),z:u.z.number(s.z,f.z,d)}}}let cn;class je extends u.E{constructor(s){super(),cn=cn||new u.q({anchor:new u.D(u.v.light.anchor),position:new an,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(cn),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,f={}){if(!this._validate(u.r,s,f))for(const d in s){const g=s[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),g):this._transitionable.setValue(d,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,f,d){return(!d||d.validate!==!1)&&u.t(this,s.call(u.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}class Oe{constructor(s,f){this.width=s,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,f){const d=s.join(",")+String(f);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(s,f)),this.dashEntry[d]}getDashRanges(s,f,d){const g=[];let v=s.length%2==1?-s[s.length-1]*d:0,C=s[0]*d,L=!0;g.push({left:v,right:C,isDash:L,zeroLength:s[0]===0});let P=s[0];for(let N=1;N<s.length;N++){L=!L;const O=s[N];v=P*d,P+=O,C=P*d,g.push({left:v,right:C,isDash:L,zeroLength:O===0})}return g}addRoundDash(s,f,d){const g=f/2;for(let v=-d;v<=d;v++){const C=this.width*(this.nextRow+d+v);let L=0,P=s[L];for(let N=0;N<this.width;N++){N/P.right>1&&(P=s[++L]);const O=Math.abs(N-P.left),V=Math.abs(N-P.right),$=Math.min(O,V);let it;const rt=v/d*(g+1);if(P.isDash){const at=g-Math.abs(rt);it=Math.sqrt($*$+at*at)}else it=g-Math.sqrt($*$+rt*rt);this.data[C+N]=Math.max(0,Math.min(255,it+128))}}}addRegularDash(s){for(let L=s.length-1;L>=0;--L){const P=s[L],N=s[L+1];P.zeroLength?s.splice(L,1):N&&N.isDash===P.isDash&&(N.left=P.left,s.splice(L,1))}const f=s[0],d=s[s.length-1];f.isDash===d.isDash&&(f.left=d.left-this.width,d.right=f.right+this.width);const g=this.width*this.nextRow;let v=0,C=s[v];for(let L=0;L<this.width;L++){L/C.right>1&&(C=s[++v]);const P=Math.abs(L-C.left),N=Math.abs(L-C.right),O=Math.min(P,N);this.data[g+L]=Math.max(0,Math.min(255,(C.isDash?O:-O)+128))}}addDash(s,f){const d=f?7:0,g=2*d+1;if(this.nextRow+g>this.height)return u.w("LineAtlas out of space"),null;let v=0;for(let L=0;L<s.length;L++)v+=s[L];if(v!==0){const L=this.width/v,P=this.getDashRanges(s,this.width,L);f?this.addRoundDash(P,L,d):this.addRegularDash(P)}const C={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:v};return this.nextRow+=g,this.dirty=!0,C}bind(s){const f=s.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const wn="maplibre_preloaded_worker_pool";class In{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<In.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[wn]}numActive(){return Object.keys(this.active).length}}const Sn=Math.floor(E.hardwareConcurrency/2);let Bn,Vn;function ne(){return Bn||(Bn=new In),Bn}In.workerCount=u.B(globalThis)?Math.max(Math.min(Sn,3),1):1;class Ie{constructor(s,f){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=f;const d=this.workerPool.acquire(f);for(let g=0;g<d.length;g++){const v=new u.C(d[g],f);v.name=`Worker ${g}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,f){const d=[];for(const g of this.actors)d.push(g.sendAsync({type:s,data:f}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,f){for(const d of this.actors)d.registerMessageHandler(s,f)}}function Fe(){return Vn||(Vn=new Ie(ne(),u.G),Vn.registerMessageHandler("getResource",(y,s,f)=>u.m(s,f))),Vn}function zn(y,s){const f=u.F();return u.H(f,f,[1,1,0]),u.J(f,f,[.5*y.width,.5*y.height,1]),u.K(f,f,y.calculatePosMatrix(s.toUnwrapped()))}function Ki(y,s,f,d,g,v){const C=function(V,$,it){if(V)for(const rt of V){const at=$[rt];if(at&&at.source===it&&at.type==="fill-extrusion")return!0}else for(const rt in $){const at=$[rt];if(at.source===it&&at.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,y.id),L=v.maxPitchScaleFactor(),P=y.tilesIn(d,L,C);P.sort(Tt);const N=[];for(const V of P)N.push({wrappedTileID:V.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(s,f,y._state,V.queryGeometry,V.cameraQueryGeometry,V.scale,g,v,L,zn(y.transform,V.tileID))});const O=function(V){const $={},it={};for(const rt of V){const at=rt.queryResults,et=rt.wrappedTileID,It=it[et]=it[et]||{};for(const Rt in at){const ft=at[Rt],kt=It[Rt]=It[Rt]||{},Ut=$[Rt]=$[Rt]||[];for(const Ft of ft)kt[Ft.featureIndex]||(kt[Ft.featureIndex]=!0,Ut.push(Ft))}}return $}(N);for(const V in O)O[V].forEach($=>{const it=$.feature,rt=y.getFeatureState(it.layer["source-layer"],it.id);it.source=it.layer.source,it.layer["source-layer"]&&(it.sourceLayer=it.layer["source-layer"]),it.state=rt});return O}function Tt(y,s){const f=y.tileID,d=s.tileID;return f.overscaledZ-d.overscaledZ||f.canonical.y-d.canonical.y||f.wrap-d.wrap||f.canonical.x-d.canonical.x}function We(y,s,f){return u._(this,void 0,void 0,function*(){let d=y;if(y.url?d=(yield u.h(s.transformRequest(y.url,W.Source),f)).data:yield E.frameAsync(f),!d)return null;const g=u.L(u.e(d,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(g.vectorLayerIds=d.vector_layers.map(v=>v.id)),g})}class Le{constructor(s,f){s&&(f?this.setSouthWest(s).setNorthEast(f):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof u.M?new u.M(s.lng,s.lat):u.M.convert(s),this}setSouthWest(s){return this._sw=s instanceof u.M?new u.M(s.lng,s.lat):u.M.convert(s),this}extend(s){const f=this._sw,d=this._ne;let g,v;if(s instanceof u.M)g=s,v=s;else{if(!(s instanceof Le))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Le.convert(s)):this.extend(u.M.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(u.M.convert(s)):this;if(g=s._sw,v=s._ne,!g||!v)return this}return f||d?(f.lng=Math.min(g.lng,f.lng),f.lat=Math.min(g.lat,f.lat),d.lng=Math.max(v.lng,d.lng),d.lat=Math.max(v.lat,d.lat)):(this._sw=new u.M(g.lng,g.lat),this._ne=new u.M(v.lng,v.lat)),this}getCenter(){return new u.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.M(this.getWest(),this.getNorth())}getSouthEast(){return new u.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:f,lat:d}=u.M.convert(s);let g=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(s){return s instanceof Le?s:s&&new Le(s)}static fromLngLat(s,f=0){const d=360*f/40075017,g=d/Math.cos(Math.PI/180*s.lat);return new Le(new u.M(s.lng-g,s.lat-d),new u.M(s.lng+g,s.lat+d))}}class Ji{constructor(s,f,d){this.bounds=Le.convert(this.validateBounds(s)),this.minzoom=f||0,this.maxzoom=d||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const f=Math.pow(2,s.z),d=Math.floor(u.N(this.bounds.getWest())*f),g=Math.floor(u.O(this.bounds.getNorth())*f),v=Math.ceil(u.N(this.bounds.getEast())*f),C=Math.ceil(u.O(this.bounds.getSouth())*f);return s.x>=d&&s.x<v&&s.y>=g&&s.y<C}}class Bt extends u.E{constructor(s,f,d,g){if(super(),this.id=s,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.L(f,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield We(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(u.e(this,s),s.bounds&&(this.tileBounds=new Ji(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new u.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(f,W.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request.collectResourceTiming=this._collectResourceTiming;let g="reloadTile";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((v,C)=>{s.reloadPromise={resolve:v,reject:C}})}else s.actor=this.dispatcher.getActor(),g="loadTile";s.abortController=new AbortController;try{const v=yield s.actor.sendAsync({type:g,data:d},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,v)}catch(v){if(delete s.abortController,s.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,f){if(f&&f.resourceTiming&&(s.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&s.setExpiryData(f),s.loadVectorData(f,this.map.painter),s.reloadPromise){const d=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(d.resolve).catch(d.reject)}}abortTile(s){return u._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"abortTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return u._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class yn extends u.E{constructor(s,f,d,g){super(),this.id=s,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},f),u.e(this,u.L(f,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield We(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(u.e(this,s),s.bounds&&(this.tileBounds=new Ji(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new u.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return u.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const d=yield U.getImage(this.map._requestManager.transformRequest(f,W.Tile),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&s.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const g=this.map.painter.context,v=g.gl,C=d.data;s.texture=this.map.painter.getTileTexture(C.width),s.texture?s.texture.update(C,{useMipmap:!0}):(s.texture=new _t(g,C,v.RGBA,{useMipmap:!0}),s.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),s.state="loaded"}}catch(d){if(delete s.abortController,s.aborted)s.state="unloaded";else if(d)throw s.state="errored",d}})}abortTile(s){return u._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return u._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class ar extends yn{constructor(s,f,d,g){super(s,f,d,g),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(f,W.Tile);s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const g=yield U.getImage(d,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){const v=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const C=u.b(v)&&u.S()?v:yield this.readImageNow(v),L={type:this.type,uid:s.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const P=yield s.actor.sendAsync({type:"loadDEMTile",data:L});s.dem=P,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}readImageNow(s){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.U()){const f=s.width+2,d=s.height+2;try{return new u.R({width:f,height:d},yield u.V(s,-1,-1,f,d))}catch{}}return E.getImageData(s,1)})}_getNeighboringTiles(s){const f=s.canonical,d=Math.pow(2,f.z),g=(f.x-1+d)%d,v=f.x===0?s.wrap-1:s.wrap,C=(f.x+1+d)%d,L=f.x+1===d?s.wrap+1:s.wrap,P={};return P[new u.Q(s.overscaledZ,v,f.z,g,f.y).key]={backfilled:!1},P[new u.Q(s.overscaledZ,L,f.z,C,f.y).key]={backfilled:!1},f.y>0&&(P[new u.Q(s.overscaledZ,v,f.z,g,f.y-1).key]={backfilled:!1},P[new u.Q(s.overscaledZ,s.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},P[new u.Q(s.overscaledZ,L,f.z,C,f.y-1).key]={backfilled:!1}),f.y+1<d&&(P[new u.Q(s.overscaledZ,v,f.z,g,f.y+1).key]={backfilled:!1},P[new u.Q(s.overscaledZ,s.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},P[new u.Q(s.overscaledZ,L,f.z,C,f.y+1).key]={backfilled:!1}),P}unloadTile(s){return u._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class dn extends u.E{constructor(s,f,d,g){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(g),this._data=f.data,this._options=u.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const v=u.W/this.tileSize;this.workerOptions=u.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*v,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*v,extent:u.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:u.W,radius:(f.clusterRadius||50)*v,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,f,d){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:s,limit:f,offset:d}})}_updateWorkerData(s){return u._(this,void 0,void 0,function*(){const f=u.e({type:this.type},this.workerOptions);s?f.dataDiff=s:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(E.resolveURL(this._data),W.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"loadData",data:f});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let g=null;d.resourceTiming&&d.resourceTiming[this.id]&&(g=d.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&u.e(v,{resourceTiming:g}),this.fire(new u.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(d))}})}loaded(){return this._pendingLoads===0}loadTile(s){return u._(this,void 0,void 0,function*(){const f=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const d={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const g=yield this.actor.sendAsync({type:f,data:d},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(g,this.map.painter,f==="reloadTile")})}abortTile(s){return u._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return u._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var mi=u.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Dr extends u.E{constructor(s,f,d,g){super(),this.id=s,this.dispatcher=d,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=f}load(s){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield U.getImage(this.map._requestManager.transformRequest(this.url,W.Image),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,s&&(this.coordinates=s),this._finishLoading())}catch(f){this._request=null,this.fire(new u.j(f))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const f=s.map(u.Y.fromLngLat);this.tileID=function(g){let v=1/0,C=1/0,L=-1/0,P=-1/0;for(const $ of g)v=Math.min(v,$.x),C=Math.min(C,$.y),L=Math.max(L,$.x),P=Math.max(P,$.y);const N=Math.max(L-v,P-C),O=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),V=Math.pow(2,O);return new u.a0(O,Math.floor((v+L)/2*V),Math.floor((C+P)/2*V))}(f),this.minzoom=this.maxzoom=this.tileID.z;const d=f.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new u.Z,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,u.W,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,u.W),this._boundsArray.emplaceBack(d[2].x,d[2].y,u.W,u.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,mi.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _t(s,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let d=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vs extends Dr{constructor(s,f,d,g){super(s,f,d,g),this.roundZoom=!0,this.type="video",this.options=f}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const f of s.urls)this.urls.push(this.map._requestManager.transformRequest(f,W.Source).url);try{const f=yield u.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new u.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const f=this.video.seekable;s<f.start(0)||s>f.end(0)?this.fire(new u.j(new u.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,f=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,mi.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new _t(s,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let d=!1;for(const g in this.tiles){const v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Us extends Dr{constructor(s,f,d,g){super(s,f,d,g),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(C=>typeof C!="number"))||this.fire(new u.j(new u.a1(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a1(`sources.${s}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new u.j(new u.a1(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a1(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a1(`sources.${s}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,d=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,mi.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _t(f,this.canvas,d.RGBA,{premultiply:!0});let g=!1;for(const v in this.tiles){const C=this.tiles[v];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,g=!0)}g&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Ga={},Gr=y=>{switch(y){case"geojson":return dn;case"image":return Dr;case"raster":return yn;case"raster-dem":return ar;case"vector":return Bt;case"video":return vs;case"canvas":return Us}return Ga[y]};class _l extends u.E{constructor(){super(...arguments),this.pluginStatus="unavailable",this.pluginURL=null,this.dispatcher=Fe(),this.queue=[]}_sendPluginStateToWorker(){return u._(this,void 0,void 0,function*(){yield this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}),this.fire(new u.k("pluginStateChange",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}))})}getRTLTextPluginStatus(){return this.pluginStatus}clearRTLTextPlugin(){this.pluginStatus="unavailable",this.pluginURL=null}setRTLTextPlugin(s,f=!1){return u._(this,void 0,void 0,function*(){if(this.pluginStatus==="deferred"||this.pluginStatus==="loading"||this.pluginStatus==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");this.pluginURL=E.resolveURL(s),this.pluginStatus="deferred",yield this._sendPluginStateToWorker(),f||(yield this._downloadRTLTextPlugin())})}_downloadRTLTextPlugin(){return u._(this,void 0,void 0,function*(){if(this.pluginStatus!=="deferred"||!this.pluginURL)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");try{this.pluginStatus="loading",yield this._sendPluginStateToWorker(),yield u.l({url:this.pluginURL},new AbortController),this.pluginStatus="loaded"}catch{this.pluginStatus="error"}yield this._sendPluginStateToWorker()})}lazyLoadRTLTextPlugin(){return u._(this,void 0,void 0,function*(){this.pluginStatus==="deferred"&&(yield this._downloadRTLTextPlugin())})}}let bs=null;function se(){return bs||(bs=new _l),bs}class es{constructor(s,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=u.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const f=s+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,f,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,v){const C={};if(!v)return C;for(const L of g){const P=L.layerIds.map(N=>v.getLayer(N)).filter(Boolean);if(P.length!==0){L.layers=P,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(N=>P.filter(O=>O.id===N)[0]));for(const N of P)C[N.id]=L}}return C}(s.buckets,f.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const v=this.buckets[g];if(v instanceof u.a5){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const v=this.buckets[g];if(v instanceof u.a5&&v.hasRTLText){this.hasRTLText=!0,se().lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const g in this.buckets){const v=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(g).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new u.a4}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const d in this.buckets){const g=this.buckets[d];g.uploadPending()&&g.upload(s)}const f=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _t(s,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _t(s,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,f,d,g,v,C,L,P,N,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:v,scale:C,tileSize:this.tileSize,pixelPosMatrix:O,transform:P,params:L,queryPadding:this.queryPadding*N},s,f,d):{}}querySourceFeatures(s,f){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),v=f&&f.sourceLayer?f.sourceLayer:"",C=g._geojsonTileLayer||g[v];if(!C)return;const L=u.a6(f&&f.filter),{z:P,x:N,y:O}=this.tileID.canonical,V={z:P,x:N,y:O};for(let $=0;$<C.length;$++){const it=C.feature($);if(L.needGeometry){const et=u.a7(it,!0);if(!L.filter(new u.a8(this.tileID.overscaledZ),et,this.tileID.canonical))continue}else if(!L.filter(new u.a8(this.tileID.overscaledZ),it))continue;const rt=d.getId(it,v),at=new u.a9(it,P,N,O,rt);at.tile=V,s.push(at)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const f=this.expirationTime;if(s.cacheControl){const d=u.aa(s.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(f)if(this.expirationTime<f)g=!0;else{const v=this.expirationTime-f;v?this.expirationTime=d+Math.max(v,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!f.style.hasLayer(g))continue;const v=this.buckets[g],C=v.layers[0].sourceLayer||"_geojsonTileLayer",L=d[C],P=s[C];if(!L||!P||Object.keys(P).length===0)continue;v.update(P,L,this.imageAtlas&&this.imageAtlas.patternPositions||{});const N=f&&f.style&&f.style.getLayer(g);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<E.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=E.now()+s}setDependencies(s,f){const d={};for(const g of f)d[g]=!0;this.dependencies[s]=d}hasDependency(s,f){for(const d of s){const g=this.dependencies[d];if(g){for(const v of f)if(g[v])return!0}}return!1}}class oo{constructor(s,f){this.max=s,this.onRemove=f,this.reset()}reset(){for(const s in this.data)for(const f of this.data[s])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(s,f,d){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const v={value:f,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},d)),this.data[g].push(v),this.order.push(g),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const f=this.data[s].shift();return f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),f.value}getByKey(s){const f=this.data[s];return f?f[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,f){if(!this.has(s))return this;const d=s.wrapped().key,g=f===void 0?0:this.data[d].indexOf(f),v=this.data[d][g];return this.data[d].splice(g,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(s){const f=[];for(const d in this.data)for(const g of this.data[d])s(g.value)||f.push(g);for(const d of f)this.remove(d.value.tileID,d)}}class yl{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,f,d){const g=String(f);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},u.e(this.stateChanges[s][g],d),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==g&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const v in this.state[s][g])d[v]||(this.deletedStates[s][g][v]=null)}else for(const v in d)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][v]===null&&delete this.deletedStates[s][g][v]}removeFeatureState(s,f,d){if(this.deletedStates[s]===null)return;const g=String(f);if(this.deletedStates[s]=this.deletedStates[s]||{},d&&f!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][d]=null);else if(f!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(d in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][d]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,f){const d=String(f),g=u.e({},(this.state[s]||{})[d],(this.stateChanges[s]||{})[d]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][f];if(v===null)return{};for(const C in v)delete g[C]}return g}initializeTileState(s,f){s.setFeatureState(this.state,f)}coalesceChanges(s,f){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const v={};for(const C in this.stateChanges[g])this.state[g][C]||(this.state[g][C]={}),u.e(this.state[g][C],this.stateChanges[g][C]),v[C]=this.state[g][C];d[g]=v}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const v={};if(this.deletedStates[g]===null)for(const C in this.state[g])v[C]={},this.state[g][C]={};else for(const C in this.deletedStates[g]){if(this.deletedStates[g][C]===null)this.state[g][C]={};else for(const L of Object.keys(this.deletedStates[g][C]))delete this.state[g][C][L];v[C]=this.state[g][C]}d[g]=d[g]||{},u.e(d[g],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in s)s[g].setFeatureState(d,f)}}class Qi extends u.E{constructor(s,f,d){super(),this.id=s,this.dispatcher=d,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,v,C,L)=>{const P=new(Gr(v.type))(g,v,C,L);if(P.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${P.id}`);return P})(s,f,d,this),this._tiles={},this._cache=new oo(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new yl,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const f=this._tiles[s];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,f,d){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,f,d)}catch(g){s.state="errored",g.status!==404?this._source.fire(new u.j(g,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new u.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const d=this._tiles[f];d.upload(s),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(ue).map(s=>s.key)}getRenderableIds(s){const f=[];for(const d in this._tiles)this._isIdRenderable(d,s)&&f.push(this._tiles[d]);return s?f.sort((d,g)=>{const v=d.tileID,C=g.tileID,L=new u.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),P=new u.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-C.overscaledZ||P.y-L.y||P.x-L.x}).map(d=>d.tileID.key):f.map(d=>d.tileID).sort(ue).map(d=>d.key)}hasRenderableParent(s){const f=this.findLoadedParent(s,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(s,f){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(f||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,f){return u._(this,void 0,void 0,function*(){const d=this._tiles[s];d&&(d.state!=="loading"&&(d.state=f),yield this._loadTile(d,s,f))})}_tileLoaded(s,f,d){s.timeAdded=E.now(),d==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(f,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const f=this.getRenderableIds();for(let g=0;g<f.length;g++){const v=f[g];if(s.neighboringTiles&&s.neighboringTiles[v]){const C=this.getTileByID(v);d(s,C),d(C,s)}}function d(g,v){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let C=v.tileID.canonical.x-g.tileID.canonical.x;const L=v.tileID.canonical.y-g.tileID.canonical.y,P=Math.pow(2,g.tileID.canonical.z),N=v.tileID.key;C===0&&L===0||Math.abs(L)>1||(Math.abs(C)>1&&(Math.abs(C+P)===1?C+=P:Math.abs(C-P)===1&&(C-=P)),v.dem&&g.dem&&(g.dem.backfillBorder(v.dem,C,L),g.neighboringTiles&&g.neighboringTiles[N]&&(g.neighboringTiles[N].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,f,d,g){for(const v in this._tiles){let C=this._tiles[v];if(g[v]||!C.hasData()||C.tileID.overscaledZ<=f||C.tileID.overscaledZ>d)continue;let L=C.tileID;for(;C&&C.tileID.overscaledZ>f+1;){const N=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[N.key],C&&C.hasData()&&(L=N)}let P=L;for(;P.overscaledZ>f;)if(P=P.scaledTo(P.overscaledZ-1),s[P.key]){g[L.key]=L;break}}}findLoadedParent(s,f){if(s.key in this._loadedParentTiles){const d=this._loadedParentTiles[s.key];return d&&d.tileID.overscaledZ>=f?d:null}for(let d=s.overscaledZ-1;d>=f;d--){const g=s.scaledTo(d),v=this._getLoadedTile(g);if(v)return v}}_getLoadedTile(s){const f=this._tiles[s.key];return f&&f.hasData()?f:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const f=Math.ceil(s.width/this._source.tileSize)+1,d=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(f*d*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(v)}handleWrapJump(s){const f=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,f){const d={};for(const g in this._tiles){const v=this._tiles[g];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+f),d[v.tileID.key]=v}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,f){if(this.transform=s,this.terrain=f,!this._sourceLoaded||this._paused)return;let d;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new u.Q(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(d=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(d=d.filter(O=>this._source.hasTile(O)))):d=[];const g=s.coveringZoomLevel(this._source),v=Math.max(g-Qi.maxOverzooming,this._source.minzoom),C=Math.max(g+Qi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const V of d)if(V.canonical.z>this._source.minzoom){const $=V.scaledTo(V.canonical.z-1);O[$.key]=$;const it=V.scaledTo(Math.max(this._source.minzoom,Math.min(V.canonical.z,5)));O[it.key]=it}d=d.concat(Object.values(O))}const L=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,L&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const P=this._updateRetainedTiles(d,g);if(ln(this._source.type)){const O={},V={},$=Object.keys(P),it=E.now();for(const rt of $){const at=P[rt],et=this._tiles[rt];if(!et||et.fadeEndTime!==0&&et.fadeEndTime<=it)continue;const It=this.findLoadedParent(at,v);It&&(this._addTile(It.tileID),O[It.tileID.key]=It.tileID),V[rt]=at}this._retainLoadedChildren(V,g,C,P);for(const rt in O)P[rt]||(this._coveredTiles[rt]=!0,P[rt]=O[rt]);if(f){const rt={},at={};for(const et of d)this._tiles[et.key].hasData()?rt[et.key]=et:at[et.key]=et;for(const et in at){const It=at[et].children(this._source.maxzoom);this._tiles[It[0].key]&&this._tiles[It[1].key]&&this._tiles[It[2].key]&&this._tiles[It[3].key]&&(rt[It[0].key]=P[It[0].key]=It[0],rt[It[1].key]=P[It[1].key]=It[1],rt[It[2].key]=P[It[2].key]=It[2],rt[It[3].key]=P[It[3].key]=It[3],delete at[et])}for(const et in at){const It=this.findLoadedParent(at[et],this._source.minzoom);if(It){rt[It.tileID.key]=P[It.tileID.key]=It.tileID;for(const Rt in rt)rt[Rt].isChildOf(It.tileID)&&delete rt[Rt]}}for(const et in this._tiles)rt[et]||(this._coveredTiles[et]=!0)}}for(const O in P)this._tiles[O].clearFadeHold();const N=u.ab(this._tiles,P);for(const O of N){const V=this._tiles[O];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,f){const d={},g={},v=Math.max(f-Qi.maxOverzooming,this._source.minzoom),C=Math.max(f+Qi.maxUnderzooming,this._source.minzoom),L={};for(const P of s){const N=this._addTile(P);d[P.key]=P,N.hasData()||f<this._source.maxzoom&&(L[P.key]=P)}this._retainLoadedChildren(L,f,C,d);for(const P of s){let N=this._tiles[P.key];if(N.hasData())continue;if(f+1>this._source.maxzoom){const V=P.children(this._source.maxzoom)[0],$=this.getTile(V);if($&&$.hasData()){d[V.key]=V;continue}}else{const V=P.children(this._source.maxzoom);if(d[V[0].key]&&d[V[1].key]&&d[V[2].key]&&d[V[3].key])continue}let O=N.wasRequested();for(let V=P.overscaledZ-1;V>=v;--V){const $=P.scaledTo(V);if(g[$.key])break;if(g[$.key]=!0,N=this.getTile($),!N&&O&&(N=this._addTile($)),N){const it=N.hasData();if((O||it)&&(d[$.key]=$),O=N.wasRequested(),it)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const f=[];let d,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}f.push(g.key);const v=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;g=v}for(const v of f)this._loadedParentTiles[v]=d}}_addTile(s){let f=this._tiles[s.key];if(f)return f;f=this._cache.getAndRemove(s),f&&(this._setTileReloadTimer(s.key,f),f.tileID=s,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,f)));const d=f;return f||(f=new es(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(f,s.key,f.state)),f.uses++,this._tiles[s.key]=f,d||this._source.fire(new u.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(s,f){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const d=f.getExpiryTimeout();d&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},d))}_removeTile(s){const f=this._tiles[s];f&&(f.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,f,d){const g=[],v=this.transform;if(!v)return g;const C=d?v.getCameraQueryGeometry(s):s,L=s.map(rt=>v.pointCoordinate(rt,this.terrain)),P=C.map(rt=>v.pointCoordinate(rt,this.terrain)),N=this.getIds();let O=1/0,V=1/0,$=-1/0,it=-1/0;for(const rt of P)O=Math.min(O,rt.x),V=Math.min(V,rt.y),$=Math.max($,rt.x),it=Math.max(it,rt.y);for(let rt=0;rt<N.length;rt++){const at=this._tiles[N[rt]];if(at.holdingForFade())continue;const et=at.tileID,It=Math.pow(2,v.zoom-at.tileID.overscaledZ),Rt=f*at.queryPadding*u.W/at.tileSize/It,ft=[et.getTilePoint(new u.Y(O,V)),et.getTilePoint(new u.Y($,it))];if(ft[0].x-Rt<u.W&&ft[0].y-Rt<u.W&&ft[1].x+Rt>=0&&ft[1].y+Rt>=0){const kt=L.map(Ft=>et.getTilePoint(Ft)),Ut=P.map(Ft=>et.getTilePoint(Ft));g.push({tile:at,tileID:et,queryGeometry:kt,cameraQueryGeometry:Ut,scale:It})}}return g}getVisibleCoordinates(s){const f=this.getRenderableIds(s).map(d=>this._tiles[d].tileID);for(const d of f)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(ln(this._source.type)){const s=E.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=s)return!0}return!1}setFeatureState(s,f,d){this._state.updateState(s=s||"_geojsonTileLayer",f,d)}removeFeatureState(s,f,d){this._state.removeFeatureState(s=s||"_geojsonTileLayer",f,d)}getFeatureState(s,f){return this._state.getState(s=s||"_geojsonTileLayer",f)}setDependencies(s,f,d){const g=this._tiles[s];g&&g.setDependencies(f,d)}reloadTilesForDependencies(s,f){for(const d in this._tiles)this._tiles[d].hasDependency(s,f)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(s,f))}}function ue(y,s){const f=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*s.wrap)-+(s.wrap<0);return y.overscaledZ-s.overscaledZ||d-f||s.canonical.y-y.canonical.y||s.canonical.x-y.canonical.x}function ln(y){return y==="raster"||y==="image"||y==="video"}Qi.maxOverzooming=10,Qi.maxUnderzooming=3;class on{constructor(s,f){this.reset(s,f)}reset(s,f){this.points=s||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=u.ac(s,0,1);let f=1,d=this._distances[f];const g=s*this.paddedLength+this.padding;for(;d<g&&f<this._distances.length;)d=this._distances[++f];const v=f-1,C=this._distances[v],L=d-C,P=L>0?(g-C)/L:0;return this.points[v].mult(1-P).add(this.points[f].mult(P))}}function Ri(y,s){let f=!0;return y==="always"||y!=="never"&&s!=="never"||(f=!1),f}class ns{constructor(s,f,d){const g=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/d),this.yCellCount=Math.ceil(f/d);for(let C=0;C<this.xCellCount*this.yCellCount;C++)g.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=f,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,f,d,g,v){this._forEachCell(f,d,g,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(f),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(v)}insertCircle(s,f,d,g){this._forEachCell(f-g,d-g,f+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(f),this.circles.push(d),this.circles.push(g)}_insertBoxCell(s,f,d,g,v,C){this.boxCells[v].push(C)}_insertCircleCell(s,f,d,g,v,C){this.circleCells[v].push(C)}_query(s,f,d,g,v,C,L){if(d<0||s>this.width||g<0||f>this.height)return[];const P=[];if(s<=0&&f<=0&&this.width<=d&&this.height<=g){if(v)return[{key:null,x1:s,y1:f,x2:d,y2:g}];for(let N=0;N<this.boxKeys.length;N++)P.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const O=this.circles[3*N],V=this.circles[3*N+1],$=this.circles[3*N+2];P.push({key:this.circleKeys[N],x1:O-$,y1:V-$,x2:O+$,y2:V+$})}}else this._forEachCell(s,f,d,g,this._queryCell,P,{hitTest:v,overlapMode:C,seenUids:{box:{},circle:{}}},L);return P}query(s,f,d,g){return this._query(s,f,d,g,!1,null)}hitTest(s,f,d,g,v,C){return this._query(s,f,d,g,!0,v,C).length>0}hitTestCircle(s,f,d,g,v){const C=s-d,L=s+d,P=f-d,N=f+d;if(L<0||C>this.width||N<0||P>this.height)return!1;const O=[];return this._forEachCell(C,P,L,N,this._queryCellCircle,O,{hitTest:!0,overlapMode:g,circle:{x:s,y:f,radius:d},seenUids:{box:{},circle:{}}},v),O.length>0}_queryCell(s,f,d,g,v,C,L,P){const{seenUids:N,hitTest:O,overlapMode:V}=L,$=this.boxCells[v];if($!==null){const rt=this.bboxes;for(const at of $)if(!N.box[at]){N.box[at]=!0;const et=4*at,It=this.boxKeys[at];if(s<=rt[et+2]&&f<=rt[et+3]&&d>=rt[et+0]&&g>=rt[et+1]&&(!P||P(It))&&(!O||!Ri(V,It.overlapMode))&&(C.push({key:It,x1:rt[et],y1:rt[et+1],x2:rt[et+2],y2:rt[et+3]}),O))return!0}}const it=this.circleCells[v];if(it!==null){const rt=this.circles;for(const at of it)if(!N.circle[at]){N.circle[at]=!0;const et=3*at,It=this.circleKeys[at];if(this._circleAndRectCollide(rt[et],rt[et+1],rt[et+2],s,f,d,g)&&(!P||P(It))&&(!O||!Ri(V,It.overlapMode))){const Rt=rt[et],ft=rt[et+1],kt=rt[et+2];if(C.push({key:It,x1:Rt-kt,y1:ft-kt,x2:Rt+kt,y2:ft+kt}),O)return!0}}}return!1}_queryCellCircle(s,f,d,g,v,C,L,P){const{circle:N,seenUids:O,overlapMode:V}=L,$=this.boxCells[v];if($!==null){const rt=this.bboxes;for(const at of $)if(!O.box[at]){O.box[at]=!0;const et=4*at,It=this.boxKeys[at];if(this._circleAndRectCollide(N.x,N.y,N.radius,rt[et+0],rt[et+1],rt[et+2],rt[et+3])&&(!P||P(It))&&!Ri(V,It.overlapMode))return C.push(!0),!0}}const it=this.circleCells[v];if(it!==null){const rt=this.circles;for(const at of it)if(!O.circle[at]){O.circle[at]=!0;const et=3*at,It=this.circleKeys[at];if(this._circlesCollide(rt[et],rt[et+1],rt[et+2],N.x,N.y,N.radius)&&(!P||P(It))&&!Ri(V,It.overlapMode))return C.push(!0),!0}}}_forEachCell(s,f,d,g,v,C,L,P){const N=this._convertToXCellCoord(s),O=this._convertToYCellCoord(f),V=this._convertToXCellCoord(d),$=this._convertToYCellCoord(g);for(let it=N;it<=V;it++)for(let rt=O;rt<=$;rt++)if(v.call(this,s,f,d,g,this.xCellCount*rt+it,C,L,P))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,f,d,g,v,C){const L=g-s,P=v-f,N=d+C;return N*N>L*L+P*P}_circleAndRectCollide(s,f,d,g,v,C,L){const P=(C-g)/2,N=Math.abs(s-(g+P));if(N>P+d)return!1;const O=(L-v)/2,V=Math.abs(f-(v+O));if(V>O+d)return!1;if(N<=P||V<=O)return!0;const $=N-P,it=V-O;return $*$+it*it<=d*d}}function rn(y,s,f,d,g){const v=u.F();return s?(u.J(v,v,[1/g,1/g,1]),f||u.ad(v,v,d.angle)):u.K(v,d.labelPlaneMatrix,y),v}function _a(y,s,f,d,g){if(s){const v=u.ae(y);return u.J(v,v,[g,g,1]),f||u.ad(v,v,-d.angle),v}return d.glCoordMatrix}function Vi(y,s,f){let d;f?(d=[y.x,y.y,f(y.x,y.y),1],u.af(d,d,s)):(d=[y.x,y.y,0,1],Pe(d,d,s));const g=d[3];return{point:new u.P(d[0]/g,d[1]/g),signedDistanceFromCamera:g}}function st(y,s){return .5+y/s*.5}function G(y,s){const f=y[0]/y[3],d=y[1]/y[3];return f>=-s[0]&&f<=s[0]&&d>=-s[1]&&d<=s[1]}function Z(y,s,f,d,g,v,C,L,P,N){const O=d?y.textSizeData:y.iconSizeData,V=u.ag(O,f.transform.zoom),$=[256/f.width*2+1,256/f.height*2+1],it=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;it.clear();const rt=y.lineVertexArray,at=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,et=f.transform.width/f.transform.height;let It=!1;for(let Rt=0;Rt<at.length;Rt++){const ft=at.get(Rt);if(ft.hidden||ft.writingMode===u.ah.vertical&&!It){$t(ft.numGlyphs,it);continue}let kt;if(It=!1,N?(kt=[ft.anchorX,ft.anchorY,N(ft.anchorX,ft.anchorY),1],u.af(kt,kt,s)):(kt=[ft.anchorX,ft.anchorY,0,1],Pe(kt,kt,s)),!G(kt,$)){$t(ft.numGlyphs,it);continue}const Ut=st(f.transform.cameraToCenterDistance,kt[3]),Ft=u.ai(O,V,ft),Kt=C?Ft/Ut:Ft*Ut,ee=new u.P(ft.anchorX,ft.anchorY),Qt=Vi(ee,g,N).point,ae={projections:{},offsets:{}},Se=Et(ft,Kt,!1,L,s,g,v,y.glyphOffsetArray,rt,it,Qt,ee,ae,et,P,N);It=Se.useVertical,(Se.notEnoughRoom||It||Se.needsFlipping&&Et(ft,Kt,!0,L,s,g,v,y.glyphOffsetArray,rt,it,Qt,ee,ae,et,P,N).notEnoughRoom)&&$t(ft.numGlyphs,it)}d?y.text.dynamicLayoutVertexBuffer.updateData(it):y.icon.dynamicLayoutVertexBuffer.updateData(it)}function K(y,s,f,d,g,v,C,L,P,N,O,V,$){const it=L.glyphStartIndex+L.numGlyphs,rt=L.lineStartIndex,at=L.lineStartIndex+L.lineLength,et=s.getoffsetX(L.glyphStartIndex),It=s.getoffsetX(it-1),Rt=Vt(y*et,f,d,g,v,C,L.segment,rt,at,P,N,O,V,$);if(!Rt)return null;const ft=Vt(y*It,f,d,g,v,C,L.segment,rt,at,P,N,O,V,$);return ft?{first:Rt,last:ft}:null}function nt(y,s,f,d){return y===u.ah.horizontal&&Math.abs(f.y-s.y)>Math.abs(f.x-s.x)*d?{useVertical:!0}:(y===u.ah.vertical?s.y<f.y:s.x>f.x)?{needsFlipping:!0}:null}function Et(y,s,f,d,g,v,C,L,P,N,O,V,$,it,rt,at){const et=s/24,It=y.lineOffsetX*et,Rt=y.lineOffsetY*et;let ft;if(y.numGlyphs>1){const kt=y.glyphStartIndex+y.numGlyphs,Ut=y.lineStartIndex,Ft=y.lineStartIndex+y.lineLength,Kt=K(et,L,It,Rt,f,O,V,y,P,v,$,rt,at);if(!Kt)return{notEnoughRoom:!0};const ee=Vi(Kt.first.point,C,at).point,Qt=Vi(Kt.last.point,C,at).point;if(d&&!f){const ae=nt(y.writingMode,ee,Qt,it);if(ae)return ae}ft=[Kt.first];for(let ae=y.glyphStartIndex+1;ae<kt-1;ae++)ft.push(Vt(et*L.getoffsetX(ae),It,Rt,f,O,V,y.segment,Ut,Ft,P,v,$,rt,at));ft.push(Kt.last)}else{if(d&&!f){const Ut=Vi(V,g,at).point,Ft=y.lineStartIndex+y.segment+1,Kt=new u.P(P.getx(Ft),P.gety(Ft)),ee=Vi(Kt,g,at),Qt=ee.signedDistanceFromCamera>0?ee.point:J(V,Kt,Ut,1,g,at),ae=nt(y.writingMode,Ut,Qt,it);if(ae)return ae}const kt=Vt(et*L.getoffsetX(y.glyphStartIndex),It,Rt,f,O,V,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,P,v,$,rt,at);if(!kt)return{notEnoughRoom:!0};ft=[kt]}for(const kt of ft)u.aj(N,kt.point,kt.angle);return{}}function J(y,s,f,d,g,v){const C=Vi(y.add(y.sub(s)._unit()),g,v).point,L=f.sub(C);return f.add(L._mult(d/L.mag()))}function Ct(y,s){const{projectionCache:f,lineVertexArray:d,labelPlaneMatrix:g,tileAnchorPoint:v,distanceFromAnchor:C,getElevation:L,previousVertex:P,direction:N,absOffsetX:O}=s;if(f.projections[y])return f.projections[y];const V=new u.P(d.getx(y),d.gety(y)),$=Vi(V,g,L);if($.signedDistanceFromCamera>0)return f.projections[y]=$.point,$.point;const it=y-N;return J(C===0?v:new u.P(d.getx(it),d.gety(it)),V,P,O-C+1,g,L)}function mt(y,s,f){return y._unit()._perp()._mult(s*f)}function At(y,s,f,d,g,v,C,L){const{projectionCache:P,direction:N}=L;if(P.offsets[y])return P.offsets[y];const O=f.add(s);if(y+N<d||y+N>=g)return P.offsets[y]=O,O;const V=Ct(y+N,L),$=mt(V.sub(f),C,N),it=f.add($),rt=V.add($);return P.offsets[y]=u.ak(v,O,it,rt)||O,P.offsets[y]}function Vt(y,s,f,d,g,v,C,L,P,N,O,V,$,it){const rt=d?y-s:y+s;let at=rt>0?1:-1,et=0;d&&(at*=-1,et=Math.PI),at<0&&(et+=Math.PI);let It,Rt,ft=at>0?L+C:L+C+1,kt=g,Ut=g,Ft=0,Kt=0;const ee=Math.abs(rt),Qt=[];let ae;for(;Ft+Kt<=ee;){if(ft+=at,ft<L||ft>=P)return null;Ft+=Kt,Ut=kt,Rt=It;const me={projectionCache:V,lineVertexArray:N,labelPlaneMatrix:O,tileAnchorPoint:v,distanceFromAnchor:Ft,getElevation:it,previousVertex:Ut,direction:at,absOffsetX:ee};if(kt=Ct(ft,me),f===0)Qt.push(Ut),ae=kt.sub(Ut);else{let Ve;const Te=kt.sub(Ut);Ve=Te.mag()===0?mt(Ct(ft+at,me).sub(kt),f,at):mt(Te,f,at),Rt||(Rt=Ut.add(Ve)),It=At(ft,Ve,kt,L,P,Rt,f,me),Qt.push(Rt),ae=It.sub(Rt)}Kt=ae.mag()}const Se=ae._mult((ee-Ft)/Kt)._add(Rt||Ut),Ue=et+Math.atan2(kt.y-Ut.y,kt.x-Ut.x);return Qt.push(Se),{point:Se,angle:$?Ue:0,path:Qt}}const Ht=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function $t(y,s){for(let f=0;f<y;f++){const d=s.length;s.resize(d+4),s.float32.set(Ht,3*d)}}function Pe(y,s,f){const d=s[0],g=s[1];return y[0]=f[0]*d+f[4]*g+f[12],y[1]=f[1]*d+f[5]*g+f[13],y[3]=f[3]*d+f[7]*g+f[15],y}const Ne=100;class Ke{constructor(s,f=new ns(s.width+200,s.height+200,25),d=new ns(s.width+200,s.height+200,25)){this.transform=s,this.grid=f,this.ignoredGrid=d,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Ne,this.screenBottomBoundary=s.height+Ne,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,f,d,g,v,C){const L=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,C),P=d*L.perspectiveRatio,N=s.x1*P+L.point.x,O=s.y1*P+L.point.y,V=s.x2*P+L.point.x,$=s.y2*P+L.point.y;return!this.isInsideGrid(N,O,V,$)||f!=="always"&&this.grid.hitTest(N,O,V,$,f,v)||L.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[N,O,V,$],offscreen:this.isOffscreen(N,O,V,$)}}placeCollisionCircles(s,f,d,g,v,C,L,P,N,O,V,$,it,rt){const at=[],et=new u.P(f.anchorX,f.anchorY),It=Vi(et,C,rt),Rt=st(this.transform.cameraToCenterDistance,It.signedDistanceFromCamera),ft=(O?v/Rt:v*Rt)/u.ao,kt=Vi(et,L,rt).point,Ut=K(ft,g,f.lineOffsetX*ft,f.lineOffsetY*ft,!1,kt,et,f,d,L,{projections:{},offsets:{}},!1,rt);let Ft=!1,Kt=!1,ee=!0;if(Ut){const Qt=.5*$*Rt+it,ae=new u.P(-100,-100),Se=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Ue=new on,me=Ut.first,Ve=Ut.last;let Te=[];for(let fn=me.path.length-1;fn>=1;fn--)Te.push(me.path[fn]);for(let fn=1;fn<Ve.path.length;fn++)Te.push(Ve.path[fn]);const hi=2.5*Qt;if(P){const fn=Te.map(bn=>Vi(bn,P,rt));Te=fn.some(bn=>bn.signedDistanceFromCamera<=0)?[]:fn.map(bn=>bn.point)}let vn=[];if(Te.length>0){const fn=Te[0].clone(),bn=Te[0].clone();for(let ji=1;ji<Te.length;ji++)fn.x=Math.min(fn.x,Te[ji].x),fn.y=Math.min(fn.y,Te[ji].y),bn.x=Math.max(bn.x,Te[ji].x),bn.y=Math.max(bn.y,Te[ji].y);vn=fn.x>=ae.x&&bn.x<=Se.x&&fn.y>=ae.y&&bn.y<=Se.y?[Te]:bn.x<ae.x||fn.x>Se.x||bn.y<ae.y||fn.y>Se.y?[]:u.al([Te],ae.x,ae.y,Se.x,Se.y)}for(const fn of vn){Ue.reset(fn,.25*Qt);let bn=0;bn=Ue.length<=.5*Qt?1:Math.ceil(Ue.paddedLength/hi)+1;for(let ji=0;ji<bn;ji++){const $n=ji/Math.max(bn-1,1),co=Ue.lerp($n),Sr=co.x+Ne,Mi=co.y+Ne;at.push(Sr,Mi,Qt,0);const qr=Sr-Qt,Zr=Mi-Qt,ss=Sr+Qt,$a=Mi+Qt;if(ee=ee&&this.isOffscreen(qr,Zr,ss,$a),Kt=Kt||this.isInsideGrid(qr,Zr,ss,$a),s!=="always"&&this.grid.hitTestCircle(Sr,Mi,Qt,s,V)&&(Ft=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Ft}}}}return{circles:!N&&Ft||!Kt||Rt<this.perspectiveRatioCutoff?[]:at,offscreen:ee,collisionDetected:Ft}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let d=1/0,g=1/0,v=-1/0,C=-1/0;for(const O of s){const V=new u.P(O.x+Ne,O.y+Ne);d=Math.min(d,V.x),g=Math.min(g,V.y),v=Math.max(v,V.x),C=Math.max(C,V.y),f.push(V)}const L=this.grid.query(d,g,v,C).concat(this.ignoredGrid.query(d,g,v,C)),P={},N={};for(const O of L){const V=O.key;if(P[V.bucketInstanceId]===void 0&&(P[V.bucketInstanceId]={}),P[V.bucketInstanceId][V.featureIndex])continue;const $=[new u.P(O.x1,O.y1),new u.P(O.x2,O.y1),new u.P(O.x2,O.y2),new u.P(O.x1,O.y2)];u.am(f,$)&&(P[V.bucketInstanceId][V.featureIndex]=!0,N[V.bucketInstanceId]===void 0&&(N[V.bucketInstanceId]=[]),N[V.bucketInstanceId].push(V.featureIndex))}return N}insertCollisionBox(s,f,d,g,v,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:C,overlapMode:f},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,f,d,g,v,C){const L=d?this.ignoredGrid:this.grid,P={bucketInstanceId:g,featureIndex:v,collisionGroupID:C,overlapMode:f};for(let N=0;N<s.length;N+=4)L.insertCircle(P,s[N],s[N+1],s[N+2])}projectAndGetPerspectiveRatio(s,f,d,g){let v;return g?(v=[f,d,g(f,d),1],u.af(v,v,s)):(v=[f,d,0,1],Pe(v,v,s)),{point:new u.P((v[0]/v[3]+1)/2*this.transform.width+Ne,(-v[1]/v[3]+1)/2*this.transform.height+Ne),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(s,f,d,g){return d<Ne||s>=this.screenRightBoundary||g<Ne||f>this.screenBottomBoundary}isInsideGrid(s,f,d,g){return d>=0&&s<this.gridRightBoundary&&g>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const s=u.an([]);return u.H(s,s,[-100,-100,0]),s}}function Qe(y,s,f){return s*(u.W/(y.tileSize*Math.pow(2,f-y.tileID.overscaledZ)))}class Tn{constructor(s,f,d,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?f:-f))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Hn{constructor(s,f,d,g,v){this.text=new Tn(s?s.text:null,f,d,v),this.icon=new Tn(s?s.icon:null,f,g,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gi{constructor(s,f,d){this.text=s,this.icon=f,this.skipFade=d}}class tr{constructor(){this.invProjMatrix=u.F(),this.viewportMatrix=u.F(),this.circles=[]}}class hn{constructor(s,f,d,g,v){this.bucketInstanceId=s,this.featureIndex=f,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=v}}class Ci{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const f=++this.maxGroupID;this.collisionGroups[s]={ID:f,predicate:d=>d.collisionGroupID===f}}return this.collisionGroups[s]}}function lr(y,s,f,d,g){const{horizontalAlign:v,verticalAlign:C}=u.at(y);return new u.P(-(v-.5)*s+d[0]*g,-(C-.5)*f+d[1]*g)}function so(y,s,f,d,g,v){const{x1:C,x2:L,y1:P,y2:N,anchorPointX:O,anchorPointY:V}=y,$=new u.P(s,f);return d&&$._rotate(g?v:-v),{x1:C+$.x,y1:P+$.y,x2:L+$.x,y2:N+$.y,anchorPointX:O,anchorPointY:V}}class wo{constructor(s,f,d,g,v){this.transform=s.clone(),this.terrain=f,this.collisionIndex=new Ke(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ci(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,f,d,g){const v=d.getBucket(f),C=d.latestFeatureIndex;if(!v||!C||f.id!==v.layerIds[0])return;const L=d.collisionBoxArray,P=v.layers[0].layout,N=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),O=d.tileSize/u.W,V=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),$=P.get("text-pitch-alignment")==="map",it=P.get("text-rotation-alignment")==="map",rt=Qe(d,1,this.transform.zoom),at=rn(V,$,it,this.transform,rt);let et=null;if($){const Rt=_a(V,$,it,this.transform,rt);et=u.K([],this.transform.labelPlaneMatrix,Rt)}this.retainedQueryData[v.bucketInstanceId]=new hn(v.bucketInstanceId,C,v.sourceLayerIndex,v.index,d.tileID);const It={bucket:v,layout:P,posMatrix:V,textLabelPlaneMatrix:at,labelToScreenMatrix:et,scale:N,textPixelRatio:O,holdingForFade:d.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:u.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(g)for(const Rt of v.sortKeyRanges){const{sortKey:ft,symbolInstanceStart:kt,symbolInstanceEnd:Ut}=Rt;s.push({sortKey:ft,symbolInstanceStart:kt,symbolInstanceEnd:Ut,parameters:It})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:It})}attemptAnchorPlacement(s,f,d,g,v,C,L,P,N,O,V,$,it,rt,at,et){const It=u.ap[s.textAnchor],Rt=[s.textOffset0,s.textOffset1],ft=lr(It,d,g,Rt,v),kt=this.collisionIndex.placeCollisionBox(so(f,ft.x,ft.y,C,L,this.transform.angle),V,P,N,O.predicate,et);if((!at||this.collisionIndex.placeCollisionBox(so(at,ft.x,ft.y,C,L,this.transform.angle),V,P,N,O.predicate,et).box.length!==0)&&kt.box.length>0){let Ut;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ut=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:Rt,width:d,height:g,anchor:It,textBoxScale:v,prevAnchor:Ut},this.markUsedJustification(it,It,$,rt),it.allowVerticalPlacement&&(this.markUsedOrientation(it,rt,$),this.placedOrientations[$.crossTileID]=rt),{shift:ft,placedGlyphBoxes:kt}}}placeLayerBucketPart(s,f,d){const{bucket:g,layout:v,posMatrix:C,textLabelPlaneMatrix:L,labelToScreenMatrix:P,textPixelRatio:N,holdingForFade:O,collisionBoxArray:V,partiallyEvaluatedTextSize:$,collisionGroup:it}=s.parameters,rt=v.get("text-optional"),at=v.get("icon-optional"),et=u.aq(v,"text-overlap","text-allow-overlap"),It=et==="always",Rt=u.aq(v,"icon-overlap","icon-allow-overlap"),ft=Rt==="always",kt=v.get("text-rotation-alignment")==="map",Ut=v.get("text-pitch-alignment")==="map",Ft=v.get("icon-text-fit")!=="none",Kt=v.get("symbol-z-order")==="viewport-y",ee=It&&(ft||!g.hasIconData()||at),Qt=ft&&(It||!g.hasTextData()||rt);!g.collisionArrays&&V&&g.deserializeCollisionBoxes(V);const ae=this.retainedQueryData[g.bucketInstanceId].tileID,Se=this.terrain?(me,Ve)=>this.terrain.getElevation(ae,me,Ve):null,Ue=(me,Ve)=>{var Te,hi;if(f[me.crossTileID])return;if(O)return void(this.placements[me.crossTileID]=new gi(!1,!1,!1));let vn=!1,fn=!1,bn=!0,ji=null,$n={box:null,offscreen:null},co={box:null,offscreen:null},Sr=null,Mi=null,qr=null,Zr=0,ss=0,$a=0;Ve.textFeatureIndex?Zr=Ve.textFeatureIndex:me.useRuntimeCollisionCircles&&(Zr=me.featureIndex),Ve.verticalTextFeatureIndex&&(ss=Ve.verticalTextFeatureIndex);const fu=Ve.textBox;if(fu){const ur=fi=>{let cr=u.ah.horizontal;if(g.allowVerticalPlacement&&!fi&&this.prevPlacement){const Ir=this.prevPlacement.placedOrientations[me.crossTileID];Ir&&(this.placedOrientations[me.crossTileID]=Ir,cr=Ir,this.markUsedOrientation(g,cr,me))}return cr},qi=(fi,cr)=>{if(g.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&Ve.verticalTextBox){for(const Ir of g.writingModes)if(Ir===u.ah.vertical?($n=cr(),co=$n):$n=fi(),$n&&$n.box&&$n.box.length)break}else $n=fi()},Pi=me.textAnchorOffsetStartIndex,ho=me.textAnchorOffsetEndIndex;if(ho===Pi){const fi=(cr,Ir)=>{const hr=this.collisionIndex.placeCollisionBox(cr,et,N,C,it.predicate,Se);return hr&&hr.box&&hr.box.length&&(this.markUsedOrientation(g,Ir,me),this.placedOrientations[me.crossTileID]=Ir),hr};qi(()=>fi(fu,u.ah.horizontal),()=>{const cr=Ve.verticalTextBox;return g.allowVerticalPlacement&&me.numVerticalGlyphVertices>0&&cr?fi(cr,u.ah.vertical):{box:null,offscreen:null}}),ur($n&&$n.box&&$n.box.length)}else{let fi=u.ap[(hi=(Te=this.prevPlacement)===null||Te===void 0?void 0:Te.variableOffsets[me.crossTileID])===null||hi===void 0?void 0:hi.anchor];const cr=(hr,sm,zi)=>{const op=hr.x2-hr.x1,am=hr.y2-hr.y1,Pl=me.textBoxScale,kl=Ft&&Rt==="never"?sm:null;let ba={box:[],offscreen:!1},bh=et==="never"?1:2,sp="never";fi&&bh++;for(let lm=0;lm<bh;lm++){for(let xh=Pi;xh<ho;xh++){const um=g.textAnchorOffsets.get(xh);if(fi&&um.textAnchor!==fi)continue;const cc=this.attemptAnchorPlacement(um,hr,op,am,Pl,kt,Ut,N,C,it,sp,me,g,zi,kl,Se);if(cc&&(ba=cc.placedGlyphBoxes,ba&&ba.box&&ba.box.length))return vn=!0,ji=cc.shift,ba}fi?fi=null:sp=et}return ba};qi(()=>cr(fu,Ve.iconBox,u.ah.horizontal),()=>{const hr=Ve.verticalTextBox;return g.allowVerticalPlacement&&!($n&&$n.box&&$n.box.length)&&me.numVerticalGlyphVertices>0&&hr?cr(hr,Ve.verticalIconBox,u.ah.vertical):{box:null,offscreen:null}}),$n&&(vn=$n.box,bn=$n.offscreen);const Ir=ur($n&&$n.box);if(!vn&&this.prevPlacement){const hr=this.prevPlacement.variableOffsets[me.crossTileID];hr&&(this.variableOffsets[me.crossTileID]=hr,this.markUsedJustification(g,hr.anchor,me,Ir))}}}if(Sr=$n,vn=Sr&&Sr.box&&Sr.box.length>0,bn=Sr&&Sr.offscreen,me.useRuntimeCollisionCircles){const ur=g.text.placedSymbolArray.get(me.centerJustifiedTextSymbolIndex),qi=u.ai(g.textSizeData,$,ur),Pi=v.get("text-padding");Mi=this.collisionIndex.placeCollisionCircles(et,ur,g.lineVertexArray,g.glyphOffsetArray,qi,C,L,P,d,Ut,it.predicate,me.collisionCircleDiameter,Pi,Se),Mi.circles.length&&Mi.collisionDetected&&!d&&u.w("Collisions detected, but collision boxes are not shown"),vn=It||Mi.circles.length>0&&!Mi.collisionDetected,bn=bn&&Mi.offscreen}if(Ve.iconFeatureIndex&&($a=Ve.iconFeatureIndex),Ve.iconBox){const ur=qi=>{const Pi=Ft&&ji?so(qi,ji.x,ji.y,kt,Ut,this.transform.angle):qi;return this.collisionIndex.placeCollisionBox(Pi,Rt,N,C,it.predicate,Se)};co&&co.box&&co.box.length&&Ve.verticalIconBox?(qr=ur(Ve.verticalIconBox),fn=qr.box.length>0):(qr=ur(Ve.iconBox),fn=qr.box.length>0),bn=bn&&qr.offscreen}const pu=rt||me.numHorizontalGlyphVertices===0&&me.numVerticalGlyphVertices===0,Xa=at||me.numIconVertices===0;if(pu||Xa?Xa?pu||(fn=fn&&vn):vn=fn&&vn:fn=vn=fn&&vn,vn&&Sr&&Sr.box&&this.collisionIndex.insertCollisionBox(Sr.box,et,v.get("text-ignore-placement"),g.bucketInstanceId,co&&co.box&&ss?ss:Zr,it.ID),fn&&qr&&this.collisionIndex.insertCollisionBox(qr.box,Rt,v.get("icon-ignore-placement"),g.bucketInstanceId,$a,it.ID),Mi&&(vn&&this.collisionIndex.insertCollisionCircles(Mi.circles,et,v.get("text-ignore-placement"),g.bucketInstanceId,Zr,it.ID),d)){const ur=g.bucketInstanceId;let qi=this.collisionCircleArrays[ur];qi===void 0&&(qi=this.collisionCircleArrays[ur]=new tr);for(let Pi=0;Pi<Mi.circles.length;Pi+=4)qi.circles.push(Mi.circles[Pi+0]),qi.circles.push(Mi.circles[Pi+1]),qi.circles.push(Mi.circles[Pi+2]),qi.circles.push(Mi.collisionDetected?1:0)}if(me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[me.crossTileID]=new gi(vn||ee,fn||Qt,bn||g.justReloaded),f[me.crossTileID]=!0};if(Kt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const me=g.getSortedSymbolIndexes(this.transform.angle);for(let Ve=me.length-1;Ve>=0;--Ve){const Te=me[Ve];Ue(g.symbolInstances.get(Te),g.collisionArrays[Te])}}else for(let me=s.symbolInstanceStart;me<s.symbolInstanceEnd;me++)Ue(g.symbolInstances.get(me),g.collisionArrays[me]);if(d&&g.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[g.bucketInstanceId];u.ar(me.invProjMatrix,C),me.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,f,d,g){let v;v=g===u.ah.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[u.as(f)];const C=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const L of C)L>=0&&(s.text.placedSymbolArray.get(L).crossTileID=v>=0&&L!==v?0:d.crossTileID)}markUsedOrientation(s,f,d){const g=f===u.ah.horizontal||f===u.ah.horizontalOnly?f:0,v=f===u.ah.vertical?f:0,C=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const L of C)s.text.placedSymbolArray.get(L).placedOrientation=g;d.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let d=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const g=f?f.symbolFadeChange(s):1,v=f?f.opacities:{},C=f?f.variableOffsets:{},L=f?f.placedOrientations:{};for(const P in this.placements){const N=this.placements[P],O=v[P];O?(this.opacities[P]=new Hn(O,g,N.text,N.icon),d=d||N.text!==O.text.placed||N.icon!==O.icon.placed):(this.opacities[P]=new Hn(null,g,N.text,N.icon,N.skipFade),d=d||N.text||N.icon)}for(const P in v){const N=v[P];if(!this.opacities[P]){const O=new Hn(N,g,!1,!1);O.isHidden()||(this.opacities[P]=O,d=d||N.text.placed||N.icon.placed)}}for(const P in C)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=C[P]);for(const P in L)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=L[P]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:s)}updateLayerOpacities(s,f){const d={};for(const g of f){const v=g.getBucket(s);v&&g.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,d,g.collisionBoxArray)}}updateBucketOpacities(s,f,d){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],v=g.layout,C=new Hn(null,0,!1,!1,!0),L=v.get("text-allow-overlap"),P=v.get("icon-allow-overlap"),N=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=v.get("text-rotation-alignment")==="map",V=v.get("text-pitch-alignment")==="map",$=v.get("icon-text-fit")!=="none",it=new Hn(null,0,L&&(P||!s.hasIconData()||v.get("icon-optional")),P&&(L||!s.hasTextData()||v.get("text-optional")),!0);!s.collisionArrays&&d&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(d);const rt=(at,et,It)=>{for(let Rt=0;Rt<et/4;Rt++)at.opacityVertexArray.emplaceBack(It);at.hasVisibleVertices=at.hasVisibleVertices||It!==Gu};for(let at=0;at<s.symbolInstances.length;at++){const et=s.symbolInstances.get(at),{numHorizontalGlyphVertices:It,numVerticalGlyphVertices:Rt,crossTileID:ft}=et;let kt=this.opacities[ft];f[ft]?kt=C:kt||(kt=it,this.opacities[ft]=kt),f[ft]=!0;const Ut=et.numIconVertices>0,Ft=this.placedOrientations[et.crossTileID],Kt=Ft===u.ah.vertical,ee=Ft===u.ah.horizontal||Ft===u.ah.horizontalOnly;if(It>0||Rt>0){const Qt=So(kt.text);rt(s.text,It,Kt?Gu:Qt),rt(s.text,Rt,ee?Gu:Qt);const ae=kt.text.isHidden();[et.rightJustifiedTextSymbolIndex,et.centerJustifiedTextSymbolIndex,et.leftJustifiedTextSymbolIndex].forEach(me=>{me>=0&&(s.text.placedSymbolArray.get(me).hidden=ae||Kt?1:0)}),et.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(et.verticalPlacedTextSymbolIndex).hidden=ae||ee?1:0);const Se=this.variableOffsets[et.crossTileID];Se&&this.markUsedJustification(s,Se.anchor,et,Ft);const Ue=this.placedOrientations[et.crossTileID];Ue&&(this.markUsedJustification(s,"left",et,Ue),this.markUsedOrientation(s,Ue,et))}if(Ut){const Qt=So(kt.icon),ae=!($&&et.verticalPlacedIconSymbolIndex&&Kt);et.placedIconSymbolIndex>=0&&(rt(s.icon,et.numIconVertices,ae?Qt:Gu),s.icon.placedSymbolArray.get(et.placedIconSymbolIndex).hidden=kt.icon.isHidden()),et.verticalPlacedIconSymbolIndex>=0&&(rt(s.icon,et.numVerticalIconVertices,ae?Gu:Qt),s.icon.placedSymbolArray.get(et.verticalPlacedIconSymbolIndex).hidden=kt.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Qt=s.collisionArrays[at];if(Qt){let ae=new u.P(0,0);if(Qt.textBox||Qt.verticalTextBox){let Ue=!0;if(N){const me=this.variableOffsets[ft];me?(ae=lr(me.anchor,me.width,me.height,me.textOffset,me.textBoxScale),O&&ae._rotate(V?this.transform.angle:-this.transform.angle)):Ue=!1}Qt.textBox&&wr(s.textCollisionBox.collisionVertexArray,kt.text.placed,!Ue||Kt,ae.x,ae.y),Qt.verticalTextBox&&wr(s.textCollisionBox.collisionVertexArray,kt.text.placed,!Ue||ee,ae.x,ae.y)}const Se=!!(!ee&&Qt.verticalIconBox);Qt.iconBox&&wr(s.iconCollisionBox.collisionVertexArray,kt.icon.placed,Se,$?ae.x:0,$?ae.y:0),Qt.verticalIconBox&&wr(s.iconCollisionBox.collisionVertexArray,kt.icon.placed,!Se,$?ae.x:0,$?ae.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const at=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=at.invProjMatrix,s.placementViewportMatrix=at.viewportMatrix,s.collisionCircleArray=at.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,f){const d=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*d>s}setStale(){this.stale=!0}}function wr(y,s,f,d,g){y.emplaceBack(s?1:0,f?1:0,d||0,g||0),y.emplaceBack(s?1:0,f?1:0,d||0,g||0),y.emplaceBack(s?1:0,f?1:0,d||0,g||0),y.emplaceBack(s?1:0,f?1:0,d||0,g||0)}const Gs=Math.pow(2,25),Id=Math.pow(2,24),jg=Math.pow(2,17),qn=Math.pow(2,16),Sf=Math.pow(2,9),If=Math.pow(2,8),Fo=Math.pow(2,1);function So(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const s=y.placed?1:0,f=Math.floor(127*y.opacity);return f*Gs+s*Id+f*jg+s*qn+f*Sf+s*If+f*Fo+s}const Gu=0;class is{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,f,d,g,v){const C=this._bucketParts;for(;this._currentTileIndex<s.length;)if(f.getBucketParts(C,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((L,P)=>L.sortKey-P.sortKey));this._currentPartIndex<C.length;)if(f.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,v())return!0;return!1}}class rs{constructor(s,f,d,g,v,C,L,P){this.placement=new wo(s,f,C,L,P),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,f,d){const g=E.now(),v=()=>!this._forceFullPlacement&&E.now()-g>2;for(;this._currentPlacementIndex>=0;){const C=f[s[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=L)&&(!C.maxzoom||C.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new is(C)),this._inProgressLayer.continuePlacement(d[C.source],this.placement,this._showCollisionBoxes,C,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const eu=512/u.W/2;class Fc{constructor(s,f,d){this.tileID=s,this.bucketInstanceId=d,this._symbolsByKey={};const g=new Map;for(let v=0;v<f.length;v++){const C=f.get(v),L=C.key,P=g.get(L);P?P.push(C):g.set(L,[C])}for(const[v,C]of g){const L={positions:C.map(P=>({x:Math.floor(P.anchorX*eu),y:Math.floor(P.anchorY*eu)})),crossTileIDs:C.map(P=>P.crossTileID)};if(L.positions.length>128){const P=new u.au(L.positions.length,16,Uint16Array);for(const{x:N,y:O}of L.positions)P.add(N,O);P.finish(),delete L.positions,L.index=P}this._symbolsByKey[v]=L}}getScaledCoordinates(s,f){const{x:d,y:g,z:v}=this.tileID.canonical,{x:C,y:L,z:P}=f.canonical,N=eu/Math.pow(2,P-v),O=(L*u.W+s.anchorY)*N,V=g*u.W*eu;return{x:Math.floor((C*u.W+s.anchorX)*N-d*u.W*eu),y:Math.floor(O-V)}}findMatches(s,f,d){const g=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let v=0;v<s.length;v++){const C=s.get(v);if(C.crossTileID)continue;const L=this._symbolsByKey[C.key];if(!L)continue;const P=this.getScaledCoordinates(C,f);if(L.index){const N=L.index.range(P.x-g,P.y-g,P.x+g,P.y+g).sort();for(const O of N){const V=L.crossTileIDs[O];if(!d[V]){d[V]=!0,C.crossTileID=V;break}}}else if(L.positions)for(let N=0;N<L.positions.length;N++){const O=L.positions[N],V=L.crossTileIDs[N];if(Math.abs(O.x-P.x)<=g&&Math.abs(O.y-P.y)<=g&&!d[V]){d[V]=!0,C.crossTileID=V;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class er{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ju{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const f=Math.round((s-this.lng)/360);if(f!==0)for(const d in this.indexes){const g=this.indexes[d],v={};for(const C in g){const L=g[C];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+f),v[L.tileID.key]=L}this.indexes[d]=v}this.lng=s}addBucket(s,f,d){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<f.symbolInstances.length;v++)f.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const C=this.indexes[v];if(Number(v)>s.overscaledZ)for(const L in C){const P=C[L];P.tileID.isChildOf(s)&&P.findMatches(f.symbolInstances,s,g)}else{const L=C[s.scaledTo(Number(v)).key];L&&L.findMatches(f.symbolInstances,s,g)}}for(let v=0;v<f.symbolInstances.length;v++){const C=f.symbolInstances.get(v);C.crossTileID||(C.crossTileID=d.generate(),g[C.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Fc(s,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(s,f){for(const d of f.getCrossTileIDsLists())for(const g of d)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let f=!1;for(const d in this.indexes){const g=this.indexes[d];for(const v in g)s[g[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[v]),delete g[v],f=!0)}return f}}class ja{constructor(){this.layerIndexes={},this.crossTileIDs=new er,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,f,d){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new ju);let v=!1;const C={};g.handleWrapJump(d);for(const L of f){const P=L.getBucket(s);P&&s.id===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(L.tileID,P,this.crossTileIDs)&&(v=!0),C[P.bucketInstanceId]=!0)}return g.removeStaleBuckets(C)&&(v=!0),v}pruneUnusedLayers(s){const f={};s.forEach(d=>{f[d]=!0});for(const d in this.layerIndexes)f[d]||delete this.layerIndexes[d]}}const xi=(y,s)=>u.t(y,s&&s.filter(f=>f.identifier!=="source.canvas")),Bc=u.av();class Bo extends u.E{constructor(s,f={}){super(),this._rtlTextPluginStateChange=()=>{for(const d in this.sourceCaches){const g=this.sourceCaches[d].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[d].reload()}},this.map=s,this.dispatcher=new Ie(ne(),s._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(d,g)=>this.getGlyphs(d,g)),this.dispatcher.registerMessageHandler("getImages",(d,g)=>this.getImages(d,g)),this.imageManager=new Pt,this.imageManager.setEventedParent(this),this.glyphManager=new Ee(s._requestManager,f.localIdeographFontFamily),this.lineAtlas=new Oe(256,512),this.crossTileSymbolIndex=new ja,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.ax()),se().on("pluginStateChange",this._rtlTextPluginStateChange),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const g=this.sourceCaches[d.sourceId];if(!g)return;const v=g.getSource();if(v&&v.vectorLayerIds)for(const C in this._layers){const L=this._layers[C];L.source===v.id&&this._validateLayer(L)}})}loadURL(s,f={},d){this.fire(new u.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const g=this.map._requestManager.transformRequest(s,W.Style);this._loadStyleRequest=new AbortController,u.h(g,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,f,d)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new u.j(v))})}loadJSON(s,f={},d){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(s,f,d)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(Bc,{validate:!1})}_load(s,f,d){var g;const v=f.transformStyle?f.transformStyle(d,s):s;if(!f.validate||!xi(this,u.x(v))){this._loaded=!0,this.stylesheet=v;for(const C in v.sources)this.addSource(C,v.sources[C],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new je(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const s=u.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of s){const d=u.az(f);d.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=d}}_loadSprite(s,f=!1,d=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,C,L,P){return u._(this,void 0,void 0,function*(){const N=wt(v),O=L>1?"@2x":"",V={},$={};for(const{id:it,url:rt}of N){const at=C.transformRequest(C.normalizeSpriteURL(rt,O,".json"),W.SpriteJSON);V[it]=u.h(at,P);const et=C.transformRequest(C.normalizeSpriteURL(rt,O,".png"),W.SpriteImage);$[it]=U.getImage(et,P)}return yield Promise.all([...Object.values(V),...Object.values($)]),function(it,rt){return u._(this,void 0,void 0,function*(){const at={};for(const et in it){at[et]={};const It=E.getImageCanvasContext((yield rt[et]).data),Rt=(yield it[et]).data;for(const ft in Rt){const{width:kt,height:Ut,x:Ft,y:Kt,sdf:ee,pixelRatio:Qt,stretchX:ae,stretchY:Se,content:Ue}=Rt[ft];at[et][ft]={data:null,pixelRatio:Qt,sdf:ee,stretchX:ae,stretchY:Se,content:Ue,spriteData:{width:kt,height:Ut,x:Ft,y:Kt,context:It}}}}return at})}(V,$)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const C in v){this._spritesImagesIds[C]=[];const L=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(P=>!(P in v)):[];for(const P of L)this.imageManager.removeImage(P),this._changedImages[P]=!0;for(const P in v[C]){const N=C==="default"?P:`${C}:${P}`;this._spritesImagesIds[C].push(N),N in this.imageManager.images?this.imageManager.updateImage(N,v[C][P],!1):this.imageManager.addImage(N,v[C][P]),f&&(this._changedImages[N]=!0)}}}).catch(v=>{this._spriteRequest=null,g=v,this.fire(new u.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),d&&d(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(s){const f=this.sourceCaches[s.source];if(!f)return;const d=s.sourceLayer;if(!d)return;const g=f.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(d)===-1)&&this.fire(new u.j(new Error(`Source layer "${d}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const f=this._serializedAllLayers();if(!s||s.length===0)return Object.values(f);const d=[];for(const g of s)f[g]&&d.push(f[g]);return d}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const f=Object.keys(this._layers);for(const d of f){const g=this._layers[d];g.type!=="custom"&&(s[d]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const f=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(g.length||v.length)&&this._updateWorkerLayers(g,v);for(const C in this._updatedSources){const L=this._updatedSources[C];if(L==="reload")this._reloadSource(C);else{if(L!=="clear")throw new Error(`Invalid action ${L}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const d={};for(const g in this.sourceCaches){const v=this.sourceCaches[g];d[g]=v.used,v.used=!1}for(const g of this._order){const v=this._layers[g];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const g in d){const v=this.sourceCaches[g];d[g]!==v.used&&v.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,f&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,f={}){var d;this._checkLoaded();const g=this.serialize();if(s=f.transformStyle?f.transformStyle(g,s):s,((d=f.validate)===null||d===void 0||d)&&xi(this,u.x(s)))return!1;(s=u.aA(s)).layers=u.ay(s.layers);const v=u.aB(g,s),C=this._getOperationsToPerform(v);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const L of C.operations)L();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const f=[],d=[];for(const g of s)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":f.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":f.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":f.push(()=>{});break;default:d.push(g.command)}return{operations:f,unimplemented:d}}addImage(s,f){if(this.getImage(s))return this.fire(new u.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,f),this._afterImageUpdated(s)}updateImage(s,f){this.imageManager.updateImage(s,f)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new u.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,f,d={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(u.x.source,`sources.${s}`,f,null,d))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const g=this.sourceCaches[s]=new Qi(s,f,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===s)return this.fire(new u.j(new Error(`Source "${s}" cannot be removed while layer "${d}" is using it.`)));const f=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],f.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,f){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const d=this.sourceCaches[s].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(f),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,f,d={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new u.j(new Error(`Layer "${g}" already exists on this map.`)));let v;if(s.type==="custom"){if(xi(this,u.aC(s)))return;v=u.az(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=u.aA(s),s=u.e(s,{source:g})),this._validate(u.x.layer,`layers.${g}`,s,{arrayIndex:-1},d))return;v=u.az(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:g}})}const C=f?this._order.indexOf(f):this._order.length;if(f&&C===-1)this.fire(new u.j(new Error(`Cannot add layer "${g}" before non-existing layer "${f}".`)));else{if(this._order.splice(C,0,g),this._layerOrderChanged=!0,this._layers[g]=v,this._removedLayers[g]&&v.source&&v.type!=="custom"){const L=this._removedLayers[g];delete this._removedLayers[g],L.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,f){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new u.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===f)return;const d=this._order.indexOf(s);this._order.splice(d,1);const g=f?this._order.indexOf(f):this._order.length;f&&g===-1?this.fire(new u.j(new Error(`Cannot move layer "${s}" before non-existing layer "${f}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const f=this._layers[s];if(!f)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${s}".`)));f.setEventedParent(null);const d=this._order.indexOf(s);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=f,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],f.onRemove&&f.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,f,d){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===f&&g.maxzoom===d||(f!=null&&(g.minzoom=f),d!=null&&(g.maxzoom=d),this._updateLayer(g)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,f,d={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!u.aD(g.filter,f))return f==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(u.x.filter,`layers.${g.id}.filter`,f,null,d)||(g.filter=u.aA(f),this._updateLayer(g)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return u.aA(this.getLayer(s).filter)}setLayoutProperty(s,f,d,g={}){this._checkLoaded();const v=this.getLayer(s);v?u.aD(v.getLayoutProperty(f),d)||(v.setLayoutProperty(f,d,g),this._updateLayer(v)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,f){const d=this.getLayer(s);if(d)return d.getLayoutProperty(f);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,f,d,g={}){this._checkLoaded();const v=this.getLayer(s);v?u.aD(v.getPaintProperty(f),d)||(v.setPaintProperty(f,d,g)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new u.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,f){return this.getLayer(s).getPaintProperty(f)}setFeatureState(s,f){this._checkLoaded();const d=s.source,g=s.sourceLayer,v=this.sourceCaches[d];if(v===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const C=v.getSource().type;C==="geojson"&&g?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||g?(s.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(g,s.id,f)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,f){this._checkLoaded();const d=s.source,g=this.sourceCaches[d];if(g===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const v=g.getSource().type,C=v==="vector"?s.sourceLayer:void 0;v!=="vector"||C?f&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(C,s.id,f):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const f=s.source,d=s.sourceLayer,g=this.sourceCaches[f];if(g!==void 0)return g.getSource().type!=="vector"||d?(s.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(d,s.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=u.aE(this.sourceCaches,v=>v.serialize()),f=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,g=this.stylesheet;return u.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:f,terrain:d},v=>v!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const f=C=>this._layers[C].type==="fill-extrusion",d={},g=[];for(let C=this._order.length-1;C>=0;C--){const L=this._order[C];if(f(L)){d[L]=C;for(const P of s){const N=P[L];if(N)for(const O of N)g.push(O)}}}g.sort((C,L)=>L.intersectionZ-C.intersectionZ);const v=[];for(let C=this._order.length-1;C>=0;C--){const L=this._order[C];if(f(L))for(let P=g.length-1;P>=0;P--){const N=g[P].feature;if(d[N.layer.id]<C)break;v.push(N),g.pop()}else for(const P of s){const N=P[L];if(N)for(const O of N)v.push(O.feature)}}return v}queryRenderedFeatures(s,f,d){f&&f.filter&&this._validate(u.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const g={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const L of f.layers){const P=this._layers[L];if(!P)return this.fire(new u.j(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];g[P.source]=!0}}const v=[];f.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const L in this.sourceCaches)f.layers&&!g[L]||v.push(Ki(this.sourceCaches[L],this._layers,C,s,f,d));return this.placement&&v.push(function(L,P,N,O,V,$,it){const rt={},at=$.queryRenderedSymbols(O),et=[];for(const It of Object.keys(at).map(Number))et.push(it[It]);et.sort(Tt);for(const It of et){const Rt=It.featureIndex.lookupSymbolFeatures(at[It.bucketInstanceId],P,It.bucketIndex,It.sourceLayerIndex,V.filter,V.layers,V.availableImages,L);for(const ft in Rt){const kt=rt[ft]=rt[ft]||[],Ut=Rt[ft];Ut.sort((Ft,Kt)=>{const ee=It.featureSortOrder;if(ee){const Qt=ee.indexOf(Ft.featureIndex);return ee.indexOf(Kt.featureIndex)-Qt}return Kt.featureIndex-Ft.featureIndex});for(const Ft of Ut)kt.push(Ft)}}for(const It in rt)rt[It].forEach(Rt=>{const ft=Rt.feature,kt=N[L[It].source].getFeatureState(ft.layer["source-layer"],ft.id);ft.source=ft.layer.source,ft.layer["source-layer"]&&(ft.sourceLayer=ft.layer["source-layer"]),ft.state=kt});return rt}(this._layers,C,this.sourceCaches,s,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,f){f&&f.filter&&this._validate(u.x.filter,"querySourceFeatures.filter",f.filter,null,f);const d=this.sourceCaches[s];return d?function(g,v){const C=g.getRenderableIds().map(N=>g.getTileByID(N)),L=[],P={};for(let N=0;N<C.length;N++){const O=C[N],V=O.tileID.canonical.key;P[V]||(P[V]=!0,O.querySourceFeatures(L,v))}return L}(d,f):[]}getLight(){return this.light.getLight()}setLight(s,f={}){this._checkLoaded();const d=this.light.getLight();let g=!1;for(const C in s)if(!u.aD(s[C],d[C])){g=!0;break}if(!g)return;const v={now:E.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,f),this.light.updateTransitions(v)}_validate(s,f,d,g,v={}){return(!v||v.validate!==!1)&&xi(this,s.call(u.x,u.e({key:f,style:this.serialize(),value:d,styleSpec:u.v},g)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),se().off("pluginStateChange",this._rtlTextPluginStateChange);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const d=this.sourceCaches[f];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const f in this.sourceCaches)this.sourceCaches[f].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,f,d,g,v=!1){let C=!1,L=!1;const P={};for(const N of this._order){const O=this._layers[N];if(O.type!=="symbol")continue;if(!P[O.source]){const $=this.sourceCaches[O.source];P[O.source]=$.getRenderableIds(!0).map(it=>$.getTileByID(it)).sort((it,rt)=>rt.tileID.overscaledZ-it.tileID.overscaledZ||(it.tileID.isLessThan(rt.tileID)?-1:1))}const V=this.crossTileSymbolIndex.addLayer(O,P[O.source],s.center.lng);C=C||V}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(E.now(),s.zoom))&&(this.pauseablePlacement=new rs(s,this.map.terrain,this._order,v,f,d,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(E.now()),L=!0),C&&this.pauseablePlacement.placement.setStale()),L||C)for(const N of this._order){const O=this._layers[N];O.type==="symbol"&&this.placement.updateLayerOpacities(O,P[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(E.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,f){return u._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[f.source];return g&&g.setDependencies(f.tileID.key,f.type,f.icons),d})}getGlyphs(s,f){return u._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(f.stacks),g=this.sourceCaches[f.source];return g&&g.setDependencies(f.tileID.key,f.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,f={}){this._checkLoaded(),s&&this._validate(u.x.glyphs,"glyphs",s,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,f,d={},g){this._checkLoaded();const v=[{id:s,url:f}],C=[...wt(this.stylesheet.sprite),...v];this._validate(u.x.sprite,"sprite",C,null,d)||(this.stylesheet.sprite=C,this._loadSprite(v,!0,g))}removeSprite(s){this._checkLoaded();const f=wt(this.stylesheet.sprite);if(f.find(d=>d.id===s)){if(this._spritesImagesIds[s])for(const d of this._spritesImagesIds[s])this.imageManager.removeImage(d),this._changedImages[d]=!0;f.splice(f.findIndex(d=>d.id===s),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return wt(this.stylesheet.sprite)}setSprite(s,f={},d){this._checkLoaded(),s&&this._validate(u.x.sprite,"sprite",s,null,f)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,d):(this._unloadSprite(),d&&d(null)))}}var Vc=u.X([{name:"a_pos",type:"Int16",components:2}]),js="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const qu={prelude:Zn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Zn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Zn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Zn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Zn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Zn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Zn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Zn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Zn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Zn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Zn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Zn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Zn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Zn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Zn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Zn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Zn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Zn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Zn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Zn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Zn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Zn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Zn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Zn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Zn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",js),terrainDepth:Zn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",js),terrainCoords:Zn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",js)};function Zn(y,s){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=s.match(/attribute ([\w]+) ([\w]+)/g),g=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=v?v.concat(g):g,L={};return{fragmentSource:y=y.replace(f,(P,N,O,V,$)=>(L[$]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${$}
varying ${O} ${V} ${$};
#else
uniform ${O} ${V} u_${$};
#endif
`:`
#ifdef HAS_UNIFORM_u_${$}
    ${O} ${V} ${$} = u_${$};
#endif
`)),vertexSource:s=s.replace(f,(P,N,O,V,$)=>{const it=V==="float"?"vec2":"vec4",rt=$.match(/color/)?"color":it;return L[$]?N==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${O} ${it} a_${$};
varying ${O} ${V} ${$};
#else
uniform ${O} ${V} u_${$};
#endif
`:rt==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${O} ${V} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${rt}(a_${$}, u_${$}_t);
#else
    ${O} ${V} ${$} = u_${$};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
attribute ${O} ${it} a_${$};
#else
uniform ${O} ${V} u_${$};
#endif
`:rt==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${O} ${V} ${$} = a_${$};
#else
    ${O} ${V} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${O} ${V} ${$} = unpack_mix_${rt}(a_${$}, u_${$}_t);
#else
    ${O} ${V} ${$} = u_${$};
#endif
`}),staticAttributes:d,staticUniforms:C}}class Uc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,f,d,g,v,C,L,P,N){this.context=s;let O=this.boundPaintVertexBuffers.length!==g.length;for(let V=0;!O&&V<g.length;V++)this.boundPaintVertexBuffers[V]!==g[V]&&(O=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==d||O||this.boundIndexBuffer!==v||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==L||this.boundDynamicVertexBuffer2!==P||this.boundDynamicVertexBuffer3!==N?this.freshBind(f,d,g,v,C,L,P,N):(s.bindVertexArray.set(this.vao),L&&L.bind(),v&&v.dynamicDraw&&v.bind(),P&&P.bind(),N&&N.bind())}freshBind(s,f,d,g,v,C,L,P){const N=s.numAttributes,O=this.context,V=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=L,this.boundDynamicVertexBuffer3=P,f.enableAttributes(V,s);for(const $ of d)$.enableAttributes(V,s);C&&C.enableAttributes(V,s),L&&L.enableAttributes(V,s),P&&P.enableAttributes(V,s),f.bind(),f.setVertexAttribPointers(V,s,v);for(const $ of d)$.bind(),$.setVertexAttribPointers(V,s,v);C&&(C.bind(),C.setVertexAttribPointers(V,s,v)),g&&g.bind(),L&&(L.bind(),L.setVertexAttribPointers(V,s,v)),P&&(P.bind(),P.setVertexAttribPointers(V,s,v)),O.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function nu(y){const s=[];for(let f=0;f<y.length;f++){if(y[f]===null)continue;const d=y[f].split(" ");s.push(d.pop())}return s}class qa{constructor(s,f,d,g,v,C){const L=s.gl;this.program=L.createProgram();const P=nu(f.staticAttributes),N=d?d.getBinderAttributes():[],O=P.concat(N),V=qu.prelude.staticUniforms?nu(qu.prelude.staticUniforms):[],$=f.staticUniforms?nu(f.staticUniforms):[],it=d?d.getBinderUniforms():[],rt=V.concat($).concat(it),at=[];for(const Ft of rt)at.indexOf(Ft)<0&&at.push(Ft);const et=d?d.defines():[];v&&et.push("#define OVERDRAW_INSPECTOR;"),C&&et.push("#define TERRAIN3D;");const It=et.concat(qu.prelude.fragmentSource,f.fragmentSource).join(`
`),Rt=et.concat(qu.prelude.vertexSource,f.vertexSource).join(`
`),ft=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(ft,It),L.compileShader(ft),!L.getShaderParameter(ft,L.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${L.getShaderInfoLog(ft)}`);L.attachShader(this.program,ft);const kt=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);if(L.shaderSource(kt,Rt),L.compileShader(kt),!L.getShaderParameter(kt,L.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${L.getShaderInfoLog(kt)}`);L.attachShader(this.program,kt),this.attributes={};const Ut={};this.numAttributes=O.length;for(let Ft=0;Ft<this.numAttributes;Ft++)O[Ft]&&(L.bindAttribLocation(this.program,Ft,O[Ft]),this.attributes[O[Ft]]=Ft);if(L.linkProgram(this.program),!L.getProgramParameter(this.program,L.LINK_STATUS))throw new Error(`Program failed to link: ${L.getProgramInfoLog(this.program)}`);L.deleteShader(kt),L.deleteShader(ft);for(let Ft=0;Ft<at.length;Ft++){const Kt=at[Ft];if(Kt&&!Ut[Kt]){const ee=L.getUniformLocation(this.program,Kt);ee&&(Ut[Kt]=ee)}}this.fixedUniforms=g(s,Ut),this.terrainUniforms=((Ft,Kt)=>({u_depth:new u.aG(Ft,Kt.u_depth),u_terrain:new u.aG(Ft,Kt.u_terrain),u_terrain_dim:new u.aH(Ft,Kt.u_terrain_dim),u_terrain_matrix:new u.aI(Ft,Kt.u_terrain_matrix),u_terrain_unpack:new u.aJ(Ft,Kt.u_terrain_unpack),u_terrain_exaggeration:new u.aH(Ft,Kt.u_terrain_exaggeration)}))(s,Ut),this.binderUniforms=d?d.getUniforms(s,Ut):[]}draw(s,f,d,g,v,C,L,P,N,O,V,$,it,rt,at,et,It,Rt){const ft=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(d),s.setStencilMode(g),s.setColorMode(v),s.setCullFace(C),P){s.activeTexture.set(ft.TEXTURE2),ft.bindTexture(ft.TEXTURE_2D,P.depthTexture),s.activeTexture.set(ft.TEXTURE3),ft.bindTexture(ft.TEXTURE_2D,P.texture);for(const Ut in this.terrainUniforms)this.terrainUniforms[Ut].set(P[Ut])}for(const Ut in this.fixedUniforms)this.fixedUniforms[Ut].set(L[Ut]);at&&at.setUniforms(s,this.binderUniforms,it,{zoom:rt});let kt=0;switch(f){case ft.LINES:kt=2;break;case ft.TRIANGLES:kt=3;break;case ft.LINE_STRIP:kt=1}for(const Ut of $.get()){const Ft=Ut.vaos||(Ut.vaos={});(Ft[N]||(Ft[N]=new Uc)).bind(s,this,O,at?at.getPaintVertexBuffers():[],V,Ut.vertexOffset,et,It,Rt),ft.drawElements(f,Ut.primitiveLength*kt,ft.UNSIGNED_SHORT,Ut.primitiveOffset*kt*2)}}}function Gc(y,s,f){const d=1/Qe(f,1,s.transform.tileZoom),g=Math.pow(2,f.tileID.overscaledZ),v=f.tileSize*Math.pow(2,s.transform.tileZoom)/g,C=v*(f.tileID.canonical.x+f.tileID.wrap*g),L=v*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[C>>16,L>>16],u_pixel_coord_lower:[65535&C,65535&L]}}const Zu=(y,s,f,d)=>{const g=s.style.light,v=g.properties.get("position"),C=[v.x,v.y,v.z],L=function(){var N=new u.A(9);return u.A!=Float32Array&&(N[1]=0,N[2]=0,N[3]=0,N[5]=0,N[6]=0,N[7]=0),N[0]=1,N[4]=1,N[8]=1,N}();g.properties.get("anchor")==="viewport"&&function(N,O){var V=Math.sin(O),$=Math.cos(O);N[0]=$,N[1]=V,N[2]=0,N[3]=-V,N[4]=$,N[5]=0,N[6]=0,N[7]=0,N[8]=1}(L,-s.transform.angle),function(N,O,V){var $=O[0],it=O[1],rt=O[2];N[0]=$*V[0]+it*V[3]+rt*V[6],N[1]=$*V[1]+it*V[4]+rt*V[7],N[2]=$*V[2]+it*V[5]+rt*V[8]}(C,C,L);const P=g.properties.get("color");return{u_matrix:y,u_lightpos:C,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+f,u_opacity:d}},qg=(y,s,f,d,g,v,C)=>u.e(Zu(y,s,f,d),Gc(v,s,C),{u_height_factor:-Math.pow(2,g.overscaledZ)/C.tileSize/8}),Ed=y=>({u_matrix:y}),jc=(y,s,f,d)=>u.e(Ed(y),Gc(f,s,d)),Zg=(y,s)=>({u_matrix:y,u_world:s}),Cd=(y,s,f,d,g)=>u.e(jc(y,s,f,d),{u_world:g}),Wg=(y,s,f,d)=>{const g=y.transform;let v,C;if(d.paint.get("circle-pitch-alignment")==="map"){const L=Qe(f,1,g.zoom);v=!0,C=[L,L]}else v=!1,C=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(s.posMatrix,f,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:C}},Td=(y,s,f)=>{const d=Qe(f,1,s.zoom),g=Math.pow(2,s.zoom-f.tileID.overscaledZ),v=f.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[s.pixelsToGLUnits[0]/(d*g),s.pixelsToGLUnits[1]/(d*g)],u_overscale_factor:v}},Ld=(y,s,f=1)=>({u_matrix:y,u_color:s,u_overlay:0,u_overlay_scale:f}),qc=y=>({u_matrix:y}),Md=(y,s,f,d)=>({u_matrix:y,u_extrude_scale:Qe(s,1,f),u_intensity:d});function Pd(y,s){const f=Math.pow(2,s.canonical.z),d=s.canonical.y;return[new u.Y(0,d/f).toLngLat().lat,new u.Y(0,(d+1)/f).toLngLat().lat]}const Zc=(y,s,f,d)=>{const g=y.transform;return{u_matrix:Wu(y,s,f,d),u_ratio:1/Qe(s,1,g.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},kd=(y,s,f,d,g)=>u.e(Zc(y,s,f,g),{u_image:0,u_image_height:d}),vl=(y,s,f,d,g)=>{const v=y.transform,C=Vo(s,v);return{u_matrix:Wu(y,s,f,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Qe(s,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[C,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Wc=(y,s,f,d,g,v)=>{const C=y.lineAtlas,L=Vo(s,y.transform),P=f.layout.get("line-cap")==="round",N=C.getDash(d.from,P),O=C.getDash(d.to,P),V=N.width*g.fromScale,$=O.width*g.toScale;return u.e(Zc(y,s,f,v),{u_patternscale_a:[L/V,-N.height/2],u_patternscale_b:[L/$,-O.height/2],u_sdfgamma:C.width/(256*Math.min(V,$)*y.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:O.y,u_mix:g.t})};function Vo(y,s){return 1/Qe(y,1,s.tileZoom)}function Wu(y,s,f,d){return y.translatePosMatrix(d?d.posMatrix:s.tileID.posMatrix,s,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Hc=(y,s,f,d,g)=>{return{u_matrix:y,u_tl_parent:s,u_scale_parent:f,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(C=g.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(v=g.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Hu(g.paint.get("raster-hue-rotate"))};var v,C};function Hu(y){y*=Math.PI/180;const s=Math.sin(y),f=Math.cos(y);return[(2*f+1)/3,(-Math.sqrt(3)*s-f+1)/3,(Math.sqrt(3)*s-f+1)/3]}const $u=(y,s,f,d,g,v,C,L,P,N)=>{const O=g.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:O.width/O.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:C,u_coord_matrix:L,u_is_text:+P,u_pitch_with_map:+d,u_texsize:N,u_texture:0}},Xu=(y,s,f,d,g,v,C,L,P,N,O)=>{const V=g.transform;return u.e($u(y,s,f,d,g,v,C,L,P,N),{u_gamma_scale:d?Math.cos(V._pitch)*V.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+O})},Yu=(y,s,f,d,g,v,C,L,P,N)=>u.e(Xu(y,s,f,d,g,v,C,L,!0,P,!0),{u_texsize_icon:N,u_texture_icon:1}),Hg=(y,s,f)=>({u_matrix:y,u_opacity:s,u_color:f}),$g=(y,s,f,d,g,v)=>u.e(function(C,L,P,N){const O=P.imageManager.getPattern(C.from.toString()),V=P.imageManager.getPattern(C.to.toString()),{width:$,height:it}=P.imageManager.getPixelSize(),rt=Math.pow(2,N.tileID.overscaledZ),at=N.tileSize*Math.pow(2,P.transform.tileZoom)/rt,et=at*(N.tileID.canonical.x+N.tileID.wrap*rt),It=at*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[$,it],u_mix:L.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Qe(N,1,P.transform.tileZoom),u_pixel_coord_upper:[et>>16,It>>16],u_pixel_coord_lower:[65535&et,65535&It]}}(d,v,f,g),{u_matrix:y,u_opacity:s}),Ad={fillExtrusion:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_lightpos:new u.aK(y,s.u_lightpos),u_lightintensity:new u.aH(y,s.u_lightintensity),u_lightcolor:new u.aK(y,s.u_lightcolor),u_vertical_gradient:new u.aH(y,s.u_vertical_gradient),u_opacity:new u.aH(y,s.u_opacity)}),fillExtrusionPattern:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_lightpos:new u.aK(y,s.u_lightpos),u_lightintensity:new u.aH(y,s.u_lightintensity),u_lightcolor:new u.aK(y,s.u_lightcolor),u_vertical_gradient:new u.aH(y,s.u_vertical_gradient),u_height_factor:new u.aH(y,s.u_height_factor),u_image:new u.aG(y,s.u_image),u_texsize:new u.aL(y,s.u_texsize),u_pixel_coord_upper:new u.aL(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,s.u_pixel_coord_lower),u_scale:new u.aK(y,s.u_scale),u_fade:new u.aH(y,s.u_fade),u_opacity:new u.aH(y,s.u_opacity)}),fill:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix)}),fillPattern:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_image:new u.aG(y,s.u_image),u_texsize:new u.aL(y,s.u_texsize),u_pixel_coord_upper:new u.aL(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,s.u_pixel_coord_lower),u_scale:new u.aK(y,s.u_scale),u_fade:new u.aH(y,s.u_fade)}),fillOutline:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_world:new u.aL(y,s.u_world)}),fillOutlinePattern:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_world:new u.aL(y,s.u_world),u_image:new u.aG(y,s.u_image),u_texsize:new u.aL(y,s.u_texsize),u_pixel_coord_upper:new u.aL(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,s.u_pixel_coord_lower),u_scale:new u.aK(y,s.u_scale),u_fade:new u.aH(y,s.u_fade)}),circle:(y,s)=>({u_camera_to_center_distance:new u.aH(y,s.u_camera_to_center_distance),u_scale_with_map:new u.aG(y,s.u_scale_with_map),u_pitch_with_map:new u.aG(y,s.u_pitch_with_map),u_extrude_scale:new u.aL(y,s.u_extrude_scale),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_matrix:new u.aI(y,s.u_matrix)}),collisionBox:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_camera_to_center_distance:new u.aH(y,s.u_camera_to_center_distance),u_pixels_to_tile_units:new u.aH(y,s.u_pixels_to_tile_units),u_extrude_scale:new u.aL(y,s.u_extrude_scale),u_overscale_factor:new u.aH(y,s.u_overscale_factor)}),collisionCircle:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_inv_matrix:new u.aI(y,s.u_inv_matrix),u_camera_to_center_distance:new u.aH(y,s.u_camera_to_center_distance),u_viewport_size:new u.aL(y,s.u_viewport_size)}),debug:(y,s)=>({u_color:new u.aM(y,s.u_color),u_matrix:new u.aI(y,s.u_matrix),u_overlay:new u.aG(y,s.u_overlay),u_overlay_scale:new u.aH(y,s.u_overlay_scale)}),clippingMask:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix)}),heatmap:(y,s)=>({u_extrude_scale:new u.aH(y,s.u_extrude_scale),u_intensity:new u.aH(y,s.u_intensity),u_matrix:new u.aI(y,s.u_matrix)}),heatmapTexture:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_world:new u.aL(y,s.u_world),u_image:new u.aG(y,s.u_image),u_color_ramp:new u.aG(y,s.u_color_ramp),u_opacity:new u.aH(y,s.u_opacity)}),hillshade:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_image:new u.aG(y,s.u_image),u_latrange:new u.aL(y,s.u_latrange),u_light:new u.aL(y,s.u_light),u_shadow:new u.aM(y,s.u_shadow),u_highlight:new u.aM(y,s.u_highlight),u_accent:new u.aM(y,s.u_accent)}),hillshadePrepare:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_image:new u.aG(y,s.u_image),u_dimension:new u.aL(y,s.u_dimension),u_zoom:new u.aH(y,s.u_zoom),u_unpack:new u.aJ(y,s.u_unpack)}),line:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_ratio:new u.aH(y,s.u_ratio),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_units_to_pixels:new u.aL(y,s.u_units_to_pixels)}),lineGradient:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_ratio:new u.aH(y,s.u_ratio),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_units_to_pixels:new u.aL(y,s.u_units_to_pixels),u_image:new u.aG(y,s.u_image),u_image_height:new u.aH(y,s.u_image_height)}),linePattern:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_texsize:new u.aL(y,s.u_texsize),u_ratio:new u.aH(y,s.u_ratio),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_image:new u.aG(y,s.u_image),u_units_to_pixels:new u.aL(y,s.u_units_to_pixels),u_scale:new u.aK(y,s.u_scale),u_fade:new u.aH(y,s.u_fade)}),lineSDF:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_ratio:new u.aH(y,s.u_ratio),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_units_to_pixels:new u.aL(y,s.u_units_to_pixels),u_patternscale_a:new u.aL(y,s.u_patternscale_a),u_patternscale_b:new u.aL(y,s.u_patternscale_b),u_sdfgamma:new u.aH(y,s.u_sdfgamma),u_image:new u.aG(y,s.u_image),u_tex_y_a:new u.aH(y,s.u_tex_y_a),u_tex_y_b:new u.aH(y,s.u_tex_y_b),u_mix:new u.aH(y,s.u_mix)}),raster:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_tl_parent:new u.aL(y,s.u_tl_parent),u_scale_parent:new u.aH(y,s.u_scale_parent),u_buffer_scale:new u.aH(y,s.u_buffer_scale),u_fade_t:new u.aH(y,s.u_fade_t),u_opacity:new u.aH(y,s.u_opacity),u_image0:new u.aG(y,s.u_image0),u_image1:new u.aG(y,s.u_image1),u_brightness_low:new u.aH(y,s.u_brightness_low),u_brightness_high:new u.aH(y,s.u_brightness_high),u_saturation_factor:new u.aH(y,s.u_saturation_factor),u_contrast_factor:new u.aH(y,s.u_contrast_factor),u_spin_weights:new u.aK(y,s.u_spin_weights)}),symbolIcon:(y,s)=>({u_is_size_zoom_constant:new u.aG(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(y,s.u_is_size_feature_constant),u_size_t:new u.aH(y,s.u_size_t),u_size:new u.aH(y,s.u_size),u_camera_to_center_distance:new u.aH(y,s.u_camera_to_center_distance),u_pitch:new u.aH(y,s.u_pitch),u_rotate_symbol:new u.aG(y,s.u_rotate_symbol),u_aspect_ratio:new u.aH(y,s.u_aspect_ratio),u_fade_change:new u.aH(y,s.u_fade_change),u_matrix:new u.aI(y,s.u_matrix),u_label_plane_matrix:new u.aI(y,s.u_label_plane_matrix),u_coord_matrix:new u.aI(y,s.u_coord_matrix),u_is_text:new u.aG(y,s.u_is_text),u_pitch_with_map:new u.aG(y,s.u_pitch_with_map),u_texsize:new u.aL(y,s.u_texsize),u_texture:new u.aG(y,s.u_texture)}),symbolSDF:(y,s)=>({u_is_size_zoom_constant:new u.aG(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(y,s.u_is_size_feature_constant),u_size_t:new u.aH(y,s.u_size_t),u_size:new u.aH(y,s.u_size),u_camera_to_center_distance:new u.aH(y,s.u_camera_to_center_distance),u_pitch:new u.aH(y,s.u_pitch),u_rotate_symbol:new u.aG(y,s.u_rotate_symbol),u_aspect_ratio:new u.aH(y,s.u_aspect_ratio),u_fade_change:new u.aH(y,s.u_fade_change),u_matrix:new u.aI(y,s.u_matrix),u_label_plane_matrix:new u.aI(y,s.u_label_plane_matrix),u_coord_matrix:new u.aI(y,s.u_coord_matrix),u_is_text:new u.aG(y,s.u_is_text),u_pitch_with_map:new u.aG(y,s.u_pitch_with_map),u_texsize:new u.aL(y,s.u_texsize),u_texture:new u.aG(y,s.u_texture),u_gamma_scale:new u.aH(y,s.u_gamma_scale),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_is_halo:new u.aG(y,s.u_is_halo)}),symbolTextAndIcon:(y,s)=>({u_is_size_zoom_constant:new u.aG(y,s.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(y,s.u_is_size_feature_constant),u_size_t:new u.aH(y,s.u_size_t),u_size:new u.aH(y,s.u_size),u_camera_to_center_distance:new u.aH(y,s.u_camera_to_center_distance),u_pitch:new u.aH(y,s.u_pitch),u_rotate_symbol:new u.aG(y,s.u_rotate_symbol),u_aspect_ratio:new u.aH(y,s.u_aspect_ratio),u_fade_change:new u.aH(y,s.u_fade_change),u_matrix:new u.aI(y,s.u_matrix),u_label_plane_matrix:new u.aI(y,s.u_label_plane_matrix),u_coord_matrix:new u.aI(y,s.u_coord_matrix),u_is_text:new u.aG(y,s.u_is_text),u_pitch_with_map:new u.aG(y,s.u_pitch_with_map),u_texsize:new u.aL(y,s.u_texsize),u_texsize_icon:new u.aL(y,s.u_texsize_icon),u_texture:new u.aG(y,s.u_texture),u_texture_icon:new u.aG(y,s.u_texture_icon),u_gamma_scale:new u.aH(y,s.u_gamma_scale),u_device_pixel_ratio:new u.aH(y,s.u_device_pixel_ratio),u_is_halo:new u.aG(y,s.u_is_halo)}),background:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_opacity:new u.aH(y,s.u_opacity),u_color:new u.aM(y,s.u_color)}),backgroundPattern:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_opacity:new u.aH(y,s.u_opacity),u_image:new u.aG(y,s.u_image),u_pattern_tl_a:new u.aL(y,s.u_pattern_tl_a),u_pattern_br_a:new u.aL(y,s.u_pattern_br_a),u_pattern_tl_b:new u.aL(y,s.u_pattern_tl_b),u_pattern_br_b:new u.aL(y,s.u_pattern_br_b),u_texsize:new u.aL(y,s.u_texsize),u_mix:new u.aH(y,s.u_mix),u_pattern_size_a:new u.aL(y,s.u_pattern_size_a),u_pattern_size_b:new u.aL(y,s.u_pattern_size_b),u_scale_a:new u.aH(y,s.u_scale_a),u_scale_b:new u.aH(y,s.u_scale_b),u_pixel_coord_upper:new u.aL(y,s.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,s.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aH(y,s.u_tile_units_to_pixels)}),terrain:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_texture:new u.aG(y,s.u_texture),u_ele_delta:new u.aH(y,s.u_ele_delta)}),terrainDepth:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_ele_delta:new u.aH(y,s.u_ele_delta)}),terrainCoords:(y,s)=>({u_matrix:new u.aI(y,s.u_matrix),u_texture:new u.aG(y,s.u_texture),u_terrain_coords_id:new u.aH(y,s.u_terrain_coords_id),u_ele_delta:new u.aH(y,s.u_ele_delta)})};class Xg{constructor(s,f,d){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const bl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $c{constructor(s,f,d,g){this.length=f.length,this.attributes=d,this.itemSize=f.bytesPerElement,this.dynamicDraw=g,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,f){for(let d=0;d<this.attributes.length;d++){const g=f.attributes[this.attributes[d].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,f,d){for(let g=0;g<this.attributes.length;g++){const v=this.attributes[g],C=f.attributes[v.name];C!==void 0&&s.vertexAttribPointer(C,v.components,s[bl[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ao=new WeakMap;function jr(y){var s;if(ao.has(y))return ao.get(y);{const f=(s=y.getParameter(y.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return ao.set(y,f),f}}class On{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xc extends On{getDefault(){return u.aO.transparent}set(s){const f=this.current;(s.r!==f.r||s.g!==f.g||s.b!==f.b||s.a!==f.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Yc extends On{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ef extends On{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Cf extends On{getDefault(){return[!0,!0,!0,!0]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||s[3]!==f[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Kc extends On{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Tf extends On{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Lf extends On{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const f=this.current;(s.func!==f.func||s.ref!==f.ref||s.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Jc extends On{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Dd extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=s,this.dirty=!1}}class Nd extends On{getDefault(){return[0,1]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class iu extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=s,this.dirty=!1}}class Yg extends On{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Kg extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.BLEND):f.disable(f.BLEND),this.current=s,this.dirty=!1}}class Jg extends On{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Qg extends On{getDefault(){return u.aO.transparent}set(s){const f=this.current;(s.r!==f.r||s.g!==f.g||s.b!==f.b||s.a!==f.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class t_ extends On{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class e_ extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;s?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=s,this.dirty=!1}}class Mf extends On{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Qc extends On{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Pf extends On{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class kf extends On{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ru extends On{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const f=this.current;(s[0]!==f[0]||s[1]!==f[1]||s[2]!==f[2]||s[3]!==f[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Rd extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class zd extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Af extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class xl extends On{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Od extends On{getDefault(){return null}set(s){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ou extends On{getDefault(){return null}set(s){var f;if(s===this.current&&!this.dirty)return;const d=this.gl;jr(d)?d.bindVertexArray(s):(f=d.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class su extends On{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Fd extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Df extends On{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class kn extends On{constructor(s,f){super(s),this.context=s,this.parent=f}getDefault(){return null}}class th extends kn{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class n_ extends kn{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Bd extends kn{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ku{constructor(s,f,d,g,v){this.context=s,this.width=f,this.height=d;const C=s.gl,L=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new th(s,L),g)this.depthAttachment=v?new Bd(s,L):new n_(s,L);else if(v)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,f=this.colorAttachment.get();if(f&&s.deleteTexture(f),this.depthAttachment){const d=this.depthAttachment.get();d&&s.deleteRenderbuffer(d)}s.deleteFramebuffer(this.framebuffer)}}class Ui{constructor(s,f,d){this.blendFunction=s,this.blendColor=f,this.mask=d}}Ui.Replace=[1,0],Ui.disabled=new Ui(Ui.Replace,u.aO.transparent,[!1,!1,!1,!1]),Ui.unblended=new Ui(Ui.Replace,u.aO.transparent,[!0,!0,!0,!0]),Ui.alphaBlended=new Ui([1,771],u.aO.transparent,[!0,!0,!0,!0]);class i_{constructor(s){var f,d;if(this.gl=s,this.clearColor=new Xc(this),this.clearDepth=new Yc(this),this.clearStencil=new Ef(this),this.colorMask=new Cf(this),this.depthMask=new Kc(this),this.stencilMask=new Tf(this),this.stencilFunc=new Lf(this),this.stencilOp=new Jc(this),this.stencilTest=new Dd(this),this.depthRange=new Nd(this),this.depthTest=new iu(this),this.depthFunc=new Yg(this),this.blend=new Kg(this),this.blendFunc=new Jg(this),this.blendColor=new Qg(this),this.blendEquation=new t_(this),this.cullFace=new e_(this),this.cullFaceSide=new Mf(this),this.frontFace=new Qc(this),this.program=new Pf(this),this.activeTexture=new kf(this),this.viewport=new ru(this),this.bindFramebuffer=new Rd(this),this.bindRenderbuffer=new zd(this),this.bindTexture=new Af(this),this.bindVertexBuffer=new xl(this),this.bindElementBuffer=new Od(this),this.bindVertexArray=new ou(this),this.pixelStoreUnpack=new su(this),this.pixelStoreUnpackPremultiplyAlpha=new Fd(this),this.pixelStoreUnpackFlipY=new Df(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),jr(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=s.RGBA16F)!==null&&f!==void 0?f:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(d=s.RGB16F)!==null&&d!==void 0?d:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,f){return new Xg(this,s,f)}createVertexBuffer(s,f,d){return new $c(this,s,f,d)}createRenderbuffer(s,f,d){const g=this.gl,v=g.createRenderbuffer();return this.bindRenderbuffer.set(v),g.renderbufferStorage(g.RENDERBUFFER,s,f,d),this.bindRenderbuffer.set(null),v}createFramebuffer(s,f,d,g){return new Ku(this,s,f,d,g)}clear({color:s,depth:f,stencil:d}){const g=this.gl;let v=0;s&&(v|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(v|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),d!==void 0&&(v|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),g.clear(v)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){u.aD(s.blendFunction,Ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return jr(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var f;return jr(this.gl)?this.gl.deleteVertexArray(s):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class Ln{constructor(s,f,d){this.func=s,this.mask=f,this.range=d}}Ln.ReadOnly=!1,Ln.ReadWrite=!0,Ln.disabled=new Ln(519,Ln.ReadOnly,[0,1]);const Nf=7680;class ui{constructor(s,f,d,g,v,C){this.test=s,this.ref=f,this.mask=d,this.fail=g,this.depthFail=v,this.pass=C}}ui.disabled=new ui({func:519,mask:0},0,0,Nf,Nf,Nf);class ni{constructor(s,f,d){this.enable=s,this.mode=f,this.frontFace=d}}let wl;function eh(y,s,f,d,g,v,C){const L=y.context,P=L.gl,N=y.useProgram("collisionBox"),O=[];let V=0,$=0;for(let ft=0;ft<d.length;ft++){const kt=d[ft],Ut=s.getTile(kt),Ft=Ut.getBucket(f);if(!Ft)continue;let Kt=kt.posMatrix;g[0]===0&&g[1]===0||(Kt=y.translatePosMatrix(kt.posMatrix,Ut,g,v));const ee=C?Ft.textCollisionBox:Ft.iconCollisionBox,Qt=Ft.collisionCircleArray;if(Qt.length>0){const ae=u.F(),Se=Kt;u.aP(ae,Ft.placementInvProjMatrix,y.transform.glCoordMatrix),u.aP(ae,ae,Ft.placementViewportMatrix),O.push({circleArray:Qt,circleOffset:$,transform:Se,invTransform:ae,coord:kt}),V+=Qt.length/4,$=V}ee&&N.draw(L,P.LINES,Ln.disabled,ui.disabled,y.colorModeForRenderPass(),ni.disabled,Td(Kt,y.transform,Ut),y.style.map.terrain&&y.style.map.terrain.getTerrainData(kt),f.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,null,y.transform.zoom,null,null,ee.collisionVertexBuffer)}if(!C||!O.length)return;const it=y.useProgram("collisionCircle"),rt=new u.aQ;rt.resize(4*V),rt._trim();let at=0;for(const ft of O)for(let kt=0;kt<ft.circleArray.length/4;kt++){const Ut=4*kt,Ft=ft.circleArray[Ut+0],Kt=ft.circleArray[Ut+1],ee=ft.circleArray[Ut+2],Qt=ft.circleArray[Ut+3];rt.emplace(at++,Ft,Kt,ee,Qt,0),rt.emplace(at++,Ft,Kt,ee,Qt,1),rt.emplace(at++,Ft,Kt,ee,Qt,2),rt.emplace(at++,Ft,Kt,ee,Qt,3)}(!wl||wl.length<2*V)&&(wl=function(ft){const kt=2*ft,Ut=new u.aS;Ut.resize(kt),Ut._trim();for(let Ft=0;Ft<kt;Ft++){const Kt=6*Ft;Ut.uint16[Kt+0]=4*Ft+0,Ut.uint16[Kt+1]=4*Ft+1,Ut.uint16[Kt+2]=4*Ft+2,Ut.uint16[Kt+3]=4*Ft+2,Ut.uint16[Kt+4]=4*Ft+3,Ut.uint16[Kt+5]=4*Ft+0}return Ut}(V));const et=L.createIndexBuffer(wl,!0),It=L.createVertexBuffer(rt,u.aR.members,!0);for(const ft of O){const kt={u_matrix:ft.transform,u_inv_matrix:ft.invTransform,u_camera_to_center_distance:(Rt=y.transform).cameraToCenterDistance,u_viewport_size:[Rt.width,Rt.height]};it.draw(L,P.TRIANGLES,Ln.disabled,ui.disabled,y.colorModeForRenderPass(),ni.disabled,kt,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ft.coord),f.id,It,et,u.$.simpleSegment(0,2*ft.circleOffset,ft.circleArray.length,ft.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Rt;It.destroy(),et.destroy()}ni.disabled=new ni(!1,1029,2305),ni.backCCW=new ni(!0,1029,2305);const Rf=u.an(new Float32Array(16));function Vd(y,s,f,d,g,v){const{horizontalAlign:C,verticalAlign:L}=u.at(y);return new u.P((-(C-.5)*s/g+d[0])*v,(-(L-.5)*f/g+d[1])*v)}function nh(y,s,f,d,g,v,C,L,P,N,O){const V=y.text.placedSymbolArray,$=y.text.dynamicLayoutVertexArray,it=y.icon.dynamicLayoutVertexArray,rt={};$.clear();for(let at=0;at<V.length;at++){const et=V.get(at),It=et.hidden||!et.crossTileID||y.allowVerticalPlacement&&!et.placedOrientation?null:d[et.crossTileID];if(It){const Rt=new u.P(et.anchorX,et.anchorY),ft=Vi(Rt,f?C:v,O),kt=st(g.cameraToCenterDistance,ft.signedDistanceFromCamera);let Ut=u.ai(y.textSizeData,P,et)*kt/u.ao;f&&(Ut*=y.tilePixelRatio/L);const{width:Ft,height:Kt,anchor:ee,textOffset:Qt,textBoxScale:ae}=It,Se=Vd(ee,Ft,Kt,Qt,ae,Ut),Ue=f?Vi(Rt.add(Se),v,O).point:ft.point.add(s?Se.rotate(-g.angle):Se),me=y.allowVerticalPlacement&&et.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let Ve=0;Ve<et.numGlyphs;Ve++)u.aj($,Ue,me);N&&et.associatedIconIndex>=0&&(rt[et.associatedIconIndex]={shiftedAnchor:Ue,angle:me})}else $t(et.numGlyphs,$)}if(N){it.clear();const at=y.icon.placedSymbolArray;for(let et=0;et<at.length;et++){const It=at.get(et);if(It.hidden)$t(It.numGlyphs,it);else{const Rt=rt[et];if(Rt)for(let ft=0;ft<It.numGlyphs;ft++)u.aj(it,Rt.shiftedAnchor,Rt.angle);else $t(It.numGlyphs,it)}}y.icon.dynamicLayoutVertexBuffer.updateData(it)}y.text.dynamicLayoutVertexBuffer.updateData($)}function ih(y,s,f){return f.iconsInText&&s?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function rh(y,s,f,d,g,v,C,L,P,N,O,V){const $=y.context,it=$.gl,rt=y.transform,at=L==="map",et=P==="map",It=L!=="viewport"&&f.layout.get("symbol-placement")!=="point",Rt=at&&!et&&!It,ft=!f.layout.get("symbol-sort-key").isConstant();let kt=!1;const Ut=y.depthModeForSublayer(0,Ln.ReadOnly),Ft=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Kt=[];for(const ee of d){const Qt=s.getTile(ee),ae=Qt.getBucket(f);if(!ae)continue;const Se=g?ae.text:ae.icon;if(!Se||!Se.segments.get().length||!Se.hasVisibleVertices)continue;const Ue=Se.programConfigurations.get(f.id),me=g||ae.sdfIcons,Ve=g?ae.textSizeData:ae.iconSizeData,Te=et||rt.pitch!==0,hi=y.useProgram(ih(me,g,ae),Ue),vn=u.ag(Ve,rt.zoom),fn=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ee);let bn,ji,$n,co,Sr=[0,0],Mi=null;if(g)ji=Qt.glyphAtlasTexture,$n=it.LINEAR,bn=Qt.glyphAtlasTexture.size,ae.iconsInText&&(Sr=Qt.imageAtlasTexture.size,Mi=Qt.imageAtlasTexture,co=Te||y.options.rotating||y.options.zooming||Ve.kind==="composite"||Ve.kind==="camera"?it.LINEAR:it.NEAREST);else{const fi=f.layout.get("icon-size").constantOr(0)!==1||ae.iconsNeedLinear;ji=Qt.imageAtlasTexture,$n=me||y.options.rotating||y.options.zooming||fi||Te?it.LINEAR:it.NEAREST,bn=Qt.imageAtlasTexture.size}const qr=Qe(Qt,1,y.transform.zoom),Zr=rn(ee.posMatrix,et,at,y.transform,qr),ss=_a(ee.posMatrix,et,at,y.transform,qr),$a=Ft&&ae.hasTextData(),fu=f.layout.get("icon-text-fit")!=="none"&&$a&&ae.hasIconData();if(It){const fi=y.style.map.terrain?(Ir,hr)=>y.style.map.terrain.getElevation(ee,Ir,hr):null,cr=f.layout.get("text-rotation-alignment")==="map";Z(ae,ee.posMatrix,y,g,Zr,ss,et,N,cr,fi)}const pu=y.translatePosMatrix(ee.posMatrix,Qt,v,C),Xa=It||g&&Ft||fu?Rf:Zr,ur=y.translatePosMatrix(ss,Qt,v,C,!0),qi=me&&f.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Pi;Pi=me?ae.iconsInText?Yu(Ve.kind,vn,Rt,et,y,pu,Xa,ur,bn,Sr):Xu(Ve.kind,vn,Rt,et,y,pu,Xa,ur,g,bn,!0):$u(Ve.kind,vn,Rt,et,y,pu,Xa,ur,g,bn);const ho={program:hi,buffers:Se,uniformValues:Pi,atlasTexture:ji,atlasTextureIcon:Mi,atlasInterpolation:$n,atlasInterpolationIcon:co,isSDF:me,hasHalo:qi};if(ft&&ae.canOverlap){kt=!0;const fi=Se.segments.get();for(const cr of fi)Kt.push({segments:new u.$([cr]),sortKey:cr.sortKey,state:ho,terrainData:fn})}else Kt.push({segments:Se.segments,sortKey:0,state:ho,terrainData:fn})}kt&&Kt.sort((ee,Qt)=>ee.sortKey-Qt.sortKey);for(const ee of Kt){const Qt=ee.state;if($.activeTexture.set(it.TEXTURE0),Qt.atlasTexture.bind(Qt.atlasInterpolation,it.CLAMP_TO_EDGE),Qt.atlasTextureIcon&&($.activeTexture.set(it.TEXTURE1),Qt.atlasTextureIcon&&Qt.atlasTextureIcon.bind(Qt.atlasInterpolationIcon,it.CLAMP_TO_EDGE)),Qt.isSDF){const ae=Qt.uniformValues;Qt.hasHalo&&(ae.u_is_halo=1,Ud(Qt.buffers,ee.segments,f,y,Qt.program,Ut,O,V,ae,ee.terrainData)),ae.u_is_halo=0}Ud(Qt.buffers,ee.segments,f,y,Qt.program,Ut,O,V,Qt.uniformValues,ee.terrainData)}}function Ud(y,s,f,d,g,v,C,L,P,N){const O=d.context;g.draw(O,O.gl.TRIANGLES,v,C,L,ni.disabled,P,N,f.id,y.layoutVertexBuffer,y.indexBuffer,s,f.paint,d.transform.zoom,y.programConfigurations.get(f.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function oh(y,s,f,d,g){if(!f||!d||!d.imageAtlas)return;const v=d.imageAtlas.patternPositions;let C=v[f.to.toString()],L=v[f.from.toString()];if(!C&&L&&(C=L),!L&&C&&(L=C),!C||!L){const P=g.getPaintProperty(s);C=v[P],L=v[P]}C&&L&&y.setConstantPatternPositions(C,L)}function Gd(y,s,f,d,g,v,C){const L=y.context.gl,P="fill-pattern",N=f.paint.get(P),O=N&&N.constantOr(1),V=f.getCrossfadeParameters();let $,it,rt,at,et;C?(it=O&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=L.LINES):(it=O?"fillPattern":"fill",$=L.TRIANGLES);const It=N.constantOr(null);for(const Rt of d){const ft=s.getTile(Rt);if(O&&!ft.patternsLoaded())continue;const kt=ft.getBucket(f);if(!kt)continue;const Ut=kt.programConfigurations.get(f.id),Ft=y.useProgram(it,Ut),Kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Rt);O&&(y.context.activeTexture.set(L.TEXTURE0),ft.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Ut.updatePaintBuffers(V)),oh(Ut,P,It,ft,f);const ee=Kt?Rt:null,Qt=y.translatePosMatrix(ee?ee.posMatrix:Rt.posMatrix,ft,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(C){at=kt.indexBuffer2,et=kt.segments2;const ae=[L.drawingBufferWidth,L.drawingBufferHeight];rt=it==="fillOutlinePattern"&&O?Cd(Qt,y,V,ft,ae):Zg(Qt,ae)}else at=kt.indexBuffer,et=kt.segments,rt=O?jc(Qt,y,V,ft):Ed(Qt);Ft.draw(y.context,$,g,y.stencilModeForClipping(Rt),v,ni.disabled,rt,Kt,f.id,kt.layoutVertexBuffer,at,et,f.paint,y.transform.zoom,Ut)}}function sh(y,s,f,d,g,v,C){const L=y.context,P=L.gl,N="fill-extrusion-pattern",O=f.paint.get(N),V=O.constantOr(1),$=f.getCrossfadeParameters(),it=f.paint.get("fill-extrusion-opacity"),rt=O.constantOr(null);for(const at of d){const et=s.getTile(at),It=et.getBucket(f);if(!It)continue;const Rt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(at),ft=It.programConfigurations.get(f.id),kt=y.useProgram(V?"fillExtrusionPattern":"fillExtrusion",ft);V&&(y.context.activeTexture.set(P.TEXTURE0),et.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),ft.updatePaintBuffers($)),oh(ft,N,rt,et,f);const Ut=y.translatePosMatrix(at.posMatrix,et,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ft=f.paint.get("fill-extrusion-vertical-gradient"),Kt=V?qg(Ut,y,Ft,it,at,$,et):Zu(Ut,y,Ft,it);kt.draw(L,L.gl.TRIANGLES,g,v,C,ni.backCCW,Kt,Rt,f.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,f.paint,y.transform.zoom,ft,y.style.map.terrain&&It.centroidVertexBuffer)}}function ah(y,s,f,d,g,v,C){const L=y.context,P=L.gl,N=f.fbo;if(!N)return;const O=y.useProgram("hillshade"),V=y.style.map.terrain&&y.style.map.terrain.getTerrainData(s);L.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,N.colorAttachment.get()),O.draw(L,P.TRIANGLES,g,v,C,ni.disabled,(($,it,rt,at)=>{const et=rt.paint.get("hillshade-shadow-color"),It=rt.paint.get("hillshade-highlight-color"),Rt=rt.paint.get("hillshade-accent-color");let ft=rt.paint.get("hillshade-illumination-direction")*(Math.PI/180);rt.paint.get("hillshade-illumination-anchor")==="viewport"&&(ft-=$.transform.angle);const kt=!$.options.moving;return{u_matrix:at?at.posMatrix:$.transform.calculatePosMatrix(it.tileID.toUnwrapped(),kt),u_image:0,u_latrange:Pd(0,it.tileID),u_light:[rt.paint.get("hillshade-exaggeration"),ft],u_shadow:et,u_highlight:It,u_accent:Rt}})(y,f,d,V?s:null),V,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function zf(y,s,f,d,g,v){const C=y.context,L=C.gl,P=s.dem;if(P&&P.data){const N=P.dim,O=P.stride,V=P.getPixels();if(C.activeTexture.set(L.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||y.getTileTexture(O),s.demTexture){const it=s.demTexture;it.update(V,{premultiply:!1}),it.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else s.demTexture=new _t(C,V,L.RGBA,{premultiply:!1}),s.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);C.activeTexture.set(L.TEXTURE0);let $=s.fbo;if(!$){const it=new _t(C,{width:N,height:N,data:null},L.RGBA);it.bind(L.LINEAR,L.CLAMP_TO_EDGE),$=s.fbo=C.createFramebuffer(N,N,!0,!1),$.colorAttachment.set(it.texture)}C.bindFramebuffer.set($.framebuffer),C.viewport.set([0,0,N,N]),y.useProgram("hillshadePrepare").draw(C,L.TRIANGLES,d,g,v,ni.disabled,((it,rt)=>{const at=rt.stride,et=u.F();return u.aN(et,0,u.W,-u.W,0,0,1),u.H(et,et,[0,-u.W,0]),{u_matrix:et,u_image:1,u_dimension:[at,at],u_zoom:it.overscaledZ,u_unpack:rt.getUnpackVector()}})(s.tileID,P),null,f.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function jd(y,s,f,d,g,v){const C=d.paint.get("raster-fade-duration");if(!v&&C>0){const L=E.now(),P=(L-y.timeAdded)/C,N=s?(L-s.timeAdded)/C:-1,O=f.getSource(),V=g.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),$=!s||Math.abs(s.tileID.overscaledZ-V)>Math.abs(y.tileID.overscaledZ-V),it=$&&y.refreshedUponExpiration?1:u.ac($?P:1-N,0,1);return y.refreshedUponExpiration&&P>=1&&(y.refreshedUponExpiration=!1),s?{opacity:1,mix:1-it}:{opacity:it,mix:0}}return{opacity:1,mix:0}}const qd=new u.aO(1,0,0,1),lh=new u.aO(0,1,0,1),Of=new u.aO(0,0,1,1),r_=new u.aO(1,0,1,1),Zd=new u.aO(0,1,1,1);function Ti(y,s,f,d){lo(y,0,s+f/2,y.transform.width,f,d)}function Za(y,s,f,d){lo(y,s-f/2,0,f,y.transform.height,d)}function lo(y,s,f,d,g,v){const C=y.context,L=C.gl;L.enable(L.SCISSOR_TEST),L.scissor(s*y.pixelRatio,f*y.pixelRatio,d*y.pixelRatio,g*y.pixelRatio),C.clear({color:v}),L.disable(L.SCISSOR_TEST)}function Ff(y,s,f){const d=y.context,g=d.gl,v=f.posMatrix,C=y.useProgram("debug"),L=Ln.disabled,P=ui.disabled,N=y.colorModeForRenderPass(),O="$debug",V=y.style.map.terrain&&y.style.map.terrain.getTerrainData(f);d.activeTexture.set(g.TEXTURE0);const $=s.getTileByID(f.key).latestRawTileData,it=Math.floor(($&&$.byteLength||0)/1024),rt=s.getTile(f).tileSize,at=512/Math.min(rt,512)*(f.overscaledZ/y.transform.zoom)*.5;let et=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(et+=` => ${f.overscaledZ}`),function(It,Rt){It.initDebugOverlayCanvas();const ft=It.debugOverlayCanvas,kt=It.context.gl,Ut=It.debugOverlayCanvas.getContext("2d");Ut.clearRect(0,0,ft.width,ft.height),Ut.shadowColor="white",Ut.shadowBlur=2,Ut.lineWidth=1.5,Ut.strokeStyle="white",Ut.textBaseline="top",Ut.font="bold 36px Open Sans, sans-serif",Ut.fillText(Rt,5,5),Ut.strokeText(Rt,5,5),It.debugOverlayTexture.update(ft),It.debugOverlayTexture.bind(kt.LINEAR,kt.CLAMP_TO_EDGE)}(y,`${et} ${it}kB`),C.draw(d,g.TRIANGLES,L,P,Ui.alphaBlended,ni.disabled,Ld(v,u.aO.transparent,at),null,O,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),C.draw(d,g.LINE_STRIP,L,P,N,ni.disabled,Ld(v,u.aO.red),V,O,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function uh(y,s,f){const d=y.context,g=d.gl,v=y.colorModeForRenderPass(),C=new Ln(g.LEQUAL,Ln.ReadWrite,y.depthRangeFor3D),L=y.useProgram("terrain"),P=s.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const N of f){const O=y.renderToTexture.getTexture(N),V=s.getTerrainData(N.tileID);d.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,O.texture);const $={u_matrix:y.transform.calculatePosMatrix(N.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(y.transform.zoom)};L.draw(d,g.TRIANGLES,C,ui.disabled,v,ni.backCCW,$,V,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}class Wd{constructor(s,f){this.context=new i_(s),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.F(),renderTime:0},this.setup(),this.numSublayers=Qi.maxUnderzooming+Qi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ja}resize(s,f,d){if(this.width=Math.floor(s*d),this.height=Math.floor(f*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,f=new u.aV;f.emplaceBack(0,0),f.emplaceBack(u.W,0),f.emplaceBack(0,u.W),f.emplaceBack(u.W,u.W),this.tileExtentBuffer=s.createVertexBuffer(f,Vc.members),this.tileExtentSegments=u.$.simpleSegment(0,0,4,2);const d=new u.aV;d.emplaceBack(0,0),d.emplaceBack(u.W,0),d.emplaceBack(0,u.W),d.emplaceBack(u.W,u.W),this.debugBuffer=s.createVertexBuffer(d,Vc.members),this.debugSegments=u.$.simpleSegment(0,0,4,5);const g=new u.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(u.W,0,u.W,0),g.emplaceBack(0,u.W,0,u.W),g.emplaceBack(u.W,u.W,u.W,u.W),this.rasterBoundsBuffer=s.createVertexBuffer(g,mi.members),this.rasterBoundsSegments=u.$.simpleSegment(0,0,4,2);const v=new u.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,Vc.members),this.viewportSegments=u.$.simpleSegment(0,0,4,2);const C=new u.aW;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(C);const L=new u.aX;L.emplaceBack(0,1,2),L.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(L);const P=this.context.gl;this.stencilClearMode=new ui({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)}clearStencil(){const s=this.context,f=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=u.F();u.aN(d,0,this.width,this.height,0,0,1),u.J(d,d,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,f.TRIANGLES,Ln.disabled,this.stencilClearMode,Ui.disabled,ni.disabled,qc(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,f){if(this.currentStencilSource===s.source||!s.isTileClipped()||!f||!f.length)return;this.currentStencilSource=s.source;const d=this.context,g=d.gl;this.nextStencilID+f.length>256&&this.clearStencil(),d.setColorMode(Ui.disabled),d.setDepthMode(Ln.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of f){const L=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);v.draw(d,g.TRIANGLES,Ln.disabled,new ui({func:g.ALWAYS,mask:0},L,255,g.KEEP,g.KEEP,g.REPLACE),Ui.disabled,ni.disabled,qc(C.posMatrix),P,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,f=this.context.gl;return new ui({func:f.NOTEQUAL,mask:255},s,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(s){const f=this.context.gl;return new ui({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(s){const f=this.context.gl,d=s.sort((C,L)=>L.overscaledZ-C.overscaledZ),g=d[d.length-1].overscaledZ,v=d[0].overscaledZ-g+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const C={};for(let L=0;L<v;L++)C[L+g]=new ui({func:f.GEQUAL,mask:255},L+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=v,[C,d]}return[{[g]:ui.disabled},d]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Ui([s.CONSTANT_COLOR,s.ONE],new u.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ui.unblended:Ui.alphaBlended}depthModeForSublayer(s,f,d){if(!this.opaquePassEnabledForLayer())return Ln.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Ln(d||this.context.gl.LEQUAL,f,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,f){this.style=s,this.options=f,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(E.now()),this.imageManager.beginFrame();const d=this.style._order,g=this.style.sourceCaches,v={},C={},L={};for(const P in g){const N=g[P];N.used&&N.prepare(this.context),v[P]=N.getVisibleCoordinates(),C[P]=v[P].slice().reverse(),L[P]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<d.length;P++)if(this.style._layers[d[P]].is3D()){this.opaquePassCutoff=P;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const P=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.aY(this.terrainFacilitator.matrix,this.transform.projMatrix)||P.length)&&(u.aZ(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(N,O){const V=N.context,$=V.gl,it=Ui.unblended,rt=new Ln($.LEQUAL,Ln.ReadWrite,[0,1]),at=O.getTerrainMesh(),et=O.sourceCache.getRenderableTiles(),It=N.useProgram("terrainDepth");V.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),V.viewport.set([0,0,N.width/devicePixelRatio,N.height/devicePixelRatio]),V.clear({color:u.aO.transparent,depth:1});for(const Rt of et){const ft=O.getTerrainData(Rt.tileID),kt={u_matrix:N.transform.calculatePosMatrix(Rt.tileID.toUnwrapped()),u_ele_delta:O.getMeshFrameDelta(N.transform.zoom)};It.draw(V,$.TRIANGLES,rt,ui.disabled,it,ni.backCCW,kt,ft,"terrain",at.vertexBuffer,at.indexBuffer,at.segments)}V.bindFramebuffer.set(null),V.viewport.set([0,0,N.width,N.height])}(this,this.style.map.terrain),function(N,O){const V=N.context,$=V.gl,it=Ui.unblended,rt=new Ln($.LEQUAL,Ln.ReadWrite,[0,1]),at=O.getTerrainMesh(),et=O.getCoordsTexture(),It=O.sourceCache.getRenderableTiles(),Rt=N.useProgram("terrainCoords");V.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),V.viewport.set([0,0,N.width/devicePixelRatio,N.height/devicePixelRatio]),V.clear({color:u.aO.transparent,depth:1}),O.coordsIndex=[];for(const ft of It){const kt=O.getTerrainData(ft.tileID);V.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,et.texture);const Ut={u_matrix:N.transform.calculatePosMatrix(ft.tileID.toUnwrapped()),u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0,u_ele_delta:O.getMeshFrameDelta(N.transform.zoom)};Rt.draw(V,$.TRIANGLES,rt,ui.disabled,it,ni.backCCW,Ut,kt,"terrain",at.vertexBuffer,at.indexBuffer,at.segments),O.coordsIndex.push(ft.tileID.key)}V.bindFramebuffer.set(null),V.viewport.set([0,0,N.width,N.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const P of d){const N=this.style._layers[P];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const O=C[N.source];(N.type==="custom"||O.length)&&this.renderLayer(this,g[N.source],N,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?u.aO.black:u.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[d[this.currentLayer]],N=g[P.source],O=v[P.source];this._renderTileClippingMasks(P,O),this.renderLayer(this,N,P,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const P=this.style._layers[d[this.currentLayer]],N=g[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P))continue;const O=(P.type==="symbol"?L:C)[P.source];this._renderTileClippingMasks(P,v[P.source]),this.renderLayer(this,N,P,O)}if(this.options.showTileBoundaries){const P=function(N,O){let V=null;const $=Object.values(N._layers).flatMap(et=>et.source&&!et.isHidden(O)?[N.sourceCaches[et.source]]:[]),it=$.filter(et=>et.getSource().type==="vector"),rt=$.filter(et=>et.getSource().type!=="vector"),at=et=>{(!V||V.getSource().maxzoom<et.getSource().maxzoom)&&(V=et)};return it.forEach(et=>at(et)),V||rt.forEach(et=>at(et)),V}(this.style,this.transform.zoom);P&&function(N,O,V){for(let $=0;$<V.length;$++)Ff(N,O,V[$])}(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const N=P.transform.padding;Ti(P,P.transform.height-(N.top||0),3,qd),Ti(P,N.bottom||0,3,lh),Za(P,N.left||0,3,Of),Za(P,P.transform.width-(N.right||0),3,r_);const O=P.transform.centerPoint;(function(V,$,it,rt){lo(V,$-1,it-10,2,20,rt),lo(V,$-10,it-1,20,2,rt)})(P,O.x,P.transform.height-O.y,Zd)}(this),this.context.setDefault()}renderLayer(s,f,d,g){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(g||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(v,C,L,P,N){if(v.renderPass!=="translucent")return;const O=ui.disabled,V=v.colorModeForRenderPass();(L._unevaluatedLayout.hasValue("text-variable-anchor")||L._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function($,it,rt,at,et,It,Rt){const ft=it.transform,kt=et==="map",Ut=It==="map";for(const Ft of $){const Kt=at.getTile(Ft),ee=Kt.getBucket(rt);if(!ee||!ee.text||!ee.text.segments.get().length)continue;const Qt=u.ag(ee.textSizeData,ft.zoom),ae=Qe(Kt,1,it.transform.zoom),Se=rn(Ft.posMatrix,Ut,kt,it.transform,ae),Ue=rt.layout.get("icon-text-fit")!=="none"&&ee.hasIconData();if(Qt){const me=Math.pow(2,ft.zoom-Kt.tileID.overscaledZ);nh(ee,kt,Ut,Rt,ft,Se,Ft.posMatrix,me,Qt,Ue,it.style.map.terrain?(Ve,Te)=>it.style.map.terrain.getElevation(Ft,Ve,Te):null)}}}(P,v,L,C,L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),N),L.paint.get("icon-opacity").constantOr(1)!==0&&rh(v,C,L,P,!1,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),L.layout.get("icon-rotation-alignment"),L.layout.get("icon-pitch-alignment"),L.layout.get("icon-keep-upright"),O,V),L.paint.get("text-opacity").constantOr(1)!==0&&rh(v,C,L,P,!0,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),L.layout.get("text-rotation-alignment"),L.layout.get("text-pitch-alignment"),L.layout.get("text-keep-upright"),O,V),C.map.showCollisionBoxes&&(eh(v,C,L,P,L.paint.get("text-translate"),L.paint.get("text-translate-anchor"),!0),eh(v,C,L,P,L.paint.get("icon-translate"),L.paint.get("icon-translate-anchor"),!1))})(s,f,d,g,this.style.placement.variableOffsets);break;case"circle":(function(v,C,L,P){if(v.renderPass!=="translucent")return;const N=L.paint.get("circle-opacity"),O=L.paint.get("circle-stroke-width"),V=L.paint.get("circle-stroke-opacity"),$=!L.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(O.constantOr(1)===0||V.constantOr(1)===0))return;const it=v.context,rt=it.gl,at=v.depthModeForSublayer(0,Ln.ReadOnly),et=ui.disabled,It=v.colorModeForRenderPass(),Rt=[];for(let ft=0;ft<P.length;ft++){const kt=P[ft],Ut=C.getTile(kt),Ft=Ut.getBucket(L);if(!Ft)continue;const Kt=Ft.programConfigurations.get(L.id),ee=v.useProgram("circle",Kt),Qt=Ft.layoutVertexBuffer,ae=Ft.indexBuffer,Se=v.style.map.terrain&&v.style.map.terrain.getTerrainData(kt),Ue={programConfiguration:Kt,program:ee,layoutVertexBuffer:Qt,indexBuffer:ae,uniformValues:Wg(v,kt,Ut,L),terrainData:Se};if($){const me=Ft.segments.get();for(const Ve of me)Rt.push({segments:new u.$([Ve]),sortKey:Ve.sortKey,state:Ue})}else Rt.push({segments:Ft.segments,sortKey:0,state:Ue})}$&&Rt.sort((ft,kt)=>ft.sortKey-kt.sortKey);for(const ft of Rt){const{programConfiguration:kt,program:Ut,layoutVertexBuffer:Ft,indexBuffer:Kt,uniformValues:ee,terrainData:Qt}=ft.state;Ut.draw(it,rt.TRIANGLES,at,et,It,ni.disabled,ee,Qt,L.id,Ft,Kt,ft.segments,L.paint,v.transform.zoom,kt)}})(s,f,d,g);break;case"heatmap":(function(v,C,L,P){if(L.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const N=v.context,O=N.gl,V=ui.disabled,$=new Ui([O.ONE,O.ONE],u.aO.transparent,[!0,!0,!0,!0]);(function(it,rt,at){const et=it.gl;it.activeTexture.set(et.TEXTURE1),it.viewport.set([0,0,rt.width/4,rt.height/4]);let It=at.heatmapFbo;if(It)et.bindTexture(et.TEXTURE_2D,It.colorAttachment.get()),it.bindFramebuffer.set(It.framebuffer);else{const Rt=et.createTexture();et.bindTexture(et.TEXTURE_2D,Rt),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_WRAP_S,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_WRAP_T,et.CLAMP_TO_EDGE),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_MIN_FILTER,et.LINEAR),et.texParameteri(et.TEXTURE_2D,et.TEXTURE_MAG_FILTER,et.LINEAR),It=at.heatmapFbo=it.createFramebuffer(rt.width/4,rt.height/4,!1,!1),function(ft,kt,Ut,Ft){var Kt,ee;const Qt=ft.gl,ae=(Kt=ft.HALF_FLOAT)!==null&&Kt!==void 0?Kt:Qt.UNSIGNED_BYTE,Se=(ee=ft.RGBA16F)!==null&&ee!==void 0?ee:Qt.RGBA;Qt.texImage2D(Qt.TEXTURE_2D,0,Se,kt.width/4,kt.height/4,0,Qt.RGBA,ae,null),Ft.colorAttachment.set(Ut)}(it,rt,Rt,It)}})(N,v,L),N.clear({color:u.aO.transparent});for(let it=0;it<P.length;it++){const rt=P[it];if(C.hasRenderableParent(rt))continue;const at=C.getTile(rt),et=at.getBucket(L);if(!et)continue;const It=et.programConfigurations.get(L.id),Rt=v.useProgram("heatmap",It),{zoom:ft}=v.transform;Rt.draw(N,O.TRIANGLES,Ln.disabled,V,$,ni.disabled,Md(rt.posMatrix,at,ft,L.paint.get("heatmap-intensity")),null,L.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,L.paint,v.transform.zoom,It)}N.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(N,O){const V=N.context,$=V.gl,it=O.heatmapFbo;if(!it)return;V.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,it.colorAttachment.get()),V.activeTexture.set($.TEXTURE1);let rt=O.colorRampTexture;rt||(rt=O.colorRampTexture=new _t(V,O.colorRamp,$.RGBA)),rt.bind($.LINEAR,$.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(V,$.TRIANGLES,Ln.disabled,ui.disabled,N.colorModeForRenderPass(),ni.disabled,((at,et,It,Rt)=>{const ft=u.F();u.aN(ft,0,at.width,at.height,0,0,1);const kt=at.context.gl;return{u_matrix:ft,u_world:[kt.drawingBufferWidth,kt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:et.paint.get("heatmap-opacity")}})(N,O),null,O.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,O.paint,N.transform.zoom)}(v,L))})(s,f,d,g);break;case"line":(function(v,C,L,P){if(v.renderPass!=="translucent")return;const N=L.paint.get("line-opacity"),O=L.paint.get("line-width");if(N.constantOr(1)===0||O.constantOr(1)===0)return;const V=v.depthModeForSublayer(0,Ln.ReadOnly),$=v.colorModeForRenderPass(),it=L.paint.get("line-dasharray"),rt=L.paint.get("line-pattern"),at=rt.constantOr(1),et=L.paint.get("line-gradient"),It=L.getCrossfadeParameters(),Rt=at?"linePattern":it?"lineSDF":et?"lineGradient":"line",ft=v.context,kt=ft.gl;let Ut=!0;for(const Ft of P){const Kt=C.getTile(Ft);if(at&&!Kt.patternsLoaded())continue;const ee=Kt.getBucket(L);if(!ee)continue;const Qt=ee.programConfigurations.get(L.id),ae=v.context.program.get(),Se=v.useProgram(Rt,Qt),Ue=Ut||Se.program!==ae,me=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ft),Ve=rt.constantOr(null);if(Ve&&Kt.imageAtlas){const vn=Kt.imageAtlas,fn=vn.patternPositions[Ve.to.toString()],bn=vn.patternPositions[Ve.from.toString()];fn&&bn&&Qt.setConstantPatternPositions(fn,bn)}const Te=me?Ft:null,hi=at?vl(v,Kt,L,It,Te):it?Wc(v,Kt,L,it,It,Te):et?kd(v,Kt,L,ee.lineClipsArray.length,Te):Zc(v,Kt,L,Te);if(at)ft.activeTexture.set(kt.TEXTURE0),Kt.imageAtlasTexture.bind(kt.LINEAR,kt.CLAMP_TO_EDGE),Qt.updatePaintBuffers(It);else if(it&&(Ue||v.lineAtlas.dirty))ft.activeTexture.set(kt.TEXTURE0),v.lineAtlas.bind(ft);else if(et){const vn=ee.gradients[L.id];let fn=vn.texture;if(L.gradientVersion!==vn.version){let bn=256;if(L.stepInterpolant){const ji=C.getSource().maxzoom,$n=Ft.canonical.z===ji?Math.ceil(1<<v.transform.maxZoom-Ft.canonical.z):1;bn=u.ac(u.aT(ee.maxLineLength/u.W*1024*$n),256,ft.maxTextureSize)}vn.gradient=u.aU({expression:L.gradientExpression(),evaluationKey:"lineProgress",resolution:bn,image:vn.gradient||void 0,clips:ee.lineClipsArray}),vn.texture?vn.texture.update(vn.gradient):vn.texture=new _t(ft,vn.gradient,kt.RGBA),vn.version=L.gradientVersion,fn=vn.texture}ft.activeTexture.set(kt.TEXTURE0),fn.bind(L.stepInterpolant?kt.NEAREST:kt.LINEAR,kt.CLAMP_TO_EDGE)}Se.draw(ft,kt.TRIANGLES,V,v.stencilModeForClipping(Ft),$,ni.disabled,hi,me,L.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,L.paint,v.transform.zoom,Qt,ee.layoutVertexBuffer2),Ut=!1}})(s,f,d,g);break;case"fill":(function(v,C,L,P){const N=L.paint.get("fill-color"),O=L.paint.get("fill-opacity");if(O.constantOr(1)===0)return;const V=v.colorModeForRenderPass(),$=L.paint.get("fill-pattern"),it=v.opaquePassEnabledForLayer()&&!$.constantOr(1)&&N.constantOr(u.aO.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===it){const rt=v.depthModeForSublayer(1,v.renderPass==="opaque"?Ln.ReadWrite:Ln.ReadOnly);Gd(v,C,L,P,rt,V,!1)}if(v.renderPass==="translucent"&&L.paint.get("fill-antialias")){const rt=v.depthModeForSublayer(L.getPaintProperty("fill-outline-color")?2:0,Ln.ReadOnly);Gd(v,C,L,P,rt,V,!0)}})(s,f,d,g);break;case"fill-extrusion":(function(v,C,L,P){const N=L.paint.get("fill-extrusion-opacity");if(N!==0&&v.renderPass==="translucent"){const O=new Ln(v.context.gl.LEQUAL,Ln.ReadWrite,v.depthRangeFor3D);if(N!==1||L.paint.get("fill-extrusion-pattern").constantOr(1))sh(v,C,L,P,O,ui.disabled,Ui.disabled),sh(v,C,L,P,O,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const V=v.colorModeForRenderPass();sh(v,C,L,P,O,ui.disabled,V)}}})(s,f,d,g);break;case"hillshade":(function(v,C,L,P){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const N=v.context,O=v.depthModeForSublayer(0,Ln.ReadOnly),V=v.colorModeForRenderPass(),[$,it]=v.renderPass==="translucent"?v.stencilConfigForOverlap(P):[{},P];for(const rt of it){const at=C.getTile(rt);at.needsHillshadePrepare!==void 0&&at.needsHillshadePrepare&&v.renderPass==="offscreen"?zf(v,at,L,O,ui.disabled,V):v.renderPass==="translucent"&&ah(v,rt,at,L,O,$[rt.overscaledZ],V)}N.viewport.set([0,0,v.width,v.height])})(s,f,d,g);break;case"raster":(function(v,C,L,P){if(v.renderPass!=="translucent"||L.paint.get("raster-opacity")===0||!P.length)return;const N=v.context,O=N.gl,V=C.getSource(),$=v.useProgram("raster"),it=v.colorModeForRenderPass(),[rt,at]=V instanceof Dr?[{},P]:v.stencilConfigForOverlap(P),et=at[at.length-1].overscaledZ,It=!v.options.moving;for(const Rt of at){const ft=v.depthModeForSublayer(Rt.overscaledZ-et,L.paint.get("raster-opacity")===1?Ln.ReadWrite:Ln.ReadOnly,O.LESS),kt=C.getTile(Rt);kt.registerFadeDuration(L.paint.get("raster-fade-duration"));const Ut=C.findLoadedParent(Rt,0),Ft=jd(kt,Ut,C,L,v.transform,v.style.map.terrain);let Kt,ee;const Qt=L.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;N.activeTexture.set(O.TEXTURE0),kt.texture.bind(Qt,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(O.TEXTURE1),Ut?(Ut.texture.bind(Qt,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),Kt=Math.pow(2,Ut.tileID.overscaledZ-kt.tileID.overscaledZ),ee=[kt.tileID.canonical.x*Kt%1,kt.tileID.canonical.y*Kt%1]):kt.texture.bind(Qt,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const ae=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Rt),Se=ae?Rt:null,Ue=Se?Se.posMatrix:v.transform.calculatePosMatrix(Rt.toUnwrapped(),It),me=Hc(Ue,ee||[0,0],Kt||1,Ft,L);V instanceof Dr?$.draw(N,O.TRIANGLES,ft,ui.disabled,it,ni.disabled,me,ae,L.id,V.boundsBuffer,v.quadTriangleIndexBuffer,V.boundsSegments):$.draw(N,O.TRIANGLES,ft,rt[Rt.overscaledZ],it,ni.disabled,me,ae,L.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(s,f,d,g);break;case"background":(function(v,C,L,P){const N=L.paint.get("background-color"),O=L.paint.get("background-opacity");if(O===0)return;const V=v.context,$=V.gl,it=v.transform,rt=it.tileSize,at=L.paint.get("background-pattern");if(v.isPatternMissing(at))return;const et=!at&&N.a===1&&O===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==et)return;const It=ui.disabled,Rt=v.depthModeForSublayer(0,et==="opaque"?Ln.ReadWrite:Ln.ReadOnly),ft=v.colorModeForRenderPass(),kt=v.useProgram(at?"backgroundPattern":"background"),Ut=P||it.coveringTiles({tileSize:rt,terrain:v.style.map.terrain});at&&(V.activeTexture.set($.TEXTURE0),v.imageManager.bind(v.context));const Ft=L.getCrossfadeParameters();for(const Kt of Ut){const ee=P?Kt.posMatrix:v.transform.calculatePosMatrix(Kt.toUnwrapped()),Qt=at?$g(ee,O,v,at,{tileID:Kt,tileSize:rt},Ft):Hg(ee,O,N),ae=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Kt);kt.draw(V,$.TRIANGLES,Rt,It,ft,ni.disabled,Qt,ae,L.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(s,0,d,g);break;case"custom":(function(v,C,L){const P=v.context,N=L.implementation;if(v.renderPass==="offscreen"){const O=N.prerender;O&&(v.setCustomLayerDefaults(),P.setColorMode(v.colorModeForRenderPass()),O.call(N,P.gl,v.transform.customLayerMatrix()),P.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),P.setColorMode(v.colorModeForRenderPass()),P.setStencilMode(ui.disabled);const O=N.renderingMode==="3d"?new Ln(v.context.gl.LEQUAL,Ln.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,Ln.ReadOnly);P.setDepthMode(O),N.render(P.gl,v.transform.customLayerMatrix()),P.setDirty(),v.setBaseState(),P.bindFramebuffer.set(null)}})(s,0,d)}}translatePosMatrix(s,f,d,g,v){if(!d[0]&&!d[1])return s;const C=v?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(C){const N=Math.sin(C),O=Math.cos(C);d=[d[0]*O-d[1]*N,d[0]*N+d[1]*O]}const L=[v?d[0]:Qe(f,d[0],this.transform.zoom),v?d[1]:Qe(f,d[1],this.transform.zoom),0],P=new Float32Array(16);return u.H(P,s,L),P}saveTileTexture(s){const f=this._tileTextures[s.size[0]];f?f.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const f=this._tileTextures[s];return f&&f.length>0?f.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const f=this.imageManager.getPattern(s.from.toString()),d=this.imageManager.getPattern(s.to.toString());return!f||!d}useProgram(s,f){this.cache=this.cache||{};const d=s+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new qa(this.context,qu[s],f,Ad[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _t(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:f}=this.context.gl;return this.width!==s||this.height!==f}}class Wa{constructor(s,f){this.points=s,this.planes=f}static fromInvProjectionMatrix(s,f,d){const g=Math.pow(2,d),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>{const P=1/(L=u.af([],L,s))[3]/f*g;return u.a_(L,L,[P,P,1/L[3],P])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(L=>{const P=function($,it){var rt=it[0],at=it[1],et=it[2],It=rt*rt+at*at+et*et;return It>0&&(It=1/Math.sqrt(It)),$[0]=it[0]*It,$[1]=it[1]*It,$[2]=it[2]*It,$}([],function($,it,rt){var at=it[0],et=it[1],It=it[2],Rt=rt[0],ft=rt[1],kt=rt[2];return $[0]=et*kt-It*ft,$[1]=It*Rt-at*kt,$[2]=at*ft-et*Rt,$}([],lt([],v[L[0]],v[L[1]]),lt([],v[L[2]],v[L[1]]))),N=-((O=P)[0]*(V=v[L[1]])[0]+O[1]*V[1]+O[2]*V[2]);var O,V;return P.concat(N)});return new Wa(v,C)}}class Ha{constructor(s,f){this.min=s,this.max=f,this.center=function(d,g,v){return d[0]=.5*g[0],d[1]=.5*g[1],d[2]=.5*g[2],d}([],function(d,g,v){return d[0]=g[0]+v[0],d[1]=g[1]+v[1],d[2]=g[2]+v[2],d}([],this.min,this.max))}quadrant(s){const f=[s%2==0,s<2],d=ut(this.min),g=ut(this.max);for(let v=0;v<f.length;v++)d[v]=f[v]?this.min[v]:this.center[v],g[v]=f[v]?this.center[v]:this.max[v];return g[2]=this.max[2],new Ha(d,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let g=0;g<s.planes.length;g++){const v=s.planes[g];let C=0;for(let L=0;L<f.length;L++)u.a$(v,f[L])>=0&&C++;if(C===0)return 0;C!==f.length&&(d=!1)}if(d)return 2;for(let g=0;g<3;g++){let v=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let L=0;L<s.points.length;L++){const P=s.points[L][g]-this.min[g];v=Math.min(v,P),C=Math.max(C,P)}if(C<0||v>this.max[g]-this.min[g])return 0}return 1}}class au{constructor(s=0,f=0,d=0,g=0){if(isNaN(s)||s<0||isNaN(f)||f<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=f,this.left=d,this.right=g}interpolate(s,f,d){return f.top!=null&&s.top!=null&&(this.top=u.z.number(s.top,f.top,d)),f.bottom!=null&&s.bottom!=null&&(this.bottom=u.z.number(s.bottom,f.bottom,d)),f.left!=null&&s.left!=null&&(this.left=u.z.number(s.left,f.left,d)),f.right!=null&&s.right!=null&&(this.right=u.z.number(s.right,f.right,d)),this}getCenter(s,f){const d=u.ac((this.left+s-this.right)/2,0,s),g=u.ac((this.top+f-this.bottom)/2,0,f);return new u.P(d,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new au(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ch{constructor(s,f,d,g,v){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=f||22,this._minPitch=d??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new au,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new ch(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const f=-u.b0(s,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var d=new u.A(4);return u.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,g,v){var C=g[0],L=g[1],P=g[2],N=g[3],O=Math.sin(v),V=Math.cos(v);d[0]=C*V+P*O,d[1]=L*V+N*O,d[2]=C*-O+P*V,d[3]=L*-O+N*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const f=u.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const f=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,f,d){this._unmodified=!1,this._edgeInsets.interpolate(s,f,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const f=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(s){const f=[new u.b1(0,s)];if(this._renderWorldCopies){const d=this.pointCoordinate(new u.P(0,0)),g=this.pointCoordinate(new u.P(this.width,0)),v=this.pointCoordinate(new u.P(this.width,this.height)),C=this.pointCoordinate(new u.P(0,this.height)),L=Math.floor(Math.min(d.x,g.x,v.x,C.x)),P=Math.floor(Math.max(d.x,g.x,v.x,C.x)),N=1;for(let O=L-N;O<=P+N;O++)O!==0&&f.push(new u.b1(O,s))}return f}coveringTiles(s){var f,d;let g=this.coveringZoomLevel(s);const v=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),L=u.Y.fromLngLat(this.center),P=Math.pow(2,g),N=[P*C.x,P*C.y,0],O=[P*L.x,P*L.y,0],V=Wa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let $=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&($=g);const it=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,rt=ft=>({aabb:new Ha([ft*P,0,0],[(ft+1)*P,P,0]),zoom:0,x:0,y:0,wrap:ft,fullyVisible:!1}),at=[],et=[],It=g,Rt=s.reparseOverscaled?v:g;if(this._renderWorldCopies)for(let ft=1;ft<=3;ft++)at.push(rt(-ft)),at.push(rt(ft));for(at.push(rt(0));at.length>0;){const ft=at.pop(),kt=ft.x,Ut=ft.y;let Ft=ft.fullyVisible;if(!Ft){const Se=ft.aabb.intersects(V);if(Se===0)continue;Ft=Se===2}const Kt=s.terrain?N:O,ee=ft.aabb.distanceX(Kt),Qt=ft.aabb.distanceY(Kt),ae=Math.max(Math.abs(ee),Math.abs(Qt));if(ft.zoom===It||ae>it+(1<<It-ft.zoom)-2&&ft.zoom>=$){const Se=It-ft.zoom,Ue=N[0]-.5-(kt<<Se),me=N[1]-.5-(Ut<<Se);et.push({tileID:new u.Q(ft.zoom===It?Rt:ft.zoom,ft.wrap,ft.zoom,kt,Ut),distanceSq:zt([O[0]-.5-kt,O[1]-.5-Ut]),tileDistanceToCamera:Math.sqrt(Ue*Ue+me*me)})}else for(let Se=0;Se<4;Se++){const Ue=(kt<<1)+Se%2,me=(Ut<<1)+(Se>>1),Ve=ft.zoom+1;let Te=ft.aabb.quadrant(Se);if(s.terrain){const hi=new u.Q(Ve,ft.wrap,Ve,Ue,me),vn=s.terrain.getMinMaxElevation(hi),fn=(f=vn.minElevation)!==null&&f!==void 0?f:this.elevation,bn=(d=vn.maxElevation)!==null&&d!==void 0?d:this.elevation;Te=new Ha([Te.min[0],Te.min[1],fn],[Te.max[0],Te.max[1],bn])}at.push({aabb:Te,zoom:Ve,x:Ue,y:me,wrap:ft.wrap,fullyVisible:Ft})}}return et.sort((ft,kt)=>ft.distanceSq-kt.distanceSq).map(ft=>ft.tileID)}resize(s,f){this.width=s,this.height=f,this.pixelsToGLUnits=[2/s,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const f=u.ac(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.P(u.N(s.lng)*this.worldSize,u.O(f)*this.worldSize)}unproject(s){return new u.Y(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const f=this.pointLocation(this.centerPoint,s),d=s.getElevationForLngLatZoom(f,this.tileZoom);if(!(this.elevation-d))return;const g=this.getCameraPosition(),v=u.Y.fromLngLat(g.lngLat,g.altitude),C=u.Y.fromLngLat(f,d),L=v.x-C.x,P=v.y-C.y,N=v.z-C.z,O=Math.sqrt(L*L+P*P+N*N),V=this.scaleZoom(this.cameraToCenterDistance/O/this.tileSize);this._elevation=d,this._center=f,this.zoom=V}setLocationAtPoint(s,f){const d=this.pointCoordinate(f),g=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),C=new u.Y(v.x-(d.x-g.x),v.y-(d.y-g.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,f){return f?this.coordinatePoint(this.locationCoordinate(s),f.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,f){return this.coordinateLocation(this.pointCoordinate(s,f))}locationCoordinate(s){return u.Y.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,f){if(f){const $=f.pointCoordinate(s);if($!=null)return $}const d=[s.x,s.y,0,1],g=[s.x,s.y,1,1];u.af(d,d,this.pixelMatrixInverse),u.af(g,g,this.pixelMatrixInverse);const v=d[3],C=g[3],L=d[1]/v,P=g[1]/C,N=d[2]/v,O=g[2]/C,V=N===O?0:(0-N)/(O-N);return new u.Y(u.z.number(d[0]/v,g[0]/C,V)/this.worldSize,u.z.number(L,P,V)/this.worldSize)}coordinatePoint(s,f=0,d=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,f,1];return u.af(g,g,d),new u.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Le().extend(this.pointLocation(new u.P(0,s))).extend(this.pointLocation(new u.P(this.width,s))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Le([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,f=!1){const d=s.key,g=f?this._alignedPosMatrixCache:this._posMatrixCache;if(g[d])return g[d];const v=s.canonical,C=this.worldSize/this.zoomScale(v.z),L=v.x+Math.pow(2,v.z)*s.wrap,P=u.an(new Float64Array(16));return u.H(P,P,[L*C,v.y*C,0]),u.J(P,P,[C/u.W,C/u.W,1]),u.K(P,f?this.alignedProjMatrix:this.projMatrix,P),g[d]=new Float32Array(P),g[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,f,d,g,v=-90,C=90,L=-180,P=180;const N=this.size,O=this._unmodified;if(this.latRange){const it=this.latRange;v=u.O(it[1])*this.worldSize,C=u.O(it[0])*this.worldSize,s=C-v<N.y?N.y/(C-v):0}if(this.lngRange){const it=this.lngRange;L=u.b0(u.N(it[0])*this.worldSize,0,this.worldSize),P=u.b0(u.N(it[1])*this.worldSize,0,this.worldSize),P<L&&(P+=this.worldSize),f=P-L<N.x?N.x/(P-L):0}const V=this.point,$=Math.max(f||0,s||0);if($)return this.center=this.unproject(new u.P(f?(P+L)/2:V.x,s?(C+v)/2:V.y)),this.zoom+=this.scaleZoom($),this._unmodified=O,void(this._constraining=!1);if(this.latRange){const it=V.y,rt=N.y/2;it-rt<v&&(g=v+rt),it+rt>C&&(g=C-rt)}if(this.lngRange){const it=(L+P)/2,rt=u.b0(V.x,it-this.worldSize/2,it+this.worldSize/2),at=N.x/2;rt-at<L&&(d=L+at),rt+at>P&&(d=P-at)}d===void 0&&g===void 0||(this.center=this.unproject(new u.P(d!==void 0?d:V.x,g!==void 0?g:V.y)).wrap()),this._unmodified=O,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,f=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b2(1,this.center.lat)*this.worldSize;let g=u.an(new Float64Array(16));u.J(g,g,[this.width/2,-this.height/2,1]),u.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=u.an(new Float64Array(16)),u.J(g,g,[1,-1,1]),u.H(g,g,[-1,-1,0]),u.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this.minElevationForCurrentTile),L=v-C*this._pixelPerMeter/Math.cos(this._pitch),P=C<0?L:v,N=Math.PI/2+this._pitch,O=this._fov*(.5+s.y/this.height),V=Math.sin(O)*P/Math.sin(u.ac(Math.PI-N-O,.01,Math.PI-.01)),$=this.getHorizon(),it=2*Math.atan($/this.cameraToCenterDistance)*(.5+s.y/(2*$)),rt=Math.sin(it)*P/Math.sin(u.ac(Math.PI-N-it,.01,Math.PI-.01)),at=Math.min(V,rt),et=1.01*(Math.cos(Math.PI/2-this._pitch)*at+P),It=this.height/50;g=new Float64Array(16),u.b3(g,this._fov,this.width/this.height,It,et),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,u.J(g,g,[1,-1,1]),u.H(g,g,[0,0,-this.cameraToCenterDistance]),u.b4(g,g,this._pitch),u.ad(g,g,this.angle),u.H(g,g,[-f,-d,0]),this.mercatorMatrix=u.J([],g,[this.worldSize,this.worldSize,this.worldSize]),u.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.K(new Float64Array(16),this.labelPlaneMatrix,g),u.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=u.ar([],g),this.pixelMatrix3D=u.K(new Float64Array(16),this.labelPlaneMatrix,g);const Rt=this.width%2/2,ft=this.height%2/2,kt=Math.cos(this.angle),Ut=Math.sin(this.angle),Ft=f-Math.round(f)+kt*Rt+Ut*ft,Kt=d-Math.round(d)+kt*ft+Ut*Rt,ee=new Float64Array(g);if(u.H(ee,ee,[Ft>.5?Ft-1:Ft,Kt>.5?Kt-1:Kt,0]),this.alignedProjMatrix=ee,g=u.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new u.P(0,0)),f=[s.x*this.worldSize,s.y*this.worldSize,0,1];return u.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,s))}getCameraQueryGeometry(s){const f=this.getCameraPoint();if(s.length===1)return[s[0],f];{let d=f.x,g=f.y,v=f.x,C=f.y;for(const L of s)d=Math.min(d,L.x),g=Math.min(g,L.y),v=Math.max(v,L.x),C=Math.max(C,L.y);return[new u.P(d,g),new u.P(v,g),new u.P(v,C),new u.P(d,C),new u.P(d,g)]}}lngLatToCameraDepth(s,f){const d=this.locationCoordinate(s),g=[d.x*this.worldSize,d.y*this.worldSize,f,1];return u.af(g,g,this.projMatrix),g[2]/g[3]}}function Bf(y,s){let f,d=!1,g=null,v=null;const C=()=>{g=null,d&&(y.apply(v,f),g=setTimeout(C,s),d=!1)};return(...L)=>(d=!0,v=this,f=L,g||C(),g)}class Vf{constructor(s){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let d;return f.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(d=g)}),(d&&d[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:d,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=Bf(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const f=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,g),C=Math.round(f.lng*v)/v,L=Math.round(f.lat*v)/v,P=this._map.getBearing(),N=this._map.getPitch();let O="";if(O+=s?`/${C}/${L}/${d}`:`${d}/${L}/${C}`,(P||N)&&(O+="/"+Math.round(10*P)/10),N&&(O+=`/${Math.round(N)}`),this._hashName){const V=this._hashName;let $=!1;const it=window.location.hash.slice(1).split("&").map(rt=>{const at=rt.split("=")[0];return at===V?($=!0,`${at}=${O}`):rt}).filter(rt=>rt);return $||it.push(`${V}=${O}`),`#${it.join("&")}`}return`#${O}`}}const Ju={linearity:.3,easing:u.b5(0,0,.3,1)},Hd=u.e({deceleration:2500,maxSpeed:1400},Ju),Sl=u.e({deceleration:20,maxSpeed:1400},Ju),$d=u.e({deceleration:1e3,maxSpeed:360},Ju),Xd=u.e({deceleration:1e3,maxSpeed:90},Ju);class Yd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:E.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,f=E.now();for(;s.length>0&&f-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)f.zoom+=v.zoomDelta||0,f.bearing+=v.bearingDelta||0,f.pitch+=v.pitchDelta||0,v.panDelta&&f.pan._add(v.panDelta),v.around&&(f.around=v.around),v.pinchAround&&(f.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(f.pan.mag()){const v=tc(f.pan.mag(),d,u.e({},Hd,s||{}));g.offset=f.pan.mult(v.amount/f.pan.mag()),g.center=this._map.transform.center,Qu(g,v)}if(f.zoom){const v=tc(f.zoom,d,Sl);g.zoom=this._map.transform.zoom+v.amount,Qu(g,v)}if(f.bearing){const v=tc(f.bearing,d,$d);g.bearing=this._map.transform.bearing+u.ac(v.amount,-179,179),Qu(g,v)}if(f.pitch){const v=tc(f.pitch,d,Xd);g.pitch=this._map.transform.pitch+v.amount,Qu(g,v)}if(g.zoom||g.bearing){const v=f.pinchAround===void 0?f.around:f.pinchAround;g.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),u.e(g,{noMoveStart:!0})}}function Qu(y,s){(!y.duration||y.duration<s.duration)&&(y.duration=s.duration,y.easing=s.easing)}function tc(y,s,f){const{maxSpeed:d,linearity:g,deceleration:v}=f,C=u.ac(y*g/(s/1e3),-d,d),L=Math.abs(C)/(v*g);return{easing:f.easing,duration:1e3*L,amount:C*(L/2)}}class Io extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,d,g={}){const v=M.mousePos(f.getCanvas(),d),C=f.unproject(v);super(s,u.e({point:v,lngLat:C,originalEvent:d},g)),this._defaultPrevented=!1,this.target=f}}class lu extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,d){const g=s==="touchend"?d.changedTouches:d.touches,v=M.touchPos(f.getCanvasContainer(),g),C=v.map(P=>f.unproject(P)),L=v.reduce((P,N,O,V)=>P.add(N.div(V.length)),new u.P(0,0));super(s,{points:v,point:L,lngLats:C,lngLat:f.unproject(L),originalEvent:d}),this._defaultPrevented=!1}}class Il extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,f,d){super(s,{originalEvent:d}),this._defaultPrevented=!1}}class Kd{constructor(s,f){this._map=s,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Il(s.type,this._map,s))}mousedown(s,f){return this._mousedownPos=f,this._firePreventable(new Io(s.type,this._map,s))}mouseup(s){this._map.fire(new Io(s.type,this._map,s))}click(s,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Io(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Io(s.type,this._map,s))}mouseover(s){this._map.fire(new Io(s.type,this._map,s))}mouseout(s){this._map.fire(new Io(s.type,this._map,s))}touchstart(s){return this._firePreventable(new lu(s.type,this._map,s))}touchmove(s){this._map.fire(new lu(s.type,this._map,s))}touchend(s){this._map.fire(new lu(s.type,this._map,s))}touchcancel(s){this._map.fire(new lu(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Io(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Io("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Io(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eo{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(u.P.convert(s),this._map.terrain)}}class Uf{constructor(s,f){this._map=s,this._tr=new Eo(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,f){this.isEnabled()&&s.shiftKey&&s.button===0&&(M.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(s,f){if(!this._active)return;const d=f;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=d,this._box||(this._box=M.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(g.x,d.x),C=Math.max(g.x,d.x),L=Math.min(g.y,d.y),P=Math.max(g.y,d.y);M.setTransform(this._box,`translate(${v}px,${L}px)`),this._box.style.width=C-v+"px",this._box.style.height=P-L+"px"}mouseupWindow(s,f){if(!this._active||s.button!==0)return;const d=this._startPos,g=f;if(this.reset(),M.suppressClick(),d.x!==g.x||d.y!==g.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(d,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,f){return this._map.fire(new u.k(s,{originalEvent:f}))}}function os(y,s){if(y.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${s.length}`);const f={};for(let d=0;d<y.length;d++)f[y[d].identifier]=s[d];return f}class ec{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,f,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const v=new u.P(0,0);for(const C of g)v._add(C);return v.div(g.length)}(f),this.touches=os(d,f)))}touchmove(s,f,d){if(this.aborted||!this.centroid)return;const g=os(d,f);for(const v in this.touches){const C=g[v];(!C||C.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(s,f,d){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Gf{constructor(s){this.singleTap=new ec(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,f,d){this.singleTap.touchstart(s,f,d)}touchmove(s,f,d){this.singleTap.touchmove(s,f,d)}touchend(s,f,d){const g=this.singleTap.touchend(s,f,d);if(g){const v=s.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(g)<30;if(v&&C||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class o_{constructor(s){this._tr=new Eo(s),this._zoomIn=new Gf({numTouches:1,numTaps:2}),this._zoomOut=new Gf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,f,d){this._zoomIn.touchstart(s,f,d),this._zoomOut.touchstart(s,f,d)}touchmove(s,f,d){this._zoomIn.touchmove(s,f,d),this._zoomOut.touchmove(s,f,d)}touchend(s,f,d){const g=this._zoomIn.touchend(s,f,d),v=this._zoomOut.touchend(s,f,d),C=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(g)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nc{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const f=this._moveFunction(...s);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(s,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,f){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=f.length?f[0]:f;return!this._moved&&g.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(d,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&M.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jd={0:1,2:2};class El{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const f=M.mouseButton(s);this._eventButton=f}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(f,d){const g=Jd[d];return f.buttons===void 0||(f.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return M.mouseButton(s)===this._eventButton}}class ya{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const xe=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(s){s.preventDefault()}},jf=({enable:y,clickTolerance:s,bearingDegreesPerPixelMoved:f=.8})=>{const d=new El({checkCorrectEvent:g=>M.mouseButton(g)===0&&g.ctrlKey||M.mouseButton(g)===2});return new nc({clickTolerance:s,move:(g,v)=>({bearingDelta:(v.x-g.x)*f}),moveStateManager:d,enable:y,assignEvents:xe})},uu=({enable:y,clickTolerance:s,pitchDegreesPerPixelMoved:f=-.5})=>{const d=new El({checkCorrectEvent:g=>M.mouseButton(g)===0&&g.ctrlKey||M.mouseButton(g)===2});return new nc({clickTolerance:s,move:(g,v)=>({pitchDelta:(v.y-g.y)*f}),moveStateManager:d,enable:y,assignEvents:xe})};class ic{constructor(s,f){this._clickTolerance=s.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,f,d){return this._calculateTransform(s,f,d)}touchmove(s,f,d){if(this._active&&!(d.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,f,d)}touchend(s,f,d){this._calculateTransform(s,f,d),this._active&&d.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,f,d){d.length>0&&(this._active=!0);const g=os(d,f),v=new u.P(0,0),C=new u.P(0,0);let L=0;for(const N in g){const O=g[N],V=this._touches[N];V&&(v._add(O),C._add(O.sub(V)),L++,g[N]=O)}if(this._touches=g,L<this.minTouchs()||!C.mag())return;const P=C.div(L);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(L),panDelta:P}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,f,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([f[0],f[1]]))}touchmove(s,f,d){if(!this._firstTwoTouches)return;s.preventDefault();const[g,v]=this._firstTwoTouches,C=_e(d,f,g),L=_e(d,f,v);if(!C||!L)return;const P=this._aroundCenter?null:C.add(L).div(2);return this._move([C,L],P,s)}touchend(s,f,d){if(!this._firstTwoTouches)return;const[g,v]=this._firstTwoTouches,C=_e(d,f,g),L=_e(d,f,v);C&&L||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function _e(y,s,f){for(let d=0;d<y.length;d++)if(y[d].identifier===f)return s[d]}function fh(y,s){return Math.log(y/s)/Math.LN2}class Qd extends hh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,f){const d=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(fh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fh(this._distance,d),pinchAround:f}}}function tm(y,s){return 180*y.angleWith(s)/Math.PI}class ph extends hh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,f,d){const g=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tm(this._vector,g),pinchAround:f}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const f=25/(Math.PI*this._minDiameter)*360,d=tm(s,this._startVector);return Math.abs(d)<f}}function dh(y){return Math.abs(y.y)>Math.abs(y.x)}class qf extends hh{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,f,d){super.touchstart(s,f,d),this._currentTouchCount=d.length}_start(s){this._lastPoints=s,dh(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,f,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,v,d.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,f,d){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,v=f.mag()>=2;if(!g&&!v)return;if(!g||!v)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const C=s.y>0==f.y>0;return dh(s)&&dh(f)&&C}}const s_={panStep:100,bearingStep:15,pitchStep:10};class em{constructor(s){this._tr=new Eo(s);const f=s_;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let f=0,d=0,g=0,v=0,C=0;switch(s.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:s.shiftKey?d=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?d=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),C=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:L=>{const P=this._tr;L.easeTo({duration:300,easeId:"keyboardHandler",easing:Cl,zoom:f?Math.round(P.zoom)+f*(s.shiftKey?2:1):P.zoom,bearing:P.bearing+d*this._bearingStep,pitch:P.pitch+g*this._pitchStep,offset:[-v*this._panStep,-C*this._panStep],center:P.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cl(y){return y*(2-y)}const ci=4.000244140625;class rc{constructor(s,f){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=s,this._tr=new Eo(s),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!s[this._map.cooperativeGestures._bypassKey])return;let f=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const d=E.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,f!==0&&f%ci==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),s.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=s,this._delta-=f,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=M.mousePos(this._map.getCanvas(),s),d=this._tr;this._around=f.y>d.transform.height/2-d.transform.getHorizon()?u.M.convert(this._aroundCenter?d.center:d.unproject(f)):u.M.convert(d.center),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>ci?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&P!==0&&(P=1/P);const N=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(N*P))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,d=this._startZoom,g=this._easing;let v,C=!1;if(this._type==="wheel"&&d&&g){const L=Math.min((E.now()-this._lastWheelEventTime)/200,1),P=g(L);v=u.z.number(d,f,P),L<1?this._frameId||(this._frameId=!0):C=!0}else v=f,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let f=u.b6;if(this._prevEase){const d=this._prevEase,g=(E.now()-d.start)/d.duration,v=d.easing(g+.01)-d.easing(g),C=.27/Math.sqrt(v*v+1e-4)*.01,L=Math.sqrt(.0729-C*C);f=u.b5(C,L,.25,1)}return this._prevEase={start:E.now(),duration:s,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class mh{constructor(s,f){this._clickZoom=s,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nm{constructor(s){this._tr=new Eo(s),this.reset()}reset(){this._active=!1}dblclick(s,f){return s.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class im{constructor(){this._tap=new Gf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,f,d){if(!this._swipePoint)if(this._tapTime){const g=f[0],v=s.timeStamp-this._tapTime<500,C=this._tapPoint.dist(g)<30;v&&C?d.length>0&&(this._swipePoint=g,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(s,f,d)}touchmove(s,f,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=f[0],v=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,f,d)}touchend(s,f,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const g=this._tap.touchend(s,f,d);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zf{constructor(s,f,d){this._el=s,this._mousePan=f,this._touchPan=d}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rm{constructor(s,f,d){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=f,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ws{constructor(s,f,d,g){this._el=s,this._touchZoom=f,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class oc{constructor(s,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=M.create("div","maplibregl-cooperative-gesture-screen",s);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=f,this._container.appendChild(g);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=d,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(M.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const ke=y=>y.zoom||y.drag||y.pitch||y.rotate;class qe extends u.k{}function cu(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Wf{constructor(s,f){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,v)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=g.type==="renderFrame"?void 0:g,L={needsRenderFrame:!1},P={},N={},O=g.touches,V=O?this._getMapTouches(O):void 0,$=V?M.touchPos(this._map.getCanvas(),V):M.mousePos(this._map.getCanvas(),g);for(const{handlerName:at,handler:et,allowed:It}of this._handlers){if(!et.isEnabled())continue;let Rt;this._blockedByActive(N,It,at)?et.reset():et[v||g.type]&&(Rt=et[v||g.type](g,$,V),this.mergeHandlerResult(L,P,Rt,at,C),Rt&&Rt.needsRenderFrame&&this._triggerRenderFrame()),(Rt||et.isActive())&&(N[at]=et)}const it={};for(const at in this._previousActiveHandlers)N[at]||(it[at]=C);this._previousActiveHandlers=N,(Object.keys(it).length||cu(L))&&(this._changes.push([L,P,it]),this._triggerRenderFrame()),(Object.keys(N).length||cu(L))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:rt}=L;rt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],rt(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yd(s),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,v,C]of this._listeners)M.addEventListener(g,v,g===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[s,f,d]of this._listeners)M.removeEventListener(s,f,s===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(s){const f=this._map,d=f.getCanvasContainer();this._add("mapEvent",new Kd(f,s));const g=f.boxZoom=new Uf(f,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const v=f.cooperativeGestures=new oc(f,s.cooperativeGestures);this._add("cooperativeGestures",v),s.cooperativeGestures&&v.enable();const C=new o_(f),L=new nm(f);f.doubleClickZoom=new mh(L,C),this._add("tapZoom",C),this._add("clickZoom",L),s.interactive&&s.doubleClickZoom&&f.doubleClickZoom.enable();const P=new im;this._add("tapDragZoom",P);const N=f.touchPitch=new qf(f);this._add("touchPitch",N),s.interactive&&s.touchPitch&&f.touchPitch.enable(s.touchPitch);const O=jf(s),V=uu(s);f.dragRotate=new rm(s,O,V),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]),s.interactive&&s.dragRotate&&f.dragRotate.enable();const $=(({enable:Rt,clickTolerance:ft})=>{const kt=new El({checkCorrectEvent:Ut=>M.mouseButton(Ut)===0&&!Ut.ctrlKey});return new nc({clickTolerance:ft,move:(Ut,Ft)=>({around:Ft,panDelta:Ft.sub(Ut)}),activateOnStart:!0,moveStateManager:kt,enable:Rt,assignEvents:xe})})(s),it=new ic(s,f);f.dragPan=new Zf(d,$,it),this._add("mousePan",$),this._add("touchPan",it,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&f.dragPan.enable(s.dragPan);const rt=new ph,at=new Qd;f.touchZoomRotate=new ws(d,at,rt,P),this._add("touchRotate",rt,["touchPan","touchZoom"]),this._add("touchZoom",at,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&f.touchZoomRotate.enable(s.touchZoomRotate);const et=f.scrollZoom=new rc(f,()=>this._triggerRenderFrame());this._add("scrollZoom",et,["mousePan"]),s.interactive&&s.scrollZoom&&f.scrollZoom.enable(s.scrollZoom);const It=f.keyboard=new em(f);this._add("keyboard",It),s.interactive&&s.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new xs(f))}_add(s,f,d){this._handlers.push({handlerName:s,handler:f,allowed:d}),this._handlersById[s]=f}stop(s){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ke(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,f,d){for(const g in s)if(g!==d&&(!f||f.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const f=[];for(const d of s)this._el.contains(d.target)&&f.push(d);return f}mergeHandlerResult(s,f,d,g,v){if(!d)return;u.e(s,d);const C={handlerName:g,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(f.zoom=C),d.panDelta!==void 0&&(f.drag=C),d.pitchDelta!==void 0&&(f.pitch=C),d.bearingDelta!==void 0&&(f.rotate=C)}_applyChanges(){const s={},f={},d={};for(const[g,v,C]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new u.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),u.e(f,v),u.e(d,C);this._updateMapTransform(s,f,d),this._changes=[]}_updateMapTransform(s,f,d){const g=this._map,v=g._getTransformForUpdate(),C=g.terrain;if(!(cu(s)||C&&this._terrainMovement))return this._fireEvents(f,d,!0);let{panDelta:L,zoomDelta:P,bearingDelta:N,pitchDelta:O,around:V,pinchAround:$}=s;$!==void 0&&(V=$),g._stop(!0),V=V||g.transform.centerPoint;const it=v.pointLocation(L?V.sub(L):V);N&&(v.bearing+=N),O&&(v.pitch+=O),P&&(v.zoom+=P),C?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(L)):v.setLocationAtPoint(it,V):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(it,V),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(g.terrain)})):v.setLocationAtPoint(it,V),g._applyUpdatedTransform(v),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(f,d,!0)}_fireEvents(s,f,d){const g=ke(this._eventsInProgress),v=ke(s),C={};for(const O in s){const{originalEvent:V}=s[O];this._eventsInProgress[O]||(C[`${O}start`]=V),this._eventsInProgress[O]=s[O]}!g&&v&&this._fireEvent("movestart",v.originalEvent);for(const O in C)this._fireEvent(O,C[O]);v&&this._fireEvent("move",v.originalEvent);for(const O in s){const{originalEvent:V}=s[O];this._fireEvent(O,V)}const L={};let P;for(const O in this._eventsInProgress){const{handlerName:V,originalEvent:$}=this._eventsInProgress[O];this._handlersById[V].isActive()||(delete this._eventsInProgress[O],P=f[V]||$,L[`${O}end`]=P)}for(const O in L)this._fireEvent(O,L[O]);const N=ke(this._eventsInProgress);if(d&&(g||v)&&!N){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!O||!O.essential&&E.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:P})),V(this._map.getBearing())&&this._map.resetNorth()):(V(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:P})),this._updatingCamera=!1}}_fireEvent(s,f){this._map.fire(new u.k(s,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new qe("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Hf extends u.E{constructor(s,f){super(),this._renderFrameCallback=()=>{const d=Math.min((E.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.M(this.transform.center.lng,this.transform.center.lat)}setCenter(s,f){return this.jumpTo({center:s},f)}panBy(s,f,d){return s=u.P.convert(s).mult(-1),this.panTo(this.transform.center,u.e({offset:s},f),d)}panTo(s,f,d){return this.easeTo(u.e({center:s},f),d)}getZoom(){return this.transform.zoom}setZoom(s,f){return this.jumpTo({zoom:s},f),this}zoomTo(s,f,d){return this.easeTo(u.e({zoom:s},f),d)}zoomIn(s,f){return this.zoomTo(this.getZoom()+1,s,f),this}zoomOut(s,f){return this.zoomTo(this.getZoom()-1,s,f),this}getBearing(){return this.transform.bearing}setBearing(s,f){return this.jumpTo({bearing:s},f),this}getPadding(){return this.transform.padding}setPadding(s,f){return this.jumpTo({padding:s},f),this}rotateTo(s,f,d){return this.easeTo(u.e({bearing:s},f),d)}resetNorth(s,f){return this.rotateTo(0,u.e({duration:1e3},s),f),this}resetNorthPitch(s,f){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},s),f),this}snapToNorth(s,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,f):this}getPitch(){return this.transform.pitch}setPitch(s,f){return this.jumpTo({pitch:s},f),this}cameraForBounds(s,f){s=Le.convert(s);const d=f&&f.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),d,f)}_cameraForBoxAndBearing(s,f,d,g){const v={top:0,bottom:0,right:0,left:0};if(typeof(g=u.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Se=g.padding;g.padding={top:Se,bottom:Se,right:Se,left:Se}}g.padding=u.e(v,g.padding);const C=this.transform,L=C.padding,P=new Le(s,f),N=C.project(P.getNorthWest()),O=C.project(P.getNorthEast()),V=C.project(P.getSouthEast()),$=C.project(P.getSouthWest()),it=u.b7(-d),rt=N.rotate(it),at=O.rotate(it),et=V.rotate(it),It=$.rotate(it),Rt=new u.P(Math.max(rt.x,at.x,It.x,et.x),Math.max(rt.y,at.y,It.y,et.y)),ft=new u.P(Math.min(rt.x,at.x,It.x,et.x),Math.min(rt.y,at.y,It.y,et.y)),kt=Rt.sub(ft),Ut=(C.width-(L.left+L.right+g.padding.left+g.padding.right))/kt.x,Ft=(C.height-(L.top+L.bottom+g.padding.top+g.padding.bottom))/kt.y;if(Ft<0||Ut<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Kt=Math.min(C.scaleZoom(C.scale*Math.min(Ut,Ft)),g.maxZoom),ee=u.P.convert(g.offset),Qt=new u.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(u.b7(d)),ae=ee.add(Qt).mult(C.scale/C.zoomScale(Kt));return{center:C.unproject(N.add(V).div(2).sub(ae)),zoom:Kt,bearing:d}}fitBounds(s,f,d){return this._fitInternal(this.cameraForBounds(s,f),f,d)}fitScreenCoordinates(s,f,d,g,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(s)),this.transform.pointLocation(u.P.convert(f)),d,g),g,v)}_fitInternal(s,f,d){return s?(delete(f=u.e(s,f)).padding,f.linear?this.easeTo(f,d):this.flyTo(f,d)):this}jumpTo(s,f){this.stop();const d=this._getTransformForUpdate();let g=!1,v=!1,C=!1;return"zoom"in s&&d.zoom!==+s.zoom&&(g=!0,d.zoom=+s.zoom),s.center!==void 0&&(d.center=u.M.convert(s.center)),"bearing"in s&&d.bearing!==+s.bearing&&(v=!0,d.bearing=+s.bearing),"pitch"in s&&d.pitch!==+s.pitch&&(C=!0,d.pitch=+s.pitch),s.padding==null||d.isPaddingEqual(s.padding)||(d.padding=s.padding),this._applyUpdatedTransform(d),this.fire(new u.k("movestart",f)).fire(new u.k("move",f)),g&&this.fire(new u.k("zoomstart",f)).fire(new u.k("zoom",f)).fire(new u.k("zoomend",f)),v&&this.fire(new u.k("rotatestart",f)).fire(new u.k("rotate",f)).fire(new u.k("rotateend",f)),C&&this.fire(new u.k("pitchstart",f)).fire(new u.k("pitch",f)).fire(new u.k("pitchend",f)),this.fire(new u.k("moveend",f))}calculateCameraOptionsFromTo(s,f,d,g=0){const v=u.Y.fromLngLat(s,f),C=u.Y.fromLngLat(d,g),L=C.x-v.x,P=C.y-v.y,N=C.z-v.z,O=Math.hypot(L,P,N);if(O===0)throw new Error("Can't calculate camera options with same From and To");const V=Math.hypot(L,P),$=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),it=180*Math.atan2(L,-P)/Math.PI;let rt=180*Math.acos(V/O)/Math.PI;return rt=N<0?90-rt:90+rt,{center:C.toLngLat(),zoom:$,pitch:rt,bearing:it}}easeTo(s,f){this._stop(!1,s.easeId),((s=u.e({offset:[0,0],duration:500,easing:u.b6},s)).animate===!1||!s.essential&&E.prefersReducedMotion)&&(s.duration=0);const d=this._getTransformForUpdate(),g=this.getZoom(),v=this.getBearing(),C=this.getPitch(),L=this.getPadding(),P="zoom"in s?+s.zoom:g,N="bearing"in s?this._normalizeBearing(s.bearing,v):v,O="pitch"in s?+s.pitch:C,V="padding"in s?s.padding:d.padding,$=u.P.convert(s.offset);let it=d.centerPoint.add($);const rt=d.pointLocation(it),at=u.M.convert(s.center||rt);this._normalizeCenter(at);const et=d.project(rt),It=d.project(at).sub(et),Rt=d.zoomScale(P-g);let ft,kt;s.around&&(ft=u.M.convert(s.around),kt=d.locationPoint(ft));const Ut={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||P!==g,this._rotating=this._rotating||v!==N,this._pitching=this._pitching||O!==C,this._padding=!d.isPaddingEqual(V),this._easeId=s.easeId,this._prepareEase(f,s.noMoveStart,Ut),this.terrain&&this._prepareElevation(at),this._ease(Ft=>{if(this._zooming&&(d.zoom=u.z.number(g,P,Ft)),this._rotating&&(d.bearing=u.z.number(v,N,Ft)),this._pitching&&(d.pitch=u.z.number(C,O,Ft)),this._padding&&(d.interpolatePadding(L,V,Ft),it=d.centerPoint.add($)),this.terrain&&!s.freezeElevation&&this._updateElevation(Ft),ft)d.setLocationAtPoint(ft,kt);else{const Kt=d.zoomScale(d.zoom-g),ee=P>g?Math.min(2,Rt):Math.max(.5,Rt),Qt=Math.pow(ee,1-Ft),ae=d.unproject(et.add(It.mult(Ft*Qt)).mult(Kt));d.setLocationAtPoint(d.renderWorldCopies?ae.wrap():ae,it)}this._applyUpdatedTransform(d),this._fireMoveEvents(f)},Ft=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,Ft)},s),this}_prepareEase(s,f,d={}){this._moving=!0,f||d.moving||this.fire(new u.k("movestart",s)),this._zooming&&!d.zooming&&this.fire(new u.k("zoomstart",s)),this._rotating&&!d.rotating&&this.fire(new u.k("rotatestart",s)),this._pitching&&!d.pitching&&this.fire(new u.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&f!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(d-(f-(d*s+this._elevationStart))/(1-s)),this._elevationTarget=f}this.transform.elevation=u.z.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const f=s.clone(),{center:d,zoom:g,pitch:v,bearing:C,elevation:L}=this.transformCameraUpdate(f);d&&(f.center=d),g!==void 0&&(f.zoom=g),v!==void 0&&(f.pitch=v),C!==void 0&&(f.bearing=C),L!==void 0&&(f.elevation=L),this.transform.apply(f)}_fireMoveEvents(s){this.fire(new u.k("move",s)),this._zooming&&this.fire(new u.k("zoom",s)),this._rotating&&this.fire(new u.k("rotate",s)),this._pitching&&this.fire(new u.k("pitch",s))}_afterEase(s,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const d=this._zooming,g=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new u.k("zoomend",s)),g&&this.fire(new u.k("rotateend",s)),v&&this.fire(new u.k("pitchend",s)),this.fire(new u.k("moveend",s))}flyTo(s,f){if(!s.essential&&E.prefersReducedMotion){const Te=u.L(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Te,f)}this.stop(),s=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b6},s);const d=this._getTransformForUpdate(),g=this.getZoom(),v=this.getBearing(),C=this.getPitch(),L=this.getPadding(),P="zoom"in s?u.ac(+s.zoom,d.minZoom,d.maxZoom):g,N="bearing"in s?this._normalizeBearing(s.bearing,v):v,O="pitch"in s?+s.pitch:C,V="padding"in s?s.padding:d.padding,$=d.zoomScale(P-g),it=u.P.convert(s.offset);let rt=d.centerPoint.add(it);const at=d.pointLocation(rt),et=u.M.convert(s.center||at);this._normalizeCenter(et);const It=d.project(at),Rt=d.project(et).sub(It);let ft=s.curve;const kt=Math.max(d.width,d.height),Ut=kt/$,Ft=Rt.mag();if("minZoom"in s){const Te=u.ac(Math.min(s.minZoom,g,P),d.minZoom,d.maxZoom),hi=kt/d.zoomScale(Te-g);ft=Math.sqrt(hi/Ft*2)}const Kt=ft*ft;function ee(Te){const hi=(Ut*Ut-kt*kt+(Te?-1:1)*Kt*Kt*Ft*Ft)/(2*(Te?Ut:kt)*Kt*Ft);return Math.log(Math.sqrt(hi*hi+1)-hi)}function Qt(Te){return(Math.exp(Te)-Math.exp(-Te))/2}function ae(Te){return(Math.exp(Te)+Math.exp(-Te))/2}const Se=ee(!1);let Ue=function(Te){return ae(Se)/ae(Se+ft*Te)},me=function(Te){return kt*((ae(Se)*(Qt(hi=Se+ft*Te)/ae(hi))-Qt(Se))/Kt)/Ft;var hi},Ve=(ee(!0)-Se)/ft;if(Math.abs(Ft)<1e-6||!isFinite(Ve)){if(Math.abs(kt-Ut)<1e-6)return this.easeTo(s,f);const Te=Ut<kt?-1:1;Ve=Math.abs(Math.log(Ut/kt))/ft,me=function(){return 0},Ue=function(hi){return Math.exp(Te*ft*hi)}}return s.duration="duration"in s?+s.duration:1e3*Ve/("screenSpeed"in s?+s.screenSpeed/ft:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==N,this._pitching=O!==C,this._padding=!d.isPaddingEqual(V),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(et),this._ease(Te=>{const hi=Te*Ve,vn=1/Ue(hi);d.zoom=Te===1?P:g+d.scaleZoom(vn),this._rotating&&(d.bearing=u.z.number(v,N,Te)),this._pitching&&(d.pitch=u.z.number(C,O,Te)),this._padding&&(d.interpolatePadding(L,V,Te),rt=d.centerPoint.add(it)),this.terrain&&!s.freezeElevation&&this._updateElevation(Te);const fn=Te===1?et:d.unproject(It.add(Rt.mult(me(hi))).mult(vn));d.setLocationAtPoint(d.renderWorldCopies?fn.wrap():fn,rt),this._applyUpdatedTransform(d),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,f)}if(!s){const d=this.handlers;d&&d.stop(!1)}return this}_ease(s,f,d){d.animate===!1||d.duration===0?(s(1),f()):(this._easeStart=E.now(),this._easeOptions=d,this._onEaseFrame=s,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,f){s=u.b0(s,-180,180);const d=Math.abs(s-f);return Math.abs(s-360-f)<d&&(s-=360),Math.abs(s+360-f)<d&&(s+=360),s}_normalizeCenter(s){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const d=s.lng-f.center.lng;s.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(u.M.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const uo={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class $f{constructor(s=uo){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=M.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=M.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,f){const d=this._map._getUIString(`AttributionControl.${f}`);s.title=d,s.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const f=this._map.style.sourceCaches;for(const g in f){const v=f[g];if(v.used||v.usedForTerrain){const C=v.getSource();C.attribution&&s.indexOf(C.attribution)<0&&s.push(C.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,v)=>g.length-v.length),s=s.filter((g,v)=>{for(let C=v+1;C<s.length;C++)if(s[C].indexOf(g)>=0)return!1;return!0});const d=s.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,s.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ss{constructor(s={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const d=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=M.create("div","maplibregl-ctrl");const f=M.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class a_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const f=++this._id;return this._queue.push({callback:s,id:f,cancelled:!1}),f}remove(s){const f=this._currentlyRunning,d=f?this._queue.concat(f):this._queue;for(const g of d)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const d of f)if(!d.cancelled&&(d.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var sc=u.X([{name:"a_pos3d",type:"Int16",components:3}]);class Li extends u.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,f){this.sourceCache.update(s,f),this._renderableTilesKeys=[];const d={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))d[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),u.aN(g.posMatrix,0,u.W,0,u.W,0,1),this._tiles[g.key]=new es(g,this.tileSize));for(const g in this._tiles)d[g]||delete this._tiles[g]}freeRtt(s){for(const f in this._tiles){const d=this._tiles[f];(!s||d.tileID.equals(s)||d.tileID.isChildOf(s)||s.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const f={};for(const d of this._renderableTilesKeys){const g=this._tiles[d].tileID;if(g.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),u.aN(v.posMatrix,0,u.W,0,u.W,0,1),f[d]=v}else if(g.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const C=g.canonical.z-s.canonical.z,L=g.canonical.x-(g.canonical.x>>C<<C),P=g.canonical.y-(g.canonical.y>>C<<C),N=u.W>>C;u.aN(v.posMatrix,0,N,0,N,0,1),u.H(v.posMatrix,v.posMatrix,[-L*N,-P*N,0]),f[d]=v}else if(s.canonical.isChildOf(g.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const C=s.canonical.z-g.canonical.z,L=s.canonical.x-(s.canonical.x>>C<<C),P=s.canonical.y-(s.canonical.y>>C<<C),N=u.W>>C;u.aN(v.posMatrix,0,u.W,0,u.W,0,1),u.H(v.posMatrix,v.posMatrix,[L*N,P*N,0]),u.J(v.posMatrix,v.posMatrix,[1/2**C,1/2**C,0]),f[d]=v}}return f}getSourceTile(s,f){const d=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>d.maxzoom&&(g=d.maxzoom),g<d.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&f)for(;g>=d.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(g--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=s)}}class Gi{constructor(s,f,d){this.painter=s,this.sourceCache=new Li(f),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,f,d,g=u.W){var v;if(!(f>=0&&f<g&&d>=0&&d<g))return 0;const C=this.getTerrainData(s),L=(v=C.tile)===null||v===void 0?void 0:v.dem;if(!L)return 0;const P=function(rt,at,et){var It=at[0],Rt=at[1];return rt[0]=et[0]*It+et[4]*Rt+et[12],rt[1]=et[1]*It+et[5]*Rt+et[13],rt}([],[f/g*u.W,d/g*u.W],C.u_terrain_matrix),N=[P[0]*L.dim,P[1]*L.dim],O=Math.floor(N[0]),V=Math.floor(N[1]),$=N[0]-O,it=N[1]-V;return L.get(O,V)*(1-$)*(1-it)+L.get(O+1,V)*$*(1-it)+L.get(O,V+1)*(1-$)*it+L.get(O+1,V+1)*$*it}getElevationForLngLatZoom(s,f){const{tileID:d,mercatorX:g,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(s,f);return this.getElevation(d,g%u.W,v%u.W,u.W)}getElevation(s,f,d,g=u.W){return this.getDEMElevation(s,f,d,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,v=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new _t(g,v,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new _t(g,new u.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const f=this.sourceCache.getSourceTile(s,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const g=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new _t(g,f.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),f.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const d=f&&f+f.tileID.key+s.key;if(d&&!this._demMatrixCache[d]){const g=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-f.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?v=s.canonical.z-g:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=s.canonical.x-(s.canonical.x>>v<<v),L=s.canonical.y-(s.canonical.y>>v<<v),P=u.b8(new Float64Array(16),[1/(u.W<<v),1/(u.W<<v),0]);u.H(P,P,[C*u.W,L*u.W,0]),this._demMatrixCache[s.key]={matrix:P,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(s){const f=this.painter,d=f.width/devicePixelRatio,g=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new _t(f.context,{width:d,height:g,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new _t(f.context,{width:d,height:g,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(d,g,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,d,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,C=0;v<this._coordsTextureSize;v++)for(let L=0;L<this._coordsTextureSize;L++,C+=4)f[C+0]=255&L,f[C+1]=255&v,f[C+2]=L>>8<<4|v>>8,f[C+3]=0;const d=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),g=new _t(s,d,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){const f=new Uint8Array(4),d=this.painter.context,g=d.gl;d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,f),d.bindFramebuffer.set(null);const v=f[0]+(f[2]>>4<<8),C=f[1]+((15&f[2])<<8),L=this.coordsIndex[255-f[3]],P=L&&this.sourceCache.getTileByID(L);if(!P)return null;const N=this._coordsTextureSize,O=(1<<P.tileID.canonical.z)*N;return new u.Y((P.tileID.canonical.x*N+v)/O+P.tileID.wrap,(P.tileID.canonical.y*N+C)/O,this.getElevation(P.tileID,v,C,N))}depthAtPoint(s){const f=new Uint8Array(4),d=this.painter.context,g=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,f),d.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,f=new u.b9,d=new u.aX,g=this.meshSize,v=u.W/g,C=g*g;for(let V=0;V<=g;V++)for(let $=0;$<=g;$++)f.emplaceBack($*v,V*v,0);for(let V=0;V<C;V+=g+1)for(let $=0;$<g;$++)d.emplaceBack($+V,g+$+V+1,g+$+V+2),d.emplaceBack($+V,g+$+V+2,$+V+1);const L=f.length,P=L+2*(g+1);for(const V of[0,1])for(let $=0;$<=g;$++)for(const it of[0,1])f.emplaceBack($*v,V*u.W,it);for(let V=0;V<2*g;V+=2)d.emplaceBack(P+V,P+V+1,P+V+3),d.emplaceBack(P+V,P+V+3,P+V+2),d.emplaceBack(L+V,L+V+3,L+V+1),d.emplaceBack(L+V,L+V+2,L+V+3);const N=f.length,O=N+2*(g+1);for(const V of[0,1])for(let $=0;$<=g;$++)for(const it of[0,1])f.emplaceBack(V*u.W,$*v,it);for(let V=0;V<2*g;V+=2)d.emplaceBack(N+V,N+V+1,N+V+3),d.emplaceBack(N+V,N+V+3,N+V+2),d.emplaceBack(O+V,O+V+3,O+V+1),d.emplaceBack(O+V,O+V+2,O+V+3);return this._mesh={indexBuffer:s.createIndexBuffer(d),vertexBuffer:s.createVertexBuffer(f,sc.members),segments:u.$.simpleSegment(0,0,f.length,d.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*u.ba/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,f){var d;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,f);return(d=this.getMinMaxElevation(g).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(s){const f=this.getTerrainData(s).tile,d={minElevation:null,maxElevation:null};return f&&f.dem&&(d.minElevation=f.dem.min*this.exaggeration,d.maxElevation=f.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(s,f){const d=u.Y.fromLngLat(s.wrap()),g=(1<<f)*u.W,v=d.x*g,C=d.y*g,L=Math.floor(v/u.W),P=Math.floor(C/u.W);return{tileID:new u.Q(f,0,f,L,P),mercatorX:v,mercatorY:C}}}class om{constructor(s,f,d){this._context=s,this._size=f,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new _t(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(d.texture),{id:s,fbo:f,texture:d,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>s.id!==f),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const qs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class gh{constructor(s,f){this.painter=s,this.terrain=f,this.pool=new om(s.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(d=>!s._layers[d].isHidden(f)),this._coordsDescendingInv={};for(const d in s.sourceCaches){this._coordsDescendingInv[d]={};const g=s.sourceCaches[d].getVisibleCoordinates();for(const v of g){const C=this.terrain.sourceCache.getTerrainCoords(v);for(const L in C)this._coordsDescendingInv[d][L]||(this._coordsDescendingInv[d][L]=[]),this._coordsDescendingInv[d][L].push(C[L])}}this._coordsDescendingInvStr={};for(const d of s._order){const g=s._layers[d],v=g.source;if(qs[g.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const C in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][C]=this._coordsDescendingInv[v][C].map(L=>L.key).sort().join()}}for(const d of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[g][d.tileID.key];v&&v!==d.rttCoords[g]&&(d.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const f=s.type,d=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(qs[f]&&(this._prevType&&qs[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(qs[this._prevType]||qs[f]&&g){this._prevType=f;const v=this._stacks.length-1,C=this._stacks[v]||[];for(const L of this._renderableTiles){if(this.pool.isFull()&&(uh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(L),L.rtt[v]){const N=this.pool.getObjectForId(L.rtt[v].id);if(N.stamp===L.rtt[v].stamp){this.pool.useObject(N);continue}}const P=this.pool.getOrCreateFreeObject();this.pool.useObject(P),this.pool.stampObject(P),L.rtt[v]={id:P.id,stamp:P.stamp},d.context.bindFramebuffer.set(P.fbo.framebuffer),d.context.clear({color:u.aO.transparent,stencil:0}),d.currentStencilSource=void 0;for(let N=0;N<C.length;N++){const O=d.style._layers[C[N]],V=O.source?this._coordsDescendingInv[O.source][L.tileID.key]:[L.tileID];d.context.viewport.set([0,0,P.fbo.width,P.fbo.height]),d._renderTileClippingMasks(O,V),d.renderLayer(d,d.style.sourceCaches[O.source],O,V),O.source&&(L.rttCoords[O.source]=this._coordsDescendingInvStr[O.source][L.tileID.key])}}return uh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),qs[f]}return!1}}const Xf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Yf=_,Kf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:uo,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},hu=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Jf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Qf{constructor(s,f,d=!1){this.mousedown=C=>{this.startMouse(u.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),M.mousePos(this.element,C)),M.addEventListener(window,"mousemove",this.mousemove),M.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,M.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),M.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),v=s.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=jf({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:L,bearingDegreesPerPixelMoved:P=.8})=>{const N=new ya;return new nc({clickTolerance:L,move:(O,V)=>({bearingDelta:(V.x-O.x)*P}),moveStateManager:N,enable:C,assignEvents:hu})})({clickTolerance:g,enable:!0}),this.map=s,d&&(this.mousePitch=uu({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:L,pitchDegreesPerPixelMoved:P=-.5})=>{const N=new ya;return new nc({clickTolerance:L,move:(O,V)=>({pitchDelta:(V.y-O.y)*P}),moveStateManager:N,enable:C,assignEvents:hu})})({clickTolerance:v,enable:!0})),M.addEventListener(f,"mousedown",this.mousedown),M.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(f,"touchcancel",this.reset)}startMouse(s,f){this.mouseRotate.dragStart(s,f),this.mousePitch&&this.mousePitch.dragStart(s,f),M.disableDrag()}startTouch(s,f){this.touchRotate.dragStart(s,f),this.touchPitch&&this.touchPitch.dragStart(s,f),M.disableDrag()}moveMouse(s,f){const d=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,f)||{};if(g&&d.setBearing(d.getBearing()+g),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(s,f)||{};v&&d.setPitch(d.getPitch()+v)}}moveTouch(s,f){const d=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,f)||{};if(g&&d.setBearing(d.getBearing()+g),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(s,f)||{};v&&d.setPitch(d.getPitch()+v)}}off(){const s=this.element;M.removeEventListener(s,"mousedown",this.mousedown),M.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend),M.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(window,"mousemove",this.mousemove),M.removeEventListener(window,"mouseup",this.mouseup),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend)}}let va;function _h(y,s,f){const d=new u.M(y.lng,y.lat);if(y=new u.M(y.lng,y.lat),s){const g=new u.M(y.lng-360,y.lat),v=new u.M(y.lng+360,y.lat),C=f.locationPoint(y).distSqr(s);f.locationPoint(g).distSqr(s)<C?y=g:f.locationPoint(v).distSqr(s)<C&&(y=v)}for(;Math.abs(y.lng-f.center.lng)>180;){const g=f.locationPoint(y);if(g.x>=0&&g.y>=0&&g.x<=f.width&&g.y<=f.height)break;y.lng>f.center.lng?y.lng-=360:y.lng+=360}return y.lng!==d.lng&&f.locationPoint(y).y>f.height/2-f.getHorizon()?y:d}const ac={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yh(y,s,f){const d=y.classList;for(const g in ac)d.remove(`maplibregl-${f}-anchor-${g}`);d.add(`maplibregl-${f}-anchor-${s}`)}class lc extends u.E{constructor(s){if(super(),this._onKeyPress=f=>{const d=f.code,g=f.charCode||f.keyCode;d!=="Space"&&d!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=f=>{const d=f.originalEvent.target,g=this._element;this._popup&&(d===g||g.contains(d))&&this.togglePopup()},this._update=f=>{if(!this._map)return;const d=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!d)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=_h(this._lngLat,this._flatPos,this._map.transform)),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),M.setTransform(this._element,`${ac[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${g}`),E.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=u.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const f=M.createNS("http://www.w3.org/2000/svg","svg"),d=41,g=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${d}px`),f.setAttributeNS(null,"width",`${g}px`),f.setAttributeNS(null,"viewBox",`0 0 ${g} ${d}`);const v=M.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const C=M.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const L=M.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");const P=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const It of P){const Rt=M.createNS("http://www.w3.org/2000/svg","ellipse");Rt.setAttributeNS(null,"opacity","0.04"),Rt.setAttributeNS(null,"cx","10.5"),Rt.setAttributeNS(null,"cy","5.80029008"),Rt.setAttributeNS(null,"rx",It.rx),Rt.setAttributeNS(null,"ry",It.ry),L.appendChild(Rt)}const N=M.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const O=M.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(O);const V=M.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const $=M.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild($);const it=M.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"transform","translate(6.0, 7.0)"),it.setAttributeNS(null,"fill","#FFFFFF");const rt=M.createNS("http://www.w3.org/2000/svg","g");rt.setAttributeNS(null,"transform","translate(8.0, 8.0)");const at=M.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#000000"),at.setAttributeNS(null,"opacity","0.25"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962");const et=M.createNS("http://www.w3.org/2000/svg","circle");et.setAttributeNS(null,"fill","#FFFFFF"),et.setAttributeNS(null,"cx","5.5"),et.setAttributeNS(null,"cy","5.5"),et.setAttributeNS(null,"r","5.4999962"),rt.appendChild(at),rt.appendChild(et),C.appendChild(L),C.appendChild(N),C.appendChild(V),C.appendChild(it),C.appendChild(rt),f.appendChild(C),f.setAttributeNS(null,"height",d*this._scale+"px"),f.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(f),this._offset=u.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),yh(this._element,this._anchor,"marker"),s&&s.className)for(const f of s.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=u.M.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_updateOpacity(s=!1){var f;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const d=this._map,g=d.terrain.depthAtPoint(this._pos),v=d.terrain.getElevationForLngLatZoom(this._lngLat,d.transform.tileZoom);if(d.transform.lngLatToCameraDepth(this._lngLat,v)-g<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/d.transform._pixelPerMeter,L=Math.sin(d.getPitch()*Math.PI/180)*C,P=d.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),N=d.transform.lngLatToCameraDepth(this._lngLat,v+L);this._element.style.opacity=N-P>.006?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=u.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,f){return s===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const tp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Tl=0,Ll=!1;const ep={maxWidth:100,unit:"metric"};function uc(y,s,f){const d=f&&f.maxWidth||100,g=y._container.clientHeight/2,v=y.unproject([0,g]),C=y.unproject([d,g]),L=v.distanceTo(C);if(f&&f.unit==="imperial"){const P=3.2808*L;P>5280?Ml(s,d,P/5280,y._getUIString("ScaleControl.Miles")):Ml(s,d,P,y._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Ml(s,d,L/1852,y._getUIString("ScaleControl.NauticalMiles")):L>=1e3?Ml(s,d,L/1e3,y._getUIString("ScaleControl.Kilometers")):Ml(s,d,L,y._getUIString("ScaleControl.Meters"))}function Ml(y,s,f,d){const g=function(v){const C=Math.pow(10,`${Math.floor(v)}`.length-1);let L=v/C;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(P){const N=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*N)/N}(L),C*L}(f);y.style.width=s*(g/f)+"px",y.innerHTML=`${g}&nbsp;${d}`}const np={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ip=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vh(y){if(y){if(typeof y=="number"){const s=Math.round(Math.abs(y)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,y),"top-left":new u.P(s,s),"top-right":new u.P(-s,s),bottom:new u.P(0,-y),"bottom-left":new u.P(s,-s),"bottom-right":new u.P(-s,-s),left:new u.P(y,0),right:new u.P(-y,0)}}if(y instanceof u.P||Array.isArray(y)){const s=u.P.convert(y);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:u.P.convert(y.center||[0,0]),top:u.P.convert(y.top||[0,0]),"top-left":u.P.convert(y["top-left"]||[0,0]),"top-right":u.P.convert(y["top-right"]||[0,0]),bottom:u.P.convert(y.bottom||[0,0]),"bottom-left":u.P.convert(y["bottom-left"]||[0,0]),"bottom-right":u.P.convert(y["bottom-right"]||[0,0]),left:u.P.convert(y.left||[0,0]),right:u.P.convert(y.right||[0,0])}}return vh(new u.P(0,0))}const rp=_;h.AJAXError=u.bd,h.Evented=u.E,h.LngLat=u.M,h.MercatorCoordinate=u.Y,h.Point=u.P,h.addProtocol=u.be,h.config=u.a,h.removeProtocol=u.bf,h.AttributionControl=$f,h.BoxZoomHandler=Uf,h.CanvasSource=Us,h.CooperativeGesturesHandler=oc,h.DoubleClickZoomHandler=mh,h.DragPanHandler=Zf,h.DragRotateHandler=rm,h.EdgeInsets=au,h.FullscreenControl=class extends u.E{constructor(y={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=M.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);M.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=dn,h.GeolocateControl=class extends u.E{constructor(y){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const f=new u.M(s.coords.longitude,s.coords.latitude),d=s.coords.accuracy,g=this._map.getBearing(),v=u.e({bearing:g},this.options.fitBoundsOptions),C=Le.fromLngLat(f,d);this._map.fitBounds(C,v,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const f=new u.M(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&Ll)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=M.create("button","maplibregl-ctrl-geolocate",this._container),M.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new lc({element:this._dotElement}),this._circleElement=M.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")))})}},this.options=u.e({},tp,y)}onAdd(y){return this._map=y,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(s=!1){return u._(this,void 0,void 0,function*(){if(va!==void 0&&!s)return va;if(window.navigator.permissions===void 0)return va=!!window.navigator.geolocation,va;try{va=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{va=!!window.navigator.geolocation}return va})}().then(s=>this._setupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Tl=0,Ll=!1}_isOutOfMapMaxBounds(y){const s=this._map.getMaxBounds(),f=y.coords;return s&&(f.longitude<s.getWest()||f.longitude>s.getEast()||f.latitude<s.getSouth()||f.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),s=y.getSouthEast(),f=y.getNorthEast(),d=s.distanceTo(f),g=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Tl--,Ll=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Tl++,Tl>1?(y={maximumAge:6e5,timeout:0},Ll=!0):(y=this.options.positionOptions,Ll=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.Hash=Vf,h.ImageSource=Dr,h.KeyboardHandler=em,h.LngLatBounds=Le,h.LogoControl=Ss,h.Map=class extends Hf{constructor(y){if(u.bb.mark(u.bc.create),(y=u.e({},Kf,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ch(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new a_,this._controls=[],this._mapId=u.a3(),this._locale=u.e({},Xf,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=U.addThrottleControl(()=>this.isMoving()),this._requestManager=new Q(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const f=Bf(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{s?f(d):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wf(this,y),this._hash=y.hash&&new Vf(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,u.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new $f(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Ss,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new u.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new u.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new u.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(y,s){if(s===void 0&&(s=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[s];return s.indexOf("bottom")!==-1?d.insertBefore(f,d.firstChild):d.appendChild(f),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(y);return s>-1&&this._controls.splice(s,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,s,f,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,s,f,d)}resize(y){var s;const f=this._containerDimensions(),d=f[0],g=f[1],v=this._getClampedPixelRatio(d,g);if(this._resizeCanvas(d,g,v),this.painter.resize(d,g,v),this.painter.overLimit()){const L=this.painter.context.gl;this._maxCanvasSize=[L.drawingBufferWidth,L.drawingBufferHeight];const P=this._getClampedPixelRatio(d,g);this._resizeCanvas(d,g,P),this.painter.resize(d,g,P)}this.transform.resize(d,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(d,g);const C=!this._moving;return C&&(this.stop(),this.fire(new u.k("movestart",y)).fire(new u.k("move",y))),this.fire(new u.k("resize",y)),C&&this.fire(new u.k("moveend",y)),this}_getClampedPixelRatio(y,s){const{0:f,1:d}=this._maxCanvasSize,g=this.getPixelRatio(),v=y*g,C=s*g;return Math.min(v>f?f/v:1,C>d?d/C:1)*g}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Le.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(u.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(u.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,s,f){if(y==="mouseenter"||y==="mouseover"){let d=!1;return{layer:s,listener:f,delegates:{mousemove:v=>{const C=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];C.length?d||(d=!0,f.call(this,new Io(y,this,v.originalEvent,{features:C}))):d=!1},mouseout:()=>{d=!1}}}}if(y==="mouseleave"||y==="mouseout"){let d=!1;return{layer:s,listener:f,delegates:{mousemove:C=>{(this.getLayer(s)?this.queryRenderedFeatures(C.point,{layers:[s]}):[]).length?d=!0:d&&(d=!1,f.call(this,new Io(y,this,C.originalEvent)))},mouseout:C=>{d&&(d=!1,f.call(this,new Io(y,this,C.originalEvent)))}}}}{const d=g=>{const v=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];v.length&&(g.features=v,f.call(this,g),delete g.features)};return{layer:s,listener:f,delegates:{[y]:d}}}}on(y,s,f){if(f===void 0)return super.on(y,s);const d=this._createDelegatedListener(y,s,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(y,s,f){if(f===void 0)return super.once(y,s);const d=this._createDelegatedListener(y,s,f);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(y,s,f){return f===void 0?super.off(y,s):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const g=this._delegatedListeners[y];for(let v=0;v<g.length;v++){const C=g[v];if(C.layer===s&&C.listener===f){for(const L in C.delegates)this.off(L,C.delegates[L]);return g.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,s){if(!this.style)return[];let f;const d=y instanceof u.P||Array.isArray(y),g=d?y:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(d?{}:y)||{},g instanceof u.P||typeof g[0]=="number")f=[u.P.convert(g)];else{const v=u.P.convert(g[0]),C=u.P.convert(g[1]);f=[v,new u.P(C.x,v.y),C,new u.P(v.x,C.y),v]}return this.style.queryRenderedFeatures(f,s,this.transform)}querySourceFeatures(y,s){return this.style.querySourceFeatures(y,s)}setStyle(y,s){return(s=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(y,s))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const s=this._locale[y];if(s==null)throw new Error(`Missing UI string '${y}'`);return s}_updateStyle(y,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,s));const f=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Bo(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,s,f):this.style.loadJSON(y,s,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Bo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,s){if(typeof y=="string"){const f=this._requestManager.transformRequest(y,W.Style);u.h(f,new AbortController).then(d=>{this._updateDiff(d.data,s)}).catch(d=>{d&&this.fire(new u.j(d))})}else typeof y=="object"&&this._updateDiff(y,s)}_updateDiff(y,s){try{this.style.setState(y,s)&&this._update(!0)}catch(f){u.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(y,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(y,s){return this._lazyInitEmptyStyle(),this.style.addSource(y,s),this._update(!0)}isSourceLoaded(y){const s=this.style&&this.style.sourceCaches[y];if(s!==void 0)return s.loaded();this.fire(new u.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const s=this.style.sourceCaches[y.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&s.reload();for(const f in this.style._layers){const d=this.style._layers[f];d.type==="hillshade"&&d.source===y.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gi(this.painter,s,y),this.painter.renderToTexture=new gh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:y})),this}getTerrain(){var y,s;return(s=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const s in y){const f=y[s]._tiles;for(const d in f){const g=f[d];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,s,f={}){const{pixelRatio:d=1,sdf:g=!1,stretchX:v,stretchY:C,content:L}=f;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||u.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:N,data:O}=s,V=s;return this.style.addImage(y,{data:new u.R({width:P,height:N},new Uint8Array(O)),pixelRatio:d,stretchX:v,stretchY:C,content:L,sdf:g,version:0,userImage:V}),V.onAdd&&V.onAdd(this,y),this}}{const{width:P,height:N,data:O}=E.getImageData(s);this.style.addImage(y,{data:new u.R({width:P,height:N},O),pixelRatio:d,stretchX:v,stretchY:C,content:L,sdf:g,version:0})}}updateImage(y,s){const f=this.style.getImage(y);if(!f)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=s instanceof HTMLImageElement||u.b(s)?E.getImageData(s):s,{width:g,height:v,data:C}=d;if(g===void 0||v===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==f.data.width||v!==f.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const L=!(s instanceof HTMLImageElement||u.b(s));return f.data.replace(C,L),this.style.updateImage(y,f),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return U.getImage(this._requestManager.transformRequest(y,W.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,s){return this._lazyInitEmptyStyle(),this.style.addLayer(y,s),this._update(!0)}moveLayer(y,s){return this.style.moveLayer(y,s),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,s,f){return this.style.setLayerZoomRange(y,s,f),this._update(!0)}setFilter(y,s,f={}){return this.style.setFilter(y,s,f),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,s,f,d={}){return this.style.setPaintProperty(y,s,f,d),this._update(!0)}getPaintProperty(y,s){return this.style.getPaintProperty(y,s)}setLayoutProperty(y,s,f,d={}){return this.style.setLayoutProperty(y,s,f,d),this._update(!0)}getLayoutProperty(y,s){return this.style.getLayoutProperty(y,s)}setGlyphs(y,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,s,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,s,f,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,s,f=>{f||this._update(!0)}),this}setLight(y,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,s){return this.style.setFeatureState(y,s),this._update()}removeFeatureState(y,s){return this.style.removeFeatureState(y,s),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,s=0;return this._container&&(y=this._container.clientWidth||400,s=this._container.clientHeight||300),[y,s]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const s=this._canvasContainer=M.create("div","maplibregl-canvas-container",y);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=M.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),d=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],d);const g=this._controlContainer=M.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{v[C]=M.create("div",`maplibregl-ctrl-${C} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,s,f){this._canvas.width=Math.floor(f*y),this._canvas.height=Math.floor(f*s),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{s={requestedAttributes:y},d&&(s.statusMessage=d.statusMessage,s.type=d.type)},{once:!0});const f=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!f){const d="Failed to initialize WebGL";throw s?(s.message=d,new Error(JSON.stringify(s))):new Error(d)}this.painter=new Wd(f,this.transform),k.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,v=E.now();this.style.zoomHistory.update(g,v);const C=new u.a8(g,{now:v,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),L=C.crossFadingFactor();L===1&&L===this._crossFadingFactor||(f=!0,this._crossFadingFactor=L),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bb.mark(u.bc.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,u.bb.mark(u.bc.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),U.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),M.remove(this._canvasContainer),M.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bb.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(y=>{u.bb.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Yf}getCameraTargetElevation(){return this.transform.elevation}},h.MapMouseEvent=Io,h.MapTouchEvent=lu,h.MapWheelEvent=Il,h.Marker=lc,h.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const s=this._map.getZoom(),f=s===this._map.getMaxZoom(),d=s===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,f)=>{const d=this._map._getUIString(`NavigationControl.${f}`);s.title=d,s.setAttribute("aria-label",d)},this.options=u.e({},Jf,y),this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),M.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),M.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=M.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,s){const f=M.create("button",y,this._container);return f.type="button",f.addEventListener("click",s),f}},h.Popup=class extends u.E{constructor(y){super(),this.remove=()=>(this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map),this.fire(new u.k("close")),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=M.create("div","maplibregl-popup",this._map.getContainer()),this._tip=M.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_h(this._lngLat,this._flatPos,this._map.transform)),this._trackPointer&&!s)return;const f=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let d=this.options.anchor;const g=vh(this.options.offset);if(!d){const C=this._container.offsetWidth,L=this._container.offsetHeight;let P;P=f.y+g.bottom.y<L?["top"]:f.y>this._map.transform.height-L?["bottom"]:[],f.x<C/2?P.push("left"):f.x>this._map.transform.width-C/2&&P.push("right"),d=P.length===0?"bottom":P.join("-")}const v=f.add(g[d]).round();M.setTransform(this._container,`${ac[d]} translate(${v.x}px,${v.y}px)`),yh(this._container,d,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(np),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=u.M.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const s=document.createDocumentFragment(),f=document.createElement("body");let d;for(f.innerHTML=y;d=f.firstChild,d;)s.appendChild(d);return this.setDOMContent(s)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(ip);y&&y.focus()}},h.RasterDEMTileSource=ar,h.RasterTileSource=yn,h.ScaleControl=class{constructor(y){this._onMove=()=>{uc(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,uc(this._map,this._container,this.options)},this.options=u.e({},ep,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=rc,h.Style=Bo,h.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=M.create("button","maplibregl-ctrl-terrain",this._container),M.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){M.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=qf,h.TwoFingersTouchRotateHandler=ph,h.TwoFingersTouchZoomHandler=Qd,h.TwoFingersTouchZoomRotateHandler=ws,h.VectorTileSource=Bt,h.VideoSource=vs,h.addSourceType=(y,s)=>u._(void 0,void 0,void 0,function*(){if(Gr(y))throw new Error(`A source type called "${y}" already exists.`);((f,d)=>{Ga[f]=d})(y,s)}),h.clearPrewarmedResources=function(){const y=Bn;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(wn),Bn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return se().getRTLTextPluginStatus()},h.getVersion=function(){return rp},h.getWorkerCount=function(){return In.workerCount},h.getWorkerUrl=function(){return u.a.WORKER_URL},h.importScriptInWorkers=function(y){return Fe().broadcast("importScript",y)},h.prewarm=function(){ne().acquire(wn)},h.setMaxParallelImageRequests=function(y){u.a.MAX_PARALLEL_IMAGE_REQUESTS=y},h.setRTLTextPlugin=function(y,s){return se().setRTLTextPlugin(y,s)},h.setWorkerCount=function(y){In.workerCount=y},h.setWorkerUrl=function(y){u.a.WORKER_URL=y}});var a=n;return a})})(hx);var wg=hx.exports;const Ls=ux(wg),Dh=[];function X_(e,t){return{subscribe:Jn(e,t).subscribe}}function Jn(e,t=Ae){let n;const i=new Set;function r(u){if(Ye(e,u)&&(e=u,n)){const _=!Dh.length;for(const w of i)w[1](),Dh.push(w,e);if(_){for(let w=0;w<Dh.length;w+=2)Dh[w][0](Dh[w+1]);Dh.length=0}}}function a(u){r(u(e))}function h(u,_=Ae){const w=[u,_];return i.add(w),i.size===1&&(n=t(r,a)||Ae),u(e),()=>{i.delete(w),i.size===0&&n&&(n(),n=null)}}return{set:r,update:a,subscribe:h}}let $e;const px=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&px.decode();let Dp=null;function Up(){return(Dp===null||Dp.byteLength===0)&&(Dp=new Uint8Array($e.memory.buffer)),Dp}function Fl(e,t){return e=e>>>0,px.decode(Up().subarray(e,e+t))}const Bl=new Array(128).fill(void 0);Bl.push(void 0,null,!0,!1);let Gp=Bl.length;function Rr(e){Gp===Bl.length&&Bl.push(Bl.length+1);const t=Gp;return Gp=Bl[t],Bl[t]=e,t}function Mn(e){return Bl[e]}function oI(e){e<132||(Bl[e]=Gp,Gp=e)}function qm(e){const t=Mn(e);return oI(e),t}function Y_(e){return e==null}let Np=null;function sI(){return(Np===null||Np.byteLength===0)&&(Np=new Float64Array($e.memory.buffer)),Np}let Rp=null;function wi(){return(Rp===null||Rp.byteLength===0)&&(Rp=new Int32Array($e.memory.buffer)),Rp}let Eu=0;const Zm=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},aI=typeof Zm.encodeInto=="function"?function(e,t){return Zm.encodeInto(e,t)}:function(e,t){const n=Zm.encode(e);return t.set(n),{read:e.length,written:n.length}};function km(e,t,n){if(n===void 0){const u=Zm.encode(e),_=t(u.length,1)>>>0;return Up().subarray(_,_+u.length).set(u),Eu=u.length,_}let i=e.length,r=t(i,1)>>>0;const a=Up();let h=0;for(;h<i;h++){const u=e.charCodeAt(h);if(u>127)break;a[r+h]=u}if(h!==i){h!==0&&(e=e.slice(h)),r=n(r,i,i=h+e.length*3,1)>>>0;const u=Up().subarray(r+h,r+i),_=aI(e,u);h+=_.written}return Eu=h,r}function ly(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const r=e.description;return r==null?"Symbol":`Symbol(${r})`}if(t=="function"){const r=e.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(e)){const r=e.length;let a="[";r>0&&(a+=ly(e[0]));for(let h=1;h<r;h++)a+=", "+ly(e[h]);return a+="]",a}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(n.length>1)i=n[1];else return toString.call(e);if(i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}function lI(e,t){const n=t(e.length*1,1)>>>0;return Up().set(e,n/1),Eu=e.length,n}function K_(e,t){try{return e.apply(this,t)}catch(n){$e.__wbindgen_exn_store(Rr(n))}}class Ym{static __wrap(t){t=t>>>0;const n=Object.create(Ym.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();$e.__wbg_jsroutesnapper_free(t)}constructor(t){try{const a=$e.__wbindgen_add_to_stack_pointer(-16),h=lI(t,$e.__wbindgen_malloc),u=Eu;$e.jsroutesnapper_new(a,h,u);var n=wi()[a/4+0],i=wi()[a/4+1],r=wi()[a/4+2];if(r)throw qm(i);return Ym.__wrap(n)}finally{$e.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(t){$e.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Rr(t))}setAreaMode(){$e.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let t,n;try{const a=$e.__wbindgen_add_to_stack_pointer(-16);$e.jsroutesnapper_getConfig(a,this.__wbg_ptr);var i=wi()[a/4+0],r=wi()[a/4+1];return t=i,n=r,Fl(i,r)}finally{$e.__wbindgen_add_to_stack_pointer(16),$e.__wbindgen_free(t,n,1)}}toFinalFeature(){try{const i=$e.__wbindgen_add_to_stack_pointer(-16);$e.jsroutesnapper_toFinalFeature(i,this.__wbg_ptr);var t=wi()[i/4+0],n=wi()[i/4+1];let r;return t!==0&&(r=Fl(t,n).slice(),$e.__wbindgen_free(t,n*1)),r}finally{$e.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let t,n;try{const a=$e.__wbindgen_add_to_stack_pointer(-16);$e.jsroutesnapper_renderGeojson(a,this.__wbg_ptr);var i=wi()[a/4+0],r=wi()[a/4+1];return t=i,n=r,Fl(i,r)}finally{$e.__wbindgen_add_to_stack_pointer(16),$e.__wbindgen_free(t,n,1)}}toggleSnapMode(){$e.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(t,n,i){return $e.jsroutesnapper_onMouseMove(this.__wbg_ptr,t,n,i)!==0}onClick(){$e.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return $e.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return $e.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){$e.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(t){try{const r=$e.__wbindgen_add_to_stack_pointer(-16);$e.jsroutesnapper_editExisting(r,this.__wbg_ptr,Rr(t));var n=wi()[r/4+0],i=wi()[r/4+1];if(i)throw qm(n)}finally{$e.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let t,n;try{const a=$e.__wbindgen_add_to_stack_pointer(-16);$e.jsroutesnapper_debugRenderGraph(a,this.__wbg_ptr);var i=wi()[a/4+0],r=wi()[a/4+1];return t=i,n=r,Fl(i,r)}finally{$e.__wbindgen_add_to_stack_pointer(16),$e.__wbindgen_free(t,n,1)}}routeNameForWaypoints(t){let n,i;try{const S=$e.__wbindgen_add_to_stack_pointer(-16);$e.jsroutesnapper_routeNameForWaypoints(S,this.__wbg_ptr,Rr(t));var r=wi()[S/4+0],a=wi()[S/4+1],h=wi()[S/4+2],u=wi()[S/4+3],_=r,w=a;if(u)throw _=0,w=0,qm(h);return n=_,i=w,Fl(_,w)}finally{$e.__wbindgen_add_to_stack_pointer(16),$e.__wbindgen_free(n,i,1)}}addSnappedWaypoint(t,n){$e.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,t,n)}undo(){$e.jsroutesnapper_undo(this.__wbg_ptr)}}async function uI(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function cI(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,n){const i=Fl(t,n);return Rr(i)},e.wbg.__wbindgen_object_drop_ref=function(t){qm(t)},e.wbg.__wbindgen_is_object=function(t){const n=Mn(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_is_undefined=function(t){return Mn(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return Mn(t)in Mn(n)},e.wbg.__wbindgen_boolean_get=function(t){const n=Mn(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_number_get=function(t,n){const i=Mn(n),r=typeof i=="number"?i:void 0;sI()[t/8+1]=Y_(r)?0:r,wi()[t/4+0]=!Y_(r)},e.wbg.__wbindgen_error_new=function(t,n){const i=new Error(Fl(t,n));return Rr(i)},e.wbg.__wbindgen_object_clone_ref=function(t){const n=Mn(t);return Rr(n)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return Mn(t)==Mn(n)},e.wbg.__wbindgen_string_get=function(t,n){const i=Mn(n),r=typeof i=="string"?i:void 0;var a=Y_(r)?0:km(r,$e.__wbindgen_malloc,$e.__wbindgen_realloc),h=Eu;wi()[t/4+1]=h,wi()[t/4+0]=a},e.wbg.__wbg_String_4370c5505c674d30=function(t,n){const i=String(Mn(n)),r=km(i,$e.__wbindgen_malloc,$e.__wbindgen_realloc),a=Eu;wi()[t/4+1]=a,wi()[t/4+0]=r},e.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(t,n){const i=Mn(t)[Mn(n)];return Rr(i)},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return Rr(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const i=Mn(n).stack,r=km(i,$e.__wbindgen_malloc,$e.__wbindgen_realloc),a=Eu;wi()[t/4+1]=a,wi()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let i,r;try{i=t,r=n,console.error(Fl(t,n))}finally{$e.__wbindgen_free(i,r,1)}},e.wbg.__wbg_debug_9a6b3243fbbebb61=function(t){console.debug(Mn(t))},e.wbg.__wbg_error_788ae33f81d3b84b=function(t){console.error(Mn(t))},e.wbg.__wbg_info_2e30e8204b29d91d=function(t){console.info(Mn(t))},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(Mn(t))},e.wbg.__wbg_warn_d60e832f9882c1b2=function(t){console.warn(Mn(t))},e.wbg.__wbg_get_44be0491f933a435=function(t,n){const i=Mn(t)[n>>>0];return Rr(i)},e.wbg.__wbg_length_fff51ee6522a1a18=function(t){return Mn(t).length},e.wbg.__wbindgen_is_function=function(t){return typeof Mn(t)=="function"},e.wbg.__wbg_next_526fc47e980da008=function(t){const n=Mn(t).next;return Rr(n)},e.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return K_(function(t){const n=Mn(t).next();return Rr(n)},arguments)},e.wbg.__wbg_done_5c1f01fb660d73b5=function(t){return Mn(t).done},e.wbg.__wbg_value_1695675138684bd5=function(t){const n=Mn(t).value;return Rr(n)},e.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Rr(Symbol.iterator)},e.wbg.__wbg_get_97b561fb56f034b5=function(){return K_(function(t,n){const i=Reflect.get(Mn(t),Mn(n));return Rr(i)},arguments)},e.wbg.__wbg_call_cb65541d95d71282=function(){return K_(function(t,n){const i=Mn(t).call(Mn(n));return Rr(i)},arguments)},e.wbg.__wbg_isArray_4c24b343cb13cfb1=function(t){return Array.isArray(Mn(t))},e.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(t){let n;try{n=Mn(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_buffer_085ec1f694018c4f=function(t){const n=Mn(t).buffer;return Rr(n)},e.wbg.__wbg_new_8125e318e6245eed=function(t){const n=new Uint8Array(Mn(t));return Rr(n)},e.wbg.__wbg_set_5cf90238115182c3=function(t,n,i){Mn(t).set(Mn(n),i>>>0)},e.wbg.__wbg_length_72e2208bbc0efc61=function(t){return Mn(t).length},e.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(t){let n;try{n=Mn(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_debug_string=function(t,n){const i=ly(Mn(n)),r=km(i,$e.__wbindgen_malloc,$e.__wbindgen_realloc),a=Eu;wi()[t/4+1]=a,wi()[t/4+0]=r},e.wbg.__wbindgen_throw=function(t,n){throw new Error(Fl(t,n))},e.wbg.__wbindgen_memory=function(){const t=$e.memory;return Rr(t)},e}function hI(e,t){return $e=e.exports,dx.__wbindgen_wasm_module=t,Np=null,Rp=null,Dp=null,$e}async function dx(e){if($e!==void 0)return $e;typeof e>"u"&&(e="/ltn/assets/route_snapper_bg.wasm");const t=cI();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await uI(await e,t);return hI(n,i)}const mx=Jn({type:"FeatureCollection",features:[]}),fI=Jn(!0),gx=Jn(0),pI=30;class dI{constructor(t,n){Un(this,"map");Un(this,"inner");Un(this,"active");Un(this,"eventListenersSuccess");Un(this,"eventListenersUpdated");Un(this,"eventListenersFailure");Un(this,"onMouseMove",t=>{if(!this.active)return;const n=[t.point.x-pI,t.point.y],i=this.map.unproject(t.point).distanceTo(this.map.unproject(n));this.inner.onMouseMove(t.lngLat.lng,t.lngLat.lat,i)&&(this.redraw(),this.dataUpdated())});Un(this,"onClick",()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())});Un(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.inner.onClick(),this.finish())});Un(this,"onDragStart",()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()});Un(this,"onMouseUp",()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()});Un(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});Un(this,"onKeyPress",t=>{this.active&&t.target.tagName!="INPUT"&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="s"?(t.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):t.key=="z"&&t.ctrlKey&&this.undo())});this.map=t,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ym(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(t){t.properties??(t.properties={}),this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),t.properties.waypoints||(t.properties.waypoints=[{lon:t.geometry.coordinates[0][0],lat:t.geometry.coordinates[0][1],snapped:!0},{lon:t.geometry.coordinates[t.geometry.coordinates.length-1][0],lat:t.geometry.coordinates[t.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(t.properties.waypoints),this.redraw()}editExistingArea(t){t.properties??(t.properties={}),this.active&&window.alert("Bug: editExistingArea called when tool is already active"),t.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(t.properties.waypoints),this.redraw()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let t=this.inner.toFinalFeature();if(t)for(let n of this.eventListenersSuccess)n(JSON.parse(t));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(t){this.inner.setRouteConfig(t),this.redraw()}addSnappedWaypoint(t){this.inner.addSnappedWaypoint(t[0],t[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}redraw(){let t=JSON.parse(this.inner.renderGeojson());mx.set(t),this.map.getCanvas().style.cursor=t.cursor,fI.set(t.snap_mode),gx.set(t.undo_length)}dataUpdated(){let t=this.inner.toFinalFeature();if(t)for(let n of this.eventListenersUpdated)n(JSON.parse(t))}}const uy="MZEJTanw3WpxRvt7qDfo";let al=Jn(null),cy=Jn("dataviz"),Hp=Jn(!window.matchMedia("(prefers-color-scheme: dark)").matches),Km=Jn(!1),Mu=Jn(""),Jm=Jn(!0),hy=Jn(null),fy=Jn(null),py=Jn(null),Fr=Jn(null),Qm=Jn(null),dy=Jn(new wg.LngLat(0,0)),my=Jn(new wg.LngLat(0,0)),Su=Jn(1),xn=Jn({mode:"title"}),gy=Jn("walk_cycle_only");function $p(){let e=Ta(Mu);e||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(e,Ta(Fr).toSavefile())}function mI(e){let t,n,i,r,a,h,u,_,w;return{c(){t=gt("label"),n=de(`Basemap:
  `),i=gt("select"),r=gt("option"),r.textContent="MapTiler Dataviz",a=gt("option"),a.textContent="MapTiler Streets",h=gt("option"),h.textContent="MapTiler Satellite",u=gt("option"),u.textContent="OS Open Zoomstack",r.__value="dataviz",La(r,r.__value),a.__value="streets",La(a,a.__value),h.__value="hybrid",La(h,h.__value),u.__value="uk-openzoomstack-light",La(u,u.__value),e[0]===void 0&&Wp(()=>e[1].call(i))},m(S,E){xt(S,t,E),ct(t,n),ct(t,i),ct(i,r),ct(i,a),ct(i,h),ct(i,u),Xm(i,e[0],!0),_||(w=Ge(i,"change",e[1]),_=!0)},p(S,[E]){E&1&&Xm(i,S[0])},i:Ae,o:Ae,d(S){S&&vt(t),_=!1,w()}}}function gI(e,t,n){let i;we(e,cy,a=>n(0,i=a));function r(){i=Jb(this),cy.set(i)}return[i,r]}class _I extends nn{constructor(t){super(),en(this,t,gI,mI,Ye,{})}}var yI=Object.defineProperty,vI=(e,t,n)=>t in e?yI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qv=(e,t,n)=>(vI(e,typeof t!="symbol"?t+"":t,n),n);function Xp(){}function _x(e){return e()}function Zv(){return Object.create(null)}function Sg(e){e.forEach(_x)}function yx(e){return typeof e=="function"}function bI(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function xI(e){return Object.keys(e).length===0}function wI(e,t){e.appendChild(t)}function SI(e,t,n){e.insertBefore(t,n||null)}function vx(e){e.parentNode&&e.parentNode.removeChild(e)}function Wv(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function bu(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function II(e){return Array.from(e.childNodes)}function Am(e,t,n){e.classList.toggle(t,!!n)}let Fy;function jp(e){Fy=e}const Fh=[],Hv=[];let Gh=[];const $v=[],EI=Promise.resolve();let _y=!1;function CI(){_y||(_y=!0,EI.then(bx))}function yy(e){Gh.push(e)}const J_=new Set;let Nh=0;function bx(){if(Nh!==0)return;const e=Fy;do{try{for(;Nh<Fh.length;){const t=Fh[Nh];Nh++,jp(t),TI(t.$$)}}catch(t){throw Fh.length=0,Nh=0,t}for(jp(null),Fh.length=0,Nh=0;Hv.length;)Hv.pop()();for(let t=0;t<Gh.length;t+=1){const n=Gh[t];J_.has(n)||(J_.add(n),n())}Gh.length=0}while(Fh.length);for(;$v.length;)$v.pop()();_y=!1,J_.clear(),jp(e)}function TI(e){if(e.fragment!==null){e.update(),Sg(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(yy)}}function LI(e){const t=[],n=[];Gh.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),Gh=t}const MI=new Set;function PI(e,t){e&&e.i&&(MI.delete(e),e.i(t))}function kI(e,t,n){const{fragment:i,after_update:r}=e.$$;i&&i.m(t,n),yy(()=>{const a=e.$$.on_mount.map(_x).filter(yx);e.$$.on_destroy?e.$$.on_destroy.push(...a):Sg(a),e.$$.on_mount=[]}),r.forEach(yy)}function AI(e,t){const n=e.$$;n.fragment!==null&&(LI(n.after_update),Sg(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function DI(e,t){e.$$.dirty[0]===-1&&(Fh.push(e),CI(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function NI(e,t,n,i,r,a,h=null,u=[-1]){const _=Fy;jp(e);const w=e.$$={fragment:null,ctx:[],props:a,update:Xp,not_equal:r,bound:Zv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(_?_.$$.context:[])),callbacks:Zv(),dirty:u,skip_bound:!1,root:t.target||_.$$.root};h&&h(w.root);let S=!1;if(w.ctx=n?n(e,t.props||{},(E,M,...k)=>{const D=k.length?k[0]:M;return w.ctx&&r(w.ctx[E],w.ctx[E]=D)&&(!w.skip_bound&&w.bound[E]&&w.bound[E](D),S&&DI(e,E)),M}):[],w.update(),S=!0,Sg(w.before_update),w.fragment=i?i(w.ctx):!1,t.target){if(t.hydrate){const E=II(t.target);w.fragment&&w.fragment.l(E),E.forEach(vx)}else w.fragment&&w.fragment.c();t.intro&&PI(e.$$.fragment),kI(e,t.target,t.anchor),bx()}jp(_)}class RI{constructor(){qv(this,"$$"),qv(this,"$$set")}$destroy(){AI(this,1),this.$destroy=Xp}$on(t,n){if(!yx(n))return Xp;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const r=i.indexOf(n);r!==-1&&i.splice(r,1)}}$set(t){this.$$set&&!xI(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const zI="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(zI);function OI(e){let t,n,i;return{c(){t=Wv("svg"),n=Wv("path"),bu(n,"stroke-width","4"),bu(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),bu(n,"class","svelte-gzo3ar"),bu(t,"width",i=e[0]==="list"?20:void 0),bu(t,"viewBox","0 0 70 85"),bu(t,"fill","none"),bu(t,"class","svelte-gzo3ar"),Am(t,"in-map",e[0]!=="list"),Am(t,"list-icon",e[0]==="list")},m(r,a){SI(r,t,a),wI(t,n)},p(r,[a]){a&1&&i!==(i=r[0]==="list"?20:void 0)&&bu(t,"width",i),a&1&&Am(t,"in-map",r[0]!=="list"),a&1&&Am(t,"list-icon",r[0]==="list")},i:Xp,o:Xp,d(r){r&&vx(t)}}}function FI(e,t,n){let{displayIn:i}=t;return e.$$set=r=>{"displayIn"in r&&n(0,i=r.displayIn)},[i]}class BI extends RI{constructor(t){super(),NI(this,t,FI,OI,bI,{displayIn:0})}}const VI=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],UI={decimalLatitude:40.123,decimalLongitude:-74.123},GI=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],jI=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function qI(){const e=[];return VI.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...UI})}),[...e,...GI,...jI]}const ZI=qI();ZI.map(e=>e.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function WI(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,r,a,h;return h={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function u(w){return function(S){return _([w,S])}}function _(w){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(a=w[0]&2?r.return:w[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,w[1])).done)return a;switch(r=0,a&&(w=[w[0]&2,a.value]),w[0]){case 0:case 1:a=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,r=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!a||w[1]>a[0]&&w[1]<a[3])){n.label=w[1];break}if(w[0]===6&&n.label<a[1]){n.label=a[1],a=w;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(w);break}a[2]&&n.ops.pop(),n.trys.pop();continue}w=t.call(e,n)}catch(S){w=[6,S],r=0}finally{i=a=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var Pu=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function HI(e,t){return e>t?1:e<t?-1:0}function Iu(e,t,n){for(var i=new Pu(null,null),r=i,a=i;;){var h=n(e,t.key);if(h<0){if(t.left===null)break;if(n(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,t=u,t.left===null)break}a.left=t,a=t,t=t.left}else if(h>0){if(t.right===null)break;if(n(e,t.right.key)>0){var u=t.right;if(t.right=u.left,u.left=t,t=u,t.right===null)break}r.right=t,r=t,t=t.right}else break}return r.right=t.left,a.left=t.right,t.left=i.right,t.right=i.left,t}function Q_(e,t,n,i){var r=new Pu(e,t);if(n===null)return r.left=r.right=null,r;n=Iu(e,n,i);var a=i(e,n.key);return a<0?(r.left=n.left,r.right=n,n.left=null):a>=0&&(r.right=n.right,r.left=n,n.right=null),r}function Xv(e,t,n){var i=null,r=null;if(t){t=Iu(e,t,n);var a=n(t.key,e);a===0?(i=t.left,r=t.right):a<0?(r=t.right,t.right=null,i=t):(i=t.left,t.left=null,r=t)}return{left:i,right:r}}function $I(e,t,n){return t===null?e:(e===null||(t=Iu(e.key,t,n),t.left=e),t)}function vy(e,t,n,i,r){if(e){i(""+t+(n?"└── ":"├── ")+r(e)+`
`);var a=t+(n?"    ":"│   ");e.left&&vy(e.left,a,!1,i,r),e.right&&vy(e.right,a,!0,i,r)}}var By=function(){function e(t){t===void 0&&(t=HI),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=Q_(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var i=new Pu(t,n);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var r=this._comparator,a=Iu(t,this._root,r),h=r(t,a.key);return h===0?this._root=a:(h<0?(i.left=a.left,i.right=a,a.left=null):h>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,i){var r;if(n===null)return null;n=Iu(t,n,i);var a=i(t,n.key);return a===0?(n.left===null?r=n.right:(r=Iu(t,n.left,i),r.right=n.right),this._size--,r):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Iu(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,i=this._comparator;n;){var r=i(t,n.key);if(r===0)return n;r<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Iu(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,i=this._comparator;n;){var r=i(t,n.key);if(r===0)return!0;r<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var i=this._root,r=[],a=!1;!a;)i!==null?(r.push(i),i=i.left):r.length!==0?(i=r.pop(),t.call(n,i),i=i.right):a=!0;return this},e.prototype.range=function(t,n,i,r){for(var a=[],h=this._comparator,u=this._root,_;a.length!==0||u;)if(u)a.push(u),u=u.left;else{if(u=a.pop(),_=h(u.key,n),_>0)break;if(h(u.key,t)>=0&&i.call(r,u))return this;u=u.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var i=n.key;return t.push(i)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var i=n.data;return t.push(i)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,i=!1,r=0,a=[];!i;)if(n)a.push(n),n=n.left;else if(a.length>0){if(n=a.pop(),r===t)return n;r++,n=n.right}else i=!0;return null},e.prototype.next=function(t){var n=this._root,i=null;if(t.right){for(i=t.right;i.left;)i=i.left;return i}for(var r=this._comparator;n;){var a=r(t.key,n.key);if(a===0)break;a<0?(i=n,n=n.left):n=n.right}return i},e.prototype.prev=function(t){var n=this._root,i=null;if(t.left!==null){for(i=t.left;i.right;)i=i.right;return i}for(var r=this._comparator;n;){var a=r(t.key,n.key);if(a===0)break;a<0?n=n.left:(i=n,n=n.right)}return i},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return YI(this._root)},e.prototype.load=function(t,n,i){n===void 0&&(n=[]),i===void 0&&(i=!1);var r=t.length,a=this._comparator;if(i&&wy(t,n,0,r-1,a),this._root===null)this._root=by(t,n,0,r),this._size=r;else{var h=KI(this.toList(),XI(t,n),a);r=this._size+r,this._root=xy({head:h},0,r)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(i){return String(i.key)});var n=[];return vy(this._root,"",!0,function(i){return n.push(i)},t),n.join("")},e.prototype.update=function(t,n,i){var r=this._comparator,a=Xv(t,this._root,r),h=a.left,u=a.right;r(t,n)<0?u=Q_(n,i,u,r):h=Q_(n,i,h,r),this._root=$I(h,u,r)},e.prototype.split=function(t){return Xv(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,n,i;return WI(this,function(r){switch(r.label){case 0:t=this._root,n=[],i=!1,r.label=1;case 1:return i?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return r.sent(),t=t.right,[3,5];case 4:i=!0,r.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function by(e,t,n,i){var r=i-n;if(r>0){var a=n+Math.floor(r/2),h=e[a],u=t[a],_=new Pu(h,u);return _.left=by(e,t,n,a),_.right=by(e,t,a+1,i),_}return null}function XI(e,t){for(var n=new Pu(null,null),i=n,r=0;r<e.length;r++)i=i.next=new Pu(e[r],t[r]);return i.next=null,n.next}function YI(e){for(var t=e,n=[],i=!1,r=new Pu(null,null),a=r;!i;)t?(n.push(t),t=t.left):n.length>0?(t=a=a.next=n.pop(),t=t.right):i=!0;return a.next=null,r.next}function xy(e,t,n){var i=n-t;if(i>0){var r=t+Math.floor(i/2),a=xy(e,t,r),h=e.head;return h.left=a,e.head=e.head.next,h.right=xy(e,r+1,n),h}return null}function KI(e,t,n){for(var i=new Pu(null,null),r=i,a=e,h=t;a!==null&&h!==null;)n(a.key,h.key)<0?(r.next=a,a=a.next):(r.next=h,h=h.next),r=r.next;return a!==null?r.next=a:h!==null&&(r.next=h),i.next}function wy(e,t,n,i,r){if(!(n>=i)){for(var a=e[n+i>>1],h=n-1,u=i+1;;){do h++;while(r(e[h],a)<0);do u--;while(r(e[u],a)>0);if(h>=u)break;var _=e[h];e[h]=e[u],e[u]=_,_=t[h],t[h]=t[u],t[u]=_}wy(e,t,n,u,r),wy(e,t,u+1,i,r)}}function da(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yv(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xo(e,t,n){return t&&Yv(e.prototype,t),n&&Yv(e,n),e}var Ip=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},Sy=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,i=e.ur.x<t.ur.x?e.ur.x:t.ur.x,r=e.ll.y<t.ll.y?t.ll.y:e.ll.y,a=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:r},ur:{x:i,y:a}}},Cu=Number.EPSILON;Cu===void 0&&(Cu=Math.pow(2,-52));var JI=Cu*Cu,Iy=function(e,t){if(-Cu<e&&e<Cu&&-Cu<t&&t<Cu)return 0;var n=e-t;return n*n<JI*e*t?0:e<t?-1:1},QI=function(){function e(){da(this,e),this.reset()}return Xo(e,[{key:"reset",value:function(){this.xRounder=new Kv,this.yRounder=new Kv}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),Kv=function(){function e(){da(this,e),this.tree=new By,this.round(0)}return Xo(e,[{key:"round",value:function(t){var n=this.tree.add(t),i=this.tree.prev(n);if(i!==null&&Iy(n.key,i.key)===0)return this.tree.remove(t),i.key;var r=this.tree.next(n);return r!==null&&Iy(n.key,r.key)===0?(this.tree.remove(t),r.key):t}}]),e}(),Yp=new QI,qp=function(e,t){return e.x*t.y-e.y*t.x},xx=function(e,t){return e.x*t.x+e.y*t.y},Jv=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y},a=qp(i,r);return Iy(a,0)},tg=function(e){return Math.sqrt(xx(e,e))},tE=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return qp(r,i)/tg(r)/tg(i)},eE=function(e,t,n){var i={x:t.x-e.x,y:t.y-e.y},r={x:n.x-e.x,y:n.y-e.y};return xx(r,i)/tg(r)/tg(i)},Qv=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},t1=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},nE=function(e,t,n,i){if(t.x===0)return t1(n,i,e.x);if(i.x===0)return t1(e,t,n.x);if(t.y===0)return Qv(n,i,e.y);if(i.y===0)return Qv(e,t,n.y);var r=qp(t,i);if(r==0)return null;var a={x:n.x-e.x,y:n.y-e.y},h=qp(a,t)/r,u=qp(a,i)/r,_=e.x+u*t.x,w=n.x+h*i.x,S=e.y+u*t.y,E=n.y+h*i.y,M=(_+w)/2,k=(S+E)/2;return{x:M,y:k}},nl=function(){Xo(e,null,[{key:"compare",value:function(t,n){var i=e.comparePoints(t.point,n.point);return i!==0?i:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:eg.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(t,n){da(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return Xo(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,i=0,r=n.length;i<r;i++){var a=n[i];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var i=this.point.events[n];if(i.segment.consumedBy===void 0)for(var r=n+1;r<t;r++){var a=this.point.events[r];a.consumedBy===void 0&&i.otherSE.point.events===a.otherSE.point.events&&i.segment.consume(a.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,i=this.point.events.length;n<i;n++){var r=this.point.events[n];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,i=new Map,r=function(a){var h=a.otherSE;i.set(a,{sine:tE(n.point,t.point,h.point),cosine:eE(n.point,t.point,h.point)})};return function(a,h){i.has(a)||r(a),i.has(h)||r(h);var u=i.get(a),_=u.sine,w=u.cosine,S=i.get(h),E=S.sine,M=S.cosine;return _>=0&&E>=0?w<M?1:w>M?-1:0:_<0&&E<0?w<M?-1:w>M?1:0:E<_?-1:E>_?1:0}}}]),e}(),iE=0,eg=function(){Xo(e,null,[{key:"compare",value:function(t,n){var i=t.leftSE.point.x,r=n.leftSE.point.x,a=t.rightSE.point.x,h=n.rightSE.point.x;if(h<i)return 1;if(a<r)return-1;var u=t.leftSE.point.y,_=n.leftSE.point.y,w=t.rightSE.point.y,S=n.rightSE.point.y;if(i<r){if(_<u&&_<w)return 1;if(_>u&&_>w)return-1;var E=t.comparePoint(n.leftSE.point);if(E<0)return 1;if(E>0)return-1;var M=n.comparePoint(t.rightSE.point);return M!==0?M:-1}if(i>r){if(u<_&&u<S)return-1;if(u>_&&u>S)return 1;var k=n.comparePoint(t.leftSE.point);if(k!==0)return k;var D=t.comparePoint(n.rightSE.point);return D<0?1:D>0?-1:1}if(u<_)return-1;if(u>_)return 1;if(a<h){var F=n.comparePoint(t.rightSE.point);if(F!==0)return F}if(a>h){var q=t.comparePoint(n.rightSE.point);if(q<0)return 1;if(q>0)return-1}if(a!==h){var X=w-u,B=a-i,U=S-_,W=h-r;if(X>B&&U<W)return 1;if(X<B&&U>W)return-1}return a>h?1:a<h||w<S?-1:w>S?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(t,n,i,r){da(this,e),this.id=++iE,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=i,this.windings=r}return Xo(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,i=this.rightSE.point,r=this.vector();if(n.x===i.x)return t.x===n.x?0:t.x<n.x?1:-1;var a=(t.y-n.y)/r.y,h=n.x+a*r.x;if(t.x===h)return 0;var u=(t.x-n.x)/r.x,_=n.y+u*r.y;return t.y===_?0:t.y<_?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),i=t.bbox(),r=Sy(n,i);if(r===null)return null;var a=this.leftSE.point,h=this.rightSE.point,u=t.leftSE.point,_=t.rightSE.point,w=Ip(n,u)&&this.comparePoint(u)===0,S=Ip(i,a)&&t.comparePoint(a)===0,E=Ip(n,_)&&this.comparePoint(_)===0,M=Ip(i,h)&&t.comparePoint(h)===0;if(S&&w)return M&&!E?h:!M&&E?_:null;if(S)return E&&a.x===_.x&&a.y===_.y?null:a;if(w)return M&&h.x===u.x&&h.y===u.y?null:u;if(M&&E)return null;if(M)return h;if(E)return _;var k=nE(a,this.vector(),u,t.vector());return k===null||!Ip(r,k)?null:Yp.round(k.x,k.y)}},{key:"split",value:function(t){var n=[],i=t.events!==void 0,r=new nl(t,!0),a=new nl(t,!1),h=this.rightSE;this.replaceRightSE(a),n.push(a),n.push(r);var u=new e(r,h,this.rings.slice(),this.windings.slice());return nl.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),nl.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(r.checkForConsuming(),a.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,i=this.windings.length;n<i;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,i=t;n.consumedBy;)n=n.consumedBy;for(;i.consumedBy;)i=i.consumedBy;var r=e.compare(n,i);if(r!==0){if(r>0){var a=n;n=i,i=a}if(n.prev===i){var h=n;n=i,i=h}for(var u=0,_=i.rings.length;u<_;u++){var w=i.rings[u],S=i.windings[u],E=n.rings.indexOf(w);E===-1?(n.rings.push(w),n.windings.push(S)):n.windings[E]+=S}i.rings=null,i.windings=null,i.consumedBy=n,i.leftSE.consumedBy=n.leftSE,i.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,i=this._afterState.windings,r=this._afterState.multiPolys,a=0,h=this.rings.length;a<h;a++){var u=this.rings[a],_=this.windings[a],w=n.indexOf(u);w===-1?(n.push(u),i.push(_)):i[w]+=_}for(var S=[],E=[],M=0,k=n.length;M<k;M++)if(i[M]!==0){var D=n[M],F=D.poly;if(E.indexOf(F)===-1)if(D.isExterior)S.push(F);else{E.indexOf(F)===-1&&E.push(F);var q=S.indexOf(D.poly);q!==-1&&S.splice(q,1)}}for(var X=0,B=S.length;X<B;X++){var U=S[X].multiPoly;r.indexOf(U)===-1&&r.push(U)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(Ma.type){case"union":{var i=t.length===0,r=n.length===0;this._isInResult=i!==r;break}case"intersection":{var a,h;t.length<n.length?(a=t.length,h=n.length):(a=n.length,h=t.length),this._isInResult=h===Ma.numMultiPolys&&a<h;break}case"xor":{var u=Math.abs(t.length-n.length);this._isInResult=u%2===1;break}case"difference":{var _=function(w){return w.length===1&&w[0].isSubject};this._isInResult=_(t)!==_(n);break}default:throw new Error("Unrecognized operation type found ".concat(Ma.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,i){var r,a,h,u=nl.comparePoints(t,n);if(u<0)r=t,a=n,h=1;else if(u>0)r=n,a=t,h=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var _=new nl(r,!0),w=new nl(a,!1);return new e(_,w,[i],[h])}}]),e}(),e1=function(){function e(t,n,i){if(da(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=i,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var r=Yp.round(t[0][0],t[0][1]);this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};for(var a=r,h=1,u=t.length;h<u;h++){if(typeof t[h][0]!="number"||typeof t[h][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var _=Yp.round(t[h][0],t[h][1]);_.x===a.x&&_.y===a.y||(this.segments.push(eg.fromRing(a,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),a=_)}(r.x!==a.x||r.y!==a.y)&&this.segments.push(eg.fromRing(a,r,this))}return Xo(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.segments.length;n<i;n++){var r=this.segments[n];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),rE=function(){function e(t,n){if(da(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new e1(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,r=t.length;i<r;i++){var a=new e1(t[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=n}return Xo(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,i=this.interiorRings.length;n<i;n++)for(var r=this.interiorRings[n].getSweepEvents(),a=0,h=r.length;a<h;a++)t.push(r[a]);return t}}]),e}(),n1=function(){function e(t,n){if(da(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,r=t.length;i<r;i++){var a=new rE(t[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=n}return Xo(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++)for(var r=this.polys[n].getSweepEvents(),a=0,h=r.length;a<h;a++)t.push(r[a]);return t}}]),e}(),oE=function(){Xo(e,null,[{key:"factory",value:function(t){for(var n=[],i=0,r=t.length;i<r;i++){var a=t[i];if(!(!a.isInResult()||a.ringOut)){for(var h=null,u=a.leftSE,_=a.rightSE,w=[u],S=u.point,E=[];h=u,u=_,w.push(u),u.point!==S;)for(;;){var M=u.getAvailableLinkedEvents();if(M.length===0){var k=w[0].point,D=w[w.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(k.x,",")+" ".concat(k.y,"]. Last matching segment found ends at")+" [".concat(D.x,", ").concat(D.y,"]."))}if(M.length===1){_=M[0].otherSE;break}for(var F=null,q=0,X=E.length;q<X;q++)if(E[q].point===u.point){F=q;break}if(F!==null){var B=E.splice(F)[0],U=w.splice(B.index);U.unshift(U[0].otherSE),n.push(new e(U.reverse()));continue}E.push({index:w.length,point:u.point});var W=u.getLeftmostComparator(h);_=M.sort(W)[0].otherSE;break}n.push(new e(w))}}return n}}]);function e(t){da(this,e),this.events=t;for(var n=0,i=t.length;n<i;n++)t[n].segment.ringOut=this;this.poly=null}return Xo(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],i=1,r=this.events.length-1;i<r;i++){var a=this.events[i].point,h=this.events[i+1].point;Jv(a,t,h)!==0&&(n.push(a),t=a)}if(n.length===1)return null;var u=n[0],_=n[1];Jv(u,t,_)===0&&n.shift(),n.push(n[0]);for(var w=this.isExteriorRing()?1:-1,S=this.isExteriorRing()?0:n.length-1,E=this.isExteriorRing()?n.length:-1,M=[],k=S;k!=E;k+=w)M.push([n[k].x,n[k].y]);return M}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,i=this.events.length;n<i;n++){var r=this.events[n];nl.compare(t,r)>0&&(t=r)}for(var a=t.segment.prevInResult(),h=a?a.prevInResult():null;;){if(!a)return null;if(!h)return a.ringOut;if(h.ringOut!==a.ringOut)return h.ringOut.enclosingRing()!==a.ringOut?a.ringOut:a.ringOut.enclosingRing();a=h.prevInResult(),h=a?a.prevInResult():null}}}]),e}(),i1=function(){function e(t){da(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return Xo(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,i=this.interiorRings.length;n<i;n++){var r=this.interiorRings[n].getGeom();r!==null&&t.push(r)}return t}}]),e}(),sE=function(){function e(t){da(this,e),this.rings=t,this.polys=this._composePolys(t)}return Xo(e,[{key:"getGeom",value:function(){for(var t=[],n=0,i=this.polys.length;n<i;n++){var r=this.polys[n].getGeom();r!==null&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var n=[],i=0,r=t.length;i<r;i++){var a=t[i];if(!a.poly)if(a.isExteriorRing())n.push(new i1(a));else{var h=a.enclosingRing();h.poly||n.push(new i1(h)),h.poly.addInterior(a)}}return n}}]),e}(),aE=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:eg.compare;da(this,e),this.queue=t,this.tree=new By(n),this.segments=[]}return Xo(e,[{key:"process",value:function(t){var n=t.segment,i=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),i;var r=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!r)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var a=r,h=r,u=void 0,_=void 0;u===void 0;)a=this.tree.prev(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);for(;_===void 0;)h=this.tree.next(h),h===null?_=null:h.key.consumedBy===void 0&&(_=h.key);if(t.isLeft){var w=null;if(u){var S=u.getIntersection(n);if(S!==null&&(n.isAnEndpoint(S)||(w=S),!u.isAnEndpoint(S)))for(var E=this._splitSafely(u,S),M=0,k=E.length;M<k;M++)i.push(E[M])}var D=null;if(_){var F=_.getIntersection(n);if(F!==null&&(n.isAnEndpoint(F)||(D=F),!_.isAnEndpoint(F)))for(var q=this._splitSafely(_,F),X=0,B=q.length;X<B;X++)i.push(q[X])}if(w!==null||D!==null){var U=null;if(w===null)U=D;else if(D===null)U=w;else{var W=nl.comparePoints(w,D);U=W<=0?w:D}this.queue.remove(n.rightSE),i.push(n.rightSE);for(var Q=n.split(U),ht=0,ut=Q.length;ht<ut;ht++)i.push(Q[ht])}i.length>0?(this.tree.remove(n),i.push(t)):(this.segments.push(n),n.prev=u)}else{if(u&&_){var St=u.getIntersection(_);if(St!==null){if(!u.isAnEndpoint(St))for(var lt=this._splitSafely(u,St),zt=0,wt=lt.length;zt<wt;zt++)i.push(lt[zt]);if(!_.isAnEndpoint(St))for(var _t=this._splitSafely(_,St),te=0,Pt=_t.length;te<Pt;te++)i.push(_t[te])}}this.tree.remove(n)}return i}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var i=t.rightSE;this.queue.remove(i);var r=t.split(n);return r.push(i),t.consumedBy===void 0&&this.tree.insert(t),r}}]),e}(),r1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,lE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,uE=function(){function e(){da(this,e)}return Xo(e,[{key:"run",value:function(t,n,i){Ma.type=t,Yp.reset();for(var r=[new n1(n,!0)],a=0,h=i.length;a<h;a++)r.push(new n1(i[a],!1));if(Ma.numMultiPolys=r.length,Ma.type==="difference")for(var u=r[0],_=1;_<r.length;)Sy(r[_].bbox,u.bbox)!==null?_++:r.splice(_,1);if(Ma.type==="intersection"){for(var w=0,S=r.length;w<S;w++)for(var E=r[w],M=w+1,k=r.length;M<k;M++)if(Sy(E.bbox,r[M].bbox)===null)return[]}for(var D=new By(nl.compare),F=0,q=r.length;F<q;F++)for(var X=r[F].getSweepEvents(),B=0,U=X.length;B<U;B++)if(D.insert(X[B]),D.size>r1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var W=new aE(D),Q=D.size,ht=D.pop();ht;){var ut=ht.key;if(D.size===Q){var St=ut.segment;throw new Error("Unable to pop() ".concat(ut.isLeft?"left":"right"," SweepEvent ")+"[".concat(ut.point.x,", ").concat(ut.point.y,"] from segment #").concat(St.id," ")+"[".concat(St.leftSE.point.x,", ").concat(St.leftSE.point.y,"] -> ")+"[".concat(St.rightSE.point.x,", ").concat(St.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(D.size>r1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(W.segments.length>lE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var lt=W.process(ut),zt=0,wt=lt.length;zt<wt;zt++){var _t=lt[zt];_t.consumedBy===void 0&&D.insert(_t)}Q=D.size,ht=D.pop()}Yp.reset();var te=oE.factory(W.segments),Pt=new sE(te);return Pt.getGeom()}}]),e}(),Ma=new uE,cE=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ma.run("union",e,n)},hE=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ma.run("intersection",e,n)},fE=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ma.run("xor",e,n)},pE=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ma.run("difference",e,n)},wx={union:cE,intersection:hE,xor:fE,difference:pE},Zo=63710088e-1,Sx={centimeters:Zo*100,centimetres:Zo*100,degrees:Zo/111325,feet:Zo*3.28084,inches:Zo*39.37,kilometers:Zo/1e3,kilometres:Zo/1e3,meters:Zo,metres:Zo,miles:Zo/1609.344,millimeters:Zo*1e3,millimetres:Zo*1e3,nauticalmiles:Zo/1852,radians:1,yards:Zo*1.0936};function Ig(e,t,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function dE(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!o1(e[0])||!o1(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return Ig(i,t,n)}function Ix(e,t,n){n===void 0&&(n={});for(var i=0,r=e;i<r.length;i++){var a=r[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<a[a.length-1].length;h++)if(a[a.length-1][h]!==a[0][h])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:e};return Ig(u,t,n)}function Ey(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function Ex(e,t,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:e};return Ig(i,t,n)}function mE(e,t){t===void 0&&(t="kilometers");var n=Sx[t];if(!n)throw new Error(t+" units is invalid");return e*n}function gE(e,t){t===void 0&&(t="kilometers");var n=Sx[t];if(!n)throw new Error(t+" units is invalid");return e/n}function o1(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function ng(e){return e.type==="Feature"?e.geometry:e}function _E(e,t,n){n===void 0&&(n={});var i=ng(e),r=ng(t),a=wx.union(i.coordinates,r.coordinates);return a.length===0?null:a.length===1?Ix(a[0],n.properties):Ex(a,n.properties)}function Cx(e,t,n){if(e!==null)for(var i,r,a,h,u,_,w,S=0,E=0,M,k=e.type,D=k==="FeatureCollection",F=k==="Feature",q=D?e.features.length:1,X=0;X<q;X++){w=D?e.features[X].geometry:F?e.geometry:e,M=w?w.type==="GeometryCollection":!1,u=M?w.geometries.length:1;for(var B=0;B<u;B++){var U=0,W=0;if(h=M?w.geometries[B]:w,h!==null){_=h.coordinates;var Q=h.type;switch(S=n&&(Q==="Polygon"||Q==="MultiPolygon")?1:0,Q){case null:break;case"Point":if(t(_,E,X,U,W)===!1)return!1;E++,U++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],E,X,U,W)===!1)return!1;E++,Q==="MultiPoint"&&U++}Q==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(r=0;r<_[i].length-S;r++){if(t(_[i][r],E,X,U,W)===!1)return!1;E++}Q==="MultiLineString"&&U++,Q==="Polygon"&&W++}Q==="Polygon"&&U++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(W=0,r=0;r<_[i].length;r++){for(a=0;a<_[i][r].length-S;a++){if(t(_[i][r][a],E,X,U,W)===!1)return!1;E++}W++}U++}break;case"GeometryCollection":for(i=0;i<h.geometries.length;i++)if(Cx(h.geometries[i],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function s1(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function Tx(e,t){var n,i,r,a,h,u,_,w,S,E,M=0,k=e.type==="FeatureCollection",D=e.type==="Feature",F=k?e.features.length:1;for(n=0;n<F;n++){for(u=k?e.features[n].geometry:D?e.geometry:e,w=k?e.features[n].properties:D?e.properties:{},S=k?e.features[n].bbox:D?e.bbox:void 0,E=k?e.features[n].id:D?e.id:void 0,_=u?u.type==="GeometryCollection":!1,h=_?u.geometries.length:1,r=0;r<h;r++){if(a=_?u.geometries[r]:u,a===null){if(t(null,M,w,S,E)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,M,w,S,E)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<a.geometries.length;i++)if(t(a.geometries[i],M,w,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}M++}}function Cy(e){var t=[1/0,1/0,-1/0,-1/0];return Cx(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Cy.default=Cy;function yE(e,t){t===void 0&&(t={});var n=Cy(e),i=(n[0]+n[2])/2,r=(n[1]+n[3])/2;return dE([i,r],t.properties,t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)t[i]=e,++i;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var yc=function(){};yc.prototype.interfaces_=function(){return[]};yc.prototype.getClass=function(){return yc};yc.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var di=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),tn=function(){},Lx={MAX_VALUE:{configurable:!0}};tn.isNaN=function(e){return Number.isNaN(e)};tn.doubleToLongBits=function(e){return e};tn.longBitsToDouble=function(e){return e};tn.isInfinite=function(e){return!Number.isFinite(e)};Lx.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(tn,Lx);var _s=function(){},Eg=function(){},jh=function(){};function ys(){}var Nt=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},Dc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};Nt.prototype.setOrdinate=function(e,t){switch(e){case Nt.X:this.x=t;break;case Nt.Y:this.y=t;break;case Nt.Z:this.z=t;break;default:throw new di("Invalid ordinate index: "+e)}};Nt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return!(!yc.equalsWithTolerance(this.x,t.x,n)||!yc.equalsWithTolerance(this.y,t.y,n))}};Nt.prototype.getOrdinate=function(e){switch(e){case Nt.X:return this.x;case Nt.Y:return this.y;case Nt.Z:return this.z}throw new di("Invalid ordinate index: "+e)};Nt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||tn.isNaN(this.z))&&tn.isNaN(e.z)};Nt.prototype.equals=function(e){return e instanceof Nt?this.equals2D(e):!1};Nt.prototype.equalInZ=function(e,t){return yc.equalsWithTolerance(this.z,e.z,t)};Nt.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};Nt.prototype.clone=function(){};Nt.prototype.copy=function(){return new Nt(this)};Nt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};Nt.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return Math.sqrt(t*t+n*n+i*i)};Nt.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)};Nt.prototype.hashCode=function(){var e=17;return e=37*e+Nt.hashCode(this.x),e=37*e+Nt.hashCode(this.y),e};Nt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};Nt.prototype.interfaces_=function(){return[_s,Eg,ys]};Nt.prototype.getClass=function(){return Nt};Nt.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=tn.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};Dc.DimensionalComparator.get=function(){return Vl};Dc.serialVersionUID.get=function(){return 6683108902428367e3};Dc.NULL_ORDINATE.get=function(){return tn.NaN};Dc.X.get=function(){return 0};Dc.Y.get=function(){return 1};Dc.Z.get=function(){return 2};Object.defineProperties(Nt,Dc);var Vl=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new di("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};Vl.prototype.compare=function(e,t){var n=e,i=t,r=Vl.compare(n.x,i.x);if(r!==0)return r;var a=Vl.compare(n.y,i.y);if(a!==0)return a;if(this._dimensionsToTest<=2)return 0;var h=Vl.compare(n.z,i.z);return h};Vl.prototype.interfaces_=function(){return[jh]};Vl.prototype.getClass=function(){return Vl};Vl.compare=function(e,t){return e<t?-1:e>t?1:tn.isNaN(e)?tn.isNaN(t)?0:-1:tn.isNaN(t)?1:0};var qh=function(){};qh.prototype.create=function(){};qh.prototype.interfaces_=function(){return[]};qh.prototype.getClass=function(){return qh};var Ot=function(){},dd={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Ot.prototype.interfaces_=function(){return[]};Ot.prototype.getClass=function(){return Ot};Ot.toLocationSymbol=function(e){switch(e){case Ot.EXTERIOR:return"e";case Ot.BOUNDARY:return"b";case Ot.INTERIOR:return"i";case Ot.NONE:return"-"}throw new di("Unknown location value: "+e)};dd.INTERIOR.get=function(){return 0};dd.BOUNDARY.get=function(){return 1};dd.EXTERIOR.get=function(){return 2};dd.NONE.get=function(){return-1};Object.defineProperties(Ot,dd);var He=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},Yo=function(){},Mx={LOG_10:{configurable:!0}};Yo.prototype.interfaces_=function(){return[]};Yo.prototype.getClass=function(){return Yo};Yo.log10=function(e){var t=Math.log(e);return tn.isInfinite(t)||tn.isNaN(t)?t:t/Yo.LOG_10};Yo.min=function(e,t,n,i){var r=e;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r};Yo.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],a=arguments[2];return i<r?r:i>a?a:i}};Yo.wrap=function(e,t){return e<0?t- -e%t:e%t};Yo.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],i=e;return t>i&&(i=t),n>i&&(i=n),i}else if(arguments.length===4){var r=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3],_=r;return a>_&&(_=a),h>_&&(_=h),u>_&&(_=u),_}};Yo.average=function(e,t){return(e+t)/2};Mx.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Yo,Mx);var ma=function(e){this.str=e};ma.prototype.append=function(e){this.str+=e};ma.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};ma.prototype.toString=function(e){return this.str};var ia=function(e){this.value=e};ia.prototype.intValue=function(){return this.value};ia.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};ia.isNaN=function(e){return Number.isNaN(e)};var Kp=function(){};Kp.isWhitespace=function(e){return e<=32&&e>=0||e===127};Kp.toUpperCase=function(e){return e.toUpperCase()};var Zt=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var i=arguments[0];e.call(this,e.parse(i))}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.init(r,a)}},Bs={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Zt.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Zt.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),i=Zt.magnitude(n._hi),r=Zt.TEN.pow(i);n=n.divide(r),n.gt(Zt.TEN)?(n=n.divide(Zt.TEN),i+=1):n.lt(Zt.ONE)&&(n=n.multiply(Zt.TEN),i-=1);for(var a=i+1,h=new ma,u=Zt.MAX_PRINT_DIGITS-1,_=0;_<=u;_++){e&&_===a&&h.append(".");var w=Math.trunc(n._hi);if(w<0)break;var S=!1,E=0;w>9?(S=!0,E="9"):E="0"+w,h.append(E),n=n.subtract(Zt.valueOf(w)).multiply(Zt.TEN),S&&n.selfAdd(Zt.TEN);var M=!0,k=Zt.magnitude(n._hi);if(k<0&&Math.abs(k)>=u-_&&(M=!1),!M)break}return t[0]=i,h.toString()};Zt.prototype.sqr=function(){return this.multiply(this)};Zt.prototype.doubleValue=function(){return this._hi+this._lo};Zt.prototype.subtract=function(){if(arguments[0]instanceof Zt){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};Zt.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Zt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Zt.prototype.selfSubtract=function(){if(arguments[0]instanceof Zt){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};Zt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Zt.prototype.min=function(e){return this.le(e)?this:e};Zt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Zt){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=null,a=null,h=null,u=null,_=null,w=null,S=null,E=null;return _=this._hi/n,w=Zt.SPLIT*_,r=w-_,E=Zt.SPLIT*n,r=w-r,a=_-r,h=E-n,S=_*n,h=E-h,u=n-h,E=r*h-S+r*u+a*h+a*u,w=(this._hi-S-E+this._lo-_*i)/n,E=_+w,this._hi=E,this._lo=_-E+w,this}};Zt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Zt.prototype.divide=function(){if(arguments[0]instanceof Zt){var e=arguments[0],t=null,n=null,i=null,r=null,a=null,h=null,u=null,_=null;a=this._hi/e._hi,h=Zt.SPLIT*a,t=h-a,_=Zt.SPLIT*e._hi,t=h-t,n=a-t,i=_-e._hi,u=a*e._hi,i=_-i,r=e._hi-i,_=t*i-u+t*r+n*i+n*r,h=(this._hi-u-_+this._lo-a*e._lo)/e._hi,_=a+h;var w=_,S=a-_+h;return new Zt(w,S)}else if(typeof arguments[0]=="number"){var E=arguments[0];return tn.isNaN(E)?Zt.createNaN():Zt.copy(this).selfDivide(E,0)}};Zt.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Zt.prototype.pow=function(e){if(e===0)return Zt.valueOf(1);var t=new Zt(this),n=Zt.valueOf(1),i=Math.abs(e);if(i>1)for(;i>0;)i%2===1&&n.selfMultiply(t),i/=2,i>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n};Zt.prototype.ceil=function(){if(this.isNaN())return Zt.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Zt(e,t)};Zt.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};Zt.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Zt.prototype.setValue=function(){if(arguments[0]instanceof Zt){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};Zt.prototype.max=function(e){return this.ge(e)?this:e};Zt.prototype.sqrt=function(){if(this.isZero())return Zt.valueOf(0);if(this.isNegative())return Zt.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=Zt.valueOf(t),i=this.subtract(n.sqr()),r=i._hi*(e*.5);return n.add(r)};Zt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Zt){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],n=null,i=null,r=null,a=null,h=null,u=null;return r=this._hi+t,h=r-this._hi,a=r-h,a=t-h+(this._hi-a),u=a+this._lo,n=r+u,i=u+(r-n),this._hi=n+i,this._lo=i+(n-this._hi),this}}else if(arguments.length===2){var _=arguments[0],w=arguments[1],S=null,E=null,M=null,k=null,D=null,F=null,q=null,X=null;D=this._hi+_,M=this._lo+w,q=D-this._hi,X=M-this._lo,F=D-q,k=M-X,F=_-q+(this._hi-F),k=w-X+(this._lo-k),q=F+M,S=D+q,E=q+(D-S),q=k+E;var B=S+q,U=q+(S-B);return this._hi=B,this._lo=U,this}};Zt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Zt){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=null,a=null,h=null,u=null,_=null,w=null;_=Zt.SPLIT*this._hi,r=_-this._hi,w=Zt.SPLIT*n,r=_-r,a=this._hi-r,h=w-n,_=this._hi*n,h=w-h,u=n-h,w=r*h-_+r*u+a*h+a*u+(this._hi*i+this._lo*n);var S=_+w;r=_-S;var E=w+r;return this._hi=S,this._lo=E,this}};Zt.prototype.selfSqr=function(){return this.selfMultiply(this)};Zt.prototype.floor=function(){if(this.isNaN())return Zt.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Zt(e,t)};Zt.prototype.negate=function(){return this.isNaN()?this:new Zt(-this._hi,-this._lo)};Zt.prototype.clone=function(){};Zt.prototype.multiply=function(){if(arguments[0]instanceof Zt){var e=arguments[0];return e.isNaN()?Zt.createNaN():Zt.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return tn.isNaN(t)?Zt.createNaN():Zt.copy(this).selfMultiply(t,0)}};Zt.prototype.isNaN=function(){return tn.isNaN(this._hi)};Zt.prototype.intValue=function(){return Math.trunc(this._hi)};Zt.prototype.toString=function(){var e=Zt.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Zt.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),i=t[0]+1,r=n;if(n.charAt(0)===".")r="0"+n;else if(i<0)r="0."+Zt.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){var a=i-n.length,h=Zt.stringOfChar("0",a);r=n+h+".0"}return this.isNegative()?"-"+r:r};Zt.prototype.reciprocal=function(){var e=null,t=null,n=null,i=null,r=null,a=null,h=null,u=null;r=1/this._hi,a=Zt.SPLIT*r,e=a-r,u=Zt.SPLIT*this._hi,e=a-e,t=r-e,n=u-this._hi,h=r*this._hi,n=u-n,i=this._hi-n,u=e*n-h+e*i+t*n+t*i,a=(1-h-u-r*this._lo)/this._hi;var _=r+a,w=r-_+a;return new Zt(_,w)};Zt.prototype.toSciNotation=function(){if(this.isZero())return Zt.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),i=Zt.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var a=n.charAt(0)+"."+r;return this.isNegative()?"-"+a+i:a+i};Zt.prototype.abs=function(){return this.isNaN()?Zt.NaN:this.isNegative()?this.negate():new Zt(this)};Zt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Zt.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Zt.prototype.add=function(){if(arguments[0]instanceof Zt){var e=arguments[0];return Zt.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Zt.copy(this).selfAdd(t)}};Zt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Zt){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._hi=n,this._lo=i}};Zt.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Zt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Zt.prototype.trunc=function(){return this.isNaN()?Zt.NaN:this.isPositive()?this.floor():this.ceil()};Zt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Zt.prototype.interfaces_=function(){return[ys,_s,Eg]};Zt.prototype.getClass=function(){return Zt};Zt.sqr=function(e){return Zt.valueOf(e).selfMultiply(e)};Zt.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Zt.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new Zt(t)}};Zt.sqrt=function(e){return Zt.valueOf(e).sqrt()};Zt.parse=function(e){for(var t=0,n=e.length;Kp.isWhitespace(e.charAt(t));)t++;var i=!1;if(t<n){var r=e.charAt(t);(r==="-"||r==="+")&&(t++,r==="-"&&(i=!0))}for(var a=new Zt,h=0,u=0,_=0;!(t>=n);){var w=e.charAt(t);if(t++,Kp.isDigit(w)){var S=w-"0";a.selfMultiply(Zt.TEN),a.selfAdd(S),h++;continue}if(w==="."){u=h;continue}if(w==="e"||w==="E"){var E=e.substring(t);try{_=ia.parseInt(E)}catch(q){throw q instanceof Error?new Error("Invalid exponent "+E+" in string "+e):q}finally{}break}throw new Error("Unexpected character '"+w+"' at position "+t+" in string "+e)}var M=a,k=h-u-_;if(k===0)M=a;else if(k>0){var D=Zt.TEN.pow(k);M=a.divide(D)}else if(k<0){var F=Zt.TEN.pow(-k);M=a.multiply(F)}return i?M.negate():M};Zt.createNaN=function(){return new Zt(tn.NaN,tn.NaN)};Zt.copy=function(e){return new Zt(e)};Zt.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n)),r=Math.pow(10,i);return r*10<=t&&(i+=1),i};Zt.stringOfChar=function(e,t){for(var n=new ma,i=0;i<t;i++)n.append(e);return n.toString()};Bs.PI.get=function(){return new Zt(3.141592653589793,12246467991473532e-32)};Bs.TWO_PI.get=function(){return new Zt(6.283185307179586,24492935982947064e-32)};Bs.PI_2.get=function(){return new Zt(1.5707963267948966,6123233995736766e-32)};Bs.E.get=function(){return new Zt(2.718281828459045,14456468917292502e-32)};Bs.NaN.get=function(){return new Zt(tn.NaN,tn.NaN)};Bs.EPS.get=function(){return 123259516440783e-46};Bs.SPLIT.get=function(){return 134217729};Bs.MAX_PRINT_DIGITS.get=function(){return 32};Bs.TEN.get=function(){return Zt.valueOf(10)};Bs.ONE.get=function(){return Zt.valueOf(1)};Bs.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};Bs.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Zt,Bs);var yo=function(){},Px={DP_SAFE_EPSILON:{configurable:!0}};yo.prototype.interfaces_=function(){return[]};yo.prototype.getClass=function(){return yo};yo.orientationIndex=function(e,t,n){var i=yo.orientationIndexFilter(e,t,n);if(i<=1)return i;var r=Zt.valueOf(t.x).selfAdd(-e.x),a=Zt.valueOf(t.y).selfAdd(-e.y),h=Zt.valueOf(n.x).selfAdd(-t.x),u=Zt.valueOf(n.y).selfAdd(-t.y);return r.selfMultiply(u).selfSubtract(a.selfMultiply(h)).signum()};yo.signOfDet2x2=function(e,t,n,i){var r=e.multiply(i).selfSubtract(t.multiply(n));return r.signum()};yo.intersection=function(e,t,n,i){var r=Zt.valueOf(i.y).selfSubtract(n.y).selfMultiply(Zt.valueOf(t.x).selfSubtract(e.x)),a=Zt.valueOf(i.x).selfSubtract(n.x).selfMultiply(Zt.valueOf(t.y).selfSubtract(e.y)),h=r.subtract(a),u=Zt.valueOf(i.x).selfSubtract(n.x).selfMultiply(Zt.valueOf(e.y).selfSubtract(n.y)),_=Zt.valueOf(i.y).selfSubtract(n.y).selfMultiply(Zt.valueOf(e.x).selfSubtract(n.x)),w=u.subtract(_),S=w.selfDivide(h).doubleValue(),E=Zt.valueOf(e.x).selfAdd(Zt.valueOf(t.x).selfSubtract(e.x).selfMultiply(S)).doubleValue(),M=Zt.valueOf(t.x).selfSubtract(e.x).selfMultiply(Zt.valueOf(e.y).selfSubtract(n.y)),k=Zt.valueOf(t.y).selfSubtract(e.y).selfMultiply(Zt.valueOf(e.x).selfSubtract(n.x)),D=M.subtract(k),F=D.selfDivide(h).doubleValue(),q=Zt.valueOf(n.y).selfAdd(Zt.valueOf(i.y).selfSubtract(n.y).selfMultiply(F)).doubleValue();return new Nt(E,q)};yo.orientationIndexFilter=function(e,t,n){var i=null,r=(e.x-n.x)*(t.y-n.y),a=(e.y-n.y)*(t.x-n.x),h=r-a;if(r>0){if(a<=0)return yo.signum(h);i=r+a}else if(r<0){if(a>=0)return yo.signum(h);i=-r-a}else return yo.signum(h);var u=yo.DP_SAFE_EPSILON*i;return h>=u||-h>=u?yo.signum(h):2};yo.signum=function(e){return e>0?1:e<0?-1:0};Px.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(yo,Px);var Pn=function(){},md={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};md.X.get=function(){return 0};md.Y.get=function(){return 1};md.Z.get=function(){return 2};md.M.get=function(){return 3};Pn.prototype.setOrdinate=function(e,t,n){};Pn.prototype.size=function(){};Pn.prototype.getOrdinate=function(e,t){};Pn.prototype.getCoordinate=function(){};Pn.prototype.getCoordinateCopy=function(e){};Pn.prototype.getDimension=function(){};Pn.prototype.getX=function(e){};Pn.prototype.clone=function(){};Pn.prototype.expandEnvelope=function(e){};Pn.prototype.copy=function(){};Pn.prototype.getY=function(e){};Pn.prototype.toCoordinateArray=function(){};Pn.prototype.interfaces_=function(){return[Eg]};Pn.prototype.getClass=function(){return Pn};Object.defineProperties(Pn,md);var kx=function(){},pf=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(kx),Lr=function(){};Lr.arraycopy=function(e,t,n,i,r){for(var a=0,h=t;h<t+r;h++)n[i+a]=e[h],a++};Lr.getProperty=function(e){return{"line.separator":`
`}[e]};var Ms=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var r=arguments[0],a=arguments[1];this.x=r.y*a.w-a.y*r.w,this.y=a.x*r.w-r.x*a.w,this.w=r.x*a.y-a.x*r.y}else if(arguments[0]instanceof Nt&&arguments[1]instanceof Nt){var h=arguments[0],u=arguments[1];this.x=h.y-u.y,this.y=u.x-h.x,this.w=h.x*u.y-u.x*h.y}}else if(arguments.length===3){var _=arguments[0],w=arguments[1],S=arguments[2];this.x=_,this.y=w,this.w=S}else if(arguments.length===4){var E=arguments[0],M=arguments[1],k=arguments[2],D=arguments[3],F=E.y-M.y,q=M.x-E.x,X=E.x*M.y-M.x*E.y,B=k.y-D.y,U=D.x-k.x,W=k.x*D.y-D.x*k.y;this.x=q*W-U*X,this.y=B*X-F*W,this.w=F*U-B*q}};Ms.prototype.getY=function(){var e=this.y/this.w;if(tn.isNaN(e)||tn.isInfinite(e))throw new pf;return e};Ms.prototype.getX=function(){var e=this.x/this.w;if(tn.isNaN(e)||tn.isInfinite(e))throw new pf;return e};Ms.prototype.getCoordinate=function(){var e=new Nt;return e.x=this.getX(),e.y=this.getY(),e};Ms.prototype.interfaces_=function(){return[]};Ms.prototype.getClass=function(){return Ms};Ms.intersection=function(e,t,n,i){var r=e.y-t.y,a=t.x-e.x,h=e.x*t.y-t.x*e.y,u=n.y-i.y,_=i.x-n.x,w=n.x*i.y-i.x*n.y,S=a*w-_*h,E=u*h-r*w,M=r*_-u*a,k=S/M,D=E/M;if(tn.isNaN(k)||tn.isInfinite(k)||tn.isNaN(D)||tn.isInfinite(D))throw new pf;return new Nt(k,D)};var Re=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Nt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(arguments.length===4){var a=arguments[0],h=arguments[1],u=arguments[2],_=arguments[3];this.init(a,h,u,_)}},Ax={serialVersionUID:{configurable:!0}};Re.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Re.prototype.equals=function(e){if(!(e instanceof Re))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};Re.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new Re;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,i=this._maxx<e._maxx?this._maxx:e._maxx,r=this._maxy<e._maxy?this._maxy:e._maxy;return new Re(t,i,n,r)};Re.prototype.isNull=function(){return this._maxx<this._minx};Re.prototype.getMaxX=function(){return this._maxx};Re.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof Nt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof Re){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&i>=this._miny&&i<=this._maxy}};Re.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof Re){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof Nt){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||i>this._maxy||i<this._miny)}};Re.prototype.getMinY=function(){return this._miny};Re.prototype.getMinX=function(){return this._minx};Re.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof Nt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof Re){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=i,this._maxy=i):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),i<this._miny&&(this._miny=i),i>this._maxy&&(this._maxy=i))}};Re.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};Re.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Re.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};Re.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};Re.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Re.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};Re.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};Re.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};Re.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Re.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof Re){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof Nt){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.covers(n,i)}};Re.prototype.centre=function(){return this.isNull()?null:new Nt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Re.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Nt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof Re){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(arguments.length===4){var r=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3];r<a?(this._minx=r,this._maxx=a):(this._minx=a,this._maxx=r),h<u?(this._miny=h,this._maxy=u):(this._miny=u,this._maxy=h)}};Re.prototype.getMaxY=function(){return this._maxy};Re.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)};Re.prototype.hashCode=function(){var e=17;return e=37*e+Nt.hashCode(this._minx),e=37*e+Nt.hashCode(this._maxx),e=37*e+Nt.hashCode(this._miny),e=37*e+Nt.hashCode(this._maxy),e};Re.prototype.interfaces_=function(){return[_s,ys]};Re.prototype.getClass=function(){return Re};Re.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var i=arguments[0],r=arguments[1],a=arguments[2],h=arguments[3],u=Math.min(a.x,h.x),_=Math.max(a.x,h.x),w=Math.min(i.x,r.x),S=Math.max(i.x,r.x);return!(w>_||S<u||(u=Math.min(a.y,h.y),_=Math.max(a.y,h.y),w=Math.min(i.y,r.y),S=Math.max(i.y,r.y),w>_)||S<u)}};Ax.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(Re,Ax);var Hs={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Cg=function(e){this.geometryFactory=e||new gn};Cg.prototype.read=function(e){var t,n,i;e=e.replace(/[\n\r]/g," ");var r=Hs.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(r=Hs.emptyTypeStr.exec(e),r[2]=void 0),r&&(n=r[1].toLowerCase(),i=r[2],Bh[n]&&(t=Bh[n].apply(this,[i]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};Cg.prototype.write=function(e){return this.extractGeometry(e)};Cg.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!tl[t])return null;var n=t.toUpperCase(),i;return e.isEmpty()?i=n+" EMPTY":i=n+"("+tl[t].apply(this,[e])+")",i};var tl={coordinate:function(e){return e.x+" "+e.y},point:function(e){return tl.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+tl.point.apply(t,[e._geometries[i]])+")");return n.join(",")},linestring:function(e){for(var t=this,n=[],i=0,r=e._points._coordinates.length;i<r;++i)n.push(tl.coordinate.apply(t,[e._points._coordinates[i]]));return n.join(",")},linearring:function(e){for(var t=this,n=[],i=0,r=e._points._coordinates.length;i<r;++i)n.push(tl.coordinate.apply(t,[e._points._coordinates[i]]));return n.join(",")},multilinestring:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+tl.linestring.apply(t,[e._geometries[i]])+")");return n.join(",")},polygon:function(e){var t=this,n=[];n.push("("+tl.linestring.apply(this,[e._shell])+")");for(var i=0,r=e._holes.length;i<r;++i)n.push("("+tl.linestring.apply(t,[e._holes[i]])+")");return n.join(",")},multipolygon:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push("("+tl.polygon.apply(t,[e._geometries[i]])+")");return n.join(",")},geometrycollection:function(e){for(var t=this,n=[],i=0,r=e._geometries.length;i<r;++i)n.push(t.extractGeometry(e._geometries[i]));return n.join(",")}},Bh={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Hs.spaces);return this.geometryFactory.createPoint(new Nt(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,i=e.trim().split(","),r=[],a=0,h=i.length;a<h;++a)n=i[a].replace(Hs.trimParens,"$1"),r.push(Bh.point.apply(t,[n]));return this.geometryFactory.createMultiPoint(r)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),n=[],i,r=0,a=t.length;r<a;++r)i=t[r].trim().split(Hs.spaces),n.push(new Nt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),n=[],i,r=0,a=t.length;r<a;++r)i=t[r].trim().split(Hs.spaces),n.push(new Nt(Number.parseFloat(i[0]),Number.parseFloat(i[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,i=e.trim().split(Hs.parenComma),r=[],a=0,h=i.length;a<h;++a)n=i[a].replace(Hs.trimParens,"$1"),r.push(Bh.linestring.apply(t,[n]));return this.geometryFactory.createMultiLineString(r)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,i,r,a=e.trim().split(Hs.parenComma),h,u=[],_=0,w=a.length;_<w;++_)n=a[_].replace(Hs.trimParens,"$1"),i=Bh.linestring.apply(t,[n]),r=t.geometryFactory.createLinearRing(i._points),_===0?h=r:u.push(r);return this.geometryFactory.createPolygon(h,u)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,i=e.trim().split(Hs.doubleParenComma),r=[],a=0,h=i.length;a<h;++a)n=i[a].replace(Hs.trimParens,"$1"),r.push(Bh.polygon.apply(t,[n]));return this.geometryFactory.createMultiPolygon(r)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),i=[],r=0,a=n.length;r<a;++r)i.push(t.read(n[r]));return this.geometryFactory.createGeometryCollection(i)}},As=function(e){this.parser=new Cg(e)};As.prototype.write=function(e){return this.parser.write(e)};As.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var ll=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),ig=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ll),un=function(){};un.prototype.interfaces_=function(){return[]};un.prototype.getClass=function(){return un};un.shouldNeverReachHere=function(){if(arguments.length===0)un.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new ig("Should never reach here"+(e!==null?": "+e:""))}};un.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],un.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new ig:new ig(t)};un.equals=function(){var e,t,n;if(arguments.length===2)e=arguments[0],t=arguments[1],un.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],n=arguments[2],!t.equals(e)))throw new ig("Expected "+e+" but encountered "+t+(n!==null?": "+n:""))};var vi=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Nt,this._intPt[1]=new Nt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},Nc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};vi.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};vi.prototype.getTopologySummary=function(){var e=new ma;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};vi.prototype.computeIntersection=function(e,t,n,i){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=i,this._result=this.computeIntersect(e,t,n,i)};vi.prototype.getIntersectionNum=function(){return this._result};vi.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);t>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};vi.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};vi.prototype.setPrecisionModel=function(e){this._precisionModel=e};vi.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[t][0])||e._intPt[n].equals2D(e._inputLines[t][1])))return!0;return!1}};vi.prototype.getIntersection=function(e){return this._intPt[e]};vi.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};vi.prototype.hasIntersection=function(){return this._result!==vi.NO_INTERSECTION};vi.prototype.getEdgeDistance=function(e,t){var n=vi.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return n};vi.prototype.isCollinear=function(){return this._result===vi.COLLINEAR_INTERSECTION};vi.prototype.toString=function(){return As.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+As.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};vi.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};vi.prototype.isIntersection=function(e){for(var t=this,n=0;n<this._result;n++)if(t._intPt[n].equals2D(e))return!0;return!1};vi.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};vi.prototype.interfaces_=function(){return[]};vi.prototype.getClass=function(){return vi};vi.computeEdgeDistance=function(e,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),a=-1;if(e.equals(t))a=0;else if(e.equals(n))i>r?a=i:a=r;else{var h=Math.abs(e.x-t.x),u=Math.abs(e.y-t.y);i>r?a=h:a=u,a===0&&!e.equals(t)&&(a=Math.max(h,u))}return un.isTrue(!(a===0&&!e.equals(t)),"Bad distance calculation"),a};vi.nonRobustComputeEdgeDistance=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,a=Math.sqrt(i*i+r*r);return un.isTrue(!(a===0&&!e.equals(t)),"Invalid distance calculation"),a};Nc.DONT_INTERSECT.get=function(){return 0};Nc.DO_INTERSECT.get=function(){return 1};Nc.COLLINEAR.get=function(){return 2};Nc.NO_INTERSECTION.get=function(){return 0};Nc.POINT_INTERSECTION.get=function(){return 1};Nc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(vi,Nc);var Vu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var i=new Re(this._inputLines[0][0],this._inputLines[0][1]),r=new Re(this._inputLines[1][0],this._inputLines[1][1]);return i.contains(n)&&r.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];if(this._isProper=!1,Re.intersects(i,r,n)&&be.orientationIndex(i,r,n)===0&&be.orientationIndex(r,i,n)===0)return this._isProper=!0,(n.equals(i)||n.equals(r))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,i,r,a,h){h.x=this.smallestInAbsValue(n.x,i.x,r.x,a.x),h.y=this.smallestInAbsValue(n.y,i.y,r.y,a.y),n.x-=h.x,n.y-=h.y,i.x-=h.x,i.y-=h.y,r.x-=h.x,r.y-=h.y,a.x-=h.x,a.y-=h.y},t.prototype.safeHCoordinateIntersection=function(n,i,r,a){var h=null;try{h=Ms.intersection(n,i,r,a)}catch(u){if(u instanceof pf)h=t.nearestEndpoint(n,i,r,a);else throw u}finally{}return h},t.prototype.intersection=function(n,i,r,a){var h=this.intersectionWithNormalization(n,i,r,a);return this.isInSegmentEnvelopes(h)||(h=new Nt(t.nearestEndpoint(n,i,r,a))),this._precisionModel!==null&&this._precisionModel.makePrecise(h),h},t.prototype.smallestInAbsValue=function(n,i,r,a){var h=n,u=Math.abs(h);return Math.abs(i)<u&&(h=i,u=Math.abs(i)),Math.abs(r)<u&&(h=r,u=Math.abs(r)),Math.abs(a)<u&&(h=a),h},t.prototype.checkDD=function(n,i,r,a,h){var u=yo.intersection(n,i,r,a),_=this.isInSegmentEnvelopes(u);Lr.out.println("DD in env = "+_+"  --------------------- "+u),h.distance(u)>1e-4&&Lr.out.println("Distance = "+h.distance(u))},t.prototype.intersectionWithNormalization=function(n,i,r,a){var h=new Nt(n),u=new Nt(i),_=new Nt(r),w=new Nt(a),S=new Nt;this.normalizeToEnvCentre(h,u,_,w,S);var E=this.safeHCoordinateIntersection(h,u,_,w);return E.x+=S.x,E.y+=S.y,E},t.prototype.computeCollinearIntersection=function(n,i,r,a){var h=Re.intersects(n,i,r),u=Re.intersects(n,i,a),_=Re.intersects(r,a,n),w=Re.intersects(r,a,i);return h&&u?(this._intPt[0]=r,this._intPt[1]=a,e.COLLINEAR_INTERSECTION):_&&w?(this._intPt[0]=n,this._intPt[1]=i,e.COLLINEAR_INTERSECTION):h&&_?(this._intPt[0]=r,this._intPt[1]=n,r.equals(n)&&!u&&!w?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):h&&w?(this._intPt[0]=r,this._intPt[1]=i,r.equals(i)&&!u&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):u&&_?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!h&&!w?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):u&&w?(this._intPt[0]=a,this._intPt[1]=i,a.equals(i)&&!h&&!_?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,i,r,a,h){var u=n.x<i.x?n.x:i.x,_=n.y<i.y?n.y:i.y,w=n.x>i.x?n.x:i.x,S=n.y>i.y?n.y:i.y,E=r.x<a.x?r.x:a.x,M=r.y<a.y?r.y:a.y,k=r.x>a.x?r.x:a.x,D=r.y>a.y?r.y:a.y,F=u>E?u:E,q=w<k?w:k,X=_>M?_:M,B=S<D?S:D,U=(F+q)/2,W=(X+B)/2;h.x=U,h.y=W,n.x-=h.x,n.y-=h.y,i.x-=h.x,i.y-=h.y,r.x-=h.x,r.y-=h.y,a.x-=h.x,a.y-=h.y},t.prototype.computeIntersect=function(n,i,r,a){if(this._isProper=!1,!Re.intersects(n,i,r,a))return e.NO_INTERSECTION;var h=be.orientationIndex(n,i,r),u=be.orientationIndex(n,i,a);if(h>0&&u>0||h<0&&u<0)return e.NO_INTERSECTION;var _=be.orientationIndex(r,a,n),w=be.orientationIndex(r,a,i);if(_>0&&w>0||_<0&&w<0)return e.NO_INTERSECTION;var S=h===0&&u===0&&_===0&&w===0;return S?this.computeCollinearIntersection(n,i,r,a):(h===0||u===0||_===0||w===0?(this._isProper=!1,n.equals2D(r)||n.equals2D(a)?this._intPt[0]=n:i.equals2D(r)||i.equals2D(a)?this._intPt[0]=i:h===0?this._intPt[0]=new Nt(r):u===0?this._intPt[0]=new Nt(a):_===0?this._intPt[0]=new Nt(n):w===0&&(this._intPt[0]=new Nt(i))):(this._isProper=!0,this._intPt[0]=this.intersection(n,i,r,a)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,i,r,a){var h=n,u=be.distancePointLine(n,r,a),_=be.distancePointLine(i,r,a);return _<u&&(u=_,h=i),_=be.distancePointLine(r,n,i),_<u&&(u=_,h=r),_=be.distancePointLine(a,n,i),_<u&&(u=_,h=a),h},t}(vi),vc=function(){};vc.prototype.interfaces_=function(){return[]};vc.prototype.getClass=function(){return vc};vc.orientationIndex=function(e,t,n){var i=t.x-e.x,r=t.y-e.y,a=n.x-t.x,h=n.y-t.y;return vc.signOfDet2x2(i,r,a,h)};vc.signOfDet2x2=function(e,t,n,i){var r=null,a=null,h=null;if(r=1,e===0||i===0)return t===0||n===0?0:t>0?n>0?-r:r:n>0?r:-r;if(t===0||n===0)return i>0?e>0?r:-r:e>0?-r:r;if(t>0?i>0?t<=i||(r=-r,a=e,e=n,n=a,a=t,t=i,i=a):t<=-i?(r=-r,n=-n,i=-i):(a=e,e=-n,n=a,a=t,t=-i,i=a):i>0?-t<=i?(r=-r,e=-e,t=-t):(a=-e,e=n,n=a,a=-t,t=i,i=a):t>=i?(e=-e,t=-t,n=-n,i=-i):(r=-r,a=-e,e=-n,n=a,a=-t,t=-i,i=a),e>0)if(n>0){if(!(e<=n))return r}else return r;else{if(n>0)return-r;if(e>=n)r=-r,e=-e,n=-n;else return-r}for(;;){if(h=Math.floor(n/e),n=n-h*e,i=i-h*t,i<0)return-r;if(i>t)return r;if(e>n+n){if(t<i+i)return r}else{if(t>i+i)return-r;n=e-n,i=t-i,r=-r}if(i===0)return n===0?0:-r;if(n===0||(h=Math.floor(e/n),e=e-h*n,t=t-h*i,t<0))return r;if(t>i)return-r;if(n>e+e){if(i<t+t)return-r}else{if(i>t+t)return r;e=n-e,t=i-t,r=-r}if(t===0)return e===0?0:r;if(e===0)return-r}};var ta=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};ta.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,i=t.x;return n>i&&(n=t.x,i=e.x),this._p.x>=n&&this._p.x<=i&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var r=e.x-this._p.x,a=e.y-this._p.y,h=t.x-this._p.x,u=t.y-this._p.y,_=vc.signOfDet2x2(r,a,h,u);if(_===0)return this._isPointOnSegment=!0,null;u<a&&(_=-_),_>0&&this._crossingCount++}};ta.prototype.isPointInPolygon=function(){return this.getLocation()!==Ot.EXTERIOR};ta.prototype.getLocation=function(){return this._isPointOnSegment?Ot.BOUNDARY:this._crossingCount%2===1?Ot.INTERIOR:Ot.EXTERIOR};ta.prototype.isOnSegment=function(){return this._isPointOnSegment};ta.prototype.interfaces_=function(){return[]};ta.prototype.getClass=function(){return ta};ta.locatePointInRing=function(){if(arguments[0]instanceof Nt&&He(arguments[1],Pn)){for(var e=arguments[0],t=arguments[1],n=new ta(e),i=new Nt,r=new Nt,a=1;a<t.size();a++)if(t.getCoordinate(a,i),t.getCoordinate(a-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof Nt&&arguments[1]instanceof Array){for(var h=arguments[0],u=arguments[1],_=new ta(h),w=1;w<u.length;w++){var S=u[w],E=u[w-1];if(_.countSegment(S,E),_.isOnSegment())return _.getLocation()}return _.getLocation()}};var be=function(){},Rc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};be.orientationIndex=function(e,t,n){return yo.orientationIndex(e,t,n)};be.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,i=1;i<e.length-1;i++){var r=e[i].x-n,a=e[i+1].y,h=e[i-1].y;t+=r*(h-a)}return t/2}else if(He(arguments[0],Pn)){var u=arguments[0],_=u.size();if(_<3)return 0;var w=new Nt,S=new Nt,E=new Nt;u.getCoordinate(0,S),u.getCoordinate(1,E);var M=S.x;E.x-=M;for(var k=0,D=1;D<_-1;D++)w.y=S.y,S.x=E.x,S.y=E.y,u.getCoordinate(D+1,E),E.x-=M,k+=S.x*(w.y-E.y);return k/2}};be.distanceLineLine=function(e,t,n,i){if(e.equals(t))return be.distancePointLine(e,n,i);if(n.equals(i))return be.distancePointLine(i,e,t);var r=!1;if(!Re.intersects(e,t,n,i))r=!0;else{var a=(t.x-e.x)*(i.y-n.y)-(t.y-e.y)*(i.x-n.x);if(a===0)r=!0;else{var h=(e.y-n.y)*(i.x-n.x)-(e.x-n.x)*(i.y-n.y),u=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),_=u/a,w=h/a;(w<0||w>1||_<0||_>1)&&(r=!0)}}return r?Yo.min(be.distancePointLine(e,n,i),be.distancePointLine(t,n,i),be.distancePointLine(n,e,t),be.distancePointLine(i,e,t)):0};be.isPointInRing=function(e,t){return be.locatePointInRing(e,t)!==Ot.EXTERIOR};be.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,i=new Nt;e.getCoordinate(0,i);for(var r=i.x,a=i.y,h=1;h<t;h++){e.getCoordinate(h,i);var u=i.x,_=i.y,w=u-r,S=_-a;n+=Math.sqrt(w*w+S*S),r=u,a=_}return n};be.isCCW=function(e){var t=e.length-1;if(t<3)throw new di("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],i=0,r=1;r<=t;r++){var a=e[r];a.y>n.y&&(n=a,i=r)}var h=i;do h=h-1,h<0&&(h=t);while(e[h].equals2D(n)&&h!==i);var u=i;do u=(u+1)%t;while(e[u].equals2D(n)&&u!==i);var _=e[h],w=e[u];if(_.equals2D(n)||w.equals2D(n)||_.equals2D(w))return!1;var S=be.computeOrientation(_,n,w),E=!1;return S===0?E=_.x>w.x:E=S>0,E};be.locatePointInRing=function(e,t){return ta.locatePointInRing(e,t)};be.distancePointLinePerpendicular=function(e,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),r=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/i;return Math.abs(r)*Math.sqrt(i)};be.computeOrientation=function(e,t,n){return be.orientationIndex(e,t,n)};be.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new di("Line array must contain at least one vertex");for(var n=e.distance(t[0]),i=0;i<t.length-1;i++){var r=be.distancePointLine(e,t[i],t[i+1]);r<n&&(n=r)}return n}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];if(h.x===u.x&&h.y===u.y)return a.distance(h);var _=(u.x-h.x)*(u.x-h.x)+(u.y-h.y)*(u.y-h.y),w=((a.x-h.x)*(u.x-h.x)+(a.y-h.y)*(u.y-h.y))/_;if(w<=0)return a.distance(h);if(w>=1)return a.distance(u);var S=((h.y-a.y)*(u.x-h.x)-(h.x-a.x)*(u.y-h.y))/_;return Math.abs(S)*Math.sqrt(_)}};be.isOnLine=function(e,t){for(var n=new Vu,i=1;i<t.length;i++){var r=t[i-1],a=t[i];if(n.computeIntersection(e,r,a),n.hasIntersection())return!0}return!1};Rc.CLOCKWISE.get=function(){return-1};Rc.RIGHT.get=function(){return be.CLOCKWISE};Rc.COUNTERCLOCKWISE.get=function(){return 1};Rc.LEFT.get=function(){return be.COUNTERCLOCKWISE};Rc.COLLINEAR.get=function(){return 0};Rc.STRAIGHT.get=function(){return be.COLLINEAR};Object.defineProperties(be,Rc);var ul=function(){};ul.prototype.filter=function(e){};ul.prototype.interfaces_=function(){return[]};ul.prototype.getClass=function(){return ul};var Ze=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},Ua={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Ze.prototype.isGeometryCollection=function(){return this.getSortIndex()===Ze.SORTINDEX_GEOMETRYCOLLECTION};Ze.prototype.getFactory=function(){return this._factory};Ze.prototype.getGeometryN=function(e){return this};Ze.prototype.getArea=function(){return 0};Ze.prototype.isRectangle=function(){return!1};Ze.prototype.equals=function(){if(arguments[0]instanceof Ze){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof Ze))return!1;var n=t;return this.equalsExact(n)}};Ze.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};Ze.prototype.geometryChanged=function(){this.apply(Ze.geometryChangedFilter)};Ze.prototype.geometryChangedAction=function(){this._envelope=null};Ze.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};Ze.prototype.getLength=function(){return 0};Ze.prototype.getNumGeometries=function(){return 1};Ze.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}};Ze.prototype.getUserData=function(){return this._userData};Ze.prototype.getSRID=function(){return this._SRID};Ze.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Ze.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===Ze.SORTINDEX_GEOMETRYCOLLECTION)throw new di("This method does not support GeometryCollection arguments")};Ze.prototype.equal=function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n};Ze.prototype.norm=function(){var e=this.copy();return e.normalize(),e};Ze.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Ze.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Re(this._envelope)};Ze.prototype.setSRID=function(e){this._SRID=e};Ze.prototype.setUserData=function(e){this._userData=e};Ze.prototype.compare=function(e,t){for(var n=e.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),a=i.next(),h=r.compareTo(a);if(h!==0)return h}return n.hasNext()?1:i.hasNext()?-1:0};Ze.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Ze.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Ze.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Ze.SORTINDEX_MULTIPOINT||this.getSortIndex()===Ze.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Ze.SORTINDEX_MULTIPOLYGON};Ze.prototype.interfaces_=function(){return[Eg,_s,ys]};Ze.prototype.getClass=function(){return Ze};Ze.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};Ze.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};Ua.serialVersionUID.get=function(){return 8763622679187377e3};Ua.SORTINDEX_POINT.get=function(){return 0};Ua.SORTINDEX_MULTIPOINT.get=function(){return 1};Ua.SORTINDEX_LINESTRING.get=function(){return 2};Ua.SORTINDEX_LINEARRING.get=function(){return 3};Ua.SORTINDEX_MULTILINESTRING.get=function(){return 4};Ua.SORTINDEX_POLYGON.get=function(){return 5};Ua.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Ua.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Ua.geometryChangedFilter.get=function(){return Vy};Object.defineProperties(Ze,Ua);var Vy=function(){};Vy.interfaces_=function(){return[ul]};Vy.filter=function(e){e.geometryChangedAction()};var Aa=function(){};Aa.prototype.filter=function(e){};Aa.prototype.interfaces_=function(){return[]};Aa.prototype.getClass=function(){return Aa};var ds=function(){},dl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ds.prototype.isInBoundary=function(e){};ds.prototype.interfaces_=function(){return[]};ds.prototype.getClass=function(){return ds};dl.Mod2BoundaryNodeRule.get=function(){return Zh};dl.EndPointBoundaryNodeRule.get=function(){return Wh};dl.MultiValentEndPointBoundaryNodeRule.get=function(){return Hh};dl.MonoValentEndPointBoundaryNodeRule.get=function(){return $h};dl.MOD2_BOUNDARY_RULE.get=function(){return new Zh};dl.ENDPOINT_BOUNDARY_RULE.get=function(){return new Wh};dl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Hh};dl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new $h};dl.OGC_SFS_BOUNDARY_RULE.get=function(){return ds.MOD2_BOUNDARY_RULE};Object.defineProperties(ds,dl);var Zh=function(){};Zh.prototype.isInBoundary=function(e){return e%2===1};Zh.prototype.interfaces_=function(){return[ds]};Zh.prototype.getClass=function(){return Zh};var Wh=function(){};Wh.prototype.isInBoundary=function(e){return e>0};Wh.prototype.interfaces_=function(){return[ds]};Wh.prototype.getClass=function(){return Wh};var Hh=function(){};Hh.prototype.isInBoundary=function(e){return e>1};Hh.prototype.interfaces_=function(){return[ds]};Hh.prototype.getClass=function(){return Hh};var $h=function(){};$h.prototype.isInBoundary=function(e){return e===1};$h.prototype.interfaces_=function(){return[ds]};$h.prototype.getClass=function(){return $h};var Wi=function(){};Wi.prototype.add=function(){};Wi.prototype.addAll=function(){};Wi.prototype.isEmpty=function(){};Wi.prototype.iterator=function(){};Wi.prototype.size=function(){};Wi.prototype.toArray=function(){};Wi.prototype.remove=function(){};function Uy(e){this.message=e||""}Uy.prototype=new Error;Uy.prototype.name="IndexOutOfBoundsException";var df=function(){};df.prototype.hasNext=function(){};df.prototype.next=function(){};df.prototype.remove=function(){};var Ps=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Wi);function mf(e){this.message=e||""}mf.prototype=new Error;mf.prototype.name="NoSuchElementException";var pe=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Wi&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Wi]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var i=this,r=n.iterator();r.hasNext();)i.add(r.next());return!0},t.prototype.set=function(n,i){var r=this.array_[n];return this.array_[n]=i,r},t.prototype.iterator=function(){return new vE(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new Uy;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,i=[],r=0,a=this.array_.length;r<a;r++)i.push(n.array_[r]);return i},t.prototype.remove=function(n){for(var i=this,r=!1,a=0,h=this.array_.length;a<h;a++)if(i.array_[a]===n){i.array_.splice(a,1),r=!0;break}return r},t}(Ps),vE=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new mf;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(df),gd=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var i=arguments[0];this.ensureCapacity(i.length),this.add(i,!0)}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.ensureCapacity(r.length),this.add(r,a)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(i){return this.get(i)},t.prototype.addAll=function(){var i=this;if(arguments.length===2){for(var r=arguments[0],a=arguments[1],h=!1,u=r.iterator();u.hasNext();)i.add(u.next(),a),h=!0;return h}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var i=this,r=e.prototype.clone.call(this),a=0;a<this.size();a++)r.add(a,i.get(a).copy());return r},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var i=this;if(arguments.length===1){var r=arguments[0];e.prototype.add.call(this,r)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1];return this.add(a,h,!0),!0}else if(arguments[0]instanceof Nt&&typeof arguments[1]=="boolean"){var u=arguments[0],_=arguments[1];if(!_&&this.size()>=1){var w=this.get(this.size()-1);if(w.equals2D(u))return null}e.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var S=arguments[0],E=arguments[1];return this.add(S,E),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var M=arguments[0],k=arguments[1],D=arguments[2];if(D)for(var F=0;F<M.length;F++)i.add(M[F],k);else for(var q=M.length-1;q>=0;q--)i.add(M[q],k);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Nt){var X=arguments[0],B=arguments[1],U=arguments[2];if(!U){var W=this.size();if(W>0){if(X>0){var Q=this.get(X-1);if(Q.equals2D(B))return null}if(X<W){var ht=this.get(X);if(ht.equals2D(B))return null}}}e.prototype.add.call(this,X,B)}}else if(arguments.length===4){var ut=arguments[0],St=arguments[1],lt=arguments[2],zt=arguments[3],wt=1;lt>zt&&(wt=-1);for(var _t=lt;_t!==zt;_t+=wt)i.add(ut[_t],St);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new Nt(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(pe),_n=function(){},Tg={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Tg.ForwardComparator.get=function(){return Jp};Tg.BidirectionalComparator.get=function(){return Xh};Tg.coordArrayType.get=function(){return new Array(0).fill(null)};_n.prototype.interfaces_=function(){return[]};_n.prototype.getClass=function(){return _n};_n.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};_n.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(_n.indexOf(i,t)<0)return i}return null};_n.scroll=function(e,t){var n=_n.indexOf(t,e);if(n<0)return null;var i=new Array(e.length).fill(null);Lr.arraycopy(e,n,i,0,e.length-n),Lr.arraycopy(e,0,i,e.length-n,n),Lr.arraycopy(i,0,e,0,e.length)};_n.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2];if(i===r)return!0;if(i===null||r===null||i.length!==r.length)return!1;for(var h=0;h<i.length;h++)if(a.compare(i[h],r[h])!==0)return!1;return!0}};_n.intersection=function(e,t){for(var n=new gd,i=0;i<e.length;i++)t.intersects(e[i])&&n.add(e[i],!0);return n.toCoordinateArray()};_n.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};_n.removeRepeatedPoints=function(e){if(!_n.hasRepeatedPoints(e))return e;var t=new gd(e,!1);return t.toCoordinateArray()};_n.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=e[i];e[i]=e[t-i],e[t-i]=r}};_n.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var i=new Array(t).fill(null);if(t===0)return i;for(var r=0,a=0;a<e.length;a++)e[a]!==null&&(i[r++]=e[a]);return i};_n.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new Nt(e[n]);return t}else if(arguments.length===5)for(var i=arguments[0],r=arguments[1],a=arguments[2],h=arguments[3],u=arguments[4],_=0;_<u;_++)a[h+_]=new Nt(i[r+_])};_n.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var i=e[n],r=t[e.length-n-1];if(i.compareTo(r)!==0)return!1}return!0};_n.envelope=function(e){for(var t=new Re,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t};_n.toCoordinateArray=function(e){return e.toArray(_n.coordArrayType)};_n.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};_n.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1};_n.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,i=e[t].compareTo(e[n]);if(i!==0)return i}return 1};_n.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var i=e[n].compareTo(t[n]);if(i!==0)return i;n++}return n<t.length?-1:n<e.length?1:0};_n.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t};_n.extract=function(e,t,n){t=Yo.clamp(t,0,e.length),n=Yo.clamp(n,-1,e.length);var i=n-t+1;n<0&&(i=0),t>=e.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(i===0)return r;for(var a=0,h=t;h<=n;h++)r[a++]=e[h];return r};Object.defineProperties(_n,Tg);var Jp=function(){};Jp.prototype.compare=function(e,t){var n=e,i=t;return _n.compare(n,i)};Jp.prototype.interfaces_=function(){return[jh]};Jp.prototype.getClass=function(){return Jp};var Xh=function(){};Xh.prototype.compare=function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;var r=_n.compare(n,i),a=_n.isEqualReversed(n,i);return a?0:r};Xh.prototype.OLDcompare=function(e,t){var n=e,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(n.length===0)return 0;for(var r=_n.increasingDirection(n),a=_n.increasingDirection(i),h=r>0?0:n.length-1,u=a>0?0:n.length-1,_=0;_<n.length;_++){var w=n[h].compareTo(i[u]);if(w!==0)return w;h+=r,u+=a}return 0};Xh.prototype.interfaces_=function(){return[jh]};Xh.prototype.getClass=function(){return Xh};var zc=function(){};zc.prototype.get=function(){};zc.prototype.put=function(){};zc.prototype.size=function(){};zc.prototype.values=function(){};zc.prototype.entrySet=function(){};var bE=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(zc);function _d(e){this.message=e||""}_d.prototype=new Error;_d.prototype.name="OperationNotSupported";function Lg(){}Lg.prototype=new Wi;Lg.prototype.contains=function(){};var Gy=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Wi&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var i=this,r=0,a=this.array_.length;r<a;r++){var h=i.array_[r];if(h===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var i=this,r=n.iterator();r.hasNext();)i.add(r.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,i=[],r=0,a=this.array_.length;r<a;r++)i.push(n.array_[r]);return i},t.prototype.iterator=function(){return new xE(this)},t}(Lg),xE=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new mf;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new _d},t}(df),il=0,xu=1;function a1(e){return e===null?il:e.color}function Yn(e){return e===null?null:e.parent}function Ja(e,t){e!==null&&(e.color=t)}function ty(e){return e===null?null:e.left}function l1(e){return e===null?null:e.right}function Br(){this.root_=null,this.size_=0}Br.prototype=new bE;Br.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};Br.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:il,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,i,r;do if(i=n,r=e.compareTo(n.key),r<0)n=n.left;else if(r>0)n=n.right;else{var a=n.value;return n.value=t,a}while(n!==null);var h={key:e,left:null,right:null,value:t,parent:i,color:il,getValue:function(){return this.value},getKey:function(){return this.key}};return r<0?i.left=h:i.right=h,this.fixAfterInsertion(h),this.size_++,null};Br.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=xu;e!=null&&e!==this.root_&&e.parent.color===xu;)if(Yn(e)===ty(Yn(Yn(e)))){var n=l1(Yn(Yn(e)));a1(n)===xu?(Ja(Yn(e),il),Ja(n,il),Ja(Yn(Yn(e)),xu),e=Yn(Yn(e))):(e===l1(Yn(e))&&(e=Yn(e),t.rotateLeft(e)),Ja(Yn(e),il),Ja(Yn(Yn(e)),xu),t.rotateRight(Yn(Yn(e))))}else{var i=ty(Yn(Yn(e)));a1(i)===xu?(Ja(Yn(e),il),Ja(i,il),Ja(Yn(Yn(e)),xu),e=Yn(Yn(e))):(e===ty(Yn(e))&&(e=Yn(e),t.rotateRight(e)),Ja(Yn(e),il),Ja(Yn(Yn(e)),xu),t.rotateLeft(Yn(Yn(e))))}this.root_.color=il};Br.prototype.values=function(){var e=new pe,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=Br.successor(t))!==null;)e.add(t.value);return e};Br.prototype.entrySet=function(){var e=new Gy,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=Br.successor(t))!==null;)e.add(t);return e};Br.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};Br.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};Br.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};Br.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,i=e;n!==null&&i===n.right;)i=n,n=n.parent;return n}};Br.prototype.size=function(){return this.size_};var Qp=function(){};Qp.prototype.interfaces_=function(){return[]};Qp.prototype.getClass=function(){return Qp};function Dx(){}Dx.prototype=new Lg;function ra(){this.array_=[],arguments[0]instanceof Wi&&this.addAll(arguments[0])}ra.prototype=new Dx;ra.prototype.contains=function(e){for(var t=this,n=0,i=this.array_.length;n<i;n++){var r=t.array_[n];if(r.compareTo(e)===0)return!0}return!1};ra.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,i=this.array_.length;n<i;n++){var r=t.array_[n];if(r.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};ra.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};ra.prototype.remove=function(e){throw new _d};ra.prototype.size=function(){return this.array_.length};ra.prototype.isEmpty=function(){return this.array_.length===0};ra.prototype.toArray=function(){for(var e=this,t=[],n=0,i=this.array_.length;n<i;n++)t.push(e.array_[n]);return t};ra.prototype.iterator=function(){return new Mg(this)};var Mg=function(e){this.treeSet_=e,this.position_=0};Mg.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new mf;return this.treeSet_.array_[this.position_++]};Mg.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};Mg.prototype.remove=function(){throw new _d};var Tu=function(){};Tu.sort=function(){var e=arguments[0],t,n,i,r;if(arguments.length===1)r=function(h,u){return h.compareTo(u)},e.sort(r);else if(arguments.length===2)i=arguments[1],r=function(h,u){return i.compare(h,u)},e.sort(r);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var a=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<a.length;t++)e.push(a[t])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),i=arguments[3],r=function(h,u){return i.compare(h,u)},n.sort(r),a=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<a.length;t++)e.push(a[t])};Tu.asList=function(e){for(var t=new pe,n=0,i=e.length;n<i;n++)t.add(e[n]);return t};var An=function(){},Vs={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Vs.P.get=function(){return 0};Vs.L.get=function(){return 1};Vs.A.get=function(){return 2};Vs.FALSE.get=function(){return-1};Vs.TRUE.get=function(){return-2};Vs.DONTCARE.get=function(){return-3};Vs.SYM_FALSE.get=function(){return"F"};Vs.SYM_TRUE.get=function(){return"T"};Vs.SYM_DONTCARE.get=function(){return"*"};Vs.SYM_P.get=function(){return"0"};Vs.SYM_L.get=function(){return"1"};Vs.SYM_A.get=function(){return"2"};An.prototype.interfaces_=function(){return[]};An.prototype.getClass=function(){return An};An.toDimensionSymbol=function(e){switch(e){case An.FALSE:return An.SYM_FALSE;case An.TRUE:return An.SYM_TRUE;case An.DONTCARE:return An.SYM_DONTCARE;case An.P:return An.SYM_P;case An.L:return An.SYM_L;case An.A:return An.SYM_A}throw new di("Unknown dimension value: "+e)};An.toDimensionValue=function(e){switch(Kp.toUpperCase(e)){case An.SYM_FALSE:return An.FALSE;case An.SYM_TRUE:return An.TRUE;case An.SYM_DONTCARE:return An.DONTCARE;case An.SYM_P:return An.P;case An.SYM_L:return An.L;case An.SYM_A:return An.A}throw new di("Unknown dimension symbol: "+e)};Object.defineProperties(An,Vs);var oa=function(){};oa.prototype.filter=function(e){};oa.prototype.interfaces_=function(){return[]};oa.prototype.getClass=function(){return oa};var Ds=function(){};Ds.prototype.filter=function(e,t){};Ds.prototype.isDone=function(){};Ds.prototype.isGeometryChanged=function(){};Ds.prototype.interfaces_=function(){return[]};Ds.prototype.getClass=function(){return Ds};var to=function(e){function t(i,r){if(e.call(this,r),this._geometries=i||[],e.hasNullElements(this._geometries))throw new di("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var i=this,r=new Re,a=0;a<this._geometries.length;a++)r.expandToInclude(i._geometries[a].getEnvelopeInternal());return r},t.prototype.getGeometryN=function(i){return this._geometries[i]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var i=this,r=new Array(this.getNumPoints()).fill(null),a=-1,h=0;h<this._geometries.length;h++)for(var u=i._geometries[h].getCoordinates(),_=0;_<u.length;_++)a++,r[a]=u[_];return r},t.prototype.getArea=function(){for(var i=this,r=0,a=0;a<this._geometries.length;a++)r+=i._geometries[a].getArea();return r},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],a=arguments[1];if(!this.isEquivalentClass(r))return!1;var h=r;if(this._geometries.length!==h._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!i._geometries[u].equalsExact(h._geometries[u],a))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,r=0;r<this._geometries.length;r++)i._geometries[r].normalize();Tu.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var i=this,r=An.FALSE,a=0;a<this._geometries.length;a++)r=Math.max(r,i._geometries[a].getBoundaryDimension());return r},t.prototype.getDimension=function(){for(var i=this,r=An.FALSE,a=0;a<this._geometries.length;a++)r=Math.max(r,i._geometries[a].getDimension());return r},t.prototype.getLength=function(){for(var i=this,r=0,a=0;a<this._geometries.length;a++)r+=i._geometries[a].getLength();return r},t.prototype.getNumPoints=function(){for(var i=this,r=0,a=0;a<this._geometries.length;a++)r+=i._geometries[a].getNumPoints();return r},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,a=new Array(r).fill(null),h=0;h<this._geometries.length;h++)a[h]=i._geometries[h].reverse();return this.getFactory().createGeometryCollection(a)},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var r=arguments[0],a=new ra(Tu.asList(this._geometries)),h=new ra(Tu.asList(r._geometries));return this.compare(a,h)}else if(arguments.length===2){for(var u=arguments[0],_=arguments[1],w=u,S=this.getNumGeometries(),E=w.getNumGeometries(),M=0;M<S&&M<E;){var k=i.getGeometryN(M),D=w.getGeometryN(M),F=k.compareToSameClass(D,_);if(F!==0)return F;M++}return M<S?1:M<E?-1:0}},t.prototype.apply=function(){var i=this;if(He(arguments[0],Aa))for(var r=arguments[0],a=0;a<this._geometries.length;a++)i._geometries[a].apply(r);else if(He(arguments[0],Ds)){var h=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(i._geometries[u].apply(h),!h.isDone());u++);h.isGeometryChanged()&&this.geometryChanged()}else if(He(arguments[0],oa)){var _=arguments[0];_.filter(this);for(var w=0;w<this._geometries.length;w++)i._geometries[w].apply(_)}else if(He(arguments[0],ul)){var S=arguments[0];S.filter(this);for(var E=0;E<this._geometries.length;E++)i._geometries[E].apply(S)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),un.shouldNeverReachHere(),null},t.prototype.clone=function(){var i=this,r=e.prototype.clone.call(this);r._geometries=new Array(this._geometries.length).fill(null);for(var a=0;a<this._geometries.length;a++)r._geometries[a]=i._geometries[a].clone();return r},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),a=0;a<r.length;a++)r[a]=i._geometries[a].copy();return new t(r,this._factory)},t.prototype.isEmpty=function(){for(var i=this,r=0;r<this._geometries.length;r++)if(!i._geometries[r].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}(Ze),ku=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ze.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?An.FALSE:0},t.prototype.isClosed=function(){var i=this;if(this.isEmpty())return!1;for(var r=0;r<this._geometries.length;r++)if(!i._geometries[r].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,a=new Array(r).fill(null),h=0;h<this._geometries.length;h++)a[r-1-h]=i._geometries[h].reverse();return this.getFactory().createMultiLineString(a)},t.prototype.getBoundary=function(){return new cs(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),a=0;a<r.length;a++)r[a]=i._geometries[a].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[Qp]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(to),cs=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=ds.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=i}};cs.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};cs.prototype.getBoundary=function(){return this._geom instanceof Ii?this.boundaryLineString(this._geom):this._geom instanceof ku?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};cs.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};cs.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};cs.prototype.computeBoundaryCoordinates=function(e){var t=this,n=new pe;this._endpointMap=new Br;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);r.getNumPoints()!==0&&(t.addEndpoint(r.getCoordinateN(0)),t.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var a=this._endpointMap.entrySet().iterator();a.hasNext();){var h=a.next(),u=h.getValue(),_=u.count;t._bnRule.isInBoundary(_)&&n.add(h.getKey())}return _n.toCoordinateArray(n)};cs.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new rg,this._endpointMap.put(e,t)),t.count++};cs.prototype.interfaces_=function(){return[]};cs.prototype.getClass=function(){return cs};cs.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new cs(e);return t.getBoundary()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=new cs(n,i);return r.getBoundary()}};var rg=function(){this.count=null};rg.prototype.interfaces_=function(){return[]};rg.prototype.getClass=function(){return rg};function wE(){}function SE(){}var IE=function(){};function EE(){}function CE(){}function TE(){}var hs=function(){},jy={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};hs.prototype.interfaces_=function(){return[]};hs.prototype.getClass=function(){return hs};hs.chars=function(e,t){for(var n=new Array(t).fill(null),i=0;i<t;i++)n[i]=e;return String(n)};hs.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new EE,n=new wE;return e.printStackTrace(n),t.toString()}else if(arguments.length===2){var i=arguments[0],r=arguments[1],a="";new SE(hs.getStackTrace(i));for(var h=new TE,u=0;u<r;u++)try{a+=h.readLine()+hs.NEWLINE}catch(_){if(_ instanceof CE)un.shouldNeverReachHere();else throw _}finally{}return a}};hs.split=function(e,t){for(var n=t.length,i=new pe,r=""+e,a=r.indexOf(t);a>=0;){var h=r.substring(0,a);i.add(h),r=r.substring(a+n),a=r.indexOf(t)}r.length>0&&i.add(r);for(var u=new Array(i.size()).fill(null),_=0;_<u.length;_++)u[_]=i.get(_);return u};hs.toString=function(){if(arguments.length===1){var e=arguments[0];return hs.SIMPLE_ORDINATE_FORMAT.format(e)}};hs.spaces=function(e){return hs.chars(" ",e)};jy.NEWLINE.get=function(){return Lr.getProperty("line.separator")};jy.SIMPLE_ORDINATE_FORMAT.get=function(){return new IE};Object.defineProperties(hs,jy);var Di=function(){};Di.prototype.interfaces_=function(){return[]};Di.prototype.getClass=function(){return Di};Di.copyCoord=function(e,t,n,i){for(var r=Math.min(e.getDimension(),n.getDimension()),a=0;a<r;a++)n.setOrdinate(i,a,e.getOrdinate(t,a))};Di.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,Pn.X)===e.getOrdinate(t-1,Pn.X)&&e.getOrdinate(0,Pn.Y)===e.getOrdinate(t-1,Pn.Y)};Di.isEqual=function(e,t){var n=e.size(),i=t.size();if(n!==i)return!1;for(var r=Math.min(e.getDimension(),t.getDimension()),a=0;a<n;a++)for(var h=0;h<r;h++){var u=e.getOrdinate(a,h),_=t.getOrdinate(a,h);if(e.getOrdinate(a,h)!==t.getOrdinate(a,h)&&!(tn.isNaN(u)&&tn.isNaN(_)))return!1}return!0};Di.extend=function(e,t,n){var i=e.create(n,t.getDimension()),r=t.size();if(Di.copy(t,0,i,0,r),r>0)for(var a=r;a<n;a++)Di.copy(t,r-1,i,a,1);return i};Di.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),i=0;i<=n;i++)Di.swap(e,i,t-i)};Di.swap=function(e,t,n){if(t===n)return null;for(var i=0;i<e.getDimension();i++){var r=e.getOrdinate(t,i);e.setOrdinate(t,i,e.getOrdinate(n,i)),e.setOrdinate(n,i,r)}};Di.copy=function(e,t,n,i,r){for(var a=0;a<r;a++)Di.copyCoord(e,t+a,n,i+a)};Di.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var n=e.getDimension(),i=new ma;i.append("(");for(var r=0;r<t;r++){r>0&&i.append(" ");for(var a=0;a<n;a++)a>0&&i.append(","),i.append(hs.toString(e.getOrdinate(r,a)))}return i.append(")"),i.toString()}};Di.ensureValidRing=function(e,t){var n=t.size();if(n===0)return t;if(n<=3)return Di.createClosedRing(e,t,4);var i=t.getOrdinate(0,Pn.X)===t.getOrdinate(n-1,Pn.X)&&t.getOrdinate(0,Pn.Y)===t.getOrdinate(n-1,Pn.Y);return i?t:Di.createClosedRing(e,t,n+1)};Di.createClosedRing=function(e,t,n){var i=e.create(n,t.getDimension()),r=t.size();Di.copy(t,0,i,0,r);for(var a=r;a<n;a++)Di.copy(t,0,i,a,1);return i};var Ii=function(e){function t(i,r){e.call(this,r),this._points=null,this.init(i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Re:this._points.expandEnvelope(new Re)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],a=arguments[1];if(!this.isEquivalentClass(r))return!1;var h=r;if(this._points.size()!==h._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!i.equal(i._points.getCoordinate(u),h._points.getCoordinate(u),a))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var i=this,r=0;r<Math.trunc(this._points.size()/2);r++){var a=i._points.size()-1-r;if(!i._points.getCoordinate(r).equals(i._points.getCoordinate(a)))return i._points.getCoordinate(r).compareTo(i._points.getCoordinate(a))>0&&Di.reverse(i._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?An.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return be.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var i=this._points.copy();Di.reverse(i);var r=this.getFactory().createLineString(i);return r},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){for(var r=arguments[0],a=r,h=0,u=0;h<this._points.size()&&u<a._points.size();){var _=i._points.getCoordinate(h).compareTo(a._points.getCoordinate(u));if(_!==0)return _;h++,u++}return h<this._points.size()?1:u<a._points.size()?-1:0}else if(arguments.length===2){var w=arguments[0],S=arguments[1],E=w;return S.compare(this._points,E._points)}},t.prototype.apply=function(){var i=this;if(He(arguments[0],Aa))for(var r=arguments[0],a=0;a<this._points.size();a++)r.filter(i._points.getCoordinate(a));else if(He(arguments[0],Ds)){var h=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(h.filter(i._points,u),!h.isDone());u++);h.isGeometryChanged()&&this.geometryChanged()}else if(He(arguments[0],oa)){var _=arguments[0];_.filter(this)}else if(He(arguments[0],ul)){var w=arguments[0];w.filter(this)}},t.prototype.getBoundary=function(){return new cs(this).getBoundary()},t.prototype.isEquivalentClass=function(i){return i instanceof t},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._points=this._points.clone(),i},t.prototype.getCoordinateN=function(i){return this._points.getCoordinate(i)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(i){if(i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),i.size()===1)throw new di("Invalid number of points in LineString (found "+i.size()+" - must be 0 or >= 2)");this._points=i},t.prototype.isCoordinate=function(i){for(var r=this,a=0;a<this._points.size();a++)if(r._points.getCoordinate(a).equals(i))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(i){return this.getFactory().createPoint(this._points.getCoordinate(i))},t.prototype.interfaces_=function(){return[Qp]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(Ze),td=function(){};td.prototype.interfaces_=function(){return[]};td.prototype.getClass=function(){return td};var Do=function(e){function t(i,r){e.call(this,r),this._coordinates=i||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Re;var i=new Re;return i.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),i},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?this.isEmpty()&&i.isEmpty()?!0:this.isEmpty()!==i.isEmpty()?!1:this.equal(i.getCoordinate(),this.getCoordinate(),r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return An.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var i=arguments[0],r=i;return this.getCoordinate().compareTo(r.getCoordinate())}else if(arguments.length===2){var a=arguments[0],h=arguments[1],u=a;return h.compare(this._coordinates,u._coordinates)}},t.prototype.apply=function(){if(He(arguments[0],Aa)){var i=arguments[0];if(this.isEmpty())return null;i.filter(this.getCoordinate())}else if(He(arguments[0],Ds)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this._coordinates,0),r.isGeometryChanged()&&this.geometryChanged()}else if(He(arguments[0],oa)){var a=arguments[0];a.filter(this)}else if(He(arguments[0],ul)){var h=arguments[0];h.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var i=e.prototype.clone.call(this);return i._coordinates=this._coordinates.clone(),i},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(i){i===null&&(i=this.getFactory().getCoordinateSequenceFactory().create([])),un.isTrue(i.size()<=1),this._coordinates=i},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[td]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}(Ze),ql=function(){};ql.prototype.interfaces_=function(){return[]};ql.prototype.getClass=function(){return ql};var Yi=function(e){function t(i,r,a){if(e.call(this,a),this._shell=null,this._holes=null,i===null&&(i=this.getFactory().createLinearRing()),r===null&&(r=[]),e.hasNullElements(r))throw new di("holes must not contain null elements");if(i.isEmpty()&&e.hasNonEmptyElements(r))throw new di("shell is empty but holes are not");this._shell=i,this._holes=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var i=this;if(this.isEmpty())return[];for(var r=new Array(this.getNumPoints()).fill(null),a=-1,h=this._shell.getCoordinates(),u=0;u<h.length;u++)a++,r[a]=h[u];for(var _=0;_<this._holes.length;_++)for(var w=i._holes[_].getCoordinates(),S=0;S<w.length;S++)a++,r[a]=w[S];return r},t.prototype.getArea=function(){var i=this,r=0;r+=Math.abs(be.signedArea(this._shell.getCoordinateSequence()));for(var a=0;a<this._holes.length;a++)r-=Math.abs(be.signedArea(i._holes[a].getCoordinateSequence()));return r},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var i=this._shell.getCoordinateSequence(),r=this.getEnvelopeInternal(),a=0;a<5;a++){var h=i.getX(a);if(!(h===r.getMinX()||h===r.getMaxX()))return!1;var u=i.getY(a);if(!(u===r.getMinY()||u===r.getMaxY()))return!1}for(var _=i.getX(0),w=i.getY(0),S=1;S<=4;S++){var E=i.getX(S),M=i.getY(S),k=E!==_,D=M!==w;if(k===D)return!1;_=E,w=M}return!0},t.prototype.equalsExact=function(){var i=this;if(arguments.length===2){var r=arguments[0],a=arguments[1];if(!this.isEquivalentClass(r))return!1;var h=r,u=this._shell,_=h._shell;if(!u.equalsExact(_,a)||this._holes.length!==h._holes.length)return!1;for(var w=0;w<this._holes.length;w++)if(!i._holes[w].equalsExact(h._holes[w],a))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var i=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var r=0;r<this._holes.length;r++)i.normalize(i._holes[r],!1);Tu.sort(this._holes)}else if(arguments.length===2){var a=arguments[0],h=arguments[1];if(a.isEmpty())return null;var u=new Array(a.getCoordinates().length-1).fill(null);Lr.arraycopy(a.getCoordinates(),0,u,0,u.length);var _=_n.minCoordinate(a.getCoordinates());_n.scroll(u,_),Lr.arraycopy(u,0,a.getCoordinates(),0,u.length),a.getCoordinates()[u.length]=u[0],be.isCCW(a.getCoordinates())===h&&_n.reverse(a.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var i=this,r=0;r+=this._shell.getLength();for(var a=0;a<this._holes.length;a++)r+=i._holes[a].getLength();return r},t.prototype.getNumPoints=function(){for(var i=this,r=this._shell.getNumPoints(),a=0;a<this._holes.length;a++)r+=i._holes[a].getNumPoints();return r},t.prototype.reverse=function(){var i=this,r=this.copy();r._shell=this._shell.copy().reverse(),r._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)r._holes[a]=i._holes[a].copy().reverse();return r},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var i=this;if(arguments.length===1){var r=arguments[0],a=this._shell,h=r._shell;return a.compareToSameClass(h)}else if(arguments.length===2){var u=arguments[0],_=arguments[1],w=u,S=this._shell,E=w._shell,M=S.compareToSameClass(E,_);if(M!==0)return M;for(var k=this.getNumInteriorRing(),D=w.getNumInteriorRing(),F=0;F<k&&F<D;){var q=i.getInteriorRingN(F),X=w.getInteriorRingN(F),B=q.compareToSameClass(X,_);if(B!==0)return B;F++}return F<k?1:F<D?-1:0}},t.prototype.apply=function(i){var r=this;if(He(i,Aa)){this._shell.apply(i);for(var a=0;a<this._holes.length;a++)r._holes[a].apply(i)}else if(He(i,Ds)){if(this._shell.apply(i),!i.isDone())for(var h=0;h<this._holes.length&&(r._holes[h].apply(i),!i.isDone());h++);i.isGeometryChanged()&&this.geometryChanged()}else if(He(i,oa))i.filter(this);else if(He(i,ul)){i.filter(this),this._shell.apply(i);for(var u=0;u<this._holes.length;u++)r._holes[u].apply(i)}},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var r=new Array(this._holes.length+1).fill(null);r[0]=this._shell;for(var a=0;a<this._holes.length;a++)r[a+1]=i._holes[a];return r.length<=1?this.getFactory().createLinearRing(r[0].getCoordinateSequence()):this.getFactory().createMultiLineString(r)},t.prototype.clone=function(){var i=this,r=e.prototype.clone.call(this);r._shell=this._shell.clone(),r._holes=new Array(this._holes.length).fill(null);for(var a=0;a<this._holes.length;a++)r._holes[a]=i._holes[a].clone();return r},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var i=this,r=this._shell.copy(),a=new Array(this._holes.length).fill(null),h=0;h<a.length;h++)a[h]=i._holes[h].copy();return new t(r,a,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(i){return this._holes[i]},t.prototype.interfaces_=function(){return[ql]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(Ze),Yh=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ze.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var i=arguments[0];return this._geometries[i].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return An.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),a=0;a<r.length;a++)r[a]=i._geometries[a].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[td]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(to),Da=function(e){function t(i,r){i instanceof Nt&&r instanceof gn&&(i=r.getCoordinateSequenceFactory().create(i)),e.call(this,i,r),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ze.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return An.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var i=this._points.copy();Di.reverse(i);var r=this.getFactory().createLinearRing(i);return r},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new di("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new di("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(Ii),Pa=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ze.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return this.isEquivalentClass(i)?e.prototype.equalsExact.call(this,i,r):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var i=this,r=this._geometries.length,a=new Array(r).fill(null),h=0;h<this._geometries.length;h++)a[h]=i._geometries[h].reverse();return this.getFactory().createMultiPolygon(a)},t.prototype.getBoundary=function(){var i=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var r=new pe,a=0;a<this._geometries.length;a++)for(var h=i._geometries[a],u=h.getBoundary(),_=0;_<u.getNumGeometries();_++)r.add(u.getGeometryN(_));var w=new Array(r.size()).fill(null);return this.getFactory().createMultiLineString(r.toArray(w))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var i=this,r=new Array(this._geometries.length).fill(null),a=0;a<r.length;a++)r[a]=i._geometries[a].copy();return new t(r,this._factory)},t.prototype.interfaces_=function(){return[ql]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(to),ms=function(e){this._factory=e||null,this._isUserDataCopied=!1},Pg={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};ms.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};ms.prototype.edit=function(e,t){if(e===null)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};ms.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof to?this.editGeometryCollection(e,t):e instanceof Yi?this.editPolygon(e,t):e instanceof Do?t.edit(e,this._factory):e instanceof Ii?t.edit(e,this._factory):(un.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};ms.prototype.editGeometryCollection=function(e,t){for(var n=this,i=t.edit(e,this._factory),r=new pe,a=0;a<i.getNumGeometries();a++){var h=n.edit(i.getGeometryN(a),t);h===null||h.isEmpty()||r.add(h)}return i.getClass()===Yh?this._factory.createMultiPoint(r.toArray([])):i.getClass()===ku?this._factory.createMultiLineString(r.toArray([])):i.getClass()===Pa?this._factory.createMultiPolygon(r.toArray([])):this._factory.createGeometryCollection(r.toArray([]))};ms.prototype.editPolygon=function(e,t){var n=this,i=t.edit(e,this._factory);if(i===null&&(i=this._factory.createPolygon(null)),i.isEmpty())return i;var r=this.edit(i.getExteriorRing(),t);if(r===null||r.isEmpty())return this._factory.createPolygon();for(var a=new pe,h=0;h<i.getNumInteriorRing();h++){var u=n.edit(i.getInteriorRingN(h),t);u===null||u.isEmpty()||a.add(u)}return this._factory.createPolygon(r,a.toArray([]))};ms.prototype.interfaces_=function(){return[]};ms.prototype.getClass=function(){return ms};ms.GeometryEditorOperation=function(){};Pg.NoOpGeometryOperation.get=function(){return ed};Pg.CoordinateOperation.get=function(){return nd};Pg.CoordinateSequenceOperation.get=function(){return id};Object.defineProperties(ms,Pg);var ed=function(){};ed.prototype.edit=function(e,t){return e};ed.prototype.interfaces_=function(){return[ms.GeometryEditorOperation]};ed.prototype.getClass=function(){return ed};var nd=function(){};nd.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof Da?t.createLinearRing(n):e instanceof Ii?t.createLineString(n):e instanceof Do?n.length>0?t.createPoint(n[0]):t.createPoint():e};nd.prototype.interfaces_=function(){return[ms.GeometryEditorOperation]};nd.prototype.getClass=function(){return nd};var id=function(){};id.prototype.edit=function(e,t){return e instanceof Da?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof Ii?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof Do?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};id.prototype.interfaces_=function(){return[ms.GeometryEditorOperation]};id.prototype.getClass=function(){return id};var ki=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)e._coordinates[n]=new Nt}else if(He(arguments[0],Pn)){var i=arguments[0];if(i===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=i.getDimension(),this._coordinates=new Array(i.size()).fill(null);for(var r=0;r<this._coordinates.length;r++)e._coordinates[r]=i.getCoordinateCopy(r)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this._coordinates=a,this._dimension=h,a===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],_=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=_;for(var w=0;w<u;w++)e._coordinates[w]=new Nt}}},Nx={serialVersionUID:{configurable:!0}};ki.prototype.setOrdinate=function(e,t,n){switch(t){case Pn.X:this._coordinates[e].x=n;break;case Pn.Y:this._coordinates[e].y=n;break;case Pn.Z:this._coordinates[e].z=n;break;default:throw new di("invalid ordinateIndex")}};ki.prototype.size=function(){return this._coordinates.length};ki.prototype.getOrdinate=function(e,t){switch(t){case Pn.X:return this._coordinates[e].x;case Pn.Y:return this._coordinates[e].y;case Pn.Z:return this._coordinates[e].z}return tn.NaN};ki.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}};ki.prototype.getCoordinateCopy=function(e){return new Nt(this._coordinates[e])};ki.prototype.getDimension=function(){return this._dimension};ki.prototype.getX=function(e){return this._coordinates[e].x};ki.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].clone();return new ki(t,this._dimension)};ki.prototype.expandEnvelope=function(e){for(var t=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(t._coordinates[n]);return e};ki.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].copy();return new ki(t,this._dimension)};ki.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new ma(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)t.append(", "),t.append(e._coordinates[n]);return t.append(")"),t.toString()}else return"()"};ki.prototype.getY=function(e){return this._coordinates[e].y};ki.prototype.toCoordinateArray=function(){return this._coordinates};ki.prototype.interfaces_=function(){return[Pn,ys]};ki.prototype.getClass=function(){return ki};Nx.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(ki,Nx);var Na=function(){},qy={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Na.prototype.readResolve=function(){return Na.instance()};Na.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new ki(e)}else if(He(arguments[0],Pn)){var t=arguments[0];return new ki(t)}}else if(arguments.length===2){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new ki(n):new ki(n,i)}};Na.prototype.interfaces_=function(){return[qh,ys]};Na.prototype.getClass=function(){return Na};Na.instance=function(){return Na.instanceObject};qy.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};qy.instanceObject.get=function(){return new Na};Object.defineProperties(Na,qy);var Rx=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,i){return this.map_.set(n,i),i},t.prototype.values=function(){for(var n=new pe,i=this.map_.values(),r=i.next();!r.done;)n.add(r.value),r=i.next();return n},t.prototype.entrySet=function(){var n=new Gy;return this.map_.entries().forEach(function(i){return n.add(i)}),n},t.prototype.size=function(){return this.map_.size()},t}(zc),Nn=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof sa){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var i=arguments[0];this._modelType=i._modelType,this._scale=i._scale}}},Zy={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Nn.prototype.equals=function(e){if(!(e instanceof Nn))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};Nn.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return new ia(n).compareTo(new ia(i))};Nn.prototype.getScale=function(){return this._scale};Nn.prototype.isFloating=function(){return this._modelType===Nn.FLOATING||this._modelType===Nn.FLOATING_SINGLE};Nn.prototype.getType=function(){return this._modelType};Nn.prototype.toString=function(){var e="UNKNOWN";return this._modelType===Nn.FLOATING?e="Floating":this._modelType===Nn.FLOATING_SINGLE?e="Floating-Single":this._modelType===Nn.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};Nn.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(tn.isNaN(e))return e;if(this._modelType===Nn.FLOATING_SINGLE){var t=e;return t}return this._modelType===Nn.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof Nt){var n=arguments[0];if(this._modelType===Nn.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};Nn.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===Nn.FLOATING?e=16:this._modelType===Nn.FLOATING_SINGLE?e=6:this._modelType===Nn.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};Nn.prototype.setScale=function(e){this._scale=Math.abs(e)};Nn.prototype.interfaces_=function(){return[ys,_s]};Nn.prototype.getClass=function(){return Nn};Nn.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};Zy.serialVersionUID.get=function(){return 7777263578777804e3};Zy.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Nn,Zy);var sa=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},Wy={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};sa.prototype.readResolve=function(){return sa.nameToTypeMap.get(this._name)};sa.prototype.toString=function(){return this._name};sa.prototype.interfaces_=function(){return[ys]};sa.prototype.getClass=function(){return sa};Wy.serialVersionUID.get=function(){return-552860263173159e4};Wy.nameToTypeMap.get=function(){return new Rx};Object.defineProperties(sa,Wy);Nn.Type=sa;Nn.FIXED=new sa("FIXED");Nn.FLOATING=new sa("FLOATING");Nn.FLOATING_SINGLE=new sa("FLOATING SINGLE");var gn=function e(){this._precisionModel=new Nn,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?He(arguments[0],qh)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Nn&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},zx={serialVersionUID:{configurable:!0}};gn.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new Nt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new Nt(e.getMinX(),e.getMinY()),new Nt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new Nt(e.getMinX(),e.getMinY()),new Nt(e.getMinX(),e.getMaxY()),new Nt(e.getMaxX(),e.getMaxY()),new Nt(e.getMaxX(),e.getMinY()),new Nt(e.getMinX(),e.getMinY())]),null)};gn.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new Ii(this.getCoordinateSequenceFactory().create(e),this);if(He(e,Pn))return new Ii(e,this)}else return new Ii(this.getCoordinateSequenceFactory().create([]),this)};gn.prototype.createMultiLineString=function(){if(arguments.length===0)return new ku(null,this);if(arguments.length===1){var e=arguments[0];return new ku(e,this)}};gn.prototype.buildGeometry=function(e){for(var t=null,n=!1,i=!1,r=e.iterator();r.hasNext();){var a=r.next(),h=a.getClass();t===null&&(t=h),h!==t&&(n=!0),a.isGeometryCollectionOrDerived()&&(i=!0)}if(t===null)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(gn.toGeometryArray(e));var u=e.iterator().next(),_=e.size()>1;if(_){if(u instanceof Yi)return this.createMultiPolygon(gn.toPolygonArray(e));if(u instanceof Ii)return this.createMultiLineString(gn.toLineStringArray(e));if(u instanceof Do)return this.createMultiPoint(gn.toPointArray(e));un.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};gn.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};gn.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Nt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(He(arguments[0],Pn)){var t=arguments[0];return new Do(t,this)}}};gn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};gn.prototype.createPolygon=function(){if(arguments.length===0)return new Yi(null,null,this);if(arguments.length===1){if(He(arguments[0],Pn)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Da){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];return new Yi(i,r,this)}};gn.prototype.getSRID=function(){return this._SRID};gn.prototype.createGeometryCollection=function(){if(arguments.length===0)return new to(null,this);if(arguments.length===1){var e=arguments[0];return new to(e,this)}};gn.prototype.createGeometry=function(e){var t=new ms(this);return t.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};gn.prototype.getPrecisionModel=function(){return this._precisionModel};gn.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(He(arguments[0],Pn)){var t=arguments[0];return new Da(t,this)}}};gn.prototype.createMultiPolygon=function(){if(arguments.length===0)return new Pa(null,this);if(arguments.length===1){var e=arguments[0];return new Pa(e,this)}};gn.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Yh(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Yh(t,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(He(arguments[0],Pn)){var i=arguments[0];if(i===null)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),a=0;a<i.size();a++){var h=e.getCoordinateSequenceFactory().create(1,i.getDimension());Di.copy(i,a,h,0,1),r[a]=e.createPoint(h)}return this.createMultiPoint(r)}}};gn.prototype.interfaces_=function(){return[ys]};gn.prototype.getClass=function(){return gn};gn.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.getDefaultCoordinateSequenceFactory=function(){return Na.instance()};gn.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};gn.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};zx.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(gn,zx);var LE=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],kg=function(e){this.geometryFactory=e||new gn};kg.prototype.read=function(e){var t;typeof e=="string"?t=JSON.parse(e):t=e;var n=t.type;if(!Xs[n])throw new Error("Unknown GeoJSON type: "+t.type);return LE.indexOf(n)!==-1?Xs[n].apply(this,[t.coordinates]):n==="GeometryCollection"?Xs[n].apply(this,[t.geometries]):Xs[n].apply(this,[t])};kg.prototype.write=function(e){var t=e.getGeometryType();if(!el[t])throw new Error("Geometry is not supported");return el[t].apply(this,[e])};var Xs={Feature:function(e){var t={};for(var n in e)t[n]=e[n];if(e.geometry){var i=e.geometry.type;if(!Xs[i])throw new Error("Unknown GeoJSON type: "+e.type);t.geometry=this.read(e.geometry)}return e.bbox&&(t.bbox=Xs.bbox.apply(this,[e.bbox])),t},FeatureCollection:function(e){var t=this,n={};if(e.features){n.features=[];for(var i=0;i<e.features.length;++i)n.features.push(t.read(e.features[i]))}return e.bbox&&(n.bbox=this.parse.bbox.apply(this,[e.bbox])),n},coordinates:function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];t.push(new Nt(i[0],i[1]))}return t},bbox:function(e){return this.geometryFactory.createLinearRing([new Nt(e[0],e[1]),new Nt(e[2],e[1]),new Nt(e[2],e[3]),new Nt(e[0],e[3]),new Nt(e[0],e[1])])},Point:function(e){var t=new Nt(e[0],e[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(e){for(var t=this,n=[],i=0;i<e.length;++i)n.push(Xs.Point.apply(t,[e[i]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(e){var t=Xs.coordinates.apply(this,[e]);return this.geometryFactory.createLineString(t)},MultiLineString:function(e){for(var t=this,n=[],i=0;i<e.length;++i)n.push(Xs.LineString.apply(t,[e[i]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(e){for(var t=this,n=Xs.coordinates.apply(this,[e[0]]),i=this.geometryFactory.createLinearRing(n),r=[],a=1;a<e.length;++a){var h=e[a],u=Xs.coordinates.apply(t,[h]),_=t.geometryFactory.createLinearRing(u);r.push(_)}return this.geometryFactory.createPolygon(i,r)},MultiPolygon:function(e){for(var t=this,n=[],i=0;i<e.length;++i){var r=e[i];n.push(Xs.Polygon.apply(t,[r]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(e){for(var t=this,n=[],i=0;i<e.length;++i){var r=e[i];n.push(t.read(r))}return this.geometryFactory.createGeometryCollection(n)}},el={coordinate:function(e){return[e.x,e.y]},Point:function(e){var t=el.coordinate.apply(this,[e.getCoordinate()]);return{type:"Point",coordinates:t}},MultiPoint:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],a=el.Point.apply(t,[r]);n.push(a.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(e){for(var t=this,n=[],i=e.getCoordinates(),r=0;r<i.length;++r){var a=i[r];n.push(el.coordinate.apply(t,[a]))}return{type:"LineString",coordinates:n}},MultiLineString:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],a=el.LineString.apply(t,[r]);n.push(a.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(e){var t=this,n=[],i=el.LineString.apply(this,[e._shell]);n.push(i.coordinates);for(var r=0;r<e._holes.length;++r){var a=e._holes[r],h=el.LineString.apply(t,[a]);n.push(h.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],a=el.Polygon.apply(t,[r]);n.push(a.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(e){for(var t=this,n=[],i=0;i<e._geometries.length;++i){var r=e._geometries[i],a=r.getGeometryType();n.push(el[a].apply(t,[r]))}return{type:"GeometryCollection",geometries:n}}},Hy=function(e){this.geometryFactory=e||new gn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new kg(this.geometryFactory)};Hy.prototype.read=function(e){var t=this.parser.read(e);return this.precisionModel.getType()===Nn.FIXED&&this.reducePrecision(t),t};Hy.prototype.reducePrecision=function(e){var t=this,n,i;if(e.coordinate)this.precisionModel.makePrecise(e.coordinate);else if(e.points)for(n=0,i=e.points.length;n<i;n++)t.precisionModel.makePrecise(e.points[n]);else if(e.geometries)for(n=0,i=e.geometries.length;n<i;n++)t.reducePrecision(e.geometries[n])};var Ox=function(){this.parser=new kg(this.geometryFactory)};Ox.prototype.write=function(e){return this.parser.write(e)};var le=function(){},Ag={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};le.prototype.interfaces_=function(){return[]};le.prototype.getClass=function(){return le};le.opposite=function(e){return e===le.LEFT?le.RIGHT:e===le.RIGHT?le.LEFT:e};Ag.ON.get=function(){return 0};Ag.LEFT.get=function(){return 1};Ag.RIGHT.get=function(){return 2};Object.defineProperties(le,Ag);function Dg(e){this.message=e||""}Dg.prototype=new Error;Dg.prototype.name="EmptyStackException";function ga(){this.array_=[]}ga.prototype=new Ps;ga.prototype.add=function(e){return this.array_.push(e),!0};ga.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};ga.prototype.push=function(e){return this.array_.push(e),e};ga.prototype.pop=function(e){if(this.array_.length===0)throw new Dg;return this.array_.pop()};ga.prototype.peek=function(){if(this.array_.length===0)throw new Dg;return this.array_[this.array_.length-1]};ga.prototype.empty=function(){return this.array_.length===0};ga.prototype.isEmpty=function(){return this.empty()};ga.prototype.search=function(e){return this.array_.indexOf(e)};ga.prototype.size=function(){return this.array_.length};ga.prototype.toArray=function(){for(var e=this,t=[],n=0,i=this.array_.length;n<i;n++)t.push(e.array_[n]);return t};var aa=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};aa.prototype.getCoordinate=function(){return this._minCoord};aa.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};aa.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();un.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],i=be.computeOrientation(this._minCoord,n,t),r=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&i===be.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&i===be.CLOCKWISE)&&(r=!0),r&&(this._minIndex=this._minIndex-1)};aa.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge(),i=n.getCoordinates();if(t<0||t+1>=i.length||i[t].y===i[t+1].y)return-1;var r=le.LEFT;return i[t].y<i[t+1].y&&(r=le.RIGHT),r};aa.prototype.getEdge=function(){return this._orientedDe};aa.prototype.checkForRightmostCoordinate=function(e){for(var t=this,n=e.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(t._minCoord===null||n[i].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=i,t._minCoord=n[i])};aa.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};aa.prototype.findEdge=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next();i.isForward()&&t.checkForRightmostCoordinate(i)}un.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var r=this.getRightmostSide(this._minDe,this._minIndex);r===le.LEFT&&(this._orientedDe=this._minDe.getSym())};aa.prototype.interfaces_=function(){return[]};aa.prototype.getClass=function(){return aa};var cl=function(e){function t(n,i){e.call(this,t.msgWithCoord(n,i)),this.pt=i?new Nt(i):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,i){return i?n:n+" [ "+i+" ]"},t}(ll),Ng=function(){this.array_=[]};Ng.prototype.addLast=function(e){this.array_.push(e)};Ng.prototype.removeFirst=function(){return this.array_.shift()};Ng.prototype.isEmpty=function(){return this.array_.length===0};var eo=function(){this._finder=null,this._dirEdgeList=new pe,this._nodes=new pe,this._rightMostCoord=null,this._env=null,this._finder=new aa};eo.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};eo.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};eo.prototype.computeNodeDepth=function(e){for(var t=this,n=null,i=e.getEdges().iterator();i.hasNext();){var r=i.next();if(r.isVisited()||r.getSym().isVisited()){n=r;break}}if(n===null)throw new cl("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var a=e.getEdges().iterator();a.hasNext();){var h=a.next();h.setVisited(!0),t.copySymDepths(h)}};eo.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(le.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};eo.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};eo.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(le.RIGHT)>=1&&t.getDepth(le.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};eo.prototype.computeDepths=function(e){var t=this,n=new Gy,i=new Ng,r=e.getNode();for(i.addLast(r),n.add(r),e.setVisited(!0);!i.isEmpty();){var a=i.removeFirst();n.add(a),t.computeNodeDepth(a);for(var h=a.getEdges().iterator();h.hasNext();){var u=h.next(),_=u.getSym();if(!_.isVisited()){var w=_.getNode();n.contains(w)||(i.addLast(w),n.add(w))}}}};eo.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};eo.prototype.getEnvelope=function(){if(this._env===null){for(var e=new Re,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next(),i=n.getEdge().getCoordinates(),r=0;r<i.length-1;r++)e.expandToInclude(i[r]);this._env=e}return this._env};eo.prototype.addReachable=function(e){var t=this,n=new ga;for(n.add(e);!n.empty();){var i=n.pop();t.add(i,n)}};eo.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(le.LEFT,e.getDepth(le.RIGHT)),t.setDepth(le.RIGHT,e.getDepth(le.LEFT))};eo.prototype.add=function(e,t){var n=this;e.setVisited(!0),this._nodes.add(e);for(var i=e.getEdges().iterator();i.hasNext();){var r=i.next();n._dirEdgeList.add(r);var a=r.getSym(),h=a.getNode();h.isVisited()||t.push(h)}};eo.prototype.getNodes=function(){return this._nodes};eo.prototype.getDirectedEdges=function(){return this._dirEdgeList};eo.prototype.interfaces_=function(){return[_s]};eo.prototype.getClass=function(){return eo};var Kn=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[le.ON]=i}else if(arguments[0]instanceof e){var r=arguments[0];if(this.init(r.location.length),r!==null)for(var a=0;a<this.location.length;a++)t.location[a]=r.location[a]}}else if(arguments.length===3){var h=arguments[0],u=arguments[1],_=arguments[2];this.init(3),this.location[le.ON]=h,this.location[le.LEFT]=u,this.location[le.RIGHT]=_}};Kn.prototype.setAllLocations=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]=e};Kn.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==Ot.NONE)return!1;return!0};Kn.prototype.setAllLocationsIfNull=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]===Ot.NONE&&(t.location[n]=e)};Kn.prototype.isLine=function(){return this.location.length===1};Kn.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[le.ON]=this.location[le.ON],n[le.LEFT]=Ot.NONE,n[le.RIGHT]=Ot.NONE,this.location=n}for(var i=0;i<this.location.length;i++)t.location[i]===Ot.NONE&&i<e.location.length&&(t.location[i]=e.location[i])};Kn.prototype.getLocations=function(){return this.location};Kn.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[le.LEFT];this.location[le.LEFT]=this.location[le.RIGHT],this.location[le.RIGHT]=e};Kn.prototype.toString=function(){var e=new ma;return this.location.length>1&&e.append(Ot.toLocationSymbol(this.location[le.LEFT])),e.append(Ot.toLocationSymbol(this.location[le.ON])),this.location.length>1&&e.append(Ot.toLocationSymbol(this.location[le.RIGHT])),e.toString()};Kn.prototype.setLocations=function(e,t,n){this.location[le.ON]=e,this.location[le.LEFT]=t,this.location[le.RIGHT]=n};Kn.prototype.get=function(e){return e<this.location.length?this.location[e]:Ot.NONE};Kn.prototype.isArea=function(){return this.location.length>1};Kn.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===Ot.NONE)return!0;return!1};Kn.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(le.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}};Kn.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(Ot.NONE)};Kn.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};Kn.prototype.allPositionsEqual=function(e){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==e)return!1;return!0};Kn.prototype.interfaces_=function(){return[]};Kn.prototype.getClass=function(){return Kn};var Fn=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Kn(t),this.elt[1]=new Kn(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new Kn(n.elt[0]),this.elt[1]=new Kn(n.elt[1])}}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.elt[0]=new Kn(Ot.NONE),this.elt[1]=new Kn(Ot.NONE),this.elt[i].setLocation(r)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];this.elt[0]=new Kn(a,h,u),this.elt[1]=new Kn(a,h,u)}else if(arguments.length===4){var _=arguments[0],w=arguments[1],S=arguments[2],E=arguments[3];this.elt[0]=new Kn(Ot.NONE,Ot.NONE,Ot.NONE),this.elt[1]=new Kn(Ot.NONE,Ot.NONE,Ot.NONE),this.elt[_].setLocations(w,S,E)}};Fn.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};Fn.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};Fn.prototype.isNull=function(e){return this.elt[e].isNull()};Fn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}};Fn.prototype.isLine=function(e){return this.elt[e].isLine()};Fn.prototype.merge=function(e){for(var t=this,n=0;n<2;n++)t.elt[n]===null&&e.elt[n]!==null?t.elt[n]=new Kn(e.elt[n]):t.elt[n].merge(e.elt[n])};Fn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Fn.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(le.ON)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}};Fn.prototype.toString=function(){var e=new ma;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};Fn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};Fn.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};Fn.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(le.ON,t)}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}};Fn.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};Fn.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};Fn.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new Kn(this.elt[e].location[0]))};Fn.prototype.interfaces_=function(){return[]};Fn.prototype.getClass=function(){return Fn};Fn.toLineLabel=function(e){for(var t=new Fn(Ot.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var Bi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new pe,this._pts=new pe,this._label=new Fn(Ot.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new pe,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};Bi.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)t[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=be.isCCW(this._ring.getCoordinates())};Bi.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};Bi.prototype.computePoints=function(e){var t=this;this._startDe=e;var n=e,i=!0;do{if(n===null)throw new cl("Found null DirectedEdge");if(n.getEdgeRing()===t)throw new cl("Directed Edge visited twice during ring-building at "+n.getCoordinate());t._edges.add(n);var r=n.getLabel();un.isTrue(r.isArea()),t.mergeLabel(r),t.addPoints(n.getEdge(),n.isForward(),i),i=!1,t.setEdgeRing(n,t),n=t.getNext(n)}while(n!==this._startDe)};Bi.prototype.getLinearRing=function(){return this._ring};Bi.prototype.getCoordinate=function(e){return this._pts.get(e)};Bi.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var n=t.getNode(),i=n.getEdges().getOutgoingDegree(e);i>e._maxNodeDegree&&(e._maxNodeDegree=i),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};Bi.prototype.addPoints=function(e,t,n){var i=this,r=e.getCoordinates();if(t){var a=1;n&&(a=0);for(var h=a;h<r.length;h++)i._pts.add(r[h])}else{var u=r.length-2;n&&(u=r.length-1);for(var _=u;_>=0;_--)i._pts.add(r[_])}};Bi.prototype.isHole=function(){return this._isHole};Bi.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};Bi.prototype.containsPoint=function(e){var t=this.getLinearRing(),n=t.getEnvelopeInternal();if(!n.contains(e)||!be.isPointInRing(e,t.getCoordinates()))return!1;for(var i=this._holes.iterator();i.hasNext();){var r=i.next();if(r.containsPoint(e))return!1}return!0};Bi.prototype.addHole=function(e){this._holes.add(e)};Bi.prototype.isShell=function(){return this._shell===null};Bi.prototype.getLabel=function(){return this._label};Bi.prototype.getEdges=function(){return this._edges};Bi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};Bi.prototype.getShell=function(){return this._shell};Bi.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=t.getLocation(n,le.RIGHT);if(i===Ot.NONE)return null;if(this._label.getLocation(n)===Ot.NONE)return this._label.setLocation(n,i),null}};Bi.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};Bi.prototype.toPolygon=function(e){for(var t=this,n=new Array(this._holes.size()).fill(null),i=0;i<this._holes.size();i++)n[i]=t._holes.get(i).getLinearRing();var r=e.createPolygon(this.getLinearRing(),n);return r};Bi.prototype.interfaces_=function(){return[]};Bi.prototype.getClass=function(){return Bi};var ME=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,i){n.setMinEdgeRing(i)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Bi),PE=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,i=new pe,r=this._startDe;do{if(r.getMinEdgeRing()===null){var a=new ME(r,n._geometryFactory);i.add(a)}r=r.getNext()}while(r!==this._startDe);return i},t.prototype.setEdgeRing=function(n,i){n.setEdgeRing(i)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,i=this._startDe;do{var r=i.getNode();r.getEdges().linkMinimalDirectedEdges(n),i=i.getNext()}while(i!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Bi),Ko=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Ko.prototype.setVisited=function(e){this._isVisited=e};Ko.prototype.setInResult=function(e){this._isInResult=e};Ko.prototype.isCovered=function(){return this._isCovered};Ko.prototype.isCoveredSet=function(){return this._isCoveredSet};Ko.prototype.setLabel=function(e){this._label=e};Ko.prototype.getLabel=function(){return this._label};Ko.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Ko.prototype.updateIM=function(e){un.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Ko.prototype.isInResult=function(){return this._isInResult};Ko.prototype.isVisited=function(){return this._isVisited};Ko.prototype.interfaces_=function(){return[]};Ko.prototype.getClass=function(){return Ko};var Rg=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],i=arguments[1];this._coord=n,this._edges=i,this._label=new Fn(0,Ot.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,i){var r=Ot.NONE;if(r=this._label.getLocation(i),!n.isNull(i)){var a=n.getLocation(i);r!==Ot.BOUNDARY&&(r=a)}return r},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];this._label===null?this._label=new Fn(n,i):this._label.setLocation(n,i)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var i=arguments[0];this.mergeLabel(i._label)}else if(arguments[0]instanceof Fn)for(var r=arguments[0],a=0;a<2;a++){var h=n.computeMergedLocation(r,a),u=n._label.getLocation(a);u===Ot.NONE&&n._label.setLocation(a,h)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var i=Ot.NONE;this._label!==null&&(i=this._label.getLocation(n));var r=null;switch(i){case Ot.BOUNDARY:r=Ot.INTERIOR;break;case Ot.INTERIOR:r=Ot.BOUNDARY;break;default:r=Ot.BOUNDARY;break}this._label.setLocation(n,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ko),la=function(){this.nodeMap=new Br,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};la.prototype.find=function(e){return this.nodeMap.get(e)};la.prototype.addNode=function(){if(arguments[0]instanceof Nt){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof Rg){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return i===null?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}};la.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};la.prototype.iterator=function(){return this.nodeMap.values().iterator()};la.prototype.values=function(){return this.nodeMap.values()};la.prototype.getBoundaryNodes=function(e){for(var t=new pe,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(e)===Ot.BOUNDARY&&t.add(i)}return t};la.prototype.add=function(e){var t=e.getCoordinate(),n=this.addNode(t);n.add(e)};la.prototype.interfaces_=function(){return[]};la.prototype.getClass=function(){return la};var Gn=function(){},yd={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Gn.prototype.interfaces_=function(){return[]};Gn.prototype.getClass=function(){return Gn};Gn.isNorthern=function(e){return e===Gn.NE||e===Gn.NW};Gn.isOpposite=function(e,t){if(e===t)return!1;var n=(e-t+4)%4;return n===2};Gn.commonHalfPlane=function(e,t){if(e===t)return e;var n=(e-t+4)%4;if(n===2)return-1;var i=e<t?e:t,r=e>t?e:t;return i===0&&r===3?3:i};Gn.isInHalfPlane=function(e,t){return t===Gn.SE?e===Gn.SE||e===Gn.SW:e===t||e===t+1};Gn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new di("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?Gn.NE:Gn.SE:t>=0?Gn.NW:Gn.SW}else if(arguments[0]instanceof Nt&&arguments[1]instanceof Nt){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new di("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Gn.NE:Gn.SE:i.y>=n.y?Gn.NW:Gn.SW}};yd.NE.get=function(){return 0};yd.NW.get=function(){return 1};yd.SW.get=function(){return 2};yd.SE.get=function(){return 3};Object.defineProperties(Gn,yd);var Vr=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2],r=null;this._edge=t,this.init(n,i),this._label=r}else if(arguments.length===4){var a=arguments[0],h=arguments[1],u=arguments[2],_=arguments[3];this._edge=a,this.init(h,u),this._label=_}};Vr.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:be.computeOrientation(e._p0,e._p1,this._p1)};Vr.prototype.getDy=function(){return this._dy};Vr.prototype.getCoordinate=function(){return this._p0};Vr.prototype.setNode=function(e){this._node=e};Vr.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);e.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};Vr.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};Vr.prototype.getDirectedCoordinate=function(){return this._p1};Vr.prototype.getDx=function(){return this._dx};Vr.prototype.getLabel=function(){return this._label};Vr.prototype.getEdge=function(){return this._edge};Vr.prototype.getQuadrant=function(){return this._quadrant};Vr.prototype.getNode=function(){return this._node};Vr.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),i=t.substring(n+1);return"  "+i+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};Vr.prototype.computeLabel=function(e){};Vr.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Gn.quadrant(this._dx,this._dy),un.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};Vr.prototype.interfaces_=function(){return[_s]};Vr.prototype.getClass=function(){return Vr};var Ty=function(e){function t(){var n=arguments[0],i=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=i,i)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var r=n.getNumPoints()-1;this.init(n.getCoordinate(r),n.getCoordinate(r-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new Fn(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,i){if(this._depth[n]!==-999&&this._depth[n]!==i)throw new cl("assigned depths do not match",this.getCoordinate());this._depth[n]=i},t.prototype.isInteriorAreaEdge=function(){for(var n=this,i=!0,r=0;r<2;r++)n._label.isArea(r)&&n._label.getLocation(r,le.LEFT)===Ot.INTERIOR&&n._label.getLocation(r,le.RIGHT)===Ot.INTERIOR||(i=!1);return i},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[le.LEFT]+"/"+this._depth[le.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),i=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ot.EXTERIOR),r=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ot.EXTERIOR);return n&&i&&r},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,i){var r=this.getEdge().getDepthDelta();this._isForward||(r=-r);var a=1;n===le.LEFT&&(a=-1);var h=le.opposite(n),u=r*a,_=i+u;this.setDepth(n,i),this.setDepth(h,_)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,i){return n===Ot.EXTERIOR&&i===Ot.INTERIOR?1:n===Ot.INTERIOR&&i===Ot.EXTERIOR?-1:0},t}(Vr),Kh=function(){};Kh.prototype.createNode=function(e){return new Rg(e,null)};Kh.prototype.interfaces_=function(){return[]};Kh.prototype.getClass=function(){return Kh};var bi=function(){if(this._edges=new pe,this._nodes=null,this._edgeEndList=new pe,arguments.length===0)this._nodes=new la(new Kh);else if(arguments.length===1){var e=arguments[0];this._nodes=new la(e)}};bi.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var i=t._edges.get(n);i.print(e),i.eiList.print(e)}};bi.prototype.find=function(e){return this._nodes.find(e)};bi.prototype.addNode=function(){if(arguments[0]instanceof Rg){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof Nt){var t=arguments[0];return this._nodes.addNode(t)}};bi.prototype.getNodeIterator=function(){return this._nodes.iterator()};bi.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};bi.prototype.debugPrintln=function(e){Lr.out.println(e)};bi.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(n===null)return!1;var i=n.getLabel();return i!==null&&i.getLocation(e)===Ot.BOUNDARY};bi.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};bi.prototype.matchInSameDirection=function(e,t,n,i){return e.equals(n)?be.computeOrientation(e,t,i)===be.COLLINEAR&&Gn.quadrant(e,t)===Gn.quadrant(n,i):!1};bi.prototype.getEdgeEnds=function(){return this._edgeEndList};bi.prototype.debugPrint=function(e){Lr.out.print(e)};bi.prototype.getEdgeIterator=function(){return this._edges.iterator()};bi.prototype.findEdgeInSameDirection=function(e,t){for(var n=this,i=0;i<this._edges.size();i++){var r=n._edges.get(i),a=r.getCoordinates();if(n.matchInSameDirection(e,t,a[0],a[1])||n.matchInSameDirection(e,t,a[a.length-1],a[a.length-2]))return r}return null};bi.prototype.insertEdge=function(e){this._edges.add(e)};bi.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null};bi.prototype.addEdges=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next();t._edges.add(i);var r=new Ty(i,!0),a=new Ty(i,!1);r.setSym(a),a.setSym(r),t.add(r),t.add(a)}};bi.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};bi.prototype.getNodes=function(){return this._nodes.values()};bi.prototype.findEdge=function(e,t){for(var n=this,i=0;i<this._edges.size();i++){var r=n._edges.get(i),a=r.getCoordinates();if(e.equals(a[0])&&t.equals(a[1]))return r}return null};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};bi.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};var No=function(){this._geometryFactory=null,this._shellList=new pe;var e=arguments[0];this._geometryFactory=e};No.prototype.sortShellsAndHoles=function(e,t,n){for(var i=e.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}};No.prototype.computePolygons=function(e){for(var t=this,n=new pe,i=e.iterator();i.hasNext();){var r=i.next(),a=r.toPolygon(t._geometryFactory);n.add(a)}return n};No.prototype.placeFreeHoles=function(e,t){for(var n=this,i=t.iterator();i.hasNext();){var r=i.next();if(r.getShell()===null){var a=n.findEdgeRingContaining(r,e);if(a===null)throw new cl("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(a)}}};No.prototype.buildMinimalEdgeRings=function(e,t,n){for(var i=this,r=new pe,a=e.iterator();a.hasNext();){var h=a.next();if(h.getMaxNodeDegree()>2){h.linkDirectedEdgesForMinimalEdgeRings();var u=h.buildMinimalRings(),_=i.findShell(u);_!==null?(i.placePolygonHoles(_,u),t.add(_)):n.addAll(u)}else r.add(h)}return r};No.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var n=t.next();if(n.containsPoint(e))return!0}return!1};No.prototype.buildMaximalEdgeRings=function(e){for(var t=this,n=new pe,i=e.iterator();i.hasNext();){var r=i.next();if(r.isInResult()&&r.getLabel().isArea()&&r.getEdgeRing()===null){var a=new PE(r,t._geometryFactory);n.add(a),a.setInResult()}}return n};No.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(e)}};No.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};No.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),a=null,h=null,u=t.iterator();u.hasNext();){var _=u.next(),w=_.getLinearRing(),S=w.getEnvelopeInternal();a!==null&&(h=a.getLinearRing().getEnvelopeInternal());var E=!1;S.contains(i)&&be.isPointInRing(r,w.getCoordinates())&&(E=!0),E&&(a===null||h.contains(S))&&(a=_)}return a};No.prototype.findShell=function(e){for(var t=0,n=null,i=e.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return un.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n};No.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];bi.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new pe,a=this.buildMinimalEdgeRings(i,this._shellList,r);this.sortShellsAndHoles(a,this._shellList,r),this.placeFreeHoles(this._shellList,r)}};No.prototype.interfaces_=function(){return[]};No.prototype.getClass=function(){return No};var Jh=function(){};Jh.prototype.getBounds=function(){};Jh.prototype.interfaces_=function(){return[]};Jh.prototype.getClass=function(){return Jh};var Ns=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};Ns.prototype.getItem=function(){return this._item};Ns.prototype.getBounds=function(){return this._bounds};Ns.prototype.interfaces_=function(){return[Jh,ys]};Ns.prototype.getClass=function(){return Ns};var hl=function(){this._size=null,this._items=null,this._size=0,this._items=new pe,this._items.add(null)};hl.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};hl.prototype.size=function(){return this._size};hl.prototype.reorder=function(e){for(var t=this,n=null,i=this._items.get(e);e*2<=this._size&&(n=e*2,n!==t._size&&t._items.get(n+1).compareTo(t._items.get(n))<0&&n++,t._items.get(n).compareTo(i)<0);e=n)t._items.set(e,t._items.get(n));this._items.set(e,i)};hl.prototype.clear=function(){this._size=0,this._items.clear()};hl.prototype.isEmpty=function(){return this._size===0};hl.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)t._items.set(n,t._items.get(Math.trunc(n/2)));this._items.set(n,e)};hl.prototype.interfaces_=function(){return[]};hl.prototype.getClass=function(){return hl};var Zl=function(){};Zl.prototype.visitItem=function(e){};Zl.prototype.interfaces_=function(){return[]};Zl.prototype.getClass=function(){return Zl};var bc=function(){};bc.prototype.insert=function(e,t){};bc.prototype.remove=function(e,t){};bc.prototype.query=function(){};bc.prototype.interfaces_=function(){return[]};bc.prototype.getClass=function(){return bc};var Xi=function(){if(this._childBoundables=new pe,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},Fx={serialVersionUID:{configurable:!0}};Xi.prototype.getLevel=function(){return this._level};Xi.prototype.size=function(){return this._childBoundables.size()};Xi.prototype.getChildBoundables=function(){return this._childBoundables};Xi.prototype.addChildBoundable=function(e){un.isTrue(this._bounds===null),this._childBoundables.add(e)};Xi.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Xi.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Xi.prototype.interfaces_=function(){return[Jh,ys]};Xi.prototype.getClass=function(){return Xi};Fx.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Xi,Fx);var Rs=function(){};Rs.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};Rs.min=function(e){return Rs.sort(e),e.get(0)};Rs.sort=function(e,t){var n=e.toArray();t?Tu.sort(n,t):Tu.sort(n);for(var i=e.iterator(),r=0,a=n.length;r<a;r++)i.next(),i.set(n[r])};Rs.singletonList=function(e){var t=new pe;return t.add(e),t};var Oi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};Oi.prototype.expandToQueue=function(e,t){var n=Oi.isComposite(this._boundable1),i=Oi.isComposite(this._boundable2);if(n&&i)return Oi.area(this._boundable1)>Oi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(i)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new di("neither boundable is composite")};Oi.prototype.isLeaves=function(){return!(Oi.isComposite(this._boundable1)||Oi.isComposite(this._boundable2))};Oi.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};Oi.prototype.expand=function(e,t,n,i){for(var r=this,a=e.getChildBoundables(),h=a.iterator();h.hasNext();){var u=h.next(),_=new Oi(u,t,r._itemDistance);_.getDistance()<i&&n.add(_)}};Oi.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};Oi.prototype.getDistance=function(){return this._distance};Oi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};Oi.prototype.interfaces_=function(){return[_s]};Oi.prototype.getClass=function(){return Oi};Oi.area=function(e){return e.getBounds().getArea()};Oi.isComposite=function(e){return e instanceof Xi};var vr=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new pe,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];un.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},zg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};vr.prototype.getNodeCapacity=function(){return this._nodeCapacity};vr.prototype.lastNode=function(e){return e.get(e.size()-1)};vr.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Xi?n+=e.size(r):r instanceof Ns&&(n+=1)}return n}};vr.prototype.removeItem=function(e,t){for(var n=null,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Ns&&r.getItem()===t&&(n=r)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};vr.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new pe:t}else if(arguments.length===1){for(var n=arguments[0],i=new pe,r=n.getChildBoundables().iterator();r.hasNext();){var a=r.next();if(a instanceof Xi){var h=e.itemsTree(a);h!==null&&i.add(h)}else a instanceof Ns?i.add(a.getItem()):un.shouldNeverReachHere()}return i.size()<=0?null:i}};vr.prototype.insert=function(e,t){un.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ns(e,t))};vr.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],n=new pe;return this.boundablesAtLevel(t,this._root,n),n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2];if(un.isTrue(i>-2),r.getLevel()===i)return a.add(r),null;for(var h=r.getChildBoundables().iterator();h.hasNext();){var u=h.next();u instanceof Xi?e.boundablesAtLevel(i,u,a):(un.isTrue(u instanceof Ns),i===-1&&a.add(u))}return null}};vr.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var n=new pe;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,n),n}else if(arguments.length===2){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),i)&&this.query(i,this._root,r)}else if(arguments.length===3){if(He(arguments[2],Zl)&&arguments[0]instanceof Object&&arguments[1]instanceof Xi)for(var a=arguments[0],h=arguments[1],u=arguments[2],_=h.getChildBoundables(),w=0;w<_.size();w++){var S=_.get(w);e.getIntersectsOp().intersects(S.getBounds(),a)&&(S instanceof Xi?e.query(a,S,u):S instanceof Ns?u.visitItem(S.getItem()):un.shouldNeverReachHere())}else if(He(arguments[2],Ps)&&arguments[0]instanceof Object&&arguments[1]instanceof Xi)for(var E=arguments[0],M=arguments[1],k=arguments[2],D=M.getChildBoundables(),F=0;F<D.size();F++){var q=D.get(F);e.getIntersectsOp().intersects(q.getBounds(),E)&&(q instanceof Xi?e.query(E,q,k):q instanceof Ns?k.add(q.getItem()):un.shouldNeverReachHere())}}};vr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};vr.prototype.getRoot=function(){return this.build(),this._root};vr.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,n):!1}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2],h=this.removeItem(r,a);if(h)return!0;for(var u=null,_=r.getChildBoundables().iterator();_.hasNext();){var w=_.next();if(e.getIntersectsOp().intersects(w.getBounds(),i)&&w instanceof Xi&&(h=e.remove(i,w,a),h)){u=w;break}}return u!==null&&u.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(u),h}};vr.prototype.createHigherLevels=function(e,t){un.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)};vr.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Xi){var a=e.depth(r);a>n&&(n=a)}}return n+1}};vr.prototype.createParentBoundables=function(e,t){var n=this;un.isTrue(!e.isEmpty());var i=new pe;i.add(this.createNode(t));var r=new pe(e);Rs.sort(r,this.getComparator());for(var a=r.iterator();a.hasNext();){var h=a.next();n.lastNode(i).getChildBoundables().size()===n.getNodeCapacity()&&i.add(n.createNode(t)),n.lastNode(i).addChildBoundable(h)}return i};vr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};vr.prototype.interfaces_=function(){return[ys]};vr.prototype.getClass=function(){return vr};vr.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};zg.IntersectsOp.get=function(){return kE};zg.serialVersionUID.get=function(){return-3886435814360241e3};zg.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(vr,zg);var kE=function(){},Qh=function(){};Qh.prototype.distance=function(e,t){};Qh.prototype.interfaces_=function(){return[]};Qh.prototype.getClass=function(){return Qh};var Bx=function(e){function t(i){i=i||t.DEFAULT_NODE_CAPACITY,e.call(this,i)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(i,r){var a=this;un.isTrue(i.length>0);for(var h=new pe,u=0;u<i.length;u++)h.addAll(a.createParentBoundablesFromVerticalSlice(i[u],r));return h},t.prototype.createNode=function(i){return new u1(i)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];if(i.isNull())return null;e.prototype.insert.call(this,i,r)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(i,r){for(var a=Math.trunc(Math.ceil(i.size()/r)),h=new Array(r).fill(null),u=i.iterator(),_=0;_<r;_++){h[_]=new pe;for(var w=0;u.hasNext()&&w<a;){var S=u.next();h[_].add(S),w++}}return h},t.prototype.query=function(){if(arguments.length===1){var i=arguments[0];return e.prototype.query.call(this,i)}else if(arguments.length===2){var r=arguments[0],a=arguments[1];e.prototype.query.call(this,r,a)}else if(arguments.length===3){if(He(arguments[2],Zl)&&arguments[0]instanceof Object&&arguments[1]instanceof Xi){var h=arguments[0],u=arguments[1],_=arguments[2];e.prototype.query.call(this,h,u,_)}else if(He(arguments[2],Ps)&&arguments[0]instanceof Object&&arguments[1]instanceof Xi){var w=arguments[0],S=arguments[1],E=arguments[2];e.prototype.query.call(this,w,S,E)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(i,r){return e.prototype.createParentBoundables.call(this,i,r)},t.prototype.remove=function(){if(arguments.length===2){var i=arguments[0],r=arguments[1];return e.prototype.remove.call(this,i,r)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(i,r){un.isTrue(!i.isEmpty());var a=Math.trunc(Math.ceil(i.size()/this.getNodeCapacity())),h=new pe(i);Rs.sort(h,t.xComparator);var u=this.verticalSlices(h,Math.trunc(Math.ceil(Math.sqrt(a))));return this.createParentBoundablesFromVerticalSlices(u,r)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(He(arguments[0],Qh)){var i=arguments[0],r=new Oi(this.getRoot(),this.getRoot(),i);return this.nearestNeighbour(r)}else if(arguments[0]instanceof Oi){var a=arguments[0];return this.nearestNeighbour(a,tn.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&He(arguments[1],Qh)){var h=arguments[0],u=arguments[1],_=new Oi(this.getRoot(),h.getRoot(),u);return this.nearestNeighbour(_)}else if(arguments[0]instanceof Oi&&typeof arguments[1]=="number"){var w=arguments[0],S=arguments[1],E=S,M=null,k=new hl;for(k.add(w);!k.isEmpty()&&E>0;){var D=k.poll(),F=D.getDistance();if(F>=E)break;D.isLeaves()?(E=F,M=D):D.expandToQueue(k,E)}return[M.getBoundable(0).getItem(),M.getBoundable(1).getItem()]}}else if(arguments.length===3){var q=arguments[0],X=arguments[1],B=arguments[2],U=new Ns(q,X),W=new Oi(this.getRoot(),U,B);return this.nearestNeighbour(W)[0]}},t.prototype.interfaces_=function(){return[bc,ys]},t.prototype.getClass=function(){return t},t.centreX=function(i){return t.avg(i.getMinX(),i.getMaxX())},t.avg=function(i,r){return(i+r)/2},t.centreY=function(i){return t.avg(i.getMinY(),i.getMaxY())},n.STRtreeNode.get=function(){return u1},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[jh]},compare:function(i,r){return e.compareDoubles(t.centreX(i.getBounds()),t.centreX(r.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[jh]},compare:function(i,r){return e.compareDoubles(t.centreY(i.getBounds()),t.centreY(r.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(i,r){return i.intersects(r)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(vr),u1=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,i=this.getChildBoundables().iterator();i.hasNext();){var r=i.next();n===null?n=new Re(r.getBounds()):n.expandToInclude(r.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Xi),_o=function(){};_o.prototype.interfaces_=function(){return[]};_o.prototype.getClass=function(){return _o};_o.relativeSign=function(e,t){return e<t?-1:e>t?1:0};_o.compare=function(e,t,n){if(t.equals2D(n))return 0;var i=_o.relativeSign(t.x,n.x),r=_o.relativeSign(t.y,n.y);switch(e){case 0:return _o.compareValue(i,r);case 1:return _o.compareValue(r,i);case 2:return _o.compareValue(r,-i);case 3:return _o.compareValue(-i,r);case 4:return _o.compareValue(-i,-r);case 5:return _o.compareValue(-r,-i);case 6:return _o.compareValue(-r,i);case 7:return _o.compareValue(i,-r)}return un.shouldNeverReachHere("invalid octant value"),0};_o.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var Wl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._segString=e,this.coord=new Nt(t),this.segmentIndex=n,this._segmentOctant=i,this._isInterior=!t.equals2D(e.getCoordinate(n))};Wl.prototype.getCoordinate=function(){return this.coord};Wl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};Wl.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:_o.compare(this._segmentOctant,this.coord,t.coord)};Wl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};Wl.prototype.isInterior=function(){return this._isInterior};Wl.prototype.interfaces_=function(){return[_s]};Wl.prototype.getClass=function(){return Wl};var no=function(){this._nodeMap=new Br,this._edge=null;var e=arguments[0];this._edge=e};no.prototype.getSplitCoordinates=function(){var e=this,t=new gd;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();e.addEdgeCoordinates(i,r,t),i=r}return t.toCoordinateArray()};no.prototype.addCollapsedNodes=function(){var e=this,t=new pe;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var n=t.iterator();n.hasNext();){var i=n.next().intValue();e.add(e._edge.getCoordinate(i),i)}};no.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};no.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,n=0;n<this._edge.size()-2;n++){var i=t._edge.getCoordinate(n),r=t._edge.getCoordinate(n+2);i.equals2D(r)&&e.add(new ia(n+1))}};no.prototype.addEdgeCoordinates=function(e,t,n){var i=this,r=this._edge.getCoordinate(t.segmentIndex),a=t.isInterior()||!t.coord.equals2D(r);n.add(new Nt(e.coord),!1);for(var h=e.segmentIndex+1;h<=t.segmentIndex;h++)n.add(i._edge.getCoordinate(h));a&&n.add(new Nt(t.coord))};no.prototype.iterator=function(){return this._nodeMap.values().iterator()};no.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next(),a=t.createSplitEdge(i,r);e.add(a),i=r}};no.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-e.segmentIndex;return t.isInterior()||i--,i===1?(n[0]=e.segmentIndex+1,!0):!1};no.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,n=new Array(1).fill(null),i=this.iterator(),r=i.next();i.hasNext();){var a=i.next(),h=t.findCollapseIndex(r,a,n);h&&e.add(new ia(n[0])),r=a}};no.prototype.getEdge=function(){return this._edge};no.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};no.prototype.createSplitEdge=function(e,t){var n=this,i=t.segmentIndex-e.segmentIndex+2,r=this._edge.getCoordinate(t.segmentIndex),a=t.isInterior()||!t.coord.equals2D(r);a||i--;var h=new Array(i).fill(null),u=0;h[u++]=new Nt(e.coord);for(var _=e.segmentIndex+1;_<=t.segmentIndex;_++)h[u++]=n._edge.getCoordinate(_);return a&&(h[u]=new Nt(t.coord)),new Ni(h,this._edge.getData())};no.prototype.add=function(e,t){var n=new Wl(this._edge,e,t,this._edge.getSegmentOctant(t)),i=this._nodeMap.get(n);return i!==null?(un.isTrue(i.coord.equals2D(e),"Found equal nodes with different coordinates"),i):(this._nodeMap.put(n,n),n)};no.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0),i=n.getCoordinate(0);if(!i.equals2D(t[0]))throw new ll("bad split edge start point at "+i);var r=e.get(e.size()-1),a=r.getCoordinates(),h=a[a.length-1];if(!h.equals2D(t[t.length-1]))throw new ll("bad split edge end point at "+h)};no.prototype.interfaces_=function(){return[]};no.prototype.getClass=function(){return no};var xc=function(){};xc.prototype.interfaces_=function(){return[]};xc.prototype.getClass=function(){return xc};xc.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new di("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),i=Math.abs(t);return e>=0?t>=0?n>=i?0:1:n>=i?7:6:t>=0?n>=i?3:2:n>=i?4:5}else if(arguments[0]instanceof Nt&&arguments[1]instanceof Nt){var r=arguments[0],a=arguments[1],h=a.x-r.x,u=a.y-r.y;if(h===0&&u===0)throw new di("Cannot compute the octant for two identical points "+r);return xc.octant(h,u)}};var Ra=function(){};Ra.prototype.getCoordinates=function(){};Ra.prototype.size=function(){};Ra.prototype.getCoordinate=function(e){};Ra.prototype.isClosed=function(){};Ra.prototype.setData=function(e){};Ra.prototype.getData=function(){};Ra.prototype.interfaces_=function(){return[]};Ra.prototype.getClass=function(){return Ra};var rd=function(){};rd.prototype.addIntersection=function(e,t){};rd.prototype.interfaces_=function(){return[Ra]};rd.prototype.getClass=function(){return rd};var Ni=function(){this._nodeList=new no(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};Ni.prototype.getCoordinates=function(){return this._pts};Ni.prototype.size=function(){return this._pts.length};Ni.prototype.getCoordinate=function(e){return this._pts[e]};Ni.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Ni.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};Ni.prototype.setData=function(e){this._data=e};Ni.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:xc.octant(e,t)};Ni.prototype.getData=function(){return this._data};Ni.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[3],a=new Nt(n.getIntersection(r));this.addIntersection(a,i)}};Ni.prototype.toString=function(){return As.toLineString(new ki(this._pts))};Ni.prototype.getNodeList=function(){return this._nodeList};Ni.prototype.addIntersectionNode=function(e,t){var n=t,i=n+1;if(i<this._pts.length){var r=this._pts[i];e.equals2D(r)&&(n=i)}var a=this._nodeList.add(e,n);return a};Ni.prototype.addIntersections=function(e,t,n){for(var i=this,r=0;r<e.getIntersectionNum();r++)i.addIntersection(e,t,n,r)};Ni.prototype.interfaces_=function(){return[rd]};Ni.prototype.getClass=function(){return Ni};Ni.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new pe;return Ni.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var a=r.next();a.getNodeList().addSplitEdges(i)}};var ze=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new Nt,this.p1=new Nt;else if(arguments.length===1){var e=arguments[0];this.p0=new Nt(e.p0),this.p1=new Nt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];this.p0=new Nt(t,n),this.p1=new Nt(i,r)}},Vx={serialVersionUID:{configurable:!0}};ze.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};ze.prototype.orientationIndex=function(){if(arguments[0]instanceof ze){var e=arguments[0],t=be.orientationIndex(this.p0,this.p1,e.p0),n=be.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}else if(arguments[0]instanceof Nt){var i=arguments[0];return be.orientationIndex(this.p0,this.p1,i)}};ze.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};ze.prototype.isVertical=function(){return this.p0.x===this.p1.x};ze.prototype.equals=function(e){if(!(e instanceof ze))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};ze.prototype.intersection=function(e){var t=new Vu;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};ze.prototype.project=function(){if(arguments[0]instanceof Nt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new Nt(e);var t=this.projectionFactor(e),n=new Nt;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof ze){var i=arguments[0],r=this.projectionFactor(i.p0),a=this.projectionFactor(i.p1);if(r>=1&&a>=1||r<=0&&a<=0)return null;var h=this.project(i.p0);r<0&&(h=this.p0),r>1&&(h=this.p1);var u=this.project(i.p1);return a<0&&(u=this.p0),a>1&&(u=this.p1),new ze(h,u)}};ze.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};ze.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};ze.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};ze.prototype.distancePerpendicular=function(e){return be.distancePointLinePerpendicular(e,this.p0,this.p1)};ze.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};ze.prototype.midPoint=function(){return ze.midPoint(this.p0,this.p1)};ze.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;if(i<=0)return tn.NaN;var r=((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/i;return r};ze.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),i=tn.MAX_VALUE,r=null,a=this.closestPoint(e.p0);i=a.distance(e.p0),n[0]=a,n[1]=e.p0;var h=this.closestPoint(e.p1);r=h.distance(e.p1),r<i&&(i=r,n[0]=h,n[1]=e.p1);var u=e.closestPoint(this.p0);r=u.distance(this.p0),r<i&&(i=r,n[0]=this.p0,n[1]=u);var _=e.closestPoint(this.p1);return r=_.distance(this.p1),r<i&&(i=r,n[0]=this.p1,n[1]=_),n};ze.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var n=this.p0.distance(e),i=this.p1.distance(e);return n<i?this.p0:this.p1};ze.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};ze.prototype.getLength=function(){return this.p0.distance(this.p1)};ze.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)};ze.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};ze.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};ze.prototype.lineIntersection=function(e){try{var t=Ms.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(n){if(!(n instanceof pf))throw n}finally{}return null};ze.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};ze.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),i=this.p0.y+e*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,a=this.p1.y-this.p0.y,h=Math.sqrt(r*r+a*a),u=0,_=0;if(t!==0){if(h<=0)throw new Error("Cannot compute offset from zero-length line segment");u=t*r/h,_=t*a/h}var w=n-_,S=i+u,E=new Nt(w,S);return E};ze.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}};ze.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||tn.isNaN(t))&&(t=1),t};ze.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};ze.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};ze.prototype.distance=function(){if(arguments[0]instanceof ze){var e=arguments[0];return be.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof Nt){var t=arguments[0];return be.distancePointLine(t,this.p0,this.p1)}};ze.prototype.pointAlong=function(e){var t=new Nt;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};ze.prototype.hashCode=function(){var e=tn.doubleToLongBits(this.p0.x);e^=tn.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),n=tn.doubleToLongBits(this.p1.x);n^=tn.doubleToLongBits(this.p1.y)*31;var i=Math.trunc(n)^Math.trunc(n>>32);return t^i};ze.prototype.interfaces_=function(){return[_s,ys]};ze.prototype.getClass=function(){return ze};ze.midPoint=function(e,t){return new Nt((e.x+t.x)/2,(e.y+t.y)/2)};Vx.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(ze,Vx);var od=function(){this.tempEnv1=new Re,this.tempEnv2=new Re,this._overlapSeg1=new ze,this._overlapSeg2=new ze};od.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];e.getLineSegment(t,this._overlapSeg1),n.getLineSegment(i,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};od.prototype.interfaces_=function(){return[]};od.prototype.getClass=function(){return od};var Ro=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=i};Ro.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};Ro.prototype.computeSelect=function(e,t,n,i){var r=this._pts[t],a=this._pts[n];if(i.tempEnv1.init(r,a),n-t===1)return i.select(this,t),null;if(!e.intersects(i.tempEnv1))return null;var h=Math.trunc((t+n)/2);t<h&&this.computeSelect(e,t,h,i),h<n&&this.computeSelect(e,h,n,i)};Ro.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),n=0,i=this._start;i<=this._end;i++)t[n++]=e._pts[i];return t};Ro.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};Ro.prototype.setId=function(e){this._id=e};Ro.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};Ro.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new Re(e,t)}return this._env};Ro.prototype.getEndIndex=function(){return this._end};Ro.prototype.getStartIndex=function(){return this._start};Ro.prototype.getContext=function(){return this._context};Ro.prototype.getId=function(){return this._id};Ro.prototype.computeOverlapsInternal=function(e,t,n,i,r,a){var h=this._pts[e],u=this._pts[t],_=n._pts[i],w=n._pts[r];if(t-e===1&&r-i===1)return a.overlap(this,e,n,i),null;if(a.tempEnv1.init(h,u),a.tempEnv2.init(_,w),!a.tempEnv1.intersects(a.tempEnv2))return null;var S=Math.trunc((e+t)/2),E=Math.trunc((i+r)/2);e<S&&(i<E&&this.computeOverlapsInternal(e,S,n,i,E,a),E<r&&this.computeOverlapsInternal(e,S,n,E,r,a)),S<t&&(i<E&&this.computeOverlapsInternal(S,t,n,i,E,a),E<r&&this.computeOverlapsInternal(S,t,n,E,r,a))};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};var ea=function(){};ea.prototype.interfaces_=function(){return[]};ea.prototype.getClass=function(){return ea};ea.getChainStartIndices=function(e){var t=0,n=new pe;n.add(new ia(t));do{var i=ea.findChainEnd(e,t);n.add(new ia(i)),t=i}while(t<e.length-1);var r=ea.toIntArray(n);return r};ea.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var i=Gn.quadrant(e[n],e[n+1]),r=t+1;r<e.length;){if(!e[r-1].equals2D(e[r])){var a=Gn.quadrant(e[r-1],e[r]);if(a!==i)break}r++}return r-1};ea.getChains=function(){if(arguments.length===1){var e=arguments[0];return ea.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],n=arguments[1],i=new pe,r=ea.getChainStartIndices(t),a=0;a<r.length-1;a++){var h=new Ro(t,r[a],r[a+1],n);i.add(h)}return i}};ea.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var Au=function(){};Au.prototype.computeNodes=function(e){};Au.prototype.getNodedSubstrings=function(){};Au.prototype.interfaces_=function(){return[]};Au.prototype.getClass=function(){return Au};var sd=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};sd.prototype.setSegmentIntersector=function(e){this._segInt=e};sd.prototype.interfaces_=function(){return[Au]};sd.prototype.getClass=function(){return sd};var $y=function(e){function t(i){i?e.call(this,i):e.call(this),this._monoChains=new pe,this._index=new Bx,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return Ni.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(i){for(var r=this,a=ea.getChains(i.getCoordinates(),i),h=a.iterator();h.hasNext();){var u=h.next();u.setId(r._idCounter++),r._index.insert(u.getEnvelope(),u),r._monoChains.add(u)}},t.prototype.computeNodes=function(i){var r=this;this._nodedSegStrings=i;for(var a=i.iterator();a.hasNext();)r.add(a.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var i=this,r=new c1(this._segInt),a=this._monoChains.iterator();a.hasNext();)for(var h=a.next(),u=i._index.query(h.getEnvelope()),_=u.iterator();_.hasNext();){var w=_.next();if(w.getId()>h.getId()&&(h.computeOverlaps(w,r),i._nOverlaps++),i._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return c1},Object.defineProperties(t,n),t}(sd),c1=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3],h=n.getContext(),u=r.getContext();this._si.processIntersections(h,i,u,a)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(od),Dn=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(arguments.length===4){var r=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(a),this.setJoinStyle(h),this.setMitreLimit(u)}}},ml={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Dn.prototype.getEndCapStyle=function(){return this._endCapStyle};Dn.prototype.isSingleSided=function(){return this._isSingleSided};Dn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=Dn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Dn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==Dn.JOIN_ROUND&&(this._quadrantSegments=Dn.DEFAULT_QUADRANT_SEGMENTS)};Dn.prototype.getJoinStyle=function(){return this._joinStyle};Dn.prototype.setJoinStyle=function(e){this._joinStyle=e};Dn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};Dn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Dn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Dn.prototype.setEndCapStyle=function(e){this._endCapStyle=e};Dn.prototype.getMitreLimit=function(){return this._mitreLimit};Dn.prototype.setMitreLimit=function(e){this._mitreLimit=e};Dn.prototype.setSingleSided=function(e){this._isSingleSided=e};Dn.prototype.interfaces_=function(){return[]};Dn.prototype.getClass=function(){return Dn};Dn.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};ml.CAP_ROUND.get=function(){return 1};ml.CAP_FLAT.get=function(){return 2};ml.CAP_SQUARE.get=function(){return 3};ml.JOIN_ROUND.get=function(){return 1};ml.JOIN_MITRE.get=function(){return 2};ml.JOIN_BEVEL.get=function(){return 3};ml.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};ml.DEFAULT_MITRE_LIMIT.get=function(){return 5};ml.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Dn,ml);var Ei=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=be.COUNTERCLOCKWISE,this._inputLine=e||null},vd={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ei.prototype.isDeletable=function(e,t,n,i){var r=this._inputLine[e],a=this._inputLine[t],h=this._inputLine[n];return!this.isConcave(r,a,h)||!this.isShallow(r,a,h,i)?!1:this.isShallowSampled(r,a,e,n,i)};Ei.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,n=this.findNextNonDeletedIndex(t),i=this.findNextNonDeletedIndex(n),r=!1;i<this._inputLine.length;){var a=!1;e.isDeletable(t,n,i,e._distanceTol)&&(e._isDeleted[n]=Ei.DELETE,a=!0,r=!0),a?t=i:t=n,n=e.findNextNonDeletedIndex(t),i=e.findNextNonDeletedIndex(n)}return r};Ei.prototype.isShallowConcavity=function(e,t,n,i){var r=be.computeOrientation(e,t,n),a=r===this._angleOrientation;if(!a)return!1;var h=be.distancePointLine(t,e,n);return h<i};Ei.prototype.isShallowSampled=function(e,t,n,i,r){var a=this,h=Math.trunc((i-n)/Ei.NUM_PTS_TO_CHECK);h<=0&&(h=1);for(var u=n;u<i;u+=h)if(!a.isShallow(e,t,a._inputLine[u],r))return!1;return!0};Ei.prototype.isConcave=function(e,t,n){var i=be.computeOrientation(e,t,n),r=i===this._angleOrientation;return r};Ei.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=be.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=t.deleteShallowConcavities();while(n);return this.collapseLine()};Ei.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===Ei.DELETE;)t++;return t};Ei.prototype.isShallow=function(e,t,n,i){var r=be.distancePointLine(t,e,n);return r<i};Ei.prototype.collapseLine=function(){for(var e=this,t=new gd,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==Ei.DELETE&&t.add(e._inputLine[n]);return t.toCoordinateArray()};Ei.prototype.interfaces_=function(){return[]};Ei.prototype.getClass=function(){return Ei};Ei.simplify=function(e,t){var n=new Ei(e);return n.simplify(t)};vd.INIT.get=function(){return 0};vd.DELETE.get=function(){return 1};vd.KEEP.get=function(){return 1};vd.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Ei,vd);var Jo=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new pe},Ux={COORDINATE_ARRAY_TYPE:{configurable:!0}};Jo.prototype.getCoordinates=function(){var e=this._ptList.toArray(Jo.COORDINATE_ARRAY_TYPE);return e};Jo.prototype.setPrecisionModel=function(e){this._precisionModel=e};Jo.prototype.addPt=function(e){var t=new Nt(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};Jo.prototype.revere=function(){};Jo.prototype.addPts=function(e,t){var n=this;if(t)for(var i=0;i<e.length;i++)n.addPt(e[i]);else for(var r=e.length-1;r>=0;r--)n.addPt(e[r])};Jo.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),n=e.distance(t);return n<this._minimimVertexDistance};Jo.prototype.toString=function(){var e=new gn,t=e.createLineString(this.getCoordinates());return t.toString()};Jo.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new Nt(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};Jo.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};Jo.prototype.interfaces_=function(){return[]};Jo.prototype.getClass=function(){return Jo};Ux.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Jo,Ux);var Cn=function(){},Oc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Cn.prototype.interfaces_=function(){return[]};Cn.prototype.getClass=function(){return Cn};Cn.toDegrees=function(e){return e*180/Math.PI};Cn.normalize=function(e){for(;e>Math.PI;)e-=Cn.PI_TIMES_2;for(;e<=-Math.PI;)e+=Cn.PI_TIMES_2;return e};Cn.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}};Cn.isAcute=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,a=n.x-t.x,h=n.y-t.y,u=i*a+r*h;return u>0};Cn.isObtuse=function(e,t,n){var i=e.x-t.x,r=e.y-t.y,a=n.x-t.x,h=n.y-t.y,u=i*a+r*h;return u<0};Cn.interiorAngle=function(e,t,n){var i=Cn.angle(t,e),r=Cn.angle(t,n);return Math.abs(r-i)};Cn.normalizePositive=function(e){if(e<0){for(;e<0;)e+=Cn.PI_TIMES_2;e>=Cn.PI_TIMES_2&&(e=0)}else{for(;e>=Cn.PI_TIMES_2;)e-=Cn.PI_TIMES_2;e<0&&(e=0)}return e};Cn.angleBetween=function(e,t,n){var i=Cn.angle(t,e),r=Cn.angle(t,n);return Cn.diff(i,r)};Cn.diff=function(e,t){var n=null;return e<t?n=t-e:n=e-t,n>Math.PI&&(n=2*Math.PI-n),n};Cn.toRadians=function(e){return e*Math.PI/180};Cn.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?Cn.COUNTERCLOCKWISE:n<0?Cn.CLOCKWISE:Cn.NONE};Cn.angleBetweenOriented=function(e,t,n){var i=Cn.angle(t,e),r=Cn.angle(t,n),a=r-i;return a<=-Math.PI?a+Cn.PI_TIMES_2:a>Math.PI?a-Cn.PI_TIMES_2:a};Oc.PI_TIMES_2.get=function(){return 2*Math.PI};Oc.PI_OVER_2.get=function(){return Math.PI/2};Oc.PI_OVER_4.get=function(){return Math.PI/4};Oc.COUNTERCLOCKWISE.get=function(){return be.COUNTERCLOCKWISE};Oc.CLOCKWISE.get=function(){return be.CLOCKWISE};Oc.NONE.get=function(){return be.COLLINEAR};Object.defineProperties(Cn,Oc);var li=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new ze,this._seg1=new ze,this._offset0=new ze,this._offset1=new ze,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new Vu,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Dn.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},bd={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};li.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=be.computeOrientation(this._s0,this._s1,this._s2),i=n===be.CLOCKWISE&&this._side===le.LEFT||n===be.COUNTERCLOCKWISE&&this._side===le.RIGHT;n===0?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)};li.prototype.addLineEndCap=function(e,t){var n=new ze(e,t),i=new ze;this.computeOffsetSegment(n,le.LEFT,this._distance,i);var r=new ze;this.computeOffsetSegment(n,le.RIGHT,this._distance,r);var a=t.x-e.x,h=t.y-e.y,u=Math.atan2(h,a);switch(this._bufParams.getEndCapStyle()){case Dn.CAP_ROUND:this._segList.addPt(i.p1),this.addFilletArc(t,u+Math.PI/2,u-Math.PI/2,be.CLOCKWISE,this._distance),this._segList.addPt(r.p1);break;case Dn.CAP_FLAT:this._segList.addPt(i.p1),this._segList.addPt(r.p1);break;case Dn.CAP_SQUARE:var _=new Nt;_.x=Math.abs(this._distance)*Math.cos(u),_.y=Math.abs(this._distance)*Math.sin(u);var w=new Nt(i.p1.x+_.x,i.p1.y+_.y),S=new Nt(r.p1.x+_.x,r.p1.y+_.y);this._segList.addPt(w),this._segList.addPt(S);break}};li.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};li.prototype.addMitreJoin=function(e,t,n,i){var r=!0,a=null;try{a=Ms.intersection(t.p0,t.p1,n.p0,n.p1);var h=i<=0?1:a.distance(e)/Math.abs(i);h>this._bufParams.getMitreLimit()&&(r=!1)}catch(u){if(u instanceof pf)a=new Nt(0,0),r=!1;else throw u}finally{}r?this._segList.addPt(a):this.addLimitedMitreJoin(t,n,i,this._bufParams.getMitreLimit())};li.prototype.addFilletCorner=function(e,t,n,i,r){var a=t.x-e.x,h=t.y-e.y,u=Math.atan2(h,a),_=n.x-e.x,w=n.y-e.y,S=Math.atan2(w,_);i===be.CLOCKWISE?u<=S&&(u+=2*Math.PI):u>=S&&(u-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,u,S,i,r),this._segList.addPt(n)};li.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*li.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Dn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Dn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};li.prototype.createSquare=function(e){this._segList.addPt(new Nt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new Nt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new Nt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new Nt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};li.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};li.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};li.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};li.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};li.prototype.addLimitedMitreJoin=function(e,t,n,i){var r=this._seg0.p1,a=Cn.angle(r,this._seg0.p0),h=Cn.angleBetweenOriented(this._seg0.p0,r,this._seg1.p1),u=h/2,_=Cn.normalize(a+u),w=Cn.normalize(_+Math.PI),S=i*n,E=S*Math.abs(Math.sin(u)),M=n-E,k=r.x+S*Math.cos(w),D=r.y+S*Math.sin(w),F=new Nt(k,D),q=new ze(r,F),X=q.pointAlongOffset(1,M),B=q.pointAlongOffset(1,-M);this._side===le.LEFT?(this._segList.addPt(X),this._segList.addPt(B)):(this._segList.addPt(B),this._segList.addPt(X))};li.prototype.computeOffsetSegment=function(e,t,n,i){var r=t===le.LEFT?1:-1,a=e.p1.x-e.p0.x,h=e.p1.y-e.p0.y,u=Math.sqrt(a*a+h*h),_=r*n*a/u,w=r*n*h/u;i.p0.x=e.p0.x-w,i.p0.y=e.p0.y+_,i.p1.x=e.p1.x-w,i.p1.y=e.p1.y+_};li.prototype.addFilletArc=function(e,t,n,i,r){var a=this,h=i===be.CLOCKWISE?-1:1,u=Math.abs(t-n),_=Math.trunc(u/this._filletAngleQuantum+.5);if(_<1)return null;for(var w=0,S=u/_,E=w,M=new Nt;E<u;){var k=t+h*E;M.x=e.x+r*Math.cos(k),M.y=e.y+r*Math.sin(k),a._segList.addPt(M),E+=S}};li.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*li.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new Nt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var i=new Nt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(i)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};li.prototype.createCircle=function(e){var t=new Nt(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};li.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};li.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Jo,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*li.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};li.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===Dn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Dn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,be.CLOCKWISE,this._distance))};li.prototype.closeRing=function(){this._segList.closeRing()};li.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};li.prototype.interfaces_=function(){return[]};li.prototype.getClass=function(){return li};bd.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};bd.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};bd.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};bd.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(li,bd);var vo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};vo.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);e.length<=1?this.computePointCurve(e[0],r):this.computeOffsetCurve(e,n,r);var a=r.getCoordinates();return n&&_n.reverse(a),a};vo.prototype.computeSingleSidedBufferCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var r=Ei.simplify(e,-i),a=r.length-1;n.initSideSegments(r[a],r[a-1],le.LEFT),n.addFirstSegment();for(var h=a-2;h>=0;h--)n.addNextSegment(r[h],!0)}else{n.addSegments(e,!1);var u=Ei.simplify(e,i),_=u.length-1;n.initSideSegments(u[0],u[1],le.LEFT),n.addFirstSegment();for(var w=2;w<=_;w++)n.addNextSegment(u[w],!0)}n.addLastSegment(),n.closeRing()};vo.prototype.computeRingBufferCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);t===le.RIGHT&&(i=-i);var r=Ei.simplify(e,i),a=r.length-1;n.initSideSegments(r[a-1],r[0],t);for(var h=1;h<=a;h++){var u=h!==1;n.addNextSegment(r[h],u)}n.closeRing()};vo.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),i=Ei.simplify(e,n),r=i.length-1;t.initSideSegments(i[0],i[1],le.LEFT);for(var a=2;a<=r;a++)t.addNextSegment(i[a],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var h=Ei.simplify(e,-n),u=h.length-1;t.initSideSegments(h[u],h[u-1],le.LEFT);for(var _=u-2;_>=0;_--)t.addNextSegment(h[_],!0);t.addLastSegment(),t.addLineEndCap(h[1],h[0]),t.closeRing()};vo.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case Dn.CAP_ROUND:t.createCircle(e);break;case Dn.CAP_SQUARE:t.createSquare(e);break}};vo.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var n=Math.abs(t),i=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],i);else if(this._bufParams.isSingleSided()){var r=t<0;this.computeSingleSidedBufferCurve(e,r,i)}else this.computeLineBufferCurve(e,i);var a=i.getCoordinates();return a};vo.prototype.getBufferParameters=function(){return this._bufParams};vo.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};vo.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return vo.copyCoordinates(e);var i=this.getSegGen(n);return this.computeRingBufferCurve(e,t,i),i.getCoordinates()};vo.prototype.computeOffsetCurve=function(e,t,n){var i=this.simplifyTolerance(this._distance);if(t){var r=Ei.simplify(e,-i),a=r.length-1;n.initSideSegments(r[a],r[a-1],le.LEFT),n.addFirstSegment();for(var h=a-2;h>=0;h--)n.addNextSegment(r[h],!0)}else{var u=Ei.simplify(e,i),_=u.length-1;n.initSideSegments(u[0],u[1],le.LEFT),n.addFirstSegment();for(var w=2;w<=_;w++)n.addNextSegment(u[w],!0)}n.addLastSegment()};vo.prototype.getSegGen=function(e){return new li(this._precisionModel,this._bufParams,e)};vo.prototype.interfaces_=function(){return[]};vo.prototype.getClass=function(){return vo};vo.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new Nt(e[n]);return t};var wc=function(){this._subgraphs=null,this._seg=new ze,this._cga=new be;var e=arguments[0];this._subgraphs=e},Gx={DepthSegment:{configurable:!0}};wc.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=new pe,i=this._subgraphs.iterator();i.hasNext();){var r=i.next(),a=r.getEnvelope();t.y<a.getMinY()||t.y>a.getMaxY()||e.findStabbedSegments(t,r.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(He(arguments[2],Ps)&&arguments[0]instanceof Nt&&arguments[1]instanceof Ty)for(var h=arguments[0],u=arguments[1],_=arguments[2],w=u.getEdge().getCoordinates(),S=0;S<w.length-1;S++){e._seg.p0=w[S],e._seg.p1=w[S+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var E=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(E<h.x)&&!e._seg.isHorizontal()&&!(h.y<e._seg.p0.y||h.y>e._seg.p1.y)&&be.computeOrientation(e._seg.p0,e._seg.p1,h)!==be.RIGHT){var M=u.getDepth(le.LEFT);e._seg.p0.equals(w[S])||(M=u.getDepth(le.RIGHT));var k=new Du(e._seg,M);_.add(k)}}else if(He(arguments[2],Ps)&&arguments[0]instanceof Nt&&He(arguments[1],Ps))for(var D=arguments[0],F=arguments[1],q=arguments[2],X=F.iterator();X.hasNext();){var B=X.next();B.isForward()&&e.findStabbedSegments(D,B,q)}}};wc.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var n=Rs.min(t);return n._leftDepth};wc.prototype.interfaces_=function(){return[]};wc.prototype.getClass=function(){return wc};Gx.DepthSegment.get=function(){return Du};Object.defineProperties(wc,Gx);var Du=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new ze(e),this._leftDepth=t};Du.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return n!==0||(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(t._upwardSeg)};Du.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return n!==0?n:e.p1.compareTo(t.p1)};Du.prototype.toString=function(){return this._upwardSeg.toString()};Du.prototype.interfaces_=function(){return[_s]};Du.prototype.getClass=function(){return Du};var Rn=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};Rn.prototype.area=function(){return Rn.area(this.p0,this.p1,this.p2)};Rn.prototype.signedArea=function(){return Rn.signedArea(this.p0,this.p1,this.p2)};Rn.prototype.interpolateZ=function(e){if(e===null)throw new di("Supplied point is null.");return Rn.interpolateZ(e,this.p0,this.p1,this.p2)};Rn.prototype.longestSideLength=function(){return Rn.longestSideLength(this.p0,this.p1,this.p2)};Rn.prototype.isAcute=function(){return Rn.isAcute(this.p0,this.p1,this.p2)};Rn.prototype.circumcentre=function(){return Rn.circumcentre(this.p0,this.p1,this.p2)};Rn.prototype.area3D=function(){return Rn.area3D(this.p0,this.p1,this.p2)};Rn.prototype.centroid=function(){return Rn.centroid(this.p0,this.p1,this.p2)};Rn.prototype.inCentre=function(){return Rn.inCentre(this.p0,this.p1,this.p2)};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};Rn.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)};Rn.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2};Rn.det=function(e,t,n,i){return e*i-t*n};Rn.interpolateZ=function(e,t,n,i){var r=t.x,a=t.y,h=n.x-r,u=i.x-r,_=n.y-a,w=i.y-a,S=h*w-u*_,E=e.x-r,M=e.y-a,k=(w*E-u*M)/S,D=(-_*E+h*M)/S,F=t.z+k*(n.z-t.z)+D*(i.z-t.z);return F};Rn.longestSideLength=function(e,t,n){var i=e.distance(t),r=t.distance(n),a=n.distance(e),h=i;return r>h&&(h=r),a>h&&(h=a),h};Rn.isAcute=function(e,t,n){return!(!Cn.isAcute(e,t,n)||!Cn.isAcute(t,n,e)||!Cn.isAcute(n,e,t))};Rn.circumcentre=function(e,t,n){var i=n.x,r=n.y,a=e.x-i,h=e.y-r,u=t.x-i,_=t.y-r,w=2*Rn.det(a,h,u,_),S=Rn.det(h,a*a+h*h,_,u*u+_*_),E=Rn.det(a,a*a+h*h,u,u*u+_*_),M=i-S/w,k=r+E/w;return new Nt(M,k)};Rn.perpendicularBisector=function(e,t){var n=t.x-e.x,i=t.y-e.y,r=new Ms(e.x+n/2,e.y+i/2,1),a=new Ms(e.x-i+n/2,e.y+n+i/2,1);return new Ms(r,a)};Rn.angleBisector=function(e,t,n){var i=t.distance(e),r=t.distance(n),a=i/(i+r),h=n.x-e.x,u=n.y-e.y,_=new Nt(e.x+a*h,e.y+a*u);return _};Rn.area3D=function(e,t,n){var i=t.x-e.x,r=t.y-e.y,a=t.z-e.z,h=n.x-e.x,u=n.y-e.y,_=n.z-e.z,w=r*_-a*u,S=a*h-i*_,E=i*u-r*h,M=w*w+S*S+E*E,k=Math.sqrt(M)/2;return k};Rn.centroid=function(e,t,n){var i=(e.x+t.x+n.x)/3,r=(e.y+t.y+n.y)/3;return new Nt(i,r)};Rn.inCentre=function(e,t,n){var i=t.distance(n),r=e.distance(n),a=e.distance(t),h=i+r+a,u=(i*e.x+r*t.x+a*n.x)/h,_=(i*e.y+r*t.y+a*n.y)/h;return new Nt(u,_)};var gs=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new pe;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};gs.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,Ot.EXTERIOR,Ot.INTERIOR)};gs.prototype.addPolygon=function(e){var t=this,n=this._distance,i=le.LEFT;this._distance<0&&(n=-this._distance,i=le.RIGHT);var r=e.getExteriorRing(),a=_n.removeRepeatedPoints(r.getCoordinates());if(this._distance<0&&this.isErodedCompletely(r,this._distance)||this._distance<=0&&a.length<3)return null;this.addPolygonRing(a,n,i,Ot.EXTERIOR,Ot.INTERIOR);for(var h=0;h<e.getNumInteriorRing();h++){var u=e.getInteriorRingN(h),_=_n.removeRepeatedPoints(u.getCoordinates());t._distance>0&&t.isErodedCompletely(u,-t._distance)||t.addPolygonRing(_,n,le.opposite(i),Ot.INTERIOR,Ot.EXTERIOR)}};gs.prototype.isTriangleErodedCompletely=function(e,t){var n=new Rn(e[0],e[1],e[2]),i=n.inCentre(),r=be.distancePointLine(i,n.p0,n.p1);return r<Math.abs(t)};gs.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=_n.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,Ot.EXTERIOR,Ot.INTERIOR)};gs.prototype.addCurve=function(e,t,n){if(e===null||e.length<2)return null;var i=new Ni(e,new Fn(0,Ot.BOUNDARY,t,n));this._curveList.add(i)};gs.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};gs.prototype.addPolygonRing=function(e,t,n,i,r){if(t===0&&e.length<Da.MINIMUM_VALID_SIZE)return null;var a=i,h=r;e.length>=Da.MINIMUM_VALID_SIZE&&be.isCCW(e)&&(a=r,h=i,n=le.opposite(n));var u=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(u,a,h)};gs.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Yi?this.addPolygon(e):e instanceof Ii?this.addLineString(e):e instanceof Do?this.addPoint(e):e instanceof Yh?this.addCollection(e):e instanceof ku?this.addCollection(e):e instanceof Pa?this.addCollection(e):e instanceof to&&this.addCollection(e)};gs.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(n.length===4)return this.isTriangleErodedCompletely(n,t);var i=e.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r};gs.prototype.addCollection=function(e){for(var t=this,n=0;n<e.getNumGeometries();n++){var i=e.getGeometryN(n);t.add(i)}};gs.prototype.interfaces_=function(){return[]};gs.prototype.getClass=function(){return gs};var tf=function(){};tf.prototype.locate=function(e){};tf.prototype.interfaces_=function(){return[]};tf.prototype.getClass=function(){return tf};var ka=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};ka.prototype.next=function(){if(this._atStart)return this._atStart=!1,ka.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new mf;var e=this._parent.getGeometryN(this._index++);return e instanceof to?(this._subcollectionIterator=new ka(e),this._subcollectionIterator.next()):e};ka.prototype.remove=function(){throw new Error(this.getClass().getName())};ka.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ka.prototype.interfaces_=function(){return[df]};ka.prototype.getClass=function(){return ka};ka.isAtomic=function(e){return!(e instanceof to)};var $o=function(){this._geom=null;var e=arguments[0];this._geom=e};$o.prototype.locate=function(e){return $o.locate(e,this._geom)};$o.prototype.interfaces_=function(){return[tf]};$o.prototype.getClass=function(){return $o};$o.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?be.isPointInRing(e,t.getCoordinates()):!1};$o.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!$o.isPointInRing(e,n))return!1;for(var i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);if($o.isPointInRing(e,r))return!1}return!0};$o.containsPoint=function(e,t){if(t instanceof Yi)return $o.containsPointInPolygon(e,t);if(t instanceof to)for(var n=new ka(t);n.hasNext();){var i=n.next();if(i!==t&&$o.containsPoint(e,i))return!0}return!1};$o.locate=function(e,t){return t.isEmpty()?Ot.EXTERIOR:$o.containsPoint(e,t)?Ot.INTERIOR:Ot.EXTERIOR};var Ur=function(){this._edgeMap=new Br,this._edgeList=null,this._ptInAreaLocation=[Ot.NONE,Ot.NONE]};Ur.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return t===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};Ur.prototype.propagateSideLabels=function(e){for(var t=Ot.NONE,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea(e)&&r.getLocation(e,le.LEFT)!==Ot.NONE&&(t=r.getLocation(e,le.LEFT))}if(t===Ot.NONE)return null;for(var a=t,h=this.iterator();h.hasNext();){var u=h.next(),_=u.getLabel();if(_.getLocation(e,le.ON)===Ot.NONE&&_.setLocation(e,le.ON,a),_.isArea(e)){var w=_.getLocation(e,le.LEFT),S=_.getLocation(e,le.RIGHT);if(S!==Ot.NONE){if(S!==a)throw new cl("side location conflict",u.getCoordinate());w===Ot.NONE&&un.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),a=w}else un.isTrue(_.getLocation(e,le.LEFT)===Ot.NONE,"found single null side"),_.setLocation(e,le.RIGHT,a),_.setLocation(e,le.LEFT,a)}}};Ur.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};Ur.prototype.print=function(e){Lr.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Ur.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};Ur.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel(),r=i.getLocation(e,le.LEFT);un.isTrue(r!==Ot.NONE,"Found unlabelled area edge");for(var a=r,h=this.iterator();h.hasNext();){var u=h.next(),_=u.getLabel();un.isTrue(_.isArea(e),"Found non-area edge");var w=_.getLocation(e,le.LEFT),S=_.getLocation(e,le.RIGHT);if(w===S||S!==a)return!1;a=w}return!0};Ur.prototype.findIndex=function(e){var t=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var i=t._edgeList.get(n);if(i===e)return n}return-1};Ur.prototype.iterator=function(){return this.getEdges().iterator()};Ur.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new pe(this._edgeMap.values())),this._edgeList};Ur.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===Ot.NONE&&(this._ptInAreaLocation[e]=$o.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]};Ur.prototype.toString=function(){var e=new ma;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append(`
`)}return e.toString()};Ur.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.computeLabel(e)}};Ur.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],i=this.iterator();i.hasNext();)for(var r=i.next(),a=r.getLabel(),h=0;h<2;h++)a.isLine(h)&&a.getLocation(h)===Ot.BOUNDARY&&(n[h]=!0);for(var u=this.iterator();u.hasNext();)for(var _=u.next(),w=_.getLabel(),S=0;S<2;S++)if(w.isAnyNull(S)){var E=Ot.NONE;if(n[S])E=Ot.EXTERIOR;else{var M=_.getCoordinate();E=t.getLocation(S,M,e)}w.setAllLocationsIfNull(S,E)}};Ur.prototype.getDegree=function(){return this._edgeMap.size()};Ur.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};Ur.prototype.interfaces_=function(){return[]};Ur.prototype.getClass=function(){return Ur};var AE=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var i=null,r=null,a=this._SCANNING_FOR_INCOMING,h=0;h<this._resultAreaEdgeList.size();h++){var u=n._resultAreaEdgeList.get(h),_=u.getSym();if(u.getLabel().isArea())switch(i===null&&u.isInResult()&&(i=u),a){case n._SCANNING_FOR_INCOMING:if(!_.isInResult())continue;r=_,a=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;r.setNext(u),a=n._SCANNING_FOR_INCOMING;break}}if(a===this._LINKING_TO_OUTGOING){if(i===null)throw new cl("no outgoing dirEdge found",this.getCoordinate());un.isTrue(i.isInResult(),"unable to link last incoming dirEdge"),r.setNext(i)}},t.prototype.insert=function(n){var i=n;this.insertEdgeEnd(i,i)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),i=n.size();if(i<1)return null;var r=n.get(0);if(i===1)return r;var a=n.get(i-1),h=r.getQuadrant(),u=a.getQuadrant();return Gn.isNorthern(h)&&Gn.isNorthern(u)?r:!Gn.isNorthern(h)&&!Gn.isNorthern(u)?a:r.getDy()!==0?r:a.getDy()!==0?a:(un.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){Lr.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var i=this.iterator();i.hasNext();){var r=i.next();n.print("out "),r.print(n),n.println(),n.print("in "),r.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new pe;for(var i=this.iterator();i.hasNext();){var r=i.next();(r.isInResult()||r.getSym().isInResult())&&n._resultAreaEdgeList.add(r)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var i=this.iterator();i.hasNext();){var r=i.next(),a=r.getLabel();a.setAllLocationsIfNull(0,n.getLocation(0)),a.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var i=null,r=null,a=this._edgeList.size()-1;a>=0;a--){var h=n._edgeList.get(a),u=h.getSym();r===null&&(r=u),i!==null&&u.setNext(i),i=h}r.setNext(i)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var i=arguments[0],r=this.findIndex(i),a=i.getDepth(le.LEFT),h=i.getDepth(le.RIGHT),u=this.computeDepths(r+1,this._edgeList.size(),a),_=this.computeDepths(0,r,u);if(_!==h)throw new cl("depth mismatch at "+i.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],S=arguments[1],E=arguments[2],M=E,k=w;k<S;k++){var D=n._edgeList.get(k);D.setEdgeDepths(le.RIGHT,M),M=D.getDepth(le.LEFT)}return M}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.merge(i.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var i=this,r=null,a=null,h=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var _=i._resultAreaEdgeList.get(u),w=_.getSym();switch(r===null&&_.getEdgeRing()===n&&(r=_),h){case i._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==n)continue;a=w,h=i._LINKING_TO_OUTGOING;break;case i._LINKING_TO_OUTGOING:if(_.getEdgeRing()!==n)continue;a.setNextMin(_),h=i._SCANNING_FOR_INCOMING;break}}h===this._LINKING_TO_OUTGOING&&(un.isTrue(r!==null,"found null for first outgoing dirEdge"),un.isTrue(r.getEdgeRing()===n,"unable to link last incoming dirEdge"),a.setNextMin(r))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,i=this.iterator();i.hasNext();){var r=i.next();r.isInResult()&&n++}return n}else if(arguments.length===1){for(var a=arguments[0],h=0,u=this.iterator();u.hasNext();){var _=u.next();_.getEdgeRing()===a&&h++}return h}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=Ot.NONE,i=this.iterator();i.hasNext();){var r=i.next(),a=r.getSym();if(!r.isLineEdge()){if(r.isInResult()){n=Ot.INTERIOR;break}if(a.isInResult()){n=Ot.EXTERIOR;break}}}if(n===Ot.NONE)return null;for(var h=n,u=this.iterator();u.hasNext();){var _=u.next(),w=_.getSym();_.isLineEdge()?_.getEdge().setCovered(h===Ot.INTERIOR):(_.isInResult()&&(h=Ot.EXTERIOR),w.isInResult()&&(h=Ot.INTERIOR))}},t.prototype.computeLabelling=function(n){var i=this;e.prototype.computeLabelling.call(this,n),this._label=new Fn(Ot.NONE);for(var r=this.iterator();r.hasNext();)for(var a=r.next(),h=a.getEdge(),u=h.getLabel(),_=0;_<2;_++){var w=u.getLocation(_);(w===Ot.INTERIOR||w===Ot.BOUNDARY)&&i._label.setLocation(_,Ot.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ur),jx=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new Rg(n,new AE)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Kh),Hl=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};Hl.prototype.compareTo=function(e){var t=e,n=Hl.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return n};Hl.prototype.interfaces_=function(){return[_s]};Hl.prototype.getClass=function(){return Hl};Hl.orientation=function(e){return _n.increasingDirection(e)===1};Hl.compareOriented=function(e,t,n,i){for(var r=t?1:-1,a=i?1:-1,h=t?e.length:-1,u=i?n.length:-1,_=t?0:e.length-1,w=i?0:n.length-1;;){var S=e[_].compareTo(n[w]);if(S!==0)return S;_+=r,w+=a;var E=_===h,M=w===u;if(E&&!M)return-1;if(!E&&M)return 1;if(E&&M)return 0}};var zs=function(){this._edges=new pe,this._ocaMap=new Br};zs.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var i=t._edges.get(n);n>0&&e.print(","),e.print("(");for(var r=i.getCoordinates(),a=0;a<r.length;a++)a>0&&e.print(","),e.print(r[a].x+" "+r[a].y);e.println(")")}e.print(")  ")};zs.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next())};zs.prototype.findEdgeIndex=function(e){for(var t=this,n=0;n<this._edges.size();n++)if(t._edges.get(n).equals(e))return n;return-1};zs.prototype.iterator=function(){return this._edges.iterator()};zs.prototype.getEdges=function(){return this._edges};zs.prototype.get=function(e){return this._edges.get(e)};zs.prototype.findEqualEdge=function(e){var t=new Hl(e.getCoordinates()),n=this._ocaMap.get(t);return n};zs.prototype.add=function(e){this._edges.add(e);var t=new Hl(e.getCoordinates());this._ocaMap.put(t,e)};zs.prototype.interfaces_=function(){return[]};zs.prototype.getClass=function(){return zs};var Nu=function(){};Nu.prototype.processIntersections=function(e,t,n,i){};Nu.prototype.isDone=function(){};Nu.prototype.interfaces_=function(){return[]};Nu.prototype.getClass=function(){return Nu};var Qo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Qo.prototype.isTrivialIntersection=function(e,t,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(Qo.isAdjacentSegments(t,i))return!0;if(e.isClosed()){var r=e.size()-1;if(t===0&&i===r||i===0&&t===r)return!0}}return!1};Qo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Qo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Qo.prototype.getLineIntersector=function(){return this._li};Qo.prototype.hasProperIntersection=function(){return this._hasProper};Qo.prototype.processIntersections=function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],a=e.getCoordinates()[t+1],h=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this._li.computeIntersection(r,a,h,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Qo.prototype.hasIntersection=function(){return this._hasIntersection};Qo.prototype.isDone=function(){return!1};Qo.prototype.hasInteriorIntersection=function(){return this._hasInterior};Qo.prototype.interfaces_=function(){return[Nu]};Qo.prototype.getClass=function(){return Qo};Qo.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var ua=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new Nt(e),this.segmentIndex=t,this.dist=n};ua.prototype.getSegmentIndex=function(){return this.segmentIndex};ua.prototype.getCoordinate=function(){return this.coord};ua.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};ua.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};ua.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};ua.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};ua.prototype.getDistance=function(){return this.dist};ua.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};ua.prototype.interfaces_=function(){return[_s]};ua.prototype.getClass=function(){return ua};var za=function(){this._nodeMap=new Br,this.edge=null;var e=arguments[0];this.edge=e};za.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};za.prototype.iterator=function(){return this._nodeMap.values().iterator()};za.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var n=this.iterator(),i=n.next();n.hasNext();){var r=n.next(),a=t.createSplitEdge(i,r);e.add(a),i=r}};za.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};za.prototype.createSplitEdge=function(e,t){var n=this,i=t.segmentIndex-e.segmentIndex+2,r=this.edge.pts[t.segmentIndex],a=t.dist>0||!t.coord.equals2D(r);a||i--;var h=new Array(i).fill(null),u=0;h[u++]=new Nt(e.coord);for(var _=e.segmentIndex+1;_<=t.segmentIndex;_++)h[u++]=n.edge.pts[_];return a&&(h[u]=t.coord),new og(h,new Fn(this.edge._label))};za.prototype.add=function(e,t,n){var i=new ua(e,t,n),r=this._nodeMap.get(i);return r!==null?r:(this._nodeMap.put(i,i),i)};za.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();if(n.coord.equals(e))return!0}return!1};za.prototype.interfaces_=function(){return[]};za.prototype.getClass=function(){return za};var Ru=function(){};Ru.prototype.getChainStartIndices=function(e){var t=this,n=0,i=new pe;i.add(new ia(n));do{var r=t.findChainEnd(e,n);i.add(new ia(r)),n=r}while(n<e.length-1);var a=Ru.toIntArray(i);return a};Ru.prototype.findChainEnd=function(e,t){for(var n=Gn.quadrant(e[t],e[t+1]),i=t+1;i<e.length;){var r=Gn.quadrant(e[i-1],e[i]);if(r!==n)break;i++}return i-1};Ru.prototype.interfaces_=function(){return[]};Ru.prototype.getClass=function(){return Ru};Ru.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var fl=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Re,this.env2=new Re;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new Ru;this.startIndex=t.getChainStartIndices(this.pts)};fl.prototype.getCoordinates=function(){return this.pts};fl.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n};fl.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n};fl.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(arguments.length===6){var r=arguments[0],a=arguments[1],h=arguments[2],u=arguments[3],_=arguments[4],w=arguments[5],S=this.pts[r],E=this.pts[a],M=h.pts[u],k=h.pts[_];if(a-r===1&&_-u===1)return w.addIntersections(this.e,r,h.e,u),null;if(this.env1.init(S,E),this.env2.init(M,k),!this.env1.intersects(this.env2))return null;var D=Math.trunc((r+a)/2),F=Math.trunc((u+_)/2);r<D&&(u<F&&this.computeIntersectsForChain(r,D,h,u,F,w),F<_&&this.computeIntersectsForChain(r,D,h,F,_,w)),D<a&&(u<F&&this.computeIntersectsForChain(D,a,h,u,F,w),F<_&&this.computeIntersectsForChain(D,a,h,F,_,w))}};fl.prototype.getStartIndexes=function(){return this.startIndex};fl.prototype.computeIntersects=function(e,t){for(var n=this,i=0;i<this.startIndex.length-1;i++)for(var r=0;r<e.startIndex.length-1;r++)n.computeIntersectsForChain(i,e,r,t)};fl.prototype.interfaces_=function(){return[]};fl.prototype.getClass=function(){return fl};var Tr=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var i=0;i<3;i++)t._depth[n][i]=e.NULL_VALUE},qx={NULL_VALUE:{configurable:!0}};Tr.prototype.getDepth=function(e,t){return this._depth[e][t]};Tr.prototype.setDepth=function(e,t,n){this._depth[e][t]=n};Tr.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(e._depth[t][n]!==Tr.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var i=arguments[0];return this._depth[i][1]===Tr.NULL_VALUE}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return this._depth[r][a]===Tr.NULL_VALUE}};Tr.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var n=e._depth[t][1];e._depth[t][2]<n&&(n=e._depth[t][2]),n<0&&(n=0);for(var i=1;i<3;i++){var r=0;e._depth[t][i]>n&&(r=1),e._depth[t][i]=r}}};Tr.prototype.getDelta=function(e){return this._depth[e][le.RIGHT]-this._depth[e][le.LEFT]};Tr.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?Ot.EXTERIOR:Ot.INTERIOR};Tr.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Tr.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);(r===Ot.EXTERIOR||r===Ot.INTERIOR)&&(e.isNull(n,i)?e._depth[n][i]=Tr.depthAtLocation(r):e._depth[n][i]+=Tr.depthAtLocation(r))}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];u===Ot.INTERIOR&&this._depth[a][h]++}};Tr.prototype.interfaces_=function(){return[]};Tr.prototype.getClass=function(){return Tr};Tr.depthAtLocation=function(e){return e===Ot.EXTERIOR?0:e===Ot.INTERIOR?1:Tr.NULL_VALUE};qx.NULL_VALUE.get=function(){return-1};Object.defineProperties(Tr,qx);var og=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new za(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Tr,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var i=arguments[0],r=arguments[1];this.pts=i,this._label=r}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var i=new t(n,Fn.toLineLabel(this._label));return i},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var i=this;if(!(n instanceof t))return!1;var r=n;if(this.pts.length!==r.pts.length)return!1;for(var a=!0,h=!0,u=this.pts.length,_=0;_<this.pts.length;_++)if(i.pts[_].equals2D(r.pts[_])||(a=!1),i.pts[_].equals2D(r.pts[--u])||(h=!1),!a&&!h)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var i=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&n.print(","),n.print(i.pts[r].x+" "+i.pts[r].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var i=this;n.print("edge "+this._name+": ");for(var r=this.pts.length-1;r>=0;r--)n.print(i.pts[r]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new fl(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new Re;for(var i=0;i<this.pts.length;i++)n._env.expandToInclude(n.pts[i])}return this._env},t.prototype.addIntersection=function(n,i,r,a){var h=new Nt(n.getIntersection(a)),u=i,_=n.getEdgeDistance(r,a),w=u+1;if(w<this.pts.length){var S=this.pts[w];h.equals2D(S)&&(u=w,_=0)}this.eiList.add(h,u,_)},t.prototype.toString=function(){var n=this,i=new ma;i.append("edge "+this._name+": "),i.append("LINESTRING (");for(var r=0;r<this.pts.length;r++)r>0&&i.append(","),i.append(n.pts[r].x+" "+n.pts[r].y);return i.append(")  "+this._label+" "+this._depthDelta),i.toString()},t.prototype.isPointwiseEqual=function(n){var i=this;if(this.pts.length!==n.pts.length)return!1;for(var r=0;r<this.pts.length;r++)if(!i.pts[r].equals2D(n.pts[r]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,i,r){for(var a=this,h=0;h<n.getIntersectionNum();h++)a.addIntersection(n,i,r,h)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];i.setAtLeastIfValid(n.getLocation(0,le.ON),n.getLocation(1,le.ON),1),n.isArea()&&(i.setAtLeastIfValid(n.getLocation(0,le.LEFT),n.getLocation(1,le.LEFT),2),i.setAtLeastIfValid(n.getLocation(0,le.RIGHT),n.getLocation(1,le.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Ko),Qr=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new zs,this._bufParams=e||null};Qr.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};Qr.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),i=e.getLabel();t.isPointwiseEqual(e)||(i=new Fn(e.getLabel()),i.flip()),n.merge(i);var r=Qr.depthDelta(i),a=t.getDepthDelta(),h=a+r;t.setDepthDelta(h)}else this._edgeList.add(e),e.setDepthDelta(Qr.depthDelta(e.getLabel()))};Qr.prototype.buildSubgraphs=function(e,t){for(var n=new pe,i=e.iterator();i.hasNext();){var r=i.next(),a=r.getRightmostCoordinate(),h=new wc(n),u=h.getDepth(a);r.computeDepth(u),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}};Qr.prototype.createSubgraphs=function(e){for(var t=new pe,n=e.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new eo;r.create(i),t.add(r)}}return Rs.sort(t,Rs.reverseOrder()),t};Qr.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};Qr.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new $y,n=new Vu;return n.setPrecisionModel(e),t.setSegmentIntersector(new Qo(n)),t};Qr.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var i=new vo(n,this._bufParams),r=new gs(e,t,i),a=r.getCurves();if(a.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(a,n),this._graph=new bi(new jx),this._graph.addEdges(this._edgeList.getEdges());var h=this.createSubgraphs(this._graph),u=new No(this._geomFact);this.buildSubgraphs(h,u);var _=u.getPolygons();if(_.size()<=0)return this.createEmptyResultGeometry();var w=this._geomFact.buildGeometry(_);return w};Qr.prototype.computeNodedEdges=function(e,t){var n=this,i=this.getNoder(t);i.computeNodes(e);for(var r=i.getNodedSubstrings(),a=r.iterator();a.hasNext();){var h=a.next(),u=h.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var _=h.getData(),w=new og(h.getCoordinates(),new Fn(_));n.insertUniqueEdge(w)}}};Qr.prototype.setNoder=function(e){this._workingNoder=e};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};Qr.depthDelta=function(e){var t=e.getLocation(0,le.LEFT),n=e.getLocation(0,le.RIGHT);return t===Ot.INTERIOR&&n===Ot.EXTERIOR?1:t===Ot.EXTERIOR&&n===Ot.INTERIOR?-1:0};Qr.convertSegStrings=function(e){for(var t=new gn,n=new pe;e.hasNext();){var i=e.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)};var $l=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],i=arguments[1],r=arguments[2],a=arguments[3];this._noder=n,this._scaleFactor=i,this._offsetX=r,this._offsetY=a,this._isScaled=!this.isIntegerPrecision()}};$l.prototype.rescale=function(){var e=this;if(He(arguments[0],Wi))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();e.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],a=0;a<r.length;a++)r[a].x=r[a].x/e._scaleFactor+e._offsetX,r[a].y=r[a].y/e._scaleFactor+e._offsetY;r.length===2&&r[0].equals2D(r[1])&&Lr.out.println(r)}};$l.prototype.scale=function(){var e=this;if(He(arguments[0],Wi)){for(var t=arguments[0],n=new pe,i=t.iterator();i.hasNext();){var r=i.next();n.add(new Ni(e.scale(r.getCoordinates()),r.getData()))}return n}else if(arguments[0]instanceof Array){for(var a=arguments[0],h=new Array(a.length).fill(null),u=0;u<a.length;u++)h[u]=new Nt(Math.round((a[u].x-e._offsetX)*e._scaleFactor),Math.round((a[u].y-e._offsetY)*e._scaleFactor),a[u].z);var _=_n.removeRepeatedPoints(h);return _}};$l.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};$l.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};$l.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};$l.prototype.interfaces_=function(){return[Au]};$l.prototype.getClass=function(){return $l};var ca=function(){this._li=new Vu,this._segStrings=null;var e=arguments[0];this._segStrings=e},Zx={fact:{configurable:!0}};ca.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next(),i=n.getCoordinates();e.checkEndPtVertexIntersections(i[0],e._segStrings),e.checkEndPtVertexIntersections(i[i.length-1],e._segStrings)}else if(arguments.length===2){for(var r=arguments[0],a=arguments[1],h=a.iterator();h.hasNext();)for(var u=h.next(),_=u.getCoordinates(),w=1;w<_.length-1;w++)if(_[w].equals(r))throw new ll("found endpt/interior pt intersection at index "+w+" :pt "+r)}};ca.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var n=t.next(),i=this._segStrings.iterator();i.hasNext();){var r=i.next();e.checkInteriorIntersections(n,r)}else if(arguments.length===2)for(var a=arguments[0],h=arguments[1],u=a.getCoordinates(),_=h.getCoordinates(),w=0;w<u.length-1;w++)for(var S=0;S<_.length-1;S++)e.checkInteriorIntersections(a,w,h,S);else if(arguments.length===4){var E=arguments[0],M=arguments[1],k=arguments[2],D=arguments[3];if(E===k&&M===D)return null;var F=E.getCoordinates()[M],q=E.getCoordinates()[M+1],X=k.getCoordinates()[D],B=k.getCoordinates()[D+1];if(this._li.computeIntersection(F,q,X,B),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,F,q)||this.hasInteriorIntersection(this._li,X,B)))throw new ll("found non-noded intersection at "+F+"-"+q+" and "+X+"-"+B)}};ca.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};ca.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();e.checkCollapses(n)}else if(arguments.length===1)for(var i=arguments[0],r=i.getCoordinates(),a=0;a<r.length-2;a++)e.checkCollapse(r[a],r[a+1],r[a+2])};ca.prototype.hasInteriorIntersection=function(e,t,n){for(var i=0;i<e.getIntersectionNum();i++){var r=e.getIntersection(i);if(!(r.equals(t)||r.equals(n)))return!0}return!1};ca.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new ll("found non-noded collapse at "+ca.fact.createLineString([e,t,n]))};ca.prototype.interfaces_=function(){return[]};ca.prototype.getClass=function(){return ca};Zx.fact.get=function(){return new gn};Object.defineProperties(ca,Zx);var bo=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new di("Scale factor must be non-zero");t!==1&&(this._pt=new Nt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new Nt,this._p1Scaled=new Nt),this.initCorners(this._pt)},Wx={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};bo.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),r=Math.min(e.y,t.y),a=Math.max(e.y,t.y),h=this._maxx<n||this._minx>i||this._maxy<r||this._miny>a;if(h)return!1;var u=this.intersectsToleranceSquare(e,t);return un.isTrue(!(h&&u),"Found bad envelope test"),u};bo.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new Nt(this._maxx,this._maxy),this._corner[1]=new Nt(this._minx,this._maxy),this._corner[2]=new Nt(this._minx,this._miny),this._corner[3]=new Nt(this._maxx,this._miny)};bo.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};bo.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};bo.prototype.getCoordinate=function(){return this._originalPt};bo.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};bo.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=bo.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Re(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};bo.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};bo.prototype.intersectsToleranceSquare=function(e,t){var n=!1,i=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(i=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||n&&i||e.equals(this._pt)||t.equals(this._pt))};bo.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),i=e.getCoordinate(t+1);return this.intersects(n,i)?(e.addIntersection(this.getCoordinate(),t),!0):!1};bo.prototype.interfaces_=function(){return[]};bo.prototype.getClass=function(){return bo};Wx.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(bo,Wx);var ad=function(){this.tempEnv1=new Re,this.selectedSegment=new ze};ad.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};ad.prototype.interfaces_=function(){return[]};ad.prototype.getClass=function(){return ad};var ef=function(){this._index=null;var e=arguments[0];this._index=e},Hx={HotPixelSnapAction:{configurable:!0}};ef.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),a=new $x(t,n,i);return this._index.query(r,{interfaces_:function(){return[Zl]},visitItem:function(h){var u=h;u.select(r,a)}}),a.isNodeAdded()}};ef.prototype.interfaces_=function(){return[]};ef.prototype.getClass=function(){return ef};Hx.HotPixelSnapAction.get=function(){return $x};Object.defineProperties(ef,Hx);var $x=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],i=arguments[1],r=arguments[2];this._hotPixel=n,this._parentEdge=i,this._hotPixelVertexIndex=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1],r=n.getContext();if(this._parentEdge!==null&&r===this._parentEdge&&i===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(r,i)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ad),Sc=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new pe};Sc.prototype.processIntersections=function(e,t,n,i){var r=this;if(e===n&&t===i)return null;var a=e.getCoordinates()[t],h=e.getCoordinates()[t+1],u=n.getCoordinates()[i],_=n.getCoordinates()[i+1];if(this._li.computeIntersection(a,h,u,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)r._interiorIntersections.add(r._li.getIntersection(w));e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)}};Sc.prototype.isDone=function(){return!1};Sc.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Sc.prototype.interfaces_=function(){return[Nu]};Sc.prototype.getClass=function(){return Sc};var Oa=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new Vu,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};Oa.prototype.checkCorrectness=function(e){var t=Ni.getNodedSubstrings(e),n=new ca(t);try{n.checkValid()}catch(i){if(i instanceof kx)i.printStackTrace();else throw i}finally{}};Oa.prototype.getNodedSubstrings=function(){return Ni.getNodedSubstrings(this._nodedSegStrings)};Oa.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};Oa.prototype.findInteriorIntersections=function(e,t){var n=new Sc(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};Oa.prototype.computeVertexSnaps=function(){var e=this;if(He(arguments[0],Wi))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();e.computeVertexSnaps(i)}else if(arguments[0]instanceof Ni)for(var r=arguments[0],a=r.getCoordinates(),h=0;h<a.length;h++){var u=new bo(a[h],e._scaleFactor,e._li),_=e._pointSnapper.snap(u,r,h);_&&r.addIntersection(a[h],h)}};Oa.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new $y,this._pointSnapper=new ef(this._noder.getIndex()),this.snapRound(e,this._li)};Oa.prototype.computeIntersectionSnaps=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next(),r=new bo(i,t._scaleFactor,t._li);t._pointSnapper.snap(r)}};Oa.prototype.interfaces_=function(){return[Au]};Oa.prototype.getClass=function(){return Oa};var Cr=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Dn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},gf={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Cr.prototype.bufferFixedPrecision=function(e){var t=new $l(new Oa(new Nn(1)),e.getScale()),n=new Qr(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Cr.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=Cr.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(a){if(a instanceof cl)e._saveException=a;else throw a}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],i=Cr.precisionScaleFactor(this._argGeom,this._distance,n),r=new Nn(i);this.bufferFixedPrecision(r)}};Cr.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===Nn.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};Cr.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};Cr.prototype.bufferOriginalPrecision=function(){try{var e=new Qr(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof ll)this._saveException=t;else throw t}finally{}};Cr.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};Cr.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};Cr.prototype.interfaces_=function(){return[]};Cr.prototype.getClass=function(){return Cr};Cr.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Cr(e),i=n.getResultGeometry(t);return i}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ze&&typeof arguments[1]=="number"){var r=arguments[0],a=arguments[1],h=arguments[2],u=new Cr(r);u.setQuadrantSegments(h);var _=u.getResultGeometry(a);return _}else if(arguments[2]instanceof Dn&&arguments[0]instanceof Ze&&typeof arguments[1]=="number"){var w=arguments[0],S=arguments[1],E=arguments[2],M=new Cr(w,E),k=M.getResultGeometry(S);return k}}else if(arguments.length===4){var D=arguments[0],F=arguments[1],q=arguments[2],X=arguments[3],B=new Cr(D);B.setQuadrantSegments(q),B.setEndCapStyle(X);var U=B.getResultGeometry(F);return U}};Cr.precisionScaleFactor=function(e,t,n){var i=e.getEnvelopeInternal(),r=Yo.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),a=t>0?t:0,h=r+2*a,u=Math.trunc(Math.log(h)/Math.log(10)+1),_=n-u,w=Math.pow(10,_);return w};gf.CAP_ROUND.get=function(){return Dn.CAP_ROUND};gf.CAP_BUTT.get=function(){return Dn.CAP_FLAT};gf.CAP_FLAT.get=function(){return Dn.CAP_FLAT};gf.CAP_SQUARE.get=function(){return Dn.CAP_SQUARE};gf.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Cr,gf);var Yr=function(){this._pt=[new Nt,new Nt],this._distance=tn.NaN,this._isNull=!0};Yr.prototype.getCoordinates=function(){return this._pt};Yr.prototype.getCoordinate=function(e){return this._pt[e]};Yr.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i<this._distance&&this.initialize(t,n,i)}};Yr.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}};Yr.prototype.getDistance=function(){return this._distance};Yr.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i>this._distance&&this.initialize(t,n,i)}};Yr.prototype.interfaces_=function(){return[]};Yr.prototype.getClass=function(){return Yr};var Ca=function(){};Ca.prototype.interfaces_=function(){return[]};Ca.prototype.getClass=function(){return Ca};Ca.computeDistance=function(){if(arguments[2]instanceof Yr&&arguments[0]instanceof Ii&&arguments[1]instanceof Nt)for(var e=arguments[0],t=arguments[1],n=arguments[2],i=e.getCoordinates(),r=new ze,a=0;a<i.length-1;a++){r.setCoordinates(i[a],i[a+1]);var h=r.closestPoint(t);n.setMinimum(h,t)}else if(arguments[2]instanceof Yr&&arguments[0]instanceof Yi&&arguments[1]instanceof Nt){var u=arguments[0],_=arguments[1],w=arguments[2];Ca.computeDistance(u.getExteriorRing(),_,w);for(var S=0;S<u.getNumInteriorRing();S++)Ca.computeDistance(u.getInteriorRingN(S),_,w)}else if(arguments[2]instanceof Yr&&arguments[0]instanceof Ze&&arguments[1]instanceof Nt){var E=arguments[0],M=arguments[1],k=arguments[2];if(E instanceof Ii)Ca.computeDistance(E,M,k);else if(E instanceof Yi)Ca.computeDistance(E,M,k);else if(E instanceof to)for(var D=E,F=0;F<D.getNumGeometries();F++){var q=D.getGeometryN(F);Ca.computeDistance(q,M,k)}else k.setMinimum(E.getCoordinate(),M)}else if(arguments[2]instanceof Yr&&arguments[0]instanceof ze&&arguments[1]instanceof Nt){var X=arguments[0],B=arguments[1],U=arguments[2],W=X.closestPoint(B);U.setMinimum(W,B)}};var zu=function(e){this._maxPtDist=new Yr,this._inputGeom=e||null},Xy={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};zu.prototype.computeMaxMidpointDistance=function(e){var t=new Xl(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};zu.prototype.computeMaxVertexDistance=function(e){var t=new Ic(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};zu.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};zu.prototype.getDistancePoints=function(){return this._maxPtDist};zu.prototype.interfaces_=function(){return[]};zu.prototype.getClass=function(){return zu};Xy.MaxPointDistanceFilter.get=function(){return Ic};Xy.MaxMidpointDistanceFilter.get=function(){return Xl};Object.defineProperties(zu,Xy);var Ic=function(e){this._maxPtDist=new Yr,this._minPtDist=new Yr,this._geom=e||null};Ic.prototype.filter=function(e){this._minPtDist.initialize(),Ca.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Ic.prototype.getMaxPointDistance=function(){return this._maxPtDist};Ic.prototype.interfaces_=function(){return[Aa]};Ic.prototype.getClass=function(){return Ic};var Xl=function(e){this._maxPtDist=new Yr,this._minPtDist=new Yr,this._geom=e||null};Xl.prototype.filter=function(e,t){if(t===0)return null;var n=e.getCoordinate(t-1),i=e.getCoordinate(t),r=new Nt((n.x+i.x)/2,(n.y+i.y)/2);this._minPtDist.initialize(),Ca.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Xl.prototype.isDone=function(){return!1};Xl.prototype.isGeometryChanged=function(){return!1};Xl.prototype.getMaxPointDistance=function(){return this._maxPtDist};Xl.prototype.interfaces_=function(){return[Ds]};Xl.prototype.getClass=function(){return Xl};var sl=function(e){this._comps=e||null};sl.prototype.filter=function(e){e instanceof Yi&&this._comps.add(e)};sl.prototype.interfaces_=function(){return[oa]};sl.prototype.getClass=function(){return sl};sl.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return sl.getPolygons(e,new pe)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof Yi?n.add(t):t instanceof to&&t.apply(new sl(n)),n}};var Er=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};Er.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof Da){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof Ii&&this._lines.add(e)};Er.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};Er.prototype.interfaces_=function(){return[ul]};Er.prototype.getClass=function(){return Er};Er.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(Er.getLines(e))}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(Er.getLines(t,n))}};Er.getLines=function(){if(arguments.length===1){var e=arguments[0];return Er.getLines(e,!1)}else if(arguments.length===2){if(He(arguments[0],Wi)&&He(arguments[1],Wi)){for(var t=arguments[0],n=arguments[1],i=t.iterator();i.hasNext();){var r=i.next();Er.getLines(r,n)}return n}else if(arguments[0]instanceof Ze&&typeof arguments[1]=="boolean"){var a=arguments[0],h=arguments[1],u=new pe;return a.apply(new Er(u,h)),u}else if(arguments[0]instanceof Ze&&He(arguments[1],Wi)){var _=arguments[0],w=arguments[1];return _ instanceof Ii?w.add(_):_.apply(new Er(w)),w}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&He(arguments[0],Wi)&&He(arguments[1],Wi)){for(var S=arguments[0],E=arguments[1],M=arguments[2],k=S.iterator();k.hasNext();){var D=k.next();Er.getLines(D,E,M)}return E}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Ze&&He(arguments[1],Wi)){var F=arguments[0],q=arguments[1],X=arguments[2];return F.apply(new Er(q,X)),q}}};var Os=function(){if(this._boundaryRule=ds.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new di("Rule must be non-null");this._boundaryRule=e}};Os.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof Nt&&arguments[1]instanceof Yi){var t=arguments[0],n=arguments[1];if(n.isEmpty())return Ot.EXTERIOR;var i=n.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===Ot.EXTERIOR)return Ot.EXTERIOR;if(r===Ot.BOUNDARY)return Ot.BOUNDARY;for(var a=0;a<n.getNumInteriorRing();a++){var h=n.getInteriorRingN(a),u=e.locateInPolygonRing(t,h);if(u===Ot.INTERIOR)return Ot.EXTERIOR;if(u===Ot.BOUNDARY)return Ot.BOUNDARY}return Ot.INTERIOR}else if(arguments[0]instanceof Nt&&arguments[1]instanceof Ii){var _=arguments[0],w=arguments[1];if(!w.getEnvelopeInternal().intersects(_))return Ot.EXTERIOR;var S=w.getCoordinates();return!w.isClosed()&&(_.equals(S[0])||_.equals(S[S.length-1]))?Ot.BOUNDARY:be.isOnLine(_,S)?Ot.INTERIOR:Ot.EXTERIOR}else if(arguments[0]instanceof Nt&&arguments[1]instanceof Do){var E=arguments[0],M=arguments[1],k=M.getCoordinate();return k.equals2D(E)?Ot.INTERIOR:Ot.EXTERIOR}};Os.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?be.locatePointInRing(e,t.getCoordinates()):Ot.EXTERIOR};Os.prototype.intersects=function(e,t){return this.locate(e,t)!==Ot.EXTERIOR};Os.prototype.updateLocationInfo=function(e){e===Ot.INTERIOR&&(this._isIn=!0),e===Ot.BOUNDARY&&this._numBoundaries++};Os.prototype.computeLocation=function(e,t){var n=this;if(t instanceof Do&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof Ii)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Yi)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof ku)for(var i=t,r=0;r<i.getNumGeometries();r++){var a=i.getGeometryN(r);n.updateLocationInfo(n.locateInternal(e,a))}else if(t instanceof Pa)for(var h=t,u=0;u<h.getNumGeometries();u++){var _=h.getGeometryN(u);n.updateLocationInfo(n.locateInternal(e,_))}else if(t instanceof to)for(var w=new ka(t);w.hasNext();){var S=w.next();S!==t&&n.computeLocation(e,S)}};Os.prototype.locate=function(e,t){return t.isEmpty()?Ot.EXTERIOR:t instanceof Ii?this.locateInternal(e,t):t instanceof Yi?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?Ot.BOUNDARY:this._numBoundaries>0||this._isIn?Ot.INTERIOR:Ot.EXTERIOR)};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};var Kr=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2];this._component=i,this._segIndex=r,this._pt=a}},Xx={INSIDE_AREA:{configurable:!0}};Kr.prototype.isInsideArea=function(){return this._segIndex===Kr.INSIDE_AREA};Kr.prototype.getCoordinate=function(){return this._pt};Kr.prototype.getGeometryComponent=function(){return this._component};Kr.prototype.getSegmentIndex=function(){return this._segIndex};Kr.prototype.interfaces_=function(){return[]};Kr.prototype.getClass=function(){return Kr};Xx.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Kr,Xx);var Gl=function(e){this._pts=e||null};Gl.prototype.filter=function(e){e instanceof Do&&this._pts.add(e)};Gl.prototype.interfaces_=function(){return[oa]};Gl.prototype.getClass=function(){return Gl};Gl.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof Do?Rs.singletonList(e):Gl.getPoints(e,new pe)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof Do?n.add(t):t instanceof to&&t.apply(new Gl(n)),n}};var Ec=function(){this._locations=null;var e=arguments[0];this._locations=e};Ec.prototype.filter=function(e){(e instanceof Do||e instanceof Ii||e instanceof Yi)&&this._locations.add(new Kr(e,0,e.getCoordinate()))};Ec.prototype.interfaces_=function(){return[oa]};Ec.prototype.getClass=function(){return Ec};Ec.getLocations=function(e){var t=new pe;return e.apply(new Ec(t)),t};var Pr=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Os,this._minDistanceLocation=null,this._minDistance=tn.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=i,this._terminateDistance=r}};Pr.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=1-n,a=sl.getPolygons(this._geom[n]);if(a.size()>0){var h=Ec.getLocations(this._geom[r]);if(this.computeContainmentDistance(h,a,i),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[r]=i[0],this._minDistanceLocation[n]=i[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&He(arguments[0],Ps)&&He(arguments[1],Ps)){for(var u=arguments[0],_=arguments[1],w=arguments[2],S=0;S<u.size();S++)for(var E=u.get(S),M=0;M<_.size();M++)if(e.computeContainmentDistance(E,_.get(M),w),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Kr&&arguments[1]instanceof Yi){var k=arguments[0],D=arguments[1],F=arguments[2],q=k.getCoordinate();if(Ot.EXTERIOR!==this._ptLocator.locate(q,D))return this._minDistance=0,F[0]=k,F[1]=new Kr(D,q),null}}};Pr.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var a=e.get(r),h=0;h<t.size();h++){var u=t.get(h);if(i.computeMinDistance(a,u,n),i._minDistance<=i._terminateDistance)return null}};Pr.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=Er.getLines(this._geom[0]),n=Er.getLines(this._geom[1]),i=Gl.getPoints(this._geom[0]),r=Gl.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,r,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,i,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(i,r,e),this.updateMinDistance(e,!1)};Pr.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Pr.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};Pr.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};Pr.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Ii&&arguments[1]instanceof Do){var t=arguments[0],n=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var r=t.getCoordinates(),a=n.getCoordinate(),h=0;h<r.length-1;h++){var u=be.distancePointLine(a,r[h],r[h+1]);if(u<e._minDistance){e._minDistance=u;var _=new ze(r[h],r[h+1]),w=_.closestPoint(a);i[0]=new Kr(t,h,w),i[1]=new Kr(n,0,a)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ii&&arguments[1]instanceof Ii){var S=arguments[0],E=arguments[1],M=arguments[2];if(S.getEnvelopeInternal().distance(E.getEnvelopeInternal())>this._minDistance)return null;for(var k=S.getCoordinates(),D=E.getCoordinates(),F=0;F<k.length-1;F++)for(var q=0;q<D.length-1;q++){var X=be.distanceLineLine(k[F],k[F+1],D[q],D[q+1]);if(X<e._minDistance){e._minDistance=X;var B=new ze(k[F],k[F+1]),U=new ze(D[q],D[q+1]),W=B.closestPoints(U);M[0]=new Kr(S,F,W[0]),M[1]=new Kr(E,q,W[1])}if(e._minDistance<=e._terminateDistance)return null}}}};Pr.prototype.computeMinDistancePoints=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var a=e.get(r),h=0;h<t.size();h++){var u=t.get(h),_=a.getCoordinate().distance(u.getCoordinate());if(_<i._minDistance&&(i._minDistance=_,n[0]=new Kr(a,0,a.getCoordinate()),n[1]=new Kr(u,0,u.getCoordinate())),i._minDistance<=i._terminateDistance)return null}};Pr.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new di("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Pr.prototype.computeMinDistanceLines=function(e,t,n){for(var i=this,r=0;r<e.size();r++)for(var a=e.get(r),h=0;h<t.size();h++){var u=t.get(h);if(i.computeMinDistance(a,u,n),i._minDistance<=i._terminateDistance)return null}};Pr.prototype.interfaces_=function(){return[]};Pr.prototype.getClass=function(){return Pr};Pr.distance=function(e,t){var n=new Pr(e,t);return n.distance()};Pr.isWithinDistance=function(e,t,n){var i=new Pr(e,t,n);return i.distance()<=n};Pr.nearestPoints=function(e,t){var n=new Pr(e,t);return n.nearestPoints()};var zr=function(){this._pt=[new Nt,new Nt],this._distance=tn.NaN,this._isNull=!0};zr.prototype.getCoordinates=function(){return this._pt};zr.prototype.getCoordinate=function(e){return this._pt[e]};zr.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i<this._distance&&this.initialize(t,n,i)}};zr.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],i=arguments[1],r=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(i),this._distance=r,this._isNull=!1}};zr.prototype.toString=function(){return As.toLineString(this._pt[0],this._pt[1])};zr.prototype.getDistance=function(){return this._distance};zr.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var i=t.distance(n);i>this._distance&&this.initialize(t,n,i)}};zr.prototype.interfaces_=function(){return[]};zr.prototype.getClass=function(){return zr};var Ks=function(){};Ks.prototype.interfaces_=function(){return[]};Ks.prototype.getClass=function(){return Ks};Ks.computeDistance=function(){if(arguments[2]instanceof zr&&arguments[0]instanceof Ii&&arguments[1]instanceof Nt)for(var e=arguments[0],t=arguments[1],n=arguments[2],i=new ze,r=e.getCoordinates(),a=0;a<r.length-1;a++){i.setCoordinates(r[a],r[a+1]);var h=i.closestPoint(t);n.setMinimum(h,t)}else if(arguments[2]instanceof zr&&arguments[0]instanceof Yi&&arguments[1]instanceof Nt){var u=arguments[0],_=arguments[1],w=arguments[2];Ks.computeDistance(u.getExteriorRing(),_,w);for(var S=0;S<u.getNumInteriorRing();S++)Ks.computeDistance(u.getInteriorRingN(S),_,w)}else if(arguments[2]instanceof zr&&arguments[0]instanceof Ze&&arguments[1]instanceof Nt){var E=arguments[0],M=arguments[1],k=arguments[2];if(E instanceof Ii)Ks.computeDistance(E,M,k);else if(E instanceof Yi)Ks.computeDistance(E,M,k);else if(E instanceof to)for(var D=E,F=0;F<D.getNumGeometries();F++){var q=D.getGeometryN(F);Ks.computeDistance(q,M,k)}else k.setMinimum(E.getCoordinate(),M)}else if(arguments[2]instanceof zr&&arguments[0]instanceof ze&&arguments[1]instanceof Nt){var X=arguments[0],B=arguments[1],U=arguments[2],W=X.closestPoint(B);U.setMinimum(W,B)}};var fs=function(){this._g0=null,this._g1=null,this._ptDist=new zr,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},Yy={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};fs.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};fs.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new di("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};fs.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};fs.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};fs.prototype.computeOrientedDistance=function(e,t,n){var i=new Cc(t);if(e.apply(i),n.setMaximum(i.getMaxPointDistance()),this._densifyFrac>0){var r=new Yl(t,this._densifyFrac);e.apply(r),n.setMaximum(r.getMaxPointDistance())}};fs.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};fs.prototype.interfaces_=function(){return[]};fs.prototype.getClass=function(){return fs};fs.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new fs(e,t);return n.distance()}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2],h=new fs(i,r);return h.setDensifyFraction(a),h.distance()}};Yy.MaxPointDistanceFilter.get=function(){return Cc};Yy.MaxDensifiedByFractionDistanceFilter.get=function(){return Yl};Object.defineProperties(fs,Yy);var Cc=function(){this._maxPtDist=new zr,this._minPtDist=new zr,this._euclideanDist=new Ks,this._geom=null;var e=arguments[0];this._geom=e};Cc.prototype.filter=function(e){this._minPtDist.initialize(),Ks.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Cc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Cc.prototype.interfaces_=function(){return[Aa]};Cc.prototype.getClass=function(){return Cc};var Yl=function(){this._maxPtDist=new zr,this._minPtDist=new zr,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};Yl.prototype.filter=function(e,t){var n=this;if(t===0)return null;for(var i=e.getCoordinate(t-1),r=e.getCoordinate(t),a=(r.x-i.x)/this._numSubSegs,h=(r.y-i.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var _=i.x+u*a,w=i.y+u*h,S=new Nt(_,w);n._minPtDist.initialize(),Ks.computeDistance(n._geom,S,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Yl.prototype.isDone=function(){return!1};Yl.prototype.isGeometryChanged=function(){return!1};Yl.prototype.getMaxPointDistance=function(){return this._maxPtDist};Yl.prototype.interfaces_=function(){return[Ds]};Yl.prototype.getClass=function(){return Yl};var Ao=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},Ky={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Ao.prototype.checkMaximumDistance=function(e,t,n){var i=new fs(t,e);if(i.setDensifyFraction(.25),this._maxDistanceFound=i.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var r=i.getCoordinates();this._errorLocation=r[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+As.toLineString(r[0],r[1])+")"}};Ao.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=Ao.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Ao.VERBOSE&&Lr.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Ao.prototype.checkNegativeValid=function(){if(!(this._input instanceof Yi||this._input instanceof Pa||this._input instanceof to))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};Ao.prototype.getErrorIndicator=function(){return this._errorIndicator};Ao.prototype.checkMinimumDistance=function(e,t,n){var i=new Pr(e,t,n);if(this._minDistanceFound=i.distance(),this._minDistanceFound<n){this._isValid=!1;var r=i.nearestPoints();this._errorLocation=i.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(r),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+As.toLineString(r[0],r[1])+" )"}};Ao.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};Ao.prototype.getErrorLocation=function(){return this._errorLocation};Ao.prototype.getPolygonLines=function(e){for(var t=new pe,n=new Er(t),i=sl.getPolygons(e),r=i.iterator();r.hasNext();){var a=r.next();a.apply(n)}return e.getFactory().buildGeometry(t)};Ao.prototype.getErrorMessage=function(){return this._errMsg};Ao.prototype.interfaces_=function(){return[]};Ao.prototype.getClass=function(){return Ao};Ky.VERBOSE.get=function(){return!1};Ky.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Ao,Ky);var kr=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},Jy={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};kr.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};kr.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*kr.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new Re(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new Re(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};kr.prototype.checkDistance=function(){var e=new Ao(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};kr.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};kr.prototype.checkPolygonal=function(){this._result instanceof Yi||this._result instanceof Pa||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};kr.prototype.getErrorIndicator=function(){return this._errorIndicator};kr.prototype.getErrorLocation=function(){return this._errorLocation};kr.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};kr.prototype.report=function(e){if(!kr.VERBOSE)return null;Lr.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};kr.prototype.getErrorMessage=function(){return this._errorMsg};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};kr.isValidMsg=function(e,t,n){var i=new kr(e,t,n);return i.isValid()?null:i.getErrorMessage()};kr.isValid=function(e,t,n){var i=new kr(e,t,n);return!!i.isValid()};Jy.VERBOSE.get=function(){return!1};Jy.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(kr,Jy);var ha=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};ha.prototype.getCoordinates=function(){return this._pts};ha.prototype.size=function(){return this._pts.length};ha.prototype.getCoordinate=function(e){return this._pts[e]};ha.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};ha.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:xc.octant(this.getCoordinate(e),this.getCoordinate(e+1))};ha.prototype.setData=function(e){this._data=e};ha.prototype.getData=function(){return this._data};ha.prototype.toString=function(){return As.toLineString(new ki(this._pts))};ha.prototype.interfaces_=function(){return[Ra]};ha.prototype.getClass=function(){return ha};var br=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new pe,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};br.prototype.getInteriorIntersection=function(){return this._interiorIntersection};br.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};br.prototype.getIntersectionSegments=function(){return this._intSegments};br.prototype.count=function(){return this._intersectionCount};br.prototype.getIntersections=function(){return this._intersections};br.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};br.prototype.setKeepIntersections=function(e){this._keepIntersections=e};br.prototype.processIntersections=function(e,t,n,i){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&t===i)return null;if(this._isCheckEndSegmentsOnly){var r=this.isEndSegment(e,t)||this.isEndSegment(n,i);if(!r)return null}var a=e.getCoordinates()[t],h=e.getCoordinates()[t+1],u=n.getCoordinates()[i],_=n.getCoordinates()[i+1];this._li.computeIntersection(a,h,u,_),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=a,this._intSegments[1]=h,this._intSegments[2]=u,this._intSegments[3]=_,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};br.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};br.prototype.hasIntersection=function(){return this._interiorIntersection!==null};br.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};br.prototype.interfaces_=function(){return[Nu]};br.prototype.getClass=function(){return br};br.createAllIntersectionsFinder=function(e){var t=new br(e);return t.setFindAllIntersections(!0),t};br.createAnyIntersectionFinder=function(e){return new br(e)};br.createIntersectionCounter=function(e){var t=new br(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var Fs=function(){this._li=new Vu,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};Fs.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};Fs.prototype.getIntersections=function(){return this._segInt.getIntersections()};Fs.prototype.isValid=function(){return this.execute(),this._isValid};Fs.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Fs.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new br(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new $y;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};Fs.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new cl(this.getErrorMessage(),this._segInt.getInteriorIntersection())};Fs.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+As.toLineString(e[0],e[1])+" and "+As.toLineString(e[2],e[3])};Fs.prototype.interfaces_=function(){return[]};Fs.prototype.getClass=function(){return Fs};Fs.computeIntersections=function(e){var t=new Fs(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var Ou=function e(){this._nv=null;var t=arguments[0];this._nv=new Fs(e.toSegmentStrings(t))};Ou.prototype.checkValid=function(){this._nv.checkValid()};Ou.prototype.interfaces_=function(){return[]};Ou.prototype.getClass=function(){return Ou};Ou.toSegmentStrings=function(e){for(var t=new pe,n=e.iterator();n.hasNext();){var i=n.next();t.add(new ha(i.getCoordinates(),i))}return t};Ou.checkValid=function(e){var t=new Ou(e);t.checkValid()};var Tc=function(e){this._mapOp=e};Tc.prototype.map=function(e){for(var t=this,n=new pe,i=0;i<e.getNumGeometries();i++){var r=t._mapOp.map(e.getGeometryN(i));r.isEmpty()||n.add(r)}return e.getFactory().createGeometryCollection(gn.toGeometryArray(n))};Tc.prototype.interfaces_=function(){return[]};Tc.prototype.getClass=function(){return Tc};Tc.map=function(e,t){var n=new Tc(t);return n.map(e)};var fa=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new pe,this._resultLineList=new pe;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};fa.prototype.collectLines=function(e){for(var t=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next();t.collectLineEdge(i,e,t._lineEdgesList),t.collectBoundaryTouchEdge(i,e,t._lineEdgesList)}};fa.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)};fa.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};fa.prototype.collectLineEdge=function(e,t,n){var i=e.getLabel(),r=e.getEdge();e.isLineEdge()&&!e.isVisited()&&sn.isResultOfOp(i,t)&&!r.isCovered()&&(n.add(r),e.setVisitedEdge(!0))};fa.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().findCoveredLineEdges()}for(var i=this._op.getGraph().getEdgeEnds().iterator();i.hasNext();){var r=i.next(),a=r.getEdge();if(r.isLineEdge()&&!a.isCoveredSet()){var h=e._op.isCoveredByA(r.getCoordinate());a.setCovered(h)}}};fa.prototype.labelIsolatedLines=function(e){for(var t=this,n=e.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();i.isIsolated()&&(r.isNull(0)?t.labelIsolatedLine(i,0):t.labelIsolatedLine(i,1))}};fa.prototype.buildLines=function(e){for(var t=this,n=this._lineEdgesList.iterator();n.hasNext();){var i=n.next(),r=t._geometryFactory.createLineString(i.getCoordinates());t._resultLineList.add(r),i.setInResult(!0)}};fa.prototype.collectBoundaryTouchEdge=function(e,t,n){var i=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;un.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),sn.isResultOfOp(i,t)&&t===sn.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};fa.prototype.interfaces_=function(){return[]};fa.prototype.getClass=function(){return fa};var Lc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new pe;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};Lc.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}};Lc.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isInResult()&&!i.isIncidentEdgeInResult()&&(i.getEdges().getDegree()===0||e===sn.INTERSECTION)){var r=i.getLabel();sn.isResultOfOp(r,e)&&t.filterCoveredNodeToPoint(i)}}};Lc.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};Lc.prototype.interfaces_=function(){return[]};Lc.prototype.getClass=function(){return Lc};var xo=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};xo.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};xo.prototype.transformPolygon=function(e,t){var n=this,i=!0,r=this.transformLinearRing(e.getExteriorRing(),e);(r===null||!(r instanceof Da)||r.isEmpty())&&(i=!1);for(var a=new pe,h=0;h<e.getNumInteriorRing();h++){var u=n.transformLinearRing(e.getInteriorRingN(h),e);u===null||u.isEmpty()||(u instanceof Da||(i=!1),a.add(u))}if(i)return this._factory.createPolygon(r,a.toArray([]));var _=new pe;return r!==null&&_.add(r),_.addAll(a),this._factory.buildGeometry(_)};xo.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};xo.prototype.getInputGeometry=function(){return this._inputGeom};xo.prototype.transformMultiLineString=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var a=n.transformLineString(e.getGeometryN(r),e);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};xo.prototype.transformCoordinates=function(e,t){return this.copy(e)};xo.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};xo.prototype.transformMultiPoint=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var a=n.transformPoint(e.getGeometryN(r),e);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};xo.prototype.transformMultiPolygon=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var a=n.transformPolygon(e.getGeometryN(r),e);a!==null&&(a.isEmpty()||i.add(a))}return this._factory.buildGeometry(i)};xo.prototype.copy=function(e){return e.copy()};xo.prototype.transformGeometryCollection=function(e,t){for(var n=this,i=new pe,r=0;r<e.getNumGeometries();r++){var a=n.transform(e.getGeometryN(r));a!==null&&(n._pruneEmptyGeometry&&a.isEmpty()||i.add(a))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(gn.toGeometryArray(i)):this._factory.buildGeometry(i)};xo.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof Do)return this.transformPoint(e,null);if(e instanceof Yh)return this.transformMultiPoint(e,null);if(e instanceof Da)return this.transformLinearRing(e,null);if(e instanceof Ii)return this.transformLineString(e,null);if(e instanceof ku)return this.transformMultiLineString(e,null);if(e instanceof Yi)return this.transformPolygon(e,null);if(e instanceof Pa)return this.transformMultiPolygon(e,null);if(e instanceof to)return this.transformGeometryCollection(e,null);throw new di("Unknown Geometry subtype: "+e.getClass().getName())};xo.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};xo.prototype.interfaces_=function(){return[]};xo.prototype.getClass=function(){return xo};var Fa=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new ze,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Ii&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var i=arguments[0],r=arguments[1];this._srcPts=i,this._isClosed=e.isClosed(i),this._snapTolerance=r}};Fa.prototype.snapVertices=function(e,t){for(var n=this,i=this._isClosed?e.size()-1:e.size(),r=0;r<i;r++){var a=e.get(r),h=n.findSnapForVertex(a,t);h!==null&&(e.set(r,new Nt(h)),r===0&&n._isClosed&&e.set(e.size()-1,new Nt(h)))}};Fa.prototype.findSnapForVertex=function(e,t){for(var n=this,i=0;i<t.length;i++){if(e.equals2D(t[i]))return null;if(e.distance(t[i])<n._snapTolerance)return t[i]}return null};Fa.prototype.snapTo=function(e){var t=new gd(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var n=t.toCoordinateArray();return n};Fa.prototype.snapSegments=function(e,t){var n=this;if(t.length===0)return null;var i=t.length;t[0].equals2D(t[t.length-1])&&(i=t.length-1);for(var r=0;r<i;r++){var a=t[r],h=n.findSegmentIndexToSnap(a,e);h>=0&&e.add(h+1,new Nt(a),!1)}};Fa.prototype.findSegmentIndexToSnap=function(e,t){for(var n=this,i=tn.MAX_VALUE,r=-1,a=0;a<t.size()-1;a++){if(n._seg.p0=t.get(a),n._seg.p1=t.get(a+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var h=n._seg.distance(e);h<n._snapTolerance&&h<i&&(i=h,r=a)}return r};Fa.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};Fa.prototype.interfaces_=function(){return[]};Fa.prototype.getClass=function(){return Fa};Fa.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var Ai=function(e){this._srcGeom=e||null},Yx={SNAP_PRECISION_FACTOR:{configurable:!0}};Ai.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e),i=new Kx(t,n);return i.transform(this._srcGeom)};Ai.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),i=new Kx(e,n,!0),r=i.transform(this._srcGeom),a=r;return t&&He(a,ql)&&(a=r.buffer(0)),a};Ai.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),n=t/10;return n};Ai.prototype.extractTargetCoordinates=function(e){for(var t=new ra,n=e.getCoordinates(),i=0;i<n.length;i++)t.add(n[i]);return t.toArray(new Array(0).fill(null))};Ai.prototype.computeMinimumSegmentLength=function(e){for(var t=tn.MAX_VALUE,n=0;n<e.length-1;n++){var i=e[n].distance(e[n+1]);i<t&&(t=i)}return t};Ai.prototype.interfaces_=function(){return[]};Ai.prototype.getClass=function(){return Ai};Ai.snap=function(e,t,n){var i=new Array(2).fill(null),r=new Ai(e);i[0]=r.snapTo(t,n);var a=new Ai(t);return i[1]=a.snapTo(i[0],n),i};Ai.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=Ai.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===Nn.FIXED){var i=1/n.getScale()*2/1.415;i>t&&(t=i)}return t}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return Math.min(Ai.computeOverlaySnapTolerance(r),Ai.computeOverlaySnapTolerance(a))}};Ai.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),n=Math.min(t.getHeight(),t.getWidth()),i=n*Ai.SNAP_PRECISION_FACTOR;return i};Ai.snapToSelf=function(e,t,n){var i=new Ai(e);return i.snapToSelf(t,n)};Yx.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Ai,Yx);var Kx=function(e){function t(n,i,r){e.call(this),this._snapTolerance=n||null,this._snapPts=i||null,this._isSelfSnap=r!==void 0?r:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,i){var r=new Fa(n,this._snapTolerance);return r.setAllowSnappingToSourceVertices(this._isSelfSnap),r.snapTo(i)},t.prototype.transformCoordinates=function(n,i){var r=n.toCoordinateArray(),a=this.snapLine(r,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xo),Xr=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Xr.prototype.getCommon=function(){return tn.longBitsToDouble(this._commonBits)};Xr.prototype.add=function(e){var t=tn.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=Xr.signExpBits(this._commonBits),this._isFirst=!1,null;var n=Xr.signExpBits(t);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=Xr.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=Xr.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};Xr.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=tn.longBitsToDouble(e),n=tn.toBinaryString(e),i="0000000000000000000000000000000000000000000000000000000000000000"+n,r=i.substring(i.length-64),a=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]";return a}};Xr.prototype.interfaces_=function(){return[]};Xr.prototype.getClass=function(){return Xr};Xr.getBit=function(e,t){var n=1<<t;return e&n?1:0};Xr.signExpBits=function(e){return e>>52};Xr.zeroLowerBits=function(e,t){var n=(1<<t)-1,i=~n,r=e&i;return r};Xr.numCommonMostSigMantissaBits=function(e,t){for(var n=0,i=52;i>=0;i--){if(Xr.getBit(e,i)!==Xr.getBit(t,i))return n;n++}return 52};var Kl=function(){this._commonCoord=null,this._ccFilter=new Mc},Qy={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Kl.prototype.addCommonBits=function(e){var t=new Jl(this._commonCoord);e.apply(t),e.geometryChanged()};Kl.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new Nt(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new Jl(t);return e.apply(n),e.geometryChanged(),e};Kl.prototype.getCommonCoordinate=function(){return this._commonCoord};Kl.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Kl.prototype.interfaces_=function(){return[]};Kl.prototype.getClass=function(){return Kl};Qy.CommonCoordinateFilter.get=function(){return Mc};Qy.Translater.get=function(){return Jl};Object.defineProperties(Kl,Qy);var Mc=function(){this._commonBitsX=new Xr,this._commonBitsY=new Xr};Mc.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};Mc.prototype.getCommonCoordinate=function(){return new Nt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Mc.prototype.interfaces_=function(){return[Aa]};Mc.prototype.getClass=function(){return Mc};var Jl=function(){this.trans=null;var e=arguments[0];this.trans=e};Jl.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,i=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,i)};Jl.prototype.isDone=function(){return!1};Jl.prototype.isGeometryChanged=function(){return!0};Jl.prototype.interfaces_=function(){return[Ds]};Jl.prototype.getClass=function(){return Jl};var xr=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};xr.prototype.selfSnap=function(e){var t=new Ai(e),n=t.snapTo(e,this._snapTolerance);return n};xr.prototype.removeCommonBits=function(e){this._cbr=new Kl,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};xr.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};xr.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=sn.overlayOp(t[0],t[1],e);return this.prepareResult(n)};xr.prototype.checkValid=function(e){e.isValid()||Lr.out.println("Snapped geometry is invalid")};xr.prototype.computeSnapTolerance=function(){this._snapTolerance=Ai.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};xr.prototype.snap=function(e){var t=this.removeCommonBits(e),n=Ai.snap(t[0],t[1],this._snapTolerance);return n};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};xr.overlayOp=function(e,t,n){var i=new xr(e,t);return i.getResultGeometry(n)};xr.union=function(e,t){return xr.overlayOp(e,t,sn.UNION)};xr.intersection=function(e,t){return xr.overlayOp(e,t,sn.INTERSECTION)};xr.symDifference=function(e,t){return xr.overlayOp(e,t,sn.SYMDIFFERENCE)};xr.difference=function(e,t){return xr.overlayOp(e,t,sn.DIFFERENCE)};var io=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};io.prototype.getResultGeometry=function(e){var t=null,n=!1,i=null;try{t=sn.overlayOp(this._geom[0],this._geom[1],e);var r=!0;r&&(n=!0)}catch(a){if(a instanceof ll)i=a;else throw a}finally{}if(!n)try{t=xr.overlayOp(this._geom[0],this._geom[1],e)}catch(a){throw a instanceof ll?i:a}finally{}return t};io.prototype.interfaces_=function(){return[]};io.prototype.getClass=function(){return io};io.overlayOp=function(e,t,n){var i=new io(e,t);return i.getResultGeometry(n)};io.union=function(e,t){return io.overlayOp(e,t,sn.UNION)};io.intersection=function(e,t){return io.overlayOp(e,t,sn.INTERSECTION)};io.symDifference=function(e,t){return io.overlayOp(e,t,sn.SYMDIFFERENCE)};io.difference=function(e,t){return io.overlayOp(e,t,sn.DIFFERENCE)};var ld=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};ld.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};ld.prototype.interfaces_=function(){return[]};ld.prototype.getClass=function(){return ld};var zo=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2];this._eventType=e.INSERT,this._label=i,this._xValue=r,this._obj=a}},t0={INSERT:{configurable:!0},DELETE:{configurable:!0}};zo.prototype.isDelete=function(){return this._eventType===zo.DELETE};zo.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};zo.prototype.getObject=function(){return this._obj};zo.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};zo.prototype.getInsertEvent=function(){return this._insertEvent};zo.prototype.isInsert=function(){return this._eventType===zo.INSERT};zo.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};zo.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};zo.prototype.interfaces_=function(){return[_s]};zo.prototype.getClass=function(){return zo};t0.INSERT.get=function(){return 1};t0.DELETE.get=function(){return 2};Object.defineProperties(zo,t0);var sg=function(){};sg.prototype.interfaces_=function(){return[]};sg.prototype.getClass=function(){return sg};var Ar=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};Ar.prototype.isTrivialIntersection=function(e,t,n,i){if(e===n&&this._li.getIntersectionNum()===1){if(Ar.isAdjacentSegments(t,i))return!0;if(e.isClosed()){var r=e.getNumPoints()-1;if(t===0&&i===r||i===0&&t===r)return!0}}return!1};Ar.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ar.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};Ar.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ar.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinate();if(e.isIntersection(r))return!0}return!1};Ar.prototype.hasProperIntersection=function(){return this._hasProper};Ar.prototype.hasIntersection=function(){return this._hasIntersection};Ar.prototype.isDone=function(){return this._isDone};Ar.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};Ar.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};Ar.prototype.addIntersections=function(e,t,n,i){if(e===n&&t===i)return null;this.numTests++;var r=e.getCoordinates()[t],a=e.getCoordinates()[t+1],h=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this._li.computeIntersection(r,a,h,u),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,i)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),n.addIntersections(this._li,i,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};Ar.prototype.interfaces_=function(){return[]};Ar.prototype.getClass=function(){return Ar};Ar.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var DE=function(e){function t(){e.call(this),this.events=new pe,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;Rs.sort(this.events);for(var i=0;i<this.events.size();i++){var r=n.events.get(i);r.isDelete()&&r.getInsertEvent().setDeleteEventIndex(i)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var i=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var r=0;r<this.events.size();r++){var a=n.events.get(r);if(a.isInsert()&&n.processOverlaps(r,a.getDeleteEventIndex(),a,i),i.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof Ar&&He(arguments[0],Ps)&&He(arguments[1],Ps)){var h=arguments[0],u=arguments[1],_=arguments[2];this.addEdges(h,h),this.addEdges(u,u),this.computeIntersections(_)}else if(typeof arguments[2]=="boolean"&&He(arguments[0],Ps)&&arguments[1]instanceof Ar){var w=arguments[0],S=arguments[1],E=arguments[2];E?this.addEdges(w,null):this.addEdges(w),this.computeIntersections(S)}}},t.prototype.addEdge=function(n,i){for(var r=this,a=n.getMonotoneChainEdge(),h=a.getStartIndexes(),u=0;u<h.length-1;u++){var _=new ld(a,u),w=new zo(i,a.getMinX(u),_);r.events.add(w),r.events.add(new zo(a.getMaxX(u),w))}},t.prototype.processOverlaps=function(n,i,r,a){for(var h=this,u=r.getObject(),_=n;_<i;_++){var w=h.events.get(_);if(w.isInsert()){var S=w.getObject();r.isSameLabel(w)||(u.computeIntersections(S,a),h.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var i=arguments[0],r=i.iterator();r.hasNext();){var a=r.next();n.addEdge(a,a)}else if(arguments.length===2)for(var h=arguments[0],u=arguments[1],_=h.iterator();_.hasNext();){var w=_.next();n.addEdge(w,u)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(sg),Ba=function(){this._min=tn.POSITIVE_INFINITY,this._max=tn.NEGATIVE_INFINITY},Jx={NodeComparator:{configurable:!0}};Ba.prototype.getMin=function(){return this._min};Ba.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};Ba.prototype.getMax=function(){return this._max};Ba.prototype.toString=function(){return As.toLineString(new Nt(this._min,0),new Nt(this._max,0))};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};Jx.NodeComparator.get=function(){return ud};Object.defineProperties(Ba,Jx);var ud=function(){};ud.prototype.compare=function(e,t){var n=e,i=t,r=(n._min+n._max)/2,a=(i._min+i._max)/2;return r<a?-1:r>a?1:0};ud.prototype.interfaces_=function(){return[jh]};ud.prototype.getClass=function(){return ud};var NE=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],i=arguments[1],r=arguments[2];this._min=n,this._max=i,this._item=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,i,r){if(!this.intersects(n,i))return null;r.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ba),RE=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],i=arguments[1];this._node1=n,this._node2=i,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,i){this._min=Math.min(n._min,i._min),this._max=Math.max(n._max,i._max)},t.prototype.query=function(n,i,r){if(!this.intersects(n,i))return null;this._node1!==null&&this._node1.query(n,i,r),this._node2!==null&&this._node2.query(n,i,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ba),Va=function(){this._leaves=new pe,this._root=null,this._level=0};Va.prototype.buildTree=function(){var e=this;Rs.sort(this._leaves,new Ba.NodeComparator);for(var t=this._leaves,n=null,i=new pe;;){if(e.buildLevel(t,i),i.size()===1)return i.get(0);n=t,t=i,i=n}};Va.prototype.insert=function(e,t,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new NE(e,t,n))};Va.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)};Va.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};Va.prototype.printNode=function(e){Lr.out.println(As.toLineString(new Nt(e._min,this._level),new Nt(e._max,this._level)))};Va.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};Va.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var i=e.get(n),r=n+1<e.size()?e.get(n):null;if(r===null)t.add(i);else{var a=new RE(e.get(n),e.get(n+1));t.add(a)}}};Va.prototype.interfaces_=function(){return[]};Va.prototype.getClass=function(){return Va};var nf=function(){this._items=new pe};nf.prototype.visitItem=function(e){this._items.add(e)};nf.prototype.getItems=function(){return this._items};nf.prototype.interfaces_=function(){return[Zl]};nf.prototype.getClass=function(){return nf};var rf=function(){this._index=null;var e=arguments[0];if(!He(e,ql))throw new di("Argument must be Polygonal");this._index=new Fu(e)},e0={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};rf.prototype.locate=function(e){var t=new ta(e),n=new of(t);return this._index.query(e.y,e.y,n),t.getLocation()};rf.prototype.interfaces_=function(){return[tf]};rf.prototype.getClass=function(){return rf};e0.SegmentVisitor.get=function(){return of};e0.IntervalIndexedGeometry.get=function(){return Fu};Object.defineProperties(rf,e0);var of=function(){this._counter=null;var e=arguments[0];this._counter=e};of.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};of.prototype.interfaces_=function(){return[Zl]};of.prototype.getClass=function(){return of};var Fu=function(){this._index=new Va;var e=arguments[0];this.init(e)};Fu.prototype.init=function(e){for(var t=this,n=Er.getLines(e),i=n.iterator();i.hasNext();){var r=i.next(),a=r.getCoordinates();t.addLine(a)}};Fu.prototype.addLine=function(e){for(var t=this,n=1;n<e.length;n++){var i=new ze(e[n-1],e[n]),r=Math.min(i.p0.y,i.p1.y),a=Math.max(i.p0.y,i.p1.y);t._index.insert(r,a,i)}};Fu.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new nf;return this._index.query(e,t,n),n.getItems()}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2];this._index.query(i,r,a)}};Fu.prototype.interfaces_=function(){return[]};Fu.prototype.getClass=function(){return Fu};var Ep=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new Rx,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Os,arguments.length===2){var n=arguments[0],i=arguments[1],r=ds.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=i,this._boundaryNodeRule=r,i!==null&&this.add(i)}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2];this._argIndex=a,this._parentGeom=h,this._boundaryNodeRule=u,h!==null&&this.add(h)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,i){var r=this._nodes.addNode(i),a=r.getLabel(),h=1,u=Ot.NONE;u=a.getLocation(n,le.ON),u===Ot.BOUNDARY&&h++;var _=t.determineBoundary(this._boundaryNodeRule,h);a.setLocation(n,_)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],i=arguments[1];return this.computeSelfNodes(n,i,!1)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],h=arguments[2],u=new Ar(r,!0,!1);u.setIsDoneIfProperInt(h);var _=this.createEdgeSetIntersector(),w=this._parentGeom instanceof Da||this._parentGeom instanceof Yi||this._parentGeom instanceof Pa,S=a||!w;return _.computeIntersections(this._edges,u,S),this.addSelfIntersectionNodes(this._argIndex),u}},t.prototype.computeSplitEdges=function(n){for(var i=this._edges.iterator();i.hasNext();){var r=i.next();r.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,i,r){var a=new Ar(i,r,!0);a.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var h=this.createEdgeSetIntersector();return h.computeIntersections(this._edges,n._edges,a),a},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof Do){var n=arguments[0],i=n.getCoordinate();this.insertPoint(this._argIndex,i,Ot.INTERIOR)}else if(arguments[0]instanceof Nt){var r=arguments[0];this.insertPoint(this._argIndex,r,Ot.INTERIOR)}},t.prototype.addPolygon=function(n){var i=this;this.addPolygonRing(n.getExteriorRing(),Ot.EXTERIOR,Ot.INTERIOR);for(var r=0;r<n.getNumInteriorRing();r++){var a=n.getInteriorRingN(r);i.addPolygonRing(a,Ot.INTERIOR,Ot.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var i=n.getCoordinates();this.insertPoint(this._argIndex,i[0],Ot.BOUNDARY),this.insertPoint(this._argIndex,i[i.length-1],Ot.BOUNDARY)},t.prototype.addLineString=function(n){var i=_n.removeRepeatedPoints(n.getCoordinates());if(i.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=i[0],null;var r=new og(i,new Fn(this._argIndex,Ot.INTERIOR));this._lineEdgeMap.put(n,r),this.insertEdge(r),un.isTrue(i.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,i[0]),this.insertBoundaryPoint(this._argIndex,i[i.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),i=new Array(n.size()).fill(null),r=0,a=n.iterator();a.hasNext();){var h=a.next();i[r++]=h.getCoordinate().copy()}return i},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,i,r){if(this.isBoundaryNode(n,i))return null;r===Ot.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,i):this.insertPoint(n,i,r)},t.prototype.addPolygonRing=function(n,i,r){if(n.isEmpty())return null;var a=_n.removeRepeatedPoints(n.getCoordinates());if(a.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=a[0],null;var h=i,u=r;be.isCCW(a)&&(h=r,u=i);var _=new og(a,new Fn(this._argIndex,Ot.BOUNDARY,h,u));this._lineEdgeMap.put(n,_),this.insertEdge(_),this.insertPoint(this._argIndex,a[0],Ot.BOUNDARY)},t.prototype.insertPoint=function(n,i,r){var a=this._nodes.addNode(i),h=a.getLabel();h===null?a._label=new Fn(n,r):h.setLocation(n,r)},t.prototype.createEdgeSetIntersector=function(){return new DE},t.prototype.addSelfIntersectionNodes=function(n){for(var i=this,r=this._edges.iterator();r.hasNext();)for(var a=r.next(),h=a.getLabel().getLocation(n),u=a.eiList.iterator();u.hasNext();){var _=u.next();i.addSelfIntersectionNode(n,_.coord,h)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Pa&&(this._useBoundaryDeterminationRule=!1),n instanceof Yi)this.addPolygon(n);else if(n instanceof Ii)this.addLineString(n);else if(n instanceof Do)this.addPoint(n);else if(n instanceof Yh)this.addCollection(n);else if(n instanceof ku)this.addCollection(n);else if(n instanceof Pa)this.addCollection(n);else if(n instanceof to)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var i=this,r=0;r<n.getNumGeometries();r++){var a=n.getGeometryN(r);i.add(a)}},t.prototype.locate=function(n){return He(this._parentGeom,ql)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new rf(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,i){return n.isInBoundary(i)?Ot.BOUNDARY:Ot.INTERIOR},t}(bi),sf=function(){if(this._li=new Vu,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ep(0,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],i=ds.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ep(0,t,i),this._arg[1]=new Ep(1,n,i)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],h=arguments[2];r.getPrecisionModel().compareTo(a.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(a.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ep(0,r,h),this._arg[1]=new Ep(1,a,h)}};sf.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};sf.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};sf.prototype.interfaces_=function(){return[]};sf.prototype.getClass=function(){return sf};var Lu=function(){};Lu.prototype.interfaces_=function(){return[]};Lu.prototype.getClass=function(){return Lu};Lu.map=function(){if(arguments[0]instanceof Ze&&He(arguments[1],Lu.MapOp)){for(var e=arguments[0],t=arguments[1],n=new pe,i=0;i<e.getNumGeometries();i++){var r=t.map(e.getGeometryN(i));r!==null&&n.add(r)}return e.getFactory().buildGeometry(n)}else if(He(arguments[0],Wi)&&He(arguments[1],Lu.MapOp)){for(var a=arguments[0],h=arguments[1],u=new pe,_=a.iterator();_.hasNext();){var w=_.next(),S=h.map(w);S!==null&&u.add(S)}return u}};Lu.MapOp=function(){};var sn=function(e){function t(){var n=arguments[0],i=arguments[1];e.call(this,n,i),this._ptLocator=new Os,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new zs,this._resultPolyList=new pe,this._resultLineList=new pe,this._resultPointList=new pe,this._graph=new bi(new jx),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var i=this._edgeList.findEqualEdge(n);if(i!==null){var r=i.getLabel(),a=n.getLabel();i.isPointwiseEqual(n)||(a=new Fn(n.getLabel()),a.flip());var h=i.getDepth();h.isNull()&&h.add(r),h.add(a),r.merge(a)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getSym();i.isInResult()&&r.isInResult()&&(i.setInResult(!1),r.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,i,r,a){var h=new pe;return h.addAll(n),h.addAll(i),h.addAll(r),h.isEmpty()?t.createEmptyResult(a,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(h)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next();i.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,i){for(var r=this,a=i.iterator();a.hasNext();){var h=a.next(),u=r._ptLocator.locate(n,h);if(u!==Ot.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new pe,i=this._edgeList.iterator();i.hasNext();){var r=i.next();r.isCollapsed()&&(i.remove(),n.add(r.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var i=n.next(),r=i.getEdges().getLabel();i.getLabel().merge(r)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var i=this,r=n.iterator();r.hasNext();){var a=r.next();i.insertUniqueEdge(a)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var i=new pe;this._arg[0].computeSplitEdges(i),this._arg[1].computeSplitEdges(i),this.insertUniqueEdges(i),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Ou.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var r=new No(this._geomFact);r.add(this._graph),this._resultPolyList=r.getPolygons();var a=new fa(this,this._geomFact,this._ptLocator);this._resultLineList=a.build(n);var h=new Lc(this,this._geomFact,this._ptLocator);this._resultPointList=h.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,i){var r=this._ptLocator.locate(n.getCoordinate(),this._arg[i].getGeometry());n.getLabel().setLocation(i,r)},t.prototype.copyPoints=function(n){for(var i=this,r=this._arg[n].getNodeIterator();r.hasNext();){var a=r.next(),h=i._graph.addNode(a.getCoordinate());h.setLabel(n,a.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var i=this._graph.getEdgeEnds().iterator();i.hasNext();){var r=i.next(),a=r.getLabel();a.isArea()&&!r.isInteriorAreaEdge()&&t.isResultOfOp(a.getLocation(0,le.RIGHT),a.getLocation(1,le.RIGHT),n)&&r.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var i=n.next(),r=i.getLabel(),a=i.getDepth();if(!a.isNull()){a.normalize();for(var h=0;h<2;h++)!r.isNull(h)&&r.isArea()&&!a.isNull(h)&&(a.getDelta(h)===0?r.toLine(h):(un.isTrue(!a.isNull(h,le.LEFT),"depth of LEFT side has not been initialized"),r.setLocation(h,le.LEFT,a.getLocation(h,le.LEFT)),un.isTrue(!a.isNull(h,le.RIGHT),"depth of RIGHT side has not been initialized"),r.setLocation(h,le.RIGHT,a.getLocation(h,le.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next();r.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,i=this._graph.getNodes().iterator();i.hasNext();){var r=i.next(),a=r.getLabel();r.isIsolated()&&(a.isNull(0)?n.labelIncompleteNode(r,0):n.labelIncompleteNode(r,1)),r.getEdges().updateLabelling(a)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(sf);sn.overlayOp=function(e,t,n){var i=new sn(e,t),r=i.getResultGeometry(n);return r};sn.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return sn.createEmptyResult(sn.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return Tc.map(e,{interfaces_:function(){return[Lu.MapOp]},map:function(i){return i.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),io.overlayOp(e,t,sn.INTERSECTION)};sn.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return sn.createEmptyResult(sn.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),io.overlayOp(e,t,sn.SYMDIFFERENCE)};sn.resultDimension=function(e,t,n){var i=t.getDimension(),r=n.getDimension(),a=-1;switch(e){case sn.INTERSECTION:a=Math.min(i,r);break;case sn.UNION:a=Math.max(i,r);break;case sn.DIFFERENCE:a=i;break;case sn.SYMDIFFERENCE:a=Math.max(i,r);break}return a};sn.createEmptyResult=function(e,t,n,i){var r=null;switch(sn.resultDimension(e,t,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon();break}return r};sn.difference=function(e,t){return e.isEmpty()?sn.createEmptyResult(sn.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),io.overlayOp(e,t,sn.DIFFERENCE))};sn.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),i=e.getLocation(1);return sn.isResultOfOp(n,i,t)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],h=arguments[2];switch(r===Ot.BOUNDARY&&(r=Ot.INTERIOR),a===Ot.BOUNDARY&&(a=Ot.INTERIOR),h){case sn.INTERSECTION:return r===Ot.INTERIOR&&a===Ot.INTERIOR;case sn.UNION:return r===Ot.INTERIOR||a===Ot.INTERIOR;case sn.DIFFERENCE:return r===Ot.INTERIOR&&a!==Ot.INTERIOR;case sn.SYMDIFFERENCE:return r===Ot.INTERIOR&&a!==Ot.INTERIOR||r!==Ot.INTERIOR&&a===Ot.INTERIOR}return!1}};sn.INTERSECTION=1;sn.UNION=2;sn.DIFFERENCE=3;sn.SYMDIFFERENCE=4;var jl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Os,this._seg=new ze;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};jl.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,n=0;n<this._linework.getNumGeometries();n++)for(var i=t._linework.getGeometryN(n),r=i.getCoordinateSequence(),a=0;a<r.size()-1;a++){r.getCoordinate(a,t._seg.p0),r.getCoordinate(a+1,t._seg.p1);var h=t._seg.distance(e);if(h<=t._boundaryDistanceTolerance)return!0}return!1};jl.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?Ot.BOUNDARY:this._ptLocator.locate(e,this._g)};jl.prototype.extractLinework=function(e){var t=new af;e.apply(t);var n=t.getLinework(),i=gn.toLineStringArray(n);return e.getFactory().createMultiLineString(i)};jl.prototype.interfaces_=function(){return[]};jl.prototype.getClass=function(){return jl};var af=function(){this._linework=null,this._linework=new pe};af.prototype.getLinework=function(){return this._linework};af.prototype.filter=function(e){var t=this;if(e instanceof Yi){var n=e;this._linework.add(n.getExteriorRing());for(var i=0;i<n.getNumInteriorRing();i++)t._linework.add(n.getInteriorRingN(i))}};af.prototype.interfaces_=function(){return[oa]};af.prototype.getClass=function(){return af};var Bu=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};Bu.prototype.extractPoints=function(e,t,n){for(var i=this,r=e.getCoordinates(),a=0;a<r.length-1;a++)i.computeOffsetPoints(r[a],r[a+1],t,n)};Bu.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};Bu.prototype.getPoints=function(e){for(var t=this,n=new pe,i=Er.getLines(this._g),r=i.iterator();r.hasNext();){var a=r.next();t.extractPoints(a,e,n)}return n};Bu.prototype.computeOffsetPoints=function(e,t,n,i){var r=t.x-e.x,a=t.y-e.y,h=Math.sqrt(r*r+a*a),u=n*r/h,_=n*a/h,w=(t.x+e.x)/2,S=(t.y+e.y)/2;if(this._doLeft){var E=new Nt(w-_,S+u);i.add(E)}if(this._doRight){var M=new Nt(w+_,S-u);i.add(M)}};Bu.prototype.interfaces_=function(){return[]};Bu.prototype.getClass=function(){return Bu};var ts=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new pe;var t=arguments[0],n=arguments[1],i=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,i],this._locFinder=[new jl(this._geom[0],this._boundaryDistanceTolerance),new jl(this._geom[1],this._boundaryDistanceTolerance),new jl(this._geom[2],this._boundaryDistanceTolerance)]},Qx={TOLERANCE:{configurable:!0}};ts.prototype.reportResult=function(e,t,n){Lr.out.println("Overlay result invalid - A:"+Ot.toLocationSymbol(t[0])+" B:"+Ot.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+Ot.toLocationSymbol(t[2]))};ts.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};ts.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=0;n<this._testCoords.size();n++){var i=e._testCoords.get(n);if(!e.checkValid(t,i))return e._invalidLocation=i,!1}return!0}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return this._location[0]=this._locFinder[0].getLocation(a),this._location[1]=this._locFinder[1].getLocation(a),this._location[2]=this._locFinder[2].getLocation(a),ts.hasLocation(this._location,Ot.BOUNDARY)?!0:this.isValidResult(r,this._location)}};ts.prototype.addTestPts=function(e){var t=new Bu(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};ts.prototype.isValidResult=function(e,t){var n=sn.isResultOfOp(t[0],t[1],e),i=t[2]===Ot.INTERIOR,r=!(n^i);return r||this.reportResult(e,t,n),r};ts.prototype.getInvalidLocation=function(){return this._invalidLocation};ts.prototype.interfaces_=function(){return[]};ts.prototype.getClass=function(){return ts};ts.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1};ts.computeBoundaryDistanceTolerance=function(e,t){return Math.min(Ai.computeSizeBasedSnapTolerance(e),Ai.computeSizeBasedSnapTolerance(t))};ts.isValid=function(e,t,n,i){var r=new ts(e,t,i);return r.isValid(n)};Qx.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(ts,Qx);var Ho=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};Ho.prototype.extractElements=function(e,t){var n=this;if(e===null)return null;for(var i=0;i<e.getNumGeometries();i++){var r=e.getGeometryN(i);n._skipEmpty&&r.isEmpty()||t.add(r)}};Ho.prototype.combine=function(){for(var e=this,t=new pe,n=this._inputGeoms.iterator();n.hasNext();){var i=n.next();e.extractElements(i,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};Ho.prototype.interfaces_=function(){return[]};Ho.prototype.getClass=function(){return Ho};Ho.combine=function(){if(arguments.length===1){var e=arguments[0],t=new Ho(e);return t.combine()}else if(arguments.length===2){var n=arguments[0],i=arguments[1],r=new Ho(Ho.createList(n,i));return r.combine()}else if(arguments.length===3){var a=arguments[0],h=arguments[1],u=arguments[2],_=new Ho(Ho.createList(a,h,u));return _.combine()}};Ho.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};Ho.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new pe;return n.add(e),n.add(t),n}else if(arguments.length===3){var i=arguments[0],r=arguments[1],a=arguments[2],h=new pe;return h.add(i),h.add(r),h.add(a),h}};var Fi=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new pe)},tw={STRTREE_NODE_CAPACITY:{configurable:!0}};Fi.prototype.reduceToGeometries=function(e){for(var t=this,n=new pe,i=e.iterator();i.hasNext();){var r=i.next(),a=null;He(r,Ps)?a=t.unionTree(r):r instanceof Ze&&(a=r),n.add(a)}return n};Fi.prototype.extractByEnvelope=function(e,t,n){for(var i=new pe,r=0;r<t.getNumGeometries();r++){var a=t.getGeometryN(r);a.getEnvelopeInternal().intersects(e)?i.add(a):n.add(a)}return this._geomFactory.buildGeometry(i)};Fi.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),i=t.getEnvelopeInternal();if(!n.intersects(i)){var r=Ho.combine(e,t);return r}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var a=n.intersection(i);return this.unionUsingEnvelopeIntersection(e,t,a)};Fi.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new Bx(Fi.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var i=e.itemsTree(),r=this.unionTree(i);return r};Fi.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Fi.getGeometry(t,n);return this.unionSafe(r,null)}else{if(i-n===2)return this.unionSafe(Fi.getGeometry(t,n),Fi.getGeometry(t,n+1));var a=Math.trunc((i+n)/2),h=this.binaryUnion(t,n,a),u=this.binaryUnion(t,a,i);return this.unionSafe(h,u)}}};Fi.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var i=n.next();t===null?t=i.copy():t=t.union(i)}return t};Fi.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};Fi.prototype.unionActual=function(e,t){return Fi.restrictToPolygons(e.union(t))};Fi.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),n=this.binaryUnion(t);return n};Fi.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var i=new pe,r=this.extractByEnvelope(n,e,i),a=this.extractByEnvelope(n,t,i),h=this.unionActual(r,a);i.add(h);var u=Ho.combine(i);return u};Fi.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),n=t.buildGeometry(e),i=n.buffer(0);return i}else if(arguments.length===2){var r=arguments[0],a=arguments[1],h=r.getFactory(),u=h.createGeometryCollection([r,a]),_=u.buffer(0);return _}};Fi.prototype.interfaces_=function(){return[]};Fi.prototype.getClass=function(){return Fi};Fi.restrictToPolygons=function(e){if(He(e,ql))return e;var t=sl.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(gn.toPolygonArray(t))};Fi.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};Fi.union=function(e){var t=new Fi(e);return t.union()};tw.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(Fi,tw);var ag=function(){};ag.prototype.interfaces_=function(){return[]};ag.prototype.getClass=function(){return ag};ag.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return sn.createEmptyResult(sn.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),io.overlayOp(e,t,sn.UNION)};function Uu(){return new lg}function lg(){this.reset()}lg.prototype={constructor:lg,reset:function(){this.s=this.t=0},add:function(e){h1(Dm,e,this.t),h1(this,Dm.s,this.s),this.s?this.t+=Dm.t:this.s=Dm.t},valueOf:function(){return this.s}};var Dm=new lg;function h1(e,t,n){var i=e.s=t+n,r=i-t,a=i-r;e.t=t-a+(n-r)}var Si=1e-6,Wn=Math.PI,ol=Wn/2,f1=Wn/4,pl=Wn*2,wu=180/Wn,$s=Wn/180,Jr=Math.abs,zE=Math.atan,lf=Math.atan2,Hi=Math.cos,$i=Math.sin,_f=Math.sqrt;function ew(e){return e>1?0:e<-1?Wn:Math.acos(e)}function Pc(e){return e>1?ol:e<-1?-ol:Math.asin(e)}function zp(){}function ug(e,t){e&&d1.hasOwnProperty(e.type)&&d1[e.type](e,t)}var p1={Feature:function(e,t){ug(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)ug(n[i].geometry,t)}},d1={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){Ly(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)Ly(n[i],t,0)},Polygon:function(e,t){m1(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)m1(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)ug(n[i],t)}};function Ly(e,t,n){var i=-1,r=e.length-n,a;for(t.lineStart();++i<r;)a=e[i],t.point(a[0],a[1],a[2]);t.lineEnd()}function m1(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)Ly(e[n],t,1);t.polygonEnd()}function OE(e,t){e&&p1.hasOwnProperty(e.type)?p1[e.type](e,t):ug(e,t)}Uu();Uu();function My(e){return[lf(e[1],e[0]),Pc(e[2])]}function uf(e){var t=e[0],n=e[1],i=Hi(n);return[i*Hi(t),i*$i(t),$i(n)]}function Nm(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function cg(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function ey(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Rm(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Py(e){var t=_f(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}Uu();function nw(e,t){function n(i,r){return i=e(i,r),t(i[0],i[1])}return e.invert&&t.invert&&(n.invert=function(i,r){return i=t.invert(i,r),i&&e.invert(i[0],i[1])}),n}function ky(e,t){return[e>Wn?e-pl:e<-Wn?e+pl:e,t]}ky.invert=ky;function FE(e,t,n){return(e%=pl)?t||n?nw(_1(e),y1(t,n)):_1(e):t||n?y1(t,n):ky}function g1(e){return function(t,n){return t+=e,[t>Wn?t-pl:t<-Wn?t+pl:t,n]}}function _1(e){var t=g1(e);return t.invert=g1(-e),t}function y1(e,t){var n=Hi(e),i=$i(e),r=Hi(t),a=$i(t);function h(u,_){var w=Hi(_),S=Hi(u)*w,E=$i(u)*w,M=$i(_),k=M*n+S*i;return[lf(E*r-k*a,S*n-M*i),Pc(k*r+E*a)]}return h.invert=function(u,_){var w=Hi(_),S=Hi(u)*w,E=$i(u)*w,M=$i(_),k=M*r-E*a;return[lf(E*r+M*a,S*n+k*i),Pc(k*n-S*i)]},h}function BE(e,t,n,i,r,a){if(n){var h=Hi(t),u=$i(t),_=i*n;r==null?(r=t+i*pl,a=t-_/2):(r=v1(h,r),a=v1(h,a),(i>0?r<a:r>a)&&(r+=i*pl));for(var w,S=r;i>0?S>a:S<a;S-=_)w=My([h,-u*Hi(S),-u*$i(S)]),e.point(w[0],w[1])}}function v1(e,t){t=uf(t),t[0]-=e,Py(t);var n=ew(-t[1]);return((-t[2]<0?-n:n)+pl-Si)%pl}function iw(){var e=[],t;return{point:function(n,i){t.push([n,i])},lineStart:function(){e.push(t=[])},lineEnd:zp,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function VE(e,t,n,i,r,a){var h=e[0],u=e[1],_=t[0],w=t[1],S=0,E=1,M=_-h,k=w-u,D;if(D=n-h,!(!M&&D>0)){if(D/=M,M<0){if(D<S)return;D<E&&(E=D)}else if(M>0){if(D>E)return;D>S&&(S=D)}if(D=r-h,!(!M&&D<0)){if(D/=M,M<0){if(D>E)return;D>S&&(S=D)}else if(M>0){if(D<S)return;D<E&&(E=D)}if(D=i-u,!(!k&&D>0)){if(D/=k,k<0){if(D<S)return;D<E&&(E=D)}else if(k>0){if(D>E)return;D>S&&(S=D)}if(D=a-u,!(!k&&D<0)){if(D/=k,k<0){if(D>E)return;D>S&&(S=D)}else if(k>0){if(D<S)return;D<E&&(E=D)}return S>0&&(e[0]=h+S*M,e[1]=u+S*k),E<1&&(t[0]=h+E*M,t[1]=u+E*k),!0}}}}}function Wm(e,t){return Jr(e[0]-t[0])<Si&&Jr(e[1]-t[1])<Si}function zm(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function rw(e,t,n,i,r){var a=[],h=[],u,_;if(e.forEach(function(D){if(!((F=D.length-1)<=0)){var F,q=D[0],X=D[F],B;if(Wm(q,X)){for(r.lineStart(),u=0;u<F;++u)r.point((q=D[u])[0],q[1]);r.lineEnd();return}a.push(B=new zm(q,D,null,!0)),h.push(B.o=new zm(q,null,B,!1)),a.push(B=new zm(X,D,null,!1)),h.push(B.o=new zm(X,null,B,!0))}}),!!a.length){for(h.sort(t),b1(a),b1(h),u=0,_=h.length;u<_;++u)h[u].e=n=!n;for(var w=a[0],S,E;;){for(var M=w,k=!0;M.v;)if((M=M.n)===w)return;S=M.z,r.lineStart();do{if(M.v=M.o.v=!0,M.e){if(k)for(u=0,_=S.length;u<_;++u)r.point((E=S[u])[0],E[1]);else i(M.x,M.n.x,1,r);M=M.n}else{if(k)for(S=M.p.z,u=S.length-1;u>=0;--u)r.point((E=S[u])[0],E[1]);else i(M.x,M.p.x,-1,r);M=M.p}M=M.o,S=M.z,k=!k}while(!M.v);r.lineEnd()}}}function b1(e){if(t=e.length){for(var t,n=0,i=e[0],r;++n<t;)i.n=r=e[n],r.p=i,i=r;i.n=r=e[0],r.p=i}}function ow(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function UE(e){return e.length===1&&(e=GE(e)),{left:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function GE(e){return function(t,n){return ow(e(t),n)}}UE(ow);function sw(e){for(var t=e.length,n,i=-1,r=0,a,h;++i<t;)r+=e[i].length;for(a=new Array(r);--t>=0;)for(h=e[t],n=h.length;--n>=0;)a[--r]=h[n];return a}var Op=1e9,Om=-Op;function jE(e,t,n,i){function r(w,S){return e<=w&&w<=n&&t<=S&&S<=i}function a(w,S,E,M){var k=0,D=0;if(w==null||(k=h(w,E))!==(D=h(S,E))||_(w,S)<0^E>0)do M.point(k===0||k===3?e:n,k>1?i:t);while((k=(k+E+4)%4)!==D);else M.point(S[0],S[1])}function h(w,S){return Jr(w[0]-e)<Si?S>0?0:3:Jr(w[0]-n)<Si?S>0?2:1:Jr(w[1]-t)<Si?S>0?1:0:S>0?3:2}function u(w,S){return _(w.x,S.x)}function _(w,S){var E=h(w,1),M=h(S,1);return E!==M?E-M:E===0?S[1]-w[1]:E===1?w[0]-S[0]:E===2?w[1]-S[1]:S[0]-w[0]}return function(w){var S=w,E=iw(),M,k,D,F,q,X,B,U,W,Q,ht,ut={point:St,lineStart:_t,lineEnd:te,polygonStart:zt,polygonEnd:wt};function St(oe,Gt){r(oe,Gt)&&S.point(oe,Gt)}function lt(){for(var oe=0,Gt=0,ie=k.length;Gt<ie;++Gt)for(var Ee=k[Gt],an=1,cn=Ee.length,je=Ee[0],Oe,wn,In=je[0],Sn=je[1];an<cn;++an)Oe=In,wn=Sn,je=Ee[an],In=je[0],Sn=je[1],wn<=i?Sn>i&&(In-Oe)*(i-wn)>(Sn-wn)*(e-Oe)&&++oe:Sn<=i&&(In-Oe)*(i-wn)<(Sn-wn)*(e-Oe)&&--oe;return oe}function zt(){S=E,M=[],k=[],ht=!0}function wt(){var oe=lt(),Gt=ht&&oe,ie=(M=sw(M)).length;(Gt||ie)&&(w.polygonStart(),Gt&&(w.lineStart(),a(null,null,1,w),w.lineEnd()),ie&&rw(M,u,oe,a,w),w.polygonEnd()),S=w,M=k=D=null}function _t(){ut.point=Pt,k&&k.push(D=[]),Q=!0,W=!1,B=U=NaN}function te(){M&&(Pt(F,q),X&&W&&E.rejoin(),M.push(E.result())),ut.point=St,W&&S.lineEnd()}function Pt(oe,Gt){var ie=r(oe,Gt);if(k&&D.push([oe,Gt]),Q)F=oe,q=Gt,X=ie,Q=!1,ie&&(S.lineStart(),S.point(oe,Gt));else if(ie&&W)S.point(oe,Gt);else{var Ee=[B=Math.max(Om,Math.min(Op,B)),U=Math.max(Om,Math.min(Op,U))],an=[oe=Math.max(Om,Math.min(Op,oe)),Gt=Math.max(Om,Math.min(Op,Gt))];VE(Ee,an,e,t,n,i)?(W||(S.lineStart(),S.point(Ee[0],Ee[1])),S.point(an[0],an[1]),ie||S.lineEnd(),ht=!1):ie&&(S.lineStart(),S.point(oe,Gt),ht=!1)}B=oe,U=Gt,W=ie}return ut}}var ny=Uu();function qE(e,t){var n=t[0],i=t[1],r=[$i(n),-Hi(n),0],a=0,h=0;ny.reset();for(var u=0,_=e.length;u<_;++u)if(S=(w=e[u]).length)for(var w,S,E=w[S-1],M=E[0],k=E[1]/2+f1,D=$i(k),F=Hi(k),q=0;q<S;++q,M=B,D=W,F=Q,E=X){var X=w[q],B=X[0],U=X[1]/2+f1,W=$i(U),Q=Hi(U),ht=B-M,ut=ht>=0?1:-1,St=ut*ht,lt=St>Wn,zt=D*W;if(ny.add(lf(zt*ut*$i(St),F*Q+zt*Hi(St))),a+=lt?ht+ut*pl:ht,lt^M>=n^B>=n){var wt=cg(uf(E),uf(X));Py(wt);var _t=cg(r,wt);Py(_t);var te=(lt^ht>=0?-1:1)*Pc(_t[2]);(i>te||i===te&&(wt[0]||wt[1]))&&(h+=lt^ht>=0?1:-1)}}return(a<-Si||a<Si&&ny<-Si)^h&1}Uu();function x1(e){return e}Uu();Uu();var cf=1/0,hg=cf,cd=-cf,fg=cd,w1={point:ZE,lineStart:zp,lineEnd:zp,polygonStart:zp,polygonEnd:zp,result:function(){var e=[[cf,hg],[cd,fg]];return cd=fg=-(hg=cf=1/0),e}};function ZE(e,t){e<cf&&(cf=e),e>cd&&(cd=e),t<hg&&(hg=t),t>fg&&(fg=t)}Uu();function aw(e,t,n,i){return function(r,a){var h=t(a),u=r.invert(i[0],i[1]),_=iw(),w=t(_),S=!1,E,M,k,D={point:F,lineStart:X,lineEnd:B,polygonStart:function(){D.point=U,D.lineStart=W,D.lineEnd=Q,M=[],E=[]},polygonEnd:function(){D.point=F,D.lineStart=X,D.lineEnd=B,M=sw(M);var ht=qE(E,u);M.length?(S||(a.polygonStart(),S=!0),rw(M,HE,ht,n,a)):ht&&(S||(a.polygonStart(),S=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),S&&(a.polygonEnd(),S=!1),M=E=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}};function F(ht,ut){var St=r(ht,ut);e(ht=St[0],ut=St[1])&&a.point(ht,ut)}function q(ht,ut){var St=r(ht,ut);h.point(St[0],St[1])}function X(){D.point=q,h.lineStart()}function B(){D.point=F,h.lineEnd()}function U(ht,ut){k.push([ht,ut]);var St=r(ht,ut);w.point(St[0],St[1])}function W(){w.lineStart(),k=[]}function Q(){U(k[0][0],k[0][1]),w.lineEnd();var ht=w.clean(),ut=_.result(),St,lt=ut.length,zt,wt,_t;if(k.pop(),E.push(k),k=null,!!lt){if(ht&1){if(wt=ut[0],(zt=wt.length-1)>0){for(S||(a.polygonStart(),S=!0),a.lineStart(),St=0;St<zt;++St)a.point((_t=wt[St])[0],_t[1]);a.lineEnd()}return}lt>1&&ht&2&&ut.push(ut.pop().concat(ut.shift())),M.push(ut.filter(WE))}}return D}}function WE(e){return e.length>1}function HE(e,t){return((e=e.x)[0]<0?e[1]-ol-Si:ol-e[1])-((t=t.x)[0]<0?t[1]-ol-Si:ol-t[1])}const S1=aw(function(){return!0},$E,YE,[-Wn,-ol]);function $E(e){var t=NaN,n=NaN,i=NaN,r;return{lineStart:function(){e.lineStart(),r=1},point:function(a,h){var u=a>0?Wn:-Wn,_=Jr(a-t);Jr(_-Wn)<Si?(e.point(t,n=(n+h)/2>0?ol:-ol),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(u,n),e.point(a,n),r=0):i!==u&&_>=Wn&&(Jr(t-i)<Si&&(t-=i*Si),Jr(a-u)<Si&&(a-=u*Si),n=XE(t,n,a,h),e.point(i,n),e.lineEnd(),e.lineStart(),e.point(u,n),r=0),e.point(t=a,n=h),i=u},lineEnd:function(){e.lineEnd(),t=n=NaN},clean:function(){return 2-r}}}function XE(e,t,n,i){var r,a,h=$i(e-n);return Jr(h)>Si?zE(($i(t)*(a=Hi(i))*$i(n)-$i(i)*(r=Hi(t))*$i(e))/(r*a*h)):(t+i)/2}function YE(e,t,n,i){var r;if(e==null)r=n*ol,i.point(-Wn,r),i.point(0,r),i.point(Wn,r),i.point(Wn,0),i.point(Wn,-r),i.point(0,-r),i.point(-Wn,-r),i.point(-Wn,0),i.point(-Wn,r);else if(Jr(e[0]-t[0])>Si){var a=e[0]<t[0]?Wn:-Wn;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])}function KE(e,t){var n=Hi(e),i=n>0,r=Jr(n)>Si;function a(S,E,M,k){BE(k,e,t,M,S,E)}function h(S,E){return Hi(S)*Hi(E)>n}function u(S){var E,M,k,D,F;return{lineStart:function(){D=k=!1,F=1},point:function(q,X){var B=[q,X],U,W=h(q,X),Q=i?W?0:w(q,X):W?w(q+(q<0?Wn:-Wn),X):0;if(!E&&(D=k=W)&&S.lineStart(),W!==k&&(U=_(E,B),(!U||Wm(E,U)||Wm(B,U))&&(B[0]+=Si,B[1]+=Si,W=h(B[0],B[1]))),W!==k)F=0,W?(S.lineStart(),U=_(B,E),S.point(U[0],U[1])):(U=_(E,B),S.point(U[0],U[1]),S.lineEnd()),E=U;else if(r&&E&&i^W){var ht;!(Q&M)&&(ht=_(B,E,!0))&&(F=0,i?(S.lineStart(),S.point(ht[0][0],ht[0][1]),S.point(ht[1][0],ht[1][1]),S.lineEnd()):(S.point(ht[1][0],ht[1][1]),S.lineEnd(),S.lineStart(),S.point(ht[0][0],ht[0][1])))}W&&(!E||!Wm(E,B))&&S.point(B[0],B[1]),E=B,k=W,M=Q},lineEnd:function(){k&&S.lineEnd(),E=null},clean:function(){return F|(D&&k)<<1}}}function _(S,E,M){var k=uf(S),D=uf(E),F=[1,0,0],q=cg(k,D),X=Nm(q,q),B=q[0],U=X-B*B;if(!U)return!M&&S;var W=n*X/U,Q=-n*B/U,ht=cg(F,q),ut=Rm(F,W),St=Rm(q,Q);ey(ut,St);var lt=ht,zt=Nm(ut,lt),wt=Nm(lt,lt),_t=zt*zt-wt*(Nm(ut,ut)-1);if(!(_t<0)){var te=_f(_t),Pt=Rm(lt,(-zt-te)/wt);if(ey(Pt,ut),Pt=My(Pt),!M)return Pt;var oe=S[0],Gt=E[0],ie=S[1],Ee=E[1],an;Gt<oe&&(an=oe,oe=Gt,Gt=an);var cn=Gt-oe,je=Jr(cn-Wn)<Si,Oe=je||cn<Si;if(!je&&Ee<ie&&(an=ie,ie=Ee,Ee=an),Oe?je?ie+Ee>0^Pt[1]<(Jr(Pt[0]-oe)<Si?ie:Ee):ie<=Pt[1]&&Pt[1]<=Ee:cn>Wn^(oe<=Pt[0]&&Pt[0]<=Gt)){var wn=Rm(lt,(-zt+te)/wt);return ey(wn,ut),[Pt,My(wn)]}}}function w(S,E){var M=i?e:Wn-e,k=0;return S<-M?k|=1:S>M&&(k|=2),E<-M?k|=4:E>M&&(k|=8),k}return aw(h,u,a,i?[0,-e]:[-Wn,e-Wn])}function lw(e){return function(t){var n=new Ay;for(var i in e)n[i]=e[i];return n.stream=t,n}}function Ay(){}Ay.prototype={constructor:Ay,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function uw(e,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],a=e.clipExtent&&e.clipExtent();e.scale(150).translate([0,0]),a!=null&&e.clipExtent(null),OE(n,e.stream(w1));var h=w1.result(),u=Math.min(i/(h[1][0]-h[0][0]),r/(h[1][1]-h[0][1])),_=+t[0][0]+(i-u*(h[1][0]+h[0][0]))/2,w=+t[0][1]+(r-u*(h[1][1]+h[0][1]))/2;return a!=null&&e.clipExtent(a),e.scale(u*150).translate([_,w])}function JE(e,t,n){return uw(e,[[0,0],t],n)}var I1=16,QE=Hi(30*$s);function E1(e,t){return+t?eC(e,t):tC(e)}function tC(e){return lw({point:function(t,n){t=e(t,n),this.stream.point(t[0],t[1])}})}function eC(e,t){function n(i,r,a,h,u,_,w,S,E,M,k,D,F,q){var X=w-i,B=S-r,U=X*X+B*B;if(U>4*t&&F--){var W=h+M,Q=u+k,ht=_+D,ut=_f(W*W+Q*Q+ht*ht),St=Pc(ht/=ut),lt=Jr(Jr(ht)-1)<Si||Jr(a-E)<Si?(a+E)/2:lf(Q,W),zt=e(lt,St),wt=zt[0],_t=zt[1],te=wt-i,Pt=_t-r,oe=B*te-X*Pt;(oe*oe/U>t||Jr((X*te+B*Pt)/U-.5)>.3||h*M+u*k+_*D<QE)&&(n(i,r,a,h,u,_,wt,_t,lt,W/=ut,Q/=ut,ht,F,q),q.point(wt,_t),n(wt,_t,lt,W,Q,ht,w,S,E,M,k,D,F,q))}}return function(i){var r,a,h,u,_,w,S,E,M,k,D,F,q={point:X,lineStart:B,lineEnd:W,polygonStart:function(){i.polygonStart(),q.lineStart=Q},polygonEnd:function(){i.polygonEnd(),q.lineStart=B}};function X(St,lt){St=e(St,lt),i.point(St[0],St[1])}function B(){E=NaN,q.point=U,i.lineStart()}function U(St,lt){var zt=uf([St,lt]),wt=e(St,lt);n(E,M,S,k,D,F,E=wt[0],M=wt[1],S=St,k=zt[0],D=zt[1],F=zt[2],I1,i),i.point(E,M)}function W(){q.point=X,i.lineEnd()}function Q(){B(),q.point=ht,q.lineEnd=ut}function ht(St,lt){U(r=St,lt),a=E,h=M,u=k,_=D,w=F,q.point=U}function ut(){n(E,M,S,k,D,F,a,h,r,u,_,w,I1,i),q.lineEnd=W,W()}return q}}var nC=lw({point:function(e,t){this.stream.point(e*$s,t*$s)}});function iC(e){return rC(function(){return e})()}function rC(e){var t,n=150,i=480,r=250,a,h,u=0,_=0,w=0,S=0,E=0,M,k,D=null,F=S1,q=null,X,B,U,W=x1,Q=.5,ht=E1(wt,Q),ut,St;function lt(Pt){return Pt=k(Pt[0]*$s,Pt[1]*$s),[Pt[0]*n+a,h-Pt[1]*n]}function zt(Pt){return Pt=k.invert((Pt[0]-a)/n,(h-Pt[1])/n),Pt&&[Pt[0]*wu,Pt[1]*wu]}function wt(Pt,oe){return Pt=t(Pt,oe),[Pt[0]*n+a,h-Pt[1]*n]}lt.stream=function(Pt){return ut&&St===Pt?ut:ut=nC(F(M,ht(W(St=Pt))))},lt.clipAngle=function(Pt){return arguments.length?(F=+Pt?KE(D=Pt*$s,6*$s):(D=null,S1),te()):D*wu},lt.clipExtent=function(Pt){return arguments.length?(W=Pt==null?(q=X=B=U=null,x1):jE(q=+Pt[0][0],X=+Pt[0][1],B=+Pt[1][0],U=+Pt[1][1]),te()):q==null?null:[[q,X],[B,U]]},lt.scale=function(Pt){return arguments.length?(n=+Pt,_t()):n},lt.translate=function(Pt){return arguments.length?(i=+Pt[0],r=+Pt[1],_t()):[i,r]},lt.center=function(Pt){return arguments.length?(u=Pt[0]%360*$s,_=Pt[1]%360*$s,_t()):[u*wu,_*wu]},lt.rotate=function(Pt){return arguments.length?(w=Pt[0]%360*$s,S=Pt[1]%360*$s,E=Pt.length>2?Pt[2]%360*$s:0,_t()):[w*wu,S*wu,E*wu]},lt.precision=function(Pt){return arguments.length?(ht=E1(wt,Q=Pt*Pt),te()):_f(Q)},lt.fitExtent=function(Pt,oe){return uw(lt,Pt,oe)},lt.fitSize=function(Pt,oe){return JE(lt,Pt,oe)};function _t(){k=nw(M=FE(w,S,E),t);var Pt=t(u,_);return a=i-Pt[0]*n,h=r+Pt[1]*n,te()}function te(){return ut=St=null,lt}return function(){return t=e.apply(this,arguments),lt.invert=t.invert&&zt,_t()}}function cw(e){return function(t,n){var i=Hi(t),r=Hi(n),a=e(i*r);return[a*r*$i(t),a*$i(n)]}}function hw(e){return function(t,n){var i=_f(t*t+n*n),r=e(i),a=$i(r),h=Hi(r);return[lf(t*a,i*h),Pc(i&&n*a/i)]}}var oC=cw(function(e){return _f(2/(1+e))});oC.invert=hw(function(e){return 2*Pc(e/2)});var fw=cw(function(e){return(e=ew(e))&&e/$i(e)});fw.invert=hw(function(e){return e});function sC(){return iC(fw).scale(79.4188).clipAngle(180-.001)}function C1(e,t){return[e,t]}C1.invert=C1;function aC(e,t,n){n=n||{};var i=n.units||"kilometers",r=n.steps||8;if(!e)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof r!="number")throw new Error("steps must be an number");if(t===void 0)throw new Error("radius is required");if(r<=0)throw new Error("steps must be greater than 0");var a=[];switch(e.type){case"GeometryCollection":return Tx(e,function(h){var u=Hm(h,t,i,r);u&&a.push(u)}),Ey(a);case"FeatureCollection":return s1(e,function(h){var u=Hm(h,t,i,r);u&&s1(u,function(_){_&&a.push(_)})}),Ey(a)}return Hm(e,t,i,r)}function Hm(e,t,n,i){var r=e.properties||{},a=e.type==="Feature"?e.geometry:e;if(a.type==="GeometryCollection"){var h=[];return Tx(e,function(F){var q=Hm(F,t,n,i);q&&h.push(q)}),Ey(h)}var u=lC(a),_={type:a.type,coordinates:dw(a.coordinates,u)},w=new Hy,S=w.read(_),E=mE(gE(t,n),"meters"),M=Cr.bufferOp(S,E,i),k=new Ox;if(M=k.write(M),!pw(M.coordinates)){var D={type:M.type,coordinates:mw(M.coordinates,u)};return Ig(D,r)}}function pw(e){return Array.isArray(e[0])?pw(e[0]):isNaN(e[0])}function dw(e,t){return typeof e[0]!="object"?t(e):e.map(function(n){return dw(n,t)})}function mw(e,t){return typeof e[0]!="object"?t.invert(e):e.map(function(n){return mw(n,t)})}function lC(e){var t=yE(e).geometry.coordinates,n=[-t[0],-t[1]];return sC().rotate(n).scale(Zo)}function uC(e,t){var n=ng(e),i=ng(t),r=e.properties||{},a=wx.difference(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?Ix(a[0],r):Ex(a,r)}function T1(e){let t;for(const n of e)t&&n[0]-t[0]>=180?n[0]-=360:t&&n[0]-t[0]<-180&&(n[0]+=360),t=n}function L1(e,t){const n=uC({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},e);if(!n)return;n.properties={isMask:"y"};const i=aC(e,0);if(i.geometry.type==="Polygon")for(const r of i.geometry.coordinates)T1(r);else for(const r of i.geometry.coordinates)for(const a of r)T1(a);t({type:"FeatureCollection",features:[i,n]})}let M1={type:"FeatureCollection",features:[]};function cC(e,t,n=!0,i=!0,r={},a={},h={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let u,_=[],w,S;function E(){(h!=null&&h.fill||h!=null&&h.line)&&e.addSource("full-geom",{type:"geojson",data:M1}),h!=null&&h.fill&&e.addLayer({...h==null?void 0:h.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),h!=null&&h.line&&e.addLayer({...h==null?void 0:h.line,id:"full-geom-line",type:"line",source:"full-geom"})}e.loaded()?E():e.once("load",()=>{E()});const M=D=>{u==null||u({type:"mapClick",coordinates:[D.lngLat.lng,D.lngLat.lat]})};function k(D=!1){if(!t)throw new Error;const F=document.createElement("div");return D&&F.classList.add("marker-interactive"),new BI({props:{displayIn:"maplibre"},target:F}),new t.Marker({element:F,offset:[1,-13]})}return{setEventHandler(D){D?(u=D,e.on("click",M)):(u=void 0,e.off("click",M))},flyTo(D,F){e.flyTo({center:D,zoom:F,...r})},fitBounds(D,F,q){e.fitBounds([[D[0],D[1]],[D[2],D[3]]],{padding:F,maxZoom:q,...a})},indicateReverse(D){e.getCanvasContainer().style.cursor=D?"crosshair":""},setReverseMarker(D){!t||!n||(S?D?S.setLngLat(D):(S.remove(),S=void 0):D&&(S=(typeof n=="object"?new t.Marker(n):k()).setLngLat(D).addTo(e),S.getElement().classList.add("marker-reverse")))},setMarkers(D,F){if(!n)return;function q(X){var B;(B=e.getSource("full-geom"))==null||B.setData(X)}for(const X of _)X.remove();if(_.length=0,q(M1),!!t){if(F){let X=!1;if(F.geometry.type==="GeometryCollection"){const B=F.geometry.geometries.filter(U=>U.type==="Polygon"||U.type==="MultiPolygon");if(B.length>0){let U=B.pop();for(const W of B)U=_E(U,W);L1({...F,geometry:U},q),X=!0}else{const U=F.geometry.geometries.filter(W=>W.type==="LineString"||W.type==="MultiLineString");U.length>0&&(q({...F,geometry:{type:"GeometryCollection",geometries:U}}),X=!0)}}if(!X){if(F.geometry.type==="Polygon"||F.geometry.type==="MultiPolygon")L1(F,q);else if(F.geometry.type==="LineString"||F.geometry.type==="MultiLineString"){q(F);return}}n&&_.push((typeof n=="object"?new t.Marker(n):k()).setLngLat(F.center).addTo(e))}if(i)for(const X of D??[]){if(X===F)continue;const B=(typeof i=="object"?new t.Marker(i):k(!0)).setLngLat(X.center).setPopup(new t.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(X.place_type[0]==="reverse"?X.place_name:X.place_name.replace(/,.*/,""))).addTo(e),U=B.getElement();U.addEventListener("click",W=>{W.stopPropagation(),u==null||u({type:"markerClick",id:X.id})}),U.addEventListener("mouseenter",()=>{u==null||u({type:"markerMouseEnter",id:X.id}),B.togglePopup()}),U.addEventListener("mouseleave",()=>{u==null||u({type:"markerMouseLeave",id:X.id}),B.togglePopup()}),_.push(B)}}},setSelectedMarker(D){w&&w.getElement().classList.toggle("marker-selected",!1),w=D>-1?_[D]:void 0,w==null||w.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const D=e.getCenter();return[e.getZoom(),D.lng,D.lat]}}}function hC(e){let t,n;return{c(){t=Ul("svg"),n=Ul("path"),Mt(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Mt(t,"viewBox","0 0 14 14"),Mt(t,"width","13"),Mt(t,"height","13"),Mt(t,"class","svelte-en2qvf")},m(i,r){xt(i,t,r),ct(t,n)},p:Ae,i:Ae,o:Ae,d(i){i&&vt(t)}}}class gw extends nn{constructor(t){super(),en(this,t,null,hC,Ye,{})}}function fC(e){let t,n;return{c(){t=Ul("svg"),n=Ul("path"),Mt(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Mt(t,"viewBox","0 0 30 30"),Mt(t,"fill","none"),Mt(t,"xmlns","http://www.w3.org/2000/svg"),Mt(t,"class","svelte-d2loi5")},m(i,r){xt(i,t,r),ct(t,n)},p:Ae,i:Ae,o:Ae,d(i){i&&vt(t)}}}class _w extends nn{constructor(t){super(),en(this,t,null,fC,Ye,{})}}function pC(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"area.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"area.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function dC(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"reverse.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"reverse.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function mC(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"poi.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"poi.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function gC(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"postal_code.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"postal_code.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function _C(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"street.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"street.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function yC(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"road.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"road.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function vC(e){let t,n;return{c(){t=gt("img"),jn(t.src,n=e[3]+"housenumber.svg")||Mt(t,"src",n),Mt(t,"alt",e[6]),Mt(t,"class","svelte-ltkwvy")},m(i,r){xt(i,t,r)},p(i,r){r&8&&!jn(t.src,n=i[3]+"housenumber.svg")&&Mt(t,"src",n),r&64&&Mt(t,"alt",i[6])},d(i){i&&vt(t)}}}function bC(e){let t,n,i,r;return{c(){t=gt("img"),jn(t.src,n=e[5])||Mt(t,"src",n),Mt(t,"alt",e[4]),Mt(t,"class","svelte-ltkwvy")},m(a,h){xt(a,t,h),i||(r=Ge(t,"error",e[14]),i=!0)},p(a,h){h&32&&!jn(t.src,n=a[5])&&Mt(t,"src",n),h&16&&Mt(t,"alt",a[4])},d(a){a&&vt(t),i=!1,r()}}}function P1(e){let t,n;return{c(){t=gt("span"),n=de(e[6]),Mt(t,"class","secondary svelte-ltkwvy")},m(i,r){xt(i,t,r),ct(t,n)},p(i,r){r&64&&yi(n,i[6])},d(i){i&&vt(t)}}}function xC(e){var ut,St;let t,n,i,r,a,h,u,_,w=(e[7]?e[0].place_name:e[0].place_name.replace(/,.*/,""))+"",S,E,M=e[2]==="always"||e[2]&&!e[0].address&&((ut=e[0].properties)==null?void 0:ut.kind)!=="road"&&((St=e[0].properties)==null?void 0:St.kind)!=="road_relation"&&!e[0].id.startsWith("address.")&&!e[0].id.startsWith("postal_code.")&&(!e[0].id.startsWith("poi.")||!e[5])&&!e[7],k,D,F=(e[7]?"":e[0].place_name.replace(/[^,]*,?\s*/,""))+"",q,X,B;function U(lt,zt){var wt,_t;return zt&1&&(n=null),zt&1&&(i=null),zt&1&&(r=null),lt[5]?bC:lt[0].address?vC:((wt=lt[0].properties)==null?void 0:wt.kind)==="road"||((_t=lt[0].properties)==null?void 0:_t.kind)==="road_relation"?yC:(n==null&&(n=!!lt[0].id.startsWith("address.")),n?_C:(i==null&&(i=!!lt[0].id.startsWith("postal_code.")),i?gC:(r==null&&(r=!!lt[0].id.startsWith("poi.")),r?mC:lt[7]?dC:pC)))}let W=U(e,-1),Q=W(e),ht=M&&P1(e);return{c(){t=gt("li"),Q.c(),a=Xt(),h=gt("span"),u=gt("span"),_=gt("span"),S=de(w),E=Xt(),ht&&ht.c(),k=Xt(),D=gt("span"),q=de(F),Mt(_,"class","primary svelte-ltkwvy"),Mt(u,"class","svelte-ltkwvy"),Mt(D,"class","line2 svelte-ltkwvy"),Mt(h,"class","texts svelte-ltkwvy"),Mt(t,"tabindex","0"),Mt(t,"data-selected",e[1]),Mt(t,"class","svelte-ltkwvy"),rl(t,"selected",e[1])},m(lt,zt){xt(lt,t,zt),Q.m(t,null),ct(t,a),ct(t,h),ct(h,u),ct(u,_),ct(_,S),ct(u,E),ht&&ht.m(u,null),ct(h,k),ct(h,D),ct(D,q),X||(B=[Ge(t,"mouseenter",e[12]),Ge(t,"focus",e[13])],X=!0)},p(lt,[zt]){var wt,_t;W===(W=U(lt,zt))&&Q?Q.p(lt,zt):(Q.d(1),Q=W(lt),Q&&(Q.c(),Q.m(t,a))),zt&1&&w!==(w=(lt[7]?lt[0].place_name:lt[0].place_name.replace(/,.*/,""))+"")&&yi(S,w),zt&37&&(M=lt[2]==="always"||lt[2]&&!lt[0].address&&((wt=lt[0].properties)==null?void 0:wt.kind)!=="road"&&((_t=lt[0].properties)==null?void 0:_t.kind)!=="road_relation"&&!lt[0].id.startsWith("address.")&&!lt[0].id.startsWith("postal_code.")&&(!lt[0].id.startsWith("poi.")||!lt[5])&&!lt[7]),M?ht?ht.p(lt,zt):(ht=P1(lt),ht.c(),ht.m(u,null)):ht&&(ht.d(1),ht=null),zt&1&&F!==(F=(lt[7]?"":lt[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&yi(q,F),zt&2&&Mt(t,"data-selected",lt[1]),zt&2&&rl(t,"selected",lt[1])},i:Ae,o:Ae,d(lt){lt&&vt(t),Q.d(),ht&&ht.d(),X=!1,ro(B)}}}function wC(e,t,n){var U;let i,r,{feature:a}=t,{selected:h=!1}=t,{showPlaceType:u}=t,{missingIconsCache:_}=t,{iconsBaseUrl:w}=t;const S=(U=a.properties)==null?void 0:U.categories;let E,M,k=0,D=a.place_type[0]==="reverse";function F(W){M&&_.add(M),n(10,k++,k)}function q(W){ii.call(this,e,W)}function X(W){ii.call(this,e,W)}const B=W=>F(W.currentTarget);return e.$$set=W=>{"feature"in W&&n(0,a=W.feature),"selected"in W&&n(1,h=W.selected),"showPlaceType"in W&&n(2,u=W.showPlaceType),"missingIconsCache"in W&&n(9,_=W.missingIconsCache),"iconsBaseUrl"in W&&n(3,w=W.iconsBaseUrl)},e.$$.update=()=>{var W,Q,ht,ut;if(e.$$.dirty&3640)do n(11,i--,i),n(4,E=S==null?void 0:S[i]),n(5,M=E?w+E.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!M||_.has(M)));e.$$.dirty&1&&n(6,r=a.id.startsWith("poi.")?(Q=(W=a.properties)==null?void 0:W.categories)==null?void 0:Q.join(", "):((ut=(ht=a.properties)==null?void 0:ht.place_type_name)==null?void 0:ut[0])??a.place_type[0])},n(11,i=(S==null?void 0:S.length)??0),[a,h,u,w,E,M,r,D,F,_,k,i,q,X,B]}class SC extends nn{constructor(t){super(),en(this,t,wC,xC,Ye,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function IC(e){let t;return{c(){t=gt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Mt(t,"class","svelte-7cmwmc")},m(n,i){xt(n,t,i)},p:Ae,i:Ae,o:Ae,d(n){n&&vt(t)}}}class EC extends nn{constructor(t){super(),en(this,t,null,IC,Ye,{})}}function CC(e){let t,n;return{c(){t=Ul("svg"),n=Ul("path"),Mt(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Mt(t,"viewBox","0 0 60.006 21.412"),Mt(t,"width","14"),Mt(t,"height","20"),Mt(t,"class","svelte-en2qvf")},m(i,r){xt(i,t,r),ct(t,n)},p:Ae,i:Ae,o:Ae,d(i){i&&vt(t)}}}class TC extends nn{constructor(t){super(),en(this,t,null,CC,Ye,{})}}function LC(e){let t,n,i;return{c(){t=Ul("svg"),n=Ul("circle"),i=Ul("path"),Mt(n,"cx","4.789"),Mt(n,"cy","4.787"),Mt(n,"r","3.85"),si(n,"stroke-width","1.875"),si(n,"fill","none"),Mt(i,"d","M12.063 12.063 7.635 7.635"),si(i,"stroke-width","1.875"),si(i,"stroke-linecap","round"),Mt(t,"xmlns","http://www.w3.org/2000/svg"),Mt(t,"width","13"),Mt(t,"height","13"),Mt(t,"viewBox","0 0 13 13"),Mt(t,"class","svelte-1bpbt60")},m(r,a){xt(r,t,a),ct(t,n),ct(t,i)},p:Ae,i:Ae,o:Ae,d(r){r&&vt(t)}}}class MC extends nn{constructor(t){super(),en(this,t,null,LC,Ye,{})}}function PC(e,t,n){const i=t[1],r=t[0],a=i-r;return e===i&&n?e:((e-r)%a+a)%a+r}function k1(e){const t=[...e];return t[2]<t[0]&&(t[2]+=360),t}let Cp;async function kC(e,t,n){const i=e==null?void 0:e.getCenterAndZoom();for(const r of t??[])if(!(i&&(r.minZoom!=null&&r.minZoom>i[0]||r.maxZoom!=null&&r.maxZoom<i[0]))){if(r.type==="fixed")return r.coordinates.join(",");t:if(r.type==="client-geolocation"){if(Cp&&r.cachedLocationExpiry&&Cp.time+r.cachedLocationExpiry>Date.now()){if(!Cp.coords)break t;return Cp.coords}let a;try{return a=await new Promise((h,u)=>{n.signal.addEventListener("abort",()=>{u(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{h([_.coords.longitude,_.coords.latitude].map(w=>w.toFixed(6)).join(","))},_=>{u(_)},r)}),a}catch{}finally{r.cachedLocationExpiry&&(Cp={time:Date.now(),coords:a})}if(n.signal.aborted)return}if(r.type==="server-geolocation")return"ip";if(i&&r.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const A1=/(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?/i,D1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?/i,N1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?/i,R1=/(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?/i;function AC(e){if(!["DMS","DM","DD"].includes(e))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){if(e=="DD")return this.decimalCoordinates;const t=this.decimalCoordinates.split(",").map(h=>Number(h.trim()));let n=z1(t[0],e),i=z1(t[1],e);n.endsWith('.0"')&&i.endsWith('.0"')&&(n=n.replace(/\.0"$/,'"'),i=i.replace(/\.0"$/,'"'));const r=t[0]>=0?" N":" S",a=t[1]>=0?" E":" W";return`${n+r}, ${i+a}`}else throw new Error("no decimal coordinates to convert")}function z1(e,t){const n=Math.abs(e),i=Math.floor(n),r=(n-i)*60;if(t=="DM"){let u=DC(r,3).toFixed(3).padStart(6,"0");return`${i}° ${u}'`}let a=Math.floor(r),h=((r-a)*60).toFixed(1).padStart(4,"0");return a=a.toString().padStart(2,"0"),`${i}° ${a}' ${h}"`}function DC(e,t){const n=Math.pow(10,t);return Math.round((e+Number.EPSILON)*n)/n}function n0(e,t){t||(t=5),e=e.replace(/\s+/g," ").trim();let n=null,i=null,r="",a="",h=[],u=!1;if(A1.test(e))if(h=A1.exec(e),u=Fm(h),u){if(n=h[2],i=h[6],n.includes(",")&&(n=n.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");h[1]?(r=h[1],a=h[5]):h[4]&&(r=h[4],a=h[8])}else throw new Error("invalid decimal coordinate format");else if(D1.test(e))if(h=D1.exec(e),u=Fm(h),u)n=Math.abs(parseInt(h[2])),h[4]&&(n+=h[4]/60),h[6]&&(n+=h[6].replace(",",".")/3600),parseInt(h[2])<0&&(n=-1*n),i=Math.abs(parseInt(h[9])),h[11]&&(i+=h[11]/60),h[13]&&(i+=h[13].replace(",",".")/3600),parseInt(h[9])<0&&(i=-1*i),h[1]?(r=h[1],a=h[8]):h[7]&&(r=h[7],a=h[14]);else throw new Error("invalid DMS coordinates format");else if(N1.test(e))if(h=N1.exec(e),u=Fm(h),u)n=Math.abs(parseInt(h[2])),h[4]&&(n+=h[4]/60),h[6]&&(n+=h[6]/3600),parseInt(h[2])<0&&(n=-1*n),i=Math.abs(parseInt(h[10])),h[12]&&(i+=h[12]/60),h[14]&&(i+=h[14]/3600),parseInt(h[10])<0&&(i=-1*i),h[1]?(r=h[1],a=h[9]):h[8]&&(r=h[8],a=h[16]);else throw new Error("invalid DMS coordinates format");else if(R1.test(e))if(h=R1.exec(e),u=Fm(h),u)n=Math.abs(parseInt(h[2])),h[4]&&(n+=h[4]/60),h[6]&&(n+=h[6]/3600),parseInt(h[2])<0&&(n=-1*n),i=Math.abs(parseInt(h[10])),h[12]&&(i+=h[12]/60),h[14]&&(i+=h[14]/3600),parseInt(h[10])<0&&(i=-1*i),h[1]?(r=h[1],a=h[9]):h[8]&&(r=h[8],a=h[16]);else throw new Error("invalid coordinates format");if(u){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(n)>=90)throw new Error("invalid latitude value");if((r||a)&&(!r||!a))throw new Error("invalid coordinates format");if(r&&r==a)throw new Error("invalid coordinates format");let _=/S|SOUTH/i;_.test(r)&&n>0&&(n=-1*n),_=/W|WEST/i,_.test(a)&&i>0&&(i=-1*i);const w=h[0].trim();let S,E;const M=/[,/;\u0020]/g,k=w.match(M);if(k==null){const q=Math.floor(e.length/2);S=w.substring(0,q).trim(),E=w.substring(q).trim()}else{let q;k.length%2==1?q=Math.floor(k.length/2):q=k.length/2-1;let X=0;if(q==0)X=w.indexOf(k[0]),S=w.substring(0,X).trim(),E=w.substring(X+1).trim();else{let B=0,U=0;for(;B<=q;)X=w.indexOf(k[B],U),U=X+1,B++;S=w.substring(0,X).trim(),E=w.substring(X+1).trim()}}const D=S.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");const F=E.split(".");if(F.length==2&&F[1]==0&&F[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return isNaN(n)&&n.includes(",")&&(n=n.replace(",",".")),n=Number(Number(n).toFixed(t)),isNaN(i)&&i.includes(",")&&(i=i.replace(",",".")),i=Number(Number(i).toFixed(t)),Object.freeze({verbatimCoordinates:w,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:n,decimalLongitude:i,decimalCoordinates:`${n},${i}`,closeEnough:NC,toCoordinateFormat:AC})}else throw new Error("coordinates pattern match failed")}function Fm(e){if(!isNaN(e[0]))return!1;const t=[...e];if(t.shift(),t.length%2>0)return!1;const n=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,r=t.length/2;for(let a=0;a<r;a++){const h=t[a],u=t[a+r],_=n.test(h)&&n.test(u),w=i.test(h)&&i.test(u),S=h==u;if(!(h==null&&u==null)){if(h==null||u==null)return!1;if(_||w||S)continue;return!1}}return!0}function O1(e,t){const n=Math.abs(e-t);return Number(n.toFixed(6))<=1e-5}function NC(e){if(e.includes(",")){const t=e.split(",");if(Number(t[0])==NaN||Number(t[1])==NaN)throw new Error("coords are not valid decimals");return O1(this.decimalLatitude,Number(t[0]))&&O1(this.decimalLongitude,t[1])}else throw new Error("coords being tested must be separated by a comma")}const RC=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});n0.to=RC;const zC=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],OC={decimalLatitude:40.123,decimalLongitude:-74.123},FC=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],BC=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function VC(){const e=[];return zC.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...OC})}),[...e,...FC,...BC]}const UC=VC();n0.formats=UC.map(e=>e.verbatimCoordinates);const GC=n0;function F1(e,t,n){const i=e.slice();return i[81]=t[n],i[83]=n,i}function B1(e){let t,n;return t=new EC({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function V1(e){let t,n,i,r,a;return n=new TC({}),{c(){t=gt("button"),Wt(n.$$.fragment),Mt(t,"type","button"),Mt(t,"title",e[9]),Mt(t,"class","svelte-zh3kmv"),rl(t,"active",e[0])},m(h,u){xt(h,t,u),jt(n,t,null),i=!0,r||(a=Ge(t,"click",e[67]),r=!0)},p(h,u){(!i||u[0]&512)&&Mt(t,"title",h[9]),(!i||u[0]&1)&&rl(t,"active",h[0])},i(h){i||(pt(n.$$.fragment,h),i=!0)},o(h){yt(n.$$.fragment,h),i=!1},d(h){h&&vt(t),qt(n),r=!1,a()}}}function jC(e){let t,n=[],i=new Map,r,a,h,u=ps(e[14]);const _=w=>w[81].id+(w[81].address?","+w[81].address:"");for(let w=0;w<u.length;w+=1){let S=F1(e,u,w),E=_(S);i.set(E,n[w]=U1(E,S))}return{c(){t=gt("ul");for(let w=0;w<n.length;w+=1)n[w].c();Mt(t,"class","svelte-zh3kmv")},m(w,S){xt(w,t,S);for(let E=0;E<n.length;E+=1)n[E]&&n[E].m(t,null);r=!0,a||(h=[Ge(t,"mouseleave",e[71]),Ge(t,"blur",e[72])],a=!0)},p(w,S){S[0]&17880064&&(u=ps(w[14]),ti(),n=HS(n,S,_,1,w,u,i,t,WS,U1,null,F1),ei())},i(w){if(!r){for(let S=0;S<u.length;S+=1)pt(n[S]);r=!0}},o(w){for(let S=0;S<n.length;S+=1)yt(n[S]);r=!1},d(w){w&&vt(t);for(let S=0;S<n.length;S+=1)n[S].d();a=!1,ro(h)}}}function qC(e){let t,n,i,r,a,h;return n=new _w({}),{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),r=gt("div"),a=de(e[7]),Mt(r,"class","svelte-zh3kmv"),Mt(t,"class","no-results svelte-zh3kmv")},m(u,_){xt(u,t,_),jt(n,t,null),ct(t,i),ct(t,r),ct(r,a),h=!0},p(u,_){(!h||_[0]&128)&&yi(a,u[7])},i(u){h||(pt(n.$$.fragment,u),h=!0)},o(u){yt(n.$$.fragment,u),h=!1},d(u){u&&vt(t),qt(n)}}}function ZC(e){let t="",n;return{c(){n=de(t)},m(i,r){xt(i,n,r)},p:Ae,i:Ae,o:Ae,d(i){i&&vt(n)}}}function WC(e){let t,n,i,r,a,h,u,_,w,S,E;return n=new _w({}),_=new gw({}),{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),r=gt("div"),a=de(e[6]),h=Xt(),u=gt("button"),Wt(_.$$.fragment),Mt(r,"class","svelte-zh3kmv"),Mt(u,"class","svelte-zh3kmv"),Mt(t,"class","error svelte-zh3kmv")},m(M,k){xt(M,t,k),jt(n,t,null),ct(t,i),ct(t,r),ct(r,a),ct(t,h),ct(t,u),jt(_,u,null),w=!0,S||(E=Ge(u,"click",e[68]),S=!0)},p(M,k){(!w||k[0]&64)&&yi(a,M[6])},i(M){w||(pt(n.$$.fragment,M),pt(_.$$.fragment,M),w=!0)},o(M){yt(n.$$.fragment,M),yt(_.$$.fragment,M),w=!1},d(M){M&&vt(t),qt(n),qt(_),S=!1,E()}}}function U1(e,t){let n,i,r;function a(){return t[69](t[83])}function h(){return t[70](t[81])}return i=new SC({props:{feature:t[81],showPlaceType:t[10],selected:t[15]===t[83],missingIconsCache:t[20],iconsBaseUrl:t[12]}}),i.$on("mouseenter",a),i.$on("focus",h),{key:e,first:null,c(){n=Oo(),Wt(i.$$.fragment),this.first=n},m(u,_){xt(u,n,_),jt(i,u,_),r=!0},p(u,_){t=u;const w={};_[0]&16384&&(w.feature=t[81]),_[0]&1024&&(w.showPlaceType=t[10]),_[0]&49152&&(w.selected=t[15]===t[83]),_[0]&4096&&(w.iconsBaseUrl=t[12]),i.$set(w)},i(u){r||(pt(i.$$.fragment,u),r=!0)},o(u){yt(i.$$.fragment,u),r=!1},d(u){u&&vt(n),qt(i,u)}}}function HC(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D,F,q,X,B,U,W,Q,ht=!1;a=new MC({}),E=new gw({});let ut=e[19]&&B1(),St=e[5]===!0&&V1(e);const lt=e[59].default,zt=ir(lt,e,e[58],null),wt=[WC,ZC,qC,jC],_t=[];function te(Pt,oe){var Gt,ie;return Pt[18]?0:Pt[16]?((Gt=Pt[14])==null?void 0:Gt.length)===0?2:Pt[16]&&((ie=Pt[14])!=null&&ie.length)?3:-1:1}return~(q=te(e))&&(X=_t[q]=wt[q](e)),{c(){t=Xt(),n=gt("form"),i=gt("div"),r=gt("button"),Wt(a.$$.fragment),h=Xt(),u=gt("input"),_=Xt(),w=gt("div"),S=gt("button"),Wt(E.$$.fragment),M=Xt(),ut&&ut.c(),k=Xt(),St&&St.c(),D=Xt(),zt&&zt.c(),F=Xt(),X&&X.c(),Mt(r,"class","search-button svelte-zh3kmv"),Mt(r,"type","button"),Mt(u,"placeholder",e[8]),Mt(u,"aria-label",e[8]),Mt(u,"class","svelte-zh3kmv"),Mt(S,"type","button"),Mt(S,"title",e[3]),Mt(S,"class","svelte-zh3kmv"),Mt(w,"class","clear-button-container svelte-zh3kmv"),rl(w,"displayable",e[1]!==""),Mt(i,"class","input-group svelte-zh3kmv"),Mt(n,"tabindex","0"),Mt(n,"class",B=$m(e[2])+" svelte-zh3kmv"),rl(n,"can-collapse",e[4]&&e[1]==="")},m(Pt,oe){xt(Pt,t,oe),xt(Pt,n,oe),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),e[61](u),La(u,e[1]),ct(i,_),ct(i,w),ct(w,S),jt(E,S,null),ct(w,M),ut&&ut.m(w,null),ct(i,k),St&&St.m(i,null),ct(i,D),zt&&zt.m(i,null),ct(n,F),~q&&_t[q].m(n,null),U=!0,W||(Q=[Ge(r,"click",e[60]),Ge(u,"input",e[62]),Ge(u,"focus",e[63]),Ge(u,"blur",e[64]),Ge(u,"keydown",e[22]),Ge(u,"input",e[65]),Ge(S,"click",e[66]),Ge(n,"submit",BS(e[21]))],W=!0)},p(Pt,oe){(!U||oe[0]&256)&&Mt(u,"placeholder",Pt[8]),(!U||oe[0]&256)&&Mt(u,"aria-label",Pt[8]),oe[0]&2&&u.value!==Pt[1]&&La(u,Pt[1]),(!U||oe[0]&8)&&Mt(S,"title",Pt[3]),Pt[19]?ut?oe[0]&524288&&pt(ut,1):(ut=B1(),ut.c(),pt(ut,1),ut.m(w,null)):ut&&(ti(),yt(ut,1,1,()=>{ut=null}),ei()),(!U||oe[0]&2)&&rl(w,"displayable",Pt[1]!==""),Pt[5]===!0?St?(St.p(Pt,oe),oe[0]&32&&pt(St,1)):(St=V1(Pt),St.c(),pt(St,1),St.m(i,D)):St&&(ti(),yt(St,1,1,()=>{St=null}),ei()),zt&&zt.p&&(!U||oe[1]&134217728)&&or(zt,lt,Pt,Pt[58],U?rr(lt,Pt[58],oe,null):sr(Pt[58]),null);let Gt=q;q=te(Pt),q===Gt?~q&&_t[q].p(Pt,oe):(X&&(ti(),yt(_t[Gt],1,1,()=>{_t[Gt]=null}),ei()),~q?(X=_t[q],X?X.p(Pt,oe):(X=_t[q]=wt[q](Pt),X.c()),pt(X,1),X.m(n,null)):X=null),(!U||oe[0]&4&&B!==(B=$m(Pt[2])+" svelte-zh3kmv"))&&Mt(n,"class",B),(!U||oe[0]&22)&&rl(n,"can-collapse",Pt[4]&&Pt[1]==="")},i(Pt){U||(pt(ht),pt(a.$$.fragment,Pt),pt(E.$$.fragment,Pt),pt(ut),pt(St),pt(zt,Pt),pt(X),U=!0)},o(Pt){yt(ht),yt(a.$$.fragment,Pt),yt(E.$$.fragment,Pt),yt(ut),yt(St),yt(zt,Pt),yt(X),U=!1},d(Pt){Pt&&(vt(t),vt(n)),qt(a),e[61](null),qt(E),ut&&ut.d(),St&&St.d(),zt&&zt.d(Pt),~q&&_t[q].d(),W=!1,ro(Q)}}}function $C(e,t,n){let i,{$$slots:r={},$$scope:a}=t,{class:h=void 0}=t,{apiKey:u}=t,{bbox:_=void 0}=t,{clearButtonTitle:w="clear"}=t,{clearOnBlur:S=!1}=t,{collapsed:E=!1}=t,{country:M=void 0}=t,{debounceSearch:k=200}=t,{enableReverse:D=!1}=t,{errorMessage:F="Something went wrong…"}=t,{filter:q=()=>!0}=t,{flyTo:X=!0}=t,{fuzzyMatch:B=!0}=t,{language:U=void 0}=t,{limit:W=void 0}=t,{mapController:Q=void 0}=t,{minLength:ht=2}=t,{noResultsMessage:ut="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:St="Search"}=t,{proximity:lt=[{type:"server-geolocation"}]}=t,{reverseActive:zt=D==="always"}=t,{reverseButtonTitle:wt="toggle reverse geocoding"}=t,{searchValue:_t=""}=t,{showFullGeometry:te=!0}=t,{showPlaceType:Pt="ifNeeded"}=t,{showResultsWhileTyping:oe=!0}=t,{selectFirst:Gt=!0}=t,{flyToSelected:ie=!1}=t,{markerOnSelected:Ee=!0}=t,{types:an=void 0}=t,{excludeTypes:cn=!1}=t,{zoom:je=16}=t,{maxZoom:Oe=18}=t,{apiUrl:wn="https://api.maptiler.com/geocoding"}=t,{fetchParameters:In={}}=t,{iconsBaseUrl:Sn="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.2/icons/"}=t,{adjustUrlQuery:Bn=J=>{}}=t;function Vn(){Bt.focus()}function ne(){Bt.blur()}function Ie(J,Ct=!0){n(1,_t=J),Ct?(n(15,yn=-1),_l()):(Qi(),setTimeout(()=>{Bt.focus(),Bt.select()}))}function Fe(){n(14,Tt=void 0),n(55,Le=void 0),n(15,yn=-1)}function zn(){n(54,We=[]),n(55,Le=void 0)}let Ki=!1,Tt,We,Le,Ji="",Bt,yn=-1,ar,dn=[],mi,Dr,vs,Us;const Ga=new Set,Gr=Ac();na(()=>{Q&&(Q.setEventHandler(void 0),Q.indicateReverse(!1),Q.setSelectedMarker(-1),Q.setMarkers(void 0,void 0))});function _l(J){if(Dr&&(clearTimeout(Dr),Dr=void 0),yn>-1&&Tt)n(55,Le=Tt[yn]),n(1,_t=Le.place_type[0]==="reverse"?Le.place_name:Le.place_name.replace(/,.*/,"")),n(18,ar=void 0),n(54,We=void 0),n(15,yn=-1);else if(_t){const Ct=J||!bs(_t);se(_t,{exact:!0}).then(()=>{n(54,We=Tt),n(55,Le=void 0),Ct&&es()}).catch(mt=>n(18,ar=mt))}}function bs(J){try{return GC(J,6)}catch{return!1}}async function se(J,{byId:Ct=!1,exact:mt=!1}={}){n(18,ar=void 0),mi==null||mi.abort();const At=new AbortController;n(19,mi=At);try{const Vt=bs(J),Ht=new URLSearchParams;if(U!==void 0&&Ht.set("language",Array.isArray(U)?U.join(","):U??""),an&&Ht.set("types",an.join(",")),cn&&Ht.set("excludeTypes",String(cn)),_&&Ht.set("bbox",_.map(Ke=>Ke.toFixed(6)).join(",")),M&&Ht.set("country",Array.isArray(M)?M.join(","):M),!Ct&&!Vt){const Ke=await kC(Q,lt,At);Ke&&Ht.set("proximity",Ke),(mt||!oe)&&Ht.set("autocomplete","false"),Ht.set("fuzzyMatch",String(B))}W!==void 0&&(!Vt||(an==null?void 0:an.length)===1)&&Ht.set("limit",String(W)),Ht.set("key",u),Bn(Ht);const $t=wn+"/"+encodeURIComponent(Vt?Vt.decimalLongitude+","+Vt.decimalLatitude:J)+".json?"+Ht.toString();if($t===Ji){Ct?(n(14,Tt=void 0),n(55,Le=dn[0])):n(14,Tt=dn);return}Ji=$t;const Pe=await fetch($t,{signal:At.signal,...In});if(!Pe.ok)throw new Error(await Pe.text());const Ne=await Pe.json();Gr("response",{url:$t,featureCollection:Ne}),Ct?(n(14,Tt=void 0),n(55,Le=Ne.features[0]),dn=[Le]):(n(14,Tt=Ne.features.filter(q)),Vt&&Tt.unshift({type:"Feature",properties:{},id:"reverse_"+Vt.decimalLongitude+"_"+Vt.decimalLatitude,text:Vt.decimalLatitude+", "+Vt.decimalLongitude,place_name:Vt.decimalLatitude+", "+Vt.decimalLongitude,place_type:["reverse"],center:[Vt.decimalLongitude,Vt.decimalLatitude],bbox:[Vt.decimalLongitude,Vt.decimalLatitude,Vt.decimalLongitude,Vt.decimalLatitude],geometry:{type:"Point",coordinates:[Vt.decimalLongitude,Vt.decimalLatitude]}}),dn=Tt,Vt&&Bt.focus())}catch(Vt){if(Vt&&typeof Vt=="object"&&"name"in Vt&&Vt.name==="AbortError")return;throw Vt}finally{At===mi&&n(19,mi=void 0)}}function es(){var mt;if(!(We!=null&&We.length)||!X)return;const J=[180,90,-180,-90],Ct=!We.some(At=>!At.matching_text);for(const At of We)if(Ct||!At.matching_text)for(const Vt of[0,1,2,3])J[Vt]=Math[Vt<2?"min":"max"](J[Vt],((mt=At.bbox)==null?void 0:mt[Vt])??At.center[Vt%2]);Q&&We.length>0&&(Le&&J[0]===J[2]&&J[1]===J[3]?Q.flyTo(Le.center,je):Q.fitBounds(k1(J),50,Oe))}function oo(J){n(0,zt=D==="always"),n(14,Tt=void 0),n(55,Le=void 0),n(15,yn=-1),Ie(J[1].toFixed(6)+", "+PC(J[0],[-180,180],!0).toFixed(6),!1)}function yl(J){if(!Tt)return;let Ct=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;Ct&&(yn===(Gt?0:-1)&&Ct===-1&&n(15,yn=Tt.length),n(15,yn+=Ct),yn>=Tt.length&&n(15,yn=-1),yn<0&&Gt&&n(15,yn=0),J.preventDefault())}function Qi(J=!0){if(n(18,ar=void 0),oe){if(Dr&&clearTimeout(Dr),_t.length<ht)return;const Ct=_t;Dr=window.setTimeout(()=>{se(Ct).catch(mt=>n(18,ar=mt))},J?k:0)}else n(14,Tt=void 0),n(18,ar=void 0)}function ue(J){n(55,Le=J),n(1,_t=J.place_name),n(15,yn=-1)}const ln=()=>Bt.focus();function on(J){Or[J?"unshift":"push"](()=>{Bt=J,n(17,Bt)})}function Ri(){_t=this.value,n(1,_t),n(13,Ki),n(27,S)}const ns=()=>n(13,Ki=!0),rn=()=>n(13,Ki=!1),_a=()=>Qi(),Vi=()=>{n(1,_t=""),Bt.focus()},st=()=>n(0,zt=!zt),G=()=>n(18,ar=void 0),Z=J=>n(15,yn=J),K=J=>ue(J),nt=()=>{Gt||n(15,yn=-1)},Et=()=>{};return e.$$set=J=>{"class"in J&&n(2,h=J.class),"apiKey"in J&&n(25,u=J.apiKey),"bbox"in J&&n(26,_=J.bbox),"clearButtonTitle"in J&&n(3,w=J.clearButtonTitle),"clearOnBlur"in J&&n(27,S=J.clearOnBlur),"collapsed"in J&&n(4,E=J.collapsed),"country"in J&&n(28,M=J.country),"debounceSearch"in J&&n(29,k=J.debounceSearch),"enableReverse"in J&&n(5,D=J.enableReverse),"errorMessage"in J&&n(6,F=J.errorMessage),"filter"in J&&n(30,q=J.filter),"flyTo"in J&&n(31,X=J.flyTo),"fuzzyMatch"in J&&n(32,B=J.fuzzyMatch),"language"in J&&n(33,U=J.language),"limit"in J&&n(34,W=J.limit),"mapController"in J&&n(35,Q=J.mapController),"minLength"in J&&n(36,ht=J.minLength),"noResultsMessage"in J&&n(7,ut=J.noResultsMessage),"placeholder"in J&&n(8,St=J.placeholder),"proximity"in J&&n(37,lt=J.proximity),"reverseActive"in J&&n(0,zt=J.reverseActive),"reverseButtonTitle"in J&&n(9,wt=J.reverseButtonTitle),"searchValue"in J&&n(1,_t=J.searchValue),"showFullGeometry"in J&&n(38,te=J.showFullGeometry),"showPlaceType"in J&&n(10,Pt=J.showPlaceType),"showResultsWhileTyping"in J&&n(39,oe=J.showResultsWhileTyping),"selectFirst"in J&&n(11,Gt=J.selectFirst),"flyToSelected"in J&&n(40,ie=J.flyToSelected),"markerOnSelected"in J&&n(41,Ee=J.markerOnSelected),"types"in J&&n(42,an=J.types),"excludeTypes"in J&&n(43,cn=J.excludeTypes),"zoom"in J&&n(44,je=J.zoom),"maxZoom"in J&&n(45,Oe=J.maxZoom),"apiUrl"in J&&n(46,wn=J.apiUrl),"fetchParameters"in J&&n(47,In=J.fetchParameters),"iconsBaseUrl"in J&&n(12,Sn=J.iconsBaseUrl),"adjustUrlQuery"in J&&n(48,Bn=J.adjustUrlQuery),"$$scope"in J&&n(58,a=J.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&134225920&&setTimeout(()=>{n(16,vs=Ki),S&&!Ki&&n(1,_t="")}),e.$$.dirty[0]&16386|e.$$.dirty[1]&32&&_t.length<ht&&(n(55,Le=void 0),n(14,Tt=void 0),n(18,ar=void 0),n(54,We=Tt)),e.$$.dirty[1]&16777344&&te&&Le&&!Le.address&&Le.geometry.type==="Point"&&Le.place_type[0]!=="reverse"&&se(Le.id,{byId:!0}).catch(J=>n(18,ar=J)),e.$$.dirty[1]&50356241&&(Q&&Le&&Le.id!==Us&&X&&(!Le.bbox||Le.bbox[0]===Le.bbox[2]&&Le.bbox[1]===Le.bbox[3]?Q.flyTo(Le.center,Le.id.startsWith("poi.")||Le.id.startsWith("address.")?Oe:je):Q.fitBounds(k1(Le.bbox),50,Oe),n(14,Tt=void 0),n(54,We=void 0),n(15,yn=-1)),n(56,Us=Le==null?void 0:Le.id)),e.$$.dirty[0]&18432&&Gt&&Tt!=null&&Tt.length&&n(15,yn=0),e.$$.dirty[0]&2050&&(Gt||n(15,yn=-1)),e.$$.dirty[0]&16384|e.$$.dirty[1]&8388608&&We!==Tt&&n(54,We=void 0),e.$$.dirty[0]&81921|e.$$.dirty[1]&8388624&&Q&&Q.setEventHandler(J=>{switch(J.type){case"mapClick":zt&&oo(J.coordinates);break;case"markerClick":{const Ct=Tt==null?void 0:Tt.find(mt=>mt.id===J.id);Ct&&ue(Ct)}break;case"markerMouseEnter":We&&n(15,yn=vs?(Tt==null?void 0:Tt.findIndex(Ct=>Ct.id===J.id))??-1:-1);break;case"markerMouseLeave":We&&n(15,yn=-1);break}}),e.$$.dirty[0]&49152&&n(57,i=Tt==null?void 0:Tt[yn]),e.$$.dirty[1]&67133969&&Q&&i&&X&&ie&&Q.flyTo(i.center,i.id.startsWith("poi.")||i.id.startsWith("address.")?Oe:je),e.$$.dirty[1]&1040&&(Ee||Q==null||Q.setMarkers(void 0,void 0)),e.$$.dirty[1]&75498512&&Q&&Ee&&!We&&(Q.setMarkers(i?[i]:void 0,void 0),Q.setSelectedMarker(i?0:-1)),e.$$.dirty[1]&25165840&&Q&&Q.setMarkers(We,Le),e.$$.dirty[0]&32768|e.$$.dirty[1]&8388624&&We&&Q&&Q.setSelectedMarker(yn),e.$$.dirty[0]&2|e.$$.dirty[1]&16&&Q){const J=bs(_t);Q.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}e.$$.dirty[1]&67108864&&Gr("select",i),e.$$.dirty[1]&16777216&&Gr("pick",Le),e.$$.dirty[0]&81920&&Gr("optionsVisibilityChange",vs&&!!Tt),e.$$.dirty[0]&16384&&Gr("featuresListed",Tt),e.$$.dirty[1]&8388608&&Gr("featuresMarked",We),e.$$.dirty[0]&1&&Gr("reverseToggle",zt),e.$$.dirty[0]&2&&Gr("queryChange",_t),e.$$.dirty[0]&1|e.$$.dirty[1]&16&&Q&&Q.indicateReverse(zt)},[zt,_t,h,w,E,D,F,ut,St,wt,Pt,Gt,Sn,Ki,Tt,yn,vs,Bt,ar,mi,Ga,_l,yl,Qi,ue,u,_,S,M,k,q,X,B,U,W,Q,ht,lt,te,oe,ie,Ee,an,cn,je,Oe,wn,In,Bn,Vn,ne,Ie,Fe,zn,We,Le,Us,i,a,r,ln,on,Ri,ns,rn,_a,Vi,st,G,Z,K,nt,Et]}class XC extends nn{constructor(t){super(),en(this,t,$C,HC,Ye,{class:2,apiKey:25,bbox:26,clearButtonTitle:3,clearOnBlur:27,collapsed:4,country:28,debounceSearch:29,enableReverse:5,errorMessage:6,filter:30,flyTo:31,fuzzyMatch:32,language:33,limit:34,mapController:35,minLength:36,noResultsMessage:7,placeholder:8,proximity:37,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:38,showPlaceType:10,showResultsWhileTyping:39,selectFirst:11,flyToSelected:40,markerOnSelected:41,types:42,excludeTypes:43,zoom:44,maxZoom:45,apiUrl:46,fetchParameters:47,iconsBaseUrl:12,adjustUrlQuery:48,focus:49,blur:50,setQuery:51,clearList:52,clearMap:53},null,[-1,-1,-1])}get focus(){return this.$$.ctx[49]}get blur(){return this.$$.ctx[50]}get setQuery(){return this.$$.ctx[51]}get clearList(){return this.$$.ctx[52]}get clearMap(){return this.$$.ctx[53]}}function G1(e){let t,n,i;return n=new XC({props:{mapController:e[0],apiKey:uy}}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"class","svelte-ixhnie")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p(r,a){const h={};a&1&&(h.mapController=r[0]),n.$set(h)},i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function YC(e){let t,n,i=e[0]&&G1(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,[a]){r[0]?i?(i.p(r,a),a&1&&pt(i,1)):(i=G1(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function KC(e,t,n){let i,r;return we(e,al,a=>n(1,r=a)),e.$$.update=()=>{e.$$.dirty&2&&n(0,i=r?cC(r,Ls):null)},[i,r]}class JC extends nn{constructor(t){super(),en(this,t,KC,YC,Ye,{})}}const QC=e=>({}),j1=e=>({}),tT=e=>({}),q1=e=>({}),eT=e=>({}),Z1=e=>({});function nT(e){let t,n,i,r,a,h;const u=e[1].top,_=ir(u,e,e[0],Z1),w=e[1].left,S=ir(w,e,e[0],q1),E=e[1].main,M=ir(E,e,e[0],j1);return{c(){t=gt("div"),_&&_.c(),n=Xt(),i=gt("div"),S&&S.c(),r=Xt(),a=gt("div"),M&&M.c(),Mt(t,"class","top svelte-3nmiww"),Mt(i,"class","left svelte-3nmiww"),Mt(a,"class","main svelte-3nmiww")},m(k,D){xt(k,t,D),_&&_.m(t,null),xt(k,n,D),xt(k,i,D),S&&S.m(i,null),xt(k,r,D),xt(k,a,D),M&&M.m(a,null),h=!0},p(k,[D]){_&&_.p&&(!h||D&1)&&or(_,u,k,k[0],h?rr(u,k[0],D,eT):sr(k[0]),Z1),S&&S.p&&(!h||D&1)&&or(S,w,k,k[0],h?rr(w,k[0],D,tT):sr(k[0]),q1),M&&M.p&&(!h||D&1)&&or(M,E,k,k[0],h?rr(E,k[0],D,QC):sr(k[0]),j1)},i(k){h||(pt(_,k),pt(S,k),pt(M,k),h=!0)},o(k){yt(_,k),yt(S,k),yt(M,k),h=!1},d(k){k&&(vt(t),vt(n),vt(i),vt(r),vt(a)),_&&_.d(k),S&&S.d(k),M&&M.d(k)}}}function iT(e,t,n){let{$$slots:i={},$$scope:r}=t;return e.$$set=a=>{"$$scope"in a&&n(0,r=a.$$scope)},[r,i]}class rT extends nn{constructor(t){super(),en(this,t,iT,nT,Ye,{})}}function oT(e){let t,n,i,r;const a=e[1].default,h=ir(a,e,e[0],null);return{c(){t=gt("a"),h&&h.c(),Mt(t,"href","#")},m(u,_){xt(u,t,_),h&&h.m(t,null),n=!0,i||(r=Ge(t,"click",e[2]),i=!0)},p(u,[_]){h&&h.p&&(!n||_&1)&&or(h,a,u,u[0],n?rr(a,u[0],_,null):sr(u[0]),null)},i(u){n||(pt(h,u),n=!0)},o(u){yt(h,u),n=!1},d(u){u&&vt(t),h&&h.d(u),i=!1,r()}}}function sT(e,t,n){let{$$slots:i={},$$scope:r}=t;function a(h){ii.call(this,e,h)}return e.$$set=h=>{"$$scope"in h&&n(0,r=h.$$scope)},[r,i,a]}class ri extends nn{constructor(t){super(),en(this,t,sT,oT,Ye,{})}}function W1(e){let t,n;return{c(){t=gt("div"),n=de(e[0]),Mt(t,"class","svelte-1uuov7f")},m(i,r){xt(i,t,r),ct(t,n)},p(i,r){r&1&&yi(n,i[0])},d(i){i&&vt(t)}}}function aT(e){let t,n=e[0]&&W1(e);return{c(){n&&n.c(),t=Oo()},m(i,r){n&&n.m(i,r),xt(i,t,r)},p(i,[r]){i[0]?n?n.p(i,r):(n=W1(i),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:Ae,o:Ae,d(i){i&&vt(t),n&&n.d(i)}}}function lT(e,t,n){let{msg:i=null}=t;return e.$$set=r=>{"msg"in r&&n(0,i=r.msg)},[i]}class yw extends nn{constructor(t){super(),en(this,t,lT,aT,Ye,{msg:0})}}const uT=e=>({dialog:e&1}),H1=e=>({dialog:e[0]});function cT(e){let t,n,i,r,a;const h=e[4].default,u=ir(h,e,e[3],H1);return{c(){t=gt("dialog"),n=gt("article"),u&&u.c(),t.open=!0},m(_,w){xt(_,t,w),ct(t,n),u&&u.m(n,null),e[6](t),i=!0,r||(a=[Ge(window,"click",e[1]),Ge(window,"keydown",e[2]),Ge(t,"close",e[5])],r=!0)},p(_,[w]){u&&u.p&&(!i||w&9)&&or(u,h,_,_[3],i?rr(h,_[3],w,uT):sr(_[3]),H1)},i(_){i||(pt(u,_),i=!0)},o(_){yt(u,_),i=!1},d(_){_&&vt(t),u&&u.d(_),e[6](null),r=!1,ro(a)}}}function hT(e,t,n){let{$$slots:i={},$$scope:r}=t,a;function h(S){a.open&&S.target==a&&a.close()}function u(S){(S.key=="Escape"||S.key=="Enter")&&(S.stopPropagation(),a.close())}function _(S){ii.call(this,e,S)}function w(S){Or[S?"unshift":"push"](()=>{a=S,n(0,a)})}return e.$$set=S=>{"$$scope"in S&&n(3,r=S.$$scope)},[a,h,u,r,i,_,w]}class i0 extends nn{constructor(t){super(),en(this,t,hT,cT,Ye,{})}}var ko=63710088e-1,r0={centimeters:ko*100,centimetres:ko*100,degrees:ko/111325,feet:ko*3.28084,inches:ko*39.37,kilometers:ko/1e3,kilometres:ko/1e3,meters:ko,metres:ko,miles:ko/1609.344,millimeters:ko*1e3,millimetres:ko*1e3,nauticalmiles:ko/1852,radians:1,yards:ko*1.0936},fT={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ko,yards:1.0936133},Dy={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function pa(e,t,n){n===void 0&&(n={});var i={type:"Feature"};return(n.id===0||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function pT(e,t,n){switch(e){case"Point":return us(t).geometry;case"LineString":return Js(t).geometry;case"Polygon":return o0(t).geometry;case"MultiPoint":return bw(t).geometry;case"MultiLineString":return vw(t).geometry;case"MultiPolygon":return xw(t).geometry;default:throw new Error(e+" is invalid")}}function us(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!pg(e[0])||!pg(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return pa(i,t,n)}function dT(e,t,n){return n===void 0&&(n={}),kc(e.map(function(i){return us(i,t)}),n)}function o0(e,t,n){n===void 0&&(n={});for(var i=0,r=e;i<r.length;i++){var a=r[i];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<a[a.length-1].length;h++)if(a[a.length-1][h]!==a[0][h])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:e};return pa(u,t,n)}function mT(e,t,n){return n===void 0&&(n={}),kc(e.map(function(i){return o0(i,t)}),n)}function Js(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return pa(i,t,n)}function gT(e,t,n){return n===void 0&&(n={}),kc(e.map(function(i){return Js(i,t)}),n)}function kc(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function vw(e,t,n){n===void 0&&(n={});var i={type:"MultiLineString",coordinates:e};return pa(i,t,n)}function bw(e,t,n){n===void 0&&(n={});var i={type:"MultiPoint",coordinates:e};return pa(i,t,n)}function xw(e,t,n){n===void 0&&(n={});var i={type:"MultiPolygon",coordinates:e};return pa(i,t,n)}function _T(e,t,n){n===void 0&&(n={});var i={type:"GeometryCollection",geometries:e};return pa(i,t,n)}function yT(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function s0(e,t){t===void 0&&(t="kilometers");var n=r0[t];if(!n)throw new Error(t+" units is invalid");return e*n}function Og(e,t){t===void 0&&(t="kilometers");var n=r0[t];if(!n)throw new Error(t+" units is invalid");return e/n}function vT(e,t){return hd(Og(e,t))}function bT(e){var t=e%360;return t<0&&(t+=360),t}function hd(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Qs(e){var t=e%360;return t*Math.PI/180}function xT(e,t,n){if(t===void 0&&(t="kilometers"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return s0(Og(e,t),n)}function wT(e,t,n){if(t===void 0&&(t="meters"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=Dy[t];if(!i)throw new Error("invalid original units");var r=Dy[n];if(!r)throw new Error("invalid final units");return e/i*r}function pg(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function a0(e){return!!e&&e.constructor===Object}function ST(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!pg(t))throw new Error("bbox must only contain numbers")})}function IT(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}const ET=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Dy,bearingToAzimuth:bT,convertArea:wT,convertLength:xT,degreesToRadians:Qs,earthRadius:ko,factors:r0,feature:pa,featureCollection:kc,geometry:pT,geometryCollection:_T,isNumber:pg,isObject:a0,lengthToDegrees:vT,lengthToRadians:Og,lineString:Js,lineStrings:gT,multiLineString:vw,multiPoint:bw,multiPolygon:xw,point:us,points:dT,polygon:o0,polygons:mT,radiansToDegrees:hd,radiansToLength:s0,round:yT,unitsFactors:fT,validateBBox:ST,validateId:IT},Symbol.toStringTag,{value:"Module"}));function fd(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function hf(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ww(e,t,n){if(n===void 0&&(n={}),n.final===!0)return CT(e,t);var i=fd(e),r=fd(t),a=Qs(i[0]),h=Qs(r[0]),u=Qs(i[1]),_=Qs(r[1]),w=Math.sin(h-a)*Math.cos(_),S=Math.cos(u)*Math.sin(_)-Math.sin(u)*Math.cos(_)*Math.cos(h-a);return hd(Math.atan2(w,S))}function CT(e,t){var n=ww(t,e);return n=(n+180)%360,n}function Tp(e,t,n){n===void 0&&(n={});var i=fd(e),r=fd(t),a=Qs(r[1]-i[1]),h=Qs(r[0]-i[0]),u=Qs(i[1]),_=Qs(r[1]),w=Math.pow(Math.sin(a/2),2)+Math.pow(Math.sin(h/2),2)*Math.cos(u)*Math.cos(_);return s0(2*Math.atan2(Math.sqrt(w),Math.sqrt(1-w)),n.units)}function $1(e,t,n,i){i===void 0&&(i={});var r=fd(e),a=Qs(r[0]),h=Qs(r[1]),u=Qs(n),_=Og(t,i.units),w=Math.asin(Math.sin(h)*Math.cos(_)+Math.cos(h)*Math.sin(_)*Math.cos(u)),S=a+Math.atan2(Math.sin(u)*Math.sin(_)*Math.cos(h),Math.cos(_)-Math.sin(h)*Math.sin(w)),E=hd(S),M=hd(w);return us([E,M],i.properties)}function xd(e,t,n){if(e!==null)for(var i,r,a,h,u,_,w,S=0,E=0,M,k=e.type,D=k==="FeatureCollection",F=k==="Feature",q=D?e.features.length:1,X=0;X<q;X++){w=D?e.features[X].geometry:F?e.geometry:e,M=w?w.type==="GeometryCollection":!1,u=M?w.geometries.length:1;for(var B=0;B<u;B++){var U=0,W=0;if(h=M?w.geometries[B]:w,h!==null){_=h.coordinates;var Q=h.type;switch(S=n&&(Q==="Polygon"||Q==="MultiPolygon")?1:0,Q){case null:break;case"Point":if(t(_,E,X,U,W)===!1)return!1;E++,U++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(t(_[i],E,X,U,W)===!1)return!1;E++,Q==="MultiPoint"&&U++}Q==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(r=0;r<_[i].length-S;r++){if(t(_[i][r],E,X,U,W)===!1)return!1;E++}Q==="MultiLineString"&&U++,Q==="Polygon"&&W++}Q==="Polygon"&&U++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(W=0,r=0;r<_[i].length;r++){for(a=0;a<_[i][r].length-S;a++){if(t(_[i][r][a],E,X,U,W)===!1)return!1;E++}W++}U++}break;case"GeometryCollection":for(i=0;i<h.geometries.length;i++)if(xd(h.geometries[i],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function TT(e,t,n,i){var r=n;return xd(e,function(a,h,u,_,w){h===0&&n===void 0?r=a:r=t(r,a,h,u,_,w)},i),r}function Sw(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function LT(e,t,n){var i=n;return Sw(e,function(r,a){a===0&&n===void 0?i=r:i=t(i,r,a)}),i}function dg(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function MT(e,t,n){var i=n;return dg(e,function(r,a){a===0&&n===void 0?i=r:i=t(i,r,a)}),i}function PT(e){var t=[];return xd(e,function(n){t.push(n)}),t}function l0(e,t){var n,i,r,a,h,u,_,w,S,E,M=0,k=e.type==="FeatureCollection",D=e.type==="Feature",F=k?e.features.length:1;for(n=0;n<F;n++){for(u=k?e.features[n].geometry:D?e.geometry:e,w=k?e.features[n].properties:D?e.properties:{},S=k?e.features[n].bbox:D?e.bbox:void 0,E=k?e.features[n].id:D?e.id:void 0,_=u?u.type==="GeometryCollection":!1,h=_?u.geometries.length:1,r=0;r<h;r++){if(a=_?u.geometries[r]:u,a===null){if(t(null,M,w,S,E)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,M,w,S,E)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<a.geometries.length;i++)if(t(a.geometries[i],M,w,S,E)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}M++}}function kT(e,t,n){var i=n;return l0(e,function(r,a,h,u,_){a===0&&n===void 0?i=r:i=t(i,r,a,h,u,_)}),i}function yf(e,t){l0(e,function(n,i,r,a,h){var u=n===null?null:n.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return t(pa(n,r,{bbox:a,id:h}),i,0)===!1?!1:void 0}var _;switch(u){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var w=0;w<n.coordinates.length;w++){var S=n.coordinates[w],E={type:_,coordinates:S};if(t(pa(E,r),i,w)===!1)return!1}})}function AT(e,t,n){var i=n;return yf(e,function(r,a,h){a===0&&h===0&&n===void 0?i=r:i=t(i,r,a,h)}),i}function Iw(e,t){yf(e,function(n,i,r){var a=0;if(n.geometry){var h=n.geometry.type;if(!(h==="Point"||h==="MultiPoint")){var u,_=0,w=0,S=0;if(xd(n,function(E,M,k,D,F){if(u===void 0||i>_||D>w||F>S){u=E,_=i,w=D,S=F,a=0;return}var q=Js([u,E],n.properties);if(t(q,i,r,F,a)===!1)return!1;a++,u=E})===!1)return!1}}})}function DT(e,t,n){var i=n,r=!1;return Iw(e,function(a,h,u,_,w){r===!1&&n===void 0?i=a:i=t(i,a,h,u,_,w),r=!0}),i}function Ew(e,t){if(!e)throw new Error("geojson is required");yf(e,function(n,i,r){if(n.geometry!==null){var a=n.geometry.type,h=n.geometry.coordinates;switch(a){case"LineString":if(t(n,i,r,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<h.length;u++)if(t(Js(h[u],n.properties),i,r,u)===!1)return!1;break}}})}function NT(e,t,n){var i=n;return Ew(e,function(r,a,h,u){a===0&&n===void 0?i=r:i=t(i,r,a,h,u)}),i}function RT(e,t){if(t=t||{},!a0(t))throw new Error("options is invalid");var n=t.featureIndex||0,i=t.multiFeatureIndex||0,r=t.geometryIndex||0,a=t.segmentIndex||0,h=t.properties,u;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),h=h||e.features[n].properties,u=e.features[n].geometry;break;case"Feature":h=h||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var _=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=_.length+a-1),Js([_[a],_[a+1]],h,t);case"Polygon":return r<0&&(r=_.length+r),a<0&&(a=_[r].length+a-1),Js([_[r][a],_[r][a+1]],h,t);case"MultiLineString":return i<0&&(i=_.length+i),a<0&&(a=_[i].length+a-1),Js([_[i][a],_[i][a+1]],h,t);case"MultiPolygon":return i<0&&(i=_.length+i),r<0&&(r=_[i].length+r),a<0&&(a=_[i][r].length-a-1),Js([_[i][r][a],_[i][r][a+1]],h,t)}throw new Error("geojson is invalid")}function zT(e,t){if(t=t||{},!a0(t))throw new Error("options is invalid");var n=t.featureIndex||0,i=t.multiFeatureIndex||0,r=t.geometryIndex||0,a=t.coordIndex||0,h=t.properties,u;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),h=h||e.features[n].properties,u=e.features[n].geometry;break;case"Feature":h=h||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var _=u.coordinates;switch(u.type){case"Point":return us(_,h,t);case"MultiPoint":return i<0&&(i=_.length+i),us(_[i],h,t);case"LineString":return a<0&&(a=_.length+a),us(_[a],h,t);case"Polygon":return r<0&&(r=_.length+r),a<0&&(a=_[r].length+a),us(_[r][a],h,t);case"MultiLineString":return i<0&&(i=_.length+i),a<0&&(a=_[i].length+a),us(_[i][a],h,t);case"MultiPolygon":return i<0&&(i=_.length+i),r<0&&(r=_[i].length+r),a<0&&(a=_[i][r].length-a),us(_[i][r][a],h,t)}throw new Error("geojson is invalid")}const OT=Object.freeze(Object.defineProperty({__proto__:null,coordAll:PT,coordEach:xd,coordReduce:TT,featureEach:dg,featureReduce:MT,findPoint:zT,findSegment:RT,flattenEach:yf,flattenReduce:AT,geomEach:l0,geomReduce:kT,lineEach:Ew,lineReduce:NT,propEach:Sw,propReduce:LT,segmentEach:Iw,segmentReduce:DT},Symbol.toStringTag,{value:"Module"}));function X1(e){if(!e)throw new Error("geojson is required");var t=[];return yf(e,function(n){FT(n,t)}),kc(t)}function FT(e,t){var n=[],i=e.geometry;if(i!==null){switch(i.type){case"Polygon":n=hf(i);break;case"LineString":n=[hf(i)]}n.forEach(function(r){var a=BT(r,e.properties);a.forEach(function(h){h.id=t.length,t.push(h)})})}}function BT(e,t){var n=[];return e.reduce(function(i,r){var a=Js([i,r],t);return a.bbox=VT(i,r),n.push(a),r}),n}function VT(e,t){var n=e[0],i=e[1],r=t[0],a=t[1],h=n<r?n:r,u=i<a?i:a,_=n>r?n:r,w=i>a?i:a;return[h,u,_,w]}var u0={exports:{}},Cw={exports:{}};(function(e,t){(function(n,i){e.exports=i()})(lx,function(){function n(B,U,W,Q,ht){(function ut(St,lt,zt,wt,_t){for(;wt>zt;){if(wt-zt>600){var te=wt-zt+1,Pt=lt-zt+1,oe=Math.log(te),Gt=.5*Math.exp(2*oe/3),ie=.5*Math.sqrt(oe*Gt*(te-Gt)/te)*(Pt-te/2<0?-1:1),Ee=Math.max(zt,Math.floor(lt-Pt*Gt/te+ie)),an=Math.min(wt,Math.floor(lt+(te-Pt)*Gt/te+ie));ut(St,lt,Ee,an,_t)}var cn=St[lt],je=zt,Oe=wt;for(i(St,zt,lt),_t(St[wt],cn)>0&&i(St,zt,wt);je<Oe;){for(i(St,je,Oe),je++,Oe--;_t(St[je],cn)<0;)je++;for(;_t(St[Oe],cn)>0;)Oe--}_t(St[zt],cn)===0?i(St,zt,Oe):i(St,++Oe,wt),Oe<=lt&&(zt=Oe+1),lt<=Oe&&(wt=Oe-1)}})(B,U,W||0,Q||B.length-1,ht||r)}function i(B,U,W){var Q=B[U];B[U]=B[W],B[W]=Q}function r(B,U){return B<U?-1:B>U?1:0}var a=function(B){B===void 0&&(B=9),this._maxEntries=Math.max(4,B),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function h(B,U,W){if(!W)return U.indexOf(B);for(var Q=0;Q<U.length;Q++)if(W(B,U[Q]))return Q;return-1}function u(B,U){_(B,0,B.children.length,U,B)}function _(B,U,W,Q,ht){ht||(ht=q(null)),ht.minX=1/0,ht.minY=1/0,ht.maxX=-1/0,ht.maxY=-1/0;for(var ut=U;ut<W;ut++){var St=B.children[ut];w(ht,B.leaf?Q(St):St)}return ht}function w(B,U){return B.minX=Math.min(B.minX,U.minX),B.minY=Math.min(B.minY,U.minY),B.maxX=Math.max(B.maxX,U.maxX),B.maxY=Math.max(B.maxY,U.maxY),B}function S(B,U){return B.minX-U.minX}function E(B,U){return B.minY-U.minY}function M(B){return(B.maxX-B.minX)*(B.maxY-B.minY)}function k(B){return B.maxX-B.minX+(B.maxY-B.minY)}function D(B,U){return B.minX<=U.minX&&B.minY<=U.minY&&U.maxX<=B.maxX&&U.maxY<=B.maxY}function F(B,U){return U.minX<=B.maxX&&U.minY<=B.maxY&&U.maxX>=B.minX&&U.maxY>=B.minY}function q(B){return{children:B,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function X(B,U,W,Q,ht){for(var ut=[U,W];ut.length;)if(!((W=ut.pop())-(U=ut.pop())<=Q)){var St=U+Math.ceil((W-U)/Q/2)*Q;n(B,St,U,W,ht),ut.push(U,St,St,W)}}return a.prototype.all=function(){return this._all(this.data,[])},a.prototype.search=function(B){var U=this.data,W=[];if(!F(B,U))return W;for(var Q=this.toBBox,ht=[];U;){for(var ut=0;ut<U.children.length;ut++){var St=U.children[ut],lt=U.leaf?Q(St):St;F(B,lt)&&(U.leaf?W.push(St):D(B,lt)?this._all(St,W):ht.push(St))}U=ht.pop()}return W},a.prototype.collides=function(B){var U=this.data;if(!F(B,U))return!1;for(var W=[];U;){for(var Q=0;Q<U.children.length;Q++){var ht=U.children[Q],ut=U.leaf?this.toBBox(ht):ht;if(F(B,ut)){if(U.leaf||D(B,ut))return!0;W.push(ht)}}U=W.pop()}return!1},a.prototype.load=function(B){if(!B||!B.length)return this;if(B.length<this._minEntries){for(var U=0;U<B.length;U++)this.insert(B[U]);return this}var W=this._build(B.slice(),0,B.length-1,0);if(this.data.children.length)if(this.data.height===W.height)this._splitRoot(this.data,W);else{if(this.data.height<W.height){var Q=this.data;this.data=W,W=Q}this._insert(W,this.data.height-W.height-1,!0)}else this.data=W;return this},a.prototype.insert=function(B){return B&&this._insert(B,this.data.height-1),this},a.prototype.clear=function(){return this.data=q([]),this},a.prototype.remove=function(B,U){if(!B)return this;for(var W,Q,ht,ut=this.data,St=this.toBBox(B),lt=[],zt=[];ut||lt.length;){if(ut||(ut=lt.pop(),Q=lt[lt.length-1],W=zt.pop(),ht=!0),ut.leaf){var wt=h(B,ut.children,U);if(wt!==-1)return ut.children.splice(wt,1),lt.push(ut),this._condense(lt),this}ht||ut.leaf||!D(ut,St)?Q?(W++,ut=Q.children[W],ht=!1):ut=null:(lt.push(ut),zt.push(W),W=0,Q=ut,ut=ut.children[0])}return this},a.prototype.toBBox=function(B){return B},a.prototype.compareMinX=function(B,U){return B.minX-U.minX},a.prototype.compareMinY=function(B,U){return B.minY-U.minY},a.prototype.toJSON=function(){return this.data},a.prototype.fromJSON=function(B){return this.data=B,this},a.prototype._all=function(B,U){for(var W=[];B;)B.leaf?U.push.apply(U,B.children):W.push.apply(W,B.children),B=W.pop();return U},a.prototype._build=function(B,U,W,Q){var ht,ut=W-U+1,St=this._maxEntries;if(ut<=St)return u(ht=q(B.slice(U,W+1)),this.toBBox),ht;Q||(Q=Math.ceil(Math.log(ut)/Math.log(St)),St=Math.ceil(ut/Math.pow(St,Q-1))),(ht=q([])).leaf=!1,ht.height=Q;var lt=Math.ceil(ut/St),zt=lt*Math.ceil(Math.sqrt(St));X(B,U,W,zt,this.compareMinX);for(var wt=U;wt<=W;wt+=zt){var _t=Math.min(wt+zt-1,W);X(B,wt,_t,lt,this.compareMinY);for(var te=wt;te<=_t;te+=lt){var Pt=Math.min(te+lt-1,_t);ht.children.push(this._build(B,te,Pt,Q-1))}}return u(ht,this.toBBox),ht},a.prototype._chooseSubtree=function(B,U,W,Q){for(;Q.push(U),!U.leaf&&Q.length-1!==W;){for(var ht=1/0,ut=1/0,St=void 0,lt=0;lt<U.children.length;lt++){var zt=U.children[lt],wt=M(zt),_t=(te=B,Pt=zt,(Math.max(Pt.maxX,te.maxX)-Math.min(Pt.minX,te.minX))*(Math.max(Pt.maxY,te.maxY)-Math.min(Pt.minY,te.minY))-wt);_t<ut?(ut=_t,ht=wt<ht?wt:ht,St=zt):_t===ut&&wt<ht&&(ht=wt,St=zt)}U=St||U.children[0]}var te,Pt;return U},a.prototype._insert=function(B,U,W){var Q=W?B:this.toBBox(B),ht=[],ut=this._chooseSubtree(Q,this.data,U,ht);for(ut.children.push(B),w(ut,Q);U>=0&&ht[U].children.length>this._maxEntries;)this._split(ht,U),U--;this._adjustParentBBoxes(Q,ht,U)},a.prototype._split=function(B,U){var W=B[U],Q=W.children.length,ht=this._minEntries;this._chooseSplitAxis(W,ht,Q);var ut=this._chooseSplitIndex(W,ht,Q),St=q(W.children.splice(ut,W.children.length-ut));St.height=W.height,St.leaf=W.leaf,u(W,this.toBBox),u(St,this.toBBox),U?B[U-1].children.push(St):this._splitRoot(W,St)},a.prototype._splitRoot=function(B,U){this.data=q([B,U]),this.data.height=B.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},a.prototype._chooseSplitIndex=function(B,U,W){for(var Q,ht,ut,St,lt,zt,wt,_t=1/0,te=1/0,Pt=U;Pt<=W-U;Pt++){var oe=_(B,0,Pt,this.toBBox),Gt=_(B,Pt,W,this.toBBox),ie=(ht=oe,ut=Gt,St=void 0,lt=void 0,zt=void 0,wt=void 0,St=Math.max(ht.minX,ut.minX),lt=Math.max(ht.minY,ut.minY),zt=Math.min(ht.maxX,ut.maxX),wt=Math.min(ht.maxY,ut.maxY),Math.max(0,zt-St)*Math.max(0,wt-lt)),Ee=M(oe)+M(Gt);ie<_t?(_t=ie,Q=Pt,te=Ee<te?Ee:te):ie===_t&&Ee<te&&(te=Ee,Q=Pt)}return Q||W-U},a.prototype._chooseSplitAxis=function(B,U,W){var Q=B.leaf?this.compareMinX:S,ht=B.leaf?this.compareMinY:E;this._allDistMargin(B,U,W,Q)<this._allDistMargin(B,U,W,ht)&&B.children.sort(Q)},a.prototype._allDistMargin=function(B,U,W,Q){B.children.sort(Q);for(var ht=this.toBBox,ut=_(B,0,U,ht),St=_(B,W-U,W,ht),lt=k(ut)+k(St),zt=U;zt<W-U;zt++){var wt=B.children[zt];w(ut,B.leaf?ht(wt):wt),lt+=k(ut)}for(var _t=W-U-1;_t>=U;_t--){var te=B.children[_t];w(St,B.leaf?ht(te):te),lt+=k(St)}return lt},a.prototype._adjustParentBBoxes=function(B,U,W){for(var Q=W;Q>=0;Q--)w(U[Q],B)},a.prototype._condense=function(B){for(var U=B.length-1,W=void 0;U>=0;U--)B[U].children.length===0?U>0?(W=B[U-1].children).splice(W.indexOf(B[U]),1):this.clear():u(B[U],this.toBBox)},a})})(Cw);var UT=Cw.exports;const GT=cx(ET),Tw=cx(OT);var c0={};Object.defineProperty(c0,"__esModule",{value:!0});var jT=Tw;function Ny(e){var t=[1/0,1/0,-1/0,-1/0];return jT.coordEach(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Ny.default=Ny;c0.default=Ny;var Qa=UT,Lw=GT,Mw=Tw,Rh=c0.default,qT=Mw.featureEach;Mw.coordEach;Lw.polygon;var Y1=Lw.featureCollection;function Pw(e){var t=new Qa(e);return t.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Rh(n),Qa.prototype.insert.call(this,n)},t.load=function(n){var i=[];return Array.isArray(n)?n.forEach(function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Rh(r),i.push(r)}):qT(n,function(r){if(r.type!=="Feature")throw new Error("invalid features");r.bbox=r.bbox?r.bbox:Rh(r),i.push(r)}),Qa.prototype.load.call(this,i)},t.remove=function(n,i){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Rh(n),Qa.prototype.remove.call(this,n,i)},t.clear=function(){return Qa.prototype.clear.call(this)},t.search=function(n){var i=Qa.prototype.search.call(this,this.toBBox(n));return Y1(i)},t.collides=function(n){return Qa.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=Qa.prototype.all.call(this);return Y1(n)},t.toJSON=function(){return Qa.prototype.toJSON.call(this)},t.fromJSON=function(n){return Qa.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var i;if(n.bbox)i=n.bbox;else if(Array.isArray(n)&&n.length===4)i=n;else if(Array.isArray(n)&&n.length===6)i=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")i=Rh(n);else if(n.type==="FeatureCollection")i=Rh(n);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},t}u0.exports=Pw;u0.exports.default=Pw;var ZT=u0.exports;const WT=ux(ZT);function HT(e,t){var n={},i=[];if(e.type==="LineString"&&(e=pa(e)),t.type==="LineString"&&(t=pa(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var r=K1(e,t);return r&&i.push(r),kc(i)}var a=WT();return a.load(X1(t)),dg(X1(e),function(h){dg(a.search(h),function(u){var _=K1(h,u);if(_){var w=hf(_).join(",");n[w]||(n[w]=!0,i.push(_))}})}),kc(i)}function K1(e,t){var n=hf(e),i=hf(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var r=n[0][0],a=n[0][1],h=n[1][0],u=n[1][1],_=i[0][0],w=i[0][1],S=i[1][0],E=i[1][1],M=(E-w)*(h-r)-(S-_)*(u-a),k=(S-_)*(a-w)-(E-w)*(r-_),D=(h-r)*(a-w)-(u-a)*(r-_);if(M===0)return null;var F=k/M,q=D/M;if(F>=0&&F<=1&&q>=0&&q<=1){var X=r+F*(h-r),B=a+F*(u-a);return us([X,B])}return null}function $T(e,t,n){n===void 0&&(n={});var i=us([1/0,1/0],{dist:1/0}),r=0;return yf(e,function(a){for(var h=hf(a),u=0;u<h.length-1;u++){var _=us(h[u]);_.properties.dist=Tp(t,_,n);var w=us(h[u+1]);w.properties.dist=Tp(t,w,n);var S=Tp(_,w,n),E=Math.max(_.properties.dist,w.properties.dist),M=ww(_,w),k=$1(t,E,M+90,n),D=$1(t,E,M-90,n),F=HT(Js([k.geometry.coordinates,D.geometry.coordinates]),Js([_.geometry.coordinates,w.geometry.coordinates])),q=null;F.features.length>0&&(q=F.features[0],q.properties.dist=Tp(t,q,n),q.properties.location=r+Tp(_,q,n)),_.properties.dist<i.properties.dist&&(i=_,i.properties.index=u,i.properties.location=r),w.properties.dist<i.properties.dist&&(i=w,i.properties.index=u+1,i.properties.location=r+S),q&&q.properties.dist<i.properties.dist&&(i=q,i.properties.index=u),r+=S}}),i}const kw=Jn({type:"FeatureCollection",features:[]}),Aw=Jn(0),XT=100;class YT{constructor(t){Un(this,"map");Un(this,"active");Un(this,"eventListenersSuccess");Un(this,"eventListenersUpdated");Un(this,"eventListenersFailure");Un(this,"points");Un(this,"cursor");Un(this,"hover");Un(this,"dragFrom");Un(this,"previousStates");Un(this,"onMouseMove",t=>{if(this.active&&!this.dragFrom)this.recalculateHovering(t);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-t.lngLat.lng,i=this.dragFrom[1]-t.lngLat.lat;for(let r of this.points)r[0]-=n,r[1]-=i}else this.points[this.hover]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),this.redraw()}});Un(this,"onClick",t=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(J1(this.points).forEach((i,r)=>{n.push([r+1,$T(i,this.cursor).properties.dist])}),n.sort((i,r)=>i[1]-r[1]),n.length>0){let i=n[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(t))});Un(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.cursor=iy(t.lngLat.toArray()),this.onClick(t),this.finish())});Un(this,"onMouseDown",t=>{this.active&&!this.dragFrom&&this.hover!=null&&(t.preventDefault(),this.cursor=null,this.dragFrom=t.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Un(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Un(this,"onKeypress",t=>{this.active&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="z"&&t.ctrlKey&&this.undo())});Un(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});this.map=t,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersSuccess)n(t);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let t of this.eventListenersFailure)t();this.stop()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(t){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(t.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let t={type:"FeatureCollection",features:[]};this.points.forEach((r,a)=>{let h=iy(r);h.properties.hover=this.hover==a,h.properties.idx=a,t.features.push(h)}),t.features=t.features.concat(J1(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",t.features.push(n)),kw.set(t);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,Aw.set(this.previousStates.length)}pointsUpdated(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersUpdated)n(t)}recalculateHovering(t){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(t.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=iy(t.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let t=this.points.map(Vw),n=[JSON.parse(JSON.stringify(t))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>XT&&this.previousStates.shift()}}function J1(e){let t=[];for(let n=0;n<e.length-1;n++)t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[n],e[n+1]]},properties:{}});return e.length>=3&&t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[e.length-1],e[0]]},properties:{}}),t}function KT(e){let t,n,i;return{c(){t=de("Undo ("),n=de(e[1]),i=de(")")},m(r,a){xt(r,t,a),xt(r,n,a),xt(r,i,a)},p(r,a){a&2&&yi(n,r[1])},d(r){r&&(vt(t),vt(n),vt(i))}}}function JT(e){let t;return{c(){t=de("Undo")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function QT(e){let t,n,i,r,a,h;function u(S,E){return S[1]==0?JT:KT}let _=u(e),w=_(e);return{c(){t=gt("button"),w.c(),i=Xt(),r=gt("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,t.disabled=n=e[1]==0},m(S,E){xt(S,t,E),w.m(t,null),xt(S,i,E),xt(S,r,E),a||(h=Ge(t,"click",e[2]),a=!0)},p(S,[E]){_===(_=u(S))&&w?w.p(S,E):(w.d(1),w=_(S),w&&(w.c(),w.m(t,null))),E&2&&n!==(n=S[1]==0)&&(t.disabled=n)},i:Ae,o:Ae,d(S){S&&(vt(t),vt(i),vt(r)),w.d(),a=!1,h()}}}function tL(e,t,n){let i;we(e,Aw,h=>n(1,i=h));let{polygonTool:r}=t;const a=()=>r.undo();return e.$$set=h=>{"polygonTool"in h&&n(0,r=h.polygonTool)},[r,i,a]}class eL extends nn{constructor(t){super(),en(this,t,tL,QT,Ye,{polygonTool:0})}}function nL(e){let t,n,i,r,a,h,u;return{c(){t=gt("button"),t.textContent="Import current view",n=Xt(),i=gt("i"),i.textContent="or...",r=Xt(),a=gt("button"),a.textContent="Draw an area to import on the map",Mt(t,"type","button"),Mt(a,"type","button")},m(_,w){xt(_,t,w),xt(_,n,w),xt(_,i,w),xt(_,r,w),xt(_,a,w),h||(u=[Ge(t,"click",e[1]),Ge(a,"click",e[2])],h=!0)},p:Ae,i:Ae,o:Ae,d(_){_&&(vt(t),vt(n),vt(i),vt(r),vt(a)),h=!1,ro(u)}}}function iL(e){let t,n;return t=new eL({props:{polygonTool:e[0]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&1&&(a.polygonTool=i[0]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function rL(e){let t,n,i,r;const a=[iL,nL],h=[];function u(_,w){return _[0]?0:1}return t=u(e),n=h[t]=a[t](e),{c(){n.c(),i=Oo()},m(_,w){h[t].m(_,w),xt(_,i,w),r=!0},p(_,[w]){let S=t;t=u(_),t===S?h[t].p(_,w):(ti(),yt(h[S],1,1,()=>{h[S]=null}),ei(),n=h[t],n?n.p(_,w):(n=h[t]=a[t](_),n.c()),pt(n,1),n.m(i.parentNode,i))},i(_){r||(pt(n),r=!0)},o(_){yt(n),r=!1},d(_){_&&vt(i),h[t].d(_)}}}function Lp(e){return[e.lng,e.lat]}function oL(e,t,n){let{map:i}=t;const r=Ac();let a=null;async function h(S){try{r("loading","Loading from Overpass");let M=await(await fetch(Uw(S))).text();r("gotXml",M)}catch(E){r("error",E.toString())}}function u(){let S=i.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Lp(S.getSouthWest()),Lp(S.getNorthWest()),Lp(S.getNorthEast()),Lp(S.getSouthEast()),Lp(S.getSouthWest())]],type:"Polygon"}}}async function _(){if(i){if(i.getZoom()<13){r("error","Zoom in more to import");return}await h(u())}}function w(){i&&(n(0,a=new YT(i)),a.startNew(),a.addEventListenerSuccess(async S=>{n(0,a=null),await h(S)}),a.addEventListenerFailure(()=>{n(0,a=null)}))}return e.$$set=S=>{"map"in S&&n(3,i=S.map)},[a,_,w,i]}class sL extends nn{constructor(t){super(),en(this,t,oL,rL,Ye,{map:3})}}let aL=Date.now();function vf(e){return`${e}-${aL++}`}const h0=Symbol.for("svelte-maplibre");function bf(){return GS(h0)}function lL(e){let t=new WeakMap;return n=>{var h;let i=t.get(n.originalEvent);if(i!==void 0)return i;let a=(h=n.target.queryRenderedFeatures(n.point).find(u=>{var _;return(_=e.get(u.layer.id))==null?void 0:_.interactive}))==null?void 0:h.layer.id;return t.set(n.originalEvent,a),a}}function uL(){let e=new Map;return Qb(h0,{map:Jn(null),source:X_(null),layer:X_(null),popupTarget:X_(null),cluster:Jn(),loadedImages:Jn(new Set),minzoom:Jn(0),maxzoom:Jn(24),layerEvent:Jn(null),layerInfo:e,eventTopMost:lL(e)})}function Q1(e){return{subscribe:e.subscribe}}function f0({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:i=!1}){let r=bf(),a=Jn(null),h=Q1(a),u={...r,[e]:Q1(a)};if(t&&(u.popupTarget=h),i){let _=Jn(null);u.layerEvent=_,r.layerEvent=_}return n&&(u.cluster=Jn()),Qb(h0,u),{...r,self:a}}function cL(){return f0({key:"source",setCluster:!0})}function hL(e=!0){return f0({key:"layer",setPopupTarget:e,setMouseEvent:e})}function fL(){return f0({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function pL(e){return"layerType"in e&&e.layerType==="deckgl"}function tb(e){let t;return n=>{if(n)for(let i in n){let r=t==null?void 0:t[i],a=n[i];r!==a&&e(i,a,r)}else if(t)for(let i in t)e(i,void 0,t[i]);t=n}}function dL(e,...t){let n=[e];for(let i of t)if(i)Array.isArray(i)&&i[0]===e?n.push(...i.slice(1)):n.push(i);else continue;if(n.length!==1)return n.length===2?n[1]:n}function mL(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function Ry(e,t){return["case",["boolean",["feature-state","hover"],!1],t,e]}var mg=gL;function gL(e){var t,n,i;if(e){if(Array.isArray(e)){for(t=[],n=e.length,i=0;i<n;i++){var r=e[i];r!=null&&t.push(r)}return t}if(typeof e=="object"){t={};var a=Object.keys(e);for(n=a.length,i=0;i<n;i++){var h=a[i],u=e[h];u!=null&&(t[h]=u)}return t}}}function eb(e){let t=e[0],n,i,r=nb(e);return{c(){r.c(),n=Oo()},m(a,h){r.m(a,h),xt(a,n,h),i=!0},p(a,h){h[0]&1&&Ye(t,t=a[0])?(ti(),yt(r,1,1,Ae),ei(),r=nb(a),r.c(),pt(r,1),r.m(n.parentNode,n)):r.p(a,h)},i(a){i||(pt(r),i=!0)},o(a){yt(r),i=!1},d(a){a&&vt(n),r.d(a)}}}function nb(e){let t;const n=e[36].default,i=ir(n,e,e[35],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a[1]&16)&&or(i,n,r,r[35],t?rr(n,r[35],a,null):sr(r[35]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function _L(e){let t,n,i=e[0]&&eb(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,a){r[0]?i?(i.p(r,a),a[0]&1&&pt(i,1)):(i=eb(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function yL(e,t,n){let i,r,a,h,u,_,w,S,E,M,k,D,{$$slots:F={},$$scope:q}=t,{id:X=vf("layer")}=t,{source:B=void 0}=t,{sourceLayer:U=void 0}=t,{beforeId:W=void 0}=t,{beforeLayerType:Q=void 0}=t,{type:ht}=t,{paint:ut=void 0}=t,{layout:St=void 0}=t,{filter:lt=void 0}=t,{applyToClusters:zt=void 0}=t,{minzoom:wt=void 0}=t,{maxzoom:_t=void 0}=t,{manageHoverState:te=!1}=t,{hovered:Pt=null}=t,{interactive:oe=!0}=t,{hoverCursor:Gt=void 0}=t,{eventsIfTopMost:ie=!1}=t;const Ee=Ac(),{map:an,source:cn,self:je,minzoom:Oe,maxzoom:wn,eventTopMost:In,layerInfo:Sn}=hL();we(e,an,Tt=>n(31,E=Tt)),we(e,cn,Tt=>n(32,M=Tt)),we(e,je,Tt=>n(0,S=Tt)),we(e,Oe,Tt=>n(34,D=Tt)),we(e,wn,Tt=>n(33,k=Tt)),na(()=>{S&&E&&(Sn.delete(S),E==null||E.removeLayer(S))});let Bn;function Vn(Tt){var Bt,yn;if(!oe||!S||!E||ie&&In(Tt)!==S)return;let We=Tt.features??[],Le=(yn=(Bt=We[0])==null?void 0:Bt.properties)==null?void 0:yn.cluster_id,Ji={event:Tt,map:E,clusterId:Le,layer:S,source:u,features:We};Ee(Tt.type,Ji)}function ne(Tt){var Bt,yn;if(!oe||!S||!E||ie&&In(Tt)!==S)return;Gt&&(E.getCanvas().style.cursor=Gt);let We=Tt.features??[];n(6,Pt=We[0]??null);let Le=(yn=(Bt=We[0])==null?void 0:Bt.properties)==null?void 0:yn.cluster_id;Ee("mouseenter",{event:Tt,map:E,clusterId:Le,layer:S,source:u,features:We})}function Ie(Tt){var Bt,yn,ar;if(!oe||!E)return;if(ie&&In(Tt)!==S){n(6,Pt=null),te&&Bn!==void 0&&(E==null||E.setFeatureState({source:u,sourceLayer:U,id:Bn},{hover:!1}),Bn=void 0);return}E.getCanvas().style.cursor=Gt;let We=Tt.features??[],Le=(yn=(Bt=We[0])==null?void 0:Bt.properties)==null?void 0:yn.cluster_id,Ji=(ar=We[0])==null?void 0:ar.id;Ji!==Bn&&(te&&(Bn!==void 0&&(E==null||E.setFeatureState({source:u,id:Bn,sourceLayer:U},{hover:!1})),E==null||E.setFeatureState({source:u,id:Ji,sourceLayer:U},{hover:!0})),Bn=Ji,n(6,Pt=We[0]??null)),Ee("mousemove",{event:Tt,map:E,clusterId:Le,layer:S,source:u,features:We})}function Fe(Tt){if(!(!oe||!S||!E)){if(Gt&&(E.getCanvas().style.cursor=""),n(6,Pt=null),te&&Bn!==void 0){const We={source:u,id:Bn,sourceLayer:U};E==null||E.setFeatureState(We,{hover:!1}),Bn=void 0}Ee("mouseleave",{map:E,layer:S,source:u})}}let zn=!0;function Ki(Tt){E&&(E.off("click",Tt,Vn),E.off("dblclick",Tt,Vn),E.off("contextmenu",Tt,Vn),E.off("mouseenter",Tt,ne),E.off("mousemove",Tt,Ie),E.off("mouseleave",Tt,Fe))}return na(()=>{E&&S&&Ki(S)}),e.$$set=Tt=>{"id"in Tt&&n(7,X=Tt.id),"source"in Tt&&n(8,B=Tt.source),"sourceLayer"in Tt&&n(9,U=Tt.sourceLayer),"beforeId"in Tt&&n(10,W=Tt.beforeId),"beforeLayerType"in Tt&&n(11,Q=Tt.beforeLayerType),"type"in Tt&&n(12,ht=Tt.type),"paint"in Tt&&n(13,ut=Tt.paint),"layout"in Tt&&n(14,St=Tt.layout),"filter"in Tt&&n(15,lt=Tt.filter),"applyToClusters"in Tt&&n(16,zt=Tt.applyToClusters),"minzoom"in Tt&&n(17,wt=Tt.minzoom),"maxzoom"in Tt&&n(18,_t=Tt.maxzoom),"manageHoverState"in Tt&&n(19,te=Tt.manageHoverState),"hovered"in Tt&&n(6,Pt=Tt.hovered),"interactive"in Tt&&n(20,oe=Tt.interactive),"hoverCursor"in Tt&&n(21,Gt=Tt.hoverCursor),"eventsIfTopMost"in Tt&&n(22,ie=Tt.eventsIfTopMost),"$$scope"in Tt&&n(35,q=Tt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,i=mL(zt)),e.$$.dirty[0]&1073774592&&n(24,r=dL("all",i,lt)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,a=wt??D),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,h=_t??k),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,u=B||M),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&E&&S!==X&&u){S&&(Ki(S),Sn.delete(S));let Tt=W;if(!W&&Q){let We=E.getStyle().layers,Le=typeof Q=="function"?Q:Bt=>Bt.type===Q,Ji=We==null?void 0:We.find(Le);Ji&&(Tt=Ji.id)}Xe(je,S=X,S),E.addLayer(mg({id:S,type:ht,source:u,"source-layer":U,filter:r,paint:ut,layout:St,minzoom:a,maxzoom:h}),Tt),n(23,zn=!0),E.on("click",S,Vn),E.on("dblclick",S,Vn),E.on("contextmenu",S,Vn),E.on("mouseenter",S,ne),E.on("mousemove",S,Ie),E.on("mouseleave",S,Fe)}e.$$.dirty[0]&1048577&&S&&Sn.set(S,{interactive:oe}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,_=S?tb((Tt,We)=>E==null?void 0:E.setPaintProperty(S,Tt,We)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,w=S?tb((Tt,We)=>E==null?void 0:E.setLayoutProperty(S,Tt,We)):void 0),e.$$.dirty[0]&268443648&&(_==null||_(ut)),e.$$.dirty[0]&134234112&&(w==null||w(St)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&S&&(E==null||E.setLayerZoomRange(S,a,h)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&S&&(zn?n(23,zn=!1):E==null||E.setFilter(S,r))},[S,an,cn,je,Oe,wn,Pt,X,B,U,W,Q,ht,ut,St,lt,zt,wt,_t,te,oe,Gt,ie,zn,r,h,a,w,_,u,i,E,M,k,D,q,F]}class Fg extends nn{constructor(t){super(),en(this,t,yL,_L,Ye,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function vL(e){let t;const n=e[16].default,i=ir(n,e,e[24],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&16777216)&&or(i,n,r,r[24],t?rr(n,r[24],a,null):sr(r[24]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function bL(e){let t,n,i;function r(h){e[17](h)}let a={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[vL]},$$scope:{ctx:e}};return e[0]!==void 0&&(a.hovered=e[0]),t=new Fg({props:a}),Or.push(()=>_c(t,"hovered",r)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){Wt(t.$$.fragment)},m(h,u){jt(t,h,u),i=!0},p(h,[u]){const _={};u&2&&(_.id=h[1]),u&4&&(_.source=h[2]),u&8&&(_.sourceLayer=h[3]),u&16&&(_.beforeId=h[4]),u&32&&(_.beforeLayerType=h[5]),u&64&&(_.paint=h[6]),u&128&&(_.layout=h[7]),u&256&&(_.filter=h[8]),u&512&&(_.applyToClusters=h[9]),u&1024&&(_.minzoom=h[10]),u&2048&&(_.maxzoom=h[11]),u&4096&&(_.hoverCursor=h[12]),u&8192&&(_.manageHoverState=h[13]),u&16384&&(_.eventsIfTopMost=h[14]),u&32768&&(_.interactive=h[15]),u&16777216&&(_.$$scope={dirty:u,ctx:h}),!n&&u&1&&(n=!0,_.hovered=h[0],gc(()=>n=!1)),t.$set(_)},i(h){i||(pt(t.$$.fragment,h),i=!0)},o(h){yt(t.$$.fragment,h),i=!1},d(h){qt(t,h)}}}function xL(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:a=vf("circle")}=t,{source:h=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:w=void 0}=t,{paint:S}=t,{layout:E=void 0}=t,{filter:M=void 0}=t,{applyToClusters:k=void 0}=t,{minzoom:D=void 0}=t,{maxzoom:F=void 0}=t,{hoverCursor:q=void 0}=t,{manageHoverState:X=!1}=t,{hovered:B=null}=t,{eventsIfTopMost:U=!1}=t,{interactive:W=!0}=t;function Q(_t){B=_t,n(0,B)}function ht(_t){ii.call(this,e,_t)}function ut(_t){ii.call(this,e,_t)}function St(_t){ii.call(this,e,_t)}function lt(_t){ii.call(this,e,_t)}function zt(_t){ii.call(this,e,_t)}function wt(_t){ii.call(this,e,_t)}return e.$$set=_t=>{"id"in _t&&n(1,a=_t.id),"source"in _t&&n(2,h=_t.source),"sourceLayer"in _t&&n(3,u=_t.sourceLayer),"beforeId"in _t&&n(4,_=_t.beforeId),"beforeLayerType"in _t&&n(5,w=_t.beforeLayerType),"paint"in _t&&n(6,S=_t.paint),"layout"in _t&&n(7,E=_t.layout),"filter"in _t&&n(8,M=_t.filter),"applyToClusters"in _t&&n(9,k=_t.applyToClusters),"minzoom"in _t&&n(10,D=_t.minzoom),"maxzoom"in _t&&n(11,F=_t.maxzoom),"hoverCursor"in _t&&n(12,q=_t.hoverCursor),"manageHoverState"in _t&&n(13,X=_t.manageHoverState),"hovered"in _t&&n(0,B=_t.hovered),"eventsIfTopMost"in _t&&n(14,U=_t.eventsIfTopMost),"interactive"in _t&&n(15,W=_t.interactive),"$$scope"in _t&&n(24,r=_t.$$scope)},[B,a,h,u,_,w,S,E,M,k,D,F,q,X,U,W,i,Q,ht,ut,St,lt,zt,wt,r]}class wd extends nn{constructor(t){super(),en(this,t,xL,bL,Ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function wL(e){let t;const n=e[15].default,i=ir(n,e,e[23],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&8388608)&&or(i,n,r,r[23],t?rr(n,r[23],a,null):sr(r[23]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function SL(e){let t,n,i;function r(h){e[16](h)}let a={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[wL]},$$scope:{ctx:e}};return e[0]!==void 0&&(a.hovered=e[0]),t=new Fg({props:a}),Or.push(()=>_c(t,"hovered",r)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){Wt(t.$$.fragment)},m(h,u){jt(t,h,u),i=!0},p(h,[u]){const _={};u&2&&(_.id=h[1]),u&4&&(_.source=h[2]),u&8&&(_.sourceLayer=h[3]),u&16&&(_.beforeId=h[4]),u&32&&(_.beforeLayerType=h[5]),u&64&&(_.paint=h[6]),u&128&&(_.layout=h[7]),u&256&&(_.filter=h[8]),u&512&&(_.minzoom=h[9]),u&1024&&(_.maxzoom=h[10]),u&2048&&(_.hoverCursor=h[11]),u&4096&&(_.manageHoverState=h[12]),u&8192&&(_.eventsIfTopMost=h[13]),u&16384&&(_.interactive=h[14]),u&8388608&&(_.$$scope={dirty:u,ctx:h}),!n&&u&1&&(n=!0,_.hovered=h[0],gc(()=>n=!1)),t.$set(_)},i(h){i||(pt(t.$$.fragment,h),i=!0)},o(h){yt(t.$$.fragment,h),i=!1},d(h){qt(t,h)}}}function IL(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:a=vf("fill")}=t,{source:h=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:w=void 0}=t,{paint:S}=t,{layout:E=void 0}=t,{filter:M=void 0}=t,{minzoom:k=void 0}=t,{maxzoom:D=void 0}=t,{hoverCursor:F=void 0}=t,{manageHoverState:q=!1}=t,{hovered:X=null}=t,{eventsIfTopMost:B=!1}=t,{interactive:U=!0}=t;function W(wt){X=wt,n(0,X)}function Q(wt){ii.call(this,e,wt)}function ht(wt){ii.call(this,e,wt)}function ut(wt){ii.call(this,e,wt)}function St(wt){ii.call(this,e,wt)}function lt(wt){ii.call(this,e,wt)}function zt(wt){ii.call(this,e,wt)}return e.$$set=wt=>{"id"in wt&&n(1,a=wt.id),"source"in wt&&n(2,h=wt.source),"sourceLayer"in wt&&n(3,u=wt.sourceLayer),"beforeId"in wt&&n(4,_=wt.beforeId),"beforeLayerType"in wt&&n(5,w=wt.beforeLayerType),"paint"in wt&&n(6,S=wt.paint),"layout"in wt&&n(7,E=wt.layout),"filter"in wt&&n(8,M=wt.filter),"minzoom"in wt&&n(9,k=wt.minzoom),"maxzoom"in wt&&n(10,D=wt.maxzoom),"hoverCursor"in wt&&n(11,F=wt.hoverCursor),"manageHoverState"in wt&&n(12,q=wt.manageHoverState),"hovered"in wt&&n(0,X=wt.hovered),"eventsIfTopMost"in wt&&n(13,B=wt.eventsIfTopMost),"interactive"in wt&&n(14,U=wt.interactive),"$$scope"in wt&&n(23,r=wt.$$scope)},[X,a,h,u,_,w,S,E,M,k,D,F,q,B,U,i,W,Q,ht,ut,St,lt,zt,r]}class xf extends nn{constructor(t){super(),en(this,t,IL,SL,Ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function EL(e,t,n){let i;const{map:r}=bf();we(e,r,_=>n(4,i=_));let{position:a="top-left"}=t,{container:h=void 0}=t,u=null;return na(()=>{i!=null&&i.loaded()&&u&&i.removeControl(u)}),e.$$set=_=>{"position"in _&&n(1,a=_.position),"container"in _&&n(2,h=_.container)},e.$$.update=()=>{if(e.$$.dirty&30&&i&&!u){let _;typeof h=="string"?_=document.querySelector(h)??void 0:_=h,n(3,u=new Ls.FullscreenControl({container:_})),i.addControl(u,a)}},[r,a,h,u,i]}class CL extends nn{constructor(t){super(),en(this,t,EL,null,Ye,{position:1,container:2})}}function TL(e,t,n,i,r){let a=!1;e.getSource(t)&&(a=!0,e.removeSource(t));const h=()=>{i(t)&&(e.addSource(t,n),r())};if(a){const u=()=>{t&&(e.getSource(t)?setTimeout(u,1):h())};u()}else h()}function LL(e,t,n){jS().then(()=>{let i=Ta(e);if(!i)return;i.getSource(t)===n&&i.removeSource(t)})}function ib(e){let t=e[0],n,i,r=rb(e);return{c(){r.c(),n=Oo()},m(a,h){r.m(a,h),xt(a,n,h),i=!0},p(a,h){h&1&&Ye(t,t=a[0])?(ti(),yt(r,1,1,Ae),ei(),r=rb(a),r.c(),pt(r,1),r.m(n.parentNode,n)):r.p(a,h)},i(a){i||(pt(r),i=!0)},o(a){yt(r),i=!1},d(a){a&&vt(n),r.d(a)}}}function rb(e){let t;const n=e[15].default,i=ir(n,e,e[14],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&16384)&&or(i,n,r,r[14],t?rr(n,r[14],a,null):sr(r[14]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function ML(e){let t,n,i=e[0]&&ib(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,[a]){r[0]?i?(i.p(r,a),a&1&&pt(i,1)):(i=ib(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function PL(e,t,n){let i,r,a,{$$slots:h={},$$scope:u}=t,{id:_=vf("geojson")}=t,{data:w}=t,{generateId:S=!1}=t,{promoteId:E=void 0}=t,{filter:M=void 0}=t,{lineMetrics:k=void 0}=t,{cluster:D=void 0}=t;const{map:F,cluster:q,self:X}=cL();we(e,F,W=>n(13,r=W)),we(e,q,W=>n(16,a=W)),we(e,X,W=>n(0,i=W));let B,U=!0;return na(()=>{i&&B&&r&&(LL(F,i,B),Xe(X,i=null,i),n(11,B=void 0))}),e.$$set=W=>{"id"in W&&n(4,_=W.id),"data"in W&&n(5,w=W.data),"generateId"in W&&n(6,S=W.generateId),"promoteId"in W&&n(7,E=W.promoteId),"filter"in W&&n(8,M=W.filter),"lineMetrics"in W&&n(9,k=W.lineMetrics),"cluster"in W&&n(10,D=W.cluster),"$$scope"in W&&n(14,u=W.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&Xe(q,a=D,a),e.$$.dirty&12273&&r&&i!==_&&(Xe(X,i=_,i),TL(r,i,mg({type:"geojson",data:w,filter:M,lineMetrics:k,generateId:S,promoteId:E,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties}),W=>r&&W===i,()=>{i&&(n(11,B=r==null?void 0:r.getSource(i)),n(12,U=!0))})),e.$$.dirty&8208&&(r==null||r.on("style.load",()=>{n(11,B=r==null?void 0:r.getSource(_))})),e.$$.dirty&6176&&B&&(U?n(12,U=!1):B.setData(w)),e.$$.dirty&3072&&(B==null||B.setClusterOptions(mg({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[i,F,q,X,_,w,S,E,M,k,D,B,U,r,u,h]}class ks extends nn{constructor(t){super(),en(this,t,PL,ML,Ye,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function kL(e,t,n){let i;const{map:r}=bf();we(e,r,M=>n(8,i=M));let{position:a="top-left"}=t,{positionOptions:h=void 0}=t,{fitBoundsOptions:u=void 0}=t,{trackUserLocation:_=!1}=t,{showAccuracyCircle:w=!0}=t,{showUserLocation:S=!0}=t,E=null;return na(()=>{i!=null&&i.loaded()&&E&&i.removeControl(E)}),e.$$set=M=>{"position"in M&&n(1,a=M.position),"positionOptions"in M&&n(2,h=M.positionOptions),"fitBoundsOptions"in M&&n(3,u=M.fitBoundsOptions),"trackUserLocation"in M&&n(4,_=M.trackUserLocation),"showAccuracyCircle"in M&&n(5,w=M.showAccuracyCircle),"showUserLocation"in M&&n(6,S=M.showUserLocation)},e.$$.update=()=>{e.$$.dirty&510&&i&&!E&&(n(7,E=new Ls.GeolocateControl({positionOptions:h,fitBoundsOptions:u,trackUserLocation:_,showAccuracyCircle:w,showUserLocation:S})),i.addControl(E,a))},[r,a,h,u,_,w,S,E,i]}class AL extends nn{constructor(t){super(),en(this,t,kL,null,Ye,{position:1,positionOptions:2,fitBoundsOptions:3,trackUserLocation:4,showAccuracyCircle:5,showUserLocation:6})}}function DL(e){let t;const n=e[15].default,i=ir(n,e,e[23],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&8388608)&&or(i,n,r,r[23],t?rr(n,r[23],a,null):sr(r[23]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function NL(e){let t,n,i;function r(h){e[16](h)}let a={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[DL]},$$scope:{ctx:e}};return e[0]!==void 0&&(a.hovered=e[0]),t=new Fg({props:a}),Or.push(()=>_c(t,"hovered",r)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){Wt(t.$$.fragment)},m(h,u){jt(t,h,u),i=!0},p(h,[u]){const _={};u&2&&(_.id=h[1]),u&4&&(_.source=h[2]),u&8&&(_.sourceLayer=h[3]),u&16&&(_.beforeId=h[4]),u&32&&(_.beforeLayerType=h[5]),u&64&&(_.paint=h[6]),u&128&&(_.layout=h[7]),u&256&&(_.filter=h[8]),u&512&&(_.minzoom=h[9]),u&1024&&(_.maxzoom=h[10]),u&2048&&(_.hoverCursor=h[11]),u&4096&&(_.manageHoverState=h[12]),u&8192&&(_.eventsIfTopMost=h[13]),u&16384&&(_.interactive=h[14]),u&8388608&&(_.$$scope={dirty:u,ctx:h}),!n&&u&1&&(n=!0,_.hovered=h[0],gc(()=>n=!1)),t.$set(_)},i(h){i||(pt(t.$$.fragment,h),i=!0)},o(h){yt(t.$$.fragment,h),i=!1},d(h){qt(t,h)}}}function RL(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:a=vf("line")}=t,{source:h=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:w=void 0}=t,{paint:S}=t,{layout:E=void 0}=t,{filter:M=void 0}=t,{minzoom:k=void 0}=t,{maxzoom:D=void 0}=t,{hoverCursor:F=void 0}=t,{manageHoverState:q=!1}=t,{hovered:X=null}=t,{eventsIfTopMost:B=!1}=t,{interactive:U=!0}=t;function W(wt){X=wt,n(0,X)}function Q(wt){ii.call(this,e,wt)}function ht(wt){ii.call(this,e,wt)}function ut(wt){ii.call(this,e,wt)}function St(wt){ii.call(this,e,wt)}function lt(wt){ii.call(this,e,wt)}function zt(wt){ii.call(this,e,wt)}return e.$$set=wt=>{"id"in wt&&n(1,a=wt.id),"source"in wt&&n(2,h=wt.source),"sourceLayer"in wt&&n(3,u=wt.sourceLayer),"beforeId"in wt&&n(4,_=wt.beforeId),"beforeLayerType"in wt&&n(5,w=wt.beforeLayerType),"paint"in wt&&n(6,S=wt.paint),"layout"in wt&&n(7,E=wt.layout),"filter"in wt&&n(8,M=wt.filter),"minzoom"in wt&&n(9,k=wt.minzoom),"maxzoom"in wt&&n(10,D=wt.maxzoom),"hoverCursor"in wt&&n(11,F=wt.hoverCursor),"manageHoverState"in wt&&n(12,q=wt.manageHoverState),"hovered"in wt&&n(0,X=wt.hovered),"eventsIfTopMost"in wt&&n(13,B=wt.eventsIfTopMost),"interactive"in wt&&n(14,U=wt.interactive),"$$scope"in wt&&n(23,r=wt.$$scope)},[X,a,h,u,_,w,S,E,M,k,D,F,q,B,U,i,W,Q,ht,ut,St,lt,zt,r]}class Ql extends nn{constructor(t){super(),en(this,t,RL,NL,Ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function zL(e){let t=e.getCenter(),n=Math.round(e.getZoom()*100)/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),a=Math.round(t.lat*r)/r,h=Math.round(t.lng*r)/r,u=`${n}/${a}/${h}`,_=e.getBearing(),w=e.getPitch();return(_||w)&&(u+=`/${Math.round(_*10)/10}`),w&&(u+=`/${Math.round(w)}`),`#${u}`}function OL(e){return e.replace("#","").split("/").map(parseFloat)}var Bm=p0;function p0(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?ob(e,t):{}.toString.call(e)=="[object Set]"?ob(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?BL(e,t):FL(e,t)}function FL(e,t){return e.toString()===t.toString()}function ob(e,t){var n=e.length;if(n!=t.length)return!1;for(var i=0;i<n;i++)if(!p0(e[i],t[i]))return!1;return!0}function BL(e,t){var n=Object.keys(e),i=n.length;if(i!=Object.keys(t).length)return!1;for(var r=0;r<i;r++){var a=n[r];if(!(t.hasOwnProperty(a)&&p0(e[a],t[a])))return!1}return!0}function VL(e,t,n){let i;const{map:r}=bf();we(e,r,S=>n(6,i=S));let{position:a="top-left"}=t,{showCompass:h=!0}=t,{showZoom:u=!0}=t,{visualizePitch:_=!1}=t,w=null;return na(()=>{i!=null&&i.loaded()&&w&&i.removeControl(w)}),e.$$set=S=>{"position"in S&&n(1,a=S.position),"showCompass"in S&&n(2,h=S.showCompass),"showZoom"in S&&n(3,u=S.showZoom),"visualizePitch"in S&&n(4,_=S.visualizePitch)},e.$$.update=()=>{e.$$.dirty&126&&i&&!w&&(n(5,w=new Ls.NavigationControl({showCompass:h,showZoom:u,visualizePitch:_})),i.addControl(w,a))},[r,a,h,u,_,w,i]}class UL extends nn{constructor(t){super(),en(this,t,VL,null,Ye,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function GL(e,t,n){let i;const{map:r}=bf();we(e,r,w=>n(5,i=w));let{position:a="bottom-left"}=t,{maxWidth:h=void 0}=t,{unit:u="metric"}=t,_=null;return na(()=>{i!=null&&i.loaded()&&_&&i.removeControl(_)}),e.$$set=w=>{"position"in w&&n(1,a=w.position),"maxWidth"in w&&n(2,h=w.maxWidth),"unit"in w&&n(3,u=w.unit)},e.$$.update=()=>{e.$$.dirty&62&&i&&!_&&(n(4,_=new Ls.ScaleControl({maxWidth:h,unit:u})),i.addControl(_,a))},[r,a,h,u,_,i]}class jL extends nn{constructor(t){super(),en(this,t,GL,null,Ye,{position:1,maxWidth:2,unit:3})}}const qL=e=>({map:e[0]&8,loadedImages:e[0]&16,allImagesLoaded:e[0]&32}),sb=e=>({map:e[3],loadedImages:e[4],allImagesLoaded:e[5]});function ab(e){let t,n,i=e[2]&&lb(e);const r=e[35].default,a=ir(r,e,e[34],sb);return{c(){i&&i.c(),t=Xt(),a&&a.c()},m(h,u){i&&i.m(h,u),xt(h,t,u),a&&a.m(h,u),n=!0},p(h,u){h[2]?i?(i.p(h,u),u[0]&4&&pt(i,1)):(i=lb(h),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei()),a&&a.p&&(!n||u[0]&56|u[1]&8)&&or(a,r,h,h[34],n?rr(r,h[34],u,qL):sr(h[34]),sb)},i(h){n||(pt(i),pt(a,h),n=!0)},o(h){yt(i),yt(a,h),n=!1},d(h){h&&vt(t),i&&i.d(h),a&&a.d(h)}}}function lb(e){let t,n,i,r,a,h,u,_;return t=new UL({props:{position:e[6]}}),i=new AL({props:{position:e[6],fitBoundsOptions:{maxZoom:12}}}),a=new CL({props:{position:e[6]}}),u=new jL({props:{position:e[6]}}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment),r=Xt(),Wt(a.$$.fragment),h=Xt(),Wt(u.$$.fragment)},m(w,S){jt(t,w,S),xt(w,n,S),jt(i,w,S),xt(w,r,S),jt(a,w,S),xt(w,h,S),jt(u,w,S),_=!0},p(w,S){const E={};S[0]&64&&(E.position=w[6]),t.$set(E);const M={};S[0]&64&&(M.position=w[6]),i.$set(M);const k={};S[0]&64&&(k.position=w[6]),a.$set(k);const D={};S[0]&64&&(D.position=w[6]),u.$set(D)},i(w){_||(pt(t.$$.fragment,w),pt(i.$$.fragment,w),pt(a.$$.fragment,w),pt(u.$$.fragment,w),_=!0)},o(w){yt(t.$$.fragment,w),yt(i.$$.fragment,w),yt(a.$$.fragment,w),yt(u.$$.fragment,w),_=!1},d(w){w&&(vt(n),vt(r),vt(h)),qt(t,w),qt(i,w),qt(a,w),qt(u,w)}}}function ZL(e){let t,n,i,r,a,h=e[3]&&e[0]&&ab(e);return{c(){t=gt("div"),h&&h.c(),Mt(t,"class",n=$m(e[1])+" svelte-p00lfq"),rl(t,"expand-map",!e[1])},m(u,_){xt(u,t,_),h&&h.m(t,null),i=!0,r||(a=ry(e[9].call(null,t)),r=!0)},p(u,_){u[3]&&u[0]?h?(h.p(u,_),_[0]&9&&pt(h,1)):(h=ab(u),h.c(),pt(h,1),h.m(t,null)):h&&(ti(),yt(h,1,1,()=>{h=null}),ei()),(!i||_[0]&2&&n!==(n=$m(u[1])+" svelte-p00lfq"))&&Mt(t,"class",n),(!i||_[0]&2)&&rl(t,"expand-map",!u[1])},i(u){i||(pt(h),i=!0)},o(u){yt(h),i=!1},d(u){u&&vt(t),h&&h.d(),r=!1,a()}}}function WL(e,t,n){let i,r,a,h,{$$slots:u={},$$scope:_}=t,{map:w=null}=t,{class:S=void 0}=t,{style:E}=t,{diffStyleUpdates:M=!1}=t,{center:k=void 0}=t,{zoom:D=void 0}=t,{pitch:F=0}=t,{bearing:q=0}=t,{bounds:X=void 0}=t,{hash:B=!1}=t,{loaded:U=!1}=t,{minZoom:W=0}=t,{maxZoom:Q=22}=t,{zoomOnDoubleClick:ht=!0}=t,{locale:ut=void 0}=t,{interactive:St=!0}=t,{attributionControl:lt=!0}=t,{cooperativeGestures:zt=!1}=t,{preserveDrawingBuffer:wt=!1}=t,{maxBounds:_t=void 0}=t,{images:te=[]}=t,{standardControls:Pt=!1}=t,{filterLayers:oe=void 0}=t,{transformRequest:Gt=void 0}=t;const ie=Ac(),{map:Ee,loadedImages:an}=uL();we(e,Ee,ne=>n(3,a=ne)),we(e,an,ne=>n(4,h=ne));let cn=new Set;async function je(ne){if(a!=null&&a.loaded())if("url"in ne){cn.add(ne.id);try{let Ie=await a.loadImage(ne.url);a==null||a.addImage(ne.id,Ie.data,ne.options),h.add(ne.id),an.set(h)}catch(Ie){ie("error",Ie)}finally{cn.delete(ne.id)}}else a.addImage(ne.id,ne.data,ne.options),h.add(ne.id),an.set(h)}let Oe,wn,In,Sn;function Bn(ne){if(B){let Ie=OL(window.location.hash);Ie.length>=3&&(n(11,D=Ie[0]),n(10,k=[Ie[2],Ie[1]])),Ie.length==5&&(n(15,q=Ie[3]),n(14,F=Ie[4]))}return Xe(Ee,a=new Ls.Map(mg({container:ne,style:E,locale:ut,center:k,zoom:D,pitch:F,bearing:q,minZoom:W,maxZoom:Q,interactive:St,preserveDrawingBuffer:wt,maxBounds:_t,bounds:X,attributionControl:lt,transformRequest:Gt,cooperativeGestures:zt})),a),a.on("load",Ie=>{n(0,U=!0),ie("load",a)}),a.on("error",Ie=>ie("error",{...Ie,map:a})),a.on("movestart",Ie=>ie("movestart",{...Ie,map:a})),a.on("moveend",Ie=>{if(n(10,k=Ie.target.getCenter()),n(11,D=Ie.target.getZoom()),n(12,X=Ie.target.getBounds()),ie("moveend",{...Ie,map:a}),B){let Fe=window.location.href.replace(/(#.+)?$/,zL(a));window.history.replaceState(window.history.state,"",Fe)}}),a.on("zoomstart",Ie=>ie("zoomstart",{...Ie,map:a})),a.on("zoom",Ie=>{n(11,D=Ie.target.getZoom()),ie("zoom",{...Ie,map:a})}),a.on("zoomend",Ie=>{n(11,D=Ie.target.getZoom()),ie("zoomend",{...Ie,map:a})}),a.on("style.load",()=>{if(a){const Ie=a.getStyle();if(n(31,Oe=Ie.layers.map(Fe=>Fe.id)),n(32,wn=Object.keys(Ie.sources)),Sn)for(const[Fe,zn]of Object.entries(Sn))a.addSource(Fe,zn);if(In)for(const Fe of In)a.addLayer(Fe)}}),a.on("styledata",Ie=>{if(a&&oe){const Fe=a.getStyle().layers;if(Fe)for(let zn of Fe)oe(zn)||a.setLayoutProperty(zn.id,"visibility","none")}ie("styledata",{...Ie,map:a})}),{destroy(){n(0,U=!1),a==null||a.remove(),Xe(Ee,a=null,a)}}}let Vn=E;return e.$$set=ne=>{"map"in ne&&n(13,w=ne.map),"class"in ne&&n(1,S=ne.class),"style"in ne&&n(16,E=ne.style),"diffStyleUpdates"in ne&&n(17,M=ne.diffStyleUpdates),"center"in ne&&n(10,k=ne.center),"zoom"in ne&&n(11,D=ne.zoom),"pitch"in ne&&n(14,F=ne.pitch),"bearing"in ne&&n(15,q=ne.bearing),"bounds"in ne&&n(12,X=ne.bounds),"hash"in ne&&n(18,B=ne.hash),"loaded"in ne&&n(0,U=ne.loaded),"minZoom"in ne&&n(19,W=ne.minZoom),"maxZoom"in ne&&n(20,Q=ne.maxZoom),"zoomOnDoubleClick"in ne&&n(21,ht=ne.zoomOnDoubleClick),"locale"in ne&&n(22,ut=ne.locale),"interactive"in ne&&n(23,St=ne.interactive),"attributionControl"in ne&&n(24,lt=ne.attributionControl),"cooperativeGestures"in ne&&n(25,zt=ne.cooperativeGestures),"preserveDrawingBuffer"in ne&&n(26,wt=ne.preserveDrawingBuffer),"maxBounds"in ne&&n(27,_t=ne.maxBounds),"images"in ne&&n(28,te=ne.images),"standardControls"in ne&&n(2,Pt=ne.standardControls),"filterLayers"in ne&&n(29,oe=ne.filterLayers),"transformRequest"in ne&&n(30,Gt=ne.transformRequest),"$$scope"in ne&&n(34,_=ne.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&4&&n(6,i=typeof Pt=="boolean"?void 0:Pt),e.$$.dirty[0]&8&&n(13,w=a),e.$$.dirty[0]&268435465&&U&&a!=null&&a.loaded())for(let ne of te)!cn.has(ne.id)&&!a.hasImage(ne.id)&&je(ne);if(e.$$.dirty[0]&268435472&&n(5,r=te.every(ne=>h.has(ne.id))),e.$$.dirty[0]&196616|e.$$.dirty[1]&7&&a&&!Bm(E,Vn)){const ne=a.getStyle();if(Oe&&(In=ne.layers.filter(Ie=>!Oe.includes(Ie.id))),wn){const Ie=Object.keys(ne.sources).filter(Fe=>!wn.includes(Fe));Sn={};for(const Fe of Ie)Sn[Fe]=ne.sources[Fe]}n(33,Vn=E),a.setStyle(E,{diff:M})}e.$$.dirty[0]&1032&&k&&!Bm(k,a==null?void 0:a.getCenter())&&(a==null||a.panTo(k)),e.$$.dirty[0]&2056&&D&&!Bm(D,a==null?void 0:a.getZoom())&&(a==null||a.zoomTo(D)),e.$$.dirty[0]&4104&&X&&!Bm(X,a==null?void 0:a.getBounds())&&(a==null||a.fitBounds(X)),e.$$.dirty[0]&2097160&&(ht?a==null||a.doubleClickZoom.enable():a==null||a.doubleClickZoom.disable())},[U,S,Pt,a,h,r,i,Ee,an,Bn,k,D,X,w,F,q,E,M,B,W,Q,ht,ut,St,lt,zt,wt,_t,te,oe,Gt,Oe,wn,Vn,_,u]}class HL extends nn{constructor(t){super(),en(this,t,WL,ZL,Ye,{map:13,class:1,style:16,diffStyleUpdates:17,center:10,zoom:11,pitch:14,bearing:15,bounds:12,hash:18,loaded:0,minZoom:19,maxZoom:20,zoomOnDoubleClick:21,locale:22,interactive:23,attributionControl:24,cooperativeGestures:25,preserveDrawingBuffer:26,maxBounds:27,images:28,standardControls:2,filterLayers:29,transformRequest:30},null,[-1,-1])}}function $L(e){let t,n,i,r,a,h,u;const _=e[18].default,w=ir(_,e,e[17],null);return{c(){t=gt("div"),w&&w.c(),Mt(t,"tabindex",n=e[1]?0:void 0),Mt(t,"role",i=e[1]?"button":void 0),si(t,"z-index",e[2])},m(S,E){xt(S,t,E),w&&w.m(t,null),a=!0,h||(u=[ry(e[6].call(null,t)),ry(r=XL.call(null,t,e[0])),Ge(t,"click",e[19]),Ge(t,"dblclick",e[20]),Ge(t,"contextmenu",e[21]),Ge(t,"mouseenter",e[22]),Ge(t,"mouseleave",e[23]),Ge(t,"mousemove",e[24]),Ge(t,"keydown",e[7])],h=!0)},p(S,[E]){w&&w.p&&(!a||E&131072)&&or(w,_,S,S[17],a?rr(_,S[17],E,null):sr(S[17]),null),(!a||E&2&&n!==(n=S[1]?0:void 0))&&Mt(t,"tabindex",n),(!a||E&2&&i!==(i=S[1]?"button":void 0))&&Mt(t,"role",i),r&&bg(r.update)&&E&1&&r.update.call(null,S[0]),E&4&&si(t,"z-index",S[2])},i(S){a||(pt(w,S),a=!0)},o(S){yt(w,S),a=!1},d(S){S&&vt(t),w&&w.d(S),h=!1,ro(u)}}}function XL(e,t){const n=e.className;function i(r){r?e.className=`${n} ${r}`:e.className=n}return i(t),{update:i}}function YL(e,t,n){let i,r,a,{$$slots:h={},$$scope:u}=t,{lngLat:_}=t,{class:w=void 0}=t,{interactive:S=!0}=t,{asButton:E=!1}=t,{draggable:M=!1}=t,{feature:k=null}=t,{offset:D=void 0}=t,{zIndex:F=void 0}=t,{rotation:q=0}=t,{opacity:X=1}=t;const B=Ac(),{map:U,layerEvent:W,self:Q}=fL();we(e,U,Gt=>n(26,a=Gt)),we(e,W,Gt=>n(25,i=Gt)),we(e,Q,Gt=>n(16,r=Gt));function ht(Gt){Xe(Q,r=new Ls.Marker({element:Gt,rotation:q,draggable:M,offset:D,opacity:X.toString()}).setLngLat(_).addTo(a),r);const ie=()=>lt("dragstart"),Ee=()=>{ut(),lt("drag")},an=()=>{ut(),lt("dragend")};return M&&(r.on("dragstart",ie),r.on("drag",Ee),r.on("dragend",an)),{destroy(){M&&(r==null||r.off("dragstart",ie),r==null||r.off("drag",Ee),r==null||r.off("dragend",an)),r==null||r.remove()}}}function ut(){let Gt=r==null?void 0:r.getLngLat();Gt&&(Array.isArray(_)?n(9,_=[Gt.lng,Gt.lat]):_&&"lon"in _?n(9,_={lon:Gt.lng,lat:Gt.lat}):n(9,_=Gt))}function St(Gt){Gt.key===" "&&(Gt.preventDefault(),Gt.stopPropagation(),lt("click"))}function lt(Gt){if(!S)return;let ie=r==null?void 0:r.getLngLat();if(!ie)return;const Ee=[ie.lng,ie.lat];let an={map:a,marker:r,lngLat:Ee,features:[{type:"Feature",properties:(k==null?void 0:k.properties)??{},geometry:{type:"Point",coordinates:Ee}}]};Xe(W,i={...an,layerType:"marker",type:Gt},i),B(Gt,an)}const zt=()=>lt("click"),wt=()=>lt("dblclick"),_t=()=>lt("contextmenu"),te=Gt=>{lt("mouseenter")},Pt=()=>{lt("mouseleave")},oe=()=>lt("mousemove");return e.$$set=Gt=>{"lngLat"in Gt&&n(9,_=Gt.lngLat),"class"in Gt&&n(0,w=Gt.class),"interactive"in Gt&&n(10,S=Gt.interactive),"asButton"in Gt&&n(1,E=Gt.asButton),"draggable"in Gt&&n(11,M=Gt.draggable),"feature"in Gt&&n(12,k=Gt.feature),"offset"in Gt&&n(13,D=Gt.offset),"zIndex"in Gt&&n(2,F=Gt.zIndex),"rotation"in Gt&&n(14,q=Gt.rotation),"opacity"in Gt&&n(15,X=Gt.opacity),"$$scope"in Gt&&n(17,u=Gt.$$scope)},e.$$.update=()=>{e.$$.dirty&66048&&(r==null||r.setLngLat(_)),e.$$.dirty&73728&&(r==null||r.setOffset(D??[0,0])),e.$$.dirty&81920&&(r==null||r.setRotation(q)),e.$$.dirty&98304&&(r==null||r.setOpacity(X.toString()))},[w,E,F,U,W,Q,ht,St,lt,_,S,M,k,D,q,X,r,u,h,zt,wt,_t,te,Pt,oe]}class ub extends nn{constructor(t){super(),en(this,t,YL,$L,Ye,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2,rotation:14,opacity:15})}}const KL=e=>({features:e[0]&16,data:e[0]&16,map:e[0]&4,close:e[0]&1}),cb=e=>{var t;return{features:e[4],data:(t=e[4])==null?void 0:t[0],map:e[2],close:e[31]}};function hb(e){let t,n,i=(e[4]||e[3]instanceof Ls.Marker)&&fb(e);return{c(){t=gt("div"),i&&i.c()},m(r,a){xt(r,t,a),i&&i.m(t,null),e[32](t),n=!0},p(r,a){r[4]||r[3]instanceof Ls.Marker?i?(i.p(r,a),a[0]&24&&pt(i,1)):(i=fb(r),i.c(),pt(i,1),i.m(t,null)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(),e[32](null)}}}function fb(e){let t;const n=e[30].default,i=ir(n,e,e[29],cb);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a[0]&536870933)&&or(i,n,r,r[29],t?rr(n,r[29],a,KL):sr(r[29]),cb)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function JL(e){let t,n,i=e[9].default&&hb(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,a){r[9].default?i?(i.p(r,a),a[0]&512&&pt(i,1)):(i=hb(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function QL(e,t,n){let i,r,a,h,u,_,{$$slots:w={},$$scope:S}=t;const E=OS(w);let{closeButton:M=void 0}=t,{closeOnClickOutside:k=!0}=t,{closeOnClickInside:D=!1}=t,{closeOnMove:F=!1}=t,{openOn:q="click"}=t,{openIfTopMost:X=!0}=t,{focusAfterOpen:B=!0}=t,{anchor:U=void 0}=t,{offset:W=void 0}=t,{popupClass:Q=void 0}=t,{maxWidth:ht=void 0}=t,{lngLat:ut=void 0}=t,{html:St=void 0}=t,{open:lt=!1}=t;const{map:zt,popupTarget:wt,layerEvent:_t,layer:te,eventTopMost:Pt}=bf();we(e,zt,Tt=>n(2,a=Tt)),we(e,wt,Tt=>n(3,u=Tt)),we(e,_t,Tt=>n(28,h=Tt)),we(e,te,Tt=>n(35,_=Tt));const oe=["click","dblclick","contextmenu"];let Gt,ie=!1,Ee;function an(){if(!Gt)return;let Tt=Gt.getElement();!Tt||Tt===Ee||(Ee=Tt,q==="hover"&&(Ee.style.pointerEvents="none"),Ee.addEventListener("mouseenter",()=>{n(24,ie=!0)},{passive:!0}),Ee.addEventListener("mouseleave",()=>{n(24,ie=!1)},{passive:!0}),Ee.addEventListener("click",()=>{D&&n(0,lt=!1)},{passive:!0}))}xg(()=>{if(a)return a.on("click",Ie),a.on("contextmenu",Ie),typeof u=="string"&&(a.on("click",u,wn),a.on("dblclick",u,wn),a.on("contextmenu",u,wn),a.on("mousemove",u,ne),a.on("mouseleave",u,Vn),a.on("touchstart",u,Sn),a.on("touchend",u,Bn)),()=>{a!=null&&a.loaded()&&(Gt==null||Gt.remove(),a.off("click",Ie),a.off("contextmenu",Ie),u instanceof Ls.Marker?u.getPopup()===Gt&&u.setPopup(void 0):typeof u=="string"&&(a.off("click",u,wn),a.off("dblclick",u,wn),a.off("contextmenu",u,wn),a.off("mousemove",u,ne),a.off("mouseleave",u,Vn),a.off("touchstart",u,Sn),a.off("touchend",u,Bn)))}});function cn(Tt){return X?!("marker"in Tt)&&!pL(Tt)&&Pt(Tt)!==_:!1}let je=null,Oe="normal";function wn(Tt){Tt.type===q&&(cn(Tt)||("layerType"in Tt?Tt.layerType==="deckgl"?(n(10,ut=Tt.coordinate),n(4,je=Tt.object?[Tt.object]:null)):(n(10,ut=Tt.lngLat),n(4,je=Tt.features??[])):(n(10,ut=Tt.lngLat),n(4,je=Tt.features??[])),setTimeout(()=>n(0,lt=!0))))}let In=null;function Sn(Tt){In=Tt.point}function Bn(Tt){if(!In||q!=="hover")return;let We=In.dist(Tt.point);In=null,We<3&&(n(10,ut=Tt.lngLat),n(4,je=Tt.features??[]),Gt.isOpen()?n(25,Oe="justOpened"):(n(25,Oe="opening"),n(0,lt=!0)))}function Vn(Tt){q!=="hover"||In||Oe!=="normal"||(n(0,lt=!1),n(4,je=null))}function ne(Tt){if(!(q!=="hover"||In||Oe!=="normal")){if(cn(Tt)){n(0,lt=!1),n(4,je=null);return}n(0,lt=!0),n(4,je=Tt.features??[]),n(10,ut=Tt.lngLat)}}function Ie(Tt){if(Oe==="justOpened"){n(25,Oe="normal");return}if(!k)return;let We=[Ee,u instanceof Ls.Marker?u==null?void 0:u.getElement():null];lt&&Gt.isOpen()&&!We.some(Le=>Le==null?void 0:Le.contains(Tt.originalEvent.target))&&(Tt.type==="contextmenu"&&q==="contextmenu"||Tt.type!=="contextmenu")&&n(0,lt=!1)}na(()=>{a&&(Gt!=null&&Gt.isOpen())&&Gt.remove()});let Fe;const zn=()=>n(0,lt=!1);function Ki(Tt){Or[Tt?"unshift":"push"](()=>{Fe=Tt,n(1,Fe)})}return e.$$set=Tt=>{"closeButton"in Tt&&n(11,M=Tt.closeButton),"closeOnClickOutside"in Tt&&n(12,k=Tt.closeOnClickOutside),"closeOnClickInside"in Tt&&n(13,D=Tt.closeOnClickInside),"closeOnMove"in Tt&&n(14,F=Tt.closeOnMove),"openOn"in Tt&&n(15,q=Tt.openOn),"openIfTopMost"in Tt&&n(16,X=Tt.openIfTopMost),"focusAfterOpen"in Tt&&n(17,B=Tt.focusAfterOpen),"anchor"in Tt&&n(18,U=Tt.anchor),"offset"in Tt&&n(19,W=Tt.offset),"popupClass"in Tt&&n(20,Q=Tt.popupClass),"maxWidth"in Tt&&n(21,ht=Tt.maxWidth),"lngLat"in Tt&&n(10,ut=Tt.lngLat),"html"in Tt&&n(22,St=Tt.html),"open"in Tt&&n(0,lt=Tt.open),"$$scope"in Tt&&n(29,S=Tt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&14336&&n(27,i=M??(!k&&!D)),e.$$.dirty[0]&146685952&&(Gt||(n(23,Gt=new Ls.Popup({closeButton:i,closeOnClick:!1,closeOnMove:F,focusAfterOpen:B,maxWidth:ht,className:Q,anchor:U,offset:W})),Ee=Gt.getElement(),Gt.on("open",()=>{n(0,lt=!0),an()}),Gt.on("close",Tt=>{n(0,lt=!1)}))),e.$$.dirty[0]&8421384&&Gt&&u instanceof Ls.Marker&&(q==="click"?u.setPopup(Gt):u.getPopup()===Gt&&u.setPopup(void 0)),e.$$.dirty[0]&268468224&&oe.includes(q)&&(h==null?void 0:h.type)===q&&(wn(h),Xe(_t,h=null,h)),e.$$.dirty[0]&268468224&&n(26,r=q==="hover"&&((h==null?void 0:h.type)==="mousemove"||(h==null?void 0:h.type)==="mouseenter")),e.$$.dirty[0]&352354304&&q==="hover"&&_t&&(r&&h&&(h.layerType==="deckgl"?(n(10,ut=h.coordinate),n(4,je=h.object?[h.object]:null)):(n(10,ut=h.lngLat),n(4,je=h.features??[]))),n(0,lt=(r||ie)??!1)),e.$$.dirty[0]&12582914&&(Fe?Gt.setDOMContent(Fe):St&&Gt.setHTML(St)),e.$$.dirty[0]&8389632&&ut&&Gt.setLngLat(ut),e.$$.dirty[0]&41943045&&a){let Tt=Gt.isOpen();lt&&!Tt?(Gt.addTo(a),Oe==="opening"&&n(25,Oe="justOpened")):!lt&&Tt&&Gt.remove()}},[lt,Fe,a,u,je,zt,wt,_t,te,E,ut,M,k,D,F,q,X,B,U,W,Q,ht,St,Gt,ie,Oe,r,i,h,S,w,zn,Ki]}class tM extends nn{constructor(t){super(),en(this,t,QL,JL,Ye,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function eM(e){let t;const n=e[16].default,i=ir(n,e,e[24],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&16777216)&&or(i,n,r,r[24],t?rr(n,r[24],a,null):sr(r[24]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function nM(e){let t,n,i;function r(h){e[17](h)}let a={id:e[1],type:"symbol",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[eM]},$$scope:{ctx:e}};return e[0]!==void 0&&(a.hovered=e[0]),t=new Fg({props:a}),Or.push(()=>_c(t,"hovered",r)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){Wt(t.$$.fragment)},m(h,u){jt(t,h,u),i=!0},p(h,[u]){const _={};u&2&&(_.id=h[1]),u&4&&(_.source=h[2]),u&8&&(_.sourceLayer=h[3]),u&16&&(_.beforeId=h[4]),u&32&&(_.beforeLayerType=h[5]),u&64&&(_.paint=h[6]),u&128&&(_.layout=h[7]),u&256&&(_.filter=h[8]),u&512&&(_.applyToClusters=h[9]),u&1024&&(_.minzoom=h[10]),u&2048&&(_.maxzoom=h[11]),u&4096&&(_.hoverCursor=h[12]),u&8192&&(_.manageHoverState=h[13]),u&16384&&(_.eventsIfTopMost=h[14]),u&32768&&(_.interactive=h[15]),u&16777216&&(_.$$scope={dirty:u,ctx:h}),!n&&u&1&&(n=!0,_.hovered=h[0],gc(()=>n=!1)),t.$set(_)},i(h){i||(pt(t.$$.fragment,h),i=!0)},o(h){yt(t.$$.fragment,h),i=!1},d(h){qt(t,h)}}}function iM(e,t,n){let{$$slots:i={},$$scope:r}=t,{id:a=vf("symbol")}=t,{source:h=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:_=void 0}=t,{beforeLayerType:w=void 0}=t,{paint:S=void 0}=t,{layout:E=void 0}=t,{filter:M=void 0}=t,{applyToClusters:k=void 0}=t,{minzoom:D=void 0}=t,{maxzoom:F=void 0}=t,{hoverCursor:q=void 0}=t,{manageHoverState:X=!1}=t,{hovered:B=null}=t,{eventsIfTopMost:U=!1}=t,{interactive:W=!0}=t;function Q(_t){B=_t,n(0,B)}function ht(_t){ii.call(this,e,_t)}function ut(_t){ii.call(this,e,_t)}function St(_t){ii.call(this,e,_t)}function lt(_t){ii.call(this,e,_t)}function zt(_t){ii.call(this,e,_t)}function wt(_t){ii.call(this,e,_t)}return e.$$set=_t=>{"id"in _t&&n(1,a=_t.id),"source"in _t&&n(2,h=_t.source),"sourceLayer"in _t&&n(3,u=_t.sourceLayer),"beforeId"in _t&&n(4,_=_t.beforeId),"beforeLayerType"in _t&&n(5,w=_t.beforeLayerType),"paint"in _t&&n(6,S=_t.paint),"layout"in _t&&n(7,E=_t.layout),"filter"in _t&&n(8,M=_t.filter),"applyToClusters"in _t&&n(9,k=_t.applyToClusters),"minzoom"in _t&&n(10,D=_t.minzoom),"maxzoom"in _t&&n(11,F=_t.maxzoom),"hoverCursor"in _t&&n(12,q=_t.hoverCursor),"manageHoverState"in _t&&n(13,X=_t.manageHoverState),"hovered"in _t&&n(0,B=_t.hovered),"eventsIfTopMost"in _t&&n(14,U=_t.eventsIfTopMost),"interactive"in _t&&n(15,W=_t.interactive),"$$scope"in _t&&n(24,r=_t.$$scope)},[B,a,h,u,_,w,S,E,M,k,D,F,q,X,U,W,i,Q,ht,ut,St,lt,zt,wt,r]}class Dw extends nn{constructor(t){super(),en(this,t,iM,nM,Ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Sd=Uint8Array,Nw=Uint16Array,rM=Int32Array,oM=new Sd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),sM=new Sd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Rw=function(e,t){for(var n=new Nw(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];for(var r=new rM(n[30]),i=1;i<30;++i)for(var a=n[i];a<n[i+1];++a)r[a]=a-n[i]<<5|i;return{b:n,r}},zw=Rw(oM,2),aM=zw.b,lM=zw.r;aM[28]=258,lM[258]=28;Rw(sM,0);var uM=new Nw(32768);for(Qn=0;Qn<32768;++Qn)zl=(Qn&43690)>>1|(Qn&21845)<<1,zl=(zl&52428)>>2|(zl&13107)<<2,zl=(zl&61680)>>4|(zl&3855)<<4,uM[Qn]=((zl&65280)>>8|(zl&255)<<8)>>1;var zl,Qn,Bg=new Sd(288);for(Qn=0;Qn<144;++Qn)Bg[Qn]=8;var Qn;for(Qn=144;Qn<256;++Qn)Bg[Qn]=9;var Qn;for(Qn=256;Qn<280;++Qn)Bg[Qn]=7;var Qn;for(Qn=280;Qn<288;++Qn)Bg[Qn]=8;var Qn,cM=new Sd(32);for(Qn=0;Qn<32;++Qn)cM[Qn]=5;var Qn,hM=new Sd(0),fM=typeof TextDecoder<"u"&&new TextDecoder,pM=0;try{fM.decode(hM,{stream:!0}),pM=1}catch{}const dM=e=>({props:e&8}),pb=e=>({props:_M(e[3])});function mM(e){let t;const n=e[1].default,i=ir(n,e,e[2],pb);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&12)&&or(i,n,r,r[2],t?rr(n,r[2],a,dM):sr(r[2]),pb)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function gM(e){let t,n;return t=new tM({props:{openOn:e[0],$$slots:{default:[mM,({features:i})=>({3:i}),({features:i})=>i?8:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&1&&(a.openOn=i[0]),r&12&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function _M(e){return e?e[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function yM(e,t,n){let{$$slots:i={},$$scope:r}=t,{openOn:a="hover"}=t;return e.$$set=h=>{"openOn"in h&&n(0,a=h.openOn),"$$scope"in h&&n(2,r=h.$$scope)},[a,i,r]}class gl extends nn{constructor(t){super(),en(this,t,yM,gM,Ye,{openOn:0})}}function db(e,t,n){const i=e.slice();return i[1]=t[n][0],i[2]=t[n][1],i}function mb(e){let t,n,i=e[1]+"",r,a,h,u=e[2]+"",_,w;return{c(){t=gt("tr"),n=gt("td"),r=de(i),a=Xt(),h=gt("td"),_=de(u),w=Xt()},m(S,E){xt(S,t,E),ct(t,n),ct(n,r),ct(t,a),ct(t,h),ct(h,_),ct(t,w)},p(S,E){E&1&&i!==(i=S[1]+"")&&yi(r,i),E&1&&u!==(u=S[2]+"")&&yi(_,u)},d(S){S&&vt(t)}}}function vM(e){let t,n,i=ps(Object.entries(e[0])),r=[];for(let a=0;a<i.length;a+=1)r[a]=mb(db(e,i,a));return{c(){t=gt("table"),n=gt("tbody");for(let a=0;a<r.length;a+=1)r[a].c();Mt(t,"class","svelte-lh2o9l")},m(a,h){xt(a,t,h),ct(t,n);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(n,null)},p(a,[h]){if(h&1){i=ps(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const _=db(a,i,u);r[u]?r[u].p(_,h):(r[u]=mb(_),r[u].c(),r[u].m(n,null))}for(;u<r.length;u+=1)r[u].d(1);r.length=i.length}},i:Ae,o:Ae,d(a){a&&vt(t),ff(r,a)}}}function bM(e,t,n){let{properties:i}=t;return e.$$set=r=>{"properties"in r&&n(0,i=r.properties)},[i]}class wf extends nn{constructor(t){super(),en(this,t,bM,vM,Ye,{properties:0})}}function Mr(e){return{id:e,beforeId:xM(e)}}function xM(e){let t=Ta(al);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let n,i=!1;for(let r=gb.length-1;r>=0;r--){let a=gb[r];if(a==e){i=!0;break}t.getLayer(a)&&(n=a)}if(!i)throw new Error(`Layer ID ${e} not defined in layerZorder`);return n}const gb=["Background","neighbourhood-boundaries","Residential","debug-borders","debug-crosses","debug-filters","cells","interior-roads","compare-route","shortcuts","shortcuts-focus","Building","route-points","route-lines","route-polygons","one-ways","Road labels","modal-filters","boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"],Ow=["==",["geometry-type"],"Polygon"],Fw=["==",["geometry-type"],"LineString"],Bw=["==",["geometry-type"],"Point"];function Fp(e,t,n){let i=["match",e];for(let[r,a]of Object.entries(t))i.push(r),i.push(a);return i.push(n),i}function wM(e,t){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(t)),n.setAttribute("download",e),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ai(e){if(e==null||e==null)throw new Error("Oops, notNull given something null");return e}function iy(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Vw(e)}}}function Vw(e){return[Math.round(e[0]*1e7)/1e7,Math.round(e[1]*1e7)/1e7]}function Uw(e){let t='poly:"';for(let[i,r]of e.geometry.coordinates[0])t+=`${r} ${i} `;return t=t.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${t}); node(w)->.x; <;); out meta;`}`}function _b(e){let t,n;return t=new i0({props:{$$slots:{default:[SM,({dialog:i})=>({3:i}),({dialog:i})=>i?8:0]},$$scope:{ctx:e}}}),t.$on("close",e[2]),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&24&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function SM(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D;function F(){return e[1](e[3])}return{c(){t=gt("h1"),t.textContent="The Low-traffic neighbourhood (LTN) tool, v2",n=Xt(),i=gt("p"),i.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,r=Xt(),a=gt("p"),a.textContent="To use this tool, you need to:",h=Xt(),u=gt("ol"),u.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Xt(),w=gt("p"),w.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,S=Xt(),E=gt("center"),M=gt("button"),M.textContent="Start!"},m(q,X){xt(q,t,X),xt(q,n,X),xt(q,i,X),xt(q,r,X),xt(q,a,X),xt(q,h,X),xt(q,u,X),xt(q,_,X),xt(q,w,X),xt(q,S,X),xt(q,E,X),ct(E,M),k||(D=Ge(M,"click",F),k=!0)},p(q,X){e=q},d(q){q&&(vt(t),vt(n),vt(i),vt(r),vt(a),vt(h),vt(u),vt(_),vt(w),vt(S),vt(E)),k=!1,D()}}}function IM(e){let t,n,i=e[0]&&_b(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,[a]){r[0]?i?(i.p(r,a),a&1&&pt(i,1)):(i=_b(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function EM(e,t,n){let i;return we(e,Jm,h=>n(0,i=h)),[i,h=>ai(h).close(),()=>Xe(Jm,i=!1,i)]}class CM extends nn{constructor(t){super(),en(this,t,EM,IM,Ye,{})}}const TM="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",yb="/ltn/assets/logo_light-97f2d067.svg",vb="/ltn/assets/logo_dark-ed08d841.svg";function LM(e){let t;return{c(){t=de("Back")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function MM(e){let t,n,i,r;return t=new ri({props:{$$slots:{default:[LM]},$$scope:{ctx:e}}}),t.$on("click",e[2]),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0,i||(r=Ge(window,"keydown",e[1]),i=!0)},p(a,[h]){const u={};h&8&&(u.$$scope={dirty:h,ctx:a}),t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a),i=!1,r()}}}function PM(e){let t=Ac();function n(r){r.key=="Escape"&&(r.stopPropagation(),t("click"))}return[t,n,()=>t("click")]}class Vg extends nn{constructor(t){super(),en(this,t,PM,MM,Ye,{})}}function kM(e){let t,n;const i=[Mr("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new Dw({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,[h]){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}class AM extends nn{constructor(t){super(),en(this,t,null,kM,Ye,{})}}function zy(e){let t=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of e.features)n.properties??(n.properties={}),n.properties.cell_color=="disconnected"?n.properties.color="red":Object.hasOwn(n.properties,"cell_color")&&(n.properties.color=t[n.properties.cell_color%t.length]);return e}const DM=e=>({}),bb=e=>({}),NM=e=>({}),xb=e=>({});function wb(e){let t;const n=e[5]["line-popup"],i=ir(n,e,e[7],xb);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&128)&&or(i,n,r,r[7],t?rr(n,r[7],a,NM):sr(r[7]),xb)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function RM(e){let t,n,i=e[0]&&wb(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,a){r[0]?i?(i.p(r,a),a&1&&pt(i,1)):(i=wb(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function zM(e){let t,n,i,r,a,h,u;const _=[Mr("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let w={};for(let D=0;D<_.length;D+=1)w=yr(w,_[D]);t=new xf({props:w});const S=[Mr("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",e[2],"#A32015"]}},{hoverCursor:e[0]?"pointer":void 0}];let E={$$slots:{default:[RM]},$$scope:{ctx:e}};for(let D=0;D<S.length;D+=1)E=yr(E,S[D]);i=new Ql({props:E}),i.$on("click",e[6]),a=new AM({});const M=e[5]["more-layers"],k=ir(M,e,e[7],bb);return{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment),r=Xt(),Wt(a.$$.fragment),h=Xt(),k&&k.c()},m(D,F){jt(t,D,F),xt(D,n,F),jt(i,D,F),xt(D,r,F),jt(a,D,F),xt(D,h,F),k&&k.m(D,F),u=!0},p(D,F){const q={};t.$set(q);const X=F&5?ix(S,[S[0],S[1],F&4&&{paint:{"line-width":5,"line-color":["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D[2],"#A32015"]}},F&1&&{hoverCursor:D[0]?"pointer":void 0}]):{};F&129&&(X.$$scope={dirty:F,ctx:D}),i.$set(X),k&&k.p&&(!u||F&128)&&or(k,M,D,D[7],u?rr(M,D[7],F,DM):sr(D[7]),bb)},i(D){u||(pt(t.$$.fragment,D),pt(i.$$.fragment,D),pt(a.$$.fragment,D),pt(k,D),u=!0)},o(D){yt(t.$$.fragment,D),yt(i.$$.fragment,D),yt(a.$$.fragment,D),yt(k,D),u=!1},d(D){D&&(vt(n),vt(r),vt(h)),qt(t,D),qt(i,D),qt(a,D),k&&k.d(D)}}}function OM(e){let t,n;return t=new ks({props:{data:e[3],generateId:!0,$$slots:{default:[zM]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&8&&(a.data=i[3]),r&135&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function FM(e,t,n){let i,r,{$$slots:a={},$$scope:h}=t,{gjInput:u}=t,{interactive:_=!0}=t,{onClickLine:w=E=>{}}=t;const S=E=>_&&w(E.detail.features[0]);return e.$$set=E=>{"gjInput"in E&&n(4,u=E.gjInput),"interactive"in E&&n(0,_=E.interactive),"onClickLine"in E&&n(1,w=E.onClickLine),"$$scope"in E&&n(7,h=E.$$scope)},e.$$.update=()=>{e.$$.dirty&16&&n(3,i=zy(u)),e.$$.dirty&16&&n(2,r=Math.max(...u.features.map(E=>E.properties.shortcuts??0)))},[_,w,r,i,u,a,S,h]}class Ug extends nn{constructor(t){super(),en(this,t,FM,OM,Ye,{gjInput:4,interactive:0,onClickLine:1})}}const BM=e=>({}),Sb=e=>({}),VM=e=>({}),Ib=e=>({}),UM=e=>({}),Eb=e=>({});function GM(e){let t,n,i,r,a,h;const u=e[4].top,_=ir(u,e,e[3],Eb),w=e[4].sidebar,S=ir(w,e,e[3],Ib),E=e[4].map,M=ir(E,e,e[3],Sb);return{c(){t=gt("div"),_&&_.c(),n=Xt(),i=gt("div"),S&&S.c(),r=Xt(),a=gt("div"),M&&M.c()},m(k,D){xt(k,t,D),_&&_.m(t,null),e[5](t),xt(k,n,D),xt(k,i,D),S&&S.m(i,null),e[6](i),xt(k,r,D),xt(k,a,D),M&&M.m(a,null),e[7](a),h=!0},p(k,[D]){_&&_.p&&(!h||D&8)&&or(_,u,k,k[3],h?rr(u,k[3],D,UM):sr(k[3]),Eb),S&&S.p&&(!h||D&8)&&or(S,w,k,k[3],h?rr(w,k[3],D,VM):sr(k[3]),Ib),M&&M.p&&(!h||D&8)&&or(M,E,k,k[3],h?rr(E,k[3],D,BM):sr(k[3]),Sb)},i(k){h||(pt(_,k),pt(S,k),pt(M,k),h=!0)},o(k){yt(_,k),yt(S,k),yt(M,k),h=!1},d(k){k&&(vt(t),vt(n),vt(i),vt(r),vt(a)),_&&_.d(k),e[5](null),S&&S.d(k),e[6](null),M&&M.d(k),e[7](null)}}}function jM(e,t,n){let i,r,a;we(e,hy,E=>n(0,i=E)),we(e,fy,E=>n(1,r=E)),we(e,py,E=>n(2,a=E));let{$$slots:h={},$$scope:u}=t;function _(E){Or[E?"unshift":"push"](()=>{i=E,hy.set(i)})}function w(E){Or[E?"unshift":"push"](()=>{r=E,fy.set(r)})}function S(E){Or[E?"unshift":"push"](()=>{a=E,py.set(a)})}return e.$$set=E=>{"$$scope"in E&&n(3,u=E.$$scope)},[i,r,a,u,h,_,w,S]}class tu extends nn{constructor(t){super(),en(this,t,jM,GM,Ye,{})}}function qM(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function ZM(e){let t;return{c(){t=de("Pick neighbourhood")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function WM(e){let t;return{c(){t=de("Editing")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function HM(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D;return a=new ri({props:{$$slots:{default:[qM]},$$scope:{ctx:e}}}),a.$on("click",e[4]),_=new ri({props:{$$slots:{default:[ZM]},$$scope:{ctx:e}}}),_.$on("click",e[5]),E=new ri({props:{$$slots:{default:[WM]},$$scope:{ctx:e}}}),E.$on("click",e[6]),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),Wt(_.$$.fragment),w=Xt(),S=gt("li"),Wt(E.$$.fragment),M=Xt(),k=gt("li"),k.textContent="Debug mode",Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top")},m(F,q){xt(F,t,q),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),jt(_,u,null),ct(i,w),ct(i,S),jt(E,S,null),ct(i,M),ct(i,k),D=!0},p(F,q){const X={};q&256&&(X.$$scope={dirty:q,ctx:F}),a.$set(X);const B={};q&256&&(B.$$scope={dirty:q,ctx:F}),_.$set(B);const U={};q&256&&(U.$$scope={dirty:q,ctx:F}),E.$set(U)},i(F){D||(pt(a.$$.fragment,F),pt(_.$$.fragment,F),pt(E.$$.fragment,F),D=!0)},o(F){yt(a.$$.fragment,F),yt(_.$$.fragment,F),yt(E.$$.fragment,F),D=!1},d(F){F&&vt(t),qt(a),qt(_),qt(E)}}}function $M(e){let t,n,i;return n=new Vg({}),n.$on("click",e[3]),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","sidebar")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p:Ae,i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function XM(e){let t,n;return t=new wf({props:{properties:e[7]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&128&&(a.properties=i[7]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function YM(e){let t,n,i;return n=new gl({props:{openOn:"hover",$$slots:{default:[XM,({props:r})=>({7:r}),({props:r})=>r?128:0]},$$scope:{ctx:e}}}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","line-popup")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p(r,a){const h={};a&384&&(h.$$scope={dirty:a,ctx:r}),n.$set(h)},i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function KM(e){let t,n;return t=new wf({props:{properties:e[7]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&128&&(a.properties=i[7]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function JM(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[KM,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&384&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function QM(e){let t,n;return t=new wf({props:{properties:e[7]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&128&&(a.properties=i[7]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function tP(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[QM,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&384&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function eP(e){let t,n,i,r;const a=[Mr("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let h={$$slots:{default:[JM]},$$scope:{ctx:e}};for(let w=0;w<a.length;w+=1)h=yr(h,a[w]);t=new wd({props:h});const u=[Mr("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let _={$$slots:{default:[tP]},$$scope:{ctx:e}};for(let w=0;w<u.length;w+=1)_=yr(_,u[w]);return i=new Ql({props:_}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment)},m(w,S){jt(t,w,S),xt(w,n,S),jt(i,w,S),r=!0},p(w,S){const E={};S&256&&(E.$$scope={dirty:S,ctx:w}),t.$set(E);const M={};S&256&&(M.$$scope={dirty:S,ctx:w}),i.$set(M)},i(w){r||(pt(t.$$.fragment,w),pt(i.$$.fragment,w),r=!0)},o(w){yt(t.$$.fragment,w),yt(i.$$.fragment,w),r=!1},d(w){w&&vt(n),qt(t,w),qt(i,w)}}}function nP(e){let t,n;return t=new wf({props:{properties:e[7]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&128&&(a.properties=i[7]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function iP(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[nP,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&384&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function rP(e){let t,n;const i=[Mr("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let r={$$slots:{default:[iP]},$$scope:{ctx:e}};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new wd({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};h&256&&(u.$$scope={dirty:h,ctx:a}),t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function oP(e){let t,n,i,r,a;return n=new Ug({props:{gjInput:JSON.parse(ai(e[0]).renderNeighbourhood()),interactive:!0,onClickLine:e[2],$$slots:{"more-layers":[eP],"line-popup":[YM]},$$scope:{ctx:e}}}),r=new ks({props:{data:JSON.parse(ai(e[0]).renderModalFilters()),generateId:!0,$$slots:{default:[rP]},$$scope:{ctx:e}}}),{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),Wt(r.$$.fragment),Mt(t,"slot","map")},m(h,u){xt(h,t,u),jt(n,t,null),ct(t,i),jt(r,t,null),a=!0},p(h,u){const _={};u&1&&(_.gjInput=JSON.parse(ai(h[0]).renderNeighbourhood())),u&256&&(_.$$scope={dirty:u,ctx:h}),n.$set(_);const w={};u&1&&(w.data=JSON.parse(ai(h[0]).renderModalFilters())),u&256&&(w.$$scope={dirty:u,ctx:h}),r.$set(w)},i(h){a||(pt(n.$$.fragment,h),pt(r.$$.fragment,h),a=!0)},o(h){yt(n.$$.fragment,h),yt(r.$$.fragment,h),a=!1},d(h){h&&vt(t),qt(n),qt(r)}}}function sP(e){let t,n;return t=new tu({props:{$$slots:{map:[oP],sidebar:[$M],top:[HM]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&259&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function aP(e,t,n){let i,r;return we(e,Fr,S=>n(0,i=S)),we(e,xn,S=>n(1,r=S)),[i,r,S=>window.open(ai(S.properties).way,"_blank"),()=>Xe(xn,r={mode:"neighbourhood"},r),()=>Xe(xn,r={mode:"title"},r),()=>Xe(xn,r={mode:"network"},r),()=>Xe(xn,r={mode:"neighbourhood"},r)]}class lP extends nn{constructor(t){super(),en(this,t,aP,sP,Ye,{})}}function uP(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function cP(e){let t,n,i,r,a,h,u,_;return a=new ri({props:{$$slots:{default:[uP]},$$scope:{ctx:e}}}),a.$on("click",e[3]),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),u.textContent="Debug route snapper",Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top")},m(w,S){xt(w,t,S),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),_=!0},p(w,S){const E={};S&32&&(E.$$scope={dirty:S,ctx:w}),a.$set(E)},i(w){_||(pt(a.$$.fragment,w),_=!0)},o(w){yt(a.$$.fragment,w),_=!1},d(w){w&&vt(t),qt(a)}}}function hP(e){let t,n,i;return n=new Vg({}),n.$on("click",e[2]),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","sidebar")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p:Ae,i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function fP(e){let t,n;return t=new wf({props:{properties:e[4]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&16&&(a.properties=i[4]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function pP(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[fP,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&48&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function dP(e){let t,n;return t=new wf({props:{properties:e[4]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&16&&(a.properties=i[4]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function mP(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[dP,({props:i})=>({4:i}),({props:i})=>i?16:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&48&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function gP(e){let t,n,i,r;return t=new Ql({props:{manageHoverState:!0,paint:{"line-width":8,"line-color":"black","line-opacity":Ry(.5,1)},$$slots:{default:[pP]},$$scope:{ctx:e}}}),i=new wd({props:{manageHoverState:!0,paint:{"circle-radius":10,"circle-color":"black","circle-opacity":Ry(.5,1)},$$slots:{default:[mP]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment)},m(a,h){jt(t,a,h),xt(a,n,h),jt(i,a,h),r=!0},p(a,h){const u={};h&32&&(u.$$scope={dirty:h,ctx:a}),t.$set(u);const _={};h&32&&(_.$$scope={dirty:h,ctx:a}),i.$set(_)},i(a){r||(pt(t.$$.fragment,a),pt(i.$$.fragment,a),r=!0)},o(a){yt(t.$$.fragment,a),yt(i.$$.fragment,a),r=!1},d(a){a&&vt(n),qt(t,a),qt(i,a)}}}function _P(e){let t,n,i;return n=new ks({props:{data:JSON.parse(ai(e[0]).toRouteSnapperGj()),generateId:!0,$$slots:{default:[gP]},$$scope:{ctx:e}}}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","map")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p(r,a){const h={};a&1&&(h.data=JSON.parse(ai(r[0]).toRouteSnapperGj())),a&32&&(h.$$scope={dirty:a,ctx:r}),n.$set(h)},i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function yP(e){let t,n;return t=new tu({props:{$$slots:{map:[_P],sidebar:[hP],top:[cP]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&35&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function vP(e,t,n){let i,r;return we(e,Fr,u=>n(0,i=u)),we(e,xn,u=>n(1,r=u)),[i,r,()=>Xe(xn,r={mode:"network"},r),()=>Xe(xn,r={mode:"title"},r)]}class bP extends nn{constructor(t){super(),en(this,t,vP,yP,Ye,{})}}function Cb(e,t,n){const i=e.slice();return i[7]=t[n][0],i[8]=t[n][1],i[9]=t[n][2],i}function Tb(e){let t,n,i,r,a,h,u=e[8]+"",_,w,S,E,M;function k(){return e[3](e[7])}return{c(){t=gt("button"),n=gt("img"),r=Xt(),a=gt("br"),h=Xt(),_=de(u),w=Xt(),jn(n.src,i=`/ltn//filters/${e[7]}_icon.gif`)||Mt(n,"src",i),Mt(n,"width","80"),Mt(n,"alt",e[8]),Mt(t,"class","outline"),si(t,"width","100%"),t.disabled=S=e[0]==e[7]},m(D,F){xt(D,t,F),ct(t,n),ct(t,r),ct(t,a),ct(t,h),ct(t,_),ct(t,w),E||(M=Ge(t,"click",k),E=!0)},p(D,F){e=D,F&1&&S!==(S=e[0]==e[7])&&(t.disabled=S)},d(D){D&&vt(t),E=!1,M()}}}function xP(e){let t,n,i,r,a,h,u,_,w,S,E,M,k=e[1][2]+"",D,F,q,X,B,U,W=ps(e[2]),Q=[];for(let ut=0;ut<W.length;ut+=1)Q[ut]=Tb(Cb(e,W,ut));function ht(){return e[4](e[6])}return{c(){t=gt("h3"),t.textContent="Choose a modal filter to place on streets",n=Xt(),i=gt("table"),r=gt("tr"),a=gt("td");for(let ut=0;ut<Q.length;ut+=1)Q[ut].c();h=Xt(),u=gt("td"),_=gt("img"),E=Xt(),M=gt("p"),D=de(k),F=Xt(),q=gt("center"),X=gt("button"),X.textContent="Confirm",jn(_.src,w=`/ltn//filters/${e[0]}.gif`)||Mt(_,"src",w),Mt(_,"height","300"),Mt(_,"alt",S=e[1][1])},m(ut,St){xt(ut,t,St),xt(ut,n,St),xt(ut,i,St),ct(i,r),ct(r,a);for(let lt=0;lt<Q.length;lt+=1)Q[lt]&&Q[lt].m(a,null);ct(r,h),ct(r,u),ct(u,_),ct(u,E),ct(u,M),ct(M,D),xt(ut,F,St),xt(ut,q,St),ct(q,X),B||(U=Ge(X,"click",ht),B=!0)},p(ut,St){if(e=ut,St&5){W=ps(e[2]);let lt;for(lt=0;lt<W.length;lt+=1){const zt=Cb(e,W,lt);Q[lt]?Q[lt].p(zt,St):(Q[lt]=Tb(zt),Q[lt].c(),Q[lt].m(a,null))}for(;lt<Q.length;lt+=1)Q[lt].d(1);Q.length=W.length}St&1&&!jn(_.src,w=`/ltn//filters/${e[0]}.gif`)&&Mt(_,"src",w),St&2&&S!==(S=e[1][1])&&Mt(_,"alt",S),St&2&&k!==(k=e[1][2]+"")&&yi(D,k)},d(ut){ut&&(vt(t),vt(n),vt(i),vt(F),vt(q)),ff(Q,ut),B=!1,U()}}}function wP(e){let t,n;return t=new i0({props:{$$slots:{default:[xP,({dialog:i})=>({6:i}),({dialog:i})=>i?64:0]},$$scope:{ctx:e}}}),t.$on("close",e[5]),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&4163&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function SP(e,t,n){let i,r;we(e,gy,w=>n(0,r=w));let a=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const h=w=>Xe(gy,r=w,r),u=w=>ai(w).close();function _(w){ii.call(this,e,w)}return e.$$.update=()=>{e.$$.dirty&1&&n(1,i=a.find(w=>w[0]==r))},[r,i,a,h,u,_]}class IP extends nn{constructor(t){super(),en(this,t,SP,wP,Ye,{})}}function Lb(e){let t,n;return t=new ks({props:{data:e[0],$$slots:{default:[EP]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&1&&(a.data=i[0]),r&64&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function EP(e){let t,n;const i=[Mr("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new Ql({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function CP(e){let t,n,i=e[0]&&Lb(e);return{c(){i&&i.c(),t=Oo()},m(r,a){i&&i.m(r,a),xt(r,t,a),n=!0},p(r,[a]){r[0]?i?(i.p(r,a),a&1&&pt(i,1)):(i=Lb(r),i.c(),pt(i,1),i.m(t.parentNode,t)):i&&(ti(),yt(i,1,1,()=>{i=null}),ei())},i(r){n||(pt(i),n=!0)},o(r){yt(i),n=!1},d(r){r&&vt(t),i&&i.d(r)}}}function TP(e,t,n){let{map:i}=t,r=null;const a=Ac();i.on("dragstart",h),i.on("mousemove",u),i.on("mouseup",_),na(()=>{i.dragPan.enable(),i.off("dragstart",h),i.off("mousemove",u),i.off("mouseup",_)});function h(){i.dragPan.disable(),n(0,r={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function u(w){r&&(r.geometry.coordinates.push(w.lngLat.toArray()),n(0,r))}function _(){r&&(a("done",r),n(0,r=null))}return e.$$set=w=>{"map"in w&&n(1,i=w.map)},[r,i]}class LP extends nn{constructor(t){super(),en(this,t,TP,CP,Ye,{map:1})}}function MP(e){let t;const n=e[3].default,i=ir(n,e,e[5],null);return{c(){i&&i.c()},m(r,a){i&&i.m(r,a),t=!0},p(r,a){i&&i.p&&(!t||a&32)&&or(i,n,r,r[5],t?rr(n,r[5],a,null):sr(r[5]),null)},i(r){t||(pt(i,r),t=!0)},o(r){yt(i,r),t=!1},d(r){i&&i.d(r)}}}function PP(e){let t,n;const i=[Mr("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let r={$$slots:{default:[MP]},$$scope:{ctx:e}};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new Dw({props:r}),t.$on("click",e[4]),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};h&32&&(u.$$scope={dirty:h,ctx:a}),t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function kP(e){let t,n;return t=new ks({props:{data:e[0],generateId:!0,$$slots:{default:[PP]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&1&&(a.data=i[0]),r&32&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function AP(e,t,n){let i,r,a;we(e,Fr,w=>n(1,r=w)),we(e,Su,w=>n(2,a=w));let{$$slots:h={},$$scope:u}=t;function _(w){ii.call(this,e,w)}return e.$$set=w=>{"$$scope"in w&&n(5,u=w.$$scope)},e.$$.update=()=>{e.$$.dirty&6&&n(0,i=a>0?JSON.parse(r.renderModalFilters()):null)},[i,r,a,h,_,u]}class Gg extends nn{constructor(t){super(),en(this,t,AP,kP,Ye,{})}}function DP(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function NP(e){let t;return{c(){t=de("Pick neighbourhood")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function RP(e){let t;return{c(){t=de("View shortcuts")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function zP(e){let t;return{c(){t=de("Route")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function OP(e){let t;return{c(){t=de("Change this boundary")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function FP(e){let t;return{c(){t=de("Debug")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function BP(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D,F,q,X,B,U,W,Q,ht,ut,St,lt;return a=new ri({props:{$$slots:{default:[DP]},$$scope:{ctx:e}}}),a.$on("click",e[21]),_=new ri({props:{$$slots:{default:[NP]},$$scope:{ctx:e}}}),_.$on("click",e[22]),F=new ri({props:{$$slots:{default:[RP]},$$scope:{ctx:e}}}),F.$on("click",e[23]),B=new ri({props:{$$slots:{default:[zP]},$$scope:{ctx:e}}}),B.$on("click",e[24]),Q=new ri({props:{$$slots:{default:[OP]},$$scope:{ctx:e}}}),Q.$on("click",e[25]),St=new ri({props:{$$slots:{default:[FP]},$$scope:{ctx:e}}}),St.$on("click",e[26]),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),Wt(_.$$.fragment),w=Xt(),S=gt("li"),S.textContent="Editing",E=Xt(),M=gt("nav"),k=gt("ul"),D=gt("li"),Wt(F.$$.fragment),q=Xt(),X=gt("li"),Wt(B.$$.fragment),U=Xt(),W=gt("li"),Wt(Q.$$.fragment),ht=Xt(),ut=gt("li"),Wt(St.$$.fragment),Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top"),si(t,"display","flex"),si(t,"justify-content","space-between")},m(zt,wt){xt(zt,t,wt),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),jt(_,u,null),ct(i,w),ct(i,S),ct(t,E),ct(t,M),ct(M,k),ct(k,D),jt(F,D,null),ct(k,q),ct(k,X),jt(B,X,null),ct(k,U),ct(k,W),jt(Q,W,null),ct(k,ht),ct(k,ut),jt(St,ut,null),lt=!0},p(zt,wt){const _t={};wt[1]&1&&(_t.$$scope={dirty:wt,ctx:zt}),a.$set(_t);const te={};wt[1]&1&&(te.$$scope={dirty:wt,ctx:zt}),_.$set(te);const Pt={};wt[1]&1&&(Pt.$$scope={dirty:wt,ctx:zt}),F.$set(Pt);const oe={};wt[1]&1&&(oe.$$scope={dirty:wt,ctx:zt}),B.$set(oe);const Gt={};wt[1]&1&&(Gt.$$scope={dirty:wt,ctx:zt}),Q.$set(Gt);const ie={};wt[1]&1&&(ie.$$scope={dirty:wt,ctx:zt}),St.$set(ie)},i(zt){lt||(pt(a.$$.fragment,zt),pt(_.$$.fragment,zt),pt(F.$$.fragment,zt),pt(B.$$.fragment,zt),pt(Q.$$.fragment,zt),pt(St.$$.fragment,zt),lt=!0)},o(zt){yt(a.$$.fragment,zt),yt(_.$$.fragment,zt),yt(F.$$.fragment,zt),yt(B.$$.fragment,zt),yt(Q.$$.fragment,zt),yt(St.$$.fragment,zt),lt=!1},d(zt){zt&&vt(t),qt(a),qt(_),qt(F),qt(B),qt(Q),qt(St)}}}function VP(e){let t,n,i;return{c(){t=de("Undo ("),n=de(e[3]),i=de(")")},m(r,a){xt(r,t,a),xt(r,n,a),xt(r,i,a)},p(r,a){a[0]&8&&yi(n,r[3])},d(r){r&&(vt(t),vt(n),vt(i))}}}function UP(e){let t;return{c(){t=de("Undo")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function GP(e){let t,n,i;return{c(){t=de("Redo ("),n=de(e[4]),i=de(")")},m(r,a){xt(r,t,a),xt(r,n,a),xt(r,i,a)},p(r,a){a[0]&16&&yi(n,r[4])},d(r){r&&(vt(t),vt(n),vt(i))}}}function jP(e){let t;return{c(){t=de("Redo")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function Mb(e){let t,n;return t=new IP({}),t.$on("close",e[20]),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function qP(e){let t,n,i,r,a=ai(ai(e[5]).properties).name+"",h,u,_,w,S,E,M,k,D,F,q,X,B,U,W,Q,ht,ut,St,lt,zt,wt,_t,te,Pt,oe,Gt,ie,Ee,an,cn,je,Oe;function wn(Fe,zn){return Fe[3]==0?UP:VP}let In=wn(e),Sn=In(e);function Bn(Fe,zn){return Fe[4]==0?jP:GP}let Vn=Bn(e),ne=Vn(e),Ie=e[2]&&Mb(e);return{c(){t=gt("div"),n=gt("p"),i=de("Editing neighbourhood "),r=gt("u"),h=de(a),u=Xt(),_=gt("p"),_.textContent=`Now that you've defined a neighbourhood boundary, you can see the possible
      shortcuts that vehicles are currently able to take through it. You can add
      a new modal filter to try and solve this. The colored "cell" areas show
      what's reachable for drivers without leaving the boundary you've drawn.`,w=Xt(),S=gt("hr"),E=Xt(),M=gt("div"),k=gt("button"),D=gt("img"),q=de(`
        Add a modal filter`),B=Xt(),U=gt("button"),W=de("Add many modal filters along line"),ht=Xt(),ut=gt("button"),St=de("Reverse directions"),zt=Xt(),wt=gt("button"),wt.textContent="Change modal filter type",_t=Xt(),te=gt("div"),Pt=gt("button"),Sn.c(),Gt=Xt(),ie=gt("button"),ne.c(),an=Xt(),Ie&&Ie.c(),jn(D.src,F=`/ltn//filters/${e[7]}_icon.gif`)||Mt(D,"src",F),Mt(D,"width","30"),Mt(D,"alt","Add a modal filter"),k.disabled=X=e[0]=="filter",U.disabled=Q=e[0]=="freehand-filters",ut.disabled=lt=e[0]=="oneway",si(M,"display","flex"),si(M,"justify-content","space-between"),Pt.disabled=oe=e[3]==0,ie.disabled=Ee=e[4]==0,si(te,"display","flex"),si(te,"justify-content","space-between"),Mt(t,"slot","sidebar")},m(Fe,zn){xt(Fe,t,zn),ct(t,n),ct(n,i),ct(n,r),ct(r,h),ct(t,u),ct(t,_),ct(t,w),ct(t,S),ct(t,E),ct(t,M),ct(M,k),ct(k,D),ct(k,q),ct(M,B),ct(M,U),ct(U,W),ct(M,ht),ct(M,ut),ct(ut,St),ct(t,zt),ct(t,wt),ct(t,_t),ct(t,te),ct(te,Pt),Sn.m(Pt,null),ct(te,Gt),ct(te,ie),ne.m(ie,null),ct(t,an),Ie&&Ie.m(t,null),cn=!0,je||(Oe=[Ge(k,"click",e[16]),Ge(U,"click",e[17]),Ge(ut,"click",e[18]),Ge(wt,"click",e[19]),Ge(Pt,"click",e[12]),Ge(ie,"click",e[13])],je=!0)},p(Fe,zn){(!cn||zn[0]&32)&&a!==(a=ai(ai(Fe[5]).properties).name+"")&&yi(h,a),(!cn||zn[0]&128&&!jn(D.src,F=`/ltn//filters/${Fe[7]}_icon.gif`))&&Mt(D,"src",F),(!cn||zn[0]&1&&X!==(X=Fe[0]=="filter"))&&(k.disabled=X),(!cn||zn[0]&1&&Q!==(Q=Fe[0]=="freehand-filters"))&&(U.disabled=Q),(!cn||zn[0]&1&&lt!==(lt=Fe[0]=="oneway"))&&(ut.disabled=lt),In===(In=wn(Fe))&&Sn?Sn.p(Fe,zn):(Sn.d(1),Sn=In(Fe),Sn&&(Sn.c(),Sn.m(Pt,null))),(!cn||zn[0]&8&&oe!==(oe=Fe[3]==0))&&(Pt.disabled=oe),Vn===(Vn=Bn(Fe))&&ne?ne.p(Fe,zn):(ne.d(1),ne=Vn(Fe),ne&&(ne.c(),ne.m(ie,null))),(!cn||zn[0]&16&&Ee!==(Ee=Fe[4]==0))&&(ie.disabled=Ee),Fe[2]?Ie?(Ie.p(Fe,zn),zn[0]&4&&pt(Ie,1)):(Ie=Mb(Fe),Ie.c(),pt(Ie,1),Ie.m(t,null)):Ie&&(ti(),yt(Ie,1,1,()=>{Ie=null}),ei())},i(Fe){cn||(pt(Ie),cn=!0)},o(Fe){yt(Ie),cn=!1},d(Fe){Fe&&vt(t),Sn.d(),ne.d(),Ie&&Ie.d(),je=!1,ro(Oe)}}}function Pb(e){let t;return{c(){t=gt("p"),t.textContent="Click to change direction"},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function ZP(e){let t,n=e[30].shortcuts+"",i,r,a=(e[30].name??"unnamed road")+"",h,u,_,w=e[0]=="oneway"&&Pb();return{c(){t=gt("p"),i=de(n),r=de(" shortcuts through "),h=de(a),u=Xt(),w&&w.c(),_=Oo()},m(S,E){xt(S,t,E),ct(t,i),ct(t,r),ct(t,h),xt(S,u,E),w&&w.m(S,E),xt(S,_,E)},p(S,E){E[0]&1073741824&&n!==(n=S[30].shortcuts+"")&&yi(i,n),E[0]&1073741824&&a!==(a=(S[30].name??"unnamed road")+"")&&yi(h,a),S[0]=="oneway"?w||(w=Pb(),w.c(),w.m(_.parentNode,_)):w&&(w.d(1),w=null)},d(S){S&&(vt(t),vt(u),vt(_)),w&&w.d(S)}}}function WP(e){let t,n,i;return n=new gl({props:{openOn:"hover",$$slots:{default:[ZP,({props:r})=>({30:r}),({props:r})=>[r?1073741824:0]]},$$scope:{ctx:e}}}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","line-popup")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p(r,a){const h={};a[0]&1073741825|a[1]&1&&(h.$$scope={dirty:a,ctx:r}),n.$set(h)},i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function HP(e){let t;return{c(){t=de("Click to delete")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function $P(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[HP]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r[1]&1&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function kb(e){let t,n;return t=new LP({props:{map:ai(e[1])}}),t.$on("done",e[14]),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r[0]&2&&(a.map=ai(i[1])),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function XP(e){let t,n,i,r,a,h;n=new Ug({props:{gjInput:e[6],interactive:e[0]=="oneway",onClickLine:e[9],$$slots:{"line-popup":[WP]},$$scope:{ctx:e}}}),r=new Gg({props:{$$slots:{default:[$P]},$$scope:{ctx:e}}}),r.$on("click",e[10]);let u=e[0]=="freehand-filters"&&kb(e);return{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),Wt(r.$$.fragment),a=Xt(),u&&u.c(),Mt(t,"slot","map")},m(_,w){xt(_,t,w),jt(n,t,null),ct(t,i),jt(r,t,null),ct(t,a),u&&u.m(t,null),h=!0},p(_,w){const S={};w[0]&64&&(S.gjInput=_[6]),w[0]&1&&(S.interactive=_[0]=="oneway"),w[0]&1|w[1]&1&&(S.$$scope={dirty:w,ctx:_}),n.$set(S);const E={};w[1]&1&&(E.$$scope={dirty:w,ctx:_}),r.$set(E),_[0]=="freehand-filters"?u?(u.p(_,w),w[0]&1&&pt(u,1)):(u=kb(_),u.c(),pt(u,1),u.m(t,null)):u&&(ti(),yt(u,1,1,()=>{u=null}),ei())},i(_){h||(pt(n.$$.fragment,_),pt(r.$$.fragment,_),pt(u),h=!0)},o(_){yt(n.$$.fragment,_),yt(r.$$.fragment,_),yt(u),h=!1},d(_){_&&vt(t),qt(n),qt(r),u&&u.d()}}}function YP(e){let t,n,i,r;return t=new tu({props:{$$slots:{map:[XP],sidebar:[qP],top:[BP]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0,i||(r=Ge(window,"keydown",e[11]),i=!0)},p(a,h){const u={};h[0]&511|h[1]&1&&(u.$$scope={dirty:h,ctx:a}),t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a),i=!1,r()}}}function KP(e,t,n){let i,r,a,h,u;we(e,Su,ie=>n(15,i=ie)),we(e,gy,ie=>n(7,r=ie)),we(e,Fr,ie=>n(27,a=ie)),we(e,al,ie=>n(1,h=ie)),we(e,xn,ie=>n(8,u=ie));let _="filter",w=!1,S=0,E=0,M,k;h.on("click",F),na(()=>{h.off("click",F),h.doubleClickZoom.enable()});function D(ie){n(6,k=JSON.parse(a.renderNeighbourhood())),n(5,M=k.features.find(Ee=>Ee.properties.kind=="boundary")),n(3,S=k.undo_length),n(4,E=k.redo_length),$p()}function F(ie){_=="filter"&&(a.addModalFilter(ie.lngLat,r),Xe(Su,i++,i))}function q(ie){_=="oneway"&&(a.toggleDirection(ie.properties.road),Xe(Su,i++,i))}function X(ie){let Ee=ie.detail.features[0];a.deleteModalFilter(Ee.properties.road),Xe(Su,i++,i)}function B(ie){ie.target.tagName!="INPUT"&&(ie.ctrlKey&&ie.key=="z"&&U(),ie.ctrlKey&&ie.key=="y"&&W(),ie.key=="1"&&n(0,_="filter"),ie.key=="2"&&n(0,_="freehand-filters"),ie.key=="3"&&n(0,_="oneway"))}function U(){a.undo(),Xe(Su,i++,i)}function W(){a.redo(),Xe(Su,i++,i)}function Q(ie){let Ee=ie.detail;Ee&&(a.addManyModalFilters(Ee,r),Xe(Su,i++,i)),n(0,_="filter")}const ht=()=>n(0,_="filter"),ut=()=>n(0,_="freehand-filters"),St=()=>n(0,_="oneway"),lt=()=>n(2,w=!0),zt=()=>n(2,w=!1),wt=()=>Xe(xn,u={mode:"title"},u),_t=()=>Xe(xn,u={mode:"network"},u),te=()=>Xe(xn,u={mode:"view-shortcuts"},u),Pt=()=>Xe(xn,u={mode:"route",prevMode:"neighbourhood"},u),oe=()=>Xe(xn,u={mode:"set-boundary",name:ai(ai(M).properties).name,existing:M},u),Gt=()=>Xe(xn,u={mode:"debug"},u);return e.$$.update=()=>{e.$$.dirty[0]&3&&(_=="oneway"?h.doubleClickZoom.disable():h.doubleClickZoom.enable()),e.$$.dirty[0]&32768&&D()},[_,h,w,S,E,M,k,r,u,q,X,B,U,W,Q,i,ht,ut,St,lt,zt,wt,_t,te,Pt,oe,Gt]}class JP extends nn{constructor(t){super(),en(this,t,KP,YP,Ye,{},null,[-1,-1])}}const gg="/ltn/assets/delete_light-ec75e756.svg",_g="/ltn/assets/delete_dark-953cd893.svg",yg="/ltn/assets/edit_light-f3f51206.svg",vg="/ltn/assets/edit_dark-97c94d36.svg";function Ab(e,t,n){const i=e.slice();return i[19]=t[n],i}function QP(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function tk(e){let t;return{c(){t=de("Route")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function ek(e){let t;return{c(){t=de("Debug route snapper")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function nk(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D,F,q;return a=new ri({props:{$$slots:{default:[QP]},$$scope:{ctx:e}}}),a.$on("click",e[15]),M=new ri({props:{$$slots:{default:[tk]},$$scope:{ctx:e}}}),M.$on("click",e[16]),F=new ri({props:{$$slots:{default:[ek]},$$scope:{ctx:e}}}),F.$on("click",e[17]),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),u.textContent="Pick neighbourhood",_=Xt(),w=gt("nav"),S=gt("ul"),E=gt("li"),Wt(M.$$.fragment),k=Xt(),D=gt("li"),Wt(F.$$.fragment),Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top"),si(t,"display","flex"),si(t,"justify-content","space-between")},m(X,B){xt(X,t,B),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),ct(t,_),ct(t,w),ct(w,S),ct(S,E),jt(M,E,null),ct(S,k),ct(S,D),jt(F,D,null),q=!0},p(X,B){const U={};B&4194304&&(U.$$scope={dirty:B,ctx:X}),a.$set(U);const W={};B&4194304&&(W.$$scope={dirty:B,ctx:X}),M.$set(W);const Q={};B&4194304&&(Q.$$scope={dirty:B,ctx:X}),F.$set(Q)},i(X){q||(pt(a.$$.fragment,X),pt(M.$$.fragment,X),pt(F.$$.fragment,X),q=!0)},o(X){yt(a.$$.fragment,X),yt(M.$$.fragment,X),yt(F.$$.fragment,X),q=!1},d(X){X&&vt(t),qt(a),qt(M),qt(F)}}}function ik(e){let t;return{c(){t=de("Draw a new boundary")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function rk(e){let t=e[19]+"",n;return{c(){n=de(t)},m(i,r){xt(i,n,r)},p(i,r){r&2&&t!==(t=i[19]+"")&&yi(n,t)},d(i){i&&vt(n)}}}function Db(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D,F;function q(){return e[12](e[19])}i=new ri({props:{$$slots:{default:[rk]},$$scope:{ctx:e}}}),i.$on("click",q);function X(){return e[13](e[19])}function B(){return e[14](e[19])}return{c(){t=gt("li"),n=gt("span"),Wt(i.$$.fragment),r=Xt(),a=gt("button"),h=gt("img"),_=Xt(),w=gt("button"),S=gt("img"),M=Xt(),jn(h.src,u=e[4]?yg:vg)||Mt(h,"src",u),Mt(h,"alt","Rename neighbourhood"),Mt(a,"class","secondary"),jn(S.src,E=e[4]?gg:_g)||Mt(S,"src",E),Mt(S,"alt","Delete neighbourhood"),Mt(w,"class","secondary"),si(n,"display","flex"),si(n,"justify-content","space-between")},m(U,W){xt(U,t,W),ct(t,n),jt(i,n,null),ct(n,r),ct(n,a),ct(a,h),ct(n,_),ct(n,w),ct(w,S),ct(t,M),k=!0,D||(F=[Ge(a,"click",X),Ge(w,"click",B)],D=!0)},p(U,W){e=U;const Q={};W&4194306&&(Q.$$scope={dirty:W,ctx:e}),i.$set(Q),(!k||W&16&&!jn(h.src,u=e[4]?yg:vg))&&Mt(h,"src",u),(!k||W&16&&!jn(S.src,E=e[4]?gg:_g))&&Mt(S,"src",E)},i(U){k||(pt(i.$$.fragment,U),k=!0)},o(U){yt(i.$$.fragment,U),k=!1},d(U){U&&vt(t),qt(i),D=!1,ro(F)}}}function ok(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D,F,q,X;r=new ri({props:{$$slots:{default:[ik]},$$scope:{ctx:e}}}),r.$on("click",e[8]);let B=ps(e[1]),U=[];for(let Q=0;Q<B.length;Q+=1)U[Q]=Db(Ab(e,B,Q));const W=Q=>yt(U[Q],1,1,()=>{U[Q]=null});return{c(){t=gt("div"),n=gt("p"),n.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
      deliberately permit) through-traffic. An appropriate neighbourhood
      boundary depends on many factors. The simplest approach is to find the
      area bounded on all sides by "main" roads, which are designed for higher
      traffic volumes. There are many other considerations, though -- maybe
      severances like rivers or rail should be part of a boundary. Bridges and
      tunnels near a boundary may be confusing as well. And note that your
      boundary may not match the conventional definition of "neighbourhood."`,i=Xt(),Wt(r.$$.fragment),a=Xt(),h=gt("ul");for(let Q=0;Q<U.length;Q+=1)U[Q].c();u=Xt(),_=gt("hr"),w=Xt(),S=gt("p"),E=de("Current project: "),M=de(e[2]),k=Xt(),D=gt("button"),D.textContent="Export project to GeoJSON",Mt(t,"slot","sidebar")},m(Q,ht){xt(Q,t,ht),ct(t,n),ct(t,i),jt(r,t,null),ct(t,a),ct(t,h);for(let ut=0;ut<U.length;ut+=1)U[ut]&&U[ut].m(h,null);ct(t,u),ct(t,_),ct(t,w),ct(t,S),ct(S,E),ct(S,M),ct(t,k),ct(t,D),F=!0,q||(X=Ge(D,"click",e[9]),q=!0)},p(Q,ht){const ut={};if(ht&4194304&&(ut.$$scope={dirty:ht,ctx:Q}),r.$set(ut),ht&242){B=ps(Q[1]);let St;for(St=0;St<B.length;St+=1){const lt=Ab(Q,B,St);U[St]?(U[St].p(lt,ht),pt(U[St],1)):(U[St]=Db(lt),U[St].c(),pt(U[St],1),U[St].m(h,null))}for(ti(),St=B.length;St<U.length;St+=1)W(St);ei()}(!F||ht&4)&&yi(M,Q[2])},i(Q){if(!F){pt(r.$$.fragment,Q);for(let ht=0;ht<B.length;ht+=1)pt(U[ht]);F=!0}},o(Q){yt(r.$$.fragment,Q),U=U.filter(Boolean);for(let ht=0;ht<U.length;ht+=1)yt(U[ht]);F=!1},d(Q){Q&&vt(t),qt(r),ff(U,Q),q=!1,X()}}}function sk(e){let t,n=e[18].name+"",i;return{c(){t=gt("p"),i=de(n)},m(r,a){xt(r,t,a),ct(t,i)},p(r,a){a&262144&&n!==(n=r[18].name+"")&&yi(i,n)},d(r){r&&vt(t)}}}function ak(e){let t,n;return t=new gl({props:{openOn:"hover",$$slots:{default:[sk,({props:i})=>({18:i}),({props:i})=>i?262144:0]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&4456448&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function lk(e){let t,n;const i=[Mr("neighbourhood-boundaries"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"red","fill-opacity":Ry(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let r={$$slots:{default:[ak]},$$scope:{ctx:e}};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new xf({props:r}),t.$on("click",e[11]),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};h&4194304&&(u.$$scope={dirty:h,ctx:a}),t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function uk(e){let t,n,i,r,a;return n=new ks({props:{data:e[0],generateId:!0,$$slots:{default:[lk]},$$scope:{ctx:e}}}),r=new Gg({}),{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),Wt(r.$$.fragment),Mt(t,"slot","map")},m(h,u){xt(h,t,u),jt(n,t,null),ct(t,i),jt(r,t,null),a=!0},p(h,u){const _={};u&1&&(_.data=h[0]),u&4194304&&(_.$$scope={dirty:u,ctx:h}),n.$set(_)},i(h){a||(pt(n.$$.fragment,h),pt(r.$$.fragment,h),a=!0)},o(h){yt(n.$$.fragment,h),yt(r.$$.fragment,h),a=!1},d(h){h&&vt(t),qt(n),qt(r)}}}function ck(e){let t,n;return t=new tu({props:{$$slots:{map:[uk],sidebar:[ok],top:[nk]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&4194335&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function hk(e,t,n){let i,r,a,h,u,_;we(e,Fr,Q=>n(10,a=Q)),we(e,Mu,Q=>n(2,h=Q)),we(e,xn,Q=>n(3,u=Q)),we(e,Hp,Q=>n(4,_=Q));function w(Q){a.setCurrentNeighbourhood(Q),Xe(xn,u={mode:"neighbourhood"},u)}function S(Q){window.confirm(`Really delete neighbourhood ${Q}? You can't undo this.`)&&(a.deleteNeighbourhoodBoundary(Q),$p(),n(0,i=JSON.parse(a.toSavefile())))}function E(Q){let ht=window.prompt(`Rename neighbourhood ${Q} to what?`,Q);ht&&(a.renameNeighbourhoodBoundary(Q,ht),$p(),n(0,i=JSON.parse(a.toSavefile())))}function M(){let Q=window.prompt("What do you want to name the neighbourhood?");Q&&Xe(xn,u={mode:"set-boundary",name:Q,existing:null},u)}function k(){wM(h+".geojson",a.toSavefile())}const D=Q=>w(ai(Q.detail.features[0].properties).name),F=Q=>w(Q),q=Q=>E(Q),X=Q=>S(Q),B=()=>Xe(xn,u={mode:"title"},u),U=()=>Xe(xn,u={mode:"route",prevMode:"network"},u),W=()=>Xe(xn,u={mode:"debug-gj"},u);return e.$$.update=()=>{e.$$.dirty&1024&&n(0,i=JSON.parse(a.toSavefile())),e.$$.dirty&1&&n(1,r=i.features.filter(Q=>Q.properties.kind=="boundary").map(Q=>Q.properties.name))},[i,r,h,u,_,w,S,E,M,k,a,D,F,q,X,B,U,W]}class fk extends nn{constructor(t){super(),en(this,t,hk,ck,Ye,{})}}function pk(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function dk(e){let t;return{c(){t=de("Pick neighbourhood")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function Nb(e){let t,n,i;return n=new ri({props:{$$slots:{default:[mk]},$$scope:{ctx:e}}}),n.$on("click",e[11]),{c(){t=gt("li"),Wt(n.$$.fragment)},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p(r,a){const h={};a&4096&&(h.$$scope={dirty:a,ctx:r}),n.$set(h)},i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function mk(e){let t;return{c(){t=de("Editing")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function gk(e){let t,n,i,r,a,h,u,_,w,S,E,M;a=new ri({props:{$$slots:{default:[pk]},$$scope:{ctx:e}}}),a.$on("click",e[9]),_=new ri({props:{$$slots:{default:[dk]},$$scope:{ctx:e}}}),_.$on("click",e[10]);let k=e[0]=="neighbourhood"&&Nb(e);return{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),Wt(_.$$.fragment),w=Xt(),k&&k.c(),S=Xt(),E=gt("li"),E.textContent="Routing",Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top")},m(D,F){xt(D,t,F),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),jt(_,u,null),ct(i,w),k&&k.m(i,null),ct(i,S),ct(i,E),M=!0},p(D,F){const q={};F&4096&&(q.$$scope={dirty:F,ctx:D}),a.$set(q);const X={};F&4096&&(X.$$scope={dirty:F,ctx:D}),_.$set(X),D[0]=="neighbourhood"?k?(k.p(D,F),F&1&&pt(k,1)):(k=Nb(D),k.c(),pt(k,1),k.m(i,S)):k&&(ti(),yt(k,1,1,()=>{k=null}),ei())},i(D){M||(pt(a.$$.fragment,D),pt(_.$$.fragment,D),pt(k),M=!0)},o(D){yt(a.$$.fragment,D),yt(_.$$.fragment,D),yt(k),M=!1},d(D){D&&vt(t),qt(a),qt(_),k&&k.d()}}}function _k(e){let t,n,i,r,a,h,u;return n=new Vg({}),n.$on("click",e[6]),{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),r=gt("p"),r.textContent="Drag markers for a route",a=Xt(),h=gt("p"),h.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,Mt(t,"slot","sidebar")},m(_,w){xt(_,t,w),jt(n,t,null),ct(t,i),ct(t,r),ct(t,a),ct(t,h),u=!0},p:Ae,i(_){u||(pt(n.$$.fragment,_),u=!0)},o(_){yt(n.$$.fragment,_),u=!1},d(_){_&&vt(t),qt(n)}}}function Rb(e){let t,n;return t=new Ug({props:{gjInput:JSON.parse(ai(e[3]).renderNeighbourhood()),interactive:!1}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&8&&(a.gjInput=JSON.parse(ai(i[3]).renderNeighbourhood())),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function yk(e){let t,n;const i=[Mr("compare-route"),{paint:{"line-width":10,"line-color":Fp(["get","kind"],{before:"red",after:"blue"},"red")}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new Ql({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function vk(e){let t;return{c(){t=gt("span"),t.textContent="A",Mt(t,"class","dot svelte-1ukzawy")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function bk(e){let t;return{c(){t=gt("span"),t.textContent="B",Mt(t,"class","dot svelte-1ukzawy")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function xk(e){let t,n,i,r,a,h,u,_,w,S,E,M,k=e[0]=="neighbourhood"&&Rb(e);i=new Gg({}),a=new ks({props:{data:e[4],$$slots:{default:[yk]},$$scope:{ctx:e}}});function D(B){e[7](B)}let F={draggable:!0,$$slots:{default:[vk]},$$scope:{ctx:e}};e[2]!==void 0&&(F.lngLat=e[2]),u=new ub({props:F}),Or.push(()=>_c(u,"lngLat",D));function q(B){e[8](B)}let X={draggable:!0,$$slots:{default:[bk]},$$scope:{ctx:e}};return e[1]!==void 0&&(X.lngLat=e[1]),S=new ub({props:X}),Or.push(()=>_c(S,"lngLat",q)),{c(){t=gt("div"),k&&k.c(),n=Xt(),Wt(i.$$.fragment),r=Xt(),Wt(a.$$.fragment),h=Xt(),Wt(u.$$.fragment),w=Xt(),Wt(S.$$.fragment),Mt(t,"slot","map")},m(B,U){xt(B,t,U),k&&k.m(t,null),ct(t,n),jt(i,t,null),ct(t,r),jt(a,t,null),ct(t,h),jt(u,t,null),ct(t,w),jt(S,t,null),M=!0},p(B,U){B[0]=="neighbourhood"?k?(k.p(B,U),U&1&&pt(k,1)):(k=Rb(B),k.c(),pt(k,1),k.m(t,n)):k&&(ti(),yt(k,1,1,()=>{k=null}),ei());const W={};U&16&&(W.data=B[4]),U&4096&&(W.$$scope={dirty:U,ctx:B}),a.$set(W);const Q={};U&4096&&(Q.$$scope={dirty:U,ctx:B}),!_&&U&4&&(_=!0,Q.lngLat=B[2],gc(()=>_=!1)),u.$set(Q);const ht={};U&4096&&(ht.$$scope={dirty:U,ctx:B}),!E&&U&2&&(E=!0,ht.lngLat=B[1],gc(()=>E=!1)),S.$set(ht)},i(B){M||(pt(k),pt(i.$$.fragment,B),pt(a.$$.fragment,B),pt(u.$$.fragment,B),pt(S.$$.fragment,B),M=!0)},o(B){yt(k),yt(i.$$.fragment,B),yt(a.$$.fragment,B),yt(u.$$.fragment,B),yt(S.$$.fragment,B),M=!1},d(B){B&&vt(t),k&&k.d(),qt(i),qt(a),qt(u),qt(S)}}}function wk(e){let t,n;return t=new tu({props:{$$slots:{map:[xk],sidebar:[_k],top:[gk]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&4159&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function Sk(e,t,n){let i,r,a,h,u;we(e,xn,F=>n(5,r=F)),we(e,my,F=>n(1,a=F)),we(e,dy,F=>n(2,h=F)),we(e,Fr,F=>n(3,u=F));let{prevMode:_}=t;function w(){Xe(xn,r={mode:_},r)}function S(F){h=F,dy.set(h)}function E(F){a=F,my.set(a)}const M=()=>Xe(xn,r={mode:"title"},r),k=()=>Xe(xn,r={mode:"network"},r),D=()=>Xe(xn,r={mode:"neighbourhood"},r);return e.$$set=F=>{"prevMode"in F&&n(0,_=F.prevMode)},e.$$.update=()=>{e.$$.dirty&14&&n(4,i=JSON.parse(u.compareRoute(h.lng,h.lat,a.lng,a.lat)))},[_,a,h,u,i,r,w,S,E,M,k,D]}class Ik extends nn{constructor(t){super(),en(this,t,Sk,wk,Ye,{prevMode:0})}}const zb="/ltn/assets/settings_light-342fb430.svg",Ob="/ltn/assets/settings_dark-088e95f1.svg";function Fb(e){let t,n;return t=new i0({props:{$$slots:{default:[Ek]},$$scope:{ctx:e}}}),t.$on("close",e[5]),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&67&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function Ek(e){let t,n,i,r,a,h,u,_,w,S,E,M,k;return i=new _I({}),{c(){t=gt("h1"),t.textContent="Settings",n=Xt(),Wt(i.$$.fragment),r=Xt(),a=gt("label"),h=gt("input"),u=de(`
      Light mode`),_=Xt(),w=gt("center"),S=gt("button"),S.textContent="Confirm",Mt(h,"type","checkbox"),Mt(h,"role","switch")},m(D,F){xt(D,t,F),xt(D,n,F),jt(i,D,F),xt(D,r,F),xt(D,a,F),ct(a,h),h.checked=e[0],ct(a,u),xt(D,_,F),xt(D,w,F),ct(w,S),E=!0,M||(k=[Ge(h,"change",e[3]),Ge(S,"click",e[4])],M=!0)},p(D,F){F&1&&(h.checked=D[0])},i(D){E||(pt(i.$$.fragment,D),E=!0)},o(D){yt(i.$$.fragment,D),E=!1},d(D){D&&(vt(t),vt(n),vt(r),vt(a),vt(_),vt(w)),qt(i,D),M=!1,ro(k)}}}function Ck(e){let t,n,i,r,a,h,u,_,w=e[1]&&Fb(e);return{c(){t=gt("button"),n=gt("img"),r=Xt(),w&&w.c(),a=Oo(),jn(n.src,i=e[0]?zb:Ob)||Mt(n,"src",i),Mt(n,"alt","Settings"),Mt(t,"class","outline")},m(S,E){xt(S,t,E),ct(t,n),xt(S,r,E),w&&w.m(S,E),xt(S,a,E),h=!0,u||(_=Ge(t,"click",e[2]),u=!0)},p(S,[E]){(!h||E&1&&!jn(n.src,i=S[0]?zb:Ob))&&Mt(n,"src",i),S[1]?w?(w.p(S,E),E&2&&pt(w,1)):(w=Fb(S),w.c(),pt(w,1),w.m(a.parentNode,a)):w&&(ti(),yt(w,1,1,()=>{w=null}),ei())},i(S){h||(pt(w),h=!0)},o(S){yt(w),h=!1},d(S){S&&(vt(t),vt(r),vt(a)),w&&w.d(S),u=!1,_()}}}function Tk(e,t,n){let i;we(e,Hp,w=>n(0,i=w));let r=!1;const a=()=>n(1,r=!0);function h(){i=this.checked,Hp.set(i)}const u=()=>n(1,r=!1),_=()=>n(1,r=!1);return e.$$.update=()=>{e.$$.dirty&1&&document.documentElement.setAttribute("data-theme",i?"light":"dark")},[i,r,a,h,u,_]}class Lk extends nn{constructor(t){super(),en(this,t,Tk,Ck,Ye,{})}}function Mk(e){let t,n,i,r,a,h;const u=[Mr("route-points"),{filter:Bw},{paint:{"circle-color":Fp(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Fp(["get","type"],{node:Vm/2},Vm)}}];let _={};for(let k=0;k<u.length;k+=1)_=yr(_,u[k]);t=new wd({props:_});const w=[Mr("route-lines"),{filter:Fw},{paint:{"line-color":["case",["get","snapped"],"red","blue"],"line-width":2.5}}];let S={};for(let k=0;k<w.length;k+=1)S=yr(S,w[k]);i=new Ql({props:S});const E=[Mr("route-polygons"),{filter:Ow},{paint:{"fill-color":"black","fill-opacity":.5}}];let M={};for(let k=0;k<E.length;k+=1)M=yr(M,E[k]);return a=new xf({props:M}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment),r=Xt(),Wt(a.$$.fragment)},m(k,D){jt(t,k,D),xt(k,n,D),jt(i,k,D),xt(k,r,D),jt(a,k,D),h=!0},p(k,D){const F=D&0?ix(u,[u[0],u[1],{paint:{"circle-color":Fp(["get","type"],{"snapped-waypoint":"red","free-waypoint":"blue"},"black"),"circle-opacity":["case",["has","hovered"],.5,1],"circle-radius":Fp(["get","type"],{node:Vm/2},Vm)}}]):{};t.$set(F);const q={};i.$set(q);const X={};a.$set(X)},i(k){h||(pt(t.$$.fragment,k),pt(i.$$.fragment,k),pt(a.$$.fragment,k),h=!0)},o(k){yt(t.$$.fragment,k),yt(i.$$.fragment,k),yt(a.$$.fragment,k),h=!1},d(k){k&&(vt(n),vt(r)),qt(t,k),qt(i,k),qt(a,k)}}}function Pk(e){let t,n;return t=new ks({props:{data:e[0],$$slots:{default:[Mk]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&1&&(a.data=i[0]),r&2&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}const Vm=10;function kk(e,t,n){let i;return we(e,mx,r=>n(0,i=r)),[i]}class Ak extends nn{constructor(t){super(),en(this,t,kk,Pk,Ye,{})}}function Dk(e){let t,n,i;return{c(){t=de("Undo ("),n=de(e[1]),i=de(")")},m(r,a){xt(r,t,a),xt(r,n,a),xt(r,i,a)},p(r,a){a&2&&yi(n,r[1])},d(r){r&&(vt(t),vt(n),vt(i))}}}function Nk(e){let t;return{c(){t=de("Undo")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function Rk(e){let t,n,i,r,a,h;function u(S,E){return S[1]==0?Nk:Dk}let _=u(e),w=_(e);return{c(){t=gt("button"),w.c(),i=Xt(),r=gt("ul"),r.innerHTML=`<li><b>Click</b>
    the map to add points</li> <li><b>Click and drag</b>
    any point to move it</li> <li><b>Click</b>
    a waypoint to delete it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,t.disabled=n=e[1]==0},m(S,E){xt(S,t,E),w.m(t,null),xt(S,i,E),xt(S,r,E),a||(h=Ge(t,"click",e[2]),a=!0)},p(S,[E]){_===(_=u(S))&&w?w.p(S,E):(w.d(1),w=_(S),w&&(w.c(),w.m(t,null))),E&2&&n!==(n=S[1]==0)&&(t.disabled=n)},i:Ae,o:Ae,d(S){S&&(vt(t),vt(i),vt(r)),w.d(),a=!1,h()}}}function zk(e,t,n){let i;we(e,gx,h=>n(1,i=h));let{route_tool:r}=t;const a=()=>r.undo();return e.$$set=h=>{"route_tool"in h&&n(0,r=h.route_tool)},[r,i,a]}class Ok extends nn{constructor(t){super(),en(this,t,zk,Rk,Ye,{route_tool:0})}}function Fk(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function Bk(e){let t;return{c(){t=de("Pick neighbourhood")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function Vk(e){let t;return{c(){t=gt("li"),t.textContent="Creating new neighbourhood boundary"},m(n,i){xt(n,t,i)},p:Ae,i:Ae,o:Ae,d(n){n&&vt(t)}}}function Uk(e){let t,n,i,r,a;return n=new ri({props:{$$slots:{default:[Gk]},$$scope:{ctx:e}}}),n.$on("click",e[8]),{c(){t=gt("li"),Wt(n.$$.fragment),i=Xt(),r=gt("li"),r.textContent="Changing neighbourhood boundary"},m(h,u){xt(h,t,u),jt(n,t,null),xt(h,i,u),xt(h,r,u),a=!0},p(h,u){const _={};u&1024&&(_.$$scope={dirty:u,ctx:h}),n.$set(_)},i(h){a||(pt(n.$$.fragment,h),a=!0)},o(h){yt(n.$$.fragment,h),a=!1},d(h){h&&(vt(t),vt(i),vt(r)),qt(n)}}}function Gk(e){let t;return{c(){t=de("Editing")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function jk(e){let t,n,i,r,a,h,u,_,w,S,E,M;a=new ri({props:{$$slots:{default:[Fk]},$$scope:{ctx:e}}}),a.$on("click",e[6]),_=new ri({props:{$$slots:{default:[Bk]},$$scope:{ctx:e}}}),_.$on("click",e[7]);const k=[Uk,Vk],D=[];function F(q,X){return q[1]?0:1}return S=F(e),E=D[S]=k[S](e),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),Wt(_.$$.fragment),w=Xt(),E.c(),Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top")},m(q,X){xt(q,t,X),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),jt(_,u,null),ct(i,w),D[S].m(i,null),M=!0},p(q,X){const B={};X&1024&&(B.$$scope={dirty:X,ctx:q}),a.$set(B);const U={};X&1024&&(U.$$scope={dirty:X,ctx:q}),_.$set(U);let W=S;S=F(q),S===W?D[S].p(q,X):(ti(),yt(D[W],1,1,()=>{D[W]=null}),ei(),E=D[S],E?E.p(q,X):(E=D[S]=k[S](q),E.c()),pt(E,1),E.m(i,null))},i(q){M||(pt(a.$$.fragment,q),pt(_.$$.fragment,q),pt(E),M=!0)},o(q){yt(a.$$.fragment,q),yt(_.$$.fragment,q),yt(E),M=!1},d(q){q&&vt(t),qt(a),qt(_),D[S].d()}}}function qk(e){let t;return{c(){t=de("Finish")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function Zk(e){let t;return{c(){t=de("Cancel")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function Wk(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D;return u=new ri({props:{$$slots:{default:[qk]},$$scope:{ctx:e}}}),u.$on("click",e[5]),w=new ri({props:{$$slots:{default:[Zk]},$$scope:{ctx:e}}}),w.$on("click",e[4]),k=new Ok({props:{route_tool:ai(e[2])}}),{c(){t=gt("div"),n=gt("h1"),i=de("Draw your neighbourhood boundary for "),r=de(e[0]),a=Xt(),h=gt("div"),Wt(u.$$.fragment),_=Xt(),Wt(w.$$.fragment),S=Xt(),E=gt("p"),E.textContent="TODO: maybe move the instructions from the previous screen to here...",M=Xt(),Wt(k.$$.fragment),si(h,"display","flex"),si(h,"justify-content","space-between"),Mt(t,"slot","sidebar")},m(F,q){xt(F,t,q),ct(t,n),ct(n,i),ct(n,r),ct(t,a),ct(t,h),jt(u,h,null),ct(h,_),jt(w,h,null),ct(t,S),ct(t,E),ct(t,M),jt(k,t,null),D=!0},p(F,q){(!D||q&1)&&yi(r,F[0]);const X={};q&1024&&(X.$$scope={dirty:q,ctx:F}),u.$set(X);const B={};q&1024&&(B.$$scope={dirty:q,ctx:F}),w.$set(B);const U={};q&4&&(U.route_tool=ai(F[2])),k.$set(U)},i(F){D||(pt(u.$$.fragment,F),pt(w.$$.fragment,F),pt(k.$$.fragment,F),D=!0)},o(F){yt(u.$$.fragment,F),yt(w.$$.fragment,F),yt(k.$$.fragment,F),D=!1},d(F){F&&vt(t),qt(u),qt(w),qt(k)}}}function Hk(e){let t,n,i;return n=new Ak({}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","map")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p:Ae,i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function $k(e){let t,n;return t=new tu({props:{$$slots:{map:[Hk],sidebar:[Wk],top:[jk]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&1039&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function Xk(e,t,n){let i,r,a;we(e,Qm,k=>n(2,i=k)),we(e,xn,k=>n(3,r=k)),we(e,Fr,k=>n(9,a=k));let{name:h}=t,{existing:u}=t;u?i.editExistingArea(u):i.startArea();function _(){u?Xe(xn,r={mode:"neighbourhood"},r):Xe(xn,r={mode:"network"},r),i.clearEventListeners()}i.addEventListenerSuccess(k=>{try{a.setNeighbourhoodBoundary(h,k),$p(),a.setCurrentNeighbourhood(h),Xe(xn,r={mode:"neighbourhood"},r),i.clearEventListeners()}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),_()}}),i.addEventListenerFailure(_);const w=()=>ai(i).finish(),S=()=>Xe(xn,r={mode:"title"},r),E=()=>Xe(xn,r={mode:"network"},r),M=()=>Xe(xn,r={mode:"neighbourhood"},r);return e.$$set=k=>{"name"in k&&n(0,h=k.name),"existing"in k&&n(1,u=k.existing)},[h,u,i,r,_,w,S,E,M]}class Yk extends nn{constructor(t){super(),en(this,t,Xk,$k,Ye,{name:0,existing:1})}}async function Oy(e){Mu.set(e);try{let t=JSON.parse(window.localStorage.getItem(e));console.time("get OSM input");let n=await Kk(t);console.timeEnd("get OSM input"),console.time("load"),Fr.set(new sx(new Uint8Array(n),t.study_area_name||void 0)),Ta(Fr).loadSavefile(t),console.timeEnd("load"),Gw()}catch(t){window.alert(`Couldn't open project: ${t}`),Mu.set("")}}async function Kk(e){if(e.study_area_name){let t=Ta(Km)?`/osm/${e.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${e.study_area_name}.pbf`;return console.log(`Grabbing ${t}`),await(await fetch(t)).arrayBuffer()}else{console.log("Grabbing from Overpass");let t=e.features.find(r=>r.properties.kind=="study_area_boundary");return await(await fetch(Uw(t))).arrayBuffer()}}function Gw(){xn.set({mode:"network"}),Qm.set(new dI(Ta(al),Ta(Fr).toRouteSnapper())),Ta(al).fitBounds(Array.from(Ta(Fr).getBounds()),{animate:!1}),dy.set(Bb()),my.set(Bb())}function Bb(){let e=Ta(Fr).getBounds(),t=e[0]+Math.random()*(e[2]-e[0]),n=e[1]+Math.random()*(e[3]-e[1]);return new wg.LngLat(t,n)}function Vb(e,t,n){const i=e.slice();return i[19]=t[n],i}function Jk(e){let t;return{c(){t=gt("div"),t.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Mt(t,"slot","top")},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function Qk(e){let t;return{c(){t=gt("p"),t.textContent="Waiting for MapLibre and WASM to load..."},m(n,i){xt(n,t,i)},p:Ae,i:Ae,o:Ae,d(n){n&&vt(t)}}}function tA(e){let t,n,i,r,a,h,u,_,w,S,E,M,k;n=new ri({props:{$$slots:{default:[eA]},$$scope:{ctx:e}}}),n.$on("click",e[11]);let D=ps(e[2]),F=[];for(let X=0;X<D.length;X+=1)F[X]=Ub(Vb(e,D,X));const q=X=>yt(F[X],1,1,()=>{F[X]=null});return{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),r=gt("p"),r.textContent="Load a saved project:",a=Xt(),h=gt("ul");for(let X=0;X<F.length;X+=1)F[X].c();u=Xt(),_=gt("label"),w=de(`Load a project from a file
        `),S=gt("input"),Mt(S,"type","file")},m(X,B){xt(X,t,B),jt(n,t,null),xt(X,i,B),xt(X,r,B),xt(X,a,B),xt(X,h,B);for(let U=0;U<F.length;U+=1)F[U]&&F[U].m(h,null);xt(X,u,B),xt(X,_,B),ct(_,w),ct(_,S),e[15](S),E=!0,M||(k=Ge(S,"change",e[7]),M=!0)},p(X,B){const U={};if(B&4194304&&(U.$$scope={dirty:B,ctx:X}),n.$set(U),B&1860){D=ps(X[2]);let W;for(W=0;W<D.length;W+=1){const Q=Vb(X,D,W);F[W]?(F[W].p(Q,B),pt(F[W],1)):(F[W]=Ub(Q),F[W].c(),pt(F[W],1),F[W].m(h,null))}for(ti(),W=D.length;W<F.length;W+=1)q(W);ei()}},i(X){if(!E){pt(n.$$.fragment,X);for(let B=0;B<D.length;B+=1)pt(F[B]);E=!0}},o(X){yt(n.$$.fragment,X),F=F.filter(Boolean);for(let B=0;B<F.length;B+=1)yt(F[B]);E=!1},d(X){X&&(vt(t),vt(i),vt(r),vt(a),vt(h),vt(u),vt(_)),qt(n),ff(F,X),e[15](null),M=!1,k()}}}function eA(e){let t;return{c(){t=de("New project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function nA(e){let t=e[19]+"",n;return{c(){n=de(t)},m(i,r){xt(i,n,r)},p(i,r){r&4&&t!==(t=i[19]+"")&&yi(n,t)},d(i){i&&vt(n)}}}function Ub(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D,F;function q(){return e[12](e[19])}i=new ri({props:{$$slots:{default:[nA]},$$scope:{ctx:e}}}),i.$on("click",q);function X(){return e[13](e[19])}function B(){return e[14](e[19])}return{c(){t=gt("li"),n=gt("span"),Wt(i.$$.fragment),r=Xt(),a=gt("button"),h=gt("img"),_=Xt(),w=gt("button"),S=gt("img"),M=Xt(),jn(h.src,u=e[6]?yg:vg)||Mt(h,"src",u),Mt(h,"alt","Rename project"),Mt(a,"class","secondary"),jn(S.src,E=e[6]?gg:_g)||Mt(S,"src",E),Mt(S,"alt","Delete project"),Mt(w,"class","secondary"),si(n,"display","flex"),si(n,"justify-content","space-between")},m(U,W){xt(U,t,W),ct(t,n),jt(i,n,null),ct(n,r),ct(n,a),ct(a,h),ct(n,_),ct(n,w),ct(w,S),ct(t,M),k=!0,D||(F=[Ge(a,"click",X),Ge(w,"click",B)],D=!0)},p(U,W){e=U;const Q={};W&4194308&&(Q.$$scope={dirty:W,ctx:e}),i.$set(Q),(!k||W&64&&!jn(h.src,u=e[6]?yg:vg))&&Mt(h,"src",u),(!k||W&64&&!jn(S.src,E=e[6]?gg:_g))&&Mt(S,"src",E)},i(U){k||(pt(i.$$.fragment,U),k=!0)},o(U){yt(i.$$.fragment,U),k=!1},d(U){U&&vt(t),qt(i),D=!1,ro(F)}}}function iA(e){let t,n,i,r;const a=[tA,Qk],h=[];function u(_,w){return _[4]&&_[0]?0:1}return n=u(e),i=h[n]=a[n](e),{c(){t=gt("div"),i.c(),Mt(t,"slot","sidebar")},m(_,w){xt(_,t,w),h[n].m(t,null),r=!0},p(_,w){let S=n;n=u(_),n===S?h[n].p(_,w):(ti(),yt(h[S],1,1,()=>{h[S]=null}),ei(),i=h[n],i?i.p(_,w):(i=h[n]=a[n](_),i.c()),pt(i,1),i.m(t,null))},i(_){r||(pt(i),r=!0)},o(_){yt(i),r=!1},d(_){_&&vt(t),h[n].d()}}}function rA(e){let t,n,i,r;return t=new yw({props:{msg:e[1]}}),i=new tu({props:{$$slots:{sidebar:[iA],top:[Jk]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment)},m(a,h){jt(t,a,h),xt(a,n,h),jt(i,a,h),r=!0},p(a,[h]){const u={};h&2&&(u.msg=a[1]),t.$set(u);const _={};h&4194429&&(_.$$scope={dirty:h,ctx:a}),i.$set(_)},i(a){r||(pt(t.$$.fragment,a),pt(i.$$.fragment,a),r=!0)},o(a){yt(t.$$.fragment,a),yt(i.$$.fragment,a),r=!1},d(a){a&&vt(n),qt(t,a),qt(i,a)}}}function Um(){let e=[];for(let t=0;t<window.localStorage.length;t++){let n=window.localStorage.key(t);n.startsWith("ltn_")&&e.push(n)}return e.sort(),e}function oA(e,t,n){let i,r,a,h,u,_;we(e,Mu,ht=>n(16,i=ht)),we(e,Qm,ht=>n(17,r=ht)),we(e,Fr,ht=>n(18,a=ht)),we(e,al,ht=>n(4,h=ht)),we(e,xn,ht=>n(5,u=ht)),we(e,Hp,ht=>n(6,_=ht));let{wasmReady:w}=t,S=null;Xe(Fr,a=null,a),Xe(Qm,r=null,r),Xe(Mu,i="",i);let E=Um(),M;async function k(ht){let ut="ltn_"+M.files[0].name;n(1,S=`Loading from file ${ut}`),window.localStorage.setItem(ut,await M.files[0].text()),n(2,E=Um()),await Oy(ut),n(1,S=null)}function D(ht){window.confirm(`Really delete project ${ht}? You can't undo this.`)&&(window.localStorage.removeItem(ht),n(2,E=Um()))}function F(ht){let ut=window.prompt(`Rename project ${ht} to what?`,ht);if(ut){ut.startsWith("ltn_")||(ut=`ltn_${ut}`);let St=window.localStorage.getItem(ht);window.localStorage.setItem(ut,St),window.localStorage.removeItem(ht),n(2,E=Um())}}async function q(ht){n(1,S=`Loading project ${ht}`),await Oy(ht),n(1,S=null)}const X=()=>Xe(xn,u={mode:"new-project"},u),B=ht=>q(ht),U=ht=>F(ht),W=ht=>D(ht);function Q(ht){Or[ht?"unshift":"push"](()=>{M=ht,n(3,M)})}return e.$$set=ht=>{"wasmReady"in ht&&n(0,w=ht.wasmReady)},[w,S,E,M,h,u,_,k,D,F,q,X,B,U,W,Q]}class sA extends nn{constructor(t){super(),en(this,t,oA,rA,Ye,{wasmReady:0})}}function aA(e){let t,n,i,r,a,h;const u=[Mr("edit-polygon-fill"),{filter:Ow},{paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}];let _={};for(let k=0;k<u.length;k+=1)_=yr(_,u[k]);t=new xf({props:_});const w=[Mr("edit-polygon-lines"),{filter:Fw},{paint:{"line-color":"black","line-width":8,"line-opacity":.5}}];let S={};for(let k=0;k<w.length;k+=1)S=yr(S,w[k]);i=new Ql({props:S});const E=[Mr("edit-polygon-vertices"),{filter:Bw},{paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}];let M={};for(let k=0;k<E.length;k+=1)M=yr(M,E[k]);return a=new wd({props:M}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment),r=Xt(),Wt(a.$$.fragment)},m(k,D){jt(t,k,D),xt(k,n,D),jt(i,k,D),xt(k,r,D),jt(a,k,D),h=!0},p(k,D){const F={};t.$set(F);const q={};i.$set(q);const X={};a.$set(X)},i(k){h||(pt(t.$$.fragment,k),pt(i.$$.fragment,k),pt(a.$$.fragment,k),h=!0)},o(k){yt(t.$$.fragment,k),yt(i.$$.fragment,k),yt(a.$$.fragment,k),h=!1},d(k){k&&(vt(n),vt(r)),qt(t,k),qt(i,k),qt(a,k)}}}function lA(e){let t,n;return t=new ks({props:{data:e[0],$$slots:{default:[aA]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&1&&(a.data=i[0]),r&2&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function uA(e,t,n){let i;return we(e,kw,r=>n(0,i=r)),[i]}class cA extends nn{constructor(t){super(),en(this,t,uA,lA,Ye,{})}}function Gb(e,t,n){const i=e.slice();return i[17]=t[n][0],i[18]=t[n][1],i}function jb(e,t,n){const i=e.slice();return i[21]=t[n][0],i[22]=t[n][1],i}function hA(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function fA(e){let t,n,i,r,a,h,u,_;return a=new ri({props:{$$slots:{default:[hA]},$$scope:{ctx:e}}}),a.$on("click",e[13]),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),u.textContent="New project",Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top")},m(w,S){xt(w,t,S),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),_=!0},p(w,S){const E={};S&33554432&&(E.$$scope={dirty:S,ctx:w}),a.$set(E)},i(w){_||(pt(a.$$.fragment,w),_=!0)},o(w){yt(a.$$.fragment,w),_=!1},d(w){w&&vt(t),qt(a)}}}function qb(e){let t,n,i,r,a,h,u,_,w,S,E,M,k;t=new yw({props:{msg:e[4]}});let D=ps(e[3]),F=[];for(let q=0;q<D.length;q+=1)F[q]=Wb(Gb(e,D,q));return S=new sL({props:{map:e[5]}}),S.$on("gotXml",e[7]),S.$on("loading",e[11]),S.$on("error",e[12]),{c(){Wt(t.$$.fragment),n=Xt(),i=gt("label"),r=de(`Load a built-in area:
        `),a=gt("select"),h=gt("option");for(let q=0;q<F.length;q+=1)F[q].c();u=Xt(),_=gt("i"),_.textContent="or...",w=Xt(),Wt(S.$$.fragment),h.__value="",La(h,h.__value),e[2]===void 0&&Wp(()=>e[9].call(a))},m(q,X){jt(t,q,X),xt(q,n,X),xt(q,i,X),ct(i,r),ct(i,a),ct(a,h);for(let B=0;B<F.length;B+=1)F[B]&&F[B].m(a,null);Xm(a,e[2],!0),xt(q,u,X),xt(q,_,X),xt(q,w,X),jt(S,q,X),E=!0,M||(k=[Ge(a,"change",e[9]),Ge(a,"change",e[10])],M=!0)},p(q,X){const B={};if(X&16&&(B.msg=q[4]),t.$set(B),X&8){D=ps(q[3]);let W;for(W=0;W<D.length;W+=1){const Q=Gb(q,D,W);F[W]?F[W].p(Q,X):(F[W]=Wb(Q),F[W].c(),F[W].m(a,null))}for(;W<F.length;W+=1)F[W].d(1);F.length=D.length}X&12&&Xm(a,q[2]);const U={};X&32&&(U.map=q[5]),S.$set(U)},i(q){E||(pt(t.$$.fragment,q),pt(S.$$.fragment,q),E=!0)},o(q){yt(t.$$.fragment,q),yt(S.$$.fragment,q),E=!1},d(q){q&&(vt(n),vt(i),vt(u),vt(_),vt(w)),qt(t,q),ff(F,q),qt(S,q),M=!1,ro(k)}}}function Zb(e){let t,n=e[22]+"",i,r;return{c(){t=gt("option"),i=de(n),t.__value=r=e[21],La(t,t.__value)},m(a,h){xt(a,t,h),ct(t,i)},p(a,h){h&8&&n!==(n=a[22]+"")&&yi(i,n),h&8&&r!==(r=a[21])&&(t.__value=r,La(t,t.__value))},d(a){a&&vt(t)}}}function Wb(e){let t,n,i=ps(e[18]),r=[];for(let a=0;a<i.length;a+=1)r[a]=Zb(jb(e,i,a));return{c(){t=gt("optgroup");for(let a=0;a<r.length;a+=1)r[a].c();Mt(t,"label",n=e[17])},m(a,h){xt(a,t,h);for(let u=0;u<r.length;u+=1)r[u]&&r[u].m(t,null)},p(a,h){if(h&8){i=ps(a[18]);let u;for(u=0;u<i.length;u+=1){const _=jb(a,i,u);r[u]?r[u].p(_,h):(r[u]=Zb(_),r[u].c(),r[u].m(t,null))}for(;u<r.length;u+=1)r[u].d(1);r.length=i.length}h&8&&n!==(n=a[17])&&Mt(t,"label",n)},d(a){a&&vt(t),ff(r,a)}}}function pA(e){let t,n,i,r,a,h,u,_,w,S=e[1]&&qb(e);return{c(){t=gt("div"),n=gt("div"),i=gt("label"),r=de(`Project name:
        `),a=gt("input"),h=Xt(),S&&S.c(),Mt(a,"type","text"),Mt(t,"slot","sidebar")},m(E,M){xt(E,t,M),ct(t,n),ct(n,i),ct(i,r),ct(i,a),La(a,e[1]),ct(t,h),S&&S.m(t,null),u=!0,_||(w=Ge(a,"input",e[8]),_=!0)},p(E,M){M&2&&a.value!==E[1]&&La(a,E[1]),E[1]?S?(S.p(E,M),M&2&&pt(S,1)):(S=qb(E),S.c(),pt(S,1),S.m(t,null)):S&&(ti(),yt(S,1,1,()=>{S=null}),ei())},i(E){u||(pt(S),u=!0)},o(E){yt(S),u=!1},d(E){E&&vt(t),S&&S.d(),_=!1,w()}}}function dA(e){let t,n,i;return n=new cA({}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","map")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p:Ae,i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function mA(e){let t,n;return t=new tu({props:{$$slots:{map:[dA],sidebar:[pA],top:[fA]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,[r]){const a={};r&33554558&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function gA(e,t,n){let i,r,a,h,u;we(e,Mu,W=>n(14,i=W)),we(e,Fr,W=>n(15,r=W)),we(e,Km,W=>n(16,a=W)),we(e,al,W=>n(5,h=W)),we(e,xn,W=>n(6,u=W));let _="",w="",S=[],E=null;xg(async()=>{let W=await fetch(a?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");n(3,S=await W.json())});function M(W){try{Xe(Fr,r=new sx(new TextEncoder().encode(W.detail),void 0),r),Xe(Mu,i=`ltn_${_}`,i),Gw(),$p()}catch(Q){window.alert(`Couldn't import from Overpass: ${Q}`)}n(4,E=null)}async function k(){if(w=="")return;let W=`ltn_${_}`;window.localStorage.setItem(W,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:w})),n(4,E=`Loading pre-clipped OSM area ${w}`),await Oy(W),n(4,E=null)}function D(){_=this.value,n(1,_)}function F(){w=Jb(this),n(2,w),n(3,S)}return[k,_,w,S,E,h,u,M,D,F,()=>k(),W=>n(4,E=W.detail),W=>window.alert(W.detail),()=>Xe(xn,u={mode:"title"},u)]}class _A extends nn{constructor(t){super(),en(this,t,gA,mA,Ye,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const{window:yA}=FS;function vA(e){let t;return{c(){t=de("Choose project")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function bA(e){let t;return{c(){t=de("Pick neighbourhood")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function xA(e){let t;return{c(){t=de("Editing")},m(n,i){xt(n,t,i)},d(n){n&&vt(t)}}}function wA(e){let t,n,i,r,a,h,u,_,w,S,E,M,k,D;return a=new ri({props:{$$slots:{default:[vA]},$$scope:{ctx:e}}}),a.$on("click",e[9]),_=new ri({props:{$$slots:{default:[bA]},$$scope:{ctx:e}}}),_.$on("click",e[10]),E=new ri({props:{$$slots:{default:[xA]},$$scope:{ctx:e}}}),E.$on("click",e[5]),{c(){t=gt("div"),n=gt("nav"),i=gt("ul"),r=gt("li"),Wt(a.$$.fragment),h=Xt(),u=gt("li"),Wt(_.$$.fragment),w=Xt(),S=gt("li"),Wt(E.$$.fragment),M=Xt(),k=gt("li"),k.textContent="Viewing shortcuts",Mt(n,"aria-label","breadcrumb"),Mt(t,"slot","top")},m(F,q){xt(F,t,q),ct(t,n),ct(n,i),ct(i,r),jt(a,r,null),ct(i,h),ct(i,u),jt(_,u,null),ct(i,w),ct(i,S),jt(E,S,null),ct(i,M),ct(i,k),D=!0},p(F,q){const X={};q&8192&&(X.$$scope={dirty:q,ctx:F}),a.$set(X);const B={};q&8192&&(B.$$scope={dirty:q,ctx:F}),_.$set(B);const U={};q&8192&&(U.$$scope={dirty:q,ctx:F}),E.$set(U)},i(F){D||(pt(a.$$.fragment,F),pt(_.$$.fragment,F),pt(E.$$.fragment,F),D=!0)},o(F){yt(a.$$.fragment,F),yt(_.$$.fragment,F),yt(E.$$.fragment,F),D=!1},d(F){F&&vt(t),qt(a),qt(_),qt(E)}}}function SA(e){let t,n,i,r,a,h,u,_,w,S=e[0].shortcutIndex+1+"",E,M,k=e[0].gj.features.length+"",D,F,q,X,B,U,W,Q,ht,ut=ai(e[0].gj.features[e[0].shortcutIndex].properties).directness.toFixed(1)+"",St,lt,zt,wt,_t;return{c(){t=gt("p"),t.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=Xt(),i=gt("button"),i.textContent="Pick a different road",r=Xt(),a=gt("div"),h=gt("button"),u=de("Previous"),w=Xt(),E=de(S),M=de(" / "),D=de(k),F=Xt(),q=gt("button"),X=de("Next"),U=Xt(),W=gt("p"),Q=de("This shortcut is "),ht=gt("b"),St=de(ut),lt=de("x"),zt=de(`
        the length of the shortest route using all roads, not just this neighbourhood`),h.disabled=_=e[0].shortcutIndex==0,q.disabled=B=e[0].shortcutIndex==e[0].gj.features.length-1,si(a,"display","flex"),si(a,"justify-content","space-between")},m(te,Pt){xt(te,t,Pt),xt(te,n,Pt),xt(te,i,Pt),xt(te,r,Pt),xt(te,a,Pt),ct(a,h),ct(h,u),ct(a,w),ct(a,E),ct(a,M),ct(a,D),ct(a,F),ct(a,q),ct(q,X),xt(te,U,Pt),xt(te,W,Pt),ct(W,Q),ct(W,ht),ct(ht,St),ct(ht,lt),ct(W,zt),wt||(_t=[Ge(i,"click",e[8]),Ge(h,"click",e[6]),Ge(q,"click",e[7])],wt=!0)},p(te,Pt){Pt&1&&_!==(_=te[0].shortcutIndex==0)&&(h.disabled=_),Pt&1&&S!==(S=te[0].shortcutIndex+1+"")&&yi(E,S),Pt&1&&k!==(k=te[0].gj.features.length+"")&&yi(D,k),Pt&1&&B!==(B=te[0].shortcutIndex==te[0].gj.features.length-1)&&(q.disabled=B),Pt&1&&ut!==(ut=ai(te[0].gj.features[te[0].shortcutIndex].properties).directness.toFixed(1)+"")&&yi(St,ut)},d(te){te&&(vt(t),vt(n),vt(i),vt(r),vt(a),vt(U),vt(W)),wt=!1,ro(_t)}}}function IA(e){let t;return{c(){t=gt("p"),t.textContent="Click a road to see shortcuts"},m(n,i){xt(n,t,i)},p:Ae,d(n){n&&vt(t)}}}function EA(e){let t,n,i,r;n=new Vg({}),n.$on("click",e[5]);function a(_,w){if(_[0].state=="neutral")return IA;if(_[0].state=="chose-road")return SA}let h=a(e),u=h&&h(e);return{c(){t=gt("div"),Wt(n.$$.fragment),i=Xt(),u&&u.c(),Mt(t,"slot","sidebar")},m(_,w){xt(_,t,w),jt(n,t,null),ct(t,i),u&&u.m(t,null),r=!0},p(_,w){h===(h=a(_))&&u?u.p(_,w):(u&&u.d(1),u=h&&h(_),u&&(u.c(),u.m(t,null)))},i(_){r||(pt(n.$$.fragment,_),r=!0)},o(_){yt(n.$$.fragment,_),r=!1},d(_){_&&vt(t),qt(n),u&&u.d()}}}function CA(e){let t,n,i,r,a,h;return t=new ks({props:{data:zy(JSON.parse(ai(e[2]).renderNeighbourhood())),$$slots:{default:[LA]},$$scope:{ctx:e}}}),i=new ks({props:{data:e[0].gj.features[e[0].shortcutIndex],$$slots:{default:[MA]},$$scope:{ctx:e}}}),a=new ks({props:{data:e[0].roadGj,$$slots:{default:[PA]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment),r=Xt(),Wt(a.$$.fragment)},m(u,_){jt(t,u,_),xt(u,n,_),jt(i,u,_),xt(u,r,_),jt(a,u,_),h=!0},p(u,_){const w={};_&4&&(w.data=zy(JSON.parse(ai(u[2]).renderNeighbourhood()))),_&8192&&(w.$$scope={dirty:_,ctx:u}),t.$set(w);const S={};_&1&&(S.data=u[0].gj.features[u[0].shortcutIndex]),_&8192&&(S.$$scope={dirty:_,ctx:u}),i.$set(S);const E={};_&1&&(E.data=u[0].roadGj),_&8192&&(E.$$scope={dirty:_,ctx:u}),a.$set(E)},i(u){h||(pt(t.$$.fragment,u),pt(i.$$.fragment,u),pt(a.$$.fragment,u),h=!0)},o(u){yt(t.$$.fragment,u),yt(i.$$.fragment,u),yt(a.$$.fragment,u),h=!1},d(u){u&&(vt(n),vt(r)),qt(t,u),qt(i,u),qt(a,u)}}}function TA(e){let t,n;return t=new Ug({props:{gjInput:JSON.parse(ai(e[2]).renderNeighbourhood()),onClickLine:e[3],$$slots:{"line-popup":[AA]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&4&&(a.gjInput=JSON.parse(ai(i[2]).renderNeighbourhood())),r&8192&&(a.$$scope={dirty:r,ctx:i}),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function LA(e){let t,n;const i=[Mr("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new xf({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function MA(e){let t,n;const i=[Mr("shortcuts"),{paint:{"line-width":5,"line-color":"red"}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new Ql({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function PA(e){let t,n;const i=[Mr("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new Ql({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function kA(e){let t,n=e[12].shortcuts+"",i,r,a=(e[12].name??"unnamed road")+"",h;return{c(){t=gt("p"),i=de(n),r=de(" shortcuts through "),h=de(a)},m(u,_){xt(u,t,_),ct(t,i),ct(t,r),ct(t,h)},p(u,_){_&4096&&n!==(n=u[12].shortcuts+"")&&yi(i,n),_&4096&&a!==(a=(u[12].name??"unnamed road")+"")&&yi(h,a)},d(u){u&&vt(t)}}}function AA(e){let t,n,i;return n=new gl({props:{openOn:"hover",$$slots:{default:[kA,({props:r})=>({12:r}),({props:r})=>r?4096:0]},$$scope:{ctx:e}}}),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","line-popup")},m(r,a){xt(r,t,a),jt(n,t,null),i=!0},p(r,a){const h={};a&12288&&(h.$$scope={dirty:a,ctx:r}),n.$set(h)},i(r){i||(pt(n.$$.fragment,r),i=!0)},o(r){yt(n.$$.fragment,r),i=!1},d(r){r&&vt(t),qt(n)}}}function DA(e){let t,n,i,r,a,h;const u=[TA,CA],_=[];function w(S,E){return S[0].state=="neutral"?0:S[0].state=="chose-road"?1:-1}return~(n=w(e))&&(i=_[n]=u[n](e)),a=new Gg({}),{c(){t=gt("div"),i&&i.c(),r=Xt(),Wt(a.$$.fragment),Mt(t,"slot","map")},m(S,E){xt(S,t,E),~n&&_[n].m(t,null),ct(t,r),jt(a,t,null),h=!0},p(S,E){let M=n;n=w(S),n===M?~n&&_[n].p(S,E):(i&&(ti(),yt(_[M],1,1,()=>{_[M]=null}),ei()),~n?(i=_[n],i?i.p(S,E):(i=_[n]=u[n](S),i.c()),pt(i,1),i.m(t,r)):i=null)},i(S){h||(pt(i),pt(a.$$.fragment,S),h=!0)},o(S){yt(i),yt(a.$$.fragment,S),h=!1},d(S){S&&vt(t),~n&&_[n].d(),qt(a)}}}function NA(e){let t,n,i,r;return t=new tu({props:{$$slots:{map:[DA],sidebar:[EA],top:[wA]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0,i||(r=Ge(yA,"keydown",e[4]),i=!0)},p(a,[h]){const u={};h&8199&&(u.$$scope={dirty:h,ctx:a}),t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a),i=!1,r()}}}function RA(e,t,n){let i,r,a;we(e,xn,F=>n(1,i=F)),we(e,al,F=>n(11,r=F)),we(e,Fr,F=>n(2,a=F));let h={state:"neutral"};function u(F){let q=JSON.parse(a.getShortcutsCrossingRoad(F.properties.id));if(q.features.length==0){window.alert("No shortcuts here");return}n(0,h={state:"chose-road",roadGj:F,gj:q,shortcutIndex:0})}xg(()=>{r==null||r.keyboard.disable()}),na(()=>{r==null||r.keyboard.enable()});function _(F){h.state=="chose-road"&&(F.key=="ArrowLeft"&&h.shortcutIndex>0&&(F.stopPropagation(),n(0,h.shortcutIndex--,h)),F.key=="ArrowRight"&&(F.stopPropagation(),h.shortcutIndex!=h.gj.features.length-1&&n(0,h.shortcutIndex++,h)))}function w(){Xe(xn,i={mode:"neighbourhood"},i)}function S(){h.state=="chose-road"&&n(0,h.shortcutIndex--,h)}function E(){h.state=="chose-road"&&n(0,h.shortcutIndex++,h)}return[h,i,a,u,_,w,S,E,()=>n(0,h={state:"neutral"}),()=>Xe(xn,i={mode:"title"},i),()=>Xe(xn,i={mode:"network"},i)]}class zA extends nn{constructor(t){super(),en(this,t,RA,NA,Ye,{})}}function OA(e){let t,n,i,r,a,h,u,_,w,S,E;return h=new Lk({}),{c(){t=gt("div"),n=gt("button"),i=gt("img"),a=Xt(),Wt(h.$$.fragment),u=Xt(),_=gt("span"),jn(i.src,r=e[9]?yb:vb)||Mt(i,"src",r),si(i,"height","6vh"),Mt(i,"alt","A/B Street logo"),Mt(n,"class","outline"),si(_,"width","100%"),Mt(t,"slot","top"),si(t,"display","flex")},m(M,k){xt(M,t,k),ct(t,n),ct(n,i),ct(t,a),jt(h,t,null),ct(t,u),ct(t,_),e[19](_),w=!0,S||(E=Ge(n,"click",e[18]),S=!0)},p(M,k){(!w||k&512&&!jn(i.src,r=M[9]?yb:vb))&&Mt(i,"src",r)},i(M){w||(pt(h.$$.fragment,M),w=!0)},o(M){yt(h.$$.fragment,M),w=!1},d(M){M&&vt(t),qt(h),e[19](null),S=!1,E()}}}function Hb(e){let t,n,i;return{c(){t=gt("button"),t.textContent="Zoom to fit study area",Mt(t,"class","secondary")},m(r,a){xt(r,t,a),n||(i=Ge(t,"click",e[10]),n=!0)},p:Ae,d(r){r&&vt(t),n=!1,i()}}}function FA(e){let t,n,i,r,a,h=e[5]&&Hb(e);return{c(){t=gt("div"),n=gt("div"),i=Xt(),r=gt("hr"),a=Xt(),h&&h.c(),Mt(t,"slot","left")},m(u,_){xt(u,t,_),ct(t,n),e[17](n),ct(t,i),ct(t,r),ct(t,a),h&&h.m(t,null)},p(u,_){u[5]?h?h.p(u,_):(h=Hb(u),h.c(),h.m(t,null)):h&&(h.d(1),h=null)},d(u){u&&vt(t),e[17](null),h&&h.d()}}}function BA(e){let t,n;return t=new _A({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function VA(e){let t,n;return t=new sA({props:{wasmReady:e[4]}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&16&&(a.wasmReady=i[4]),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function $b(e){let t,n,i,r,a,h;t=new ks({props:{data:JSON.parse(e[5].getInvertedBoundary()),$$slots:{default:[UA]},$$scope:{ctx:e}}});const u=[$A,HA,WA,ZA,qA,jA,GA],_=[];function w(S,E){return S[7].mode=="network"?0:S[7].mode=="set-boundary"?1:S[7].mode=="neighbourhood"?2:S[7].mode=="view-shortcuts"?3:S[7].mode=="route"?4:S[7].mode=="debug"?5:S[7].mode=="debug-gj"?6:-1}return~(i=w(e))&&(r=_[i]=u[i](e)),{c(){Wt(t.$$.fragment),n=Xt(),r&&r.c(),a=Oo()},m(S,E){jt(t,S,E),xt(S,n,E),~i&&_[i].m(S,E),xt(S,a,E),h=!0},p(S,E){const M={};E&32&&(M.data=JSON.parse(S[5].getInvertedBoundary())),E&4194304&&(M.$$scope={dirty:E,ctx:S}),t.$set(M);let k=i;i=w(S),i===k?~i&&_[i].p(S,E):(r&&(ti(),yt(_[k],1,1,()=>{_[k]=null}),ei()),~i?(r=_[i],r?r.p(S,E):(r=_[i]=u[i](S),r.c()),pt(r,1),r.m(a.parentNode,a)):r=null)},i(S){h||(pt(t.$$.fragment,S),pt(r),h=!0)},o(S){yt(t.$$.fragment,S),yt(r),h=!1},d(S){S&&(vt(n),vt(a)),qt(t,S),~i&&_[i].d(S)}}}function UA(e){let t,n;const i=[Mr("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let r={};for(let a=0;a<i.length;a+=1)r=yr(r,i[a]);return t=new xf({props:r}),{c(){Wt(t.$$.fragment)},m(a,h){jt(t,a,h),n=!0},p(a,h){const u={};t.$set(u)},i(a){n||(pt(t.$$.fragment,a),n=!0)},o(a){yt(t.$$.fragment,a),n=!1},d(a){qt(t,a)}}}function GA(e){let t,n;return t=new bP({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function jA(e){let t,n;return t=new lP({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function qA(e){let t,n;return t=new Ik({props:{prevMode:e[7].prevMode}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&128&&(a.prevMode=i[7].prevMode),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function ZA(e){let t,n;return t=new zA({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function WA(e){let t,n;return t=new JP({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function HA(e){let t,n;return t=new Yk({props:{name:e[7].name,existing:e[7].existing}}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p(i,r){const a={};r&128&&(a.name=i[7].name),r&128&&(a.existing=i[7].existing),t.$set(a)},i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function $A(e){let t,n;return t=new fk({}),{c(){Wt(t.$$.fragment)},m(i,r){jt(t,i,r),n=!0},p:Ae,i(i){n||(pt(t.$$.fragment,i),n=!0)},o(i){yt(t.$$.fragment,i),n=!1},d(i){qt(t,i)}}}function XA(e){let t,n,i,r,a,h,u,_,w;t=new JC({});const S=[VA,BA],E=[];function M(D,F){return D[7].mode=="title"?0:D[7].mode=="new-project"?1:-1}~(a=M(e))&&(h=E[a]=S[a](e));let k=e[5]&&$b(e);return{c(){Wt(t.$$.fragment),n=Xt(),i=gt("div"),r=Xt(),h&&h.c(),u=Xt(),k&&k.c(),_=Oo()},m(D,F){jt(t,D,F),xt(D,n,F),xt(D,i,F),e[14](i),xt(D,r,F),~a&&E[a].m(D,F),xt(D,u,F),k&&k.m(D,F),xt(D,_,F),w=!0},p(D,F){let q=a;a=M(D),a===q?~a&&E[a].p(D,F):(h&&(ti(),yt(E[q],1,1,()=>{E[q]=null}),ei()),~a?(h=E[a],h?h.p(D,F):(h=E[a]=S[a](D),h.c()),pt(h,1),h.m(u.parentNode,u)):h=null),D[5]?k?(k.p(D,F),F&32&&pt(k,1)):(k=$b(D),k.c(),pt(k,1),k.m(_.parentNode,_)):k&&(ti(),yt(k,1,1,()=>{k=null}),ei())},i(D){w||(pt(t.$$.fragment,D),pt(h),pt(k),w=!0)},o(D){yt(t.$$.fragment,D),yt(h),yt(k),w=!1},d(D){D&&(vt(n),vt(i),vt(r),vt(u),vt(_)),qt(t,D),e[14](null),~a&&E[a].d(D),k&&k.d(D)}}}function YA(e){let t,n,i,r;function a(u){e[15](u)}let h={style:`https://api.maptiler.com/maps/${e[6]}/style.json?key=${uy}`,standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:TM}],$$slots:{default:[XA]},$$scope:{ctx:e}};return e[0]!==void 0&&(h.map=e[0]),n=new HL({props:h}),Or.push(()=>_c(n,"map",a)),n.$on("error",e[16]),{c(){t=gt("div"),Wt(n.$$.fragment),Mt(t,"slot","main"),si(t,"position","relative"),si(t,"width","100%"),si(t,"height","100%")},m(u,_){xt(u,t,_),jt(n,t,null),r=!0},p(u,_){const w={};_&64&&(w.style=`https://api.maptiler.com/maps/${u[6]}/style.json?key=${uy}`),_&4194488&&(w.$$scope={dirty:_,ctx:u}),!i&&_&1&&(i=!0,w.map=u[0],gc(()=>i=!1)),n.$set(w)},i(u){r||(pt(n.$$.fragment,u),r=!0)},o(u){yt(n.$$.fragment,u),r=!1},d(u){u&&vt(t),qt(n)}}}function KA(e){let t,n,i,r;return t=new CM({}),i=new rT({props:{$$slots:{main:[YA],left:[FA],top:[OA]},$$scope:{ctx:e}}}),{c(){Wt(t.$$.fragment),n=Xt(),Wt(i.$$.fragment)},m(a,h){jt(t,a,h),xt(a,n,h),jt(i,a,h),r=!0},p(a,[h]){const u={};h&4195327&&(u.$$scope={dirty:h,ctx:a}),i.$set(u)},i(a){r||(pt(t.$$.fragment,a),pt(i.$$.fragment,a),r=!0)},o(a){yt(t.$$.fragment,a),yt(i.$$.fragment,a),r=!1},d(a){a&&vt(n),qt(t,a),qt(i,a)}}}function JA(e,t,n){let i,r,a,h,u,_,w,S,E,M;we(e,py,lt=>n(11,i=lt)),we(e,fy,lt=>n(12,r=lt)),we(e,hy,lt=>n(13,a=lt)),we(e,Fr,lt=>n(5,h=lt)),we(e,al,lt=>n(20,u=lt)),we(e,Km,lt=>n(21,_=lt)),we(e,cy,lt=>n(6,w=lt)),we(e,xn,lt=>n(7,S=lt)),we(e,Jm,lt=>n(8,E=lt)),we(e,Hp,lt=>n(9,M=lt));let k=!1;xg(async()=>{await ax(),await dx(),n(4,k=!0);try{(await fetch("/osm/areas.json")).ok&&(Xe(Km,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let D;function F(){u.fitBounds(Array.from(h.getBounds()),{animate:!1})}let q,X,B;function U(lt){Or[lt?"unshift":"push"](()=>{B=lt,n(3,B),n(11,i)})}function W(lt){D=lt,n(0,D)}const Q=lt=>{console.log(lt.detail.error)};function ht(lt){Or[lt?"unshift":"push"](()=>{X=lt,n(2,X),n(12,r)})}const ut=()=>Xe(Jm,E=!0,E);function St(lt){Or[lt?"unshift":"push"](()=>{q=lt,n(1,q),n(13,a)})}return e.$$.update=()=>{e.$$.dirty&1&&D&&al.set(D),e.$$.dirty&8194&&q&&a&&(n(1,q.innerHTML="",q),q.appendChild(a)),e.$$.dirty&4100&&X&&r&&(n(2,X.innerHTML="",X),X.appendChild(r)),e.$$.dirty&2056&&B&&i&&(n(3,B.innerHTML="",B),B.appendChild(i))},[D,q,X,B,k,h,w,S,E,M,F,i,r,a,U,W,Q,ht,ut,St]}class QA extends nn{constructor(t){super(),en(this,t,JA,KA,Ye,{})}}new QA({target:document.getElementById("app")});
