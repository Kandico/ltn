var Qs=Object.defineProperty;var xs=(r,e,n)=>e in r?Qs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var pt=(r,e,n)=>(xs(r,typeof e!="symbol"?e+"":e,n),n);import{S as se,i as ae,s as le,e as Ye,a as b,n as Q,d as $,b as k,t as z,c as M,f as N,g as p,h as ne,j as oe,k as Re,l as K,u as De,m as Ue,o as He,p as v,q as S,r as nt,v as je,w as Ge,x as Me,y as st,z as ea,A as dl,B as ta,C as he,D as be,E as V,F as pr,G as P,H as I,I as E,J as te,L as Yi,K as ut,M as ct,N as _l,O as gt,P as ml,Q as Tt,R as na,T as mn,U as Cl,V as Rr,W as Zi,X as Yr,Y as ra,Z as Xt,_ as la,$ as Sr,a0 as oa,a1 as ia,a2 as sa,a3 as aa,a4 as gr,a5 as fa,a6 as ze,a7 as fn,a8 as yt,a9 as Zr,aa as un,ab as Mt,ac as Ve,ad as wt,ae as _e,af as Jt,ag as hr,ah as Ll,ai as Vt,aj as Qt,ak as Ki,al as Xi,am as Wt,an as St,ao as tt,ap as Ke,aq as Ml,ar as ua,as as ca,at as da,au as _a,av as dt,aw as at,ax as vn,ay as Le,az as Yt,aA as ce,aB as Jn,aC as xe,aD as Tn,aE as br,aF as Kr,aG as pl,aH as zt,aI as Vi,aJ as Xr,aK as Tl,aL as fr,aM as Yn,aN as Zn,aO as Vr,aP as Al,aQ as ma,aR as Qr,aS as pa,aT as Fl,aU as ga,aV as ha}from"./pico.conditional.jade.min-4f0550d9.js";function Oe(r,e){const n={},t={},l={$$scope:1};let o=r.length;for(;o--;){const i=r[o],s=e[o];if(s){for(const a in i)a in s||(t[a]=1);for(const a in s)l[a]||(n[a]=s[a],l[a]=1);r[o]=s}else for(const a in i)l[a]=1}for(const i in t)i in n||(n[i]=void 0);return n}function Cr(r){return typeof r=="object"&&r!==null?r:{}}const ba="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",$a="/ltn/assets/logo-97f2d067.svg",Qi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function Pl(r){let e,n,t,l=r[1]!=null&&Il(r);return{c(){e=k("div"),n=z(r[0]),t=M(),l&&l.c(),N(e,"class","cover svelte-1w7hi45")},m(o,i){b(o,e,i),p(e,n),p(e,t),l&&l.m(e,null)},p(o,i){i&1&&ne(n,o[0]),o[1]!=null?l?l.p(o,i):(l=Il(o),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(o){o&&$(e),l&&l.d()}}}function Il(r){let e,n;return{c(){e=k("div"),n=k("progress"),n.value=r[1],oe(n,"width","100%")},m(t,l){b(t,e,l),p(e,n)},p(t,l){l&2&&(n.value=t[1])},d(t){t&&$(e)}}}function va(r){let e,n=r[0]&&Pl(r);return{c(){n&&n.c(),e=Ye()},m(t,l){n&&n.m(t,l),b(t,e,l)},p(t,[l]){t[0]?n?n.p(t,l):(n=Pl(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:Q,o:Q,d(t){t&&$(e),n&&n.d(t)}}}function ya(r,e,n){let{loading:t}=e,{progress:l=null}=e;return r.$$set=o=>{"loading"in o&&n(0,t=o.loading),"progress"in o&&n(1,l=o.progress)},[t,l]}class xi extends se{constructor(e){super(),ae(this,e,ya,va,le,{loading:0,progress:1})}}const wa=r=>({dialog:r&1}),El=r=>({dialog:r[0]});function ka(r){let e,n,t,l,o;const i=r[4].default,s=Re(i,r,r[3],El);return{c(){e=k("dialog"),n=k("article"),s&&s.c(),e.open=!0},m(a,f){b(a,e,f),p(e,n),s&&s.m(n,null),r[6](e),t=!0,l||(o=[K(window,"click",r[1]),K(window,"keydown",r[2]),K(e,"close",r[5])],l=!0)},p(a,[f]){s&&s.p&&(!t||f&9)&&De(s,i,a,a[3],t?He(i,a[3],f,wa):Ue(a[3]),El)},i(a){t||(v(s,a),t=!0)},o(a){S(s,a),t=!1},d(a){a&&$(e),s&&s.d(a),r[6](null),l=!1,nt(o)}}}function Sa(r,e,n){let{$$slots:t={},$$scope:l}=e,o;function i(u){o.open&&u.target==o&&o.close()}function s(u){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),o.close())}function a(u){je.call(this,r,u)}function f(u){Ge[u?"unshift":"push"](()=>{o=u,n(0,o)})}return r.$$set=u=>{"$$scope"in u&&n(3,l=u.$$scope)},[o,i,s,l,t,a,f]}class Lr extends se{constructor(e){super(),ae(this,e,Sa,ka,le,{})}}function Nl(r,e,n){const t=r.slice();return t[1]=e[n][0],t[2]=e[n][1],t}function jl(r){let e,n,t=r[1]+"",l,o,i,s=r[2]+"",a,f;return{c(){e=k("tr"),n=k("td"),l=z(t),o=M(),i=k("td"),a=z(s),f=M()},m(u,c){b(u,e,c),p(e,n),p(n,l),p(e,o),p(e,i),p(i,a),p(e,f)},p(u,c){c&1&&t!==(t=u[1]+"")&&ne(l,t),c&1&&s!==(s=u[2]+"")&&ne(a,s)},d(u){u&&$(e)}}}function Ca(r){let e,n,t=Me(Object.entries(r[0])),l=[];for(let o=0;o<t.length;o+=1)l[o]=jl(Nl(r,t,o));return{c(){e=k("table"),n=k("tbody");for(let o=0;o<l.length;o+=1)l[o].c();N(e,"class","svelte-lh2o9l")},m(o,i){b(o,e,i),p(e,n);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(n,null)},p(o,[i]){if(i&1){t=Me(Object.entries(o[0]));let s;for(s=0;s<t.length;s+=1){const a=Nl(o,t,s);l[s]?l[s].p(a,i):(l[s]=jl(a),l[s].c(),l[s].m(n,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}},i:Q,o:Q,d(o){o&&$(e),st(l,o)}}}function La(r,e,n){let{properties:t}=e;return r.$$set=l=>{"properties"in l&&n(0,t=l.properties)},[t]}class Qn extends se{constructor(e){super(),ae(this,e,La,Ca,le,{properties:0})}}function zl(r,e,n){const t=r.slice();return t[2]=e[n][0],t[6]=e[n][1],t}function Ol(r,e,n){const t=r.slice();return t[2]=e[n][0],t[3]=e[n][1],t}function Bl(r,e,n){const t=r.slice();return t[3]=e[n][0],t[6]=e[n][1],t}function Ma(r){let e,n=Me(Object.entries(r[0])),t=[];for(let l=0;l<n.length;l+=1)t[l]=Rl(zl(r,n,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=Ye()},m(l,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(l,o);b(l,e,o)},p(l,o){if(o&1){n=Me(Object.entries(l[0]));let i;for(i=0;i<n.length;i+=1){const s=zl(l,n,i);t[i]?t[i].p(s,o):(t[i]=Rl(s),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(l){l&&$(e),st(t,l)}}}function Ta(r){let e,n,t,l=Me(Object.entries(r[0])),o=[];for(let a=0;a<l.length;a+=1)o[a]=Dl(Bl(r,l,a));let i=Me(Object.entries(r[0])),s=[];for(let a=0;a<i.length;a+=1)s[a]=Ul(Ol(r,i,a));return{c(){e=k("div");for(let a=0;a<o.length;a+=1)o[a].c();n=M(),t=k("div");for(let a=0;a<s.length;a+=1)s[a].c();oe(e,"display","flex"),oe(t,"display","flex"),oe(t,"justify-content","space-between")},m(a,f){b(a,e,f);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);b(a,n,f),b(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,f){if(f&1){l=Me(Object.entries(a[0]));let u;for(u=0;u<l.length;u+=1){const c=Bl(a,l,u);o[u]?o[u].p(c,f):(o[u]=Dl(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=l.length}if(f&1){i=Me(Object.entries(a[0]));let u;for(u=0;u<i.length;u+=1){const c=Ol(a,i,u);s[u]?s[u].p(c,f):(s[u]=Ul(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},d(a){a&&($(e),$(n),$(t)),st(o,a),st(s,a)}}}function Rl(r){let e,n,t,l=r[2]+"",o,i;return{c(){e=k("div"),n=k("span"),t=M(),o=z(l),i=M(),N(n,"class","vertical-block svelte-rl95zk"),oe(n,"background",r[6])},m(s,a){b(s,e,a),p(e,n),p(e,t),p(e,o),p(e,i)},p(s,a){a&1&&oe(n,"background",s[6]),a&1&&l!==(l=s[2]+"")&&ne(o,l)},d(s){s&&$(e)}}}function Dl(r){let e,n;return{c(){e=k("span"),n=z(` 
      `),oe(e,"background",r[6]),oe(e,"width","100%"),oe(e,"border","1px solid black")},m(t,l){b(t,e,l),p(e,n)},p(t,l){l&1&&oe(e,"background",t[6])},d(t){t&&$(e)}}}function Ul(r){let e,n=r[2]+"",t;return{c(){e=k("span"),t=z(n)},m(l,o){b(l,e,o),p(e,t)},p(l,o){o&1&&n!==(n=l[2]+"")&&ne(t,n)},d(l){l&&$(e)}}}function Aa(r){let e;function n(o,i){return o[1]?Ta:Ma}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),b(o,e,i)},p(o,[i]){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},i:Q,o:Q,d(o){o&&$(e),l.d(o)}}}function Fa(r,e,n){let{colors:t}=e,{horiz:l=!1}=e;return r.$$set=o=>{"colors"in o&&n(0,t=o.colors),"horiz"in o&&n(1,l=o.horiz)},[t,l]}class Mr extends se{constructor(e){super(),ae(this,e,Fa,Aa,le,{colors:0,horiz:1})}}function Hl(r,e,n){const t=r.slice();return t[3]=e[n],t}function Gl(r,e,n){const t=r.slice();return t[6]=e[n],t}function Wl(r){let e,n;return{c(){e=k("span"),n=z(` 
    `),oe(e,"background",r[6]),oe(e,"width","100%"),oe(e,"border","1px solid black")},m(t,l){b(t,e,l),p(e,n)},p(t,l){l&1&&oe(e,"background",t[6])},d(t){t&&$(e)}}}function Pa(r){let e,n=r[3]+"",t;return{c(){e=k("span"),t=z(n)},m(l,o){b(l,e,o),p(e,t)},p(l,o){o&2&&n!==(n=l[3]+"")&&ne(t,n)},d(l){l&&$(e)}}}function Ia(r){let e,n=r[3].toFixed(r[2])+"",t;return{c(){e=k("span"),t=z(n)},m(l,o){b(l,e,o),p(e,t)},p(l,o){o&6&&n!==(n=l[3].toFixed(l[2])+"")&&ne(t,n)},d(l){l&&$(e)}}}function ql(r){let e;function n(o,i){return o[2]>0?Ia:Pa}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),b(o,e,i)},p(o,i){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&$(e),l.d(o)}}}function Ea(r){let e,n,t,l=Me(r[0]),o=[];for(let a=0;a<l.length;a+=1)o[a]=Wl(Gl(r,l,a));let i=Me(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=ql(Hl(r,i,a));return{c(){e=k("div");for(let a=0;a<o.length;a+=1)o[a].c();n=M(),t=k("div");for(let a=0;a<s.length;a+=1)s[a].c();oe(e,"display","flex"),oe(t,"display","flex"),oe(t,"justify-content","space-between")},m(a,f){b(a,e,f);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);b(a,n,f),b(a,t,f);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(t,null)},p(a,[f]){if(f&1){l=Me(a[0]);let u;for(u=0;u<l.length;u+=1){const c=Gl(a,l,u);o[u]?o[u].p(c,f):(o[u]=Wl(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=l.length}if(f&6){i=Me(a[1]);let u;for(u=0;u<i.length;u+=1){const c=Hl(a,i,u);s[u]?s[u].p(c,f):(s[u]=ql(c),s[u].c(),s[u].m(t,null))}for(;u<s.length;u+=1)s[u].d(1);s.length=i.length}},i:Q,o:Q,d(a){a&&($(e),$(n),$(t)),st(o,a),st(s,a)}}}function Na(r,e,n){let{colorScale:t}=e,{limits:l}=e,{decimalPlaces:o=0}=e;return r.$$set=i=>{"colorScale"in i&&n(0,t=i.colorScale),"limits"in i&&n(1,l=i.limits),"decimalPlaces"in i&&n(2,o=i.decimalPlaces)},[t,l,o]}class kn extends se{constructor(e){super(),ae(this,e,Na,Ea,le,{colorScale:0,limits:1,decimalPlaces:2})}}function $r(r,e){let n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",r),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ft(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let de;const es=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&es.decode();let zn=null;function Gn(){return(zn===null||zn.byteLength===0)&&(zn=new Uint8Array(de.memory.buffer)),zn}function Bt(r,e){return r=r>>>0,es.decode(Gn().subarray(r,r+e))}const tn=new Array(128).fill(void 0);tn.push(void 0,null,!0,!1);let Wn=tn.length;function ot(r){Wn===tn.length&&tn.push(tn.length+1);const e=Wn;return Wn=tn[e],tn[e]=r,e}function Ae(r){return tn[r]}function ja(r){r<132||(tn[r]=Wn,Wn=r)}function Cn(r){const e=Ae(r);return ja(r),e}function Dr(r){return r==null}let On=null;function za(){return(On===null||On.byteLength===0)&&(On=new Float64Array(de.memory.buffer)),On}let Bn=null;function Ee(){return(Bn===null||Bn.byteLength===0)&&(Bn=new Int32Array(de.memory.buffer)),Bn}let cn=0;const ur=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Oa=typeof ur.encodeInto=="function"?function(r,e){return ur.encodeInto(r,e)}:function(r,e){const n=ur.encode(r);return e.set(n),{read:r.length,written:n.length}};function sr(r,e,n){if(n===void 0){const s=ur.encode(r),a=e(s.length,1)>>>0;return Gn().subarray(a,a+s.length).set(s),cn=s.length,a}let t=r.length,l=e(t,1)>>>0;const o=Gn();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;o[l+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),l=n(l,t,t=i+r.length*3,1)>>>0;const s=Gn().subarray(l+i,l+t),a=Oa(r,s);i+=a.written}return cn=i,l}function xr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let o="[";l>0&&(o+=xr(r[0]));for(let i=1;i<l;i++)o+=", "+xr(r[i]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Ba(r,e){const n=e(r.length*1,1)>>>0;return Gn().set(r,n/1),cn=r.length,n}function Ur(r,e){try{return r.apply(this,e)}catch(n){de.__wbindgen_exn_store(ot(n))}}class vr{static __wrap(e){e=e>>>0;const n=Object.create(vr.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();de.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=de.__wbindgen_add_to_stack_pointer(-16),i=Ba(e,de.__wbindgen_malloc),s=cn;de.jsroutesnapper_new(o,i,s);var n=Ee()[o/4+0],t=Ee()[o/4+1],l=Ee()[o/4+2];if(l)throw Cn(t);return vr.__wrap(n)}finally{de.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){de.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ot(e))}setAreaMode(){de.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getConfig(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}toFinalFeature(){try{const t=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_toFinalFeature(t,this.__wbg_ptr);var e=Ee()[t/4+0],n=Ee()[t/4+1];let l;return e!==0&&(l=Bt(e,n).slice(),de.__wbindgen_free(e,n*1)),l}finally{de.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}toggleSnapMode(){de.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,n,t){return de.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,n,t)!==0}onClick(){de.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return de.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return de.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){de.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_editExisting(l,this.__wbg_ptr,ot(e));var n=Ee()[l/4+0],t=Ee()[l/4+1];if(t)throw Cn(n)}finally{de.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}debugSnappableNodes(){let e,n;try{const o=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var t=Ee()[o/4+0],l=Ee()[o/4+1];return e=t,n=l,Bt(t,l)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(e,n,1)}}routeNameForWaypoints(e){let n,t;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_routeNameForWaypoints(u,this.__wbg_ptr,ot(e));var l=Ee()[u/4+0],o=Ee()[u/4+1],i=Ee()[u/4+2],s=Ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Cn(i);return n=a,t=f,Bt(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,t,1)}}addSnappedWaypoint(e,n){de.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,n)}undo(){de.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let n,t;try{const u=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_calculateRoute(u,this.__wbg_ptr,ot(e));var l=Ee()[u/4+0],o=Ee()[u/4+1],i=Ee()[u/4+2],s=Ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Cn(i);return n=a,t=f,Bt(a,f)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(n,t,1)}}getExtraNodes(e,n){let t,l;try{const c=de.__wbindgen_add_to_stack_pointer(-16);de.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,ot(e),ot(n));var o=Ee()[c/4+0],i=Ee()[c/4+1],s=Ee()[c/4+2],a=Ee()[c/4+3],f=o,u=i;if(a)throw f=0,u=0,Cn(s);return t=f,l=u,Bt(f,u)}finally{de.__wbindgen_add_to_stack_pointer(16),de.__wbindgen_free(t,l,1)}}}async function Ra(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Da(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,n){const t=Bt(e,n);return ot(t)},r.wbg.__wbindgen_object_drop_ref=function(e){Cn(e)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(Bt(e,n));return ot(t)},r.wbg.__wbindgen_number_get=function(e,n){const t=Ae(n),l=typeof t=="number"?t:void 0;za()[e/8+1]=Dr(l)?0:l,Ee()[e/4+0]=!Dr(l)},r.wbg.__wbindgen_is_object=function(e){const n=Ae(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_is_undefined=function(e){return Ae(e)===void 0},r.wbg.__wbindgen_in=function(e,n){return Ae(e)in Ae(n)},r.wbg.__wbindgen_boolean_get=function(e){const n=Ae(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Ae(e)==Ae(n)},r.wbg.__wbindgen_string_get=function(e,n){const t=Ae(n),l=typeof t=="string"?t:void 0;var o=Dr(l)?0:sr(l,de.__wbindgen_malloc,de.__wbindgen_realloc),i=cn;Ee()[e/4+1]=i,Ee()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,n){const t=String(Ae(n)),l=sr(t,de.__wbindgen_malloc,de.__wbindgen_realloc),o=cn;Ee()[e/4+1]=o,Ee()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Ae(e);return ot(n)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,n){const t=Ae(e)[Ae(n)];return ot(t)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ot(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Ae(n).stack,l=sr(t,de.__wbindgen_malloc,de.__wbindgen_realloc),o=cn;Ee()[e/4+1]=o,Ee()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,l;try{t=e,l=n,console.error(Bt(e,n))}finally{de.__wbindgen_free(t,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ae(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ae(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ae(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ae(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ae(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,n){const t=Ae(e)[n>>>0];return ot(t)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ae(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ae(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const n=Ae(e).next;return ot(n)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Ur(function(e){const n=Ae(e).next();return ot(n)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ae(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const n=Ae(e).value;return ot(n)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ot(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Ur(function(e,n){const t=Reflect.get(Ae(e),Ae(n));return ot(t)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Ur(function(e,n){const t=Ae(e).call(Ae(n));return ot(t)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ae(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let n;try{n=Ae(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const n=Ae(e).buffer;return ot(n)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const n=new Uint8Array(Ae(e));return ot(n)},r.wbg.__wbg_set_5cf90238115182c3=function(e,n,t){Ae(e).set(Ae(n),t>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ae(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let n;try{n=Ae(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_debug_string=function(e,n){const t=xr(Ae(n)),l=sr(t,de.__wbindgen_malloc,de.__wbindgen_realloc),o=cn;Ee()[e/4+1]=o,Ee()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,n){throw new Error(Bt(e,n))},r.wbg.__wbindgen_memory=function(){const e=de.memory;return ot(e)},r}function Ua(r,e){return de=r.exports,ts.__wbindgen_wasm_module=e,On=null,Bn=null,zn=null,de}async function ts(r){if(de!==void 0)return de;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Da();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Ra(await r,e);return Ua(n,t)}var $t=63710088e-1,gl={centimeters:$t*100,centimetres:$t*100,degrees:$t/111325,feet:$t*3.28084,inches:$t*39.37,kilometers:$t/1e3,kilometres:$t/1e3,meters:$t,metres:$t,miles:$t/1609.344,millimeters:$t*1e3,millimetres:$t*1e3,nauticalmiles:$t/1852,radians:1,yards:$t*1.0936},Ha={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/$t,yards:1.0936133},el={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ut(r,e,n){n===void 0&&(n={});var t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function Ga(r,e,n){switch(r){case"Point":return Lt(e).geometry;case"LineString":return Rt(e).geometry;case"Polygon":return hl(e).geometry;case"MultiPoint":return rs(e).geometry;case"MultiLineString":return ns(e).geometry;case"MultiPolygon":return ls(e).geometry;default:throw new Error(r+" is invalid")}}function Lt(r,e,n){if(n===void 0&&(n={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!yr(r[0])||!yr(r[1]))throw new Error("coordinates must contain numbers");var t={type:"Point",coordinates:r};return Ut(t,e,n)}function Wa(r,e,n){return n===void 0&&(n={}),yn(r.map(function(t){return Lt(t,e)}),n)}function hl(r,e,n){n===void 0&&(n={});for(var t=0,l=r;t<l.length;t++){var o=l[t];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Ut(s,e,n)}function qa(r,e,n){return n===void 0&&(n={}),yn(r.map(function(t){return hl(t,e)}),n)}function Rt(r,e,n){if(n===void 0&&(n={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var t={type:"LineString",coordinates:r};return Ut(t,e,n)}function Ja(r,e,n){return n===void 0&&(n={}),yn(r.map(function(t){return Rt(t,e)}),n)}function yn(r,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=r,n}function ns(r,e,n){n===void 0&&(n={});var t={type:"MultiLineString",coordinates:r};return Ut(t,e,n)}function rs(r,e,n){n===void 0&&(n={});var t={type:"MultiPoint",coordinates:r};return Ut(t,e,n)}function ls(r,e,n){n===void 0&&(n={});var t={type:"MultiPolygon",coordinates:r};return Ut(t,e,n)}function Ya(r,e,n){n===void 0&&(n={});var t={type:"GeometryCollection",geometries:r};return Ut(t,e,n)}function Za(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(r*n)/n}function bl(r,e){e===void 0&&(e="kilometers");var n=gl[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Tr(r,e){e===void 0&&(e="kilometers");var n=gl[e];if(!n)throw new Error(e+" units is invalid");return r/n}function Ka(r,e){return Kn(Tr(r,e))}function Xa(r){var e=r%360;return e<0&&(e+=360),e}function Kn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Dt(r){var e=r%360;return e*Math.PI/180}function Va(r,e,n){if(e===void 0&&(e="kilometers"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("length must be a positive number");return bl(Tr(r,e),n)}function Qa(r,e,n){if(e===void 0&&(e="meters"),n===void 0&&(n="kilometers"),!(r>=0))throw new Error("area must be a positive number");var t=el[e];if(!t)throw new Error("invalid original units");var l=el[n];if(!l)throw new Error("invalid final units");return r/t*l}function yr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function $l(r){return!!r&&r.constructor===Object}function xa(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!yr(e))throw new Error("bbox must only contain numbers")})}function ef(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const tf=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:el,bearingToAzimuth:Xa,convertArea:Qa,convertLength:Va,degreesToRadians:Dt,earthRadius:$t,factors:gl,feature:Ut,featureCollection:yn,geometry:Ga,geometryCollection:Ya,isNumber:yr,isObject:$l,lengthToDegrees:Ka,lengthToRadians:Tr,lineString:Rt,lineStrings:Ja,multiLineString:ns,multiPoint:rs,multiPolygon:ls,point:Lt,points:Wa,polygon:hl,polygons:qa,radiansToDegrees:Kn,radiansToLength:bl,round:Za,unitsFactors:Ha,validateBBox:xa,validateId:ef},Symbol.toStringTag,{value:"Module"}));function Xn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function An(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function En(r,e,n){n===void 0&&(n={});var t=Xn(r),l=Xn(e),o=Dt(l[1]-t[1]),i=Dt(l[0]-t[0]),s=Dt(t[1]),a=Dt(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return bl(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function xn(r,e,n){if(r!==null)for(var t,l,o,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",y=m?r.features.length:1,h=0;h<y;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var w=0;w<s;w++){var C=0,L=0;if(i=_?f.geometries[w]:f,i!==null){a=i.coordinates;var F=i.type;switch(u=n&&(F==="Polygon"||F==="MultiPolygon")?1:0,F){case null:break;case"Point":if(e(a,c,h,C,L)===!1)return!1;c++,C++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,C,L)===!1)return!1;c++,F==="MultiPoint"&&C++}F==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(l=0;l<a[t].length-u;l++){if(e(a[t][l],c,h,C,L)===!1)return!1;c++}F==="MultiLineString"&&C++,F==="Polygon"&&L++}F==="Polygon"&&C++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(L=0,l=0;l<a[t].length;l++){for(o=0;o<a[t][l].length-u;o++){if(e(a[t][l][o],c,h,C,L)===!1)return!1;c++}L++}C++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(xn(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function nf(r,e,n,t){var l=n;return xn(r,function(o,i,s,a,f){i===0&&n===void 0?l=o:l=e(l,o,i,s,a,f)},t),l}function os(r,e){var n;switch(r.type){case"FeatureCollection":for(n=0;n<r.features.length&&e(r.features[n].properties,n)!==!1;n++);break;case"Feature":e(r.properties,0);break}}function rf(r,e,n){var t=n;return os(r,function(l,o){o===0&&n===void 0?t=l:t=e(t,l,o)}),t}function wr(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var n=0;n<r.features.length&&e(r.features[n],n)!==!1;n++);}function lf(r,e,n){var t=n;return wr(r,function(l,o){o===0&&n===void 0?t=l:t=e(t,l,o)}),t}function of(r){var e=[];return xn(r,function(n){e.push(n)}),e}function vl(r,e){var n,t,l,o,i,s,a,f,u,c,_=0,d=r.type==="FeatureCollection",m=r.type==="Feature",g=d?r.features.length:1;for(n=0;n<g;n++){for(s=d?r.features[n].geometry:m?r.geometry:r,f=d?r.features[n].properties:m?r.properties:{},u=d?r.features[n].bbox:m?r.bbox:void 0,c=d?r.features[n].id:m?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,l=0;l<i;l++){if(o=a?s.geometries[l]:s,o===null){if(e(null,_,f,u,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,_,f,u,c)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<o.geometries.length;t++)if(e(o.geometries[t],_,f,u,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function sf(r,e,n){var t=n;return vl(r,function(l,o,i,s,a){o===0&&n===void 0?t=l:t=e(t,l,o,i,s,a)}),t}function Pn(r,e){vl(r,function(n,t,l,o,i){var s=n===null?null:n.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Ut(n,l,{bbox:o,id:i}),t,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var f=0;f<n.coordinates.length;f++){var u=n.coordinates[f],c={type:a,coordinates:u};if(e(Ut(c,l),t,f)===!1)return!1}})}function af(r,e,n){var t=n;return Pn(r,function(l,o,i){o===0&&i===0&&n===void 0?t=l:t=e(t,l,o,i)}),t}function is(r,e){Pn(r,function(n,t,l){var o=0;if(n.geometry){var i=n.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,f=0,u=0;if(xn(n,function(c,_,d,m,g){if(s===void 0||t>a||m>f||g>u){s=c,a=t,f=m,u=g,o=0;return}var y=Rt([s,c],n.properties);if(e(y,t,l,g,o)===!1)return!1;o++,s=c})===!1)return!1}}})}function ff(r,e,n){var t=n,l=!1;return is(r,function(o,i,s,a,f){l===!1&&n===void 0?t=o:t=e(t,o,i,s,a,f),l=!0}),t}function ss(r,e){if(!r)throw new Error("geojson is required");Pn(r,function(n,t,l){if(n.geometry!==null){var o=n.geometry.type,i=n.geometry.coordinates;switch(o){case"LineString":if(e(n,t,l,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Rt(i[s],n.properties),t,l,s)===!1)return!1;break}}})}function uf(r,e,n){var t=n;return ss(r,function(l,o,i,s){o===0&&n===void 0?t=l:t=e(t,l,o,i,s)}),t}function cf(r,e){if(e=e||{},!$l(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,l=e.geometryIndex||0,o=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=a.length+o-1),Rt([a[o],a[o+1]],i,e);case"Polygon":return l<0&&(l=a.length+l),o<0&&(o=a[l].length+o-1),Rt([a[l][o],a[l][o+1]],i,e);case"MultiLineString":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o-1),Rt([a[t][o],a[t][o+1]],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),o<0&&(o=a[t][l].length-o-1),Rt([a[t][l][o],a[t][l][o+1]],i,e)}throw new Error("geojson is invalid")}function df(r,e){if(e=e||{},!$l(e))throw new Error("options is invalid");var n=e.featureIndex||0,t=e.multiFeatureIndex||0,l=e.geometryIndex||0,o=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":n<0&&(n=r.features.length+n),i=i||r.features[n].properties,s=r.features[n].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return Lt(a,i,e);case"MultiPoint":return t<0&&(t=a.length+t),Lt(a[t],i,e);case"LineString":return o<0&&(o=a.length+o),Lt(a[o],i,e);case"Polygon":return l<0&&(l=a.length+l),o<0&&(o=a[l].length+o),Lt(a[l][o],i,e);case"MultiLineString":return t<0&&(t=a.length+t),o<0&&(o=a[t].length+o),Lt(a[t][o],i,e);case"MultiPolygon":return t<0&&(t=a.length+t),l<0&&(l=a[t].length+l),o<0&&(o=a[t][l].length-o),Lt(a[t][l][o],i,e)}throw new Error("geojson is invalid")}const _f=Object.freeze(Object.defineProperty({__proto__:null,coordAll:of,coordEach:xn,coordReduce:nf,featureEach:wr,featureReduce:lf,findPoint:df,findSegment:cf,flattenEach:Pn,flattenReduce:af,geomEach:vl,geomReduce:sf,lineEach:ss,lineReduce:uf,propEach:os,propReduce:rf,segmentEach:is,segmentReduce:ff},Symbol.toStringTag,{value:"Module"}));function as(r,e,n){if(n===void 0&&(n={}),n.final===!0)return mf(r,e);var t=Xn(r),l=Xn(e),o=Dt(t[0]),i=Dt(l[0]),s=Dt(t[1]),a=Dt(l[1]),f=Math.sin(i-o)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-o);return Kn(Math.atan2(f,u))}function mf(r,e){var n=as(e,r);return n=(n+180)%360,n}function Jl(r,e,n,t){t===void 0&&(t={});var l=Xn(r),o=Dt(l[0]),i=Dt(l[1]),s=Dt(n),a=Tr(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=Kn(u),_=Kn(f);return Lt([c,_],t.properties)}function Yl(r){if(!r)throw new Error("geojson is required");var e=[];return Pn(r,function(n){pf(n,e)}),yn(e)}function pf(r,e){var n=[],t=r.geometry;if(t!==null){switch(t.type){case"Polygon":n=An(t);break;case"LineString":n=[An(t)]}n.forEach(function(l){var o=gf(l,r.properties);o.forEach(function(i){i.id=e.length,e.push(i)})})}}function gf(r,e){var n=[];return r.reduce(function(t,l){var o=Rt([t,l],e);return o.bbox=hf(t,l),n.push(o),l}),n}function hf(r,e){var n=r[0],t=r[1],l=e[0],o=e[1],i=n<l?n:l,s=t<o?t:o,a=n>l?n:l,f=t>o?t:o;return[i,s,a,f]}var yl={exports:{}},fs={exports:{}};(function(r,e){(function(n,t){r.exports=t()})(ea,function(){function n(w,C,L,F,T){(function A(j,O,U,R,B){for(;R>U;){if(R-U>600){var H=R-U+1,G=O-U+1,Z=Math.log(H),Y=.5*Math.exp(2*Z/3),ie=.5*Math.sqrt(Z*Y*(H-Y)/H)*(G-H/2<0?-1:1),D=Math.max(U,Math.floor(O-G*Y/H+ie)),ve=Math.min(R,Math.floor(O+(H-G)*Y/H+ie));A(j,O,D,ve,B)}var ge=j[O],fe=U,ye=R;for(t(j,U,O),B(j[R],ge)>0&&t(j,U,R);fe<ye;){for(t(j,fe,ye),fe++,ye--;B(j[fe],ge)<0;)fe++;for(;B(j[ye],ge)>0;)ye--}B(j[U],ge)===0?t(j,U,ye):t(j,++ye,R),ye<=O&&(U=ye+1),O<=ye&&(R=ye-1)}})(w,C,L||0,F||w.length-1,T||l)}function t(w,C,L){var F=w[C];w[C]=w[L],w[L]=F}function l(w,C){return w<C?-1:w>C?1:0}var o=function(w){w===void 0&&(w=9),this._maxEntries=Math.max(4,w),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(w,C,L){if(!L)return C.indexOf(w);for(var F=0;F<C.length;F++)if(L(w,C[F]))return F;return-1}function s(w,C){a(w,0,w.children.length,C,w)}function a(w,C,L,F,T){T||(T=y(null)),T.minX=1/0,T.minY=1/0,T.maxX=-1/0,T.maxY=-1/0;for(var A=C;A<L;A++){var j=w.children[A];f(T,w.leaf?F(j):j)}return T}function f(w,C){return w.minX=Math.min(w.minX,C.minX),w.minY=Math.min(w.minY,C.minY),w.maxX=Math.max(w.maxX,C.maxX),w.maxY=Math.max(w.maxY,C.maxY),w}function u(w,C){return w.minX-C.minX}function c(w,C){return w.minY-C.minY}function _(w){return(w.maxX-w.minX)*(w.maxY-w.minY)}function d(w){return w.maxX-w.minX+(w.maxY-w.minY)}function m(w,C){return w.minX<=C.minX&&w.minY<=C.minY&&C.maxX<=w.maxX&&C.maxY<=w.maxY}function g(w,C){return C.minX<=w.maxX&&C.minY<=w.maxY&&C.maxX>=w.minX&&C.maxY>=w.minY}function y(w){return{children:w,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function h(w,C,L,F,T){for(var A=[C,L];A.length;)if(!((L=A.pop())-(C=A.pop())<=F)){var j=C+Math.ceil((L-C)/F/2)*F;n(w,j,C,L,T),A.push(C,j,j,L)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(w){var C=this.data,L=[];if(!g(w,C))return L;for(var F=this.toBBox,T=[];C;){for(var A=0;A<C.children.length;A++){var j=C.children[A],O=C.leaf?F(j):j;g(w,O)&&(C.leaf?L.push(j):m(w,O)?this._all(j,L):T.push(j))}C=T.pop()}return L},o.prototype.collides=function(w){var C=this.data;if(!g(w,C))return!1;for(var L=[];C;){for(var F=0;F<C.children.length;F++){var T=C.children[F],A=C.leaf?this.toBBox(T):T;if(g(w,A)){if(C.leaf||m(w,A))return!0;L.push(T)}}C=L.pop()}return!1},o.prototype.load=function(w){if(!w||!w.length)return this;if(w.length<this._minEntries){for(var C=0;C<w.length;C++)this.insert(w[C]);return this}var L=this._build(w.slice(),0,w.length-1,0);if(this.data.children.length)if(this.data.height===L.height)this._splitRoot(this.data,L);else{if(this.data.height<L.height){var F=this.data;this.data=L,L=F}this._insert(L,this.data.height-L.height-1,!0)}else this.data=L;return this},o.prototype.insert=function(w){return w&&this._insert(w,this.data.height-1),this},o.prototype.clear=function(){return this.data=y([]),this},o.prototype.remove=function(w,C){if(!w)return this;for(var L,F,T,A=this.data,j=this.toBBox(w),O=[],U=[];A||O.length;){if(A||(A=O.pop(),F=O[O.length-1],L=U.pop(),T=!0),A.leaf){var R=i(w,A.children,C);if(R!==-1)return A.children.splice(R,1),O.push(A),this._condense(O),this}T||A.leaf||!m(A,j)?F?(L++,A=F.children[L],T=!1):A=null:(O.push(A),U.push(L),L=0,F=A,A=A.children[0])}return this},o.prototype.toBBox=function(w){return w},o.prototype.compareMinX=function(w,C){return w.minX-C.minX},o.prototype.compareMinY=function(w,C){return w.minY-C.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(w){return this.data=w,this},o.prototype._all=function(w,C){for(var L=[];w;)w.leaf?C.push.apply(C,w.children):L.push.apply(L,w.children),w=L.pop();return C},o.prototype._build=function(w,C,L,F){var T,A=L-C+1,j=this._maxEntries;if(A<=j)return s(T=y(w.slice(C,L+1)),this.toBBox),T;F||(F=Math.ceil(Math.log(A)/Math.log(j)),j=Math.ceil(A/Math.pow(j,F-1))),(T=y([])).leaf=!1,T.height=F;var O=Math.ceil(A/j),U=O*Math.ceil(Math.sqrt(j));h(w,C,L,U,this.compareMinX);for(var R=C;R<=L;R+=U){var B=Math.min(R+U-1,L);h(w,R,B,O,this.compareMinY);for(var H=R;H<=B;H+=O){var G=Math.min(H+O-1,B);T.children.push(this._build(w,H,G,F-1))}}return s(T,this.toBBox),T},o.prototype._chooseSubtree=function(w,C,L,F){for(;F.push(C),!C.leaf&&F.length-1!==L;){for(var T=1/0,A=1/0,j=void 0,O=0;O<C.children.length;O++){var U=C.children[O],R=_(U),B=(H=w,G=U,(Math.max(G.maxX,H.maxX)-Math.min(G.minX,H.minX))*(Math.max(G.maxY,H.maxY)-Math.min(G.minY,H.minY))-R);B<A?(A=B,T=R<T?R:T,j=U):B===A&&R<T&&(T=R,j=U)}C=j||C.children[0]}var H,G;return C},o.prototype._insert=function(w,C,L){var F=L?w:this.toBBox(w),T=[],A=this._chooseSubtree(F,this.data,C,T);for(A.children.push(w),f(A,F);C>=0&&T[C].children.length>this._maxEntries;)this._split(T,C),C--;this._adjustParentBBoxes(F,T,C)},o.prototype._split=function(w,C){var L=w[C],F=L.children.length,T=this._minEntries;this._chooseSplitAxis(L,T,F);var A=this._chooseSplitIndex(L,T,F),j=y(L.children.splice(A,L.children.length-A));j.height=L.height,j.leaf=L.leaf,s(L,this.toBBox),s(j,this.toBBox),C?w[C-1].children.push(j):this._splitRoot(L,j)},o.prototype._splitRoot=function(w,C){this.data=y([w,C]),this.data.height=w.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(w,C,L){for(var F,T,A,j,O,U,R,B=1/0,H=1/0,G=C;G<=L-C;G++){var Z=a(w,0,G,this.toBBox),Y=a(w,G,L,this.toBBox),ie=(T=Z,A=Y,j=void 0,O=void 0,U=void 0,R=void 0,j=Math.max(T.minX,A.minX),O=Math.max(T.minY,A.minY),U=Math.min(T.maxX,A.maxX),R=Math.min(T.maxY,A.maxY),Math.max(0,U-j)*Math.max(0,R-O)),D=_(Z)+_(Y);ie<B?(B=ie,F=G,H=D<H?D:H):ie===B&&D<H&&(H=D,F=G)}return F||L-C},o.prototype._chooseSplitAxis=function(w,C,L){var F=w.leaf?this.compareMinX:u,T=w.leaf?this.compareMinY:c;this._allDistMargin(w,C,L,F)<this._allDistMargin(w,C,L,T)&&w.children.sort(F)},o.prototype._allDistMargin=function(w,C,L,F){w.children.sort(F);for(var T=this.toBBox,A=a(w,0,C,T),j=a(w,L-C,L,T),O=d(A)+d(j),U=C;U<L-C;U++){var R=w.children[U];f(A,w.leaf?T(R):R),O+=d(A)}for(var B=L-C-1;B>=C;B--){var H=w.children[B];f(j,w.leaf?T(H):H),O+=d(j)}return O},o.prototype._adjustParentBBoxes=function(w,C,L){for(var F=L;F>=0;F--)f(C[F],w)},o.prototype._condense=function(w){for(var C=w.length-1,L=void 0;C>=0;C--)w[C].children.length===0?C>0?(L=w[C-1].children).splice(L.indexOf(w[C]),1):this.clear():s(w[C],this.toBBox)},o})})(fs);var bf=fs.exports;const $f=dl(tf),vf=dl(_f);function us(r,e,n){if(r!==null)for(var t,l,o,i,s,a,f,u=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",y=m?r.features.length:1,h=0;h<y;h++){f=m?r.features[h].geometry:g?r.geometry:r,_=f?f.type==="GeometryCollection":!1,s=_?f.geometries.length:1;for(var w=0;w<s;w++){var C=0,L=0;if(i=_?f.geometries[w]:f,i!==null){a=i.coordinates;var F=i.type;switch(u=n&&(F==="Polygon"||F==="MultiPolygon")?1:0,F){case null:break;case"Point":if(e(a,c,h,C,L)===!1)return!1;c++,C++;break;case"LineString":case"MultiPoint":for(t=0;t<a.length;t++){if(e(a[t],c,h,C,L)===!1)return!1;c++,F==="MultiPoint"&&C++}F==="LineString"&&C++;break;case"Polygon":case"MultiLineString":for(t=0;t<a.length;t++){for(l=0;l<a[t].length-u;l++){if(e(a[t][l],c,h,C,L)===!1)return!1;c++}F==="MultiLineString"&&C++,F==="Polygon"&&L++}F==="Polygon"&&C++;break;case"MultiPolygon":for(t=0;t<a.length;t++){for(L=0,l=0;l<a[t].length;l++){for(o=0;o<a[t][l].length-u;o++){if(e(a[t][l][o],c,h,C,L)===!1)return!1;c++}L++}C++}break;case"GeometryCollection":for(t=0;t<i.geometries.length;t++)if(us(i.geometries[t],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function cs(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const n=[1/0,1/0,-1/0,-1/0];return us(r,t=>{n[0]>t[0]&&(n[0]=t[0]),n[1]>t[1]&&(n[1]=t[1]),n[2]<t[0]&&(n[2]=t[0]),n[3]<t[1]&&(n[3]=t[1])}),n}var yf=cs;const wf=Object.freeze(Object.defineProperty({__proto__:null,bbox:cs,default:yf},Symbol.toStringTag,{value:"Module"})),kf=dl(wf);var Kt=bf,ds=$f,_s=vf,Sn=kf.default,Sf=_s.featureEach;_s.coordEach;ds.polygon;var Zl=ds.featureCollection;function ms(r){var e=new Kt(r);return e.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Sn(n),Kt.prototype.insert.call(this,n)},e.load=function(n){var t=[];return Array.isArray(n)?n.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Sn(l),t.push(l)}):Sf(n,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Sn(l),t.push(l)}),Kt.prototype.load.call(this,t)},e.remove=function(n,t){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:Sn(n),Kt.prototype.remove.call(this,n,t)},e.clear=function(){return Kt.prototype.clear.call(this)},e.search=function(n){var t=Kt.prototype.search.call(this,this.toBBox(n));return Zl(t)},e.collides=function(n){return Kt.prototype.collides.call(this,this.toBBox(n))},e.all=function(){var n=Kt.prototype.all.call(this);return Zl(n)},e.toJSON=function(){return Kt.prototype.toJSON.call(this)},e.fromJSON=function(n){return Kt.prototype.fromJSON.call(this,n)},e.toBBox=function(n){var t;if(n.bbox)t=n.bbox;else if(Array.isArray(n)&&n.length===4)t=n;else if(Array.isArray(n)&&n.length===6)t=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")t=Sn(n);else if(n.type==="FeatureCollection")t=Sn(n);else throw new Error("invalid geojson");return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},e}yl.exports=ms;yl.exports.default=ms;var Cf=yl.exports;const Lf=ta(Cf);function Mf(r,e){var n={},t=[];if(r.type==="LineString"&&(r=Ut(r)),e.type==="LineString"&&(e=Ut(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Kl(r,e);return l&&t.push(l),yn(t)}var o=Lf();return o.load(Yl(e)),wr(Yl(r),function(i){wr(o.search(i),function(s){var a=Kl(i,s);if(a){var f=An(a).join(",");n[f]||(n[f]=!0,t.push(a))}})}),yn(t)}function Kl(r,e){var n=An(r),t=An(e);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(t.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=n[0][0],o=n[0][1],i=n[1][0],s=n[1][1],a=t[0][0],f=t[0][1],u=t[1][0],c=t[1][1],_=(c-f)*(i-l)-(u-a)*(s-o),d=(u-a)*(o-f)-(c-f)*(l-a),m=(i-l)*(o-f)-(s-o)*(l-a);if(_===0)return null;var g=d/_,y=m/_;if(g>=0&&g<=1&&y>=0&&y<=1){var h=l+g*(i-l),w=o+g*(s-o);return Lt([h,w])}return null}function Tf(r,e,n){n===void 0&&(n={});var t=Lt([1/0,1/0],{dist:1/0}),l=0;return Pn(r,function(o){for(var i=An(o),s=0;s<i.length-1;s++){var a=Lt(i[s]);a.properties.dist=En(e,a,n);var f=Lt(i[s+1]);f.properties.dist=En(e,f,n);var u=En(a,f,n),c=Math.max(a.properties.dist,f.properties.dist),_=as(a,f),d=Jl(e,c,_+90,n),m=Jl(e,c,_-90,n),g=Mf(Rt([d.geometry.coordinates,m.geometry.coordinates]),Rt([a.geometry.coordinates,f.geometry.coordinates])),y=null;g.features.length>0&&(y=g.features[0],y.properties.dist=En(e,y,n),y.properties.location=l+En(a,y,n)),a.properties.dist<t.properties.dist&&(t=a,t.properties.index=s,t.properties.location=l),f.properties.dist<t.properties.dist&&(t=f,t.properties.index=s+1,t.properties.location=l+u),y&&y.properties.dist<t.properties.dist&&(t=y,t.properties.index=s),l+=u}}),t}const Af=30;class Ff{constructor(e,n,t,l,o){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-Af,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new vr(n),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=t,this.snapMode=l,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersSuccess)n(JSON.parse(e));else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let n of this.eventListenersUpdated)n(JSON.parse(e))}}function Xl(r){let e,n;return e=new Lr({props:{$$slots:{default:[Pf,({dialog:t})=>({3:t}),({dialog:t})=>t?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Pf(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;function g(){return r[1](r[3])}return{c(){e=k("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",n=M(),t=k("p"),t.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=M(),o=k("p"),o.textContent="To use this tool, you need to:",i=M(),s=k("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=M(),f=k("p"),f.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,u=M(),c=k("center"),_=k("button"),_.textContent="Start!"},m(y,h){b(y,e,h),b(y,n,h),b(y,t,h),b(y,l,h),b(y,o,h),b(y,i,h),b(y,s,h),b(y,a,h),b(y,f,h),b(y,u,h),b(y,c,h),p(c,_),d||(m=K(_,"click",g),d=!0)},p(y,h){r=y},d(y){y&&($(e),$(n),$(t),$(l),$(o),$(i),$(s),$(a),$(f),$(u),$(c)),d=!1,m()}}}function If(r){let e,n,t=r[0]&&Xl(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&v(t,1)):(t=Xl(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function Ef(r,e,n){let t;return V(r,pr,i=>n(0,t=i)),[t,i=>ft(i).close(),()=>te(pr,t=!1,t)]}class Nf extends se{constructor(e){super(),ae(this,e,Ef,If,le,{})}}function jf(r){let e;const n=r[16].default,t=Re(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&De(t,n,l,l[24],e?He(n,l[24],o,null):Ue(l[24]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function zf(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[jf]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Yi({props:o}),Ge.push(()=>ut(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){P(e.$$.fragment)},m(i,s){I(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function Of(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=_l("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:L=!0}=e;function F(B){w=B,n(0,w)}function T(B){je.call(this,r,B)}function A(B){je.call(this,r,B)}function j(B){je.call(this,r,B)}function O(B){je.call(this,r,B)}function U(B){je.call(this,r,B)}function R(B){je.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,o=B.id),"source"in B&&n(2,i=B.source),"sourceLayer"in B&&n(3,s=B.sourceLayer),"beforeId"in B&&n(4,a=B.beforeId),"beforeLayerType"in B&&n(5,f=B.beforeLayerType),"paint"in B&&n(6,u=B.paint),"layout"in B&&n(7,c=B.layout),"filter"in B&&n(8,_=B.filter),"applyToClusters"in B&&n(9,d=B.applyToClusters),"minzoom"in B&&n(10,m=B.minzoom),"maxzoom"in B&&n(11,g=B.maxzoom),"hoverCursor"in B&&n(12,y=B.hoverCursor),"manageHoverState"in B&&n(13,h=B.manageHoverState),"hovered"in B&&n(0,w=B.hovered),"eventsIfTopMost"in B&&n(14,C=B.eventsIfTopMost),"interactive"in B&&n(15,L=B.interactive),"$$scope"in B&&n(24,l=B.$$scope)},[w,o,i,s,a,f,u,c,_,d,m,g,y,h,C,L,t,F,T,A,j,O,U,R,l]}let on=class extends se{constructor(e){super(),ae(this,e,Of,zf,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Bf(r){let e,n;const t=r[7].default,l=Re(t,r,r[6],null);return{c(){e=k("div"),l&&l.c(),N(e,"class",r[1]),gt(e,"maplibregl-ctrl",r[0])},m(o,i){b(o,e,i),l&&l.m(e,null),r[8](e),n=!0},p(o,[i]){l&&l.p&&(!n||i&64)&&De(l,t,o,o[6],n?He(t,o[6],i,null):Ue(o[6]),null),(!n||i&2)&&N(e,"class",o[1]),(!n||i&3)&&gt(e,"maplibregl-ctrl",o[0])},i(o){n||(v(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&$(e),l&&l.d(o),r[8](null)}}}function Rf(r,e,n){let t,{$$slots:l={},$$scope:o}=e,{defaultStyling:i=!0}=e,{position:s="top-right"}=e,{class:a=void 0}=e;const{map:f}=ml();V(r,f,d=>n(5,t=d));let u,c={onAdd(){return u},onRemove(){var d;(d=u==null?void 0:u.parentNode)==null||d.removeChild(u)}};Tt(()=>{t==null||t.removeControl(c)});function _(d){Ge[d?"unshift":"push"](()=>{u=d,n(2,u)})}return r.$$set=d=>{"defaultStyling"in d&&n(0,i=d.defaultStyling),"position"in d&&n(4,s=d.position),"class"in d&&n(1,a=d.class),"$$scope"in d&&n(6,o=d.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&t&&u&&t.addControl(c,s)},[i,a,u,f,s,t,o,l,_]}class Df extends se{constructor(e){super(),ae(this,e,Rf,Bf,le,{defaultStyling:0,position:4,class:1})}}function Uf(r,e,n){let t,l,{data:o}=e,{idCol:i}=e,{sourceLayer:s=void 0}=e,a=new Set;const{map:f,source:u}=na();return V(r,f,c=>n(6,t=c)),V(r,u,c=>n(7,l=c)),r.$$set=c=>{"data"in c&&n(2,o=c.data),"idCol"in c&&n(3,i=c.idCol),"sourceLayer"in c&&n(4,s=c.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&t&&l){let c=new Set;for(const _ of o){const d=_[i];if(!d)continue;a.delete(d),c.add(d);const m={id:d,source:l,sourceLayer:s},g=t.getFeatureState(m);let y=!1;for(const h of Object.keys(_))if(g[h]!==_[h]){y=!0;break}y&&t.setFeatureState(m,_)}for(const _ of a){const d={id:_,source:l,sourceLayer:s},m=t.getFeatureState(d);for(const g of Object.keys(m))t.removeFeatureState(d,g)}n(5,a=c)}},[f,u,o,i,s,a,t,l]}class Hf extends se{constructor(e){super(),ae(this,e,Uf,null,le,{data:2,idCol:3,sourceLayer:4})}}function Gf(r,e,n){let t;const l=mn();let{layer:o=void 0}=e;const{map:i}=ml();V(r,i,u=>n(2,t=u));function s(u){l(u.type,{...u,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],f=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Tt(()=>{if(t)if(o)for(const u of a)t.off(u,o,s);else for(const u of f)t.off(u,s)}),r.$$set=u=>{"layer"in u&&n(1,o=u.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&t)if(o)for(const u of a)t.on(u,o,s);else for(const u of f)t.on(u,s)},[i,o,t]}class ps extends se{constructor(e){super(),ae(this,e,Gf,null,le,{layer:1})}}const Wf=r=>({marker:r&8}),Vl=r=>({marker:r[3]});function qf(r){let e,n,t,l,o,i,s;const a=r[19].default,f=Re(a,r,r[18],Vl);return{c(){e=k("div"),f&&f.c(),N(e,"tabindex",n=r[1]?0:void 0),N(e,"role",t=r[1]?"button":void 0),oe(e,"z-index",r[2])},m(u,c){b(u,e,c),f&&f.m(e,null),o=!0,i||(s=[Cl(r[7].call(null,e)),Cl(l=Jf.call(null,e,r[0])),K(e,"click",Rr(r[20])),K(e,"dblclick",Rr(r[21])),K(e,"contextmenu",Rr(Zi(r[22]))),K(e,"mouseenter",r[23]),K(e,"mouseleave",r[24]),K(e,"mousemove",r[25]),K(e,"keydown",r[8])],i=!0)},p(u,[c]){f&&f.p&&(!o||c&262152)&&De(f,a,u,u[18],o?He(a,u[18],c,Wf):Ue(u[18]),Vl),(!o||c&2&&n!==(n=u[1]?0:void 0))&&N(e,"tabindex",n),(!o||c&2&&t!==(t=u[1]?"button":void 0))&&N(e,"role",t),l&&Yr(l.update)&&c&1&&l.update.call(null,u[0]),c&4&&oe(e,"z-index",u[2])},i(u){o||(v(f,u),o=!0)},o(u){S(f,u),o=!1},d(u){u&&$(e),f&&f.d(u),i=!1,nt(s)}}}function Jf(r,e){const n=r.className;function t(l){l?r.className=`${n} ${l}`:r.className=n}return t(e),{update:t}}function Yf(r,e,n){let t,l,o,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:f}=e,{class:u=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:m=null}=e,{offset:g=void 0}=e,{zIndex:y=void 0}=e,{rotation:h=0}=e,{opacity:w=1}=e;const C=mn(),{map:L,layerEvent:F,self:T,markerClickManager:A}=ra();V(r,L,D=>n(27,o=D)),V(r,F,D=>n(26,t=D)),V(r,T,D=>n(3,l=D));function j(D){te(T,l=new Xt.Marker({element:D,rotation:h,draggable:d,offset:g,opacity:w.toString()}).setLngLat(f).addTo(o),l),n(11,a=l);const ve=()=>R("dragstart"),ge=()=>{O(),R("drag")},fe=()=>{O(),R("dragend")};return d&&(l.on("dragstart",ve),l.on("drag",ge),l.on("dragend",fe)),{destroy(){d&&(l==null||l.off("dragstart",ve),l==null||l.off("drag",ge),l==null||l.off("dragend",fe)),n(11,a=void 0),l==null||l.remove()}}}function O(){let D=l==null?void 0:l.getLngLat();D&&(Array.isArray(f)?n(10,f=[D.lng,D.lat]):f&&"lon"in f?n(10,f={lon:D.lng,lat:D.lat}):n(10,f=D))}function U(D){D.key===" "&&(D.preventDefault(),D.stopPropagation(),R("click"))}function R(D){if(!c)return;let ve=l==null?void 0:l.getLngLat();if(!ve)return;const ge=[ve.lng,ve.lat];let fe={map:o,marker:l,lngLat:ge,features:[{type:"Feature",properties:(m==null?void 0:m.properties)??{},geometry:{type:"Point",coordinates:ge}}]};(D==="click"||D==="contextmenu")&&A.handleClick(fe),te(F,t={...fe,layerType:"marker",type:D},t),C(D,fe)}const B=()=>R("click"),H=()=>R("dblclick"),G=()=>{R("contextmenu")},Z=()=>{R("mouseenter")},Y=()=>{R("mouseleave")},ie=()=>R("mousemove");return r.$$set=D=>{"marker"in D&&n(11,a=D.marker),"lngLat"in D&&n(10,f=D.lngLat),"class"in D&&n(0,u=D.class),"interactive"in D&&n(12,c=D.interactive),"asButton"in D&&n(1,_=D.asButton),"draggable"in D&&n(13,d=D.draggable),"feature"in D&&n(14,m=D.feature),"offset"in D&&n(15,g=D.offset),"zIndex"in D&&n(2,y=D.zIndex),"rotation"in D&&n(16,h=D.rotation),"opacity"in D&&n(17,w=D.opacity),"$$scope"in D&&n(18,s=D.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(f)),r.$$.dirty&32776&&(l==null||l.setOffset(g??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(h)),r.$$.dirty&131080&&(l==null||l.setOpacity(w.toString()))},[u,_,y,l,L,F,T,j,U,R,f,a,c,d,m,g,h,w,s,i,B,H,G,Z,Y,ie]}class Ar extends se{constructor(e){super(),ae(this,e,Yf,qf,le,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Zf=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Ql=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function xl(r){var l;let e,n,t=(((l=r[4])==null?void 0:l.length)||r[3]instanceof Xt.Marker)&&eo(r);return{c(){e=k("div"),t&&t.c()},m(o,i){b(o,e,i),t&&t.m(e,null),r[32](e),n=!0},p(o,i){var s;(s=o[4])!=null&&s.length||o[3]instanceof Xt.Marker?t?(t.p(o,i),i[0]&24&&v(t,1)):(t=eo(o),t.c(),v(t,1),t.m(e,null)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(o){n||(v(t),n=!0)},o(o){S(t),n=!1},d(o){o&&$(e),t&&t.d(),r[32](null)}}}function eo(r){let e;const n=r[30].default,t=Re(n,r,r[29],Ql);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o[0]&536870933)&&De(t,n,l,l[29],e?He(n,l[29],o,Zf):Ue(l[29]),Ql)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Kf(r){let e,n,t=r[9].default&&xl(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,o){l[9].default?t?(t.p(l,o),o[0]&512&&v(t,1)):(t=xl(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function Xf(r,e,n){let t,l,o,i,s,a,{$$slots:f={},$$scope:u}=e;const c=la(f);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:m=!1}=e,{closeOnMove:g=!1}=e,{openOn:y="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:w=!0}=e,{anchor:C=void 0}=e,{offset:L=void 0}=e,{popupClass:F=void 0}=e,{maxWidth:T=void 0}=e,{lngLat:A=void 0}=e,{html:j=void 0}=e,{open:O=!1}=e;const U=mn(),{map:R,popupTarget:B,layerEvent:H,layer:G,eventTopMost:Z,markerClickManager:Y}=ml();V(r,R,W=>n(2,o=W)),V(r,B,W=>n(3,s=W)),V(r,H,W=>n(28,i=W)),V(r,G,W=>n(35,a=W));const ie=["click","dblclick","contextmenu"];let D,ve=!1,ge;function fe(){if(!D)return;let W=D.getElement();!W||W===ge||(ge=W,y==="hover"&&(ge.style.pointerEvents="none"),ge.addEventListener("mouseenter",()=>{n(24,ve=!0)},{passive:!0}),ge.addEventListener("mouseleave",()=>{n(24,ve=!1)},{passive:!0}),ge.addEventListener("click",()=>{m&&n(0,O=!1)},{passive:!0}))}Sr(()=>{if(o)return o.on("click",me),o.on("contextmenu",me),Y.add(x),typeof s=="string"&&(o.on("click",s,Te),o.on("dblclick",s,Te),o.on("contextmenu",s,Te),o.on("mousemove",s,X),o.on("mouseleave",s,ke),o.on("touchstart",s,Je),o.on("touchend",s,Ne)),()=>{o!=null&&o.loaded()&&(D==null||D.remove(),o.off("click",me),o.off("contextmenu",me),Y.remove(x),s instanceof Xt.Marker?s.getPopup()===D&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Te),o.off("dblclick",s,Te),o.off("contextmenu",s,Te),o.off("mousemove",s,X),o.off("mouseleave",s,ke),o.off("touchstart",s,Je),o.off("touchend",s,Ne)))}});function ye(W){return h?!("marker"in W)&&!oa(W)&&Z(W)!==a:!1}let ue=null,Fe="normal";function Ze(W){"layerType"in W&&W.layerType==="deckgl"?(n(10,A=W.coordinate),n(4,ue=W.object?[W.object]:null)):(n(10,A=W.lngLat),n(4,ue=W.features??[]))}function Te(W){W.type!==y||ye(W)||(Ze(W),setTimeout(()=>n(0,O=!0)))}let re=null;function Je(W){re=W.point}function Ne(W){if(!re||y!=="hover")return;let _t=re.dist(W.point);re=null,_t<3&&(n(10,A=W.lngLat),n(4,ue=W.features??[]),D.isOpen()?n(25,Fe="justOpened"):(n(25,Fe="opening"),n(0,O=!0)))}function ke(W){y!=="hover"||re||Fe!=="normal"||(n(0,O=!1),n(4,ue=null))}function X(W){if(!(y!=="hover"||re||Fe!=="normal")){if(ye(W)){n(0,O=!1),n(4,ue=null);return}n(0,O=!0),n(4,ue=W.features??[]),n(10,A=W.lngLat)}}function me(W){if(Fe==="justOpened"){n(25,Fe="normal");return}if(!d)return;let _t=[ge,s instanceof Xt.Marker?s==null?void 0:s.getElement():null];O&&D.isOpen()&&!_t.some(Be=>Be==null?void 0:Be.contains(W.originalEvent.target))&&(W.type==="contextmenu"&&y==="contextmenu"||W.type!=="contextmenu")&&n(0,O=!1)}function x(W){d&&O&&D.isOpen()&&W.marker!==s&&n(0,O=!1)}Tt(()=>{o&&(D!=null&&D.isOpen())&&D.remove()});let pe;const $e=()=>n(0,O=!1);function Se(W){Ge[W?"unshift":"push"](()=>{pe=W,n(1,pe)})}return r.$$set=W=>{"closeButton"in W&&n(11,_=W.closeButton),"closeOnClickOutside"in W&&n(12,d=W.closeOnClickOutside),"closeOnClickInside"in W&&n(13,m=W.closeOnClickInside),"closeOnMove"in W&&n(14,g=W.closeOnMove),"openOn"in W&&n(15,y=W.openOn),"openIfTopMost"in W&&n(16,h=W.openIfTopMost),"focusAfterOpen"in W&&n(17,w=W.focusAfterOpen),"anchor"in W&&n(18,C=W.anchor),"offset"in W&&n(19,L=W.offset),"popupClass"in W&&n(20,F=W.popupClass),"maxWidth"in W&&n(21,T=W.maxWidth),"lngLat"in W&&n(10,A=W.lngLat),"html"in W&&n(22,j=W.html),"open"in W&&n(0,O=W.open),"$$scope"in W&&n(29,u=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&n(27,t=_??(!d&&!m)),r.$$.dirty[0]&146685952&&(D||(n(23,D=new Xt.Popup({closeButton:t,closeOnClick:!1,closeOnMove:g,focusAfterOpen:w,maxWidth:T,className:F,anchor:C,offset:L})),ge=D.getElement(),D.on("open",()=>{n(0,O=!0),fe(),U("open",D)}),D.on("close",()=>{n(0,O=!1),U("close",D)}),D.on("hover",()=>{U("hover",D)}))),r.$$.dirty[0]&8421384&&D&&s instanceof Xt.Marker&&(y==="click"?s.setPopup(D):s.getPopup()===D&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&ie.includes(y)&&(i==null?void 0:i.type)===y&&(Te(i),te(H,i=null,i)),r.$$.dirty[0]&268468224&&n(26,l=y==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&y==="hover"&&H&&(l&&i&&Ze(i),n(0,O=(l||ve)??!1)),r.$$.dirty[0]&12582914&&(pe?D.setDOMContent(pe):j&&D.setHTML(j)),r.$$.dirty[0]&8389632&&A&&D.setLngLat(A),r.$$.dirty[0]&41943045&&o){let W=D.isOpen();O&&!W?(D.addTo(o),Fe==="opening"&&n(25,Fe="justOpened")):!O&&W&&D.remove()}},[O,pe,o,s,ue,R,B,H,G,c,A,_,d,m,g,y,h,w,C,L,F,T,j,D,ve,Fe,l,t,i,u,f,$e,Se]}class Vf extends se{constructor(e){super(),ae(this,e,Xf,Kf,le,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Qf(r){let e;const n=r[16].default,t=Re(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&De(t,n,l,l[24],e?He(n,l[24],o,null):Ue(l[24]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function xf(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Qf]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Yi({props:o}),Ge.push(()=>ut(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){P(e.$$.fragment)},m(i,s){I(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function eu(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=_l("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:L=!0}=e;function F(B){w=B,n(0,w)}function T(B){je.call(this,r,B)}function A(B){je.call(this,r,B)}function j(B){je.call(this,r,B)}function O(B){je.call(this,r,B)}function U(B){je.call(this,r,B)}function R(B){je.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,o=B.id),"source"in B&&n(2,i=B.source),"sourceLayer"in B&&n(3,s=B.sourceLayer),"beforeId"in B&&n(4,a=B.beforeId),"beforeLayerType"in B&&n(5,f=B.beforeLayerType),"paint"in B&&n(6,u=B.paint),"layout"in B&&n(7,c=B.layout),"filter"in B&&n(8,_=B.filter),"applyToClusters"in B&&n(9,d=B.applyToClusters),"minzoom"in B&&n(10,m=B.minzoom),"maxzoom"in B&&n(11,g=B.maxzoom),"hoverCursor"in B&&n(12,y=B.hoverCursor),"manageHoverState"in B&&n(13,h=B.manageHoverState),"hovered"in B&&n(0,w=B.hovered),"eventsIfTopMost"in B&&n(14,C=B.eventsIfTopMost),"interactive"in B&&n(15,L=B.interactive),"$$scope"in B&&n(24,l=B.$$scope)},[w,o,i,s,a,f,u,c,_,d,m,g,y,h,C,L,t,F,T,A,j,O,U,R,l]}class kr extends se{constructor(e){super(),ae(this,e,eu,xf,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function to(r){let e=r[0],n,t,l=no(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),b(o,n,i),t=!0},p(o,i){i&1&&le(e,e=o[0])?(he(),S(l,1,1,Q),be(),l=no(o),l.c(),v(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||(v(l),t=!0)},o(o){S(l),t=!1},d(o){o&&$(n),l.d(o)}}}function no(r){let e;const n=r[15].default,t=Re(n,r,r[14],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16384)&&De(t,n,l,l[14],e?He(n,l[14],o,null):Ue(l[14]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function tu(r){let e,n,t=r[0]&&to(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&v(t,1)):(t=to(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function nu(r,e,n){let t,l,{$$slots:o={},$$scope:i}=e,{id:s=_l("vector")}=e,{url:a=null}=e,{tiles:f=null}=e,{promoteId:u=null}=e,{bounds:c=null}=e,{scheme:_=null}=e,{attribution:d=null}=e,{minzoom:m=null}=e,{maxzoom:g=null}=e,{volatile:y=null}=e;if(a&&a.includes("pmtiles://")&&!Xt.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let L=new fa;Xt.addProtocol("pmtiles",L.tile)}const{map:h,self:w}=ia();V(r,h,L=>n(13,l=L)),V(r,w,L=>n(0,t=L));let C;return Tt(()=>{t&&l&&(sa(h,t,C),te(w,t=null,t),C=void 0)}),r.$$set=L=>{"id"in L&&n(3,s=L.id),"url"in L&&n(4,a=L.url),"tiles"in L&&n(5,f=L.tiles),"promoteId"in L&&n(6,u=L.promoteId),"bounds"in L&&n(7,c=L.bounds),"scheme"in L&&n(8,_=L.scheme),"attribution"in L&&n(9,d=L.attribution),"minzoom"in L&&n(10,m=L.minzoom),"maxzoom"in L&&n(11,g=L.maxzoom),"volatile"in L&&n(12,y=L.volatile),"$$scope"in L&&n(14,i=L.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&l&&t!==s&&(te(w,t=s,t),aa(l,t,gr({type:"vector",url:a,tiles:f,promoteId:u,bounds:c,scheme:_,attribution:d,minzoom:m,maxzoom:g,volatile:y}),L=>l&&L===t,()=>{t&&(C=l==null?void 0:l.getSource(t))})),r.$$.dirty&8200&&(l==null||l.on("style.load",()=>{C=l==null?void 0:l.getSource(s)}))},[t,h,w,s,a,f,u,c,_,d,m,g,y,l,i,o]}class er extends se{constructor(e){super(),ae(this,e,nu,tu,le,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}const ru="/ltn/assets/layers-03647595.svg";function lu(r){let e,n,t,l,o,i,s,a,f;return{c(){e=k("label"),n=z(`Basemap:
  `),t=k("select"),l=k("option"),l.textContent="MapTiler Dataviz",o=k("option"),o.textContent="MapTiler Streets",i=k("option"),i.textContent="MapTiler Satellite",s=k("option"),s.textContent="OS Open Zoomstack",l.__value="dataviz",ze(l,l.__value),o.__value="streets-v2",ze(o,o.__value),i.__value="hybrid",ze(i,i.__value),s.__value="uk-openzoomstack-light",ze(s,s.__value),r[0]===void 0&&fn(()=>r[1].call(t))},m(u,c){b(u,e,c),p(e,n),p(e,t),p(t,l),p(t,o),p(t,i),p(t,s),yt(t,r[0],!0),a||(f=K(t,"change",r[1]),a=!0)},p(u,[c]){c&1&&yt(t,u[0])},i:Q,o:Q,d(u){u&&$(e),a=!1,f()}}}function ou(r,e,n){let t;V(r,Zr,o=>n(0,t=o));function l(){t=un(this),Zr.set(t)}return[t,l]}class iu extends se{constructor(e){super(),ae(this,e,ou,lu,le,{})}}let cr=Mt(!0);function su(r){let e,n;return e=new wt({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.layout={visibility:t[0]?"none":"visible"}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function au(r){let e,n;return e=new Ve({props:{data:r[1],$$slots:{default:[su]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&5&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function fu(r,e,n){let t;return V(r,cr,o=>n(0,t=o)),[t,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class uu extends se{constructor(e){super(),ae(this,e,fu,au,le,{})}}function cu(r){let e,n;return e=new Ar({props:{lngLat:r[0],$$slots:{default:[_u]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.lngLat=t[0]),l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function du(r){let e,n,t;function l(i){r[3](i)}let o={draggable:!0,$$slots:{default:[mu]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new Ar({props:o}),Ge.push(()=>ut(e,"lngLat",l)),{c(){P(e.$$.fragment)},m(i,s){I(e,i,s),t=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.lngLat=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function _u(r){let e,n;const t=r[2].default,l=Re(t,r,r[4],null);return{c(){e=k("span"),l&&l.c(),N(e,"class","dot svelte-1gcxp27")},m(o,i){b(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i&16)&&De(l,t,o,o[4],n?He(t,o[4],i,null):Ue(o[4]),null)},i(o){n||(v(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&$(e),l&&l.d(o)}}}function mu(r){let e,n;const t=r[2].default,l=Re(t,r,r[4],null);return{c(){e=k("span"),l&&l.c(),N(e,"class","dot svelte-1gcxp27")},m(o,i){b(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i&16)&&De(l,t,o,o[4],n?He(t,o[4],i,null):Ue(o[4]),null)},i(o){n||(v(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&$(e),l&&l.d(o)}}}function pu(r){let e,n,t,l;const o=[du,cu],i=[];function s(a,f){return a[1]?0:1}return e=s(r),n=i[e]=o[e](r),{c(){n.c(),t=Ye()},m(a,f){i[e].m(a,f),b(a,t,f),l=!0},p(a,[f]){let u=e;e=s(a),e===u?i[e].p(a,f):(he(),S(i[u],1,1,()=>{i[u]=null}),be(),n=i[e],n?n.p(a,f):(n=i[e]=o[e](a),n.c()),v(n,1),n.m(t.parentNode,t))},i(a){l||(v(n),l=!0)},o(a){S(n),l=!1},d(a){a&&$(t),i[e].d(a)}}}function gu(r,e,n){let{$$slots:t={},$$scope:l}=e,{lngLat:o}=e,{draggable:i=!1}=e;function s(a){o=a,n(0,o)}return r.$$set=a=>{"lngLat"in a&&n(0,o=a.lngLat),"draggable"in a&&n(1,i=a.draggable),"$$scope"in a&&n(4,l=a.$$scope)},[o,i,t,s,l]}class wn extends se{constructor(e){super(),ae(this,e,gu,pu,le,{lngLat:0,draggable:1})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const hu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},ro=hu;function lo(r,e,n){const t=r.slice();return t[11]=e[n][0],t[12]=e[n][1],t}function Hr(r){let e,n=[r[12]],t={};for(let l=0;l<n.length;l+=1)t=_e(t,n[l]);return{c(){e=Jt(r[11]),hr(e,t)},m(l,o){b(l,e,o)},p(l,o){hr(e,t=Oe(n,[o&32&&l[12]]))},d(l){l&&$(e)}}}function oo(r){let e=r[11],n,t=r[11]&&Hr(r);return{c(){t&&t.c(),n=Ye()},m(l,o){t&&t.m(l,o),b(l,n,o)},p(l,o){l[11]?e?le(e,l[11])?(t.d(1),t=Hr(l),e=l[11],t.c(),t.m(n.parentNode,n)):t.p(l,o):(t=Hr(l),e=l[11],t.c(),t.m(n.parentNode,n)):e&&(t.d(1),t=null,e=l[11])},d(l){l&&$(n),t&&t.d(l)}}}function bu(r){let e,n,t,l,o,i=Me(r[5]),s=[];for(let _=0;_<i.length;_+=1)s[_]=oo(lo(r,i,_));const a=r[10].default,f=Re(a,r,r[9],null);let u=[ro,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":t=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:l=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],c={};for(let _=0;_<u.length;_+=1)c=_e(c,u[_]);return{c(){e=Jt("svg");for(let _=0;_<s.length;_+=1)s[_].c();n=Ye(),f&&f.c(),hr(e,c)},m(_,d){b(_,e,d);for(let m=0;m<s.length;m+=1)s[m]&&s[m].m(e,null);p(e,n),f&&f.m(e,null),o=!0},p(_,[d]){if(d&32){i=Me(_[5]);let m;for(m=0;m<i.length;m+=1){const g=lo(_,i,m);s[m]?s[m].p(g,d):(s[m]=oo(g),s[m].c(),s[m].m(e,n))}for(;m<s.length;m+=1)s[m].d(1);s.length=i.length}f&&f.p&&(!o||d&512)&&De(f,a,_,_[9],o?He(a,_[9],d,null):Ue(_[9]),null),hr(e,c=Oe(u,[ro,d&128&&_[7],(!o||d&4)&&{width:_[2]},(!o||d&4)&&{height:_[2]},(!o||d&2)&&{stroke:_[1]},(!o||d&28&&t!==(t=_[4]?Number(_[3])*24/Number(_[2]):_[3]))&&{"stroke-width":t},(!o||d&257&&l!==(l=_[6]("lucide-icon","lucide",_[0]?`lucide-${_[0]}`:"",_[8].class)))&&{class:l}]))},i(_){o||(v(f,_),o=!0)},o(_){S(f,_),o=!1},d(_){_&&$(e),st(s,_),f&&f.d(_)}}}function $u(r,e,n){const t=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let l=Ll(e,t),{$$slots:o={},$$scope:i}=e,{name:s=void 0}=e,{color:a="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:c=!1}=e,{iconNode:_=[]}=e;const d=(...m)=>m.filter((g,y,h)=>!!g&&h.indexOf(g)===y).join(" ");return r.$$set=m=>{n(8,e=_e(_e({},e),Vt(m))),n(7,l=Ll(e,t)),"name"in m&&n(0,s=m.name),"color"in m&&n(1,a=m.color),"size"in m&&n(2,f=m.size),"strokeWidth"in m&&n(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&n(4,c=m.absoluteStrokeWidth),"iconNode"in m&&n(5,_=m.iconNode),"$$scope"in m&&n(9,i=m.$$scope)},e=Vt(e),[s,a,f,u,c,_,d,l,e,i,o]}class vu extends se{constructor(e){super(),ae(this,e,$u,bu,le,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Fr=vu;function yu(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function wu(r){let e,n;const t=[{name:"circle-help"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[yu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Fr({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&Cr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function ku(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class Su extends se{constructor(e){super(),ae(this,e,ku,wu,le,{})}}const Cu=Su;function Lu(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Mu(r){let e,n;const t=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[Lu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Fr({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&Cr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Tu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class Au extends se{constructor(e){super(),ae(this,e,Tu,Mu,le,{})}}const Fu=Au;function Pu(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Iu(r){let e,n;const t=[{name:"pencil"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[Pu]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Fr({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&Cr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Eu(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class Nu extends se{constructor(e){super(),ae(this,e,Eu,Iu,le,{})}}const wl=Nu;function ju(r){let e;const n=r[2].default,t=Re(n,r,r[3],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8)&&De(t,n,l,l[3],e?He(n,l[3],o,null):Ue(l[3]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function zu(r){let e,n;const t=[{name:"trash-2"},r[1],{iconNode:r[0]}];let l={$$slots:{default:[ju]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new Fr({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s=i&3?Oe(t,[t[0],i&2&&Cr(o[1]),i&1&&{iconNode:o[0]}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Ou(r,e,n){let{$$slots:t={},$$scope:l}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=i=>{n(1,e=_e(_e({},e),Vt(i))),"$$scope"in i&&n(3,l=i.$$scope)},e=Vt(e),[o,e,t,l]}class Bu extends se{constructor(e){super(),ae(this,e,Ou,zu,le,{})}}const gs=Bu;function io(r){let e,n;return e=new Lr({props:{$$slots:{default:[Ru]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ru(r){let e,n,t;const l=r[1].default,o=Re(l,r,r[4],null);return{c(){e=k("h2"),e.textContent="Help",n=M(),o&&o.c()},m(i,s){b(i,e,s),b(i,n,s),o&&o.m(i,s),t=!0},p(i,s){o&&o.p&&(!t||s&16)&&De(o,l,i,i[4],t?He(l,i[4],s,null):Ue(i[4]),null)},i(i){t||(v(o,i),t=!0)},o(i){S(o,i),t=!1},d(i){i&&($(e),$(n)),o&&o.d(i)}}}function Du(r){let e,n,t,l,o,i,s;n=new Cu({props:{color:"black"}});let a=r[0]&&io(r);return{c(){e=k("button"),P(n.$$.fragment),t=M(),a&&a.c(),l=Ye(),N(e,"class","icon-btn help svelte-my65h"),N(e,"aria-label","Help")},m(f,u){b(f,e,u),I(n,e,null),b(f,t,u),a&&a.m(f,u),b(f,l,u),o=!0,i||(s=K(e,"click",r[2]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&v(a,1)):(a=io(f),a.c(),v(a,1),a.m(l.parentNode,l)):a&&(he(),S(a,1,1,()=>{a=null}),be())},i(f){o||(v(n.$$.fragment,f),v(a),o=!0)},o(f){S(n.$$.fragment,f),S(a),o=!1},d(f){f&&($(e),$(t),$(l)),E(n),a&&a.d(f),i=!1,s()}}}function Uu(r,e,n){let{$$slots:t={},$$scope:l}=e,o=!1;const i=()=>n(0,o=!0),s=()=>n(0,o=!1);return r.$$set=a=>{"$$scope"in a&&n(4,l=a.$$scope)},[o,t,i,s,l]}class jt extends se{constructor(e){super(),ae(this,e,Uu,Du,le,{})}}function Hu(r){let e,n,t,l,o,i=r[0]+1+"",s,a,f=r[1].length+"",u,c,_,d,m,g,y;return{c(){e=k("div"),n=k("button"),t=z("Previous"),o=M(),s=z(i),a=z(" / "),u=z(f),c=M(),_=k("button"),d=z("Next"),n.disabled=l=r[0]==0,N(n,"data-tooltip","Left"),_.disabled=m=r[0]==r[1].length-1,N(_,"data-tooltip","Right"),oe(e,"display","flex"),oe(e,"justify-content","space-between"),oe(e,"align-items","center")},m(h,w){b(h,e,w),p(e,n),p(n,t),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c),p(e,_),p(_,d),g||(y=[K(window,"keydown",r[2]),K(n,"click",r[3]),K(_,"click",r[4])],g=!0)},p(h,[w]){w&1&&l!==(l=h[0]==0)&&(n.disabled=l),w&1&&i!==(i=h[0]+1+"")&&ne(s,i),w&2&&f!==(f=h[1].length+"")&&ne(u,f),w&3&&m!==(m=h[0]==h[1].length-1)&&(_.disabled=m)},i:Q,o:Q,d(h){h&&$(e),g=!1,nt(y)}}}function Gu(r,e,n){let t;V(r,Qt,f=>n(5,t=f));let{list:l}=e,{idx:o=0}=e;Sr(()=>{t==null||t.keyboard.disable()}),Tt(()=>{t==null||t.keyboard.enable()});function i(f){f.key=="ArrowLeft"&&(f.stopPropagation(),s()),f.key=="ArrowRight"&&(f.stopPropagation(),a())}function s(){o!=0&&n(0,o--,o)}function a(){o!=l.length-1&&n(0,o++,o)}return r.$$set=f=>{"list"in f&&n(1,l=f.list),"idx"in f&&n(0,o=f.idx)},[o,l,i,s,a]}class Pr extends se{constructor(e){super(),ae(this,e,Gu,Hu,le,{list:1,idx:0})}}function Wu(r,e){let n=new Set(r.getStyle().layers.filter(t=>t.type=="line").map(t=>t.id));return e=="dataviz"?["Road network","Path"].filter(t=>n.has(t)):e=="hybrid"?["Path","Road","Tunnel"].filter(t=>n.has(t)):e=="streets-v2"?r.getStyle().layers.filter(t=>t["source-layer"]=="transportation"&&t.type=="line").map(t=>t.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(t=>t["source-layer"]=="roads"&&t.type=="line").map(t=>t.id):[]}const{window:qu}=Ki;function Ju(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g;return d=Xi(r[8][0]),{c(){e=k("button"),e.textContent="Stop StreetView",n=M(),t=k("fieldset"),l=k("legend"),l.textContent="Source:",o=M(),i=k("label"),s=k("input"),a=z(`
      Google Street View`),f=M(),u=k("label"),c=k("input"),_=z(`
      Bing Streetside`),N(e,"class","secondary"),N(s,"type","radio"),s.__value="google",ze(s,s.__value),N(c,"type","radio"),c.__value="bing",ze(c,c.__value),d.p(s,c)},m(y,h){b(y,e,h),b(y,n,h),b(y,t,h),p(t,l),p(t,o),p(t,i),p(i,s),s.checked=s.__value===r[0],p(i,a),p(t,f),p(t,u),p(u,c),c.checked=c.__value===r[0],p(u,_),m||(g=[K(e,"click",r[3]),K(s,"change",r[7]),K(c,"change",r[9])],m=!0)},p(y,h){h&1&&(s.checked=s.__value===y[0]),h&1&&(c.checked=c.__value===y[0])},d(y){y&&($(e),$(n),$(t)),d.r(),m=!1,nt(g)}}}function Yu(r){let e,n,t;return{c(){e=k("button"),e.textContent="StreetView",N(e,"class","secondary")},m(l,o){b(l,e,o),n||(t=K(e,"click",r[2]),n=!0)},p:Q,d(l){l&&$(e),n=!1,t()}}}function Zu(r){let e,n,t;function l(s,a){return s[1]?Yu:Ju}let o=l(r),i=o(r);return{c(){i.c(),e=Ye()},m(s,a){i.m(s,a),b(s,e,a),n||(t=K(qu,"keydown",r[4]),n=!0)},p(s,[a]){o===(o=l(s))&&i?i.p(s,a):(i.d(1),i=o(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Q,o:Q,d(s){s&&$(e),i.d(s),n=!1,t()}}}function Ku(r,e,n){let t;V(r,cr,g=>n(1,t=g));let{map:l}=e,{maptilerBasemap:o}=e,i="google",s=[];function a(){te(cr,t=!1,t),l.on("click",u),l.getCanvas().style.cursor="crosshair";for(let g of Wu(l,o))s.push([g,l.getPaintProperty(g,"line-color")]),l.setPaintProperty(g,"line-color","cyan")}function f(){te(cr,t=!0,t),l.off("click",u),l.getCanvas().style.cursor="inherit";for(let[g,y]of s)l.setPaintProperty(g,"line-color",y);s=[]}Tt(f);function u(g){let y=g.lngLat.lng,h=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${h},${y}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${h}~${y}&style=x`,"_blank")}function c(g){!t&&g.key=="Escape"&&(g.stopPropagation(),f())}const _=[[]];function d(){i=this.__value,n(0,i)}function m(){i=this.__value,n(0,i)}return r.$$set=g=>{"map"in g&&n(5,l=g.map),"maptilerBasemap"in g&&n(6,o=g.maptilerBasemap)},[i,t,a,f,c,l,o,d,_,m]}class Xu extends se{constructor(e){super(),ae(this,e,Ku,Zu,le,{map:5,maptilerBasemap:6})}}function we(r,e=!0){return{id:r,beforeId:Vu(r),eventsIfTopMost:e}}function Vu(r){let e=Wt(Qt);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let n,t=!1;for(let l=so.length-1;l>=0;l--){let o=so[l];if(o==r){t=!0;break}e.getLayer(o)&&(n=o)}if(!t)throw new Error(`Layer ID ${r} not defined in layerZorder`);return n}let Gr=r=>r,Wr=r=>r;const so=[Gr(Wr("Background")),"neighbourhood-boundaries","neighbourhood-prioritization-simd","neighbourhood-prioritization-area",Gr("Ferry line"),"neighbourhood-boundaries-outline","debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",Wr("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-gp-practices","context-hospitals","context-schools","context-railway-stations","context-stats19",Wr("Road labels"),Gr("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function an(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function dn(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function _n(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),n=Math.round(r-e*60);return`${e}m${n}s`}function tl(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function bn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function ao(r){return r.reduce((e,n)=>e+n,0)}function fo(r){let e,n;return e=new jt({props:{$$slots:{default:[Qu]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Qu(r){let e;return{c(){e=k("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
      according to OpenStreetMap.`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function xu(r){let e,n;const t=[we("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":an(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&1?Oe(t,[t[0],t[1],t[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function ec(r){let e,n,t,l,o,i,s,a=r[0]&&fo(r);return l=new er({props:{url:`pmtiles://${St("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[xu]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Bus routes",n=M(),a&&a.c(),t=M(),P(l.$$.fragment),N(e,"class","secondary")},m(f,u){b(f,e,u),b(f,n,u),a&&a.m(f,u),b(f,t,u),I(l,f,u),o=!0,i||(s=K(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&v(a,1):(a=fo(f),a.c(),v(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u&5&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(v(a),v(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),E(l,f),i=!1,s()}}}function tc(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class nc extends se{constructor(e){super(),ae(this,e,tc,ec,le,{})}}function rc(r){let e,n;return{c(){e=Jt("svg"),n=Jt("path"),N(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),N(e,"viewBox","0 0 14 14"),N(e,"width","13"),N(e,"height","13"),N(e,"class","svelte-en2qvf")},m(t,l){b(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&$(e)}}}class hs extends se{constructor(e){super(),ae(this,e,null,rc,le,{})}}function lc(r){let e,n;return{c(){e=Jt("svg"),n=Jt("path"),N(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),N(e,"viewBox","0 0 30 30"),N(e,"fill","none"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"class","svelte-d2loi5")},m(t,l){b(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&$(e)}}}class bs extends se{constructor(e){super(),ae(this,e,null,lc,le,{})}}function oc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"area.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"area.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function ic(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"reverse.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"reverse.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function sc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"poi.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"poi.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function ac(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"postal_code.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"postal_code.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function fc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"street.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"street.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function uc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"road.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"road.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function cc(r){let e,n;return{c(){e=k("img"),Ke(e.src,n=r[3]+"housenumber.svg")||N(e,"src",n),N(e,"alt",r[6]),N(e,"class","svelte-ltkwvy")},m(t,l){b(t,e,l)},p(t,l){l&8&&!Ke(e.src,n=t[3]+"housenumber.svg")&&N(e,"src",n),l&64&&N(e,"alt",t[6])},d(t){t&&$(e)}}}function dc(r){let e,n,t,l;return{c(){e=k("img"),Ke(e.src,n=r[5])||N(e,"src",n),N(e,"alt",r[4]),N(e,"class","svelte-ltkwvy")},m(o,i){b(o,e,i),t||(l=K(e,"error",r[14]),t=!0)},p(o,i){i&32&&!Ke(e.src,n=o[5])&&N(e,"src",n),i&16&&N(e,"alt",o[4])},d(o){o&&$(e),t=!1,l()}}}function uo(r){let e,n;return{c(){e=k("span"),n=z(r[6]),N(e,"class","secondary svelte-ltkwvy")},m(t,l){b(t,e,l),p(e,n)},p(t,l){l&64&&ne(n,t[6])},d(t){t&&$(e)}}}function _c(r){let e,n,t,l,o,i,s,a,f,u=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],m,g,y=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",h,w,C;function L(j,O){return O&1&&(n=null),O&1&&(t=null),O&1&&(l=null),O&1&&(o=null),j[5]?dc:j[0].address?cc:(n==null&&(n=!!j[0].id.startsWith("road.")),n?uc:(t==null&&(t=!!j[0].id.startsWith("address.")),t?fc:(l==null&&(l=!!j[0].id.startsWith("postal_code.")),l?ac:(o==null&&(o=!!j[0].id.startsWith("poi.")),o?sc:j[7]?ic:oc))))}let F=L(r,-1),T=F(r),A=d&&uo(r);return{c(){e=k("li"),T.c(),i=M(),s=k("span"),a=k("span"),f=k("span"),c=z(u),_=M(),A&&A.c(),m=M(),g=k("span"),h=z(y),N(f,"class","primary svelte-ltkwvy"),N(a,"class","svelte-ltkwvy"),N(g,"class","line2 svelte-ltkwvy"),N(s,"class","texts svelte-ltkwvy"),N(e,"tabindex","0"),N(e,"data-selected",r[1]),N(e,"class","svelte-ltkwvy"),gt(e,"selected",r[1])},m(j,O){b(j,e,O),T.m(e,null),p(e,i),p(e,s),p(s,a),p(a,f),p(f,c),p(a,_),A&&A.m(a,null),p(s,m),p(s,g),p(g,h),w||(C=[K(e,"mouseenter",r[12]),K(e,"focus",r[13])],w=!0)},p(j,[O]){F===(F=L(j,O))&&T?T.p(j,O):(T.d(1),T=F(j),T&&(T.c(),T.m(e,i))),O&1&&u!==(u=(j[7]?j[0].place_name:j[0].place_name.replace(/,.*/,""))+"")&&ne(c,u),O&37&&(d=j[2]==="always"||j[2]!=="never"&&!j[0].address&&!j[0].id.startsWith("road.")&&!j[0].id.startsWith("address.")&&!j[0].id.startsWith("postal_code.")&&(!j[0].id.startsWith("poi.")||!j[5])&&!j[7]),d?A?A.p(j,O):(A=uo(j),A.c(),A.m(a,null)):A&&(A.d(1),A=null),O&1&&y!==(y=(j[7]?"":j[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&ne(h,y),O&2&&N(e,"data-selected",j[1]),O&2&&gt(e,"selected",j[1])},i:Q,o:Q,d(j){j&&$(e),T.d(),A&&A.d(),w=!1,nt(C)}}}function mc(r,e,n){var C;let t,l,{feature:o}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:f}=e;const u=(C=o.properties)==null?void 0:C.categories;let c,_,d=0,m=o.place_type[0]==="reverse";function g(){_&&a.add(_),n(10,d++,d)}function y(L){je.call(this,r,L)}function h(L){je.call(this,r,L)}const w=()=>g();return r.$$set=L=>{"feature"in L&&n(0,o=L.feature),"selected"in L&&n(1,i=L.selected),"showPlaceType"in L&&n(2,s=L.showPlaceType),"missingIconsCache"in L&&n(9,a=L.missingIconsCache),"iconsBaseUrl"in L&&n(3,f=L.iconsBaseUrl)},r.$$.update=()=>{var L,F,T,A;if(r.$$.dirty&3640)do n(11,t--,t),n(4,c=u==null?void 0:u[t]),n(5,_=c?f+c.replace(/ /g,"_")+".svg":void 0);while(t>-1&&(!_||a.has(_)));r.$$.dirty&1&&n(6,l=((F=(L=o.properties)==null?void 0:L.categories)==null?void 0:F.join(", "))??((A=(T=o.properties)==null?void 0:T.place_type_name)==null?void 0:A[0])??o.place_type[0])},n(11,t=(u==null?void 0:u.length)??0),[o,i,s,f,c,_,l,m,g,a,d,t,y,h,w]}class pc extends se{constructor(e){super(),ae(this,e,mc,_c,le,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function gc(r){let e;return{c(){e=k("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',N(e,"class","svelte-7cmwmc")},m(n,t){b(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}class hc extends se{constructor(e){super(),ae(this,e,null,gc,le,{})}}function bc(r){let e,n;return{c(){e=Jt("svg"),n=Jt("path"),N(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),N(e,"viewBox","0 0 60.006 21.412"),N(e,"width","14"),N(e,"height","20"),N(e,"class","svelte-en2qvf")},m(t,l){b(t,e,l),p(e,n)},p:Q,i:Q,o:Q,d(t){t&&$(e)}}}class $c extends se{constructor(e){super(),ae(this,e,null,bc,le,{})}}function vc(r){let e,n,t;return{c(){e=Jt("svg"),n=Jt("circle"),t=Jt("path"),N(n,"cx","4.789"),N(n,"cy","4.787"),N(n,"r","3.85"),N(n,"class","svelte-1aq105l"),N(t,"d","M12.063 12.063 7.635 7.635"),N(t,"class","svelte-1aq105l"),N(e,"xmlns","http://www.w3.org/2000/svg"),N(e,"width","13"),N(e,"height","13"),N(e,"viewBox","0 0 13 13"),N(e,"class","svelte-1aq105l")},m(l,o){b(l,e,o),p(e,n),p(e,t)},p:Q,i:Q,o:Q,d(l){l&&$(e)}}}class yc extends se{constructor(e){super(),ae(this,e,null,vc,le,{})}}function wc(r,e,n){const t=e[1],l=e[0],o=t-l;return r===t&&n?r:((r-l)%o+o)%o+l}function co(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Nn;async function kc(r,e,n){const t=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(t&&(l.minZoom!=null&&l.minZoom>t[0]||l.maxZoom!=null&&l.maxZoom<t[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Nn&&l.cachedLocationExpiry&&Nn.time+l.cachedLocationExpiry>Date.now()){if(!Nn.coords)break e;return Nn.coords}let o;try{return o=await new Promise((i,s)=>{n.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(f=>f.toFixed(6)).join(","))},a=>{s(a)},l)}),o}catch{}finally{l.cachedLocationExpiry&&(Nn={time:Date.now(),coords:o})}if(n.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(t&&l.type==="map-center")return t[1].toFixed(6)+","+t[2].toFixed(6)}}function _o(r,e,n){const t=r.slice();return t[84]=e[n],t[86]=n,t}function mo(r){let e,n;return e=new hc({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function po(r){let e,n,t,l,o;return n=new $c({}),{c(){e=k("button"),P(n.$$.fragment),N(e,"type","button"),N(e,"title",r[9]),N(e,"class","svelte-bz0zu3"),gt(e,"active",r[0])},m(i,s){b(i,e,s),I(n,e,null),t=!0,l||(o=K(e,"click",r[69]),l=!0)},p(i,s){(!t||s[0]&512)&&N(e,"title",i[9]),(!t||s[0]&1)&&gt(e,"active",i[0])},i(i){t||(v(n.$$.fragment,i),t=!0)},o(i){S(n.$$.fragment,i),t=!1},d(i){i&&$(e),E(n),l=!1,o()}}}function Sc(r){let e,n=[],t=new Map,l,o,i,s=Me(r[14]);const a=f=>f[84].id+(f[84].address?","+f[84].address:"");for(let f=0;f<s.length;f+=1){let u=_o(r,s,f),c=a(u);t.set(c,n[f]=go(c,u))}return{c(){e=k("ul");for(let f=0;f<n.length;f+=1)n[f].c();N(e,"class","options svelte-bz0zu3")},m(f,u){b(f,e,u);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);l=!0,o||(i=[K(e,"mouseleave",r[73]),K(e,"blur",r[74])],o=!0)},p(f,u){u[0]&17880064&&(s=Me(f[14]),he(),n=ca(n,u,a,1,f,s,t,e,da,go,null,_o),be())},i(f){if(!l){for(let u=0;u<s.length;u+=1)v(n[u]);l=!0}},o(f){for(let u=0;u<n.length;u+=1)S(n[u]);l=!1},d(f){f&&$(e);for(let u=0;u<n.length;u+=1)n[u].d();o=!1,nt(i)}}}function Cc(r){let e,n,t,l,o,i;return n=new bs({}),{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("div"),o=z(r[7]),N(l,"class","svelte-bz0zu3"),N(e,"class","no-results svelte-bz0zu3")},m(s,a){b(s,e,a),I(n,e,null),p(e,t),p(e,l),p(l,o),i=!0},p(s,a){(!i||a[0]&128)&&ne(o,s[7])},i(s){i||(v(n.$$.fragment,s),i=!0)},o(s){S(n.$$.fragment,s),i=!1},d(s){s&&$(e),E(n)}}}function Lc(r){let e="",n;return{c(){n=z(e)},m(t,l){b(t,n,l)},p:Q,i:Q,o:Q,d(t){t&&$(n)}}}function Mc(r){let e,n,t,l,o,i,s,a,f,u,c;return n=new bs({}),a=new hs({}),{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("div"),o=z(r[6]),i=M(),s=k("button"),P(a.$$.fragment),N(l,"class","svelte-bz0zu3"),N(s,"class","svelte-bz0zu3"),N(e,"class","error svelte-bz0zu3")},m(_,d){b(_,e,d),I(n,e,null),p(e,t),p(e,l),p(l,o),p(e,i),p(e,s),I(a,s,null),f=!0,u||(c=K(s,"click",r[70]),u=!0)},p(_,d){(!f||d[0]&64)&&ne(o,_[6])},i(_){f||(v(n.$$.fragment,_),v(a.$$.fragment,_),f=!0)},o(_){S(n.$$.fragment,_),S(a.$$.fragment,_),f=!1},d(_){_&&$(e),E(n),E(a),u=!1,c()}}}function go(r,e){let n,t,l;function o(){return e[71](e[86])}function i(){return e[72](e[84])}return t=new pc({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),t.$on("mouseenter",o),t.$on("focus",i),{key:r,first:null,c(){n=Ye(),P(t.$$.fragment),this.first=n},m(s,a){b(s,n,a),I(t,s,a),l=!0},p(s,a){e=s;const f={};a[0]&16384&&(f.feature=e[84]),a[0]&1024&&(f.showPlaceType=e[10]),a[0]&49152&&(f.selected=e[15]===e[86]),a[0]&4096&&(f.iconsBaseUrl=e[12]),t.$set(f)},i(s){l||(v(t.$$.fragment,s),l=!0)},o(s){S(t.$$.fragment,s),l=!1},d(s){s&&$(n),E(t,s)}}}function Tc(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,w,C,L,F,T=!1;o=new yc({}),c=new hs({});let A=r[19]&&mo(),j=r[5]==="button"&&po(r);const O=r[61].default,U=Re(O,r,r[60],null),R=[Mc,Lc,Cc,Sc],B=[];function H(G,Z){var Y,ie;return G[18]?0:G[16]?((Y=G[14])==null?void 0:Y.length)===0?2:G[16]&&((ie=G[14])!=null&&ie.length)?3:-1:1}return~(y=H(r))&&(h=B[y]=R[y](r)),{c(){e=M(),n=k("form"),t=k("div"),l=k("button"),P(o.$$.fragment),i=M(),s=k("input"),a=M(),f=k("div"),u=k("button"),P(c.$$.fragment),_=M(),A&&A.c(),d=M(),j&&j.c(),m=M(),U&&U.c(),g=M(),h&&h.c(),N(l,"class","search-button svelte-bz0zu3"),N(l,"type","button"),N(s,"placeholder",r[8]),N(s,"aria-label",r[8]),N(s,"class","svelte-bz0zu3"),N(u,"type","button"),N(u,"title",r[3]),N(u,"class","svelte-bz0zu3"),N(f,"class","clear-button-container svelte-bz0zu3"),gt(f,"displayable",r[1]!==""),N(t,"class","input-group svelte-bz0zu3"),N(n,"tabindex","0"),N(n,"class",w=Ml(r[2])+" svelte-bz0zu3"),gt(n,"can-collapse",r[4]&&r[1]==="")},m(G,Z){b(G,e,Z),b(G,n,Z),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),r[63](s),ze(s,r[1]),p(t,a),p(t,f),p(f,u),I(c,u,null),p(f,_),A&&A.m(f,null),p(t,d),j&&j.m(t,null),p(t,m),U&&U.m(t,null),p(n,g),~y&&B[y].m(n,null),C=!0,L||(F=[K(l,"click",r[62]),K(s,"input",r[64]),K(s,"focus",r[65]),K(s,"blur",r[66]),K(s,"keydown",r[22]),K(s,"input",r[67]),K(u,"click",r[68]),K(n,"submit",Zi(r[21]))],L=!0)},p(G,Z){(!C||Z[0]&256)&&N(s,"placeholder",G[8]),(!C||Z[0]&256)&&N(s,"aria-label",G[8]),Z[0]&2&&s.value!==G[1]&&ze(s,G[1]),(!C||Z[0]&8)&&N(u,"title",G[3]),G[19]?A?Z[0]&524288&&v(A,1):(A=mo(),A.c(),v(A,1),A.m(f,null)):A&&(he(),S(A,1,1,()=>{A=null}),be()),(!C||Z[0]&2)&&gt(f,"displayable",G[1]!==""),G[5]==="button"?j?(j.p(G,Z),Z[0]&32&&v(j,1)):(j=po(G),j.c(),v(j,1),j.m(t,m)):j&&(he(),S(j,1,1,()=>{j=null}),be()),U&&U.p&&(!C||Z[1]&536870912)&&De(U,O,G,G[60],C?He(O,G[60],Z,null):Ue(G[60]),null);let Y=y;y=H(G),y===Y?~y&&B[y].p(G,Z):(h&&(he(),S(B[Y],1,1,()=>{B[Y]=null}),be()),~y?(h=B[y],h?h.p(G,Z):(h=B[y]=R[y](G),h.c()),v(h,1),h.m(n,null)):h=null),(!C||Z[0]&4&&w!==(w=Ml(G[2])+" svelte-bz0zu3"))&&N(n,"class",w),(!C||Z[0]&22)&&gt(n,"can-collapse",G[4]&&G[1]==="")},i(G){C||(v(T),v(o.$$.fragment,G),v(c.$$.fragment,G),v(A),v(j),v(U,G),v(h),C=!0)},o(G){S(T),S(o.$$.fragment,G),S(c.$$.fragment,G),S(A),S(j),S(U,G),S(h),C=!1},d(G){G&&($(e),$(n)),E(o),r[63](null),E(c),A&&A.d(),j&&j.d(),U&&U.d(G),~y&&B[y].d(),L=!1,nt(F)}}}function Ac(r,e,n){let t,l,{$$slots:o={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:f}=e,{bbox:u=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:m=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:y="never"}=e,{errorMessage:h="Something went wrong…"}=e,{filter:w=()=>!0}=e,{flyTo:C=!0}=e,{fuzzyMatch:L=!0}=e,{language:F=void 0}=e,{limit:T=void 0}=e,{mapController:A=void 0}=e,{minLength:j=2}=e,{noResultsMessage:O="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:U="Search"}=e,{proximity:R=[{type:"server-geolocation"}]}=e,{reverseActive:B=y==="always"}=e,{reverseButtonTitle:H="toggle reverse geocoding"}=e,{searchValue:G=""}=e,{pickedResultStyle:Z="full-geometry"}=e,{showPlaceType:Y="if-needed"}=e,{showResultsWhileTyping:ie=!0}=e,{selectFirst:D=!0}=e,{flyToSelected:ve=!1}=e,{markerOnSelected:ge=!0}=e,{types:fe=void 0}=e,{exhaustiveReverseGeocoding:ye=!1}=e,{excludeTypes:ue=!1}=e,{zoom:Fe=s}=e,{apiUrl:Ze="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Te={}}=e,{iconsBaseUrl:re="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Je=()=>{}}=e;function Ne(){Be.focus()}function ke(){Be.blur()}function X(J,et=!0,ht=!1){n(1,G=J),et?(n(15,We=-1),Pt()):(jr(!ht,ht),setTimeout(()=>{Be.focus(),Be.select()}))}function me(){n(14,$e=void 0),n(56,W=void 0),n(15,We=-1)}function x(){n(55,Se=[]),n(56,W=void 0)}let pe=!1,$e,Se,W,_t="",Be,We=-1,kt,bt=[],Qe,xt,en,Ct;const or=new Set,Ft=mn();Tt(()=>{A&&(A.setEventHandler(void 0),A.indicateReverse(!1),A.setSelectedMarker(-1),A.setFeatures(void 0,void 0,!1))});function Pt(J){if(xt&&(clearTimeout(xt),xt=void 0),We>-1&&$e)n(56,W=$e[We]),n(1,G=W.place_type[0]==="reverse"?W.place_name:W.place_name.replace(/,.*/,"")),n(18,kt=void 0),n(55,Se=void 0),n(15,We=-1);else if(G){const et=J||!rt(G);Pe(G,{exact:!0}).then(()=>{n(55,Se=$e),n(56,W=void 0),et&&lt()}).catch(ht=>n(18,kt=ht))}}function rt(J){try{return ua(J,6)}catch{return!1}}async function Pe(J,{byId:et=!1,exact:ht=!1}={}){n(18,kt=void 0),Qe==null||Qe.abort();const It=new AbortController;n(19,Qe=It);try{const Ie=rt(J),mt=new URLSearchParams;if(F!==void 0&&mt.set("language",Array.isArray(F)?F.join(","):F??""),fe&&mt.set("types",fe.join(",")),ue&&mt.set("excludeTypes",String(ue)),u&&mt.set("bbox",u.map(ir=>ir.toFixed(6)).join(",")),m&&mt.set("country",Array.isArray(m)?m.join(","):m),!et&&!Ie){const ir=await kc(A,R,It);ir&&mt.set("proximity",ir),(ht||!ie)&&mt.set("autocomplete","false"),mt.set("fuzzyMatch",String(L))}T!==void 0&&(ye||!Ie||(fe==null?void 0:fe.length)===1)&&mt.set("limit",String(T)),mt.set("key",f),Je(mt);const Zt=Ze+"/"+encodeURIComponent(Ie?Ie.decimalLongitude+","+Ie.decimalLatitude:J)+".json?"+mt.toString();if(Zt===_t){et?(n(14,$e=void 0),n(56,W=bt[0])):n(14,$e=bt);return}_t=Zt;const Or=await fetch(Zt,{signal:It.signal,...Te});if(!Or.ok)throw new Error(await Or.text());const Br=await Or.json();Ft("response",{url:Zt,featureCollection:Br}),et?(n(14,$e=void 0),n(56,W=Br.features[0]),bt=[W]):(n(14,$e=Br.features.filter(w)),Ie&&$e.unshift({type:"Feature",properties:{},id:"reverse_"+Ie.decimalLongitude+"_"+Ie.decimalLatitude,text:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_name:Ie.decimalLatitude+", "+Ie.decimalLongitude,place_type:["reverse"],center:[Ie.decimalLongitude,Ie.decimalLatitude],bbox:[Ie.decimalLongitude,Ie.decimalLatitude,Ie.decimalLongitude,Ie.decimalLatitude],geometry:{type:"Point",coordinates:[Ie.decimalLongitude,Ie.decimalLatitude]}}),bt=$e,Ie&&Be.focus())}catch(Ie){if(Ie&&typeof Ie=="object"&&"name"in Ie&&Ie.name==="AbortError")return;throw Ie}finally{It===Qe&&n(19,Qe=void 0)}}function lt(){var It;if(!(Se!=null&&Se.length)||!C)return;const J=[180,90,-180,-90],et=!Se.some(Ie=>!Ie.matching_text);let ht;for(const Ie of Se){const mt=In(Ie);if(ht=ht===void 0?mt:mt===void 0?ht:Math.max(ht,mt),et||!Ie.matching_text)for(const Zt of[0,1,2,3])J[Zt]=Math[Zt<2?"min":"max"](J[Zt],((It=Ie.bbox)==null?void 0:It[Zt])??Ie.center[Zt%2])}A&&Se.length>0&&(W&&J[0]===J[2]&&J[1]===J[3]?A.flyTo(W.center,In(W)):A.fitBounds(co(J),50,ht))}function In(J){var ht;if(!J.bbox||J.bbox[0]!==J.bbox[2]&&J.bbox[1]!==J.bbox[3])return;const et=J.id.replace(/\..*/,"");return(Array.isArray((ht=J.properties)==null?void 0:ht.categories)?J.properties.categories.reduce((It,Ie)=>{const mt=Fe[et+"."+Ie];return It===void 0?mt:mt===void 0?It:Math.max(It,mt)},void 0):void 0)??Fe[et]}function Os(J){n(0,B=y==="always"),n(14,$e=void 0),n(56,W=void 0),n(15,We=-1),X(J[1].toFixed(6)+", "+wc(J[0],[-180,180],!0).toFixed(6),!1,!0)}function Bs(J){if(!$e)return;let et=J.key==="ArrowDown"?1:J.key==="ArrowUp"?-1:0;et&&(We===(D?0:-1)&&et===-1&&n(15,We=$e.length),n(15,We+=et),We>=$e.length&&n(15,We=-1),We<0&&D&&n(15,We=0),J.preventDefault())}function jr(J=!0,et=!1){if(n(18,kt=void 0),ie||et){if(xt&&clearTimeout(xt),G.length<j)return;const ht=G;xt=window.setTimeout(()=>{Pe(ht).catch(It=>n(18,kt=It))},J?g:0)}else n(14,$e=void 0),n(18,kt=void 0)}function zr(J){n(56,W=J),n(1,G=J.place_name),n(15,We=-1)}const Rs=()=>Be.focus();function Ds(J){Ge[J?"unshift":"push"](()=>{Be=J,n(17,Be)})}function Us(){G=this.value,n(1,G),n(13,pe),n(28,_)}const Hs=()=>n(13,pe=!0),Gs=()=>n(13,pe=!1),Ws=()=>jr(),qs=()=>{n(1,G=""),Be.focus()},Js=()=>n(0,B=!B),Ys=()=>n(18,kt=void 0),Zs=J=>n(15,We=J),Ks=J=>zr(J),Xs=()=>{D||n(15,We=-1)},Vs=()=>{};return r.$$set=J=>{"class"in J&&n(2,a=J.class),"apiKey"in J&&n(26,f=J.apiKey),"bbox"in J&&n(27,u=J.bbox),"clearButtonTitle"in J&&n(3,c=J.clearButtonTitle),"clearOnBlur"in J&&n(28,_=J.clearOnBlur),"collapsed"in J&&n(4,d=J.collapsed),"country"in J&&n(29,m=J.country),"debounceSearch"in J&&n(30,g=J.debounceSearch),"enableReverse"in J&&n(5,y=J.enableReverse),"errorMessage"in J&&n(6,h=J.errorMessage),"filter"in J&&n(31,w=J.filter),"flyTo"in J&&n(32,C=J.flyTo),"fuzzyMatch"in J&&n(33,L=J.fuzzyMatch),"language"in J&&n(34,F=J.language),"limit"in J&&n(35,T=J.limit),"mapController"in J&&n(36,A=J.mapController),"minLength"in J&&n(37,j=J.minLength),"noResultsMessage"in J&&n(7,O=J.noResultsMessage),"placeholder"in J&&n(8,U=J.placeholder),"proximity"in J&&n(38,R=J.proximity),"reverseActive"in J&&n(0,B=J.reverseActive),"reverseButtonTitle"in J&&n(9,H=J.reverseButtonTitle),"searchValue"in J&&n(1,G=J.searchValue),"pickedResultStyle"in J&&n(39,Z=J.pickedResultStyle),"showPlaceType"in J&&n(10,Y=J.showPlaceType),"showResultsWhileTyping"in J&&n(40,ie=J.showResultsWhileTyping),"selectFirst"in J&&n(11,D=J.selectFirst),"flyToSelected"in J&&n(41,ve=J.flyToSelected),"markerOnSelected"in J&&n(42,ge=J.markerOnSelected),"types"in J&&n(43,fe=J.types),"exhaustiveReverseGeocoding"in J&&n(44,ye=J.exhaustiveReverseGeocoding),"excludeTypes"in J&&n(45,ue=J.excludeTypes),"zoom"in J&&n(46,Fe=J.zoom),"apiUrl"in J&&n(47,Ze=J.apiUrl),"fetchParameters"in J&&n(48,Te=J.fetchParameters),"iconsBaseUrl"in J&&n(12,re=J.iconsBaseUrl),"adjustUrlQuery"in J&&n(49,Je=J.adjustUrlQuery),"$$scope"in J&&n(60,i=J.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&n(0,B=y==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{n(16,en=pe),_&&!pe&&n(1,G="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&G.length<j&&(n(56,W=void 0),n(14,$e=void 0),n(18,kt=void 0),n(55,Se=$e)),r.$$.dirty[1]&33554688&&Z!=="marker-only"&&W&&!W.address&&W.geometry.type==="Point"&&W.place_type[0]!=="reverse"&&Pe(W.id,{byId:!0}).catch(J=>n(18,kt=J)),r.$$.dirty[1]&100663330&&(A&&W&&W.id!==Ct&&C&&(!W.bbox||W.bbox[0]===W.bbox[2]&&W.bbox[1]===W.bbox[3]?A.flyTo(W.center,In(W)):A.fitBounds(co(W.bbox),50,In(W)),n(14,$e=void 0),n(55,Se=void 0),n(15,We=-1)),n(57,Ct=W==null?void 0:W.id)),r.$$.dirty[0]&18432&&D&&$e!=null&&$e.length&&n(15,We=0),r.$$.dirty[0]&2&&n(15,We=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Se!==$e&&n(55,Se=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&A&&A.setEventHandler(J=>{switch(J.type){case"mapClick":B&&Os(J.coordinates);break;case"markerClick":{const et=$e==null?void 0:$e.find(ht=>ht.id===J.id);et&&zr(et)}break;case"markerMouseEnter":Se&&n(15,We=en?($e==null?void 0:$e.findIndex(et=>et.id===J.id))??-1:-1);break;case"markerMouseLeave":Se&&n(15,We=-1);break}}),r.$$.dirty[0]&49152&&n(58,l=$e==null?void 0:$e[We]),r.$$.dirty[1]&134218786&&A&&l&&C&&ve&&A.flyTo(l.center,In(l)),r.$$.dirty[1]&256&&n(59,t=Z==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(ge||A==null||A.setFeatures(void 0,void 0,t)),r.$$.dirty[1]&419432480&&A&&ge&&!Se&&(A.setFeatures(l?[l]:void 0,void 0,t),A.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&A&&A.setFeatures(Se,W,t),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Se&&A&&A.setSelectedMarker(We),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&A){const J=rt(G);A.setReverseMarker(J?[J.decimalLongitude,J.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Ft("select",{feature:l}),r.$$.dirty[1]&33554432&&Ft("pick",{feature:W}),r.$$.dirty[0]&81920&&Ft("optionsvisibilitychange",{optionsVisible:en&&!!$e}),r.$$.dirty[0]&16384&&Ft("featureslisted",{features:$e}),r.$$.dirty[1]&16777216&&Ft("featuresmarked",{features:Se}),r.$$.dirty[0]&1&&Ft("reversetoggle",{reverse:B}),r.$$.dirty[0]&2&&Ft("querychange",{query:G}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&A&&A.indicateReverse(B)},[B,G,a,c,d,y,h,O,U,H,Y,D,re,pe,$e,We,en,Be,kt,Qe,or,Pt,Bs,jr,zr,s,f,u,_,m,g,w,C,L,F,T,A,j,R,Z,ie,ve,ge,fe,ye,ue,Fe,Ze,Te,Je,Ne,ke,X,me,x,Se,W,Ct,l,t,i,o,Rs,Ds,Us,Hs,Gs,Ws,qs,Js,Ys,Zs,Ks,Xs,Vs]}class Fc extends se{constructor(e){super(),ae(this,e,Ac,Tc,le,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function ho(r){let e,n,t;return n=new Fc({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=k("div"),P(n.$$.fragment),N(e,"class","svelte-ixhnie")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o&4&&(i.mapController=l[2]),o&1&&(i.apiKey=l[0]),o&2&&(i.country=l[1]),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function Pc(r){let e,n,t=r[2]&&ho(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,[o]){l[2]?t?(t.p(l,o),o&4&&v(t,1)):(t=ho(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function Ic(r,e,n){let t,{apiKey:l}=e,{map:o}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(f){return f?_a(f,Xt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=f=>{"apiKey"in f&&n(0,l=f.apiKey),"map"in f&&n(4,o=f.map),"country"in f&&n(1,i=f.country)},r.$$.update=()=>{r.$$.dirty&16&&n(2,t=a(o))},[l,i,t,s,o]}class Ec extends se{constructor(e){super(),ae(this,e,Ic,Pc,le,{apiKey:0,map:4,country:1})}}function Gt(r,e,n){let t=["match",r];for(let[l,o]of Object.entries(e))t.push(l),t.push(o);return t.push(n),t}function Nt(r,e,n){let t=["step",r];for(let l=1;l<e.length;l++)t.push(n[l-1]),t.push(e[l]);return t.push(n[n.length-1]),t}function rn(){return{type:"FeatureCollection",features:[]}}function bo(r){let e,n,t,l,o;return n=new kn({props:{colorScale:r[3].colorScale,limits:r[3].limits}}),l=new jt({props:{$$slots:{default:[Nc]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment)},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function Nc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function $o(r){let e,n,t,l,o;return n=new Mr({props:{colors:r[4],horiz:!0}}),l=new jt({props:{$$slots:{default:[jc]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment)},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function jc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function vo(r){let e,n,t,l,o;return n=new Mr({props:{colors:r[5],horiz:!0}}),l=new jt({props:{$$slots:{default:[zc]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment)},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s&512&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function zc(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#infrastructureandtraffic"),N(e,"target","_blank")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function Oc(r){let e,n,t,l,o,i;const s=[we("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Gt(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":an(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new tt({props:a});const f=[we("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Gt(["get","Level of Service"],r[4],"cyan"),"line-width":an(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new tt({props:u});const c=[we("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Gt(["get","Infrastructure type"],r[5],"cyan"),"line-width":an(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return o=new tt({props:_}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment)},m(d,m){I(e,d,m),b(d,n,m),I(t,d,m),b(d,l,m),I(o,d,m),i=!0},p(d,m){const g=m&9?Oe(s,[s[0],s[1],s[2],m&8&&{paint:{"line-color":Gt(["get","Traffic volume category"],{"0 to 1999":d[3].colorScale[0],"2000 to 3999":d[3].colorScale[1],"4000+":d[3].colorScale[2]},"cyan"),"line-width":an(0)}},m&1&&{layout:{visibility:d[0]?"visible":"none"}}]):{};e.$set(g);const y=m&18?Oe(f,[f[0],f[1],m&16&&{paint:{"line-color":Gt(["get","Level of Service"],d[4],"cyan"),"line-width":an(1)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};t.$set(y);const h=m&36?Oe(c,[c[0],c[1],c[2],m&32&&{paint:{"line-color":Gt(["get","Infrastructure type"],d[5],"cyan"),"line-width":an(1)}},m&4&&{layout:{visibility:d[2]?"visible":"none"}}]):{};o.$set(h)},i(d){i||(v(e.$$.fragment,d),v(t.$$.fragment,d),v(o.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),i=!1},d(d){d&&($(n),$(l)),E(e,d),E(t,d),E(o,d)}}}function Bc(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m=r[0]&&bo(r),g=r[1]&&$o(r),y=r[2]&&vo(r);return u=new er({props:{url:`pmtiles://${St("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[Oc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Traffic",n=M(),m&&m.c(),t=M(),l=k("button"),l.textContent="Level of Service",o=M(),g&&g.c(),i=M(),s=k("button"),s.textContent="Existing cycle infrastructure",a=M(),y&&y.c(),f=M(),P(u.$$.fragment),N(e,"class","secondary"),N(l,"class","secondary"),N(s,"class","secondary")},m(h,w){b(h,e,w),b(h,n,w),m&&m.m(h,w),b(h,t,w),b(h,l,w),b(h,o,w),g&&g.m(h,w),b(h,i,w),b(h,s,w),b(h,a,w),y&&y.m(h,w),b(h,f,w),I(u,h,w),c=!0,_||(d=[K(e,"click",r[6]),K(l,"click",r[7]),K(s,"click",r[8])],_=!0)},p(h,[w]){h[0]?m?(m.p(h,w),w&1&&v(m,1)):(m=bo(h),m.c(),v(m,1),m.m(t.parentNode,t)):m&&(he(),S(m,1,1,()=>{m=null}),be()),h[1]?g?(g.p(h,w),w&2&&v(g,1)):(g=$o(h),g.c(),v(g,1),g.m(i.parentNode,i)):g&&(he(),S(g,1,1,()=>{g=null}),be()),h[2]?y?(y.p(h,w),w&4&&v(y,1)):(y=vo(h),y.c(),v(y,1),y.m(f.parentNode,f)):y&&(he(),S(y,1,1,()=>{y=null}),be());const C={};w&519&&(C.$$scope={dirty:w,ctx:h}),u.$set(C)},i(h){c||(v(m),v(g),v(y),v(u.$$.fragment,h),c=!0)},o(h){S(m),S(g),S(y),S(u.$$.fragment,h),c=!1},d(h){h&&($(e),$(n),$(t),$(l),$(o),$(i),$(s),$(a),$(f)),m&&m.d(h),g&&g.d(h),y&&y.d(h),E(u,h),_=!1,nt(d)}}}function Rc(r,e,n){let t=!1,l=!1,o=!1;return[t,l,o,{colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},{High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},{"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"},()=>n(0,t=!t),()=>n(1,l=!l),()=>n(2,o=!o)]}class Dc extends se{constructor(e){super(),ae(this,e,Rc,Bc,le,{})}}function yo(r){let e,n,t,l,o;return n=new Mr({props:{colors:r[1],horiz:!0}}),l=new jt({props:{$$slots:{default:[Uc]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment)},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function Uc(r){let e;return{c(){e=k("p"),e.innerHTML=`See Scottish data sources for <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
        ,
        <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
        , and
        <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
        .`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function Hc(r){let e=r[3].name+"",n;return{c(){n=z(e)},m(t,l){b(t,n,l)},p(t,l){l&8&&e!==(e=t[3].name+"")&&ne(n,e)},d(t){t&&$(n)}}}function Gc(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Hc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Wc(r){let e,n;const t=[we("context-gp-practices"),{paint:{"circle-color":r[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Gc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&3?Oe(t,[t[0],i&2&&{paint:{"circle-color":o[1].GPs,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function qc(r){let e=r[3].name+"",n;return{c(){n=z(e)},m(t,l){b(t,n,l)},p(t,l){l&8&&e!==(e=t[3].name+"")&&ne(n,e)},d(t){t&&$(n)}}}function Jc(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[qc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Yc(r){let e,n;const t=[we("context-hospitals"),{paint:{"circle-color":r[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Jc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&3?Oe(t,[t[0],i&2&&{paint:{"circle-color":o[1].Hospitals,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Zc(r){let e=r[3].name+"",n,t,l=r[3].pupils+"",o,i;return{c(){n=z(e),t=z(" with "),o=z(l),i=z(" pupils")},m(s,a){b(s,n,a),b(s,t,a),b(s,o,a),b(s,i,a)},p(s,a){a&8&&e!==(e=s[3].name+"")&&ne(n,e),a&8&&l!==(l=s[3].pupils+"")&&ne(o,l)},d(s){s&&($(n),$(t),$(o),$(i))}}}function Kc(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Zc,({props:t})=>({3:t}),({props:t})=>t?8:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&24&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Xc(r){let e,n;const t=[we("context-schools"),{paint:{"circle-color":r[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[Kc]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&3?Oe(t,[t[0],i&2&&{paint:{"circle-color":o[1].Schools,"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},i&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};i&16&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Vc(r){let e,n,t,l,o,i,s,a,f,u,c,_=r[0]&&yo(r);return l=new Ve({props:{data:St("cnt_layers/gp_practices.geojson"),generateId:!0,$$slots:{default:[Wc]},$$scope:{ctx:r}}}),i=new Ve({props:{data:St("cnt_layers/hospitals.geojson"),generateId:!0,$$slots:{default:[Yc]},$$scope:{ctx:r}}}),a=new Ve({props:{data:St("cnt_layers/schools.geojson"),generateId:!0,$$slots:{default:[Xc]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="POIs",n=M(),_&&_.c(),t=M(),P(l.$$.fragment),o=M(),P(i.$$.fragment),s=M(),P(a.$$.fragment),N(e,"class","secondary")},m(d,m){b(d,e,m),b(d,n,m),_&&_.m(d,m),b(d,t,m),I(l,d,m),b(d,o,m),I(i,d,m),b(d,s,m),I(a,d,m),f=!0,u||(c=K(e,"click",r[2]),u=!0)},p(d,[m]){d[0]?_?(_.p(d,m),m&1&&v(_,1)):(_=yo(d),_.c(),v(_,1),_.m(t.parentNode,t)):_&&(he(),S(_,1,1,()=>{_=null}),be());const g={};m&17&&(g.$$scope={dirty:m,ctx:d}),l.$set(g);const y={};m&17&&(y.$$scope={dirty:m,ctx:d}),i.$set(y);const h={};m&17&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){f||(v(_),v(l.$$.fragment,d),v(i.$$.fragment,d),v(a.$$.fragment,d),f=!0)},o(d){S(_),S(l.$$.fragment,d),S(i.$$.fragment,d),S(a.$$.fragment,d),f=!1},d(d){d&&($(e),$(n),$(t),$(o),$(s)),_&&_.d(d),E(l,d),E(i,d),E(a,d),u=!1,c()}}}function Qc(r,e,n){let t=!1;return[t,{Schools:"#7fc97f",GPs:"#beaed4",Hospitals:"#fdc086"},()=>n(0,t=!t)]}class xc extends se{constructor(e){super(),ae(this,e,Qc,Vc,le,{})}}let $s=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],vs=[20,30,40,50,60,70],ln=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],tr=[0,20,40,60,80,100];const $n={mapFeature:{hover:{backgroundColor:"blue"}}};let dr=["#CDE594","#80C6A3","#1F9EB7","#186290","#080C54"],kl=[0,.3,.6,1,1.5,2];function wo(r){let e,n,t,l,o,i;return e=new kn({props:{colorScale:ln,limits:tr}}),o=new jt({props:{$$slots:{default:[ed]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment),n=M(),t=k("p"),t.textContent="Darker colours are more deprived",l=M(),P(o.$$.fragment)},m(s,a){I(e,s,a),b(s,n,a),b(s,t,a),b(s,l,a),I(o,s,a),i=!0},i(s){i||(v(e.$$.fragment,s),v(o.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(o.$$.fragment,s),i=!1},d(s){s&&($(n),$(t),$(l)),E(e,s),E(o,s)}}}function ed(r){let e;return{c(){e=k("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      . SIMD combines different domains: income; employment; health; education, skills
      and training; geographic access to services; crime; and housing.`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function ko(r){let e,n,t,l,o,i;return e=new kn({props:{colorScale:r[2],limits:r[3]}}),o=new jt({props:{$$slots:{default:[td]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment),n=M(),t=k("p"),t.textContent="Darker colours are denser",l=M(),P(o.$$.fragment)},m(s,a){I(e,s,a),b(s,n,a),b(s,t,a),b(s,l,a),I(o,s,a),i=!0},p(s,a){const f={};a&128&&(f.$$scope={dirty:a,ctx:s}),o.$set(f)},i(s){i||(v(e.$$.fragment,s),v(o.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(o.$$.fragment,s),i=!1},d(s){s&&($(n),$(t),$(l)),E(e,s),E(o,s)}}}function td(r){let e;return{c(){e=k("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
      .`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function nd(r){let e,n,t=r[6].id+"",l,o,i=r[6].population.toLocaleString()+"",s,a,f=r[6].imd_rank+"",u,c,_=r[6].imd_percentile+"",d,m;return{c(){e=k("p"),n=z("Data zone "),l=z(t),o=z(`
        has `),s=z(i),a=z(`
        people, and a SIMD rank of `),u=z(f),c=z(", putting it in the "),d=z(_),m=z(`
        percentile.`)},m(g,y){b(g,e,y),p(e,n),p(e,l),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c),p(e,d),p(e,m)},p(g,y){y&64&&t!==(t=g[6].id+"")&&ne(l,t),y&64&&i!==(i=g[6].population.toLocaleString()+"")&&ne(s,i),y&64&&f!==(f=g[6].imd_rank+"")&&ne(u,f),y&64&&_!==(_=g[6].imd_percentile+"")&&ne(d,_)},d(g){g&&$(e)}}}function rd(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[nd,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ld(r){let e,n,t=r[6].id+"",l,o,i=r[6].population.toLocaleString()+"",s,a,f=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",u,c;return{c(){e=k("p"),n=z("Data zone "),l=z(t),o=z(`
        has `),s=z(i),a=z(`
        people, with a density of `),u=z(f),c=z(" people per square kilometer")},m(_,d){b(_,e,d),p(e,n),p(e,l),p(e,o),p(e,s),p(e,a),p(e,u),p(e,c)},p(_,d){d&64&&t!==(t=_[6].id+"")&&ne(l,t),d&64&&i!==(i=_[6].population.toLocaleString()+"")&&ne(s,i),d&64&&f!==(f=Math.round(_[6].population/(_[6].area/1e6)).toLocaleString()+"")&&ne(u,f)},d(_){_&&$(e)}}}function od(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[ld,({props:t})=>({6:t}),({props:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function id(r){let e,n,t,l,o,i;const s=[we("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Nt(["get","imd_percentile"],tr,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let a={$$slots:{default:[rd]},$$scope:{ctx:r}};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new wt({props:a});const f=[we("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Nt(["/",["get","population"],["/",["get","area"],1e6]],r[3],r[2]),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let u={$$slots:{default:[od]},$$scope:{ctx:r}};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new wt({props:u});const c=[we("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]?"visible":"none"}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return o=new tt({props:_}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment)},m(d,m){I(e,d,m),b(d,n,m),I(t,d,m),b(d,l,m),I(o,d,m),i=!0},p(d,m){const g=m&1?Oe(s,[s[0],s[1],s[2],s[3],{layout:{visibility:d[0]?"visible":"none"}}]):{};m&128&&(g.$$scope={dirty:m,ctx:d}),e.$set(g);const y=m&14?Oe(f,[f[0],f[1],f[2],m&12&&{paint:{"fill-color":Nt(["/",["get","population"],["/",["get","area"],1e6]],d[3],d[2]),"fill-opacity":at(.7,.9)}},m&2&&{layout:{visibility:d[1]?"visible":"none"}}]):{};m&128&&(y.$$scope={dirty:m,ctx:d}),t.$set(y);const h=m&3?Oe(c,[c[0],c[1],c[2],{layout:{visibility:d[0]||d[1]?"visible":"none"}}]):{};o.$set(h)},i(d){i||(v(e.$$.fragment,d),v(t.$$.fragment,d),v(o.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),i=!1},d(d){d&&($(n),$(l)),E(e,d),E(t,d),E(o,d)}}}function sd(r){let e,n,t,l,o,i,s,a,f,u,c=r[0]&&wo(r),_=r[1]&&ko(r);return s=new er({props:{url:`pmtiles://${St("cnt_layers/population.pmtiles")}`,$$slots:{default:[id]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="SIMD",n=M(),c&&c.c(),t=M(),l=k("button"),l.textContent="Population density",o=M(),_&&_.c(),i=M(),P(s.$$.fragment),N(e,"class","secondary"),N(l,"class","secondary")},m(d,m){b(d,e,m),b(d,n,m),c&&c.m(d,m),b(d,t,m),b(d,l,m),b(d,o,m),_&&_.m(d,m),b(d,i,m),I(s,d,m),a=!0,f||(u=[K(e,"click",r[4]),K(l,"click",r[5])],f=!0)},p(d,[m]){d[0]?c?m&1&&v(c,1):(c=wo(d),c.c(),v(c,1),c.m(t.parentNode,t)):c&&(he(),S(c,1,1,()=>{c=null}),be()),d[1]?_?(_.p(d,m),m&2&&v(_,1)):(_=ko(d),_.c(),v(_,1),_.m(i.parentNode,i)):_&&(he(),S(_,1,1,()=>{_=null}),be());const g={};m&131&&(g.$$scope={dirty:m,ctx:d}),s.$set(g)},i(d){a||(v(c),v(_),v(s.$$.fragment,d),a=!0)},o(d){S(c),S(_),S(s.$$.fragment,d),a=!1},d(d){d&&($(e),$(n),$(t),$(l),$(o),$(i)),c&&c.d(d),_&&_.d(d),E(s,d),f=!1,nt(u)}}}function ad(r,e,n){let t=!1,l=!1,o=ln.toReversed();return[t,l,o,[0,4700,13e3,33e3,94e3,198e4],()=>n(0,t=!t),()=>n(1,l=!l)]}class fd extends se{constructor(e){super(),ae(this,e,ad,sd,le,{})}}function So(r){let e,n,t,l,o,i;return o=new jt({props:{$$slots:{default:[ud]},$$scope:{ctx:r}}}),{c(){e=k("div"),n=k("img"),l=M(),P(o.$$.fragment),Ke(n.src,t=Qi)||N(n,"src",t),N(n,"alt","National Rail logo")},m(s,a){b(s,e,a),p(e,n),p(e,l),I(o,e,null),i=!0},i(s){i||(v(o.$$.fragment,s),i=!0)},o(s){S(o.$$.fragment,s),i=!1},d(s){s&&$(e),E(o)}}}function ud(r){let e;return{c(){e=k("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
        according to OpenStreetMap.`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function cd(r){let e,n=(r[2].name??"Unnamed railway station")+"",t;return{c(){e=k("p"),t=z(n)},m(l,o){b(l,e,o),p(e,t)},p(l,o){o&4&&n!==(n=(l[2].name??"Unnamed railway station")+"")&&ne(t,n)},d(l){l&&$(e)}}}function dd(r){let e,n;return e=new dt({props:{$$slots:{default:[cd,({props:t})=>({2:t}),({props:t})=>t?4:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&12&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function _d(r){let e,n;const t=[we("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let l={$$slots:{default:[dd]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new kr({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&1?Oe(t,[t[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function md(r){let e,n,t,l,o,i,s,a=r[0]&&So(r);return l=new Ve({props:{data:St("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[_d]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Railway stations",n=M(),a&&a.c(),t=M(),P(l.$$.fragment),N(e,"class","secondary")},m(f,u){b(f,e,u),b(f,n,u),a&&a.m(f,u),b(f,t,u),I(l,f,u),o=!0,i||(s=K(e,"click",r[1]),i=!0)},p(f,[u]){f[0]?a?u&1&&v(a,1):(a=So(f),a.c(),v(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u&9&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(v(a),v(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),E(l,f),i=!1,s()}}}function pd(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class gd extends se{constructor(e){super(),ae(this,e,pd,md,le,{})}}function Co(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Lo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Mo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function To(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Ao(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Fo(r,e,n){const t=r.slice();return t[18]=e[n][0],t[19]=e[n][1],t}function Po(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,w,C,L;e=new jt({props:{$$slots:{default:[hd]},$$scope:{ctx:r}}});let F=Me(r[7]),T=[];for(let H=0;H<F.length;H+=1)T[H]=Io(Fo(r,F,H));let A=Me(r[8]),j=[];for(let H=0;H<A.length;H+=1)j[H]=Eo(Ao(r,A,H));let O=Me(r[9]),U=[];for(let H=0;H<O.length;H+=1)U[H]=No(To(r,O,H));let R=Me(r[10]),B=[];for(let H=0;H<R.length;H+=1)B[H]=jo(Mo(r,R,H));return{c(){P(e.$$.fragment),n=M(),t=k("label"),l=z(`Trip purpose:
    `),o=k("select");for(let H=0;H<T.length;H+=1)T[H].c();i=M(),s=k("label"),a=z(`Scenario:
    `),f=k("select");for(let H=0;H<j.length;H+=1)j[H].c();u=M(),c=k("label"),_=z(`Network type:
    `),d=k("select");for(let H=0;H<U.length;H+=1)U[H].c();m=M(),g=k("label"),y=z(`Color by:
    `),h=k("select");for(let H=0;H<B.length;H+=1)B[H].c();r[0]===void 0&&fn(()=>r[12].call(o)),r[1]===void 0&&fn(()=>r[13].call(f)),r[2]===void 0&&fn(()=>r[14].call(d)),r[3]===void 0&&fn(()=>r[15].call(h))},m(H,G){I(e,H,G),b(H,n,G),b(H,t,G),p(t,l),p(t,o);for(let Z=0;Z<T.length;Z+=1)T[Z]&&T[Z].m(o,null);yt(o,r[0],!0),b(H,i,G),b(H,s,G),p(s,a),p(s,f);for(let Z=0;Z<j.length;Z+=1)j[Z]&&j[Z].m(f,null);yt(f,r[1],!0),b(H,u,G),b(H,c,G),p(c,_),p(c,d);for(let Z=0;Z<U.length;Z+=1)U[Z]&&U[Z].m(d,null);yt(d,r[2],!0),b(H,m,G),b(H,g,G),p(g,y),p(g,h);for(let Z=0;Z<B.length;Z+=1)B[Z]&&B[Z].m(h,null);yt(h,r[3],!0),w=!0,C||(L=[K(o,"change",r[12]),K(f,"change",r[13]),K(d,"change",r[14]),K(h,"change",r[15])],C=!0)},p(H,G){const Z={};if(G[1]&2&&(Z.$$scope={dirty:G,ctx:H}),e.$set(Z),G[0]&128){F=Me(H[7]);let Y;for(Y=0;Y<F.length;Y+=1){const ie=Fo(H,F,Y);T[Y]?T[Y].p(ie,G):(T[Y]=Io(ie),T[Y].c(),T[Y].m(o,null))}for(;Y<T.length;Y+=1)T[Y].d(1);T.length=F.length}if(G[0]&129&&yt(o,H[0]),G[0]&256){A=Me(H[8]);let Y;for(Y=0;Y<A.length;Y+=1){const ie=Ao(H,A,Y);j[Y]?j[Y].p(ie,G):(j[Y]=Eo(ie),j[Y].c(),j[Y].m(f,null))}for(;Y<j.length;Y+=1)j[Y].d(1);j.length=A.length}if(G[0]&258&&yt(f,H[1]),G[0]&512){O=Me(H[9]);let Y;for(Y=0;Y<O.length;Y+=1){const ie=To(H,O,Y);U[Y]?U[Y].p(ie,G):(U[Y]=No(ie),U[Y].c(),U[Y].m(d,null))}for(;Y<U.length;Y+=1)U[Y].d(1);U.length=O.length}if(G[0]&516&&yt(d,H[2]),G[0]&1024){R=Me(H[10]);let Y;for(Y=0;Y<R.length;Y+=1){const ie=Mo(H,R,Y);B[Y]?B[Y].p(ie,G):(B[Y]=jo(ie),B[Y].c(),B[Y].m(h,null))}for(;Y<B.length;Y+=1)B[Y].d(1);B.length=R.length}G[0]&1032&&yt(h,H[3])},i(H){w||(v(e.$$.fragment,H),w=!0)},o(H){S(e.$$.fragment,H),w=!1},d(H){H&&($(n),$(t),$(i),$(s),$(u),$(c),$(m),$(g)),E(e,H),st(T,H),st(j,H),st(U,H),st(B,H),C=!1,nt(L)}}}function hd(r){let e;return{c(){e=k("a"),e.textContent="Data from NPT",N(e,"href","https://nptscot.github.io/manual/#routenetwork"),N(e,"target","_blank")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function Io(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=z(n),e.__value=r[18],ze(e,e.__value)},m(l,o){b(l,e,o),p(e,t)},p:Q,d(l){l&&$(e)}}}function Eo(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=z(n),e.__value=r[18],ze(e,e.__value)},m(l,o){b(l,e,o),p(e,t)},p:Q,d(l){l&&$(e)}}}function No(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=z(n),e.__value=r[18],ze(e,e.__value)},m(l,o){b(l,e,o),p(e,t)},p:Q,d(l){l&&$(e)}}}function jo(r){let e,n=r[19]+"",t;return{c(){e=k("option"),t=z(n),e.__value=r[18],ze(e,e.__value)},m(l,o){b(l,e,o),p(e,t)},p:Q,d(l){l&&$(e)}}}function zo(r){let e,n,t,l,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=k("tr"),n=k("th"),n.textContent=`${r[19]}`,t=M(),l=k("td"),i=z(o),s=M(),a=k("td"),u=z(f),c=M(),_=k("td"),m=z(d),g=M()},m(y,h){b(y,e,h),p(e,n),p(e,t),p(e,l),p(l,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(y,h){h[0]&131072&&o!==(o=y[17][`${y[18]}_fastest_bicycle`].toLocaleString()+"")&&ne(i,o),h[0]&131072&&f!==(f=y[17][`${y[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&ne(u,f),h[0]&131072&&d!==(d=y[17][`${y[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&ne(m,d)},d(y){y&&$(e)}}}function Oo(r){let e,n,t,l,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",i,s,a,f=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",u,c,_,d=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",m,g;return{c(){e=k("tr"),n=k("th"),n.textContent=`${r[19]}`,t=M(),l=k("td"),i=z(o),s=M(),a=k("td"),u=z(f),c=M(),_=k("td"),m=z(d),g=M()},m(y,h){b(y,e,h),p(e,n),p(e,t),p(e,l),p(l,i),p(e,s),p(e,a),p(a,u),p(e,c),p(e,_),p(_,m),p(e,g)},p(y,h){h[0]&131072&&o!==(o=y[17][`${y[18]}_quietest_bicycle`].toLocaleString()+"")&&ne(i,o),h[0]&131072&&f!==(f=y[17][`${y[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&ne(u,f),h[0]&131072&&d!==(d=y[17][`${y[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&ne(m,d)},d(y){y&&$(e)}}}function bd(r){let e,n,t,l=r[17][r[4]].toLocaleString()+"",o,i,s,a,f=r[17].gradient+"",u,c,_,d,m,g=r[17].quietness+"",y,h,w,C,L,F,T,A,j,O,U,R,B,H,G,Z,Y,ie=Me(r[7]),D=[];for(let fe=0;fe<ie.length;fe+=1)D[fe]=zo(Lo(r,ie,fe));let ve=Me(r[7]),ge=[];for(let fe=0;fe<ve.length;fe+=1)ge[fe]=Oo(Co(r,ve,fe));return{c(){e=k("div"),n=k("p"),t=z("Cyclists: "),o=z(l),i=M(),s=k("p"),a=z("Gradient: "),u=z(f),c=z("%"),_=M(),d=k("p"),m=z("Cycle-friendliness: "),y=z(g),h=z("%"),w=M(),C=k("details"),L=k("summary"),L.textContent="All network details",F=M(),T=k("p"),T.textContent="Fast/Direct network",A=M(),j=k("table"),O=k("tr"),O.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",U=M();for(let fe=0;fe<D.length;fe+=1)D[fe].c();R=M(),B=k("p"),B.textContent="Quiet/Indirect network",H=M(),G=k("table"),Z=k("tr"),Z.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Y=M();for(let fe=0;fe<ge.length;fe+=1)ge[fe].c();oe(e,"max-width","30vw"),oe(e,"max-height","60vh"),oe(e,"overflow","auto")},m(fe,ye){b(fe,e,ye),p(e,n),p(n,t),p(n,o),p(e,i),p(e,s),p(s,a),p(s,u),p(s,c),p(e,_),p(e,d),p(d,m),p(d,y),p(d,h),p(e,w),p(e,C),p(C,L),p(C,F),p(C,T),p(C,A),p(C,j),p(j,O),p(j,U);for(let ue=0;ue<D.length;ue+=1)D[ue]&&D[ue].m(j,null);p(C,R),p(C,B),p(C,H),p(C,G),p(G,Z),p(G,Y);for(let ue=0;ue<ge.length;ue+=1)ge[ue]&&ge[ue].m(G,null)},p(fe,ye){if(ye[0]&131088&&l!==(l=fe[17][fe[4]].toLocaleString()+"")&&ne(o,l),ye[0]&131072&&f!==(f=fe[17].gradient+"")&&ne(u,f),ye[0]&131072&&g!==(g=fe[17].quietness+"")&&ne(y,g),ye[0]&131200){ie=Me(fe[7]);let ue;for(ue=0;ue<ie.length;ue+=1){const Fe=Lo(fe,ie,ue);D[ue]?D[ue].p(Fe,ye):(D[ue]=zo(Fe),D[ue].c(),D[ue].m(j,null))}for(;ue<D.length;ue+=1)D[ue].d(1);D.length=ie.length}if(ye[0]&131200){ve=Me(fe[7]);let ue;for(ue=0;ue<ve.length;ue+=1){const Fe=Co(fe,ve,ue);ge[ue]?ge[ue].p(Fe,ye):(ge[ue]=Oo(Fe),ge[ue].c(),ge[ue].m(G,null))}for(;ue<ge.length;ue+=1)ge[ue].d(1);ge.length=ve.length}},d(fe){fe&&$(e),st(D,fe),st(ge,fe)}}}function $d(r){let e,n;return e=new dt({props:{openOn:"click",$$slots:{default:[bd,({props:t})=>({17:t}),({props:t})=>[t?131072:0]]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l[0]&131088|l[1]&2&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function vd(r){let e,n;const t=[we("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Bo(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[$d]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i[0]&112?Oe(t,[t[0],t[1],i[0]&80&&{paint:{"line-color":o[6],"line-width":Bo(["get",o[4]])}},i[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},t[4]]):{};i[0]&16|i[1]&2&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function yd(r){let e,n,t,l,o,i,s,a=r[5]&&Po(r);return l=new er({props:{url:`pmtiles://${St("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[vd]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Route network",n=M(),a&&a.c(),t=M(),P(l.$$.fragment),N(e,"class","secondary")},m(f,u){b(f,e,u),b(f,n,u),a&&a.m(f,u),b(f,t,u),I(l,f,u),o=!0,i||(s=K(e,"click",r[11]),i=!0)},p(f,u){f[5]?a?(a.p(f,u),u[0]&32&&v(a,1)):(a=Po(f),a.c(),v(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u[0]&112|u[1]&2&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(v(a),v(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),E(l,f),i=!1,s()}}}function Bo(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function wd(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function kd(r,e,n){let t,l,o=!1,i="all",s="bicycle_go_dutch",a="fastest",f="flow",u=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],c=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],_=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],d=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],m={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};const g=()=>n(5,o=!o);function y(){i=un(this),n(0,i),n(7,u)}function h(){s=un(this),n(1,s),n(8,c)}function w(){a=un(this),n(2,a),n(9,_)}function C(){f=un(this),n(3,f),n(10,d)}return r.$$.update=()=>{r.$$.dirty[0]&7&&n(4,t=`${i}_${a}_${s}`),r.$$.dirty[0]&24&&n(6,l={none:"#304ce7",flow:wd(["get",t]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Nt(["abs",["get","gradient"]],m.limits,m.colorScale)}[f])},[i,s,a,f,t,o,l,u,c,_,d,g,y,h,w,C]}class Sd extends se{constructor(e){super(),ae(this,e,kd,yd,le,{},null,[-1,-1])}}function Ro(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,w,C,L,F;return e=new jt({props:{$$slots:{default:[Cd]},$$scope:{ctx:r}}}),w=new Mr({props:{colors:r[6],horiz:!0}}),{c(){P(e.$$.fragment),n=M(),t=k("fieldset"),l=k("label"),o=k("input"),i=z(`
      Pedestrians`),s=M(),a=k("label"),f=k("input"),u=z(`
      Cyclists`),c=M(),_=k("div"),d=z(`Filter years:
    `),m=k("input"),g=z(`
    -
    `),y=k("input"),h=M(),P(w.$$.fragment),N(o,"type","checkbox"),N(o,"class","svelte-1ft65rw"),N(f,"type","checkbox"),N(f,"class","svelte-1ft65rw"),N(m,"type","number"),N(m,"min",2017),N(m,"max",2023),N(m,"class","svelte-1ft65rw"),N(y,"type","number"),N(y,"min",2017),N(y,"max",2023),N(y,"class","svelte-1ft65rw")},m(T,A){I(e,T,A),b(T,n,A),b(T,t,A),p(t,l),p(l,o),o.checked=r[1].pedestrians,p(l,i),p(t,s),p(t,a),p(a,f),f.checked=r[1].cyclists,p(a,u),b(T,c,A),b(T,_,A),p(_,d),p(_,m),ze(m,r[1].minYear),p(_,g),p(_,y),ze(y,r[1].maxYear),b(T,h,A),I(w,T,A),C=!0,L||(F=[K(o,"change",r[8]),K(f,"change",r[9]),K(m,"input",r[10]),K(y,"input",r[11])],L=!0)},p(T,A){const j={};A&8192&&(j.$$scope={dirty:A,ctx:T}),e.$set(j),A&2&&(o.checked=T[1].pedestrians),A&2&&(f.checked=T[1].cyclists),A&2&&vn(m.value)!==T[1].minYear&&ze(m,T[1].minYear),A&2&&vn(y.value)!==T[1].maxYear&&ze(y,T[1].maxYear)},i(T){C||(v(e.$$.fragment,T),v(w.$$.fragment,T),C=!0)},o(T){S(e.$$.fragment,T),S(w.$$.fragment,T),C=!1},d(T){T&&($(n),$(t),$(c),$(_),$(h)),E(e,T),E(w,T),L=!1,nt(F)}}}function Cd(r){let e,n,t,l,o,i,s;return{c(){e=k("p"),e.innerHTML=`This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:`,n=M(),t=k("ul"),t.innerHTML=`<li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li>`,l=M(),o=k("p"),o.textContent="You can click a point to open the full report, thanks to CycleStreets.",i=M(),s=k("p"),s.innerHTML=`License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.`},m(a,f){b(a,e,f),b(a,n,f),b(a,t,f),b(a,l,f),b(a,o,f),b(a,i,f),b(a,s,f)},p:Q,d(a){a&&($(e),$(n),$(t),$(l),$(o),$(i),$(s))}}}function Do(r){let e,n,t,l=r[3][r[12].pedestrian_location]+"",o;return{c(){e=k("p"),n=z("Pedestrian location: "),t=k("b"),o=z(l)},m(i,s){b(i,e,s),p(e,n),p(e,t),p(t,o)},p(i,s){s&4096&&l!==(l=i[3][i[12].pedestrian_location]+"")&&ne(o,l)},d(i){i&&$(e)}}}function Uo(r){let e,n,t,l=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=k("p"),n=z("Pedestrian movement: "),t=k("b"),o=z(l)},m(i,s){b(i,e,s),p(e,n),p(e,t),p(t,o)},p(i,s){s&4096&&l!==(l=i[4][i[12].pedestrian_movement]+"")&&ne(o,l)},d(i){i&&$(e)}}}function Ld(r){let e,n,t,l=r[12].year+"",o,i,s,a,f,u=r[5][r[12].severity]+"",c,_,d,m,g,y=Ho(r[12])+"",h,w,C,L,F,T=r[12].pedestrian_location&&Do(r),A=r[12].pedestrian_movement&&Uo(r);return{c(){e=k("p"),n=z("Year: "),t=k("b"),o=z(l),i=M(),s=k("p"),a=z("Severity: "),f=k("b"),c=z(u),_=M(),d=k("p"),m=z("Casualties: "),g=k("b"),h=z(y),w=M(),T&&T.c(),C=M(),A&&A.c(),L=M(),F=k("p"),F.textContent="Click to open full report in CycleStreets"},m(j,O){b(j,e,O),p(e,n),p(e,t),p(t,o),b(j,i,O),b(j,s,O),p(s,a),p(s,f),p(f,c),b(j,_,O),b(j,d,O),p(d,m),p(d,g),p(g,h),b(j,w,O),T&&T.m(j,O),b(j,C,O),A&&A.m(j,O),b(j,L,O),b(j,F,O)},p(j,O){O&4096&&l!==(l=j[12].year+"")&&ne(o,l),O&4096&&u!==(u=j[5][j[12].severity]+"")&&ne(c,u),O&4096&&y!==(y=Ho(j[12])+"")&&ne(h,y),j[12].pedestrian_location?T?T.p(j,O):(T=Do(j),T.c(),T.m(C.parentNode,C)):T&&(T.d(1),T=null),j[12].pedestrian_movement?A?A.p(j,O):(A=Uo(j),A.c(),A.m(L.parentNode,L)):A&&(A.d(1),A=null)},d(j){j&&($(e),$(i),$(s),$(_),$(d),$(w),$(C),$(L),$(F)),T&&T.d(j),A&&A.d(j)}}}function Md(r){let e,n;return e=new dt({props:{$$slots:{default:[Ld,({props:t})=>({12:t}),({props:t})=>t?4096:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&12288&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Td(r){let e,n;const t=[we("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":Nt(["get","severity"],[1,2,3],[nl,rl,ll]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let l={$$slots:{default:[Md]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),e.$on("click",Fd),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&7?Oe(t,[t[0],t[1],i&0&&{paint:{"circle-color":Nt(["get","severity"],[1,2,3],[nl,rl,ll]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},i&6&&{filter:o[2](o[1])},i&1&&{layout:{visibility:o[0]?"visible":"none"}},t[5]]):{};i&8192&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Ad(r){let e,n,t,l,o,i,s,a=r[0]&&Ro(r);return l=new er({props:{url:`pmtiles://${St("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[Td]},$$scope:{ctx:r}}}),{c(){e=k("button"),e.textContent="Collisions",n=M(),a&&a.c(),t=M(),P(l.$$.fragment),N(e,"class","secondary")},m(f,u){b(f,e,u),b(f,n,u),a&&a.m(f,u),b(f,t,u),I(l,f,u),o=!0,i||(s=K(e,"click",r[7]),i=!0)},p(f,[u]){f[0]?a?(a.p(f,u),u&1&&v(a,1)):(a=Ro(f),a.c(),v(a,1),a.m(t.parentNode,t)):a&&(he(),S(a,1,1,()=>{a=null}),be());const c={};u&8195&&(c.$$scope={dirty:u,ctx:f}),l.$set(c)},i(f){o||(v(a),v(l.$$.fragment,f),o=!0)},o(f){S(a),S(l.$$.fragment,f),o=!1},d(f){f&&($(e),$(n),$(t)),a&&a.d(f),E(l,f),i=!1,s()}}}let nl="#080C54",rl="#1F9EB7",ll="#CDE594";function Ho(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function Fd(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function Pd(r,e,n){let t=!1,l={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(g){let y=["any"];return l.pedestrians&&y.push(["get","pedestrian"]),l.cyclists&&y.push(["get","cyclist"]),["all",[">=",["get","year"],l.minYear],["<=",["get","year"],l.maxYear],y]}let i={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},a={1:"Fatal",2:"Serious",3:"Slight"},f={Fatal:nl,Serious:rl,Slight:ll};const u=()=>n(0,t=!t);function c(){l.pedestrians=this.checked,n(1,l)}function _(){l.cyclists=this.checked,n(1,l)}function d(){l.minYear=vn(this.value),n(1,l)}function m(){l.maxYear=vn(this.value),n(1,l)}return[t,l,o,i,s,a,f,u,c,_,d,m]}class Id extends se{constructor(e){super(),ae(this,e,Pd,Ad,le,{})}}function Ed(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,w,C,L;return o=new xc({}),s=new fd({}),f=new gd({}),c=new nc({}),d=new Dc({}),g=new Sd({}),h=new Id({}),{c(){e=k("div"),n=k("button"),n.innerHTML=`<img src="${ru}" title="Layers" alt="Layers"/>`,t=M(),l=k("div"),P(o.$$.fragment),i=M(),P(s.$$.fragment),a=M(),P(f.$$.fragment),u=M(),P(c.$$.fragment),_=M(),P(d.$$.fragment),m=M(),P(g.$$.fragment),y=M(),P(h.$$.fragment),oe(l,"display","flex"),oe(l,"flex-direction","column"),oe(l,"visibility",r[0]?"visible":"collapse"),N(e,"class","pico"),oe(e,"display","flex"),oe(e,"flex-direction","column"),oe(e,"max-height","80vh"),oe(e,"overflow","auto"),oe(e,"background","grey")},m(F,T){b(F,e,T),p(e,n),p(e,t),p(e,l),I(o,l,null),p(l,i),I(s,l,null),p(l,a),I(f,l,null),p(l,u),I(c,l,null),p(l,_),I(d,l,null),p(l,m),I(g,l,null),p(l,y),I(h,l,null),w=!0,C||(L=K(n,"click",r[1]),C=!0)},p(F,T){T&1&&oe(l,"visibility",F[0]?"visible":"collapse")},i(F){w||(v(o.$$.fragment,F),v(s.$$.fragment,F),v(f.$$.fragment,F),v(c.$$.fragment,F),v(d.$$.fragment,F),v(g.$$.fragment,F),v(h.$$.fragment,F),w=!0)},o(F){S(o.$$.fragment,F),S(s.$$.fragment,F),S(f.$$.fragment,F),S(c.$$.fragment,F),S(d.$$.fragment,F),S(g.$$.fragment,F),S(h.$$.fragment,F),w=!1},d(F){F&&$(e),E(o),E(s),E(f),E(c),E(d),E(g),E(h),C=!1,L()}}}function Nd(r){let e,n;return e=new Df({props:{defaultStyling:!0,$$slots:{default:[Ed]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&5&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function jd(r,e,n){let t=!1;return[t,()=>n(0,t=!t)]}class zd extends se{constructor(e){super(),ae(this,e,jd,Nd,le,{})}}let q;const nn=new Array(128).fill(void 0);nn.push(void 0,null,!0,!1);function Ce(r){return nn[r]}let qn=nn.length;function Od(r){r<132||(nn[r]=qn,qn=r)}function Xe(r){const e=Ce(r);return Od(r),e}let vt=0,Rn=null;function Mn(){return(Rn===null||Rn.byteLength===0)&&(Rn=new Uint8Array(q.memory.buffer)),Rn}const _r=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Bd=typeof _r.encodeInto=="function"?function(r,e){return _r.encodeInto(r,e)}:function(r,e){const n=_r.encode(r);return e.set(n),{read:r.length,written:n.length}};function Ht(r,e,n){if(n===void 0){const s=_r.encode(r),a=e(s.length,1)>>>0;return Mn().subarray(a,a+s.length).set(s),vt=s.length,a}let t=r.length,l=e(t,1)>>>0;const o=Mn();let i=0;for(;i<t;i++){const s=r.charCodeAt(i);if(s>127)break;o[l+i]=s}if(i!==t){i!==0&&(r=r.slice(i)),l=n(l,t,t=i+r.length*3,1)>>>0;const s=Mn().subarray(l+i,l+t),a=Bd(r,s);i+=a.written}return vt=i,l}function Ln(r){return r==null}let Dn=null;function ee(){return(Dn===null||Dn.byteLength===0)&&(Dn=new Int32Array(q.memory.buffer)),Dn}let Un=null;function ys(){return(Un===null||Un.byteLength===0)&&(Un=new Float64Array(q.memory.buffer)),Un}function qe(r){qn===nn.length&&nn.push(nn.length+1);const e=qn;return qn=nn[e],nn[e]=r,e}const ws=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ws.decode();function it(r,e){return r=r>>>0,ws.decode(Mn().subarray(r,r+e))}let Hn=null;function Rd(){return(Hn===null||Hn.byteLength===0)&&(Hn=new BigInt64Array(q.memory.buffer)),Hn}function ol(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let o="[";l>0&&(o+=ol(r[0]));for(let i=1;i<l;i++)o+=", "+ol(r[i]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(r));let t;if(n.length>1)t=n[1];else return toString.call(r);if(t=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:t}function Go(r,e){const n=e(r.length*1,1)>>>0;return Mn().set(r,n/1),vt=r.length,n}function Dd(r,e){return r=r>>>0,ys().subarray(r/8,r/8+e)}function Ud(r,e){return r=r>>>0,Mn().subarray(r/1,r/1+e)}function hn(r,e){try{return r.apply(this,e)}catch(n){q.__wbindgen_exn_store(qe(n))}}class Hd{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();q.__wbg_ltn_free(e)}constructor(e,n,t,l){try{const u=q.__wbindgen_add_to_stack_pointer(-16),c=Go(e,q.__wbindgen_malloc),_=vt,d=Go(n,q.__wbindgen_malloc),m=vt;var o=Ln(l)?0:Ht(l,q.__wbindgen_malloc,q.__wbindgen_realloc),i=vt;q.ltn_new(u,c,_,d,m,qe(t),o,i);var s=ee()[u/4+0],a=ee()[u/4+1],f=ee()[u/4+2];if(f)throw Xe(a);return this.__wbg_ptr=s>>>0,this}finally{q.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getInvertedBoundary(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getBounds(){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getBounds(l,this.__wbg_ptr);var e=ee()[l/4+0],n=ee()[l/4+1],t=Dd(e,n).slice();return q.__wbindgen_free(e,n*8,8),t}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=ee()[l/4+0],n=ee()[l/4+1],t=Ud(e,n).slice();return q.__wbindgen_free(e,n*1,1),t}finally{q.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toRouteSnapperGj(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderModalFilters(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderModalFilters(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderNeighbourhood(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderNeighbourhood(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}renderAutoBoundaries(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_renderAutoBoundaries(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}setNeighbourhoodBoundary(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ht(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=vt;q.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,i,s,qe(n));var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const n=Ht(e,q.__wbindgen_malloc,q.__wbindgen_realloc),t=vt;q.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,n,t)}renameNeighbourhoodBoundary(e,n){const t=Ht(e,q.__wbindgen_malloc,q.__wbindgen_realloc),l=vt,o=Ht(n,q.__wbindgen_malloc,q.__wbindgen_realloc),i=vt;q.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,t,l,o,i)}setCurrentNeighbourhood(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ht(e,q.__wbindgen_malloc,q.__wbindgen_realloc),s=vt;q.ltn_setCurrentNeighbourhood(o,this.__wbg_ptr,i,s,n);var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ht(n,q.__wbindgen_malloc,q.__wbindgen_realloc),s=vt;q.ltn_addModalFilter(o,this.__wbg_ptr,qe(e),i,s);var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,n){try{const o=q.__wbindgen_add_to_stack_pointer(-16),i=Ht(n,q.__wbindgen_malloc,q.__wbindgen_realloc),s=vt;q.ltn_addManyModalFilters(o,this.__wbg_ptr,qe(e),i,s);var t=ee()[o/4+0],l=ee()[o/4+1];if(l)throw Xe(t)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){q.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_addDiagonalFilter(l,this.__wbg_ptr,e);var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_rotateDiagonalFilter(l,this.__wbg_ptr,e);var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_deleteDiagonalFilter(l,this.__wbg_ptr,e);var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}toggleTravelFlow(e){q.ltn_toggleTravelFlow(this.__wbg_ptr,e)}undo(){q.ltn_undo(this.__wbg_ptr)}redo(){q.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getShortcutsCrossingRoad(u,this.__wbg_ptr,e);var l=ee()[u/4+0],o=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,it(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getAllShortcuts(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllShortcuts(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}toSavefile(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_toSavefile(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}loadSavefile(e){try{const l=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_loadSavefile(l,this.__wbg_ptr,qe(e));var n=ee()[l/4+0],t=ee()[l/4+1];if(t)throw Xe(n)}finally{q.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,n,t,l,o){let i,s;try{const m=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_compareRoute(m,this.__wbg_ptr,e,n,t,l,o);var a=ee()[m/4+0],f=ee()[m/4+1],u=ee()[m/4+2],c=ee()[m/4+3],_=a,d=f;if(c)throw _=0,d=0,Xe(u);return i=_,s=d,it(_,d)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(i,s,1)}}impactToOneDestination(e,n){let t,l;try{const c=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_impactToOneDestination(c,this.__wbg_ptr,e,n);var o=ee()[c/4+0],i=ee()[c/4+1],s=ee()[c/4+2],a=ee()[c/4+3],f=o,u=i;if(a)throw f=0,u=0,Xe(s);return t=f,l=u,it(f,u)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(t,l,1)}}predictImpact(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_predictImpact(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getImpactsOnRoad(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getImpactsOnRoad(u,this.__wbg_ptr,e);var l=ee()[u/4+0],o=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,it(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getAllNeighbourhoods(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllNeighbourhoods(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getAllIntersections(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getAllIntersections(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}getMovements(e){let n,t;try{const u=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getMovements(u,this.__wbg_ptr,e);var l=ee()[u/4+0],o=ee()[u/4+1],i=ee()[u/4+2],s=ee()[u/4+3],a=l,f=o;if(s)throw a=0,f=0,Xe(i);return n=a,t=f,it(a,f)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(n,t,1)}}getDemandModel(){let e,n;try{const f=q.__wbindgen_add_to_stack_pointer(-16);q.ltn_getDemandModel(f,this.__wbg_ptr);var t=ee()[f/4+0],l=ee()[f/4+1],o=ee()[f/4+2],i=ee()[f/4+3],s=t,a=l;if(i)throw s=0,a=0,Xe(o);return e=s,n=a,it(s,a)}finally{q.__wbindgen_add_to_stack_pointer(16),q.__wbindgen_free(e,n,1)}}}async function Gd(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(t){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t);else throw t}const n=await r.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(r,e);return n instanceof WebAssembly.Instance?{instance:n,module:r}:n}}function Wd(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Xe(e)},r.wbg.__wbindgen_string_get=function(e,n){const t=Ce(n),l=typeof t=="string"?t:void 0;var o=Ln(l)?0:Ht(l,q.__wbindgen_malloc,q.__wbindgen_realloc),i=vt;ee()[e/4+1]=i,ee()[e/4+0]=o},r.wbg.__wbindgen_boolean_get=function(e){const n=Ce(e);return typeof n=="boolean"?n?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Ce(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,n){const t=Ce(n),l=typeof t=="number"?t:void 0;ys()[e/8+1]=Ln(l)?0:l,ee()[e/4+0]=!Ln(l)},r.wbg.__wbindgen_is_object=function(e){const n=Ce(e);return typeof n=="object"&&n!==null},r.wbg.__wbindgen_in=function(e,n){return Ce(e)in Ce(n)},r.wbg.__wbindgen_bigint_from_i64=function(e){return qe(e)},r.wbg.__wbindgen_jsval_eq=function(e,n){return Ce(e)===Ce(n)},r.wbg.__wbindgen_bigint_from_u64=function(e){const n=BigInt.asUintN(64,e);return qe(n)},r.wbg.__wbindgen_error_new=function(e,n){const t=new Error(it(e,n));return qe(t)},r.wbg.__wbindgen_is_undefined=function(e){return Ce(e)===void 0},r.wbg.__wbindgen_string_new=function(e,n){const t=it(e,n);return qe(t)},r.wbg.__wbindgen_jsval_loose_eq=function(e,n){return Ce(e)==Ce(n)},r.wbg.__wbindgen_object_clone_ref=function(e){const n=Ce(e);return qe(n)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,n){const t=Ce(e)[Ce(n)];return qe(t)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Ce(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Ce(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Ce(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Ce(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Ce(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return qe(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const t=Ce(n).stack,l=Ht(t,q.__wbindgen_malloc,q.__wbindgen_realloc),o=vt;ee()[e/4+1]=o,ee()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let t,l;try{t=e,l=n,console.error(it(e,n))}finally{q.__wbindgen_free(t,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const n=Ce(e).performance;return qe(n)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Ce(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,n){const t=Ce(e)[n>>>0];return qe(t)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Ce(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ce(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,n){const t=new Function(it(e,n));return qe(t)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const n=Ce(e).next;return qe(n)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return hn(function(e){const n=Ce(e).next();return qe(n)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Ce(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const n=Ce(e).value;return qe(n)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return qe(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return hn(function(e,n){const t=Reflect.get(Ce(e),Ce(n));return qe(t)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return hn(function(e,n){const t=Ce(e).call(Ce(n));return qe(t)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return hn(function(){const e=self.self;return qe(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return hn(function(){const e=window.window;return qe(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return hn(function(){const e=globalThis.globalThis;return qe(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return hn(function(){const e=global.global;return qe(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Ce(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let n;try{n=Ce(e)instanceof ArrayBuffer}catch{n=!1}return n},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Ce(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const n=Object.entries(Ce(e));return qe(n)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const n=Ce(e).buffer;return qe(n)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const n=new Uint8Array(Ce(e));return qe(n)},r.wbg.__wbg_set_2357bf09366ee480=function(e,n,t){Ce(e).set(Ce(n),t>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Ce(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let n;try{n=Ce(e)instanceof Uint8Array}catch{n=!1}return n},r.wbg.__wbindgen_bigint_get_as_i64=function(e,n){const t=Ce(n),l=typeof t=="bigint"?t:void 0;Rd()[e/8+1]=Ln(l)?BigInt(0):l,ee()[e/4+0]=!Ln(l)},r.wbg.__wbindgen_debug_string=function(e,n){const t=ol(Ce(n)),l=Ht(t,q.__wbindgen_malloc,q.__wbindgen_realloc),o=vt;ee()[e/4+1]=o,ee()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,n){throw new Error(it(e,n))},r.wbg.__wbindgen_memory=function(){const e=q.memory;return qe(e)},r}function qd(r,e){return q=r.exports,ks.__wbindgen_wasm_module=e,Hn=null,Un=null,Dn=null,Rn=null,q}async function ks(r){if(q!==void 0)return q;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=Wd();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:n,module:t}=await Gd(await r,e);return qd(n,t)}const Jd=r=>({}),Wo=r=>({}),Yd=r=>({}),qo=r=>({}),Zd=r=>({}),Jo=r=>({});function Kd(r){let e,n,t,l,o,i,s,a;const f=r[1].top,u=Re(f,r,r[0],Jo),c=r[1].left,_=Re(c,r,r[0],qo),d=r[1].main,m=Re(d,r,r[0],Wo);return{c(){e=k("div"),n=k("div"),u&&u.c(),t=M(),l=k("div"),o=k("div"),_&&_.c(),i=M(),s=k("div"),m&&m.c(),N(n,"class","top svelte-29q570"),N(o,"class","left svelte-29q570"),N(s,"class","main svelte-29q570"),N(l,"class","content svelte-29q570"),N(e,"class","flex-container svelte-29q570")},m(g,y){b(g,e,y),p(e,n),u&&u.m(n,null),p(e,t),p(e,l),p(l,o),_&&_.m(o,null),p(l,i),p(l,s),m&&m.m(s,null),a=!0},p(g,[y]){u&&u.p&&(!a||y&1)&&De(u,f,g,g[0],a?He(f,g[0],y,Zd):Ue(g[0]),Jo),_&&_.p&&(!a||y&1)&&De(_,c,g,g[0],a?He(c,g[0],y,Yd):Ue(g[0]),qo),m&&m.p&&(!a||y&1)&&De(m,d,g,g[0],a?He(d,g[0],y,Jd):Ue(g[0]),Wo)},i(g){a||(v(u,g),v(_,g),v(m,g),a=!0)},o(g){S(u,g),S(_,g),S(m,g),a=!1},d(g){g&&$(e),u&&u.d(g),_&&_.d(g),m&&m.d(g)}}}function Xd(r,e,n){let{$$slots:t={},$$scope:l}=e;return r.$$set=o=>{"$$scope"in o&&n(0,l=o.$$scope)},[l,t]}class Vd extends se{constructor(e){super(),ae(this,e,Xd,Kd,le,{})}}const Qd=r=>({}),Yo=r=>({}),xd=r=>({}),Zo=r=>({}),e_=r=>({}),Ko=r=>({});function t_(r){let e,n,t,l,o,i;const s=r[4].top,a=Re(s,r,r[3],Ko),f=r[4].sidebar,u=Re(f,r,r[3],Zo),c=r[4].map,_=Re(c,r,r[3],Yo);return{c(){e=k("div"),a&&a.c(),n=M(),t=k("div"),u&&u.c(),l=M(),o=k("div"),_&&_.c()},m(d,m){b(d,e,m),a&&a.m(e,null),r[5](e),b(d,n,m),b(d,t,m),u&&u.m(t,null),r[6](t),b(d,l,m),b(d,o,m),_&&_.m(o,null),r[7](o),i=!0},p(d,[m]){a&&a.p&&(!i||m&8)&&De(a,s,d,d[3],i?He(s,d[3],m,e_):Ue(d[3]),Ko),u&&u.p&&(!i||m&8)&&De(u,f,d,d[3],i?He(f,d[3],m,xd):Ue(d[3]),Zo),_&&_.p&&(!i||m&8)&&De(_,c,d,d[3],i?He(c,d[3],m,Qd):Ue(d[3]),Yo)},i(d){i||(v(a,d),v(u,d),v(_,d),i=!0)},o(d){S(a,d),S(u,d),S(_,d),i=!1},d(d){d&&($(e),$(n),$(t),$(l),$(o)),a&&a.d(d),r[5](null),u&&u.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function n_(r,e,n){let t,l,o;V(r,il,c=>n(0,t=c)),V(r,sl,c=>n(1,l=c)),V(r,al,c=>n(2,o=c));let{$$slots:i={},$$scope:s}=e;function a(c){Ge[c?"unshift":"push"](()=>{t=c,il.set(t)})}function f(c){Ge[c?"unshift":"push"](()=>{l=c,sl.set(l)})}function u(c){Ge[c?"unshift":"push"](()=>{o=c,al.set(o)})}return r.$$set=c=>{"$$scope"in c&&n(3,s=c.$$scope)},[t,l,o,s,i,a,f,u]}class At extends se{constructor(e){super(),ae(this,e,n_,t_,le,{})}}let il=Mt(null),sl=Mt(null),al=Mt(null);function r_(r){let e;return{c(){e=z("Back")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function l_(r){let e,n,t,l;return e=new Le({props:{$$slots:{default:[r_]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0,t||(l=K(window,"keydown",r[1]),t=!0)},p(o,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o),t=!1,l()}}}function o_(r){let e=mn();function n(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,n,()=>e("click")]}class pn extends se{constructor(e){super(),ae(this,e,o_,l_,le,{})}}function fl(r,e,n){let t=new Set(r.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,n);if(!l)return null;if(t.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function i_(r){let e,n;return e=new kn({props:{colorScale:ln,limits:kl}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function s_(r){let e,n;return e=new kn({props:{colorScale:ln,limits:tr}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function a_(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;const g=[s_,i_],y=[];function h(w,C){return w[0]=="simd"?0:w[0]=="area"?1:-1}return~(f=h(r))&&(u=y[f]=g[f](r)),{c(){e=k("div"),n=k("label"),n.textContent="Metric",t=M(),l=k("select"),o=k("option"),o.textContent="None",i=k("option"),i.textContent="Area (km²)",s=k("option"),s.textContent="Fake SIMD (percentile)",a=M(),u&&u.c(),c=Ye(),N(n,"for","prioritization-selection"),o.__value="none",ze(o,o.__value),i.__value="area",ze(i,i.__value),s.__value="simd",ze(s,s.__value),N(l,"id","prioritization-selection"),r[0]===void 0&&fn(()=>r[1].call(l)),oe(e,"display","flex"),oe(e,"gap","16px"),oe(e,"align-items","center")},m(w,C){b(w,e,C),p(e,n),p(e,t),p(e,l),p(l,o),p(l,i),p(l,s),yt(l,r[0],!0),b(w,a,C),~f&&y[f].m(w,C),b(w,c,C),_=!0,d||(m=K(l,"change",r[1]),d=!0)},p(w,[C]){C&1&&yt(l,w[0]);let L=f;f=h(w),f!==L&&(u&&(he(),S(y[L],1,1,()=>{y[L]=null}),be()),~f?(u=y[f],u||(u=y[f]=g[f](w),u.c()),v(u,1),u.m(c.parentNode,c)):u=null)},i(w){_||(v(u),_=!0)},o(w){S(u),_=!1},d(w){w&&($(e),$(a),$(c)),~f&&y[f].d(w),d=!1,m()}}}function f_(r,e,n){let t;V(r,Yt,s=>n(2,t=s));let{selectedPrioritization:l}=e;function o(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="area"?n(0,l="area"):s=="simd"&&n(0,l="simd")}t.startsWith("ltn_cnt/")?o():l="none";function i(){l=un(this),n(0,l)}return r.$$set=s=>{"selectedPrioritization"in s&&n(0,l=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);l=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",l),history.replaceState({},"",s)}},[l,i]}class Ss extends se{constructor(e){super(),ae(this,e,f_,a_,le,{selectedPrioritization:0})}}function u_(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function c_(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function d_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[u_]},$$scope:{ctx:r}}}),o.$on("click",r[12]),a=new Le({props:{$$slots:{default:[c_]},$$scope:{ctx:r}}}),a.$on("click",r[13]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),u.textContent="Use an auto-generated boundary",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){b(_,e,d),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&131072&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&131072&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(o.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&$(e),E(o),E(a)}}}function Xo(r){let e,n,t,l,o,i,s;function a(u){r[9](u)}let f={};return r[2]!==void 0&&(f.selectedPrioritization=r[2]),o=new Ss({props:f}),Ge.push(()=>ut(o,"selectedPrioritization",a)),{c(){e=k("h3"),e.textContent="Prioritization",n=M(),t=k("p"),t.textContent="Compare metrics across candidate neighbourhoods.",l=M(),P(o.$$.fragment)},m(u,c){b(u,e,c),b(u,n,c),b(u,t,c),b(u,l,c),I(o,u,c),s=!0},p(u,c){const _={};!i&&c&4&&(i=!0,_.selectedPrioritization=u[2],ct(()=>i=!1)),o.$set(_)},i(u){s||(v(o.$$.fragment,u),s=!0)},o(u){S(o.$$.fragment,u),s=!1},d(u){u&&($(e),$(n),$(t),$(l)),E(o,u)}}}function Vo(r){let e;return{c(){e=k("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function __(r){let e,n,t,l,o,i=r[4].startsWith("ltn_cnt/"),s,a,f,u,c,_,d,m,g,y,h,w,C,L;n=new pn({}),n.$on("click",r[8]);let F=i&&Xo(r),T=r[2]=="none"&&Vo();return{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),l.textContent=`Click an area to use it as the boundary for your neighbourhood. These
      particular boundaries are suggested by finding roads, railways, and water
      that form severances.`,o=M(),F&&F.c(),s=M(),T&&T.c(),a=M(),f=k("button"),f.textContent="Export to GeoJSON",u=M(),c=k("label"),_=z(`Minimum area (km²)
      `),d=k("input"),m=M(),g=k("label"),y=k("input"),h=z(`
      Remove areas not touching a big road`),N(f,"class","secondary"),N(d,"type","number"),N(d,"min","0"),N(d,"max","1"),N(d,"step","0.01"),N(y,"type","checkbox"),N(e,"slot","sidebar")},m(A,j){b(A,e,j),I(n,e,null),p(e,t),p(e,l),p(e,o),F&&F.m(e,null),p(e,s),T&&T.m(e,null),p(e,a),p(e,f),p(e,u),p(e,c),p(c,_),p(c,d),ze(d,r[0]),p(e,m),p(e,g),p(g,y),y.checked=r[1],p(g,h),w=!0,C||(L=[K(f,"click",r[7]),K(d,"input",r[10]),K(y,"change",r[11])],C=!0)},p(A,j){j&16&&(i=A[4].startsWith("ltn_cnt/")),i?F?(F.p(A,j),j&16&&v(F,1)):(F=Xo(A),F.c(),v(F,1),F.m(e,s)):F&&(he(),S(F,1,1,()=>{F=null}),be()),A[2]=="none"?T||(T=Vo(),T.c(),T.m(e,a)):T&&(T.d(1),T=null),j&1&&vn(d.value)!==A[0]&&ze(d,A[0]),j&2&&(y.checked=A[1])},i(A){w||(v(n.$$.fragment,A),v(F),w=!0)},o(A){S(n.$$.fragment,A),S(F),w=!1},d(A){A&&$(e),E(n),F&&F.d(),T&&T.d(),C=!1,nt(L)}}}function m_(r){let e,n,t=r[16].area_km2.toFixed(1)+"",l,o,i;return{c(){e=k("b"),e.textContent="Area:",n=M(),l=z(t),o=z(` km²
          `),i=k("br")},m(s,a){b(s,e,a),b(s,n,a),b(s,l,a),b(s,o,a),b(s,i,a)},p(s,a){a&65536&&t!==(t=s[16].area_km2.toFixed(1)+"")&&ne(l,t)},d(s){s&&($(e),$(n),$(l),$(o),$(i))}}}function p_(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[m_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&196608&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function g_(r){let e,n,t=r[16].simd.toFixed(1)+"",l;return{c(){e=k("b"),e.textContent="SIMD:",n=M(),l=z(t)},m(o,i){b(o,e,i),b(o,n,i),b(o,l,i)},p(o,i){i&65536&&t!==(t=o[16].simd.toFixed(1)+"")&&ne(l,t)},d(o){o&&($(e),$(n),$(l))}}}function h_(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[g_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&196608&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function b_(r){let e,n,t=r[16].area_km2.toFixed(1)+"",l,o;return{c(){e=k("b"),e.textContent="Area:",n=M(),l=z(t),o=z(" km²")},m(i,s){b(i,e,s),b(i,n,s),b(i,l,s),b(i,o,s)},p(i,s){s&65536&&t!==(t=i[16].area_km2.toFixed(1)+"")&&ne(l,t)},d(i){i&&($(e),$(n),$(l),$(o))}}}function $_(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[b_,({props:t})=>({16:t}),({props:t})=>t?65536:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&196608&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function v_(r){let e,n,t,l,o,i,s,a;const f=[we("neighbourhood-boundaries",!1),{filter:sn(r[0],r[1])},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":at(.2,.4)}},{layout:{visibility:r[2]=="none"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[p_]},$$scope:{ctx:r}};for(let h=0;h<f.length;h+=1)u=_e(u,f[h]);e=new wt({props:u}),e.$on("click",r[6]);const c=[we("neighbourhood-prioritization-simd"),{filter:sn(r[0],r[1])},{paint:{"fill-color":Nt(["get","simd"],tr,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[2]=="simd"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let _={$$slots:{default:[h_]},$$scope:{ctx:r}};for(let h=0;h<c.length;h+=1)_=_e(_,c[h]);t=new wt({props:_}),t.$on("click",r[6]);const d=[we("neighbourhood-prioritization-area"),{filter:sn(r[0],r[1])},{paint:{"fill-color":Nt(["get","area_km2"],kl,ln),"fill-opacity":at(.7,.9)}},{layout:{visibility:r[2]=="area"?"visible":"none"}},{manageHoverState:!0},{hoverCursor:"pointer"}];let m={$$slots:{default:[$_]},$$scope:{ctx:r}};for(let h=0;h<d.length;h+=1)m=_e(m,d[h]);o=new wt({props:m}),o.$on("click",r[6]);const g=[we("neighbourhood-boundaries-outline",!1),{filter:sn(r[0],r[1])},{paint:{"line-color":"black","line-width":1}}];let y={};for(let h=0;h<g.length;h+=1)y=_e(y,g[h]);return s=new tt({props:y}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),P(s.$$.fragment)},m(h,w){I(e,h,w),b(h,n,w),I(t,h,w),b(h,l,w),I(o,h,w),b(h,i,w),I(s,h,w),a=!0},p(h,w){const C=w&7?Oe(f,[f[0],w&3&&{filter:sn(h[0],h[1])},f[2],w&4&&{layout:{visibility:h[2]=="none"?"visible":"none"}},f[4],f[5]]):{};w&131072&&(C.$$scope={dirty:w,ctx:h}),e.$set(C);const L=w&7?Oe(c,[c[0],w&3&&{filter:sn(h[0],h[1])},c[2],w&4&&{layout:{visibility:h[2]=="simd"?"visible":"none"}},c[4],c[5]]):{};w&131072&&(L.$$scope={dirty:w,ctx:h}),t.$set(L);const F=w&7?Oe(d,[d[0],w&3&&{filter:sn(h[0],h[1])},d[2],w&4&&{layout:{visibility:h[2]=="area"?"visible":"none"}},d[4],d[5]]):{};w&131072&&(F.$$scope={dirty:w,ctx:h}),o.$set(F);const T=w&3?Oe(g,[g[0],{filter:sn(h[0],h[1])},g[2]]):{};s.$set(T)},i(h){a||(v(e.$$.fragment,h),v(t.$$.fragment,h),v(o.$$.fragment,h),v(s.$$.fragment,h),a=!0)},o(h){S(e.$$.fragment,h),S(t.$$.fragment,h),S(o.$$.fragment,h),S(s.$$.fragment,h),a=!1},d(h){h&&($(n),$(l),$(i)),E(e,h),E(t,h),E(o,h),E(s,h)}}}function y_(r){let e,n,t;return n=new Ve({props:{data:r[5],generateId:!0,$$slots:{default:[v_]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","map")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o&131079&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function w_(r){let e,n;return e=new At({props:{$$slots:{map:[y_],sidebar:[__],top:[d_]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&131103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function sn(r,e){let n=["all",[">=",["get","area_km2"],r]];return e&&n.push(["get","touches_big_road"]),n}function k_(r,e,n){let t,l,o,i;V(r,ce,C=>n(3,t=C)),V(r,Jn,C=>n(14,l=C)),V(r,xe,C=>n(15,o=C)),V(r,Yt,C=>n(4,i=C));let s=o.renderAutoBoundaries(),a=0,f=!0,u="none";function c(C){let L=fl(o,"What do you want to name the neighbourhood?","");if(L)try{let F={type:"Feature",properties:{},geometry:s.features[C.detail.features[0].id].geometry};o.setNeighbourhoodBoundary(L,F),Tn(),o.setCurrentNeighbourhood(L,l),te(ce,t={mode:"neighbourhood"},t)}catch(F){console.log("error when setting auto-generated neighborhood",F),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working.")}}function _(){$r("auto_boundaries.geojson",JSON.stringify(s,null,"  "))}const d=()=>te(ce,t={mode:"pick-neighbourhood"},t);function m(C){u=C,n(2,u)}function g(){a=vn(this.value),n(0,a)}function y(){f=this.checked,n(1,f)}return[a,f,u,t,i,s,c,_,d,m,g,y,()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class S_ extends se{constructor(e){super(),ae(this,e,k_,w_,le,{})}}function C_(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function L_(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function M_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[C_]},$$scope:{ctx:r}}}),o.$on("click",r[11]),a=new Le({props:{$$slots:{default:[L_]},$$scope:{ctx:r}}}),a.$on("click",r[12]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),u.textContent="Debug demand model",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){b(_,e,d),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&65536&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&65536&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(o.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&$(e),E(o),E(a)}}}function T_(r){let e;return{c(){e=k("p"),e.textContent="Hover on a zone"},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function A_(r){let e,n=r[6].properties.name+"",t,l,o,i,s=r[6].properties.sum_from.toLocaleString()+"",a,f,u,c,_=r[6].properties.sum_to.toLocaleString()+"",d,m,g,y,h=r[6].properties.counts_from[r[3]]+"",w;return{c(){e=k("u"),t=z(n),l=M(),o=k("p"),i=z("Total trips from here: "),a=z(s),f=M(),u=k("p"),c=z("Total trips to here: "),d=z(_),m=M(),g=k("p"),y=z("Total intra-zonal trips starting and ending here: "),w=z(h)},m(C,L){b(C,e,L),p(e,t),b(C,l,L),b(C,o,L),p(o,i),p(o,a),b(C,f,L),b(C,u,L),p(u,c),p(u,d),b(C,m,L),b(C,g,L),p(g,y),p(g,w)},p(C,L){L&64&&n!==(n=C[6].properties.name+"")&&ne(t,n),L&64&&s!==(s=C[6].properties.sum_from.toLocaleString()+"")&&ne(a,s),L&64&&_!==(_=C[6].properties.sum_to.toLocaleString()+"")&&ne(d,_),L&72&&h!==(h=C[6].properties.counts_from[C[3]]+"")&&ne(w,h)},d(C){C&&($(e),$(l),$(o),$(f),$(u),$(m),$(g))}}}function F_(r){let e,n,t,l,o=r[0].features.length.toLocaleString()+"",i,s,a,f,u,c,_,d,m,g,y=r[1]?"from":"to",h,w,C=r[3]==null?"each zone":"this zone",L,F,T,A,j,O,U,R,B,H;n=new pn({}),n.$on("click",r[9]),A=new kn({props:{colorScale:dr,limits:r[5]}});function G(ie,D){return ie[6]&&ie[3]!=null?A_:T_}let Z=G(r),Y=Z(r);return{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),i=z(o),s=z(" zones"),a=M(),f=k("label"),u=z(`Trips from
      `),c=k("input"),_=z(`
      Trips to`),d=M(),m=k("p"),g=z("Trips "),h=z(y),w=M(),L=z(C),F=z(":"),T=M(),P(A.$$.fragment),j=M(),O=k("hr"),U=M(),Y.c(),N(c,"type","checkbox"),N(c,"role","switch"),N(e,"slot","sidebar")},m(ie,D){b(ie,e,D),I(n,e,null),p(e,t),p(e,l),p(l,i),p(l,s),p(e,a),p(e,f),p(f,u),p(f,c),c.checked=r[1],p(f,_),p(e,d),p(e,m),p(m,g),p(m,h),p(m,w),p(m,L),p(m,F),p(e,T),I(A,e,null),p(e,j),p(e,O),p(e,U),Y.m(e,null),R=!0,B||(H=K(c,"change",r[10]),B=!0)},p(ie,D){(!R||D&1)&&o!==(o=ie[0].features.length.toLocaleString()+"")&&ne(i,o),D&2&&(c.checked=ie[1]),(!R||D&2)&&y!==(y=ie[1]?"from":"to")&&ne(h,y),(!R||D&8)&&C!==(C=ie[3]==null?"each zone":"this zone")&&ne(L,C);const ve={};D&32&&(ve.limits=ie[5]),A.$set(ve),Z===(Z=G(ie))&&Y?Y.p(ie,D):(Y.d(1),Y=Z(ie),Y&&(Y.c(),Y.m(e,null)))},i(ie){R||(v(n.$$.fragment,ie),v(A.$$.fragment,ie),R=!0)},o(ie){S(n.$$.fragment,ie),S(A.$$.fragment,ie),R=!1},d(ie){ie&&$(e),E(n),E(A),Y.d(),B=!1,H()}}}function P_(r){let e,n,t,l,o;const i=[we("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":at(.5,.1)}},{manageHoverState:!0}];function s(c){r[8](c)}let a={};for(let c=0;c<i.length;c+=1)a=_e(a,i[c]);r[2]!==void 0&&(a.hovered=r[2]),e=new wt({props:a}),Ge.push(()=>ut(e,"hovered",s));const f=[we("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let u={};for(let c=0;c<f.length;c+=1)u=_e(u,f[c]);return l=new tt({props:u}),{c(){P(e.$$.fragment),t=M(),P(l.$$.fragment)},m(c,_){I(e,c,_),b(c,t,_),I(l,c,_),o=!0},p(c,_){const d=_&16?Oe(i,[i[0],{paint:{"fill-color":c[4],"fill-opacity":at(.5,.1)}},i[2]]):{};!n&&_&4&&(n=!0,d.hovered=c[2],ct(()=>n=!1)),e.$set(d);const m={};l.$set(m)},i(c){o||(v(e.$$.fragment,c),v(l.$$.fragment,c),o=!0)},o(c){S(e.$$.fragment,c),S(l.$$.fragment,c),o=!1},d(c){c&&$(t),E(e,c),E(l,c)}}}function I_(r){let e,n,t;return n=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[P_]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","map")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o&1&&(i.data=l[0]),o&65556&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function E_(r){let e,n;return e=new At({props:{$$slots:{map:[I_],sidebar:[F_],top:[M_]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&65791&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function N_(r,e,n){let t,l,o,i,s,a;V(r,ce,C=>n(7,s=C)),V(r,xe,C=>n(13,a=C));let f=rn();try{f=a.getDemandModel()}catch{window.alert("No demand model for this area"),te(ce,s={mode:"pick-neighbourhood"},s)}let u=!1,c=null;function _(C,L){if(C==null){let F=L?"sum_to":"sum_from",T=Math.max(...f.features.map(j=>j.properties[F])),A=d(T);return[A.map(j=>j.toLocaleString()),Nt(["get",F],A,dr)]}else{let F=L?"counts_to":"counts_from",T=[...f.features.map(O=>O.properties[F][C])],A=Math.max(...T),j=d(A);return[j.map(O=>O.toLocaleString()),Nt(["at",["id"],["literal",T]],j,dr)]}}function d(C){let L=dr.length+1;return Array.from(Array(L).keys()).map(F=>Math.round(C/(L-1)*F))}function m(C){c=C,n(2,c)}const g=()=>te(ce,s={mode:"pick-neighbourhood"},s);function y(){u=this.checked,n(1,u)}const h=()=>te(ce,s={mode:"title",firstLoad:!1},s),w=()=>te(ce,s={mode:"pick-neighbourhood"},s);return r.$$.update=()=>{r.$$.dirty&4&&n(3,t=c==null?null:c.id),r.$$.dirty&9&&n(6,l=t!=null?f.features[t]:null),r.$$.dirty&10&&n(5,[o,i]=_(t,u),o,(n(4,i),n(3,t),n(1,u),n(2,c)))},[f,u,c,t,i,o,l,s,m,g,y,h,w]}class j_ extends se{constructor(e){super(),ae(this,e,N_,E_,le,{})}}function z_(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function O_(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function B_(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[z_]},$$scope:{ctx:r}}}),o.$on("click",r[8]),a=new Le({props:{$$slots:{default:[O_]},$$scope:{ctx:r}}}),a.$on("click",r[9]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),u.textContent="Debug intersections",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){b(_,e,d),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(o.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&$(e),E(o),E(a)}}}function Qo(r){let e,n,t,l,o,i,s;function a(u){r[7](u)}let f={list:r[0].features};return r[1]!==void 0&&(f.idx=r[1]),t=new Pr({props:f}),Ge.push(()=>ut(t,"idx",a)),{c(){e=k("button"),e.textContent="Pick another intersection",n=M(),P(t.$$.fragment),N(e,"class","secondary")},m(u,c){b(u,e,c),b(u,n,c),I(t,u,c),o=!0,i||(s=K(e,"click",r[6]),i=!0)},p(u,c){const _={};c&1&&(_.list=u[0].features),!l&&c&2&&(l=!0,_.idx=u[1],ct(()=>l=!1)),t.$set(_)},i(u){o||(v(t.$$.fragment,u),o=!0)},o(u){S(t.$$.fragment,u),o=!1},d(u){u&&($(e),$(n)),E(t,u),i=!1,s()}}}function R_(r){let e,n,t,l,o,i;n=new pn({}),n.$on("click",r[5]);let s=r[0].features.length>0&&Qo(r);return{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),l.textContent="Purple intersections have some kind of turn restriction.",o=M(),s&&s.c(),N(e,"slot","sidebar")},m(a,f){b(a,e,f),I(n,e,null),p(e,t),p(e,l),p(e,o),s&&s.m(e,null),i=!0},p(a,f){a[0].features.length>0?s?(s.p(a,f),f&1&&v(s,1)):(s=Qo(a),s.c(),v(s,1),s.m(e,null)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){i||(v(n.$$.fragment,a),v(s),i=!0)},o(a){S(n.$$.fragment,a),S(s),i=!1},d(a){a&&$(e),E(n),s&&s.d()}}}function D_(r){let e,n;const t=[we("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),e.$on("click",r[4]),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function U_(r){let e,n,t,l;const o=[we("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new tt({props:i});const s=[we("debug-movements-fill"),{filter:["==",["id"],r[1]]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new wt({props:a}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _=u&2?Oe(s,[s[0],{filter:["==",["id"],f[1]]},s[2]]):{};t.$set(_)},i(f){l||(v(e.$$.fragment,f),v(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&$(n),E(e,f),E(t,f)}}}function H_(r){let e,n,t,l,o;return n=new Ve({props:{data:ft(r[2]).getAllIntersections(),generateId:!0,$$slots:{default:[D_]},$$scope:{ctx:r}}}),l=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[U_]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),N(e,"slot","map")},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s&4&&(a.data=ft(i[2]).getAllIntersections()),s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a);const f={};s&1&&(f.data=i[0]),s&1026&&(f.$$scope={dirty:s,ctx:i}),l.$set(f)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function G_(r){let e,n;return e=new At({props:{$$slots:{map:[H_],sidebar:[R_],top:[B_]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1039&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function W_(r,e,n){let t,l;V(r,xe,d=>n(2,t=d)),V(r,ce,d=>n(3,l=d));let o=rn(),i=0;function s(d){n(0,o=t.getMovements(d.detail.features[0].id)),n(1,i=0)}const a=()=>te(ce,l={mode:"pick-neighbourhood"},l),f=()=>n(0,o=rn());function u(d){i=d,n(1,i)}return[o,i,t,l,s,a,f,u,()=>te(ce,l={mode:"title",firstLoad:!1},l),()=>te(ce,l={mode:"pick-neighbourhood"},l)]}class q_ extends se{constructor(e){super(),ae(this,e,W_,G_,le,{})}}function J_(r){let e,n,t,l,o,i;const s=[we("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=_e(a,s[d]);e=new wt({props:a});const f=[we("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let u={};for(let d=0;d<f.length;d+=1)u=_e(u,f[d]);t=new wt({props:u});const c=[we("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return o=new tt({props:_}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment)},m(d,m){I(e,d,m),b(d,n,m),I(t,d,m),b(d,l,m),I(o,d,m),i=!0},p(d,[m]){const g=m&1?Oe(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const y={};t.$set(y);const h={};o.$set(h)},i(d){i||(v(e.$$.fragment,d),v(t.$$.fragment,d),v(o.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),i=!1},d(d){d&&($(n),$(l)),E(e,d),E(t,d),E(o,d)}}}function Y_(r,e,n){let t;return V(r,br,l=>n(0,t=l)),[t]}class Ir extends se{constructor(e){super(),ae(this,e,Y_,J_,le,{})}}function Z_(r){let e,n;const t=[we("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new wt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}class Er extends se{constructor(e){super(),ae(this,e,null,Z_,le,{})}}const K_=r=>({}),xo=r=>({});function ei(r){let e;const n=r[7]["line-popup"],t=Re(n,r,r[9],xo);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&512)&&De(t,n,l,l[9],e?He(n,l[9],o,K_):Ue(l[9]),xo)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function X_(r){let e,n,t=r[0]&&ei(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,o){l[0]?t?(t.p(l,o),o&1&&v(t,1)):(t=ei(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function V_(r){let e,n,t,l;const o=[we("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new tt({props:i});const s=[we("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":at(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[X_]},$$scope:{ctx:r}};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new tt({props:a}),t.$on("click",r[8]),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),l=!0},p(f,[u]){const c=u&84?Oe(o,[o[0],o[1],{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=u&125?Oe(s,[s[0],s[1],u&124&&{paint:{"line-width":f[6](f[2],f[4].maxShortcuts,0),"line-color":f[5](f[3],f[4].maxShortcuts),"line-opacity":at(1,.5)}},u&1&&{manageHoverState:f[0]},u&1&&{hoverCursor:f[0]?"pointer":void 0}]):{};u&513&&(_.$$scope={dirty:u,ctx:f}),t.$set(_)},i(f){l||(v(e.$$.fragment,f),v(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&$(n),E(e,f),E(t,f)}}}function Q_(r,e,n){let t,l;V(r,Kr,d=>n(2,t=d)),V(r,br,d=>n(3,l=d));let{$$slots:o={},$$scope:i}=e,s=pl("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:f=(d,m)=>{}}=e;function u(d,m){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?Nt(["get","speed_mph"],vs,$s):m<=2?at("white","blue"):at(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",m,"#A32015"],$n.mapFeature.hover.backgroundColor)}function c(d,m,g){return!d||m<=2?an(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,m,25+g]}const _=d=>a&&f(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&n(0,a=d.interactive),"onClickLine"in d&&n(1,f=d.onClickLine),"$$scope"in d&&n(9,i=d.$$scope)},[a,f,t,l,s,u,c,o,_,i]}class nr extends se{constructor(e){super(),ae(this,e,Q_,V_,le,{interactive:0,onClickLine:1})}}function x_(r){let e;const n=r[3].default,t=Re(n,r,r[5],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&32)&&De(t,n,l,l[5],e?He(n,l[5],o,null):Ue(l[5]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function em(r){let e,n,t,l;const o=[we("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[x_]},$$scope:{ctx:r}};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new kr({props:i}),e.$on("click",r[4]);const s=[we("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new kr({props:a}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),l=!0},p(f,u){const c={};u&32&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};t.$set(_)},i(f){l||(v(e.$$.fragment,f),v(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&$(n),E(e,f),E(t,f)}}}function tm(r){let e,n;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[em]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&32&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function nm(r,e,n){let t,l,o;V(r,xe,f=>n(1,l=f)),V(r,zt,f=>n(2,o=f));let{$$slots:i={},$$scope:s}=e;function a(f){je.call(this,r,f)}return r.$$set=f=>{"$$scope"in f&&n(5,s=f.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=o>0?l.renderModalFilters():rn())},[t,l,o,i,a,s]}class gn extends se{constructor(e){super(),ae(this,e,nm,tm,le,{})}}function rm(r){let e,n;const t=[we("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new kr({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}class Nr extends se{constructor(e){super(),ae(this,e,null,rm,le,{})}}function lm(r){let e;const n=r[3].default,t=Re(n,r,r[4],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16)&&De(t,n,l,l[4],e?He(n,l[4],o,null):Ue(l[4]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function om(r){let e,n;return e=new Ve({props:{data:r[0],generateId:!0,$$slots:{default:[lm]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&16&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function im(r,e,n){let t,l;V(r,xe,a=>n(2,l=a));let{$$slots:o={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&n(1,s=a.input),"$$scope"in a&&n(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&n(0,t=s||l.renderNeighbourhood()),r.$$.dirty&1&&Vi("neighbourhoodGj",t)},[t,s,l,o,i]}class rr extends se{constructor(e){super(),ae(this,e,im,om,le,{input:1})}}function sm(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function am(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function fm(r){let e;return{c(){e=z("Editing")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function um(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Le({props:{$$slots:{default:[sm]},$$scope:{ctx:r}}}),o.$on("click",r[8]),a=new Le({props:{$$slots:{default:[am]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new Le({props:{$$slots:{default:[fm]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),P(c.$$.fragment),_=M(),d=k("li"),d.textContent="Debug mode",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){b(g,e,y),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),I(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&4096&&(h.$$scope={dirty:y,ctx:g}),o.$set(h);const w={};y&4096&&(w.$$scope={dirty:y,ctx:g}),a.$set(w);const C={};y&4096&&(C.$$scope={dirty:y,ctx:g}),c.$set(C)},i(g){m||(v(o.$$.fragment,g),v(a.$$.fragment,g),v(c.$$.fragment,g),m=!0)},o(g){S(o.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&$(e),E(o),E(a),E(c)}}}function ti(r){let e,n,t;return{c(){e=k("button"),e.textContent="Ⓧ",N(e,"class","close-btn svelte-khnvno")},m(l,o){b(l,e,o),n||(t=K(e,"click",r[6]),n=!0)},p:Q,d(l){l&&$(e),n=!1,t()}}}function cm(r){let e;return{c(){e=k("p"),e.textContent="Click an intersection to inspect its movements."},m(n,t){b(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function dm(r){let e,n,t,l,o,i,s;e=new Qn({props:{properties:r[0].feature.properties}});function a(u){r[7](u)}let f={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(f.idx=r[0].movementIdx),o=new Pr({props:f}),Ge.push(()=>ut(o,"idx",a)),{c(){P(e.$$.fragment),n=M(),t=k("h5"),t.textContent="Turn restrictions:",l=M(),P(o.$$.fragment)},m(u,c){I(e,u,c),b(u,n,c),b(u,t,c),b(u,l,c),I(o,u,c),s=!0},p(u,c){const _={};c&1&&(_.properties=u[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=u[0].movements.features),!i&&c&1&&(i=!0,d.idx=u[0].movementIdx,ct(()=>i=!1)),o.$set(d)},i(u){s||(v(e.$$.fragment,u),v(o.$$.fragment,u),s=!0)},o(u){S(e.$$.fragment,u),S(o.$$.fragment,u),s=!1},d(u){u&&($(n),$(t),$(l)),E(e,u),E(o,u)}}}function _m(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;n=new pn({}),n.$on("click",r[5]);let g=r[0]&&ti(r);const y=[dm,cm],h=[];function w(C,L){return C[0]?0:1}return _=w(r),d=h[_]=y[_](r),{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("h4"),l.textContent="Roads",o=M(),i=k("p"),i.textContent="Click a road to visit its OSM object.",s=M(),a=k("div"),f=k("h4"),f.textContent="Intersections",u=M(),g&&g.c(),c=M(),d.c(),oe(a,"display","flex"),oe(a,"align-items","start"),oe(a,"justify-content","space-between"),N(e,"slot","sidebar")},m(C,L){b(C,e,L),I(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(e,s),p(e,a),p(a,f),p(a,u),g&&g.m(a,null),p(e,c),h[_].m(e,null),m=!0},p(C,L){C[0]?g?g.p(C,L):(g=ti(C),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let F=_;_=w(C),_===F?h[_].p(C,L):(he(),S(h[F],1,1,()=>{h[F]=null}),be(),d=h[_],d?d.p(C,L):(d=h[_]=y[_](C),d.c()),v(d,1),d.m(e,null))},i(C){m||(v(n.$$.fragment,C),v(d),m=!0)},o(C){S(n.$$.fragment,C),S(d),m=!1},d(C){C&&$(e),E(n),g&&g.d(),h[_].d()}}}function mm(r){let e,n;return e=new Qn({props:{properties:r[11]}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function pm(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[mm,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function gm(r){let e,n;return e=new Qn({props:{properties:r[11]}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function hm(r){let e,n,t;return n=new dt({props:{openOn:"hover",$$slots:{default:[gm,({props:l})=>({11:l}),({props:l})=>l?2048:0]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o&6144&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function bm(r){let e,n,t,l,o,i,s,a,f,u;e=new Er({}),t=new Ir({}),o=new Nr({});const c=[we("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[pm]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=_e(_,c[d]);return s=new on({props:_}),f=new nr({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[hm]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),P(s.$$.fragment),a=M(),P(f.$$.fragment)},m(d,m){I(e,d,m),b(d,n,m),I(t,d,m),b(d,l,m),I(o,d,m),b(d,i,m),I(s,d,m),b(d,a,m),I(f,d,m),u=!0},p(d,m){const g={};m&4096&&(g.$$scope={dirty:m,ctx:d}),s.$set(g);const y={};m&4096&&(y.$$scope={dirty:m,ctx:d}),f.$set(y)},i(d){u||(v(e.$$.fragment,d),v(t.$$.fragment,d),v(o.$$.fragment,d),v(s.$$.fragment,d),v(f.$$.fragment,d),u=!0)},o(d){S(e.$$.fragment,d),S(t.$$.fragment,d),S(o.$$.fragment,d),S(s.$$.fragment,d),S(f.$$.fragment,d),u=!1},d(d){d&&($(n),$(l),$(i),$(a)),E(e,d),E(t,d),E(o,d),E(s,d),E(f,d)}}}function $m(r){let e,n;return e=new Qn({props:{properties:r[11]}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function vm(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[$m,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ym(r){let e,n;return e=new Qn({props:{properties:r[11]}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&2048&&(o.properties=t[11]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function wm(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[ym,({props:t})=>({11:t}),({props:t})=>t?2048:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&6144&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function km(r){var o,i,s;let e,n;const t=[we("debug-intersections"),{paint:{"circle-radius":tl(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(o=r[0])==null?void 0:o.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,at(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[wm]},$$scope:{ctx:r}};for(let a=0;a<t.length;a+=1)l=_e(l,t[a]);return e=new on({props:l}),e.$on("click",r[3]),{c(){P(e.$$.fragment)},m(a,f){I(e,a,f),n=!0},p(a,f){var c,_,d;const u=f&1?Oe(t,[t[0],{paint:{"circle-radius":tl(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,at(0,.5)]}},t[2],t[3]]):{};f&4096&&(u.$$scope={dirty:f,ctx:a}),e.$set(u)},i(a){n||(v(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){E(e,a)}}}function ni(r){let e,n;return e=new Ve({props:{data:r[0].movements,generateId:!0,$$slots:{default:[Sm]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.data=t[0].movements),l&4097&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Sm(r){let e,n,t,l;const o=[we("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new tt({props:i});const s=[we("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new wt({props:a}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _=u&1?Oe(s,[s[0],{filter:["==",["id"],f[0].movementIdx]},s[2]]):{};t.$set(_)},i(f){l||(v(e.$$.fragment,f),v(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&$(n),E(e,f),E(t,f)}}}function Cm(r){let e,n,t,l,o,i,s,a;n=new rr({props:{$$slots:{default:[bm]},$$scope:{ctx:r}}}),l=new gn({props:{$$slots:{default:[vm]},$$scope:{ctx:r}}}),i=new Ve({props:{data:ft(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[km]},$$scope:{ctx:r}}});let f=r[0]&&ni(r);return{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),o=M(),P(i.$$.fragment),s=M(),f&&f.c(),N(e,"slot","map")},m(u,c){b(u,e,c),I(n,e,null),p(e,t),I(l,e,null),p(e,o),I(i,e,null),p(e,s),f&&f.m(e,null),a=!0},p(u,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:u}),l.$set(d);const m={};c&2&&(m.data=ft(u[1]).getAllIntersections()),c&4097&&(m.$$scope={dirty:c,ctx:u}),i.$set(m),u[0]?f?(f.p(u,c),c&1&&v(f,1)):(f=ni(u),f.c(),v(f,1),f.m(e,null)):f&&(he(),S(f,1,1,()=>{f=null}),be())},i(u){a||(v(n.$$.fragment,u),v(l.$$.fragment,u),v(i.$$.fragment,u),v(f),a=!0)},o(u){S(n.$$.fragment,u),S(l.$$.fragment,u),S(i.$$.fragment,u),S(f),a=!1},d(u){u&&$(e),E(n),E(l),E(i),f&&f.d()}}}function Lm(r){let e,n;return e=new At({props:{$$slots:{map:[Cm],sidebar:[_m],top:[um]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&4103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Mm(r,e,n){let t,l;V(r,xe,m=>n(1,t=m)),V(r,ce,m=>n(2,l=m));let o=null;function i(m){let g=m.detail.features[0],y=t.getMovements(g.properties.intersection_id);n(0,o={feature:g,movements:y,movementIdx:0})}const s=(m,g)=>window.open(ft(m.properties).way,"_blank"),a=()=>te(ce,l={mode:"neighbourhood"},l),f=()=>n(0,o=null);function u(m){r.$$.not_equal(o.movementIdx,m)&&(o.movementIdx=m,n(0,o))}return[o,t,l,i,s,a,f,u,()=>te(ce,l={mode:"title",firstLoad:!1},l),()=>te(ce,l={mode:"pick-neighbourhood"},l),()=>te(ce,l={mode:"neighbourhood"},l)]}class Tm extends se{constructor(e){super(),ae(this,e,Mm,Lm,le,{})}}var Et=63710088e-1,Cs={centimeters:Et*100,centimetres:Et*100,degrees:360/(2*Math.PI),feet:Et*3.28084,inches:Et*39.37,kilometers:Et/1e3,kilometres:Et/1e3,meters:Et,metres:Et,miles:Et/1609.344,millimeters:Et*1e3,millimetres:Et*1e3,nauticalmiles:Et/1852,radians:1,yards:Et*1.0936};function Am(r,e,n={}){const t={type:"Feature"};return(n.id===0||n.id)&&(t.id=n.id),n.bbox&&(t.bbox=n.bbox),t.properties=e||{},t.geometry=r,t}function ul(r,e,n={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ri(r[0])||!ri(r[1]))throw new Error("coordinates must contain numbers");return Am({type:"Point",coordinates:r},e,n)}function Fm(r,e="kilometers"){const n=Cs[e];if(!n)throw new Error(e+" units is invalid");return r*n}function Pm(r,e="kilometers"){const n=Cs[e];if(!n)throw new Error(e+" units is invalid");return r/n}function cl(r){return r%(2*Math.PI)*180/Math.PI}function qt(r){return r%360*Math.PI/180}function ri(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Vn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Im(r){return r.type==="Feature"?r.geometry:r}function Ls(r,e,n={}){if(n.final===!0)return Em(r,e);const t=Vn(r),l=Vn(e),o=qt(t[0]),i=qt(l[0]),s=qt(t[1]),a=qt(l[1]),f=Math.sin(i-o)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-o);return cl(Math.atan2(f,u))}function Em(r,e){let n=Ls(e,r);return n=(n+180)%360,n}function Nm(r,e,n,t={}){const l=Vn(r),o=qt(l[0]),i=qt(l[1]),s=qt(n),a=Pm(e,t.units),f=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),u=o+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(f)),c=cl(u),_=cl(f);return ul([c,_],t.properties)}function jm(r,e,n={}){var t=Vn(r),l=Vn(e),o=qt(l[1]-t[1]),i=qt(l[0]-t[0]),s=qt(t[1]),a=qt(l[1]),f=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return Fm(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),n.units)}function zm(r,e,n={}){const l=Im(r).coordinates;let o=0;for(let i=0;i<l.length&&!(e>=o&&i===l.length-1);i++)if(o>=e){const s=e-o;if(s){const a=Ls(l[i],l[i-1])-180;return Nm(l[i],s,a,n)}else return ul(l[i])}else o+=jm(l[i],l[i+1],n);return ul(l[l.length-1])}var Om=zm;function Bm(r){let e,n;const t=[we("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Rm(r){let e,n;return e=new Ve({props:{data:r[0],$$slots:{default:[Bm]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}let Dm=50,Um=100,Hm=.01;function Gm(r,e,n){let{paths:t}=e,l=a(),o=f(),i=c(),s=setInterval(_,Um);Tt(()=>clearInterval(s));function a(){return t.features.map(d=>1/d.properties.directness).reduce((d,m)=>d+m,0)}function f(){return t.features.length==0?[]:Array.from({length:Dm},u)}function u(){let d=Math.random()*l,m=0;for(let[g,y]of t.features.entries())if(m+=1/y.properties.directness,d<m)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function c(){return{type:"FeatureCollection",features:o.map(({idx:d,distance:m})=>Om(t.features[d],m,{units:"kilometers"}))}}function _(){for(let[d,m]of o.entries())m.distance+=Hm,m.distance>=t.features[m.idx].properties.length_meters/1e3&&(o[d]=u());n(0,i=c())}return r.$$set=d=>{"paths"in d&&n(1,t=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&t&&(l=a(),o=f())},[i,t]}class Wm extends se{constructor(e){super(),ae(this,e,Gm,Rm,le,{paths:1})}}class qm{constructor(e){pt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function Jm(r){let e,n,t,l,o;return{c(){e=k("div"),e.textContent="+",n=M(),t=k("img"),o=z(`
    Add diagonal filter`),oe(e,"font-size","200%"),oe(e,"margin-top","-12px"),N(e,"class","icon"),Ke(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Add diagonal filter"),oe(t,"transform","rotate(135deg)"),N(t,"class","svelte-j2s60j")},m(i,s){b(i,e,s),b(i,n,s),b(i,t,s),b(i,o,s)},p:Q,d(i){i&&($(e),$(n),$(t),$(o))}}}function Ym(r){let e;function n(o,i){return o[0].hasRotatedFilter?Km:Zm}let t=n(r),l=t(r);return{c(){l.c(),e=Ye()},m(o,i){l.m(o,i),b(o,e,i)},p(o,i){t!==(t=n(o))&&(l.d(1),l=t(o),l&&(l.c(),l.m(e.parentNode,e)))},d(o){o&&$(e),l.d(o)}}}function Zm(r){let e,n,t,l,o;return{c(){e=k("div"),e.textContent="↻",n=M(),t=k("img"),o=z(`
      Rotate diagonal filter`),oe(e,"font-size","200%"),oe(e,"padding-bottom","4px"),N(e,"class","icon"),Ke(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Rotate diagonal filter"),oe(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){b(i,e,s),b(i,n,s),b(i,t,s),b(i,o,s)},d(i){i&&($(e),$(n),$(t),$(o))}}}function Km(r){let e,n,t,l,o;return{c(){e=k("div"),e.textContent="❌",n=M(),t=k("img"),o=z(`
      Delete diagonal filter`),N(e,"class","icon"),Ke(t.src,l="/ltn//filters/diagonal_filter_icon.png")||N(t,"src",l),N(t,"alt","Remove diagonal filter"),oe(t,"transform","rotate(45deg)"),N(t,"class","svelte-j2s60j")},m(i,s){b(i,e,s),b(i,n,s),b(i,t,s),b(i,o,s)},d(i){i&&($(e),$(n),$(t),$(o))}}}function Xm(r){let e;function n(o,i){return o[0].filter?Ym:Jm}let t=n(r),l=t(r);return{c(){e=k("div"),l.c(),oe(e,"display","flex"),oe(e,"align-items","center")},m(o,i){b(o,e,i),l.m(e,null)},p(o,[i]){t===(t=n(o))&&l?l.p(o,i):(l.d(1),l=t(o),l&&(l.c(),l.m(e,null)))},i:Q,o:Q,d(o){o&&$(e),l.d()}}}function Vm(r,e,n){let{intersection:t}=e;return r.$$set=l=>{"intersection"in l&&n(0,t=l.intersection)},[t]}class Qm extends se{constructor(e){super(),ae(this,e,Vm,Xm,le,{intersection:0})}}function xm(r){let e,n;return e=new Qm({props:{intersection:r[2](r[6])}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&64&&(o.intersection=t[2](t[6])),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ep(r){let e,n;return e=new Vf({props:{openOn:"hover",$$slots:{default:[xm,({features:t})=>({6:t}),({features:t})=>t?64:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&192&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function tp(r){let e,n;const t=[we("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":tl(30),"circle-color":$n.mapFeature.hover.backgroundColor,"circle-opacity":at(0,.5),"circle-stroke-color":$n.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":at(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[ep]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new on({props:l}),e.$on("click",r[4]),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,[i]){const s=i&2?Oe(t,[t[0],t[1],t[2],{interactive:o[1]},t[4],t[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function np(r,e,n){let{neighbourhood:t=pl("neighbourhoodGj")}=e,{onClickIntersection:l=f=>{}}=e,{interactive:o=!1}=e;function i(f){let u=t.features[f];return new qm(u)}function s(f){return i(f[0].id)}const a=f=>l(s(f.detail.features));return r.$$set=f=>{"neighbourhood"in f&&n(3,t=f.neighbourhood),"onClickIntersection"in f&&n(0,l=f.onClickIntersection),"interactive"in f&&n(1,o=f.interactive)},[l,o,s,t,a]}class rp extends se{constructor(e){super(),ae(this,e,np,tp,le,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function li(r,e,n){const t=r.slice();return t[7]=e[n][0],t[8]=e[n][1],t[9]=e[n][2],t}function oi(r){let e,n,t,l,o,i,s=r[8]+"",a,f,u,c,_;function d(){return r[3](r[7])}return{c(){e=k("button"),n=k("img"),l=M(),o=k("br"),i=M(),a=z(s),f=M(),Ke(n.src,t=`/ltn//filters/${r[7]}_icon.gif`)||N(n,"src",t),N(n,"width","80"),N(n,"alt",r[8]),N(e,"class","outline"),oe(e,"width","100%"),e.disabled=u=r[0]==r[7]},m(m,g){b(m,e,g),p(e,n),p(e,l),p(e,o),p(e,i),p(e,a),p(e,f),c||(_=K(e,"click",d),c=!0)},p(m,g){r=m,g&1&&u!==(u=r[0]==r[7])&&(e.disabled=u)},d(m){m&&$(e),c=!1,_()}}}function lp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d=r[1][2]+"",m,g,y,h,w,C,L=Me(r[2]),F=[];for(let A=0;A<L.length;A+=1)F[A]=oi(li(r,L,A));function T(){return r[4](r[6])}return{c(){e=k("h3"),e.textContent="Choose a modal filter to place on streets",n=M(),t=k("table"),l=k("tr"),o=k("td");for(let A=0;A<F.length;A+=1)F[A].c();i=M(),s=k("td"),a=k("img"),c=M(),_=k("p"),m=z(d),g=M(),y=k("center"),h=k("button"),h.textContent="Confirm",Ke(a.src,f=`/ltn//filters/${r[0]}.gif`)||N(a,"src",f),N(a,"height","300"),N(a,"alt",u=r[1][1])},m(A,j){b(A,e,j),b(A,n,j),b(A,t,j),p(t,l),p(l,o);for(let O=0;O<F.length;O+=1)F[O]&&F[O].m(o,null);p(l,i),p(l,s),p(s,a),p(s,c),p(s,_),p(_,m),b(A,g,j),b(A,y,j),p(y,h),w||(C=K(h,"click",T),w=!0)},p(A,j){if(r=A,j&5){L=Me(r[2]);let O;for(O=0;O<L.length;O+=1){const U=li(r,L,O);F[O]?F[O].p(U,j):(F[O]=oi(U),F[O].c(),F[O].m(o,null))}for(;O<F.length;O+=1)F[O].d(1);F.length=L.length}j&1&&!Ke(a.src,f=`/ltn//filters/${r[0]}.gif`)&&N(a,"src",f),j&2&&u!==(u=r[1][1])&&N(a,"alt",u),j&2&&d!==(d=r[1][2]+"")&&ne(m,d)},d(A){A&&($(e),$(n),$(t),$(g),$(y)),st(F,A),w=!1,C()}}}function op(r){let e,n;return e=new Lr({props:{$$slots:{default:[lp,({dialog:t})=>({6:t}),({dialog:t})=>t?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&4163&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ip(r,e,n){let t,l;V(r,Xr,f=>n(0,l=f));let o=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=f=>te(Xr,l=f,l),s=f=>ft(f).close();function a(f){je.call(this,r,f)}return r.$$.update=()=>{r.$$.dirty&1&&n(1,t=o.find(f=>f[0]==l))},[l,t,o,i,s,a]}class sp extends se{constructor(e){super(),ae(this,e,ip,op,le,{})}}function ii(r){let e,n;return e=new Ve({props:{data:r[0],$$slots:{default:[ap]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.data=t[0]),l&64&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ap(r){let e,n;const t=[we("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function fp(r){let e,n,t=r[0]&&ii(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&v(t,1)):(t=ii(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function up(r,e,n){let{map:t}=e,l=null;const o=mn();t.on("dragstart",i),t.on("mousemove",s),t.on("mouseup",a),Tt(()=>{t.dragPan.enable(),t.off("dragstart",i),t.off("mousemove",s),t.off("mouseup",a)});function i(){t.dragPan.disable(),n(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(f){l&&(l.geometry.coordinates.push(f.lngLat.toArray()),n(0,l))}function a(){l&&(o("done",l),n(0,l=null))}return r.$$set=f=>{"map"in f&&n(1,t=f.map)},[l,t]}class cp extends se{constructor(e){super(),ae(this,e,up,fp,le,{map:1})}}function dp(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function _p(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function mp(r){let e;return{c(){e=k("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function pp(r){let e;return{c(){e=z("View shortcuts")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function gp(r){let e;return{c(){e=z("Route")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function hp(r){let e;return{c(){e=z("Impact routing to one destination")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function bp(r){let e;return{c(){e=z("Change this boundary")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function $p(r){let e;return{c(){e=z("Debug")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function vp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,w,C,L,F,T,A,j,O,U,R,B,H,G;return o=new Le({props:{$$slots:{default:[dp]},$$scope:{ctx:r}}}),o.$on("click",r[31]),a=new Le({props:{$$slots:{default:[_p]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new jt({props:{$$slots:{default:[mp]},$$scope:{ctx:r}}}),h=new Le({props:{$$slots:{default:[pp]},$$scope:{ctx:r}}}),h.$on("click",r[33]),L=new Le({props:{$$slots:{default:[gp]},$$scope:{ctx:r}}}),L.$on("click",r[34]),A=new Le({props:{$$slots:{default:[hp]},$$scope:{ctx:r}}}),A.$on("click",r[35]),U=new Le({props:{$$slots:{default:[bp]},$$scope:{ctx:r}}}),U.$on("click",r[36]),H=new Le({props:{$$slots:{default:[$p]},$$scope:{ctx:r}}}),H.$on("click",r[37]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),c=z(`Editing
          `),P(_.$$.fragment),d=M(),m=k("nav"),g=k("ul"),y=k("li"),P(h.$$.fragment),w=M(),C=k("li"),P(L.$$.fragment),F=M(),T=k("li"),P(A.$$.fragment),j=M(),O=k("li"),P(U.$$.fragment),R=M(),B=k("li"),P(H.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),oe(e,"display","flex"),oe(e,"justify-content","space-between")},m(Z,Y){b(Z,e,Y),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),p(u,c),I(_,u,null),p(e,d),p(e,m),p(m,g),p(g,y),I(h,y,null),p(g,w),p(g,C),I(L,C,null),p(g,F),p(g,T),I(A,T,null),p(g,j),p(g,O),I(U,O,null),p(g,R),p(g,B),I(H,B,null),G=!0},p(Z,Y){const ie={};Y[1]&1024&&(ie.$$scope={dirty:Y,ctx:Z}),o.$set(ie);const D={};Y[1]&1024&&(D.$$scope={dirty:Y,ctx:Z}),a.$set(D);const ve={};Y[1]&1024&&(ve.$$scope={dirty:Y,ctx:Z}),_.$set(ve);const ge={};Y[1]&1024&&(ge.$$scope={dirty:Y,ctx:Z}),h.$set(ge);const fe={};Y[1]&1024&&(fe.$$scope={dirty:Y,ctx:Z}),L.$set(fe);const ye={};Y[1]&1024&&(ye.$$scope={dirty:Y,ctx:Z}),A.$set(ye);const ue={};Y[1]&1024&&(ue.$$scope={dirty:Y,ctx:Z}),U.$set(ue);const Fe={};Y[1]&1024&&(Fe.$$scope={dirty:Y,ctx:Z}),H.$set(Fe)},i(Z){G||(v(o.$$.fragment,Z),v(a.$$.fragment,Z),v(_.$$.fragment,Z),v(h.$$.fragment,Z),v(L.$$.fragment,Z),v(A.$$.fragment,Z),v(U.$$.fragment,Z),v(H.$$.fragment,Z),G=!0)},o(Z){S(o.$$.fragment,Z),S(a.$$.fragment,Z),S(_.$$.fragment,Z),S(h.$$.fragment,Z),S(L.$$.fragment,Z),S(A.$$.fragment,Z),S(U.$$.fragment,Z),S(H.$$.fragment,Z),G=!1},d(Z){Z&&$(e),E(o),E(a),E(_),E(h),E(L),E(A),E(U),E(H)}}}function si(r){let e;return{c(){e=k("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function ai(r){let e,n;return e=new kn({props:{colorScale:$s,limits:vs}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function yp(r){let e,n,t;return{c(){e=z("Undo ("),n=z(r[4]),t=z(")")},m(l,o){b(l,e,o),b(l,n,o),b(l,t,o)},p(l,o){o[0]&16&&ne(n,l[4])},d(l){l&&($(e),$(n),$(t))}}}function wp(r){let e;return{c(){e=z("Undo")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function kp(r){let e,n,t;return{c(){e=z("Redo ("),n=z(r[5]),t=z(")")},m(l,o){b(l,e,o),b(l,n,o),b(l,t,o)},p(l,o){o[0]&32&&ne(n,l[5])},d(l){l&&($(e),$(n),$(t))}}}function Sp(r){let e;return{c(){e=z("Redo")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function fi(r){let e,n;return e=new sp({}),e.$on("close",r[30]),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Cp(r){let e,n,t,l,o=ft(r[6]).properties.name+"",i,s,a=ft(r[6]).properties.area_km2.toFixed(1)+"",f,u,c,_,d,m,g,y,h,w,C,L,F,T,A,j,O,U,R,B,H,G,Z,Y,ie,D,ve,ge,fe,ye,ue,Fe,Ze,Te,re,Je,Ne,ke,X,me,x,pe,$e,Se,W,_t,Be,We,kt,bt=r[8]>0&&si(),Qe=r[12]=="speeds"&&ai();function xt(Pe,lt){return Pe[4]==0?wp:yp}let en=xt(r),Ct=en(r);function or(Pe,lt){return Pe[5]==0?Sp:kp}let Ft=or(r),Pt=Ft(r),rt=r[3]&&fi(r);return{c(){e=k("div"),n=k("p"),t=z("Editing neighbourhood "),l=k("u"),i=z(o),s=z(`
      , with an area of `),f=z(a),u=z(" km²"),c=M(),bt&&bt.c(),_=M(),d=k("div"),m=k("button"),g=k("img"),h=z(`
        Add a modal filter`),C=M(),L=k("button"),F=z("Add many modal filters along line"),A=M(),j=k("button"),O=z("Reverse directions"),R=M(),B=k("button"),B.textContent="Change modal filter type",H=M(),G=k("label"),Z=k("input"),Y=z(`
      Animate shortcuts`),ie=M(),D=k("label"),ve=k("input"),ge=z(`
      Include perimeter roads`),fe=M(),ye=k("div"),ue=k("label"),Fe=z(`Draw roads:
        `),Ze=k("select"),Te=k("option"),Te.textContent="Worst shortcuts",re=k("option"),re.textContent="Cell",Je=k("option"),Je.textContent="Edits (either filter or direction)",Ne=k("option"),Ne.textContent="Speed limit",ke=M(),Qe&&Qe.c(),X=M(),me=k("div"),x=k("button"),Ct.c(),$e=M(),Se=k("button"),Pt.c(),_t=M(),rt&&rt.c(),Ke(g.src,y=`/ltn//filters/${r[9]}_icon.gif`)||N(g,"src",y),N(g,"width","30"),N(g,"alt","Add a modal filter"),m.disabled=w=r[0]=="filter",N(m,"data-tooltip","hotkey 1"),L.disabled=T=r[0]=="freehand-filters",N(L,"data-tooltip","hotkey 2"),j.disabled=U=r[0]=="oneway",N(j,"data-tooltip","hotkey 3"),oe(d,"display","flex"),oe(d,"justify-content","space-between"),N(Z,"type","checkbox"),N(ve,"type","checkbox"),Te.__value="shortcuts",ze(Te,Te.__value),re.__value="cells",ze(re,re.__value),Je.__value="edits",ze(Je,Je.__value),Ne.__value="speeds",ze(Ne,Ne.__value),r[12]===void 0&&fn(()=>r[29].call(Ze)),oe(ye,"border","1px solid black"),oe(ye,"padding","4px"),x.disabled=pe=r[4]==0,N(x,"data-tooltip","Ctrl+Z"),Se.disabled=W=r[5]==0,N(Se,"data-tooltip","Ctrl+Y"),oe(me,"display","flex"),oe(me,"justify-content","space-between"),N(e,"slot","sidebar")},m(Pe,lt){b(Pe,e,lt),p(e,n),p(n,t),p(n,l),p(l,i),p(n,s),p(n,f),p(n,u),p(e,c),bt&&bt.m(e,null),p(e,_),p(e,d),p(d,m),p(m,g),p(m,h),p(d,C),p(d,L),p(L,F),p(d,A),p(d,j),p(j,O),p(e,R),p(e,B),p(e,H),p(e,G),p(G,Z),Z.checked=r[11],p(G,Y),p(e,ie),p(e,D),p(D,ve),ve.checked=r[10],p(D,ge),p(e,fe),p(e,ye),p(ye,ue),p(ue,Fe),p(ue,Ze),p(Ze,Te),p(Ze,re),p(Ze,Je),p(Ze,Ne),yt(Ze,r[12],!0),p(ye,ke),Qe&&Qe.m(ye,null),p(e,X),p(e,me),p(me,x),Ct.m(x,null),p(me,$e),p(me,Se),Pt.m(Se,null),p(e,_t),rt&&rt.m(e,null),Be=!0,We||(kt=[K(m,"click",r[23]),K(L,"click",r[24]),K(j,"click",r[25]),K(B,"click",r[26]),K(Z,"change",r[27]),K(ve,"change",r[28]),K(ve,"change",r[14]),K(Ze,"change",r[29]),K(x,"click",r[19]),K(Se,"click",r[20])],We=!0)},p(Pe,lt){(!Be||lt[0]&64)&&o!==(o=ft(Pe[6]).properties.name+"")&&ne(i,o),(!Be||lt[0]&64)&&a!==(a=ft(Pe[6]).properties.area_km2.toFixed(1)+"")&&ne(f,a),Pe[8]>0?bt||(bt=si(),bt.c(),bt.m(e,_)):bt&&(bt.d(1),bt=null),(!Be||lt[0]&512&&!Ke(g.src,y=`/ltn//filters/${Pe[9]}_icon.gif`))&&N(g,"src",y),(!Be||lt[0]&1&&w!==(w=Pe[0]=="filter"))&&(m.disabled=w),(!Be||lt[0]&1&&T!==(T=Pe[0]=="freehand-filters"))&&(L.disabled=T),(!Be||lt[0]&1&&U!==(U=Pe[0]=="oneway"))&&(j.disabled=U),lt[0]&2048&&(Z.checked=Pe[11]),lt[0]&1024&&(ve.checked=Pe[10]),lt[0]&4096&&yt(Ze,Pe[12]),Pe[12]=="speeds"?Qe?lt[0]&4096&&v(Qe,1):(Qe=ai(),Qe.c(),v(Qe,1),Qe.m(ye,null)):Qe&&(he(),S(Qe,1,1,()=>{Qe=null}),be()),en===(en=xt(Pe))&&Ct?Ct.p(Pe,lt):(Ct.d(1),Ct=en(Pe),Ct&&(Ct.c(),Ct.m(x,null))),(!Be||lt[0]&16&&pe!==(pe=Pe[4]==0))&&(x.disabled=pe),Ft===(Ft=or(Pe))&&Pt?Pt.p(Pe,lt):(Pt.d(1),Pt=Ft(Pe),Pt&&(Pt.c(),Pt.m(Se,null))),(!Be||lt[0]&32&&W!==(W=Pe[5]==0))&&(Se.disabled=W),Pe[3]?rt?(rt.p(Pe,lt),lt[0]&8&&v(rt,1)):(rt=fi(Pe),rt.c(),v(rt,1),rt.m(e,null)):rt&&(he(),S(rt,1,1,()=>{rt=null}),be())},i(Pe){Be||(v(Qe),v(rt),Be=!0)},o(Pe){S(Qe),S(rt),Be=!1},d(Pe){Pe&&$(e),bt&&bt.d(),Qe&&Qe.d(),Ct.d(),Pt.d(),rt&&rt.d(),We=!1,nt(kt)}}}function Lp(r){let e;return{c(){e=k("p"),e.textContent="Click to change direction"},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function Mp(r){let e,n,t,l;return{c(){e=k("div"),n=k("img"),l=z(`
                Click to add modal filter`),Ke(n.src,t=`/ltn//filters/${r[9]}_icon.gif`)||N(n,"src",t),N(n,"width","20"),N(n,"alt","Add modal filter")},m(o,i){b(o,e,i),p(e,n),p(e,l)},p(o,i){i[0]&512&&!Ke(n.src,t=`/ltn//filters/${o[9]}_icon.gif`)&&N(n,"src",t)},d(o){o&&$(e)}}}function Tp(r){let e,n=r[40].shortcuts+"",t,l,o=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",f,u,c,_;function d(y,h){return y[0]=="filter"?Mp:Lp}let m=d(r),g=m(r);return{c(){e=k("p"),t=z(n),l=z(" shortcuts through "),i=z(o),s=z(`
              (`),f=z(a),u=z(" mph)"),c=M(),g.c(),_=Ye()},m(y,h){b(y,e,h),p(e,t),p(e,l),p(e,i),p(e,s),p(e,f),p(e,u),b(y,c,h),g.m(y,h),b(y,_,h)},p(y,h){h[1]&512&&n!==(n=y[40].shortcuts+"")&&ne(t,n),h[1]&512&&o!==(o=(y[40].name??"unnamed road")+"")&&ne(i,o),h[1]&512&&a!==(a=Math.round(y[40].speed_mph)+"")&&ne(f,a),m===(m=d(y))&&g?g.p(y,h):(g.d(1),g=m(y),g&&(g.c(),g.m(_.parentNode,_)))},d(y){y&&($(e),$(c),$(_)),g.d(y)}}}function Ap(r){let e,n,t;return n=new dt({props:{openOn:"hover",$$slots:{default:[Tp,({props:l})=>({40:l}),({props:l})=>[0,l?512:0]]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o[0]&513|o[1]&1536&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function Fp(r){let e,n,t,l,o,i,s,a,f,u;return e=new Er({}),t=new Ir({}),o=new Nr({}),s=new nr({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[Ap]},$$scope:{ctx:r}}}),f=new rp({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),P(s.$$.fragment),a=M(),P(f.$$.fragment)},m(c,_){I(e,c,_),b(c,n,_),I(t,c,_),b(c,l,_),I(o,c,_),b(c,i,_),I(s,c,_),b(c,a,_),I(f,c,_),u=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const m={};_[0]&1&&(m.interactive=c[0]=="filter"),_[0]&2&&(m.neighbourhood=c[1]),f.$set(m)},i(c){u||(v(e.$$.fragment,c),v(t.$$.fragment,c),v(o.$$.fragment,c),v(s.$$.fragment,c),v(f.$$.fragment,c),u=!0)},o(c){S(e.$$.fragment,c),S(t.$$.fragment,c),S(o.$$.fragment,c),S(s.$$.fragment,c),S(f.$$.fragment,c),u=!1},d(c){c&&($(n),$(l),$(i),$(a)),E(e,c),E(t,c),E(o,c),E(s,c),E(f,c)}}}function ui(r){let e,n;return e=new Wm({props:{paths:r[7]}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l[0]&128&&(o.paths=t[7]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Pp(r){let e;return{c(){e=z("Click to delete")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Ip(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Pp]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l[1]&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function ci(r){let e,n;return e=new cp({props:{map:ft(r[2])}}),e.$on("done",r[21]),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l[0]&4&&(o.map=ft(t[2])),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ep(r){let e,n,t,l,o,i,s;n=new rr({props:{input:r[1],$$slots:{default:[Fp]},$$scope:{ctx:r}}});let a=r[11]&&ui(r);o=new gn({props:{$$slots:{default:[Ip]},$$scope:{ctx:r}}}),o.$on("click",r[16]);let f=r[0]=="freehand-filters"&&ci(r);return{c(){e=k("div"),P(n.$$.fragment),t=M(),a&&a.c(),l=M(),P(o.$$.fragment),i=M(),f&&f.c(),N(e,"slot","map")},m(u,c){b(u,e,c),I(n,e,null),p(e,t),a&&a.m(e,null),p(e,l),I(o,e,null),p(e,i),f&&f.m(e,null),s=!0},p(u,c){const _={};c[0]&2&&(_.input=u[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_),u[11]?a?(a.p(u,c),c[0]&2048&&v(a,1)):(a=ui(u),a.c(),v(a,1),a.m(e,l)):a&&(he(),S(a,1,1,()=>{a=null}),be());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:u}),o.$set(d),u[0]=="freehand-filters"?f?(f.p(u,c),c[0]&1&&v(f,1)):(f=ci(u),f.c(),v(f,1),f.m(e,null)):f&&(he(),S(f,1,1,()=>{f=null}),be())},i(u){s||(v(n.$$.fragment,u),v(a),v(o.$$.fragment,u),v(f),s=!0)},o(u){S(n.$$.fragment,u),S(a),S(o.$$.fragment,u),S(f),s=!1},d(u){u&&$(e),E(n),a&&a.d(),E(o),f&&f.d()}}}function Np(r){let e,n,t,l;return e=new At({props:{$$slots:{map:[Ep],sidebar:[Cp],top:[vp]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0,t||(l=K(window,"keydown",r[18]),t=!0)},p(o,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o),t=!1,l()}}}function jp(r,e,n){let t,l,o,i,s,a,f,u,c;V(r,zt,re=>n(22,l=re)),V(r,Xr,re=>n(9,o=re)),V(r,xe,re=>n(38,i=re)),V(r,Jn,re=>n(10,s=re)),V(r,Qt,re=>n(2,a=re)),V(r,Tl,re=>n(11,f=re)),V(r,br,re=>n(12,u=re)),V(r,ce,re=>n(13,c=re));let _="filter",d=!1,m=0,g=0,y,h,w=i.getAllShortcuts();Tt(()=>{a.doubleClickZoom.enable()});function C(re){n(1,h=i.renderNeighbourhood()),n(6,y=h.features.find(Je=>Je.properties.kind=="boundary")),n(4,m=h.undo_length),n(5,g=h.redo_length),n(7,w=i.getAllShortcuts()),Tn()}function L(){i.setCurrentNeighbourhood(y.properties.name,s),te(zt,l++,l)}function F(re,Je){_=="filter"?(i.addModalFilter(Je,o),te(zt,l++,l)):_=="oneway"&&(i.toggleTravelFlow(re.properties.road),te(zt,l++,l))}function T(re){let Je=re.detail.features[0];i.deleteModalFilter(Je.properties.road),te(zt,l++,l)}function A(re){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}re.hasRotatedFilter?(i.deleteDiagonalFilter(re),te(zt,l++,l)):re.filter?(i.rotateDiagonalFilter(re),te(zt,l++,l)):(i.addDiagonalFilter(re),te(zt,l++,l))}function j(re){re.target.tagName!="INPUT"&&(re.ctrlKey&&re.key=="z"&&O(),re.ctrlKey&&re.key=="y"&&U(),re.key=="1"&&n(0,_="filter"),re.key=="2"&&n(0,_="freehand-filters"),re.key=="3"&&n(0,_="oneway"))}function O(){i.undo(),te(zt,l++,l)}function U(){i.redo(),te(zt,l++,l)}function R(re){let Je=re.detail;Je&&(i.addManyModalFilters(Je,o),te(zt,l++,l)),n(0,_="filter")}const B=()=>n(0,_="filter"),H=()=>n(0,_="freehand-filters"),G=()=>n(0,_="oneway"),Z=()=>n(3,d=!0);function Y(){f=this.checked,Tl.set(f)}function ie(){s=this.checked,Jn.set(s)}function D(){u=un(this),br.set(u)}const ve=()=>n(3,d=!1),ge=()=>te(ce,c={mode:"title",firstLoad:!1},c),fe=()=>te(ce,c={mode:"pick-neighbourhood"},c),ye=()=>te(ce,c={mode:"view-shortcuts"},c),ue=()=>te(ce,c={mode:"route",prevMode:"neighbourhood"},c),Fe=()=>te(ce,c={mode:"impact-one-destination"},c),Ze=()=>te(ce,c={mode:"set-boundary",name:ft(y).properties.name,existing:y},c),Te=()=>te(ce,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&C(),r.$$.dirty[0]&2&&n(8,t=h.features.filter(re=>re.properties.kind=="cell"&&re.properties.cell_color=="disconnected").length)},[_,h,a,d,m,g,y,w,t,o,s,f,u,c,L,F,T,A,j,O,U,R,l,B,H,G,Z,Y,ie,D,ve,ge,fe,ye,ue,Fe,Ze,Te]}class zp extends se{constructor(e){super(),ae(this,e,jp,Np,le,{},null,[-1,-1])}}function Op(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Bp(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Rp(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[Op]},$$scope:{ctx:r}}}),o.$on("click",r[7]),a=new Le({props:{$$slots:{default:[Bp]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){b(_,e,d),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(o.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&$(e),E(o),E(a)}}}function Dp(r){let e;return{c(){e=z("Pick a different road")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Up(r){let e,n,t,l,o,i,s,a;n=new Le({props:{$$slots:{default:[Dp]},$$scope:{ctx:r}}}),n.$on("click",r[5]);function f(c){r[6](c)}let u={list:r[2]};return r[0]!==void 0&&(u.idx=r[0]),l=new Pr({props:u}),Ge.push(()=>ut(l,"idx",f)),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),i=M(),s=k("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,N(e,"slot","sidebar")},m(c,_){b(c,e,_),I(n,e,null),p(e,t),I(l,e,null),p(e,i),p(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),n.$set(d);const m={};!o&&_&1&&(o=!0,m.idx=c[0],ct(()=>o=!1)),l.$set(m)},i(c){a||(v(n.$$.fragment,c),v(l.$$.fragment,c),a=!0)},o(c){S(n.$$.fragment,c),S(l.$$.fragment,c),a=!1},d(c){c&&$(e),E(n),E(l)}}}function Hp(r){let e,n;const t=[we("predict-impact"),{paint:{"line-width":Gt(["get","kind"],{focus:8},5),"line-color":Gt(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Gt(["get","kind"],{focus:1},.5)}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Gp(r){let e;return{c(){e=z("A")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Wp(r){let e;return{c(){e=z("B")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function qp(r){let e,n,t,l,o,i,s,a,f;return n=new Ve({props:{data:r[3](r[0]),$$slots:{default:[Hp]},$$scope:{ctx:r}}}),l=new wn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[Gp]},$$scope:{ctx:r}}}),i=new wn({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[Wp]},$$scope:{ctx:r}}}),a=new gn({}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),o=M(),P(i.$$.fragment),s=M(),P(a.$$.fragment),N(e,"slot","map")},m(u,c){b(u,e,c),I(n,e,null),p(e,t),I(l,e,null),p(e,o),I(i,e,null),p(e,s),I(a,e,null),f=!0},p(u,c){const _={};c&1&&(_.data=u[3](u[0])),c&1024&&(_.$$scope={dirty:c,ctx:u}),n.$set(_);const d={};c&1&&(d.lngLat=u[2][u[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:u}),l.$set(d);const m={};c&1&&(m.lngLat=u[2][u[0]][0].geometry.coordinates[u[2][u[0]][0].geometry.coordinates.length-1]),c&1024&&(m.$$scope={dirty:c,ctx:u}),i.$set(m)},i(u){f||(v(n.$$.fragment,u),v(l.$$.fragment,u),v(i.$$.fragment,u),v(a.$$.fragment,u),f=!0)},o(u){S(n.$$.fragment,u),S(l.$$.fragment,u),S(i.$$.fragment,u),S(a.$$.fragment,u),f=!1},d(u){u&&$(e),E(n),E(l),E(i),E(a)}}}function Jp(r){let e,n;return e=new At({props:{$$slots:{map:[qp],sidebar:[Up],top:[Rp]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1027&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Yp(r,e,n){let t,l;V(r,xe,d=>n(9,t=d)),V(r,ce,d=>n(1,l=d));let{road:o}=e;o.properties.kind="focus";let i=t.getImpactsOnRoad(o.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],o]}}const f=()=>te(ce,l={mode:"predict-impact"},l);function u(d){s=d,n(0,s)}const c=()=>te(ce,l={mode:"title",firstLoad:!1},l),_=()=>te(ce,l={mode:"pick-neighbourhood"},l);return r.$$set=d=>{"road"in d&&n(4,o=d.road)},[s,l,i,a,o,f,u,c,_]}class Zp extends se{constructor(e){super(),ae(this,e,Yp,Jp,le,{road:4})}}function Kp(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Xp(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Vp(r){let e;return{c(){e=z("Editing")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Qp(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Le({props:{$$slots:{default:[Kp]},$$scope:{ctx:r}}}),o.$on("click",r[12]),a=new Le({props:{$$slots:{default:[Xp]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new Le({props:{$$slots:{default:[Vp]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),P(c.$$.fragment),_=M(),d=k("li"),d.textContent="Impact routing to one destination",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){b(g,e,y),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),I(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&262144&&(h.$$scope={dirty:y,ctx:g}),o.$set(h);const w={};y&262144&&(w.$$scope={dirty:y,ctx:g}),a.$set(w);const C={};y&262144&&(C.$$scope={dirty:y,ctx:g}),c.$set(C)},i(g){m||(v(o.$$.fragment,g),v(a.$$.fragment,g),v(c.$$.fragment,g),m=!0)},o(g){S(o.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&$(e),E(o),E(a),E(c)}}}function xp(r){let e,n,t,l,o,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",f,u;return n=new pn({}),n.$on("click",r[5]),{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=M(),i=k("p"),s=z("Highest ratio is "),f=z(a),N(e,"slot","sidebar")},m(c,_){b(c,e,_),I(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(i,s),p(i,f),u=!0},p(c,_){(!u||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&ne(f,a)},i(c){u||(v(n.$$.fragment,c),u=!0)},o(c){S(n.$$.fragment,c),u=!1},d(c){c&&$(e),E(n)}}}function eg(r){let e,n;const t=[we("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new wt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function tg(r){let e,n=dn(r[17].distance_before)+"",t,l,o=_n(r[17].time_before)+"",i,s,a,f,u=dn(r[17].distance_after)+"",c,_,d=_n(r[17].time_after)+"",m,g,y,h,w,C=(r[17].time_after/r[17].time_before).toFixed(1)+"",L;return{c(){e=k("p"),t=z(n),l=z(", "),i=z(o),s=z(" before"),a=M(),f=k("p"),c=z(u),_=z(", "),m=z(d),g=z(" after"),y=M(),h=k("p"),w=z("Time ratio: "),L=z(C)},m(F,T){b(F,e,T),p(e,t),p(e,l),p(e,i),p(e,s),b(F,a,T),b(F,f,T),p(f,c),p(f,_),p(f,m),p(f,g),b(F,y,T),b(F,h,T),p(h,w),p(h,L)},p(F,T){T&131072&&n!==(n=dn(F[17].distance_before)+"")&&ne(t,n),T&131072&&o!==(o=_n(F[17].time_before)+"")&&ne(i,o),T&131072&&u!==(u=dn(F[17].distance_after)+"")&&ne(c,u),T&131072&&d!==(d=_n(F[17].time_after)+"")&&ne(m,d),T&131072&&C!==(C=(F[17].time_after/F[17].time_before).toFixed(1)+"")&&ne(L,C)},d(F){F&&($(e),$(a),$(f),$(y),$(h))}}}function ng(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[tg,({props:t})=>({17:t}),({props:t})=>t?131072:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&393216&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function rg(r){let e,n,t;const l=[we("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[9](s)}let i={$$slots:{default:[ng]},$$scope:{ctx:r}};for(let s=0;s<l.length;s+=1)i=_e(i,l[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new tt({props:i}),Ge.push(()=>ut(e,"hovered",o)),e.$on("click",r[10]),{c(){P(e.$$.fragment)},m(s,a){I(e,s,a),t=!0},p(s,a){const f=a&8?Oe(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},l[2]]):{};a&262144&&(f.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,f.hovered=s[0],ct(()=>n=!1)),e.$set(f)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){S(e.$$.fragment,s),t=!1},d(s){E(e,s)}}}function lg(r){let e,n;const t=[we("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Gt(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function og(r){let e;return{c(){e=z("X")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function ig(r){let e,n,t,l,o,i,s,a,f,u,c,_;n=new rr({props:{$$slots:{default:[eg]},$$scope:{ctx:r}}}),l=new Ve({props:{data:r[3],generateId:!0,$$slots:{default:[rg]},$$scope:{ctx:r}}}),i=new Ve({props:{data:r[2],$$slots:{default:[lg]},$$scope:{ctx:r}}}),a=new gn({});function d(g){r[11](g)}let m={draggable:!0,$$slots:{default:[og]},$$scope:{ctx:r}};return r[1]!==void 0&&(m.lngLat=r[1]),u=new wn({props:m}),Ge.push(()=>ut(u,"lngLat",d)),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),o=M(),P(i.$$.fragment),s=M(),P(a.$$.fragment),f=M(),P(u.$$.fragment),N(e,"slot","map")},m(g,y){b(g,e,y),I(n,e,null),p(e,t),I(l,e,null),p(e,o),I(i,e,null),p(e,s),I(a,e,null),p(e,f),I(u,e,null),_=!0},p(g,y){const h={};y&262144&&(h.$$scope={dirty:y,ctx:g}),n.$set(h);const w={};y&8&&(w.data=g[3]),y&262153&&(w.$$scope={dirty:y,ctx:g}),l.$set(w);const C={};y&4&&(C.data=g[2]),y&262144&&(C.$$scope={dirty:y,ctx:g}),i.$set(C);const L={};y&262144&&(L.$$scope={dirty:y,ctx:g}),!c&&y&2&&(c=!0,L.lngLat=g[1],ct(()=>c=!1)),u.$set(L)},i(g){_||(v(n.$$.fragment,g),v(l.$$.fragment,g),v(i.$$.fragment,g),v(a.$$.fragment,g),v(u.$$.fragment,g),_=!0)},o(g){S(n.$$.fragment,g),S(l.$$.fragment,g),S(i.$$.fragment,g),S(a.$$.fragment,g),S(u.$$.fragment,g),_=!1},d(g){g&&$(e),E(n),E(l),E(i),E(a),E(u)}}}function sg(r){let e,n,t,l;return e=new ps({}),e.$on("contextmenu",r[7]),t=new At({props:{$$slots:{map:[ig],sidebar:[xp],top:[Qp]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(o,i){I(e,o,i),b(o,n,i),I(t,o,i),l=!0},p(o,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:o}),t.$set(s)},i(o){l||(v(e.$$.fragment,o),v(t.$$.fragment,o),l=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),l=!1},d(o){o&&$(n),E(e,o),E(t,o)}}}function ag(r,e,n){let t,l,o,i,s,a,f;V(r,fr,L=>n(1,o=L)),V(r,ce,L=>n(4,i=L)),V(r,Yn,L=>n(14,s=L)),V(r,Zn,L=>n(15,a=L)),V(r,xe,L=>n(8,f=L));function u(){te(ce,i={mode:"neighbourhood"},i)}let c=null;function _(L){return L?f.compareRoute(new Vr.LngLat(L.properties.pt1_x,L.properties.pt1_y),o,1):rn()}function d(L){te(Zn,a=new Vr.LngLat(L.properties.pt1_x,L.properties.pt1_y),a),te(Yn,s=o,s),te(ce,i={mode:"route",prevMode:"impact-one-destination"},i)}function m(L){te(fr,o=L.detail.lngLat,o)}function g(L){c=L,n(0,c)}const y=L=>d(L.detail.features[0]);function h(L){o=L,fr.set(o)}const w=()=>te(ce,i={mode:"title",firstLoad:!1},i),C=()=>te(ce,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&n(3,t=f.impactToOneDestination(o)),r.$$.dirty&1&&n(2,l=_(c))},[c,o,l,t,i,u,d,m,f,g,y,h,w,C]}class fg extends se{constructor(e){super(),ae(this,e,ag,sg,le,{})}}function di(r,e,n){const t=r.slice();return t[32]=e[n].properties.name,t[33]=e[n].properties.area_km2,t[34]=e[n].properties.simd,t}function ug(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function cg(r){let e;return{c(){e=k("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function dg(r){let e;return{c(){e=z("Route")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function _g(r){let e;return{c(){e=z("Predict impact")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function mg(r){let e;return{c(){e=z("Debug intersections")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function pg(r){let e;return{c(){e=z("Debug demand")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function gg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h,w,C,L,F,T,A,j;return o=new Le({props:{$$slots:{default:[ug]},$$scope:{ctx:r}}}),o.$on("click",r[25]),f=new jt({props:{$$slots:{default:[cg]},$$scope:{ctx:r}}}),m=new Le({props:{$$slots:{default:[dg]},$$scope:{ctx:r}}}),m.$on("click",r[26]),h=new Le({props:{$$slots:{default:[_g]},$$scope:{ctx:r}}}),h.$on("click",r[27]),L=new Le({props:{$$slots:{default:[mg]},$$scope:{ctx:r}}}),L.$on("click",r[28]),A=new Le({props:{$$slots:{default:[pg]},$$scope:{ctx:r}}}),A.$on("click",r[29]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),a=z(`Pick neighbourhood
          `),P(f.$$.fragment),u=M(),c=k("nav"),_=k("ul"),d=k("li"),P(m.$$.fragment),g=M(),y=k("li"),P(h.$$.fragment),w=M(),C=k("li"),P(L.$$.fragment),F=M(),T=k("li"),P(A.$$.fragment),N(n,"aria-label","breadcrumb"),N(e,"slot","top"),oe(e,"display","flex"),oe(e,"justify-content","space-between")},m(O,U){b(O,e,U),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),p(s,a),I(f,s,null),p(e,u),p(e,c),p(c,_),p(_,d),I(m,d,null),p(_,g),p(_,y),I(h,y,null),p(_,w),p(_,C),I(L,C,null),p(_,F),p(_,T),I(A,T,null),j=!0},p(O,U){const R={};U[1]&64&&(R.$$scope={dirty:U,ctx:O}),o.$set(R);const B={};U[1]&64&&(B.$$scope={dirty:U,ctx:O}),f.$set(B);const H={};U[1]&64&&(H.$$scope={dirty:U,ctx:O}),m.$set(H);const G={};U[1]&64&&(G.$$scope={dirty:U,ctx:O}),h.$set(G);const Z={};U[1]&64&&(Z.$$scope={dirty:U,ctx:O}),L.$set(Z);const Y={};U[1]&64&&(Y.$$scope={dirty:U,ctx:O}),A.$set(Y)},i(O){j||(v(o.$$.fragment,O),v(f.$$.fragment,O),v(m.$$.fragment,O),v(h.$$.fragment,O),v(L.$$.fragment,O),v(A.$$.fragment,O),j=!0)},o(O){S(o.$$.fragment,O),S(f.$$.fragment,O),S(m.$$.fragment,O),S(h.$$.fragment,O),S(L.$$.fragment,O),S(A.$$.fragment,O),j=!1},d(O){O&&$(e),E(o),E(f),E(m),E(h),E(L),E(A)}}}function hg(r){let e=r[32]+"",n;return{c(){n=z(e)},m(t,l){b(t,n,l)},p(t,l){l[0]&1&&e!==(e=t[32]+"")&&ne(n,e)},d(t){t&&$(n)}}}function bg(r){let e,n,t,l=r[34].toFixed(1)+"",o;return{c(){e=k("span"),n=k("b"),n.textContent="SIMD (percentile):",t=M(),o=z(l)},m(i,s){b(i,e,s),p(e,n),p(e,t),p(e,o)},p(i,s){s[0]&1&&l!==(l=i[34].toFixed(1)+"")&&ne(o,l)},d(i){i&&$(e)}}}function $g(r){let e,n,t,l=r[33].toFixed(1)+"",o,i;return{c(){e=k("span"),n=k("b"),n.textContent="Area:",t=M(),o=z(l),i=z(" km²")},m(s,a){b(s,e,a),p(e,n),p(e,t),p(e,o),p(e,i)},p(s,a){a[0]&1&&l!==(l=s[33].toFixed(1)+"")&&ne(o,l)},d(s){s&&$(e)}}}function _i(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g;function y(){return r[18](r[32])}l=new Le({props:{$$slots:{default:[hg]},$$scope:{ctx:r}}}),l.$on("click",y),a=new wl({props:{color:"black"}});function h(){return r[19](r[32])}c=new gs({props:{color:"white"}});function w(){return r[20](r[32])}function C(A,j){if(A[1]=="area")return $g;if(A[1]=="simd")return bg}let L=C(r),F=L&&L(r);function T(){return r[21](r[32])}return{c(){var A;e=k("li"),n=k("span"),t=k("span"),P(l.$$.fragment),o=M(),i=k("span"),s=k("button"),P(a.$$.fragment),f=M(),u=k("button"),P(c.$$.fragment),_=M(),F&&F.c(),N(t,"class","neighbourhood-name svelte-v2avug"),N(s,"class","outline icon-btn"),N(s,"aria-label","Rename neighbourhood"),N(u,"class","icon-btn destructive"),N(u,"aria-label","Delete neighbourhood"),oe(i,"display","flex"),oe(i,"gap","16px"),oe(n,"display","flex"),oe(n,"justify-content","space-between"),N(e,"class","svelte-v2avug"),gt(e,"highlighted",((A=r[3])==null?void 0:A.properties.name)==r[32])},m(A,j){b(A,e,j),p(e,n),p(n,t),I(l,t,null),p(n,o),p(n,i),p(i,s),I(a,s,null),p(i,f),p(i,u),I(c,u,null),p(e,_),F&&F.m(e,null),d=!0,m||(g=[K(s,"click",h),K(u,"click",w),K(e,"mouseenter",T),K(e,"mouseleave",r[22])],m=!0)},p(A,j){var U;r=A;const O={};j[0]&1|j[1]&64&&(O.$$scope={dirty:j,ctx:r}),l.$set(O),L===(L=C(r))&&F?F.p(r,j):(F&&F.d(1),F=L&&L(r),F&&(F.c(),F.m(e,null))),(!d||j[0]&9)&&gt(e,"highlighted",((U=r[3])==null?void 0:U.properties.name)==r[32])},i(A){d||(v(l.$$.fragment,A),v(a.$$.fragment,A),v(c.$$.fragment,A),d=!0)},o(A){S(l.$$.fragment,A),S(a.$$.fragment,A),S(c.$$.fragment,A),d=!1},d(A){A&&$(e),E(l),E(a),E(c),F&&F.d(),m=!1,nt(g)}}}function vg(r){let e,n,t;return e=new wl({}),{c(){P(e.$$.fragment),n=z(`
              Draw a new boundary`)},m(l,o){I(e,l,o),b(l,n,o),t=!0},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){l&&$(n),E(e,l)}}}function yg(r){let e,n,t;return e=new Fu({}),{c(){P(e.$$.fragment),n=z(`
              Use a generated boundary`)},m(l,o){I(e,l,o),b(l,n,o),t=!0},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){l&&$(n),E(e,l)}}}function mi(r){let e,n,t,l,o,i,s,a,f;function u(_){r[24](_)}let c={};return r[1]!==void 0&&(c.selectedPrioritization=r[1]),o=new Ss({props:c}),Ge.push(()=>ut(o,"selectedPrioritization",u)),{c(){e=k("h3"),e.textContent="Prioritization",n=M(),t=k("p"),t.textContent="Compare metrics across your neighbourhoods.",l=M(),P(o.$$.fragment),s=M(),a=k("hr")},m(_,d){b(_,e,d),b(_,n,d),b(_,t,d),b(_,l,d),I(o,_,d),b(_,s,d),b(_,a,d),f=!0},p(_,d){const m={};!i&&d[0]&2&&(i=!0,m.selectedPrioritization=_[1],ct(()=>i=!1)),o.$set(m)},i(_){f||(v(o.$$.fragment,_),f=!0)},o(_){S(o.$$.fragment,_),f=!1},d(_){_&&($(e),$(n),$(t),$(l),$(s),$(a)),E(o,_)}}}function wg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g=r[5].startsWith("ltn_cnt/"),y,h,w,C,L,F,T=r[4].modalFilters+"",A,j,O,U,R=r[4].deletedModalFilters+"",B,H,G,Z,Y=r[4].travelFlows+"",ie,D,ve,ge,fe,ye,ue,Fe,Ze,Te=Me(r[0].features),re=[];for(let ke=0;ke<Te.length;ke+=1)re[ke]=_i(di(r,Te,ke));const Je=ke=>S(re[ke],1,1,()=>{re[ke]=null});u=new Le({props:{$$slots:{default:[vg]},$$scope:{ctx:r}}}),u.$on("click",r[10]),d=new Le({props:{$$slots:{default:[yg]},$$scope:{ctx:r}}}),d.$on("click",r[23]);let Ne=g&&mi(r);return{c(){e=k("div"),n=k("h3"),n.textContent="Neighbourhoods",t=M(),l=k("ul");for(let ke=0;ke<re.length;ke+=1)re[ke].c();o=M(),i=k("li"),s=z(`Add a new neighbourhood:
        `),a=k("ul"),f=k("li"),P(u.$$.fragment),c=M(),_=k("li"),P(d.$$.fragment),m=M(),Ne&&Ne.c(),y=M(),h=k("p"),w=z("Current project: "),C=z(r[5]),L=M(),F=k("p"),A=z(T),j=z(" new modal filter(s) added"),O=M(),U=k("p"),B=z(R),H=z(`
      existing modal filter(s) removed`),G=M(),Z=k("p"),ie=z(Y),D=z(" road segment direction(s) changed"),ve=M(),ge=k("button"),ge.textContent="Export project to GeoJSON",fe=M(),ye=k("button"),ye.textContent="Debug route-snapper",oe(n,"padding","4px 8px"),oe(n,"margin-bottom","0"),oe(f,"list-style","none"),oe(_,"list-style","none"),oe(a,"margin-bottom","0"),oe(a,"padding","0"),N(i,"class","svelte-v2avug"),N(l,"class","neighbourhood-list svelte-v2avug"),N(ye,"class","secondary"),N(e,"slot","sidebar")},m(ke,X){b(ke,e,X),p(e,n),p(e,t),p(e,l);for(let me=0;me<re.length;me+=1)re[me]&&re[me].m(l,null);p(l,o),p(l,i),p(i,s),p(i,a),p(a,f),I(u,f,null),p(a,c),p(a,_),I(d,_,null),p(e,m),Ne&&Ne.m(e,null),p(e,y),p(e,h),p(h,w),p(h,C),p(e,L),p(e,F),p(F,A),p(F,j),p(e,O),p(e,U),p(U,B),p(U,H),p(e,G),p(e,Z),p(Z,ie),p(Z,D),p(e,ve),p(e,ge),p(e,fe),p(e,ye),ue=!0,Fe||(Ze=[K(ge,"click",r[11]),K(ye,"click",r[12])],Fe=!0)},p(ke,X){if(X[0]&911){Te=Me(ke[0].features);let pe;for(pe=0;pe<Te.length;pe+=1){const $e=di(ke,Te,pe);re[pe]?(re[pe].p($e,X),v(re[pe],1)):(re[pe]=_i($e),re[pe].c(),v(re[pe],1),re[pe].m(l,o))}for(he(),pe=Te.length;pe<re.length;pe+=1)Je(pe);be()}const me={};X[1]&64&&(me.$$scope={dirty:X,ctx:ke}),u.$set(me);const x={};X[1]&64&&(x.$$scope={dirty:X,ctx:ke}),d.$set(x),X[0]&32&&(g=ke[5].startsWith("ltn_cnt/")),g?Ne?(Ne.p(ke,X),X[0]&32&&v(Ne,1)):(Ne=mi(ke),Ne.c(),v(Ne,1),Ne.m(e,y)):Ne&&(he(),S(Ne,1,1,()=>{Ne=null}),be()),(!ue||X[0]&32)&&ne(C,ke[5]),(!ue||X[0]&16)&&T!==(T=ke[4].modalFilters+"")&&ne(A,T),(!ue||X[0]&16)&&R!==(R=ke[4].deletedModalFilters+"")&&ne(B,R),(!ue||X[0]&16)&&Y!==(Y=ke[4].travelFlows+"")&&ne(ie,Y)},i(ke){if(!ue){for(let X=0;X<Te.length;X+=1)v(re[X]);v(u.$$.fragment,ke),v(d.$$.fragment,ke),v(Ne),ue=!0}},o(ke){re=re.filter(Boolean);for(let X=0;X<re.length;X+=1)S(re[X]);S(u.$$.fragment,ke),S(d.$$.fragment,ke),S(Ne),ue=!1},d(ke){ke&&$(e),st(re,ke),E(u),E(d),Ne&&Ne.d(),Fe=!1,nt(Ze)}}}function kg(r){let e,n,t=r[31].simd.toFixed(1)+"",l;return{c(){e=k("b"),e.textContent="Fake SIMD:",n=M(),l=z(t)},m(o,i){b(o,e,i),b(o,n,i),b(o,l,i)},p(o,i){i[1]&1&&t!==(t=o[31].simd.toFixed(1)+"")&&ne(l,t)},d(o){o&&($(e),$(n),$(l))}}}function Sg(r){let e,n,t=r[31].area_km2.toFixed(1)+"",l,o;return{c(){e=k("b"),e.textContent="Area:",n=M(),l=z(t),o=z(" km²")},m(i,s){b(i,e,s),b(i,n,s),b(i,l,s),b(i,o,s)},p(i,s){s[1]&1&&t!==(t=i[31].area_km2.toFixed(1)+"")&&ne(l,t)},d(i){i&&($(e),$(n),$(l),$(o))}}}function Cg(r){let e,n=r[31].name+"",t,l,o;function i(f,u){if(f[1]=="none"||f[1]=="area")return Sg;if(f[1]=="simd")return kg}let s=i(r),a=s&&s(r);return{c(){e=k("h2"),t=z(n),l=M(),a&&a.c(),o=Ye()},m(f,u){b(f,e,u),p(e,t),b(f,l,u),a&&a.m(f,u),b(f,o,u)},p(f,u){u[1]&1&&n!==(n=f[31].name+"")&&ne(t,n),s===(s=i(f))&&a?a.p(f,u):(a&&a.d(1),a=s&&s(f),a&&(a.c(),a.m(o.parentNode,o)))},d(f){f&&($(e),$(l),$(o)),a&&a.d(f)}}}function Lg(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Cg,({props:t})=>({31:t}),({props:t})=>[0,t?1:0]]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l[0]&2|l[1]&65&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Mg(r){let e,n,t,l,o;e=new Hf({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const i=[we("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function s(f){r[16](f)}let a={$$slots:{default:[Lg]},$$scope:{ctx:r}};for(let f=0;f<i.length;f+=1)a=_e(a,i[f]);return r[3]!==void 0&&(a.hovered=r[3]),t=new wt({props:a}),Ge.push(()=>ut(t,"hovered",s)),t.$on("click",r[17]),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),o=!0},p(f,u){const c={};u[0]&4&&(c.data=f[2]?[{name:f[2],highlight:"yes"}]:[]),e.$set(c);const _=u[0]&24578?Oe(i,[i[0],i[1],{paint:{"fill-color":f[13](f[1]),"fill-opacity":f[14](f[1])}},i[3],i[4]]):{};u[0]&2|u[1]&64&&(_.$$scope={dirty:u,ctx:f}),!l&&u[0]&8&&(l=!0,_.hovered=f[3],ct(()=>l=!1)),t.$set(_)},i(f){o||(v(e.$$.fragment,f),v(t.$$.fragment,f),o=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),o=!1},d(f){f&&$(n),E(e,f),E(t,f)}}}function Tg(r){let e,n,t,l,o;return n=new Ve({props:{data:r[0],promoteId:"name",$$slots:{default:[Mg]},$$scope:{ctx:r}}}),l=new gn({}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),N(e,"slot","map")},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s[0]&1&&(a.data=i[0]),s[0]&14|s[1]&64&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function Ag(r){let e,n;return e=new At({props:{$$slots:{map:[Tg],sidebar:[wg],top:[gg]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l[0]&127|l[1]&64&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Fg(r){let e=0,n=0,t=0;for(let l of r.features)l.properties.kind=="modal_filter"?e++:l.properties.kind=="deleted_existing_modal_filter"?n++:l.properties.kind=="travel_flow"&&t++;return{modalFilters:e,deletedModalFilters:n,travelFlows:t}}function Pg(r,e,n){let t,l,o,i,s,a;V(r,xe,D=>n(15,o=D)),V(r,Yt,D=>n(5,i=D)),V(r,ce,D=>n(6,s=D)),V(r,Jn,D=>n(30,a=D));let f="none",u=null,c=null;function _(D){o.setCurrentNeighbourhood(D,a),te(ce,s={mode:"neighbourhood"},s)}function d(D){window.confirm(`Really delete neighbourhood ${D}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(D),Tn(),n(0,t=o.getAllNeighbourhoods()))}function m(D){let ve=fl(o,`Rename neighbourhood ${D} to what?`,D);ve&&(o.renameNeighbourhoodBoundary(D,ve),Tn(),n(0,t=o.getAllNeighbourhoods()))}function g(){let D=fl(o,"What do you want to name the neighbourhood?","");D&&te(ce,s={mode:"set-boundary",name:D,existing:null},s)}function y(){$r(i+".geojson",JSON.stringify(o.toSavefile()))}function h(){$r("debug_route_snapper.geojson",o.toRouteSnapperGj())}function w(D){let ve={none:"black",simd:Nt(["get","simd"],tr,ln),area:Nt(["get","area_km2"],kl,ln)}[D];return["case",["==",["feature-state","highlight"],"yes"],"yellow",ve]}function C(D){return{none:at(.3,.5),simd:at(.7,.9),area:at(.7,.9)}[D]}function L(D){c=D,n(3,c)}const F=D=>_(ft(D.detail.features[0].properties).name),T=D=>_(D),A=D=>m(D),j=D=>d(D),O=D=>n(2,u=D),U=()=>n(2,u=null),R=()=>te(ce,s={mode:"auto-boundaries"},s);function B(D){f=D,n(1,f)}const H=()=>te(ce,s={mode:"title",firstLoad:!1},s),G=()=>te(ce,s={mode:"route",prevMode:"pick-neighbourhood"},s),Z=()=>te(ce,s={mode:"predict-impact"},s),Y=()=>te(ce,s={mode:"debug-intersections"},s),ie=()=>te(ce,s={mode:"debug-demand"},s);return r.$$.update=()=>{r.$$.dirty[0]&32768&&n(0,t=o.getAllNeighbourhoods()),r.$$.dirty[0]&1&&n(4,l=Fg(t))},[t,f,u,c,l,i,s,_,d,m,g,y,h,w,C,o,L,F,T,A,j,O,U,R,B,H,G,Z,Y,ie]}class Ig extends se{constructor(e){super(),ae(this,e,Pg,Ag,le,{},null,[-1,-1])}}function Eg(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Ng(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function jg(r){let e,n,t,l,o,i,s,a,f,u,c;return o=new Le({props:{$$slots:{default:[Eg]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Le({props:{$$slots:{default:[Ng]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),u.textContent="Predict impact",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(_,d){b(_,e,d),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),o.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(v(o.$$.fragment,_),v(a.$$.fragment,_),c=!0)},o(_){S(o.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&$(e),E(o),E(a)}}}function zg(r){let e,n,t,l,o,i,s,a,f;return n=new pn({}),n.$on("click",r[5]),{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),l.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,o=M(),i=k("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=M(),a=k("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,N(e,"slot","sidebar")},m(u,c){b(u,e,c),I(n,e,null),p(e,t),p(e,l),p(e,o),p(e,i),p(e,s),p(e,a),f=!0},p:Q,i(u){f||(v(n.$$.fragment,u),f=!0)},o(u){S(n.$$.fragment,u),f=!1},d(u){u&&$(e),E(n)}}}function Og(r){let e,n=r[9].before.toLocaleString()+"",t,l,o=r[9].after.toLocaleString()+"",i,s,a,f,u=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=k("p"),t=z(n),l=z(" before, "),i=z(o),s=z(`
            after`),a=M(),f=k("p"),c=z(u),_=z("%")},m(d,m){b(d,e,m),p(e,t),p(e,l),p(e,i),p(e,s),b(d,a,m),b(d,f,m),p(f,c),p(f,_)},p(d,m){m&512&&n!==(n=d[9].before.toLocaleString()+"")&&ne(t,n),m&512&&o!==(o=d[9].after.toLocaleString()+"")&&ne(i,o),m&512&&u!==(u=Math.round(100*d[9].after/d[9].before)+"")&&ne(c,u)},d(d){d&&($(e),$(a),$(f))}}}function Bg(r){let e,n;return e=new dt({props:{openOn:"hover",$$slots:{default:[Og,({props:t})=>({9:t}),({props:t})=>t?512:0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1536&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Rg(r){let e,n;const t=[we("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,pi,r[2].max_count,gi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[Bg]},$$scope:{ctx:r}};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),e.$on("click",r[4]),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s=i&6?Oe(t,[t[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,pi,o[2].max_count,gi],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,o[1][0],50,o[1][1],100,o[1][2],150,o[1][3],200,o[1][4]]]}},t[2],t[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Dg(r){let e,n,t,l,o;return n=new Ve({props:{data:r[2],generateId:!0,$$slots:{default:[Rg]},$$scope:{ctx:r}}}),l=new gn({}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),N(e,"slot","map")},m(i,s){b(i,e,s),I(n,e,null),p(e,t),I(l,e,null),o=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&$(e),E(n),E(l)}}}function Ug(r){let e,n;return e=new At({props:{$$slots:{map:[Dg],sidebar:[zg],top:[jg]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1025&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}let pi=3,gi=10;function Hg(r,e,n){let t,l;V(r,ce,_=>n(0,t=_)),V(r,xe,_=>n(8,l=_));let o=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=l.predictImpact();function s(_){te(ce,t={mode:"impact-detail",road:_},t)}return[t,o,i,s,_=>s(_.detail.features[0]),()=>te(ce,t={mode:"pick-neighbourhood"},t),()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class Gg extends se{constructor(e){super(),ae(this,e,Hg,Ug,le,{})}}function Wg(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function qg(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function hi(r){let e,n,t;return n=new Le({props:{$$slots:{default:[Jg]},$$scope:{ctx:r}}}),n.$on("click",r[13]),{c(){e=k("li"),P(n.$$.fragment)},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o&16384&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function Jg(r){let e;return{c(){e=z("Editing")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Yg(r){let e,n,t,l,o,i,s,a,f,u,c,_;o=new Le({props:{$$slots:{default:[Wg]},$$scope:{ctx:r}}}),o.$on("click",r[11]),a=new Le({props:{$$slots:{default:[qg]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&hi(r);return{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),d&&d.c(),u=M(),c=k("li"),c.textContent="Routing",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(m,g){b(m,e,g),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),d&&d.m(t,null),p(t,u),p(t,c),_=!0},p(m,g){const y={};g&16384&&(y.$$scope={dirty:g,ctx:m}),o.$set(y);const h={};g&16384&&(h.$$scope={dirty:g,ctx:m}),a.$set(h),m[0]=="neighbourhood"?d?(d.p(m,g),g&1&&v(d,1)):(d=hi(m),d.c(),v(d,1),d.m(t,u)):d&&(he(),S(d,1,1,()=>{d=null}),be())},i(m){_||(v(o.$$.fragment,m),v(a.$$.fragment,m),v(d),_=!0)},o(m){S(o.$$.fragment,m),S(a.$$.fragment,m),S(d),_=!1},d(m){m&&$(e),E(o),E(a),d&&d.d()}}}function bi(r){let e,n,t,l=dn(r[4].features[0].properties.distance)+"",o,i,s=_n(r[4].features[0].properties.time)+"",a,f,u,c,_,d=dn(r[4].features[1].properties.distance)+"",m,g,y=_n(r[4].features[1].properties.time)+"",h;return{c(){e=k("p"),n=k("span"),n.textContent="Route before",t=z(`
        : `),o=z(l),i=z(", "),a=z(s),f=M(),u=k("p"),c=k("span"),c.textContent="Route after",_=z(`
        : `),m=z(d),g=z(", "),h=z(y),oe(n,"color","red"),oe(c,"color","blue")},m(w,C){b(w,e,C),p(e,n),p(e,t),p(e,o),p(e,i),p(e,a),b(w,f,C),b(w,u,C),p(u,c),p(u,_),p(u,m),p(u,g),p(u,h)},p(w,C){C&16&&l!==(l=dn(w[4].features[0].properties.distance)+"")&&ne(o,l),C&16&&s!==(s=_n(w[4].features[0].properties.time)+"")&&ne(a,s),C&16&&d!==(d=dn(w[4].features[1].properties.distance)+"")&&ne(m,d),C&16&&y!==(y=_n(w[4].features[1].properties.time)+"")&&ne(h,y)},d(w){w&&($(e),$(f),$(u))}}}function Zg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y;n=new pn({}),n.$on("click",r[6]);let h=r[4].features.length==2&&bi(r);return{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),l.textContent="Drag markers for a route",o=M(),h&&h.c(),i=M(),s=k("label"),a=z("Slow-down factor for main roads: "),f=z(r[1]),u=M(),c=k("input"),_=M(),d=k("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,N(c,"type","range"),N(c,"min","1.0"),N(c,"max","5.0"),N(c,"step","0.1"),N(e,"slot","sidebar")},m(w,C){b(w,e,C),I(n,e,null),p(e,t),p(e,l),p(e,o),h&&h.m(e,null),p(e,i),p(e,s),p(s,a),p(s,f),p(s,u),p(s,c),ze(c,r[1]),p(e,_),p(e,d),m=!0,g||(y=[K(c,"change",r[10]),K(c,"input",r[10])],g=!0)},p(w,C){w[4].features.length==2?h?h.p(w,C):(h=bi(w),h.c(),h.m(e,i)):h&&(h.d(1),h=null),(!m||C&2)&&ne(f,w[1]),C&2&&ze(c,w[1])},i(w){m||(v(n.$$.fragment,w),m=!0)},o(w){S(n.$$.fragment,w),m=!1},d(w){w&&$(e),E(n),h&&h.d(),g=!1,nt(y)}}}function $i(r){let e,n;return e=new rr({props:{$$slots:{default:[Kg]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Kg(r){let e,n,t,l,o,i,s,a;return e=new Er({}),t=new Ir({}),o=new Nr({}),s=new nr({props:{interactive:!1}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),P(s.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),b(f,l,u),I(o,f,u),b(f,i,u),I(s,f,u),a=!0},p:Q,i(f){a||(v(e.$$.fragment,f),v(t.$$.fragment,f),v(o.$$.fragment,f),v(s.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),S(o.$$.fragment,f),S(s.$$.fragment,f),a=!1},d(f){f&&($(n),$(l),$(i)),E(e,f),E(t,f),E(o,f),E(s,f)}}}function Xg(r){let e,n;const t=[we("compare-route"),{paint:{"line-width":10,"line-color":Gt(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function Vg(r){let e;return{c(){e=z("A")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Qg(r){let e;return{c(){e=z("B")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function xg(r){let e,n,t,l,o,i,s,a,f,u,c,_,d=r[0]=="neighbourhood"&&$i(r);t=new gn({}),o=new Ve({props:{data:r[4],$$slots:{default:[Xg]},$$scope:{ctx:r}}});function m(w){r[8](w)}let g={draggable:!0,$$slots:{default:[Vg]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new wn({props:g}),Ge.push(()=>ut(s,"lngLat",m));function y(w){r[9](w)}let h={draggable:!0,$$slots:{default:[Qg]},$$scope:{ctx:r}};return r[2]!==void 0&&(h.lngLat=r[2]),u=new wn({props:h}),Ge.push(()=>ut(u,"lngLat",y)),{c(){e=k("div"),d&&d.c(),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),P(s.$$.fragment),f=M(),P(u.$$.fragment),N(e,"slot","map")},m(w,C){b(w,e,C),d&&d.m(e,null),p(e,n),I(t,e,null),p(e,l),I(o,e,null),p(e,i),I(s,e,null),p(e,f),I(u,e,null),_=!0},p(w,C){w[0]=="neighbourhood"?d?C&1&&v(d,1):(d=$i(w),d.c(),v(d,1),d.m(e,n)):d&&(he(),S(d,1,1,()=>{d=null}),be());const L={};C&16&&(L.data=w[4]),C&16384&&(L.$$scope={dirty:C,ctx:w}),o.$set(L);const F={};C&16384&&(F.$$scope={dirty:C,ctx:w}),!a&&C&8&&(a=!0,F.lngLat=w[3],ct(()=>a=!1)),s.$set(F);const T={};C&16384&&(T.$$scope={dirty:C,ctx:w}),!c&&C&4&&(c=!0,T.lngLat=w[2],ct(()=>c=!1)),u.$set(T)},i(w){_||(v(d),v(t.$$.fragment,w),v(o.$$.fragment,w),v(s.$$.fragment,w),v(u.$$.fragment,w),_=!0)},o(w){S(d),S(t.$$.fragment,w),S(o.$$.fragment,w),S(s.$$.fragment,w),S(u.$$.fragment,w),_=!1},d(w){w&&$(e),d&&d.d(),E(t),E(o),E(s),E(u)}}}function e1(r){let e,n;return e=new At({props:{$$slots:{map:[xg],sidebar:[Zg],top:[Yg]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&16447&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function t1(r,e,n){let t,l,o,i,s,a;V(r,ce,h=>n(5,l=h)),V(r,Al,h=>n(1,o=h)),V(r,Yn,h=>n(2,i=h)),V(r,Zn,h=>n(3,s=h)),V(r,xe,h=>n(7,a=h));let{prevMode:f}=e;function u(){te(ce,l={mode:f},l)}function c(h){s=h,Zn.set(s)}function _(h){i=h,Yn.set(i)}function d(){o=vn(this.value),Al.set(o)}const m=()=>te(ce,l={mode:"title",firstLoad:!1},l),g=()=>te(ce,l={mode:"pick-neighbourhood"},l),y=()=>te(ce,l={mode:"neighbourhood"},l);return r.$$set=h=>{"prevMode"in h&&n(0,f=h.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&n(4,t=a.compareRoute(s,i,o))},[f,o,i,s,t,l,u,a,c,_,d,m,g,y]}class n1 extends se{constructor(e){super(),ae(this,e,t1,e1,le,{prevMode:0})}}let Fn=Mt(null);const Ot=Mt([]);function Ms(r){if(r.length<3)return JSON.parse(Wt(Fn).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let n=JSON.parse(Wt(Fn).inner.calculateRoute(e));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}const{window:r1}=Ki,l1=r=>({}),vi=r=>({}),o1=r=>({}),yi=r=>({});function wi(r,e,n){const t=r.slice();return t[44]=e[n],t[45]=e,t[46]=n,t}function ki(r,e,n){const t=r.slice();return t[47]=e[n],t[48]=e,t[49]=n,t}function i1(r){let e,n;const t=r[24]["extra-top"],l=Re(t,r,r[38],vi);return{c(){e=k("div"),l&&l.c(),N(e,"slot","top")},m(o,i){b(o,e,i),l&&l.m(e,null),n=!0},p(o,i){l&&l.p&&(!n||i[1]&128)&&De(l,t,o,o[38],n?He(t,o[38],i,l1):Ue(o[38]),vi)},i(o){n||(v(l,o),n=!0)},o(o){S(l,o),n=!1},d(o){o&&$(e),l&&l.d(o)}}}function s1(r){let e,n,t,l,o;return{c(){e=k("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,n=M(),t=k("p"),t.textContent="Keyboard shortcuts:",l=M(),o=k("ul"),o.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){b(i,e,s),b(i,n,s),b(i,t,s),b(i,l,s),b(i,o,s)},p:Q,d(i){i&&($(e),$(n),$(t),$(l),$(o))}}}function a1(r){let e,n=r[8].length+"",t,l;return{c(){e=z("Undo ("),t=z(n),l=z(")")},m(o,i){b(o,e,i),b(o,t,i),b(o,l,i)},p(o,i){i[0]&256&&n!==(n=o[8].length+"")&&ne(t,n)},d(o){o&&($(e),$(t),$(l))}}}function f1(r){let e;return{c(){e=z("Undo")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function u1(r){let e;return{c(){e=k("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function c1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;return c=Xi(r[36][0]),{c(){e=k("fieldset"),n=k("label"),t=k("input"),l=z(`
          Snap to roads`),o=M(),i=k("label"),s=k("input"),a=z(`
          Draw anywhere`),f=M(),u=k("p"),u.textContent="Click to add at least 3 points",N(t,"type","radio"),t.__value="snap",ze(t,t.__value),N(s,"type","radio"),s.__value="free",ze(s,s.__value),c.p(t,s)},m(m,g){b(m,e,g),p(e,n),p(n,t),t.checked=t.__value===r[7],p(n,l),p(e,o),p(e,i),p(i,s),s.checked=s.__value===r[7],p(i,a),b(m,f,g),b(m,u,g),_||(d=[K(t,"change",r[35]),K(s,"change",r[37])],_=!0)},p(m,g){g[0]&128&&(t.checked=t.__value===m[7]),g[0]&128&&(s.checked=s.__value===m[7])},d(m){m&&($(e),$(f),$(u)),c.r(),_=!1,nt(d)}}}function d1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m,g,y,h;const w=r[24]["extra-sidebar"],C=Re(w,r,r[38],yi);u=new jt({props:{$$slots:{default:[s1]},$$scope:{ctx:r}}});function L(U,R){return U[8].length==0?f1:a1}let F=L(r),T=F(r);function A(U,R){return U[5].length<3?c1:u1}let j=A(r),O=j(r);return{c(){e=k("div"),C&&C.c(),n=M(),t=k("div"),l=k("button"),o=z("Finish"),s=M(),a=k("button"),a.textContent="Cancel",f=M(),P(u.$$.fragment),c=M(),_=k("button"),T.c(),m=M(),O.c(),l.disabled=i=r[5].length<3,N(a,"class","secondary"),oe(t,"display","flex"),N(_,"class","secondary"),_.disabled=d=r[8].length==0,N(e,"slot","sidebar")},m(U,R){b(U,e,R),C&&C.m(e,null),p(e,n),p(e,t),p(t,l),p(l,o),p(t,s),p(t,a),p(t,f),I(u,t,null),p(e,c),p(e,_),T.m(_,null),p(e,m),O.m(e,null),g=!0,y||(h=[K(l,"click",function(){Yr(r[0])&&r[0].apply(this,arguments)}),K(a,"click",function(){Yr(r[1])&&r[1].apply(this,arguments)}),K(_,"click",r[11])],y=!0)},p(U,R){r=U,C&&C.p&&(!g||R[1]&128)&&De(C,w,r,r[38],g?He(w,r[38],R,o1):Ue(r[38]),yi),(!g||R[0]&32&&i!==(i=r[5].length<3))&&(l.disabled=i);const B={};R[1]&128&&(B.$$scope={dirty:R,ctx:r}),u.$set(B),F===(F=L(r))&&T?T.p(r,R):(T.d(1),T=F(r),T&&(T.c(),T.m(_,null))),(!g||R[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),j===(j=A(r))&&O?O.p(r,R):(O.d(1),O=j(r),O&&(O.c(),O.m(e,null)))},i(U){g||(v(C,U),v(u.$$.fragment,U),g=!0)},o(U){S(C,U),S(u.$$.fragment,U),g=!1},d(U){U&&$(e),C&&C.d(U),E(u),T.d(),O.d(),y=!1,nt(h)}}}function _1(r){let e;return{c(){e=k("span"),N(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped-node",r[47].snapped),gt(e,"free-node",!r[47].snapped),gt(e,"hide",r[4])},m(n,t){b(n,e,t)},p(n,t){t[0]&512&&gt(e,"snapped-node",n[47].snapped),t[0]&512&&gt(e,"free-node",!n[47].snapped),t[0]&16&&gt(e,"hide",n[4])},d(n){n&&$(e)}}}function Si(r){let e,n,t;function l(f){r[25](f,r[47])}function o(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[_1]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new Ar({props:a}),Ge.push(()=>ut(e,"lngLat",l)),e.$on("dragstart",o),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){P(e.$$.fragment)},m(f,u){I(e,f,u),t=!0},p(f,u){r=f;const c={};u[0]&528|u[1]&128&&(c.$$scope={dirty:u,ctx:r}),!n&&u[0]&512&&(n=!0,c.lngLat=r[47].point,ct(()=>n=!1)),e.$set(c)},i(f){t||(v(e.$$.fragment,f),t=!0)},o(f){S(e.$$.fragment,f),t=!1},d(f){E(e,f)}}}function m1(r){let e;return{c(){e=k("span"),e.textContent=`${r[46]+1}`,N(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped",r[44].snapped)},m(n,t){b(n,e,t)},p(n,t){t[0]&32&&gt(e,"snapped",n[44].snapped)},d(n){n&&$(e)}}}function Ci(r){let e,n,t;function l(a){r[29](a,r[44])}function o(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[m1]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new Ar({props:s}),Ge.push(()=>ut(e,"lngLat",l)),e.$on("click",o),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){P(e.$$.fragment)},m(a,f){I(e,a,f),t=!0},p(a,f){r=a;const u={};f[0]&32|f[1]&128&&(u.$$scope={dirty:f,ctx:r}),!n&&f[0]&32&&(n=!0,u.lngLat=r[44].point,ct(()=>n=!1)),e.$set(u)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){S(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function p1(r){let e,n,t,l;const o=[we("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let f=0;f<o.length;f+=1)i=_e(i,o[f]);e=new tt({props:i});const s=[we("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let f=0;f<s.length;f+=1)a=_e(a,s[f]);return t=new wt({props:a}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),l=!0},p(f,u){const c={};e.$set(c);const _={};t.$set(_)},i(f){l||(v(e.$$.fragment,f),v(t.$$.fragment,f),l=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),l=!1},d(f){f&&$(n),E(e,f),E(t,f)}}}function g1(r){let e,n;return e=new tt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function h1(r){let e,n,t,l,o,i,s,a,f;n=new ps({}),n.$on("click",r[12]),n.$on("mousemove",r[13]);let u=Me(r[9]),c=[];for(let y=0;y<u.length;y+=1)c[y]=Si(ki(r,u,y));const _=y=>S(c[y],1,1,()=>{c[y]=null});let d=Me(r[5]),m=[];for(let y=0;y<d.length;y+=1)m[y]=Ci(wi(r,d,y));const g=y=>S(m[y],1,1,()=>{m[y]=null});return i=new Ve({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[p1]},$$scope:{ctx:r}}}),a=new Ve({props:{data:r[10],$$slots:{default:[g1]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M();for(let y=0;y<c.length;y+=1)c[y].c();l=M();for(let y=0;y<m.length;y+=1)m[y].c();o=M(),P(i.$$.fragment),s=M(),P(a.$$.fragment),N(e,"slot","map")},m(y,h){b(y,e,h),I(n,e,null),p(e,t);for(let w=0;w<c.length;w+=1)c[w]&&c[w].m(e,null);p(e,l);for(let w=0;w<m.length;w+=1)m[w]&&m[w].m(e,null);p(e,o),I(i,e,null),p(e,s),I(a,e,null),f=!0},p(y,h){if(h[0]&918032){u=Me(y[9]);let L;for(L=0;L<u.length;L+=1){const F=ki(y,u,L);c[L]?(c[L].p(F,h),v(c[L],1)):(c[L]=Si(F),c[L].c(),v(c[L],1),c[L].m(e,l))}for(he(),L=u.length;L<c.length;L+=1)_(L);be()}if(h[0]&2146348){d=Me(y[5]);let L;for(L=0;L<d.length;L+=1){const F=wi(y,d,L);m[L]?(m[L].p(F,h),v(m[L],1)):(m[L]=Ci(F),m[L].c(),v(m[L],1),m[L].m(e,o))}for(he(),L=d.length;L<m.length;L+=1)g(L);be()}const w={};h[0]&96&&(w.data=y[16](y[6],y[5])),h[1]&128&&(w.$$scope={dirty:h,ctx:y}),i.$set(w);const C={};h[0]&1024&&(C.data=y[10]),h[1]&128&&(C.$$scope={dirty:h,ctx:y}),a.$set(C)},i(y){if(!f){v(n.$$.fragment,y);for(let h=0;h<u.length;h+=1)v(c[h]);for(let h=0;h<d.length;h+=1)v(m[h]);v(i.$$.fragment,y),v(a.$$.fragment,y),f=!0}},o(y){S(n.$$.fragment,y),c=c.filter(Boolean);for(let h=0;h<c.length;h+=1)S(c[h]);m=m.filter(Boolean);for(let h=0;h<m.length;h+=1)S(m[h]);S(i.$$.fragment,y),S(a.$$.fragment,y),f=!1},d(y){y&&$(e),E(n),st(c,y),st(m,y),E(i),E(a)}}}function b1(r){let e,n,t,l;return e=new At({props:{$$slots:{map:[h1],sidebar:[d1],top:[i1]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0,t||(l=K(r1,"keydown",r[20]),t=!0)},p(o,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:o}),e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o),t=!1,l()}}}function $1(r,e,n){let t,l,o;V(r,Ot,X=>n(5,l=X)),V(r,Fn,X=>n(6,o=X));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:f}=e,{cancel:u}=e;Tt(()=>{te(Ot,l=[],l),o==null||o.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],m=null,g=!1,y=!1,h=!1;function w(X){let me=X.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=me}function C(){let X=_.pop();n(8,_),X&&te(Ot,l=X,l)}function L(){_.length==100&&_.shift(),n(8,_=[..._,JSON.parse(JSON.stringify(l))])}function F(){n(7,c=c=="snap"?"free":"snap"),m&&n(23,m.snapped=c=="snap",m)}function T(X){l.length>=3||(L(),Ot.update(me=>(me.push({point:X.detail.lngLat.toArray(),snapped:c=="snap"}),me)))}function A(X){n(23,m={point:X.detail.lngLat.toArray(),snapped:c=="snap"})}function j(X){L(),Ot.update(me=>(me[X].snapped=!me[X].snapped,me))}function O(X){L(),Ot.update(me=>(me.splice(X,1),me)),n(2,g=!1)}function U(X,me){try{if(X)return Ms(me)}catch{}return rn()}function R(X,me,x,pe){if(pe||me.length>=3)return rn();try{if(X&&me.length>0&&x)return JSON.parse(X.inner.calculateRoute([me[me.length-1],x]))}catch{}return rn()}function B(X,me,x){if(x)return;if(!X||me.length<3){n(9,d=[]);return}let pe=[],$e=1,Se=JSON.parse(JSON.stringify(me));Se.push(Se[0]);for(let W=0;W<Se.length-1;W++){let _t=JSON.parse(X.inner.getExtraNodes(Se[W],Se[W+1]));for(let[Be,We,kt]of _t)pe.push({point:[Be,We],snapped:kt,insertIdx:$e});$e++}n(9,d=pe)}function H(X){L(),Ot.update(me=>(me.splice(X.insertIdx,0,{point:X.point,snapped:X.snapped}),me)),n(4,h=!0)}function G(X){Ot.update(me=>(me[X.insertIdx].point=X.point,me))}function Z(){n(4,h=!1)}function Y(X){let me=X.target.tagName,x=me=="INPUT"||me=="TEXTAREA";X.key=="Enter"&&!x||X.key=="Escape"?(X.stopPropagation(),l.length>=3?f():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):X.key=="s"&&!x?F():X.key=="z"&&X.ctrlKey&&(X.stopPropagation(),C())}function ie(){L(),n(3,y=!0)}const D=[[]];function ve(X,me){r.$$.not_equal(me.point,X)&&(me.point=X,n(9,d))}const ge=X=>H(X),fe=X=>G(X),ye=X=>{H(X),n(4,h=!1)};function ue(X,me){r.$$.not_equal(me.point,X)&&(me.point=X,Ot.set(l))}const Fe=X=>j(X),Ze=X=>O(X),Te=()=>n(2,g=!0),re=()=>n(2,g=!1),Je=()=>n(3,y=!1);function Ne(){c=this.__value,n(7,c)}function ke(){c=this.__value,n(7,c)}return r.$$set=X=>{"map"in X&&n(22,a=X.map),"finish"in X&&n(0,f=X.finish),"cancel"in X&&n(1,u=X.cancel),"$$scope"in X&&n(38,s=X.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&B(o,l,h),r.$$.dirty[0]&8388716&&n(10,t=R(o,l,m,g||y)),r.$$.dirty[0]&32&&w(l)},[f,u,g,y,h,l,o,c,_,d,t,C,T,A,j,O,U,H,G,Z,Y,ie,a,m,i,ve,ge,fe,ye,ue,Fe,Ze,Te,re,Je,Ne,D,ke,s]}class v1 extends se{constructor(e){super(),ae(this,e,$1,b1,le,{map:22,finish:0,cancel:1},null,[-1,-1])}}function y1(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function w1(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function k1(r){let e;return{c(){e=k("li"),e.textContent="Creating new neighbourhood boundary"},m(n,t){b(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function S1(r){let e,n,t,l,o;return n=new Le({props:{$$slots:{default:[C1]},$$scope:{ctx:r}}}),n.$on("click",r[8]),{c(){e=k("li"),P(n.$$.fragment),t=M(),l=k("li"),l.textContent="Changing neighbourhood boundary"},m(i,s){b(i,e,s),I(n,e,null),b(i,t,s),b(i,l,s),o=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),n.$set(a)},i(i){o||(v(n.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),o=!1},d(i){i&&($(e),$(t),$(l)),E(n)}}}function C1(r){let e;return{c(){e=z("Editing")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function L1(r){let e,n,t,l,o,i,s,a,f,u,c,_;o=new Le({props:{$$slots:{default:[y1]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Le({props:{$$slots:{default:[w1]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[S1,k1],m=[];function g(y,h){return y[1]?0:1}return u=g(r),c=m[u]=d[u](r),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),c.c(),N(n,"aria-label","breadcrumb"),N(e,"slot","extra-top")},m(y,h){b(y,e,h),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),m[u].m(t,null),_=!0},p(y,h){const w={};h&4096&&(w.$$scope={dirty:h,ctx:y}),o.$set(w);const C={};h&4096&&(C.$$scope={dirty:h,ctx:y}),a.$set(C);let L=u;u=g(y),u===L?m[u].p(y,h):(he(),S(m[L],1,1,()=>{m[L]=null}),be(),c=m[u],c?c.p(y,h):(c=m[u]=d[u](y),c.c()),v(c,1),c.m(t,null))},i(y){_||(v(o.$$.fragment,y),v(a.$$.fragment,y),v(c),_=!0)},o(y){S(o.$$.fragment,y),S(a.$$.fragment,y),S(c),_=!1},d(y){y&&$(e),E(o),E(a),m[u].d()}}}function M1(r){let e,n,t,l;return{c(){e=k("div"),n=k("h1"),t=z("Draw your neighbourhood boundary for "),l=z(r[0]),N(e,"slot","extra-sidebar")},m(o,i){b(o,e,i),p(e,n),p(n,t),p(n,l)},p(o,i){i&1&&ne(l,o[0])},d(o){o&&$(e)}}}function T1(r){let e,n;return e=new v1({props:{map:ft(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[M1],"extra-top":[L1]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&8&&(o.map=ft(t[3])),l&4103&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function A1(r,e,n){let t,l,o,i,s;V(r,ce,g=>n(2,t=g)),V(r,Jn,g=>n(9,l=g)),V(r,xe,g=>n(10,o=g)),V(r,Ot,g=>n(11,i=g)),V(r,Qt,g=>n(3,s=g));let{name:a}=e,{existing:f}=e;f&&(f.properties.waypoints?te(Ot,i=f.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):te(Ot,i=f.geometry.coordinates[1].slice(1).map(g=>({point:g,snapped:!1})),i));function u(){if(i.length>=3)try{let g=Ms(i);o.setNeighbourhoodBoundary(a,g),Tn(),o.setCurrentNeighbourhood(a,l),te(ce,t={mode:"neighbourhood"},t)}catch(g){console.log("error when setting hand drawn neighborhood",g),window.alert("Sorry, an error occurred. You may need to refresh the page for the application to continue working."),c()}}function c(){f?te(ce,t={mode:"neighbourhood"},t):te(ce,t={mode:"pick-neighbourhood"},t)}const _=()=>te(ce,t={mode:"title",firstLoad:!1},t),d=()=>te(ce,t={mode:"pick-neighbourhood"},t),m=()=>te(ce,t={mode:"neighbourhood"},t);return r.$$set=g=>{"name"in g&&n(0,a=g.name),"existing"in g&&n(1,f=g.existing)},[a,f,t,s,u,c,_,d,m]}class F1 extends se{constructor(e){super(),ae(this,e,A1,T1,le,{name:0,existing:1})}}const P1="/ltn/assets/settings-342fb430.svg";function Li(r){let e,n;return e=new Lr({props:{$$slots:{default:[I1]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&67&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function I1(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;return t=new iu({}),{c(){e=k("h1"),e.textContent="Settings",n=M(),P(t.$$.fragment),l=M(),o=k("label"),i=k("input"),s=z(`
      Road thickness depends on shortcuts`),a=M(),f=k("center"),u=k("button"),u.textContent="Confirm",N(i,"type","checkbox")},m(m,g){b(m,e,g),b(m,n,g),I(t,m,g),b(m,l,g),b(m,o,g),p(o,i),i.checked=r[1],p(o,s),b(m,a,g),b(m,f,g),p(f,u),c=!0,_||(d=[K(i,"change",r[3]),K(u,"click",r[4])],_=!0)},p(m,g){g&2&&(i.checked=m[1])},i(m){c||(v(t.$$.fragment,m),c=!0)},o(m){S(t.$$.fragment,m),c=!1},d(m){m&&($(e),$(n),$(l),$(o),$(a),$(f)),E(t,m),_=!1,nt(d)}}}function E1(r){let e,n,t,l,o,i,s=r[0]&&Li(r);return{c(){e=k("button"),e.innerHTML=`<img src="${P1}" alt="Settings"/>`,n=M(),s&&s.c(),t=Ye(),N(e,"class","outline")},m(a,f){b(a,e,f),b(a,n,f),s&&s.m(a,f),b(a,t,f),l=!0,o||(i=K(e,"click",r[2]),o=!0)},p(a,[f]){a[0]?s?(s.p(a,f),f&1&&v(s,1)):(s=Li(a),s.c(),v(s,1),s.m(t.parentNode,t)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){l||(v(s),l=!0)},o(a){S(s),l=!1},d(a){a&&($(e),$(n),$(t)),s&&s.d(a),o=!1,i()}}}function N1(r,e,n){let t;V(r,Kr,f=>n(1,t=f));let l=!1;const o=()=>n(0,l=!0);function i(){t=this.checked,Kr.set(t)}return[l,t,o,i,()=>n(0,l=!1),()=>n(0,l=!1)]}class j1 extends se{constructor(e){super(),ae(this,e,N1,E1,le,{})}}const z1=["==",["geometry-type"],"Polygon"],O1=["==",["geometry-type"],"LineString"],B1=["==",["geometry-type"],"Point"];function Ts(){return{type:"FeatureCollection",features:[]}}function qr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:As(r)}}}function As(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Fs=Mt(Ts()),Ps=Mt(0),R1=100;class D1{constructor(e){pt(this,"map");pt(this,"active");pt(this,"eventListenersSuccess");pt(this,"eventListenersUpdated");pt(this,"eventListenersFailure");pt(this,"points");pt(this,"cursor");pt(this,"hover");pt(this,"dragFrom");pt(this,"previousStates");pt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-e.lngLat.lng,t=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=n,l[1]-=t}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});pt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(Mi(this.points).forEach((t,l)=>{n.push([l+1,Tf(t,this.cursor).properties.dist])}),n.sort((t,l)=>t[1]-l[1]),n.length>0){let t=n[0][0];this.points.splice(t,0,this.cursor.geometry.coordinates),this.hover=t}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});pt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=qr(e.lngLat.toArray()),this.onClick(e),this.finish())});pt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});pt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});pt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});pt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersSuccess)n(e);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Ts();this.points.forEach((l,o)=>{let i=qr(l);i.properties.hover=this.hover==o,i.properties.idx=o,e.features.push(i)}),e.features=e.features.concat(Mi(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",e.features.push(n)),Fs.set(e);let t="crosshair";this.hover!=null&&(t=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=t,Ps.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let n of this.eventListenersUpdated)n(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=qr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(As),n=[JSON.parse(JSON.stringify(e))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>R1&&this.previousStates.shift()}}function Mi(r){let e=[];for(let n=0;n<r.length-1;n++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[n],r[n+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function U1(r){let e,n,t;return{c(){e=z("Undo ("),n=z(r[1]),t=z(")")},m(l,o){b(l,e,o),b(l,n,o),b(l,t,o)},p(l,o){o&2&&ne(n,l[1])},d(l){l&&($(e),$(n),$(t))}}}function H1(r){let e;return{c(){e=z("Undo")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function G1(r){let e,n,t,l,o,i,s,a,f,u,c;function _(g,y){return g[1]==0?H1:U1}let d=_(r),m=d(r);return{c(){e=k("div"),n=k("button"),n.textContent="Finish",t=M(),l=k("button"),l.textContent="Cancel",o=M(),i=k("button"),m.c(),a=M(),f=k("ul"),f.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,oe(e,"display","flex"),oe(e,"justify-content","space-between")},m(g,y){b(g,e,y),p(e,n),p(e,t),p(e,l),p(e,o),p(e,i),m.m(i,null),b(g,a,y),b(g,f,y),u||(c=[K(n,"click",r[2]),K(l,"click",r[3]),K(i,"click",r[4])],u=!0)},p(g,[y]){d===(d=_(g))&&m?m.p(g,y):(m.d(1),m=d(g),m&&(m.c(),m.m(i,null))),y&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Q,o:Q,d(g){g&&($(e),$(a),$(f)),m.d(),u=!1,nt(c)}}}function W1(r,e,n){let t;V(r,Ps,a=>n(1,t=a));let{polygonTool:l}=e;const o=()=>l.finish(),i=()=>l.cancel(),s=()=>l.undo();return r.$$set=a=>{"polygonTool"in a&&n(0,l=a.polygonTool)},[l,t,o,i,s]}class q1 extends se{constructor(e){super(),ae(this,e,W1,G1,le,{polygonTool:0})}}let J1=Date.now();function lr(r){return`${r}-${J1++}`}const Is=Symbol.for("svelte-maplibre");function Y1(){return pl(Is)}function Ti(r){return{subscribe:r.subscribe}}function Es({key:r,setPopupTarget:e=!1,setCluster:n=!1,setMouseEvent:t=!1}){let l=Y1(),o=Mt(null),i=Ti(o),s={...l,[r]:Ti(o)};if(e&&(s.popupTarget=i),t){let a=Mt(null);s.layerEvent=a,l.layerEvent=a}return n&&(s.cluster=Mt()),Vi(Is,s),{...l,self:o}}function Z1(){return Es({key:"source",setCluster:!0})}function K1(r=!0){return Es({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Ai(r){let e;return n=>{if(n)for(let t in n){let l=e==null?void 0:e[t],o=n[t];l!==o&&r(t,o,l)}else if(e)for(let t in e)r(t,void 0,e[t]);e=n}}function X1(r,...e){let n=[r];for(let t of e)if(t)Array.isArray(t)&&t[0]===r?n.push(...t.slice(1)):n.push(t);else continue;if(n.length!==1)return n.length===2?n[1]:n}function V1(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Fi(r){let e=r[0],n,t,l=Pi(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),b(o,n,i),t=!0},p(o,i){i[0]&1&&le(e,e=o[0])?(he(),S(l,1,1,Q),be(),l=Pi(o),l.c(),v(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||(v(l),t=!0)},o(o){S(l),t=!1},d(o){o&&$(n),l.d(o)}}}function Pi(r){let e;const n=r[36].default,t=Re(n,r,r[35],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o[1]&16)&&De(t,n,l,l[35],e?He(n,l[35],o,null):Ue(l[35]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function Q1(r){let e,n,t=r[0]&&Fi(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,o){l[0]?t?(t.p(l,o),o[0]&1&&v(t,1)):(t=Fi(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function x1(r,e,n){let t,l,o,i,s,a,f,u,c,_,d,m,{$$slots:g={},$$scope:y}=e,{id:h=lr("layer")}=e,{source:w=void 0}=e,{sourceLayer:C=void 0}=e,{beforeId:L=void 0}=e,{beforeLayerType:F=void 0}=e,{type:T}=e,{paint:A=void 0}=e,{layout:j=void 0}=e,{filter:O=void 0}=e,{applyToClusters:U=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:B=void 0}=e,{manageHoverState:H=!1}=e,{hovered:G=null}=e,{interactive:Z=!0}=e,{hoverCursor:Y=void 0}=e,{eventsIfTopMost:ie=!1}=e;const D=mn(),{map:ve,source:ge,self:fe,minzoom:ye,maxzoom:ue,eventTopMost:Fe,layerInfo:Ze}=K1();V(r,ve,x=>n(31,c=x)),V(r,ge,x=>n(32,_=x)),V(r,fe,x=>n(0,u=x)),V(r,ye,x=>n(34,m=x)),V(r,ue,x=>n(33,d=x)),Tt(()=>{u&&c&&(Ze.delete(u),c==null||c.removeLayer(u))});let Te;function re(x){var W,_t;if(!Z||!u||!c||ie&&Fe(x)!==u)return;let pe=x.features??[],$e=(_t=(W=pe[0])==null?void 0:W.properties)==null?void 0:_t.cluster_id,Se={event:x,map:c,clusterId:$e,layer:u,source:s,features:pe};D(x.type,Se)}function Je(x){var W,_t;if(!Z||!u||!c||ie&&Fe(x)!==u)return;Y&&(c.getCanvas().style.cursor=Y);let pe=x.features??[];n(6,G=pe[0]??null);let $e=(_t=(W=pe[0])==null?void 0:W.properties)==null?void 0:_t.cluster_id;D("mouseenter",{event:x,map:c,clusterId:$e,layer:u,source:s,features:pe})}function Ne(x){var W,_t,Be;if(!Z||!c)return;if(ie&&Fe(x)!==u){n(6,G=null),H&&Te!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:C,id:Te},{hover:!1}),Te=void 0);return}c.getCanvas().style.cursor=Y;let pe=x.features??[],$e=(_t=(W=pe[0])==null?void 0:W.properties)==null?void 0:_t.cluster_id,Se=(Be=pe[0])==null?void 0:Be.id;Se!==Te&&(H&&(Te!==void 0&&(c==null||c.setFeatureState({source:s,id:Te,sourceLayer:C},{hover:!1})),c==null||c.setFeatureState({source:s,id:Se,sourceLayer:C},{hover:!0})),Te=Se,n(6,G=pe[0]??null)),D("mousemove",{event:x,map:c,clusterId:$e,layer:u,source:s,features:pe})}function ke(x){if(!(!Z||!u||!c)){if(Y&&(c.getCanvas().style.cursor=""),n(6,G=null),H&&Te!==void 0){const pe={source:s,id:Te,sourceLayer:C};c==null||c.setFeatureState(pe,{hover:!1}),Te=void 0}D("mouseleave",{map:c,layer:u,source:s})}}let X=!0;function me(x){c&&(c.off("click",x,re),c.off("dblclick",x,re),c.off("contextmenu",x,re),c.off("mouseenter",x,Je),c.off("mousemove",x,Ne),c.off("mouseleave",x,ke))}return Tt(()=>{c&&u&&me(u)}),r.$$set=x=>{"id"in x&&n(7,h=x.id),"source"in x&&n(8,w=x.source),"sourceLayer"in x&&n(9,C=x.sourceLayer),"beforeId"in x&&n(10,L=x.beforeId),"beforeLayerType"in x&&n(11,F=x.beforeLayerType),"type"in x&&n(12,T=x.type),"paint"in x&&n(13,A=x.paint),"layout"in x&&n(14,j=x.layout),"filter"in x&&n(15,O=x.filter),"applyToClusters"in x&&n(16,U=x.applyToClusters),"minzoom"in x&&n(17,R=x.minzoom),"maxzoom"in x&&n(18,B=x.maxzoom),"manageHoverState"in x&&n(19,H=x.manageHoverState),"hovered"in x&&n(6,G=x.hovered),"interactive"in x&&n(20,Z=x.interactive),"hoverCursor"in x&&n(21,Y=x.hoverCursor),"eventsIfTopMost"in x&&n(22,ie=x.eventsIfTopMost),"$$scope"in x&&n(35,y=x.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&n(30,t=V1(U)),r.$$.dirty[0]&1073774592&&n(24,l=X1("all",t,O)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&n(26,o=R??m),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&n(25,i=B??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&n(29,s=w||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&u!==h&&s){u&&(me(u),Ze.delete(u));let x=L;if(!L&&F){let pe=c.getStyle().layers,$e=typeof F=="function"?F:W=>W.type===F,Se=pe==null?void 0:pe.find($e);Se&&(x=Se.id)}te(fe,u=h,u),c.addLayer(gr({id:u,type:T,source:s,"source-layer":C,filter:l,paint:A,layout:j,minzoom:o,maxzoom:i}),x),n(23,X=!0),c.on("click",u,re),c.on("dblclick",u,re),c.on("contextmenu",u,re),c.on("mouseenter",u,Je),c.on("mousemove",u,Ne),c.on("mouseleave",u,ke)}r.$$.dirty[0]&1048577&&u&&Ze.set(u,{interactive:Z}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(28,a=u?Ai((x,pe)=>c==null?void 0:c.setPaintProperty(u,x,pe)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&n(27,f=u?Ai((x,pe)=>c==null?void 0:c.setLayoutProperty(u,x,pe)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(A)),r.$$.dirty[0]&134234112&&(f==null||f(j)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&u&&(c==null||c.setLayerZoomRange(u,o,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&u&&(X?n(23,X=!1):c==null||c.setFilter(u,l))},[u,ve,ge,fe,ye,ue,G,h,w,C,L,F,T,A,j,O,U,R,B,H,Z,Y,ie,X,l,i,o,f,a,s,t,c,_,d,m,y,g]}class Sl extends se{constructor(e){super(),ae(this,e,x1,Q1,le,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function eh(r){let e;const n=r[16].default,t=Re(n,r,r[24],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16777216)&&De(t,n,l,l[24],e?He(n,l[24],o,null):Ue(l[24]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function th(r){let e,n,t;function l(i){r[17](i)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[eh]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sl({props:o}),Ge.push(()=>ut(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){P(e.$$.fragment)},m(i,s){I(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function nh(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=lr("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:h=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:L=!0}=e;function F(B){w=B,n(0,w)}function T(B){je.call(this,r,B)}function A(B){je.call(this,r,B)}function j(B){je.call(this,r,B)}function O(B){je.call(this,r,B)}function U(B){je.call(this,r,B)}function R(B){je.call(this,r,B)}return r.$$set=B=>{"id"in B&&n(1,o=B.id),"source"in B&&n(2,i=B.source),"sourceLayer"in B&&n(3,s=B.sourceLayer),"beforeId"in B&&n(4,a=B.beforeId),"beforeLayerType"in B&&n(5,f=B.beforeLayerType),"paint"in B&&n(6,u=B.paint),"layout"in B&&n(7,c=B.layout),"filter"in B&&n(8,_=B.filter),"applyToClusters"in B&&n(9,d=B.applyToClusters),"minzoom"in B&&n(10,m=B.minzoom),"maxzoom"in B&&n(11,g=B.maxzoom),"hoverCursor"in B&&n(12,y=B.hoverCursor),"manageHoverState"in B&&n(13,h=B.manageHoverState),"hovered"in B&&n(0,w=B.hovered),"eventsIfTopMost"in B&&n(14,C=B.eventsIfTopMost),"interactive"in B&&n(15,L=B.interactive),"$$scope"in B&&n(24,l=B.$$scope)},[w,o,i,s,a,f,u,c,_,d,m,g,y,h,C,L,t,F,T,A,j,O,U,R,l]}class rh extends se{constructor(e){super(),ae(this,e,nh,th,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function lh(r){let e;const n=r[15].default,t=Re(n,r,r[23],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8388608)&&De(t,n,l,l[23],e?He(n,l[23],o,null):Ue(l[23]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function oh(r){let e,n,t;function l(i){r[16](i)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[lh]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sl({props:o}),Ge.push(()=>ut(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){P(e.$$.fragment)},m(i,s){I(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function ih(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=lr("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:y=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:w=!1}=e,{interactive:C=!0}=e;function L(R){h=R,n(0,h)}function F(R){je.call(this,r,R)}function T(R){je.call(this,r,R)}function A(R){je.call(this,r,R)}function j(R){je.call(this,r,R)}function O(R){je.call(this,r,R)}function U(R){je.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,o=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,y=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,w=R.eventsIfTopMost),"interactive"in R&&n(14,C=R.interactive),"$$scope"in R&&n(23,l=R.$$scope)},[h,o,i,s,a,f,u,c,_,d,m,g,y,w,C,t,L,F,T,A,j,O,U,l]}class sh extends se{constructor(e){super(),ae(this,e,ih,oh,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function ah(r,e,n,t,l){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const i=()=>{t(e)&&(r.addSource(e,n),l())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function fh(r,e,n){ma().then(()=>{let t=Wt(r);if(!t)return;t.getSource(e)===n&&t.removeSource(e)})}function Ii(r){let e=r[0],n,t,l=Ei(r);return{c(){l.c(),n=Ye()},m(o,i){l.m(o,i),b(o,n,i),t=!0},p(o,i){i&1&&le(e,e=o[0])?(he(),S(l,1,1,Q),be(),l=Ei(o),l.c(),v(l,1),l.m(n.parentNode,n)):l.p(o,i)},i(o){t||(v(l),t=!0)},o(o){S(l),t=!1},d(o){o&&$(n),l.d(o)}}}function Ei(r){let e;const n=r[15].default,t=Re(n,r,r[14],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&16384)&&De(t,n,l,l[14],e?He(n,l[14],o,null):Ue(l[14]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function uh(r){let e,n,t=r[0]&&Ii(r);return{c(){t&&t.c(),e=Ye()},m(l,o){t&&t.m(l,o),b(l,e,o),n=!0},p(l,[o]){l[0]?t?(t.p(l,o),o&1&&v(t,1)):(t=Ii(l),t.c(),v(t,1),t.m(e.parentNode,e)):t&&(he(),S(t,1,1,()=>{t=null}),be())},i(l){n||(v(t),n=!0)},o(l){S(t),n=!1},d(l){l&&$(e),t&&t.d(l)}}}function ch(r,e,n){let t,l,o,{$$slots:i={},$$scope:s}=e,{id:a=lr("geojson")}=e,{data:f}=e,{generateId:u=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:m=void 0}=e;const{map:g,cluster:y,self:h}=Z1();V(r,g,L=>n(13,l=L)),V(r,y,L=>n(16,o=L)),V(r,h,L=>n(0,t=L));let w,C=!0;return Tt(()=>{t&&w&&l&&(fh(g,t,w),te(h,t=null,t),n(11,w=void 0))}),r.$$set=L=>{"id"in L&&n(4,a=L.id),"data"in L&&n(5,f=L.data),"generateId"in L&&n(6,u=L.generateId),"promoteId"in L&&n(7,c=L.promoteId),"filter"in L&&n(8,_=L.filter),"lineMetrics"in L&&n(9,d=L.lineMetrics),"cluster"in L&&n(10,m=L.cluster),"$$scope"in L&&n(14,s=L.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&te(y,o=m,o),r.$$.dirty&12273&&l&&t!==a&&(te(h,t=a,t),ah(l,t,gr({type:"geojson",data:f,filter:_,lineMetrics:d,generateId:u,promoteId:c,cluster:!!m,clusterMinPoints:m==null?void 0:m.minPoints,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius,clusterProperties:m==null?void 0:m.properties}),L=>l&&L===t,()=>{t&&(n(11,w=l==null?void 0:l.getSource(t)),n(12,C=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{n(11,w=l==null?void 0:l.getSource(a))})),r.$$.dirty&6176&&w&&(C?n(12,C=!1):w.setData(f)),r.$$.dirty&3072&&(w==null||w.setClusterOptions(gr({cluster:!!m,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius})))},[t,g,y,h,a,f,u,c,_,d,m,w,C,l,s,i]}class dh extends se{constructor(e){super(),ae(this,e,ch,uh,le,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function _h(r){let e;const n=r[15].default,t=Re(n,r,r[23],null);return{c(){t&&t.c()},m(l,o){t&&t.m(l,o),e=!0},p(l,o){t&&t.p&&(!e||o&8388608)&&De(t,n,l,l[23],e?He(n,l[23],o,null):Ue(l[23]),null)},i(l){e||(v(t,l),e=!0)},o(l){S(t,l),e=!1},d(l){t&&t.d(l)}}}function mh(r){let e,n,t;function l(i){r[16](i)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[_h]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Sl({props:o}),Ge.push(()=>ut(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){P(e.$$.fragment)},m(i,s){I(e,i,s),t=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ct(()=>n=!1)),e.$set(a)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){S(e.$$.fragment,i),t=!1},d(i){E(e,i)}}}function ph(r,e,n){let{$$slots:t={},$$scope:l}=e,{id:o=lr("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:u}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:y=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:w=!1}=e,{interactive:C=!0}=e;function L(R){h=R,n(0,h)}function F(R){je.call(this,r,R)}function T(R){je.call(this,r,R)}function A(R){je.call(this,r,R)}function j(R){je.call(this,r,R)}function O(R){je.call(this,r,R)}function U(R){je.call(this,r,R)}return r.$$set=R=>{"id"in R&&n(1,o=R.id),"source"in R&&n(2,i=R.source),"sourceLayer"in R&&n(3,s=R.sourceLayer),"beforeId"in R&&n(4,a=R.beforeId),"beforeLayerType"in R&&n(5,f=R.beforeLayerType),"paint"in R&&n(6,u=R.paint),"layout"in R&&n(7,c=R.layout),"filter"in R&&n(8,_=R.filter),"minzoom"in R&&n(9,d=R.minzoom),"maxzoom"in R&&n(10,m=R.maxzoom),"hoverCursor"in R&&n(11,g=R.hoverCursor),"manageHoverState"in R&&n(12,y=R.manageHoverState),"hovered"in R&&n(0,h=R.hovered),"eventsIfTopMost"in R&&n(13,w=R.eventsIfTopMost),"interactive"in R&&n(14,C=R.interactive),"$$scope"in R&&n(23,l=R.$$scope)},[h,o,i,s,a,f,u,c,_,d,m,g,y,w,C,t,L,F,T,A,j,O,U,l]}class gh extends se{constructor(e){super(),ae(this,e,ph,mh,le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function hh(r){let e,n,t,l,o,i;return e=new sh({props:{id:"edit-polygon-fill",filter:z1,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),t=new gh({props:{id:"edit-polygon-lines",filter:O1,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new rh({props:{id:"edit-polygon-vertices",filter:B1,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment)},m(s,a){I(e,s,a),b(s,n,a),I(t,s,a),b(s,l,a),I(o,s,a),i=!0},p:Q,i(s){i||(v(e.$$.fragment,s),v(t.$$.fragment,s),v(o.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(t.$$.fragment,s),S(o.$$.fragment,s),i=!1},d(s){s&&($(n),$(l)),E(e,s),E(t,s),E(o,s)}}}function bh(r){let e,n;return e=new dh({props:{data:r[0],$$slots:{default:[hh]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1&&(o.data=t[0]),l&2&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function $h(r,e,n){let t;return V(r,Fs,l=>n(0,t=l)),[t]}class vh extends se{constructor(e){super(),ae(this,e,$h,bh,le,{})}}function yh(r){let e,n,t,l,o,i,s;return{c(){e=k("button"),e.textContent="Import current view",n=M(),t=k("i"),t.textContent="or...",l=M(),o=k("button"),o.textContent="Draw an area to import on the map",N(e,"type","button"),N(o,"type","button")},m(a,f){b(a,e,f),b(a,n,f),b(a,t,f),b(a,l,f),b(a,o,f),i||(s=[K(e,"click",r[2]),K(o,"click",r[3])],i=!0)},p:Q,i:Q,o:Q,d(a){a&&($(e),$(n),$(t),$(l),$(o)),i=!1,nt(s)}}}function wh(r){let e,n;return e=new q1({props:{polygonTool:r[0]}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1&&(o.polygonTool=t[0]),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function kh(r){let e,n,t,l,o,i,s,a,f;const u=[wh,yh],c=[];function _(d,m){return d[0]?0:1}return e=_(r),n=c[e]=u[e](r),{c(){n.c(),t=M(),l=k("label"),o=k("input"),i=z(`Save a copy of the osm.xml
  after importing`),N(o,"type","checkbox")},m(d,m){c[e].m(d,m),b(d,t,m),b(d,l,m),p(l,o),o.checked=r[1],p(l,i),s=!0,a||(f=K(o,"change",r[5]),a=!0)},p(d,[m]){let g=e;e=_(d),e===g?c[e].p(d,m):(he(),S(c[g],1,1,()=>{c[g]=null}),be(),n=c[e],n?n.p(d,m):(n=c[e]=u[e](d),n.c()),v(n,1),n.m(t.parentNode,t)),m&2&&(o.checked=d[1])},i(d){s||(v(n),s=!0)},o(d){S(n),s=!1},d(d){d&&($(t),$(l)),c[e].d(d),a=!1,f()}}}function jn(r){return[r.lng,r.lat]}function Sh(r,e,n){let{map:t}=e;const l=mn();let o=null,i=!1;async function s(_){try{l("loading","Loading from Overpass");let m=await(await fetch(Ns(_))).text();i&&$r("osm.xml",m),l("gotXml",{xml:m,boundary:_})}catch(d){l("error",d.toString())}}function a(){let _=t.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[jn(_.getSouthWest()),jn(_.getNorthWest()),jn(_.getNorthEast()),jn(_.getSouthEast()),jn(_.getSouthWest())]],type:"Polygon"}}}async function f(){if(t){if(t.getZoom()<13){l("error","Zoom in more to import");return}await s(a())}}function u(){t&&(n(0,o=new D1(t)),o.startNew(),o.addEventListenerSuccess(async _=>{n(0,o=null),await s(_)}),o.addEventListenerFailure(()=>{n(0,o=null)}))}function c(){i=this.checked,n(1,i)}return r.$$set=_=>{"map"in _&&n(4,t=_.map)},[o,i,f,u,t,c]}class Ch extends se{constructor(e){super(),ae(this,e,Sh,kh,le,{map:4})}}function Ns(r){let e='poly:"';for(let[t,l]of r.geometry.coordinates[0])e+=`${l} ${t} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class js{constructor(e,n,t,l){pt(this,"inner");this.inner=new Hd(e,n||new Uint8Array,t,l)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=Lh(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(n=>n.properties.kind=="interior_road"?n.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,n){this.inner.setNeighbourhoodBoundary(e,n)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,n){this.inner.renameNeighbourhoodBoundary(e,n)}setCurrentNeighbourhood(e,n){this.inner.setCurrentNeighbourhood(e,n)}addModalFilter(e,n){this.inner.addModalFilter(e,n)}addManyModalFilters(e,n){this.inner.addManyModalFilters(e,n)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,n,t){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,n.lng,n.lat,t))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let n of e.features)n.properties.sum_from=ao(n.properties.counts_from),n.properties.sum_to=ao(n.properties.counts_to);return e}}function Lh(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let n of r.features)n.properties.kind!="cell"&&n.properties.kind!="border_arrow"&&n.properties.kind!="interior_road"||(n.properties.cell_color=="disconnected"?n.properties.color="red":n.properties.color=e[n.properties.cell_color%e.length]);return r}async function mr(r){Yt.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let[n,t,l]=await Mh(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),xe.set(new js(new Uint8Array(n),t?new Uint8Array(t):void 0,l,e.study_area_name||void 0)),Wt(xe).loadSavefile(e),console.timeEnd("load"),zs()}catch(e){window.alert(`Couldn't open project: ${e}`),Yt.set("")}}async function Mh(r,e){if(e){let n=St(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${n}`);let l=await(await bn(n)).arrayBuffer(),o=St(`cnt_boundaries/${r.study_area_name}.geojson`),s=await(await bn(o)).json(),a=St(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let f=null;try{f=await(await bn(a)).arrayBuffer()}catch(u){console.log(`No demand model: ${u}`)}return[l,f,s]}else if(r.study_area_name){let n=St(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${n}`);let l=await(await bn(n)).arrayBuffer(),o=St(`boundaries/${r.study_area_name}.geojson`),s=await(await bn(o)).json();return[l,null,s]}else{console.log("Grabbing from Overpass");let n=r.features.find(o=>o.properties.kind=="study_area_boundary");return[await(await bn(Ns(n))).arrayBuffer(),null,n]}}function zs(){ce.set({mode:"pick-neighbourhood"}),Fn.set(new Ff(Wt(Qt),Wt(xe).toRouteSnapper(),Mt(rn()),Mt(!0),Mt(0))),Wt(Qt).fitBounds(Wt(xe).getBounds(),{animate:!1}),Zn.set(Jr()),Yn.set(Jr()),fr.set(Jr());let r=new URL(window.location.href);r.searchParams.set("project",Wt(Yt)),window.history.replaceState(null,"",r.toString())}function Jr(){let r=Wt(xe).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),n=r[1]+Math.random()*(r[3]-r[1]);return new Vr.LngLat(e,n)}function Ni(r,e,n){const t=r.slice();return t[16]=e[n][0],t[17]=e[n][1],t}function ji(r,e,n){const t=r.slice();return t[20]=e[n][0],t[21]=e[n][1],t}function Th(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Ah(r){let e,n,t,l,o,i,s,a;return o=new Le({props:{$$slots:{default:[Th]},$$scope:{ctx:r}}}),o.$on("click",r[13]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),s.textContent="New project",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(f,u){b(f,e,u),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),a=!0},p(f,u){const c={};u&16777216&&(c.$$scope={dirty:u,ctx:f}),o.$set(c)},i(f){a||(v(o.$$.fragment,f),a=!0)},o(f){S(o.$$.fragment,f),a=!1},d(f){f&&$(e),E(o)}}}function zi(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;e=new xi({props:{loading:r[4]}});let g=Me(r[3]),y=[];for(let h=0;h<g.length;h+=1)y[h]=Bi(Ni(r,g,h));return c=new Ch({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){P(e.$$.fragment),n=M(),t=k("label"),l=z(`Load a built-in area:
        `),o=k("select"),i=k("option");for(let h=0;h<y.length;h+=1)y[h].c();s=M(),a=k("i"),a.textContent="or...",f=M(),u=k("div"),P(c.$$.fragment),i.__value="",ze(i,i.__value),r[2]===void 0&&fn(()=>r[9].call(o))},m(h,w){I(e,h,w),b(h,n,w),b(h,t,w),p(t,l),p(t,o),p(o,i);for(let C=0;C<y.length;C+=1)y[C]&&y[C].m(o,null);yt(o,r[2],!0),b(h,s,w),b(h,a,w),b(h,f,w),b(h,u,w),I(c,u,null),_=!0,d||(m=[K(o,"change",r[9]),K(o,"change",r[10])],d=!0)},p(h,w){const C={};if(w&16&&(C.loading=h[4]),e.$set(C),w&8){g=Me(h[3]);let F;for(F=0;F<g.length;F+=1){const T=Ni(h,g,F);y[F]?y[F].p(T,w):(y[F]=Bi(T),y[F].c(),y[F].m(o,null))}for(;F<y.length;F+=1)y[F].d(1);y.length=g.length}w&12&&yt(o,h[2]);const L={};w&32&&(L.map=h[5]),c.$set(L)},i(h){_||(v(e.$$.fragment,h),v(c.$$.fragment,h),_=!0)},o(h){S(e.$$.fragment,h),S(c.$$.fragment,h),_=!1},d(h){h&&($(n),$(t),$(s),$(a),$(f),$(u)),E(e,h),st(y,h),E(c),d=!1,nt(m)}}}function Oi(r){let e,n=r[21]+"",t,l;return{c(){e=k("option"),t=z(n),e.__value=l=r[20],ze(e,e.__value)},m(o,i){b(o,e,i),p(e,t)},p(o,i){i&8&&n!==(n=o[21]+"")&&ne(t,n),i&8&&l!==(l=o[20])&&(e.__value=l,ze(e,e.__value))},d(o){o&&$(e)}}}function Bi(r){let e,n,t=Me(r[17]),l=[];for(let o=0;o<t.length;o+=1)l[o]=Oi(ji(r,t,o));return{c(){e=k("optgroup");for(let o=0;o<l.length;o+=1)l[o].c();N(e,"label",n=r[16])},m(o,i){b(o,e,i);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(o,i){if(i&8){t=Me(o[17]);let s;for(s=0;s<t.length;s+=1){const a=ji(o,t,s);l[s]?l[s].p(a,i):(l[s]=Oi(a),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=t.length}i&8&&n!==(n=o[16])&&N(e,"label",n)},d(o){o&&$(e),st(l,o)}}}function Fh(r){let e,n,t,l,o,i,s,a,f,u=r[1]&&zi(r);return{c(){e=k("div"),n=k("div"),t=k("label"),l=z(`Project name:
        `),o=k("input"),i=M(),u&&u.c(),N(o,"type","text"),N(e,"slot","sidebar")},m(c,_){b(c,e,_),p(e,n),p(n,t),p(t,l),p(t,o),ze(o,r[1]),p(e,i),u&&u.m(e,null),s=!0,a||(f=K(o,"input",r[8]),a=!0)},p(c,_){_&2&&o.value!==c[1]&&ze(o,c[1]),c[1]?u?(u.p(c,_),_&2&&v(u,1)):(u=zi(c),u.c(),v(u,1),u.m(e,null)):u&&(he(),S(u,1,1,()=>{u=null}),be())},i(c){s||(v(u),s=!0)},o(c){S(u),s=!1},d(c){c&&$(e),u&&u.d(),a=!1,f()}}}function Ph(r){let e,n,t;return n=new vh({}),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","map")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p:Q,i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function Ih(r){let e,n;return e=new At({props:{$$slots:{map:[Ph],sidebar:[Fh],top:[Ah]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&16777342&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Eh(r,e,n){let t,l,o,i;V(r,Yt,C=>n(14,t=C)),V(r,xe,C=>n(15,l=C)),V(r,Qt,C=>n(5,o=C)),V(r,ce,C=>n(6,i=C));let s="",a="",f=[],u="";Sr(async()=>{let C=await bn(St("severance_pbfs/areas.json"));n(3,f=await C.json())});function c(C){n(4,u="Loading OSM");try{te(xe,l=new js(new TextEncoder().encode(C.detail.xml),void 0,C.detail.boundary,void 0),l),te(Yt,t=`ltn_${s}`,t),zs(),Tn()}catch(L){window.alert(`Couldn't import from Overpass: ${L}`)}n(4,u="")}async function _(){if(a=="")return;let C=`ltn_${s}`;window.localStorage.setItem(C,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:a})),n(4,u=`Loading pre-clipped OSM area ${a}`),await mr(C),n(4,u="")}function d(){s=this.value,n(1,s)}function m(){a=un(this),n(2,a),n(3,f)}return[_,s,a,f,u,o,i,c,d,m,()=>_(),C=>n(4,u=C.detail),C=>window.alert(C.detail),()=>te(ce,i={mode:"title",firstLoad:!1},i)]}class Nh extends se{constructor(e){super(),ae(this,e,Eh,Ih,le,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Ri(r,e,n){const t=r.slice();return t[19]=e[n][0],t[20]=e[n][1],t}function Di(r,e,n){const t=r.slice();return t[23]=e[n],t}function jh(r){let e;return{c(){e=k("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',N(e,"slot","top")},m(n,t){b(n,e,t)},p:Q,d(n){n&&$(e)}}}function zh(r){let e;return{c(){e=k("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(n,t){b(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function Oh(r){let e,n,t,l,o,i,s,a,f,u,c,_,d;n=new Le({props:{$$slots:{default:[Bh]},$$scope:{ctx:r}}}),n.$on("click",r[11]);let m=Me(r[2]),g=[];for(let h=0;h<m.length;h+=1)g[h]=Hi(Ri(r,m,h));const y=h=>S(g[h],1,1,()=>{g[h]=null});return{c(){e=k("div"),P(n.$$.fragment),t=M(),l=k("p"),l.textContent="Load a saved project:",o=M(),i=k("ul");for(let h=0;h<g.length;h+=1)g[h].c();s=M(),a=k("label"),f=z(`Load a project from a file
        `),u=k("input"),N(u,"type","file")},m(h,w){b(h,e,w),I(n,e,null),b(h,t,w),b(h,l,w),b(h,o,w),b(h,i,w);for(let C=0;C<g.length;C+=1)g[C]&&g[C].m(i,null);b(h,s,w),b(h,a,w),p(a,f),p(a,u),r[15](u),c=!0,_||(d=K(u,"change",r[6]),_=!0)},p(h,w){const C={};if(w&67108864&&(C.$$scope={dirty:w,ctx:h}),n.$set(C),w&900){m=Me(h[2]);let L;for(L=0;L<m.length;L+=1){const F=Ri(h,m,L);g[L]?(g[L].p(F,w),v(g[L],1)):(g[L]=Hi(F),g[L].c(),v(g[L],1),g[L].m(i,null))}for(he(),L=m.length;L<g.length;L+=1)y(L);be()}},i(h){if(!c){v(n.$$.fragment,h);for(let w=0;w<m.length;w+=1)v(g[w]);c=!0}},o(h){S(n.$$.fragment,h),g=g.filter(Boolean);for(let w=0;w<g.length;w+=1)S(g[w]);c=!1},d(h){h&&($(e),$(t),$(l),$(o),$(i),$(s),$(a)),E(n),st(g,h),r[15](null),_=!1,d()}}}function Bh(r){let e;return{c(){e=z("New project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Rh(r){let e=r[23].slice(4)+"",n;return{c(){n=z(e)},m(t,l){b(t,n,l)},p(t,l){l&4&&e!==(e=t[23].slice(4)+"")&&ne(n,e)},d(t){t&&$(n)}}}function Ui(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;function g(){return r[12](r[23])}t=new Le({props:{$$slots:{default:[Rh]},$$scope:{ctx:r}}}),t.$on("click",g),s=new wl({props:{color:"black"}});function y(){return r[13](r[23])}u=new gs({props:{color:"white"}});function h(){return r[14](r[23])}return{c(){e=k("li"),n=k("span"),P(t.$$.fragment),l=M(),o=k("span"),i=k("button"),P(s.$$.fragment),a=M(),f=k("button"),P(u.$$.fragment),c=M(),N(i,"class","outline icon-btn"),N(i,"aria-label","Rename project"),N(f,"class","icon-btn destructive"),N(f,"aria-label","Delete project"),oe(o,"display","flex"),oe(o,"gap","16px"),oe(n,"display","flex"),oe(n,"justify-content","space-between")},m(w,C){b(w,e,C),p(e,n),I(t,n,null),p(n,l),p(n,o),p(o,i),I(s,i,null),p(o,a),p(o,f),I(u,f,null),p(e,c),_=!0,d||(m=[K(i,"click",y),K(f,"click",h)],d=!0)},p(w,C){r=w;const L={};C&67108868&&(L.$$scope={dirty:C,ctx:r}),t.$set(L)},i(w){_||(v(t.$$.fragment,w),v(s.$$.fragment,w),v(u.$$.fragment,w),_=!0)},o(w){S(t.$$.fragment,w),S(s.$$.fragment,w),S(u.$$.fragment,w),_=!1},d(w){w&&$(e),E(t),E(s),E(u),d=!1,nt(m)}}}function Hi(r){let e,n=(r[19]??"custom area")+"",t,l,o,i,s=Me(r[20]),a=[];for(let u=0;u<s.length;u+=1)a[u]=Ui(Di(r,s,u));const f=u=>S(a[u],1,1,()=>{a[u]=null});return{c(){e=k("u"),t=z(n),l=M();for(let u=0;u<a.length;u+=1)a[u].c();o=Ye()},m(u,c){b(u,e,c),p(e,t),b(u,l,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(u,c);b(u,o,c),i=!0},p(u,c){if((!i||c&4)&&n!==(n=(u[19]??"custom area")+"")&&ne(t,n),c&900){s=Me(u[20]);let _;for(_=0;_<s.length;_+=1){const d=Di(u,s,_);a[_]?(a[_].p(d,c),v(a[_],1)):(a[_]=Ui(d),a[_].c(),v(a[_],1),a[_].m(o.parentNode,o))}for(he(),_=s.length;_<a.length;_+=1)f(_);be()}},i(u){if(!i){for(let c=0;c<s.length;c+=1)v(a[c]);i=!0}},o(u){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)S(a[c]);i=!1},d(u){u&&($(e),$(l),$(o)),st(a,u)}}}function Dh(r){let e,n,t,l;const o=[Oh,zh],i=[];function s(a,f){return a[4]&&a[0]?0:1}return n=s(r),t=i[n]=o[n](r),{c(){e=k("div"),t.c(),N(e,"slot","sidebar")},m(a,f){b(a,e,f),i[n].m(e,null),l=!0},p(a,f){let u=n;n=s(a),n===u?i[n].p(a,f):(he(),S(i[u],1,1,()=>{i[u]=null}),be(),t=i[n],t?t.p(a,f):(t=i[n]=o[n](a),t.c()),v(t,1),t.m(e,null))},i(a){l||(v(t),l=!0)},o(a){S(t),l=!1},d(a){a&&$(e),i[n].d()}}}function Uh(r){let e,n,t,l;return e=new xi({props:{loading:r[1]}}),t=new At({props:{$$slots:{sidebar:[Dh],top:[jh]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment)},m(o,i){I(e,o,i),b(o,n,i),I(t,o,i),l=!0},p(o,[i]){const s={};i&2&&(s.loading=o[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:o}),t.$set(a)},i(o){l||(v(e.$$.fragment,o),v(t.$$.fragment,o),l=!0)},o(o){S(e.$$.fragment,o),S(t.$$.fragment,o),l=!1},d(o){o&&$(n),E(e,o),E(t,o)}}}function ar(){let r=new Map,e=[];for(let t=0;t<window.localStorage.length;t++){let l=window.localStorage.key(t);if(l.startsWith("ltn_")){let o="";try{o=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}o&&o.length>0?(r.has(o)||r.set(o,[]),r.get(o).push(l)):e.push(l)}}let n=[...r.entries()];return n.sort((t,l)=>t[0].localeCompare(l[0])),n.push(["custom",e]),n}function Hh(r,e,n){let t,l,o,i,s;V(r,Yt,T=>n(16,t=T)),V(r,Fn,T=>n(17,l=T)),V(r,xe,T=>n(18,o=T)),V(r,Qt,T=>n(4,i=T)),V(r,ce,T=>n(5,s=T));let{wasmReady:a}=e,{firstLoad:f}=e,u="";if(te(xe,o=null,o),te(Fn,l=null,l),te(Yt,t="",t),f){let A=new URLSearchParams(window.location.search).get("project");A&&(u=`Loading project ${A}`,mr(A))}else{let T=new URL(window.location.href);T.searchParams.delete("project"),window.history.replaceState(null,"",T.toString())}let c=ar(),_;async function d(T){let A="ltn_"+_.files[0].name;n(1,u=`Loading from file ${A}`),window.localStorage.setItem(A,await _.files[0].text()),n(2,c=ar()),await mr(A),n(1,u="")}function m(T){window.confirm(`Really delete project ${T}? You can't undo this.`)&&(window.localStorage.removeItem(T),n(2,c=ar()))}function g(T){let A=window.prompt(`Rename project ${T} to what?`,T);if(A){A.startsWith("ltn_")||(A=`ltn_${A}`);let j=window.localStorage.getItem(T);window.localStorage.setItem(A,j),window.localStorage.removeItem(T),n(2,c=ar())}}async function y(T){n(1,u=`Loading project ${T}`),await mr(T),n(1,u="")}const h=()=>te(ce,s={mode:"new-project"},s),w=T=>y(T),C=T=>g(T),L=T=>m(T);function F(T){Ge[T?"unshift":"push"](()=>{_=T,n(3,_)})}return r.$$set=T=>{"wasmReady"in T&&n(0,a=T.wasmReady),"firstLoad"in T&&n(10,f=T.firstLoad)},[a,u,c,_,i,s,d,m,g,y,f,h,w,C,L,F]}class Gh extends se{constructor(e){super(),ae(this,e,Hh,Uh,le,{wasmReady:0,firstLoad:10})}}function Wh(r){let e;return{c(){e=z("Choose project")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function qh(r){let e;return{c(){e=z("Pick neighbourhood")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Jh(r){let e;return{c(){e=z("Editing")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function Yh(r){let e,n,t,l,o,i,s,a,f,u,c,_,d,m;return o=new Le({props:{$$slots:{default:[Wh]},$$scope:{ctx:r}}}),o.$on("click",r[6]),a=new Le({props:{$$slots:{default:[qh]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new Le({props:{$$slots:{default:[Jh]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=k("div"),n=k("nav"),t=k("ul"),l=k("li"),P(o.$$.fragment),i=M(),s=k("li"),P(a.$$.fragment),f=M(),u=k("li"),P(c.$$.fragment),_=M(),d=k("li"),d.textContent="Viewing shortcuts",N(n,"aria-label","breadcrumb"),N(e,"slot","top")},m(g,y){b(g,e,y),p(e,n),p(n,t),p(t,l),I(o,l,null),p(t,i),p(t,s),I(a,s,null),p(t,f),p(t,u),I(c,u,null),p(t,_),p(t,d),m=!0},p(g,y){const h={};y&1024&&(h.$$scope={dirty:y,ctx:g}),o.$set(h);const w={};y&1024&&(w.$$scope={dirty:y,ctx:g}),a.$set(w);const C={};y&1024&&(C.$$scope={dirty:y,ctx:g}),c.$set(C)},i(g){m||(v(o.$$.fragment,g),v(a.$$.fragment,g),v(c.$$.fragment,g),m=!0)},o(g){S(o.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&$(e),E(o),E(a),E(c)}}}function Zh(r){let e,n,t,l,o,i,s,a,f,u,c=ft(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,m,g,y,h;function w(L){r[5](L)}let C={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(C.idx=r[0].shortcutIndex),o=new Pr({props:C}),Ge.push(()=>ut(o,"idx",w)),{c(){e=k("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,n=M(),t=k("button"),t.textContent="Pick a different road",l=M(),P(o.$$.fragment),s=M(),a=k("p"),f=z("This shortcut is "),u=k("b"),_=z(c),d=z("x"),m=z(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(L,F){b(L,e,F),b(L,n,F),b(L,t,F),b(L,l,F),I(o,L,F),b(L,s,F),b(L,a,F),p(a,f),p(a,u),p(u,_),p(u,d),p(a,m),g=!0,y||(h=K(t,"click",r[4]),y=!0)},p(L,F){const T={};F&1&&(T.list=L[0].gj.features),!i&&F&1&&(i=!0,T.idx=L[0].shortcutIndex,ct(()=>i=!1)),o.$set(T),(!g||F&1)&&c!==(c=ft(L[0].gj.features[L[0].shortcutIndex].properties).directness.toFixed(1)+"")&&ne(_,c)},i(L){g||(v(o.$$.fragment,L),g=!0)},o(L){S(o.$$.fragment,L),g=!1},d(L){L&&($(e),$(n),$(t),$(l),$(s),$(a)),E(o,L),y=!1,h()}}}function Kh(r){let e;return{c(){e=k("p"),e.textContent="Click a road to see shortcuts"},m(n,t){b(n,e,t)},p:Q,i:Q,o:Q,d(n){n&&$(e)}}}function Xh(r){let e,n,t,l,o,i;n=new pn({}),n.$on("click",r[3]);const s=[Kh,Zh],a=[];function f(u,c){return u[0].state=="neutral"?0:u[0].state=="chose-road"?1:-1}return~(l=f(r))&&(o=a[l]=s[l](r)),{c(){e=k("div"),P(n.$$.fragment),t=M(),o&&o.c(),N(e,"slot","sidebar")},m(u,c){b(u,e,c),I(n,e,null),p(e,t),~l&&a[l].m(e,null),i=!0},p(u,c){let _=l;l=f(u),l===_?~l&&a[l].p(u,c):(o&&(he(),S(a[_],1,1,()=>{a[_]=null}),be()),~l?(o=a[l],o?o.p(u,c):(o=a[l]=s[l](u),o.c()),v(o,1),o.m(e,null)):o=null)},i(u){i||(v(n.$$.fragment,u),v(o),i=!0)},o(u){S(n.$$.fragment,u),S(o),i=!1},d(u){u&&$(e),E(n),~l&&a[l].d()}}}function Vh(r){let e,n;return e=new nr({props:{interactive:!1}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Qh(r){let e,n;return e=new nr({props:{onClickLine:r[2],$$slots:{"line-popup":[e0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&1024&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function xh(r){let e,n=r[9].shortcuts+"",t,l,o=(r[9].name??"unnamed road")+"",i;return{c(){e=k("p"),t=z(n),l=z(" shortcuts through "),i=z(o)},m(s,a){b(s,e,a),p(e,t),p(e,l),p(e,i)},p(s,a){a&512&&n!==(n=s[9].shortcuts+"")&&ne(t,n),a&512&&o!==(o=(s[9].name??"unnamed road")+"")&&ne(i,o)},d(s){s&&$(e)}}}function e0(r){let e,n,t;return n=new dt({props:{openOn:"hover",$$slots:{default:[xh,({props:l})=>({9:l}),({props:l})=>l?512:0]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","line-popup")},m(l,o){b(l,e,o),I(n,e,null),t=!0},p(l,o){const i={};o&1536&&(i.$$scope={dirty:o,ctx:l}),n.$set(i)},i(l){t||(v(n.$$.fragment,l),t=!0)},o(l){S(n.$$.fragment,l),t=!1},d(l){l&&$(e),E(n)}}}function t0(r){let e,n,t,l,o,i,s,a,f,u;e=new Er({}),t=new Ir({}),o=new Nr({});const c=[Qh,Vh],_=[];function d(m,g){return m[0].state=="neutral"?0:m[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),a&&a.c(),f=Ye()},m(m,g){I(e,m,g),b(m,n,g),I(t,m,g),b(m,l,g),I(o,m,g),b(m,i,g),~s&&_[s].m(m,g),b(m,f,g),u=!0},p(m,g){let y=s;s=d(m),s===y?~s&&_[s].p(m,g):(a&&(he(),S(_[y],1,1,()=>{_[y]=null}),be()),~s?(a=_[s],a?a.p(m,g):(a=_[s]=c[s](m),a.c()),v(a,1),a.m(f.parentNode,f)):a=null)},i(m){u||(v(e.$$.fragment,m),v(t.$$.fragment,m),v(o.$$.fragment,m),v(a),u=!0)},o(m){S(e.$$.fragment,m),S(t.$$.fragment,m),S(o.$$.fragment,m),S(a),u=!1},d(m){m&&($(n),$(l),$(i),$(f)),E(e,m),E(t,m),E(o,m),~s&&_[s].d(m)}}}function Gi(r){let e,n,t,l,o,i,s,a;return e=new Ve({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[n0]},$$scope:{ctx:r}}}),t=new Ve({props:{data:r[0].roadGj,$$slots:{default:[r0]},$$scope:{ctx:r}}}),o=new wn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[l0]},$$scope:{ctx:r}}}),s=new wn({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[o0]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),P(s.$$.fragment)},m(f,u){I(e,f,u),b(f,n,u),I(t,f,u),b(f,l,u),I(o,f,u),b(f,i,u),I(s,f,u),a=!0},p(f,u){const c={};u&1&&(c.data=f[0].gj.features[f[0].shortcutIndex]),u&1024&&(c.$$scope={dirty:u,ctx:f}),e.$set(c);const _={};u&1&&(_.data=f[0].roadGj),u&1024&&(_.$$scope={dirty:u,ctx:f}),t.$set(_);const d={};u&1&&(d.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[0]),u&1024&&(d.$$scope={dirty:u,ctx:f}),o.$set(d);const m={};u&1&&(m.lngLat=f[0].gj.features[f[0].shortcutIndex].geometry.coordinates[f[0].gj.features[f[0].shortcutIndex].geometry.coordinates.length-1]),u&1024&&(m.$$scope={dirty:u,ctx:f}),s.$set(m)},i(f){a||(v(e.$$.fragment,f),v(t.$$.fragment,f),v(o.$$.fragment,f),v(s.$$.fragment,f),a=!0)},o(f){S(e.$$.fragment,f),S(t.$$.fragment,f),S(o.$$.fragment,f),S(s.$$.fragment,f),a=!1},d(f){f&&($(n),$(l),$(i)),E(e,f),E(t,f),E(o,f),E(s,f)}}}function n0(r){let e,n;const t=[we("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function r0(r){let e,n;const t=[we("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new tt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function l0(r){let e;return{c(){e=z("A")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function o0(r){let e;return{c(){e=z("B")},m(n,t){b(n,e,t)},d(n){n&&$(e)}}}function i0(r){let e,n,t,l,o,i;n=new rr({props:{$$slots:{default:[t0]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Gi(r);return o=new gn({}),{c(){e=k("div"),P(n.$$.fragment),t=M(),s&&s.c(),l=M(),P(o.$$.fragment),N(e,"slot","map")},m(a,f){b(a,e,f),I(n,e,null),p(e,t),s&&s.m(e,null),p(e,l),I(o,e,null),i=!0},p(a,f){const u={};f&1025&&(u.$$scope={dirty:f,ctx:a}),n.$set(u),a[0].state=="chose-road"?s?(s.p(a,f),f&1&&v(s,1)):(s=Gi(a),s.c(),v(s,1),s.m(e,l)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){i||(v(n.$$.fragment,a),v(s),v(o.$$.fragment,a),i=!0)},o(a){S(n.$$.fragment,a),S(s),S(o.$$.fragment,a),i=!1},d(a){a&&$(e),E(n),s&&s.d(),E(o)}}}function s0(r){let e,n;return e=new At({props:{$$slots:{map:[i0],sidebar:[Xh],top:[Yh]},$$scope:{ctx:r}}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,[l]){const o={};l&1027&&(o.$$scope={dirty:l,ctx:t}),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function a0(r,e,n){let t,l;V(r,ce,_=>n(1,t=_)),V(r,xe,_=>n(8,l=_));let o={state:"neutral"};function i(_,d){let m=l.getShortcutsCrossingRoad(_.properties.id);if(m.features.length==0){window.alert("No shortcuts here");return}n(0,o={state:"chose-road",roadGj:_,gj:m,shortcutIndex:0})}function s(){te(ce,t={mode:"neighbourhood"},t)}const a=()=>n(0,o={state:"neutral"});function f(_){r.$$.not_equal(o.shortcutIndex,_)&&(o.shortcutIndex=_,n(0,o))}return[o,t,i,s,a,f,()=>te(ce,t={mode:"title",firstLoad:!1},t),()=>te(ce,t={mode:"pick-neighbourhood"},t)]}class f0 extends se{constructor(e){super(),ae(this,e,a0,s0,le,{})}}function u0(r){let e,n,t,l,o,i,s,a,f;return l=new j1({}),{c(){e=k("div"),n=k("button"),n.innerHTML=`<img src="${$a}" style="height: 6vh;" alt="A/B Street logo"/>`,t=M(),P(l.$$.fragment),o=M(),i=k("span"),N(n,"class","outline"),oe(i,"width","100%"),N(e,"slot","top"),N(e,"class","pico"),oe(e,"display","flex")},m(u,c){b(u,e,c),p(e,n),p(e,t),I(l,e,null),p(e,o),p(e,i),r[20](i),s=!0,a||(f=K(n,"click",r[19]),a=!0)},p:Q,i(u){s||(v(l.$$.fragment,u),s=!0)},o(u){S(l.$$.fragment,u),s=!1},d(u){u&&$(e),E(l),r[20](null),a=!1,f()}}}function Wi(r){let e,n,t,l,o,i;return t=new Xu({props:{map:ft(r[6]),maptilerBasemap:r[7]}}),{c(){e=k("button"),e.textContent="Zoom to fit study area",n=M(),P(t.$$.fragment),N(e,"class","secondary")},m(s,a){b(s,e,a),b(s,n,a),I(t,s,a),l=!0,o||(i=K(e,"click",r[11]),o=!0)},p(s,a){const f={};a&64&&(f.map=ft(s[6])),a&128&&(f.maptilerBasemap=s[7]),t.$set(f)},i(s){l||(v(t.$$.fragment,s),l=!0)},o(s){S(t.$$.fragment,s),l=!1},d(s){s&&($(e),$(n)),E(t,s),o=!1,i()}}}function c0(r){let e,n,t,l,o,i,s=r[5]&&Wi(r);return{c(){e=k("div"),n=k("div"),t=M(),l=k("hr"),o=M(),s&&s.c(),N(e,"class","pico"),N(e,"slot","left")},m(a,f){b(a,e,f),p(e,n),r[18](n),p(e,t),p(e,l),p(e,o),s&&s.m(e,null),i=!0},p(a,f){a[5]?s?(s.p(a,f),f&32&&v(s,1)):(s=Wi(a),s.c(),v(s,1),s.m(e,null)):s&&(he(),S(s,1,1,()=>{s=null}),be())},i(a){i||(v(s),i=!0)},o(a){S(s),i=!1},d(a){a&&$(e),r[18](null),s&&s.d()}}}function qi(r){let e,n;return e=new zd({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function d0(r){let e,n;return e=new Nh({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function _0(r){let e,n;return e=new Gh({props:{wasmReady:r[4],firstLoad:r[9].firstLoad}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&16&&(o.wasmReady=t[4]),l&512&&(o.firstLoad=t[9].firstLoad),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function Ji(r){let e,n,t,l,o,i;e=new Ve({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[m0]},$$scope:{ctx:r}}});const s=[L0,C0,S0,k0,w0,y0,v0,$0,b0,h0,g0,p0],a=[];function f(u,c){return u[9].mode=="pick-neighbourhood"?0:u[9].mode=="set-boundary"?1:u[9].mode=="auto-boundaries"?2:u[9].mode=="neighbourhood"?3:u[9].mode=="view-shortcuts"?4:u[9].mode=="impact-one-destination"?5:u[9].mode=="route"?6:u[9].mode=="predict-impact"?7:u[9].mode=="impact-detail"?8:u[9].mode=="debug-neighbourhood"?9:u[9].mode=="debug-intersections"?10:u[9].mode=="debug-demand"?11:-1}return~(t=f(r))&&(l=a[t]=s[t](r)),{c(){P(e.$$.fragment),n=M(),l&&l.c(),o=Ye()},m(u,c){I(e,u,c),b(u,n,c),~t&&a[t].m(u,c),b(u,o,c),i=!0},p(u,c){const _={};c&32&&(_.data=u[5].getInvertedBoundary()),c&4194304&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);let d=t;t=f(u),t===d?~t&&a[t].p(u,c):(l&&(he(),S(a[d],1,1,()=>{a[d]=null}),be()),~t?(l=a[t],l?l.p(u,c):(l=a[t]=s[t](u),l.c()),v(l,1),l.m(o.parentNode,o)):l=null)},i(u){i||(v(e.$$.fragment,u),v(l),i=!0)},o(u){S(e.$$.fragment,u),S(l),i=!1},d(u){u&&($(n),$(o)),E(e,u),~t&&a[t].d(u)}}}function m0(r){let e,n;const t=[we("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let o=0;o<t.length;o+=1)l=_e(l,t[o]);return e=new wt({props:l}),{c(){P(e.$$.fragment)},m(o,i){I(e,o,i),n=!0},p(o,i){const s={};e.$set(s)},i(o){n||(v(e.$$.fragment,o),n=!0)},o(o){S(e.$$.fragment,o),n=!1},d(o){E(e,o)}}}function p0(r){let e,n;return e=new j_({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function g0(r){let e,n;return e=new q_({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function h0(r){let e,n;return e=new Tm({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function b0(r){let e,n;return e=new Zp({props:{road:r[9].road}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.road=t[9].road),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function $0(r){let e,n;return e=new Gg({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function v0(r){let e,n;return e=new n1({props:{prevMode:r[9].prevMode}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.prevMode=t[9].prevMode),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function y0(r){let e,n;return e=new fg({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function w0(r){let e,n;return e=new f0({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function k0(r){let e,n;return e=new zp({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function S0(r){let e,n;return e=new S_({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function C0(r){let e,n;return e=new F1({props:{name:r[9].name,existing:r[9].existing}}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p(t,l){const o={};l&512&&(o.name=t[9].name),l&512&&(o.existing=t[9].existing),e.$set(o)},i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function L0(r){let e,n;return e=new Ig({}),{c(){P(e.$$.fragment)},m(t,l){I(e,t,l),n=!0},p:Q,i(t){n||(v(e.$$.fragment,t),n=!0)},o(t){S(e.$$.fragment,t),n=!1},d(t){E(e,t)}}}function M0(r){let e,n,t,l,o,i,s=r[8].startsWith("ltn_cnt/"),a,f,u,c,_,d,m,g,y;e=new ga({}),t=new ha({}),o=new Ec({props:{map:r[0],apiKey:Qr,country:void 0}});let h=s&&qi();const w=[_0,d0],C=[];function L(T,A){return T[9].mode=="title"?0:T[9].mode=="new-project"?1:-1}~(c=L(r))&&(_=C[c]=w[c](r));let F=r[5]&&Ji(r);return g=new uu({}),{c(){P(e.$$.fragment),n=M(),P(t.$$.fragment),l=M(),P(o.$$.fragment),i=M(),h&&h.c(),a=M(),f=k("div"),u=M(),_&&_.c(),d=M(),F&&F.c(),m=M(),P(g.$$.fragment)},m(T,A){I(e,T,A),b(T,n,A),I(t,T,A),b(T,l,A),I(o,T,A),b(T,i,A),h&&h.m(T,A),b(T,a,A),b(T,f,A),r[15](f),b(T,u,A),~c&&C[c].m(T,A),b(T,d,A),F&&F.m(T,A),b(T,m,A),I(g,T,A),y=!0},p(T,A){const j={};A&1&&(j.map=T[0]),o.$set(j),A&256&&(s=T[8].startsWith("ltn_cnt/")),s?h?A&256&&v(h,1):(h=qi(),h.c(),v(h,1),h.m(a.parentNode,a)):h&&(he(),S(h,1,1,()=>{h=null}),be());let O=c;c=L(T),c===O?~c&&C[c].p(T,A):(_&&(he(),S(C[O],1,1,()=>{C[O]=null}),be()),~c?(_=C[c],_?_.p(T,A):(_=C[c]=w[c](T),_.c()),v(_,1),_.m(d.parentNode,d)):_=null),T[5]?F?(F.p(T,A),A&32&&v(F,1)):(F=Ji(T),F.c(),v(F,1),F.m(m.parentNode,m)):F&&(he(),S(F,1,1,()=>{F=null}),be())},i(T){y||(v(e.$$.fragment,T),v(t.$$.fragment,T),v(o.$$.fragment,T),v(h),v(_),v(F),v(g.$$.fragment,T),y=!0)},o(T){S(e.$$.fragment,T),S(t.$$.fragment,T),S(o.$$.fragment,T),S(h),S(_),S(F),S(g.$$.fragment,T),y=!1},d(T){T&&($(n),$(l),$(i),$(a),$(f),$(u),$(d),$(m)),E(e,T),E(t,T),E(o,T),h&&h.d(T),r[15](null),~c&&C[c].d(T),F&&F.d(T),E(g,T)}}}function T0(r){let e,n,t,l;function o(s){r[16](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${Qr}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"oneway_arrow",url:ba},{id:"national_rail",url:Qi}],$$slots:{default:[M0]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),n=new pa({props:i}),Ge.push(()=>ut(n,"map",o)),n.$on("error",r[17]),{c(){e=k("div"),P(n.$$.fragment),N(e,"slot","main"),oe(e,"position","relative"),oe(e,"width","100%"),oe(e,"height","100%")},m(s,a){b(s,e,a),I(n,e,null),l=!0},p(s,a){const f={};a&128&&(f.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${Qr}`),a&4195129&&(f.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,f.map=s[0],ct(()=>t=!1)),n.$set(f)},i(s){l||(v(n.$$.fragment,s),l=!0)},o(s){S(n.$$.fragment,s),l=!1},d(s){s&&$(e),E(n)}}}function A0(r){let e,n,t,l,o;return n=new Nf({}),l=new Vd({props:{$$slots:{main:[T0],left:[c0],top:[u0]},$$scope:{ctx:r}}}),{c(){e=k("div"),P(n.$$.fragment),t=M(),P(l.$$.fragment),N(e,"class","pico")},m(i,s){b(i,e,s),I(n,e,null),b(i,t,s),I(l,i,s),o=!0},p(i,[s]){const a={};s&4196351&&(a.$$scope={dirty:s,ctx:i}),l.$set(a)},i(i){o||(v(n.$$.fragment,i),v(l.$$.fragment,i),o=!0)},o(i){S(n.$$.fragment,i),S(l.$$.fragment,i),o=!1},d(i){i&&($(e),$(t)),E(n),E(l,i)}}}function F0(r,e,n){let t,l,o,i,s,a,f,u,c,_;V(r,al,O=>n(12,t=O)),V(r,sl,O=>n(13,l=O)),V(r,il,O=>n(14,o=O)),V(r,xe,O=>n(5,i=O)),V(r,Qt,O=>n(6,s=O)),V(r,Fl,O=>n(21,a=O)),V(r,Zr,O=>n(7,f=O)),V(r,Yt,O=>n(8,u=O)),V(r,ce,O=>n(9,c=O)),V(r,pr,O=>n(10,_=O));let d=!1;Sr(async()=>{await ks(),await ts(),n(4,d=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(te(Fl,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let m=null;function g(){s.fitBounds(i.getBounds(),{animate:!1})}let y,h,w;function C(O){Ge[O?"unshift":"push"](()=>{w=O,n(3,w),n(12,t)})}function L(O){m=O,n(0,m)}const F=O=>{console.log(O.detail.error)};function T(O){Ge[O?"unshift":"push"](()=>{h=O,n(2,h),n(13,l)})}const A=()=>te(pr,_=!0,_);function j(O){Ge[O?"unshift":"push"](()=>{y=O,n(1,y),n(14,o)})}return r.$$.update=()=>{r.$$.dirty&1&&m&&Qt.set(m),r.$$.dirty&16386&&y&&o&&(n(1,y.innerHTML="",y),y.appendChild(o)),r.$$.dirty&8196&&h&&l&&(n(2,h.innerHTML="",h),h.appendChild(l)),r.$$.dirty&4104&&w&&t&&(n(3,w.innerHTML="",w),w.appendChild(t))},[m,y,h,w,d,i,s,f,u,c,_,g,t,l,o,C,L,F,T,A,j]}class P0 extends se{constructor(e){super(),ae(this,e,F0,A0,le,{})}}new P0({target:document.getElementById("app")});
