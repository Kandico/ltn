var sb=Object.defineProperty;var ab=(r,e,t)=>e in r?sb(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var jn=(r,e,t)=>(ab(r,typeof e!="symbol"?e+"":e,t),t);function lb(r,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const l in i)if(l!=="default"&&!(l in r)){const u=Object.getOwnPropertyDescriptor(i,l);u&&Object.defineProperty(r,l,u.get?u:{enumerable:!0,get:()=>i[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function Ct(){}function en(r,e){for(const t in e)r[t]=e[t];return r}function Qy(r){return r()}function Tg(){return Object.create(null)}function mn(r){r.forEach(Qy)}function ic(r){return typeof r=="function"}function Ft(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let id;function Dn(r,e){return r===e?!0:(id||(id=document.createElement("a")),id.href=e,r===id.href)}function cb(r){return Object.keys(r).length===0}function e0(r,...e){if(r==null){for(const i of e)i(void 0);return Ct}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Dr(r){let e;return e0(r,t=>e=t)(),e}function lt(r,e,t){r.$$.on_destroy.push(e0(e,t))}function Vi(r,e,t,i){if(r){const l=t0(r,e,t,i);return r[0](l)}}function t0(r,e,t,i){return r[1]&&i?en(t.ctx.slice(),r[1](i(e))):t.ctx}function qi(r,e,t,i){if(r[2]&&i){const l=r[2](i(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Zi(r,e,t,i,l,u){if(l){const d=t0(e,t,i,u);r.p(d,l)}}function Gi(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function ub(r){const e={};for(const t in r)e[t]=!0;return e}function _d(r){return r??""}function St(r,e,t){return r.set(t),e}function np(r){return r&&ic(r.destroy)?r.destroy:Ct}const Mp=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Z(r,e){r.appendChild(e)}function ae(r,e,t){r.insertBefore(e,t||null)}function se(r){r.parentNode&&r.parentNode.removeChild(r)}function Vo(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function re(r){return document.createElement(r)}function Ss(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function je(r){return document.createTextNode(r)}function Le(){return je(" ")}function En(){return je("")}function Mt(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function Ep(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Zf(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function ke(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function i0(r){let e;return{p(...t){e=t,e.forEach(i=>r.push(i))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function Ip(r){return r===""?null:+r}function hb(r){return Array.from(r.childNodes)}function ai(r,e){e=""+e,r.data!==e&&(r.data=e)}function zn(r,e){r.value=e??""}function Ri(r,e,t,i){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,i?"important":"")}function nc(r,e,t){for(let i=0;i<r.options.length;i+=1){const l=r.options[i];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Lp(r){const e=r.querySelector(":checked");return e&&e.__value}function dr(r,e,t){r.classList.toggle(e,!!t)}function db(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}let Au;function Tu(r){Au=r}function qu(){if(!Au)throw new Error("Function called outside component initialization");return Au}function Md(r){qu().$$.on_mount.push(r)}function or(r){qu().$$.on_destroy.push(r)}function rs(){const r=qu();return(e,t,{cancelable:i=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=db(e,t,{cancelable:i});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function Ed(r,e){return qu().$$.context.set(r,e),e}function Id(r){return qu().$$.context.get(r)}function pi(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Xl=[],Xi=[];let Ql=[];const rp=[],n0=Promise.resolve();let op=!1;function r0(){op||(op=!0,n0.then(s0))}function o0(){return r0(),n0}function rc(r){Ql.push(r)}function fr(r){rp.push(r)}const Gf=new Set;let Vl=0;function s0(){if(Vl!==0)return;const r=Au;do{try{for(;Vl<Xl.length;){const e=Xl[Vl];Vl++,Tu(e),fb(e.$$)}}catch(e){throw Xl.length=0,Vl=0,e}for(Tu(null),Xl.length=0,Vl=0;Xi.length;)Xi.pop()();for(let e=0;e<Ql.length;e+=1){const t=Ql[e];Gf.has(t)||(Gf.add(t),t())}Ql.length=0}while(Xl.length);for(;rp.length;)rp.pop()();op=!1,Gf.clear(),Tu(r)}function fb(r){if(r.fragment!==null){r.update(),mn(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(rc)}}function pb(r){const e=[],t=[];Ql.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Ql=e}const ad=new Set;let Fa;function gi(){Fa={r:0,c:[],p:Fa}}function _i(){Fa.r||mn(Fa.c),Fa=Fa.p}function K(r,e){r&&r.i&&(ad.delete(r),r.i(e))}function ie(r,e,t,i){if(r&&r.o){if(ad.has(r))return;ad.add(r),Fa.c.push(()=>{ad.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function Tn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function mb(r,e){ie(r,1,1,()=>{e.delete(r.key)})}function gb(r,e,t,i,l,u,d,a,_,y,x,S){let C=r.length,L=u.length,P=C;const R={};for(;P--;)R[r[P].key]=P;const D=[],B=new Map,N=new Map,$=[];for(P=L;P--;){const J=S(l,u,P),te=t(J);let ye=d.get(te);ye?i&&$.push(()=>ye.p(J,e)):(ye=y(te,J),ye.c()),B.set(te,D[P]=ye),te in R&&N.set(te,Math.abs(P-R[te]))}const j=new Set,le=new Set;function ce(J){K(J,1),J.m(a,x),d.set(J.key,J),x=J.first,L--}for(;C&&L;){const J=D[L-1],te=r[C-1],ye=J.key,Ue=te.key;J===te?(x=J.first,C--,L--):B.has(Ue)?!d.has(ye)||j.has(ye)?ce(J):le.has(Ue)?C--:N.get(ye)>N.get(Ue)?(le.add(ye),ce(J)):(j.add(Ue),C--):(_(te,d),C--)}for(;C--;){const J=r[C];B.has(J.key)||_(J,d)}for(;L;)ce(D[L-1]);return mn($),D}function Na(r,e){const t={},i={},l={$$scope:1};let u=r.length;for(;u--;){const d=r[u],a=e[u];if(a){for(const _ in d)_ in a||(i[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);r[u]=a}else for(const _ in d)l[_]=1}for(const d in i)d in t||(t[d]=void 0);return t}function pr(r,e,t){const i=r.$$.props[e];i!==void 0&&(r.$$.bound[i]=t,t(r.$$.ctx[i]))}function Ce(r){r&&r.c()}function Se(r,e,t){const{fragment:i,after_update:l}=r.$$;i&&i.m(e,t),rc(()=>{const u=r.$$.on_mount.map(Qy).filter(ic);r.$$.on_destroy?r.$$.on_destroy.push(...u):mn(u),r.$$.on_mount=[]}),l.forEach(rc)}function Te(r,e){const t=r.$$;t.fragment!==null&&(pb(t.after_update),mn(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _b(r,e){r.$$.dirty[0]===-1&&(Xl.push(r),r0(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function jt(r,e,t,i,l,u,d=null,a=[-1]){const _=Au;Tu(r);const y=r.$$={fragment:null,ctx:[],props:u,update:Ct,not_equal:l,bound:Tg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Tg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(y.root);let x=!1;if(y.ctx=t?t(r,e.props||{},(S,C,...L)=>{const P=L.length?L[0]:C;return y.ctx&&l(y.ctx[S],y.ctx[S]=P)&&(!y.skip_bound&&y.bound[S]&&y.bound[S](P),x&&_b(r,S)),C}):[],y.update(),x=!0,mn(y.before_update),y.fragment=i?i(y.ctx):!1,e.target){if(e.hydrate){const S=hb(e.target);y.fragment&&y.fragment.l(S),S.forEach(se)}else y.fragment&&y.fragment.c();e.intro&&K(r.$$.fragment),Se(r,e.target,e.anchor),s0()}Tu(_)}class Ut{constructor(){jn(this,"$$");jn(this,"$$set")}$destroy(){Te(this,1),this.$destroy=Ct}$on(e,t){if(!ic(t))return Ct;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!cb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const yb="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yb);const vb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",bb="/ltn/assets/logo-97f2d067.svg";function Cg(r){let e,t;return{c(){e=re("div"),t=je(r[0]),ke(e,"class","svelte-1uuov7f")},m(i,l){ae(i,e,l),Z(e,t)},p(i,l){l&1&&ai(t,i[0])},d(i){i&&se(e)}}}function wb(r){let e,t=r[0]&&Cg(r);return{c(){t&&t.c(),e=En()},m(i,l){t&&t.m(i,l),ae(i,e,l)},p(i,[l]){i[0]?t?t.p(i,l):(t=Cg(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Ct,o:Ct,d(i){i&&se(e),t&&t.d(i)}}}function xb(r,e,t){let{loading:i}=e;return r.$$set=l=>{"loading"in l&&t(0,i=l.loading)},[i]}class a0 extends Ut{constructor(e){super(),jt(this,e,xb,wb,Ft,{loading:0})}}const kb=r=>({dialog:r&1}),Mg=r=>({dialog:r[0]});function Sb(r){let e,t,i,l,u;const d=r[4].default,a=Vi(d,r,r[3],Mg);return{c(){e=re("dialog"),t=re("article"),a&&a.c(),e.open=!0},m(_,y){ae(_,e,y),Z(e,t),a&&a.m(t,null),r[6](e),i=!0,l||(u=[Mt(window,"click",r[1]),Mt(window,"keydown",r[2]),Mt(e,"close",r[5])],l=!0)},p(_,[y]){a&&a.p&&(!i||y&9)&&Zi(a,d,_,_[3],i?qi(d,_[3],y,kb):Gi(_[3]),Mg)},i(_){i||(K(a,_),i=!0)},o(_){ie(a,_),i=!1},d(_){_&&se(e),a&&a.d(_),r[6](null),l=!1,mn(u)}}}function Tb(r,e,t){let{$$slots:i={},$$scope:l}=e,u;function d(x){u.open&&x.target==u&&u.close()}function a(x){(x.key=="Escape"||x.key=="Enter")&&(x.stopPropagation(),u.close())}function _(x){pi.call(this,r,x)}function y(x){Xi[x?"unshift":"push"](()=>{u=x,t(0,u)})}return r.$$set=x=>{"$$scope"in x&&t(3,l=x.$$scope)},[u,d,a,l,i,_,y]}class Ld extends Ut{constructor(e){super(),jt(this,e,Tb,Sb,Ft,{})}}function Eg(r,e,t){const i=r.slice();return i[1]=e[t][0],i[2]=e[t][1],i}function Ig(r){let e,t,i=r[1]+"",l,u,d,a=r[2]+"",_,y;return{c(){e=re("tr"),t=re("td"),l=je(i),u=Le(),d=re("td"),_=je(a),y=Le()},m(x,S){ae(x,e,S),Z(e,t),Z(t,l),Z(e,u),Z(e,d),Z(d,_),Z(e,y)},p(x,S){S&1&&i!==(i=x[1]+"")&&ai(l,i),S&1&&a!==(a=x[2]+"")&&ai(_,a)},d(x){x&&se(e)}}}function Cb(r){let e,t,i=Tn(Object.entries(r[0])),l=[];for(let u=0;u<i.length;u+=1)l[u]=Ig(Eg(r,i,u));return{c(){e=re("table"),t=re("tbody");for(let u=0;u<l.length;u+=1)l[u].c();ke(e,"class","svelte-lh2o9l")},m(u,d){ae(u,e,d),Z(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){i=Tn(Object.entries(u[0]));let a;for(a=0;a<i.length;a+=1){const _=Eg(u,i,a);l[a]?l[a].p(_,d):(l[a]=Ig(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}},i:Ct,o:Ct,d(u){u&&se(e),Vo(l,u)}}}function Mb(r,e,t){let{properties:i}=e;return r.$$set=l=>{"properties"in l&&t(0,i=l.properties)},[i]}class Ap extends Ut{constructor(e){super(),jt(this,e,Mb,Cb,Ft,{properties:0})}}function Lg(r,e,t){const i=r.slice();return i[3]=e[t],i}function Ag(r,e,t){const i=r.slice();return i[6]=e[t],i}function Pg(r){let e,t;return{c(){e=re("span"),t=je(` 
    `),Ri(e,"background",r[6]),Ri(e,"width","100%"),Ri(e,"border","1px solid black")},m(i,l){ae(i,e,l),Z(e,t)},p(i,l){l&1&&Ri(e,"background",i[6])},d(i){i&&se(e)}}}function Eb(r){let e,t=r[3]+"",i;return{c(){e=re("span"),i=je(t)},m(l,u){ae(l,e,u),Z(e,i)},p(l,u){u&2&&t!==(t=l[3]+"")&&ai(i,t)},d(l){l&&se(e)}}}function Ib(r){let e,t=r[3].toFixed(r[2])+"",i;return{c(){e=re("span"),i=je(t)},m(l,u){ae(l,e,u),Z(e,i)},p(l,u){u&6&&t!==(t=l[3].toFixed(l[2])+"")&&ai(i,t)},d(l){l&&se(e)}}}function zg(r){let e;function t(u,d){return u[2]>0?Ib:Eb}let i=t(r),l=i(r);return{c(){l.c(),e=En()},m(u,d){l.m(u,d),ae(u,e,d)},p(u,d){i===(i=t(u))&&l?l.p(u,d):(l.d(1),l=i(u),l&&(l.c(),l.m(e.parentNode,e)))},d(u){u&&se(e),l.d(u)}}}function Lb(r){let e,t,i,l=Tn(r[0]),u=[];for(let _=0;_<l.length;_+=1)u[_]=Pg(Ag(r,l,_));let d=Tn(r[1]),a=[];for(let _=0;_<d.length;_+=1)a[_]=zg(Lg(r,d,_));return{c(){e=re("div");for(let _=0;_<u.length;_+=1)u[_].c();t=Le(),i=re("div");for(let _=0;_<a.length;_+=1)a[_].c();Ri(e,"display","flex"),Ri(i,"display","flex"),Ri(i,"justify-content","space-between")},m(_,y){ae(_,e,y);for(let x=0;x<u.length;x+=1)u[x]&&u[x].m(e,null);ae(_,t,y),ae(_,i,y);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(i,null)},p(_,[y]){if(y&1){l=Tn(_[0]);let x;for(x=0;x<l.length;x+=1){const S=Ag(_,l,x);u[x]?u[x].p(S,y):(u[x]=Pg(S),u[x].c(),u[x].m(e,null))}for(;x<u.length;x+=1)u[x].d(1);u.length=l.length}if(y&6){d=Tn(_[1]);let x;for(x=0;x<d.length;x+=1){const S=Lg(_,d,x);a[x]?a[x].p(S,y):(a[x]=zg(S),a[x].c(),a[x].m(i,null))}for(;x<a.length;x+=1)a[x].d(1);a.length=d.length}},i:Ct,o:Ct,d(_){_&&(se(e),se(t),se(i)),Vo(u,_),Vo(a,_)}}}function Ab(r,e,t){let{colorScale:i}=e,{limits:l}=e,{decimalPlaces:u=0}=e;return r.$$set=d=>{"colorScale"in d&&t(0,i=d.colorScale),"limits"in d&&t(1,l=d.limits),"decimalPlaces"in d&&t(2,u=d.decimalPlaces)},[i,l,u]}class Pb extends Ut{constructor(e){super(),jt(this,e,Ab,Lb,Ft,{colorScale:0,limits:1,decimalPlaces:2})}}function yd(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function sr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var l0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function c0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Pp(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var l=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:function(){return r[i]}})}),t}var u0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,i){r.exports=i()})(l0,function(){var t={},i={};function l(d,a,_){if(i[d]=_,d==="index"){var y="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",x={};return i.shared(x),i.index(t,x),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,n,c,f){return new(c||(c=Promise))(function(g,w){function k(z){try{I(f.next(z))}catch(O){w(O)}}function T(z){try{I(f.throw(z))}catch(O){w(O)}}function I(z){var O;z.done?g(z.value):(O=z.value,O instanceof c?O:new c(function(U){U(O)})).then(k,T)}I((f=f.apply(s,n||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var y=x;function x(s,n){this.x=s,this.y=n}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,n){return this.clone()._rotateAround(s,n)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var n=s.x-this.x,c=s.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,n){return Math.atan2(this.x*n-this.y*s,this.x*s+this.y*n)},_matMult:function(s){var n=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=n,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var n=Math.cos(s),c=Math.sin(s),f=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,n){var c=Math.cos(s),f=Math.sin(s),g=n.y+f*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-f*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(s){return s instanceof x?s:Array.isArray(s)?new x(s[0],s[1]):s};var S=_(y),C=L;function L(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}L.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var k=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<n));f++)s>g?k=c:T=c,c=.5*(T-k)+k;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var P=_(C);let R,D;function B(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function N(){if(D==null&&(D=!1,B())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let f=0;f<5*5;f++){const g=4*f;n.fillStyle=`rgb(${g},${g+1},${g+2})`,n.fillRect(f%5,Math.floor(f/5),1,1)}const c=n.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){D=!0;break}}}return D||!1}function $(s,n,c,f){const g=new P(s,n,c,f);return function(w){return g.solve(w)}}const j=$(.25,.1,.25,1);function le(s,n,c){return Math.min(c,Math.max(n,s))}function ce(s,n,c){const f=c-n,g=((s-n)%f+f)%f+n;return g===n?c:g}function J(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}let te=1;function ye(s,n,c){const f={};for(const g in s)f[g]=n.call(c||this,s[g],g,s);return f}function Ue(s,n,c){const f={};for(const g in s)n.call(c||this,s[g],g,s)&&(f[g]=s[g]);return f}function oe(s){return Array.isArray(s)?s.map(oe):typeof s=="object"&&s?ye(s,oe):s}const ve={};function st(s){ve[s]||(typeof console<"u"&&console.warn(s),ve[s]=!0)}function ze(s,n,c){return(c.y-s.y)*(n.x-s.x)>(n.y-s.y)*(c.x-s.x)}function Qe(s){let n=0;for(let c,f,g=0,w=s.length,k=w-1;g<w;k=g++)c=s[g],f=s[k],n+=(f.x-c.x)*(c.y+f.y);return n}function wt(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let pt=null;function nt(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Ht="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function oi(s,n,c,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const k=w==null?void 0:w.format;if(!k||!k.startsWith("BGR")&&!k.startsWith("RGB"))throw new Error(`Unrecognized format ${k}`);const T=k.startsWith("BGR"),I=new Uint8ClampedArray(f*g*4);if(yield w.copyTo(I,function(z,O,U,H,Y){const ee=4*Math.max(-O,0),he=(Math.max(0,U)-U)*H*4+ee,ge=4*H,xe=Math.max(0,O),Oe=Math.max(0,U);return{rect:{x:xe,y:Oe,width:Math.min(z.width,O+H)-xe,height:Math.min(z.height,U+Y)-Oe},layout:[{offset:he,stride:ge}]}}(s,n,c,f,g)),T)for(let z=0;z<I.length;z+=4){const O=I[z];I[z]=I[z+2],I[z+2]=O}return I}finally{w.close()}})}let Dt,mt;const ti="AbortError";function Pt(){return new Error(ti)}const Rt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ct(s){return Rt.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const Jt="global-dispatcher";class Yt extends Error{constructor(n,c,f,g){super(`AJAXError: ${c} (${n}): ${f}`),this.status=n,this.statusText=c,this.url=f,this.body=g}}const Ei=()=>wt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Fi=function(s,n){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=ct(s.url);if(f)return f(s,n);if(wt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:Jt},n)}if(!(/^file:/.test(c=s.url)||/^file:/.test(Ei())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Ei(),signal:g.signal});f.type==="json"&&w.headers.set("Accept","application/json");const k=yield fetch(w);if(!k.ok){const z=yield k.blob();throw new Yt(k.status,k.statusText,f.url,z)}let T;T=f.type==="arrayBuffer"||f.type==="image"?k.arrayBuffer():f.type==="json"?k.json():k.text();const I=yield T;if(g.signal.aborted)throw Pt();return{data:I,cacheControl:k.headers.get("Cache-Control"),expires:k.headers.get("Expires")}})}(s,n);if(wt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:Jt},n)}var c;return function(f,g){return new Promise((w,k)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const I in f.headers)T.setRequestHeader(I,f.headers[I]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{k(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(f.type==="json")try{I=JSON.parse(T.response)}catch(z){return void k(z)}w({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});k(new Yt(T.status,T.statusText,f.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),k(Pt())}),T.send(f.body)})}(s,n)};function ht(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const n=new URL(s),c=window.location;return n.protocol===c.protocol&&n.host===c.host}function Ot(s,n,c){c[s]&&c[s].indexOf(n)!==-1||(c[s]=c[s]||[],c[s].push(n))}function Fe(s,n,c){if(c&&c[s]){const f=c[s].indexOf(n);f!==-1&&c[s].splice(f,1)}}class Ne{constructor(n,c={}){J(this,c),this.type=n}}class dt extends Ne{constructor(n,c={}){super("error",J({error:n},c))}}class bt{on(n,c){return this._listeners=this._listeners||{},Ot(n,c,this._listeners),this}off(n,c){return Fe(n,c,this._listeners),Fe(n,c,this._oneTimeListeners),this}once(n,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Ot(n,c,this._oneTimeListeners),this):new Promise(f=>this.once(n,f))}fire(n,c){typeof n=="string"&&(n=new Ne(n,c||{}));const f=n.type;if(this.listens(f)){n.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,n);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of w)Fe(f,T,this._oneTimeListeners),T.call(this,n);const k=this._eventedParent;k&&(J(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(n))}else n instanceof dt&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,c){return this._eventedParent=n,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qe(s,n){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return Ii.forEach(f=>{f in n&&(c[f]=n[f])}),c}function Je(s,n){if(Array.isArray(s)){if(!Array.isArray(n)||s.length!==n.length)return!1;for(let c=0;c<s.length;c++)if(!Je(s[c],n[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&n!==null){if(typeof n!="object"||Object.keys(s).length!==Object.keys(n).length)return!1;for(const c in s)if(!Je(s[c],n[c]))return!1;return!0}return s===n}function Vt(s,n){s.push(n)}function Pi(s,n,c){Vt(c,{command:"addSource",args:[s,n[s]]})}function wi(s,n,c){Vt(n,{command:"removeSource",args:[s]}),c[s]=!0}function gn(s,n,c,f){wi(s,c,f),Pi(s,n,c)}function In(s,n,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!Je(s[c][f],n[c][f]))return!1;for(f in n[c])if(Object.prototype.hasOwnProperty.call(n[c],f)&&f!=="data"&&!Je(s[c][f],n[c][f]))return!1;return!0}function tn(s,n,c,f,g,w){s=s||{},n=n||{};for(const k in s)Object.prototype.hasOwnProperty.call(s,k)&&(Je(s[k],n[k])||c.push({command:w,args:[f,k,n[k],g]}));for(const k in n)Object.prototype.hasOwnProperty.call(n,k)&&!Object.prototype.hasOwnProperty.call(s,k)&&(Je(s[k],n[k])||c.push({command:w,args:[f,k,n[k],g]}))}function io(s){return s.id}function Oi(s,n){return s[n.id]=n,s}class rt{constructor(n,c,f,g){this.message=(n?`${n}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Li(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}class ii extends Error{constructor(n,c){super(c),this.message=c,this.key=n}}class Ni{constructor(n,c=[]){this.parent=n,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(n){return new Ni(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Ki={kind:"null"},yt={kind:"number"},li={kind:"string"},ni={kind:"boolean"},Ji={kind:"color"},xr={kind:"object"},si={kind:"value"},no={kind:"collator"},_n={kind:"formatted"},me={kind:"padding"},W={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function ne(s,n){return{kind:"array",itemType:s,N:n}}function de(s){if(s.kind==="array"){const n=de(s.itemType);return typeof s.N=="number"?`array<${n}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${n}>`}return s.kind}const Ae=[Ki,yt,li,ni,Ji,_n,xr,ne(si),me,W,X];function Pe(s,n){if(n.kind==="error")return null;if(s.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Pe(s.itemType,n.itemType))&&(typeof s.N!="number"||s.N===n.N))return null}else{if(s.kind===n.kind)return null;if(s.kind==="value"){for(const c of Ae)if(!Pe(c,n))return null}}return`Expected ${de(s)} but found ${de(n)} instead.`}function Be(s,n){return n.some(c=>c.kind===s.kind)}function Me(s,n){return n.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function G(s,n){return s.kind==="array"&&n.kind==="array"?s.itemType.kind===n.itemType.kind&&typeof s.N=="number":s.kind===n.kind}const $e=.96422,Ve=.82521,Ge=4/29,Ke=6/29,ft=3*Ke*Ke,Nt=Ke*Ke*Ke,Qt=Math.PI/180,hi=180/Math.PI;function xi(s){return(s%=360)<0&&(s+=360),s}function an([s,n,c,f]){let g,w;const k=di((.2225045*(s=Rn(s))+.7168786*(n=Rn(n))+.0606169*(c=Rn(c)))/1);s===n&&n===c?g=w=k:(g=di((.4360747*s+.3850649*n+.1430804*c)/$e),w=di((.0139322*s+.0971045*n+.7141733*c)/Ve));const T=116*k-16;return[T<0?0:T,500*(g-k),200*(k-w),f]}function Rn(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function di(s){return s>Nt?Math.pow(s,1/3):s/ft+Ge}function yn([s,n,c,f]){let g=(s+16)/116,w=isNaN(n)?g:g+n/500,k=isNaN(c)?g:g-c/200;return g=1*mr(g),w=$e*mr(w),k=Ve*mr(k),[Vn(3.1338561*w-1.6168667*g-.4906146*k),Vn(-.9787684*w+1.9161415*g+.033454*k),Vn(.0719453*w-.2289914*g+1.4052427*k),f]}function Vn(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function mr(s){return s>Ke?s*s*s:ft*(s-Ge)}function kr(s){return parseInt(s.padEnd(2,s),16)/255}function er(s,n){return _o(n?s/100:s,0,1)}function _o(s,n,c){return Math.min(Math.max(n,s),c)}function Ju(s){return!s.some(Number.isNaN)}const Nd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class $i{constructor(n,c,f,g=1,w=!0){this.r=n,this.g=c,this.b=f,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[n,c,f,g]))}static parse(n){if(n instanceof $i)return n;if(typeof n!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Nd[f];if(g){const[k,T,I]=g;return[k/255,T/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const k=f.length<6?1:2;let T=1;return[kr(f.slice(T,T+=k)),kr(f.slice(T,T+=k)),kr(f.slice(T,T+=k)),kr(f.slice(T,T+k)||"ff")]}if(f.startsWith("rgb")){const k=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[T,I,z,O,U,H,Y,ee,he,ge,xe,Oe]=k,Ee=[O||" ",Y||" ",ge].join("");if(Ee==="  "||Ee==="  /"||Ee===",,"||Ee===",,,"){const De=[z,H,he].join(""),Ye=De==="%%%"?100:De===""?255:0;if(Ye){const et=[_o(+I/Ye,0,1),_o(+U/Ye,0,1),_o(+ee/Ye,0,1),xe?er(+xe,Oe):1];if(Ju(et))return et}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[k,T,I,z,O,U,H,Y,ee]=w,he=[I||" ",O||" ",H].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const ge=[+T,_o(+z,0,100),_o(+U,0,100),Y?er(+Y,ee):1];if(Ju(ge))return function([xe,Oe,Ee,De]){function Ye(et){const Lt=(et+xe/30)%12,$t=Oe*Math.min(Ee,1-Ee);return Ee-$t*Math.max(-1,Math.min(Lt-3,9-Lt,1))}return xe=xi(xe),Oe/=100,Ee/=100,[Ye(0),Ye(8),Ye(4),De]}(ge)}}}(n);return c?new $i(...c,!1):void 0}get rgb(){const{r:n,g:c,b:f,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[n/w,c/w,f/w,g])}get hcl(){return this.overwriteGetter("hcl",function(n){const[c,f,g,w]=an(n),k=Math.sqrt(f*f+g*g);return[Math.round(1e4*k)?xi(Math.atan2(g,f)*hi):NaN,k,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",an(this.rgb))}overwriteGetter(n,c){return Object.defineProperty(this,n,{value:c}),c}toString(){const[n,c,f,g]=this.rgb;return`rgba(${[n,c,f].map(w=>Math.round(255*w)).join(",")},${g})`}}$i.black=new $i(0,0,0,1),$i.white=new $i(1,1,1,1),$i.transparent=new $i(0,0,0,0),$i.red=new $i(1,0,0,1);class hc{constructor(n,c,f){this.sensitivity=n?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,c){return this.collator.compare(n,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dc{constructor(n,c,f,g,w){this.text=n,this.image=c,this.scale=f,this.fontStack=g,this.textColor=w}}class Br{constructor(n){this.sections=n}static fromString(n){return new Br([new dc(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Br?n:Br.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Sr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Sr)return n;if(typeof n=="number")return new Sr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const c of n)if(typeof c!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Sr(n)}}toString(){return JSON.stringify(this.values)}}const ua=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Xr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Xr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let c=0;c<n.length;c+=2){const f=n[c],g=n[c+1];if(typeof f!="string"||!ua.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Xr(n)}}toString(){return JSON.stringify(this.values)}}class Kr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Kr({name:n,available:!1}):null}}function As(s,n,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,n,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,n,c,f]:[s,n,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ga(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof $i||s instanceof hc||s instanceof Br||s instanceof Sr||s instanceof Xr||s instanceof Kr)return!0;if(Array.isArray(s)){for(const n of s)if(!Ga(n))return!1;return!0}if(typeof s=="object"){for(const n in s)if(!Ga(s[n]))return!1;return!0}return!1}function Bn(s){if(s===null)return Ki;if(typeof s=="string")return li;if(typeof s=="boolean")return ni;if(typeof s=="number")return yt;if(s instanceof $i)return Ji;if(s instanceof hc)return no;if(s instanceof Br)return _n;if(s instanceof Sr)return me;if(s instanceof Xr)return X;if(s instanceof Kr)return W;if(Array.isArray(s)){const n=s.length;let c;for(const f of s){const g=Bn(f);if(c){if(c===g)continue;c=si;break}c=g}return ne(c||si,n)}return xr}function ha(s){const n=typeof s;return s===null?"":n==="string"||n==="number"||n==="boolean"?String(s):s instanceof $i||s instanceof Br||s instanceof Sr||s instanceof Xr||s instanceof Kr?s.toString():JSON.stringify(s)}class qo{constructor(n,c){this.type=n,this.value=c}static parse(n,c){if(n.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ga(n[1]))return c.error("invalid value");const f=n[1];let g=Bn(f);const w=c.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new qo(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class hn{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Wa={string:li,number:yt,boolean:ni,object:xr};class Fr{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");let f,g=1;const w=n[0];if(w==="array"){let T,I;if(n.length>2){const z=n[1];if(typeof z!="string"||!(z in Wa)||z==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=Wa[z],g++}else T=si;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=n[2],g++}f=ne(T,I)}else{if(!Wa[w])throw new Error(`Types doesn't contain name = ${w}`);f=Wa[w]}const k=[];for(;g<n.length;g++){const T=c.parse(n[g],g,si);if(!T)return null;k.push(T)}return new Fr(f,k)}evaluate(n){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(n);if(!Pe(this.type,Bn(f)))return f;if(c===this.args.length-1)throw new hn(`Expected value to be of type ${de(this.type)}, but found ${de(Bn(f))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const Ha={"to-boolean":ni,"to-color":Ji,"to-number":yt,"to-string":li};class yo{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[0];if(!Ha[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&n.length!==2)return c.error("Expected one argument.");const g=Ha[f],w=[];for(let k=1;k<n.length;k++){const T=c.parse(n[k],k,si);if(!T)return null;w.push(T)}return new yo(g,w)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let c,f;for(const g of this.args){if(c=g.evaluate(n),f=null,c instanceof $i)return c;if(typeof c=="string"){const w=n.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:As(c[0],c[1],c[2],c[3]),!f))return new $i(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new hn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(n);const g=Sr.parse(c);if(g)return g}throw new hn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(n);const g=Xr.parse(c);if(g)return g}throw new hn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(n),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new hn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Br.fromString(ha(this.args[0].evaluate(n)));case"resolvedImage":return Kr.fromString(ha(this.args[0].evaluate(n)));default:return ha(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const da=["Unknown","Point","LineString","Polygon"];class ji{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?da[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let c=this._parseColorCache[n];return c||(c=this._parseColorCache[n]=$i.parse(n)),c}}class Xa{constructor(n,c,f=[],g,w=new Ni,k=[]){this.registry=n,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=k,this.expectedType=g,this._isConstant=c}parse(n,c,f,g,w={}){return c?this.concat(c,f,g)._parse(n,w):this._parse(n,w)}_parse(n,c){function f(g,w,k){return k==="assert"?new Fr(w,[g]):k==="coerce"?new yo(w,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=n[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let k=w.parse(n,this);if(!k)return null;if(this.expectedType){const T=this.expectedType,I=k.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else k=f(k,T,c.typeAnnotation||"coerce");else k=f(k,T,c.typeAnnotation||"coerce");else k=f(k,T,c.typeAnnotation||"coerce");else k=f(k,T,c.typeAnnotation||"assert")}if(!(k instanceof qo)&&k.type.kind!=="resolvedImage"&&this._isConstant(k)){const T=new ji;try{k=new qo(k.type,k.evaluate(T))}catch(I){return this.error(I.message),null}}return k}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,c,f){const g=typeof n=="number"?this.path.concat(n):this.path,w=f?this.scope.concat(f):this.scope;return new Xa(this.registry,this._isConstant,g,c||null,w,this.errors)}error(n,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new ii(f,n))}checkSubtype(n,c){const f=Pe(n,c);return f&&this.error(f),f}}class Ps{constructor(n,c,f){this.type=no,this.locale=f,this.caseSensitive=n,this.diacriticSensitive=c}static parse(n,c){if(n.length!==2)return c.error("Expected one argument.");const f=n[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,ni);if(!g)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,ni);if(!w)return null;let k=null;return f.locale&&(k=c.parse(f.locale,1,li),!k)?null:new Ps(g,w,k)}evaluate(n){return new hc(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const Zo=8192;function Ka(s,n){s[0]=Math.min(s[0],n[0]),s[1]=Math.min(s[1],n[1]),s[2]=Math.max(s[2],n[0]),s[3]=Math.max(s[3],n[1])}function fa(s,n){return!(s[0]<=n[0]||s[2]>=n[2]||s[1]<=n[1]||s[3]>=n[3])}function $d(s,n){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(c*g*Zo),Math.round(f*g*Zo)]}function Yu(s,n,c){const f=s[0]-n[0],g=s[1]-n[1],w=s[0]-c[0],k=s[1]-c[1];return f*k-w*g==0&&f*w<=0&&g*k<=0}function Ja(s,n){let c=!1;for(let k=0,T=n.length;k<T;k++){const I=n[k];for(let z=0,O=I.length;z<O-1;z++){if(Yu(s,I[z],I[z+1]))return!1;(g=I[z])[1]>(f=s)[1]!=(w=I[z+1])[1]>f[1]&&f[0]<(w[0]-g[0])*(f[1]-g[1])/(w[1]-g[1])+g[0]&&(c=!c)}}var f,g,w;return c}function jd(s,n){for(let c=0;c<n.length;c++)if(Ja(s,n[c]))return!0;return!1}function Qu(s,n,c,f){const g=f[0]-c[0],w=f[1]-c[1],k=(s[0]-c[0])*w-g*(s[1]-c[1]),T=(n[0]-c[0])*w-g*(n[1]-c[1]);return k>0&&T<0||k<0&&T>0}function Ud(s,n,c){for(const z of c)for(let O=0;O<z.length-1;++O)if((T=[(k=z[O+1])[0]-(w=z[O])[0],k[1]-w[1]])[0]*(I=[(g=n)[0]-(f=s)[0],g[1]-f[1]])[1]-T[1]*I[0]!=0&&Qu(f,g,w,k)&&Qu(w,k,f,g))return!0;var f,g,w,k,T,I;return!1}function eh(s,n){for(let c=0;c<s.length;++c)if(!Ja(s[c],n))return!1;for(let c=0;c<s.length-1;++c)if(Ud(s[c],s[c+1],n))return!1;return!0}function th(s,n){for(let c=0;c<n.length;c++)if(eh(s,n[c]))return!0;return!1}function Ya(s,n,c){const f=[];for(let g=0;g<s.length;g++){const w=[];for(let k=0;k<s[g].length;k++){const T=$d(s[g][k],c);Ka(n,T),w.push(T)}f.push(w)}return f}function ih(s,n,c){const f=[];for(let g=0;g<s.length;g++){const w=Ya(s[g],n,c);f.push(w)}return f}function nh(s,n,c,f){if(s[0]<c[0]||s[0]>c[2]){const g=.5*f;let w=s[0]-c[0]>g?-f:c[0]-s[0]>g?f:0;w===0&&(w=s[0]-c[2]>g?-f:c[2]-s[0]>g?f:0),s[0]+=w}Ka(n,s)}function Qa(s,n,c,f){const g=Math.pow(2,f.z)*Zo,w=[f.x*Zo,f.y*Zo],k=[];for(const T of s)for(const I of T){const z=[I.x+w[0],I.y+w[1]];nh(z,n,c,g),k.push(z)}return k}function rh(s,n,c,f){const g=Math.pow(2,f.z)*Zo,w=[f.x*Zo,f.y*Zo],k=[];for(const I of s){const z=[];for(const O of I){const U=[O.x+w[0],O.y+w[1]];Ka(n,U),z.push(U)}k.push(z)}if(n[2]-n[0]<=g/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of k)for(const z of I)nh(z,n,c,g)}var T;return k}class ss{constructor(n,c){this.type=ni,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ga(n[1])){const f=n[1];if(f.type==="FeatureCollection"){const g=[];for(const w of f.features){const{type:k,coordinates:T}=w.geometry;k==="Polygon"&&g.push(T),k==="MultiPolygon"&&g.push(...T)}if(g.length)return new ss(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ss(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ss(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],k=c.canonicalID();if(f.type==="Polygon"){const T=Ya(f.coordinates,w,k),I=Qa(c.geometry(),g,w,k);if(!fa(g,w))return!1;for(const z of I)if(!Ja(z,T))return!1}if(f.type==="MultiPolygon"){const T=ih(f.coordinates,w,k),I=Qa(c.geometry(),g,w,k);if(!fa(g,w))return!1;for(const z of I)if(!jd(z,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],k=c.canonicalID();if(f.type==="Polygon"){const T=Ya(f.coordinates,w,k),I=rh(c.geometry(),g,w,k);if(!fa(g,w))return!1;for(const z of I)if(!eh(z,T))return!1}if(f.type==="MultiPolygon"){const T=ih(f.coordinates,w,k),I=rh(c.geometry(),g,w,k);if(!fa(g,w))return!1;for(const z of I)if(!th(z,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class el{constructor(n,c){this.type=c.type,this.name=n,this.boundExpression=c}static parse(n,c){if(n.length!==2||typeof n[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=n[1];return c.scope.has(f)?new el(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Or{constructor(n,c,f,g){this.name=n,this.type=c,this._evaluate=f,this.args=g}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,c){const f=n[0],g=Or.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,k=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=k.filter(([z])=>!Array.isArray(z)||z.length===n.length-1);let I=null;for(const[z,O]of T){I=new Xa(c.registry,pa,c.path,null,c.scope);const U=[];let H=!1;for(let Y=1;Y<n.length;Y++){const ee=n[Y],he=Array.isArray(z)?z[Y-1]:z.type,ge=I.parse(ee,1+U.length,he);if(!ge){H=!0;break}U.push(ge)}if(!H)if(Array.isArray(z)&&z.length!==U.length)I.error(`Expected ${z.length} arguments, but found ${U.length} instead.`);else{for(let Y=0;Y<U.length;Y++){const ee=Array.isArray(z)?z[Y]:z.type,he=U[Y];I.concat(Y+1).checkSubtype(ee,he.type)}if(I.errors.length===0)return new Or(f,w,O,U)}}if(T.length===1)c.errors.push(...I.errors);else{const z=(T.length?T:k).map(([U])=>{return H=U,Array.isArray(H)?`(${H.map(de).join(", ")})`:`(${de(H.type)}...)`;var H}).join(" | "),O=[];for(let U=1;U<n.length;U++){const H=c.parse(n[U],1+O.length);if(!H)return null;O.push(de(H.type))}c.error(`Expected arguments of type ${z}, but found (${O.join(", ")}) instead.`)}return null}static register(n,c){Or.definitions=c;for(const f in c)n[f]=Or}}function pa(s){if(s instanceof el)return pa(s.boundExpression);if(s instanceof Or&&s.name==="error"||s instanceof Ps||s instanceof ss)return!1;const n=s instanceof yo||s instanceof Fr;let c=!0;return s.eachChild(f=>{c=n?c&&pa(f):c&&f instanceof qo}),!!c&&tl(s)&&ga(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function tl(s){if(s instanceof Or&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ss)return!1;let n=!0;return s.eachChild(c=>{n&&!tl(c)&&(n=!1)}),n}function ma(s){if(s instanceof Or&&s.name==="feature-state")return!1;let n=!0;return s.eachChild(c=>{n&&!ma(c)&&(n=!1)}),n}function ga(s,n){if(s instanceof Or&&n.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!ga(f,n)&&(c=!1)}),c}function _a(s,n){const c=s.length-1;let f,g,w=0,k=c,T=0;for(;w<=k;)if(T=Math.floor((w+k)/2),f=s[T],g=s[T+1],f<=n){if(T===c||n<g)return T;w=T+1}else{if(!(f>n))throw new hn("Input is not a number.");k=T-1}return 0}class ya{constructor(n,c,f){this.type=n,this.input=c,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static parse(n,c){if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(n[1],1,yt);if(!f)return null;const g=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let k=1;k<n.length;k+=2){const T=k===1?-1/0:n[k],I=n[k+1],z=k,O=k+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const U=c.parse(I,O,w);if(!U)return null;w=w||U.type,g.push([T,U])}return new ya(w,f,g)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return f[0].evaluate(n);const w=c.length;return g>=c[w-1]?f[w-1].evaluate(n):f[_a(c,g)].evaluate(n)}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Vd(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var qd=oh;function oh(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}oh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var k=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<n));f++)s>g?k=c:T=c,c=.5*(T-k)+k;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var Zd=Vd(qd);function as(s,n,c){return s+c*(n-s)}function il(s,n,c){return s.map((f,g)=>as(f,n[g],c))}const gr={number:as,color:function(s,n,c,f="rgb"){switch(f){case"rgb":{const[g,w,k,T]=il(s.rgb,n.rgb,c);return new $i(g,w,k,T,!1)}case"hcl":{const[g,w,k,T]=s.hcl,[I,z,O,U]=n.hcl;let H,Y;if(isNaN(g)||isNaN(I))isNaN(g)?isNaN(I)?H=NaN:(H=I,k!==1&&k!==0||(Y=z)):(H=g,O!==1&&O!==0||(Y=w));else{let Oe=I-g;I>g&&Oe>180?Oe-=360:I<g&&g-I>180&&(Oe+=360),H=g+c*Oe}const[ee,he,ge,xe]=function([Oe,Ee,De,Ye]){return Oe=isNaN(Oe)?0:Oe*Qt,yn([De,Math.cos(Oe)*Ee,Math.sin(Oe)*Ee,Ye])}([H,Y??as(w,z,c),as(k,O,c),as(T,U,c)]);return new $i(ee,he,ge,xe,!1)}case"lab":{const[g,w,k,T]=yn(il(s.lab,n.lab,c));return new $i(g,w,k,T,!1)}}},array:il,padding:function(s,n,c){return new Sr(il(s.values,n.values,c))},variableAnchorOffsetCollection:function(s,n,c){const f=s.values,g=n.values;if(f.length!==g.length)throw new hn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${n.toString()}`);const w=[];for(let k=0;k<f.length;k+=2){if(f[k]!==g[k])throw new hn(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${f[k]}, to[${k}]: ${g[k]}`);w.push(f[k]);const[T,I]=f[k+1],[z,O]=g[k+1];w.push([as(T,z,c),as(I,O,c)])}return new Xr(w)}};class ar{constructor(n,c,f,g,w){this.type=n,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[k,T]of w)this.labels.push(k),this.outputs.push(T)}static interpolationFactor(n,c,f,g){let w=0;if(n.name==="exponential")w=zi(c,n.base,f,g);else if(n.name==="linear")w=zi(c,1,f,g);else if(n.name==="cubic-bezier"){const k=n.controlPoints;w=new Zd(k[0],k[1],k[2],k[3]).solve(zi(c,1,f,g))}return w}static parse(n,c){let[f,g,w,...k]=n;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const z=g[1];if(typeof z!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:z}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const z=g.slice(1);if(z.length!==4||z.some(O=>typeof O!="number"||O<0||O>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:z}}}if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,yt),!w)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Ji:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let z=0;z<k.length;z+=2){const O=k[z],U=k[z+1],H=z+3,Y=z+4;if(typeof O!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(T.length&&T[T.length-1][0]>=O)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const ee=c.parse(U,Y,I);if(!ee)return null;I=I||ee.type,T.push([O,ee])}return G(I,yt)||G(I,Ji)||G(I,me)||G(I,X)||G(I,ne(yt))?new ar(I,f,g,w,T):c.error(`Type ${de(I)} is not interpolatable.`)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return f[0].evaluate(n);const w=c.length;if(g>=c[w-1])return f[w-1].evaluate(n);const k=_a(c,g),T=ar.interpolationFactor(this.interpolation,g,c[k],c[k+1]),I=f[k].evaluate(n),z=f[k+1].evaluate(n);switch(this.operator){case"interpolate":return gr[this.type.kind](I,z,T);case"interpolate-hcl":return gr.color(I,z,T,"hcl");case"interpolate-lab":return gr.color(I,z,T,"lab")}}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function zi(s,n,c,f){const g=f-c,w=s-c;return g===0?0:n===1?w/g:(Math.pow(n,w)-1)/(Math.pow(n,g)-1)}class nl{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const w=[];for(const T of n.slice(1)){const I=c.parse(T,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,w.push(I)}if(!f)throw new Error("No output type");const k=g&&w.some(T=>Pe(g,T.type));return new nl(k?si:f,w)}evaluate(n){let c,f=null,g=0;for(const w of this.args)if(g++,f=w.evaluate(n),f&&f instanceof Kr&&!f.available&&(c||(c=f.name),f=null,g===this.args.length&&(f=c)),f!==null)break;return f}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class rl{constructor(n,c){this.type=c.type,this.bindings=[].concat(n),this.result=c}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const c of this.bindings)n(c[1]);n(this.result)}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const f=[];for(let w=1;w<n.length-1;w+=2){const k=n[w];if(typeof k!="string")return c.error(`Expected string, but found ${typeof k} instead.`,w);if(/[^a-zA-Z0-9_]/.test(k))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(n[w+1],w+1);if(!T)return null;f.push([k,T])}const g=c.parse(n[n.length-1],n.length-1,c.expectedType,f);return g?new rl(f,g):null}outputDefined(){return this.result.outputDefined()}}class fc{constructor(n,c,f){this.type=n,this.index=c,this.input=f}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,yt),g=c.parse(n[2],2,ne(c.expectedType||si));return f&&g?new fc(g.type.itemType,f,g):null}evaluate(n){const c=this.index.evaluate(n),f=this.input.evaluate(n);if(c<0)throw new hn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new hn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new hn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class pc{constructor(n,c){this.type=ni,this.needle=n,this.haystack=c}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,si),g=c.parse(n[2],2,si);return f&&g?Be(f.type,[ni,li,yt,Ki,si])?new pc(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`):null}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!f)return!1;if(!Me(c,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${de(Bn(c))} instead.`);if(!Me(f,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${de(Bn(f))} instead.`);return f.indexOf(c)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class ol{constructor(n,c,f){this.type=yt,this.needle=n,this.haystack=c,this.fromIndex=f}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,si),g=c.parse(n[2],2,si);if(!f||!g)return null;if(!Be(f.type,[ni,li,yt,Ki,si]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,yt);return w?new ol(f,g,w):null}return new ol(f,g)}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!Me(c,["boolean","string","number","null"]))throw new hn(`Expected first argument to be of type boolean, string, number or null, but found ${de(Bn(c))} instead.`);if(!Me(f,["string","array"]))throw new hn(`Expected second argument to be of type array or string, but found ${de(Bn(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class mc{constructor(n,c,f,g,w,k){this.inputType=n,this.type=c,this.input=f,this.cases=g,this.outputs=w,this.otherwise=k}static parse(n,c){if(n.length<5)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const w={},k=[];for(let z=2;z<n.length-1;z+=2){let O=n[z];const U=n[z+1];Array.isArray(O)||(O=[O]);const H=c.concat(z);if(O.length===0)return H.error("Expected at least one branch label.");for(const ee of O){if(typeof ee!="number"&&typeof ee!="string")return H.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ee=="number"&&Math.floor(ee)!==ee)return H.error("Numeric branch labels must be integer values.");if(f){if(H.checkSubtype(f,Bn(ee)))return null}else f=Bn(ee);if(w[String(ee)]!==void 0)return H.error("Branch labels must be unique.");w[String(ee)]=k.length}const Y=c.parse(U,z,g);if(!Y)return null;g=g||Y.type,k.push(Y)}const T=c.parse(n[1],1,si);if(!T)return null;const I=c.parse(n[n.length-1],n.length-1,g);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new mc(f,g,T,w,k,I):null}evaluate(n){const c=this.input.evaluate(n);return(Bn(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class gc{constructor(n,c,f){this.type=n,this.branches=c,this.otherwise=f}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let k=1;k<n.length-1;k+=2){const T=c.parse(n[k],k,ni);if(!T)return null;const I=c.parse(n[k+1],k+1,f);if(!I)return null;g.push([T,I]),f=f||I.type}const w=c.parse(n[n.length-1],n.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new gc(f,g,w)}evaluate(n){for(const[c,f]of this.branches)if(c.evaluate(n))return f.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[c,f]of this.branches)n(c),n(f);n(this.otherwise)}outputDefined(){return this.branches.every(([n,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class sl{constructor(n,c,f,g){this.type=n,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,si),g=c.parse(n[2],2,yt);if(!f||!g)return null;if(!Be(f.type,[ne(si),li,si]))return c.error(`Expected first argument to be of type array or string, but found ${de(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,yt);return w?new sl(f.type,f,g,w):null}return new sl(f.type,f,g)}evaluate(n){const c=this.input.evaluate(n),f=this.beginIndex.evaluate(n);if(!Me(c,["string","array"]))throw new hn(`Expected first argument to be of type array or string, but found ${de(Bn(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return c.slice(f,g)}return c.slice(f)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function sh(s,n){return s==="=="||s==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function ah(s,n,c,f){return f.compare(n,c)===0}function zs(s,n,c){const f=s!=="=="&&s!=="!=";return class h0{constructor(w,k,T){this.type=ni,this.lhs=w,this.rhs=k,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||k.type.kind==="value"}static parse(w,k){if(w.length!==3&&w.length!==4)return k.error("Expected two or three arguments.");const T=w[0];let I=k.parse(w[1],1,si);if(!I)return null;if(!sh(T,I.type))return k.concat(1).error(`"${T}" comparisons are not supported for type '${de(I.type)}'.`);let z=k.parse(w[2],2,si);if(!z)return null;if(!sh(T,z.type))return k.concat(2).error(`"${T}" comparisons are not supported for type '${de(z.type)}'.`);if(I.type.kind!==z.type.kind&&I.type.kind!=="value"&&z.type.kind!=="value")return k.error(`Cannot compare types '${de(I.type)}' and '${de(z.type)}'.`);f&&(I.type.kind==="value"&&z.type.kind!=="value"?I=new Fr(z.type,[I]):I.type.kind!=="value"&&z.type.kind==="value"&&(z=new Fr(I.type,[z])));let O=null;if(w.length===4){if(I.type.kind!=="string"&&z.type.kind!=="string"&&I.type.kind!=="value"&&z.type.kind!=="value")return k.error("Cannot use collator to compare non-string types.");if(O=k.parse(w[3],3,no),!O)return null}return new h0(I,z,O)}evaluate(w){const k=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const I=Bn(k),z=Bn(T);if(I.kind!==z.kind||I.kind!=="string"&&I.kind!=="number")throw new hn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${z.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=Bn(k),z=Bn(T);if(I.kind!=="string"||z.kind!=="string")return n(w,k,T)}return this.collator?c(w,k,T,this.collator.evaluate(w)):n(w,k,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Gd=zs("==",function(s,n,c){return n===c},ah),Wd=zs("!=",function(s,n,c){return n!==c},function(s,n,c,f){return!ah(0,n,c,f)}),Hd=zs("<",function(s,n,c){return n<c},function(s,n,c,f){return f.compare(n,c)<0}),Xd=zs(">",function(s,n,c){return n>c},function(s,n,c,f){return f.compare(n,c)>0}),Kd=zs("<=",function(s,n,c){return n<=c},function(s,n,c,f){return f.compare(n,c)<=0}),Jd=zs(">=",function(s,n,c){return n>=c},function(s,n,c,f){return f.compare(n,c)>=0});class _c{constructor(n,c,f,g,w){this.type=li,this.number=n,this.locale=c,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(n,c){if(n.length!==3)return c.error("Expected two arguments.");const f=c.parse(n[1],1,yt);if(!f)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=c.parse(g.locale,1,li),!w))return null;let k=null;if(g.currency&&(k=c.parse(g.currency,1,li),!k))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,yt),!T))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,yt),!I)?null:new _c(f,w,k,T,I)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class al{constructor(n){this.type=_n,this.sections=n}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let w=!1;for(let k=1;k<=n.length-1;++k){const T=n[k];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,yt),!I))return null;let z=null;if(T["text-font"]&&(z=c.parse(T["text-font"],1,ne(li)),!z))return null;let O=null;if(T["text-color"]&&(O=c.parse(T["text-color"],1,Ji),!O))return null;const U=g[g.length-1];U.scale=I,U.font=z,U.textColor=O}else{const I=c.parse(n[k],1,si);if(!I)return null;const z=I.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new al(g)}evaluate(n){return new Br(this.sections.map(c=>{const f=c.content.evaluate(n);return Bn(f)===W?new dc("",f,null,null,null):new dc(ha(f),null,c.scale?c.scale.evaluate(n):null,c.font?c.font.evaluate(n).join(","):null,c.textColor?c.textColor.evaluate(n):null)}))}eachChild(n){for(const c of this.sections)n(c.content),c.scale&&n(c.scale),c.font&&n(c.font),c.textColor&&n(c.textColor)}outputDefined(){return!1}}class yc{constructor(n){this.type=W,this.input=n}static parse(n,c){if(n.length!==2)return c.error("Expected two arguments.");const f=c.parse(n[1],1,li);return f?new yc(f):c.error("No image name provided.")}evaluate(n){const c=this.input.evaluate(n),f=Kr.fromString(c);return f&&n.availableImages&&(f.available=n.availableImages.indexOf(c)>-1),f}eachChild(n){n(this.input)}outputDefined(){return!1}}class vc{constructor(n){this.type=yt,this.input=n}static parse(n,c){if(n.length!==2)return c.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=c.parse(n[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${de(f.type)} instead.`):new vc(f):null}evaluate(n){const c=this.input.evaluate(n);if(typeof c=="string"||Array.isArray(c))return c.length;throw new hn(`Expected value to be of type string or array, but found ${de(Bn(c))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Ds={"==":Gd,"!=":Wd,">":Xd,"<":Hd,">=":Jd,"<=":Kd,array:Fr,at:fc,boolean:Fr,case:gc,coalesce:nl,collator:Ps,format:al,image:yc,in:pc,"index-of":ol,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:vc,let:rl,literal:qo,match:mc,number:Fr,"number-format":_c,object:Fr,slice:sl,step:ya,string:Fr,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:el,within:ss};function lh(s,[n,c,f,g]){n=n.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const w=g?g.evaluate(s):1,k=As(n,c,f,w);if(k)throw new hn(k);return new $i(n/255,c/255,f/255,w,!1)}function ch(s,n){return s in n}function bc(s,n){const c=n[s];return c===void 0?null:c}function ls(s){return{type:s}}function uh(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function hh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function wc(s){return!!s.expression&&s.expression.interpolated}function Ai(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function ll(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Yd(s){return s}function dh(s,n){const c=n.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),w=s.type||(wc(n)?"exponential":"interval");if(c||n.type==="padding"){const O=c?$i.parse:Sr.parse;(s=Li({},s)).stops&&(s.stops=s.stops.map(U=>[U[0],O(U[1])])),s.default=O(s.default?s.default:n.default)}if(s.colorSpace&&(k=s.colorSpace)!=="rgb"&&k!=="hcl"&&k!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var k;let T,I,z;if(w==="exponential")T=Ti;else if(w==="interval")T=Qd;else if(w==="categorical"){T=Ln,I=Object.create(null);for(const O of s.stops)I[O[0]]=O[1];z=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=xc}if(f){const O={},U=[];for(let ee=0;ee<s.stops.length;ee++){const he=s.stops[ee],ge=he[0].zoom;O[ge]===void 0&&(O[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},U.push(ge)),O[ge].stops.push([he[0].value,he[1]])}const H=[];for(const ee of U)H.push([O[ee].zoom,dh(O[ee],n)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:ar.interpolationFactor.bind(void 0,Y),zoomStops:H.map(ee=>ee[0]),evaluate:({zoom:ee},he)=>Ti({stops:H,base:s.base},n,ee).evaluate(ee,he)}}if(g){const O=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:ar.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(U=>U[0]),evaluate:({zoom:U})=>T(s,n,U,I,z)}}return{kind:"source",evaluate(O,U){const H=U&&U.properties?U.properties[s.property]:void 0;return H===void 0?va(s.default,n.default):T(s,n,H,I,z)}}}function va(s,n,c){return s!==void 0?s:n!==void 0?n:c!==void 0?c:void 0}function Ln(s,n,c,f,g){return va(typeof c===g?f[c]:void 0,s.default,n.default)}function Qd(s,n,c){if(Ai(c)!=="number")return va(s.default,n.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const g=_a(s.stops.map(w=>w[0]),c);return s.stops[g][1]}function Ti(s,n,c){const f=s.base!==void 0?s.base:1;if(Ai(c)!=="number")return va(s.default,n.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const w=_a(s.stops.map(O=>O[0]),c),k=function(O,U,H,Y){const ee=Y-H,he=O-H;return ee===0?0:U===1?he/ee:(Math.pow(U,he)-1)/(Math.pow(U,ee)-1)}(c,f,s.stops[w][0],s.stops[w+1][0]),T=s.stops[w][1],I=s.stops[w+1][1],z=gr[n.type]||Yd;return typeof T.evaluate=="function"?{evaluate(...O){const U=T.evaluate.apply(void 0,O),H=I.evaluate.apply(void 0,O);if(U!==void 0&&H!==void 0)return z(U,H,k,s.colorSpace)}}:z(T,I,k,s.colorSpace)}function xc(s,n,c){switch(n.type){case"color":c=$i.parse(c);break;case"formatted":c=Br.fromString(c.toString());break;case"resolvedImage":c=Kr.fromString(c.toString());break;case"padding":c=Sr.parse(c);break;default:Ai(c)===n.type||n.type==="enum"&&n.values[c]||(c=void 0)}return va(c,s.default,n.default)}Or.register(Ds,{error:[{kind:"error"},[li],(s,[n])=>{throw new hn(n.evaluate(s))}],typeof:[li,[si],(s,[n])=>de(Bn(n.evaluate(s)))],"to-rgba":[ne(yt,4),[Ji],(s,[n])=>{const[c,f,g,w]=n.evaluate(s).rgb;return[255*c,255*f,255*g,w]}],rgb:[Ji,[yt,yt,yt],lh],rgba:[Ji,[yt,yt,yt,yt],lh],has:{type:ni,overloads:[[[li],(s,[n])=>ch(n.evaluate(s),s.properties())],[[li,xr],(s,[n,c])=>ch(n.evaluate(s),c.evaluate(s))]]},get:{type:si,overloads:[[[li],(s,[n])=>bc(n.evaluate(s),s.properties())],[[li,xr],(s,[n,c])=>bc(n.evaluate(s),c.evaluate(s))]]},"feature-state":[si,[li],(s,[n])=>bc(n.evaluate(s),s.featureState||{})],properties:[xr,[],s=>s.properties()],"geometry-type":[li,[],s=>s.geometryType()],id:[si,[],s=>s.id()],zoom:[yt,[],s=>s.globals.zoom],"heatmap-density":[yt,[],s=>s.globals.heatmapDensity||0],"line-progress":[yt,[],s=>s.globals.lineProgress||0],accumulated:[si,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[yt,ls(yt),(s,n)=>{let c=0;for(const f of n)c+=f.evaluate(s);return c}],"*":[yt,ls(yt),(s,n)=>{let c=1;for(const f of n)c*=f.evaluate(s);return c}],"-":{type:yt,overloads:[[[yt,yt],(s,[n,c])=>n.evaluate(s)-c.evaluate(s)],[[yt],(s,[n])=>-n.evaluate(s)]]},"/":[yt,[yt,yt],(s,[n,c])=>n.evaluate(s)/c.evaluate(s)],"%":[yt,[yt,yt],(s,[n,c])=>n.evaluate(s)%c.evaluate(s)],ln2:[yt,[],()=>Math.LN2],pi:[yt,[],()=>Math.PI],e:[yt,[],()=>Math.E],"^":[yt,[yt,yt],(s,[n,c])=>Math.pow(n.evaluate(s),c.evaluate(s))],sqrt:[yt,[yt],(s,[n])=>Math.sqrt(n.evaluate(s))],log10:[yt,[yt],(s,[n])=>Math.log(n.evaluate(s))/Math.LN10],ln:[yt,[yt],(s,[n])=>Math.log(n.evaluate(s))],log2:[yt,[yt],(s,[n])=>Math.log(n.evaluate(s))/Math.LN2],sin:[yt,[yt],(s,[n])=>Math.sin(n.evaluate(s))],cos:[yt,[yt],(s,[n])=>Math.cos(n.evaluate(s))],tan:[yt,[yt],(s,[n])=>Math.tan(n.evaluate(s))],asin:[yt,[yt],(s,[n])=>Math.asin(n.evaluate(s))],acos:[yt,[yt],(s,[n])=>Math.acos(n.evaluate(s))],atan:[yt,[yt],(s,[n])=>Math.atan(n.evaluate(s))],min:[yt,ls(yt),(s,n)=>Math.min(...n.map(c=>c.evaluate(s)))],max:[yt,ls(yt),(s,n)=>Math.max(...n.map(c=>c.evaluate(s)))],abs:[yt,[yt],(s,[n])=>Math.abs(n.evaluate(s))],round:[yt,[yt],(s,[n])=>{const c=n.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[yt,[yt],(s,[n])=>Math.floor(n.evaluate(s))],ceil:[yt,[yt],(s,[n])=>Math.ceil(n.evaluate(s))],"filter-==":[ni,[li,si],(s,[n,c])=>s.properties()[n.value]===c.value],"filter-id-==":[ni,[si],(s,[n])=>s.id()===n.value],"filter-type-==":[ni,[li],(s,[n])=>s.geometryType()===n.value],"filter-<":[ni,[li,si],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[ni,[si],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<f}],"filter->":[ni,[li,si],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[ni,[si],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>f}],"filter-<=":[ni,[li,si],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[ni,[si],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<=f}],"filter->=":[ni,[li,si],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[ni,[si],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>=f}],"filter-has":[ni,[si],(s,[n])=>n.value in s.properties()],"filter-has-id":[ni,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[ni,[ne(li)],(s,[n])=>n.value.indexOf(s.geometryType())>=0],"filter-id-in":[ni,[ne(si)],(s,[n])=>n.value.indexOf(s.id())>=0],"filter-in-small":[ni,[li,ne(si)],(s,[n,c])=>c.value.indexOf(s.properties()[n.value])>=0],"filter-in-large":[ni,[li,ne(si)],(s,[n,c])=>function(f,g,w,k){for(;w<=k;){const T=w+k>>1;if(g[T]===f)return!0;g[T]>f?k=T-1:w=T+1}return!1}(s.properties()[n.value],c.value,0,c.value.length-1)],all:{type:ni,overloads:[[[ni,ni],(s,[n,c])=>n.evaluate(s)&&c.evaluate(s)],[ls(ni),(s,n)=>{for(const c of n)if(!c.evaluate(s))return!1;return!0}]]},any:{type:ni,overloads:[[[ni,ni],(s,[n,c])=>n.evaluate(s)||c.evaluate(s)],[ls(ni),(s,n)=>{for(const c of n)if(c.evaluate(s))return!0;return!1}]]},"!":[ni,[ni],(s,[n])=>!n.evaluate(s)],"is-supported-script":[ni,[li],(s,[n])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(n.evaluate(s))}],upcase:[li,[li],(s,[n])=>n.evaluate(s).toUpperCase()],downcase:[li,[li],(s,[n])=>n.evaluate(s).toLowerCase()],concat:[li,ls(si),(s,n)=>n.map(c=>ha(c.evaluate(s))).join("")],"resolved-locale":[li,[no],(s,[n])=>n.evaluate(s).resolvedLocale()]});class rn{constructor(n,c){var f;this.expression=n,this._warningHistory={},this._evaluator=new ji,this._defaultValue=c?(f=c).type==="color"&&ll(f.default)?new $i(0,0,0,0):f.type==="color"?$i.parse(f.default)||null:f.type==="padding"?Sr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Xr.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(n,c,f,g,w,k){return this._evaluator.globals=n,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=k,this.expression.evaluate(this._evaluator)}evaluate(n,c,f,g,w,k){this._evaluator.globals=n,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=k||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new hn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Yi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function cs(s,n){const c=new Xa(Ds,pa,[],n?function(g){const w={color:Ji,string:li,number:yt,enum:li,boolean:ni,formatted:_n,padding:me,resolvedImage:W,variableAnchorOffsetCollection:X};return g.type==="array"?ne(w[g.value]||si,g.length):w[g.type]}(n):void 0),f=c.parse(s,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?uh(new rn(f,n)):Rs(c.errors)}class cl{constructor(n,c){this.kind=n,this._styleExpression=c,this.isStateDependent=n!=="constant"&&!ma(c.expression)}evaluateWithoutErrorHandling(n,c,f,g,w,k){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,g,w,k)}evaluate(n,c,f,g,w,k){return this._styleExpression.evaluate(n,c,f,g,w,k)}}class kc{constructor(n,c,f,g){this.kind=n,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=n!=="camera"&&!ma(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,c,f,g,w,k){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,g,w,k)}evaluate(n,c,f,g,w,k){return this._styleExpression.evaluate(n,c,f,g,w,k)}interpolationFactor(n,c,f){return this.interpolationType?ar.interpolationFactor(this.interpolationType,n,c,f):0}}function fh(s,n){const c=cs(s,n);if(c.result==="error")return c;const f=c.value.expression,g=tl(f);if(!g&&!Bs(n))return Rs([new ii("","data expressions not supported")]);const w=ga(f,["zoom"]);if(!w&&!hh(n))return Rs([new ii("","zoom expressions not supported")]);const k=hl(f);return k||w?k instanceof ii?Rs([k]):k instanceof ar&&!wc(n)?Rs([new ii("",'"interpolate" expressions cannot be used with this property')]):uh(k?new kc(g?"camera":"composite",c.value,k.labels,k instanceof ar?k.interpolation:void 0):new cl(g?"constant":"source",c.value)):Rs([new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ul{constructor(n,c){this._parameters=n,this._specification=c,Li(this,dh(this._parameters,this._specification))}static deserialize(n){return new ul(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function hl(s){let n=null;if(s instanceof rl)n=hl(s.result);else if(s instanceof nl){for(const c of s.args)if(n=hl(c),n)break}else(s instanceof ya||s instanceof ar)&&s.input instanceof Or&&s.input.name==="zoom"&&(n=s);return n instanceof ii||s.eachChild(c=>{const f=hl(c);f instanceof ii?n=f:!n&&f?n=new ii("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&f&&n!==f&&(n=new ii("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function dl(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const n of s.slice(1))if(!dl(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const ph={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function fl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};dl(s)||(s=ml(s));const n=cs(s,ph);if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,g)=>n.value.evaluate(c,f,{},g),needGeometry:pl(s)}}function mh(s,n){return s<n?-1:s>n?1:0}function pl(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let n=1;n<s.length;n++)if(pl(s[n]))return!0;return!1}function ml(s){if(!s)return!0;const n=s[0];return s.length<=1?n!=="any":n==="=="?Sc(s[1],s[2],"=="):n==="!="?gl(Sc(s[1],s[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Sc(s[1],s[2],n):n==="any"?(c=s.slice(1),["any"].concat(c.map(ml))):n==="all"?["all"].concat(s.slice(1).map(ml)):n==="none"?["all"].concat(s.slice(1).map(ml).map(gl)):n==="in"?gh(s[1],s.slice(2)):n==="!in"?gl(gh(s[1],s.slice(2))):n==="has"?_h(s[1]):n==="!has"?gl(_h(s[1])):n!=="within"||s;var c}function Sc(s,n,c){switch(s){case"$type":return[`filter-type-${c}`,n];case"$id":return[`filter-id-${c}`,n];default:return[`filter-${c}`,s,n]}}function gh(s,n){if(n.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(c=>typeof c!=typeof n[0])?["filter-in-large",s,["literal",n.sort(mh)]]:["filter-in-small",s,["literal",n]]}}function _h(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function gl(s){return["!",s]}function Tc(s){const n=typeof s;if(n==="number"||n==="boolean"||n==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${Tc(w)},`;return`${g}]`}const c=Object.keys(s).sort();let f="{";for(let g=0;g<c.length;g++)f+=`${JSON.stringify(c[g])}:${Tc(s[c[g]])},`;return`${f}}`}function ef(s){let n="";for(const c of Ii)n+=`/${Tc(s[c])}`;return n}function yh(s){const n=s.value;return n?[new rt(s.key,n,"constants have been deprecated as of v8")]:[]}function vn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Go(s){if(Array.isArray(s))return s.map(Go);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const n={};for(const c in s)n[c]=Go(s[c]);return n}return vn(s)}function _r(s){const n=s.key,c=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,k=s.styleSpec,T=s.validateSpec;let I=[];const z=Ai(c);if(z!=="object")return[new rt(n,c,`object expected, ${z} found`)];for(const O in c){const U=O.split(".")[0],H=f[U]||f["*"];let Y;if(g[U])Y=g[U];else if(f[U])Y=T;else if(g["*"])Y=g["*"];else{if(!f["*"]){I.push(new rt(n,c[O],`unknown property "${O}"`));continue}Y=T}I=I.concat(Y({key:(n&&`${n}.`)+O,value:c[O],valueSpec:H,style:w,styleSpec:k,object:c,objectKey:O,validateSpec:T},c))}for(const O in f)g[O]||f[O].required&&f[O].default===void 0&&c[O]===void 0&&I.push(new rt(n,c,`missing required property "${O}"`));return I}function Cc(s){const n=s.value,c=s.valueSpec,f=s.style,g=s.styleSpec,w=s.key,k=s.arrayElementValidator||s.validateSpec;if(Ai(n)!=="array")return[new rt(w,n,`array expected, ${Ai(n)} found`)];if(c.length&&n.length!==c.length)return[new rt(w,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new rt(w,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Ai(c.value)==="object"&&(T=c.value);let I=[];for(let z=0;z<n.length;z++)I=I.concat(k({array:n,arrayIndex:z,value:n[z],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${w}[${z}]`}));return I}function _l(s){const n=s.key,c=s.value,f=s.valueSpec;let g=Ai(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new rt(n,c,`number expected, ${g} found`)]:"minimum"in f&&c<f.minimum?[new rt(n,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new rt(n,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function vh(s){const n=s.valueSpec,c=vn(s.value.type);let f,g,w,k={};const T=c!=="categorical"&&s.value.property===void 0,I=!T,z=Ai(s.value.stops)==="array"&&Ai(s.value.stops[0])==="array"&&Ai(s.value.stops[0][0])==="object",O=_r({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(Y){if(c==="identity")return[new rt(Y.key,Y.value,'identity function may not have a "stops" property')];let ee=[];const he=Y.value;return ee=ee.concat(Cc({key:Y.key,value:he,valueSpec:Y.valueSpec,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,arrayElementValidator:U})),Ai(he)==="array"&&he.length===0&&ee.push(new rt(Y.key,he,"array must have at least one stop")),ee},default:function(Y){return Y.validateSpec({key:Y.key,value:Y.value,valueSpec:n,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec})}}});return c==="identity"&&T&&O.push(new rt(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||O.push(new rt(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!wc(s.valueSpec)&&O.push(new rt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!Bs(s.valueSpec)?O.push(new rt(s.key,s.value,"property functions not supported")):T&&!hh(s.valueSpec)&&O.push(new rt(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!z||s.value.property!==void 0||O.push(new rt(s.key,s.value,'"property" property is required')),O;function U(Y){let ee=[];const he=Y.value,ge=Y.key;if(Ai(he)!=="array")return[new rt(ge,he,`array expected, ${Ai(he)} found`)];if(he.length!==2)return[new rt(ge,he,`array length 2 expected, length ${he.length} found`)];if(z){if(Ai(he[0])!=="object")return[new rt(ge,he,`object expected, ${Ai(he[0])} found`)];if(he[0].zoom===void 0)return[new rt(ge,he,"object stop key must have zoom")];if(he[0].value===void 0)return[new rt(ge,he,"object stop key must have value")];if(w&&w>vn(he[0].zoom))return[new rt(ge,he[0].zoom,"stop zoom values must appear in ascending order")];vn(he[0].zoom)!==w&&(w=vn(he[0].zoom),g=void 0,k={}),ee=ee.concat(_r({key:`${ge}[0]`,value:he[0],valueSpec:{zoom:{}},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec,objectElementValidators:{zoom:_l,value:H}}))}else ee=ee.concat(H({key:`${ge}[0]`,value:he[0],valueSpec:{},validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec},he));return Yi(Go(he[1]))?ee.concat([new rt(`${ge}[1]`,he[1],"expressions are not allowed in function stops.")]):ee.concat(Y.validateSpec({key:`${ge}[1]`,value:he[1],valueSpec:n,validateSpec:Y.validateSpec,style:Y.style,styleSpec:Y.styleSpec}))}function H(Y,ee){const he=Ai(Y.value),ge=vn(Y.value),xe=Y.value!==null?Y.value:ee;if(f){if(he!==f)return[new rt(Y.key,xe,`${he} stop domain type must match previous stop domain type ${f}`)]}else f=he;if(he!=="number"&&he!=="string"&&he!=="boolean")return[new rt(Y.key,xe,"stop domain value must be a number, string, or boolean")];if(he!=="number"&&c!=="categorical"){let Oe=`number expected, ${he} found`;return Bs(n)&&c===void 0&&(Oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new rt(Y.key,xe,Oe)]}return c!=="categorical"||he!=="number"||isFinite(ge)&&Math.floor(ge)===ge?c!=="categorical"&&he==="number"&&g!==void 0&&ge<g?[new rt(Y.key,xe,"stop domain values must appear in ascending order")]:(g=ge,c==="categorical"&&ge in k?[new rt(Y.key,xe,"stop domain values must be unique")]:(k[ge]=!0,[])):[new rt(Y.key,xe,`integer expected, found ${ge}`)]}}function Wo(s){const n=(s.expressionContext==="property"?fh:cs)(Go(s.value),s.valueSpec);if(n.result==="error")return n.value.map(f=>new rt(`${s.key}${f.key}`,s.value,f.message));const c=n.value.expression||n.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new rt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!ma(c))return[new rt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!ma(c))return[new rt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!ga(c,["zoom","feature-state"]))return[new rt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!tl(c))return[new rt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ho(s){const n=s.key,c=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(vn(c))===-1&&g.push(new rt(n,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(vn(c))===-1&&g.push(new rt(n,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Fs(s){return dl(Go(s.value))?Wo(Li({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mc(s)}function Mc(s){const n=s.value,c=s.key;if(Ai(n)!=="array")return[new rt(c,n,`array expected, ${Ai(n)} found`)];const f=s.styleSpec;let g,w=[];if(n.length<1)return[new rt(c,n,"filter array must have at least 1 element")];switch(w=w.concat(Ho({key:`${c}[0]`,value:n[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),vn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&vn(n[1])==="$type"&&w.push(new rt(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&w.push(new rt(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=Ai(n[1]),g!=="string"&&w.push(new rt(`${c}[1]`,n[1],`string expected, ${g} found`)));for(let k=2;k<n.length;k++)g=Ai(n[k]),vn(n[1])==="$type"?w=w.concat(Ho({key:`${c}[${k}]`,value:n[k],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new rt(`${c}[${k}]`,n[k],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let k=1;k<n.length;k++)w=w.concat(Mc({key:`${c}[${k}]`,value:n[k],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Ai(n[1]),n.length!==2?w.push(new rt(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new rt(`${c}[1]`,n[1],`string expected, ${g} found`));break;case"within":g=Ai(n[1]),n.length!==2?w.push(new rt(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="object"&&w.push(new rt(`${c}[1]`,n[1],`object expected, ${g} found`))}return w}function yl(s,n){const c=s.key,f=s.validateSpec,g=s.style,w=s.styleSpec,k=s.value,T=s.objectKey,I=w[`${n}_${s.layerType}`];if(!I)return[];const z=T.match(/^(.*)-transition$/);if(n==="paint"&&z&&I[z[1]]&&I[z[1]].transition)return f({key:c,value:k,valueSpec:w.transition,style:g,styleSpec:w});const O=s.valueSpec||I[T];if(!O)return[new rt(c,k,`unknown property "${T}"`)];let U;if(Ai(k)==="string"&&Bs(O)&&!O.tokens&&(U=/^{([^}]+)}$/.exec(k)))return[new rt(c,k,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const H=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&H.push(new rt(c,k,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&ll(Go(k))&&vn(k.type)==="identity"&&H.push(new rt(c,k,'"text-font" does not support identity functions'))),H.concat(f({key:s.key,value:k,valueSpec:O,style:g,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:T}))}function Ec(s){return yl(s,"paint")}function Ic(s){return yl(s,"layout")}function ba(s){let n=[];const c=s.value,f=s.key,g=s.style,w=s.styleSpec;c.type||c.ref||n.push(new rt(f,c,'either "type" or "ref" is required'));let k=vn(c.type);const T=vn(c.ref);if(c.id){const I=vn(c.id);for(let z=0;z<s.arrayIndex;z++){const O=g.layers[z];vn(O.id)===I&&n.push(new rt(f,c.id,`duplicate layer id "${c.id}", previously used at line ${O.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(z=>{z in c&&n.push(new rt(f,c[z],`"${z}" is prohibited for ref layers`))}),g.layers.forEach(z=>{vn(z.id)===T&&(I=z)}),I?I.ref?n.push(new rt(f,c.ref,"ref cannot reference another ref layer")):k=vn(I.type):n.push(new rt(f,c.ref,`ref layer "${T}" not found`))}else if(k!=="background")if(c.source){const I=g.sources&&g.sources[c.source],z=I&&vn(I.type);I?z==="vector"&&k==="raster"?n.push(new rt(f,c.source,`layer "${c.id}" requires a raster source`)):z!=="raster-dem"&&k==="hillshade"?n.push(new rt(f,c.source,`layer "${c.id}" requires a raster-dem source`)):z==="raster"&&k!=="raster"?n.push(new rt(f,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&k!=="hillshade"?n.push(new rt(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!c.paint||!c.paint["line-gradient"]||z==="geojson"&&I.lineMetrics||n.push(new rt(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new rt(f,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new rt(f,c.source,`source "${c.source}" not found`))}else n.push(new rt(f,c,'missing required property "source"'));return n=n.concat(_r({key:f,value:c,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Fs,layout:I=>_r({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":z=>Ic(Li({layerType:k},z))}}),paint:I=>_r({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":z=>Ec(Li({layerType:k},z))}})}})),n}function us(s){const n=s.value,c=s.key,f=Ai(n);return f!=="string"?[new rt(c,n,`string expected, ${f} found`)]:[]}const bh={promoteId:function({key:s,value:n}){if(Ai(n)==="string")return us({key:s,value:n});{const c=[];for(const f in n)c.push(...us({key:`${s}.${f}`,value:n[f]}));return c}}};function wh(s){const n=s.value,c=s.key,f=s.styleSpec,g=s.style,w=s.validateSpec;if(!n.type)return[new rt(c,n,'"type" is required')];const k=vn(n.type);let T;switch(k){case"vector":case"raster":return T=_r({key:c,value:n,valueSpec:f[`source_${k.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:bh,validateSpec:w}),T;case"raster-dem":return T=function(I){var z;const O=(z=I.sourceName)!==null&&z!==void 0?z:"",U=I.value,H=I.styleSpec,Y=H.source_raster_dem,ee=I.style;let he=[];const ge=Ai(U);if(U===void 0)return he;if(ge!=="object")return he.push(new rt("source_raster_dem",U,`object expected, ${ge} found`)),he;const xe=vn(U.encoding)==="custom",Oe=["redFactor","greenFactor","blueFactor","baseShift"],Ee=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const De in U)!xe&&Oe.includes(De)?he.push(new rt(De,U[De],`In "${O}": "${De}" is only valid when "encoding" is set to "custom". ${Ee} encoding found`)):Y[De]?he=he.concat(I.validateSpec({key:De,value:U[De],valueSpec:Y[De],validateSpec:I.validateSpec,style:ee,styleSpec:H})):he.push(new rt(De,U[De],`unknown property "${De}"`));return he}({sourceName:c,value:n,style:s.style,styleSpec:f,validateSpec:w}),T;case"geojson":if(T=_r({key:c,value:n,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:w,objectElementValidators:bh}),n.cluster)for(const I in n.clusterProperties){const[z,O]=n.clusterProperties[I],U=typeof z=="string"?[z,["accumulated"],["get",I]]:z;T.push(...Wo({key:`${c}.${I}.map`,value:O,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Wo({key:`${c}.${I}.reduce`,value:U,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return _r({key:c,value:n,valueSpec:f.source_video,style:g,validateSpec:w,styleSpec:f});case"image":return _r({key:c,value:n,valueSpec:f.source_image,style:g,validateSpec:w,styleSpec:f});case"canvas":return[new rt(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ho({key:`${c}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:w,styleSpec:f})}}function xh(s){const n=s.value,c=s.styleSpec,f=c.light,g=s.style;let w=[];const k=Ai(n);if(n===void 0)return w;if(k!=="object")return w=w.concat([new rt("light",n,`object expected, ${k} found`)]),w;for(const T in n){const I=T.match(/^(.*)-transition$/);w=w.concat(I&&f[I[1]]&&f[I[1]].transition?s.validateSpec({key:T,value:n[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new rt(T,n[T],`unknown property "${T}"`)])}return w}function kh(s){const n=s.value,c=s.styleSpec,f=c.sky,g=s.style,w=Ai(n);if(n===void 0)return[];if(w!=="object")return[new rt("sky",n,`object expected, ${w} found`)];let k=[];for(const T in n)k=k.concat(f[T]?vo({key:T,value:n[T],valueSpec:f[T],style:g,styleSpec:c}):[new rt(T,n[T],`unknown property "${T}"`)]);return k}function wa(s){const n=s.value,c=s.styleSpec,f=c.terrain,g=s.style;let w=[];const k=Ai(n);if(n===void 0)return w;if(k!=="object")return w=w.concat([new rt("terrain",n,`object expected, ${k} found`)]),w;for(const T in n)w=w.concat(f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new rt(T,n[T],`unknown property "${T}"`)]);return w}function xa(s){let n=[];const c=s.value,f=s.key;if(Array.isArray(c)){const g=[],w=[];for(const k in c)c[k].id&&g.includes(c[k].id)&&n.push(new rt(f,c,`all the sprites' ids must be unique, but ${c[k].id} is duplicated`)),g.push(c[k].id),c[k].url&&w.includes(c[k].url)&&n.push(new rt(f,c,`all the sprites' URLs must be unique, but ${c[k].url} is duplicated`)),w.push(c[k].url),n=n.concat(_r({key:`${f}[${k}]`,value:c[k],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return n}return us({key:f,value:c})}const Tr={"*":()=>[],array:Cc,boolean:function(s){const n=s.value,c=s.key,f=Ai(n);return f!=="boolean"?[new rt(c,n,`boolean expected, ${f} found`)]:[]},number:_l,color:function(s){const n=s.key,c=s.value,f=Ai(c);return f!=="string"?[new rt(n,c,`color expected, ${f} found`)]:$i.parse(String(c))?[]:[new rt(n,c,`color expected, "${c}" found`)]},constants:yh,enum:Ho,filter:Fs,function:vh,layer:ba,object:_r,source:wh,light:xh,sky:kh,terrain:wa,string:us,formatted:function(s){return us(s).length===0?[]:Wo(s)},resolvedImage:function(s){return us(s).length===0?[]:Wo(s)},padding:function(s){const n=s.key,c=s.value;if(Ai(c)==="array"){if(c.length<1||c.length>4)return[new rt(n,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let g=[];for(let w=0;w<c.length;w++)g=g.concat(s.validateSpec({key:`${n}[${w}]`,value:c[w],validateSpec:s.validateSpec,valueSpec:f}));return g}return _l({key:n,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const n=s.key,c=s.value,f=Ai(c),g=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new rt(n,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let k=0;k<c.length;k+=2)w=w.concat(Ho({key:`${n}[${k}]`,value:c[k],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Cc({key:`${n}[${k+1}]`,value:c[k+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:xa};function vo(s){const n=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=vo,c.expression&&ll(vn(n))?vh(s):c.expression&&Yi(Go(n))?Wo(s):c.type&&Tr[c.type]?Tr[c.type](s):_r(Li({},s,{valueSpec:c.type?f[c.type]:c}))}function Lc(s){const n=s.value,c=s.key,f=us(s);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new rt(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new rt(c,n,'"glyphs" url must include a "{range}" token'))),f}function ro(s,n=we){let c=[];return c=c.concat(vo({key:"",value:s,valueSpec:n.$root,styleSpec:n,style:s,validateSpec:vo,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),s.constants&&(c=c.concat(yh({key:"constants",value:s.constants,style:s,styleSpec:n,validateSpec:vo}))),Os(c)}function bo(s){return function(n){return s({...n,validateSpec:vo})}}function Os(s){return[].concat(s).sort((n,c)=>n.line-c.line)}function oo(s){return function(...n){return Os(s.apply(this,n))}}ro.source=oo(bo(wh)),ro.sprite=oo(bo(xa)),ro.glyphs=oo(bo(Lc)),ro.light=oo(bo(xh)),ro.sky=oo(bo(kh)),ro.terrain=oo(bo(wa)),ro.layer=oo(bo(ba)),ro.filter=oo(bo(Fs)),ro.paintProperty=oo(bo(Ec)),ro.layoutProperty=oo(bo(Ic));const hs=ro,tf=hs.light,Ac=hs.paintProperty,nf=hs.layoutProperty;function Ns(s,n){let c=!1;if(n&&n.length)for(const f of n)s.fire(new dt(new Error(f.message))),c=!0;return c}class ka{constructor(n,c,f){const g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const k=new Int32Array(this.arrayBuffer);n=k[0],this.d=(c=k[1])+2*(f=k[2]);for(let I=0;I<this.d*this.d;I++){const z=k[3+I],O=k[3+I+1];g.push(z===O?null:k.subarray(z,O))}const T=k[3+g.length+1];this.keys=k.subarray(k[3+g.length],T),this.bboxes=k.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let k=0;k<this.d*this.d;k++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=f,this.scale=c/n,this.uid=0;const w=f/c*n;this.min=-w,this.max=n+w}insert(n,c,f,g,w){this._forEachCell(c,f,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,c,f,g,w,k){this.cells[w].push(k)}query(n,c,f,g,w){const k=this.min,T=this.max;if(n<=k&&c<=k&&T<=f&&T<=g&&!w)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(n,c,f,g,this._queryCell,I,{},w),I}}_queryCell(n,c,f,g,w,k,T,I){const z=this.cells[w];if(z!==null){const O=this.keys,U=this.bboxes;for(let H=0;H<z.length;H++){const Y=z[H];if(T[Y]===void 0){const ee=4*Y;(I?I(U[ee+0],U[ee+1],U[ee+2],U[ee+3]):n<=U[ee+2]&&c<=U[ee+3]&&f>=U[ee+0]&&g>=U[ee+1])?(T[Y]=!0,k.push(O[Y])):T[Y]=!1}}}}_forEachCell(n,c,f,g,w,k,T,I){const z=this._convertToCellCoord(n),O=this._convertToCellCoord(c),U=this._convertToCellCoord(f),H=this._convertToCellCoord(g);for(let Y=z;Y<=U;Y++)for(let ee=O;ee<=H;ee++){const he=this.d*ee+Y;if((!I||I(this._convertFromCellCoord(Y),this._convertFromCellCoord(ee),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(ee+1)))&&w.call(this,n,c,f,g,he,k,T,I))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,c=3+this.cells.length+1+1;let f=0;for(let k=0;k<this.cells.length;k++)f+=this.cells[k].length;const g=new Int32Array(c+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=c;for(let k=0;k<n.length;k++){const T=n[k];g[3+k]=w,g.set(T,w),w+=T.length}return g[3+n.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+n.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(n,c){const f=n.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(n){return new ka(n.buffer)}}const wo={};function zt(s,n,c={}){if(wo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:s,writeable:!1}),wo[s]={klass:n,omit:c.omit||[],shallow:c.shallow||[]}}zt("Object",Object),zt("TransferableGridIndex",ka),zt("Color",$i),zt("Error",Error),zt("AJAXError",Yt),zt("ResolvedImage",Kr),zt("StylePropertyFunction",ul),zt("StyleExpression",rn,{omit:["_evaluator"]}),zt("ZoomDependentExpression",kc),zt("ZoomConstantExpression",cl),zt("CompoundExpression",Or,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||zt(`Expression_${s}`,Ds[s]);function vl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function $s(s,n){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(vl(s)||nt(s))return n&&n.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return n&&n.push(c.buffer),c}if(s instanceof ImageData)return n&&n.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const f of s)c.push($s(f,n));return c}if(typeof s=="object"){const c=s.constructor,f=c._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!wo[f])throw new Error(`${f} is not registered.`);const g=c.serialize?c.serialize(s,n):{};if(c.serialize){if(n&&g===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||wo[f].omit.indexOf(w)>=0)continue;const k=s[w];g[w]=wo[f].shallow.indexOf(w)>=0?k:$s(k,n)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof s)}function js(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||vl(s)||nt(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(js);if(typeof s=="object"){const n=s.$name||"Object";if(!wo[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:c}=wo[n];if(!c)throw new Error(`can't deserialize unregistered class ${n}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];f[g]=wo[n].shallow.indexOf(g)>=0?w:js(w)}return f}throw new Error("can't deserialize object of type "+typeof s)}class Sh{constructor(){this.first=!0}update(n,c){const f=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=f,!0))}}const Et={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Us(s){for(const n of s)if(bl(n.charCodeAt(0)))return!0;return!1}function Th(s){for(const n of s)if(!Ch(n.charCodeAt(0)))return!1;return!0}function Ch(s){return!(Et.Arabic(s)||Et["Arabic Supplement"](s)||Et["Arabic Extended-A"](s)||Et["Arabic Presentation Forms-A"](s)||Et["Arabic Presentation Forms-B"](s))}function bl(s){return!(s!==746&&s!==747&&(s<4352||!(Et["Bopomofo Extended"](s)||Et.Bopomofo(s)||Et["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Et["CJK Compatibility Ideographs"](s)||Et["CJK Compatibility"](s)||Et["CJK Radicals Supplement"](s)||Et["CJK Strokes"](s)||!(!Et["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Et["CJK Unified Ideographs Extension A"](s)||Et["CJK Unified Ideographs"](s)||Et["Enclosed CJK Letters and Months"](s)||Et["Hangul Compatibility Jamo"](s)||Et["Hangul Jamo Extended-A"](s)||Et["Hangul Jamo Extended-B"](s)||Et["Hangul Jamo"](s)||Et["Hangul Syllables"](s)||Et.Hiragana(s)||Et["Ideographic Description Characters"](s)||Et.Kanbun(s)||Et["Kangxi Radicals"](s)||Et["Katakana Phonetic Extensions"](s)||Et.Katakana(s)&&s!==12540||!(!Et["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Et["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Et["Unified Canadian Aboriginal Syllabics"](s)||Et["Unified Canadian Aboriginal Syllabics Extended"](s)||Et["Vertical Forms"](s)||Et["Yijing Hexagram Symbols"](s)||Et["Yi Syllables"](s)||Et["Yi Radicals"](s))))}function Pc(s){return!(bl(s)||function(n){return!!(Et["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Et["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Et["Letterlike Symbols"](n)||Et["Number Forms"](n)||Et["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Et["Control Pictures"](n)&&n!==9251||Et["Optical Character Recognition"](n)||Et["Enclosed Alphanumerics"](n)||Et["Geometric Shapes"](n)||Et["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Et["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Et["CJK Symbols and Punctuation"](n)||Et.Katakana(n)||Et["Private Use Area"](n)||Et["CJK Compatibility Forms"](n)||Et["Small Form Variants"](n)||Et["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(s))}function wl(s){return s>=1424&&s<=2303||Et["Arabic Presentation Forms-A"](s)||Et["Arabic Presentation Forms-B"](s)}function Mh(s,n){return!(!n&&wl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Et.Khmer(s))}function rf(s){for(const n of s)if(wl(n.charCodeAt(0)))return!0;return!1}const Xo=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ln{constructor(n,c){this.zoom=n,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sh,this.transition={})}isSupportedScript(n){return function(c,f){for(const g of c)if(!Mh(g.charCodeAt(0),f))return!1;return!0}(n,Xo.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,c=n-Math.floor(n),f=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class Sa{constructor(n,c){this.property=n,this.value=c,this.expression=function(f,g){if(ll(f))return new ul(f,g);if(Yi(f)){const w=fh(f,g);if(w.result==="error")throw new Error(w.value.map(k=>`${k.key}: ${k.message}`).join(", "));return w.value}{let w=f;return g.type==="color"&&typeof f=="string"?w=$i.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Xr.parse(f)):w=Sr.parse(f),{kind:"constant",evaluate:()=>w}}}(c===void 0?n.specification.default:c,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,c,f){return this.property.possiblyEvaluate(this,n,c,f)}}class xl{constructor(n){this.property=n,this.value=new Sa(n,void 0)}transitioned(n,c){return new Eh(this.property,this.value,c,J({},n.transition,this.transition),n.now)}untransitioned(){return new Eh(this.property,this.value,null,{},0)}}class zc{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return oe(this._values[n].value.value)}setValue(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new xl(this._values[n].property)),this._values[n].value=new Sa(this._values[n].property,c===null?void 0:oe(c))}getTransition(n){return oe(this._values[n].transition)}setTransition(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new xl(this._values[n].property)),this._values[n].transition=oe(c)||void 0}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f);const g=this.getTransition(c);g!==void 0&&(n[`${c}-transition`]=g)}return n}transitioned(n,c){const f=new Ih(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(n,c._values[g]);return f}untransitioned(){const n=new Ih(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].untransitioned();return n}}class Eh{constructor(n,c,f,g,w){this.property=n,this.value=c,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,n.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(n,c,f){const g=n.now||0,w=this.value.possiblyEvaluate(n,c,f),k=this.prior;if(k){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return k.possiblyEvaluate(n,c,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(k.possiblyEvaluate(n,c,f),w,function(I){if(I<=0)return 0;if(I>=1)return 1;const z=I*I,O=z*I;return 4*(I<.5?O:3*(I-z)+O-.75)}(T))}}return w}}class Ih{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,c,f){const g=new Ta(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,c,f);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Lh{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return oe(this._values[n].value)}setValue(n,c){this._values[n]=new Sa(this._values[n].property,c===null?void 0:oe(c))}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f)}return n}possiblyEvaluate(n,c,f){const g=new Ta(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,c,f);return g}}class so{constructor(n,c,f){this.property=n,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,c,f,g){return this.property.evaluate(this.value,this.parameters,n,c,f,g)}}class Ta{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Zt{constructor(n){this.specification=n}possiblyEvaluate(n,c){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(c)}interpolate(n,c,f){const g=gr[this.specification.type];return g?g(n,c,f):n}}class Kt{constructor(n,c){this.specification=n,this.overrides=c}possiblyEvaluate(n,c,f,g){return new so(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(c,null,{},f,g)}:n.expression,c)}interpolate(n,c,f){if(n.value.kind!=="constant"||c.value.kind!=="constant")return n;if(n.value.value===void 0||c.value.value===void 0)return new so(this,{kind:"constant",value:void 0},n.parameters);const g=gr[this.specification.type];if(g){const w=g(n.value.value,c.value.value,f);return new so(this,{kind:"constant",value:w},n.parameters)}return n}evaluate(n,c,f,g,w,k){return n.kind==="constant"?n.value:n.evaluate(c,f,g,w,k)}}class kl extends Kt{possiblyEvaluate(n,c,f,g){if(n.value===void 0)return new so(this,{kind:"constant",value:void 0},c);if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,g),k=n.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(k,k,k,c);return new so(this,{kind:"constant",value:T},c)}if(n.expression.kind==="camera"){const w=this._calculate(n.expression.evaluate({zoom:c.zoom-1}),n.expression.evaluate({zoom:c.zoom}),n.expression.evaluate({zoom:c.zoom+1}),c);return new so(this,{kind:"constant",value:w},c)}return new so(this,n.expression,c)}evaluate(n,c,f,g,w,k){if(n.kind==="source"){const T=n.evaluate(c,f,g,w,k);return this._calculate(T,T,T,c)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(c.zoom)-1},f,g),n.evaluate({zoom:Math.floor(c.zoom)},f,g),n.evaluate({zoom:Math.floor(c.zoom)+1},f,g),c):n.value}_calculate(n,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Ca{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,g){if(n.value!==void 0){if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,g);return this._calculate(w,w,w,c)}return this._calculate(n.expression.evaluate(new ln(Math.floor(c.zoom-1),c)),n.expression.evaluate(new ln(Math.floor(c.zoom),c)),n.expression.evaluate(new ln(Math.floor(c.zoom+1),c)),c)}}_calculate(n,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Dc{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,g){return!!n.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class Cr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in n){const f=n[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Sa(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new xl(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}zt("DataDrivenProperty",Kt),zt("DataConstantProperty",Zt),zt("CrossFadedDataDrivenProperty",kl),zt("CrossFadedProperty",Ca),zt("ColorRampProperty",Dc);const Rc="-transition";class ao extends bt{constructor(n,c){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),c.layout&&(this._unevaluatedLayout=new Lh(c.layout)),c.paint)){this._transitionablePaint=new zc(c.paint);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ta(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,c,f={}){c!=null&&this._validate(nf,`layers.${this.id}.layout.${n}`,n,c,f)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,c):this.visibility=c)}getPaintProperty(n){return n.endsWith(Rc)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,c,f={}){if(c!=null&&this._validate(Ac,`layers.${this.id}.paint.${n}`,n,c,f))return!1;if(n.endsWith(Rc))return this._transitionablePaint.setTransition(n.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[n],w=g.property.specification["property-type"]==="cross-faded-data-driven",k=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(n,c),this._handleSpecialPaintPropertyUpdate(n);const I=this._transitionablePaint._values[n].value;return I.isDataDriven()||k||w||this._handleOverridablePaintPropertyUpdate(n,T,I)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,c,f){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,c){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,c)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Ue(n,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(n,c,f,g,w={}){return(!w||w.validate!==!1)&&Ns(this,n.call(hs,{key:c,layerType:this.type,objectKey:f,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const c=this.paint.get(n);if(c instanceof so&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Ah={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ma{constructor(n,c){this._structArray=n,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class bn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,c){return n._trim(),c&&(n.isTransferred=!0,c.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const c=Object.create(this.prototype);return c.arrayBuffer=n.arrayBuffer,c.length=n.length,c.capacity=n.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function An(s,n=1){let c=0,f=0;return{members:s.map(g=>{const w=Ah[g.type].BYTES_PER_ELEMENT,k=c=Ph(c,Math.max(n,w)),T=g.components||1;return f=Math.max(f,w),c+=w*T,{name:g.name,type:g.type,components:T,offset:k}}),size:Ph(c,Math.max(f,n)),alignment:n}}function Ph(s,n){return Math.ceil(s/n)*n}class Ea extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.int16[g+0]=c,this.int16[g+1]=f,n}}Ea.prototype.bytesPerElement=4,zt("StructArrayLayout2i4",Ea);class zo extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=g,n}}zo.prototype.bytesPerElement=6,zt("StructArrayLayout3i6",zo);class Bc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const k=4*n;return this.int16[k+0]=c,this.int16[k+1]=f,this.int16[k+2]=g,this.int16[k+3]=w,n}}Bc.prototype.bytesPerElement=8,zt("StructArrayLayout4i8",Bc);class Fc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,k)}emplace(n,c,f,g,w,k,T){const I=6*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=w,this.int16[I+4]=k,this.int16[I+5]=T,n}}Fc.prototype.bytesPerElement=12,zt("StructArrayLayout2i4i12",Fc);class Oc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,k)}emplace(n,c,f,g,w,k,T){const I=4*n,z=8*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[z+4]=g,this.uint8[z+5]=w,this.uint8[z+6]=k,this.uint8[z+7]=T,n}}Oc.prototype.bytesPerElement=8,zt("StructArrayLayout2i4ub8",Oc);class Ia extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.float32[g+0]=c,this.float32[g+1]=f,n}}Ia.prototype.bytesPerElement=8,zt("StructArrayLayout2f8",Ia);class Sl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k,T,I,z,O){const U=this.length;return this.resize(U+1),this.emplace(U,n,c,f,g,w,k,T,I,z,O)}emplace(n,c,f,g,w,k,T,I,z,O,U){const H=10*n;return this.uint16[H+0]=c,this.uint16[H+1]=f,this.uint16[H+2]=g,this.uint16[H+3]=w,this.uint16[H+4]=k,this.uint16[H+5]=T,this.uint16[H+6]=I,this.uint16[H+7]=z,this.uint16[H+8]=O,this.uint16[H+9]=U,n}}Sl.prototype.bytesPerElement=20,zt("StructArrayLayout10ui20",Sl);class Nc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k,T,I,z,O,U,H){const Y=this.length;return this.resize(Y+1),this.emplace(Y,n,c,f,g,w,k,T,I,z,O,U,H)}emplace(n,c,f,g,w,k,T,I,z,O,U,H,Y){const ee=12*n;return this.int16[ee+0]=c,this.int16[ee+1]=f,this.int16[ee+2]=g,this.int16[ee+3]=w,this.uint16[ee+4]=k,this.uint16[ee+5]=T,this.uint16[ee+6]=I,this.uint16[ee+7]=z,this.int16[ee+8]=O,this.int16[ee+9]=U,this.int16[ee+10]=H,this.int16[ee+11]=Y,n}}Nc.prototype.bytesPerElement=24,zt("StructArrayLayout4i4ui4i24",Nc);class $c extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,n}}$c.prototype.bytesPerElement=12,zt("StructArrayLayout3f12",$c);class Do extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint32[1*n+0]=c,n}}Do.prototype.bytesPerElement=4,zt("StructArrayLayout1ul4",Do);class Tl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k,T,I,z){const O=this.length;return this.resize(O+1),this.emplace(O,n,c,f,g,w,k,T,I,z)}emplace(n,c,f,g,w,k,T,I,z,O){const U=10*n,H=5*n;return this.int16[U+0]=c,this.int16[U+1]=f,this.int16[U+2]=g,this.int16[U+3]=w,this.int16[U+4]=k,this.int16[U+5]=T,this.uint32[H+3]=I,this.uint16[U+8]=z,this.uint16[U+9]=O,n}}Tl.prototype.bytesPerElement=20,zt("StructArrayLayout6i1ul2ui20",Tl);class La extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,k)}emplace(n,c,f,g,w,k,T){const I=6*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=w,this.int16[I+4]=k,this.int16[I+5]=T,n}}La.prototype.bytesPerElement=12,zt("StructArrayLayout2i2i2i12",La);class Cl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w){const k=this.length;return this.resize(k+1),this.emplace(k,n,c,f,g,w)}emplace(n,c,f,g,w,k){const T=4*n,I=8*n;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[I+6]=w,this.int16[I+7]=k,n}}Cl.prototype.bytesPerElement=16,zt("StructArrayLayout2f1f2i16",Cl);class Aa extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const k=12*n,T=3*n;return this.uint8[k+0]=c,this.uint8[k+1]=f,this.float32[T+1]=g,this.float32[T+2]=w,n}}Aa.prototype.bytesPerElement=12,zt("StructArrayLayout2ub2f12",Aa);class Ml extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=g,n}}Ml.prototype.bytesPerElement=6,zt("StructArrayLayout3ui6",Ml);class Vs extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he,ge,xe){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he,ge,xe)}emplace(n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he,ge,xe,Oe){const Ee=24*n,De=12*n,Ye=48*n;return this.int16[Ee+0]=c,this.int16[Ee+1]=f,this.uint16[Ee+2]=g,this.uint16[Ee+3]=w,this.uint32[De+2]=k,this.uint32[De+3]=T,this.uint32[De+4]=I,this.uint16[Ee+10]=z,this.uint16[Ee+11]=O,this.uint16[Ee+12]=U,this.float32[De+7]=H,this.float32[De+8]=Y,this.uint8[Ye+36]=ee,this.uint8[Ye+37]=he,this.uint8[Ye+38]=ge,this.uint32[De+10]=xe,this.int16[Ee+22]=Oe,n}}Vs.prototype.bytesPerElement=48,zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vs);class ds extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he,ge,xe,Oe,Ee,De,Ye,et,Lt,$t,It,Tt,_t,Bt){const kt=this.length;return this.resize(kt+1),this.emplace(kt,n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he,ge,xe,Oe,Ee,De,Ye,et,Lt,$t,It,Tt,_t,Bt)}emplace(n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he,ge,xe,Oe,Ee,De,Ye,et,Lt,$t,It,Tt,_t,Bt,kt){const ut=32*n,Xt=16*n;return this.int16[ut+0]=c,this.int16[ut+1]=f,this.int16[ut+2]=g,this.int16[ut+3]=w,this.int16[ut+4]=k,this.int16[ut+5]=T,this.int16[ut+6]=I,this.int16[ut+7]=z,this.uint16[ut+8]=O,this.uint16[ut+9]=U,this.uint16[ut+10]=H,this.uint16[ut+11]=Y,this.uint16[ut+12]=ee,this.uint16[ut+13]=he,this.uint16[ut+14]=ge,this.uint16[ut+15]=xe,this.uint16[ut+16]=Oe,this.uint16[ut+17]=Ee,this.uint16[ut+18]=De,this.uint16[ut+19]=Ye,this.uint16[ut+20]=et,this.uint16[ut+21]=Lt,this.uint16[ut+22]=$t,this.uint32[Xt+12]=It,this.float32[Xt+13]=Tt,this.float32[Xt+14]=_t,this.uint16[ut+30]=Bt,this.uint16[ut+31]=kt,n}}ds.prototype.bytesPerElement=64,zt("StructArrayLayout8i15ui1ul2f2ui64",ds);class El extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.float32[1*n+0]=c,n}}El.prototype.bytesPerElement=4,zt("StructArrayLayout1f4",El);class Il extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.uint16[6*n+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,n}}Il.prototype.bytesPerElement=12,zt("StructArrayLayout1ui2f12",Il);class fs extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=4*n;return this.uint32[2*n+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=g,n}}fs.prototype.bytesPerElement=8,zt("StructArrayLayout1ul2ui8",fs);class jc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.uint16[g+0]=c,this.uint16[g+1]=f,n}}jc.prototype.bytesPerElement=4,zt("StructArrayLayout2ui4",jc);class Uc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint16[1*n+0]=c,n}}Uc.prototype.bytesPerElement=2,zt("StructArrayLayout1ui2",Uc);class Ll extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const k=4*n;return this.float32[k+0]=c,this.float32[k+1]=f,this.float32[k+2]=g,this.float32[k+3]=w,n}}Ll.prototype.bytesPerElement=16,zt("StructArrayLayout4f16",Ll);class zh extends Ma{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}zh.prototype.size=20;class v extends Tl{get(n){return new zh(this,n)}}zt("CollisionBoxArray",v);class o extends Ma{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}o.prototype.size=48;class h extends Vs{get(n){return new o(this,n)}}zt("PlacedSymbolArray",h);class p extends Ma{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends ds{get(n){return new p(this,n)}}zt("SymbolInstanceArray",m);class b extends El{getoffsetX(n){return this.float32[1*n+0]}}zt("GlyphOffsetArray",b);class M extends zo{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}zt("SymbolLineVertexArray",M);class E extends Ma{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}E.prototype.size=12;class A extends Il{get(n){return new E(this,n)}}zt("TextAnchorOffsetArray",A);class F extends Ma{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class V extends fs{get(n){return new F(this,n)}}zt("FeatureIndexArray",V);class q extends Ea{}class Q extends Ea{}class pe extends Ea{}class fe extends Fc{}class _e extends Oc{}class ue extends Ia{}class Ie extends Sl{}class Ze extends Nc{}class be extends $c{}class Re extends Do{}class We extends La{}class He extends Aa{}class Xe extends Ml{}class ot extends jc{}const it=An([{name:"a_pos",components:2,type:"Int16"}],4),{members:gt}=it;class vt{constructor(n=[]){this.segments=n}prepareSegment(n,c,f,g){let w=this.segments[this.segments.length-1];return n>vt.MAX_VERTEX_ARRAY_LENGTH&&st(`Max vertices per segment is ${vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!w||w.vertexLength+n>vt.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const n of this.segments)for(const c in n.vaos)n.vaos[c].destroy()}static simpleSegment(n,c,f,g){return new vt([{vertexOffset:n,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function ci(s,n){return 256*(s=le(Math.floor(s),0,255))+le(Math.floor(n),0,255)}vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt("SegmentVector",vt);const xt=An([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ei={exports:{}},ui={exports:{}};ui.exports=function(s,n){var c,f,g,w,k,T,I,z;for(f=s.length-(c=3&s.length),g=n,k=3432918353,T=461845907,z=0;z<f;)I=255&s.charCodeAt(z)|(255&s.charCodeAt(++z))<<8|(255&s.charCodeAt(++z))<<16|(255&s.charCodeAt(++z))<<24,++z,g=27492+(65535&(w=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*k+(((I>>>16)*k&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&s.charCodeAt(z+2))<<16;case 2:I^=(255&s.charCodeAt(z+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(z)))*k+(((I>>>16)*k&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Ci=ui.exports,ri={exports:{}};ri.exports=function(s,n){for(var c,f=s.length,g=n^f,w=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var fi=Ci,yi=ri.exports;ei.exports=fi,ei.exports.murmur3=fi,ei.exports.murmur2=yi;var wn=_(ei.exports);class Ui{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,c,f,g){this.ids.push(Nr(n)),this.positions.push(c,f,g)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Nr(n);let f=0,g=this.ids.length-1;for(;f<g;){const k=f+g>>1;this.ids[k]>=c?g=k:f=k+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(n,c){const f=new Float64Array(n.ids),g=new Uint32Array(n.positions);return qn(f,g,0,f.length-1),c&&c.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(n){const c=new Ui;return c.ids=n.ids,c.positions=n.positions,c.indexed=!0,c}}function Nr(s){const n=+s;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:wn(String(s))}function qn(s,n,c,f){for(;c<f;){const g=s[c+f>>1];let w=c-1,k=f+1;for(;;){do w++;while(s[w]<g);do k--;while(s[k]>g);if(w>=k)break;dn(s,w,k),dn(n,3*w,3*k),dn(n,3*w+1,3*k+1),dn(n,3*w+2,3*k+2)}k-c<f-k?(qn(s,n,c,k),c=k+1):(qn(s,n,k+1,f),f=k)}}function dn(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}zt("FeaturePositionMap",Ui);class Zn{constructor(n,c){this.gl=n.gl,this.location=c}}class $r extends Zn{constructor(n,c){super(n,c),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class xo extends Zn{constructor(n,c){super(n,c),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Ko extends Zn{constructor(n,c){super(n,c),this.current=$i.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Pa=new Float32Array(16);function Jo(s){return[ci(255*s.r,255*s.g),ci(255*s.b,255*s.a)]}class ko{constructor(n,c,f){this.value=n,this.uniformNames=c.map(g=>`u_${g}`),this.type=f}setUniform(n,c,f){n.set(f.constantOr(this.value))}getBinding(n,c,f){return this.type==="color"?new Ko(n,c):new $r(n,c)}}class Fn{constructor(n,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=n.tlbr}setUniform(n,c,f,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&n.set(w)}getBinding(n,c,f){return f.substr(0,9)==="u_pattern"?new xo(n,c):new $r(n,c)}}class fn{constructor(n,c,f,g){this.expression=n,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,c,f,g,w){const k=this.paintVertexArray.length,T=this.expression.evaluate(new ln(0),c,{},g,[],w);this.paintVertexArray.resize(n),this._setPaintValue(k,n,T)}updatePaintArray(n,c,f,g){const w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(n,c,w)}_setPaintValue(n,c,f){if(this.type==="color"){const g=Jo(f);for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=n;g<c;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cn{constructor(n,c,f,g,w,k){this.expression=n,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new k}populatePaintArray(n,c,f,g,w){const k=this.expression.evaluate(new ln(this.zoom),c,{},g,[],w),T=this.expression.evaluate(new ln(this.zoom+1),c,{},g,[],w),I=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(I,n,k,T)}updatePaintArray(n,c,f,g){const w=this.expression.evaluate({zoom:this.zoom},f,g),k=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(n,c,w,k)}_setPaintValue(n,c,f,g){if(this.type==="color"){const w=Jo(f),k=Jo(g);for(let T=n;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],k[0],k[1])}else{for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=le(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(g)}getBinding(n,c,f){return new $r(n,c)}}class Jr{constructor(n,c,f,g,w,k){this.expression=n,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=k,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(n,c,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(g,n,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(n,c,f,g,w){this._setPaintValues(n,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(n,c,f,g){if(!g||!f)return;const{min:w,mid:k,max:T}=f,I=g[w],z=g[k],O=g[T];if(I&&z&&O)for(let U=n;U<c;U++)this.zoomInPaintVertexArray.emplace(U,z.tl[0],z.tl[1],z.br[0],z.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],z.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,z.tl[0],z.tl[1],z.br[0],z.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],z.pixelRatio,O.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,xt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,xt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class On{constructor(n,c,f){this.binders={},this._buffers=[];const g=[];for(const w in n.paint._values){if(!f(w))continue;const k=n.paint.get(w);if(!(k instanceof so&&Bs(k.property.specification)))continue;const T=Yr(w,n.type),I=k.value,z=k.property.specification.type,O=k.property.useIntegerZoom,U=k.property.specification["property-type"],H=U==="cross-faded"||U==="cross-faded-data-driven";if(I.kind==="constant")this.binders[w]=H?new Fn(I.value,T):new ko(I.value,T,z),g.push(`/u_${w}`);else if(I.kind==="source"||H){const Y=Nn(w,z,"source");this.binders[w]=H?new Jr(I,z,O,c,Y,n.id):new fn(I,T,z,Y),g.push(`/a_${w}`)}else{const Y=Nn(w,z,"composite");this.binders[w]=new cn(I,T,z,O,c,Y),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(n){const c=this.binders[n];return c instanceof fn||c instanceof cn?c.maxValue:0}populatePaintArrays(n,c,f,g,w){for(const k in this.binders){const T=this.binders[k];(T instanceof fn||T instanceof cn||T instanceof Jr)&&T.populatePaintArray(n,c,f,g,w)}}setConstantPatternPositions(n,c){for(const f in this.binders){const g=this.binders[f];g instanceof Fn&&g.setConstantPatternPositions(n,c)}}updatePaintArrays(n,c,f,g,w){let k=!1;for(const T in n){const I=c.getPositions(T);for(const z of I){const O=f.feature(z.index);for(const U in this.binders){const H=this.binders[U];if((H instanceof fn||H instanceof cn||H instanceof Jr)&&H.expression.isStateDependent===!0){const Y=g.paint.get(U);H.expression=Y.value,H.updatePaintArray(z.start,z.end,O,n[T],w),k=!0}}}}return k}defines(){const n=[];for(const c in this.binders){const f=this.binders[c];(f instanceof ko||f instanceof Fn)&&n.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof fn||f instanceof cn)for(let g=0;g<f.paintVertexAttributes.length;g++)n.push(f.paintVertexAttributes[g].name);else if(f instanceof Jr)for(let g=0;g<xt.members.length;g++)n.push(xt.members[g].name)}return n}getBinderUniforms(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ko||f instanceof Fn||f instanceof cn)for(const g of f.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,c){const f=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof ko||w instanceof Fn||w instanceof cn){for(const k of w.uniformNames)if(c[k]){const T=w.getBinding(n,c[k],k);f.push({name:k,property:g,binding:T})}}}return f}setUniforms(n,c,f,g){for(const{name:w,property:k,binding:T}of c)this.binders[k].setUniform(T,g,f.get(k),w)}updatePaintBuffers(n){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(n&&f instanceof Jr){const g=n.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof fn||f instanceof cn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(n){for(const c in this.binders){const f=this.binders[c];(f instanceof fn||f instanceof cn||f instanceof Jr)&&f.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const c=this.binders[n];(c instanceof fn||c instanceof cn||c instanceof Jr)&&c.destroy()}}}class pn{constructor(n,c,f=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new On(g,c,f);this.needsUpload=!1,this._featureMap=new Ui,this._bufferOffset=0}populatePaintArrays(n,c,f,g,w,k){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,c,g,w,k);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,c,f,g){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,c,w,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Yr(s,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${n}-`,"").replace(/-/g,"_")]}function Nn(s,n,c){const f={color:{source:Ia,composite:Ll},number:{source:El,composite:Ia}},g=function(w){return{"line-pattern":{source:Ie,composite:Ie},"fill-pattern":{source:Ie,composite:Ie},"fill-extrusion-pattern":{source:Ie,composite:Ie}}[w]}(s);return g&&g[c]||f[n][c]}zt("ConstantBinder",ko),zt("CrossFadedConstantBinder",Fn),zt("SourceExpressionBinder",fn),zt("CrossFadedCompositeBinder",Jr),zt("CompositeExpressionBinder",cn),zt("ProgramConfiguration",On,{omit:["_buffers"]}),zt("ProgramConfigurationSet",pn);const Sn=8192,Vc=Math.pow(2,14)-1,Dh=-Vc-1;function ps(s){const n=Sn/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const g=c[f];for(let w=0;w<g.length;w++){const k=g[w],T=Math.round(k.x*n),I=Math.round(k.y*n);k.x=le(T,Dh,Vc),k.y=le(I,Dh,Vc),(T<k.x||T>k.x+1||I<k.y||I>k.y+1)&&st("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function ms(s,n){return{type:s.type,id:s.id,properties:s.properties,geometry:n?ps(s):[]}}function Al(s,n,c,f,g){s.emplaceBack(2*n+(f+1)/2,2*c+(g+1)/2)}class Yo{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.indexArray=new Xe,this.segments=new vt,this.programConfigurations=new pn(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){const g=this.layers[0],w=[];let k=null,T=!1;g.type==="circle"&&(k=g.layout.get("circle-sort-key"),T=!k.isConstant());for(const{feature:I,id:z,index:O,sourceLayerIndex:U}of n){const H=this.layers[0]._featureFilter.needGeometry,Y=ms(I,H);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),Y,f))continue;const ee=T?k.evaluate(Y,{},f):void 0,he={id:z,properties:I.properties,type:I.type,sourceLayerIndex:U,index:O,geometry:H?Y.geometry:ps(I),patterns:{},sortKey:ee};w.push(he)}T&&w.sort((I,z)=>I.sortKey-z.sortKey);for(const I of w){const{geometry:z,index:O,sourceLayerIndex:U}=I,H=n[O].feature;this.addFeature(I,z,O,f),c.featureIndex.insert(H,z,O,U,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,gt),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,c,f,g){for(const w of c)for(const k of w){const T=k.x,I=k.y;if(T<0||T>=Sn||I<0||I>=Sn)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),O=z.vertexLength;Al(this.layoutVertexArray,T,I,-1,-1),Al(this.layoutVertexArray,T,I,1,-1),Al(this.layoutVertexArray,T,I,1,1),Al(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,{},g)}}function qc(s,n){for(let c=0;c<s.length;c++)if(zl(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(zl(s,n[c]))return!0;return!!Pl(s,n)}function Rh(s,n,c){return!!zl(s,n)||!!of(n,s,c)}function Zc(s,n){if(s.length===1)return Jp(n,s[0]);for(let c=0;c<n.length;c++){const f=n[c];for(let g=0;g<f.length;g++)if(zl(s,f[g]))return!0}for(let c=0;c<s.length;c++)if(Jp(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(Pl(s,n[c]))return!0;return!1}function Gc(s,n,c){if(s.length>1){if(Pl(s,n))return!0;for(let f=0;f<n.length;f++)if(of(n[f],s,c))return!0}for(let f=0;f<s.length;f++)if(of(s[f],n,c))return!0;return!1}function Pl(s,n){if(s.length===0||n.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],g=s[c+1];for(let w=0;w<n.length-1;w++)if(Wc(f,g,n[w],n[w+1]))return!0}return!1}function Wc(s,n,c,f){return ze(s,c,f)!==ze(n,c,f)&&ze(s,n,c)!==ze(s,n,f)}function of(s,n,c){const f=c*c;if(n.length===1)return s.distSqr(n[0])<f;for(let g=1;g<n.length;g++)if(Kp(s,n[g-1],n[g])<f)return!0;return!1}function Kp(s,n,c){const f=n.distSqr(c);if(f===0)return s.distSqr(n);const g=((s.x-n.x)*(c.x-n.x)+(s.y-n.y)*(c.y-n.y))/f;return s.distSqr(g<0?n:g>1?c:c.sub(n)._mult(g)._add(n))}function Jp(s,n){let c,f,g,w=!1;for(let k=0;k<s.length;k++){c=s[k];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],g=c[I],f.y>n.y!=g.y>n.y&&n.x<(g.x-f.x)*(n.y-f.y)/(g.y-f.y)+f.x&&(w=!w)}return w}function zl(s,n){let c=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const w=s[f],k=s[g];w.y>n.y!=k.y>n.y&&n.x<(k.x-w.x)*(n.y-w.y)/(k.y-w.y)+w.x&&(c=!c)}return c}function g1(s,n,c){const f=c[0],g=c[2];if(s.x<f.x&&n.x<f.x||s.x>g.x&&n.x>g.x||s.y<f.y&&n.y<f.y||s.y>g.y&&n.y>g.y)return!1;const w=ze(s,n,c[0]);return w!==ze(s,n,c[1])||w!==ze(s,n,c[2])||w!==ze(s,n,c[3])}function Hc(s,n,c){const f=n.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(n.id).getMaxValue(s)}function Bh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Fh(s,n,c,f,g){if(!n[0]&&!n[1])return s;const w=S.convert(n)._mult(g);c==="viewport"&&w._rotate(-f);const k=[];for(let T=0;T<s.length;T++)k.push(s[T].sub(w));return k}let Yp,Qp;zt("CircleBucket",Yo,{omit:["layers"]});var _1={get paint(){return Qp=Qp||new Cr({"circle-radius":new Kt(we.paint_circle["circle-radius"]),"circle-color":new Kt(we.paint_circle["circle-color"]),"circle-blur":new Kt(we.paint_circle["circle-blur"]),"circle-opacity":new Kt(we.paint_circle["circle-opacity"]),"circle-translate":new Zt(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Zt(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Zt(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Zt(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(we.paint_circle["circle-stroke-opacity"])})},get layout(){return Yp=Yp||new Cr({"circle-sort-key":new Kt(we.layout_circle["circle-sort-key"])})}},Mr=1e-6,Dl=typeof Float32Array<"u"?Float32Array:Array;function sf(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function em(s,n,c){var f=n[0],g=n[1],w=n[2],k=n[3],T=n[4],I=n[5],z=n[6],O=n[7],U=n[8],H=n[9],Y=n[10],ee=n[11],he=n[12],ge=n[13],xe=n[14],Oe=n[15],Ee=c[0],De=c[1],Ye=c[2],et=c[3];return s[0]=Ee*f+De*T+Ye*U+et*he,s[1]=Ee*g+De*I+Ye*H+et*ge,s[2]=Ee*w+De*z+Ye*Y+et*xe,s[3]=Ee*k+De*O+Ye*ee+et*Oe,s[4]=(Ee=c[4])*f+(De=c[5])*T+(Ye=c[6])*U+(et=c[7])*he,s[5]=Ee*g+De*I+Ye*H+et*ge,s[6]=Ee*w+De*z+Ye*Y+et*xe,s[7]=Ee*k+De*O+Ye*ee+et*Oe,s[8]=(Ee=c[8])*f+(De=c[9])*T+(Ye=c[10])*U+(et=c[11])*he,s[9]=Ee*g+De*I+Ye*H+et*ge,s[10]=Ee*w+De*z+Ye*Y+et*xe,s[11]=Ee*k+De*O+Ye*ee+et*Oe,s[12]=(Ee=c[12])*f+(De=c[13])*T+(Ye=c[14])*U+(et=c[15])*he,s[13]=Ee*g+De*I+Ye*H+et*ge,s[14]=Ee*w+De*z+Ye*Y+et*xe,s[15]=Ee*k+De*O+Ye*ee+et*Oe,s}Math.hypot||(Math.hypot=function(){for(var s=0,n=arguments.length;n--;)s+=arguments[n]*arguments[n];return Math.sqrt(s)});var Xc,y1=em;function Oh(s,n,c){var f=n[0],g=n[1],w=n[2],k=n[3];return s[0]=c[0]*f+c[4]*g+c[8]*w+c[12]*k,s[1]=c[1]*f+c[5]*g+c[9]*w+c[13]*k,s[2]=c[2]*f+c[6]*g+c[10]*w+c[14]*k,s[3]=c[3]*f+c[7]*g+c[11]*w+c[15]*k,s}Xc=new Dl(4),Dl!=Float32Array&&(Xc[0]=0,Xc[1]=0,Xc[2]=0,Xc[3]=0);class v1 extends ao{constructor(n){super(n,_1)}createBucket(n){return new Yo(n)}queryRadius(n){const c=n;return Hc("circle-radius",this,c)+Hc("circle-stroke-width",this,c)+Bh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,c,f,g,w,k,T,I){const z=Fh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,T),O=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),U=this.paint.get("circle-pitch-alignment")==="map",H=U?z:function(ee,he){return ee.map(ge=>tm(ge,he))}(z,I),Y=U?O*T:O;for(const ee of g)for(const he of ee){const ge=U?he:tm(he,I);let xe=Y;const Oe=Oh([],[he.x,he.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Oe[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=k.cameraToCenterDistance/Oe[3]),Rh(H,ge,xe))return!0}return!1}}function tm(s,n){const c=Oh([],[s.x,s.y,0,1],n);return new S(c[0]/c[3],c[1]/c[3])}class im extends Yo{}let nm;zt("HeatmapBucket",im,{omit:["layers"]});var b1={get paint(){return nm=nm||new Cr({"heatmap-radius":new Kt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Zt(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Zt(we.paint_heatmap["heatmap-opacity"])})}};function af(s,{width:n,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*c*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${n*c*f}`)}else g=new Uint8Array(n*c*f);return s.width=n,s.height=c,s.data=g,s}function rm(s,{width:n,height:c},f){if(n===s.width&&c===s.height)return;const g=af({},{width:n,height:c},f);lf(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,n),height:Math.min(s.height,c)},f),s.width=n,s.height=c,s.data=g.data}function lf(s,n,c,f,g,w){if(g.width===0||g.height===0)return n;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||f.x>n.width-g.width||f.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const k=s.data,T=n.data;if(k===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const z=((c.y+I)*s.width+c.x)*w,O=((f.y+I)*n.width+f.x)*w;for(let U=0;U<g.width*w;U++)T[O+U]=k[z+U]}return n}class Kc{constructor(n,c){af(this,n,1,c)}resize(n){rm(this,n,1)}clone(){return new Kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,g,w){lf(n,c,f,g,w,1)}}class lo{constructor(n,c){af(this,n,4,c)}resize(n){rm(this,n,4)}replace(n,c){c?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,g,w){lf(n,c,f,g,w,4)}}function om(s){const n={},c=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new lo({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(k,T,I)=>{n[s.evaluationKey]=I;const z=s.expression.evaluate(n);g.data[k+T+0]=Math.floor(255*z.r/z.a),g.data[k+T+1]=Math.floor(255*z.g/z.a),g.data[k+T+2]=Math.floor(255*z.b/z.a),g.data[k+T+3]=Math.floor(255*z.a)};if(s.clips)for(let k=0,T=0;k<f;++k,T+=4*c)for(let I=0,z=0;I<c;I++,z+=4){const O=I/(c-1),{start:U,end:H}=s.clips[k];w(T,z,U*(1-O)+H*O)}else for(let k=0,T=0;k<c;k++,T+=4)w(0,T,k/(c-1));return g}zt("AlphaImage",Kc),zt("RGBAImage",lo);class w1 extends ao{createBucket(n){return new im(n)}constructor(n){super(n,b1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=om({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let sm;var x1={get paint(){return sm=sm||new Cr({"hillshade-illumination-direction":new Zt(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Zt(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Zt(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Zt(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Zt(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Zt(we.paint_hillshade["hillshade-accent-color"])})}};class k1 extends ao{constructor(n){super(n,x1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const S1=An([{name:"a_pos",components:2,type:"Int16"}],4),{members:T1}=S1;var cf={exports:{}};function Nh(s,n,c){c=c||2;var f,g,w,k,T,I,z,O=n&&n.length,U=O?n[0]*c:s.length,H=am(s,0,U,c,!0),Y=[];if(!H||H.next===H.prev)return Y;if(O&&(H=function(he,ge,xe,Oe){var Ee,De,Ye,et=[];for(Ee=0,De=ge.length;Ee<De;Ee++)(Ye=am(he,ge[Ee]*Oe,Ee<De-1?ge[Ee+1]*Oe:he.length,Oe,!1))===Ye.next&&(Ye.steiner=!0),et.push(z1(Ye));for(et.sort(L1),Ee=0;Ee<et.length;Ee++)xe=A1(et[Ee],xe);return xe}(s,n,H,c)),s.length>80*c){f=w=s[0],g=k=s[1];for(var ee=c;ee<U;ee+=c)(T=s[ee])<f&&(f=T),(I=s[ee+1])<g&&(g=I),T>w&&(w=T),I>k&&(k=I);z=(z=Math.max(w-f,k-g))!==0?32767/z:0}return Jc(H,Y,c,f,g,z,0),Y}function am(s,n,c,f,g){var w,k;if(g===df(s,n,c,f)>0)for(w=n;w<c;w+=f)k=um(w,s[w],s[w+1],k);else for(w=c-f;w>=n;w-=f)k=um(w,s[w],s[w+1],k);return k&&$h(k,k.next)&&(Qc(k),k=k.next),k}function za(s,n){if(!s)return s;n||(n=s);var c,f=s;do if(c=!1,f.steiner||!$h(f,f.next)&&Pn(f.prev,f,f.next)!==0)f=f.next;else{if(Qc(f),(f=n=f.prev)===f.next)break;c=!0}while(c||f!==n);return n}function Jc(s,n,c,f,g,w,k){if(s){!k&&w&&function(O,U,H,Y){var ee=O;do ee.z===0&&(ee.z=uf(ee.x,ee.y,U,H,Y)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==O);ee.prevZ.nextZ=null,ee.prevZ=null,function(he){var ge,xe,Oe,Ee,De,Ye,et,Lt,$t=1;do{for(xe=he,he=null,De=null,Ye=0;xe;){for(Ye++,Oe=xe,et=0,ge=0;ge<$t&&(et++,Oe=Oe.nextZ);ge++);for(Lt=$t;et>0||Lt>0&&Oe;)et!==0&&(Lt===0||!Oe||xe.z<=Oe.z)?(Ee=xe,xe=xe.nextZ,et--):(Ee=Oe,Oe=Oe.nextZ,Lt--),De?De.nextZ=Ee:he=Ee,Ee.prevZ=De,De=Ee;xe=Oe}De.nextZ=null,$t*=2}while(Ye>1)}(ee)}(s,f,g,w);for(var T,I,z=s;s.prev!==s.next;)if(T=s.prev,I=s.next,w?M1(s,f,g,w):C1(s))n.push(T.i/c|0),n.push(s.i/c|0),n.push(I.i/c|0),Qc(s),s=I.next,z=I.next;else if((s=I)===z){k?k===1?Jc(s=E1(za(s),n,c),n,c,f,g,w,2):k===2&&I1(s,n,c,f,g,w):Jc(za(s),n,c,f,g,w,1);break}}}function C1(s){var n=s.prev,c=s,f=s.next;if(Pn(n,c,f)>=0)return!1;for(var g=n.x,w=c.x,k=f.x,T=n.y,I=c.y,z=f.y,O=g<w?g<k?g:k:w<k?w:k,U=T<I?T<z?T:z:I<z?I:z,H=g>w?g>k?g:k:w>k?w:k,Y=T>I?T>z?T:z:I>z?I:z,ee=f.next;ee!==n;){if(ee.x>=O&&ee.x<=H&&ee.y>=U&&ee.y<=Y&&Rl(g,T,w,I,k,z,ee.x,ee.y)&&Pn(ee.prev,ee,ee.next)>=0)return!1;ee=ee.next}return!0}function M1(s,n,c,f){var g=s.prev,w=s,k=s.next;if(Pn(g,w,k)>=0)return!1;for(var T=g.x,I=w.x,z=k.x,O=g.y,U=w.y,H=k.y,Y=T<I?T<z?T:z:I<z?I:z,ee=O<U?O<H?O:H:U<H?U:H,he=T>I?T>z?T:z:I>z?I:z,ge=O>U?O>H?O:H:U>H?U:H,xe=uf(Y,ee,n,c,f),Oe=uf(he,ge,n,c,f),Ee=s.prevZ,De=s.nextZ;Ee&&Ee.z>=xe&&De&&De.z<=Oe;){if(Ee.x>=Y&&Ee.x<=he&&Ee.y>=ee&&Ee.y<=ge&&Ee!==g&&Ee!==k&&Rl(T,O,I,U,z,H,Ee.x,Ee.y)&&Pn(Ee.prev,Ee,Ee.next)>=0||(Ee=Ee.prevZ,De.x>=Y&&De.x<=he&&De.y>=ee&&De.y<=ge&&De!==g&&De!==k&&Rl(T,O,I,U,z,H,De.x,De.y)&&Pn(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;Ee&&Ee.z>=xe;){if(Ee.x>=Y&&Ee.x<=he&&Ee.y>=ee&&Ee.y<=ge&&Ee!==g&&Ee!==k&&Rl(T,O,I,U,z,H,Ee.x,Ee.y)&&Pn(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.prevZ}for(;De&&De.z<=Oe;){if(De.x>=Y&&De.x<=he&&De.y>=ee&&De.y<=ge&&De!==g&&De!==k&&Rl(T,O,I,U,z,H,De.x,De.y)&&Pn(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function E1(s,n,c){var f=s;do{var g=f.prev,w=f.next.next;!$h(g,w)&&lm(g,f,f.next,w)&&Yc(g,w)&&Yc(w,g)&&(n.push(g.i/c|0),n.push(f.i/c|0),n.push(w.i/c|0),Qc(f),Qc(f.next),f=s=w),f=f.next}while(f!==s);return za(f)}function I1(s,n,c,f,g,w){var k=s;do{for(var T=k.next.next;T!==k.prev;){if(k.i!==T.i&&D1(k,T)){var I=cm(k,T);return k=za(k,k.next),I=za(I,I.next),Jc(k,n,c,f,g,w,0),void Jc(I,n,c,f,g,w,0)}T=T.next}k=k.next}while(k!==s)}function L1(s,n){return s.x-n.x}function A1(s,n){var c=function(g,w){var k,T=w,I=g.x,z=g.y,O=-1/0;do{if(z<=T.y&&z>=T.next.y&&T.next.y!==T.y){var U=T.x+(z-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(U<=I&&U>O&&(O=U,k=T.x<T.next.x?T:T.next,U===I))return k}T=T.next}while(T!==w);if(!k)return null;var H,Y=k,ee=k.x,he=k.y,ge=1/0;T=k;do I>=T.x&&T.x>=ee&&I!==T.x&&Rl(z<he?I:O,z,ee,he,z<he?O:I,z,T.x,T.y)&&(H=Math.abs(z-T.y)/(I-T.x),Yc(T,g)&&(H<ge||H===ge&&(T.x>k.x||T.x===k.x&&P1(k,T)))&&(k=T,ge=H)),T=T.next;while(T!==Y);return k}(s,n);if(!c)return n;var f=cm(c,s);return za(f,f.next),za(c,c.next)}function P1(s,n){return Pn(s.prev,s,n.prev)<0&&Pn(n.next,s,s.next)<0}function uf(s,n,c,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-f)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function z1(s){var n=s,c=s;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==s);return c}function Rl(s,n,c,f,g,w,k,T){return(g-k)*(n-T)>=(s-k)*(w-T)&&(s-k)*(f-T)>=(c-k)*(n-T)&&(c-k)*(w-T)>=(g-k)*(f-T)}function D1(s,n){return s.next.i!==n.i&&s.prev.i!==n.i&&!function(c,f){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&lm(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(s,n)&&(Yc(s,n)&&Yc(n,s)&&function(c,f){var g=c,w=!1,k=(c.x+f.x)/2,T=(c.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&k<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==c);return w}(s,n)&&(Pn(s.prev,s,n.prev)||Pn(s,n.prev,n))||$h(s,n)&&Pn(s.prev,s,s.next)>0&&Pn(n.prev,n,n.next)>0)}function Pn(s,n,c){return(n.y-s.y)*(c.x-n.x)-(n.x-s.x)*(c.y-n.y)}function $h(s,n){return s.x===n.x&&s.y===n.y}function lm(s,n,c,f){var g=Uh(Pn(s,n,c)),w=Uh(Pn(s,n,f)),k=Uh(Pn(c,f,s)),T=Uh(Pn(c,f,n));return g!==w&&k!==T||!(g!==0||!jh(s,c,n))||!(w!==0||!jh(s,f,n))||!(k!==0||!jh(c,s,f))||!(T!==0||!jh(c,n,f))}function jh(s,n,c){return n.x<=Math.max(s.x,c.x)&&n.x>=Math.min(s.x,c.x)&&n.y<=Math.max(s.y,c.y)&&n.y>=Math.min(s.y,c.y)}function Uh(s){return s>0?1:s<0?-1:0}function Yc(s,n){return Pn(s.prev,s,s.next)<0?Pn(s,n,s.next)>=0&&Pn(s,s.prev,n)>=0:Pn(s,n,s.prev)<0||Pn(s,s.next,n)<0}function cm(s,n){var c=new hf(s.i,s.x,s.y),f=new hf(n.i,n.x,n.y),g=s.next,w=n.prev;return s.next=n,n.prev=s,c.next=g,g.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function um(s,n,c,f){var g=new hf(s,n,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Qc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function hf(s,n,c){this.i=s,this.x=n,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function df(s,n,c,f){for(var g=0,w=n,k=c-f;w<c;w+=f)g+=(s[k]-s[w])*(s[w+1]+s[k+1]),k=w;return g}cf.exports=Nh,cf.exports.default=Nh,Nh.deviation=function(s,n,c,f){var g=n&&n.length,w=Math.abs(df(s,0,g?n[0]*c:s.length,c));if(g)for(var k=0,T=n.length;k<T;k++)w-=Math.abs(df(s,n[k]*c,k<T-1?n[k+1]*c:s.length,c));var I=0;for(k=0;k<f.length;k+=3){var z=f[k]*c,O=f[k+1]*c,U=f[k+2]*c;I+=Math.abs((s[z]-s[U])*(s[O+1]-s[z+1])-(s[z]-s[O])*(s[U+1]-s[z+1]))}return w===0&&I===0?0:Math.abs((I-w)/w)},Nh.flatten=function(s){for(var n=s[0][0].length,c={vertices:[],holes:[],dimensions:n},f=0,g=0;g<s.length;g++){for(var w=0;w<s[g].length;w++)for(var k=0;k<n;k++)c.vertices.push(s[g][w][k]);g>0&&c.holes.push(f+=s[g-1].length)}return c};var hm=_(cf.exports);function R1(s,n,c,f,g){dm(s,n,c||0,f||s.length-1,g||B1)}function dm(s,n,c,f,g){for(;f>c;){if(f-c>600){var w=f-c+1,k=n-c+1,T=Math.log(w),I=.5*Math.exp(2*T/3),z=.5*Math.sqrt(T*I*(w-I)/w)*(k-w/2<0?-1:1);dm(s,n,Math.max(c,Math.floor(n-k*I/w+z)),Math.min(f,Math.floor(n+(w-k)*I/w+z)),g)}var O=s[n],U=c,H=f;for(eu(s,c,n),g(s[f],O)>0&&eu(s,c,f);U<H;){for(eu(s,U,H),U++,H--;g(s[U],O)<0;)U++;for(;g(s[H],O)>0;)H--}g(s[c],O)===0?eu(s,c,H):eu(s,++H,f),H<=n&&(c=H+1),n<=H&&(f=H-1)}}function eu(s,n,c){var f=s[n];s[n]=s[c],s[c]=f}function B1(s,n){return s<n?-1:s>n?1:0}function ff(s,n){const c=s.length;if(c<=1)return[s];const f=[];let g,w;for(let k=0;k<c;k++){const T=Qe(s[k]);T!==0&&(s[k].area=Math.abs(T),w===void 0&&(w=T<0),w===T<0?(g&&f.push(g),g=[s[k]]):g.push(s[k]))}if(g&&f.push(g),n>1)for(let k=0;k<f.length;k++)f[k].length<=n||(R1(f[k],n,1,f[k].length-1,F1),f[k]=f[k].slice(0,n));return f}function F1(s,n){return n.area-s.area}function pf(s,n,c){const f=c.patternDependencies;let g=!1;for(const w of n){const k=w.paint.get(`${s}-pattern`);k.isConstant()||(g=!0);const T=k.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function mf(s,n,c,f,g){const w=g.patternDependencies;for(const k of n){const T=k.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},c,{},g.availableImages),z=T.evaluate({zoom:f},c,{},g.availableImages),O=T.evaluate({zoom:f+1},c,{},g.availableImages);I=I&&I.name?I.name:I,z=z&&z.name?z.name:z,O=O&&O.name?O.name:O,w[I]=!0,w[z]=!0,w[O]=!0,c.patterns[k.id]={min:I,mid:z,max:O}}}return c}class gf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new Xe,this.indexArray2=new ot,this.programConfigurations=new pn(n.layers,n.zoom),this.segments=new vt,this.segments2=new vt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=pf("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),k=[];for(const{feature:T,id:I,index:z,sourceLayerIndex:O}of n){const U=this.layers[0]._featureFilter.needGeometry,H=ms(T,U);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),H,f))continue;const Y=w?g.evaluate(H,{},f,c.availableImages):void 0,ee={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:z,geometry:U?H.geometry:ps(T),patterns:{},sortKey:Y};k.push(ee)}w&&k.sort((T,I)=>T.sortKey-I.sortKey);for(const T of k){const{geometry:I,index:z,sourceLayerIndex:O}=T;if(this.hasPattern){const U=mf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(U)}else this.addFeature(T,I,z,f,{});c.featureIndex.insert(n[z].feature,I,z,O,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,T1),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,c,f,g,w){for(const k of ff(c,500)){let T=0;for(const Y of k)T+=Y.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),z=I.vertexLength,O=[],U=[];for(const Y of k){if(Y.length===0)continue;Y!==k[0]&&U.push(O.length/2);const ee=this.segments2.prepareSegment(Y.length,this.layoutVertexArray,this.indexArray2),he=ee.vertexLength;this.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),this.indexArray2.emplaceBack(he+Y.length-1,he),O.push(Y[0].x),O.push(Y[0].y);for(let ge=1;ge<Y.length;ge++)this.layoutVertexArray.emplaceBack(Y[ge].x,Y[ge].y),this.indexArray2.emplaceBack(he+ge-1,he+ge),O.push(Y[ge].x),O.push(Y[ge].y);ee.vertexLength+=Y.length,ee.primitiveLength+=Y.length}const H=hm(O,U);for(let Y=0;Y<H.length;Y+=3)this.indexArray.emplaceBack(z+H[Y],z+H[Y+1],z+H[Y+2]);I.vertexLength+=T,I.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}}let fm,pm;zt("FillBucket",gf,{omit:["layers","patternFeatures"]});var O1={get paint(){return pm=pm||new Cr({"fill-antialias":new Zt(we.paint_fill["fill-antialias"]),"fill-opacity":new Kt(we.paint_fill["fill-opacity"]),"fill-color":new Kt(we.paint_fill["fill-color"]),"fill-outline-color":new Kt(we.paint_fill["fill-outline-color"]),"fill-translate":new Zt(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Zt(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new kl(we.paint_fill["fill-pattern"])})},get layout(){return fm=fm||new Cr({"fill-sort-key":new Kt(we.layout_fill["fill-sort-key"])})}};class N1 extends ao{constructor(n){super(n,O1)}recalculate(n,c){super.recalculate(n,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new gf(n)}queryRadius(){return Bh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,c,f,g,w,k,T){return Zc(Fh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,T),g)}isTileClipped(){return!0}}const $1=An([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),j1=An([{name:"a_centroid",components:2,type:"Int16"}],4),{members:U1}=$1;var qs={},V1=y,mm=Bl;function Bl(s,n,c,f,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(q1,this,n)}function q1(s,n,c){s==1?n.id=c.readVarint():s==2?function(f,g){for(var w=f.readVarint()+f.pos;f.pos<w;){var k=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[k]=T}}(c,n):s==3?n.type=c.readVarint():s==4&&(n._geometry=c.pos)}function Z1(s){for(var n,c,f=0,g=0,w=s.length,k=w-1;g<w;k=g++)f+=((c=s[k]).x-(n=s[g]).x)*(n.y+c.y);return f}Bl.types=["Unknown","Point","LineString","Polygon"],Bl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var n,c=s.readVarint()+s.pos,f=1,g=0,w=0,k=0,T=[];s.pos<c;){if(g<=0){var I=s.readVarint();f=7&I,g=I>>3}if(g--,f===1||f===2)w+=s.readSVarint(),k+=s.readSVarint(),f===1&&(n&&T.push(n),n=[]),n.push(new V1(w,k));else{if(f!==7)throw new Error("unknown command "+f);n&&n.push(n[0].clone())}}return n&&T.push(n),T},Bl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var n=s.readVarint()+s.pos,c=1,f=0,g=0,w=0,k=1/0,T=-1/0,I=1/0,z=-1/0;s.pos<n;){if(f<=0){var O=s.readVarint();c=7&O,f=O>>3}if(f--,c===1||c===2)(g+=s.readSVarint())<k&&(k=g),g>T&&(T=g),(w+=s.readSVarint())<I&&(I=w),w>z&&(z=w);else if(c!==7)throw new Error("unknown command "+c)}return[k,I,T,z]},Bl.prototype.toGeoJSON=function(s,n,c){var f,g,w=this.extent*Math.pow(2,c),k=this.extent*s,T=this.extent*n,I=this.loadGeometry(),z=Bl.types[this.type];function O(Y){for(var ee=0;ee<Y.length;ee++){var he=Y[ee];Y[ee]=[360*(he.x+k)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(f=0;f<I.length;f++)U[f]=I[f][0];O(I=U);break;case 2:for(f=0;f<I.length;f++)O(I[f]);break;case 3:for(I=function(Y){var ee=Y.length;if(ee<=1)return[Y];for(var he,ge,xe=[],Oe=0;Oe<ee;Oe++){var Ee=Z1(Y[Oe]);Ee!==0&&(ge===void 0&&(ge=Ee<0),ge===Ee<0?(he&&xe.push(he),he=[Y[Oe]]):he.push(Y[Oe]))}return he&&xe.push(he),xe}(I),f=0;f<I.length;f++)for(g=0;g<I[f].length;g++)O(I[f][g])}I.length===1?I=I[0]:z="Multi"+z;var H={type:"Feature",geometry:{type:z,coordinates:I},properties:this.properties};return"id"in this&&(H.id=this.id),H};var G1=mm,gm=_m;function _m(s,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(W1,this,n),this.length=this._features.length}function W1(s,n,c){s===15?n.version=c.readVarint():s===1?n.name=c.readString():s===5?n.extent=c.readVarint():s===2?n._features.push(c.pos):s===3?n._keys.push(c.readString()):s===4&&n._values.push(function(f){for(var g=null,w=f.readVarint()+f.pos;f.pos<w;){var k=f.readVarint()>>3;g=k===1?f.readString():k===2?f.readFloat():k===3?f.readDouble():k===4?f.readVarint64():k===5?f.readVarint():k===6?f.readSVarint():k===7?f.readBoolean():null}return g}(c))}_m.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var n=this._pbf.readVarint()+this._pbf.pos;return new G1(this._pbf,n,this.extent,this._keys,this._values)};var H1=gm;function X1(s,n,c){if(s===3){var f=new H1(c,c.readVarint()+c.pos);f.length&&(n[f.name]=f)}}qs.VectorTile=function(s,n){this.layers=s.readFields(X1,{},n)},qs.VectorTileFeature=mm,qs.VectorTileLayer=gm;const K1=qs.VectorTileFeature.types,_f=Math.pow(2,13);function tu(s,n,c,f,g,w,k,T){s.emplaceBack(n,c,2*Math.floor(f*_f)+k,g*_f*2,w*_f*2,Math.round(T))}class yf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new q,this.indexArray=new Xe,this.programConfigurations=new pn(n.layers,n.zoom),this.segments=new vt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.features=[],this.hasPattern=pf("fill-extrusion",this.layers,c);for(const{feature:g,id:w,index:k,sourceLayerIndex:T}of n){const I=this.layers[0]._featureFilter.needGeometry,z=ms(g,I);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),z,f))continue;const O={id:w,sourceLayerIndex:T,index:k,geometry:I?z.geometry:ps(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(mf("fill-extrusion",this.layers,O,this.zoom,c)):this.addFeature(O,O.geometry,k,f,{}),c.featureIndex.insert(g,O.geometry,k,T,this.index,!0)}}addFeatures(n,c,f){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,c,f)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,U1),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,j1.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,c,f,g,w){const k={x:0,y:0,vertexCount:0};for(const T of ff(c,500)){let I=0;for(const ee of T)I+=ee.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ee of T){if(ee.length===0||Y1(ee))continue;let he=0;for(let ge=0;ge<ee.length;ge++){const xe=ee[ge];if(ge>=1){const Oe=ee[ge-1];if(!J1(xe,Oe)){z.vertexLength+4>vt.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ee=xe.sub(Oe)._perp()._unit(),De=Oe.dist(xe);he+De>32768&&(he=0),tu(this.layoutVertexArray,xe.x,xe.y,Ee.x,Ee.y,0,0,he),tu(this.layoutVertexArray,xe.x,xe.y,Ee.x,Ee.y,0,1,he),k.x+=2*xe.x,k.y+=2*xe.y,k.vertexCount+=2,he+=De,tu(this.layoutVertexArray,Oe.x,Oe.y,Ee.x,Ee.y,0,0,he),tu(this.layoutVertexArray,Oe.x,Oe.y,Ee.x,Ee.y,0,1,he),k.x+=2*Oe.x,k.y+=2*Oe.y,k.vertexCount+=2;const Ye=z.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+I>vt.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),K1[n.type]!=="Polygon")continue;const O=[],U=[],H=z.vertexLength;for(const ee of T)if(ee.length!==0){ee!==T[0]&&U.push(O.length/2);for(let he=0;he<ee.length;he++){const ge=ee[he];tu(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),k.x+=ge.x,k.y+=ge.y,k.vertexCount+=1,O.push(ge.x),O.push(ge.y)}}const Y=hm(O,U);for(let ee=0;ee<Y.length;ee+=3)this.indexArray.emplaceBack(H+Y[ee],H+Y[ee+2],H+Y[ee+1]);z.primitiveLength+=Y.length/3,z.vertexLength+=I}for(let T=0;T<k.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(k.x/k.vertexCount),Math.floor(k.y/k.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}}function J1(s,n){return s.x===n.x&&(s.x<0||s.x>Sn)||s.y===n.y&&(s.y<0||s.y>Sn)}function Y1(s){return s.every(n=>n.x<0)||s.every(n=>n.x>Sn)||s.every(n=>n.y<0)||s.every(n=>n.y>Sn)}let ym;zt("FillExtrusionBucket",yf,{omit:["layers","features"]});var Q1={get paint(){return ym=ym||new Cr({"fill-extrusion-opacity":new Zt(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Zt(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Zt(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Zt(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ev extends ao{constructor(n){super(n,Q1)}createBucket(n){return new yf(n)}queryRadius(){return Bh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,c,f,g,w,k,T,I){const z=Fh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(c,f),U=this.paint.get("fill-extrusion-base").evaluate(c,f),H=function(ee,he,ge,xe){const Oe=[];for(const Ee of ee){const De=[Ee.x,Ee.y,0,1];Oh(De,De,he),Oe.push(new S(De[0]/De[3],De[1]/De[3]))}return Oe}(z,I),Y=function(ee,he,ge,xe){const Oe=[],Ee=[],De=xe[8]*he,Ye=xe[9]*he,et=xe[10]*he,Lt=xe[11]*he,$t=xe[8]*ge,It=xe[9]*ge,Tt=xe[10]*ge,_t=xe[11]*ge;for(const Bt of ee){const kt=[],ut=[];for(const Xt of Bt){const qt=Xt.x,vi=Xt.y,on=xe[0]*qt+xe[4]*vi+xe[12],un=xe[1]*qt+xe[5]*vi+xe[13],Wn=xe[2]*qt+xe[6]*vi+xe[14],Qr=xe[3]*qt+xe[7]*vi+xe[15],Er=Wn+et,$n=Qr+Lt,ir=on+$t,cr=un+It,Ir=Wn+Tt,Lr=Qr+_t,Hn=new S((on+De)/$n,(un+Ye)/$n);Hn.z=Er/$n,kt.push(Hn);const Xn=new S(ir/Lr,cr/Lr);Xn.z=Ir/Lr,ut.push(Xn)}Oe.push(kt),Ee.push(ut)}return[Oe,Ee]}(g,U,O,I);return function(ee,he,ge){let xe=1/0;Zc(ge,he)&&(xe=vm(ge,he[0]));for(let Oe=0;Oe<he.length;Oe++){const Ee=he[Oe],De=ee[Oe];for(let Ye=0;Ye<Ee.length-1;Ye++){const et=Ee[Ye],Lt=[et,Ee[Ye+1],De[Ye+1],De[Ye],et];qc(ge,Lt)&&(xe=Math.min(xe,vm(ge,Lt)))}}return xe!==1/0&&xe}(Y[0],Y[1],H)}}function iu(s,n){return s.x*n.x+s.y*n.y}function vm(s,n){if(s.length===1){let c=0;const f=n[c++];let g;for(;!g||f.equals(g);)if(g=n[c++],!g)return 1/0;for(;c<n.length;c++){const w=n[c],k=s[0],T=g.sub(f),I=w.sub(f),z=k.sub(f),O=iu(T,T),U=iu(T,I),H=iu(I,I),Y=iu(z,T),ee=iu(z,I),he=O*H-U*U,ge=(H*Y-U*ee)/he,xe=(O*ee-U*Y)/he,Oe=f.z*(1-ge-xe)+g.z*ge+w.z*xe;if(isFinite(Oe))return Oe}return 1/0}{let c=1/0;for(const f of n)c=Math.min(c,f.z);return c}}const tv=An([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:iv}=tv,nv=An([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rv}=nv,ov=qs.VectorTileFeature.types,sv=Math.cos(Math.PI/180*37.5),bm=Math.pow(2,14)/.5;class vf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new _e,this.layoutVertexArray2=new ue,this.indexArray=new Xe,this.programConfigurations=new pn(n.layers,n.zoom),this.segments=new vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=pf("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),k=[];for(const{feature:T,id:I,index:z,sourceLayerIndex:O}of n){const U=this.layers[0]._featureFilter.needGeometry,H=ms(T,U);if(!this.layers[0]._featureFilter.filter(new ln(this.zoom),H,f))continue;const Y=w?g.evaluate(H,{},f):void 0,ee={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:z,geometry:U?H.geometry:ps(T),patterns:{},sortKey:Y};k.push(ee)}w&&k.sort((T,I)=>T.sortKey-I.sortKey);for(const T of k){const{geometry:I,index:z,sourceLayerIndex:O}=T;if(this.hasPattern){const U=mf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(U)}else this.addFeature(T,I,z,f,{});c.featureIndex.insert(n[z].feature,I,z,O,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,rv)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,iv),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,c,f,g,w){const k=this.layers[0].layout,T=k.get("line-join").evaluate(n,{}),I=k.get("line-cap"),z=k.get("line-miter-limit"),O=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const U of c)this.addLine(U,n,T,I,z,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}addLine(n,c,f,g,w,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<n.length-1;xe++)this.totalDistance+=n[xe].dist(n[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=ov[c.type]==="Polygon";let I=n.length;for(;I>=2&&n[I-1].equals(n[I-2]);)I--;let z=0;for(;z<I-1&&n[z].equals(n[z+1]);)z++;if(I<(T?3:2))return;f==="bevel"&&(w=1.05);const O=this.overscaling<=16?15*Sn/(512*this.overscaling):0,U=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let H,Y,ee,he,ge;this.e1=this.e2=-1,T&&(H=n[I-2],ge=n[z].sub(H)._unit()._perp());for(let xe=z;xe<I;xe++){if(ee=xe===I-1?T?n[z+1]:void 0:n[xe+1],ee&&n[xe].equals(ee))continue;ge&&(he=ge),H&&(Y=H),H=n[xe],ge=ee?ee.sub(H)._unit()._perp():he,he=he||ge;let Oe=he.add(ge);Oe.x===0&&Oe.y===0||Oe._unit();const Ee=he.x*ge.x+he.y*ge.y,De=Oe.x*ge.x+Oe.y*ge.y,Ye=De!==0?1/De:1/0,et=2*Math.sqrt(2-2*De),Lt=De<sv&&Y&&ee,$t=he.x*ge.y-he.y*ge.x>0;if(Lt&&xe>z){const _t=H.dist(Y);if(_t>2*O){const Bt=H.sub(H.sub(Y)._mult(O/_t)._round());this.updateDistance(Y,Bt),this.addCurrentVertex(Bt,he,0,0,U),Y=Bt}}const It=Y&&ee;let Tt=It?f:T?"butt":g;if(It&&Tt==="round"&&(Ye<k?Tt="miter":Ye<=2&&(Tt="fakeround")),Tt==="miter"&&Ye>w&&(Tt="bevel"),Tt==="bevel"&&(Ye>2&&(Tt="flipbevel"),Ye<w&&(Tt="miter")),Y&&this.updateDistance(Y,H),Tt==="miter")Oe._mult(Ye),this.addCurrentVertex(H,Oe,0,0,U);else if(Tt==="flipbevel"){if(Ye>100)Oe=ge.mult(-1);else{const _t=Ye*he.add(ge).mag()/he.sub(ge).mag();Oe._perp()._mult(_t*($t?-1:1))}this.addCurrentVertex(H,Oe,0,0,U),this.addCurrentVertex(H,Oe.mult(-1),0,0,U)}else if(Tt==="bevel"||Tt==="fakeround"){const _t=-Math.sqrt(Ye*Ye-1),Bt=$t?_t:0,kt=$t?0:_t;if(Y&&this.addCurrentVertex(H,he,Bt,kt,U),Tt==="fakeround"){const ut=Math.round(180*et/Math.PI/20);for(let Xt=1;Xt<ut;Xt++){let qt=Xt/ut;if(qt!==.5){const on=qt-.5;qt+=qt*on*(qt-1)*((1.0904+Ee*(Ee*(3.55645-1.43519*Ee)-3.2452))*on*on+(.848013+Ee*(.215638*Ee-1.06021)))}const vi=ge.sub(he)._mult(qt)._add(he)._unit()._mult($t?-1:1);this.addHalfVertex(H,vi.x,vi.y,!1,$t,0,U)}}ee&&this.addCurrentVertex(H,ge,-Bt,-kt,U)}else if(Tt==="butt")this.addCurrentVertex(H,Oe,0,0,U);else if(Tt==="square"){const _t=Y?1:-1;this.addCurrentVertex(H,Oe,_t,_t,U)}else Tt==="round"&&(Y&&(this.addCurrentVertex(H,he,0,0,U),this.addCurrentVertex(H,he,1,1,U,!0)),ee&&(this.addCurrentVertex(H,ge,-1,-1,U,!0),this.addCurrentVertex(H,ge,0,0,U)));if(Lt&&xe<I-1){const _t=H.dist(ee);if(_t>2*O){const Bt=H.add(ee.sub(H)._mult(O/_t)._round());this.updateDistance(H,Bt),this.addCurrentVertex(Bt,ge,0,0,U),H=Bt}}}}addCurrentVertex(n,c,f,g,w,k=!1){const T=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(n,c.x+c.y*f,c.y-c.x*f,k,!1,f,w),this.addHalfVertex(n,T,I,k,!0,-g,w),this.distance>bm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,c,f,g,w,k))}addHalfVertex({x:n,y:c},f,g,w,k,T,I){const z=.5*(this.lineClips?this.scaledDistance*(bm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(c<<1)+(k?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),I.primitiveLength++),k?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,c){this.distance+=n.dist(c),this.updateScaledDistance()}}let wm,xm;zt("LineBucket",vf,{omit:["layers","patternFeatures"]});var km={get paint(){return xm=xm||new Cr({"line-opacity":new Kt(we.paint_line["line-opacity"]),"line-color":new Kt(we.paint_line["line-color"]),"line-translate":new Zt(we.paint_line["line-translate"]),"line-translate-anchor":new Zt(we.paint_line["line-translate-anchor"]),"line-width":new Kt(we.paint_line["line-width"]),"line-gap-width":new Kt(we.paint_line["line-gap-width"]),"line-offset":new Kt(we.paint_line["line-offset"]),"line-blur":new Kt(we.paint_line["line-blur"]),"line-dasharray":new Ca(we.paint_line["line-dasharray"]),"line-pattern":new kl(we.paint_line["line-pattern"]),"line-gradient":new Dc(we.paint_line["line-gradient"])})},get layout(){return wm=wm||new Cr({"line-cap":new Zt(we.layout_line["line-cap"]),"line-join":new Kt(we.layout_line["line-join"]),"line-miter-limit":new Zt(we.layout_line["line-miter-limit"]),"line-round-limit":new Zt(we.layout_line["line-round-limit"]),"line-sort-key":new Kt(we.layout_line["line-sort-key"])})}};class av extends Kt{possiblyEvaluate(n,c){return c=new ln(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(n,c)}evaluate(n,c,f,g){return c=J({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(n,c,f,g)}}let Vh;class lv extends ao{constructor(n){super(n,km),this.gradientVersion=0,Vh||(Vh=new av(km.paint.properties["line-width"].specification),Vh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof ya,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,c){super.recalculate(n,c),this.paint._values["line-floorwidth"]=Vh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new vf(n)}queryRadius(n){const c=n,f=Sm(Hc("line-width",this,c),Hc("line-gap-width",this,c)),g=Hc("line-offset",this,c);return f/2+Math.abs(g)+Bh(this.paint.get("line-translate"))}queryIntersectsFeature(n,c,f,g,w,k,T){const I=Fh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,T),z=T/2*Sm(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),O=this.paint.get("line-offset").evaluate(c,f);return O&&(g=function(U,H){const Y=[];for(let ee=0;ee<U.length;ee++){const he=U[ee],ge=[];for(let xe=0;xe<he.length;xe++){const Oe=he[xe-1],Ee=he[xe],De=he[xe+1],Ye=xe===0?new S(0,0):Ee.sub(Oe)._unit()._perp(),et=xe===he.length-1?new S(0,0):De.sub(Ee)._unit()._perp(),Lt=Ye._add(et)._unit(),$t=Lt.x*et.x+Lt.y*et.y;$t!==0&&Lt._mult(1/$t),ge.push(Lt._mult(H)._add(Ee))}Y.push(ge)}return Y}(g,O*T)),function(U,H,Y){for(let ee=0;ee<H.length;ee++){const he=H[ee];if(U.length>=3){for(let ge=0;ge<he.length;ge++)if(zl(U,he[ge]))return!0}if(Gc(U,he,Y))return!0}return!1}(I,g,z)}isTileClipped(){return!0}}function Sm(s,n){return n>0?n+2*s:s}const cv=An([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uv=An([{name:"a_projected_pos",components:3,type:"Float32"}],4);An([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const hv=An([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);An([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Tm=An([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dv=An([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fv(s,n,c){return s.sections.forEach(f=>{f.text=function(g,w,k){const T=w.layout.get("text-transform").evaluate(k,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Xo.applyArabicShaping&&(g=Xo.applyArabicShaping(g)),g}(f.text,n,c)}),s}An([{name:"triangle",components:3,type:"Uint16"}]),An([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),An([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),An([{type:"Float32",name:"offsetX"}]),An([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),An([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Gn=24,Cm=Wi,Mm=function(s,n,c,f,g){var w,k,T=8*g-f-1,I=(1<<T)-1,z=I>>1,O=-7,U=c?g-1:0,H=c?-1:1,Y=s[n+U];for(U+=H,w=Y&(1<<-O)-1,Y>>=-O,O+=T;O>0;w=256*w+s[n+U],U+=H,O-=8);for(k=w&(1<<-O)-1,w>>=-O,O+=f;O>0;k=256*k+s[n+U],U+=H,O-=8);if(w===0)w=1-z;else{if(w===I)return k?NaN:1/0*(Y?-1:1);k+=Math.pow(2,f),w-=z}return(Y?-1:1)*k*Math.pow(2,w-f)},Em=function(s,n,c,f,g,w){var k,T,I,z=8*w-g-1,O=(1<<z)-1,U=O>>1,H=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Y=f?0:w-1,ee=f?1:-1,he=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,k=O):(k=Math.floor(Math.log(n)/Math.LN2),n*(I=Math.pow(2,-k))<1&&(k--,I*=2),(n+=k+U>=1?H/I:H*Math.pow(2,1-U))*I>=2&&(k++,I/=2),k+U>=O?(T=0,k=O):k+U>=1?(T=(n*I-1)*Math.pow(2,g),k+=U):(T=n*Math.pow(2,U-1)*Math.pow(2,g),k=0));g>=8;s[c+Y]=255&T,Y+=ee,T/=256,g-=8);for(k=k<<g|T,z+=g;z>0;s[c+Y]=255&k,Y+=ee,k/=256,z-=8);s[c+Y-ee]|=128*he};function Wi(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Wi.Varint=0,Wi.Fixed64=1,Wi.Bytes=2,Wi.Fixed32=5;var bf=4294967296,Im=1/bf,Lm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gs(s){return s.type===Wi.Bytes?s.readVarint()+s.pos:s.pos+1}function Fl(s,n,c){return c?4294967296*n+(s>>>0):4294967296*(n>>>0)+(s>>>0)}function Am(s,n,c){var f=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));c.realloc(f);for(var g=c.pos-1;g>=s;g--)c.buf[g+f]=c.buf[g]}function pv(s,n){for(var c=0;c<s.length;c++)n.writeVarint(s[c])}function mv(s,n){for(var c=0;c<s.length;c++)n.writeSVarint(s[c])}function gv(s,n){for(var c=0;c<s.length;c++)n.writeFloat(s[c])}function _v(s,n){for(var c=0;c<s.length;c++)n.writeDouble(s[c])}function yv(s,n){for(var c=0;c<s.length;c++)n.writeBoolean(s[c])}function vv(s,n){for(var c=0;c<s.length;c++)n.writeFixed32(s[c])}function bv(s,n){for(var c=0;c<s.length;c++)n.writeSFixed32(s[c])}function wv(s,n){for(var c=0;c<s.length;c++)n.writeFixed64(s[c])}function xv(s,n){for(var c=0;c<s.length;c++)n.writeSFixed64(s[c])}function qh(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+16777216*s[n+3]}function Ol(s,n,c){s[c]=n,s[c+1]=n>>>8,s[c+2]=n>>>16,s[c+3]=n>>>24}function Pm(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+(s[n+3]<<24)}Wi.prototype={destroy:function(){this.buf=null},readFields:function(s,n,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),g=f>>3,w=this.pos;this.type=7&f,s(g,n,this),this.pos===w&&this.skip(f)}return n},readMessage:function(s,n){return this.readFields(s,n,this.readVarint()+this.pos)},readFixed32:function(){var s=qh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Pm(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=qh(this.buf,this.pos)+qh(this.buf,this.pos+4)*bf;return this.pos+=8,s},readSFixed64:function(){var s=qh(this.buf,this.pos)+Pm(this.buf,this.pos+4)*bf;return this.pos+=8,s},readFloat:function(){var s=Mm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Mm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var n,c,f=this.buf;return n=127&(c=f[this.pos++]),c<128?n:(n|=(127&(c=f[this.pos++]))<<7,c<128?n:(n|=(127&(c=f[this.pos++]))<<14,c<128?n:(n|=(127&(c=f[this.pos++]))<<21,c<128?n:function(g,w,k){var T,I,z=k.buf;if(T=(112&(I=z[k.pos++]))>>4,I<128||(T|=(127&(I=z[k.pos++]))<<3,I<128)||(T|=(127&(I=z[k.pos++]))<<10,I<128)||(T|=(127&(I=z[k.pos++]))<<17,I<128)||(T|=(127&(I=z[k.pos++]))<<24,I<128)||(T|=(1&(I=z[k.pos++]))<<31,I<128))return Fl(g,T,w);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,n=this.pos;return this.pos=s,s-n>=12&&Lm?function(c,f,g){return Lm.decode(c.subarray(f,g))}(this.buf,n,s):function(c,f,g){for(var w="",k=f;k<g;){var T,I,z,O=c[k],U=null,H=O>239?4:O>223?3:O>191?2:1;if(k+H>g)break;H===1?O<128&&(U=O):H===2?(192&(T=c[k+1]))==128&&(U=(31&O)<<6|63&T)<=127&&(U=null):H===3?(I=c[k+2],(192&(T=c[k+1]))==128&&(192&I)==128&&((U=(15&O)<<12|(63&T)<<6|63&I)<=2047||U>=55296&&U<=57343)&&(U=null)):H===4&&(I=c[k+2],z=c[k+3],(192&(T=c[k+1]))==128&&(192&I)==128&&(192&z)==128&&((U=(15&O)<<18|(63&T)<<12|(63&I)<<6|63&z)<=65535||U>=1114112)&&(U=null)),U===null?(U=65533,H=1):U>65535&&(U-=65536,w+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),w+=String.fromCharCode(U),k+=H}return w}(this.buf,n,s)},readBytes:function(){var s=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,s);return this.pos=s,n},readPackedVarint:function(s,n){if(this.type!==Wi.Bytes)return s.push(this.readVarint(n));var c=gs(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(n));return s},readPackedSVarint:function(s){if(this.type!==Wi.Bytes)return s.push(this.readSVarint());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Wi.Bytes)return s.push(this.readBoolean());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Wi.Bytes)return s.push(this.readFloat());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Wi.Bytes)return s.push(this.readDouble());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Wi.Bytes)return s.push(this.readFixed32());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Wi.Bytes)return s.push(this.readSFixed32());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Wi.Bytes)return s.push(this.readFixed64());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Wi.Bytes)return s.push(this.readSFixed64());var n=gs(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed64());return s},skip:function(s){var n=7&s;if(n===Wi.Varint)for(;this.buf[this.pos++]>127;);else if(n===Wi.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Wi.Fixed32)this.pos+=4;else{if(n!==Wi.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(s,n){this.writeVarint(s<<3|n)},realloc:function(s){for(var n=this.length||16;n<this.pos+s;)n*=2;if(n!==this.length){var c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Ol(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Ol(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Ol(this.buf,-1&s,this.pos),Ol(this.buf,Math.floor(s*Im),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Ol(this.buf,-1&s,this.pos),Ol(this.buf,Math.floor(s*Im),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(n,c){var f,g;if(n>=0?(f=n%4294967296|0,g=n/4294967296|0):(g=~(-n/4294967296),4294967295^(f=~(-n%4294967296))?f=f+1|0:(f=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,k,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(f,0,c),function(w,k){var T=(7&w)<<4;k.buf[k.pos++]|=T|((w>>>=3)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w|((w>>>=7)?128:0),w&&(k.buf[k.pos++]=127&w)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var n=this.pos;this.pos=function(f,g,w){for(var k,T,I=0;I<g.length;I++){if((k=g.charCodeAt(I))>55295&&k<57344){if(!T){k>56319||I+1===g.length?(f[w++]=239,f[w++]=191,f[w++]=189):T=k;continue}if(k<56320){f[w++]=239,f[w++]=191,f[w++]=189,T=k;continue}k=T-55296<<10|k-56320|65536,T=null}else T&&(f[w++]=239,f[w++]=191,f[w++]=189,T=null);k<128?f[w++]=k:(k<2048?f[w++]=k>>6|192:(k<65536?f[w++]=k>>12|224:(f[w++]=k>>18|240,f[w++]=k>>12&63|128),f[w++]=k>>6&63|128),f[w++]=63&k|128)}return w}(this.buf,s,this.pos);var c=this.pos-n;c>=128&&Am(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),Em(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Em(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var n=s.length;this.writeVarint(n),this.realloc(n);for(var c=0;c<n;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,n){this.pos++;var c=this.pos;s(n,this);var f=this.pos-c;f>=128&&Am(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,n,c){this.writeTag(s,Wi.Bytes),this.writeRawMessage(n,c)},writePackedVarint:function(s,n){n.length&&this.writeMessage(s,pv,n)},writePackedSVarint:function(s,n){n.length&&this.writeMessage(s,mv,n)},writePackedBoolean:function(s,n){n.length&&this.writeMessage(s,yv,n)},writePackedFloat:function(s,n){n.length&&this.writeMessage(s,gv,n)},writePackedDouble:function(s,n){n.length&&this.writeMessage(s,_v,n)},writePackedFixed32:function(s,n){n.length&&this.writeMessage(s,vv,n)},writePackedSFixed32:function(s,n){n.length&&this.writeMessage(s,bv,n)},writePackedFixed64:function(s,n){n.length&&this.writeMessage(s,wv,n)},writePackedSFixed64:function(s,n){n.length&&this.writeMessage(s,xv,n)},writeBytesField:function(s,n){this.writeTag(s,Wi.Bytes),this.writeBytes(n)},writeFixed32Field:function(s,n){this.writeTag(s,Wi.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(s,n){this.writeTag(s,Wi.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(s,n){this.writeTag(s,Wi.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(s,n){this.writeTag(s,Wi.Fixed64),this.writeSFixed64(n)},writeVarintField:function(s,n){this.writeTag(s,Wi.Varint),this.writeVarint(n)},writeSVarintField:function(s,n){this.writeTag(s,Wi.Varint),this.writeSVarint(n)},writeStringField:function(s,n){this.writeTag(s,Wi.Bytes),this.writeString(n)},writeFloatField:function(s,n){this.writeTag(s,Wi.Fixed32),this.writeFloat(n)},writeDoubleField:function(s,n){this.writeTag(s,Wi.Fixed64),this.writeDouble(n)},writeBooleanField:function(s,n){this.writeVarintField(s,!!n)}};var wf=_(Cm);const xf=3;function kv(s,n,c){s===1&&c.readMessage(Sv,n)}function Sv(s,n,c){if(s===3){const{id:f,bitmap:g,width:w,height:k,left:T,top:I,advance:z}=c.readMessage(Tv,{});n.push({id:f,bitmap:new Kc({width:w+2*xf,height:k+2*xf},g),metrics:{width:w,height:k,left:T,top:I,advance:z}})}}function Tv(s,n,c){s===1?n.id=c.readVarint():s===2?n.bitmap=c.readBytes():s===3?n.width=c.readVarint():s===4?n.height=c.readVarint():s===5?n.left=c.readSVarint():s===6?n.top=c.readSVarint():s===7&&(n.advance=c.readVarint())}const zm=xf;function Dm(s){let n=0,c=0;for(const k of s)n+=k.w*k.h,c=Math.max(c,k.w);s.sort((k,T)=>T.h-k.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),c),h:1/0}];let g=0,w=0;for(const k of s)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(k.w>I.w||k.h>I.h)){if(k.x=I.x,k.y=I.y,w=Math.max(w,k.y+k.h),g=Math.max(g,k.x+k.w),k.w===I.w&&k.h===I.h){const z=f.pop();T<f.length&&(f[T]=z)}else k.h===I.h?(I.x+=k.w,I.w-=k.w):k.w===I.w?(I.y+=k.h,I.h-=k.h):(f.push({x:I.x+k.w,y:I.y,w:I.w-k.w,h:k.h}),I.y+=k.h,I.h-=k.h);break}}return{w:g,h:w,fill:n/(g*w)||0}}const jr=1;class kf{constructor(n,{pixelRatio:c,version:f,stretchX:g,stretchY:w,content:k}){this.paddedRect=n,this.pixelRatio=c,this.stretchX=g,this.stretchY=w,this.content=k,this.version=f}get tl(){return[this.paddedRect.x+jr,this.paddedRect.y+jr]}get br(){return[this.paddedRect.x+this.paddedRect.w-jr,this.paddedRect.y+this.paddedRect.h-jr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*jr)/this.pixelRatio,(this.paddedRect.h-2*jr)/this.pixelRatio]}}class Rm{constructor(n,c){const f={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(n,f,w),this.addImages(c,g,w);const{w:k,h:T}=Dm(w),I=new lo({width:k||1,height:T||1});for(const z in n){const O=n[z],U=f[z].paddedRect;lo.copy(O.data,I,{x:0,y:0},{x:U.x+jr,y:U.y+jr},O.data)}for(const z in c){const O=c[z],U=g[z].paddedRect,H=U.x+jr,Y=U.y+jr,ee=O.data.width,he=O.data.height;lo.copy(O.data,I,{x:0,y:0},{x:H,y:Y},O.data),lo.copy(O.data,I,{x:0,y:he-1},{x:H,y:Y-1},{width:ee,height:1}),lo.copy(O.data,I,{x:0,y:0},{x:H,y:Y+he},{width:ee,height:1}),lo.copy(O.data,I,{x:ee-1,y:0},{x:H-1,y:Y},{width:1,height:he}),lo.copy(O.data,I,{x:0,y:0},{x:H+ee,y:Y},{width:1,height:he})}this.image=I,this.iconPositions=f,this.patternPositions=g}addImages(n,c,f){for(const g in n){const w=n[g],k={x:0,y:0,w:w.data.width+2*jr,h:w.data.height+2*jr};f.push(k),c[g]=new kf(k,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(n,c){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in n.updatedImages)this.patchUpdatedImage(this.iconPositions[f],n.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],n.getImage(f),c)}patchUpdatedImage(n,c,f){if(!n||!c||n.version===c.version)return;n.version=c.version;const[g,w]=n.tl;f.update(c.data,void 0,{x:g,y:w})}}var Zs;zt("ImagePosition",kf),zt("ImageAtlas",Rm),d.ah=void 0,(Zs=d.ah||(d.ah={}))[Zs.none=0]="none",Zs[Zs.horizontal=1]="horizontal",Zs[Zs.vertical=2]="vertical",Zs[Zs.horizontalOnly=3]="horizontalOnly";const ru=-17;class ou{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,c){const f=new ou;return f.scale=n||1,f.fontStack=c,f}static forImage(n){const c=new ou;return c.imageName=n,c}}class Nl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,c){const f=new Nl;for(let g=0;g<n.sections.length;g++){const w=n.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let c="";for(let f=0;f<n.length;f++){const g=n.charCodeAt(f+1)||null,w=n.charCodeAt(f-1)||null;c+=g&&Pc(g)&&!nu[n[f+1]]||w&&Pc(w)&&!nu[n[f-1]]||!nu[n[f]]?n[f]:nu[n[f]]}return c}(this.text)}trim(){let n=0;for(let f=0;f<this.text.length&&Gh[this.text.charCodeAt(f)];f++)n++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=n&&Gh[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(n,c),this.sectionIndex=this.sectionIndex.slice(n,c)}substring(n,c){const f=new Nl;return f.text=this.text.substring(n,c),f.sectionIndex=this.sectionIndex.slice(n,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,c)=>Math.max(n,this.sections[c].scale),0)}addTextSection(n,c){this.text+=n.text,this.sections.push(ou.forText(n.scale,n.fontStack||c));const f=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(f)}addImageSection(n){const c=n.image?n.image.name:"";if(c.length===0)return void st("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ou.forImage(c)),this.sectionIndex.push(this.sections.length-1)):st("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zh(s,n,c,f,g,w,k,T,I,z,O,U,H,Y,ee,he){const ge=Nl.fromFeature(s,g);let xe;U===d.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Oe,processStyledBidirectionalText:Ee}=Xo;if(Oe&&ge.sections.length===1){xe=[];const et=Oe(ge.toString(),Sf(ge,z,w,n,f,Y,ee));for(const Lt of et){const $t=new Nl;$t.text=Lt,$t.sections=ge.sections;for(let It=0;It<Lt.length;It++)$t.sectionIndex.push(0);xe.push($t)}}else if(Ee){xe=[];const et=Ee(ge.text,ge.sectionIndex,Sf(ge,z,w,n,f,Y,ee));for(const Lt of et){const $t=new Nl;$t.text=Lt[0],$t.sectionIndex=Lt[1],$t.sections=ge.sections,xe.push($t)}}else xe=function(et,Lt){const $t=[],It=et.text;let Tt=0;for(const _t of Lt)$t.push(et.substring(Tt,_t)),Tt=_t;return Tt<It.length&&$t.push(et.substring(Tt,It.length)),$t}(ge,Sf(ge,z,w,n,f,Y,ee));const De=[],Ye={positionedLines:De,text:ge.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:U,iconsInText:!1,verticalizable:!1};return function(et,Lt,$t,It,Tt,_t,Bt,kt,ut,Xt,qt,vi){let on=0,un=ru,Wn=0,Qr=0;const Er=kt==="right"?1:kt==="left"?0:.5;let $n=0;for(const Hn of Tt){Hn.trim();const Xn=Hn.getMaxScale(),yr=(Xn-1)*Gn,Ar={positionedGlyphs:[],lineOffset:0};et.positionedLines[$n]=Ar;const vr=Ar.positionedGlyphs;let Ur=0;if(!Hn.length()){un+=_t,++$n;continue}for(let Kn=0;Kn<Hn.length();Kn++){const ki=Hn.getSection(Kn),br=Hn.getSectionIndex(Kn),ur=Hn.getCharCode(Kn);let Jn=0,So=null,Ro=null,Bo=null,_s=Gn;const To=!(ut===d.ah.horizontal||!qt&&!bl(ur)||qt&&(Gh[ur]||(ir=ur,Et.Arabic(ir)||Et["Arabic Supplement"](ir)||Et["Arabic Extended-A"](ir)||Et["Arabic Presentation Forms-A"](ir)||Et["Arabic Presentation Forms-B"](ir))));if(ki.imageName){const uo=It[ki.imageName];if(!uo)continue;Bo=ki.imageName,et.iconsInText=et.iconsInText||!0,Ro=uo.paddedRect;const qr=uo.displaySize;ki.scale=ki.scale*Gn/vi,So={width:qr[0],height:qr[1],left:jr,top:-zm,advance:To?qr[1]:qr[0]},Jn=yr+(Gn-qr[1]*ki.scale),_s=So.advance;const ys=To?qr[0]*ki.scale-Gn*Xn:qr[1]*ki.scale-Gn*Xn;ys>0&&ys>Ur&&(Ur=ys)}else{const uo=$t[ki.fontStack],qr=uo&&uo[ur];if(qr&&qr.rect)Ro=qr.rect,So=qr.metrics;else{const ys=Lt[ki.fontStack],uu=ys&&ys[ur];if(!uu)continue;So=uu.metrics}Jn=(Xn-ki.scale)*Gn}To?(et.verticalizable=!0,vr.push({glyph:ur,imageName:Bo,x:on,y:un+Jn,vertical:To,scale:ki.scale,fontStack:ki.fontStack,sectionIndex:br,metrics:So,rect:Ro}),on+=_s*ki.scale+Xt):(vr.push({glyph:ur,imageName:Bo,x:on,y:un+Jn,vertical:To,scale:ki.scale,fontStack:ki.fontStack,sectionIndex:br,metrics:So,rect:Ro}),on+=So.advance*ki.scale+Xt)}vr.length!==0&&(Wn=Math.max(on-Xt,Wn),Ev(vr,0,vr.length-1,Er,Ur)),on=0;const Vr=_t*Xn+Ur;Ar.lineOffset=Math.max(Ur,yr),un+=Vr,Qr=Math.max(Vr,Qr),++$n}var ir;const cr=un-ru,{horizontalAlign:Ir,verticalAlign:Lr}=Tf(Bt);(function(Hn,Xn,yr,Ar,vr,Ur,Vr,Kn,ki){const br=(Xn-yr)*vr;let ur=0;ur=Ur!==Vr?-Kn*Ar-ru:(-Ar*ki+.5)*Vr;for(const Jn of Hn)for(const So of Jn.positionedGlyphs)So.x+=br,So.y+=ur})(et.positionedLines,Er,Ir,Lr,Wn,Qr,_t,cr,Tt.length),et.top+=-Lr*cr,et.bottom=et.top+cr,et.left+=-Ir*Wn,et.right=et.left+Wn}(Ye,n,c,f,xe,k,T,I,U,z,H,he),!function(et){for(const Lt of et)if(Lt.positionedGlyphs.length!==0)return!1;return!0}(De)&&Ye}const Gh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Bm(s,n,c,f,g,w){if(n.imageName){const k=f[n.imageName];return k?k.displaySize[0]*n.scale*Gn/w+g:0}{const k=c[n.fontStack],T=k&&k[s];return T?T.metrics.advance*n.scale+g:0}}function Fm(s,n,c,f){const g=Math.pow(s-n,2);return f?s<n?g/2:2*g:g+Math.abs(c)*c}function Mv(s,n,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),n!==41&&n!==65289||(f+=50),f}function Om(s,n,c,f,g,w){let k=null,T=Fm(n,c,g,w);for(const I of f){const z=Fm(n-I.x,c,g,w)+I.badness;z<=T&&(k=I,T=z)}return{index:s,x:n,priorBreak:k,badness:T}}function Nm(s){return s?Nm(s.priorBreak).concat(s.index):[]}function Sf(s,n,c,f,g,w,k){if(w!=="point")return[];if(!s)return[];const T=[],I=function(H,Y,ee,he,ge,xe){let Oe=0;for(let Ee=0;Ee<H.length();Ee++){const De=H.getSection(Ee);Oe+=Bm(H.getCharCode(Ee),De,he,ge,Y,xe)}return Oe/Math.max(1,Math.ceil(Oe/ee))}(s,n,c,f,g,k),z=s.text.indexOf("​")>=0;let O=0;for(let H=0;H<s.length();H++){const Y=s.getSection(H),ee=s.getCharCode(H);if(Gh[ee]||(O+=Bm(ee,Y,f,g,n,k)),H<s.length()-1){const he=!((U=ee)<11904||!(Et["Bopomofo Extended"](U)||Et.Bopomofo(U)||Et["CJK Compatibility Forms"](U)||Et["CJK Compatibility Ideographs"](U)||Et["CJK Compatibility"](U)||Et["CJK Radicals Supplement"](U)||Et["CJK Strokes"](U)||Et["CJK Symbols and Punctuation"](U)||Et["CJK Unified Ideographs Extension A"](U)||Et["CJK Unified Ideographs"](U)||Et["Enclosed CJK Letters and Months"](U)||Et["Halfwidth and Fullwidth Forms"](U)||Et.Hiragana(U)||Et["Ideographic Description Characters"](U)||Et["Kangxi Radicals"](U)||Et["Katakana Phonetic Extensions"](U)||Et.Katakana(U)||Et["Vertical Forms"](U)||Et["Yi Radicals"](U)||Et["Yi Syllables"](U)));(Cv[ee]||he||Y.imageName)&&T.push(Om(H+1,O,I,T,Mv(ee,s.getCharCode(H+1),he&&z),!1))}}var U;return Nm(Om(s.length(),O,I,T,0,!0))}function Tf(s){let n=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:n,verticalAlign:c}}function Ev(s,n,c,f,g){if(!f&&!g)return;const w=s[c],k=(s[c].x+w.metrics.advance*w.scale)*f;for(let T=n;T<=c;T++)s[T].x-=k,s[T].y+=g}function Iv(s,n,c){const{horizontalAlign:f,verticalAlign:g}=Tf(c),w=n[0]-s.displaySize[0]*f,k=n[1]-s.displaySize[1]*g;return{image:s,top:k,bottom:k+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function $m(s,n,c,f,g,w){const k=s.image;let T;if(k.content){const ge=k.content,xe=k.pixelRatio||1;T=[ge[0]/xe,ge[1]/xe,k.displaySize[0]-ge[2]/xe,k.displaySize[1]-ge[3]/xe]}const I=n.left*w,z=n.right*w;let O,U,H,Y;c==="width"||c==="both"?(Y=g[0]+I-f[3],U=g[0]+z+f[1]):(Y=g[0]+(I+z-k.displaySize[0])/2,U=Y+k.displaySize[0]);const ee=n.top*w,he=n.bottom*w;return c==="height"||c==="both"?(O=g[1]+ee-f[0],H=g[1]+he+f[2]):(O=g[1]+(ee+he-k.displaySize[1])/2,H=O+k.displaySize[1]),{image:k,top:O,right:U,bottom:H,left:Y,collisionPadding:T}}const su=255,Qo=128,Gs=su*Qo;function jm(s,n){const{expression:c}=n;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new ln(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let k=w;for(;k<f.length&&f[k]<s+1;)k++;k=Math.min(f.length-1,k);const T=f[w],I=f[k];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new ln(T)),maxSize:c.evaluate(new ln(I)),interpolationType:g}}}function Cf(s,n,c){let f="never";const g=s.get(n);return g?f=g:s.get(c)&&(f="always"),f}const Lv=qs.VectorTileFeature.types,Av=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wh(s,n,c,f,g,w,k,T,I,z,O,U,H){const Y=T?Math.min(Gs,Math.round(T[0])):0,ee=T?Math.min(Gs,Math.round(T[1])):0;s.emplaceBack(n,c,Math.round(32*f),Math.round(32*g),w,k,(Y<<1)+(I?1:0),ee,16*z,16*O,256*U,256*H)}function Mf(s,n,c){s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c)}function Pv(s){for(const n of s.sections)if(rf(n.text))return!0;return!1}class Ef{constructor(n){this.layoutVertexArray=new Ze,this.indexArray=new Xe,this.programConfigurations=n,this.segments=new vt,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new Re,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,c,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,cv.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,uv.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Av,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}zt("SymbolBuffers",Ef);class If{constructor(n,c,f){this.layoutVertexArray=new n,this.layoutAttributes=c,this.indexArray=new f,this.segments=new vt,this.collisionVertexArray=new He}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,hv.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}zt("CollisionBuffers",If);class $l{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(k=>k.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sf([]),this.placementViewportMatrix=sf([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jm(this.zoom,c["text-size"]),this.iconSizeData=jm(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=Cf(f,"text-overlap","text-allow-overlap")!=="never"||Cf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(k=>d.ah[k])),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.sourceID=n.sourceID}createArrays(){this.text=new Ef(new pn(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Ef(new pn(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new b,this.lineVertexArray=new M,this.symbolInstances=new m,this.textAnchorOffsets=new A}calculateGlyphDependencies(n,c,f,g,w){for(let k=0;k<n.length;k++)if(c[n.charCodeAt(k)]=!0,(f||g)&&w){const T=nu[n.charAt(k)];T&&(c[T.charCodeAt(0)]=!0)}}populate(n,c,f){const g=this.layers[0],w=g.layout,k=w.get("text-font"),T=w.get("text-field"),I=w.get("icon-image"),z=(T.value.kind!=="constant"||T.value.value instanceof Br&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),O=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,U=w.get("symbol-sort-key");if(this.features=[],!z&&!O)return;const H=c.iconDependencies,Y=c.glyphDependencies,ee=c.availableImages,he=new ln(this.zoom);for(const{feature:ge,id:xe,index:Oe,sourceLayerIndex:Ee}of n){const De=g._featureFilter.needGeometry,Ye=ms(ge,De);if(!g._featureFilter.filter(he,Ye,f))continue;let et,Lt;if(De||(Ye.geometry=ps(ge)),z){const It=g.getValueAndResolveTokens("text-field",Ye,f,ee),Tt=Br.factory(It),_t=this.hasRTLText=this.hasRTLText||Pv(Tt);(!_t||Xo.getRTLTextPluginStatus()==="unavailable"||_t&&Xo.isParsed())&&(et=fv(Tt,g,Ye))}if(O){const It=g.getValueAndResolveTokens("icon-image",Ye,f,ee);Lt=It instanceof Kr?It:Kr.fromString(It)}if(!et&&!Lt)continue;const $t=this.sortFeaturesByKey?U.evaluate(Ye,{},f):void 0;if(this.features.push({id:xe,text:et,icon:Lt,index:Oe,sourceLayerIndex:Ee,geometry:Ye.geometry,properties:ge.properties,type:Lv[ge.type],sortKey:$t}),Lt&&(H[Lt.name]=!0),et){const It=k.evaluate(Ye,{},f).join(","),Tt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const _t of et.sections)if(_t.image)H[_t.image.name]=!0;else{const Bt=Us(et.toString()),kt=_t.fontStack||It,ut=Y[kt]=Y[kt]||{};this.calculateGlyphDependencies(_t.text,ut,Tt,this.allowVerticalPlacement,Bt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ge){const xe={},Oe={},Ee=[];let De=0;function Ye(It){Ee.push(ge[It]),De++}function et(It,Tt,_t){const Bt=Oe[It];return delete Oe[It],Oe[Tt]=Bt,Ee[Bt].geometry[0].pop(),Ee[Bt].geometry[0]=Ee[Bt].geometry[0].concat(_t[0]),Bt}function Lt(It,Tt,_t){const Bt=xe[Tt];return delete xe[Tt],xe[It]=Bt,Ee[Bt].geometry[0].shift(),Ee[Bt].geometry[0]=_t[0].concat(Ee[Bt].geometry[0]),Bt}function $t(It,Tt,_t){const Bt=_t?Tt[0][Tt[0].length-1]:Tt[0][0];return`${It}:${Bt.x}:${Bt.y}`}for(let It=0;It<ge.length;It++){const Tt=ge[It],_t=Tt.geometry,Bt=Tt.text?Tt.text.toString():null;if(!Bt){Ye(It);continue}const kt=$t(Bt,_t),ut=$t(Bt,_t,!0);if(kt in Oe&&ut in xe&&Oe[kt]!==xe[ut]){const Xt=Lt(kt,ut,_t),qt=et(kt,ut,Ee[Xt].geometry);delete xe[kt],delete Oe[ut],Oe[$t(Bt,Ee[qt].geometry,!0)]=qt,Ee[Xt].geometry=null}else kt in Oe?et(kt,ut,_t):ut in xe?Lt(kt,ut,_t):(Ye(It),xe[kt]=De-1,Oe[ut]=De-1)}return Ee.filter(It=>It.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,xe)=>ge.sortKey-xe.sortKey)}update(n,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(n,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,c){const f=this.lineVertexArray.length;if(n.segment!==void 0){let g=n.dist(c[n.segment+1]),w=n.dist(c[n.segment]);const k={};for(let T=n.segment+1;T<c.length;T++)k[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=n.segment||0;T>=0;T--)k[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=k[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(n,c,f,g,w,k,T,I,z,O,U,H){const Y=n.indexArray,ee=n.layoutVertexArray,he=n.segments.prepareSegment(4*c.length,ee,Y,this.canOverlap?k.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=he.vertexLength,Oe=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Ee=k.text&&k.text.sections;for(let De=0;De<c.length;De++){const{tl:Ye,tr:et,bl:Lt,br:$t,tex:It,pixelOffsetTL:Tt,pixelOffsetBR:_t,minFontScaleX:Bt,minFontScaleY:kt,glyphOffset:ut,isSDF:Xt,sectionIndex:qt}=c[De],vi=he.vertexLength,on=ut[1];Wh(ee,I.x,I.y,Ye.x,on+Ye.y,It.x,It.y,f,Xt,Tt.x,Tt.y,Bt,kt),Wh(ee,I.x,I.y,et.x,on+et.y,It.x+It.w,It.y,f,Xt,_t.x,Tt.y,Bt,kt),Wh(ee,I.x,I.y,Lt.x,on+Lt.y,It.x,It.y+It.h,f,Xt,Tt.x,_t.y,Bt,kt),Wh(ee,I.x,I.y,$t.x,on+$t.y,It.x+It.w,It.y+It.h,f,Xt,_t.x,_t.y,Bt,kt),Mf(n.dynamicLayoutVertexArray,I,Oe),Y.emplaceBack(vi,vi+1,vi+2),Y.emplaceBack(vi+1,vi+2,vi+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),De!==c.length-1&&qt===c[De+1].sectionIndex||n.programConfigurations.populatePaintArrays(ee.length,k,k.index,{},H,Ee&&Ee[qt])}n.placedSymbolArray.emplaceBack(I.x,I.y,ge,this.glyphOffsetArray.length-ge,xe,z,O,I.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,U)}_addCollisionDebugVertex(n,c,f,g,w,k){return c.emplaceBack(0,0),n.emplaceBack(f.x,f.y,g,w,Math.round(k.x),Math.round(k.y))}addCollisionDebugVertices(n,c,f,g,w,k,T){const I=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),z=I.vertexLength,O=w.layoutVertexArray,U=w.collisionVertexArray,H=T.anchorX,Y=T.anchorY;this._addCollisionDebugVertex(O,U,k,H,Y,new S(n,c)),this._addCollisionDebugVertex(O,U,k,H,Y,new S(f,c)),this._addCollisionDebugVertex(O,U,k,H,Y,new S(f,g)),this._addCollisionDebugVertex(O,U,k,H,Y,new S(n,g)),I.vertexLength+=4;const ee=w.indexArray;ee.emplaceBack(z,z+1),ee.emplaceBack(z+1,z+2),ee.emplaceBack(z+2,z+3),ee.emplaceBack(z+3,z),I.primitiveLength+=4}addDebugCollisionBoxes(n,c,f,g){for(let w=n;w<c;w++){const k=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(k.x1,k.y1,k.x2,k.y2,g?this.textCollisionBox:this.iconCollisionBox,k.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new If(We,Tm.members,ot),this.iconCollisionBox=new If(We,Tm.members,ot);for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(n,c,f,g,w,k,T,I,z){const O={};for(let U=c;U<f;U++){const H=n.get(U);O.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.textFeatureIndex=H.featureIndex;break}for(let U=g;U<w;U++){const H=n.get(U);O.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalTextFeatureIndex=H.featureIndex;break}for(let U=k;U<T;U++){const H=n.get(U);O.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.iconFeatureIndex=H.featureIndex;break}for(let U=I;U<z;U++){const H=n.get(U);O.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},O.verticalIconFeatureIndex=H.featureIndex;break}return O}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,c){const f=n.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<g;w+=4)n.indexArray.emplaceBack(w,w+1,w+2),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(n),f=Math.cos(n),g=[],w=[],k=[];for(let T=0;T<this.symbolInstances.length;++T){k.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(c*I.anchorX+f*I.anchorY)),w.push(I.featureIndex)}return k.sort((T,I)=>g[T]-g[I]||w[I]-w[T]),k}addToSortKeyRanges(n,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,w,k)=>{g>=0&&k.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Um,Vm;zt("SymbolBucket",$l,{omit:["layers","collisionBoxArray","features","compareText"]}),$l.MAX_GLYPHS=65535,$l.addDynamicAttributes=Mf;var Lf={get paint(){return Vm=Vm||new Cr({"icon-opacity":new Kt(we.paint_symbol["icon-opacity"]),"icon-color":new Kt(we.paint_symbol["icon-color"]),"icon-halo-color":new Kt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Zt(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Zt(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(we.paint_symbol["text-opacity"]),"text-color":new Kt(we.paint_symbol["text-color"],{runtimeType:Ji,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Kt(we.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(we.paint_symbol["text-halo-blur"]),"text-translate":new Zt(we.paint_symbol["text-translate"]),"text-translate-anchor":new Zt(we.paint_symbol["text-translate-anchor"])})},get layout(){return Um=Um||new Cr({"symbol-placement":new Zt(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Zt(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Zt(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Zt(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Zt(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Zt(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Zt(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Zt(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Zt(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(we.layout_symbol["icon-size"]),"icon-text-fit":new Zt(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Zt(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(we.layout_symbol["icon-image"]),"icon-rotate":new Kt(we.layout_symbol["icon-rotate"]),"icon-padding":new Kt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Zt(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(we.layout_symbol["icon-offset"]),"icon-anchor":new Kt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Zt(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Zt(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Zt(we.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(we.layout_symbol["text-field"]),"text-font":new Kt(we.layout_symbol["text-font"]),"text-size":new Kt(we.layout_symbol["text-size"]),"text-max-width":new Kt(we.layout_symbol["text-max-width"]),"text-line-height":new Zt(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(we.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(we.layout_symbol["text-justify"]),"text-radial-offset":new Kt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Zt(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Kt(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Kt(we.layout_symbol["text-anchor"]),"text-max-angle":new Zt(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Zt(we.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(we.layout_symbol["text-rotate"]),"text-padding":new Zt(we.layout_symbol["text-padding"]),"text-keep-upright":new Zt(we.layout_symbol["text-keep-upright"]),"text-transform":new Kt(we.layout_symbol["text-transform"]),"text-offset":new Kt(we.layout_symbol["text-offset"]),"text-allow-overlap":new Zt(we.layout_symbol["text-allow-overlap"]),"text-overlap":new Zt(we.layout_symbol["text-overlap"]),"text-ignore-placement":new Zt(we.layout_symbol["text-ignore-placement"]),"text-optional":new Zt(we.layout_symbol["text-optional"])})}};class qm{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Ki,this.defaultValue=n}evaluate(n){if(n.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(n.formattedSection))return c.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt("FormatSectionOverride",qm,{omit:["defaultValue"]});class Hh extends ao{constructor(n){super(n,Lf)}recalculate(n,c){if(super.recalculate(n,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const w of f)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,c,f,g){const w=this.layout.get(n).evaluate(c,{},f,g),k=this._unevaluatedLayout._values[n];return k.isDataDriven()||Yi(k.value)||!w?w:function(T,I){return I.replace(/{([^{}]+)}/g,(z,O)=>T&&O in T?String(T[O]):"")}(c.properties,w)}createBucket(n){return new $l(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of Lf.paint.overridableProperties){if(!Hh.hasPaintOverride(this.layout,n))continue;const c=this.paint.get(n),f=new qm(c),g=new rn(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new cl("source",g):new kc("composite",g,c.value.zoomStops),this.paint._values[n]=new so(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(n,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Hh.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,c){const f=n.get("text-field"),g=Lf.paint.properties[c];let w=!1;const k=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Br)k(f.value.value.sections);else if(f.value.kind==="source"){const T=z=>{w||(z instanceof qo&&Bn(z.value)===_n?k(z.value.sections):z instanceof al?k(z.sections):z.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return w}}let Zm;var zv={get paint(){return Zm=Zm||new Cr({"background-color":new Zt(we.paint_background["background-color"]),"background-pattern":new Ca(we.paint_background["background-pattern"]),"background-opacity":new Zt(we.paint_background["background-opacity"])})}};class Dv extends ao{constructor(n){super(n,zv)}}let Gm;var Rv={get paint(){return Gm=Gm||new Cr({"raster-opacity":new Zt(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new Zt(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Zt(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Zt(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Zt(we.paint_raster["raster-saturation"]),"raster-contrast":new Zt(we.paint_raster["raster-contrast"]),"raster-resampling":new Zt(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Zt(we.paint_raster["raster-fade-duration"])})}};class Bv extends ao{constructor(n){super(n,Rv)}}class Fv extends ao{constructor(n){super(n,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ov{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Af=63710088e-1;class Ws{constructor(n,c){if(isNaN(n)||isNaN(c))throw new Error(`Invalid LngLat object: (${n}, ${c})`);if(this.lng=+n,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ws(ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const c=Math.PI/180,f=this.lat*c,g=n.lat*c,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((n.lng-this.lng)*c);return Af*Math.acos(Math.min(w,1))}static convert(n){if(n instanceof Ws)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ws(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ws(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Wm=2*Math.PI*Af;function Hm(s){return Wm*Math.cos(s*Math.PI/180)}function Xm(s){return(180+s)/360}function Km(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Jm(s,n){return s/Hm(n)}function Pf(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Xh{constructor(n,c,f=0){this.x=+n,this.y=+c,this.z=+f}static fromLngLat(n,c=0){const f=Ws.convert(n);return new Xh(Xm(f.lng),Km(f.lat),Jm(c,f.lat))}toLngLat(){return new Ws(360*this.x-180,Pf(this.y))}toAltitude(){return this.z*Hm(Pf(this.y))}meterInMercatorCoordinateUnits(){return 1/Wm*(n=Pf(this.y),1/Math.cos(n*Math.PI/180));var n}}function Ym(s,n,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,n*f-2*Math.PI*6378137/2]}class zf{constructor(n,c,f){if(n<0||n>25||f<0||f>=Math.pow(2,n)||c<0||c>=Math.pow(2,n))throw new Error(`x=${c}, y=${f}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=c,this.y=f,this.key=au(0,n,n,c,f)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,c,f){const g=(k=this.y,T=this.z,I=Ym(256*(w=this.x),256*(k=Math.pow(2,T)-k-1),T),z=Ym(256*(w+1),256*(k+1),T),I[0]+","+I[1]+","+z[0]+","+z[1]);var w,k,T,I,z;const O=function(U,H,Y){let ee,he="";for(let ge=U;ge>0;ge--)ee=1<<ge-1,he+=(H&ee?1:0)+(Y&ee?2:0);return he}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(n){const c=this.z-n.z;return c>0&&n.x===this.x>>c&&n.y===this.y>>c}getTilePoint(n){const c=Math.pow(2,this.z);return new S((n.x*c-this.x)*Sn,(n.y*c-this.y)*Sn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Qm{constructor(n,c){this.wrap=n,this.canonical=c,this.key=au(n,c.z,c.z,c.x,c.y)}}class co{constructor(n,c,f,g,w){if(n<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${f}`);this.overscaledZ=n,this.wrap=c,this.canonical=new zf(f,+g,+w),this.key=au(c,n,f,g,w)}clone(){return new co(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?new co(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new co(n,this.wrap,n,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(n,c){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-n;return n>this.canonical.z?au(this.wrap*+c,n,this.canonical.z,this.canonical.x,this.canonical.y):au(this.wrap*+c,n,n,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const c=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>c&&n.canonical.y===this.canonical.y>>c}children(n){if(this.overscaledZ>=n)return[new co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new co(c,this.wrap,c,f,g),new co(c,this.wrap,c,f+1,g),new co(c,this.wrap,c,f,g+1),new co(c,this.wrap,c,f+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new co(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Qm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Xh(n.x-this.wrap,n.y))}}function au(s,n,c,f,g){(s*=2)<0&&(s=-1*s-1);const w=1<<c;return(w*w*s+w*g+f).toString(36)+c.toString(36)+n.toString(36)}zt("CanonicalTileID",zf),zt("OverscaledTileID",co,{omit:["posMatrix"]});class eg{constructor(n,c,f,g=1,w=1,k=1,T=0){if(this.uid=n,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void st(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=k,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<I;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(I,z)]=this.data[this._idx(I-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,I)]=this.data[this._idx(z,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<I;z++)for(let O=0;O<I;O++){const U=this.get(z,O);U>this.max&&(this.max=U),U<this.min&&(this.min=U)}}get(n,c){const f=new Uint8Array(this.data.buffer),g=4*this._idx(n,c);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,c){if(n<-1||n>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(n+1)}unpack(n,c,f){return n*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,c,f){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,w=c*this.dim+this.dim,k=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:k=T-1;break;case 1:T=k+1}const I=-c*this.dim,z=-f*this.dim;for(let O=k;O<T;O++)for(let U=g;U<w;U++)this.data[this._idx(U,O)]=n.data[this._idx(U+I,O+z)]}}zt("DEMData",eg);class tg{constructor(n){this._stringToNumber={},this._numberToString=[];for(let c=0;c<n.length;c++){const f=n[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class ig{constructor(n,c,f,g,w){this.type="Feature",this._vectorTileFeature=n,n._z=c,n._x=f,n._y=g,this.properties=n.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(n[c]=this[c]);return n}}class ng{constructor(n,c){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ka(Sn,16,0),this.grid3D=new ka(Sn,16,0),this.featureIndexArray=new V,this.promoteId=c}insert(n,c,f,g,w,k){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);const I=k?this.grid3D:this.grid;for(let z=0;z<c.length;z++){const O=c[z],U=[1/0,1/0,-1/0,-1/0];for(let H=0;H<O.length;H++){const Y=O[H];U[0]=Math.min(U[0],Y.x),U[1]=Math.min(U[1],Y.y),U[2]=Math.max(U[2],Y.x),U[3]=Math.max(U[3],Y.y)}U[0]<Sn&&U[1]<Sn&&U[2]>=0&&U[3]>=0&&I.insert(T,U[0],U[1],U[2],U[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new qs.VectorTile(new wf(this.rawTileData)).layers,this.sourceLayerCoder=new tg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,c,f,g){this.loadVTLayers();const w=n.params||{},k=Sn/n.tileSize/n.scale,T=fl(w.filter),I=n.queryGeometry,z=n.queryPadding*k,O=og(I),U=this.grid.query(O.minX-z,O.minY-z,O.maxX+z,O.maxY+z),H=og(n.cameraQueryGeometry),Y=this.grid3D.query(H.minX-z,H.minY-z,H.maxX+z,H.maxY+z,(ge,xe,Oe,Ee)=>function(De,Ye,et,Lt,$t){for(const Tt of De)if(Ye<=Tt.x&&et<=Tt.y&&Lt>=Tt.x&&$t>=Tt.y)return!0;const It=[new S(Ye,et),new S(Ye,$t),new S(Lt,$t),new S(Lt,et)];if(De.length>2){for(const Tt of It)if(zl(De,Tt))return!0}for(let Tt=0;Tt<De.length-1;Tt++)if(g1(De[Tt],De[Tt+1],It))return!0;return!1}(n.cameraQueryGeometry,ge-z,xe-z,Oe+z,Ee+z));for(const ge of Y)U.push(ge);U.sort(Nv);const ee={};let he;for(let ge=0;ge<U.length;ge++){const xe=U[ge];if(xe===he)continue;he=xe;const Oe=this.featureIndexArray.get(xe);let Ee=null;this.loadMatchingFeature(ee,Oe.bucketIndex,Oe.sourceLayerIndex,Oe.featureIndex,T,w.layers,w.availableImages,c,f,g,(De,Ye,et)=>(Ee||(Ee=ps(De)),Ye.queryIntersectsFeature(I,De,et,Ee,this.z,n.transform,k,n.pixelPosMatrix)))}return ee}loadMatchingFeature(n,c,f,g,w,k,T,I,z,O,U){const H=this.bucketLayerIDs[c];if(k&&!function(ge,xe){for(let Oe=0;Oe<ge.length;Oe++)if(xe.indexOf(ge[Oe])>=0)return!0;return!1}(k,H))return;const Y=this.sourceLayerCoder.decode(f),ee=this.vtLayers[Y].feature(g);if(w.needGeometry){const ge=ms(ee,!0);if(!w.filter(new ln(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!w.filter(new ln(this.tileID.overscaledZ),ee))return;const he=this.getId(ee,Y);for(let ge=0;ge<H.length;ge++){const xe=H[ge];if(k&&k.indexOf(xe)<0)continue;const Oe=I[xe];if(!Oe)continue;let Ee={};he&&O&&(Ee=O.getState(Oe.sourceLayer||"_geojsonTileLayer",he));const De=J({},z[xe]);De.paint=rg(De.paint,Oe.paint,ee,Ee,T),De.layout=rg(De.layout,Oe.layout,ee,Ee,T);const Ye=!U||U(ee,Oe,Ee);if(!Ye)continue;const et=new ig(ee,this.z,this.x,this.y,he);et.layer=De;let Lt=n[xe];Lt===void 0&&(Lt=n[xe]=[]),Lt.push({featureIndex:g,feature:et,intersectionZ:Ye})}}lookupSymbolFeatures(n,c,f,g,w,k,T,I){const z={};this.loadVTLayers();const O=fl(w);for(const U of n)this.loadMatchingFeature(z,f,g,U,O,k,T,I,c);return z}hasLayer(n){for(const c of this.bucketLayerIDs)for(const f of c)if(n===f)return!0;return!1}getId(n,c){let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function rg(s,n,c,f,g){return ye(s,(w,k)=>{const T=n instanceof Ta?n.get(k):null;return T&&T.evaluate?T.evaluate(c,f,g):T})}function og(s){let n=1/0,c=1/0,f=-1/0,g=-1/0;for(const w of s)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return{minX:n,minY:c,maxX:f,maxY:g}}function Nv(s,n){return n-s}function sg(s,n,c,f,g){const w=[];for(let k=0;k<s.length;k++){const T=s[k];let I;for(let z=0;z<T.length-1;z++){let O=T[z],U=T[z+1];O.x<n&&U.x<n||(O.x<n?O=new S(n,O.y+(n-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x<n&&(U=new S(n,O.y+(n-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y<c&&U.y<c||(O.y<c?O=new S(O.x+(c-O.y)/(U.y-O.y)*(U.x-O.x),c)._round():U.y<c&&(U=new S(O.x+(c-O.y)/(U.y-O.y)*(U.x-O.x),c)._round()),O.x>=f&&U.x>=f||(O.x>=f?O=new S(f,O.y+(f-O.x)/(U.x-O.x)*(U.y-O.y))._round():U.x>=f&&(U=new S(f,O.y+(f-O.x)/(U.x-O.x)*(U.y-O.y))._round()),O.y>=g&&U.y>=g||(O.y>=g?O=new S(O.x+(g-O.y)/(U.y-O.y)*(U.x-O.x),g)._round():U.y>=g&&(U=new S(O.x+(g-O.y)/(U.y-O.y)*(U.x-O.x),g)._round()),I&&O.equals(I[I.length-1])||(I=[O],w.push(I)),I.push(U)))))}}return w}zt("FeatureIndex",ng,{omit:["rawTileData","sourceLayerCoder"]});class Hs extends S{constructor(n,c,f,g){super(n,c),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Hs(this.x,this.y,this.angle,this.segment)}}function ag(s,n,c,f,g){if(n.segment===void 0||c===0)return!0;let w=n,k=n.segment+1,T=0;for(;T>-c/2;){if(k--,k<0)return!1;T-=s[k].dist(w),w=s[k]}T+=s[k].dist(s[k+1]),k++;const I=[];let z=0;for(;T<c/2;){const O=s[k],U=s[k+1];if(!U)return!1;let H=s[k-1].angleTo(O)-O.angleTo(U);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:H}),z+=H;T-I[0].distance>f;)z-=I.shift().angleDelta;if(z>g)return!1;k++,T+=O.dist(U)}return!0}function lg(s){let n=0;for(let c=0;c<s.length-1;c++)n+=s[c].dist(s[c+1]);return n}function cg(s,n,c){return s?.6*n*c:0}function ug(s,n){return Math.max(s?s.right-s.left:0,n?n.right-n.left:0)}function $v(s,n,c,f,g,w){const k=cg(c,g,w),T=ug(c,f)*w;let I=0;const z=lg(s)/2;for(let O=0;O<s.length-1;O++){const U=s[O],H=s[O+1],Y=U.dist(H);if(I+Y>z){const ee=(z-I)/Y,he=gr.number(U.x,H.x,ee),ge=gr.number(U.y,H.y,ee),xe=new Hs(he,ge,H.angleTo(U),O);return xe._round(),!k||ag(s,xe,T,k,n)?xe:void 0}I+=Y}}function jv(s,n,c,f,g,w,k,T,I){const z=cg(f,w,k),O=ug(f,g),U=O*k,H=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return n-U<n/4&&(n=U+n/4),hg(s,H?n/2*T%n:(O/2+2*w)*k*T%n,n,z,c,U,H,!1,I)}function hg(s,n,c,f,g,w,k,T,I){const z=w/2,O=lg(s);let U=0,H=n-c,Y=[];for(let ee=0;ee<s.length-1;ee++){const he=s[ee],ge=s[ee+1],xe=he.dist(ge),Oe=ge.angleTo(he);for(;H+c<U+xe;){H+=c;const Ee=(H-U)/xe,De=gr.number(he.x,ge.x,Ee),Ye=gr.number(he.y,ge.y,Ee);if(De>=0&&De<I&&Ye>=0&&Ye<I&&H-z>=0&&H+z<=O){const et=new Hs(De,Ye,Oe,ee);et._round(),f&&!ag(s,et,w,f,g)||Y.push(et)}}U+=xe}return T||Y.length||k||(Y=hg(s,U/2,c,f,g,w,k,!0,I)),Y}zt("Anchor",Hs);const jl=jr;function dg(s,n,c,f){const g=[],w=s.image,k=w.pixelRatio,T=w.paddedRect.w-2*jl,I=w.paddedRect.h-2*jl,z=s.right-s.left,O=s.bottom-s.top,U=w.stretchX||[[0,T]],H=w.stretchY||[[0,I]],Y=(_t,Bt)=>_t+Bt[1]-Bt[0],ee=U.reduce(Y,0),he=H.reduce(Y,0),ge=T-ee,xe=I-he;let Oe=0,Ee=ee,De=0,Ye=he,et=0,Lt=ge,$t=0,It=xe;if(w.content&&f){const _t=w.content;Oe=Kh(U,0,_t[0]),De=Kh(H,0,_t[1]),Ee=Kh(U,_t[0],_t[2]),Ye=Kh(H,_t[1],_t[3]),et=_t[0]-Oe,$t=_t[1]-De,Lt=_t[2]-_t[0]-Ee,It=_t[3]-_t[1]-Ye}const Tt=(_t,Bt,kt,ut)=>{const Xt=Jh(_t.stretch-Oe,Ee,z,s.left),qt=Yh(_t.fixed-et,Lt,_t.stretch,ee),vi=Jh(Bt.stretch-De,Ye,O,s.top),on=Yh(Bt.fixed-$t,It,Bt.stretch,he),un=Jh(kt.stretch-Oe,Ee,z,s.left),Wn=Yh(kt.fixed-et,Lt,kt.stretch,ee),Qr=Jh(ut.stretch-De,Ye,O,s.top),Er=Yh(ut.fixed-$t,It,ut.stretch,he),$n=new S(Xt,vi),ir=new S(un,vi),cr=new S(un,Qr),Ir=new S(Xt,Qr),Lr=new S(qt/k,on/k),Hn=new S(Wn/k,Er/k),Xn=n*Math.PI/180;if(Xn){const vr=Math.sin(Xn),Ur=Math.cos(Xn),Vr=[Ur,-vr,vr,Ur];$n._matMult(Vr),ir._matMult(Vr),Ir._matMult(Vr),cr._matMult(Vr)}const yr=_t.stretch+_t.fixed,Ar=Bt.stretch+Bt.fixed;return{tl:$n,tr:ir,bl:Ir,br:cr,tex:{x:w.paddedRect.x+jl+yr,y:w.paddedRect.y+jl+Ar,w:kt.stretch+kt.fixed-yr,h:ut.stretch+ut.fixed-Ar},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:Hn,minFontScaleX:Lt/k/z,minFontScaleY:It/k/O,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const _t=fg(U,ge,ee),Bt=fg(H,xe,he);for(let kt=0;kt<_t.length-1;kt++){const ut=_t[kt],Xt=_t[kt+1];for(let qt=0;qt<Bt.length-1;qt++)g.push(Tt(ut,Bt[qt],Xt,Bt[qt+1]))}}else g.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return g}function Kh(s,n,c){let f=0;for(const g of s)f+=Math.max(n,Math.min(c,g[1]))-Math.max(n,Math.min(c,g[0]));return f}function fg(s,n,c){const f=[{fixed:-jl,stretch:0}];for(const[g,w]of s){const k=f[f.length-1];f.push({fixed:g-k.stretch,stretch:k.stretch}),f.push({fixed:g-k.stretch,stretch:k.stretch+(w-g)})}return f.push({fixed:n+jl,stretch:c}),f}function Jh(s,n,c,f){return s/n*c+f}function Yh(s,n,c,f){return s-n*c/f}class Qh{constructor(n,c,f,g,w,k,T,I,z,O){if(this.boxStartIndex=n.length,z){let U=k.top,H=k.bottom;const Y=k.collisionPadding;Y&&(U-=Y[1],H+=Y[3]);let ee=H-U;ee>0&&(ee=Math.max(10,ee),this.circleDiameter=ee)}else{let U=k.top*T-I[0],H=k.bottom*T+I[2],Y=k.left*T-I[3],ee=k.right*T+I[1];const he=k.collisionPadding;if(he&&(Y-=he[0]*T,U-=he[1]*T,ee+=he[2]*T,H+=he[3]*T),O){const ge=new S(Y,U),xe=new S(ee,U),Oe=new S(Y,H),Ee=new S(ee,H),De=O*Math.PI/180;ge._rotate(De),xe._rotate(De),Oe._rotate(De),Ee._rotate(De),Y=Math.min(ge.x,xe.x,Oe.x,Ee.x),ee=Math.max(ge.x,xe.x,Oe.x,Ee.x),U=Math.min(ge.y,xe.y,Oe.y,Ee.y),H=Math.max(ge.y,xe.y,Oe.y,Ee.y)}n.emplaceBack(c.x,c.y,Y,U,ee,H,f,g,w)}this.boxEndIndex=n.length}}class Uv{constructor(n=[],c=Vv){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:f}=this,g=c[n];for(;n>0;){const w=n-1>>1,k=c[w];if(f(g,k)>=0)break;c[n]=k,n=w}c[n]=g}_down(n){const{data:c,compare:f}=this,g=this.length>>1,w=c[n];for(;n<g;){let k=1+(n<<1),T=c[k];const I=k+1;if(I<this.length&&f(c[I],T)<0&&(k=I,T=c[I]),f(T,w)>=0)break;c[n]=T,n=k}c[n]=w}}function Vv(s,n){return s<n?-1:s>n?1:0}function qv(s,n=1,c=!1){let f=1/0,g=1/0,w=-1/0,k=-1/0;const T=s[0];for(let Y=0;Y<T.length;Y++){const ee=T[Y];(!Y||ee.x<f)&&(f=ee.x),(!Y||ee.y<g)&&(g=ee.y),(!Y||ee.x>w)&&(w=ee.x),(!Y||ee.y>k)&&(k=ee.y)}const I=Math.min(w-f,k-g);let z=I/2;const O=new Uv([],Zv);if(I===0)return new S(f,g);for(let Y=f;Y<w;Y+=I)for(let ee=g;ee<k;ee+=I)O.push(new Ul(Y+z,ee+z,z,s));let U=function(Y){let ee=0,he=0,ge=0;const xe=Y[0];for(let Oe=0,Ee=xe.length,De=Ee-1;Oe<Ee;De=Oe++){const Ye=xe[Oe],et=xe[De],Lt=Ye.x*et.y-et.x*Ye.y;he+=(Ye.x+et.x)*Lt,ge+=(Ye.y+et.y)*Lt,ee+=3*Lt}return new Ul(he/ee,ge/ee,0,Y)}(s),H=O.length;for(;O.length;){const Y=O.pop();(Y.d>U.d||!U.d)&&(U=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,H)),Y.max-U.d<=n||(z=Y.h/2,O.push(new Ul(Y.p.x-z,Y.p.y-z,z,s)),O.push(new Ul(Y.p.x+z,Y.p.y-z,z,s)),O.push(new Ul(Y.p.x-z,Y.p.y+z,z,s)),O.push(new Ul(Y.p.x+z,Y.p.y+z,z,s)),H+=4)}return c&&(console.log(`num probes: ${H}`),console.log(`best distance: ${U.d}`)),U.p}function Zv(s,n){return n.max-s.max}function Ul(s,n,c,f){this.p=new S(s,n),this.h=c,this.d=function(g,w){let k=!1,T=1/0;for(let I=0;I<w.length;I++){const z=w[I];for(let O=0,U=z.length,H=U-1;O<U;H=O++){const Y=z[O],ee=z[H];Y.y>g.y!=ee.y>g.y&&g.x<(ee.x-Y.x)*(g.y-Y.y)/(ee.y-Y.y)+Y.x&&(k=!k),T=Math.min(T,Kp(g,Y,ee))}}return(k?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var lr;d.ap=void 0,(lr=d.ap||(d.ap={}))[lr.center=1]="center",lr[lr.left=2]="left",lr[lr.right=3]="right",lr[lr.top=4]="top",lr[lr.bottom=5]="bottom",lr[lr["top-left"]=6]="top-left",lr[lr["top-right"]=7]="top-right",lr[lr["bottom-left"]=8]="bottom-left",lr[lr["bottom-right"]=9]="bottom-right";const Xs=7,Df=Number.POSITIVE_INFINITY;function pg(s,n){return n[1]!==Df?function(c,f,g){let w=0,k=0;switch(f=Math.abs(f),g=Math.abs(g),c){case"top-right":case"top-left":case"top":k=g-Xs;break;case"bottom-right":case"bottom-left":case"bottom":k=-g+Xs}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,k]}(s,n[0],n[1]):function(c,f){let g=0,w=0;f<0&&(f=0);const k=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=k-Xs;break;case"bottom-right":case"bottom-left":w=-k+Xs;break;case"bottom":w=-f+Xs;break;case"top":w=f-Xs}switch(c){case"top-right":case"bottom-right":g=-k;break;case"top-left":case"bottom-left":g=k;break;case"left":g=f;break;case"right":g=-f}return[g,w]}(s,n[0])}function mg(s,n,c){var f;const g=s.layout,w=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(n,{},c);if(w){const T=w.values,I=[];for(let z=0;z<T.length;z+=2){const O=I[z]=T[z],U=T[z+1].map(H=>H*Gn);O.startsWith("top")?U[1]-=Xs:O.startsWith("bottom")&&(U[1]+=Xs),I[z+1]=U}return new Xr(I)}const k=g.get("text-variable-anchor");if(k){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(n,{},c)*Gn,Df]:g.get("text-offset").evaluate(n,{},c).map(z=>z*Gn);const I=[];for(const z of k)I.push(z,pg(z,T));return new Xr(I)}return null}function Rf(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gv(s,n,c,f,g,w,k,T,I,z,O){let U=w.textMaxSize.evaluate(n,{});U===void 0&&(U=k);const H=s.layers[0].layout,Y=H.get("icon-offset").evaluate(n,{},O),ee=_g(c.horizontal),he=k/24,ge=s.tilePixelRatio*he,xe=s.tilePixelRatio*U/24,Oe=s.tilePixelRatio*T,Ee=s.tilePixelRatio*H.get("symbol-spacing"),De=H.get("text-padding")*s.tilePixelRatio,Ye=function(ut,Xt,qt,vi=1){const on=ut.get("icon-padding").evaluate(Xt,{},qt),un=on&&on.values;return[un[0]*vi,un[1]*vi,un[2]*vi,un[3]*vi]}(H,n,O,s.tilePixelRatio),et=H.get("text-max-angle")/180*Math.PI,Lt=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",$t=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",It=H.get("symbol-placement"),Tt=Ee/2,_t=H.get("icon-text-fit");let Bt;f&&_t!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Bt=$m(f,c.vertical,_t,H.get("icon-text-fit-padding"),Y,he)),ee&&(f=$m(f,ee,_t,H.get("icon-text-fit-padding"),Y,he)));const kt=(ut,Xt)=>{Xt.x<0||Xt.x>=Sn||Xt.y<0||Xt.y>=Sn||function(qt,vi,on,un,Wn,Qr,Er,$n,ir,cr,Ir,Lr,Hn,Xn,yr,Ar,vr,Ur,Vr,Kn,ki,br,ur,Jn,So){const Ro=qt.addToLineVertexArray(vi,on);let Bo,_s,To,uo,qr=0,ys=0,uu=0,wg=0,Vf=-1,qf=-1;const vs={};let xg=wn("");if(qt.allowVerticalPlacement&&un.vertical){const wr=$n.layout.get("text-rotate").evaluate(ki,{},Jn)+90;To=new Qh(ir,vi,cr,Ir,Lr,un.vertical,Hn,Xn,yr,wr),Er&&(uo=new Qh(ir,vi,cr,Ir,Lr,Er,vr,Ur,yr,wr))}if(Wn){const wr=$n.layout.get("icon-rotate").evaluate(ki,{}),ho=$n.layout.get("icon-text-fit")!=="none",Da=dg(Wn,wr,ur,ho),Oo=Er?dg(Er,wr,ur,ho):void 0;_s=new Qh(ir,vi,cr,Ir,Lr,Wn,vr,Ur,!1,wr),qr=4*Da.length;const Ra=qt.iconSizeData;let es=null;Ra.kind==="source"?(es=[Qo*$n.layout.get("icon-size").evaluate(ki,{})],es[0]>Gs&&st(`${qt.layerIds[0]}: Value for "icon-size" is >= ${su}. Reduce your "icon-size".`)):Ra.kind==="composite"&&(es=[Qo*br.compositeIconSizes[0].evaluate(ki,{},Jn),Qo*br.compositeIconSizes[1].evaluate(ki,{},Jn)],(es[0]>Gs||es[1]>Gs)&&st(`${qt.layerIds[0]}: Value for "icon-size" is >= ${su}. Reduce your "icon-size".`)),qt.addSymbols(qt.icon,Da,es,Kn,Vr,ki,d.ah.none,vi,Ro.lineStartIndex,Ro.lineLength,-1,Jn),Vf=qt.icon.placedSymbolArray.length-1,Oo&&(ys=4*Oo.length,qt.addSymbols(qt.icon,Oo,es,Kn,Vr,ki,d.ah.vertical,vi,Ro.lineStartIndex,Ro.lineLength,-1,Jn),qf=qt.icon.placedSymbolArray.length-1)}const kg=Object.keys(un.horizontal);for(const wr of kg){const ho=un.horizontal[wr];if(!Bo){xg=wn(ho.text);const Oo=$n.layout.get("text-rotate").evaluate(ki,{},Jn);Bo=new Qh(ir,vi,cr,Ir,Lr,ho,Hn,Xn,yr,Oo)}const Da=ho.positionedLines.length===1;if(uu+=gg(qt,vi,ho,Qr,$n,yr,ki,Ar,Ro,un.vertical?d.ah.horizontal:d.ah.horizontalOnly,Da?kg:[wr],vs,Vf,br,Jn),Da)break}un.vertical&&(wg+=gg(qt,vi,un.vertical,Qr,$n,yr,ki,Ar,Ro,d.ah.vertical,["vertical"],vs,qf,br,Jn));const Xv=Bo?Bo.boxStartIndex:qt.collisionBoxArray.length,Kv=Bo?Bo.boxEndIndex:qt.collisionBoxArray.length,Jv=To?To.boxStartIndex:qt.collisionBoxArray.length,Yv=To?To.boxEndIndex:qt.collisionBoxArray.length,Qv=_s?_s.boxStartIndex:qt.collisionBoxArray.length,eb=_s?_s.boxEndIndex:qt.collisionBoxArray.length,tb=uo?uo.boxStartIndex:qt.collisionBoxArray.length,ib=uo?uo.boxEndIndex:qt.collisionBoxArray.length;let Fo=-1;const td=(wr,ho)=>wr&&wr.circleDiameter?Math.max(wr.circleDiameter,ho):ho;Fo=td(Bo,Fo),Fo=td(To,Fo),Fo=td(_s,Fo),Fo=td(uo,Fo);const Sg=Fo>-1?1:0;Sg&&(Fo*=So/Gn),qt.glyphOffsetArray.length>=$l.MAX_GLYPHS&&st("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ki.sortKey!==void 0&&qt.addToSortKeyRanges(qt.symbolInstances.length,ki.sortKey);const nb=mg($n,ki,Jn),[rb,ob]=function(wr,ho){const Da=wr.length,Oo=ho==null?void 0:ho.values;if((Oo==null?void 0:Oo.length)>0)for(let Ra=0;Ra<Oo.length;Ra+=2){const es=Oo[Ra+1];wr.emplaceBack(d.ap[Oo[Ra]],es[0],es[1])}return[Da,wr.length]}(qt.textAnchorOffsets,nb);qt.symbolInstances.emplaceBack(vi.x,vi.y,vs.right>=0?vs.right:-1,vs.center>=0?vs.center:-1,vs.left>=0?vs.left:-1,vs.vertical||-1,Vf,qf,xg,Xv,Kv,Jv,Yv,Qv,eb,tb,ib,cr,uu,wg,qr,ys,Sg,0,Hn,Fo,rb,ob)}(s,Xt,ut,c,f,g,Bt,s.layers[0],s.collisionBoxArray,n.index,n.sourceLayerIndex,s.index,ge,[De,De,De,De],Lt,I,Oe,Ye,$t,Y,n,w,z,O,k)};if(It==="line")for(const ut of sg(n.geometry,0,0,Sn,Sn)){const Xt=jv(ut,Ee,et,c.vertical||ee,f,24,xe,s.overscaling,Sn);for(const qt of Xt)ee&&Wv(s,ee.text,Tt,qt)||kt(ut,qt)}else if(It==="line-center"){for(const ut of n.geometry)if(ut.length>1){const Xt=$v(ut,et,c.vertical||ee,f,24,xe);Xt&&kt(ut,Xt)}}else if(n.type==="Polygon")for(const ut of ff(n.geometry,0)){const Xt=qv(ut,16);kt(ut[0],new Hs(Xt.x,Xt.y,0))}else if(n.type==="LineString")for(const ut of n.geometry)kt(ut,new Hs(ut[0].x,ut[0].y,0));else if(n.type==="Point")for(const ut of n.geometry)for(const Xt of ut)kt([Xt],new Hs(Xt.x,Xt.y,0))}function gg(s,n,c,f,g,w,k,T,I,z,O,U,H,Y,ee){const he=function(Oe,Ee,De,Ye,et,Lt,$t,It){const Tt=Ye.layout.get("text-rotate").evaluate(Lt,{})*Math.PI/180,_t=[];for(const Bt of Ee.positionedLines)for(const kt of Bt.positionedGlyphs){if(!kt.rect)continue;const ut=kt.rect||{};let Xt=zm+1,qt=!0,vi=1,on=0;const un=(et||It)&&kt.vertical,Wn=kt.metrics.advance*kt.scale/2;if(It&&Ee.verticalizable&&(on=Bt.lineOffset/2-(kt.imageName?-(Gn-kt.metrics.width*kt.scale)/2:(kt.scale-1)*Gn)),kt.imageName){const Kn=$t[kt.imageName];qt=Kn.sdf,vi=Kn.pixelRatio,Xt=jr/vi}const Qr=et?[kt.x+Wn,kt.y]:[0,0];let Er=et?[0,0]:[kt.x+Wn+De[0],kt.y+De[1]-on],$n=[0,0];un&&($n=Er,Er=[0,0]);const ir=kt.metrics.isDoubleResolution?2:1,cr=(kt.metrics.left-Xt)*kt.scale-Wn+Er[0],Ir=(-kt.metrics.top-Xt)*kt.scale+Er[1],Lr=cr+ut.w/ir*kt.scale/vi,Hn=Ir+ut.h/ir*kt.scale/vi,Xn=new S(cr,Ir),yr=new S(Lr,Ir),Ar=new S(cr,Hn),vr=new S(Lr,Hn);if(un){const Kn=new S(-Wn,Wn-ru),ki=-Math.PI/2,br=Gn/2-Wn,ur=new S(5-ru-br,-(kt.imageName?br:0)),Jn=new S(...$n);Xn._rotateAround(ki,Kn)._add(ur)._add(Jn),yr._rotateAround(ki,Kn)._add(ur)._add(Jn),Ar._rotateAround(ki,Kn)._add(ur)._add(Jn),vr._rotateAround(ki,Kn)._add(ur)._add(Jn)}if(Tt){const Kn=Math.sin(Tt),ki=Math.cos(Tt),br=[ki,-Kn,Kn,ki];Xn._matMult(br),yr._matMult(br),Ar._matMult(br),vr._matMult(br)}const Ur=new S(0,0),Vr=new S(0,0);_t.push({tl:Xn,tr:yr,bl:Ar,br:vr,tex:ut,writingMode:Ee.writingMode,glyphOffset:Qr,sectionIndex:kt.sectionIndex,isSDF:qt,pixelOffsetTL:Ur,pixelOffsetBR:Vr,minFontScaleX:0,minFontScaleY:0})}return _t}(0,c,T,g,w,k,f,s.allowVerticalPlacement),ge=s.textSizeData;let xe=null;ge.kind==="source"?(xe=[Qo*g.layout.get("text-size").evaluate(k,{})],xe[0]>Gs&&st(`${s.layerIds[0]}: Value for "text-size" is >= ${su}. Reduce your "text-size".`)):ge.kind==="composite"&&(xe=[Qo*Y.compositeTextSizes[0].evaluate(k,{},ee),Qo*Y.compositeTextSizes[1].evaluate(k,{},ee)],(xe[0]>Gs||xe[1]>Gs)&&st(`${s.layerIds[0]}: Value for "text-size" is >= ${su}. Reduce your "text-size".`)),s.addSymbols(s.text,he,xe,T,w,k,z,n,I.lineStartIndex,I.lineLength,H,ee);for(const Oe of O)U[Oe]=s.text.placedSymbolArray.length-1;return 4*he.length}function _g(s){for(const n in s)return s[n];return null}function Wv(s,n,c,f){const g=s.compareText;if(n in g){const w=g[n];for(let k=w.length-1;k>=0;k--)if(f.dist(w[k])<c)return!0}else g[n]=[];return g[n].push(f),!1}const yg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Bf{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(n,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=yg[15&f];if(!w)throw new Error("Unrecognized array type.");const[k]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new Bf(T,k,w,n)}constructor(n,c=64,f=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=yg.indexOf(this.ArrayType),k=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+I,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+k+T+I),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+I,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=n)}add(n,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=n,this.coords[this._pos++]=c,f}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Ff(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:k,nodeSize:T}=this,I=[0,w.length-1,0],z=[];for(;I.length;){const O=I.pop()||0,U=I.pop()||0,H=I.pop()||0;if(U-H<=T){for(let ge=H;ge<=U;ge++){const xe=k[2*ge],Oe=k[2*ge+1];xe>=n&&xe<=f&&Oe>=c&&Oe<=g&&z.push(w[ge])}continue}const Y=H+U>>1,ee=k[2*Y],he=k[2*Y+1];ee>=n&&ee<=f&&he>=c&&he<=g&&z.push(w[Y]),(O===0?n<=ee:c<=he)&&(I.push(H),I.push(Y-1),I.push(1-O)),(O===0?f>=ee:g>=he)&&(I.push(Y+1),I.push(U),I.push(1-O))}return z}within(n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:k}=this,T=[0,g.length-1,0],I=[],z=f*f;for(;T.length;){const O=T.pop()||0,U=T.pop()||0,H=T.pop()||0;if(U-H<=k){for(let ge=H;ge<=U;ge++)bg(w[2*ge],w[2*ge+1],n,c)<=z&&I.push(g[ge]);continue}const Y=H+U>>1,ee=w[2*Y],he=w[2*Y+1];bg(ee,he,n,c)<=z&&I.push(g[Y]),(O===0?n-f<=ee:c-f<=he)&&(T.push(H),T.push(Y-1),T.push(1-O)),(O===0?n+f>=ee:c+f>=he)&&(T.push(Y+1),T.push(U),T.push(1-O))}return I}}function Ff(s,n,c,f,g,w){if(g-f<=c)return;const k=f+g>>1;vg(s,n,k,f,g,w),Ff(s,n,c,f,k-1,1-w),Ff(s,n,c,k+1,g,1-w)}function vg(s,n,c,f,g,w){for(;g>f;){if(g-f>600){const z=g-f+1,O=c-f+1,U=Math.log(z),H=.5*Math.exp(2*U/3),Y=.5*Math.sqrt(U*H*(z-H)/z)*(O-z/2<0?-1:1);vg(s,n,c,Math.max(f,Math.floor(c-O*H/z+Y)),Math.min(g,Math.floor(c+(z-O)*H/z+Y)),w)}const k=n[2*c+w];let T=f,I=g;for(lu(s,n,f,c),n[2*g+w]>k&&lu(s,n,f,g);T<I;){for(lu(s,n,T,I),T++,I--;n[2*T+w]<k;)T++;for(;n[2*I+w]>k;)I--}n[2*f+w]===k?lu(s,n,f,I):(I++,lu(s,n,I,g)),I<=c&&(f=I+1),c<=I&&(g=I-1)}}function lu(s,n,c,f){Of(s,c,f),Of(n,2*c,2*f),Of(n,2*c+1,2*f+1)}function Of(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}function bg(s,n,c,f){const g=s-c,w=n-f;return g*g+w*w}var Nf;d.bd=void 0,(Nf=d.bd||(d.bd={})).create="create",Nf.load="load",Nf.fullLoad="fullLoad";let ed=null,cu=[];const $f=1e3/60,jf="loadTime",Uf="fullLoadTime",Hv={mark(s){performance.mark(s)},frame(s){const n=s;ed!=null&&cu.push(n-ed),ed=n},clearMetrics(){ed=null,cu=[],performance.clearMeasures(jf),performance.clearMeasures(Uf);for(const s in d.bd)performance.clearMarks(d.bd[s])},getPerformanceMetrics(){performance.measure(jf,d.bd.create,d.bd.load),performance.measure(Uf,d.bd.create,d.bd.fullLoad);const s=performance.getEntriesByName(jf)[0].duration,n=performance.getEntriesByName(Uf)[0].duration,c=cu.length,f=1/(cu.reduce((w,k)=>w+k,0)/c/1e3),g=cu.filter(w=>w>$f).reduce((w,k)=>w+(k-$f)/$f,0);return{loadTime:s,fullLoadTime:n,fps:f,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};d.$=vt,d.A=Dl,d.B=function(s){if(pt==null){const n=s.navigator?s.navigator.userAgent:null;pt=!!s.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return pt},d.C=class{constructor(s,n){this.target=s,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ov(()=>this.process()),this.subscription=function(c,f,g,w){return c.addEventListener(f,g,!1),{unsubscribe:()=>{c.removeEventListener(f,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=wt(self)?s:window}registerMessageHandler(s,n){this.messageHandlers[s]=n}sendAsync(s,n){return new Promise((c,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:f},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],k=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:$s(s.data,w)});this.target.postMessage(k,{transfer:w})})}receive(s){const n=s.data,c=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(wt(self)||n.mustQueue)return this.tasks[c]=n,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,n)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),n=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(s,n)}processTask(s,n){return a(this,void 0,void 0,function*(){if(n.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(n.error?g.reject(js(n.error)):g.resolve(js(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=js(n.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[n.type](n.sourceMapId,c,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,n,c){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?$s(n):null,data:$s(c,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.D=Zt,d.E=bt,d.F=function(){var s=new Dl(16);return Dl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.G=Jt,d.H=function(s,n,c){var f,g,w,k,T,I,z,O,U,H,Y,ee,he=c[0],ge=c[1],xe=c[2];return n===s?(s[12]=n[0]*he+n[4]*ge+n[8]*xe+n[12],s[13]=n[1]*he+n[5]*ge+n[9]*xe+n[13],s[14]=n[2]*he+n[6]*ge+n[10]*xe+n[14],s[15]=n[3]*he+n[7]*ge+n[11]*xe+n[15]):(g=n[1],w=n[2],k=n[3],T=n[4],I=n[5],z=n[6],O=n[7],U=n[8],H=n[9],Y=n[10],ee=n[11],s[0]=f=n[0],s[1]=g,s[2]=w,s[3]=k,s[4]=T,s[5]=I,s[6]=z,s[7]=O,s[8]=U,s[9]=H,s[10]=Y,s[11]=ee,s[12]=f*he+T*ge+U*xe+n[12],s[13]=g*he+I*ge+H*xe+n[13],s[14]=w*he+z*ge+Y*xe+n[14],s[15]=k*he+O*ge+ee*xe+n[15]),s},d.I=kf,d.J=function(s,n,c){var f=c[0],g=c[1],w=c[2];return s[0]=n[0]*f,s[1]=n[1]*f,s[2]=n[2]*f,s[3]=n[3]*f,s[4]=n[4]*g,s[5]=n[5]*g,s[6]=n[6]*g,s[7]=n[7]*g,s[8]=n[8]*w,s[9]=n[9]*w,s[10]=n[10]*w,s[11]=n[11]*w,s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.K=em,d.L=function(s,n){const c={};for(let f=0;f<n.length;f++){const g=n[f];g in s&&(c[g]=s[g])}return c},d.M=Ws,d.N=Xm,d.O=Km,d.P=S,d.Q=co,d.R=lo,d.S=B,d.T=zc,d.U=N,d.V=oi,d.W=Sn,d.X=An,d.Y=Xh,d.Z=class extends Bc{},d._=a,d.a=Rt,d.a$=function(s,n,c){return s[0]=n[0]*c[0],s[1]=n[1]*c[1],s[2]=n[2]*c[2],s[3]=n[3]*c[3],s},d.a0=zf,d.a1=rt,d.a2=s=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(c=>{n.onloadstart=()=>{c(n)};for(const f of s){const g=window.document.createElement("source");ht(f)||(n.crossOrigin="Anonymous"),g.src=f,n.appendChild(g)}})},d.a3=function(){return te++},d.a4=v,d.a5=$l,d.a6=fl,d.a7=ms,d.a8=ln,d.a9=ig,d.aA=oe,d.aB=function(s,n){if(!s)return[{command:"setStyle",args:[n]}];let c=[];try{if(!Je(s.version,n.version))return[{command:"setStyle",args:[n]}];Je(s.center,n.center)||c.push({command:"setCenter",args:[n.center]}),Je(s.zoom,n.zoom)||c.push({command:"setZoom",args:[n.zoom]}),Je(s.bearing,n.bearing)||c.push({command:"setBearing",args:[n.bearing]}),Je(s.pitch,n.pitch)||c.push({command:"setPitch",args:[n.pitch]}),Je(s.sprite,n.sprite)||c.push({command:"setSprite",args:[n.sprite]}),Je(s.glyphs,n.glyphs)||c.push({command:"setGlyphs",args:[n.glyphs]}),Je(s.transition,n.transition)||c.push({command:"setTransition",args:[n.transition]}),Je(s.light,n.light)||c.push({command:"setLight",args:[n.light]}),Je(s.terrain,n.terrain)||c.push({command:"setTerrain",args:[n.terrain]}),Je(s.sky,n.sky)||c.push({command:"setSky",args:[n.sky]});const f={},g=[];(function(k,T,I,z){let O;for(O in T=T||{},k=k||{})Object.prototype.hasOwnProperty.call(k,O)&&(Object.prototype.hasOwnProperty.call(T,O)||wi(O,I,z));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(k,O)?Je(k[O],T[O])||(k[O].type==="geojson"&&T[O].type==="geojson"&&In(k,T,O)?Vt(I,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):gn(O,T,I,z)):Pi(O,T,I))})(s.sources,n.sources,g,f);const w=[];s.layers&&s.layers.forEach(k=>{"source"in k&&f[k.source]?c.push({command:"removeLayer",args:[k.id]}):w.push(k)}),c=c.concat(g),function(k,T,I){T=T||[];const z=(k=k||[]).map(io),O=T.map(io),U=k.reduce(Oi,{}),H=T.reduce(Oi,{}),Y=z.slice(),ee=Object.create(null);let he,ge,xe,Oe,Ee;for(let De=0,Ye=0;De<z.length;De++)he=z[De],Object.prototype.hasOwnProperty.call(H,he)?Ye++:(Vt(I,{command:"removeLayer",args:[he]}),Y.splice(Y.indexOf(he,Ye),1));for(let De=0,Ye=0;De<O.length;De++)he=O[O.length-1-De],Y[Y.length-1-De]!==he&&(Object.prototype.hasOwnProperty.call(U,he)?(Vt(I,{command:"removeLayer",args:[he]}),Y.splice(Y.lastIndexOf(he,Y.length-Ye),1)):Ye++,Oe=Y[Y.length-De],Vt(I,{command:"addLayer",args:[H[he],Oe]}),Y.splice(Y.length-De,0,he),ee[he]=!0);for(let De=0;De<O.length;De++)if(he=O[De],ge=U[he],xe=H[he],!ee[he]&&!Je(ge,xe))if(Je(ge.source,xe.source)&&Je(ge["source-layer"],xe["source-layer"])&&Je(ge.type,xe.type)){for(Ee in tn(ge.layout,xe.layout,I,he,null,"setLayoutProperty"),tn(ge.paint,xe.paint,I,he,null,"setPaintProperty"),Je(ge.filter,xe.filter)||Vt(I,{command:"setFilter",args:[he,xe.filter]}),Je(ge.minzoom,xe.minzoom)&&Je(ge.maxzoom,xe.maxzoom)||Vt(I,{command:"setLayerZoomRange",args:[he,xe.minzoom,xe.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?tn(ge[Ee],xe[Ee],I,he,Ee.slice(6),"setPaintProperty"):Je(ge[Ee],xe[Ee])||Vt(I,{command:"setLayerProperty",args:[he,Ee,xe[Ee]]}));for(Ee in xe)Object.prototype.hasOwnProperty.call(xe,Ee)&&!Object.prototype.hasOwnProperty.call(ge,Ee)&&Ee!=="layout"&&Ee!=="paint"&&Ee!=="filter"&&Ee!=="metadata"&&Ee!=="minzoom"&&Ee!=="maxzoom"&&(Ee.indexOf("paint.")===0?tn(ge[Ee],xe[Ee],I,he,Ee.slice(6),"setPaintProperty"):Je(ge[Ee],xe[Ee])||Vt(I,{command:"setLayerProperty",args:[he,Ee,xe[Ee]]}))}else Vt(I,{command:"removeLayer",args:[he]}),Oe=Y[Y.lastIndexOf(he)+1],Vt(I,{command:"addLayer",args:[xe,Oe]})}(w,n.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[n]}]}return c},d.aC=function(s){const n=[],c=s.id;return c===void 0&&n.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&n.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&n.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),n},d.aD=function s(n,c){if(Array.isArray(n)){if(!Array.isArray(c)||n.length!==c.length)return!1;for(let f=0;f<n.length;f++)if(!s(n[f],c[f]))return!1;return!0}if(typeof n=="object"&&n!==null&&c!==null){if(typeof c!="object"||Object.keys(n).length!==Object.keys(c).length)return!1;for(const f in n)if(!s(n[f],c[f]))return!1;return!0}return n===c},d.aE=ye,d.aF=Ue,d.aG=class extends Zn{constructor(s,n){super(s,n),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aH=$r,d.aI=class extends Zn{constructor(s,n){super(s,n),this.current=Pa}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let n=1;n<16;n++)if(s[n]!==this.current[n]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aJ=xo,d.aK=class extends Zn{constructor(s,n){super(s,n),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aL=class extends Zn{constructor(s,n){super(s,n),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aM=Ko,d.aN=function(s,n,c,f,g,w,k){var T=1/(n-c),I=1/(f-g),z=1/(w-k);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*z,s[11]=0,s[12]=(n+c)*T,s[13]=(g+f)*I,s[14]=(k+w)*z,s[15]=1,s},d.aO=$i,d.aP=y1,d.aQ=class extends Cl{},d.aR=dv,d.aS=class extends Ml{},d.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aU=om,d.aV=q,d.aW=class extends Uc{},d.aX=Xe,d.aY=function(s,n){return s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]&&s[3]===n[3]&&s[4]===n[4]&&s[5]===n[5]&&s[6]===n[6]&&s[7]===n[7]&&s[8]===n[8]&&s[9]===n[9]&&s[10]===n[10]&&s[11]===n[11]&&s[12]===n[12]&&s[13]===n[13]&&s[14]===n[14]&&s[15]===n[15]},d.aZ=function(s,n){var c=s[0],f=s[1],g=s[2],w=s[3],k=s[4],T=s[5],I=s[6],z=s[7],O=s[8],U=s[9],H=s[10],Y=s[11],ee=s[12],he=s[13],ge=s[14],xe=s[15],Oe=n[0],Ee=n[1],De=n[2],Ye=n[3],et=n[4],Lt=n[5],$t=n[6],It=n[7],Tt=n[8],_t=n[9],Bt=n[10],kt=n[11],ut=n[12],Xt=n[13],qt=n[14],vi=n[15];return Math.abs(c-Oe)<=Mr*Math.max(1,Math.abs(c),Math.abs(Oe))&&Math.abs(f-Ee)<=Mr*Math.max(1,Math.abs(f),Math.abs(Ee))&&Math.abs(g-De)<=Mr*Math.max(1,Math.abs(g),Math.abs(De))&&Math.abs(w-Ye)<=Mr*Math.max(1,Math.abs(w),Math.abs(Ye))&&Math.abs(k-et)<=Mr*Math.max(1,Math.abs(k),Math.abs(et))&&Math.abs(T-Lt)<=Mr*Math.max(1,Math.abs(T),Math.abs(Lt))&&Math.abs(I-$t)<=Mr*Math.max(1,Math.abs(I),Math.abs($t))&&Math.abs(z-It)<=Mr*Math.max(1,Math.abs(z),Math.abs(It))&&Math.abs(O-Tt)<=Mr*Math.max(1,Math.abs(O),Math.abs(Tt))&&Math.abs(U-_t)<=Mr*Math.max(1,Math.abs(U),Math.abs(_t))&&Math.abs(H-Bt)<=Mr*Math.max(1,Math.abs(H),Math.abs(Bt))&&Math.abs(Y-kt)<=Mr*Math.max(1,Math.abs(Y),Math.abs(kt))&&Math.abs(ee-ut)<=Mr*Math.max(1,Math.abs(ee),Math.abs(ut))&&Math.abs(he-Xt)<=Mr*Math.max(1,Math.abs(he),Math.abs(Xt))&&Math.abs(ge-qt)<=Mr*Math.max(1,Math.abs(ge),Math.abs(qt))&&Math.abs(xe-vi)<=Mr*Math.max(1,Math.abs(xe),Math.abs(vi))},d.a_=function(s,n){return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.aa=function(s){const n={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,w)=>{const k=g||w;return n[f]=!k||k.toLowerCase(),""}),n["max-age"]){const c=parseInt(n["max-age"],10);isNaN(c)?delete n["max-age"]:n["max-age"]=c}return n},d.ab=function(s,n){const c=[];for(const f in s)f in n||c.push(f);return c},d.ac=le,d.ad=function(s,n,c){var f=Math.sin(c),g=Math.cos(c),w=n[0],k=n[1],T=n[2],I=n[3],z=n[4],O=n[5],U=n[6],H=n[7];return n!==s&&(s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[0]=w*g+z*f,s[1]=k*g+O*f,s[2]=T*g+U*f,s[3]=I*g+H*f,s[4]=z*g-w*f,s[5]=O*g-k*f,s[6]=U*g-T*f,s[7]=H*g-I*f,s},d.ae=function(s){var n=new Dl(16);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},d.af=Oh,d.ag=function(s,n){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:k}=s,T=g?le(ar.interpolationFactor(g,n,w,k),0,1):0;s.kind==="camera"?f=gr.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:n,uSizeT:c},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/Qo:s.kind==="composite"?gr.number(f/Qo,g/Qo,c):n},d.aj=Mf,d.ak=function(s,n,c,f){const g=n.y-s.y,w=n.x-s.x,k=f.y-c.y,T=f.x-c.x,I=k*w-T*g;if(I===0)return null;const z=(T*(s.y-c.y)-k*(s.x-c.x))/I;return new S(s.x+z*w,s.y+z*g)},d.al=sg,d.am=qc,d.an=sf,d.ao=Gn,d.aq=Cf,d.ar=function(s,n){var c=n[0],f=n[1],g=n[2],w=n[3],k=n[4],T=n[5],I=n[6],z=n[7],O=n[8],U=n[9],H=n[10],Y=n[11],ee=n[12],he=n[13],ge=n[14],xe=n[15],Oe=c*T-f*k,Ee=c*I-g*k,De=c*z-w*k,Ye=f*I-g*T,et=f*z-w*T,Lt=g*z-w*I,$t=O*he-U*ee,It=O*ge-H*ee,Tt=O*xe-Y*ee,_t=U*ge-H*he,Bt=U*xe-Y*he,kt=H*xe-Y*ge,ut=Oe*kt-Ee*Bt+De*_t+Ye*Tt-et*It+Lt*$t;return ut?(s[0]=(T*kt-I*Bt+z*_t)*(ut=1/ut),s[1]=(g*Bt-f*kt-w*_t)*ut,s[2]=(he*Lt-ge*et+xe*Ye)*ut,s[3]=(H*et-U*Lt-Y*Ye)*ut,s[4]=(I*Tt-k*kt-z*It)*ut,s[5]=(c*kt-g*Tt+w*It)*ut,s[6]=(ge*De-ee*Lt-xe*Ee)*ut,s[7]=(O*Lt-H*De+Y*Ee)*ut,s[8]=(k*Bt-T*Tt+z*$t)*ut,s[9]=(f*Tt-c*Bt-w*$t)*ut,s[10]=(ee*et-he*De+xe*Oe)*ut,s[11]=(U*De-O*et-Y*Oe)*ut,s[12]=(T*It-k*_t-I*$t)*ut,s[13]=(c*_t-f*It+g*$t)*ut,s[14]=(he*Ee-ee*Ye-ge*Oe)*ut,s[15]=(O*Ye-U*Ee+H*Oe)*ut,s):null},d.as=Rf,d.at=Tf,d.au=Bf,d.av=function(){const s={},n=we.$version;for(const c in we.$root){const f=we.$root[c];if(f.required){let g=null;g=c==="version"?n:f.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},d.aw=Sh,d.ax=Ei,d.ay=function(s){s=s.slice();const n=Object.create(null);for(let c=0;c<s.length;c++)n[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=qe(s[c],n[s[c].ref]));return s},d.az=function(s){if(s.type==="custom")return new Fv(s);switch(s.type){case"background":return new Dv(s);case"circle":return new v1(s);case"fill":return new N1(s);case"fill-extrusion":return new ev(s);case"heatmap":return new w1(s);case"hillshade":return new k1(s);case"line":return new lv(s);case"raster":return new Bv(s);case"symbol":return new Hh(s)}},d.b=nt,d.b0=function(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+s[3]*n[3]},d.b1=ce,d.b2=Qm,d.b3=Jm,d.b4=function(s,n,c,f,g){var w,k=1/Math.tan(n/2);return s[0]=k/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=k,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(w=1/(f-g)),s[14]=2*g*f*w):(s[10]=-1,s[14]=-2*f),s},d.b5=function(s,n,c){var f=Math.sin(c),g=Math.cos(c),w=n[4],k=n[5],T=n[6],I=n[7],z=n[8],O=n[9],U=n[10],H=n[11];return n!==s&&(s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[4]=w*g+z*f,s[5]=k*g+O*f,s[6]=T*g+U*f,s[7]=I*g+H*f,s[8]=z*g-w*f,s[9]=O*g-k*f,s[10]=U*g-T*f,s[11]=H*g-I*f,s},d.b6=$,d.b7=j,d.b8=function(s){return s*Math.PI/180},d.b9=function(s,n){return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bA=Xo,d.ba=class extends zo{},d.bb=Af,d.bc=Hv,d.be=Yt,d.bf=function(s,n){Rt.REGISTERED_PROTOCOLS[s]=n},d.bg=function(s){delete Rt.REGISTERED_PROTOCOLS[s]},d.bh=function(s,n){const c={};for(let g=0;g<s.length;g++){const w=n&&n[s[g].id]||ef(s[g]);n&&(n[s[g].id]=w);let k=c[w];k||(k=c[w]=[]),k.push(s[g])}const f=[];for(const g in c)f.push(c[g]);return f},d.bi=zt,d.bj=tg,d.bk=ng,d.bl=Rm,d.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=Sn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const n=s.bucket.layers[0],c=n.layout,f=n._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new ln(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new ln(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new ln(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:O}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new ln(z),s.canonical),f["text-size"].possiblyEvaluate(new ln(O),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:O}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new ln(z),s.canonical),f["icon-size"].possiblyEvaluate(new ln(O),s.canonical)]}const w=c.get("text-line-height")*Gn,k=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const z of s.bucket.features){const O=c.get("text-font").evaluate(z,{},s.canonical).join(","),U=I.evaluate(z,{},s.canonical),H=g.layoutTextSize.evaluate(z,{},s.canonical),Y=g.layoutIconSize.evaluate(z,{},s.canonical),ee={horizontal:{},vertical:void 0},he=z.text;let ge,xe=[0,0];if(he){const De=he.toString(),Ye=c.get("text-letter-spacing").evaluate(z,{},s.canonical)*Gn,et=Th(De)?Ye:0,Lt=c.get("text-anchor").evaluate(z,{},s.canonical),$t=mg(n,z,s.canonical);if(!$t){const kt=c.get("text-radial-offset").evaluate(z,{},s.canonical);xe=kt?pg(Lt,[kt*Gn,Df]):c.get("text-offset").evaluate(z,{},s.canonical).map(ut=>ut*Gn)}let It=k?"center":c.get("text-justify").evaluate(z,{},s.canonical);const Tt=c.get("symbol-placement"),_t=Tt==="point"?c.get("text-max-width").evaluate(z,{},s.canonical)*Gn:0,Bt=()=>{s.bucket.allowVerticalPlacement&&Us(De)&&(ee.vertical=Zh(he,s.glyphMap,s.glyphPositions,s.imagePositions,O,_t,w,Lt,"left",et,xe,d.ah.vertical,!0,Tt,H,U))};if(!k&&$t){const kt=new Set;if(It==="auto")for(let Xt=0;Xt<$t.values.length;Xt+=2)kt.add(Rf($t.values[Xt]));else kt.add(It);let ut=!1;for(const Xt of kt)if(!ee.horizontal[Xt])if(ut)ee.horizontal[Xt]=ee.horizontal[0];else{const qt=Zh(he,s.glyphMap,s.glyphPositions,s.imagePositions,O,_t,w,"center",Xt,et,xe,d.ah.horizontal,!1,Tt,H,U);qt&&(ee.horizontal[Xt]=qt,ut=qt.positionedLines.length===1)}Bt()}else{It==="auto"&&(It=Rf(Lt));const kt=Zh(he,s.glyphMap,s.glyphPositions,s.imagePositions,O,_t,w,Lt,It,et,xe,d.ah.horizontal,!1,Tt,H,U);kt&&(ee.horizontal[It]=kt),Bt(),Us(De)&&k&&T&&(ee.vertical=Zh(he,s.glyphMap,s.glyphPositions,s.imagePositions,O,_t,w,Lt,It,et,xe,d.ah.vertical,!1,Tt,H,U))}}let Oe=!1;if(z.icon&&z.icon.name){const De=s.imageMap[z.icon.name];De&&(ge=Iv(s.imagePositions[z.icon.name],c.get("icon-offset").evaluate(z,{},s.canonical),c.get("icon-anchor").evaluate(z,{},s.canonical)),Oe=!!De.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Oe:s.bucket.sdfIcons!==Oe&&st("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Ee=_g(ee.horizontal)||ee.vertical;s.bucket.iconsInText=!!Ee&&Ee.iconsInText,(Ee||ge)&&Gv(s.bucket,z,ee,ge,s.imageMap,g,H,Y,xe,Oe,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bn=vf,d.bo=gf,d.bp=yf,d.bq=qs,d.br=wf,d.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bt=function(s,n,c,f,g){return a(this,void 0,void 0,function*(){if(N())try{return yield oi(s,n,c,f,g)}catch{}return function(w,k,T,I,z){const O=w.width,U=w.height;Dt&&mt||(Dt=new OffscreenCanvas(O,U),mt=Dt.getContext("2d",{willReadFrequently:!0})),Dt.width=O,Dt.height=U,mt.drawImage(w,0,0,O,U);const H=mt.getImageData(k,T,I,z);return mt.clearRect(0,0,O,U),H.data}(s,n,c,f,g)})},d.bu=eg,d.bv=_,d.bw=y,d.bx=Cm,d.by=cs,d.bz=function(s){return s.message===ti},d.c=Pt,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(n)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=J,d.f=s=>new Promise((n,c)=>{const f=new Image;f.onload=()=>{n(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Ht})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Ht}),d.g=ct,d.h=(s,n)=>Fi(J(s,{type:"json"}),n),d.i=wt,d.j=dt,d.k=Ne,d.l=(s,n)=>Fi(J(s,{type:"arrayBuffer"}),n),d.m=Fi,d.n=function(s){return new wf(s).readFields(kv,[])},d.o=Kc,d.p=Dm,d.q=Cr,d.r=tf,d.s=ht,d.t=Ns,d.u=Et,d.v=we,d.w=st,d.x=hs,d.y=function([s,n,c]){return n+=90,n*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(n)*Math.sin(c),y:s*Math.sin(n)*Math.sin(c),z:s*Math.cos(c)}},d.z=gr}),l("worker",["./shared"],function(d){class a{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,X){for(const de of W){this._layerConfigs[de.id]=de;const Ae=this._layers[de.id]=d.az(de);Ae._featureFilter=d.a6(Ae.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of X)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const ne=d.bh(Object.values(this._layerConfigs),this.keyCache);for(const de of ne){const Ae=de.map(Ve=>this._layers[Ve.id]),Pe=Ae[0];if(Pe.visibility==="none")continue;const Be=Pe.source||"";let Me=this.familiesBySource[Be];Me||(Me=this.familiesBySource[Be]={});const G=Pe.sourceLayer||"_geojsonTileLayer";let $e=Me[G];$e||($e=Me[G]=[]),$e.push(Ae)}}}class _{constructor(W){const X={},ne=[];for(const Be in W){const Me=W[Be],G=X[Be]={};for(const $e in Me){const Ve=Me[+$e];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const Ge={x:0,y:0,w:Ve.bitmap.width+2,h:Ve.bitmap.height+2};ne.push(Ge),G[$e]={rect:Ge,metrics:Ve.metrics}}}const{w:de,h:Ae}=d.p(ne),Pe=new d.o({width:de||1,height:Ae||1});for(const Be in W){const Me=W[Be];for(const G in Me){const $e=Me[+G];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Ve=X[Be][G].rect;d.o.copy($e.bitmap,Pe,{x:0,y:0},{x:Ve.x+1,y:Ve.y+1},$e.bitmap)}}this.image=Pe,this.positions=X}}d.bi("GlyphAtlas",_);class y{constructor(W){this.tileID=new d.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,X,ne,de){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new d.a4;const Ae=new d.bj(Object.keys(W.layers).sort()),Pe=new d.bk(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Be={},Me={featureIndex:Pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},G=X.familiesBySource[this.source];for(const di in G){const yn=W.layers[di];if(!yn)continue;yn.version===1&&d.w(`Vector tile source "${this.source}" layer "${di}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vn=Ae.encode(di),mr=[];for(let kr=0;kr<yn.length;kr++){const er=yn.feature(kr),_o=Pe.getId(er,di);mr.push({feature:er,id:_o,index:kr,sourceLayerIndex:Vn})}for(const kr of G[di]){const er=kr[0];er.source!==this.source&&d.w(`layer.source = ${er.source} does not equal this.source = ${this.source}`),er.minzoom&&this.zoom<Math.floor(er.minzoom)||er.maxzoom&&this.zoom>=er.maxzoom||er.visibility!=="none"&&(x(kr,this.zoom,ne),(Be[er.id]=er.createBucket({index:Pe.bucketLayerIDs.length,layers:kr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vn,sourceID:this.source})).populate(mr,Me,this.tileID.canonical),Pe.bucketLayerIDs.push(kr.map(_o=>_o.id)))}}const $e=d.aE(Me.glyphDependencies,di=>Object.keys(di).map(Number));this.inFlightDependencies.forEach(di=>di==null?void 0:di.abort()),this.inFlightDependencies=[];let Ve=Promise.resolve({});if(Object.keys($e).length){const di=new AbortController;this.inFlightDependencies.push(di),Ve=de.sendAsync({type:"GG",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},di)}const Ge=Object.keys(Me.iconDependencies);let Ke=Promise.resolve({});if(Ge.length){const di=new AbortController;this.inFlightDependencies.push(di),Ke=de.sendAsync({type:"GI",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},di)}const ft=Object.keys(Me.patternDependencies);let Nt=Promise.resolve({});if(ft.length){const di=new AbortController;this.inFlightDependencies.push(di),Nt=de.sendAsync({type:"GI",data:{icons:ft,source:this.source,tileID:this.tileID,type:"patterns"}},di)}const[Qt,hi,xi]=yield Promise.all([Ve,Ke,Nt]),an=new _(Qt),Rn=new d.bl(hi,xi);for(const di in Be){const yn=Be[di];yn instanceof d.a5?(x(yn.layers,this.zoom,ne),d.bm({bucket:yn,glyphMap:Qt,glyphPositions:an.positions,imageMap:hi,imagePositions:Rn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):yn.hasPattern&&(yn instanceof d.bn||yn instanceof d.bo||yn instanceof d.bp)&&(x(yn.layers,this.zoom,ne),yn.addFeatures(Me,this.tileID.canonical,Rn.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter(di=>!di.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:an.image,imageAtlas:Rn,glyphMap:this.returnDependencies?Qt:null,iconMap:this.returnDependencies?hi:null,glyphPositions:this.returnDependencies?an.positions:null}})}}function x(me,W,X){const ne=new d.a8(W);for(const de of me)de.recalculate(ne,X)}class S{constructor(W,X,ne){this.actor=W,this.layerIndex=X,this.availableImages=ne,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,X){return d._(this,void 0,void 0,function*(){const ne=yield d.l(W.request,X);try{return{vectorTile:new d.bq.VectorTile(new d.br(ne.data)),rawData:ne.data,cacheControl:ne.cacheControl,expires:ne.expires}}catch(de){const Ae=new Uint8Array(ne.data);let Pe=`Unable to parse the tile at ${W.request.url}, `;throw Pe+=Ae[0]===31&&Ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.messge}`,new Error(Pe)}})}loadTile(W){return d._(this,void 0,void 0,function*(){const X=W.uid,ne=!!(W&&W.request&&W.request.collectResourceTiming)&&new d.bs(W.request),de=new y(W);this.loading[X]=de;const Ae=new AbortController;de.abort=Ae;try{const Pe=yield this.loadVectorTile(W,Ae);if(delete this.loading[X],!Pe)return null;const Be=Pe.rawData,Me={};Pe.expires&&(Me.expires=Pe.expires),Pe.cacheControl&&(Me.cacheControl=Pe.cacheControl);const G={};if(ne){const Ve=ne.finish();Ve&&(G.resourceTiming=JSON.parse(JSON.stringify(Ve)))}de.vectorTile=Pe.vectorTile;const $e=de.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=de,this.fetching[X]={rawTileData:Be,cacheControl:Me,resourceTiming:G};try{const Ve=yield $e;return d.e({rawTileData:Be.slice(0)},Ve,Me,G)}finally{delete this.fetching[X]}}catch(Pe){throw delete this.loading[X],de.status="done",this.loaded[X]=de,Pe}})}reloadTile(W){return d._(this,void 0,void 0,function*(){const X=W.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ne=this.loaded[X];if(ne.showCollisionBoxes=W.showCollisionBoxes,ne.status==="parsing"){const de=yield ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ae;if(this.fetching[X]){const{rawTileData:Pe,cacheControl:Be,resourceTiming:Me}=this.fetching[X];delete this.fetching[X],Ae=d.e({rawTileData:Pe.slice(0)},de,Be,Me)}else Ae=de;return Ae}if(ne.status==="done"&&ne.vectorTile)return ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return d._(this,void 0,void 0,function*(){const X=this.loading,ne=W.uid;X&&X[ne]&&X[ne].abort&&(X[ne].abort.abort(),delete X[ne])})}removeTile(W){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class C{constructor(){this.loaded={}}loadTile(W){return d._(this,void 0,void 0,function*(){const{uid:X,encoding:ne,rawImageData:de,redFactor:Ae,greenFactor:Pe,blueFactor:Be,baseShift:Me}=W,G=de.width+2,$e=de.height+2,Ve=d.b(de)?new d.R({width:G,height:$e},yield d.bt(de,-1,-1,G,$e)):de,Ge=new d.bu(X,Ve,ne,Ae,Pe,Be,Me);return this.loaded=this.loaded||{},this.loaded[X]=Ge,Ge})}removeTile(W){const X=this.loaded,ne=W.uid;X&&X[ne]&&delete X[ne]}}function L(me,W){if(me.length!==0){P(me[0],W);for(var X=1;X<me.length;X++)P(me[X],!W)}}function P(me,W){for(var X=0,ne=0,de=0,Ae=me.length,Pe=Ae-1;de<Ae;Pe=de++){var Be=(me[de][0]-me[Pe][0])*(me[Pe][1]+me[de][1]),Me=X+Be;ne+=Math.abs(X)>=Math.abs(Be)?X-Me+Be:Be-Me+X,X=Me}X+ne>=0!=!!W&&me.reverse()}var R=d.bv(function me(W,X){var ne,de=W&&W.type;if(de==="FeatureCollection")for(ne=0;ne<W.features.length;ne++)me(W.features[ne],X);else if(de==="GeometryCollection")for(ne=0;ne<W.geometries.length;ne++)me(W.geometries[ne],X);else if(de==="Feature")me(W.geometry,X);else if(de==="Polygon")L(W.coordinates,X);else if(de==="MultiPolygon")for(ne=0;ne<W.coordinates.length;ne++)L(W.coordinates[ne],X);return W});const D=d.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},N=d.bw,$=d.bq.VectorTileFeature,j=le;function le(me,W){this.options=W||{},this.features=me,this.length=me.length}function ce(me,W){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=W||4096}le.prototype.feature=function(me){return new ce(this.features[me],this.options.extent)},ce.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var W=0;W<me.length;W++){for(var X=me[W],ne=[],de=0;de<X.length;de++)ne.push(new N(X[de][0],X[de][1]));this.geometry.push(ne)}return this.geometry},ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,W=1/0,X=-1/0,ne=1/0,de=-1/0,Ae=0;Ae<me.length;Ae++)for(var Pe=me[Ae],Be=0;Be<Pe.length;Be++){var Me=Pe[Be];W=Math.min(W,Me.x),X=Math.max(X,Me.x),ne=Math.min(ne,Me.y),de=Math.max(de,Me.y)}return[W,ne,X,de]},ce.prototype.toGeoJSON=$.prototype.toGeoJSON;var J=d.bx,te=j;function ye(me){var W=new J;return function(X,ne){for(var de in X.layers)ne.writeMessage(3,Ue,X.layers[de])}(me,W),W.finish()}function Ue(me,W){var X;W.writeVarintField(15,me.version||1),W.writeStringField(1,me.name||""),W.writeVarintField(5,me.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<me.length;X++)ne.feature=me.feature(X),W.writeMessage(2,oe,ne);var de=ne.keys;for(X=0;X<de.length;X++)W.writeStringField(3,de[X]);var Ae=ne.values;for(X=0;X<Ae.length;X++)W.writeMessage(4,wt,Ae[X])}function oe(me,W){var X=me.feature;X.id!==void 0&&W.writeVarintField(1,X.id),W.writeMessage(2,ve,me),W.writeVarintField(3,X.type),W.writeMessage(4,Qe,X)}function ve(me,W){var X=me.feature,ne=me.keys,de=me.values,Ae=me.keycache,Pe=me.valuecache;for(var Be in X.properties){var Me=X.properties[Be],G=Ae[Be];if(Me!==null){G===void 0&&(ne.push(Be),Ae[Be]=G=ne.length-1),W.writeVarint(G);var $e=typeof Me;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(Me=JSON.stringify(Me));var Ve=$e+":"+Me,Ge=Pe[Ve];Ge===void 0&&(de.push(Me),Pe[Ve]=Ge=de.length-1),W.writeVarint(Ge)}}}function st(me,W){return(W<<3)+(7&me)}function ze(me){return me<<1^me>>31}function Qe(me,W){for(var X=me.loadGeometry(),ne=me.type,de=0,Ae=0,Pe=X.length,Be=0;Be<Pe;Be++){var Me=X[Be],G=1;ne===1&&(G=Me.length),W.writeVarint(st(1,G));for(var $e=ne===3?Me.length-1:Me.length,Ve=0;Ve<$e;Ve++){Ve===1&&ne!==1&&W.writeVarint(st(2,$e-1));var Ge=Me[Ve].x-de,Ke=Me[Ve].y-Ae;W.writeVarint(ze(Ge)),W.writeVarint(ze(Ke)),de+=Ge,Ae+=Ke}ne===3&&W.writeVarint(st(7,1))}}function wt(me,W){var X=typeof me;X==="string"?W.writeStringField(1,me):X==="boolean"?W.writeBooleanField(7,me):X==="number"&&(me%1!=0?W.writeDoubleField(3,me):me<0?W.writeSVarintField(6,me):W.writeVarintField(5,me))}B.exports=ye,B.exports.fromVectorTileJs=ye,B.exports.fromGeojsonVt=function(me,W){W=W||{};var X={};for(var ne in me)X[ne]=new te(me[ne].features,W),X[ne].name=ne,X[ne].version=W.version,X[ne].extent=W.extent;return ye({layers:X})},B.exports.GeoJSONWrapper=te;var pt=d.bv(B.exports);const nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Ht=Math.fround||(oi=new Float32Array(1),me=>(oi[0]=+me,oi[0]));var oi;const Dt=3,mt=5,ti=6;class Pt{constructor(W){this.options=Object.assign(Object.create(nt),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:ne,maxZoom:de}=this.options;X&&console.time("total time");const Ae=`prepare ${W.length} points`;X&&console.time(Ae),this.points=W;const Pe=[];for(let Me=0;Me<W.length;Me++){const G=W[Me];if(!G.geometry)continue;const[$e,Ve]=G.geometry.coordinates,Ge=Ht(Jt($e)),Ke=Ht(Yt(Ve));Pe.push(Ge,Ke,1/0,Me,-1,1),this.options.reduce&&Pe.push(0)}let Be=this.trees[de+1]=this._createTree(Pe);X&&console.timeEnd(Ae);for(let Me=de;Me>=ne;Me--){const G=+Date.now();Be=this.trees[Me]=this._createTree(this._cluster(Be,Me)),X&&console.log("z%d: %d clusters in %dms",Me,Be.numItems,+Date.now()-G)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let ne=((W[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,W[1]));let Ae=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ne=-180,Ae=180;else if(ne>Ae){const Ve=this.getClusters([ne,de,180,Pe],X),Ge=this.getClusters([-180,de,Ae,Pe],X);return Ve.concat(Ge)}const Be=this.trees[this._limitZoom(X)],Me=Be.range(Jt(ne),Yt(Pe),Jt(Ae),Yt(de)),G=Be.data,$e=[];for(const Ve of Me){const Ge=this.stride*Ve;$e.push(G[Ge+mt]>1?Rt(G,Ge,this.clusterProps):this.points[G[Ge+Dt]])}return $e}getChildren(W){const X=this._getOriginId(W),ne=this._getOriginZoom(W),de="No cluster with the specified id.",Ae=this.trees[ne];if(!Ae)throw new Error(de);const Pe=Ae.data;if(X*this.stride>=Pe.length)throw new Error(de);const Be=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Me=Ae.within(Pe[X*this.stride],Pe[X*this.stride+1],Be),G=[];for(const $e of Me){const Ve=$e*this.stride;Pe[Ve+4]===W&&G.push(Pe[Ve+mt]>1?Rt(Pe,Ve,this.clusterProps):this.points[Pe[Ve+Dt]])}if(G.length===0)throw new Error(de);return G}getLeaves(W,X,ne){const de=[];return this._appendLeaves(de,W,X=X||10,ne=ne||0,0),de}getTile(W,X,ne){const de=this.trees[this._limitZoom(W)],Ae=Math.pow(2,W),{extent:Pe,radius:Be}=this.options,Me=Be/Pe,G=(ne-Me)/Ae,$e=(ne+1+Me)/Ae,Ve={features:[]};return this._addTileFeatures(de.range((X-Me)/Ae,G,(X+1+Me)/Ae,$e),de.data,X,ne,Ae,Ve),X===0&&this._addTileFeatures(de.range(1-Me/Ae,G,1,$e),de.data,Ae,ne,Ae,Ve),X===Ae-1&&this._addTileFeatures(de.range(0,G,Me/Ae,$e),de.data,-1,ne,Ae,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const ne=this.getChildren(W);if(X++,ne.length!==1)break;W=ne[0].properties.cluster_id}return X}_appendLeaves(W,X,ne,de,Ae){const Pe=this.getChildren(X);for(const Be of Pe){const Me=Be.properties;if(Me&&Me.cluster?Ae+Me.point_count<=de?Ae+=Me.point_count:Ae=this._appendLeaves(W,Me.cluster_id,ne,de,Ae):Ae<de?Ae++:W.push(Be),W.length===ne)break}return Ae}_createTree(W){const X=new d.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<W.length;ne+=this.stride)X.add(W[ne],W[ne+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,ne,de,Ae,Pe){for(const Be of W){const Me=Be*this.stride,G=X[Me+mt]>1;let $e,Ve,Ge;if(G)$e=ct(X,Me,this.clusterProps),Ve=X[Me],Ge=X[Me+1];else{const Nt=this.points[X[Me+Dt]];$e=Nt.properties;const[Qt,hi]=Nt.geometry.coordinates;Ve=Jt(Qt),Ge=Yt(hi)}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Ve*Ae-ne)),Math.round(this.options.extent*(Ge*Ae-de))]],tags:$e};let ft;ft=G||this.options.generateId?X[Me+Dt]:this.points[X[Me+Dt]].id,ft!==void 0&&(Ke.id=ft),Pe.features.push(Ke)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:ne,extent:de,reduce:Ae,minPoints:Pe}=this.options,Be=ne/(de*Math.pow(2,X)),Me=W.data,G=[],$e=this.stride;for(let Ve=0;Ve<Me.length;Ve+=$e){if(Me[Ve+2]<=X)continue;Me[Ve+2]=X;const Ge=Me[Ve],Ke=Me[Ve+1],ft=W.within(Me[Ve],Me[Ve+1],Be),Nt=Me[Ve+mt];let Qt=Nt;for(const hi of ft){const xi=hi*$e;Me[xi+2]>X&&(Qt+=Me[xi+mt])}if(Qt>Nt&&Qt>=Pe){let hi,xi=Ge*Nt,an=Ke*Nt,Rn=-1;const di=((Ve/$e|0)<<5)+(X+1)+this.points.length;for(const yn of ft){const Vn=yn*$e;if(Me[Vn+2]<=X)continue;Me[Vn+2]=X;const mr=Me[Vn+mt];xi+=Me[Vn]*mr,an+=Me[Vn+1]*mr,Me[Vn+4]=di,Ae&&(hi||(hi=this._map(Me,Ve,!0),Rn=this.clusterProps.length,this.clusterProps.push(hi)),Ae(hi,this._map(Me,Vn)))}Me[Ve+4]=di,G.push(xi/Qt,an/Qt,1/0,di,-1,Qt),Ae&&G.push(Rn)}else{for(let hi=0;hi<$e;hi++)G.push(Me[Ve+hi]);if(Qt>1)for(const hi of ft){const xi=hi*$e;if(!(Me[xi+2]<=X)){Me[xi+2]=X;for(let an=0;an<$e;an++)G.push(Me[xi+an])}}}}return G}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,ne){if(W[X+mt]>1){const Pe=this.clusterProps[W[X+ti]];return ne?Object.assign({},Pe):Pe}const de=this.points[W[X+Dt]].properties,Ae=this.options.map(de);return ne&&Ae===de?Object.assign({},Ae):Ae}}function Rt(me,W,X){return{type:"Feature",id:me[W+Dt],properties:ct(me,W,X),geometry:{type:"Point",coordinates:[(ne=me[W],360*(ne-.5)),Ei(me[W+1])]}};var ne}function ct(me,W,X){const ne=me[W+mt],de=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,Ae=me[W+ti],Pe=Ae===-1?{}:Object.assign({},X[Ae]);return Object.assign(Pe,{cluster:!0,cluster_id:me[W+Dt],point_count:ne,point_count_abbreviated:de})}function Jt(me){return me/360+.5}function Yt(me){const W=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function Ei(me){const W=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Fi(me,W,X,ne){for(var de,Ae=ne,Pe=X-W>>1,Be=X-W,Me=me[W],G=me[W+1],$e=me[X],Ve=me[X+1],Ge=W+3;Ge<X;Ge+=3){var Ke=ht(me[Ge],me[Ge+1],Me,G,$e,Ve);if(Ke>Ae)de=Ge,Ae=Ke;else if(Ke===Ae){var ft=Math.abs(Ge-Pe);ft<Be&&(de=Ge,Be=ft)}}Ae>ne&&(de-W>3&&Fi(me,W,de,ne),me[de+2]=Ae,X-de>3&&Fi(me,de,X,ne))}function ht(me,W,X,ne,de,Ae){var Pe=de-X,Be=Ae-ne;if(Pe!==0||Be!==0){var Me=((me-X)*Pe+(W-ne)*Be)/(Pe*Pe+Be*Be);Me>1?(X=de,ne=Ae):Me>0&&(X+=Pe*Me,ne+=Be*Me)}return(Pe=me-X)*Pe+(Be=W-ne)*Be}function Ot(me,W,X,ne){var de={id:me===void 0?null:me,type:W,geometry:X,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ae){var Pe=Ae.geometry,Be=Ae.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")Fe(Ae,Pe);else if(Be==="Polygon"||Be==="MultiLineString")for(var Me=0;Me<Pe.length;Me++)Fe(Ae,Pe[Me]);else if(Be==="MultiPolygon")for(Me=0;Me<Pe.length;Me++)for(var G=0;G<Pe[Me].length;G++)Fe(Ae,Pe[Me][G])}(de),de}function Fe(me,W){for(var X=0;X<W.length;X+=3)me.minX=Math.min(me.minX,W[X]),me.minY=Math.min(me.minY,W[X+1]),me.maxX=Math.max(me.maxX,W[X]),me.maxY=Math.max(me.maxY,W[X+1])}function Ne(me,W,X,ne){if(W.geometry){var de=W.geometry.coordinates,Ae=W.geometry.type,Pe=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Be=[],Me=W.id;if(X.promoteId?Me=W.properties[X.promoteId]:X.generateId&&(Me=ne||0),Ae==="Point")dt(de,Be);else if(Ae==="MultiPoint")for(var G=0;G<de.length;G++)dt(de[G],Be);else if(Ae==="LineString")bt(de,Be,Pe,!1);else if(Ae==="MultiLineString"){if(X.lineMetrics){for(G=0;G<de.length;G++)bt(de[G],Be=[],Pe,!1),me.push(Ot(Me,"LineString",Be,W.properties));return}we(de,Be,Pe,!1)}else if(Ae==="Polygon")we(de,Be,Pe,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(G=0;G<W.geometry.geometries.length;G++)Ne(me,{id:Me,geometry:W.geometry.geometries[G],properties:W.properties},X,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(G=0;G<de.length;G++){var $e=[];we(de[G],$e,Pe,!0),Be.push($e)}}me.push(Ot(Me,Ae,Be,W.properties))}}function dt(me,W){W.push(Ii(me[0])),W.push(qe(me[1])),W.push(0)}function bt(me,W,X,ne){for(var de,Ae,Pe=0,Be=0;Be<me.length;Be++){var Me=Ii(me[Be][0]),G=qe(me[Be][1]);W.push(Me),W.push(G),W.push(0),Be>0&&(Pe+=ne?(de*G-Me*Ae)/2:Math.sqrt(Math.pow(Me-de,2)+Math.pow(G-Ae,2))),de=Me,Ae=G}var $e=W.length-3;W[2]=1,Fi(W,0,$e,X),W[$e+2]=1,W.size=Math.abs(Pe),W.start=0,W.end=W.size}function we(me,W,X,ne){for(var de=0;de<me.length;de++){var Ae=[];bt(me[de],Ae,X,ne),W.push(Ae)}}function Ii(me){return me/360+.5}function qe(me){var W=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function Je(me,W,X,ne,de,Ae,Pe,Be){if(ne/=W,Ae>=(X/=W)&&Pe<ne)return me;if(Pe<X||Ae>=ne)return null;for(var Me=[],G=0;G<me.length;G++){var $e=me[G],Ve=$e.geometry,Ge=$e.type,Ke=de===0?$e.minX:$e.minY,ft=de===0?$e.maxX:$e.maxY;if(Ke>=X&&ft<ne)Me.push($e);else if(!(ft<X||Ke>=ne)){var Nt=[];if(Ge==="Point"||Ge==="MultiPoint")Vt(Ve,Nt,X,ne,de);else if(Ge==="LineString")Pi(Ve,Nt,X,ne,de,!1,Be.lineMetrics);else if(Ge==="MultiLineString")gn(Ve,Nt,X,ne,de,!1);else if(Ge==="Polygon")gn(Ve,Nt,X,ne,de,!0);else if(Ge==="MultiPolygon")for(var Qt=0;Qt<Ve.length;Qt++){var hi=[];gn(Ve[Qt],hi,X,ne,de,!0),hi.length&&Nt.push(hi)}if(Nt.length){if(Be.lineMetrics&&Ge==="LineString"){for(Qt=0;Qt<Nt.length;Qt++)Me.push(Ot($e.id,Ge,Nt[Qt],$e.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(Nt.length===1?(Ge="LineString",Nt=Nt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=Nt.length===3?"Point":"MultiPoint"),Me.push(Ot($e.id,Ge,Nt,$e.tags))}}}return Me.length?Me:null}function Vt(me,W,X,ne,de){for(var Ae=0;Ae<me.length;Ae+=3){var Pe=me[Ae+de];Pe>=X&&Pe<=ne&&(W.push(me[Ae]),W.push(me[Ae+1]),W.push(me[Ae+2]))}}function Pi(me,W,X,ne,de,Ae,Pe){for(var Be,Me,G=wi(me),$e=de===0?tn:io,Ve=me.start,Ge=0;Ge<me.length-3;Ge+=3){var Ke=me[Ge],ft=me[Ge+1],Nt=me[Ge+2],Qt=me[Ge+3],hi=me[Ge+4],xi=de===0?Ke:ft,an=de===0?Qt:hi,Rn=!1;Pe&&(Be=Math.sqrt(Math.pow(Ke-Qt,2)+Math.pow(ft-hi,2))),xi<X?an>X&&(Me=$e(G,Ke,ft,Qt,hi,X),Pe&&(G.start=Ve+Be*Me)):xi>ne?an<ne&&(Me=$e(G,Ke,ft,Qt,hi,ne),Pe&&(G.start=Ve+Be*Me)):In(G,Ke,ft,Nt),an<X&&xi>=X&&(Me=$e(G,Ke,ft,Qt,hi,X),Rn=!0),an>ne&&xi<=ne&&(Me=$e(G,Ke,ft,Qt,hi,ne),Rn=!0),!Ae&&Rn&&(Pe&&(G.end=Ve+Be*Me),W.push(G),G=wi(me)),Pe&&(Ve+=Be)}var di=me.length-3;Ke=me[di],ft=me[di+1],Nt=me[di+2],(xi=de===0?Ke:ft)>=X&&xi<=ne&&In(G,Ke,ft,Nt),di=G.length-3,Ae&&di>=3&&(G[di]!==G[0]||G[di+1]!==G[1])&&In(G,G[0],G[1],G[2]),G.length&&W.push(G)}function wi(me){var W=[];return W.size=me.size,W.start=me.start,W.end=me.end,W}function gn(me,W,X,ne,de,Ae){for(var Pe=0;Pe<me.length;Pe++)Pi(me[Pe],W,X,ne,de,Ae,!1)}function In(me,W,X,ne){me.push(W),me.push(X),me.push(ne)}function tn(me,W,X,ne,de,Ae){var Pe=(Ae-W)/(ne-W);return me.push(Ae),me.push(X+(de-X)*Pe),me.push(1),Pe}function io(me,W,X,ne,de,Ae){var Pe=(Ae-X)/(de-X);return me.push(W+(ne-W)*Pe),me.push(Ae),me.push(1),Pe}function Oi(me,W){for(var X=[],ne=0;ne<me.length;ne++){var de,Ae=me[ne],Pe=Ae.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")de=rt(Ae.geometry,W);else if(Pe==="MultiLineString"||Pe==="Polygon"){de=[];for(var Be=0;Be<Ae.geometry.length;Be++)de.push(rt(Ae.geometry[Be],W))}else if(Pe==="MultiPolygon")for(de=[],Be=0;Be<Ae.geometry.length;Be++){for(var Me=[],G=0;G<Ae.geometry[Be].length;G++)Me.push(rt(Ae.geometry[Be][G],W));de.push(Me)}X.push(Ot(Ae.id,Pe,de,Ae.tags))}return X}function rt(me,W){var X=[];X.size=me.size,me.start!==void 0&&(X.start=me.start,X.end=me.end);for(var ne=0;ne<me.length;ne+=3)X.push(me[ne]+W,me[ne+1],me[ne+2]);return X}function Li(me,W){if(me.transformed)return me;var X,ne,de,Ae=1<<me.z,Pe=me.x,Be=me.y;for(X=0;X<me.features.length;X++){var Me=me.features[X],G=Me.geometry,$e=Me.type;if(Me.geometry=[],$e===1)for(ne=0;ne<G.length;ne+=2)Me.geometry.push(ii(G[ne],G[ne+1],W,Ae,Pe,Be));else for(ne=0;ne<G.length;ne++){var Ve=[];for(de=0;de<G[ne].length;de+=2)Ve.push(ii(G[ne][de],G[ne][de+1],W,Ae,Pe,Be));Me.geometry.push(Ve)}}return me.transformed=!0,me}function ii(me,W,X,ne,de,Ae){return[Math.round(X*(me*ne-de)),Math.round(X*(W*ne-Ae))]}function Ni(me,W,X,ne,de){for(var Ae=W===de.maxZoom?0:de.tolerance/((1<<W)*de.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ne,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<me.length;Be++){Pe.numFeatures++,Ki(Pe,me[Be],Ae,de);var Me=me[Be].minX,G=me[Be].minY,$e=me[Be].maxX,Ve=me[Be].maxY;Me<Pe.minX&&(Pe.minX=Me),G<Pe.minY&&(Pe.minY=G),$e>Pe.maxX&&(Pe.maxX=$e),Ve>Pe.maxY&&(Pe.maxY=Ve)}return Pe}function Ki(me,W,X,ne){var de=W.geometry,Ae=W.type,Pe=[];if(Ae==="Point"||Ae==="MultiPoint")for(var Be=0;Be<de.length;Be+=3)Pe.push(de[Be]),Pe.push(de[Be+1]),me.numPoints++,me.numSimplified++;else if(Ae==="LineString")yt(Pe,de,me,X,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(Be=0;Be<de.length;Be++)yt(Pe,de[Be],me,X,Ae==="Polygon",Be===0);else if(Ae==="MultiPolygon")for(var Me=0;Me<de.length;Me++){var G=de[Me];for(Be=0;Be<G.length;Be++)yt(Pe,G[Be],me,X,!0,Be===0)}if(Pe.length){var $e=W.tags||null;if(Ae==="LineString"&&ne.lineMetrics){for(var Ve in $e={},W.tags)$e[Ve]=W.tags[Ve];$e.mapbox_clip_start=de.start/de.size,$e.mapbox_clip_end=de.end/de.size}var Ge={geometry:Pe,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:$e};W.id!==null&&(Ge.id=W.id),me.features.push(Ge)}}function yt(me,W,X,ne,de,Ae){var Pe=ne*ne;if(ne>0&&W.size<(de?Pe:ne))X.numPoints+=W.length/3;else{for(var Be=[],Me=0;Me<W.length;Me+=3)(ne===0||W[Me+2]>Pe)&&(X.numSimplified++,Be.push(W[Me]),Be.push(W[Me+1])),X.numPoints++;de&&function(G,$e){for(var Ve=0,Ge=0,Ke=G.length,ft=Ke-2;Ge<Ke;ft=Ge,Ge+=2)Ve+=(G[Ge]-G[ft])*(G[Ge+1]+G[ft+1]);if(Ve>0===$e)for(Ge=0,Ke=G.length;Ge<Ke/2;Ge+=2){var Nt=G[Ge],Qt=G[Ge+1];G[Ge]=G[Ke-2-Ge],G[Ge+1]=G[Ke-1-Ge],G[Ke-2-Ge]=Nt,G[Ke-1-Ge]=Qt}}(Be,Ae),me.push(Be)}}function li(me,W){var X=(W=this.options=function(de,Ae){for(var Pe in Ae)de[Pe]=Ae[Pe];return de}(Object.create(this.options),W)).debug;if(X&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var ne=function(de,Ae){var Pe=[];if(de.type==="FeatureCollection")for(var Be=0;Be<de.features.length;Be++)Ne(Pe,de.features[Be],Ae,Be);else Ne(Pe,de.type==="Feature"?de:{geometry:de},Ae);return Pe}(me,W);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=function(de,Ae){var Pe=Ae.buffer/Ae.extent,Be=de,Me=Je(de,1,-1-Pe,Pe,0,-1,2,Ae),G=Je(de,1,1-Pe,2+Pe,0,-1,2,Ae);return(Me||G)&&(Be=Je(de,1,-Pe,1+Pe,0,-1,2,Ae)||[],Me&&(Be=Oi(Me,1).concat(Be)),G&&(Be=Be.concat(Oi(G,-1)))),Be}(ne,W),ne.length&&this.splitTile(ne,0,0,0),X&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ni(me,W,X){return 32*((1<<me)*X+W)+me}function Ji(me,W){return W?me.properties[W]:me.id}function xr(me,W){if(me==null)return!0;if(me.type==="Feature")return Ji(me,W)!=null;if(me.type==="FeatureCollection"){const X=new Set;for(const ne of me.features){const de=Ji(ne,W);if(de==null||X.has(de))return!1;X.add(de)}return!0}return!1}function si(me,W){const X=new Map;if(me!=null)if(me.type==="Feature")X.set(Ji(me,W),me);else for(const ne of me.features)X.set(Ji(ne,W),ne);return X}li.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},li.prototype.splitTile=function(me,W,X,ne,de,Ae,Pe){for(var Be=[me,W,X,ne],Me=this.options,G=Me.debug;Be.length;){ne=Be.pop(),X=Be.pop(),W=Be.pop(),me=Be.pop();var $e=1<<W,Ve=ni(W,X,ne),Ge=this.tiles[Ve];if(!Ge&&(G>1&&console.time("creation"),Ge=this.tiles[Ve]=Ni(me,W,X,ne,Me),this.tileCoords.push({z:W,x:X,y:ne}),G)){G>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,X,ne,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Ke="z"+W;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(Ge.source=me,de){if(W===Me.maxZoom||W===de)continue;var ft=1<<de-W;if(X!==Math.floor(Ae/ft)||ne!==Math.floor(Pe/ft))continue}else if(W===Me.indexMaxZoom||Ge.numPoints<=Me.indexMaxPoints)continue;if(Ge.source=null,me.length!==0){G>1&&console.time("clipping");var Nt,Qt,hi,xi,an,Rn,di=.5*Me.buffer/Me.extent,yn=.5-di,Vn=.5+di,mr=1+di;Nt=Qt=hi=xi=null,an=Je(me,$e,X-di,X+Vn,0,Ge.minX,Ge.maxX,Me),Rn=Je(me,$e,X+yn,X+mr,0,Ge.minX,Ge.maxX,Me),me=null,an&&(Nt=Je(an,$e,ne-di,ne+Vn,1,Ge.minY,Ge.maxY,Me),Qt=Je(an,$e,ne+yn,ne+mr,1,Ge.minY,Ge.maxY,Me),an=null),Rn&&(hi=Je(Rn,$e,ne-di,ne+Vn,1,Ge.minY,Ge.maxY,Me),xi=Je(Rn,$e,ne+yn,ne+mr,1,Ge.minY,Ge.maxY,Me),Rn=null),G>1&&console.timeEnd("clipping"),Be.push(Nt||[],W+1,2*X,2*ne),Be.push(Qt||[],W+1,2*X,2*ne+1),Be.push(hi||[],W+1,2*X+1,2*ne),Be.push(xi||[],W+1,2*X+1,2*ne+1)}}},li.prototype.getTile=function(me,W,X){var ne=this.options,de=ne.extent,Ae=ne.debug;if(me<0||me>24)return null;var Pe=1<<me,Be=ni(me,W=(W%Pe+Pe)%Pe,X);if(this.tiles[Be])return Li(this.tiles[Be],de);Ae>1&&console.log("drilling down to z%d-%d-%d",me,W,X);for(var Me,G=me,$e=W,Ve=X;!Me&&G>0;)G--,$e=Math.floor($e/2),Ve=Math.floor(Ve/2),Me=this.tiles[ni(G,$e,Ve)];return Me&&Me.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",G,$e,Ve),Ae>1&&console.time("drilling down"),this.splitTile(Me.source,G,$e,Ve,me,W,X),Ae>1&&console.timeEnd("drilling down"),this.tiles[Be]?Li(this.tiles[Be],de):null):null};class no extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,X){return d._(this,void 0,void 0,function*(){const ne=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!de)return null;const Ae=new class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.W,this.length=Be.length,this._features=Be}feature(Be){return new class{constructor(Me){this._feature=Me,this.extent=d.W,this.type=Me.type,this.properties=Me.tags,"id"in Me&&!isNaN(Me.id)&&(this.id=parseInt(Me.id,10))}loadGeometry(){if(this._feature.type===1){const Me=[];for(const G of this._feature.geometry)Me.push([new d.P(G[0],G[1])]);return Me}{const Me=[];for(const G of this._feature.geometry){const $e=[];for(const Ve of G)$e.push(new d.P(Ve[0],Ve[1]));Me.push($e)}return Me}}toGeoJSON(Me,G,$e){return D.call(this,Me,G,$e)}}(this._features[Be])}}(de.features);let Pe=pt(Ae);return Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),{vectorTile:Ae,rawData:Pe.buffer}})}loadData(W){return d._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const ne=!!(W&&W.request&&W.request.collectResourceTiming)&&new d.bs(W.request);this._pendingRequest=new AbortController;try{let de=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(R(de,!0),W.filter){const Pe=d.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(Me=>Pe.value.evaluate({zoom:0},Me))}}this._geoJSONIndex=W.cluster?new Pt(function({superclusterOptions:Pe,clusterProperties:Be}){if(!Be||!Pe)return Pe;const Me={},G={},$e={accumulated:null,zoom:0},Ve={properties:null},Ge=Object.keys(Be);for(const Ke of Ge){const[ft,Nt]=Be[Ke],Qt=d.by(Nt),hi=d.by(typeof ft=="string"?[ft,["accumulated"],["get",Ke]]:ft);Me[Ke]=Qt.value,G[Ke]=hi.value}return Pe.map=Ke=>{Ve.properties=Ke;const ft={};for(const Nt of Ge)ft[Nt]=Me[Nt].evaluate($e,Ve);return ft},Pe.reduce=(Ke,ft)=>{Ve.properties=ft;for(const Nt of Ge)$e.accumulated=Ke[Nt],Ke[Nt]=G[Nt].evaluate($e,Ve)},Pe}(W)).load(de.features):function(Pe,Be){return new li(Pe,Be)}(de,W.geojsonVtOptions),this.loaded={};const Ae={};if(ne){const Pe=ne.finish();Pe&&(Ae.resourceTiming={},Ae.resourceTiming[W.source]=JSON.parse(JSON.stringify(Pe)))}return Ae}catch(de){if(delete this._pendingRequest,d.bz(de))return{abandoned:!0};throw de}})}reloadTile(W){const X=this.loaded;return X&&X[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,X){return d._(this,void 0,void 0,function*(){const{promoteId:ne}=W;if(W.request){const de=yield d.h(W.request,X);return this._dataUpdateable=xr(de.data,ne)?si(de.data,ne):void 0,de.data}if(typeof W.data=="string")try{const de=JSON.parse(W.data);return this._dataUpdateable=xr(de,ne)?si(de,ne):void 0,de}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(de,Ae,Pe){var Be,Me,G,$e;if(Ae.removeAll&&de.clear(),Ae.remove)for(const Ve of Ae.remove)de.delete(Ve);if(Ae.add)for(const Ve of Ae.add){const Ge=Ji(Ve,Pe);Ge!=null&&de.set(Ge,Ve)}if(Ae.update)for(const Ve of Ae.update){let Ge=de.get(Ve.id);if(Ge==null)continue;const Ke=!Ve.removeAllProperties&&(((Be=Ve.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((Me=Ve.addOrUpdateProperties)===null||Me===void 0?void 0:Me.length)>0);if((Ve.newGeometry||Ve.removeAllProperties||Ke)&&(Ge=Object.assign({},Ge),de.set(Ve.id,Ge),Ke&&(Ge.properties=Object.assign({},Ge.properties))),Ve.newGeometry&&(Ge.geometry=Ve.newGeometry),Ve.removeAllProperties)Ge.properties={};else if(((G=Ve.removeProperties)===null||G===void 0?void 0:G.length)>0)for(const ft of Ve.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,ft)&&delete Ge.properties[ft];if((($e=Ve.addOrUpdateProperties)===null||$e===void 0?void 0:$e.length)>0)for(const{key:ft,value:Nt}of Ve.addOrUpdateProperties)Ge.properties[ft]=Nt}}(this._dataUpdateable,W.dataDiff,ne),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class _n{constructor(W){this.self=W,this.actor=new d.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,ne)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=ne},this.self.addProtocol=d.bf,this.self.removeProtocol=d.bg,this.self.registerRTLTextPlugin=X=>{if(d.bA.isParsed())throw new Error("RTL text plugin already registered.");d.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,ne)=>this._getDEMWorkerSource(X,ne.source).loadTile(ne)),this.actor.registerMessageHandler("RDT",(X,ne)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,ne.source).removeTile(ne)})),this.actor.registerMessageHandler("GCEZ",(X,ne)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ne.type,ne.source).getClusterExpansionZoom(ne)})),this.actor.registerMessageHandler("GCC",(X,ne)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ne.type,ne.source).getClusterChildren(ne)})),this.actor.registerMessageHandler("GCL",(X,ne)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ne.type,ne.source).getClusterLeaves(ne)})),this.actor.registerMessageHandler("LD",(X,ne)=>this._getWorkerSource(X,ne.type,ne.source).loadData(ne)),this.actor.registerMessageHandler("LT",(X,ne)=>this._getWorkerSource(X,ne.type,ne.source).loadTile(ne)),this.actor.registerMessageHandler("RT",(X,ne)=>this._getWorkerSource(X,ne.type,ne.source).reloadTile(ne)),this.actor.registerMessageHandler("AT",(X,ne)=>this._getWorkerSource(X,ne.type,ne.source).abortTile(ne)),this.actor.registerMessageHandler("RMT",(X,ne)=>this._getWorkerSource(X,ne.type,ne.source).removeTile(ne)),this.actor.registerMessageHandler("RS",(X,ne)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][ne.type]||!this.workerSources[X][ne.type][ne.source])return;const de=this.workerSources[X][ne.type][ne.source];delete this.workerSources[X][ne.type][ne.source],de.removeSource!==void 0&&de.removeSource(ne)})),this.actor.registerMessageHandler("RM",X=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,ne)=>d._(this,void 0,void 0,function*(){this.referrer=ne})),this.actor.registerMessageHandler("SRPS",(X,ne)=>this._syncRTLPluginState(X,ne)),this.actor.registerMessageHandler("IS",(X,ne)=>d._(this,void 0,void 0,function*(){this.self.importScripts(ne)})),this.actor.registerMessageHandler("SI",(X,ne)=>this._setImages(X,ne)),this.actor.registerMessageHandler("UL",(X,ne)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(ne.layers,ne.removedIds)})),this.actor.registerMessageHandler("SL",(X,ne)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(ne)}))}_setImages(W,X){return d._(this,void 0,void 0,function*(){this.availableImages[W]=X;for(const ne in this.workerSources[W]){const de=this.workerSources[W][ne];for(const Ae in de)de[Ae].availableImages=X}})}_syncRTLPluginState(W,X){return d._(this,void 0,void 0,function*(){if(d.bA.isParsed())return d.bA.getState();if(X.pluginStatus!=="loading")return d.bA.setState(X),X;const ne=X.pluginURL;if(this.self.importScripts(ne),d.bA.isParsed()){const de={pluginStatus:"loaded",pluginURL:ne};return d.bA.setState(de),de}throw d.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ne}`)})}_getAvailableImages(W){let X=this.availableImages[W];return X||(X=[]),X}_getLayerIndex(W){let X=this.layerIndexes[W];return X||(X=this.layerIndexes[W]=new a),X}_getWorkerSource(W,X,ne){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][X]||(this.workerSources[W][X]={}),!this.workerSources[W][X][ne]){const de={sendAsync:(Ae,Pe)=>(Ae.targetMapId=W,this.actor.sendAsync(Ae,Pe))};switch(X){case"vector":this.workerSources[W][X][ne]=new S(de,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][X][ne]=new no(de,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][X][ne]=new this.externalWorkerSourceTypes[X](de,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][X][ne]}_getDEMWorkerSource(W,X){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][X]||(this.demWorkerSources[W][X]=new C),this.demWorkerSources[W][X]}}return d.i(self)&&(self.worker=new _n(self)),_n}),l("index",["exports","./shared"],function(d,a){var _="4.1.3";let y,x;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:v=>new Promise((o,h)=>{const p=requestAnimationFrame(o);v.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(v,o=0){return this.getImageCanvasContext(v).getImageData(-o,-o,v.width+2*o,v.height+2*o)},getImageCanvasContext(v){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=v.width,o.height=v.height,h.drawImage(v,0,0,v.width,v.height),h},resolveURL:v=>(y||(y=document.createElement("a")),y.href=v,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class C{static testProp(o){if(!C.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in C.docStyle)return o[h];return o[0]}static create(o,h,p){const m=window.document.createElement(o);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(o,h){o.style[C.transformProp]=h}static addEventListener(o,h,p,m={}){o.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(o,h,p,m={}){o.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-o.clientLeft,(p.clientY-m.top)/h.y-o.clientTop)}static mousePos(o,h){const p=C.getScale(o);return C.getPoint(o,p,h)}static touchPos(o,h){const p=[],m=C.getScale(o);for(let b=0;b<h.length;b++)p.push(C.getPoint(o,m,h[b]));return p}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(v){!D&&R&&(B?N(v):P=v)}};let P,R,D=!1,B=!1;function N(v){const o=v.createTexture();v.bindTexture(v.TEXTURE_2D,o);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,R),v.isContextLost())return;L.supported=!0}catch{}v.deleteTexture(o),D=!0}var $;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){P&&N(P),P=null,B=!0},R.onerror=function(){D=!0,P=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let o,h,p,m;v.resetRequestQueue=()=>{o=[],h=0,p=0,m={}},v.addThrottleControl=A=>{const F=p++;return m[F]=A,F},v.removeThrottleControl=A=>{delete m[A],M()},v.getImage=(A,F,V=!0)=>new Promise((q,Q)=>{L.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),a.e(A,{type:"image"}),o.push({abortController:F,requestParameters:A,supportImageRefresh:V,state:"queued",onError:pe=>{Q(pe)},onSuccess:pe=>{q(pe)}}),M()});const b=A=>a._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:F,supportImageRefresh:V,onError:q,onSuccess:Q,abortController:pe}=A,fe=V===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((Ie,Ze)=>Ie&&Ze==="accept",!0));h++;const _e=fe?E(F,pe):a.m(F,pe);try{const Ie=yield _e;delete A.abortController,A.state="completed",Ie.data instanceof HTMLImageElement||a.b(Ie.data)?Q(Ie):Ie.data&&Q({data:yield(ue=Ie.data,typeof createImageBitmap=="function"?a.d(ue):a.f(ue)),cacheControl:Ie.cacheControl,expires:Ie.expires})}catch(Ie){delete A.abortController,q(Ie)}finally{h--,M()}var ue}),M=()=>{const A=(()=>{for(const F of Object.keys(m))if(m[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=h;F<A&&o.length>0;F++){const V=o.shift();V.abortController.signal.aborted?F--:b(V)}},E=(A,F)=>new Promise((V,q)=>{const Q=new Image,pe=A.url,fe=A.credentials;fe&&fe==="include"?Q.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!a.s(pe))&&(Q.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{Q.src="",q(a.c())}),Q.fetchPriority="high",Q.onload=()=>{Q.onerror=Q.onload=null,V({data:Q})},Q.onerror=()=>{Q.onerror=Q.onload=null,F.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Q.src=pe})}($||($={})),$.resetRequestQueue();class j{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const m=function(b){const M=b.match(le);if(!M)throw new Error(`Unable to parse URL "${b}"`);return{protocol:M[1],authority:M[2],path:M[3]||"/",params:M[4]?M[4].split("&"):[]}}(o);return m.path+=`${h}${p}`,function(b){const M=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${M}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const le=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ce(v){var o=new a.A(3);return o[0]=v[0],o[1]=v[1],o[2]=v[2],o}var J,te=function(v,o,h){return v[0]=o[0]-h[0],v[1]=o[1]-h[1],v[2]=o[2]-h[2],v};J=new a.A(3),a.A!=Float32Array&&(J[0]=0,J[1]=0,J[2]=0);var ye=function(v){var o=v[0],h=v[1];return o*o+h*h};function Ue(v){const o=[];if(typeof v=="string")o.push({id:"default",url:v});else if(v&&v.length>0){const h=[];for(const{id:p,url:m}of v){const b=`${p}${m}`;h.indexOf(b)===-1&&(h.push(b),o.push({id:p,url:m}))}}return o}(function(){var v=new a.A(2);a.A!=Float32Array&&(v[0]=0,v[1]=0)})();class oe{constructor(o,h,p,m){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,m)}update(o,h,p){const{width:m,height:b}=o,M=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:E}=this,{gl:A}=E;if(this.useMipmap=!!(h&&h.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!h||h.premultiply!==!1)),M)this.size=[m,b],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,o):A.texImage2D(A.TEXTURE_2D,0,this.format,m,b,0,this.format,A.UNSIGNED_BYTE,o.data);else{const{x:F,y:V}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?A.texSubImage2D(A.TEXTURE_2D,0,F,V,A.RGBA,A.UNSIGNED_BYTE,o):A.texSubImage2D(A.TEXTURE_2D,0,F,V,m,b,A.RGBA,A.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(o,h,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),o!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,o),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ve(v){const{userImage:o}=v;return!!(o&&o.render&&o.render())&&(v.data.replace(new Uint8Array(o.data.buffer)),!0)}class st extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const m of o){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,b=p&&p.height||h.data.height;return!(o[0]<0||m<o[0]||o[1]<0||b<o[1]||o[2]<0||m<o[2]||o[3]<0||b<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h,p=!0){const m=this.getImage(o);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const b of o)this.images[b]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const p of o){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[o]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new oe(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const b in this.patterns)o.push(this.patterns[b].bin);const{w:h,h:p}=a.p(o),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const b in this.patterns){const{bin:M}=this.patterns[b],E=M.x+1,A=M.y+1,F=this.getImage(b).data,V=F.width,q=F.height;a.R.copy(F,m,{x:0,y:0},{x:E,y:A},{width:V,height:q}),a.R.copy(F,m,{x:0,y:q-1},{x:E,y:A-1},{width:V,height:1}),a.R.copy(F,m,{x:0,y:0},{x:E,y:A+q},{width:V,height:1}),a.R.copy(F,m,{x:V-1,y:0},{x:E-1,y:A},{width:1,height:q}),a.R.copy(F,m,{x:0,y:0},{x:E+V,y:A},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ve(p)&&this.updateImage(h,p)}}}const ze=1e20;function Qe(v,o,h,p,m,b,M,E,A){for(let F=o;F<o+p;F++)wt(v,h*b+F,b,m,M,E,A);for(let F=h;F<h+m;F++)wt(v,F*b+o,1,p,M,E,A)}function wt(v,o,h,p,m,b,M){b[0]=0,M[0]=-ze,M[1]=ze,m[0]=v[o];for(let E=1,A=0,F=0;E<p;E++){m[E]=v[o+E*h];const V=E*E;do{const q=b[A];F=(m[E]-m[q]+V-q*q)/(E-q)/2}while(F<=M[A]&&--A>-1);A++,b[A]=E,M[A]=F,M[A+1]=ze}for(let E=0,A=0;E<p;E++){for(;M[A+1]<E;)A++;const F=b[A],V=E-F;v[o+E*h]=m[F]+V*V}}class pt{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return a._(this,void 0,void 0,function*(){const h=[];for(const b in o)for(const M of o[b])h.push(this._getAndCacheGlyphsPromise(b,M));const p=yield Promise.all(h),m={};for(const{stack:b,id:M,glyph:E}of p)m[b]||(m[b]={}),m[b][M]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics};return m})}_getAndCacheGlyphsPromise(o,h){return a._(this,void 0,void 0,function*(){let p=this.entries[o];p||(p=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:o,id:h,glyph:m};if(m=this._tinySDF(p,o,h),m)return p.glyphs[h]=m,{stack:o,id:h,glyph:m};const b=Math.floor(h/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:o,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const E=pt.loadGlyphRange(o,b,this.url,this.requestManager);p.requests[b]=E}const M=yield p.requests[b];for(const E in M)this._doesCharSupportLocalGlyph(+E)||(p.glyphs[+E]=M[+E]);return p.ranges[b]=!0,{stack:o,id:h,glyph:M[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](o)||a.u["Hangul Syllables"](o)||a.u.Hiragana(o)||a.u.Katakana(o))}_tinySDF(o,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=o.tinySDF;if(!b){let E="400";/bold/i.test(h)?E="900":/medium/i.test(h)?E="500":/light/i.test(h)&&(E="200"),b=o.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:E})}const M=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:M.width||60,height:M.height||60},M.data),metrics:{width:M.glyphWidth/2||24,height:M.glyphHeight/2||24,left:M.glyphLeft/2+.5||0,top:M.glyphTop/2-27.5||-8,advance:M.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(v,o,h,p){return a._(this,void 0,void 0,function*(){const m=256*o,b=m+255,M=p.transformRequest(h.replace("{fontstack}",v).replace("{range}",`${m}-${b}`),"Glyphs"),E=yield a.l(M,new AbortController);if(!E||!E.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${b}`);const A={};for(const F of a.n(E.data))A[F.id]=F;return A})},pt.TinySDF=class{constructor({fontSize:v=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:M="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const E=this.size=v+4*o,A=this._createCanvas(E),F=this.ctx=A.getContext("2d",{willReadFrequently:!0});F.font=`${M} ${b} ${v}px ${m}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(v){const o=document.createElement("canvas");return o.width=o.height=v,o}draw(v){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(v),M=Math.ceil(h),E=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),A=Math.min(this.size-this.buffer,M+Math.ceil(p)),F=E+2*this.buffer,V=A+2*this.buffer,q=Math.max(F*V,0),Q=new Uint8ClampedArray(q),pe={data:Q,width:F,height:V,glyphWidth:E,glyphHeight:A,glyphTop:M,glyphLeft:0,glyphAdvance:o};if(E===0||A===0)return pe;const{ctx:fe,buffer:_e,gridInner:ue,gridOuter:Ie}=this;fe.clearRect(_e,_e,E,A),fe.fillText(v,_e,_e+M);const Ze=fe.getImageData(_e,_e,E,A);Ie.fill(ze,0,q),ue.fill(0,0,q);for(let be=0;be<A;be++)for(let Re=0;Re<E;Re++){const We=Ze.data[4*(be*E+Re)+3]/255;if(We===0)continue;const He=(be+_e)*F+Re+_e;if(We===1)Ie[He]=0,ue[He]=ze;else{const Xe=.5-We;Ie[He]=Xe>0?Xe*Xe:0,ue[He]=Xe<0?Xe*Xe:0}}Qe(Ie,0,0,F,V,F,this.f,this.v,this.z),Qe(ue,_e,_e,E,A,F,this.f,this.v,this.z);for(let be=0;be<q;be++){const Re=Math.sqrt(Ie[be])-Math.sqrt(ue[be]);Q[be]=Math.round(255-255*(Re/this.radius+this.cutoff))}return pe}};class nt{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,h){return a.y(o.expression.evaluate(h))}interpolate(o,h,p){return{x:a.z.number(o.x,h.x,p),y:a.z.number(o.y,h.y,p),z:a.z.number(o.z,h.z,p)}}}let Ht;class oi extends a.E{constructor(o){super(),Ht=Ht||new a.q({anchor:new a.D(a.v.light.anchor),position:new nt,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ht),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(a.r,o,h))for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&a.t(this,o.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Dt{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const m=[];let b=o.length%2==1?-o[o.length-1]*p:0,M=o[0]*p,E=!0;m.push({left:b,right:M,isDash:E,zeroLength:o[0]===0});let A=o[0];for(let F=1;F<o.length;F++){E=!E;const V=o[F];b=A*p,A+=V,M=A*p,m.push({left:b,right:M,isDash:E,zeroLength:V===0})}return m}addRoundDash(o,h,p){const m=h/2;for(let b=-p;b<=p;b++){const M=this.width*(this.nextRow+p+b);let E=0,A=o[E];for(let F=0;F<this.width;F++){F/A.right>1&&(A=o[++E]);const V=Math.abs(F-A.left),q=Math.abs(F-A.right),Q=Math.min(V,q);let pe;const fe=b/p*(m+1);if(A.isDash){const _e=m-Math.abs(fe);pe=Math.sqrt(Q*Q+_e*_e)}else pe=m-Math.sqrt(Q*Q+fe*fe);this.data[M+F]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(o){for(let E=o.length-1;E>=0;--E){const A=o[E],F=o[E+1];A.zeroLength?o.splice(E,1):F&&F.isDash===A.isDash&&(F.left=A.left,o.splice(E,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let b=0,M=o[b];for(let E=0;E<this.width;E++){E/M.right>1&&(M=o[++b]);const A=Math.abs(E-M.left),F=Math.abs(E-M.right),V=Math.min(A,F);this.data[m+E]=Math.max(0,Math.min(255,(M.isDash?V:-V)+128))}}addDash(o,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let E=0;E<o.length;E++)b+=o[E];if(b!==0){const E=this.width/b,A=this.getDashRanges(o,this.width,E);h?this.addRoundDash(A,E,p):this.addRegularDash(A)}const M={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,M}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const mt="maplibre_preloaded_worker_pool";class ti{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<ti.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mt]}numActive(){return Object.keys(this.active).length}}const Pt=Math.floor(S.hardwareConcurrency/2);let Rt,ct;function Jt(){return Rt||(Rt=new ti),Rt}ti.workerCount=a.B(globalThis)?Math.max(Math.min(Pt,3),1):1;class Yt{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const b=new a.C(p[m],h);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:o,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const p of this.actors)p.registerMessageHandler(o,h)}}function Ei(){return ct||(ct=new Yt(Jt(),a.G),ct.registerMessageHandler("GR",(v,o,h)=>a.m(o,h))),ct}function Fi(v,o){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*v.width,.5*v.height,1]),a.K(h,h,v.calculatePosMatrix(o.toUnwrapped()))}function ht(v,o,h,p,m,b){const M=function(q,Q,pe){if(q)for(const fe of q){const _e=Q[fe];if(_e&&_e.source===pe&&_e.type==="fill-extrusion")return!0}else for(const fe in Q){const _e=Q[fe];if(_e.source===pe&&_e.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,v.id),E=b.maxPitchScaleFactor(),A=v.tilesIn(p,E,M);A.sort(Ot);const F=[];for(const q of A)F.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(o,h,v._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,m,b,E,Fi(v.transform,q.tileID))});const V=function(q){const Q={},pe={};for(const fe of q){const _e=fe.queryResults,ue=fe.wrappedTileID,Ie=pe[ue]=pe[ue]||{};for(const Ze in _e){const be=_e[Ze],Re=Ie[Ze]=Ie[Ze]||{},We=Q[Ze]=Q[Ze]||[];for(const He of be)Re[He.featureIndex]||(Re[He.featureIndex]=!0,We.push(He))}}return Q}(F);for(const q in V)V[q].forEach(Q=>{const pe=Q.feature,fe=v.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=fe});return V}function Ot(v,o){const h=v.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Fe(v,o,h){return a._(this,void 0,void 0,function*(){let p=v;if(v.url?p=(yield a.h(o.transformRequest(v.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.L(a.e(p,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class Ne{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}extend(o){const h=this._sw,p=this._ne;let m,b;if(o instanceof a.M)m=o,b=o;else{if(!(o instanceof Ne))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Ne.convert(o)):this.extend(a.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.M.convert(o)):this;if(m=o._sw,b=o._ne,!m||!b)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(b.lng,b.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:p}=a.M.convert(o);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(o){return o instanceof Ne?o:o&&new Ne(o)}static fromLngLat(o,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*o.lat);return new Ne(new a.M(o.lng-m,o.lat-p),new a.M(o.lng+m,o.lat+p))}}class dt{constructor(o,h,p){this.bounds=Ne.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),b=Math.ceil(a.N(this.bounds.getEast())*h),M=Math.ceil(a.O(this.bounds.getSouth())*h);return o.x>=p&&o.x<b&&o.y>=m&&o.y<M}}class bt extends a.E{constructor(o,h,p,m){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Fe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(a.e(this,o),o.bounds&&(this.tileBounds=new dt(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((b,M)=>{o.reloadPromise={resolve:b,reject:M}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const b=yield o.actor.sendAsync({type:m,data:p},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,b)}catch(b){if(delete o.abortController,o.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const p=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(p.resolve).catch(p.reject)}}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class we extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Fe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new dt(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const p=yield $.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&o.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,M=p.data;o.texture=this.map.painter.getTileTexture(M.width),o.texture?o.texture.update(M,{useMipmap:!0}):(o.texture=new oe(m,M,b.RGBA,{useMipmap:!0}),o.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(p){if(delete o.abortController,o.aborted)o.state="unloaded";else if(p)throw o.state="errored",p}})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class Ii extends we{constructor(o,h,p,m){super(o,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield $.getImage(p,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const M=a.b(b)&&a.S()?b:yield this.readImageNow(b),E={type:this.type,uid:o.uid,source:this.id,rawImageData:M,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const A=yield o.actor.sendAsync({type:"LDT",data:E});o.dem=A,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=o.width+2,p=o.height+2;try{return new a.R({width:h,height:p},yield a.V(o,-1,-1,h,p))}catch{}}return S.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,b=h.x===0?o.wrap-1:o.wrap,M=(h.x+1+p)%p,E=h.x+1===p?o.wrap+1:o.wrap,A={};return A[new a.Q(o.overscaledZ,b,h.z,m,h.y).key]={backfilled:!1},A[new a.Q(o.overscaledZ,E,h.z,M,h.y).key]={backfilled:!1},h.y>0&&(A[new a.Q(o.overscaledZ,b,h.z,m,h.y-1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,E,h.z,M,h.y-1).key]={backfilled:!1}),h.y+1<p&&(A[new a.Q(o.overscaledZ,b,h.z,m,h.y+1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,E,h.z,M,h.y+1).key]={backfilled:!1}),A}unloadTile(o){return a._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class qe extends a.E{constructor(o,h,p,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:p}})}_updateWorkerData(o){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(b,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const p={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Je=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vt extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(o){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield $.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(a.Y.fromLngLat);this.tileID=function(m){let b=1/0,M=1/0,E=-1/0,A=-1/0;for(const Q of m)b=Math.min(b,Q.x),M=Math.min(M,Q.y),E=Math.max(E,Q.x),A=Math.max(A,Q.y);const F=Math.max(E-b,A-M),V=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),q=Math.pow(2,V);return new a.a0(V,Math.floor((b+E)/2*q),Math.floor((M+A)/2*q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Je.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new oe(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Pi extends Vt{constructor(o,h,p,m){super(o,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Je.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new oe(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wi extends Vt{constructor(o,h,p,m){super(o,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(M=>typeof M!="number"))||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Je.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new oe(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const M=this.tiles[b];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const gn={},In=v=>{switch(v){case"geojson":return qe;case"image":return Vt;case"raster":return we;case"raster-dem":return Ii;case"vector":return bt;case"video":return Pi;case"canvas":return wi}return gn[v]},tn="RTLPluginLoaded";class io extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ei()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(tn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Oi=null;function rt(){return Oi||(Oi=new io),Oi}class Li{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,b){const M={};if(!b)return M;for(const E of m){const A=E.layerIds.map(F=>b.getLayer(F)).filter(Boolean);if(A.length!==0){E.layers=A,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(F=>A.filter(V=>V.id===F)[0]));for(const F of A)M[F.id]=E}}return M}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5&&b.hasRTLText){this.hasRTLText=!0,rt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(b))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new oe(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new oe(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,m,b,M,E,A,F,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:M,tileSize:this.tileSize,pixelPosMatrix:V,transform:A,params:E,queryPadding:this.queryPadding*F},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",M=m._geojsonTileLayer||m[b];if(!M)return;const E=a.a6(h&&h.filter),{z:A,x:F,y:V}=this.tileID.canonical,q={z:A,x:F,y:V};for(let Q=0;Q<M.length;Q++){const pe=M.feature(Q);if(E.needGeometry){const ue=a.a7(pe,!0);if(!E.filter(new a.a8(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!E.filter(new a.a8(this.tileID.overscaledZ),pe))continue;const fe=p.getId(pe,b),_e=new a.a9(pe,A,F,V,fe);_e.tile=q,o.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=a.aa(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const b=this.expirationTime-h;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const b=this.buckets[m],M=b.layers[0].sourceLayer||"_geojsonTileLayer",E=p[M],A=o[M];if(!E||!A||Object.keys(A).length===0)continue;b.update(A,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=h&&h.style&&h.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=S.now()+o}setDependencies(o,h){const p={};for(const m of h)p[m]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const m=this.dependencies[p];if(m){for(const b of h)if(m[b])return!0}}return!1}}class ii{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:h,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(o,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const m of this.data[p])o(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Ni{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const m=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},a.e(this.stateChanges[o][m],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const b in this.state[o])b!==m&&(this.deletedStates[o][b]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const b in this.state[o][m])p[b]||(this.deletedStates[o][m][b]=null)}else for(const b in p)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][b]===null&&delete this.deletedStates[o][m][b]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const m=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(p in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][p]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),m=a.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const b=this.deletedStates[o][h];if(b===null)return{};for(const M in b)delete m[M]}return m}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const M in this.stateChanges[m])this.state[m][M]||(this.state[m][M]={}),a.e(this.state[m][M],this.stateChanges[m][M]),b[M]=this.state[m][M];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const M in this.state[m])b[M]={},this.state[m][M]={};else for(const M in this.deletedStates[m]){if(this.deletedStates[m][M]===null)this.state[m][M]={};else for(const E of Object.keys(this.deletedStates[m][M]))delete this.state[m][M][E];b[M]=this.state[m][M]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in o)o[m].setFeatureState(p,h)}}class Ki extends a.E{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,M,E)=>{const A=new(In(b.type))(m,b,M,E);if(A.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${A.id}`);return A})(o,h,p,this),this._tiles={},this._cache=new ii(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ni,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,p)}catch(m){o.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(yt).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,m)=>{const b=p.tileID,M=m.tileID,E=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),A=new a.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-M.overscaledZ||A.y-E.y||A.x-E.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(yt).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,o,h))})}_tileLoaded(o,h,p){o.timeAdded=S.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const b=h[m];if(o.neighboringTiles&&o.neighboringTiles[b]){const M=this.getTileByID(b);p(o,M),p(M,o)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let M=b.tileID.canonical.x-m.tileID.canonical.x;const E=b.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),F=b.tileID.key;M===0&&E===0||Math.abs(E)>1||(Math.abs(M)>1&&(Math.abs(M+A)===1?M+=A:Math.abs(M-A)===1&&(M-=A)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,M,E),m.neighboringTiles&&m.neighboringTiles[F]&&(m.neighboringTiles[F].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,m){for(const b in this._tiles){let M=this._tiles[b];if(m[b]||!M.hasData()||M.tileID.overscaledZ<=h||M.tileID.overscaledZ>p)continue;let E=M.tileID;for(;M&&M.tileID.overscaledZ>h+1;){const F=M.tileID.scaledTo(M.tileID.overscaledZ-1);M=this._tiles[F.key],M&&M.hasData()&&(E=F)}let A=E;for(;A.overscaledZ>h;)if(A=A.scaledTo(A.overscaledZ-1),o[A.key]){m[E.key]=E;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const m=o.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new a.Q(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(V=>this._source.hasTile(V)))):p=[];const m=o.coveringZoomLevel(this._source),b=Math.max(m-Ki.maxOverzooming,this._source.minzoom),M=Math.max(m+Ki.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const q of p)if(q.canonical.z>this._source.minzoom){const Q=q.scaledTo(q.canonical.z-1);V[Q.key]=Q;const pe=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));V[pe.key]=pe}p=p.concat(Object.values(V))}const E=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,E&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(p,m);if(li(this._source.type)){const V={},q={},Q=Object.keys(A),pe=S.now();for(const fe of Q){const _e=A[fe],ue=this._tiles[fe];if(!ue||ue.fadeEndTime!==0&&ue.fadeEndTime<=pe)continue;const Ie=this.findLoadedParent(_e,b);Ie&&(this._addTile(Ie.tileID),V[Ie.tileID.key]=Ie.tileID),q[fe]=_e}this._retainLoadedChildren(q,m,M,A);for(const fe in V)A[fe]||(this._coveredTiles[fe]=!0,A[fe]=V[fe]);if(h){const fe={},_e={};for(const ue of p)this._tiles[ue.key].hasData()?fe[ue.key]=ue:_e[ue.key]=ue;for(const ue in _e){const Ie=_e[ue].children(this._source.maxzoom);this._tiles[Ie[0].key]&&this._tiles[Ie[1].key]&&this._tiles[Ie[2].key]&&this._tiles[Ie[3].key]&&(fe[Ie[0].key]=A[Ie[0].key]=Ie[0],fe[Ie[1].key]=A[Ie[1].key]=Ie[1],fe[Ie[2].key]=A[Ie[2].key]=Ie[2],fe[Ie[3].key]=A[Ie[3].key]=Ie[3],delete _e[ue])}for(const ue in _e){const Ie=this.findLoadedParent(_e[ue],this._source.minzoom);if(Ie){fe[Ie.tileID.key]=A[Ie.tileID.key]=Ie.tileID;for(const Ze in fe)fe[Ze].isChildOf(Ie.tileID)&&delete fe[Ze]}}for(const ue in this._tiles)fe[ue]||(this._coveredTiles[ue]=!0)}}for(const V in A)this._tiles[V].clearFadeHold();const F=a.ab(this._tiles,A);for(const V of F){const q=this._tiles[V];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},m={},b=Math.max(h-Ki.maxOverzooming,this._source.minzoom),M=Math.max(h+Ki.maxUnderzooming,this._source.minzoom),E={};for(const A of o){const F=this._addTile(A);p[A.key]=A,F.hasData()||h<this._source.maxzoom&&(E[A.key]=A)}this._retainLoadedChildren(E,h,M,p);for(const A of o){let F=this._tiles[A.key];if(F.hasData())continue;if(h+1>this._source.maxzoom){const q=A.children(this._source.maxzoom)[0],Q=this.getTile(q);if(Q&&Q.hasData()){p[q.key]=q;continue}}else{const q=A.children(this._source.maxzoom);if(p[q[0].key]&&p[q[1].key]&&p[q[2].key]&&p[q[3].key])continue}let V=F.wasRequested();for(let q=A.overscaledZ-1;q>=b;--q){const Q=A.scaledTo(q);if(m[Q.key])break;if(m[Q.key]=!0,F=this.getTile(Q),!F&&V&&(F=this._addTile(Q)),F){const pe=F.hasData();if((V||pe)&&(p[Q.key]=Q),V=F.wasRequested(),pe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of h)this._loadedParentTiles[b]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new Li(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const m=[],b=this.transform;if(!b)return m;const M=p?b.getCameraQueryGeometry(o):o,E=o.map(fe=>b.pointCoordinate(fe,this.terrain)),A=M.map(fe=>b.pointCoordinate(fe,this.terrain)),F=this.getIds();let V=1/0,q=1/0,Q=-1/0,pe=-1/0;for(const fe of A)V=Math.min(V,fe.x),q=Math.min(q,fe.y),Q=Math.max(Q,fe.x),pe=Math.max(pe,fe.y);for(let fe=0;fe<F.length;fe++){const _e=this._tiles[F[fe]];if(_e.holdingForFade())continue;const ue=_e.tileID,Ie=Math.pow(2,b.zoom-_e.tileID.overscaledZ),Ze=h*_e.queryPadding*a.W/_e.tileSize/Ie,be=[ue.getTilePoint(new a.Y(V,q)),ue.getTilePoint(new a.Y(Q,pe))];if(be[0].x-Ze<a.W&&be[0].y-Ze<a.W&&be[1].x+Ze>=0&&be[1].y+Ze>=0){const Re=E.map(He=>ue.getTilePoint(He)),We=A.map(He=>ue.getTilePoint(He));m.push({tile:_e,tileID:ue,queryGeometry:Re,cameraQueryGeometry:We,scale:Ie})}}return m}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(li(this._source.type)){const o=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const m=this._tiles[o];m&&m.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function yt(v,o){const h=Math.abs(2*v.wrap)-+(v.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return v.overscaledZ-o.overscaledZ||p-h||o.canonical.y-v.canonical.y||o.canonical.x-v.canonical.x}function li(v){return v==="raster"||v==="image"||v==="video"}Ki.maxOverzooming=10,Ki.maxUnderzooming=3;class ni{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ac(o,0,1);let h=1,p=this._distances[h];const m=o*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const b=h-1,M=this._distances[b],E=p-M,A=E>0?(m-M)/E:0;return this.points[b].mult(1-A).add(this.points[h].mult(A))}}function Ji(v,o){let h=!0;return v==="always"||v!=="never"&&o!=="never"||(h=!1),h}class xr{constructor(o,h,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let M=0;M<this.xCellCount*this.yCellCount;M++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,m,b){this._forEachCell(h,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(o,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(o,h,p,m,b,M){this.boxCells[b].push(M)}_insertCircleCell(o,h,p,m,b,M){this.circleCells[b].push(M)}_query(o,h,p,m,b,M,E){if(p<0||o>this.width||m<0||h>this.height)return[];const A=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:o,y1:h,x2:p,y2:m}];for(let F=0;F<this.boxKeys.length;F++)A.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],q=this.circles[3*F+1],Q=this.circles[3*F+2];A.push({key:this.circleKeys[F],x1:V-Q,y1:q-Q,x2:V+Q,y2:q+Q})}}else this._forEachCell(o,h,p,m,this._queryCell,A,{hitTest:b,overlapMode:M,seenUids:{box:{},circle:{}}},E);return A}query(o,h,p,m){return this._query(o,h,p,m,!1,null)}hitTest(o,h,p,m,b,M){return this._query(o,h,p,m,!0,b,M).length>0}hitTestCircle(o,h,p,m,b){const M=o-p,E=o+p,A=h-p,F=h+p;if(E<0||M>this.width||F<0||A>this.height)return!1;const V=[];return this._forEachCell(M,A,E,F,this._queryCellCircle,V,{hitTest:!0,overlapMode:m,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},b),V.length>0}_queryCell(o,h,p,m,b,M,E,A){const{seenUids:F,hitTest:V,overlapMode:q}=E,Q=this.boxCells[b];if(Q!==null){const fe=this.bboxes;for(const _e of Q)if(!F.box[_e]){F.box[_e]=!0;const ue=4*_e,Ie=this.boxKeys[_e];if(o<=fe[ue+2]&&h<=fe[ue+3]&&p>=fe[ue+0]&&m>=fe[ue+1]&&(!A||A(Ie))&&(!V||!Ji(q,Ie.overlapMode))&&(M.push({key:Ie,x1:fe[ue],y1:fe[ue+1],x2:fe[ue+2],y2:fe[ue+3]}),V))return!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!F.circle[_e]){F.circle[_e]=!0;const ue=3*_e,Ie=this.circleKeys[_e];if(this._circleAndRectCollide(fe[ue],fe[ue+1],fe[ue+2],o,h,p,m)&&(!A||A(Ie))&&(!V||!Ji(q,Ie.overlapMode))){const Ze=fe[ue],be=fe[ue+1],Re=fe[ue+2];if(M.push({key:Ie,x1:Ze-Re,y1:be-Re,x2:Ze+Re,y2:be+Re}),V)return!0}}}return!1}_queryCellCircle(o,h,p,m,b,M,E,A){const{circle:F,seenUids:V,overlapMode:q}=E,Q=this.boxCells[b];if(Q!==null){const fe=this.bboxes;for(const _e of Q)if(!V.box[_e]){V.box[_e]=!0;const ue=4*_e,Ie=this.boxKeys[_e];if(this._circleAndRectCollide(F.x,F.y,F.radius,fe[ue+0],fe[ue+1],fe[ue+2],fe[ue+3])&&(!A||A(Ie))&&!Ji(q,Ie.overlapMode))return M.push(!0),!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!V.circle[_e]){V.circle[_e]=!0;const ue=3*_e,Ie=this.circleKeys[_e];if(this._circlesCollide(fe[ue],fe[ue+1],fe[ue+2],F.x,F.y,F.radius)&&(!A||A(Ie))&&!Ji(q,Ie.overlapMode))return M.push(!0),!0}}}_forEachCell(o,h,p,m,b,M,E,A){const F=this._convertToXCellCoord(o),V=this._convertToYCellCoord(h),q=this._convertToXCellCoord(p),Q=this._convertToYCellCoord(m);for(let pe=F;pe<=q;pe++)for(let fe=V;fe<=Q;fe++)if(b.call(this,o,h,p,m,this.xCellCount*fe+pe,M,E,A))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,m,b,M){const E=m-o,A=b-h,F=p+M;return F*F>E*E+A*A}_circleAndRectCollide(o,h,p,m,b,M,E){const A=(M-m)/2,F=Math.abs(o-(m+A));if(F>A+p)return!1;const V=(E-b)/2,q=Math.abs(h-(b+V));if(q>V+p)return!1;if(F<=A||q<=V)return!0;const Q=F-A,pe=q-V;return Q*Q+pe*pe<=p*p}}function si(v,o,h,p,m){const b=a.F();return o?(a.J(b,b,[1/m,1/m,1]),h||a.ad(b,b,p.angle)):a.K(b,p.labelPlaneMatrix,v),b}function no(v,o,h,p,m){if(o){const b=a.ae(v);return a.J(b,b,[m,m,1]),h||a.ad(b,b,-p.angle),b}return p.glCoordMatrix}function _n(v,o,h){let p;h?(p=[v.x,v.y,h(v.x,v.y),1],a.af(p,p,o)):(p=[v.x,v.y,0,1],Ke(p,p,o));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function me(v,o){return .5+v/o*.5}function W(v,o){const h=v[0]/v[3],p=v[1]/v[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function X(v,o,h,p,m,b,M,E,A,F){const V=p?v.textSizeData:v.iconSizeData,q=a.ag(V,h.transform.zoom),Q=[256/h.width*2+1,256/h.height*2+1],pe=p?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;pe.clear();const fe=v.lineVertexArray,_e=p?v.text.placedSymbolArray:v.icon.placedSymbolArray,ue=h.transform.width/h.transform.height;let Ie=!1;for(let Ze=0;Ze<_e.length;Ze++){const be=_e.get(Ze);if(be.hidden||be.writingMode===a.ah.vertical&&!Ie){Ge(be.numGlyphs,pe);continue}let Re;if(Ie=!1,F?(Re=[be.anchorX,be.anchorY,F(be.anchorX,be.anchorY),1],a.af(Re,Re,o)):(Re=[be.anchorX,be.anchorY,0,1],Ke(Re,Re,o)),!W(Re,Q)){Ge(be.numGlyphs,pe);continue}const We=me(h.transform.cameraToCenterDistance,Re[3]),He=a.ai(V,q,be),Xe=M?He/We:He*We,ot=new a.P(be.anchorX,be.anchorY),it=_n(ot,m,F).point,gt={projections:{},offsets:{}},vt=Ae(be,Xe,!1,E,o,m,b,v.glyphOffsetArray,fe,pe,it,ot,gt,ue,A,F);Ie=vt.useVertical,(vt.notEnoughRoom||Ie||vt.needsFlipping&&Ae(be,Xe,!0,E,o,m,b,v.glyphOffsetArray,fe,pe,it,ot,gt,ue,A,F).notEnoughRoom)&&Ge(be.numGlyphs,pe)}p?v.text.dynamicLayoutVertexBuffer.updateData(pe):v.icon.dynamicLayoutVertexBuffer.updateData(pe)}function ne(v,o,h,p,m,b,M,E,A,F,V,q,Q){const pe=E.glyphStartIndex+E.numGlyphs,fe=E.lineStartIndex,_e=E.lineStartIndex+E.lineLength,ue=o.getoffsetX(E.glyphStartIndex),Ie=o.getoffsetX(pe-1),Ze=$e(v*ue,h,p,m,b,M,E.segment,fe,_e,A,F,V,q,Q);if(!Ze)return null;const be=$e(v*Ie,h,p,m,b,M,E.segment,fe,_e,A,F,V,q,Q);return be?{first:Ze,last:be}:null}function de(v,o,h,p){return v===a.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(v===a.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Ae(v,o,h,p,m,b,M,E,A,F,V,q,Q,pe,fe,_e){const ue=o/24,Ie=v.lineOffsetX*ue,Ze=v.lineOffsetY*ue;let be;if(v.numGlyphs>1){const Re=v.glyphStartIndex+v.numGlyphs,We=v.lineStartIndex,He=v.lineStartIndex+v.lineLength,Xe=ne(ue,E,Ie,Ze,h,V,q,v,A,b,Q,fe,_e);if(!Xe)return{notEnoughRoom:!0};const ot=_n(Xe.first.point,M,_e).point,it=_n(Xe.last.point,M,_e).point;if(p&&!h){const gt=de(v.writingMode,ot,it,pe);if(gt)return gt}be=[Xe.first];for(let gt=v.glyphStartIndex+1;gt<Re-1;gt++)be.push($e(ue*E.getoffsetX(gt),Ie,Ze,h,V,q,v.segment,We,He,A,b,Q,fe,_e));be.push(Xe.last)}else{if(p&&!h){const We=_n(q,m,_e).point,He=v.lineStartIndex+v.segment+1,Xe=new a.P(A.getx(He),A.gety(He)),ot=_n(Xe,m,_e),it=ot.signedDistanceFromCamera>0?ot.point:Pe(q,Xe,We,1,m,_e),gt=de(v.writingMode,We,it,pe);if(gt)return gt}const Re=$e(ue*E.getoffsetX(v.glyphStartIndex),Ie,Ze,h,V,q,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,A,b,Q,fe,_e);if(!Re)return{notEnoughRoom:!0};be=[Re]}for(const Re of be)a.aj(F,Re.point,Re.angle);return{}}function Pe(v,o,h,p,m,b){const M=_n(v.add(v.sub(o)._unit()),m,b).point,E=h.sub(M);return h.add(E._mult(p/E.mag()))}function Be(v,o){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:b,distanceFromAnchor:M,getElevation:E,previousVertex:A,direction:F,absOffsetX:V}=o;if(h.projections[v])return h.projections[v];const q=new a.P(p.getx(v),p.gety(v)),Q=_n(q,m,E);if(Q.signedDistanceFromCamera>0)return h.projections[v]=Q.point,Q.point;const pe=v-F;return Pe(M===0?b:new a.P(p.getx(pe),p.gety(pe)),q,A,V-M+1,m,E)}function Me(v,o,h){return v._unit()._perp()._mult(o*h)}function G(v,o,h,p,m,b,M,E){const{projectionCache:A,direction:F}=E;if(A.offsets[v])return A.offsets[v];const V=h.add(o);if(v+F<p||v+F>=m)return A.offsets[v]=V,V;const q=Be(v+F,E),Q=Me(q.sub(h),M,F),pe=h.add(Q),fe=q.add(Q);return A.offsets[v]=a.ak(b,V,pe,fe)||V,A.offsets[v]}function $e(v,o,h,p,m,b,M,E,A,F,V,q,Q,pe){const fe=p?v-o:v+o;let _e=fe>0?1:-1,ue=0;p&&(_e*=-1,ue=Math.PI),_e<0&&(ue+=Math.PI);let Ie,Ze,be=_e>0?E+M:E+M+1,Re=m,We=m,He=0,Xe=0;const ot=Math.abs(fe),it=[];let gt;for(;He+Xe<=ot;){if(be+=_e,be<E||be>=A)return null;He+=Xe,We=Re,Ze=Ie;const xt={projectionCache:q,lineVertexArray:F,labelPlaneMatrix:V,tileAnchorPoint:b,distanceFromAnchor:He,getElevation:pe,previousVertex:We,direction:_e,absOffsetX:ot};if(Re=Be(be,xt),h===0)it.push(We),gt=Re.sub(We);else{let ei;const ui=Re.sub(We);ei=ui.mag()===0?Me(Be(be+_e,xt).sub(Re),h,_e):Me(ui,h,_e),Ze||(Ze=We.add(ei)),Ie=G(be,ei,Re,E,A,Ze,h,xt),it.push(Ze),gt=Ie.sub(Ze)}Xe=gt.mag()}const vt=gt._mult((ot-He)/Xe)._add(Ze||We),ci=ue+Math.atan2(Re.y-We.y,Re.x-We.x);return it.push(vt),{point:vt,angle:Q?ci:0,path:it}}const Ve=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(v,o){for(let h=0;h<v;h++){const p=o.length;o.resize(p+4),o.float32.set(Ve,3*p)}}function Ke(v,o,h){const p=o[0],m=o[1];return v[0]=h[0]*p+h[4]*m+h[12],v[1]=h[1]*p+h[5]*m+h[13],v[3]=h[3]*p+h[7]*m+h[15],v}const ft=100;class Nt{constructor(o,h=new xr(o.width+200,o.height+200,25),p=new xr(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ft,this.screenBottomBoundary=o.height+ft,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,m,b,M){const E=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,M),A=p*E.perspectiveRatio,F=o.x1*A+E.point.x,V=o.y1*A+E.point.y,q=o.x2*A+E.point.x,Q=o.y2*A+E.point.y;return!this.isInsideGrid(F,V,q,Q)||h!=="always"&&this.grid.hitTest(F,V,q,Q,h,b)||E.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,V,q,Q],offscreen:this.isOffscreen(F,V,q,Q)}}placeCollisionCircles(o,h,p,m,b,M,E,A,F,V,q,Q,pe,fe){const _e=[],ue=new a.P(h.anchorX,h.anchorY),Ie=_n(ue,M,fe),Ze=me(this.transform.cameraToCenterDistance,Ie.signedDistanceFromCamera),be=(V?b/Ze:b*Ze)/a.ao,Re=_n(ue,E,fe).point,We=ne(be,m,h.lineOffsetX*be,h.lineOffsetY*be,!1,Re,ue,h,p,E,{projections:{},offsets:{}},!1,fe);let He=!1,Xe=!1,ot=!0;if(We){const it=.5*Q*Ze+pe,gt=new a.P(-100,-100),vt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),ci=new ni,xt=We.first,ei=We.last;let ui=[];for(let fi=xt.path.length-1;fi>=1;fi--)ui.push(xt.path[fi]);for(let fi=1;fi<ei.path.length;fi++)ui.push(ei.path[fi]);const Ci=2.5*it;if(A){const fi=ui.map(yi=>_n(yi,A,fe));ui=fi.some(yi=>yi.signedDistanceFromCamera<=0)?[]:fi.map(yi=>yi.point)}let ri=[];if(ui.length>0){const fi=ui[0].clone(),yi=ui[0].clone();for(let wn=1;wn<ui.length;wn++)fi.x=Math.min(fi.x,ui[wn].x),fi.y=Math.min(fi.y,ui[wn].y),yi.x=Math.max(yi.x,ui[wn].x),yi.y=Math.max(yi.y,ui[wn].y);ri=fi.x>=gt.x&&yi.x<=vt.x&&fi.y>=gt.y&&yi.y<=vt.y?[ui]:yi.x<gt.x||fi.x>vt.x||yi.y<gt.y||fi.y>vt.y?[]:a.al([ui],gt.x,gt.y,vt.x,vt.y)}for(const fi of ri){ci.reset(fi,.25*it);let yi=0;yi=ci.length<=.5*it?1:Math.ceil(ci.paddedLength/Ci)+1;for(let wn=0;wn<yi;wn++){const Ui=wn/Math.max(yi-1,1),Nr=ci.lerp(Ui),qn=Nr.x+ft,dn=Nr.y+ft;_e.push(qn,dn,it,0);const Zn=qn-it,$r=dn-it,xo=qn+it,Ko=dn+it;if(ot=ot&&this.isOffscreen(Zn,$r,xo,Ko),Xe=Xe||this.isInsideGrid(Zn,$r,xo,Ko),o!=="always"&&this.grid.hitTestCircle(qn,dn,it,o,q)&&(He=!0,!F))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!F&&He||!Xe||Ze<this.perspectiveRatioCutoff?[]:_e,offscreen:ot,collisionDetected:He}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,b=-1/0,M=-1/0;for(const V of o){const q=new a.P(V.x+ft,V.y+ft);p=Math.min(p,q.x),m=Math.min(m,q.y),b=Math.max(b,q.x),M=Math.max(M,q.y),h.push(q)}const E=this.grid.query(p,m,b,M).concat(this.ignoredGrid.query(p,m,b,M)),A={},F={};for(const V of E){const q=V.key;if(A[q.bucketInstanceId]===void 0&&(A[q.bucketInstanceId]={}),A[q.bucketInstanceId][q.featureIndex])continue;const Q=[new a.P(V.x1,V.y1),new a.P(V.x2,V.y1),new a.P(V.x2,V.y2),new a.P(V.x1,V.y2)];a.am(h,Q)&&(A[q.bucketInstanceId][q.featureIndex]=!0,F[q.bucketInstanceId]===void 0&&(F[q.bucketInstanceId]=[]),F[q.bucketInstanceId].push(q.featureIndex))}return F}insertCollisionBox(o,h,p,m,b,M){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:M,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,m,b,M){const E=p?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:b,collisionGroupID:M,overlapMode:h};for(let F=0;F<o.length;F+=4)E.insertCircle(A,o[F],o[F+1],o[F+2])}projectAndGetPerspectiveRatio(o,h,p,m){let b;return m?(b=[h,p,m(h,p),1],a.af(b,b,o)):(b=[h,p,0,1],Ke(b,b,o)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+ft,(-b[1]/b[3]+1)/2*this.transform.height+ft),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(o,h,p,m){return p<ft||o>=this.screenRightBoundary||m<ft||h>this.screenBottomBoundary}isInsideGrid(o,h,p,m){return p>=0&&o<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.an([]);return a.H(o,o,[-100,-100,0]),o}}function Qt(v,o,h){return o*(a.W/(v.tileSize*Math.pow(2,h-v.tileID.overscaledZ)))}class hi{constructor(o,h,p,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class xi{constructor(o,h,p,m,b){this.text=new hi(o?o.text:null,h,p,b),this.icon=new hi(o?o.icon:null,h,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class an{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class Rn{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class di{constructor(o,h,p,m,b){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class yn{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function Vn(v,o,h,p,m){const{horizontalAlign:b,verticalAlign:M}=a.at(v);return new a.P(-(b-.5)*o+p[0]*m,-(M-.5)*h+p[1]*m)}function mr(v,o,h,p,m,b){const{x1:M,x2:E,y1:A,y2:F,anchorPointX:V,anchorPointY:q}=v,Q=new a.P(o,h);return p&&Q._rotate(m?b:-b),{x1:M+Q.x,y1:A+Q.y,x2:E+Q.x,y2:F+Q.y,anchorPointX:V,anchorPointY:q}}class kr{constructor(o,h,p,m,b){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new Nt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new yn(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,m){const b=p.getBucket(h),M=p.latestFeatureIndex;if(!b||!M||h.id!==b.layerIds[0])return;const E=p.collisionBoxArray,A=b.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/a.W,q=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),Q=A.get("text-pitch-alignment")==="map",pe=A.get("text-rotation-alignment")==="map",fe=Qt(p,1,this.transform.zoom),_e=si(q,Q,pe,this.transform,fe);let ue=null;if(Q){const Ze=no(q,Q,pe,this.transform,fe);ue=a.K([],this.transform.labelPlaneMatrix,Ze)}this.retainedQueryData[b.bucketInstanceId]=new di(b.bucketInstanceId,M,b.sourceLayerIndex,b.index,p.tileID);const Ie={bucket:b,layout:A,posMatrix:q,textLabelPlaneMatrix:_e,labelToScreenMatrix:ue,scale:F,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:a.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const Ze of b.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Re,symbolInstanceEnd:We}=Ze;o.push({sortKey:be,symbolInstanceStart:Re,symbolInstanceEnd:We,parameters:Ie})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(o,h,p,m,b,M,E,A,F,V,q,Q,pe,fe,_e,ue){const Ie=a.ap[o.textAnchor],Ze=[o.textOffset0,o.textOffset1],be=Vn(Ie,p,m,Ze,b),Re=this.collisionIndex.placeCollisionBox(mr(h,be.x,be.y,M,E,this.transform.angle),q,A,F,V.predicate,ue);if((!_e||this.collisionIndex.placeCollisionBox(mr(_e,be.x,be.y,M,E,this.transform.angle),q,A,F,V.predicate,ue).box.length!==0)&&Re.box.length>0){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(We=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),Q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Q.crossTileID]={textOffset:Ze,width:p,height:m,anchor:Ie,textBoxScale:b,prevAnchor:We},this.markUsedJustification(pe,Ie,Q,fe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,fe,Q),this.placedOrientations[Q.crossTileID]=fe),{shift:be,placedGlyphBoxes:Re}}}placeLayerBucketPart(o,h,p){const{bucket:m,layout:b,posMatrix:M,textLabelPlaneMatrix:E,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:V,collisionBoxArray:q,partiallyEvaluatedTextSize:Q,collisionGroup:pe}=o.parameters,fe=b.get("text-optional"),_e=b.get("icon-optional"),ue=a.aq(b,"text-overlap","text-allow-overlap"),Ie=ue==="always",Ze=a.aq(b,"icon-overlap","icon-allow-overlap"),be=Ze==="always",Re=b.get("text-rotation-alignment")==="map",We=b.get("text-pitch-alignment")==="map",He=b.get("icon-text-fit")!=="none",Xe=b.get("symbol-z-order")==="viewport-y",ot=Ie&&(be||!m.hasIconData()||_e),it=be&&(Ie||!m.hasTextData()||fe);!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q);const gt=this.retainedQueryData[m.bucketInstanceId].tileID,vt=this.terrain?(xt,ei)=>this.terrain.getElevation(gt,xt,ei):null,ci=(xt,ei)=>{var ui,Ci;if(h[xt.crossTileID])return;if(V)return void(this.placements[xt.crossTileID]=new an(!1,!1,!1));let ri=!1,fi=!1,yi=!0,wn=null,Ui={box:null,offscreen:null},Nr={box:null,offscreen:null},qn=null,dn=null,Zn=null,$r=0,xo=0,Ko=0;ei.textFeatureIndex?$r=ei.textFeatureIndex:xt.useRuntimeCollisionCircles&&($r=xt.featureIndex),ei.verticalTextFeatureIndex&&(xo=ei.verticalTextFeatureIndex);const Pa=ei.textBox;if(Pa){const Fn=On=>{let pn=a.ah.horizontal;if(m.allowVerticalPlacement&&!On&&this.prevPlacement){const Yr=this.prevPlacement.placedOrientations[xt.crossTileID];Yr&&(this.placedOrientations[xt.crossTileID]=Yr,pn=Yr,this.markUsedOrientation(m,pn,xt))}return pn},fn=(On,pn)=>{if(m.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&ei.verticalTextBox){for(const Yr of m.writingModes)if(Yr===a.ah.vertical?(Ui=pn(),Nr=Ui):Ui=On(),Ui&&Ui.box&&Ui.box.length)break}else Ui=On()},cn=xt.textAnchorOffsetStartIndex,Jr=xt.textAnchorOffsetEndIndex;if(Jr===cn){const On=(pn,Yr)=>{const Nn=this.collisionIndex.placeCollisionBox(pn,ue,F,M,pe.predicate,vt);return Nn&&Nn.box&&Nn.box.length&&(this.markUsedOrientation(m,Yr,xt),this.placedOrientations[xt.crossTileID]=Yr),Nn};fn(()=>On(Pa,a.ah.horizontal),()=>{const pn=ei.verticalTextBox;return m.allowVerticalPlacement&&xt.numVerticalGlyphVertices>0&&pn?On(pn,a.ah.vertical):{box:null,offscreen:null}}),Fn(Ui&&Ui.box&&Ui.box.length)}else{let On=a.ap[(Ci=(ui=this.prevPlacement)===null||ui===void 0?void 0:ui.variableOffsets[xt.crossTileID])===null||Ci===void 0?void 0:Ci.anchor];const pn=(Nn,Sn,Vc)=>{const Dh=Nn.x2-Nn.x1,ps=Nn.y2-Nn.y1,ms=xt.textBoxScale,Al=He&&Ze==="never"?Sn:null;let Yo={box:[],offscreen:!1},qc=ue==="never"?1:2,Rh="never";On&&qc++;for(let Zc=0;Zc<qc;Zc++){for(let Gc=cn;Gc<Jr;Gc++){const Pl=m.textAnchorOffsets.get(Gc);if(On&&Pl.textAnchor!==On)continue;const Wc=this.attemptAnchorPlacement(Pl,Nn,Dh,ps,ms,Re,We,F,M,pe,Rh,xt,m,Vc,Al,vt);if(Wc&&(Yo=Wc.placedGlyphBoxes,Yo&&Yo.box&&Yo.box.length))return ri=!0,wn=Wc.shift,Yo}On?On=null:Rh=ue}return Yo};fn(()=>pn(Pa,ei.iconBox,a.ah.horizontal),()=>{const Nn=ei.verticalTextBox;return m.allowVerticalPlacement&&!(Ui&&Ui.box&&Ui.box.length)&&xt.numVerticalGlyphVertices>0&&Nn?pn(Nn,ei.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Ui&&(ri=Ui.box,yi=Ui.offscreen);const Yr=Fn(Ui&&Ui.box);if(!ri&&this.prevPlacement){const Nn=this.prevPlacement.variableOffsets[xt.crossTileID];Nn&&(this.variableOffsets[xt.crossTileID]=Nn,this.markUsedJustification(m,Nn.anchor,xt,Yr))}}}if(qn=Ui,ri=qn&&qn.box&&qn.box.length>0,yi=qn&&qn.offscreen,xt.useRuntimeCollisionCircles){const Fn=m.text.placedSymbolArray.get(xt.centerJustifiedTextSymbolIndex),fn=a.ai(m.textSizeData,Q,Fn),cn=b.get("text-padding");dn=this.collisionIndex.placeCollisionCircles(ue,Fn,m.lineVertexArray,m.glyphOffsetArray,fn,M,E,A,p,We,pe.predicate,xt.collisionCircleDiameter,cn,vt),dn.circles.length&&dn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),ri=Ie||dn.circles.length>0&&!dn.collisionDetected,yi=yi&&dn.offscreen}if(ei.iconFeatureIndex&&(Ko=ei.iconFeatureIndex),ei.iconBox){const Fn=fn=>{const cn=He&&wn?mr(fn,wn.x,wn.y,Re,We,this.transform.angle):fn;return this.collisionIndex.placeCollisionBox(cn,Ze,F,M,pe.predicate,vt)};Nr&&Nr.box&&Nr.box.length&&ei.verticalIconBox?(Zn=Fn(ei.verticalIconBox),fi=Zn.box.length>0):(Zn=Fn(ei.iconBox),fi=Zn.box.length>0),yi=yi&&Zn.offscreen}const Jo=fe||xt.numHorizontalGlyphVertices===0&&xt.numVerticalGlyphVertices===0,ko=_e||xt.numIconVertices===0;if(Jo||ko?ko?Jo||(fi=fi&&ri):ri=fi&&ri:fi=ri=fi&&ri,ri&&qn&&qn.box&&this.collisionIndex.insertCollisionBox(qn.box,ue,b.get("text-ignore-placement"),m.bucketInstanceId,Nr&&Nr.box&&xo?xo:$r,pe.ID),fi&&Zn&&this.collisionIndex.insertCollisionBox(Zn.box,Ze,b.get("icon-ignore-placement"),m.bucketInstanceId,Ko,pe.ID),dn&&(ri&&this.collisionIndex.insertCollisionCircles(dn.circles,ue,b.get("text-ignore-placement"),m.bucketInstanceId,$r,pe.ID),p)){const Fn=m.bucketInstanceId;let fn=this.collisionCircleArrays[Fn];fn===void 0&&(fn=this.collisionCircleArrays[Fn]=new Rn);for(let cn=0;cn<dn.circles.length;cn+=4)fn.circles.push(dn.circles[cn+0]),fn.circles.push(dn.circles[cn+1]),fn.circles.push(dn.circles[cn+2]),fn.circles.push(dn.collisionDetected?1:0)}if(xt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xt.crossTileID]=new an(ri||ot,fi||it,yi||m.justReloaded),h[xt.crossTileID]=!0};if(Xe){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xt=m.getSortedSymbolIndexes(this.transform.angle);for(let ei=xt.length-1;ei>=0;--ei){const ui=xt[ei];ci(m.symbolInstances.get(ui),m.collisionArrays[ui])}}else for(let xt=o.symbolInstanceStart;xt<o.symbolInstanceEnd;xt++)ci(m.symbolInstances.get(xt),m.collisionArrays[xt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const xt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(xt.invProjMatrix,M),xt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,h,p,m){let b;b=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const M=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const E of M)E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=b>=0&&E!==b?0:p.crossTileID)}markUsedOrientation(o,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,b=h===a.ah.vertical?h:0,M=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const E of M)o.text.placedSymbolArray.get(E).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(o):1,b=h?h.opacities:{},M=h?h.variableOffsets:{},E=h?h.placedOrientations:{};for(const A in this.placements){const F=this.placements[A],V=b[A];V?(this.opacities[A]=new xi(V,m,F.text,F.icon),p=p||F.text!==V.text.placed||F.icon!==V.icon.placed):(this.opacities[A]=new xi(null,m,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const A in b){const F=b[A];if(!this.opacities[A]){const V=new xi(F,m,!1,!1);V.isHidden()||(this.opacities[A]=V,p=p||F.text.placed||F.icon.placed)}}for(const A in M)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=M[A]);for(const A in E)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=E[A]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const m of h){const b=m.getBucket(o);b&&m.latestFeatureIndex&&o.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,m.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],b=m.layout,M=new xi(null,0,!1,!1,!0),E=b.get("text-allow-overlap"),A=b.get("icon-allow-overlap"),F=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=b.get("text-rotation-alignment")==="map",q=b.get("text-pitch-alignment")==="map",Q=b.get("icon-text-fit")!=="none",pe=new xi(null,0,E&&(A||!o.hasIconData()||b.get("icon-optional")),A&&(E||!o.hasTextData()||b.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const fe=(_e,ue,Ie)=>{for(let Ze=0;Ze<ue/4;Ze++)_e.opacityVertexArray.emplaceBack(Ie);_e.hasVisibleVertices=_e.hasVisibleVertices||Ie!==ua};for(let _e=0;_e<o.symbolInstances.length;_e++){const ue=o.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:Ze,crossTileID:be}=ue;let Re=this.opacities[be];h[be]?Re=M:Re||(Re=pe,this.opacities[be]=Re),h[be]=!0;const We=ue.numIconVertices>0,He=this.placedOrientations[ue.crossTileID],Xe=He===a.ah.vertical,ot=He===a.ah.horizontal||He===a.ah.horizontalOnly;if(Ie>0||Ze>0){const it=Sr(Re.text);fe(o.text,Ie,Xe?ua:it),fe(o.text,Ze,ot?ua:it);const gt=Re.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(xt=>{xt>=0&&(o.text.placedSymbolArray.get(xt).hidden=gt||Xe?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=gt||ot?1:0);const vt=this.variableOffsets[ue.crossTileID];vt&&this.markUsedJustification(o,vt.anchor,ue,He);const ci=this.placedOrientations[ue.crossTileID];ci&&(this.markUsedJustification(o,"left",ue,ci),this.markUsedOrientation(o,ci,ue))}if(We){const it=Sr(Re.icon),gt=!(Q&&ue.verticalPlacedIconSymbolIndex&&Xe);ue.placedIconSymbolIndex>=0&&(fe(o.icon,ue.numIconVertices,gt?it:ua),o.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Re.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(fe(o.icon,ue.numVerticalIconVertices,gt?ua:it),o.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Re.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const it=o.collisionArrays[_e];if(it){let gt=new a.P(0,0);if(it.textBox||it.verticalTextBox){let ci=!0;if(F){const xt=this.variableOffsets[be];xt?(gt=Vn(xt.anchor,xt.width,xt.height,xt.textOffset,xt.textBoxScale),V&&gt._rotate(q?this.transform.angle:-this.transform.angle)):ci=!1}it.textBox&&er(o.textCollisionBox.collisionVertexArray,Re.text.placed,!ci||Xe,gt.x,gt.y),it.verticalTextBox&&er(o.textCollisionBox.collisionVertexArray,Re.text.placed,!ci||ot,gt.x,gt.y)}const vt=!!(!ot&&it.verticalIconBox);it.iconBox&&er(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,vt,Q?gt.x:0,Q?gt.y:0),it.verticalIconBox&&er(o.iconCollisionBox.collisionVertexArray,Re.icon.placed,!vt,Q?gt.x:0,Q?gt.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=_e.invProjMatrix,o.placementViewportMatrix=_e.viewportMatrix,o.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function er(v,o,h,p,m){v.emplaceBack(o?1:0,h?1:0,p||0,m||0),v.emplaceBack(o?1:0,h?1:0,p||0,m||0),v.emplaceBack(o?1:0,h?1:0,p||0,m||0),v.emplaceBack(o?1:0,h?1:0,p||0,m||0)}const _o=Math.pow(2,25),Ju=Math.pow(2,24),Nd=Math.pow(2,17),$i=Math.pow(2,16),hc=Math.pow(2,9),dc=Math.pow(2,8),Br=Math.pow(2,1);function Sr(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const o=v.placed?1:0,h=Math.floor(127*v.opacity);return h*_o+o*Ju+h*Nd+o*$i+h*hc+o*dc+h*Br+o}const ua=0;class Xr{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,m,b){const M=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(M,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((E,A)=>E.sortKey-A.sortKey));this._currentPartIndex<M.length;)if(h.placeLayerBucketPart(M[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Kr{constructor(o,h,p,m,b,M,E,A){this.placement=new kr(o,h,M,E,A),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const m=S.now(),b=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const M=h[o[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=E)&&(!M.maxzoom||M.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new Xr(M)),this._inProgressLayer.continuePlacement(p[M.source],this.placement,this._showCollisionBoxes,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const As=512/a.W/2;class Ga{constructor(o,h,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<h.length;b++){const M=h.get(b),E=M.key,A=m.get(E);A?A.push(M):m.set(E,[M])}for(const[b,M]of m){const E={positions:M.map(A=>({x:Math.floor(A.anchorX*As),y:Math.floor(A.anchorY*As)})),crossTileIDs:M.map(A=>A.crossTileID)};if(E.positions.length>128){const A=new a.au(E.positions.length,16,Uint16Array);for(const{x:F,y:V}of E.positions)A.add(F,V);A.finish(),delete E.positions,E.index=A}this._symbolsByKey[b]=E}}getScaledCoordinates(o,h){const{x:p,y:m,z:b}=this.tileID.canonical,{x:M,y:E,z:A}=h.canonical,F=As/Math.pow(2,A-b),V=(E*a.W+o.anchorY)*F,q=m*a.W*As;return{x:Math.floor((M*a.W+o.anchorX)*F-p*a.W*As),y:Math.floor(V-q)}}findMatches(o,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<o.length;b++){const M=o.get(b);if(M.crossTileID)continue;const E=this._symbolsByKey[M.key];if(!E)continue;const A=this.getScaledCoordinates(M,h);if(E.index){const F=E.index.range(A.x-m,A.y-m,A.x+m,A.y+m).sort();for(const V of F){const q=E.crossTileIDs[V];if(!p[q]){p[q]=!0,M.crossTileID=q;break}}}else if(E.positions)for(let F=0;F<E.positions.length;F++){const V=E.positions[F],q=E.crossTileIDs[F];if(Math.abs(V.x-A.x)<=m&&Math.abs(V.y-A.y)<=m&&!p[q]){p[q]=!0,M.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Bn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ha{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const M in m){const E=m[M];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),b[E.tileID.key]=E}this.indexes[p]=b}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const b in this.indexes){const M=this.indexes[b];if(Number(b)>o.overscaledZ)for(const E in M){const A=M[E];A.tileID.isChildOf(o)&&A.findMatches(h.symbolInstances,o,m)}else{const E=M[o.scaledTo(Number(b)).key];E&&E.findMatches(h.symbolInstances,o,m)}}for(let b=0;b<h.symbolInstances.length;b++){const M=h.symbolInstances.get(b);M.crossTileID||(M.crossTileID=p.generate(),m[M.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Ga(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)o[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],h=!0)}return h}}class qo{constructor(){this.layerIndexes={},this.crossTileIDs=new Bn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new ha);let b=!1;const M={};m.handleWrapJump(p);for(const E of h){const A=E.getBucket(o);A&&o.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(E.tileID,A,this.crossTileIDs)&&(b=!0),M[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(M)&&(b=!0),b}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const hn=(v,o)=>a.t(v,o&&o.filter(h=>h.identifier!=="source.canvas")),Wa=a.av();class Fr extends a.E{constructor(o,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=o,this.dispatcher=new Yt(Jt(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new st,this.imageManager.setEventedParent(this),this.glyphManager=new pt(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Dt(256,512),this.crossTileSymbolIndex=new qo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),rt().on(tn,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const M in this._layers){const E=this._layers[M];E.source===b.id&&this._validateLayer(E)}})}loadURL(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,h,p)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new a.j(b))})}loadJSON(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Wa,{validate:!1})}_load(o,h,p){var m;const b=h.transformStyle?h.transformStyle(p,o):o;if(!h.validate||!hn(this,a.x(b))){this._loaded=!0,this.stylesheet=b;for(const M in b.sources)this.addSource(M,b.sources[M],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new oi(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(o,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,M,E,A){return a._(this,void 0,void 0,function*(){const F=Ue(b),V=E>1?"@2x":"",q={},Q={};for(const{id:pe,url:fe}of F){const _e=M.transformRequest(M.normalizeSpriteURL(fe,V,".json"),"SpriteJSON");q[pe]=a.h(_e,A);const ue=M.transformRequest(M.normalizeSpriteURL(fe,V,".png"),"SpriteImage");Q[pe]=$.getImage(ue,A)}return yield Promise.all([...Object.values(q),...Object.values(Q)]),function(pe,fe){return a._(this,void 0,void 0,function*(){const _e={};for(const ue in pe){_e[ue]={};const Ie=S.getImageCanvasContext((yield fe[ue]).data),Ze=(yield pe[ue]).data;for(const be in Ze){const{width:Re,height:We,x:He,y:Xe,sdf:ot,pixelRatio:it,stretchX:gt,stretchY:vt,content:ci}=Ze[be];_e[ue][be]={data:null,pixelRatio:it,sdf:ot,stretchX:gt,stretchY:vt,content:ci,spriteData:{width:Re,height:We,x:He,y:Xe,context:Ie}}}}return _e})}(q,Q)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const M in b){this._spritesImagesIds[M]=[];const E=this._spritesImagesIds[M]?this._spritesImagesIds[M].filter(A=>!(A in b)):[];for(const A of E)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in b[M]){const F=M==="default"?A:`${M}:${A}`;this._spritesImagesIds[M].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,b[M][A],!1):this.imageManager.addImage(F,b[M][A]),h&&(this._changedImages[F]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const h=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h);const p=[];for(const m of o)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(o[p]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const M in this._updatedSources){const E=this._updatedSources[M];if(E==="reload")this._reloadSource(M);else{if(E!=="clear")throw new Error(`Invalid action ${E}`);this._clearSource(M)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(o,this._availableImages),!b.isHidden(o.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,h={}){var p;this._checkLoaded();const m=this.serialize();if(o=h.transformStyle?h.transformStyle(m,o):o,((p=h.validate)===null||p===void 0||p)&&hn(this,a.x(o)))return!1;(o=a.aA(o)).layers=a.ay(o.layers);const b=a.aB(m,o),M=this._getOperationsToPerform(b);if(M.unimplemented.length>0)throw new Error(`Unimplemented: ${M.unimplemented.join(", ")}.`);if(M.operations.length===0)return!1;for(const E of M.operations)E();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],p=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(o,h){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[o]=new Ki(o,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(o.type==="custom"){if(hn(this,a.aC(o)))return;b=a.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=a.aA(o),o=a.e(o,{source:m})),this._validate(a.x.layer,`layers.${m}`,o,{arrayIndex:-1},p))return;b=a.az(o),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const M=h?this._order.indexOf(h):this._order.length;if(h&&M===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(M,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const E=this._removedLayers[m];delete this._removedLayers[m],E.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aA(this.getLayer(o).filter)}setLayoutProperty(o,h,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?a.aD(b.getLayoutProperty(h),p)||(b.setLayoutProperty(h,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,m={}){this._checkLoaded();const b=this.getLayer(o);b?a.aD(b.getPaintProperty(h),p)||(b.setPaintProperty(h,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,m=o.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const M=b.getSource().type;M==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):M!=="vector"||m?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,o.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,M=b==="vector"?o.sourceLayer:void 0;b!=="vector"||M?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(M,o.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aE(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:h,terrain:p},b=>b!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=M=>this._layers[M].type==="fill-extrusion",p={},m=[];for(let M=this._order.length-1;M>=0;M--){const E=this._order[M];if(h(E)){p[E]=M;for(const A of o){const F=A[E];if(F)for(const V of F)m.push(V)}}}m.sort((M,E)=>E.intersectionZ-M.intersectionZ);const b=[];for(let M=this._order.length-1;M>=0;M--){const E=this._order[M];if(h(E))for(let A=m.length-1;A>=0;A--){const F=m[A].feature;if(p[F.layer.id]<M)break;b.push(F),m.pop()}else for(const A of o){const F=A[E];if(F)for(const V of F)b.push(V.feature)}}return b}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const E of h.layers){const A=this._layers[E];if(!A)return this.fire(new a.j(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];m[A.source]=!0}}const b=[];h.availableImages=this._availableImages;const M=this._serializedAllLayers();for(const E in this.sourceCaches)h.layers&&!m[E]||b.push(ht(this.sourceCaches[E],this._layers,M,o,h,p));return this.placement&&b.push(function(E,A,F,V,q,Q,pe){const fe={},_e=Q.queryRenderedSymbols(V),ue=[];for(const Ie of Object.keys(_e).map(Number))ue.push(pe[Ie]);ue.sort(Ot);for(const Ie of ue){const Ze=Ie.featureIndex.lookupSymbolFeatures(_e[Ie.bucketInstanceId],A,Ie.bucketIndex,Ie.sourceLayerIndex,q.filter,q.layers,q.availableImages,E);for(const be in Ze){const Re=fe[be]=fe[be]||[],We=Ze[be];We.sort((He,Xe)=>{const ot=Ie.featureSortOrder;if(ot){const it=ot.indexOf(He.featureIndex);return ot.indexOf(Xe.featureIndex)-it}return Xe.featureIndex-He.featureIndex});for(const He of We)Re.push(He)}}for(const Ie in fe)fe[Ie].forEach(Ze=>{const be=Ze.feature,Re=F[E[Ie].source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Re});return fe}(this._layers,M,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(m,b){const M=m.getRenderableIds().map(F=>m.getTileByID(F)),E=[],A={};for(let F=0;F<M.length;F++){const V=M[F],q=V.tileID.canonical.key;A[q]||(A[q]=!0,V.querySourceFeatures(E,b))}return E}(p,h):[]}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const M in o)if(!a.aD(o[M],p[M])){m=!0;break}if(!m)return;const b={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(b)}_validate(o,h,p,m,b={}){return(!b||b.validate!==!1)&&hn(this,o.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),rt().off(tn,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,m,b=!1){let M=!1,E=!1;const A={};for(const F of this._order){const V=this._layers[F];if(V.type!=="symbol")continue;if(!A[V.source]){const Q=this.sourceCaches[V.source];A[V.source]=Q.getRenderableIds(!0).map(pe=>Q.getTileByID(pe)).sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,A[V.source],o.center.lng);M=M||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),o.zoom))&&(this.pauseablePlacement=new Kr(o,this.map.terrain,this._order,b,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),E=!0),M&&this.pauseablePlacement.placement.setStale()),E||M)for(const F of this._order){const V=this._layers[F];V.type==="symbol"&&this.placement.updateLayerOpacities(V,A[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,h={}){this._checkLoaded(),o&&this._validate(a.x.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h,p={},m){this._checkLoaded();const b=[{id:o,url:h}],M=[...Ue(this.stylesheet.sprite),...b];this._validate(a.x.sprite,"sprite",M,null,p)||(this.stylesheet.sprite=M,this._loadSprite(b,!0,m))}removeSprite(o){this._checkLoaded();const h=Ue(this.stylesheet.sprite);if(h.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Ue(this.stylesheet.sprite)}setSprite(o,h={},p){this._checkLoaded(),o&&this._validate(a.x.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}var Ha=a.X([{name:"a_pos",type:"Int16",components:2}]),yo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const da={prelude:ji(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ji(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ji(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ji(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ji("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ji(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ji(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ji("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ji("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ji("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ji(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ji(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ji(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ji(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ji(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ji(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ji(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ji(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ji(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ji(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ji(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ji(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ji(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ji(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ji(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ji("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",yo),terrainDepth:ji("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",yo),terrainCoords:ji("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",yo)};function ji(v,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),m=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=b?b.concat(m):m,E={};return{fragmentSource:v=v.replace(h,(A,F,V,q,Q)=>(E[Q]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
varying ${V} ${q} ${Q};
#else
uniform ${V} ${q} u_${Q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Q}
    ${V} ${q} ${Q} = u_${Q};
#endif
`)),vertexSource:o=o.replace(h,(A,F,V,q,Q)=>{const pe=q==="float"?"vec2":"vec4",fe=Q.match(/color/)?"color":pe;return E[Q]?F==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${V} ${pe} a_${Q};
varying ${V} ${q} ${Q};
#else
uniform ${V} ${q} u_${Q};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${V} ${q} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${fe}(a_${Q}, u_${Q}_t);
#else
    ${V} ${q} ${Q} = u_${Q};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
attribute ${V} ${pe} a_${Q};
#else
uniform ${V} ${q} u_${Q};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${V} ${q} ${Q} = a_${Q};
#else
    ${V} ${q} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${V} ${q} ${Q} = unpack_mix_${fe}(a_${Q}, u_${Q}_t);
#else
    ${V} ${q} ${Q} = u_${Q};
#endif
`}),staticAttributes:p,staticUniforms:M}}class Xa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,m,b,M,E,A,F){this.context=o;let V=this.boundPaintVertexBuffers.length!==m.length;for(let q=0;!V&&q<m.length;q++)this.boundPaintVertexBuffers[q]!==m[q]&&(V=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||V||this.boundIndexBuffer!==b||this.boundVertexOffset!==M||this.boundDynamicVertexBuffer!==E||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==F?this.freshBind(h,p,m,b,M,E,A,F):(o.bindVertexArray.set(this.vao),E&&E.bind(),b&&b.dynamicDraw&&b.bind(),A&&A.bind(),F&&F.bind())}freshBind(o,h,p,m,b,M,E,A){const F=o.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=E,this.boundDynamicVertexBuffer3=A,h.enableAttributes(q,o);for(const Q of p)Q.enableAttributes(q,o);M&&M.enableAttributes(q,o),E&&E.enableAttributes(q,o),A&&A.enableAttributes(q,o),h.bind(),h.setVertexAttribPointers(q,o,b);for(const Q of p)Q.bind(),Q.setVertexAttribPointers(q,o,b);M&&(M.bind(),M.setVertexAttribPointers(q,o,b)),m&&m.bind(),E&&(E.bind(),E.setVertexAttribPointers(q,o,b)),A&&(A.bind(),A.setVertexAttribPointers(q,o,b)),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(v){const o=[];for(let h=0;h<v.length;h++){if(v[h]===null)continue;const p=v[h].split(" ");o.push(p.pop())}return o}class Zo{constructor(o,h,p,m,b,M){const E=o.gl;this.program=E.createProgram();const A=Ps(h.staticAttributes),F=p?p.getBinderAttributes():[],V=A.concat(F),q=da.prelude.staticUniforms?Ps(da.prelude.staticUniforms):[],Q=h.staticUniforms?Ps(h.staticUniforms):[],pe=p?p.getBinderUniforms():[],fe=q.concat(Q).concat(pe),_e=[];for(const He of fe)_e.indexOf(He)<0&&_e.push(He);const ue=p?p.defines():[];b&&ue.push("#define OVERDRAW_INSPECTOR;"),M&&ue.push("#define TERRAIN3D;");const Ie=ue.concat(da.prelude.fragmentSource,h.fragmentSource).join(`
`),Ze=ue.concat(da.prelude.vertexSource,h.vertexSource).join(`
`),be=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(be,Ie),E.compileShader(be),!E.getShaderParameter(be,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(be)}`);E.attachShader(this.program,be);const Re=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(Re,Ze),E.compileShader(Re),!E.getShaderParameter(Re,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(Re)}`);E.attachShader(this.program,Re),this.attributes={};const We={};this.numAttributes=V.length;for(let He=0;He<this.numAttributes;He++)V[He]&&(E.bindAttribLocation(this.program,He,V[He]),this.attributes[V[He]]=He);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(Re),E.deleteShader(be);for(let He=0;He<_e.length;He++){const Xe=_e[He];if(Xe&&!We[Xe]){const ot=E.getUniformLocation(this.program,Xe);ot&&(We[Xe]=ot)}}this.fixedUniforms=m(o,We),this.terrainUniforms=((He,Xe)=>({u_depth:new a.aG(He,Xe.u_depth),u_terrain:new a.aG(He,Xe.u_terrain),u_terrain_dim:new a.aH(He,Xe.u_terrain_dim),u_terrain_matrix:new a.aI(He,Xe.u_terrain_matrix),u_terrain_unpack:new a.aJ(He,Xe.u_terrain_unpack),u_terrain_exaggeration:new a.aH(He,Xe.u_terrain_exaggeration)}))(o,We),this.binderUniforms=p?p.getUniforms(o,We):[]}draw(o,h,p,m,b,M,E,A,F,V,q,Q,pe,fe,_e,ue,Ie,Ze){const be=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(m),o.setColorMode(b),o.setCullFace(M),A){o.activeTexture.set(be.TEXTURE2),be.bindTexture(be.TEXTURE_2D,A.depthTexture),o.activeTexture.set(be.TEXTURE3),be.bindTexture(be.TEXTURE_2D,A.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(A[We])}for(const We in this.fixedUniforms)this.fixedUniforms[We].set(E[We]);_e&&_e.setUniforms(o,this.binderUniforms,pe,{zoom:fe});let Re=0;switch(h){case be.LINES:Re=2;break;case be.TRIANGLES:Re=3;break;case be.LINE_STRIP:Re=1}for(const We of Q.get()){const He=We.vaos||(We.vaos={});(He[F]||(He[F]=new Xa)).bind(o,this,V,_e?_e.getPaintVertexBuffers():[],q,We.vertexOffset,ue,Ie,Ze),be.drawElements(h,We.primitiveLength*Re,be.UNSIGNED_SHORT,We.primitiveOffset*Re*2)}}}function Ka(v,o,h){const p=1/Qt(h,1,o.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,o.transform.tileZoom)/m,M=b*(h.tileID.canonical.x+h.tileID.wrap*m),E=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[M>>16,E>>16],u_pixel_coord_lower:[65535&M,65535&E]}}const fa=(v,o,h,p)=>{const m=o.style.light,b=m.properties.get("position"),M=[b.x,b.y,b.z],E=function(){var F=new a.A(9);return a.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();m.properties.get("anchor")==="viewport"&&function(F,V){var q=Math.sin(V),Q=Math.cos(V);F[0]=Q,F[1]=q,F[2]=0,F[3]=-q,F[4]=Q,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(E,-o.transform.angle),function(F,V,q){var Q=V[0],pe=V[1],fe=V[2];F[0]=Q*q[0]+pe*q[3]+fe*q[6],F[1]=Q*q[1]+pe*q[4]+fe*q[7],F[2]=Q*q[2]+pe*q[5]+fe*q[8]}(M,M,E);const A=m.properties.get("color");return{u_matrix:v,u_lightpos:M,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+h,u_opacity:p}},$d=(v,o,h,p,m,b,M)=>a.e(fa(v,o,h,p),Ka(b,o,M),{u_height_factor:-Math.pow(2,m.overscaledZ)/M.tileSize/8}),Yu=v=>({u_matrix:v}),Ja=(v,o,h,p)=>a.e(Yu(v),Ka(h,o,p)),jd=(v,o)=>({u_matrix:v,u_world:o}),Qu=(v,o,h,p,m)=>a.e(Ja(v,o,h,p),{u_world:m}),Ud=(v,o,h,p)=>{const m=v.transform;let b,M;if(p.paint.get("circle-pitch-alignment")==="map"){const E=Qt(h,1,m.zoom);b=!0,M=[E,E]}else b=!1,M=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:v.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:M}},eh=(v,o,h)=>{const p=Qt(h,1,o.zoom),m=Math.pow(2,o.zoom-h.tileID.overscaledZ),b=h.tileID.overscaleFactor();return{u_matrix:v,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*m),o.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:b}},th=(v,o,h=1)=>({u_matrix:v,u_color:o,u_overlay:0,u_overlay_scale:h}),Ya=v=>({u_matrix:v}),ih=(v,o,h,p)=>({u_matrix:v,u_extrude_scale:Qt(o,1,h),u_intensity:p});function nh(v,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const Qa=(v,o,h,p)=>{const m=v.transform;return{u_matrix:pa(v,o,h,p),u_ratio:1/Qt(o,1,m.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},rh=(v,o,h,p,m)=>a.e(Qa(v,o,h,m),{u_image:0,u_image_height:p}),ss=(v,o,h,p,m)=>{const b=v.transform,M=Or(o,b);return{u_matrix:pa(v,o,h,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Qt(o,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[M,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},el=(v,o,h,p,m,b)=>{const M=v.lineAtlas,E=Or(o,v.transform),A=h.layout.get("line-cap")==="round",F=M.getDash(p.from,A),V=M.getDash(p.to,A),q=F.width*m.fromScale,Q=V.width*m.toScale;return a.e(Qa(v,o,h,b),{u_patternscale_a:[E/q,-F.height/2],u_patternscale_b:[E/Q,-V.height/2],u_sdfgamma:M.width/(256*Math.min(q,Q)*v.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:V.y,u_mix:m.t})};function Or(v,o){return 1/Qt(v,1,o.tileZoom)}function pa(v,o,h,p){return v.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const tl=(v,o,h,p,m)=>{return{u_matrix:v,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(M=m.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:ma(m.paint.get("raster-hue-rotate"))};var b,M};function ma(v){v*=Math.PI/180;const o=Math.sin(v),h=Math.cos(v);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const ga=(v,o,h,p,m,b,M,E,A,F)=>{const V=m.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:V.width/V.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:M,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},_a=(v,o,h,p,m,b,M,E,A,F,V)=>{const q=m.transform;return a.e(ga(v,o,h,p,m,b,M,E,A,F),{u_gamma_scale:p?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+V})},ya=(v,o,h,p,m,b,M,E,A,F)=>a.e(_a(v,o,h,p,m,b,M,E,!0,A,!0),{u_texsize_icon:F,u_texture_icon:1}),Vd=(v,o,h)=>({u_matrix:v,u_opacity:o,u_color:h}),qd=(v,o,h,p,m,b)=>a.e(function(M,E,A,F){const V=A.imageManager.getPattern(M.from.toString()),q=A.imageManager.getPattern(M.to.toString()),{width:Q,height:pe}=A.imageManager.getPixelSize(),fe=Math.pow(2,F.tileID.overscaledZ),_e=F.tileSize*Math.pow(2,A.transform.tileZoom)/fe,ue=_e*(F.tileID.canonical.x+F.tileID.wrap*fe),Ie=_e*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[Q,pe],u_mix:E.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/Qt(F,1,A.transform.tileZoom),u_pixel_coord_upper:[ue>>16,Ie>>16],u_pixel_coord_lower:[65535&ue,65535&Ie]}}(p,b,h,m),{u_matrix:v,u_opacity:o}),oh={fillExtrusion:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_lightpos:new a.aK(v,o.u_lightpos),u_lightintensity:new a.aH(v,o.u_lightintensity),u_lightcolor:new a.aK(v,o.u_lightcolor),u_vertical_gradient:new a.aH(v,o.u_vertical_gradient),u_opacity:new a.aH(v,o.u_opacity)}),fillExtrusionPattern:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_lightpos:new a.aK(v,o.u_lightpos),u_lightintensity:new a.aH(v,o.u_lightintensity),u_lightcolor:new a.aK(v,o.u_lightcolor),u_vertical_gradient:new a.aH(v,o.u_vertical_gradient),u_height_factor:new a.aH(v,o.u_height_factor),u_image:new a.aG(v,o.u_image),u_texsize:new a.aL(v,o.u_texsize),u_pixel_coord_upper:new a.aL(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(v,o.u_pixel_coord_lower),u_scale:new a.aK(v,o.u_scale),u_fade:new a.aH(v,o.u_fade),u_opacity:new a.aH(v,o.u_opacity)}),fill:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix)}),fillPattern:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_image:new a.aG(v,o.u_image),u_texsize:new a.aL(v,o.u_texsize),u_pixel_coord_upper:new a.aL(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(v,o.u_pixel_coord_lower),u_scale:new a.aK(v,o.u_scale),u_fade:new a.aH(v,o.u_fade)}),fillOutline:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_world:new a.aL(v,o.u_world)}),fillOutlinePattern:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_world:new a.aL(v,o.u_world),u_image:new a.aG(v,o.u_image),u_texsize:new a.aL(v,o.u_texsize),u_pixel_coord_upper:new a.aL(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(v,o.u_pixel_coord_lower),u_scale:new a.aK(v,o.u_scale),u_fade:new a.aH(v,o.u_fade)}),circle:(v,o)=>({u_camera_to_center_distance:new a.aH(v,o.u_camera_to_center_distance),u_scale_with_map:new a.aG(v,o.u_scale_with_map),u_pitch_with_map:new a.aG(v,o.u_pitch_with_map),u_extrude_scale:new a.aL(v,o.u_extrude_scale),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_matrix:new a.aI(v,o.u_matrix)}),collisionBox:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_camera_to_center_distance:new a.aH(v,o.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(v,o.u_pixels_to_tile_units),u_extrude_scale:new a.aL(v,o.u_extrude_scale),u_overscale_factor:new a.aH(v,o.u_overscale_factor)}),collisionCircle:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_inv_matrix:new a.aI(v,o.u_inv_matrix),u_camera_to_center_distance:new a.aH(v,o.u_camera_to_center_distance),u_viewport_size:new a.aL(v,o.u_viewport_size)}),debug:(v,o)=>({u_color:new a.aM(v,o.u_color),u_matrix:new a.aI(v,o.u_matrix),u_overlay:new a.aG(v,o.u_overlay),u_overlay_scale:new a.aH(v,o.u_overlay_scale)}),clippingMask:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix)}),heatmap:(v,o)=>({u_extrude_scale:new a.aH(v,o.u_extrude_scale),u_intensity:new a.aH(v,o.u_intensity),u_matrix:new a.aI(v,o.u_matrix)}),heatmapTexture:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_world:new a.aL(v,o.u_world),u_image:new a.aG(v,o.u_image),u_color_ramp:new a.aG(v,o.u_color_ramp),u_opacity:new a.aH(v,o.u_opacity)}),hillshade:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_image:new a.aG(v,o.u_image),u_latrange:new a.aL(v,o.u_latrange),u_light:new a.aL(v,o.u_light),u_shadow:new a.aM(v,o.u_shadow),u_highlight:new a.aM(v,o.u_highlight),u_accent:new a.aM(v,o.u_accent)}),hillshadePrepare:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_image:new a.aG(v,o.u_image),u_dimension:new a.aL(v,o.u_dimension),u_zoom:new a.aH(v,o.u_zoom),u_unpack:new a.aJ(v,o.u_unpack)}),line:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_ratio:new a.aH(v,o.u_ratio),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(v,o.u_units_to_pixels)}),lineGradient:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_ratio:new a.aH(v,o.u_ratio),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(v,o.u_units_to_pixels),u_image:new a.aG(v,o.u_image),u_image_height:new a.aH(v,o.u_image_height)}),linePattern:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_texsize:new a.aL(v,o.u_texsize),u_ratio:new a.aH(v,o.u_ratio),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_image:new a.aG(v,o.u_image),u_units_to_pixels:new a.aL(v,o.u_units_to_pixels),u_scale:new a.aK(v,o.u_scale),u_fade:new a.aH(v,o.u_fade)}),lineSDF:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_ratio:new a.aH(v,o.u_ratio),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(v,o.u_units_to_pixels),u_patternscale_a:new a.aL(v,o.u_patternscale_a),u_patternscale_b:new a.aL(v,o.u_patternscale_b),u_sdfgamma:new a.aH(v,o.u_sdfgamma),u_image:new a.aG(v,o.u_image),u_tex_y_a:new a.aH(v,o.u_tex_y_a),u_tex_y_b:new a.aH(v,o.u_tex_y_b),u_mix:new a.aH(v,o.u_mix)}),raster:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_tl_parent:new a.aL(v,o.u_tl_parent),u_scale_parent:new a.aH(v,o.u_scale_parent),u_buffer_scale:new a.aH(v,o.u_buffer_scale),u_fade_t:new a.aH(v,o.u_fade_t),u_opacity:new a.aH(v,o.u_opacity),u_image0:new a.aG(v,o.u_image0),u_image1:new a.aG(v,o.u_image1),u_brightness_low:new a.aH(v,o.u_brightness_low),u_brightness_high:new a.aH(v,o.u_brightness_high),u_saturation_factor:new a.aH(v,o.u_saturation_factor),u_contrast_factor:new a.aH(v,o.u_contrast_factor),u_spin_weights:new a.aK(v,o.u_spin_weights)}),symbolIcon:(v,o)=>({u_is_size_zoom_constant:new a.aG(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(v,o.u_is_size_feature_constant),u_size_t:new a.aH(v,o.u_size_t),u_size:new a.aH(v,o.u_size),u_camera_to_center_distance:new a.aH(v,o.u_camera_to_center_distance),u_pitch:new a.aH(v,o.u_pitch),u_rotate_symbol:new a.aG(v,o.u_rotate_symbol),u_aspect_ratio:new a.aH(v,o.u_aspect_ratio),u_fade_change:new a.aH(v,o.u_fade_change),u_matrix:new a.aI(v,o.u_matrix),u_label_plane_matrix:new a.aI(v,o.u_label_plane_matrix),u_coord_matrix:new a.aI(v,o.u_coord_matrix),u_is_text:new a.aG(v,o.u_is_text),u_pitch_with_map:new a.aG(v,o.u_pitch_with_map),u_texsize:new a.aL(v,o.u_texsize),u_texture:new a.aG(v,o.u_texture)}),symbolSDF:(v,o)=>({u_is_size_zoom_constant:new a.aG(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(v,o.u_is_size_feature_constant),u_size_t:new a.aH(v,o.u_size_t),u_size:new a.aH(v,o.u_size),u_camera_to_center_distance:new a.aH(v,o.u_camera_to_center_distance),u_pitch:new a.aH(v,o.u_pitch),u_rotate_symbol:new a.aG(v,o.u_rotate_symbol),u_aspect_ratio:new a.aH(v,o.u_aspect_ratio),u_fade_change:new a.aH(v,o.u_fade_change),u_matrix:new a.aI(v,o.u_matrix),u_label_plane_matrix:new a.aI(v,o.u_label_plane_matrix),u_coord_matrix:new a.aI(v,o.u_coord_matrix),u_is_text:new a.aG(v,o.u_is_text),u_pitch_with_map:new a.aG(v,o.u_pitch_with_map),u_texsize:new a.aL(v,o.u_texsize),u_texture:new a.aG(v,o.u_texture),u_gamma_scale:new a.aH(v,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_is_halo:new a.aG(v,o.u_is_halo)}),symbolTextAndIcon:(v,o)=>({u_is_size_zoom_constant:new a.aG(v,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(v,o.u_is_size_feature_constant),u_size_t:new a.aH(v,o.u_size_t),u_size:new a.aH(v,o.u_size),u_camera_to_center_distance:new a.aH(v,o.u_camera_to_center_distance),u_pitch:new a.aH(v,o.u_pitch),u_rotate_symbol:new a.aG(v,o.u_rotate_symbol),u_aspect_ratio:new a.aH(v,o.u_aspect_ratio),u_fade_change:new a.aH(v,o.u_fade_change),u_matrix:new a.aI(v,o.u_matrix),u_label_plane_matrix:new a.aI(v,o.u_label_plane_matrix),u_coord_matrix:new a.aI(v,o.u_coord_matrix),u_is_text:new a.aG(v,o.u_is_text),u_pitch_with_map:new a.aG(v,o.u_pitch_with_map),u_texsize:new a.aL(v,o.u_texsize),u_texsize_icon:new a.aL(v,o.u_texsize_icon),u_texture:new a.aG(v,o.u_texture),u_texture_icon:new a.aG(v,o.u_texture_icon),u_gamma_scale:new a.aH(v,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(v,o.u_device_pixel_ratio),u_is_halo:new a.aG(v,o.u_is_halo)}),background:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_opacity:new a.aH(v,o.u_opacity),u_color:new a.aM(v,o.u_color)}),backgroundPattern:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_opacity:new a.aH(v,o.u_opacity),u_image:new a.aG(v,o.u_image),u_pattern_tl_a:new a.aL(v,o.u_pattern_tl_a),u_pattern_br_a:new a.aL(v,o.u_pattern_br_a),u_pattern_tl_b:new a.aL(v,o.u_pattern_tl_b),u_pattern_br_b:new a.aL(v,o.u_pattern_br_b),u_texsize:new a.aL(v,o.u_texsize),u_mix:new a.aH(v,o.u_mix),u_pattern_size_a:new a.aL(v,o.u_pattern_size_a),u_pattern_size_b:new a.aL(v,o.u_pattern_size_b),u_scale_a:new a.aH(v,o.u_scale_a),u_scale_b:new a.aH(v,o.u_scale_b),u_pixel_coord_upper:new a.aL(v,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(v,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(v,o.u_tile_units_to_pixels)}),terrain:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_texture:new a.aG(v,o.u_texture),u_ele_delta:new a.aH(v,o.u_ele_delta)}),terrainDepth:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_ele_delta:new a.aH(v,o.u_ele_delta)}),terrainCoords:(v,o)=>({u_matrix:new a.aI(v,o.u_matrix),u_texture:new a.aG(v,o.u_texture),u_terrain_coords_id:new a.aH(v,o.u_terrain_coords_id),u_ele_delta:new a.aH(v,o.u_ele_delta)})};class Zd{constructor(o,h,p){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const as={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class il{constructor(o,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=o;const b=o.gl;this.buffer=b.createBuffer(),o.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,h,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],M=h.attributes[b.name];M!==void 0&&o.vertexAttribPointer(M,b.components,o[as[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gr=new WeakMap;function ar(v){var o;if(gr.has(v))return gr.get(v);{const h=(o=v.getParameter(v.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return gr.set(v,h),h}}class zi{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class nl extends zi{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class rl extends zi{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class fc extends zi{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class pc extends zi{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ol extends zi{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class mc extends zi{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class gc extends zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class sl extends zi{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class sh extends zi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class ah extends zi{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class zs extends zi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Gd extends zi{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Wd extends zi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Hd extends zi{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Xd extends zi{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Kd extends zi{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Jd extends zi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class _c extends zi{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class al extends zi{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class yc extends zi{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class vc extends zi{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ds extends zi{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class lh extends zi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ch extends zi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class bc extends zi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class ls extends zi{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class uh extends zi{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Rs extends zi{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const p=this.gl;ar(p)?p.bindVertexArray(o):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Bs extends zi{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class hh extends zi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class wc extends zi{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Ai extends zi{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class ll extends Ai{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Yd extends Ai{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class dh extends Ai{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class va{constructor(o,h,p,m,b){this.context=o,this.width=h,this.height=p;const M=o.gl,E=this.framebuffer=M.createFramebuffer();if(this.colorAttachment=new ll(o,E),m)this.depthAttachment=b?new dh(o,E):new Yd(o,E);else if(b)throw new Error("Stencil cannot be set without depth");if(M.checkFramebufferStatus(M.FRAMEBUFFER)!==M.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class Ln{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}Ln.Replace=[1,0],Ln.disabled=new Ln(Ln.Replace,a.aO.transparent,[!1,!1,!1,!1]),Ln.unblended=new Ln(Ln.Replace,a.aO.transparent,[!0,!0,!0,!0]),Ln.alphaBlended=new Ln([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Qd{constructor(o){var h,p;if(this.gl=o,this.clearColor=new nl(this),this.clearDepth=new rl(this),this.clearStencil=new fc(this),this.colorMask=new pc(this),this.depthMask=new ol(this),this.stencilMask=new mc(this),this.stencilFunc=new gc(this),this.stencilOp=new sl(this),this.stencilTest=new sh(this),this.depthRange=new ah(this),this.depthTest=new zs(this),this.depthFunc=new Gd(this),this.blend=new Wd(this),this.blendFunc=new Hd(this),this.blendColor=new Xd(this),this.blendEquation=new Kd(this),this.cullFace=new Jd(this),this.cullFaceSide=new _c(this),this.frontFace=new al(this),this.program=new yc(this),this.activeTexture=new vc(this),this.viewport=new Ds(this),this.bindFramebuffer=new lh(this),this.bindRenderbuffer=new ch(this),this.bindTexture=new bc(this),this.bindVertexBuffer=new ls(this),this.bindElementBuffer=new uh(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Bs(this),this.pixelStoreUnpackPremultiplyAlpha=new hh(this),this.pixelStoreUnpackFlipY=new wc(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),ar(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=o.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Zd(this,o,h)}createVertexBuffer(o,h,p){return new il(this,o,h,p)}createRenderbuffer(o,h,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),b}createFramebuffer(o,h,p,m){return new va(this,o,h,p,m)}clear({color:o,depth:h,stencil:p}){const m=this.gl;let b=0;o&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aD(o.blendFunction,Ln.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return ar(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return ar(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class Ti{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}Ti.ReadOnly=!1,Ti.ReadWrite=!0,Ti.disabled=new Ti(519,Ti.ReadOnly,[0,1]);const xc=7680;class rn{constructor(o,h,p,m,b,M){this.test=o,this.ref=h,this.mask=p,this.fail=m,this.depthFail=b,this.pass=M}}rn.disabled=new rn({func:519,mask:0},0,0,xc,xc,xc);class Yi{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let cs;function cl(v,o,h,p,m,b,M){const E=v.context,A=E.gl,F=v.useProgram("collisionBox"),V=[];let q=0,Q=0;for(let be=0;be<p.length;be++){const Re=p[be],We=o.getTile(Re),He=We.getBucket(h);if(!He)continue;let Xe=Re.posMatrix;m[0]===0&&m[1]===0||(Xe=v.translatePosMatrix(Re.posMatrix,We,m,b));const ot=M?He.textCollisionBox:He.iconCollisionBox,it=He.collisionCircleArray;if(it.length>0){const gt=a.F(),vt=Xe;a.aP(gt,He.placementInvProjMatrix,v.transform.glCoordMatrix),a.aP(gt,gt,He.placementViewportMatrix),V.push({circleArray:it,circleOffset:Q,transform:vt,invTransform:gt,coord:Re}),q+=it.length/4,Q=q}ot&&F.draw(E,A.LINES,Ti.disabled,rn.disabled,v.colorModeForRenderPass(),Yi.disabled,eh(Xe,v.transform,We),v.style.map.terrain&&v.style.map.terrain.getTerrainData(Re),h.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,null,v.transform.zoom,null,null,ot.collisionVertexBuffer)}if(!M||!V.length)return;const pe=v.useProgram("collisionCircle"),fe=new a.aQ;fe.resize(4*q),fe._trim();let _e=0;for(const be of V)for(let Re=0;Re<be.circleArray.length/4;Re++){const We=4*Re,He=be.circleArray[We+0],Xe=be.circleArray[We+1],ot=be.circleArray[We+2],it=be.circleArray[We+3];fe.emplace(_e++,He,Xe,ot,it,0),fe.emplace(_e++,He,Xe,ot,it,1),fe.emplace(_e++,He,Xe,ot,it,2),fe.emplace(_e++,He,Xe,ot,it,3)}(!cs||cs.length<2*q)&&(cs=function(be){const Re=2*be,We=new a.aS;We.resize(Re),We._trim();for(let He=0;He<Re;He++){const Xe=6*He;We.uint16[Xe+0]=4*He+0,We.uint16[Xe+1]=4*He+1,We.uint16[Xe+2]=4*He+2,We.uint16[Xe+3]=4*He+2,We.uint16[Xe+4]=4*He+3,We.uint16[Xe+5]=4*He+0}return We}(q));const ue=E.createIndexBuffer(cs,!0),Ie=E.createVertexBuffer(fe,a.aR.members,!0);for(const be of V){const Re={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(Ze=v.transform).cameraToCenterDistance,u_viewport_size:[Ze.width,Ze.height]};pe.draw(E,A.TRIANGLES,Ti.disabled,rn.disabled,v.colorModeForRenderPass(),Yi.disabled,Re,v.style.map.terrain&&v.style.map.terrain.getTerrainData(be.coord),h.id,Ie,ue,a.$.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,v.transform.zoom,null,null,null)}var Ze;Ie.destroy(),ue.destroy()}Yi.disabled=new Yi(!1,1029,2305),Yi.backCCW=new Yi(!0,1029,2305);const kc=a.an(new Float32Array(16));function fh(v,o,h,p,m,b){const{horizontalAlign:M,verticalAlign:E}=a.at(v);return new a.P((-(M-.5)*o/m+p[0])*b,(-(E-.5)*h/m+p[1])*b)}function ul(v,o,h,p,m,b,M,E,A,F,V){const q=v.text.placedSymbolArray,Q=v.text.dynamicLayoutVertexArray,pe=v.icon.dynamicLayoutVertexArray,fe={};Q.clear();for(let _e=0;_e<q.length;_e++){const ue=q.get(_e),Ie=ue.hidden||!ue.crossTileID||v.allowVerticalPlacement&&!ue.placedOrientation?null:p[ue.crossTileID];if(Ie){const Ze=new a.P(ue.anchorX,ue.anchorY),be=_n(Ze,h?M:b,V),Re=me(m.cameraToCenterDistance,be.signedDistanceFromCamera);let We=a.ai(v.textSizeData,A,ue)*Re/a.ao;h&&(We*=v.tilePixelRatio/E);const{width:He,height:Xe,anchor:ot,textOffset:it,textBoxScale:gt}=Ie,vt=fh(ot,He,Xe,it,gt,We),ci=h?_n(Ze.add(vt),b,V).point:be.point.add(o?vt.rotate(-m.angle):vt),xt=v.allowVerticalPlacement&&ue.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let ei=0;ei<ue.numGlyphs;ei++)a.aj(Q,ci,xt);F&&ue.associatedIconIndex>=0&&(fe[ue.associatedIconIndex]={shiftedAnchor:ci,angle:xt})}else Ge(ue.numGlyphs,Q)}if(F){pe.clear();const _e=v.icon.placedSymbolArray;for(let ue=0;ue<_e.length;ue++){const Ie=_e.get(ue);if(Ie.hidden)Ge(Ie.numGlyphs,pe);else{const Ze=fe[ue];if(Ze)for(let be=0;be<Ie.numGlyphs;be++)a.aj(pe,Ze.shiftedAnchor,Ze.angle);else Ge(Ie.numGlyphs,pe)}}v.icon.dynamicLayoutVertexBuffer.updateData(pe)}v.text.dynamicLayoutVertexBuffer.updateData(Q)}function hl(v,o,h){return h.iconsInText&&o?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function dl(v,o,h,p,m,b,M,E,A,F,V,q){const Q=v.context,pe=Q.gl,fe=v.transform,_e=E==="map",ue=A==="map",Ie=E!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ze=_e&&!ue&&!Ie,be=!h.layout.get("symbol-sort-key").isConstant();let Re=!1;const We=v.depthModeForSublayer(0,Ti.ReadOnly),He=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[];for(const ot of p){const it=o.getTile(ot),gt=it.getBucket(h);if(!gt)continue;const vt=m?gt.text:gt.icon;if(!vt||!vt.segments.get().length||!vt.hasVisibleVertices)continue;const ci=vt.programConfigurations.get(h.id),xt=m||gt.sdfIcons,ei=m?gt.textSizeData:gt.iconSizeData,ui=ue||fe.pitch!==0,Ci=v.useProgram(hl(xt,m,gt),ci),ri=a.ag(ei,fe.zoom),fi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ot);let yi,wn,Ui,Nr,qn=[0,0],dn=null;if(m)wn=it.glyphAtlasTexture,Ui=pe.LINEAR,yi=it.glyphAtlasTexture.size,gt.iconsInText&&(qn=it.imageAtlasTexture.size,dn=it.imageAtlasTexture,Nr=ui||v.options.rotating||v.options.zooming||ei.kind==="composite"||ei.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const On=h.layout.get("icon-size").constantOr(0)!==1||gt.iconsNeedLinear;wn=it.imageAtlasTexture,Ui=xt||v.options.rotating||v.options.zooming||On||ui?pe.LINEAR:pe.NEAREST,yi=it.imageAtlasTexture.size}const Zn=Qt(it,1,v.transform.zoom),$r=si(ot.posMatrix,ue,_e,v.transform,Zn),xo=no(ot.posMatrix,ue,_e,v.transform,Zn),Ko=He&&gt.hasTextData(),Pa=h.layout.get("icon-text-fit")!=="none"&&Ko&&gt.hasIconData();if(Ie){const On=v.style.map.terrain?(Yr,Nn)=>v.style.map.terrain.getElevation(ot,Yr,Nn):null,pn=h.layout.get("text-rotation-alignment")==="map";X(gt,ot.posMatrix,v,m,$r,xo,ue,F,pn,On)}const Jo=v.translatePosMatrix(ot.posMatrix,it,b,M),ko=Ie||m&&He||Pa?kc:$r,Fn=v.translatePosMatrix(xo,it,b,M,!0),fn=xt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let cn;cn=xt?gt.iconsInText?ya(ei.kind,ri,Ze,ue,v,Jo,ko,Fn,yi,qn):_a(ei.kind,ri,Ze,ue,v,Jo,ko,Fn,m,yi,!0):ga(ei.kind,ri,Ze,ue,v,Jo,ko,Fn,m,yi);const Jr={program:Ci,buffers:vt,uniformValues:cn,atlasTexture:wn,atlasTextureIcon:dn,atlasInterpolation:Ui,atlasInterpolationIcon:Nr,isSDF:xt,hasHalo:fn};if(be&&gt.canOverlap){Re=!0;const On=vt.segments.get();for(const pn of On)Xe.push({segments:new a.$([pn]),sortKey:pn.sortKey,state:Jr,terrainData:fi})}else Xe.push({segments:vt.segments,sortKey:0,state:Jr,terrainData:fi})}Re&&Xe.sort((ot,it)=>ot.sortKey-it.sortKey);for(const ot of Xe){const it=ot.state;if(Q.activeTexture.set(pe.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,pe.CLAMP_TO_EDGE),it.atlasTextureIcon&&(Q.activeTexture.set(pe.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),it.isSDF){const gt=it.uniformValues;it.hasHalo&&(gt.u_is_halo=1,ph(it.buffers,ot.segments,h,v,it.program,We,V,q,gt,ot.terrainData)),gt.u_is_halo=0}ph(it.buffers,ot.segments,h,v,it.program,We,V,q,it.uniformValues,ot.terrainData)}}function ph(v,o,h,p,m,b,M,E,A,F){const V=p.context;m.draw(V,V.gl.TRIANGLES,b,M,E,Yi.disabled,A,F,h.id,v.layoutVertexBuffer,v.indexBuffer,o,h.paint,p.transform.zoom,v.programConfigurations.get(h.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function fl(v,o,h,p,m){if(!h||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let M=b[h.to.toString()],E=b[h.from.toString()];if(!M&&E&&(M=E),!E&&M&&(E=M),!M||!E){const A=m.getPaintProperty(o);M=b[A],E=b[A]}M&&E&&v.setConstantPatternPositions(M,E)}function mh(v,o,h,p,m,b,M){const E=v.context.gl,A="fill-pattern",F=h.paint.get(A),V=F&&F.constantOr(1),q=h.getCrossfadeParameters();let Q,pe,fe,_e,ue;M?(pe=V&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=E.LINES):(pe=V?"fillPattern":"fill",Q=E.TRIANGLES);const Ie=F.constantOr(null);for(const Ze of p){const be=o.getTile(Ze);if(V&&!be.patternsLoaded())continue;const Re=be.getBucket(h);if(!Re)continue;const We=Re.programConfigurations.get(h.id),He=v.useProgram(pe,We),Xe=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ze);V&&(v.context.activeTexture.set(E.TEXTURE0),be.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),We.updatePaintBuffers(q)),fl(We,A,Ie,be,h);const ot=Xe?Ze:null,it=v.translatePosMatrix(ot?ot.posMatrix:Ze.posMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(M){_e=Re.indexBuffer2,ue=Re.segments2;const gt=[E.drawingBufferWidth,E.drawingBufferHeight];fe=pe==="fillOutlinePattern"&&V?Qu(it,v,q,be,gt):jd(it,gt)}else _e=Re.indexBuffer,ue=Re.segments,fe=V?Ja(it,v,q,be):Yu(it);He.draw(v.context,Q,m,v.stencilModeForClipping(Ze),b,Yi.disabled,fe,Xe,h.id,Re.layoutVertexBuffer,_e,ue,h.paint,v.transform.zoom,We)}}function pl(v,o,h,p,m,b,M){const E=v.context,A=E.gl,F="fill-extrusion-pattern",V=h.paint.get(F),q=V.constantOr(1),Q=h.getCrossfadeParameters(),pe=h.paint.get("fill-extrusion-opacity"),fe=V.constantOr(null);for(const _e of p){const ue=o.getTile(_e),Ie=ue.getBucket(h);if(!Ie)continue;const Ze=v.style.map.terrain&&v.style.map.terrain.getTerrainData(_e),be=Ie.programConfigurations.get(h.id),Re=v.useProgram(q?"fillExtrusionPattern":"fillExtrusion",be);q&&(v.context.activeTexture.set(A.TEXTURE0),ue.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),be.updatePaintBuffers(Q)),fl(be,F,fe,ue,h);const We=v.translatePosMatrix(_e.posMatrix,ue,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),Xe=q?$d(We,v,He,pe,_e,Q,ue):fa(We,v,He,pe);Re.draw(E,E.gl.TRIANGLES,m,b,M,Yi.backCCW,Xe,Ze,h.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,h.paint,v.transform.zoom,be,v.style.map.terrain&&Ie.centroidVertexBuffer)}}function ml(v,o,h,p,m,b,M){const E=v.context,A=E.gl,F=h.fbo;if(!F)return;const V=v.useProgram("hillshade"),q=v.style.map.terrain&&v.style.map.terrain.getTerrainData(o);E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,F.colorAttachment.get()),V.draw(E,A.TRIANGLES,m,b,M,Yi.disabled,((Q,pe,fe,_e)=>{const ue=fe.paint.get("hillshade-shadow-color"),Ie=fe.paint.get("hillshade-highlight-color"),Ze=fe.paint.get("hillshade-accent-color");let be=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=Q.transform.angle);const Re=!Q.options.moving;return{u_matrix:_e?_e.posMatrix:Q.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Re),u_image:0,u_latrange:nh(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),be],u_shadow:ue,u_highlight:Ie,u_accent:Ze}})(v,h,p,q?o:null),q,p.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}function Sc(v,o,h,p,m,b){const M=v.context,E=M.gl,A=o.dem;if(A&&A.data){const F=A.dim,V=A.stride,q=A.getPixels();if(M.activeTexture.set(E.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||v.getTileTexture(V),o.demTexture){const pe=o.demTexture;pe.update(q,{premultiply:!1}),pe.bind(E.NEAREST,E.CLAMP_TO_EDGE)}else o.demTexture=new oe(M,q,E.RGBA,{premultiply:!1}),o.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);M.activeTexture.set(E.TEXTURE0);let Q=o.fbo;if(!Q){const pe=new oe(M,{width:F,height:F,data:null},E.RGBA);pe.bind(E.LINEAR,E.CLAMP_TO_EDGE),Q=o.fbo=M.createFramebuffer(F,F,!0,!1),Q.colorAttachment.set(pe.texture)}M.bindFramebuffer.set(Q.framebuffer),M.viewport.set([0,0,F,F]),v.useProgram("hillshadePrepare").draw(M,E.TRIANGLES,p,m,b,Yi.disabled,((pe,fe)=>{const _e=fe.stride,ue=a.F();return a.aN(ue,0,a.W,-a.W,0,0,1),a.H(ue,ue,[0,-a.W,0]),{u_matrix:ue,u_image:1,u_dimension:[_e,_e],u_zoom:pe.overscaledZ,u_unpack:fe.getUnpackVector()}})(o.tileID,A),null,h.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function gh(v,o,h,p,m,b){const M=p.paint.get("raster-fade-duration");if(!b&&M>0){const E=S.now(),A=(E-v.timeAdded)/M,F=o?(E-o.timeAdded)/M:-1,V=h.getSource(),q=m.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),Q=!o||Math.abs(o.tileID.overscaledZ-q)>Math.abs(v.tileID.overscaledZ-q),pe=Q&&v.refreshedUponExpiration?1:a.ac(Q?A:1-F,0,1);return v.refreshedUponExpiration&&A>=1&&(v.refreshedUponExpiration=!1),o?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const _h=new a.aO(1,0,0,1),gl=new a.aO(0,1,0,1),Tc=new a.aO(0,0,1,1),ef=new a.aO(1,0,1,1),yh=new a.aO(0,1,1,1);function vn(v,o,h,p){_r(v,0,o+h/2,v.transform.width,h,p)}function Go(v,o,h,p){_r(v,o-h/2,0,h,v.transform.height,p)}function _r(v,o,h,p,m,b){const M=v.context,E=M.gl;E.enable(E.SCISSOR_TEST),E.scissor(o*v.pixelRatio,h*v.pixelRatio,p*v.pixelRatio,m*v.pixelRatio),M.clear({color:b}),E.disable(E.SCISSOR_TEST)}function Cc(v,o,h){const p=v.context,m=p.gl,b=h.posMatrix,M=v.useProgram("debug"),E=Ti.disabled,A=rn.disabled,F=v.colorModeForRenderPass(),V="$debug",q=v.style.map.terrain&&v.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const Q=o.getTileByID(h.key).latestRawTileData,pe=Math.floor((Q&&Q.byteLength||0)/1024),fe=o.getTile(h).tileSize,_e=512/Math.min(fe,512)*(h.overscaledZ/v.transform.zoom)*.5;let ue=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ue+=` => ${h.overscaledZ}`),function(Ie,Ze){Ie.initDebugOverlayCanvas();const be=Ie.debugOverlayCanvas,Re=Ie.context.gl,We=Ie.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,be.width,be.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(Ze,5,5),We.strokeText(Ze,5,5),Ie.debugOverlayTexture.update(be),Ie.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(v,`${ue} ${pe}kB`),M.draw(p,m.TRIANGLES,E,A,Ln.alphaBlended,Yi.disabled,th(b,a.aO.transparent,_e),null,V,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),M.draw(p,m.LINE_STRIP,E,A,F,Yi.disabled,th(b,a.aO.red),q,V,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function _l(v,o,h){const p=v.context,m=p.gl,b=v.colorModeForRenderPass(),M=new Ti(m.LEQUAL,Ti.ReadWrite,v.depthRangeFor3D),E=v.useProgram("terrain"),A=o.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,v.width,v.height]);for(const F of h){const V=v.renderToTexture.getTexture(F),q=o.getTerrainData(F.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,V.texture);const Q={u_matrix:v.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(v.transform.zoom)};E.draw(p,m.TRIANGLES,M,rn.disabled,b,Yi.backCCW,Q,q,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class vh{constructor(o,h){this.context=new Qd(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ki.maxUnderzooming+Ki.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qo}resize(o,h,p){if(this.width=Math.floor(o*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=o.createVertexBuffer(h,Ha.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=o.createVertexBuffer(p,Ha.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=o.createVertexBuffer(m,Je.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const b=new a.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(b,Ha.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const M=new a.aW;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(M);const E=new a.aX;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);const A=this.context.gl;this.stencilClearMode=new rn({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,Ti.disabled,this.stencilClearMode,Ln.disabled,Yi.disabled,Ya(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Ln.disabled),p.setDepthMode(Ti.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of h){const E=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(M);b.draw(p,m.TRIANGLES,Ti.disabled,new rn({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),Ln.disabled,Yi.disabled,Ya(M.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new rn({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new rn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((M,E)=>E.overscaledZ-M.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const M={};for(let E=0;E<b;E++)M[E+m]=new rn({func:h.GEQUAL,mask:255},E+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[M,p]}return[{[m]:rn.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Ln([o.CONSTANT_COLOR,o.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ln.unblended:Ln.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return Ti.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Ti(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},M={},E={};for(const A in m){const F=m[A];F.used&&F.prepare(this.context),b[A]=F.getVisibleCoordinates(),M[A]=b[A].slice().reverse(),E[A]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const F=this.style._layers[A];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const V=M[F.source];(F.type==="custom"||V.length)&&this.renderLayer(this,m[F.source],F,V)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],F=m[A.source],V=b[A.source];this._renderTileClippingMasks(A,V),this.renderLayer(this,F,A,V)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],F=m[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const V=(A.type==="symbol"?E:M)[A.source];this._renderTileClippingMasks(A,b[A.source]),this.renderLayer(this,F,A,V)}if(this.options.showTileBoundaries){const A=function(F,V){let q=null;const Q=Object.values(F._layers).flatMap(ue=>ue.source&&!ue.isHidden(V)?[F.sourceCaches[ue.source]]:[]),pe=Q.filter(ue=>ue.getSource().type==="vector"),fe=Q.filter(ue=>ue.getSource().type!=="vector"),_e=ue=>{(!q||q.getSource().maxzoom<ue.getSource().maxzoom)&&(q=ue)};return pe.forEach(ue=>_e(ue)),q||fe.forEach(ue=>_e(ue)),q}(this.style,this.transform.zoom);A&&function(F,V,q){for(let Q=0;Q<q.length;Q++)Cc(F,V,q[Q])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const F=A.transform.padding;vn(A,A.transform.height-(F.top||0),3,_h),vn(A,F.bottom||0,3,gl),Go(A,F.left||0,3,Tc),Go(A,A.transform.width-(F.right||0),3,ef);const V=A.transform.centerPoint;(function(q,Q,pe,fe){_r(q,Q-1,pe-10,2,20,fe),_r(q,Q-10,pe-1,20,2,fe)})(A,V.x,A.transform.height-V.y,yh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,M){const E=b.context,A=E.gl,F=Ln.unblended,V=new Ti(A.LEQUAL,Ti.ReadWrite,[0,1]),q=M.getTerrainMesh(),Q=M.sourceCache.getRenderableTiles(),pe=b.useProgram("terrainDepth");E.bindFramebuffer.set(M.getFramebuffer("depth").framebuffer),E.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),E.clear({color:a.aO.transparent,depth:1});for(const fe of Q){const _e=M.getTerrainData(fe.tileID),ue={u_matrix:b.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:M.getMeshFrameDelta(b.transform.zoom)};pe.draw(E,A.TRIANGLES,V,rn.disabled,F,Yi.backCCW,ue,_e,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}E.bindFramebuffer.set(null),E.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,M){const E=b.context,A=E.gl,F=Ln.unblended,V=new Ti(A.LEQUAL,Ti.ReadWrite,[0,1]),q=M.getTerrainMesh(),Q=M.getCoordsTexture(),pe=M.sourceCache.getRenderableTiles(),fe=b.useProgram("terrainCoords");E.bindFramebuffer.set(M.getFramebuffer("coords").framebuffer),E.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),E.clear({color:a.aO.transparent,depth:1}),M.coordsIndex=[];for(const _e of pe){const ue=M.getTerrainData(_e.tileID);E.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Q.texture);const Ie={u_matrix:b.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-M.coordsIndex.length)/255,u_texture:0,u_ele_delta:M.getMeshFrameDelta(b.transform.zoom)};fe.draw(E,A.TRIANGLES,V,rn.disabled,F,Yi.backCCW,Ie,ue,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),M.coordsIndex.push(_e.tileID.key)}E.bindFramebuffer.set(null),E.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(o,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,M,E,A,F){if(b.renderPass!=="translucent")return;const V=rn.disabled,q=b.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Q,pe,fe,_e,ue,Ie,Ze){const be=pe.transform,Re=ue==="map",We=Ie==="map";for(const He of Q){const Xe=_e.getTile(He),ot=Xe.getBucket(fe);if(!ot||!ot.text||!ot.text.segments.get().length)continue;const it=a.ag(ot.textSizeData,be.zoom),gt=Qt(Xe,1,pe.transform.zoom),vt=si(He.posMatrix,We,Re,pe.transform,gt),ci=fe.layout.get("icon-text-fit")!=="none"&&ot.hasIconData();if(it){const xt=Math.pow(2,be.zoom-Xe.tileID.overscaledZ);ul(ot,Re,We,Ze,be,vt,He.posMatrix,xt,it,ci,pe.style.map.terrain?(ei,ui)=>pe.style.map.terrain.getElevation(He,ei,ui):null)}}}(A,b,E,M,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),F),E.paint.get("icon-opacity").constantOr(1)!==0&&dl(b,M,E,A,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),V,q),E.paint.get("text-opacity").constantOr(1)!==0&&dl(b,M,E,A,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),V,q),M.map.showCollisionBoxes&&(cl(b,M,E,A,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),!0),cl(b,M,E,A,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),!1))})(o,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,M,E,A){if(b.renderPass!=="translucent")return;const F=E.paint.get("circle-opacity"),V=E.paint.get("circle-stroke-width"),q=E.paint.get("circle-stroke-opacity"),Q=!E.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(V.constantOr(1)===0||q.constantOr(1)===0))return;const pe=b.context,fe=pe.gl,_e=b.depthModeForSublayer(0,Ti.ReadOnly),ue=rn.disabled,Ie=b.colorModeForRenderPass(),Ze=[];for(let be=0;be<A.length;be++){const Re=A[be],We=M.getTile(Re),He=We.getBucket(E);if(!He)continue;const Xe=He.programConfigurations.get(E.id),ot=b.useProgram("circle",Xe),it=He.layoutVertexBuffer,gt=He.indexBuffer,vt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Re),ci={programConfiguration:Xe,program:ot,layoutVertexBuffer:it,indexBuffer:gt,uniformValues:Ud(b,Re,We,E),terrainData:vt};if(Q){const xt=He.segments.get();for(const ei of xt)Ze.push({segments:new a.$([ei]),sortKey:ei.sortKey,state:ci})}else Ze.push({segments:He.segments,sortKey:0,state:ci})}Q&&Ze.sort((be,Re)=>be.sortKey-Re.sortKey);for(const be of Ze){const{programConfiguration:Re,program:We,layoutVertexBuffer:He,indexBuffer:Xe,uniformValues:ot,terrainData:it}=be.state;We.draw(pe,fe.TRIANGLES,_e,ue,Ie,Yi.disabled,ot,it,E.id,He,Xe,be.segments,E.paint,b.transform.zoom,Re)}})(o,h,p,m);break;case"heatmap":(function(b,M,E,A){if(E.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const F=b.context,V=F.gl,q=rn.disabled,Q=new Ln([V.ONE,V.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(pe,fe,_e){const ue=pe.gl;pe.activeTexture.set(ue.TEXTURE1),pe.viewport.set([0,0,fe.width/4,fe.height/4]);let Ie=_e.heatmapFbo;if(Ie)ue.bindTexture(ue.TEXTURE_2D,Ie.colorAttachment.get()),pe.bindFramebuffer.set(Ie.framebuffer);else{const Ze=ue.createTexture();ue.bindTexture(ue.TEXTURE_2D,Ze),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_WRAP_S,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_WRAP_T,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_MIN_FILTER,ue.LINEAR),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_MAG_FILTER,ue.LINEAR),Ie=_e.heatmapFbo=pe.createFramebuffer(fe.width/4,fe.height/4,!1,!1),function(be,Re,We,He){var Xe,ot;const it=be.gl,gt=(Xe=be.HALF_FLOAT)!==null&&Xe!==void 0?Xe:it.UNSIGNED_BYTE,vt=(ot=be.RGBA16F)!==null&&ot!==void 0?ot:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,vt,Re.width/4,Re.height/4,0,it.RGBA,gt,null),He.colorAttachment.set(We)}(pe,fe,Ze,Ie)}})(F,b,E),F.clear({color:a.aO.transparent});for(let pe=0;pe<A.length;pe++){const fe=A[pe];if(M.hasRenderableParent(fe))continue;const _e=M.getTile(fe),ue=_e.getBucket(E);if(!ue)continue;const Ie=ue.programConfigurations.get(E.id),Ze=b.useProgram("heatmap",Ie),{zoom:be}=b.transform;Ze.draw(F,V.TRIANGLES,Ti.disabled,q,Q,Yi.disabled,ih(fe.posMatrix,_e,be,E.paint.get("heatmap-intensity")),null,E.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,E.paint,b.transform.zoom,Ie)}F.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(F,V){const q=F.context,Q=q.gl,pe=V.heatmapFbo;if(!pe)return;q.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,pe.colorAttachment.get()),q.activeTexture.set(Q.TEXTURE1);let fe=V.colorRampTexture;fe||(fe=V.colorRampTexture=new oe(q,V.colorRamp,Q.RGBA)),fe.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(q,Q.TRIANGLES,Ti.disabled,rn.disabled,F.colorModeForRenderPass(),Yi.disabled,((_e,ue,Ie,Ze)=>{const be=a.F();a.aN(be,0,_e.width,_e.height,0,0,1);const Re=_e.context.gl;return{u_matrix:be,u_world:[Re.drawingBufferWidth,Re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ue.paint.get("heatmap-opacity")}})(F,V),null,V.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,V.paint,F.transform.zoom)}(b,E))})(o,h,p,m);break;case"line":(function(b,M,E,A){if(b.renderPass!=="translucent")return;const F=E.paint.get("line-opacity"),V=E.paint.get("line-width");if(F.constantOr(1)===0||V.constantOr(1)===0)return;const q=b.depthModeForSublayer(0,Ti.ReadOnly),Q=b.colorModeForRenderPass(),pe=E.paint.get("line-dasharray"),fe=E.paint.get("line-pattern"),_e=fe.constantOr(1),ue=E.paint.get("line-gradient"),Ie=E.getCrossfadeParameters(),Ze=_e?"linePattern":pe?"lineSDF":ue?"lineGradient":"line",be=b.context,Re=be.gl;let We=!0;for(const He of A){const Xe=M.getTile(He);if(_e&&!Xe.patternsLoaded())continue;const ot=Xe.getBucket(E);if(!ot)continue;const it=ot.programConfigurations.get(E.id),gt=b.context.program.get(),vt=b.useProgram(Ze,it),ci=We||vt.program!==gt,xt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),ei=fe.constantOr(null);if(ei&&Xe.imageAtlas){const ri=Xe.imageAtlas,fi=ri.patternPositions[ei.to.toString()],yi=ri.patternPositions[ei.from.toString()];fi&&yi&&it.setConstantPatternPositions(fi,yi)}const ui=xt?He:null,Ci=_e?ss(b,Xe,E,Ie,ui):pe?el(b,Xe,E,pe,Ie,ui):ue?rh(b,Xe,E,ot.lineClipsArray.length,ui):Qa(b,Xe,E,ui);if(_e)be.activeTexture.set(Re.TEXTURE0),Xe.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),it.updatePaintBuffers(Ie);else if(pe&&(ci||b.lineAtlas.dirty))be.activeTexture.set(Re.TEXTURE0),b.lineAtlas.bind(be);else if(ue){const ri=ot.gradients[E.id];let fi=ri.texture;if(E.gradientVersion!==ri.version){let yi=256;if(E.stepInterpolant){const wn=M.getSource().maxzoom,Ui=He.canonical.z===wn?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;yi=a.ac(a.aT(ot.maxLineLength/a.W*1024*Ui),256,be.maxTextureSize)}ri.gradient=a.aU({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:yi,image:ri.gradient||void 0,clips:ot.lineClipsArray}),ri.texture?ri.texture.update(ri.gradient):ri.texture=new oe(be,ri.gradient,Re.RGBA),ri.version=E.gradientVersion,fi=ri.texture}be.activeTexture.set(Re.TEXTURE0),fi.bind(E.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}vt.draw(be,Re.TRIANGLES,q,b.stencilModeForClipping(He),Q,Yi.disabled,Ci,xt,E.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,E.paint,b.transform.zoom,it,ot.layoutVertexBuffer2),We=!1}})(o,h,p,m);break;case"fill":(function(b,M,E,A){const F=E.paint.get("fill-color"),V=E.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const q=b.colorModeForRenderPass(),Q=E.paint.get("fill-pattern"),pe=b.opaquePassEnabledForLayer()&&!Q.constantOr(1)&&F.constantOr(a.aO.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===pe){const fe=b.depthModeForSublayer(1,b.renderPass==="opaque"?Ti.ReadWrite:Ti.ReadOnly);mh(b,M,E,A,fe,q,!1)}if(b.renderPass==="translucent"&&E.paint.get("fill-antialias")){const fe=b.depthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,Ti.ReadOnly);mh(b,M,E,A,fe,q,!0)}})(o,h,p,m);break;case"fill-extrusion":(function(b,M,E,A){const F=E.paint.get("fill-extrusion-opacity");if(F!==0&&b.renderPass==="translucent"){const V=new Ti(b.context.gl.LEQUAL,Ti.ReadWrite,b.depthRangeFor3D);if(F!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))pl(b,M,E,A,V,rn.disabled,Ln.disabled),pl(b,M,E,A,V,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const q=b.colorModeForRenderPass();pl(b,M,E,A,V,rn.disabled,q)}}})(o,h,p,m);break;case"hillshade":(function(b,M,E,A){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const F=b.context,V=b.depthModeForSublayer(0,Ti.ReadOnly),q=b.colorModeForRenderPass(),[Q,pe]=b.renderPass==="translucent"?b.stencilConfigForOverlap(A):[{},A];for(const fe of pe){const _e=M.getTile(fe);_e.needsHillshadePrepare!==void 0&&_e.needsHillshadePrepare&&b.renderPass==="offscreen"?Sc(b,_e,E,V,rn.disabled,q):b.renderPass==="translucent"&&ml(b,fe,_e,E,V,Q[fe.overscaledZ],q)}F.viewport.set([0,0,b.width,b.height])})(o,h,p,m);break;case"raster":(function(b,M,E,A){if(b.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!A.length)return;const F=b.context,V=F.gl,q=M.getSource(),Q=b.useProgram("raster"),pe=b.colorModeForRenderPass(),[fe,_e]=q instanceof Vt?[{},A]:b.stencilConfigForOverlap(A),ue=_e[_e.length-1].overscaledZ,Ie=!b.options.moving;for(const Ze of _e){const be=b.depthModeForSublayer(Ze.overscaledZ-ue,E.paint.get("raster-opacity")===1?Ti.ReadWrite:Ti.ReadOnly,V.LESS),Re=M.getTile(Ze);Re.registerFadeDuration(E.paint.get("raster-fade-duration"));const We=M.findLoadedParent(Ze,0),He=gh(Re,We,M,E,b.transform,b.style.map.terrain);let Xe,ot;const it=E.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;F.activeTexture.set(V.TEXTURE0),Re.texture.bind(it,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(V.TEXTURE1),We?(We.texture.bind(it,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,We.tileID.overscaledZ-Re.tileID.overscaledZ),ot=[Re.tileID.canonical.x*Xe%1,Re.tileID.canonical.y*Xe%1]):Re.texture.bind(it,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const gt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ze),vt=gt?Ze:null,ci=vt?vt.posMatrix:b.transform.calculatePosMatrix(Ze.toUnwrapped(),Ie),xt=tl(ci,ot||[0,0],Xe||1,He,E);q instanceof Vt?Q.draw(F,V.TRIANGLES,be,rn.disabled,pe,Yi.disabled,xt,gt,E.id,q.boundsBuffer,b.quadTriangleIndexBuffer,q.boundsSegments):Q.draw(F,V.TRIANGLES,be,fe[Ze.overscaledZ],pe,Yi.disabled,xt,gt,E.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(o,h,p,m);break;case"background":(function(b,M,E,A){const F=E.paint.get("background-color"),V=E.paint.get("background-opacity");if(V===0)return;const q=b.context,Q=q.gl,pe=b.transform,fe=pe.tileSize,_e=E.paint.get("background-pattern");if(b.isPatternMissing(_e))return;const ue=!_e&&F.a===1&&V===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==ue)return;const Ie=rn.disabled,Ze=b.depthModeForSublayer(0,ue==="opaque"?Ti.ReadWrite:Ti.ReadOnly),be=b.colorModeForRenderPass(),Re=b.useProgram(_e?"backgroundPattern":"background"),We=A||pe.coveringTiles({tileSize:fe,terrain:b.style.map.terrain});_e&&(q.activeTexture.set(Q.TEXTURE0),b.imageManager.bind(b.context));const He=E.getCrossfadeParameters();for(const Xe of We){const ot=A?Xe.posMatrix:b.transform.calculatePosMatrix(Xe.toUnwrapped()),it=_e?qd(ot,V,b,_e,{tileID:Xe,tileSize:fe},He):Vd(ot,V,F),gt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Xe);Re.draw(q,Q.TRIANGLES,Ze,Ie,be,Yi.disabled,it,gt,E.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(o,0,p,m);break;case"custom":(function(b,M,E){const A=b.context,F=E.implementation;if(b.renderPass==="offscreen"){const V=F.prerender;V&&(b.setCustomLayerDefaults(),A.setColorMode(b.colorModeForRenderPass()),V.call(F,A.gl,b.transform.customLayerMatrix()),A.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),A.setColorMode(b.colorModeForRenderPass()),A.setStencilMode(rn.disabled);const V=F.renderingMode==="3d"?new Ti(b.context.gl.LEQUAL,Ti.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Ti.ReadOnly);A.setDepthMode(V),F.render(A.gl,b.transform.customLayerMatrix()),A.setDirty(),b.setBaseState(),A.bindFramebuffer.set(null)}})(o,0,p)}}translatePosMatrix(o,h,p,m,b){if(!p[0]&&!p[1])return o;const M=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(M){const F=Math.sin(M),V=Math.cos(M);p=[p[0]*V-p[1]*F,p[0]*F+p[1]*V]}const E=[b?p[0]:Qt(h,p[0],this.transform.zoom),b?p[1]:Qt(h,p[1],this.transform.zoom),0],A=new Float32Array(16);return a.H(A,o,E),A}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Zo(this.context,da[o],h,oh[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new oe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class Wo{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const A=1/(E=a.af([],E,o))[3]/h*m;return a.a$(E,E,[A,A,1/E[3],A])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const A=function(Q,pe){var fe=pe[0],_e=pe[1],ue=pe[2],Ie=fe*fe+_e*_e+ue*ue;return Ie>0&&(Ie=1/Math.sqrt(Ie)),Q[0]=pe[0]*Ie,Q[1]=pe[1]*Ie,Q[2]=pe[2]*Ie,Q}([],function(Q,pe,fe){var _e=pe[0],ue=pe[1],Ie=pe[2],Ze=fe[0],be=fe[1],Re=fe[2];return Q[0]=ue*Re-Ie*be,Q[1]=Ie*Ze-_e*Re,Q[2]=_e*be-ue*Ze,Q}([],te([],b[E[0]],b[E[1]]),te([],b[E[2]],b[E[1]]))),F=-((V=A)[0]*(q=b[E[1]])[0]+V[1]*q[1]+V[2]*q[2]);var V,q;return A.concat(F)});return new Wo(b,M)}}class Ho{constructor(o,h){this.min=o,this.max=h,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],p=ce(this.min),m=ce(this.max);for(let b=0;b<h.length;b++)p[b]=h[b]?this.min[b]:this.center[b],m[b]=h[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new Ho(p,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<o.planes.length;m++){const b=o.planes[m];let M=0;for(let E=0;E<h.length;E++)a.b0(b,h[E])>=0&&M++;if(M===0)return 0;M!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let E=0;E<o.points.length;E++){const A=o.points[E][m]-this.min[m];b=Math.min(b,A),M=Math.max(M,A)}if(M<0||b>this.max[m]-this.min[m])return 0}return 1}}class Fs{constructor(o=0,h=0,p=0,m=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=m}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=a.z.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.z.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=a.z.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=a.z.number(o.right,h.right,p)),this}getCenter(o,h){const p=a.ac((this.left+o-this.right)/2,0,o),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Mc=85.051129;class yl{constructor(o,h,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new yl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-a.b1(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var M=m[0],E=m[1],A=m[2],F=m[3],V=Math.sin(b),q=Math.cos(b);p[0]=M*q+A*V,p[1]=E*q+F*V,p[2]=M*-V+A*q,p[3]=E*-V+F*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.b2(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),M=this.pointCoordinate(new a.P(0,this.height)),E=Math.floor(Math.min(p.x,m.x,b.x,M.x)),A=Math.floor(Math.max(p.x,m.x,b.x,M.x)),F=1;for(let V=E-F;V<=A+F;V++)V!==0&&h.push(new a.b2(V,o))}return h}coveringTiles(o){var h,p;let m=this.coveringZoomLevel(o);const b=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const M=this.pointCoordinate(this.getCameraPoint()),E=a.Y.fromLngLat(this.center),A=Math.pow(2,m),F=[A*M.x,A*M.y,0],V=[A*E.x,A*E.y,0],q=Wo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let Q=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Q=m);const pe=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,fe=be=>({aabb:new Ho([be*A,0,0],[(be+1)*A,A,0]),zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),_e=[],ue=[],Ie=m,Ze=o.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let be=1;be<=3;be++)_e.push(fe(-be)),_e.push(fe(be));for(_e.push(fe(0));_e.length>0;){const be=_e.pop(),Re=be.x,We=be.y;let He=be.fullyVisible;if(!He){const vt=be.aabb.intersects(q);if(vt===0)continue;He=vt===2}const Xe=o.terrain?F:V,ot=be.aabb.distanceX(Xe),it=be.aabb.distanceY(Xe),gt=Math.max(Math.abs(ot),Math.abs(it));if(be.zoom===Ie||gt>pe+(1<<Ie-be.zoom)-2&&be.zoom>=Q){const vt=Ie-be.zoom,ci=F[0]-.5-(Re<<vt),xt=F[1]-.5-(We<<vt);ue.push({tileID:new a.Q(be.zoom===Ie?Ze:be.zoom,be.wrap,be.zoom,Re,We),distanceSq:ye([V[0]-.5-Re,V[1]-.5-We]),tileDistanceToCamera:Math.sqrt(ci*ci+xt*xt)})}else for(let vt=0;vt<4;vt++){const ci=(Re<<1)+vt%2,xt=(We<<1)+(vt>>1),ei=be.zoom+1;let ui=be.aabb.quadrant(vt);if(o.terrain){const Ci=new a.Q(ei,be.wrap,ei,ci,xt),ri=o.terrain.getMinMaxElevation(Ci),fi=(h=ri.minElevation)!==null&&h!==void 0?h:this.elevation,yi=(p=ri.maxElevation)!==null&&p!==void 0?p:this.elevation;ui=new Ho([ui.min[0],ui.min[1],fi],[ui.max[0],ui.max[1],yi])}_e.push({aabb:ui,zoom:ei,x:ci,y:xt,wrap:be.wrap,fullyVisible:He})}}return ue.sort((be,Re)=>be.distanceSq-Re.distanceSq).map(be=>be.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=a.ac(o.lat,-85.051129,Mc);return new a.P(a.N(o.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(o){return new a.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,o),b=o.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const M=p+h-b,E=Math.cos(this._pitch)*this.cameraToCenterDistance/M/a.b3(1,m.lat),A=this.scaleZoom(E/this.tileSize);this._elevation=b,this._center=m,this.zoom=A}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(o),M=new a.Y(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return a.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const Q=h.pointCoordinate(o);if(Q!=null)return Q}const p=[o.x,o.y,0,1],m=[o.x,o.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const b=p[3],M=m[3],E=p[1]/b,A=m[1]/M,F=p[2]/b,V=m[2]/M,q=F===V?0:(0-F)/(V-F);return new a.Y(a.z.number(p[0]/b,m[0]/M,q)/this.worldSize,a.z.number(E,A,q)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new Ne().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ne([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Mc])}calculatePosMatrix(o,h=!1){const p=o.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=o.canonical,M=this.worldSize/this.zoomScale(b.z),E=b.x+Math.pow(2,b.z)*o.wrap,A=a.an(new Float64Array(16));return a.H(A,A,[E*M,b.y*M,0]),a.J(A,A,[M/a.W,M/a.W,1]),a.K(A,h?this.alignedProjMatrix:this.projMatrix,A),m[p]=new Float32Array(A),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(o.lng,o.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const be=179.9999999999;m=[-be,be]}const b=this.tileSize*this.zoomScale(p.zoom);let M=0,E=b,A=0,F=b,V=0,q=0;const{x:Q,y:pe}=this.size;if(this.latRange){const be=this.latRange;M=a.O(be[1])*b,E=a.O(be[0])*b,E-M<pe&&(V=pe/(E-M))}m&&(A=a.b1(a.N(m[0])*b,0,b),F=a.b1(a.N(m[1])*b,0,b),F<A&&(F+=b),F-A<Q&&(q=Q/(F-A)));const{x:fe,y:_e}=this.project.call({worldSize:b},o);let ue,Ie;const Ze=Math.max(q||0,V||0);if(Ze){const be=new a.P(q?(F+A)/2:fe,V?(E+M)/2:_e);return p.center=this.unproject.call({worldSize:b},be).wrap(),p.zoom+=this.scaleZoom(Ze),p}if(this.latRange){const be=pe/2;_e-be<M&&(Ie=M+be),_e+be>E&&(Ie=E-be)}if(m){const be=(A+F)/2;let Re=fe;this._renderWorldCopies&&(Re=a.b1(fe,be-b/2,be+b/2));const We=Q/2;Re-We<A&&(ue=A+We),Re+We>F&&(ue=F-We)}if(ue!==void 0||Ie!==void 0){const be=new a.P(ue??fe,Ie??_e);p.center=this.unproject.call({worldSize:b},be).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),M=Math.min(this.elevation,this.minElevationForCurrentTile),E=b-M*this._pixelPerMeter/Math.cos(this._pitch),A=M<0?E:b,F=Math.PI/2+this._pitch,V=this._fov*(.5+o.y/this.height),q=Math.sin(V)*A/Math.sin(a.ac(Math.PI-F-V,.01,Math.PI-.01)),Q=this.getHorizon(),pe=2*Math.atan(Q/this.cameraToCenterDistance)*(.5+o.y/(2*Q)),fe=Math.sin(pe)*A/Math.sin(a.ac(Math.PI-F-pe,.01,Math.PI-.01)),_e=Math.min(q,fe),ue=1.01*(Math.cos(Math.PI/2-this._pitch)*_e+A),Ie=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ie,ue),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const Ze=this.width%2/2,be=this.height%2/2,Re=Math.cos(this.angle),We=Math.sin(this.angle),He=h-Math.round(h)+Re*Ze+We*be,Xe=p-Math.round(p)+Re*be+We*Ze,ot=new Float64Array(m);if(a.H(ot,ot,[He>.5?He-1:He,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=ot,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,m=h.y,b=h.x,M=h.y;for(const E of o)p=Math.min(p,E.x),m=Math.min(m,E.y),b=Math.max(b,E.x),M=Math.max(M,E.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,M),new a.P(p,M),new a.P(p,m)]}}lngLatToCameraDepth(o,h){const p=this.locationCoordinate(o),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function Ec(v,o){let h,p=!1,m=null,b=null;const M=()=>{m=null,p&&(v.apply(b,h),m=setTimeout(M,o),p=!1)};return(...E)=>(p=!0,b=this,h=E,m||M(),m)}class Ic{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Ec(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),M=Math.round(h.lng*b)/b,E=Math.round(h.lat*b)/b,A=this._map.getBearing(),F=this._map.getPitch();let V="";if(V+=o?`/${M}/${E}/${p}`:`${p}/${E}/${M}`,(A||F)&&(V+="/"+Math.round(10*A)/10),F&&(V+=`/${Math.round(F)}`),this._hashName){const q=this._hashName;let Q=!1;const pe=window.location.hash.slice(1).split("&").map(fe=>{const _e=fe.split("=")[0];return _e===q?(Q=!0,`${_e}=${V}`):fe}).filter(fe=>fe);return Q||pe.push(`${q}=${V}`),`#${pe.join("&")}`}return`#${V}`}}const ba={linearity:.3,easing:a.b6(0,0,.3,1)},us=a.e({deceleration:2500,maxSpeed:1400},ba),bh=a.e({deceleration:20,maxSpeed:1400},ba),wh=a.e({deceleration:1e3,maxSpeed:360},ba),xh=a.e({deceleration:1e3,maxSpeed:90},ba);class kh{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=S.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const b=xa(h.pan.mag(),p,a.e({},us,o||{}));m.offset=h.pan.mult(b.amount/h.pan.mag()),m.center=this._map.transform.center,wa(m,b)}if(h.zoom){const b=xa(h.zoom,p,bh);m.zoom=this._map.transform.zoom+b.amount,wa(m,b)}if(h.bearing){const b=xa(h.bearing,p,wh);m.bearing=this._map.transform.bearing+a.ac(b.amount,-179,179),wa(m,b)}if(h.pitch){const b=xa(h.pitch,p,xh);m.pitch=this._map.transform.pitch+b.amount,wa(m,b)}if(m.zoom||m.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function wa(v,o){(!v.duration||v.duration<o.duration)&&(v.duration=o.duration,v.easing=o.easing)}function xa(v,o,h){const{maxSpeed:p,linearity:m,deceleration:b}=h,M=a.ac(v*m/(o/1e3),-p,p),E=Math.abs(M)/(b*m);return{easing:h.easing,duration:1e3*E,amount:M*(E/2)}}class Tr extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p,m={}){const b=C.mousePos(h.getCanvas(),p),M=h.unproject(b);super(o,a.e({point:b,lngLat:M,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class vo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){const m=o==="touchend"?p.changedTouches:p.touches,b=C.touchPos(h.getCanvasContainer(),m),M=b.map(A=>h.unproject(A)),E=b.reduce((A,F,V,q)=>A.add(F.div(q.length)),new a.P(0,0));super(o,{points:b,point:E,lngLats:M,lngLat:h.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class Lc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class ro{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Lc(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Tr(o.type,this._map,o))}mouseup(o){this._map.fire(new Tr(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Tr(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Tr(o.type,this._map,o))}mouseover(o){this._map.fire(new Tr(o.type,this._map,o))}mouseout(o){this._map.fire(new Tr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new vo(o.type,this._map,o))}touchmove(o){this._map.fire(new vo(o.type,this._map,o))}touchend(o){this._map.fire(new vo(o.type,this._map,o))}touchcancel(o){this._map.fire(new vo(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bo{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Tr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Tr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class oo{constructor(o,h){this._map=o,this._tr=new Os(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const b=Math.min(m.x,p.x),M=Math.max(m.x,p.x),E=Math.min(m.y,p.y),A=Math.max(m.y,p.y);C.setTransform(this._box,`translate(${b}px,${E}px)`),this._box.style.width=M-b+"px",this._box.style.height=A-E+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,m=h;if(this.reset(),C.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.k(o,{originalEvent:h}))}}function hs(v,o){if(v.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${o.length}`);const h={};for(let p=0;p<v.length;p++)h[v[p].identifier]=o[p];return h}class tf{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const M of m)b._add(M);return b.div(m.length)}(h),this.touches=hs(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const m=hs(p,h);for(const b in this.touches){const M=m[b];(!M||M.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ac{constructor(o){this.singleTap=new tf(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const m=this.singleTap.touchend(o,h,p);if(m){const b=o.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(m)<30;if(b&&M||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class nf{constructor(o){this._tr=new Os(o),this._zoomIn=new Ac({numTouches:1,numTaps:2}),this._zoomOut=new Ac({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const m=this._zoomIn.touchend(o,h,p),b=this._zoomOut.touchend(o,h,p),M=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:M.zoom+1,around:M.unproject(m)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:M.zoom-1,around:M.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const h=this._moveFunction(...o);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&C.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ka={0:1,2:2};class wo{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=C.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,p){const m=ka[p];return h.buttons===void 0||(h.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return C.mouseButton(o)===this._eventButton}}class zt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const vl=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=function(o){o.preventDefault()}},$s=({enable:v,clickTolerance:o,bearingDegreesPerPixelMoved:h=.8})=>{const p=new wo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new Ns({clickTolerance:o,move:(m,b)=>({bearingDelta:(b.x-m.x)*h}),moveStateManager:p,enable:v,assignEvents:vl})},js=({enable:v,clickTolerance:o,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new wo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new Ns({clickTolerance:o,move:(m,b)=>({pitchDelta:(b.y-m.y)*h}),moveStateManager:p,enable:v,assignEvents:vl})};class Sh{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._active&&!(p.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const m=hs(p,h),b=new a.P(0,0),M=new a.P(0,0);let E=0;for(const F in m){const V=m[F],q=this._touches[F];q&&(b._add(V),M._add(V.sub(q)),E++,m[F]=V)}if(this._touches=m,E<this.minTouchs()||!M.mag())return;const A=M.div(E);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(E),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Et{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[m,b]=this._firstTwoTouches,M=Us(p,h,m),E=Us(p,h,b);if(!M||!E)return;const A=this._aroundCenter?null:M.add(E).div(2);return this._move([M,E],A,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,M=Us(p,h,m),E=Us(p,h,b);M&&E||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Us(v,o,h){for(let p=0;p<v.length;p++)if(v[p].identifier===h)return o[p]}function Th(v,o){return Math.log(v/o)/Math.LN2}class Ch extends Et{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Th(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Th(this._distance,p),pinchAround:h}}}function bl(v,o){return 180*v.angleWith(o)/Math.PI}class Pc extends Et{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,p){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:bl(this._vector,m),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=bl(o,this._startVector);return Math.abs(p)<h}}function wl(v){return Math.abs(v.y)>Math.abs(v.x)}class Mh extends Et{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,wl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),b=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,b=h.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const M=o.y>0==h.y>0;return wl(o)&&wl(h)&&M}}const rf={panStep:100,bearingStep:15,pitchStep:10};class Xo{constructor(o){this._tr=new Os(o);const h=rf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,m=0,b=0,M=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),M=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:E=>{const A=this._tr;E.easeTo({duration:300,easeId:"keyboardHandler",easing:ln,zoom:h?Math.round(A.zoom)+h*(o.shiftKey?2:1):A.zoom,bearing:A.bearing+p*this._bearingStep,pitch:A.pitch+m*this._pitchStep,offset:[-b*this._panStep,-M*this._panStep],center:A.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ln(v){return v*(2-v)}const Sa=4.000244140625;class xl{constructor(o,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new Os(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Sa==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._map.getCanvas(),o),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Sa?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);const F=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(F*A))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,m=this._easing;let b,M=!1;if(this._type==="wheel"&&p&&m){const E=Math.min((S.now()-this._lastWheelEventTime)/200,1),A=m(E);b=a.z.number(p,h,A),E<1?this._frameId||(this._frameId=!0):M=!0}else b=h,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:b-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),M=.27/Math.sqrt(b*b+1e-4)*.01,E=Math.sqrt(.0729-M*M);h=a.b6(M,E,.25,1)}return this._prevEase={start:S.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zc{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Eh{constructor(o){this._tr=new Os(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ih{constructor(){this._tap=new Ac({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],b=o.timeStamp-this._tapTime<500,M=this._tapPoint.dist(m)<30;b&&M?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,h,p)}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(o,h,p);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lh{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class so{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ta{constructor(o,h,p,m){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zt{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Kt=v=>v.zoom||v.drag||v.pitch||v.rotate;class kl extends a.k{}function Ca(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Dc{constructor(o,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const M=m.type==="renderFrame"?void 0:m,E={needsRenderFrame:!1},A={},F={},V=m.touches,q=V?this._getMapTouches(V):void 0,Q=q?C.touchPos(this._map.getCanvas(),q):C.mousePos(this._map.getCanvas(),m);for(const{handlerName:_e,handler:ue,allowed:Ie}of this._handlers){if(!ue.isEnabled())continue;let Ze;this._blockedByActive(F,Ie,_e)?ue.reset():ue[b||m.type]&&(Ze=ue[b||m.type](m,Q,q),this.mergeHandlerResult(E,A,Ze,_e,M),Ze&&Ze.needsRenderFrame&&this._triggerRenderFrame()),(Ze||ue.isActive())&&(F[_e]=ue)}const pe={};for(const _e in this._previousActiveHandlers)F[_e]||(pe[_e]=M);this._previousActiveHandlers=F,(Object.keys(pe).length||Ca(E))&&(this._changes.push([E,A,pe]),this._triggerRenderFrame()),(Object.keys(F).length||Ca(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=E;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kh(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,M]of this._listeners)C.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[o,h,p]of this._listeners)C.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new ro(h,o));const m=h.boxZoom=new oo(h,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const b=h.cooperativeGestures=new Zt(h,o.cooperativeGestures);this._add("cooperativeGestures",b),o.cooperativeGestures&&b.enable();const M=new nf(h),E=new Eh(h);h.doubleClickZoom=new zc(E,M),this._add("tapZoom",M),this._add("clickZoom",E),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const A=new Ih;this._add("tapDragZoom",A);const F=h.touchPitch=new Mh(h);this._add("touchPitch",F),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const V=$s(o),q=js(o);h.dragRotate=new so(o,V,q),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const Q=(({enable:Ze,clickTolerance:be})=>{const Re=new wo({checkCorrectEvent:We=>C.mouseButton(We)===0&&!We.ctrlKey});return new Ns({clickTolerance:be,move:(We,He)=>({around:He,panDelta:He.sub(We)}),activateOnStart:!0,moveStateManager:Re,enable:Ze,assignEvents:vl})})(o),pe=new Sh(o,h);h.dragPan=new Lh(p,Q,pe),this._add("mousePan",Q),this._add("touchPan",pe,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const fe=new Pc,_e=new Ch;h.touchZoomRotate=new Ta(p,_e,fe,A),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const ue=h.scrollZoom=new xl(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ue,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const Ie=h.keyboard=new Xo(h);this._add("keyboard",Ie),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new bo(h))}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Kt(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const m in o)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(o,h,p,m,b){if(!p)return;a.e(o,p);const M={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(h.zoom=M),p.panDelta!==void 0&&(h.drag=M),p.pitchDelta!==void 0&&(h.pitch=M),p.bearingDelta!==void 0&&(h.rotate=M)}_applyChanges(){const o={},h={},p={};for(const[m,b,M]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),a.e(h,b),a.e(p,M);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const m=this._map,b=m._getTransformForUpdate(),M=m.terrain;if(!(Ca(o)||M&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:E,zoomDelta:A,bearingDelta:F,pitchDelta:V,around:q,pinchAround:Q}=o;Q!==void 0&&(q=Q),m._stop(!0),q=q||m.transform.centerPoint;const pe=b.pointLocation(E?q.sub(E):q);F&&(b.bearing+=F),V&&(b.pitch+=V),A&&(b.zoom+=A),M?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(E)):b.setLocationAtPoint(pe,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(pe,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(m.terrain)})):b.setLocationAtPoint(pe,q),m._applyUpdatedTransform(b),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const m=Kt(this._eventsInProgress),b=Kt(o),M={};for(const V in o){const{originalEvent:q}=o[V];this._eventsInProgress[V]||(M[`${V}start`]=q),this._eventsInProgress[V]=o[V]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const V in M)this._fireEvent(V,M[V]);b&&this._fireEvent("move",b.originalEvent);for(const V in o){const{originalEvent:q}=o[V];this._fireEvent(V,q)}const E={};let A;for(const V in this._eventsInProgress){const{handlerName:q,originalEvent:Q}=this._eventsInProgress[V];this._handlersById[q].isActive()||(delete this._eventsInProgress[V],A=h[q]||Q,E[`${V}end`]=A)}for(const V in E)this._fireEvent(V,E[V]);const F=Kt(this._eventsInProgress);if(p&&(m||b)&&!F){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;!V||!V.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:A})),q(this._map.getBearing())&&this._map.resetNorth()):(q(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new kl("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Cr extends a.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},h),p)}panTo(o,h,p){return this.easeTo(a.e({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(a.e({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(a.e({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,a.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=Ne.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const vt=m.padding;m.padding={top:vt,bottom:vt,right:vt,left:vt}}m.padding=a.e(b,m.padding);const M=this.transform,E=M.padding,A=new Ne(o,h),F=M.project(A.getNorthWest()),V=M.project(A.getNorthEast()),q=M.project(A.getSouthEast()),Q=M.project(A.getSouthWest()),pe=a.b8(-p),fe=F.rotate(pe),_e=V.rotate(pe),ue=q.rotate(pe),Ie=Q.rotate(pe),Ze=new a.P(Math.max(fe.x,_e.x,Ie.x,ue.x),Math.max(fe.y,_e.y,Ie.y,ue.y)),be=new a.P(Math.min(fe.x,_e.x,Ie.x,ue.x),Math.min(fe.y,_e.y,Ie.y,ue.y)),Re=Ze.sub(be),We=(M.width-(E.left+E.right+m.padding.left+m.padding.right))/Re.x,He=(M.height-(E.top+E.bottom+m.padding.top+m.padding.bottom))/Re.y;if(He<0||We<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(M.scaleZoom(M.scale*Math.min(We,He)),m.maxZoom),ot=a.P.convert(m.offset),it=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),gt=ot.add(it).mult(M.scale/M.zoomScale(Xe));return{center:M.unproject(F.add(q).div(2).sub(gt)),zoom:Xe,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(h)),p,m),m,b)}_fitInternal(o,h,p){return o?(delete(h=a.e(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,M=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(m=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=a.M.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(b=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(M=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),b&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),M&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(o,h,p,m=0){const b=a.Y.fromLngLat(o,h),M=a.Y.fromLngLat(p,m),E=M.x-b.x,A=M.y-b.y,F=M.z-b.z,V=Math.hypot(E,A,F);if(V===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(E,A),Q=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),pe=180*Math.atan2(E,-A)/Math.PI;let fe=180*Math.acos(q/V)/Math.PI;return fe=F<0?90-fe:90+fe,{center:M.toLngLat(),zoom:Q,pitch:fe,bearing:pe}}easeTo(o,h){var p;this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.b7},o)).animate===!1||!o.essential&&S.prefersReducedMotion)&&(o.duration=0);const m=this._getTransformForUpdate(),b=this.getZoom(),M=this.getBearing(),E=this.getPitch(),A=this.getPadding(),F="bearing"in o?this._normalizeBearing(o.bearing,M):M,V="pitch"in o?+o.pitch:E,q="padding"in o?o.padding:m.padding,Q=a.P.convert(o.offset);let pe=m.centerPoint.add(Q);const fe=m.pointLocation(pe),{center:_e,zoom:ue}=m.getConstrained(a.M.convert(o.center||fe),(p=o.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ie=m.project(fe),Ze=m.project(_e).sub(Ie),be=m.zoomScale(ue-b);let Re,We;o.around&&(Re=a.M.convert(o.around),We=m.locationPoint(Re));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ue!==b,this._rotating=this._rotating||M!==F,this._pitching=this._pitching||V!==E,this._padding=!m.isPaddingEqual(q),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,He),this.terrain&&this._prepareElevation(_e),this._ease(Xe=>{if(this._zooming&&(m.zoom=a.z.number(b,ue,Xe)),this._rotating&&(m.bearing=a.z.number(M,F,Xe)),this._pitching&&(m.pitch=a.z.number(E,V,Xe)),this._padding&&(m.interpolatePadding(A,q,Xe),pe=m.centerPoint.add(Q)),this.terrain&&!o.freezeElevation&&this._updateElevation(Xe),Re)m.setLocationAtPoint(Re,We);else{const ot=m.zoomScale(m.zoom-b),it=ue>b?Math.min(2,be):Math.max(.5,be),gt=Math.pow(it,1-Xe),vt=m.unproject(Ie.add(Ze.mult(Xe*gt)).mult(ot));m.setLocationAtPoint(m.renderWorldCopies?vt.wrap():vt,pe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Xe)},o),this}_prepareEase(o,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",o)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(h-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const h=o.clone(),{center:p,zoom:m,pitch:b,bearing:M,elevation:E}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),b!==void 0&&(h.pitch=b),M!==void 0&&(h.bearing=M),E!==void 0&&(h.elevation=E),this.transform.apply(h)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",o)),m&&this.fire(new a.k("rotateend",o)),b&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,h){var p;if(!o.essential&&S.prefersReducedMotion){const Ci=a.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ci,h)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},o);const m=this._getTransformForUpdate(),b=this.getZoom(),M=this.getBearing(),E=this.getPitch(),A=this.getPadding(),F="bearing"in o?this._normalizeBearing(o.bearing,M):M,V="pitch"in o?+o.pitch:E,q="padding"in o?o.padding:m.padding,Q=a.P.convert(o.offset);let pe=m.centerPoint.add(Q);const fe=m.pointLocation(pe),{center:_e,zoom:ue}=m.getConstrained(a.M.convert(o.center||fe),(p=o.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ie=m.zoomScale(ue-b),Ze=m.project(fe),be=m.project(_e).sub(Ze);let Re=o.curve;const We=Math.max(m.width,m.height),He=We/Ie,Xe=be.mag();if("minZoom"in o){const Ci=a.ac(Math.min(o.minZoom,b,ue),m.minZoom,m.maxZoom),ri=We/m.zoomScale(Ci-b);Re=Math.sqrt(ri/Xe*2)}const ot=Re*Re;function it(Ci){const ri=(He*He-We*We+(Ci?-1:1)*ot*ot*Xe*Xe)/(2*(Ci?He:We)*ot*Xe);return Math.log(Math.sqrt(ri*ri+1)-ri)}function gt(Ci){return(Math.exp(Ci)-Math.exp(-Ci))/2}function vt(Ci){return(Math.exp(Ci)+Math.exp(-Ci))/2}const ci=it(!1);let xt=function(Ci){return vt(ci)/vt(ci+Re*Ci)},ei=function(Ci){return We*((vt(ci)*(gt(ri=ci+Re*Ci)/vt(ri))-gt(ci))/ot)/Xe;var ri},ui=(it(!0)-ci)/Re;if(Math.abs(Xe)<1e-6||!isFinite(ui)){if(Math.abs(We-He)<1e-6)return this.easeTo(o,h);const Ci=He<We?-1:1;ui=Math.abs(Math.log(He/We))/Re,ei=function(){return 0},xt=function(ri){return Math.exp(Ci*Re*ri)}}return o.duration="duration"in o?+o.duration:1e3*ui/("screenSpeed"in o?+o.screenSpeed/Re:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=M!==F,this._pitching=V!==E,this._padding=!m.isPaddingEqual(q),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(_e),this._ease(Ci=>{const ri=Ci*ui,fi=1/xt(ri);m.zoom=Ci===1?ue:b+m.scaleZoom(fi),this._rotating&&(m.bearing=a.z.number(M,F,Ci)),this._pitching&&(m.pitch=a.z.number(E,V,Ci)),this._padding&&(m.interpolatePadding(A,q,Ci),pe=m.centerPoint.add(Q)),this.terrain&&!o.freezeElevation&&this._updateElevation(Ci);const yi=Ci===1?_e:m.unproject(Ze.add(be.mult(ei(ri))).mult(fi));m.setLocationAtPoint(m.renderWorldCopies?yi.wrap():yi,pe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=a.b1(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Rc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ao{constructor(o=Rc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const b=h[m];if(b.used||b.usedForTerrain){const M=b.getSource();M.attribution&&o.indexOf(M.attribution)<0&&o.push(M.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,b)=>m.length-b.length),o=o.filter((m,b)=>{for(let M=b+1;M<o.length;M++)if(o[M].indexOf(m)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ah{constructor(o={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const h=C.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ma{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var bn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class An extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const p={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Li(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(o){for(const h in this._tiles){const p=this._tiles[h];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),h[p]=b}else if(m.canonical.isChildOf(o.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const M=m.canonical.z-o.canonical.z,E=m.canonical.x-(m.canonical.x>>M<<M),A=m.canonical.y-(m.canonical.y>>M<<M),F=a.W>>M;a.aN(b.posMatrix,0,F,0,F,0,1),a.H(b.posMatrix,b.posMatrix,[-E*F,-A*F,0]),h[p]=b}else if(o.canonical.isChildOf(m.canonical)){const b=o.clone();b.posMatrix=new Float64Array(16);const M=o.canonical.z-m.canonical.z,E=o.canonical.x-(o.canonical.x>>M<<M),A=o.canonical.y-(o.canonical.y>>M<<M),F=a.W>>M;a.aN(b.posMatrix,0,a.W,0,a.W,0,1),a.H(b.posMatrix,b.posMatrix,[E*F,A*F,0]),a.J(b.posMatrix,b.posMatrix,[1/2**M,1/2**M,0]),h[p]=b}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!b||!b.dem)&&h)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(o.scaledTo(m--).key);return b}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class Ph{constructor(o,h,p){this.painter=o,this.sourceCache=new An(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,p,m=a.W){var b;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const M=this.getTerrainData(o),E=(b=M.tile)===null||b===void 0?void 0:b.dem;if(!E)return 0;const A=function(fe,_e,ue){var Ie=_e[0],Ze=_e[1];return fe[0]=ue[0]*Ie+ue[4]*Ze+ue[12],fe[1]=ue[1]*Ie+ue[5]*Ze+ue[13],fe}([],[h/m*a.W,p/m*a.W],M.u_terrain_matrix),F=[A[0]*E.dim,A[1]*E.dim],V=Math.floor(F[0]),q=Math.floor(F[1]),Q=F[0]-V,pe=F[1]-q;return E.get(V,q)*(1-Q)*(1-pe)+E.get(V+1,q)*Q*(1-pe)+E.get(V,q+1)*(1-Q)*pe+E.get(V+1,q+1)*Q*pe}getElevationForLngLatZoom(o,h){const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(p,m%a.W,b%a.W,a.W)}getElevation(o,h,p,m=a.W){return this.getDEMElevation(o,h,p,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new oe(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new oe(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new oe(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?b=o.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const M=o.canonical.x-(o.canonical.x>>b<<b),E=o.canonical.y-(o.canonical.y>>b<<b),A=a.b9(new Float64Array(16),[1/(a.W<<b),1/(a.W<<b),0]);a.H(A,A,[M*a.W,E*a.W,0]),this._demMatrixCache[o.key]={matrix:A,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new oe(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new oe(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,M=0;b<this._coordsTextureSize;b++)for(let E=0;E<this._coordsTextureSize;E++,M+=4)h[M+0]=255&E,h[M+1]=255&b,h[M+2]=E>>8<<4|b>>8,h[M+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new oe(o,p,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),M=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),E=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,E-M-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const A=h[0]+(h[2]>>4<<8),F=h[1]+((15&h[2])<<8),V=this.coordsIndex[255-h[3]],q=V&&this.sourceCache.getTileByID(V);if(!q)return null;const Q=this._coordsTextureSize,pe=(1<<q.tileID.canonical.z)*Q;return new a.Y((q.tileID.canonical.x*Q+A)/pe+q.tileID.wrap,(q.tileID.canonical.y*Q+F)/pe,this.getElevation(q.tileID,A,F,Q))}depthAtPoint(o){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,b=a.W/m,M=m*m;for(let q=0;q<=m;q++)for(let Q=0;Q<=m;Q++)h.emplaceBack(Q*b,q*b,0);for(let q=0;q<M;q+=m+1)for(let Q=0;Q<m;Q++)p.emplaceBack(Q+q,m+Q+q+1,m+Q+q+2),p.emplaceBack(Q+q,m+Q+q+2,Q+q+1);const E=h.length,A=E+2*(m+1);for(const q of[0,1])for(let Q=0;Q<=m;Q++)for(const pe of[0,1])h.emplaceBack(Q*b,q*a.W,pe);for(let q=0;q<2*m;q+=2)p.emplaceBack(A+q,A+q+1,A+q+3),p.emplaceBack(A+q,A+q+3,A+q+2),p.emplaceBack(E+q,E+q+3,E+q+1),p.emplaceBack(E+q,E+q+2,E+q+3);const F=h.length,V=F+2*(m+1);for(const q of[0,1])for(let Q=0;Q<=m;Q++)for(const pe of[0,1])h.emplaceBack(q*a.W,Q*b,pe);for(let q=0;q<2*m;q+=2)p.emplaceBack(F+q,F+q+1,F+q+3),p.emplaceBack(F+q,F+q+3,F+q+2),p.emplaceBack(V+q,V+q+3,V+q+1),p.emplaceBack(V+q,V+q+2,V+q+3);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,bn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,h){const p=a.Y.fromLngLat(o.wrap()),m=(1<<h)*a.W,b=p.x*m,M=p.y*m,E=Math.floor(b/a.W),A=Math.floor(M/a.W);return{tileID:new a.Q(h,0,h,E,A),mercatorX:b,mercatorY:M}}}class Ea{constructor(o,h,p){this._context=o,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new oe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:o,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const zo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Bc{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new Ea(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const m=o.sourceCaches[p].getVisibleCoordinates();for(const b of m){const M=this.terrain.sourceCache.getTerrainCoords(b);for(const E in M)this._coordsDescendingInv[p][E]||(this._coordsDescendingInv[p][E]=[]),this._coordsDescendingInv[p][E].push(M[E])}}this._coordsDescendingInvStr={};for(const p of o._order){const m=o._layers[p],b=m.source;if(zo[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const M in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][M]=this._coordsDescendingInv[b][M].map(E=>E.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(zo[h]&&(this._prevType&&zo[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(zo[this._prevType]||zo[h]&&m){this._prevType=h;const b=this._stacks.length-1,M=this._stacks[b]||[];for(const E of this._renderableTiles){if(this.pool.isFull()&&(_l(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(E),E.rtt[b]){const F=this.pool.getObjectForId(E.rtt[b].id);if(F.stamp===E.rtt[b].stamp){this.pool.useObject(F);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),E.rtt[b]={id:A.id,stamp:A.stamp},p.context.bindFramebuffer.set(A.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let F=0;F<M.length;F++){const V=p.style._layers[M[F]],q=V.source?this._coordsDescendingInv[V.source][E.tileID.key]:[E.tileID];p.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),p._renderTileClippingMasks(V,q),p.renderLayer(p,p.style.sourceCaches[V.source],V,q),V.source&&(E.rttCoords[V.source]=this._coordsDescendingInvStr[V.source][E.tileID.key])}}return _l(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),zo[h]}return!1}}const Fc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Oc=_,Ia={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Rc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Sl=v=>{v.touchstart=v.dragStart,v.touchmoveWindow=v.dragMove,v.touchend=v.dragEnd},Nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class $c{constructor(o,h,p=!1){this.mousedown=M=>{this.startMouse(a.e({},M,{ctrlKey:!0,preventDefault:()=>M.preventDefault()}),C.mousePos(this.element,M)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=M=>{this.moveMouse(M,C.mousePos(this.element,M))},this.mouseup=M=>{this.mouseRotate.dragEnd(M),this.mousePitch&&this.mousePitch.dragEnd(M),this.offTemp()},this.touchstart=M=>{M.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,M.targetTouches)[0],this.startTouch(M,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=M=>{M.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,M.targetTouches)[0],this.moveTouch(M,this._lastPos))},this.touchend=M=>{M.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),b=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=$s({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:M,clickTolerance:E,bearingDegreesPerPixelMoved:A=.8})=>{const F=new zt;return new Ns({clickTolerance:E,move:(V,q)=>({bearingDelta:(q.x-V.x)*A}),moveStateManager:F,enable:M,assignEvents:Sl})})({clickTolerance:m,enable:!0}),this.map=o,p&&(this.mousePitch=js({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:M,clickTolerance:E,pitchDegreesPerPixelMoved:A=-.5})=>{const F=new zt;return new Ns({clickTolerance:E,move:(V,q)=>({pitchDelta:(q.y-V.y)*A}),moveStateManager:F,enable:M,assignEvents:Sl})})({clickTolerance:b,enable:!0})),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),C.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),C.disableDrag()}moveMouse(o,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(o,h)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(o,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(o,h)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const o=this.element;C.removeEventListener(o,"mousedown",this.mousedown),C.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Do;function Tl(v,o,h){const p=new a.M(v.lng,v.lat);if(v=new a.M(v.lng,v.lat),o){const m=new a.M(v.lng-360,v.lat),b=new a.M(v.lng+360,v.lat),M=h.locationPoint(v).distSqr(o);h.locationPoint(m).distSqr(o)<M?v=m:h.locationPoint(b).distSqr(o)<M&&(v=b)}for(;Math.abs(v.lng-h.center.lng)>180;){const m=h.locationPoint(v);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;v.lng>h.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&h.locationPoint(v).y>h.height/2-h.getHorizon()?v:p}const La={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Cl(v,o,h){const p=v.classList;for(const m in La)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${o}`)}class Aa extends a.E{constructor(o){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Tl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let M="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?M="rotateX(0deg)":this._pitchAlignment==="map"&&(M=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${La[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${M} ${b}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const h=C.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=C.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const M=C.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of A){const Ze=C.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",Ie.rx),Ze.setAttributeNS(null,"ry",Ie.ry),E.appendChild(Ze)}const F=C.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const V=C.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(V);const q=C.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const Q=C.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(Q);const pe=C.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const fe=C.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=C.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const ue=C.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#FFFFFF"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962"),fe.appendChild(_e),fe.appendChild(ue),M.appendChild(E),M.appendChild(F),M.appendChild(q),M.appendChild(pe),M.appendChild(fe),h.appendChild(M),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Cl(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),M=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,M)-b<.006)return void(this._element.style.opacity=this._opacity);const E=-this._offset.y/m.transform._pixelPerMeter,A=Math.sin(m.getPitch()*Math.PI/180)*E,F=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),V=m.transform.lngLatToCameraDepth(this._lngLat,M+A)-F>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Ml={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vs=0,ds=!1;const El={maxWidth:100,unit:"metric"};function Il(v,o,h){const p=h&&h.maxWidth||100,m=v._container.clientHeight/2,b=v.unproject([0,m]),M=v.unproject([p,m]),E=b.distanceTo(M);if(h&&h.unit==="imperial"){const A=3.2808*E;A>5280?fs(o,p,A/5280,v._getUIString("ScaleControl.Miles")):fs(o,p,A,v._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?fs(o,p,E/1852,v._getUIString("ScaleControl.NauticalMiles")):E>=1e3?fs(o,p,E/1e3,v._getUIString("ScaleControl.Kilometers")):fs(o,p,E,v._getUIString("ScaleControl.Meters"))}function fs(v,o,h,p){const m=function(b){const M=Math.pow(10,`${Math.floor(b)}`.length-1);let E=b/M;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(A){const F=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*F)/F}(E),M*E}(h);v.style.width=o*(m/h)+"px",v.innerHTML=`${m}&nbsp;${p}`}const jc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ll(v){if(v){if(typeof v=="number"){const o=Math.round(Math.abs(v)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,v),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-v),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(v,0),right:new a.P(-v,0)}}if(v instanceof a.P||Array.isArray(v)){const o=a.P.convert(v);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(v.center||[0,0]),top:a.P.convert(v.top||[0,0]),"top-left":a.P.convert(v["top-left"]||[0,0]),"top-right":a.P.convert(v["top-right"]||[0,0]),bottom:a.P.convert(v.bottom||[0,0]),"bottom-left":a.P.convert(v["bottom-left"]||[0,0]),"bottom-right":a.P.convert(v["bottom-right"]||[0,0]),left:a.P.convert(v.left||[0,0]),right:a.P.convert(v.right||[0,0])}}return Ll(new a.P(0,0))}const zh=_;d.AJAXError=a.be,d.Evented=a.E,d.LngLat=a.M,d.MercatorCoordinate=a.Y,d.Point=a.P,d.addProtocol=a.bf,d.config=a.a,d.removeProtocol=a.bg,d.AttributionControl=ao,d.BoxZoomHandler=oo,d.CanvasSource=wi,d.CooperativeGesturesHandler=Zt,d.DoubleClickZoomHandler=zc,d.DragPanHandler=Lh,d.DragRotateHandler=so,d.EdgeInsets=Fs,d.FullscreenControl=class extends a.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=qe,d.GeolocateControl=class extends a.E{constructor(v){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new a.M(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),M=Ne.fromLngLat(h,p);this._map.fitBounds(M,b,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new a.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&ds)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Aa({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Aa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Ml,v)}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(o=!1){if(Do!==void 0&&!o)return Do;if(window.navigator.permissions===void 0)return Do=!!window.navigator.geolocation,Do;try{Do=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Do=!!window.navigator.geolocation}return Do})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Vs=0,ds=!1}_isOutOfMapMaxBounds(v){const o=this._map.getMaxBounds(),h=v.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const v=this._map.getBounds(),o=v.getSouthEast(),h=v.getNorthEast(),p=o.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Vs--,ds=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Vs++,Vs>1?(v={maximumAge:6e5,timeout:0},ds=!0):(v=this.options.positionOptions,ds=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=Ic,d.ImageSource=Vt,d.KeyboardHandler=Xo,d.LngLatBounds=Ne,d.LogoControl=Ah,d.Map=class extends Cr{constructor(v){if(a.bc.mark(a.bd.create),(v=a.e({},Ia,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new yl(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),{bearingSnap:v.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=v.interactive,this._maxTileCacheSize=v.maxTileCacheSize,this._maxTileCacheZoomLevels=v.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new Ma,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Fc,v.locale),this._clickTolerance=v.clickTolerance,this._overridePixelRatio=v.pixelRatio,this._maxCanvasSize=v.maxCanvasSize,this.transformCameraUpdate=v.transformCameraUpdate,this._imageQueueHandle=$.addThrottleControl(()=>this.isMoving()),this._requestManager=new j(v.transformRequest),typeof v.container=="string"){if(this._container=document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const h=Ec(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{o?h(p):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Dc(this,v),this._hash=v.hash&&new Ic(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,a.e({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,this._validateStyle=v.validateStyle,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new ao(typeof v.attributionControl=="boolean"?void 0:v.attributionControl)),v.maplibreLogo&&this.addControl(new Ah,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new a.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(v,o){if(o===void 0&&(o=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=v.onAdd(this);this._controls.push(v);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(v);return o>-1&&this._controls.splice(o,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}calculateCameraOptionsFromTo(v,o,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,o,h,p)}resize(v){var o;const h=this._containerDimensions(),p=h[0],m=h[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const A=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,A),this.painter.resize(p,m,A)}this.transform.resize(p,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(p,m);const M=!this._moving;return M&&(this.stop(),this.fire(new a.k("movestart",v)).fire(new a.k("move",v))),this.fire(new a.k("resize",v)),M&&this.fire(new a.k("moveend",v)),this}_getClampedPixelRatio(v,o){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=v*m,M=o*m;return Math.min(b>h?h/b:1,M>p?p/M:1)*m}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Ne.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this._update()}project(v){return this.transform.locationPoint(a.M.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.pointLocation(a.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,o,h){if(v==="mouseenter"||v==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:b=>{const M=this.getLayer(o)?this.queryRenderedFeatures(b.point,{layers:[o]}):[];M.length?p||(p=!0,h.call(this,new Tr(v,this,b.originalEvent,{features:M}))):p=!1},mouseout:()=>{p=!1}}}}if(v==="mouseleave"||v==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:M=>{(this.getLayer(o)?this.queryRenderedFeatures(M.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new Tr(v,this,M.originalEvent)))},mouseout:M=>{p&&(p=!1,h.call(this,new Tr(v,this,M.originalEvent)))}}}}{const p=m=>{const b=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];b.length&&(m.features=b,h.call(this,m),delete m.features)};return{layer:o,listener:h,delegates:{[v]:p}}}}on(v,o,h){if(h===void 0)return super.on(v,o);const p=this._createDelegatedListener(v,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(v,o,h){if(h===void 0)return super.once(v,o);const p=this._createDelegatedListener(v,o,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(v,o,h){return h===void 0?super.off(v,o):(this._delegatedListeners&&this._delegatedListeners[v]&&(p=>{const m=this._delegatedListeners[v];for(let b=0;b<m.length;b++){const M=m[b];if(M.layer===o&&M.listener===h){for(const E in M.delegates)this.off(E,M.delegates[E]);return m.splice(b,1),this}}})(),this)}queryRenderedFeatures(v,o){if(!this.style)return[];let h;const p=v instanceof a.P||Array.isArray(v),m=p?v:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:v)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const b=a.P.convert(m[0]),M=a.P.convert(m[1]);h=[b,new a.P(M.x,b.y),M,new a.P(b.x,M.y),b]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(v,o){return this.style.querySourceFeatures(v,o)}setStyle(v,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(v,o))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const o=this._locale[v];if(o==null)throw new Error(`Missing UI string '${v}'`);return o}_updateStyle(v,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new Fr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,o,h):this.style.loadJSON(v,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,o){if(typeof v=="string"){const h=this._requestManager.transformRequest(v,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,o)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof v=="object"&&this._updateDiff(v,o)}_updateDiff(v,o){try{this.style.setState(v,o)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(v,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(v,o){return this._lazyInitEmptyStyle(),this.style.addSource(v,o),this._update(!0)}isSourceLoaded(v){const o=this.style&&this.style.sourceCaches[v];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const o=this.style.sourceCaches[v.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===v.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ph(this.painter,o,v),this.painter.renderToTexture=new Bc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==v.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:v})),this}getTerrain(){var v,o;return(o=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const o in v){const h=v[o]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,o,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:M,content:E}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:F,data:V}=o,q=o;return this.style.addImage(v,{data:new a.R({width:A,height:F},new Uint8Array(V)),pixelRatio:p,stretchX:b,stretchY:M,content:E,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,v),this}}{const{width:A,height:F,data:V}=S.getImageData(o);this.style.addImage(v,{data:new a.R({width:A,height:F},V),pixelRatio:p,stretchX:b,stretchY:M,content:E,sdf:m,version:0})}}updateImage(v,o){const h=this.style.getImage(v);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||a.b(o)?S.getImageData(o):o,{width:m,height:b,data:M}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||b!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const E=!(o instanceof HTMLImageElement||a.b(o));return h.data.replace(M,E),this.style.updateImage(v,h),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return $.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,o){return this._lazyInitEmptyStyle(),this.style.addLayer(v,o),this._update(!0)}moveLayer(v,o){return this.style.moveLayer(v,o),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,o,h){return this.style.setLayerZoomRange(v,o,h),this._update(!0)}setFilter(v,o,h={}){return this.style.setFilter(v,o,h),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,o,h,p={}){return this.style.setPaintProperty(v,o,h,p),this._update(!0)}getPaintProperty(v,o){return this.style.getPaintProperty(v,o)}setLayoutProperty(v,o,h,p={}){return this.style.setLayoutProperty(v,o,h,p),this._update(!0)}getLayoutProperty(v,o){return this.style.getLayoutProperty(v,o)}setGlyphs(v,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,o,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,o,h,p=>{p||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,o,h=>{h||this._update(!0)}),this}setLight(v,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(v,o){return this.style.setFeatureState(v,o),this._update()}removeFeatureState(v,o){return this.style.removeFeatureState(v,o),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,o=0;return this._container&&(v=this._container.clientWidth||400,o=this._container.clientHeight||300),[v,o]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const o=this._canvasContainer=C.create("div","maplibregl-canvas-container",v);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=C.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{b[M]=C.create("div",`maplibregl-ctrl-${M} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,o,h){this._canvas.width=Math.floor(h*v),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const v={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:v},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v);if(!h){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new vh(h,this.transform),L.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=S.now();this.style.zoomHistory.update(m,b);const M=new a.a8(m,{now:b,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),E=M.crossFadingFactor();E===1&&E===this._crossFadingFactor||(h=!0,this._crossFadingFactor=E),this.style.update(M)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(v=>{a.bc.frame(v),this._frameRequest=null,this._render(v)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Oc}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=Tr,d.MapTouchEvent=vo,d.MapWheelEvent=Lc,d.Marker=Aa,d.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);o.title=p,o.setAttribute("aria-label",p)},this.options=a.e({},Nc,v),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $c(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,o){const h=C.create("button",v,this._container);return h.type="button",h.addEventListener("click",o),h}},d.Popup=class extends a.E{constructor(v){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Tl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const p=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=Ll(this.options.offset);if(!m){const E=this._container.offsetWidth,A=this._container.offsetHeight;let F;F=p.y+b.bottom.y<A?["top"]:p.y>this._map.transform.height-A?["bottom"]:[],p.x<E/2?F.push("left"):p.x>this._map.transform.width-E/2&&F.push("right"),m=F.length===0?"bottom":F.join("-")}let M=p.add(b[m]);this.options.subpixelPositioning||(M=M.round()),C.setTransform(this._container,`${La[m]} translate(${M.x}px,${M.y}px)`),Cl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(jc),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=a.M.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=v;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){this._container&&this._container.classList.add(v)}removeClassName(v){this._container&&this._container.classList.remove(v)}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Uc);v&&v.focus()}},d.RasterDEMTileSource=Ii,d.RasterTileSource=we,d.ScaleControl=class{constructor(v){this._onMove=()=>{Il(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Il(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},El),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=xl,d.Style=Fr,d.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Mh,d.TwoFingersTouchRotateHandler=Pc,d.TwoFingersTouchZoomHandler=Ch,d.TwoFingersTouchZoomRotateHandler=Ta,d.VectorTileSource=bt,d.VideoSource=Pi,d.addSourceType=(v,o)=>a._(void 0,void 0,void 0,function*(){if(In(v))throw new Error(`A source type called "${v}" already exists.`);((h,p)=>{gn[h]=p})(v,o)}),d.clearPrewarmedResources=function(){const v=Rt;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(mt),Rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return rt().getRTLTextPluginStatus()},d.getVersion=function(){return zh},d.getWorkerCount=function(){return ti.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(v){return Ei().broadcast("IS",v)},d.prewarm=function(){Jt().acquire(mt)},d.setMaxParallelImageRequests=function(v){a.a.MAX_PARALLEL_IMAGE_REQUESTS=v},d.setRTLTextPlugin=function(v,o){return rt().setRTLTextPlugin(v,o)},d.setWorkerCount=function(v){ti.workerCount=v},d.setWorkerUrl=function(v){a.a.WORKER_URL=v}});var u=t;return u})})(u0);var Cs=u0.exports;const to=c0(Cs),zb=lb({__proto__:null,default:to},[Cs]);let Gt;const d0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&d0.decode();let yu=null;function Cu(){return(yu===null||yu.byteLength===0)&&(yu=new Uint8Array(Gt.memory.buffer)),yu}function Mo(r,e){return r=r>>>0,d0.decode(Cu().subarray(r,r+e))}const xs=new Array(128).fill(void 0);xs.push(void 0,null,!0,!1);let Mu=xs.length;function Un(r){Mu===xs.length&&xs.push(xs.length+1);const e=Mu;return Mu=xs[e],xs[e]=r,e}function Mi(r){return xs[r]}function Db(r){r<132||(xs[r]=Mu,Mu=r)}function Kl(r){const e=Mi(r);return Db(r),e}function Wf(r){return r==null}let vu=null;function Rb(){return(vu===null||vu.byteLength===0)&&(vu=new Float64Array(Gt.memory.buffer)),vu}let bu=null;function Di(){return(bu===null||bu.byteLength===0)&&(bu=new Int32Array(Gt.memory.buffer)),bu}let Js=0;const ld=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Bb=typeof ld.encodeInto=="function"?function(r,e){return ld.encodeInto(r,e)}:function(r,e){const t=ld.encode(r);return e.set(t),{read:r.length,written:t.length}};function nd(r,e,t){if(t===void 0){const a=ld.encode(r),_=e(a.length,1)>>>0;return Cu().subarray(_,_+a.length).set(a),Js=a.length,_}let i=r.length,l=e(i,1)>>>0;const u=Cu();let d=0;for(;d<i;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==i){d!==0&&(r=r.slice(d)),l=t(l,i,i=d+r.length*3,1)>>>0;const a=Cu().subarray(l+d,l+i),_=Bb(r,a);d+=_.written}return Js=d,l}function sp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=sp(r[0]));for(let d=1;d<l;d++)u+=", "+sp(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let i;if(t.length>1)i=t[1];else return toString.call(r);if(i=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:i}function Fb(r,e){const t=e(r.length*1,1)>>>0;return Cu().set(r,t/1),Js=r.length,t}function Hf(r,e){try{return r.apply(this,e)}catch(t){Gt.__wbindgen_exn_store(Un(t))}}class vd{static __wrap(e){e=e>>>0;const t=Object.create(vd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Gt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=Gt.__wbindgen_add_to_stack_pointer(-16),d=Fb(e,Gt.__wbindgen_malloc),a=Js;Gt.jsroutesnapper_new(u,d,a);var t=Di()[u/4+0],i=Di()[u/4+1],l=Di()[u/4+2];if(l)throw Kl(i);return vd.__wrap(t)}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Gt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Un(e))}setAreaMode(){Gt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var i=Di()[u/4+0],l=Di()[u/4+1];return e=i,t=l,Mo(i,l)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const i=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_toFinalFeature(i,this.__wbg_ptr);var e=Di()[i/4+0],t=Di()[i/4+1];let l;return e!==0&&(l=Mo(e,t).slice(),Gt.__wbindgen_free(e,t*1)),l}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var i=Di()[u/4+0],l=Di()[u/4+1];return e=i,t=l,Mo(i,l)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,t,1)}}toggleSnapMode(){Gt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,i){return Gt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,i)!==0}onClick(){Gt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Gt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Gt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Gt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Un(e));var t=Di()[l/4+0],i=Di()[l/4+1];if(i)throw Kl(t)}finally{Gt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var i=Di()[u/4+0],l=Di()[u/4+1];return e=i,t=l,Mo(i,l)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var i=Di()[u/4+0],l=Di()[u/4+1];return e=i,t=l,Mo(i,l)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,i;try{const x=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_routeNameForWaypoints(x,this.__wbg_ptr,Un(e));var l=Di()[x/4+0],u=Di()[x/4+1],d=Di()[x/4+2],a=Di()[x/4+3],_=l,y=u;if(a)throw _=0,y=0,Kl(d);return t=_,i=y,Mo(_,y)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(t,i,1)}}addSnappedWaypoint(e,t){Gt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Gt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,i;try{const x=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_calculateRoute(x,this.__wbg_ptr,Un(e));var l=Di()[x/4+0],u=Di()[x/4+1],d=Di()[x/4+2],a=Di()[x/4+3],_=l,y=u;if(a)throw _=0,y=0,Kl(d);return t=_,i=y,Mo(_,y)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(t,i,1)}}getExtraNodes(e,t){let i,l;try{const S=Gt.__wbindgen_add_to_stack_pointer(-16);Gt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Un(e),Un(t));var u=Di()[S/4+0],d=Di()[S/4+1],a=Di()[S/4+2],_=Di()[S/4+3],y=u,x=d;if(_)throw y=0,x=0,Kl(a);return i=y,l=x,Mo(y,x)}finally{Gt.__wbindgen_add_to_stack_pointer(16),Gt.__wbindgen_free(i,l,1)}}}async function Ob(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Nb(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const i=Mo(e,t);return Un(i)},r.wbg.__wbindgen_object_drop_ref=function(e){Kl(e)},r.wbg.__wbindgen_error_new=function(e,t){const i=new Error(Mo(e,t));return Un(i)},r.wbg.__wbindgen_number_get=function(e,t){const i=Mi(t),l=typeof i=="number"?i:void 0;Rb()[e/8+1]=Wf(l)?0:l,Di()[e/4+0]=!Wf(l)},r.wbg.__wbindgen_is_object=function(e){const t=Mi(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Mi(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Mi(e)in Mi(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Mi(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Mi(e)==Mi(t)},r.wbg.__wbindgen_string_get=function(e,t){const i=Mi(t),l=typeof i=="string"?i:void 0;var u=Wf(l)?0:nd(l,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),d=Js;Di()[e/4+1]=d,Di()[e/4+0]=u},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const i=String(Mi(t)),l=nd(i,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),u=Js;Di()[e/4+1]=u,Di()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Mi(e);return Un(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const i=Mi(e)[Mi(t)];return Un(i)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Un(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const i=Mi(t).stack,l=nd(i,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),u=Js;Di()[e/4+1]=u,Di()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let i,l;try{i=e,l=t,console.error(Mo(e,t))}finally{Gt.__wbindgen_free(i,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Mi(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Mi(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Mi(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Mi(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Mi(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const i=Mi(e)[t>>>0];return Un(i)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Mi(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Mi(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Mi(e).next;return Un(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Hf(function(e){const t=Mi(e).next();return Un(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Mi(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Mi(e).value;return Un(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Un(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Hf(function(e,t){const i=Reflect.get(Mi(e),Mi(t));return Un(i)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Hf(function(e,t){const i=Mi(e).call(Mi(t));return Un(i)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Mi(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Mi(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Mi(e).buffer;return Un(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Mi(e));return Un(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,i){Mi(e).set(Mi(t),i>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Mi(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Mi(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const i=sp(Mi(t)),l=nd(i,Gt.__wbindgen_malloc,Gt.__wbindgen_realloc),u=Js;Di()[e/4+1]=u,Di()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Mo(e,t))},r.wbg.__wbindgen_memory=function(){const e=Gt.memory;return Un(e)},r}function $b(r,e){return Gt=r.exports,f0.__wbindgen_wasm_module=e,vu=null,bu=null,yu=null,Gt}async function f0(r){if(Gt!==void 0)return Gt;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Nb();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:i}=await Ob(await r,e);return $b(t,i)}var zr=63710088e-1,zp={centimeters:zr*100,centimetres:zr*100,degrees:zr/111325,feet:zr*3.28084,inches:zr*39.37,kilometers:zr/1e3,kilometres:zr/1e3,meters:zr,metres:zr,miles:zr/1609.344,millimeters:zr*1e3,millimetres:zr*1e3,nauticalmiles:zr/1852,radians:1,yards:zr*1.0936},jb={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/zr,yards:1.0936133},ap={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Po(r,e,t){t===void 0&&(t={});var i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function Ub(r,e,t){switch(r){case"Point":return eo(e).geometry;case"LineString":return Io(e).geometry;case"Polygon":return Dp(e).geometry;case"MultiPoint":return m0(e).geometry;case"MultiLineString":return p0(e).geometry;case"MultiPolygon":return g0(e).geometry;default:throw new Error(r+" is invalid")}}function eo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!bd(r[0])||!bd(r[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:r};return Po(i,e,t)}function Vb(r,e,t){return t===void 0&&(t={}),$a(r.map(function(i){return eo(i,e)}),t)}function Dp(r,e,t){t===void 0&&(t={});for(var i=0,l=r;i<l.length;i++){var u=l[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return Po(a,e,t)}function qb(r,e,t){return t===void 0&&(t={}),$a(r.map(function(i){return Dp(i,e)}),t)}function Io(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:r};return Po(i,e,t)}function Zb(r,e,t){return t===void 0&&(t={}),$a(r.map(function(i){return Io(i,e)}),t)}function $a(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function p0(r,e,t){t===void 0&&(t={});var i={type:"MultiLineString",coordinates:r};return Po(i,e,t)}function m0(r,e,t){t===void 0&&(t={});var i={type:"MultiPoint",coordinates:r};return Po(i,e,t)}function g0(r,e,t){t===void 0&&(t={});var i={type:"MultiPolygon",coordinates:r};return Po(i,e,t)}function Gb(r,e,t){t===void 0&&(t={});var i={type:"GeometryCollection",geometries:r};return Po(i,e,t)}function Wb(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Rp(r,e){e===void 0&&(e="kilometers");var t=zp[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Ad(r,e){e===void 0&&(e="kilometers");var t=zp[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Hb(r,e){return Pu(Ad(r,e))}function Xb(r){var e=r%360;return e<0&&(e+=360),e}function Pu(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Lo(r){var e=r%360;return e*Math.PI/180}function Kb(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Rp(Ad(r,e),t)}function Jb(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var i=ap[e];if(!i)throw new Error("invalid original units");var l=ap[t];if(!l)throw new Error("invalid final units");return r/i*l}function bd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Bp(r){return!!r&&r.constructor===Object}function Yb(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!bd(e))throw new Error("bbox must only contain numbers")})}function Qb(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const ew=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:ap,bearingToAzimuth:Xb,convertArea:Jb,convertLength:Kb,degreesToRadians:Lo,earthRadius:zr,factors:zp,feature:Po,featureCollection:$a,geometry:Ub,geometryCollection:Gb,isNumber:bd,isObject:Bp,lengthToDegrees:Hb,lengthToRadians:Ad,lineString:Io,lineStrings:Zb,multiLineString:p0,multiPoint:m0,multiPolygon:g0,point:eo,points:Vb,polygon:Dp,polygons:qb,radiansToDegrees:Pu,radiansToLength:Rp,round:Wb,unitsFactors:jb,validateBBox:Yb,validateId:Qb},Symbol.toStringTag,{value:"Module"}));function zu(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function oc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function hu(r,e,t){t===void 0&&(t={});var i=zu(r),l=zu(e),u=Lo(l[1]-i[1]),d=Lo(l[0]-i[0]),a=Lo(i[1]),_=Lo(l[1]),y=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return Rp(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),t.units)}function Zu(r,e,t){if(r!==null)for(var i,l,u,d,a,_,y,x=0,S=0,C,L=r.type,P=L==="FeatureCollection",R=L==="Feature",D=P?r.features.length:1,B=0;B<D;B++){y=P?r.features[B].geometry:R?r.geometry:r,C=y?y.type==="GeometryCollection":!1,a=C?y.geometries.length:1;for(var N=0;N<a;N++){var $=0,j=0;if(d=C?y.geometries[N]:y,d!==null){_=d.coordinates;var le=d.type;switch(x=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,S,B,$,j)===!1)return!1;S++,$++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,B,$,j)===!1)return!1;S++,le==="MultiPoint"&&$++}le==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-x;l++){if(e(_[i][l],S,B,$,j)===!1)return!1;S++}le==="MultiLineString"&&$++,le==="Polygon"&&j++}le==="Polygon"&&$++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(j=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-x;u++){if(e(_[i][l][u],S,B,$,j)===!1)return!1;S++}j++}$++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(Zu(d.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function tw(r,e,t,i){var l=t;return Zu(r,function(u,d,a,_,y){d===0&&t===void 0?l=u:l=e(l,u,d,a,_,y)},i),l}function _0(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function iw(r,e,t){var i=t;return _0(r,function(l,u){u===0&&t===void 0?i=l:i=e(i,l,u)}),i}function wd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function nw(r,e,t){var i=t;return wd(r,function(l,u){u===0&&t===void 0?i=l:i=e(i,l,u)}),i}function rw(r){var e=[];return Zu(r,function(t){e.push(t)}),e}function Fp(r,e){var t,i,l,u,d,a,_,y,x,S,C=0,L=r.type==="FeatureCollection",P=r.type==="Feature",R=L?r.features.length:1;for(t=0;t<R;t++){for(a=L?r.features[t].geometry:P?r.geometry:r,y=L?r.features[t].properties:P?r.properties:{},x=L?r.features[t].bbox:P?r.bbox:void 0,S=L?r.features[t].id:P?r.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,y,x,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,y,x,S)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],C,y,x,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function ow(r,e,t){var i=t;return Fp(r,function(l,u,d,a,_){u===0&&t===void 0?i=l:i=e(i,l,u,d,a,_)}),i}function lc(r,e){Fp(r,function(t,i,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Po(t,l,{bbox:u,id:d}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var y=0;y<t.coordinates.length;y++){var x=t.coordinates[y],S={type:_,coordinates:x};if(e(Po(S,l),i,y)===!1)return!1}})}function sw(r,e,t){var i=t;return lc(r,function(l,u,d){u===0&&d===0&&t===void 0?i=l:i=e(i,l,u,d)}),i}function y0(r,e){lc(r,function(t,i,l){var u=0;if(t.geometry){var d=t.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var a,_=0,y=0,x=0;if(Zu(t,function(S,C,L,P,R){if(a===void 0||i>_||P>y||R>x){a=S,_=i,y=P,x=R,u=0;return}var D=Io([a,S],t.properties);if(e(D,i,l,R,u)===!1)return!1;u++,a=S})===!1)return!1}}})}function aw(r,e,t){var i=t,l=!1;return y0(r,function(u,d,a,_,y){l===!1&&t===void 0?i=u:i=e(i,u,d,a,_,y),l=!0}),i}function v0(r,e){if(!r)throw new Error("geojson is required");lc(r,function(t,i,l){if(t.geometry!==null){var u=t.geometry.type,d=t.geometry.coordinates;switch(u){case"LineString":if(e(t,i,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<d.length;a++)if(e(Io(d[a],t.properties),i,l,a)===!1)return!1;break}}})}function lw(r,e,t){var i=t;return v0(r,function(l,u,d,a){u===0&&t===void 0?i=l:i=e(i,l,u,d,a)}),i}function cw(r,e){if(e=e||{},!Bp(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,d=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),d=d||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":d=d||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Io([_[u],_[u+1]],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Io([_[l][u],_[l][u+1]],d,e);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u-1),Io([_[i][u],_[i][u+1]],d,e);case"MultiPolygon":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),u<0&&(u=_[i][l].length-u-1),Io([_[i][l][u],_[i][l][u+1]],d,e)}throw new Error("geojson is invalid")}function uw(r,e){if(e=e||{},!Bp(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,d=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),d=d||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":d=d||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return eo(_,d,e);case"MultiPoint":return i<0&&(i=_.length+i),eo(_[i],d,e);case"LineString":return u<0&&(u=_.length+u),eo(_[u],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),eo(_[l][u],d,e);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u),eo(_[i][u],d,e);case"MultiPolygon":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),u<0&&(u=_[i][l].length-u),eo(_[i][l][u],d,e)}throw new Error("geojson is invalid")}const hw=Object.freeze(Object.defineProperty({__proto__:null,coordAll:rw,coordEach:Zu,coordReduce:tw,featureEach:wd,featureReduce:nw,findPoint:uw,findSegment:cw,flattenEach:lc,flattenReduce:sw,geomEach:Fp,geomReduce:ow,lineEach:v0,lineReduce:lw,propEach:_0,propReduce:iw,segmentEach:y0,segmentReduce:aw},Symbol.toStringTag,{value:"Module"}));function b0(r,e,t){if(t===void 0&&(t={}),t.final===!0)return dw(r,e);var i=zu(r),l=zu(e),u=Lo(i[0]),d=Lo(l[0]),a=Lo(i[1]),_=Lo(l[1]),y=Math.sin(d-u)*Math.cos(_),x=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Pu(Math.atan2(y,x))}function dw(r,e){var t=b0(e,r);return t=(t+180)%360,t}function Dg(r,e,t,i){i===void 0&&(i={});var l=zu(r),u=Lo(l[0]),d=Lo(l[1]),a=Lo(t),_=Ad(e,i.units),y=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),x=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(y)),S=Pu(x),C=Pu(y);return eo([S,C],i.properties)}function Rg(r){if(!r)throw new Error("geojson is required");var e=[];return lc(r,function(t){fw(t,e)}),$a(e)}function fw(r,e){var t=[],i=r.geometry;if(i!==null){switch(i.type){case"Polygon":t=oc(i);break;case"LineString":t=[oc(i)]}t.forEach(function(l){var u=pw(l,r.properties);u.forEach(function(d){d.id=e.length,e.push(d)})})}}function pw(r,e){var t=[];return r.reduce(function(i,l){var u=Io([i,l],e);return u.bbox=mw(i,l),t.push(u),l}),t}function mw(r,e){var t=r[0],i=r[1],l=e[0],u=e[1],d=t<l?t:l,a=i<u?i:u,_=t>l?t:l,y=i>u?i:u;return[d,a,_,y]}var Op={exports:{}},w0={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(l0,function(){function t(N,$,j,le,ce){(function J(te,ye,Ue,oe,ve){for(;oe>Ue;){if(oe-Ue>600){var st=oe-Ue+1,ze=ye-Ue+1,Qe=Math.log(st),wt=.5*Math.exp(2*Qe/3),pt=.5*Math.sqrt(Qe*wt*(st-wt)/st)*(ze-st/2<0?-1:1),nt=Math.max(Ue,Math.floor(ye-ze*wt/st+pt)),Ht=Math.min(oe,Math.floor(ye+(st-ze)*wt/st+pt));J(te,ye,nt,Ht,ve)}var oi=te[ye],Dt=Ue,mt=oe;for(i(te,Ue,ye),ve(te[oe],oi)>0&&i(te,Ue,oe);Dt<mt;){for(i(te,Dt,mt),Dt++,mt--;ve(te[Dt],oi)<0;)Dt++;for(;ve(te[mt],oi)>0;)mt--}ve(te[Ue],oi)===0?i(te,Ue,mt):i(te,++mt,oe),mt<=ye&&(Ue=mt+1),ye<=mt&&(oe=mt-1)}})(N,$,j||0,le||N.length-1,ce||l)}function i(N,$,j){var le=N[$];N[$]=N[j],N[j]=le}function l(N,$){return N<$?-1:N>$?1:0}var u=function(N){N===void 0&&(N=9),this._maxEntries=Math.max(4,N),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function d(N,$,j){if(!j)return $.indexOf(N);for(var le=0;le<$.length;le++)if(j(N,$[le]))return le;return-1}function a(N,$){_(N,0,N.children.length,$,N)}function _(N,$,j,le,ce){ce||(ce=D(null)),ce.minX=1/0,ce.minY=1/0,ce.maxX=-1/0,ce.maxY=-1/0;for(var J=$;J<j;J++){var te=N.children[J];y(ce,N.leaf?le(te):te)}return ce}function y(N,$){return N.minX=Math.min(N.minX,$.minX),N.minY=Math.min(N.minY,$.minY),N.maxX=Math.max(N.maxX,$.maxX),N.maxY=Math.max(N.maxY,$.maxY),N}function x(N,$){return N.minX-$.minX}function S(N,$){return N.minY-$.minY}function C(N){return(N.maxX-N.minX)*(N.maxY-N.minY)}function L(N){return N.maxX-N.minX+(N.maxY-N.minY)}function P(N,$){return N.minX<=$.minX&&N.minY<=$.minY&&$.maxX<=N.maxX&&$.maxY<=N.maxY}function R(N,$){return $.minX<=N.maxX&&$.minY<=N.maxY&&$.maxX>=N.minX&&$.maxY>=N.minY}function D(N){return{children:N,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(N,$,j,le,ce){for(var J=[$,j];J.length;)if(!((j=J.pop())-($=J.pop())<=le)){var te=$+Math.ceil((j-$)/le/2)*le;t(N,te,$,j,ce),J.push($,te,te,j)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(N){var $=this.data,j=[];if(!R(N,$))return j;for(var le=this.toBBox,ce=[];$;){for(var J=0;J<$.children.length;J++){var te=$.children[J],ye=$.leaf?le(te):te;R(N,ye)&&($.leaf?j.push(te):P(N,ye)?this._all(te,j):ce.push(te))}$=ce.pop()}return j},u.prototype.collides=function(N){var $=this.data;if(!R(N,$))return!1;for(var j=[];$;){for(var le=0;le<$.children.length;le++){var ce=$.children[le],J=$.leaf?this.toBBox(ce):ce;if(R(N,J)){if($.leaf||P(N,J))return!0;j.push(ce)}}$=j.pop()}return!1},u.prototype.load=function(N){if(!N||!N.length)return this;if(N.length<this._minEntries){for(var $=0;$<N.length;$++)this.insert(N[$]);return this}var j=this._build(N.slice(),0,N.length-1,0);if(this.data.children.length)if(this.data.height===j.height)this._splitRoot(this.data,j);else{if(this.data.height<j.height){var le=this.data;this.data=j,j=le}this._insert(j,this.data.height-j.height-1,!0)}else this.data=j;return this},u.prototype.insert=function(N){return N&&this._insert(N,this.data.height-1),this},u.prototype.clear=function(){return this.data=D([]),this},u.prototype.remove=function(N,$){if(!N)return this;for(var j,le,ce,J=this.data,te=this.toBBox(N),ye=[],Ue=[];J||ye.length;){if(J||(J=ye.pop(),le=ye[ye.length-1],j=Ue.pop(),ce=!0),J.leaf){var oe=d(N,J.children,$);if(oe!==-1)return J.children.splice(oe,1),ye.push(J),this._condense(ye),this}ce||J.leaf||!P(J,te)?le?(j++,J=le.children[j],ce=!1):J=null:(ye.push(J),Ue.push(j),j=0,le=J,J=J.children[0])}return this},u.prototype.toBBox=function(N){return N},u.prototype.compareMinX=function(N,$){return N.minX-$.minX},u.prototype.compareMinY=function(N,$){return N.minY-$.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(N){return this.data=N,this},u.prototype._all=function(N,$){for(var j=[];N;)N.leaf?$.push.apply($,N.children):j.push.apply(j,N.children),N=j.pop();return $},u.prototype._build=function(N,$,j,le){var ce,J=j-$+1,te=this._maxEntries;if(J<=te)return a(ce=D(N.slice($,j+1)),this.toBBox),ce;le||(le=Math.ceil(Math.log(J)/Math.log(te)),te=Math.ceil(J/Math.pow(te,le-1))),(ce=D([])).leaf=!1,ce.height=le;var ye=Math.ceil(J/te),Ue=ye*Math.ceil(Math.sqrt(te));B(N,$,j,Ue,this.compareMinX);for(var oe=$;oe<=j;oe+=Ue){var ve=Math.min(oe+Ue-1,j);B(N,oe,ve,ye,this.compareMinY);for(var st=oe;st<=ve;st+=ye){var ze=Math.min(st+ye-1,ve);ce.children.push(this._build(N,st,ze,le-1))}}return a(ce,this.toBBox),ce},u.prototype._chooseSubtree=function(N,$,j,le){for(;le.push($),!$.leaf&&le.length-1!==j;){for(var ce=1/0,J=1/0,te=void 0,ye=0;ye<$.children.length;ye++){var Ue=$.children[ye],oe=C(Ue),ve=(st=N,ze=Ue,(Math.max(ze.maxX,st.maxX)-Math.min(ze.minX,st.minX))*(Math.max(ze.maxY,st.maxY)-Math.min(ze.minY,st.minY))-oe);ve<J?(J=ve,ce=oe<ce?oe:ce,te=Ue):ve===J&&oe<ce&&(ce=oe,te=Ue)}$=te||$.children[0]}var st,ze;return $},u.prototype._insert=function(N,$,j){var le=j?N:this.toBBox(N),ce=[],J=this._chooseSubtree(le,this.data,$,ce);for(J.children.push(N),y(J,le);$>=0&&ce[$].children.length>this._maxEntries;)this._split(ce,$),$--;this._adjustParentBBoxes(le,ce,$)},u.prototype._split=function(N,$){var j=N[$],le=j.children.length,ce=this._minEntries;this._chooseSplitAxis(j,ce,le);var J=this._chooseSplitIndex(j,ce,le),te=D(j.children.splice(J,j.children.length-J));te.height=j.height,te.leaf=j.leaf,a(j,this.toBBox),a(te,this.toBBox),$?N[$-1].children.push(te):this._splitRoot(j,te)},u.prototype._splitRoot=function(N,$){this.data=D([N,$]),this.data.height=N.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(N,$,j){for(var le,ce,J,te,ye,Ue,oe,ve=1/0,st=1/0,ze=$;ze<=j-$;ze++){var Qe=_(N,0,ze,this.toBBox),wt=_(N,ze,j,this.toBBox),pt=(ce=Qe,J=wt,te=void 0,ye=void 0,Ue=void 0,oe=void 0,te=Math.max(ce.minX,J.minX),ye=Math.max(ce.minY,J.minY),Ue=Math.min(ce.maxX,J.maxX),oe=Math.min(ce.maxY,J.maxY),Math.max(0,Ue-te)*Math.max(0,oe-ye)),nt=C(Qe)+C(wt);pt<ve?(ve=pt,le=ze,st=nt<st?nt:st):pt===ve&&nt<st&&(st=nt,le=ze)}return le||j-$},u.prototype._chooseSplitAxis=function(N,$,j){var le=N.leaf?this.compareMinX:x,ce=N.leaf?this.compareMinY:S;this._allDistMargin(N,$,j,le)<this._allDistMargin(N,$,j,ce)&&N.children.sort(le)},u.prototype._allDistMargin=function(N,$,j,le){N.children.sort(le);for(var ce=this.toBBox,J=_(N,0,$,ce),te=_(N,j-$,j,ce),ye=L(J)+L(te),Ue=$;Ue<j-$;Ue++){var oe=N.children[Ue];y(J,N.leaf?ce(oe):oe),ye+=L(J)}for(var ve=j-$-1;ve>=$;ve--){var st=N.children[ve];y(te,N.leaf?ce(st):st),ye+=L(te)}return ye},u.prototype._adjustParentBBoxes=function(N,$,j){for(var le=j;le>=0;le--)y($[le],N)},u.prototype._condense=function(N){for(var $=N.length-1,j=void 0;$>=0;$--)N[$].children.length===0?$>0?(j=N[$-1].children).splice(j.indexOf(N[$]),1):this.clear():a(N[$],this.toBBox)},u})})(w0);var gw=w0.exports;const _w=Pp(ew),yw=Pp(hw);function x0(r,e,t){if(r!==null)for(var i,l,u,d,a,_,y,x=0,S=0,C,L=r.type,P=L==="FeatureCollection",R=L==="Feature",D=P?r.features.length:1,B=0;B<D;B++){y=P?r.features[B].geometry:R?r.geometry:r,C=y?y.type==="GeometryCollection":!1,a=C?y.geometries.length:1;for(var N=0;N<a;N++){var $=0,j=0;if(d=C?y.geometries[N]:y,d!==null){_=d.coordinates;var le=d.type;switch(x=t&&(le==="Polygon"||le==="MultiPolygon")?1:0,le){case null:break;case"Point":if(e(_,S,B,$,j)===!1)return!1;S++,$++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,B,$,j)===!1)return!1;S++,le==="MultiPoint"&&$++}le==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-x;l++){if(e(_[i][l],S,B,$,j)===!1)return!1;S++}le==="MultiLineString"&&$++,le==="Polygon"&&j++}le==="Polygon"&&$++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(j=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-x;u++){if(e(_[i][l][u],S,B,$,j)===!1)return!1;S++}j++}$++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(x0(d.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function k0(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return x0(r,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var vw=k0;const bw=Object.freeze(Object.defineProperty({__proto__:null,bbox:k0,default:vw},Symbol.toStringTag,{value:"Module"})),ww=Pp(bw);var ts=gw,S0=_w,T0=yw,ql=ww.default,xw=T0.featureEach;T0.coordEach;S0.polygon;var Bg=S0.featureCollection;function C0(r){var e=new ts(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ql(t),ts.prototype.insert.call(this,t)},e.load=function(t){var i=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:ql(l),i.push(l)}):xw(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:ql(l),i.push(l)}),ts.prototype.load.call(this,i)},e.remove=function(t,i){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ql(t),ts.prototype.remove.call(this,t,i)},e.clear=function(){return ts.prototype.clear.call(this)},e.search=function(t){var i=ts.prototype.search.call(this,this.toBBox(t));return Bg(i)},e.collides=function(t){return ts.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=ts.prototype.all.call(this);return Bg(t)},e.toJSON=function(){return ts.prototype.toJSON.call(this)},e.fromJSON=function(t){return ts.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var i;if(t.bbox)i=t.bbox;else if(Array.isArray(t)&&t.length===4)i=t;else if(Array.isArray(t)&&t.length===6)i=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")i=ql(t);else if(t.type==="FeatureCollection")i=ql(t);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},e}Op.exports=C0;Op.exports.default=C0;var kw=Op.exports;const Sw=c0(kw);function Tw(r,e){var t={},i=[];if(r.type==="LineString"&&(r=Po(r)),e.type==="LineString"&&(e=Po(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Fg(r,e);return l&&i.push(l),$a(i)}var u=Sw();return u.load(Rg(e)),wd(Rg(r),function(d){wd(u.search(d),function(a){var _=Fg(d,a);if(_){var y=oc(_).join(",");t[y]||(t[y]=!0,i.push(_))}})}),$a(i)}function Fg(r,e){var t=oc(r),i=oc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],d=t[1][0],a=t[1][1],_=i[0][0],y=i[0][1],x=i[1][0],S=i[1][1],C=(S-y)*(d-l)-(x-_)*(a-u),L=(x-_)*(u-y)-(S-y)*(l-_),P=(d-l)*(u-y)-(a-u)*(l-_);if(C===0)return null;var R=L/C,D=P/C;if(R>=0&&R<=1&&D>=0&&D<=1){var B=l+R*(d-l),N=u+R*(a-u);return eo([B,N])}return null}function Cw(r,e,t){t===void 0&&(t={});var i=eo([1/0,1/0],{dist:1/0}),l=0;return lc(r,function(u){for(var d=oc(u),a=0;a<d.length-1;a++){var _=eo(d[a]);_.properties.dist=hu(e,_,t);var y=eo(d[a+1]);y.properties.dist=hu(e,y,t);var x=hu(_,y,t),S=Math.max(_.properties.dist,y.properties.dist),C=b0(_,y),L=Dg(e,S,C+90,t),P=Dg(e,S,C-90,t),R=Tw(Io([L.geometry.coordinates,P.geometry.coordinates]),Io([_.geometry.coordinates,y.geometry.coordinates])),D=null;R.features.length>0&&(D=R.features[0],D.properties.dist=hu(e,D,t),D.properties.location=l+hu(_,D,t)),_.properties.dist<i.properties.dist&&(i=_,i.properties.index=a,i.properties.location=l),y.properties.dist<i.properties.dist&&(i=y,i.properties.index=a+1,i.properties.location=l+x),D&&D.properties.dist<i.properties.dist&&(i=D,i.properties.index=a),l+=x}}),i}const Mw=30;class Ew{constructor(e,t,i,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-Mw,d.point.y],_=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new vd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=i,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Zl=[];function Xf(r,e){return{subscribe:Si(r,e).subscribe}}function Si(r,e=Ct){let t;const i=new Set;function l(a){if(Ft(r,a)&&(r=a,t)){const _=!Zl.length;for(const y of i)y[1](),Zl.push(y,r);if(_){for(let y=0;y<Zl.length;y+=2)Zl[y][0](Zl[y+1]);Zl.length=0}}}function u(a){l(a(r))}function d(a,_=Ct){const y=[a,_];return i.add(y),i.size===1&&(t=e(l,u)||Ct),a(r),()=>{i.delete(y),i.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const lp="MZEJTanw3WpxRvt7qDfo";let is=Si(null),Du=Si(!1),Ms=Si(""),xd=Si(!0),Cn=Si(null),Ru=Si(new Cs.LngLat(0,0)),Bu=Si(new Cs.LngLat(0,0)),cd=Si(new Cs.LngLat(0,0)),Og=Si(1),ws=Si(1),Wt=Si({mode:"title",firstLoad:!0}),cp=Si("streets-v2"),up=Si("walk_cycle_only"),Ng=Si(!1),Fu=Si(!1),kd=Si("shortcuts"),hp=Si(!1);function sc(){let r=Dr(Ms);r||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(r,JSON.stringify(Dr(Cn).toSavefile()))}function $g(r){let e,t;return e=new Ld({props:{$$slots:{default:[Iw,({dialog:i})=>({3:i}),({dialog:i})=>i?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function Iw(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P;function R(){return r[1](r[3])}return{c(){e=re("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Le(),i=re("p"),i.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=Le(),u=re("p"),u.textContent="To use this tool, you need to:",d=Le(),a=re("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Le(),y=re("p"),y.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,x=Le(),S=re("center"),C=re("button"),C.textContent="Start!"},m(D,B){ae(D,e,B),ae(D,t,B),ae(D,i,B),ae(D,l,B),ae(D,u,B),ae(D,d,B),ae(D,a,B),ae(D,_,B),ae(D,y,B),ae(D,x,B),ae(D,S,B),Z(S,C),L||(P=Mt(C,"click",R),L=!0)},p(D,B){r=D},d(D){D&&(se(e),se(t),se(i),se(l),se(u),se(d),se(a),se(_),se(y),se(x),se(S)),L=!1,P()}}}function Lw(r){let e,t,i=r[0]&&$g(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&K(i,1)):(i=$g(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function Aw(r,e,t){let i;return lt(r,xd,d=>t(0,i=d)),[i,d=>sr(d).close(),()=>St(xd,i=!1,i)]}class Pw extends Ut{constructor(e){super(),jt(this,e,Aw,Lw,Ft,{})}}let tt;const ks=new Array(128).fill(void 0);ks.push(void 0,null,!0,!1);function mi(r){return ks[r]}let Eu=ks.length;function zw(r){r<132||(ks[r]=Eu,Eu=r)}function Yn(r){const e=mi(r);return zw(r),e}let Gr=0,wu=null;function ec(){return(wu===null||wu.byteLength===0)&&(wu=new Uint8Array(tt.memory.buffer)),wu}const ud=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Dw=typeof ud.encodeInto=="function"?function(r,e){return ud.encodeInto(r,e)}:function(r,e){const t=ud.encode(r);return e.set(t),{read:r.length,written:t.length}};function No(r,e,t){if(t===void 0){const a=ud.encode(r),_=e(a.length,1)>>>0;return ec().subarray(_,_+a.length).set(a),Gr=a.length,_}let i=r.length,l=e(i,1)>>>0;const u=ec();let d=0;for(;d<i;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==i){d!==0&&(r=r.slice(d)),l=t(l,i,i=d+r.length*3,1)>>>0;const a=ec().subarray(l+d,l+i),_=Dw(r,a);d+=_.written}return Gr=d,l}function Jl(r){return r==null}let xu=null;function At(){return(xu===null||xu.byteLength===0)&&(xu=new Int32Array(tt.memory.buffer)),xu}const M0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&M0.decode();function rr(r,e){return r=r>>>0,M0.decode(ec().subarray(r,r+e))}function Qi(r){Eu===ks.length&&ks.push(ks.length+1);const e=Eu;return Eu=ks[e],ks[e]=r,e}let ku=null;function E0(){return(ku===null||ku.byteLength===0)&&(ku=new Float64Array(tt.memory.buffer)),ku}let Su=null;function Rw(){return(Su===null||Su.byteLength===0)&&(Su=new BigInt64Array(tt.memory.buffer)),Su}function dp(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=dp(r[0]));for(let d=1;d<l;d++)u+=", "+dp(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let i;if(t.length>1)i=t[1];else return toString.call(r);if(i=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:i}function Bw(r,e){const t=e(r.length*1,1)>>>0;return ec().set(r,t/1),Gr=r.length,t}function Fw(r,e){return r=r>>>0,E0().subarray(r/8,r/8+e)}function Ow(r,e){return r=r>>>0,ec().subarray(r/1,r/1+e)}function Ba(r,e){try{return r.apply(this,e)}catch(t){tt.__wbindgen_exn_store(Qi(t))}}class Nw{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();tt.__wbg_ltn_free(e)}constructor(e,t,i){try{const y=tt.__wbindgen_add_to_stack_pointer(-16),x=Bw(e,tt.__wbindgen_malloc),S=Gr;var l=Jl(i)?0:No(i,tt.__wbindgen_malloc,tt.__wbindgen_realloc),u=Gr;tt.ltn_new(y,x,S,Qi(t),l,u);var d=At()[y/4+0],a=At()[y/4+1],_=At()[y/4+2];if(_)throw Yn(a);return this.__wbg_ptr=d>>>0,this}finally{tt.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getInvertedBoundary(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}getBounds(){try{const l=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getBounds(l,this.__wbg_ptr);var e=At()[l/4+0],t=At()[l/4+1],i=Fw(e,t).slice();return tt.__wbindgen_free(e,t*8,8),i}finally{tt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=At()[l/4+0],t=At()[l/4+1],i=Ow(e,t).slice();return tt.__wbindgen_free(e,t*1,1),i}finally{tt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_toRouteSnapperGj(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_renderModalFilters(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_renderNeighbourhood(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_renderAutoBoundaries(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=tt.__wbindgen_add_to_stack_pointer(-16),d=No(e,tt.__wbindgen_malloc,tt.__wbindgen_realloc),a=Gr;tt.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,d,a,Qi(t));var i=At()[u/4+0],l=At()[u/4+1];if(l)throw Yn(i)}finally{tt.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=No(e,tt.__wbindgen_malloc,tt.__wbindgen_realloc),i=Gr;tt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,i)}renameNeighbourhoodBoundary(e,t){const i=No(e,tt.__wbindgen_malloc,tt.__wbindgen_realloc),l=Gr,u=No(t,tt.__wbindgen_malloc,tt.__wbindgen_realloc),d=Gr;tt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,i,l,u,d)}setCurrentNeighbourhood(e,t){try{const u=tt.__wbindgen_add_to_stack_pointer(-16),d=No(e,tt.__wbindgen_malloc,tt.__wbindgen_realloc),a=Gr;tt.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,d,a,t);var i=At()[u/4+0],l=At()[u/4+1];if(l)throw Yn(i)}finally{tt.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=tt.__wbindgen_add_to_stack_pointer(-16),d=No(t,tt.__wbindgen_malloc,tt.__wbindgen_realloc),a=Gr;tt.ltn_addModalFilter(u,this.__wbg_ptr,Qi(e),d,a);var i=At()[u/4+0],l=At()[u/4+1];if(l)throw Yn(i)}finally{tt.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=tt.__wbindgen_add_to_stack_pointer(-16),d=No(t,tt.__wbindgen_malloc,tt.__wbindgen_realloc),a=Gr;tt.ltn_addManyModalFilters(u,this.__wbg_ptr,Qi(e),d,a);var i=At()[u/4+0],l=At()[u/4+1];if(l)throw Yn(i)}finally{tt.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){tt.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){tt.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){tt.ltn_undo(this.__wbg_ptr)}redo(){tt.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,i;try{const x=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getShortcutsCrossingRoad(x,this.__wbg_ptr,e);var l=At()[x/4+0],u=At()[x/4+1],d=At()[x/4+2],a=At()[x/4+3],_=l,y=u;if(a)throw _=0,y=0,Yn(d);return t=_,i=y,rr(_,y)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(t,i,1)}}getAllShortcuts(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getAllShortcuts(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_toSavefile(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_loadSavefile(l,this.__wbg_ptr,Qi(e));var t=At()[l/4+0],i=At()[l/4+1];if(i)throw Yn(t)}finally{tt.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,i,l,u){let d,a;try{const P=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_compareRoute(P,this.__wbg_ptr,e,t,i,l,u);var _=At()[P/4+0],y=At()[P/4+1],x=At()[P/4+2],S=At()[P/4+3],C=_,L=y;if(S)throw C=0,L=0,Yn(x);return d=C,a=L,rr(C,L)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(d,a,1)}}impactToOneDestination(e,t){let i,l;try{const S=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_impactToOneDestination(S,this.__wbg_ptr,e,t);var u=At()[S/4+0],d=At()[S/4+1],a=At()[S/4+2],_=At()[S/4+3],y=u,x=d;if(_)throw y=0,x=0,Yn(a);return i=y,l=x,rr(y,x)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(i,l,1)}}predictImpact(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_predictImpact(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,i;try{const x=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getImpactsOnRoad(x,this.__wbg_ptr,e);var l=At()[x/4+0],u=At()[x/4+1],d=At()[x/4+2],a=At()[x/4+3],_=l,y=u;if(a)throw _=0,y=0,Yn(d);return t=_,i=y,rr(_,y)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(t,i,1)}}getAllIntersections(){let e,t;try{const y=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getAllIntersections(y,this.__wbg_ptr);var i=At()[y/4+0],l=At()[y/4+1],u=At()[y/4+2],d=At()[y/4+3],a=i,_=l;if(d)throw a=0,_=0,Yn(u);return e=a,t=_,rr(a,_)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(e,t,1)}}getMovements(e){let t,i;try{const x=tt.__wbindgen_add_to_stack_pointer(-16);tt.ltn_getMovements(x,this.__wbg_ptr,e);var l=At()[x/4+0],u=At()[x/4+1],d=At()[x/4+2],a=At()[x/4+3],_=l,y=u;if(a)throw _=0,y=0,Yn(d);return t=_,i=y,rr(_,y)}finally{tt.__wbindgen_add_to_stack_pointer(16),tt.__wbindgen_free(t,i,1)}}}async function $w(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function jw(){const r={};return r.wbg={},r.wbg.__wbindgen_object_drop_ref=function(e){Yn(e)},r.wbg.__wbindgen_string_get=function(e,t){const i=mi(t),l=typeof i=="string"?i:void 0;var u=Jl(l)?0:No(l,tt.__wbindgen_malloc,tt.__wbindgen_realloc),d=Gr;At()[e/4+1]=d,At()[e/4+0]=u},r.wbg.__wbindgen_error_new=function(e,t){const i=new Error(rr(e,t));return Qi(i)},r.wbg.__wbindgen_boolean_get=function(e){const t=mi(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof mi(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const i=mi(t),l=typeof i=="number"?i:void 0;E0()[e/8+1]=Jl(l)?0:l,At()[e/4+0]=!Jl(l)},r.wbg.__wbindgen_is_object=function(e){const t=mi(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return mi(e)in mi(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Qi(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return mi(e)===mi(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Qi(t)},r.wbg.__wbindgen_string_new=function(e,t){const i=rr(e,t);return Qi(i)},r.wbg.__wbindgen_is_undefined=function(e){return mi(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return mi(e)==mi(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=mi(e);return Qi(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const i=mi(e)[mi(t)];return Qi(i)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(mi(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(mi(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(mi(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(mi(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(mi(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Qi(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const i=mi(t).stack,l=No(i,tt.__wbindgen_malloc,tt.__wbindgen_realloc),u=Gr;At()[e/4+1]=u,At()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let i,l;try{i=e,l=t,console.error(rr(e,t))}finally{tt.__wbindgen_free(i,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=mi(e).performance;return Qi(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return mi(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const i=mi(e)[t>>>0];return Qi(i)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return mi(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof mi(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const i=new Function(rr(e,t));return Qi(i)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=mi(e).next;return Qi(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ba(function(e){const t=mi(e).next();return Qi(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return mi(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=mi(e).value;return Qi(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Qi(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ba(function(e,t){const i=Reflect.get(mi(e),mi(t));return Qi(i)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Ba(function(e,t){const i=mi(e).call(mi(t));return Qi(i)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Ba(function(){const e=self.self;return Qi(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Ba(function(){const e=window.window;return Qi(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Ba(function(){const e=globalThis.globalThis;return Qi(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Ba(function(){const e=global.global;return Qi(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(mi(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=mi(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(mi(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(mi(e));return Qi(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=mi(e).buffer;return Qi(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(mi(e));return Qi(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,i){mi(e).set(mi(t),i>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return mi(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=mi(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const i=mi(t),l=typeof i=="bigint"?i:void 0;Rw()[e/8+1]=Jl(l)?BigInt(0):l,At()[e/4+0]=!Jl(l)},r.wbg.__wbindgen_debug_string=function(e,t){const i=dp(mi(t)),l=No(i,tt.__wbindgen_malloc,tt.__wbindgen_realloc),u=Gr;At()[e/4+1]=u,At()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(rr(e,t))},r.wbg.__wbindgen_memory=function(){const e=tt.memory;return Qi(e)},r}function Uw(r,e){return tt=r.exports,I0.__wbindgen_wasm_module=e,Su=null,ku=null,xu=null,wu=null,tt}async function I0(r){if(tt!==void 0)return tt;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=jw();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:i}=await $w(await r,e);return Uw(t,i)}let Vw=Date.now();function cc(r){return`${r}-${Vw++}`}const Np=Symbol.for("svelte-maplibre");function uc(){return Id(Np)}function qw(r){let e=new WeakMap;return t=>{var d;let i=e.get(t.originalEvent);if(i!==void 0)return i;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=r.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function Zw(){let r=new Map;return Ed(Np,{map:Si(null),source:Xf(null),layer:Xf(null),popupTarget:Xf(null),cluster:Si(),loadedImages:Si(new Set),minzoom:Si(0),maxzoom:Si(24),layerEvent:Si(null),layerInfo:r,eventTopMost:qw(r),markerClickManager:new Xw})}function jg(r){return{subscribe:r.subscribe}}function $p({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:i=!1}){let l=uc(),u=Si(null),d=jg(u),a={...l,[r]:jg(u)};if(e&&(a.popupTarget=d),i){let _=Si(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=Si()),Ed(Np,a),{...l,self:u}}function Gw(){return $p({key:"source",setCluster:!0})}function Ww(r=!0){return $p({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Hw(){return $p({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class Xw{constructor(){jn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Ug(r){let e;return t=>{if(t)for(let i in t){let l=e==null?void 0:e[i],u=t[i];l!==u&&r(i,u,l)}else if(e)for(let i in e)r(i,void 0,e[i]);e=t}}function Kw(r,...e){let t=[r];for(let i of e)if(i)Array.isArray(i)&&i[0]===r?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Jw(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function ja(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Ua=Yw;function Yw(r){var e,t,i;if(r){if(Array.isArray(r)){for(e=[],t=r.length,i=0;i<t;i++){var l=r[i];l!=null&&e.push(l)}return e}if(typeof r=="object"){e={};var u=Object.keys(r);for(t=u.length,i=0;i<t;i++){var d=u[i],a=r[d];a!=null&&(e[d]=a)}return e}}}function Vg(r){let e=r[0],t,i,l=qg(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d[0]&1&&Ft(e,e=u[0])?(gi(),ie(l,1,1,Ct),_i(),l=qg(u),l.c(),K(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(K(l),i=!0)},o(u){ie(l),i=!1},d(u){u&&se(t),l.d(u)}}}function qg(r){let e;const t=r[36].default,i=Vi(t,r,r[35],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[1]&16)&&Zi(i,t,l,l[35],e?qi(t,l[35],u,null):Gi(l[35]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function Qw(r){let e,t,i=r[0]&&Vg(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u[0]&1&&K(i,1)):(i=Vg(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function ex(r,e,t){let i,l,u,d,a,_,y,x,S,C,L,P,{$$slots:R={},$$scope:D}=e,{id:B=cc("layer")}=e,{source:N=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:j=void 0}=e,{beforeLayerType:le=void 0}=e,{type:ce}=e,{paint:J=void 0}=e,{layout:te=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:Ue=void 0}=e,{minzoom:oe=void 0}=e,{maxzoom:ve=void 0}=e,{manageHoverState:st=!1}=e,{hovered:ze=null}=e,{interactive:Qe=!0}=e,{hoverCursor:wt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const nt=rs(),{map:Ht,source:oi,self:Dt,minzoom:mt,maxzoom:ti,eventTopMost:Pt,layerInfo:Rt}=Ww();lt(r,Ht,Fe=>t(31,S=Fe)),lt(r,oi,Fe=>t(32,C=Fe)),lt(r,Dt,Fe=>t(0,x=Fe)),lt(r,mt,Fe=>t(34,P=Fe)),lt(r,ti,Fe=>t(33,L=Fe)),or(()=>{x&&S&&(Rt.delete(x),S==null||S.removeLayer(x))});let ct;function Jt(Fe){var we,Ii;if(!Qe||!x||!S||pt&&Pt(Fe)!==x)return;let Ne=Fe.features??[],dt=(Ii=(we=Ne[0])==null?void 0:we.properties)==null?void 0:Ii.cluster_id,bt={event:Fe,map:S,clusterId:dt,layer:x,source:a,features:Ne};nt(Fe.type,bt)}function Yt(Fe){var we,Ii;if(!Qe||!x||!S||pt&&Pt(Fe)!==x)return;wt&&(S.getCanvas().style.cursor=wt);let Ne=Fe.features??[];t(6,ze=Ne[0]??null);let dt=(Ii=(we=Ne[0])==null?void 0:we.properties)==null?void 0:Ii.cluster_id;nt("mouseenter",{event:Fe,map:S,clusterId:dt,layer:x,source:a,features:Ne})}function Ei(Fe){var we,Ii,qe;if(!Qe||!S)return;if(pt&&Pt(Fe)!==x){t(6,ze=null),st&&ct!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:$,id:ct},{hover:!1}),ct=void 0);return}S.getCanvas().style.cursor=wt;let Ne=Fe.features??[],dt=(Ii=(we=Ne[0])==null?void 0:we.properties)==null?void 0:Ii.cluster_id,bt=(qe=Ne[0])==null?void 0:qe.id;bt!==ct&&(st&&(ct!==void 0&&(S==null||S.setFeatureState({source:a,id:ct,sourceLayer:$},{hover:!1})),S==null||S.setFeatureState({source:a,id:bt,sourceLayer:$},{hover:!0})),ct=bt,t(6,ze=Ne[0]??null)),nt("mousemove",{event:Fe,map:S,clusterId:dt,layer:x,source:a,features:Ne})}function Fi(Fe){if(!(!Qe||!x||!S)){if(wt&&(S.getCanvas().style.cursor=""),t(6,ze=null),st&&ct!==void 0){const Ne={source:a,id:ct,sourceLayer:$};S==null||S.setFeatureState(Ne,{hover:!1}),ct=void 0}nt("mouseleave",{map:S,layer:x,source:a})}}let ht=!0;function Ot(Fe){S&&(S.off("click",Fe,Jt),S.off("dblclick",Fe,Jt),S.off("contextmenu",Fe,Jt),S.off("mouseenter",Fe,Yt),S.off("mousemove",Fe,Ei),S.off("mouseleave",Fe,Fi))}return or(()=>{S&&x&&Ot(x)}),r.$$set=Fe=>{"id"in Fe&&t(7,B=Fe.id),"source"in Fe&&t(8,N=Fe.source),"sourceLayer"in Fe&&t(9,$=Fe.sourceLayer),"beforeId"in Fe&&t(10,j=Fe.beforeId),"beforeLayerType"in Fe&&t(11,le=Fe.beforeLayerType),"type"in Fe&&t(12,ce=Fe.type),"paint"in Fe&&t(13,J=Fe.paint),"layout"in Fe&&t(14,te=Fe.layout),"filter"in Fe&&t(15,ye=Fe.filter),"applyToClusters"in Fe&&t(16,Ue=Fe.applyToClusters),"minzoom"in Fe&&t(17,oe=Fe.minzoom),"maxzoom"in Fe&&t(18,ve=Fe.maxzoom),"manageHoverState"in Fe&&t(19,st=Fe.manageHoverState),"hovered"in Fe&&t(6,ze=Fe.hovered),"interactive"in Fe&&t(20,Qe=Fe.interactive),"hoverCursor"in Fe&&t(21,wt=Fe.hoverCursor),"eventsIfTopMost"in Fe&&t(22,pt=Fe.eventsIfTopMost),"$$scope"in Fe&&t(35,D=Fe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,i=Jw(Ue)),r.$$.dirty[0]&1073774592&&t(24,l=Kw("all",i,ye)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=oe??P),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ve??L),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=N||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&x!==B&&a){x&&(Ot(x),Rt.delete(x));let Fe=j;if(!j&&le){let Ne=S.getStyle().layers,dt=typeof le=="function"?le:we=>we.type===le,bt=Ne==null?void 0:Ne.find(dt);bt&&(Fe=bt.id)}St(Dt,x=B,x),S.addLayer(Ua({id:x,type:ce,source:a,"source-layer":$,filter:l,paint:J,layout:te,minzoom:u,maxzoom:d}),Fe),t(23,ht=!0),S.on("click",x,Jt),S.on("dblclick",x,Jt),S.on("contextmenu",x,Jt),S.on("mouseenter",x,Yt),S.on("mousemove",x,Ei),S.on("mouseleave",x,Fi)}r.$$.dirty[0]&1048577&&x&&Rt.set(x,{interactive:Qe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=x?Ug((Fe,Ne)=>{S!=null&&S.style._loaded?S.setPaintProperty(x,Fe,Ne):S==null||S.once("styledata",()=>S==null?void 0:S.setPaintProperty(x,Fe,Ne))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,y=x?Ug((Fe,Ne)=>{S!=null&&S.style._loaded?S.setLayoutProperty(x,Fe,Ne):S==null||S.once("styledata",()=>S==null?void 0:S.setLayoutProperty(x,Fe,Ne))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_(J)),r.$$.dirty[0]&134234112&&(y==null||y(te)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&x&&(S==null||S.setLayerZoomRange(x,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&x&&(ht?t(23,ht=!1):S==null||S.setFilter(x,l))},[x,Ht,oi,Dt,mt,ti,ze,B,N,$,j,le,ce,J,te,ye,Ue,oe,ve,st,Qe,wt,pt,ht,l,d,u,y,_,a,i,S,C,L,P,D,R]}let Pd=class extends Ut{constructor(e){super(),jt(this,e,ex,Qw,Ft,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function tx(r){let e;const t=r[16].default,i=Vi(t,r,r[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Zi(i,t,l,l[24],e?qi(t,l[24],u,null):Gi(l[24]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function ix(r){let e,t,i;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[tx]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Pd({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function nx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=cc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:j=!0}=e;function le(ve){N=ve,t(0,N)}function ce(ve){pi.call(this,r,ve)}function J(ve){pi.call(this,r,ve)}function te(ve){pi.call(this,r,ve)}function ye(ve){pi.call(this,r,ve)}function Ue(ve){pi.call(this,r,ve)}function oe(ve){pi.call(this,r,ve)}return r.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,y=ve.beforeLayerType),"paint"in ve&&t(6,x=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,C=ve.filter),"applyToClusters"in ve&&t(9,L=ve.applyToClusters),"minzoom"in ve&&t(10,P=ve.minzoom),"maxzoom"in ve&&t(11,R=ve.maxzoom),"hoverCursor"in ve&&t(12,D=ve.hoverCursor),"manageHoverState"in ve&&t(13,B=ve.manageHoverState),"hovered"in ve&&t(0,N=ve.hovered),"eventsIfTopMost"in ve&&t(14,$=ve.eventsIfTopMost),"interactive"in ve&&t(15,j=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[N,u,d,a,_,y,x,S,C,L,P,R,D,B,$,j,i,le,ce,J,te,ye,Ue,oe,l]}let zd=class extends Ut{constructor(e){super(),jt(this,e,nx,ix,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function rx(r){let e;const t=r[15].default,i=Vi(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function ox(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[rx]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Pd({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function sx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=cc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:$=!0}=e;function j(oe){B=oe,t(0,B)}function le(oe){pi.call(this,r,oe)}function ce(oe){pi.call(this,r,oe)}function J(oe){pi.call(this,r,oe)}function te(oe){pi.call(this,r,oe)}function ye(oe){pi.call(this,r,oe)}function Ue(oe){pi.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,u=oe.id),"source"in oe&&t(2,d=oe.source),"sourceLayer"in oe&&t(3,a=oe.sourceLayer),"beforeId"in oe&&t(4,_=oe.beforeId),"beforeLayerType"in oe&&t(5,y=oe.beforeLayerType),"paint"in oe&&t(6,x=oe.paint),"layout"in oe&&t(7,S=oe.layout),"filter"in oe&&t(8,C=oe.filter),"minzoom"in oe&&t(9,L=oe.minzoom),"maxzoom"in oe&&t(10,P=oe.maxzoom),"hoverCursor"in oe&&t(11,R=oe.hoverCursor),"manageHoverState"in oe&&t(12,D=oe.manageHoverState),"hovered"in oe&&t(0,B=oe.hovered),"eventsIfTopMost"in oe&&t(13,N=oe.eventsIfTopMost),"interactive"in oe&&t(14,$=oe.interactive),"$$scope"in oe&&t(23,l=oe.$$scope)},[B,u,d,a,_,y,x,S,C,L,P,R,D,N,$,i,j,le,ce,J,te,ye,Ue,l]}let ns=class extends Ut{constructor(e){super(),jt(this,e,sx,ox,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function ax(r,e,t){let i;const{map:l}=uc();lt(r,l,_=>t(4,i=_));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return or(()=>{i!=null&&i.loaded()&&a&&i.removeControl(a)}),r.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,d=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&i&&!a){let _;typeof d=="string"?_=document.querySelector(d)??void 0:_=d,t(3,a=new to.FullscreenControl({container:_})),i.addControl(a,u)}},[l,u,d,a,i]}class lx extends Ut{constructor(e){super(),jt(this,e,ax,null,Ft,{position:1,container:2})}}function cx(r,e,t,i,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{i(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function ux(r,e,t){o0().then(()=>{let i=Dr(r);if(!i)return;i.getSource(e)===t&&i.removeSource(e)})}function Zg(r){let e=r[0],t,i,l=Gg(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d&1&&Ft(e,e=u[0])?(gi(),ie(l,1,1,Ct),_i(),l=Gg(u),l.c(),K(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(K(l),i=!0)},o(u){ie(l),i=!1},d(u){u&&se(t),l.d(u)}}}function Gg(r){let e;const t=r[19].default,i=Vi(t,r,r[18],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&262144)&&Zi(i,t,l,l[18],e?qi(t,l[18],u,null):Gi(l[18]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function hx(r){let e,t,i=r[0]&&Zg(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&K(i,1)):(i=Zg(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function dx(r,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{id:_=cc("geojson")}=e,{data:y}=e,{generateId:x=!1}=e,{promoteId:S=void 0}=e,{filter:C=void 0}=e,{lineMetrics:L=void 0}=e,{cluster:P=void 0}=e,{maxzoom:R=void 0}=e,{attribution:D=void 0}=e,{buffer:B=void 0}=e,{tolerance:N=void 0}=e;const{map:$,cluster:j,self:le}=Gw();lt(r,$,te=>t(17,l=te)),lt(r,j,te=>t(20,u=te)),lt(r,le,te=>t(0,i=te));let ce,J=!0;return or(()=>{i&&ce&&l&&(ux($,i,ce),St(le,i=null,i),t(15,ce=void 0))}),r.$$set=te=>{"id"in te&&t(4,_=te.id),"data"in te&&t(5,y=te.data),"generateId"in te&&t(6,x=te.generateId),"promoteId"in te&&t(7,S=te.promoteId),"filter"in te&&t(8,C=te.filter),"lineMetrics"in te&&t(9,L=te.lineMetrics),"cluster"in te&&t(10,P=te.cluster),"maxzoom"in te&&t(11,R=te.maxzoom),"attribution"in te&&t(12,D=te.attribution),"buffer"in te&&t(13,B=te.buffer),"tolerance"in te&&t(14,N=te.tolerance),"$$scope"in te&&t(18,a=te.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&St(j,u=P,u),r.$$.dirty&196593&&l&&i!==_&&(St(le,i=_,i),cx(l,i,Ua({type:"geojson",data:y,filter:C,lineMetrics:L,generateId:x,promoteId:S,cluster:!!P,clusterMinPoints:P==null?void 0:P.minPoints,clusterMaxZoom:P==null?void 0:P.maxZoom,clusterRadius:P==null?void 0:P.radius,clusterProperties:P==null?void 0:P.properties,maxzoom:R,attribution:D,buffer:B,tolerance:N}),te=>l&&te===i,()=>{i&&(t(15,ce=l==null?void 0:l.getSource(i)),t(16,J=!0))})),r.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,ce=l==null?void 0:l.getSource(_))})),r.$$.dirty&98336&&ce&&(J?t(16,J=!1):ce.setData(y)),r.$$.dirty&33792&&(ce==null||ce.setClusterOptions(Ua({cluster:!!P,clusterMaxZoom:P==null?void 0:P.maxZoom,clusterRadius:P==null?void 0:P.radius})))},[i,$,j,le,_,y,x,S,C,L,P,R,D,B,N,ce,J,l,a,d]}let tr=class extends Ut{constructor(e){super(),jt(this,e,dx,hx,Ft,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function fx(r,e,t){let i;const{map:l}=uc();lt(r,l,C=>t(8,i=C));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:y=!0}=e,{showUserLocation:x=!0}=e,{control:S=null}=e;return or(()=>{i!=null&&i.loaded()&&S&&i.removeControl(S)}),r.$$set=C=>{"position"in C&&t(2,u=C.position),"positionOptions"in C&&t(3,d=C.positionOptions),"fitBoundsOptions"in C&&t(4,a=C.fitBoundsOptions),"trackUserLocation"in C&&t(5,_=C.trackUserLocation),"showAccuracyCircle"in C&&t(6,y=C.showAccuracyCircle),"showUserLocation"in C&&t(7,x=C.showUserLocation),"control"in C&&t(1,S=C.control)},r.$$.update=()=>{r.$$.dirty&510&&i&&!S&&(t(1,S=new to.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:y,showUserLocation:x})),i.addControl(S,u))},[l,S,u,d,a,_,y,x,i]}class px extends Ut{constructor(e){super(),jt(this,e,fx,null,Ft,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function mx(r){let e;const t=r[15].default,i=Vi(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function gx(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[mx]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Pd({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function _x(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=cc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:$=!0}=e;function j(oe){B=oe,t(0,B)}function le(oe){pi.call(this,r,oe)}function ce(oe){pi.call(this,r,oe)}function J(oe){pi.call(this,r,oe)}function te(oe){pi.call(this,r,oe)}function ye(oe){pi.call(this,r,oe)}function Ue(oe){pi.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,u=oe.id),"source"in oe&&t(2,d=oe.source),"sourceLayer"in oe&&t(3,a=oe.sourceLayer),"beforeId"in oe&&t(4,_=oe.beforeId),"beforeLayerType"in oe&&t(5,y=oe.beforeLayerType),"paint"in oe&&t(6,x=oe.paint),"layout"in oe&&t(7,S=oe.layout),"filter"in oe&&t(8,C=oe.filter),"minzoom"in oe&&t(9,L=oe.minzoom),"maxzoom"in oe&&t(10,P=oe.maxzoom),"hoverCursor"in oe&&t(11,R=oe.hoverCursor),"manageHoverState"in oe&&t(12,D=oe.manageHoverState),"hovered"in oe&&t(0,B=oe.hovered),"eventsIfTopMost"in oe&&t(13,N=oe.eventsIfTopMost),"interactive"in oe&&t(14,$=oe.interactive),"$$scope"in oe&&t(23,l=oe.$$scope)},[B,u,d,a,_,y,x,S,C,L,P,R,D,N,$,i,j,le,ce,J,te,ye,Ue,l]}let Hr=class extends Ut{constructor(e){super(),jt(this,e,_x,gx,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function yx(r,e,t){let i;const l=rs();let{layer:u=void 0}=e;const{map:d}=uc();lt(r,d,x=>t(2,i=x));function a(x){l(x.type,{...x,map:d})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],y=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return or(()=>{if(i)if(u)for(const x of _)i.off(x,u,a);else for(const x of y)i.off(x,a)}),r.$$set=x=>{"layer"in x&&t(1,u=x.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&i)if(u)for(const x of _)i.on(x,u,a);else for(const x of y)i.on(x,a)},[d,u,i]}class L0 extends Ut{constructor(e){super(),jt(this,e,yx,null,Ft,{layer:1})}}function vx(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,i=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,i),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,_=r.getBearing(),y=r.getPitch();return(_||y)&&(a+=`/${Math.round(_*10)/10}`),y&&(a+=`/${Math.round(y)}`),`#${a}`}function bx(r){return r.replace("#","").split("/").map(parseFloat)}var Gl=jp;function jp(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?Wg(r,e):{}.toString.call(r)=="[object Set]"?Wg(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?xx(r,e):wx(r,e)}function wx(r,e){return r.toString()===e.toString()}function Wg(r,e){var t=r.length;if(t!=e.length)return!1;for(var i=0;i<t;i++)if(!jp(r[i],e[i]))return!1;return!0}function xx(r,e){var t=Object.keys(r),i=t.length;if(i!=Object.keys(e).length)return!1;for(var l=0;l<i;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&jp(r[u],e[u])))return!1}return!0}function kx(r,e,t){let i;const{map:l}=uc();lt(r,l,x=>t(6,i=x));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,y=null;return or(()=>{i!=null&&i.loaded()&&y&&i.removeControl(y)}),r.$$set=x=>{"position"in x&&t(1,u=x.position),"showCompass"in x&&t(2,d=x.showCompass),"showZoom"in x&&t(3,a=x.showZoom),"visualizePitch"in x&&t(4,_=x.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&i&&!y&&(t(5,y=new to.NavigationControl({showCompass:d,showZoom:a,visualizePitch:_})),i.addControl(y,u))},[l,u,d,a,_,y,i]}class A0 extends Ut{constructor(e){super(),jt(this,e,kx,null,Ft,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function Sx(r,e,t){let i;const{map:l}=uc();lt(r,l,y=>t(5,i=y));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,_=null;return or(()=>{i!=null&&i.loaded()&&_&&i.removeControl(_)}),r.$$set=y=>{"position"in y&&t(1,u=y.position),"maxWidth"in y&&t(2,d=y.maxWidth),"unit"in y&&t(3,a=y.unit)},r.$$.update=()=>{r.$$.dirty&62&&i&&!_&&(t(4,_=new to.ScaleControl({maxWidth:d,unit:a})),i.addControl(_,u))},[l,u,d,a,_,i]}class P0 extends Ut{constructor(e){super(),jt(this,e,Sx,null,Ft,{position:1,maxWidth:2,unit:3})}}const{window:Tx}=Mp,Cx=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),Hg=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function Xg(r){let e,t,i=r[3]&&Kg(r);const l=r[46].default,u=Vi(l,r,r[45],Hg);return{c(){i&&i.c(),e=Le(),u&&u.c()},m(d,a){i&&i.m(d,a),ae(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?i?(i.p(d,a),a[0]&8&&K(i,1)):(i=Kg(d),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Zi(u,l,d,d[45],t?qi(l,d[45],a,Cx):Gi(d[45]),Hg)},i(d){t||(K(i),K(u,d),t=!0)},o(d){ie(i),ie(u,d),t=!1},d(d){d&&se(e),i&&i.d(d),u&&u.d(d)}}}function Kg(r){let e,t,i,l,u,d,a,_;return e=new A0({props:{position:r[7]}}),i=new px({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),u=new lx({props:{position:r[7]}}),a=new P0({props:{position:r[7]}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),Ce(a.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),ae(y,l,x),Se(u,y,x),ae(y,d,x),Se(a,y,x),_=!0},p(y,x){const S={};x[0]&128&&(S.position=y[7]),e.$set(S);const C={};x[0]&128&&(C.position=y[7]),i.$set(C);const L={};x[0]&128&&(L.position=y[7]),u.$set(L);const P={};x[0]&128&&(P.position=y[7]),a.$set(P)},i(y){_||(K(e.$$.fragment,y),K(i.$$.fragment,y),K(u.$$.fragment,y),K(a.$$.fragment,y),_=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),ie(u.$$.fragment,y),ie(a.$$.fragment,y),_=!1},d(y){y&&(se(t),se(l),se(d)),Te(e,y),Te(i,y),Te(u,y),Te(a,y)}}}function Mx(r){let e,t,i,l,u,d=r[4]&&r[0]&&Xg(r);return{c(){e=re("div"),d&&d.c(),ke(e,"class",t=_d(r[2])+" svelte-p00lfq"),ke(e,"data-testid","map-container"),dr(e,"expand-map",!r[2])},m(a,_){ae(a,e,_),d&&d.m(e,null),r[47](e),i=!0,l||(u=[Mt(Tx,"hashchange",r[11]),np(r[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?d?(d.p(a,_),_[0]&17&&K(d,1)):(d=Xg(a),d.c(),K(d,1),d.m(e,null)):d&&(gi(),ie(d,1,1,()=>{d=null}),_i()),(!i||_[0]&4&&t!==(t=_d(a[2])+" svelte-p00lfq"))&&ke(e,"class",t),(!i||_[0]&4)&&dr(e,"expand-map",!a[2])},i(a){i||(K(d),i=!0)},o(a){ie(d),i=!1},d(a){a&&se(e),d&&d.d(),r[47](null),l=!1,mn(u)}}}function Ex(r,e,t){let i,l,u,d,{$$slots:a={},$$scope:_}=e,{map:y=null}=e,{mapContainer:x=void 0}=e,{class:S=void 0}=e,{style:C}=e,{diffStyleUpdates:L=!1}=e,{center:P=void 0}=e,{zoom:R=void 0}=e,{pitch:D=0}=e,{bearing:B=0}=e,{bounds:N=void 0}=e,{hash:$=!1}=e,{updateHash:j=qe=>{window.history.replaceState(window.history.state,"",qe)}}=e,{loaded:le=!1}=e,{minZoom:ce=0}=e,{maxZoom:J=22}=e,{minPitch:te=0}=e,{maxPitch:ye=60}=e,{renderWorldCopies:Ue=void 0}=e,{dragPan:oe=void 0}=e,{dragRotate:ve=void 0}=e,{pitchWithRotate:st=void 0}=e,{antialias:ze=void 0}=e,{zoomOnDoubleClick:Qe=!0}=e,{locale:wt=void 0}=e,{interactive:pt=!0}=e,{attributionControl:nt=!0}=e,{cooperativeGestures:Ht=!1}=e,{preserveDrawingBuffer:oi=!1}=e,{maxBounds:Dt=void 0}=e,{images:mt=[]}=e,{standardControls:ti=!1}=e,{filterLayers:Pt=void 0}=e,{transformRequest:Rt=void 0}=e;const ct=rs(),{map:Jt,loadedImages:Yt}=Zw();lt(r,Jt,qe=>t(4,u=qe)),lt(r,Yt,qe=>t(5,d=qe));let Ei=new Set;async function Fi(qe,Je=!1){if(u&&!(!u.loaded()&&!Je))if("url"in qe){Ei.add(qe.id);try{let Vt=await u.loadImage(qe.url);u==null||u.addImage(qe.id,Vt.data,qe.options),d.add(qe.id),Yt.set(d)}catch(Vt){ct("error",Vt)}finally{Ei.delete(qe.id)}}else u.addImage(qe.id,qe.data,qe.options),d.add(qe.id),Yt.set(d)}let ht,Ot,Fe,Ne;function dt(qe){return we(),St(Jt,u=new to.Map(Ua({container:qe,style:C,locale:wt,center:P,zoom:R,pitch:D,bearing:B,minZoom:ce,maxZoom:J,minPitch:te,maxPitch:ye,renderWorldCopies:Ue,dragPan:oe,dragRotate:ve,pitchWithRotate:st,antialias:ze,interactive:pt,preserveDrawingBuffer:oi,maxBounds:Dt,bounds:N,attributionControl:nt,transformRequest:Rt,cooperativeGestures:Ht})),u),u.on("load",Je=>{Je.target.getContainer().setAttribute("data-testid","map"),Je.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,le=!0),ct("load",u)}),u.on("error",Je=>ct("error",{...Je,map:u})),u.on("movestart",Je=>ct("movestart",{...Je,map:u})),u.on("moveend",Je=>{if(t(12,P=Je.target.getCenter()),t(13,R=Je.target.getZoom()),t(14,D=Je.target.getPitch()),t(15,B=Je.target.getBearing()),t(16,N=Je.target.getBounds()),ct("moveend",{...Je,map:u}),$){let Vt=new URL(window.location.href.replace(/(#.+)?$/,vx(u)));j(Vt)}}),u.on("click",Je=>ct("click",{...Je,map:u})),u.on("dblclick",Je=>ct("dblclick",{...Je,map:u})),u.on("contextmenu",Je=>ct("contextmenu",{...Je,map:u})),u.on("zoomstart",Je=>ct("zoomstart",{...Je,map:u})),u.on("zoom",Je=>{ct("zoom",{...Je,map:u})}),u.on("zoomend",Je=>{ct("zoomend",{...Je,map:u})}),u.on("style.load",()=>{if(u){const Je=u.getStyle();if(t(42,ht=Je.layers.map(Vt=>Vt.id)),t(43,Ot=Object.keys(Je.sources)),Ne)for(const[Vt,Pi]of Object.entries(Ne))u.addSource(Vt,Pi);if(Fe)for(const Vt of Fe)u.addLayer(Vt);for(const Vt of mt)Fi(Vt,!0)}}),u.on("styledata",Je=>{if(u&&Pt){const Vt=u.getStyle().layers;if(Vt)for(let Pi of Vt)Pt(Pi)||u.setLayoutProperty(Pi.id,"visibility","none")}ct("styledata",{...Je,map:u})}),{destroy(){t(0,le=!1),u==null||u.remove(),St(Jt,u=null,u)}}}let bt=C;function we(){if($){let qe=bx(window.location.hash);qe.length>=3&&(t(13,R=qe[0]),t(12,P=[qe[2],qe[1]])),qe.length==5&&(t(15,B=qe[3]),t(14,D=qe[4]))}}function Ii(qe){Xi[qe?"unshift":"push"](()=>{x=qe,t(1,x)})}return r.$$set=qe=>{"map"in qe&&t(17,y=qe.map),"mapContainer"in qe&&t(1,x=qe.mapContainer),"class"in qe&&t(2,S=qe.class),"style"in qe&&t(18,C=qe.style),"diffStyleUpdates"in qe&&t(19,L=qe.diffStyleUpdates),"center"in qe&&t(12,P=qe.center),"zoom"in qe&&t(13,R=qe.zoom),"pitch"in qe&&t(14,D=qe.pitch),"bearing"in qe&&t(15,B=qe.bearing),"bounds"in qe&&t(16,N=qe.bounds),"hash"in qe&&t(20,$=qe.hash),"updateHash"in qe&&t(21,j=qe.updateHash),"loaded"in qe&&t(0,le=qe.loaded),"minZoom"in qe&&t(22,ce=qe.minZoom),"maxZoom"in qe&&t(23,J=qe.maxZoom),"minPitch"in qe&&t(24,te=qe.minPitch),"maxPitch"in qe&&t(25,ye=qe.maxPitch),"renderWorldCopies"in qe&&t(26,Ue=qe.renderWorldCopies),"dragPan"in qe&&t(27,oe=qe.dragPan),"dragRotate"in qe&&t(28,ve=qe.dragRotate),"pitchWithRotate"in qe&&t(29,st=qe.pitchWithRotate),"antialias"in qe&&t(30,ze=qe.antialias),"zoomOnDoubleClick"in qe&&t(31,Qe=qe.zoomOnDoubleClick),"locale"in qe&&t(32,wt=qe.locale),"interactive"in qe&&t(33,pt=qe.interactive),"attributionControl"in qe&&t(34,nt=qe.attributionControl),"cooperativeGestures"in qe&&t(35,Ht=qe.cooperativeGestures),"preserveDrawingBuffer"in qe&&t(36,oi=qe.preserveDrawingBuffer),"maxBounds"in qe&&t(37,Dt=qe.maxBounds),"images"in qe&&t(38,mt=qe.images),"standardControls"in qe&&t(3,ti=qe.standardControls),"filterLayers"in qe&&t(39,Pt=qe.filterLayers),"transformRequest"in qe&&t(40,Rt=qe.transformRequest),"$$scope"in qe&&t(45,_=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,i=typeof ti=="boolean"?void 0:ti),r.$$.dirty[0]&16&&t(17,y=u),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&u&&!Gl(C,bt)){const qe=u.getStyle();if(ht&&(Fe=qe.layers.filter(Je=>!ht.includes(Je.id))),Ot){const Je=Object.keys(qe.sources).filter(Vt=>!Ot.includes(Vt));Ne={};for(const Vt of Je)Ne[Vt]=qe.sources[Vt]}t(44,bt=C),u.setStyle(C,{diff:L}),St(Yt,d=new Set,d),t(41,Ei=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&le&&u!=null&&u.loaded())for(let qe of mt)!d.has(qe.id)&&!Ei.has(qe.id)&&!u.hasImage(qe.id)&&Fi(qe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,l=mt.every(qe=>d.has(qe.id))),r.$$.dirty[0]&61456&&u){let qe={};P!=null&&!Gl(P,u==null?void 0:u.getCenter())&&(qe.center=P),R!=null&&!Gl(R,u==null?void 0:u.getZoom())&&(qe.zoom=R),B!=null&&!Gl(B,u==null?void 0:u.getBearing())&&(qe.bearing=B),D!=null&&!Gl(D,u==null?void 0:u.getPitch())&&(qe.pitch=D),Object.keys(qe).length&&u.easeTo(qe)}r.$$.dirty[0]&65552&&N&&!Gl(N,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(N)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(Qe?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[le,x,S,ti,u,d,l,i,Jt,Yt,dt,we,P,R,D,B,N,y,C,L,$,j,ce,J,te,ye,Ue,oe,ve,st,ze,Qe,wt,pt,nt,Ht,oi,Dt,mt,Pt,Rt,Ei,ht,Ot,bt,_,a,Ii]}class Ix extends Ut{constructor(e){super(),jt(this,e,Ex,Mx,Ft,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const Lx=r=>({marker:r&8}),Jg=r=>({marker:r[3]});function Ax(r){let e,t,i,l,u,d,a;const _=r[19].default,y=Vi(_,r,r[18],Jg);return{c(){e=re("div"),y&&y.c(),ke(e,"tabindex",t=r[1]?0:void 0),ke(e,"role",i=r[1]?"button":void 0),Ri(e,"z-index",r[2])},m(x,S){ae(x,e,S),y&&y.m(e,null),u=!0,d||(a=[np(r[7].call(null,e)),np(l=Px.call(null,e,r[0])),Mt(e,"click",Zf(r[20])),Mt(e,"dblclick",Zf(r[21])),Mt(e,"contextmenu",Zf(Ep(r[22]))),Mt(e,"mouseenter",r[23]),Mt(e,"mouseleave",r[24]),Mt(e,"mousemove",r[25]),Mt(e,"keydown",r[8])],d=!0)},p(x,[S]){y&&y.p&&(!u||S&262152)&&Zi(y,_,x,x[18],u?qi(_,x[18],S,Lx):Gi(x[18]),Jg),(!u||S&2&&t!==(t=x[1]?0:void 0))&&ke(e,"tabindex",t),(!u||S&2&&i!==(i=x[1]?"button":void 0))&&ke(e,"role",i),l&&ic(l.update)&&S&1&&l.update.call(null,x[0]),S&4&&Ri(e,"z-index",x[2])},i(x){u||(K(y,x),u=!0)},o(x){ie(y,x),u=!1},d(x){x&&se(e),y&&y.d(x),d=!1,mn(a)}}}function Px(r,e){const t=r.className;function i(l){l?r.className=`${t} ${l}`:r.className=t}return i(e),{update:i}}function zx(r,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:y}=e,{class:x=void 0}=e,{interactive:S=!0}=e,{asButton:C=!1}=e,{draggable:L=!1}=e,{feature:P=null}=e,{offset:R=void 0}=e,{zIndex:D=void 0}=e,{rotation:B=0}=e,{opacity:N=1}=e;const $=rs(),{map:j,layerEvent:le,self:ce,markerClickManager:J}=Hw();lt(r,j,nt=>t(27,u=nt)),lt(r,le,nt=>t(26,i=nt)),lt(r,ce,nt=>t(3,l=nt));function te(nt){St(ce,l=new to.Marker({element:nt,rotation:B,draggable:L,offset:R,opacity:N.toString()}).setLngLat(y).addTo(u),l),t(11,_=l);const Ht=()=>oe("dragstart"),oi=()=>{ye(),oe("drag")},Dt=()=>{ye(),oe("dragend")};return L&&(l.on("dragstart",Ht),l.on("drag",oi),l.on("dragend",Dt)),{destroy(){L&&(l==null||l.off("dragstart",Ht),l==null||l.off("drag",oi),l==null||l.off("dragend",Dt)),t(11,_=void 0),l==null||l.remove()}}}function ye(){let nt=l==null?void 0:l.getLngLat();nt&&(Array.isArray(y)?t(10,y=[nt.lng,nt.lat]):y&&"lon"in y?t(10,y={lon:nt.lng,lat:nt.lat}):t(10,y=nt))}function Ue(nt){nt.key===" "&&(nt.preventDefault(),nt.stopPropagation(),oe("click"))}function oe(nt){if(!S)return;let Ht=l==null?void 0:l.getLngLat();if(!Ht)return;const oi=[Ht.lng,Ht.lat];let Dt={map:u,marker:l,lngLat:oi,features:[{type:"Feature",properties:(P==null?void 0:P.properties)??{},geometry:{type:"Point",coordinates:oi}}]};(nt==="click"||nt==="contextmenu")&&J.handleClick(Dt),St(le,i={...Dt,layerType:"marker",type:nt},i),$(nt,Dt)}const ve=()=>oe("click"),st=()=>oe("dblclick"),ze=()=>{oe("contextmenu")},Qe=()=>{oe("mouseenter")},wt=()=>{oe("mouseleave")},pt=()=>oe("mousemove");return r.$$set=nt=>{"marker"in nt&&t(11,_=nt.marker),"lngLat"in nt&&t(10,y=nt.lngLat),"class"in nt&&t(0,x=nt.class),"interactive"in nt&&t(12,S=nt.interactive),"asButton"in nt&&t(1,C=nt.asButton),"draggable"in nt&&t(13,L=nt.draggable),"feature"in nt&&t(14,P=nt.feature),"offset"in nt&&t(15,R=nt.offset),"zIndex"in nt&&t(2,D=nt.zIndex),"rotation"in nt&&t(16,B=nt.rotation),"opacity"in nt&&t(17,N=nt.opacity),"$$scope"in nt&&t(18,a=nt.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(y)),r.$$.dirty&32776&&(l==null||l.setOffset(R??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(B)),r.$$.dirty&131080&&(l==null||l.setOpacity(N.toString()))},[x,C,D,l,j,le,ce,te,Ue,oe,y,_,S,L,P,R,B,N,a,d,ve,st,ze,Qe,wt,pt]}class Dd extends Ut{constructor(e){super(),jt(this,e,zx,Ax,Ft,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}var Gu=Uint8Array,z0=Uint16Array,Dx=Int32Array,Rx=new Gu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Bx=new Gu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),D0=function(r,e){for(var t=new z0(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var l=new Dx(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)l[u]=u-t[i]<<5|i;return{b:t,r:l}},R0=D0(Rx,2),Fx=R0.b,Ox=R0.r;Fx[28]=258,Ox[258]=28;D0(Bx,0);var Nx=new z0(32768);for(Hi=0;Hi<32768;++Hi)bs=(Hi&43690)>>1|(Hi&21845)<<1,bs=(bs&52428)>>2|(bs&13107)<<2,bs=(bs&61680)>>4|(bs&3855)<<4,Nx[Hi]=((bs&65280)>>8|(bs&255)<<8)>>1;var bs,Hi,Rd=new Gu(288);for(Hi=0;Hi<144;++Hi)Rd[Hi]=8;var Hi;for(Hi=144;Hi<256;++Hi)Rd[Hi]=9;var Hi;for(Hi=256;Hi<280;++Hi)Rd[Hi]=7;var Hi;for(Hi=280;Hi<288;++Hi)Rd[Hi]=8;var Hi,$x=new Gu(32);for(Hi=0;Hi<32;++Hi)$x[Hi]=5;var Hi,jx=new Gu(0),Ux=typeof TextDecoder<"u"&&new TextDecoder,Vx=0;try{Ux.decode(jx,{stream:!0}),Vx=1}catch{}function qx(r){let e;const t=r[16].default,i=Vi(t,r,r[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Zi(i,t,l,l[24],e?qi(t,l[24],u,null):Gi(l[24]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function Zx(r){let e,t,i;function l(d){r[17](d)}let u={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[qx]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Pd({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function Gx(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=cc("symbol")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x=void 0}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:j=!0}=e;function le(ve){N=ve,t(0,N)}function ce(ve){pi.call(this,r,ve)}function J(ve){pi.call(this,r,ve)}function te(ve){pi.call(this,r,ve)}function ye(ve){pi.call(this,r,ve)}function Ue(ve){pi.call(this,r,ve)}function oe(ve){pi.call(this,r,ve)}return r.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,y=ve.beforeLayerType),"paint"in ve&&t(6,x=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,C=ve.filter),"applyToClusters"in ve&&t(9,L=ve.applyToClusters),"minzoom"in ve&&t(10,P=ve.minzoom),"maxzoom"in ve&&t(11,R=ve.maxzoom),"hoverCursor"in ve&&t(12,D=ve.hoverCursor),"manageHoverState"in ve&&t(13,B=ve.manageHoverState),"hovered"in ve&&t(0,N=ve.hovered),"eventsIfTopMost"in ve&&t(14,$=ve.eventsIfTopMost),"interactive"in ve&&t(15,j=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[N,u,d,a,_,y,x,S,C,L,P,R,D,B,$,j,i,le,ce,J,te,ye,Ue,oe,l]}class B0 extends Ut{constructor(e){super(),jt(this,e,Gx,Zx,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Wx=Object.defineProperty,F0=r=>{throw TypeError(r)},Hx=(r,e,t)=>e in r?Wx(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,po=(r,e,t)=>Hx(r,typeof e!="symbol"?e+"":e,t),O0=(r,e,t)=>e.has(r)||F0("Cannot "+t),nr=(r,e,t)=>(O0(r,e,"read from private field"),t?t.call(r):e.get(r)),Yg=(r,e,t)=>e.has(r)?F0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Qg=(r,e,t,i)=>(O0(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t);function xn(){}function Xx(r,e){for(const t in e)r[t]=e[t];return r}function N0(r){return r()}function e_(){return Object.create(null)}function Ls(r){r.forEach(N0)}function $0(r){return typeof r=="function"}function sa(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let rd;function Rr(r,e){return r===e?!0:(rd||(rd=document.createElement("a")),rd.href=e,r===rd.href)}function Kx(r){return Object.keys(r).length===0}function Jx(r,e,t,i){if(r){const l=j0(r,e,t,i);return r[0](l)}}function j0(r,e,t,i){return r[1]&&i?Xx(t.ctx.slice(),r[1](i(e))):t.ctx}function Yx(r,e,t,i){if(r[2]&&i){const l=r[2](i(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Qx(r,e,t,i,l,u){if(l){const d=j0(e,t,i,u);r.p(d,l)}}function e2(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function t_(r){return r??""}function Bi(r,e){r.appendChild(e)}function Mn(r,e,t){r.insertBefore(e,t||null)}function kn(r){r.parentNode&&r.parentNode.removeChild(r)}function sn(r){return document.createElement(r)}function Uo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function na(r){return document.createTextNode(r)}function mo(){return na(" ")}function t2(){return na("")}function Wr(r,e,t,i){return r.addEventListener(e,t,i),()=>r.removeEventListener(e,t,i)}function i2(r){return function(e){return e.preventDefault(),r.call(this,e)}}function at(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function n2(r){return Array.from(r.childNodes)}function Ou(r,e){e=""+e,r.data!==e&&(r.data=e)}function i_(r,e){r.value=e??""}function Ao(r,e,t){r.classList.toggle(e,!!t)}function r2(r,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:i})}let Nu;function Iu(r){Nu=r}function U0(){if(!Nu)throw new Error("Function called outside component initialization");return Nu}function o2(r){U0().$$.on_destroy.push(r)}function s2(){const r=U0();return(e,t,{cancelable:i=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=r2(e,t,{cancelable:i});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function n_(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Yl=[],fp=[];let tc=[];const r_=[],a2=Promise.resolve();let pp=!1;function l2(){pp||(pp=!0,a2.then(V0))}function mp(r){tc.push(r)}const Kf=new Set;let Wl=0;function V0(){if(Wl!==0)return;const r=Nu;do{try{for(;Wl<Yl.length;){const e=Yl[Wl];Wl++,Iu(e),c2(e.$$)}}catch(e){throw Yl.length=0,Wl=0,e}for(Iu(null),Yl.length=0,Wl=0;fp.length;)fp.pop()();for(let e=0;e<tc.length;e+=1){const t=tc[e];Kf.has(t)||(Kf.add(t),t())}tc.length=0}while(Yl.length);for(;r_.length;)r_.pop()();pp=!1,Kf.clear(),Iu(r)}function c2(r){if(r.fragment!==null){r.update(),Ls(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(mp)}}function u2(r){const e=[],t=[];tc.forEach(i=>r.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),tc=e}const hd=new Set;let Oa;function dd(){Oa={r:0,c:[],p:Oa}}function fd(){Oa.r||Ls(Oa.c),Oa=Oa.p}function Qn(r,e){r&&r.i&&(hd.delete(r),r.i(e))}function hr(r,e,t,i){if(r&&r.o){if(hd.has(r))return;hd.add(r),Oa.c.push(()=>{hd.delete(r),i&&(t&&r.d(1),i())}),r.o(e)}else i&&i()}function o_(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function h2(r,e){hr(r,1,1,()=>{e.delete(r.key)})}function d2(r,e,t,i,l,u,d,a,_,y,x,S){let C=r.length,L=u.length,P=C;const R={};for(;P--;)R[r[P].key]=P;const D=[],B=new Map,N=new Map,$=[];for(P=L;P--;){const J=S(l,u,P),te=t(J);let ye=d.get(te);ye?$.push(()=>ye.p(J,e)):(ye=y(te,J),ye.c()),B.set(te,D[P]=ye),te in R&&N.set(te,Math.abs(P-R[te]))}const j=new Set,le=new Set;function ce(J){Qn(J,1),J.m(a,x),d.set(J.key,J),x=J.first,L--}for(;C&&L;){const J=D[L-1],te=r[C-1],ye=J.key,Ue=te.key;J===te?(x=J.first,C--,L--):B.has(Ue)?!d.has(ye)||j.has(ye)?ce(J):le.has(Ue)?C--:N.get(ye)>N.get(Ue)?(le.add(ye),ce(J)):(j.add(Ue),C--):(_(te,d),C--)}for(;C--;){const J=r[C];B.has(J.key)||_(J,d)}for(;L;)ce(D[L-1]);return Ls($),D}function ra(r){r&&r.c()}function Es(r,e,t){const{fragment:i,after_update:l}=r.$$;i&&i.m(e,t),mp(()=>{const u=r.$$.on_mount.map(N0).filter($0);r.$$.on_destroy?r.$$.on_destroy.push(...u):Ls(u),r.$$.on_mount=[]}),l.forEach(mp)}function Is(r,e){const t=r.$$;t.fragment!==null&&(u2(t.after_update),Ls(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function f2(r,e){r.$$.dirty[0]===-1&&(Yl.push(r),l2(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function aa(r,e,t,i,l,u,d=null,a=[-1]){const _=Nu;Iu(r);const y=r.$$={fragment:null,ctx:[],props:u,update:xn,not_equal:l,bound:e_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:e_(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(y.root);let x=!1;if(y.ctx=t?t(r,e.props||{},(S,C,...L)=>{const P=L.length?L[0]:C;return y.ctx&&l(y.ctx[S],y.ctx[S]=P)&&(!y.skip_bound&&y.bound[S]&&y.bound[S](P),x&&f2(r,S)),C}):[],y.update(),x=!0,Ls(y.before_update),y.fragment=i?i(y.ctx):!1,e.target){if(e.hydrate){const S=n2(e.target);y.fragment&&y.fragment.l(S),S.forEach(kn)}else y.fragment&&y.fragment.c();e.intro&&Qn(r.$$.fragment),Es(r,e.target,e.anchor),V0()}Iu(_)}class la{constructor(){po(this,"$$"),po(this,"$$set")}$destroy(){Is(this,1),this.$destroy=xn}$on(e,t){if(!$0(t))return xn;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!Kx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const p2="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(p2);function m2(r){let e,t;return{c(){e=Uo("svg"),t=Uo("path"),at(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),at(e,"viewBox","0 0 14 14"),at(e,"width","13"),at(e,"height","13"),at(e,"class","svelte-en2qvf")},m(i,l){Mn(i,e,l),Bi(e,t)},p:xn,i:xn,o:xn,d(i){i&&kn(e)}}}class q0 extends la{constructor(e){super(),aa(this,e,null,m2,sa,{})}}function g2(r){let e,t;return{c(){e=Uo("svg"),t=Uo("path"),at(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),at(e,"viewBox","0 0 30 30"),at(e,"fill","none"),at(e,"xmlns","http://www.w3.org/2000/svg"),at(e,"class","svelte-d2loi5")},m(i,l){Mn(i,e,l),Bi(e,t)},p:xn,i:xn,o:xn,d(i){i&&kn(e)}}}class Z0 extends la{constructor(e){super(),aa(this,e,null,g2,sa,{})}}function _2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"area.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"area.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function y2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"reverse.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"reverse.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function v2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"poi.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"poi.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function b2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"postal_code.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"postal_code.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function w2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"street.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"street.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function x2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"road.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"road.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function k2(r){let e,t;return{c(){e=sn("img"),Rr(e.src,t=r[3]+"housenumber.svg")||at(e,"src",t),at(e,"alt",r[6]),at(e,"class","svelte-ltkwvy")},m(i,l){Mn(i,e,l)},p(i,l){l&8&&!Rr(e.src,t=i[3]+"housenumber.svg")&&at(e,"src",t),l&64&&at(e,"alt",i[6])},d(i){i&&kn(e)}}}function S2(r){let e,t,i,l;return{c(){e=sn("img"),Rr(e.src,t=r[5])||at(e,"src",t),at(e,"alt",r[4]),at(e,"class","svelte-ltkwvy")},m(u,d){Mn(u,e,d),i||(l=Wr(e,"error",r[14]),i=!0)},p(u,d){d&32&&!Rr(e.src,t=u[5])&&at(e,"src",t),d&16&&at(e,"alt",u[4])},d(u){u&&kn(e),i=!1,l()}}}function s_(r){let e,t;return{c(){e=sn("span"),t=na(r[6]),at(e,"class","secondary svelte-ltkwvy")},m(i,l){Mn(i,e,l),Bi(e,t)},p(i,l){l&64&&Ou(t,i[6])},d(i){i&&kn(e)}}}function T2(r){let e,t,i,l,u,d,a,_,y,x=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,C,L=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],P,R,D=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,$;function j(te,ye){return ye&1&&(t=null),ye&1&&(i=null),ye&1&&(l=null),ye&1&&(u=null),te[5]?S2:te[0].address?k2:(t==null&&(t=!!te[0].id.startsWith("road.")),t?x2:(i==null&&(i=!!te[0].id.startsWith("address.")),i?w2:(l==null&&(l=!!te[0].id.startsWith("postal_code.")),l?b2:(u==null&&(u=!!te[0].id.startsWith("poi.")),u?v2:te[7]?y2:_2))))}let le=j(r,-1),ce=le(r),J=L&&s_(r);return{c(){e=sn("li"),ce.c(),d=mo(),a=sn("span"),_=sn("span"),y=sn("span"),S=na(x),C=mo(),J&&J.c(),P=mo(),R=sn("span"),B=na(D),at(y,"class","primary svelte-ltkwvy"),at(_,"class","svelte-ltkwvy"),at(R,"class","line2 svelte-ltkwvy"),at(a,"class","texts svelte-ltkwvy"),at(e,"tabindex","0"),at(e,"data-selected",r[1]),at(e,"class","svelte-ltkwvy"),Ao(e,"selected",r[1])},m(te,ye){Mn(te,e,ye),ce.m(e,null),Bi(e,d),Bi(e,a),Bi(a,_),Bi(_,y),Bi(y,S),Bi(_,C),J&&J.m(_,null),Bi(a,P),Bi(a,R),Bi(R,B),N||($=[Wr(e,"mouseenter",r[12]),Wr(e,"focus",r[13])],N=!0)},p(te,[ye]){le===(le=j(te,ye))&&ce?ce.p(te,ye):(ce.d(1),ce=le(te),ce&&(ce.c(),ce.m(e,d))),ye&1&&x!==(x=(te[7]?te[0].place_name:te[0].place_name.replace(/,.*/,""))+"")&&Ou(S,x),ye&37&&(L=te[2]==="always"||te[2]!=="never"&&!te[0].address&&!te[0].id.startsWith("road.")&&!te[0].id.startsWith("address.")&&!te[0].id.startsWith("postal_code.")&&(!te[0].id.startsWith("poi.")||!te[5])&&!te[7]),L?J?J.p(te,ye):(J=s_(te),J.c(),J.m(_,null)):J&&(J.d(1),J=null),ye&1&&D!==(D=(te[7]?"":te[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Ou(B,D),ye&2&&at(e,"data-selected",te[1]),ye&2&&Ao(e,"selected",te[1])},i:xn,o:xn,d(te){te&&kn(e),ce.d(),J&&J.d(),N=!1,Ls($)}}}function C2(r,e,t){var i;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:y}=e,{iconsBaseUrl:x}=e;const S=(i=d.properties)==null?void 0:i.categories;let C,L,P=0,R=d.place_type[0]==="reverse";function D(){L&&y.add(L),t(10,P++,P)}function B(j){n_.call(this,r,j)}function N(j){n_.call(this,r,j)}const $=()=>D();return r.$$set=j=>{"feature"in j&&t(0,d=j.feature),"selected"in j&&t(1,a=j.selected),"showPlaceType"in j&&t(2,_=j.showPlaceType),"missingIconsCache"in j&&t(9,y=j.missingIconsCache),"iconsBaseUrl"in j&&t(3,x=j.iconsBaseUrl)},r.$$.update=()=>{var j,le,ce,J;if(r.$$.dirty&3640)do t(11,l--,l),t(4,C=S==null?void 0:S[l]),t(5,L=C?x+C.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!L||y.has(L)));r.$$.dirty&1&&t(6,u=((le=(j=d.properties)==null?void 0:j.categories)==null?void 0:le.join(", "))??((J=(ce=d.properties)==null?void 0:ce.place_type_name)==null?void 0:J[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,a,_,x,C,L,u,R,D,y,P,l,B,N,$]}class M2 extends la{constructor(e){super(),aa(this,e,C2,T2,sa,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function E2(r){let e;return{c(){e=sn("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',at(e,"class","svelte-7cmwmc")},m(t,i){Mn(t,e,i)},p:xn,i:xn,o:xn,d(t){t&&kn(e)}}}class I2 extends la{constructor(e){super(),aa(this,e,null,E2,sa,{})}}function L2(r){let e,t,i;return{c(){e=Uo("svg"),t=Uo("path"),at(t,"stroke-width","4"),at(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),at(t,"class","svelte-gzo3ar"),at(e,"width",i=r[0]==="list"?20:void 0),at(e,"viewBox","0 0 70 85"),at(e,"fill","none"),at(e,"class","svelte-gzo3ar"),Ao(e,"in-map",r[0]!=="list"),Ao(e,"list-icon",r[0]==="list")},m(l,u){Mn(l,e,u),Bi(e,t)},p(l,[u]){u&1&&i!==(i=l[0]==="list"?20:void 0)&&at(e,"width",i),u&1&&Ao(e,"in-map",l[0]!=="list"),u&1&&Ao(e,"list-icon",l[0]==="list")},i:xn,o:xn,d(l){l&&kn(e)}}}function A2(r,e,t){let{displayIn:i}=e;return r.$$set=l=>{"displayIn"in l&&t(0,i=l.displayIn)},[i]}class P2 extends la{constructor(e){super(),aa(this,e,A2,L2,sa,{displayIn:0})}}function z2(r){let e,t;return{c(){e=Uo("svg"),t=Uo("path"),at(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),at(e,"viewBox","0 0 60.006 21.412"),at(e,"width","14"),at(e,"height","20"),at(e,"class","svelte-en2qvf")},m(i,l){Mn(i,e,l),Bi(e,t)},p:xn,i:xn,o:xn,d(i){i&&kn(e)}}}class D2 extends la{constructor(e){super(),aa(this,e,null,z2,sa,{})}}function R2(r){let e,t,i;return{c(){e=Uo("svg"),t=Uo("circle"),i=Uo("path"),at(t,"cx","4.789"),at(t,"cy","4.787"),at(t,"r","3.85"),at(t,"class","svelte-1aq105l"),at(i,"d","M12.063 12.063 7.635 7.635"),at(i,"class","svelte-1aq105l"),at(e,"xmlns","http://www.w3.org/2000/svg"),at(e,"width","13"),at(e,"height","13"),at(e,"viewBox","0 0 13 13"),at(e,"class","svelte-1aq105l")},m(l,u){Mn(l,e,u),Bi(e,t),Bi(e,i)},p:xn,i:xn,o:xn,d(l){l&&kn(e)}}}class B2 extends la{constructor(e){super(),aa(this,e,null,R2,sa,{})}}function F2(r,e,t){const i=e[1],l=e[0],u=i-l;return r===i&&t?r:((r-l)%u+u)%u+l}function Sd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let du;async function O2(r,e,t){const i=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(i&&(l.minZoom!=null&&l.minZoom>i[0]||l.maxZoom!=null&&l.maxZoom<i[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(du&&l.cachedLocationExpiry&&du.time+l.cachedLocationExpiry>Date.now()){if(!du.coords)break e;return du.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(y=>y.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(du={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(i&&l.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const N2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,a_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,l_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,c_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,u_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,h_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function $2(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(L=>Number(L.trim())),t=Number(e[0]),i=Number(e[1]),l=Math.abs(t),u=Math.abs(i),d=t>0?"N":"S",a=i>0?"E":"W";let _;r=="DD"&&(_=`${l}° ${d}, ${u}° ${a}`);const y=Math.floor(l),x=Math.floor(u),S=(l-y)*60,C=(u-x)*60;if(r=="DM"){let L=d_(S,3).toFixed(3).padStart(6,"0"),P=d_(C,3).toFixed(3).padStart(6,"0");L.endsWith(".000")&&P.endsWith(".000")&&(L=L.replace(/\.000$/,""),P=P.replace(/\.000$/,"")),_=`${y}° ${L}' ${d}, ${x}° ${P}' ${a}`}if(r=="DMS"){const L=Math.floor(S),P=Math.floor(C);let R=((S-L)*60).toFixed(1).padStart(4,"0"),D=((C-P)*60).toFixed(1).padStart(4,"0");const B=L.toString().padStart(2,"0"),N=P.toString().padStart(2,"0");R.endsWith(".0")&&D.endsWith(".0")&&(R=R.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),_=`${y}° ${B}' ${R}" ${d}, ${x}° ${N}' ${D}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function d_(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Up(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,i=null,l="",u="",d=null,a=[],_=!1;if(N2.test(r))throw new Error("invalid coordinate value");if(a_.test(r))if(a=a_.exec(r),_=fu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),d="DM";else throw new Error("invalid coordinate format");else if(l_.test(r))if(a=l_.exec(r),_=fu(a),_){if(t=a[2],i=a[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(c_.test(r))if(a=c_.exec(r),_=fu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(u_.test(r))if(a=u_.exec(r),_=fu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(h_.test(r)){if(a=h_.exec(r),_=fu(a),a.filter(y=>y).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let y=/S|SOUTH/i;y.test(l)&&t>0&&(t=-1*t),y=/W|WEST/i,y.test(u)&&i>0&&(i=-1*i);const x=a[0].trim();let S,C;const L=/[,/;\u0020]/g,P=x.match(L);if(P==null){const B=Math.floor(r.length/2);S=x.substring(0,B).trim(),C=x.substring(B).trim()}else{let B;P.length%2==1?B=Math.floor(P.length/2):B=P.length/2-1;let N=0;if(B==0)N=x.indexOf(P[0]),S=x.substring(0,N).trim(),C=x.substring(N+1).trim();else{let $=0,j=0;for(;$<=B;)N=x.indexOf(P[$],j),j=N+1,$++;S=x.substring(0,N).trim(),C=x.substring(N+1).trim()}}const R=S.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const D=C.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:x,verbatimLatitude:S,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:d,closeEnough:j2,toCoordinateFormat:$2})}else throw new Error("coordinates pattern match failed")}function fu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),y=i.test(d)&&i.test(a),x=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||y||x)continue;return!1}}return!0}function f_(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function j2(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return f_(this.decimalLatitude,Number(e[0]))&&f_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const U2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Up.to=U2;const V2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],q2={decimalLatitude:40.123,decimalLongitude:-74.123},Z2=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],G2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function W2(){const r=[];return V2.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...q2})}),[...r,...Z2,...G2]}const H2=W2();Up.formats=H2.map(r=>r.verbatimCoordinates);const X2=Up;function p_(r,e,t){const i=r.slice();return i[84]=e[t],i[86]=t,i}function m_(r){let e,t;return e=new I2({}),{c(){ra(e.$$.fragment)},m(i,l){Es(e,i,l),t=!0},i(i){t||(Qn(e.$$.fragment,i),t=!0)},o(i){hr(e.$$.fragment,i),t=!1},d(i){Is(e,i)}}}function g_(r){let e,t,i,l,u;return t=new D2({}),{c(){e=sn("button"),ra(t.$$.fragment),at(e,"type","button"),at(e,"title",r[9]),at(e,"class","svelte-bz0zu3"),Ao(e,"active",r[0])},m(d,a){Mn(d,e,a),Es(t,e,null),i=!0,l||(u=Wr(e,"click",r[69]),l=!0)},p(d,a){(!i||a[0]&512)&&at(e,"title",d[9]),(!i||a[0]&1)&&Ao(e,"active",d[0])},i(d){i||(Qn(t.$$.fragment,d),i=!0)},o(d){hr(t.$$.fragment,d),i=!1},d(d){d&&kn(e),Is(t),l=!1,u()}}}function K2(r){let e,t=[],i=new Map,l,u,d,a=o_(r[14]);const _=y=>y[84].id+(y[84].address?","+y[84].address:"");for(let y=0;y<a.length;y+=1){let x=p_(r,a,y),S=_(x);i.set(S,t[y]=__(S,x))}return{c(){e=sn("ul");for(let y=0;y<t.length;y+=1)t[y].c();at(e,"class","options svelte-bz0zu3")},m(y,x){Mn(y,e,x);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Wr(e,"mouseleave",r[73]),Wr(e,"blur",r[74])],u=!0)},p(y,x){x[0]&17880064&&(a=o_(y[14]),dd(),t=d2(t,x,_,1,y,a,i,e,h2,__,null,p_),fd())},i(y){if(!l){for(let x=0;x<a.length;x+=1)Qn(t[x]);l=!0}},o(y){for(let x=0;x<t.length;x+=1)hr(t[x]);l=!1},d(y){y&&kn(e);for(let x=0;x<t.length;x+=1)t[x].d();u=!1,Ls(d)}}}function J2(r){let e,t,i,l,u,d;return t=new Z0({}),{c(){e=sn("div"),ra(t.$$.fragment),i=mo(),l=sn("div"),u=na(r[7]),at(l,"class","svelte-bz0zu3"),at(e,"class","no-results svelte-bz0zu3")},m(a,_){Mn(a,e,_),Es(t,e,null),Bi(e,i),Bi(e,l),Bi(l,u),d=!0},p(a,_){(!d||_[0]&128)&&Ou(u,a[7])},i(a){d||(Qn(t.$$.fragment,a),d=!0)},o(a){hr(t.$$.fragment,a),d=!1},d(a){a&&kn(e),Is(t)}}}function Y2(r){let e="",t;return{c(){t=na(e)},m(i,l){Mn(i,t,l)},p:xn,i:xn,o:xn,d(i){i&&kn(t)}}}function Q2(r){let e,t,i,l,u,d,a,_,y,x,S;return t=new Z0({}),_=new q0({}),{c(){e=sn("div"),ra(t.$$.fragment),i=mo(),l=sn("div"),u=na(r[6]),d=mo(),a=sn("button"),ra(_.$$.fragment),at(l,"class","svelte-bz0zu3"),at(a,"class","svelte-bz0zu3"),at(e,"class","error svelte-bz0zu3")},m(C,L){Mn(C,e,L),Es(t,e,null),Bi(e,i),Bi(e,l),Bi(l,u),Bi(e,d),Bi(e,a),Es(_,a,null),y=!0,x||(S=Wr(a,"click",r[70]),x=!0)},p(C,L){(!y||L[0]&64)&&Ou(u,C[6])},i(C){y||(Qn(t.$$.fragment,C),Qn(_.$$.fragment,C),y=!0)},o(C){hr(t.$$.fragment,C),hr(_.$$.fragment,C),y=!1},d(C){C&&kn(e),Is(t),Is(_),x=!1,S()}}}function __(r,e){let t,i,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return i=new M2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),i.$on("mouseenter",u),i.$on("focus",d),{key:r,first:null,c(){t=t2(),ra(i.$$.fragment),this.first=t},m(a,_){Mn(a,t,_),Es(i,a,_),l=!0},p(a,_){e=a;const y={};_[0]&16384&&(y.feature=e[84]),_[0]&1024&&(y.showPlaceType=e[10]),_[0]&49152&&(y.selected=e[15]===e[86]),_[0]&4096&&(y.iconsBaseUrl=e[12]),i.$set(y)},i(a){l||(Qn(i.$$.fragment,a),l=!0)},o(a){hr(i.$$.fragment,a),l=!1},d(a){a&&kn(t),Is(i,a)}}}function ek(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B,N,$,j,le,ce=!1;u=new B2({}),S=new q0({});let J=r[19]&&m_(),te=r[5]==="button"&&g_(r);const ye=r[61].default,Ue=Jx(ye,r,r[60],null),oe=[Q2,Y2,J2,K2],ve=[];function st(ze,Qe){var wt,pt;return ze[18]?0:ze[16]?((wt=ze[14])==null?void 0:wt.length)===0?2:ze[16]&&(pt=ze[14])!=null&&pt.length?3:-1:1}return~(D=st(r))&&(B=ve[D]=oe[D](r)),{c(){e=mo(),t=sn("form"),i=sn("div"),l=sn("button"),ra(u.$$.fragment),d=mo(),a=sn("input"),_=mo(),y=sn("div"),x=sn("button"),ra(S.$$.fragment),C=mo(),J&&J.c(),L=mo(),te&&te.c(),P=mo(),Ue&&Ue.c(),R=mo(),B&&B.c(),at(l,"class","search-button svelte-bz0zu3"),at(l,"type","button"),at(a,"placeholder",r[8]),at(a,"aria-label",r[8]),at(a,"class","svelte-bz0zu3"),at(x,"type","button"),at(x,"title",r[3]),at(x,"class","svelte-bz0zu3"),at(y,"class","clear-button-container svelte-bz0zu3"),Ao(y,"displayable",r[1]!==""),at(i,"class","input-group svelte-bz0zu3"),at(t,"tabindex","0"),at(t,"class",N=t_(r[2])+" svelte-bz0zu3"),Ao(t,"can-collapse",r[4]&&r[1]==="")},m(ze,Qe){Mn(ze,e,Qe),Mn(ze,t,Qe),Bi(t,i),Bi(i,l),Es(u,l,null),Bi(i,d),Bi(i,a),r[63](a),i_(a,r[1]),Bi(i,_),Bi(i,y),Bi(y,x),Es(S,x,null),Bi(y,C),J&&J.m(y,null),Bi(i,L),te&&te.m(i,null),Bi(i,P),Ue&&Ue.m(i,null),Bi(t,R),~D&&ve[D].m(t,null),$=!0,j||(le=[Wr(l,"click",r[62]),Wr(a,"input",r[64]),Wr(a,"focus",r[65]),Wr(a,"blur",r[66]),Wr(a,"keydown",r[22]),Wr(a,"input",r[67]),Wr(x,"click",r[68]),Wr(t,"submit",i2(r[21]))],j=!0)},p(ze,Qe){(!$||Qe[0]&256)&&at(a,"placeholder",ze[8]),(!$||Qe[0]&256)&&at(a,"aria-label",ze[8]),Qe[0]&2&&a.value!==ze[1]&&i_(a,ze[1]),(!$||Qe[0]&8)&&at(x,"title",ze[3]),ze[19]?J?Qe[0]&524288&&Qn(J,1):(J=m_(),J.c(),Qn(J,1),J.m(y,null)):J&&(dd(),hr(J,1,1,()=>{J=null}),fd()),(!$||Qe[0]&2)&&Ao(y,"displayable",ze[1]!==""),ze[5]==="button"?te?(te.p(ze,Qe),Qe[0]&32&&Qn(te,1)):(te=g_(ze),te.c(),Qn(te,1),te.m(i,P)):te&&(dd(),hr(te,1,1,()=>{te=null}),fd()),Ue&&Ue.p&&(!$||Qe[1]&536870912)&&Qx(Ue,ye,ze,ze[60],$?Yx(ye,ze[60],Qe,null):e2(ze[60]),null);let wt=D;D=st(ze),D===wt?~D&&ve[D].p(ze,Qe):(B&&(dd(),hr(ve[wt],1,1,()=>{ve[wt]=null}),fd()),~D?(B=ve[D],B?B.p(ze,Qe):(B=ve[D]=oe[D](ze),B.c()),Qn(B,1),B.m(t,null)):B=null),(!$||Qe[0]&4&&N!==(N=t_(ze[2])+" svelte-bz0zu3"))&&at(t,"class",N),(!$||Qe[0]&22)&&Ao(t,"can-collapse",ze[4]&&ze[1]==="")},i(ze){$||(Qn(ce),Qn(u.$$.fragment,ze),Qn(S.$$.fragment,ze),Qn(J),Qn(te),Qn(Ue,ze),Qn(B),$=!0)},o(ze){hr(ce),hr(u.$$.fragment,ze),hr(S.$$.fragment,ze),hr(J),hr(te),hr(Ue,ze),hr(B),$=!1},d(ze){ze&&(kn(e),kn(t)),Is(u),r[63](null),Is(S),J&&J.d(),te&&te.d(),Ue&&Ue.d(ze),~D&&ve[D].d(),j=!1,Ls(le)}}}function tk(r,e,t){let i,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:y}=e,{bbox:x=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:L=!1}=e,{country:P=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:D="never"}=e,{errorMessage:B="Something went wrong…"}=e,{filter:N=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:j=!0}=e,{language:le=void 0}=e,{limit:ce=void 0}=e,{mapController:J=void 0}=e,{minLength:te=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ue="Search"}=e,{proximity:oe=[{type:"server-geolocation"}]}=e,{reverseActive:ve=D==="always"}=e,{reverseButtonTitle:st="toggle reverse geocoding"}=e,{searchValue:ze=""}=e,{pickedResultStyle:Qe="full-geometry"}=e,{showPlaceType:wt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:nt=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:oi=!0}=e,{types:Dt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:ti=!1}=e,{zoom:Pt=a}=e,{apiUrl:Rt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ct={}}=e,{iconsBaseUrl:Jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Yt=()=>{}}=e;function Ei(){qe.focus()}function Fi(){qe.blur()}function ht(G,$e=!0,Ve=!1){t(1,ze=G),$e?(t(15,Je=-1),rt()):(ni(!Ve,Ve),setTimeout(()=>{qe.focus(),qe.select()}))}function Ot(){t(14,dt=void 0),t(56,we=void 0),t(15,Je=-1)}function Fe(){t(55,bt=[]),t(56,we=void 0)}let Ne=!1,dt,bt,we,Ii="",qe,Je=-1,Vt,Pi=[],wi,gn,In,tn;const io=new Set,Oi=s2();o2(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function rt(G){if(gn&&(clearTimeout(gn),gn=void 0),Je>-1&&dt)t(56,we=dt[Je]),t(1,ze=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,Vt=void 0),t(55,bt=void 0),t(15,Je=-1);else if(ze){const $e=G||!Li(ze);ii(ze,{exact:!0}).then(()=>{t(55,bt=dt),t(56,we=void 0),$e&&Ni()}).catch(Ve=>t(18,Vt=Ve))}}function Li(G){try{return X2(G,6)}catch{return!1}}async function ii(G,{byId:$e=!1,exact:Ve=!1}={}){t(18,Vt=void 0),wi==null||wi.abort();const Ge=new AbortController;t(19,wi=Ge);try{const Ke=Li(G),ft=new URLSearchParams;if(le!==void 0&&ft.set("language",Array.isArray(le)?le.join(","):le??""),Dt&&ft.set("types",Dt.join(",")),ti&&ft.set("excludeTypes",String(ti)),x&&ft.set("bbox",x.map(xi=>xi.toFixed(6)).join(",")),P&&ft.set("country",Array.isArray(P)?P.join(","):P),!$e&&!Ke){const xi=await O2(J,oe,Ge);xi&&ft.set("proximity",xi),(Ve||!pt)&&ft.set("autocomplete","false"),ft.set("fuzzyMatch",String(j))}ce!==void 0&&(mt||!Ke||(Dt==null?void 0:Dt.length)===1)&&ft.set("limit",String(ce)),ft.set("key",y),Yt(ft);const Nt=Rt+"/"+encodeURIComponent(Ke?Ke.decimalLongitude+","+Ke.decimalLatitude:G)+".json?"+ft.toString();if(Nt===Ii){$e?(t(14,dt=void 0),t(56,we=Pi[0])):t(14,dt=Pi);return}Ii=Nt;const Qt=await fetch(Nt,{signal:Ge.signal,...ct});if(!Qt.ok)throw new Error(await Qt.text());const hi=await Qt.json();Oi("response",{url:Nt,featureCollection:hi}),$e?(t(14,dt=void 0),t(56,we=hi.features[0]),Pi=[we]):(t(14,dt=hi.features.filter(N)),Ke&&dt.unshift({type:"Feature",properties:{},id:"reverse_"+Ke.decimalLongitude+"_"+Ke.decimalLatitude,text:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_name:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_type:["reverse"],center:[Ke.decimalLongitude,Ke.decimalLatitude],bbox:[Ke.decimalLongitude,Ke.decimalLatitude,Ke.decimalLongitude,Ke.decimalLatitude],geometry:{type:"Point",coordinates:[Ke.decimalLongitude,Ke.decimalLatitude]}}),Pi=dt,Ke&&qe.focus())}catch(Ke){if(Ke&&typeof Ke=="object"&&"name"in Ke&&Ke.name==="AbortError")return;throw Ke}finally{Ge===wi&&t(19,wi=void 0)}}function Ni(){var G;if(!(bt!=null&&bt.length)||!$)return;const $e=[180,90,-180,-90],Ve=!bt.some(Ke=>!Ke.matching_text);let Ge;for(const Ke of bt){const ft=Ki(Ke);if(Ge=Ge===void 0?ft:ft===void 0?Ge:Math.max(Ge,ft),Ve||!Ke.matching_text)for(const Nt of[0,1,2,3])$e[Nt]=Math[Nt<2?"min":"max"]($e[Nt],((G=Ke.bbox)==null?void 0:G[Nt])??Ke.center[Nt%2])}J&&bt.length>0&&(we&&$e[0]===$e[2]&&$e[1]===$e[3]?J.flyTo(we.center,Ki(we)):J.fitBounds(Sd($e),50,Ge))}function Ki(G){var $e;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ve=G.id.replace(/\..*/,"");return(Array.isArray(($e=G.properties)==null?void 0:$e.categories)?G.properties.categories.reduce((Ge,Ke)=>{const ft=Pt[Ve+"."+Ke];return Ge===void 0?ft:ft===void 0?Ge:Math.max(Ge,ft)},void 0):void 0)??Pt[Ve]}function yt(G){t(0,ve=D==="always"),t(14,dt=void 0),t(56,we=void 0),t(15,Je=-1),ht(G[1].toFixed(6)+", "+F2(G[0],[-180,180],!0).toFixed(6),!1,!0)}function li(G){if(!dt)return;let $e=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;$e&&(Je===(nt?0:-1)&&$e===-1&&t(15,Je=dt.length),t(15,Je+=$e),Je>=dt.length&&t(15,Je=-1),Je<0&&nt&&t(15,Je=0),G.preventDefault())}function ni(G=!0,$e=!1){if(t(18,Vt=void 0),pt||$e){if(gn&&clearTimeout(gn),ze.length<te)return;const Ve=ze;gn=window.setTimeout(()=>{ii(Ve).catch(Ge=>t(18,Vt=Ge))},G?R:0)}else t(14,dt=void 0),t(18,Vt=void 0)}function Ji(G){t(56,we=G),t(1,ze=G.place_name),t(15,Je=-1)}const xr=()=>qe.focus();function si(G){fp[G?"unshift":"push"](()=>{qe=G,t(17,qe)})}function no(){ze=this.value,t(1,ze),t(13,Ne),t(28,C)}const _n=()=>t(13,Ne=!0),me=()=>t(13,Ne=!1),W=()=>ni(),X=()=>{t(1,ze=""),qe.focus()},ne=()=>t(0,ve=!ve),de=()=>t(18,Vt=void 0),Ae=G=>t(15,Je=G),Pe=G=>Ji(G),Be=()=>{nt||t(15,Je=-1)},Me=()=>{};return r.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,y=G.apiKey),"bbox"in G&&t(27,x=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,C=G.clearOnBlur),"collapsed"in G&&t(4,L=G.collapsed),"country"in G&&t(29,P=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,D=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,$=G.flyTo),"fuzzyMatch"in G&&t(33,j=G.fuzzyMatch),"language"in G&&t(34,le=G.language),"limit"in G&&t(35,ce=G.limit),"mapController"in G&&t(36,J=G.mapController),"minLength"in G&&t(37,te=G.minLength),"noResultsMessage"in G&&t(7,ye=G.noResultsMessage),"placeholder"in G&&t(8,Ue=G.placeholder),"proximity"in G&&t(38,oe=G.proximity),"reverseActive"in G&&t(0,ve=G.reverseActive),"reverseButtonTitle"in G&&t(9,st=G.reverseButtonTitle),"searchValue"in G&&t(1,ze=G.searchValue),"pickedResultStyle"in G&&t(39,Qe=G.pickedResultStyle),"showPlaceType"in G&&t(10,wt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,nt=G.selectFirst),"flyToSelected"in G&&t(41,Ht=G.flyToSelected),"markerOnSelected"in G&&t(42,oi=G.markerOnSelected),"types"in G&&t(43,Dt=G.types),"exhaustiveReverseGeocoding"in G&&t(44,mt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,ti=G.excludeTypes),"zoom"in G&&t(46,Pt=G.zoom),"apiUrl"in G&&t(47,Rt=G.apiUrl),"fetchParameters"in G&&t(48,ct=G.fetchParameters),"iconsBaseUrl"in G&&t(12,Jt=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,Yt=G.adjustUrlQuery),"$$scope"in G&&t(60,d=G.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ve=D==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,In=Ne),C&&!Ne&&t(1,ze="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ze.length<te&&(t(56,we=void 0),t(14,dt=void 0),t(18,Vt=void 0),t(55,bt=dt)),r.$$.dirty[1]&33554688&&Qe!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&ii(we.id,{byId:!0}).catch(G=>t(18,Vt=G)),r.$$.dirty[1]&100663330&&(J&&we&&we.id!==tn&&$&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?J.flyTo(we.center,Ki(we)):J.fitBounds(Sd(we.bbox),50,Ki(we)),t(14,dt=void 0),t(55,bt=void 0),t(15,Je=-1)),t(57,tn=we==null?void 0:we.id)),r.$$.dirty[0]&18432&&nt&&dt!=null&&dt.length&&t(15,Je=0),r.$$.dirty[0]&2&&t(15,Je=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&bt!==dt&&t(55,bt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(G=>{switch(G.type){case"mapClick":ve&&yt(G.coordinates);break;case"markerClick":{const $e=dt==null?void 0:dt.find(Ve=>Ve.id===G.id);$e&&Ji($e)}break;case"markerMouseEnter":bt&&t(15,Je=In?(dt==null?void 0:dt.findIndex($e=>$e.id===G.id))??-1:-1);break;case"markerMouseLeave":bt&&t(15,Je=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=dt==null?void 0:dt[Je]),r.$$.dirty[1]&134218786&&J&&l&&$&&Ht&&J.flyTo(l.center,Ki(l)),r.$$.dirty[1]&256&&t(59,i=Qe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(oi||J==null||J.setFeatures(void 0,void 0,i)),r.$$.dirty[1]&419432480&&J&&oi&&!bt&&(J.setFeatures(l?[l]:void 0,void 0,i),J.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(bt,we,i),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&bt&&J&&J.setSelectedMarker(Je),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const G=Li(ze);J.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Oi("select",{feature:l}),r.$$.dirty[1]&33554432&&Oi("pick",{feature:we}),r.$$.dirty[0]&81920&&Oi("optionsvisibilitychange",{optionsVisible:In&&!!dt}),r.$$.dirty[0]&16384&&Oi("featureslisted",{features:dt}),r.$$.dirty[1]&16777216&&Oi("featuresmarked",{features:bt}),r.$$.dirty[0]&1&&Oi("reversetoggle",{reverse:ve}),r.$$.dirty[0]&2&&Oi("querychange",{query:ze}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ve)},[ve,ze,_,S,L,D,B,ye,Ue,st,wt,nt,Jt,Ne,dt,Je,In,qe,Vt,wi,io,rt,li,ni,Ji,a,y,x,C,P,R,N,$,j,le,ce,J,te,oe,Qe,pt,Ht,oi,Dt,mt,ti,Pt,Rt,ct,Yt,Ei,Fi,ht,Ot,Fe,bt,we,tn,l,i,d,u,xr,si,no,_n,me,W,X,ne,de,Ae,Pe,Be,Me]}let ik=class extends la{constructor(r){super(),aa(this,r,tk,ek,sa,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function $u(r,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function Vp(r,e,t={}){for(const i of r){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<i[i.length-1].length;l++)if(i[i.length-1][l]!==i[0][l])throw new Error("First and last Position are not equivalent.")}return $u({type:"Polygon",coordinates:r},e,t)}function ju(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function G0(r,e,t={}){return $u({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function nk(r,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(y){return function(x){return _([y,x])}}function _(y){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,l&&(u=y[0]&2?l.return:y[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,y[1])).done)return u;switch(l=0,u&&(y=[y[0]&2,u.value]),y[0]){case 0:case 1:u=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,l=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!u||y[1]>u[0]&&y[1]<u[3])){t.label=y[1];break}if(y[0]===6&&t.label<u[1]){t.label=u[1],u=y;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(y);break}u[2]&&t.ops.pop(),t.trys.pop();continue}y=e.call(r,t)}catch(x){y=[6,x],l=0}finally{i=u=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}var oa=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function rk(r,e){return r>e?1:r<e?-1:0}function Ks(r,e,t){for(var i=new oa(null,null),l=i,u=i;;){var d=t(r,e.key);if(d<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=i.right,e.right=i.left,e}function Jf(r,e,t,i){var l=new oa(r,e);if(t===null)return l.left=l.right=null,l;t=Ks(r,t,i);var u=i(r,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function y_(r,e,t){var i=null,l=null;if(e){e=Ks(r,e,t);var u=t(e.key,r);u===0?(i=e.left,l=e.right):u<0?(l=e.right,e.right=null,i=e):(i=e.left,e.left=null,l=e)}return{left:i,right:l}}function ok(r,e,t){return e===null?r:(r===null||(e=Ks(r.key,e,t),e.left=r),e)}function gp(r,e,t,i,l){if(r){i(""+e+(t?"└── ":"├── ")+l(r)+`
`);var u=e+(t?"    ":"│   ");r.left&&gp(r.left,u,!1,i,l),r.right&&gp(r.right,u,!0,i,l)}}var qp=function(){function r(e){e===void 0&&(e=rk),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Jf(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var i=new oa(e,t);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var l=this._comparator,u=Ks(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(i.left=u.left,i.right=u,u.left=null):d>0&&(i.right=u.right,i.left=u,u.right=null),this._size++,this._root=i),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,i){var l;if(t===null)return null;t=Ks(e,t,i);var u=i(e,t.key);return u===0?(t.left===null?l=t.right:(l=Ks(e,t.left,i),l.right=t.right),this._size--,l):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ks(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var l=i(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ks(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var l=i(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var i=this._root,l=[],u=!1;!u;)i!==null?(l.push(i),i=i.left):l.length!==0?(i=l.pop(),e.call(t,i),i=i.right):u=!0;return this},r.prototype.range=function(e,t,i,l){for(var u=[],d=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=d(a.key,t),_>0)break;if(d(a.key,e)>=0&&i.call(l,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var i=t.key;return e.push(i)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var i=t.data;return e.push(i)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,i=!1,l=0,u=[];!i;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else i=!0;return null},r.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(i=t,t=t.left):t=t.right}return i},r.prototype.prev=function(e){var t=this._root,i=null;if(e.left!==null){for(i=e.left;i.right;)i=i.right;return i}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(i=t,t=t.right)}return i},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return ak(this._root)},r.prototype.load=function(e,t,i){t===void 0&&(t=[]),i===void 0&&(i=!1);var l=e.length,u=this._comparator;if(i&&vp(e,t,0,l-1,u),this._root===null)this._root=_p(e,t,0,l),this._size=l;else{var d=lk(this.toList(),sk(e,t),u);l=this._size+l,this._root=yp({head:d},0,l)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(i){return String(i.key)});var t=[];return gp(this._root,"",!0,function(i){return t.push(i)},e),t.join("")},r.prototype.update=function(e,t,i){var l=this._comparator,u=y_(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=Jf(t,i,a,l):d=Jf(t,i,d,l),this._root=ok(d,a,l)},r.prototype.split=function(e){return y_(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,i;return nk(this,function(l){switch(l.label){case 0:e=this._root,t=[],i=!1,l.label=1;case 1:return i?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:i=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function _p(r,e,t,i){var l=i-t;if(l>0){var u=t+Math.floor(l/2),d=r[u],a=e[u],_=new oa(d,a);return _.left=_p(r,e,t,u),_.right=_p(r,e,u+1,i),_}return null}function sk(r,e){for(var t=new oa(null,null),i=t,l=0;l<r.length;l++)i=i.next=new oa(r[l],e[l]);return i.next=null,t.next}function ak(r){for(var e=r,t=[],i=!1,l=new oa(null,null),u=l;!i;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):i=!0;return u.next=null,l.next}function yp(r,e,t){var i=t-e;if(i>0){var l=e+Math.floor(i/2),u=yp(r,e,l),d=r.head;return d.left=u,r.head=r.head.next,d.right=yp(r,l+1,t),d}return null}function lk(r,e,t){for(var i=new oa(null,null),l=i,u=r,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),i.next}function vp(r,e,t,i,l){if(!(t>=i)){for(var u=r[t+i>>1],d=t-1,a=i+1;;){do d++;while(l(r[d],u)<0);do a--;while(l(r[a],u)>0);if(d>=a)break;var _=r[d];r[d]=r[a],r[a]=_,_=e[d],e[d]=e[a],e[a]=_}vp(r,e,t,a,l),vp(r,e,a+1,i,l)}}const Ts=11102230246251565e-32,Pr=134217729,ck=(3+8*Ts)*Ts;function Yf(r,e,t,i,l){let u,d,a,_,y=e[0],x=i[0],S=0,C=0;x>y==x>-y?(u=y,y=e[++S]):(u=x,x=i[++C]);let L=0;if(S<r&&C<t)for(x>y==x>-y?(d=y+u,a=u-(d-y),y=e[++S]):(d=x+u,a=u-(d-x),x=i[++C]),u=d,a!==0&&(l[L++]=a);S<r&&C<t;)x>y==x>-y?(d=u+y,_=d-u,a=u-(d-_)+(y-_),y=e[++S]):(d=u+x,_=d-u,a=u-(d-_)+(x-_),x=i[++C]),u=d,a!==0&&(l[L++]=a);for(;S<r;)d=u+y,_=d-u,a=u-(d-_)+(y-_),y=e[++S],u=d,a!==0&&(l[L++]=a);for(;C<t;)d=u+x,_=d-u,a=u-(d-_)+(x-_),x=i[++C],u=d,a!==0&&(l[L++]=a);return(u!==0||L===0)&&(l[L++]=u),L}function uk(r,e){let t=e[0];for(let i=1;i<r;i++)t+=e[i];return t}function Wu(r){return new Float64Array(r)}const hk=(3+16*Ts)*Ts,dk=(2+12*Ts)*Ts,fk=(9+64*Ts)*Ts*Ts,Hl=Wu(4),v_=Wu(8),b_=Wu(12),w_=Wu(16),Zr=Wu(4);function pk(r,e,t,i,l,u,d){let a,_,y,x,S,C,L,P,R,D,B,N,$,j,le,ce,J,te;const ye=r-l,Ue=t-l,oe=e-u,ve=i-u;j=ye*ve,C=Pr*ye,L=C-(C-ye),P=ye-L,C=Pr*ve,R=C-(C-ve),D=ve-R,le=P*D-(j-L*R-P*R-L*D),ce=oe*Ue,C=Pr*oe,L=C-(C-oe),P=oe-L,C=Pr*Ue,R=C-(C-Ue),D=Ue-R,J=P*D-(ce-L*R-P*R-L*D),B=le-J,S=le-B,Hl[0]=le-(B+S)+(S-J),N=j+B,S=N-j,$=j-(N-S)+(B-S),B=$-ce,S=$-B,Hl[1]=$-(B+S)+(S-ce),te=N+B,S=te-N,Hl[2]=N-(te-S)+(B-S),Hl[3]=te;let st=uk(4,Hl),ze=dk*d;if(st>=ze||-st>=ze||(S=r-ye,a=r-(ye+S)+(S-l),S=t-Ue,y=t-(Ue+S)+(S-l),S=e-oe,_=e-(oe+S)+(S-u),S=i-ve,x=i-(ve+S)+(S-u),a===0&&_===0&&y===0&&x===0)||(ze=fk*d+ck*Math.abs(st),st+=ye*x+ve*a-(oe*y+Ue*_),st>=ze||-st>=ze))return st;j=a*ve,C=Pr*a,L=C-(C-a),P=a-L,C=Pr*ve,R=C-(C-ve),D=ve-R,le=P*D-(j-L*R-P*R-L*D),ce=_*Ue,C=Pr*_,L=C-(C-_),P=_-L,C=Pr*Ue,R=C-(C-Ue),D=Ue-R,J=P*D-(ce-L*R-P*R-L*D),B=le-J,S=le-B,Zr[0]=le-(B+S)+(S-J),N=j+B,S=N-j,$=j-(N-S)+(B-S),B=$-ce,S=$-B,Zr[1]=$-(B+S)+(S-ce),te=N+B,S=te-N,Zr[2]=N-(te-S)+(B-S),Zr[3]=te;const Qe=Yf(4,Hl,4,Zr,v_);j=ye*x,C=Pr*ye,L=C-(C-ye),P=ye-L,C=Pr*x,R=C-(C-x),D=x-R,le=P*D-(j-L*R-P*R-L*D),ce=oe*y,C=Pr*oe,L=C-(C-oe),P=oe-L,C=Pr*y,R=C-(C-y),D=y-R,J=P*D-(ce-L*R-P*R-L*D),B=le-J,S=le-B,Zr[0]=le-(B+S)+(S-J),N=j+B,S=N-j,$=j-(N-S)+(B-S),B=$-ce,S=$-B,Zr[1]=$-(B+S)+(S-ce),te=N+B,S=te-N,Zr[2]=N-(te-S)+(B-S),Zr[3]=te;const wt=Yf(Qe,v_,4,Zr,b_);j=a*x,C=Pr*a,L=C-(C-a),P=a-L,C=Pr*x,R=C-(C-x),D=x-R,le=P*D-(j-L*R-P*R-L*D),ce=_*y,C=Pr*_,L=C-(C-_),P=_-L,C=Pr*y,R=C-(C-y),D=y-R,J=P*D-(ce-L*R-P*R-L*D),B=le-J,S=le-B,Zr[0]=le-(B+S)+(S-J),N=j+B,S=N-j,$=j-(N-S)+(B-S),B=$-ce,S=$-B,Zr[1]=$-(B+S)+(S-ce),te=N+B,S=te-N,Zr[2]=N-(te-S)+(B-S),Zr[3]=te;const pt=Yf(wt,b_,4,Zr,w_);return w_[pt-1]}function mk(r,e,t,i,l,u){const d=(e-u)*(t-l),a=(r-l)*(i-u),_=d-a,y=Math.abs(d+a);return Math.abs(_)>=hk*y?_:-pk(r,e,t,i,l,u,y)}const pu=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,bp=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,i=r.ur.x<e.ur.x?r.ur.x:e.ur.x,l=r.ll.y<e.ll.y?e.ll.y:r.ll.y,u=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:i,y:u}}};let Ys=Number.EPSILON;Ys===void 0&&(Ys=Math.pow(2,-52));const gk=Ys*Ys,x_=(r,e)=>{if(-Ys<r&&r<Ys&&-Ys<e&&e<Ys)return 0;const t=r-e;return t*t<gk*r*e?0:r<e?-1:1};class _k{constructor(){this.reset()}reset(){this.xRounder=new k_,this.yRounder=new k_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class k_{constructor(){this.tree=new qp,this.round(0)}round(e){const t=this.tree.add(e),i=this.tree.prev(t);if(i!==null&&x_(t.key,i.key)===0)return this.tree.remove(e),i.key;const l=this.tree.next(t);return l!==null&&x_(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const Uu=new _k,pd=(r,e)=>r.x*e.y-r.y*e.x,W0=(r,e)=>r.x*e.x+r.y*e.y,S_=(r,e,t)=>{const i=mk(r.x,r.y,e.x,e.y,t.x,t.y);return i>0?-1:i<0?1:0},Td=r=>Math.sqrt(W0(r,r)),yk=(r,e,t)=>{const i={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return pd(l,i)/Td(l)/Td(i)},vk=(r,e,t)=>{const i={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return W0(l,i)/Td(l)/Td(i)},T_=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},C_=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},bk=(r,e,t,i)=>{if(e.x===0)return C_(t,i,r.x);if(i.x===0)return C_(r,e,t.x);if(e.y===0)return T_(t,i,r.y);if(i.y===0)return T_(r,e,t.y);const l=pd(e,i);if(l==0)return null;const u={x:t.x-r.x,y:t.y-r.y},d=pd(u,e)/l,a=pd(u,i)/l,_=r.x+a*e.x,y=t.x+d*i.x,x=r.y+a*e.y,S=t.y+d*i.y,C=(_+y)/2,L=(x+S)/2;return{x:C,y:L}};class Eo{static compare(e,t){const i=Eo.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:ta.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,l=t.length;i<l;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,i=l=>{const u=l.otherSE;t.set(l,{sine:yk(this.point,e.point,u.point),cosine:vk(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||i(l),t.has(u)||i(u);const{sine:d,cosine:a}=t.get(l),{sine:_,cosine:y}=t.get(u);return d>=0&&_>=0?a<y?1:a>y?-1:0:d<0&&_<0?a<y?-1:a>y?1:0:_<d?-1:_>d?1:0}}}let wk=0;class ta{static compare(e,t){const i=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<i)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,y=e.rightSE.point.y,x=t.rightSE.point.y;if(i<l){if(_<a&&_<y)return 1;if(_>a&&_>y)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const C=t.comparePoint(e.rightSE.point);return C!==0?C:-1}if(i>l){if(a<_&&a<x)return-1;if(a>_&&a>x)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const C=e.comparePoint(t.rightSE.point);return C<0?1:C>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=y-a,C=u-i,L=x-_,P=d-l;if(S>C&&L<P)return 1;if(S<C&&L>P)return-1}return u>d?1:u<d||y<x?-1:y>x?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,l){this.id=++wk,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=l}static fromRing(e,t,i){let l,u,d;const a=Eo.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new Eo(l,!0),y=new Eo(u,!1);return new ta(_,y,[i],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,i=this.rightSE.point,l=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),i=e.bbox(),l=bp(t,i);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,y=pu(t,a)&&this.comparePoint(a)===0,x=pu(i,u)&&e.comparePoint(u)===0,S=pu(t,_)&&this.comparePoint(_)===0,C=pu(i,d)&&e.comparePoint(d)===0;if(x&&y)return C&&!S?d:!C&&S?_:null;if(x)return S&&u.x===_.x&&u.y===_.y?null:u;if(y)return C&&d.x===a.x&&d.y===a.y?null:a;if(C&&S)return null;if(C)return d;if(S)return _;const L=bk(u,this.vector(),a,e.vector());return L===null||!pu(l,L)?null:Uu.round(L.x,L.y)}split(e){const t=[],i=e.events!==void 0,l=new Eo(e,!0),u=new Eo(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new ta(l,d,this.rings.slice(),this.windings.slice());return Eo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Eo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const l=ta.compare(t,i);if(l!==0){if(l>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,d=i.rings.length;u<d;u++){const a=i.rings[u],_=i.windings[u],y=t.rings.indexOf(a);y===-1?(t.rings.push(a),t.windings.push(_)):t.windings[y]+=_}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const y=this.rings[a],x=this.windings[a],S=t.indexOf(y);S===-1?(t.push(y),i.push(x)):i[S]+=x}const u=[],d=[];for(let a=0,_=t.length;a<_;a++){if(i[a]===0)continue;const y=t[a],x=y.poly;if(d.indexOf(x)===-1)if(y.isExterior)u.push(x);else{d.indexOf(x)===-1&&d.push(x);const S=u.indexOf(y.poly);S!==-1&&u.splice(S,1)}}for(let a=0,_=u.length;a<_;a++){const y=u[a].multiPoly;l.indexOf(y)===-1&&l.push(y)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch($o.type){case"union":{const i=e.length===0,l=t.length===0;this._isInResult=i!==l;break}case"intersection":{let i,l;e.length<t.length?(i=e.length,l=t.length):(i=t.length,l=e.length),this._isInResult=l===$o.numMultiPolys&&i<l;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=l=>l.length===1&&l[0].isSubject;this._isInResult=i(e)!==i(t);break}default:throw new Error(`Unrecognized operation type found ${$o.type}`)}return this._isInResult}}class M_{constructor(e,t,i){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=Uu.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=Uu.round(e[d][0],e[d][1]);_.x===u.x&&_.y===u.y||(this.segments.push(ta.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(ta.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,i=this.segments.length;t<i;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class xk{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new M_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,l=e.length;i<l;i++){const u=new M_(e[i],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class E_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,l=e.length;i<l;i++){const u=new xk(e[i],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class Cd{static factory(e){const t=[];for(let i=0,l=e.length;i<l;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,_=u.rightSE;const y=[a],x=a.point,S=[];for(;d=a,a=_,y.push(a),a.point!==x;)for(;;){const C=a.getAvailableLinkedEvents();if(C.length===0){const R=y[0].point,D=y[y.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(C.length===1){_=C[0].otherSE;break}let L=null;for(let R=0,D=S.length;R<D;R++)if(S[R].point===a.point){L=R;break}if(L!==null){const R=S.splice(L)[0],D=y.splice(R.index);D.unshift(D[0].otherSE),t.push(new Cd(D.reverse()));continue}S.push({index:y.length,point:a.point});const P=a.getLeftmostComparator(d);_=C.sort(P)[0].otherSE;break}t.push(new Cd(y))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let y=1,x=this.events.length-1;y<x;y++){const S=this.events[y].point,C=this.events[y+1].point;S_(S,e,C)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const i=t[0],l=t[1];S_(i,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let y=d;y!=a;y+=u)_.push([t[y].x,t[y].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];Eo.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}}class I_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,i=this.interiorRings.length;t<i;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class kk{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let i=0,l=e.length;i<l;i++){const u=e[i];if(!u.poly)if(u.isExteriorRing())t.push(new I_(u));else{const d=u.enclosingRing();d.poly||t.push(new I_(d)),d.poly.addInterior(u)}}return t}}class Sk{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ta.compare;this.queue=e,this.tree=new qp(t),this.segments=[]}process(e){const t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)d=this.tree.next(d),d===null?_=null:d.key.consumedBy===void 0&&(_=d.key);if(e.isLeft){let y=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(y=S),!a.isAnEndpoint(S))){const C=this._splitSafely(a,S);for(let L=0,P=C.length;L<P;L++)i.push(C[L])}}let x=null;if(_){const S=_.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(x=S),!_.isAnEndpoint(S))){const C=this._splitSafely(_,S);for(let L=0,P=C.length;L<P;L++)i.push(C[L])}}if(y!==null||x!==null){let S=null;y===null?S=x:x===null?S=y:S=Eo.comparePoints(y,x)<=0?y:x,this.queue.remove(t.rightSE),i.push(t.rightSE);const C=t.split(S);for(let L=0,P=C.length;L<P;L++)i.push(C[L])}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const y=a.getIntersection(_);if(y!==null){if(!a.isAnEndpoint(y)){const x=this._splitSafely(a,y);for(let S=0,C=x.length;S<C;S++)i.push(x[S])}if(!_.isAnEndpoint(y)){const x=this._splitSafely(_,y);for(let S=0,C=x.length;S<C;S++)i.push(x[S])}}}this.tree.remove(t)}return i}_splitSafely(e,t){this.tree.remove(e);const i=e.rightSE;this.queue.remove(i);const l=e.split(t);return l.push(i),e.consumedBy===void 0&&this.tree.add(e),l}}const L_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Tk=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Ck{run(e,t,i){$o.type=e,Uu.reset();const l=[new E_(t,!0)];for(let x=0,S=i.length;x<S;x++)l.push(new E_(i[x],!1));if($o.numMultiPolys=l.length,$o.type==="difference"){const x=l[0];let S=1;for(;S<l.length;)bp(l[S].bbox,x.bbox)!==null?S++:l.splice(S,1)}if($o.type==="intersection")for(let x=0,S=l.length;x<S;x++){const C=l[x];for(let L=x+1,P=l.length;L<P;L++)if(bp(C.bbox,l[L].bbox)===null)return[]}const u=new qp(Eo.compare);for(let x=0,S=l.length;x<S;x++){const C=l[x].getSweepEvents();for(let L=0,P=C.length;L<P;L++)if(u.insert(C[L]),u.size>L_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new Sk(u);let a=u.size,_=u.pop();for(;_;){const x=_.key;if(u.size===a){const C=x.segment;throw new Error(`Unable to pop() ${x.isLeft?"left":"right"} SweepEvent [${x.point.x}, ${x.point.y}] from segment #${C.id} [${C.leftSE.point.x}, ${C.leftSE.point.y}] -> [${C.rightSE.point.x}, ${C.rightSE.point.y}] from queue.`)}if(u.size>L_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>Tk)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(x);for(let C=0,L=S.length;C<L;C++){const P=S[C];P.consumedBy===void 0&&u.insert(P)}a=u.size,_=u.pop()}Uu.reset();const y=Cd.factory(d.segments);return new kk(y).getGeom()}}const $o=new Ck,Mk=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return $o.run("union",r,t)},Ek=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return $o.run("intersection",r,t)},Ik=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return $o.run("xor",r,t)},Lk=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return $o.run("difference",r,t)};var H0={union:Mk,intersection:Ek,xor:Ik,difference:Lk};function X0(r,e,t){if(r!==null)for(var i,l,u,d,a,_,y,x=0,S=0,C,L=r.type,P=L==="FeatureCollection",R=L==="Feature",D=P?r.features.length:1,B=0;B<D;B++){y=P?r.features[B].geometry:R?r.geometry:r,C=y?y.type==="GeometryCollection":!1,a=C?y.geometries.length:1;for(var N=0;N<a;N++){var $=0,j=0;if(d=C?y.geometries[N]:y,d!==null){_=d.coordinates;var le=d.type;switch(x=0,le){case null:break;case"Point":if(e(_,S,B,$,j)===!1)return!1;S++,$++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,B,$,j)===!1)return!1;S++,le==="MultiPoint"&&$++}le==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-x;l++){if(e(_[i][l],S,B,$,j)===!1)return!1;S++}le==="MultiLineString"&&$++,le==="Polygon"&&j++}le==="Polygon"&&$++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(j=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-x;u++){if(e(_[i][l][u],S,B,$,j)===!1)return!1;S++}j++}$++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(X0(d.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zp(r,e){var t,i,l,u,d,a,_,y,x,S,C=0,L=r.type==="FeatureCollection",P=r.type==="Feature",R=L?r.features.length:1;for(t=0;t<R;t++){for(a=L?r.features[t].geometry:P?r.geometry:r,y=L?r.features[t].properties:P?r.properties:{},x=L?r.features[t].bbox:P?r.bbox:void 0,S=L?r.features[t].id:P?r.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,y,x,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,y,x,S)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],C,y,x,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function Ak(r,e){Zp(r,function(t,i,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e($u(t,l,{bbox:u,id:d}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var y=0;y<t.coordinates.length;y++){var x=t.coordinates[y],S={type:_,coordinates:x};if(e($u(S,l),i,y)===!1)return!1}})}function Pk(r,e={}){const t=[];if(Zp(r,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const i=H0.union(t[0],...t.slice(1));return i.length===0?null:i.length===1?Vp(i[0],e.properties):G0(i,e.properties)}var K0=Pk;function zk(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return X0(r,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var A_=zk;function Dk(r){const e=[];if(Zp(r,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},i=H0.difference(e[0],...e.slice(1));return i.length===0?null:i.length===1?Vp(i[0],t):G0(i,t)}var Rk=Dk;function Bk(r){if(!r)throw new Error("geojson is required");var e=[];return Ak(r,function(t){e.push(t)}),ju(e)}var Fk=Bk;function P_(r,e){const t=Rk(ju([Vp([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const i=Sd(A_(r)),l=(i[2]-i[0])/360/1e3,u=i[0]<-180,d=i[2]>180,a=Fk(r);if(a.features.length>1&&(u||d))for(const _ of a.features){const y=Sd(A_(_));if(d&&y[0]<-180+l)for(const x of _.geometry.coordinates)for(const S of x)S[0]+=360-l;if(u&&y[2]>180-l)for(const x of _.geometry.coordinates)for(const S of x)S[0]-=360-l}e(ju([a.features.length<2?r:K0(a)??r,t]))}const z_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},od="mtlr-gc-full-geom",D_="mtlr-gc-full-geom-fill",R_="mtlr-gc-full-geom-line";function J0(r,e,t=!0,i=!0,l={},u={},d=z_){let a;const _=[];let y,x,S;function C(){if(!r.loaded){r.once("load",C);return}const D=d?d===!0?z_:d:void 0;if(!(D!=null&&D.fill)&&!(D!=null&&D.line))return;const B=r.getSource(od);if(B)B.setData(S??ju([]));else if(S)r.addSource(od,{type:"geojson",data:S});else return;!r.getLayer(D_)&&D!=null&&D.fill&&r.addLayer({...D==null?void 0:D.fill,id:D_,type:"fill",source:od}),!r.getLayer(R_)&&D!=null&&D.line&&r.addLayer({...D==null?void 0:D.line,id:R_,type:"line",source:od})}function L(D){S=D,C()}r.on("styledata",()=>{setTimeout(()=>{S&&C()})});const P=D=>{a==null||a({type:"mapClick",coordinates:[D.lngLat.lng,D.lngLat.lat]})};function R(D=!1){if(!e)throw new Error;const B=document.createElement("div");return D&&B.classList.add("marker-interactive"),new P2({props:{displayIn:"maplibre"},target:B}),new e.Marker({element:B,offset:[1,-13]})}return{setEventHandler(D){D?(a=D,r.on("click",P)):(a=void 0,r.off("click",P))},flyTo(D,B){r.flyTo({center:D,...B?{zoom:B}:{},...l})},fitBounds(D,B,N){r.fitBounds([[D[0],D[1]],[D[2],D[3]]],{padding:B,...N?{maxZoom:N}:{},...u})},indicateReverse(D){r.getCanvasContainer().style.cursor=D?"crosshair":""},setReverseMarker(D){!e||!t||(x?D?x.setLngLat(D):(x.remove(),x=void 0):D&&(t instanceof Function?x=t(r)??void 0:(x=(typeof t=="object"?new e.Marker(t):R()).setLngLat(D).addTo(r),x.getElement().classList.add("marker-reverse"))))},setFeatures(D,B,N){for(const $ of _)$.remove();if(_.length=0,L(void 0),!!e){if(B){let $=!1;if(B.geometry.type==="GeometryCollection"){const j=B.geometry.geometries.filter(le=>le.type==="Polygon"||le.type==="MultiPolygon");e:if(j.length>0){const le=K0(ju(j.map(ce=>$u(ce))));if(!le)break e;P_({...B,geometry:le.geometry},L),$=!0}else{const le=B.geometry.geometries.filter(ce=>ce.type==="LineString"||ce.type==="MultiLineString");le.length>0&&(L({...B,geometry:{type:"GeometryCollection",geometries:le}}),$=!0)}}if(!$){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")P_(B,L);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){L(B);return}}if(!N&&B.geometry.type!=="Point")return;if(t instanceof Function){const j=t(r,B);j&&_.push(j)}else t&&_.push(typeof t=="object"?new e.Marker(t):R().setLngLat(B.center).addTo(r))}if(i)for(const $ of D??[]){if($===B)continue;let j;if(i instanceof Function){if(j=i(r,$),!j)continue}else j=(typeof i=="object"?new e.Marker(i):R(!0)).setLngLat($.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText($.place_type[0]==="reverse"?$.place_name:$.place_name.replace(/,.*/,""))).addTo(r);const le=j.getElement();le.addEventListener("click",ce=>{ce.stopPropagation(),a==null||a({type:"markerClick",id:$.id})}),le.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:$.id}),j.togglePopup()}),le.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:$.id}),j.togglePopup()}),_.push(j)}}},setSelectedMarker(D){y&&y.getElement().classList.toggle("marker-selected",!1),y=D>-1?_[D]:void 0,y==null||y.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const D=r.getCenter();return[r.getZoom(),D.lng,D.lat]}}}function Ok(r,e,t){var i,l;class u{constructor(D,B){po(this,"type"),po(this,"target"),this.type=B,this.target=D}}class d extends u{constructor(D,B){super(D,"select"),po(this,"feature"),Object.assign(this,B)}}class a extends u{constructor(D,B){super(D,"featureslisted"),po(this,"features"),this.features=B}}class _ extends u{constructor(D,B){super(D,"featuresmarked"),po(this,"features"),this.features=B}}class y extends u{constructor(D,B){super(D,"optionsvisibilitychange"),po(this,"optionsVisible"),this.optionsVisible=B}}class x extends u{constructor(D,B){super(D,"pick"),po(this,"feature"),this.feature=B}}class S extends u{constructor(D,B){super(D,"querychange"),po(this,"query"),this.query=B}}class C extends u{constructor(D,B,N){super(D,"response"),po(this,"url"),po(this,"featureCollection"),this.url=B,this.featureCollection=N}}class L extends u{constructor(D,B){super(D,"reversetoggle"),po(this,"reverse"),this.reverse=B}}class P extends r{constructor(D={}){super(),Yg(this,i),Yg(this,l),Qg(this,l,D)}onAddInt(D){const B=document.createElement("div");B.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:N,showResultMarkers:$,flyTo:j,fullGeometryStyle:le,...ce}=nr(this,l),J=typeof j=="boolean"?{}:j,te={mapController:J0(D,e,N,$,J,J,le),flyTo:j===void 0?!0:!!j,apiKey:"",...t==null?void 0:t(D,B),...ce};if(!te.apiKey)throw new Error("no apiKey provided");return Qg(this,i,new ik({target:B,props:te})),nr(this,i).$on("select",ye=>{this.fire(new d(this,ye.detail))}),nr(this,i).$on("pick",ye=>{this.fire(new x(this,ye.detail.feature))}),nr(this,i).$on("featureslisted",ye=>{this.fire(new a(this,ye.detail.features))}),nr(this,i).$on("featuresmarked",ye=>{this.fire(new _(this,ye.detail.features))}),nr(this,i).$on("response",ye=>{this.fire(new C(this,ye.detail.url,ye.detail.featureCollection))}),nr(this,i).$on("optionsvisibilitychange",ye=>{this.fire(new y(this,ye.detail.optionsVisible))}),nr(this,i).$on("reversetoggle",ye=>{this.fire(new L(this,ye.detail.reverse))}),nr(this,i).$on("querychange",ye=>{this.fire(new S(this,ye.detail.query))}),B}on(D,B){return super.on(D,B)}once(D,B){return super.once(D,B)}off(D,B){return super.off(D,B)}listens(D){return super.listens(D)}setOptions(D){var B;Object.assign(nr(this,l),D);const{marker:N,showResultMarkers:$,flyTo:j,fullGeometryStyle:le,...ce}=nr(this,l);(B=nr(this,i))==null||B.$set(ce)}setQuery(D,B=!0){var N;(N=nr(this,i))==null||N.setQuery(D,B)}clearMap(){var D;(D=nr(this,i))==null||D.clearMap()}clearList(){var D;(D=nr(this,i))==null||D.clearList()}setReverseMode(D){var B;(B=nr(this,i))==null||B.$set({reverseActive:D})}focus(){var D;(D=nr(this,i))==null||D.focus()}blur(){var D;(D=nr(this,i))==null||D.blur()}onRemove(){var D;(D=nr(this,i))==null||D.$destroy()}}return i=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:P,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:y,PickEvent:x,QueryChangeEvent:S,ResponseEvent:C,ReverseToggleEvent:L}}}const{MapLibreBasedGeocodingControl:wE,events:ca}=Ok(Cs.Evented,zb);ca.SelectEvent;ca.FeaturesListedEvent;ca.FeaturesMarkedEvent;ca.OptionsVisibilityChangeEvent;ca.PickEvent;ca.QueryChangeEvent;ca.ResponseEvent;ca.ReverseToggleEvent;function Nk(r){let e,t;return{c(){e=Ss("svg"),t=Ss("path"),ke(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ke(e,"viewBox","0 0 14 14"),ke(e,"width","13"),ke(e,"height","13"),ke(e,"class","svelte-en2qvf")},m(i,l){ae(i,e,l),Z(e,t)},p:Ct,i:Ct,o:Ct,d(i){i&&se(e)}}}class Y0 extends Ut{constructor(e){super(),jt(this,e,null,Nk,Ft,{})}}function $k(r){let e,t;return{c(){e=Ss("svg"),t=Ss("path"),ke(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ke(e,"viewBox","0 0 30 30"),ke(e,"fill","none"),ke(e,"xmlns","http://www.w3.org/2000/svg"),ke(e,"class","svelte-d2loi5")},m(i,l){ae(i,e,l),Z(e,t)},p:Ct,i:Ct,o:Ct,d(i){i&&se(e)}}}class Q0 extends Ut{constructor(e){super(),jt(this,e,null,$k,Ft,{})}}function jk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"area.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"area.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Uk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"reverse.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"reverse.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Vk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"poi.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"poi.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function qk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"postal_code.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"postal_code.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Zk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"street.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"street.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Gk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"road.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"road.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Wk(r){let e,t;return{c(){e=re("img"),Dn(e.src,t=r[3]+"housenumber.svg")||ke(e,"src",t),ke(e,"alt",r[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){ae(i,e,l)},p(i,l){l&8&&!Dn(e.src,t=i[3]+"housenumber.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&se(e)}}}function Hk(r){let e,t,i,l;return{c(){e=re("img"),Dn(e.src,t=r[5])||ke(e,"src",t),ke(e,"alt",r[4]),ke(e,"class","svelte-ltkwvy")},m(u,d){ae(u,e,d),i||(l=Mt(e,"error",r[14]),i=!0)},p(u,d){d&32&&!Dn(e.src,t=u[5])&&ke(e,"src",t),d&16&&ke(e,"alt",u[4])},d(u){u&&se(e),i=!1,l()}}}function B_(r){let e,t;return{c(){e=re("span"),t=je(r[6]),ke(e,"class","secondary svelte-ltkwvy")},m(i,l){ae(i,e,l),Z(e,t)},p(i,l){l&64&&ai(t,i[6])},d(i){i&&se(e)}}}function Xk(r){let e,t,i,l,u,d,a,_,y,x=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,C,L=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],P,R,D=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,$;function j(te,ye){return ye&1&&(t=null),ye&1&&(i=null),ye&1&&(l=null),ye&1&&(u=null),te[5]?Hk:te[0].address?Wk:(t==null&&(t=!!te[0].id.startsWith("road.")),t?Gk:(i==null&&(i=!!te[0].id.startsWith("address.")),i?Zk:(l==null&&(l=!!te[0].id.startsWith("postal_code.")),l?qk:(u==null&&(u=!!te[0].id.startsWith("poi.")),u?Vk:te[7]?Uk:jk))))}let le=j(r,-1),ce=le(r),J=L&&B_(r);return{c(){e=re("li"),ce.c(),d=Le(),a=re("span"),_=re("span"),y=re("span"),S=je(x),C=Le(),J&&J.c(),P=Le(),R=re("span"),B=je(D),ke(y,"class","primary svelte-ltkwvy"),ke(_,"class","svelte-ltkwvy"),ke(R,"class","line2 svelte-ltkwvy"),ke(a,"class","texts svelte-ltkwvy"),ke(e,"tabindex","0"),ke(e,"data-selected",r[1]),ke(e,"class","svelte-ltkwvy"),dr(e,"selected",r[1])},m(te,ye){ae(te,e,ye),ce.m(e,null),Z(e,d),Z(e,a),Z(a,_),Z(_,y),Z(y,S),Z(_,C),J&&J.m(_,null),Z(a,P),Z(a,R),Z(R,B),N||($=[Mt(e,"mouseenter",r[12]),Mt(e,"focus",r[13])],N=!0)},p(te,[ye]){le===(le=j(te,ye))&&ce?ce.p(te,ye):(ce.d(1),ce=le(te),ce&&(ce.c(),ce.m(e,d))),ye&1&&x!==(x=(te[7]?te[0].place_name:te[0].place_name.replace(/,.*/,""))+"")&&ai(S,x),ye&37&&(L=te[2]==="always"||te[2]!=="never"&&!te[0].address&&!te[0].id.startsWith("road.")&&!te[0].id.startsWith("address.")&&!te[0].id.startsWith("postal_code.")&&(!te[0].id.startsWith("poi.")||!te[5])&&!te[7]),L?J?J.p(te,ye):(J=B_(te),J.c(),J.m(_,null)):J&&(J.d(1),J=null),ye&1&&D!==(D=(te[7]?"":te[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&ai(B,D),ye&2&&ke(e,"data-selected",te[1]),ye&2&&dr(e,"selected",te[1])},i:Ct,o:Ct,d(te){te&&se(e),ce.d(),J&&J.d(),N=!1,mn($)}}}function Kk(r,e,t){var $;let i,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:y}=e;const x=($=u.properties)==null?void 0:$.categories;let S,C,L=0,P=u.place_type[0]==="reverse";function R(){C&&_.add(C),t(10,L++,L)}function D(j){pi.call(this,r,j)}function B(j){pi.call(this,r,j)}const N=()=>R();return r.$$set=j=>{"feature"in j&&t(0,u=j.feature),"selected"in j&&t(1,d=j.selected),"showPlaceType"in j&&t(2,a=j.showPlaceType),"missingIconsCache"in j&&t(9,_=j.missingIconsCache),"iconsBaseUrl"in j&&t(3,y=j.iconsBaseUrl)},r.$$.update=()=>{var j,le,ce,J;if(r.$$.dirty&3640)do t(11,i--,i),t(4,S=x==null?void 0:x[i]),t(5,C=S?y+S.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||_.has(C)));r.$$.dirty&1&&t(6,l=((le=(j=u.properties)==null?void 0:j.categories)==null?void 0:le.join(", "))??((J=(ce=u.properties)==null?void 0:ce.place_type_name)==null?void 0:J[0])??u.place_type[0])},t(11,i=(x==null?void 0:x.length)??0),[u,d,a,y,S,C,l,P,R,_,L,i,D,B,N]}class Jk extends Ut{constructor(e){super(),jt(this,e,Kk,Xk,Ft,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Yk(r){let e;return{c(){e=re("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ke(e,"class","svelte-7cmwmc")},m(t,i){ae(t,e,i)},p:Ct,i:Ct,o:Ct,d(t){t&&se(e)}}}class Qk extends Ut{constructor(e){super(),jt(this,e,null,Yk,Ft,{})}}function e4(r){let e,t;return{c(){e=Ss("svg"),t=Ss("path"),ke(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ke(e,"viewBox","0 0 60.006 21.412"),ke(e,"width","14"),ke(e,"height","20"),ke(e,"class","svelte-en2qvf")},m(i,l){ae(i,e,l),Z(e,t)},p:Ct,i:Ct,o:Ct,d(i){i&&se(e)}}}class t4 extends Ut{constructor(e){super(),jt(this,e,null,e4,Ft,{})}}function i4(r){let e,t,i;return{c(){e=Ss("svg"),t=Ss("circle"),i=Ss("path"),ke(t,"cx","4.789"),ke(t,"cy","4.787"),ke(t,"r","3.85"),ke(t,"class","svelte-1aq105l"),ke(i,"d","M12.063 12.063 7.635 7.635"),ke(i,"class","svelte-1aq105l"),ke(e,"xmlns","http://www.w3.org/2000/svg"),ke(e,"width","13"),ke(e,"height","13"),ke(e,"viewBox","0 0 13 13"),ke(e,"class","svelte-1aq105l")},m(l,u){ae(l,e,u),Z(e,t),Z(e,i)},p:Ct,i:Ct,o:Ct,d(l){l&&se(e)}}}class n4 extends Ut{constructor(e){super(),jt(this,e,null,i4,Ft,{})}}function r4(r,e,t){const i=e[1],l=e[0],u=i-l;return r===i&&t?r:((r-l)%u+u)%u+l}function F_(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let mu;async function o4(r,e,t){const i=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(i&&(l.minZoom!=null&&l.minZoom>i[0]||l.maxZoom!=null&&l.maxZoom<i[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(mu&&l.cachedLocationExpiry&&mu.time+l.cachedLocationExpiry>Date.now()){if(!mu.coords)break e;return mu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(y=>y.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(mu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(i&&l.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const s4=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,O_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,N_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,$_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,j_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,U_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function a4(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(L=>Number(L.trim())),t=Number(e[0]),i=Number(e[1]),l=Math.abs(t),u=Math.abs(i),d=t>0?"N":"S",a=i>0?"E":"W";let _;r=="DD"&&(_=`${l}° ${d}, ${u}° ${a}`);const y=Math.floor(l),x=Math.floor(u),S=(l-y)*60,C=(u-x)*60;if(r=="DM"){let L=V_(S,3).toFixed(3).padStart(6,"0"),P=V_(C,3).toFixed(3).padStart(6,"0");L.endsWith(".000")&&P.endsWith(".000")&&(L=L.replace(/\.000$/,""),P=P.replace(/\.000$/,"")),_=`${y}° ${L}' ${d}, ${x}° ${P}' ${a}`}if(r=="DMS"){const L=Math.floor(S),P=Math.floor(C);let R=((S-L)*60).toFixed(1).padStart(4,"0"),D=((C-P)*60).toFixed(1).padStart(4,"0");const B=L.toString().padStart(2,"0"),N=P.toString().padStart(2,"0");R.endsWith(".0")&&D.endsWith(".0")&&(R=R.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),_=`${y}° ${B}' ${R}" ${d}, ${x}° ${N}' ${D}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function V_(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Gp(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,i=null,l="",u="",d=null,a=[],_=!1;if(s4.test(r))throw new Error("invalid coordinate value");if(O_.test(r))if(a=O_.exec(r),_=gu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),d="DM";else throw new Error("invalid coordinate format");else if(N_.test(r))if(a=N_.exec(r),_=gu(a),_){if(t=a[2],i=a[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if($_.test(r))if(a=$_.exec(r),_=gu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(j_.test(r))if(a=j_.exec(r),_=gu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(U_.test(r)){if(a=U_.exec(r),_=gu(a),a.filter(y=>y).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let y=/S|SOUTH/i;y.test(l)&&t>0&&(t=-1*t),y=/W|WEST/i,y.test(u)&&i>0&&(i=-1*i);const x=a[0].trim();let S,C;const L=/[,/;\u0020]/g,P=x.match(L);if(P==null){const B=Math.floor(r.length/2);S=x.substring(0,B).trim(),C=x.substring(B).trim()}else{let B;P.length%2==1?B=Math.floor(P.length/2):B=P.length/2-1;let N=0;if(B==0)N=x.indexOf(P[0]),S=x.substring(0,N).trim(),C=x.substring(N+1).trim();else{let $=0,j=0;for(;$<=B;)N=x.indexOf(P[$],j),j=N+1,$++;S=x.substring(0,N).trim(),C=x.substring(N+1).trim()}}const R=S.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const D=C.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:x,verbatimLatitude:S,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:d,closeEnough:l4,toCoordinateFormat:a4})}else throw new Error("coordinates pattern match failed")}function gu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),y=i.test(d)&&i.test(a),x=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||y||x)continue;return!1}}return!0}function q_(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function l4(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return q_(this.decimalLatitude,Number(e[0]))&&q_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const c4=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Gp.to=c4;const u4=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],h4={decimalLatitude:40.123,decimalLongitude:-74.123},d4=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],f4=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function p4(){const r=[];return u4.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...h4})}),[...r,...d4,...f4]}const m4=p4();Gp.formats=m4.map(r=>r.verbatimCoordinates);const g4=Gp;function Z_(r,e,t){const i=r.slice();return i[84]=e[t],i[86]=t,i}function G_(r){let e,t;return e=new Qk({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function W_(r){let e,t,i,l,u;return t=new t4({}),{c(){e=re("button"),Ce(t.$$.fragment),ke(e,"type","button"),ke(e,"title",r[9]),ke(e,"class","svelte-bz0zu3"),dr(e,"active",r[0])},m(d,a){ae(d,e,a),Se(t,e,null),i=!0,l||(u=Mt(e,"click",r[69]),l=!0)},p(d,a){(!i||a[0]&512)&&ke(e,"title",d[9]),(!i||a[0]&1)&&dr(e,"active",d[0])},i(d){i||(K(t.$$.fragment,d),i=!0)},o(d){ie(t.$$.fragment,d),i=!1},d(d){d&&se(e),Te(t),l=!1,u()}}}function _4(r){let e,t=[],i=new Map,l,u,d,a=Tn(r[14]);const _=y=>y[84].id+(y[84].address?","+y[84].address:"");for(let y=0;y<a.length;y+=1){let x=Z_(r,a,y),S=_(x);i.set(S,t[y]=H_(S,x))}return{c(){e=re("ul");for(let y=0;y<t.length;y+=1)t[y].c();ke(e,"class","options svelte-bz0zu3")},m(y,x){ae(y,e,x);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Mt(e,"mouseleave",r[73]),Mt(e,"blur",r[74])],u=!0)},p(y,x){x[0]&17880064&&(a=Tn(y[14]),gi(),t=gb(t,x,_,1,y,a,i,e,mb,H_,null,Z_),_i())},i(y){if(!l){for(let x=0;x<a.length;x+=1)K(t[x]);l=!0}},o(y){for(let x=0;x<t.length;x+=1)ie(t[x]);l=!1},d(y){y&&se(e);for(let x=0;x<t.length;x+=1)t[x].d();u=!1,mn(d)}}}function y4(r){let e,t,i,l,u,d;return t=new Q0({}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("div"),u=je(r[7]),ke(l,"class","svelte-bz0zu3"),ke(e,"class","no-results svelte-bz0zu3")},m(a,_){ae(a,e,_),Se(t,e,null),Z(e,i),Z(e,l),Z(l,u),d=!0},p(a,_){(!d||_[0]&128)&&ai(u,a[7])},i(a){d||(K(t.$$.fragment,a),d=!0)},o(a){ie(t.$$.fragment,a),d=!1},d(a){a&&se(e),Te(t)}}}function v4(r){let e="",t;return{c(){t=je(e)},m(i,l){ae(i,t,l)},p:Ct,i:Ct,o:Ct,d(i){i&&se(t)}}}function b4(r){let e,t,i,l,u,d,a,_,y,x,S;return t=new Q0({}),_=new Y0({}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("div"),u=je(r[6]),d=Le(),a=re("button"),Ce(_.$$.fragment),ke(l,"class","svelte-bz0zu3"),ke(a,"class","svelte-bz0zu3"),ke(e,"class","error svelte-bz0zu3")},m(C,L){ae(C,e,L),Se(t,e,null),Z(e,i),Z(e,l),Z(l,u),Z(e,d),Z(e,a),Se(_,a,null),y=!0,x||(S=Mt(a,"click",r[70]),x=!0)},p(C,L){(!y||L[0]&64)&&ai(u,C[6])},i(C){y||(K(t.$$.fragment,C),K(_.$$.fragment,C),y=!0)},o(C){ie(t.$$.fragment,C),ie(_.$$.fragment,C),y=!1},d(C){C&&se(e),Te(t),Te(_),x=!1,S()}}}function H_(r,e){let t,i,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return i=new Jk({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),i.$on("mouseenter",u),i.$on("focus",d),{key:r,first:null,c(){t=En(),Ce(i.$$.fragment),this.first=t},m(a,_){ae(a,t,_),Se(i,a,_),l=!0},p(a,_){e=a;const y={};_[0]&16384&&(y.feature=e[84]),_[0]&1024&&(y.showPlaceType=e[10]),_[0]&49152&&(y.selected=e[15]===e[86]),_[0]&4096&&(y.iconsBaseUrl=e[12]),i.$set(y)},i(a){l||(K(i.$$.fragment,a),l=!0)},o(a){ie(i.$$.fragment,a),l=!1},d(a){a&&se(t),Te(i,a)}}}function w4(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B,N,$,j,le,ce=!1;u=new n4({}),S=new Y0({});let J=r[19]&&G_(),te=r[5]==="button"&&W_(r);const ye=r[61].default,Ue=Vi(ye,r,r[60],null),oe=[b4,v4,y4,_4],ve=[];function st(ze,Qe){var wt,pt;return ze[18]?0:ze[16]?((wt=ze[14])==null?void 0:wt.length)===0?2:ze[16]&&((pt=ze[14])!=null&&pt.length)?3:-1:1}return~(D=st(r))&&(B=ve[D]=oe[D](r)),{c(){e=Le(),t=re("form"),i=re("div"),l=re("button"),Ce(u.$$.fragment),d=Le(),a=re("input"),_=Le(),y=re("div"),x=re("button"),Ce(S.$$.fragment),C=Le(),J&&J.c(),L=Le(),te&&te.c(),P=Le(),Ue&&Ue.c(),R=Le(),B&&B.c(),ke(l,"class","search-button svelte-bz0zu3"),ke(l,"type","button"),ke(a,"placeholder",r[8]),ke(a,"aria-label",r[8]),ke(a,"class","svelte-bz0zu3"),ke(x,"type","button"),ke(x,"title",r[3]),ke(x,"class","svelte-bz0zu3"),ke(y,"class","clear-button-container svelte-bz0zu3"),dr(y,"displayable",r[1]!==""),ke(i,"class","input-group svelte-bz0zu3"),ke(t,"tabindex","0"),ke(t,"class",N=_d(r[2])+" svelte-bz0zu3"),dr(t,"can-collapse",r[4]&&r[1]==="")},m(ze,Qe){ae(ze,e,Qe),ae(ze,t,Qe),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),r[63](a),zn(a,r[1]),Z(i,_),Z(i,y),Z(y,x),Se(S,x,null),Z(y,C),J&&J.m(y,null),Z(i,L),te&&te.m(i,null),Z(i,P),Ue&&Ue.m(i,null),Z(t,R),~D&&ve[D].m(t,null),$=!0,j||(le=[Mt(l,"click",r[62]),Mt(a,"input",r[64]),Mt(a,"focus",r[65]),Mt(a,"blur",r[66]),Mt(a,"keydown",r[22]),Mt(a,"input",r[67]),Mt(x,"click",r[68]),Mt(t,"submit",Ep(r[21]))],j=!0)},p(ze,Qe){(!$||Qe[0]&256)&&ke(a,"placeholder",ze[8]),(!$||Qe[0]&256)&&ke(a,"aria-label",ze[8]),Qe[0]&2&&a.value!==ze[1]&&zn(a,ze[1]),(!$||Qe[0]&8)&&ke(x,"title",ze[3]),ze[19]?J?Qe[0]&524288&&K(J,1):(J=G_(),J.c(),K(J,1),J.m(y,null)):J&&(gi(),ie(J,1,1,()=>{J=null}),_i()),(!$||Qe[0]&2)&&dr(y,"displayable",ze[1]!==""),ze[5]==="button"?te?(te.p(ze,Qe),Qe[0]&32&&K(te,1)):(te=W_(ze),te.c(),K(te,1),te.m(i,P)):te&&(gi(),ie(te,1,1,()=>{te=null}),_i()),Ue&&Ue.p&&(!$||Qe[1]&536870912)&&Zi(Ue,ye,ze,ze[60],$?qi(ye,ze[60],Qe,null):Gi(ze[60]),null);let wt=D;D=st(ze),D===wt?~D&&ve[D].p(ze,Qe):(B&&(gi(),ie(ve[wt],1,1,()=>{ve[wt]=null}),_i()),~D?(B=ve[D],B?B.p(ze,Qe):(B=ve[D]=oe[D](ze),B.c()),K(B,1),B.m(t,null)):B=null),(!$||Qe[0]&4&&N!==(N=_d(ze[2])+" svelte-bz0zu3"))&&ke(t,"class",N),(!$||Qe[0]&22)&&dr(t,"can-collapse",ze[4]&&ze[1]==="")},i(ze){$||(K(ce),K(u.$$.fragment,ze),K(S.$$.fragment,ze),K(J),K(te),K(Ue,ze),K(B),$=!0)},o(ze){ie(ce),ie(u.$$.fragment,ze),ie(S.$$.fragment,ze),ie(J),ie(te),ie(Ue,ze),ie(B),$=!1},d(ze){ze&&(se(e),se(t)),Te(u),r[63](null),Te(S),J&&J.d(),te&&te.d(),Ue&&Ue.d(ze),~D&&ve[D].d(),j=!1,mn(le)}}}function x4(r,e,t){let i,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:y}=e,{bbox:x=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:L=!1}=e,{country:P=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:D="never"}=e,{errorMessage:B="Something went wrong…"}=e,{filter:N=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:j=!0}=e,{language:le=void 0}=e,{limit:ce=void 0}=e,{mapController:J=void 0}=e,{minLength:te=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ue="Search"}=e,{proximity:oe=[{type:"server-geolocation"}]}=e,{reverseActive:ve=D==="always"}=e,{reverseButtonTitle:st="toggle reverse geocoding"}=e,{searchValue:ze=""}=e,{pickedResultStyle:Qe="full-geometry"}=e,{showPlaceType:wt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:nt=!0}=e,{flyToSelected:Ht=!1}=e,{markerOnSelected:oi=!0}=e,{types:Dt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:ti=!1}=e,{zoom:Pt=a}=e,{apiUrl:Rt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:ct={}}=e,{iconsBaseUrl:Jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Yt=()=>{}}=e;function Ei(){qe.focus()}function Fi(){qe.blur()}function ht(G,$e=!0,Ve=!1){t(1,ze=G),$e?(t(15,Je=-1),rt()):(ni(!Ve,Ve),setTimeout(()=>{qe.focus(),qe.select()}))}function Ot(){t(14,dt=void 0),t(56,we=void 0),t(15,Je=-1)}function Fe(){t(55,bt=[]),t(56,we=void 0)}let Ne=!1,dt,bt,we,Ii="",qe,Je=-1,Vt,Pi=[],wi,gn,In,tn;const io=new Set,Oi=rs();or(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function rt(G){if(gn&&(clearTimeout(gn),gn=void 0),Je>-1&&dt)t(56,we=dt[Je]),t(1,ze=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,Vt=void 0),t(55,bt=void 0),t(15,Je=-1);else if(ze){const $e=G||!Li(ze);ii(ze,{exact:!0}).then(()=>{t(55,bt=dt),t(56,we=void 0),$e&&Ni()}).catch(Ve=>t(18,Vt=Ve))}}function Li(G){try{return g4(G,6)}catch{return!1}}async function ii(G,{byId:$e=!1,exact:Ve=!1}={}){t(18,Vt=void 0),wi==null||wi.abort();const Ge=new AbortController;t(19,wi=Ge);try{const Ke=Li(G),ft=new URLSearchParams;if(le!==void 0&&ft.set("language",Array.isArray(le)?le.join(","):le??""),Dt&&ft.set("types",Dt.join(",")),ti&&ft.set("excludeTypes",String(ti)),x&&ft.set("bbox",x.map(xi=>xi.toFixed(6)).join(",")),P&&ft.set("country",Array.isArray(P)?P.join(","):P),!$e&&!Ke){const xi=await o4(J,oe,Ge);xi&&ft.set("proximity",xi),(Ve||!pt)&&ft.set("autocomplete","false"),ft.set("fuzzyMatch",String(j))}ce!==void 0&&(mt||!Ke||(Dt==null?void 0:Dt.length)===1)&&ft.set("limit",String(ce)),ft.set("key",y),Yt(ft);const Nt=Rt+"/"+encodeURIComponent(Ke?Ke.decimalLongitude+","+Ke.decimalLatitude:G)+".json?"+ft.toString();if(Nt===Ii){$e?(t(14,dt=void 0),t(56,we=Pi[0])):t(14,dt=Pi);return}Ii=Nt;const Qt=await fetch(Nt,{signal:Ge.signal,...ct});if(!Qt.ok)throw new Error(await Qt.text());const hi=await Qt.json();Oi("response",{url:Nt,featureCollection:hi}),$e?(t(14,dt=void 0),t(56,we=hi.features[0]),Pi=[we]):(t(14,dt=hi.features.filter(N)),Ke&&dt.unshift({type:"Feature",properties:{},id:"reverse_"+Ke.decimalLongitude+"_"+Ke.decimalLatitude,text:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_name:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_type:["reverse"],center:[Ke.decimalLongitude,Ke.decimalLatitude],bbox:[Ke.decimalLongitude,Ke.decimalLatitude,Ke.decimalLongitude,Ke.decimalLatitude],geometry:{type:"Point",coordinates:[Ke.decimalLongitude,Ke.decimalLatitude]}}),Pi=dt,Ke&&qe.focus())}catch(Ke){if(Ke&&typeof Ke=="object"&&"name"in Ke&&Ke.name==="AbortError")return;throw Ke}finally{Ge===wi&&t(19,wi=void 0)}}function Ni(){var Ge;if(!(bt!=null&&bt.length)||!$)return;const G=[180,90,-180,-90],$e=!bt.some(Ke=>!Ke.matching_text);let Ve;for(const Ke of bt){const ft=Ki(Ke);if(Ve=Ve===void 0?ft:ft===void 0?Ve:Math.max(Ve,ft),$e||!Ke.matching_text)for(const Nt of[0,1,2,3])G[Nt]=Math[Nt<2?"min":"max"](G[Nt],((Ge=Ke.bbox)==null?void 0:Ge[Nt])??Ke.center[Nt%2])}J&&bt.length>0&&(we&&G[0]===G[2]&&G[1]===G[3]?J.flyTo(we.center,Ki(we)):J.fitBounds(F_(G),50,Ve))}function Ki(G){var Ve;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const $e=G.id.replace(/\..*/,"");return(Array.isArray((Ve=G.properties)==null?void 0:Ve.categories)?G.properties.categories.reduce((Ge,Ke)=>{const ft=Pt[$e+"."+Ke];return Ge===void 0?ft:ft===void 0?Ge:Math.max(Ge,ft)},void 0):void 0)??Pt[$e]}function yt(G){t(0,ve=D==="always"),t(14,dt=void 0),t(56,we=void 0),t(15,Je=-1),ht(G[1].toFixed(6)+", "+r4(G[0],[-180,180],!0).toFixed(6),!1,!0)}function li(G){if(!dt)return;let $e=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;$e&&(Je===(nt?0:-1)&&$e===-1&&t(15,Je=dt.length),t(15,Je+=$e),Je>=dt.length&&t(15,Je=-1),Je<0&&nt&&t(15,Je=0),G.preventDefault())}function ni(G=!0,$e=!1){if(t(18,Vt=void 0),pt||$e){if(gn&&clearTimeout(gn),ze.length<te)return;const Ve=ze;gn=window.setTimeout(()=>{ii(Ve).catch(Ge=>t(18,Vt=Ge))},G?R:0)}else t(14,dt=void 0),t(18,Vt=void 0)}function Ji(G){t(56,we=G),t(1,ze=G.place_name),t(15,Je=-1)}const xr=()=>qe.focus();function si(G){Xi[G?"unshift":"push"](()=>{qe=G,t(17,qe)})}function no(){ze=this.value,t(1,ze),t(13,Ne),t(28,C)}const _n=()=>t(13,Ne=!0),me=()=>t(13,Ne=!1),W=()=>ni(),X=()=>{t(1,ze=""),qe.focus()},ne=()=>t(0,ve=!ve),de=()=>t(18,Vt=void 0),Ae=G=>t(15,Je=G),Pe=G=>Ji(G),Be=()=>{nt||t(15,Je=-1)},Me=()=>{};return r.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,y=G.apiKey),"bbox"in G&&t(27,x=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,C=G.clearOnBlur),"collapsed"in G&&t(4,L=G.collapsed),"country"in G&&t(29,P=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,D=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,N=G.filter),"flyTo"in G&&t(32,$=G.flyTo),"fuzzyMatch"in G&&t(33,j=G.fuzzyMatch),"language"in G&&t(34,le=G.language),"limit"in G&&t(35,ce=G.limit),"mapController"in G&&t(36,J=G.mapController),"minLength"in G&&t(37,te=G.minLength),"noResultsMessage"in G&&t(7,ye=G.noResultsMessage),"placeholder"in G&&t(8,Ue=G.placeholder),"proximity"in G&&t(38,oe=G.proximity),"reverseActive"in G&&t(0,ve=G.reverseActive),"reverseButtonTitle"in G&&t(9,st=G.reverseButtonTitle),"searchValue"in G&&t(1,ze=G.searchValue),"pickedResultStyle"in G&&t(39,Qe=G.pickedResultStyle),"showPlaceType"in G&&t(10,wt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,nt=G.selectFirst),"flyToSelected"in G&&t(41,Ht=G.flyToSelected),"markerOnSelected"in G&&t(42,oi=G.markerOnSelected),"types"in G&&t(43,Dt=G.types),"exhaustiveReverseGeocoding"in G&&t(44,mt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,ti=G.excludeTypes),"zoom"in G&&t(46,Pt=G.zoom),"apiUrl"in G&&t(47,Rt=G.apiUrl),"fetchParameters"in G&&t(48,ct=G.fetchParameters),"iconsBaseUrl"in G&&t(12,Jt=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,Yt=G.adjustUrlQuery),"$$scope"in G&&t(60,d=G.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ve=D==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,In=Ne),C&&!Ne&&t(1,ze="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ze.length<te&&(t(56,we=void 0),t(14,dt=void 0),t(18,Vt=void 0),t(55,bt=dt)),r.$$.dirty[1]&33554688&&Qe!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&ii(we.id,{byId:!0}).catch(G=>t(18,Vt=G)),r.$$.dirty[1]&100663330&&(J&&we&&we.id!==tn&&$&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?J.flyTo(we.center,Ki(we)):J.fitBounds(F_(we.bbox),50,Ki(we)),t(14,dt=void 0),t(55,bt=void 0),t(15,Je=-1)),t(57,tn=we==null?void 0:we.id)),r.$$.dirty[0]&18432&&nt&&dt!=null&&dt.length&&t(15,Je=0),r.$$.dirty[0]&2&&t(15,Je=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&bt!==dt&&t(55,bt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(G=>{switch(G.type){case"mapClick":ve&&yt(G.coordinates);break;case"markerClick":{const $e=dt==null?void 0:dt.find(Ve=>Ve.id===G.id);$e&&Ji($e)}break;case"markerMouseEnter":bt&&t(15,Je=In?(dt==null?void 0:dt.findIndex($e=>$e.id===G.id))??-1:-1);break;case"markerMouseLeave":bt&&t(15,Je=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=dt==null?void 0:dt[Je]),r.$$.dirty[1]&134218786&&J&&l&&$&&Ht&&J.flyTo(l.center,Ki(l)),r.$$.dirty[1]&256&&t(59,i=Qe==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(oi||J==null||J.setFeatures(void 0,void 0,i)),r.$$.dirty[1]&419432480&&J&&oi&&!bt&&(J.setFeatures(l?[l]:void 0,void 0,i),J.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(bt,we,i),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&bt&&J&&J.setSelectedMarker(Je),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const G=Li(ze);J.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Oi("select",{feature:l}),r.$$.dirty[1]&33554432&&Oi("pick",{feature:we}),r.$$.dirty[0]&81920&&Oi("optionsvisibilitychange",{optionsVisible:In&&!!dt}),r.$$.dirty[0]&16384&&Oi("featureslisted",{features:dt}),r.$$.dirty[1]&16777216&&Oi("featuresmarked",{features:bt}),r.$$.dirty[0]&1&&Oi("reversetoggle",{reverse:ve}),r.$$.dirty[0]&2&&Oi("querychange",{query:ze}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ve)},[ve,ze,_,S,L,D,B,ye,Ue,st,wt,nt,Jt,Ne,dt,Je,In,qe,Vt,wi,io,rt,li,ni,Ji,a,y,x,C,P,R,N,$,j,le,ce,J,te,oe,Qe,pt,Ht,oi,Dt,mt,ti,Pt,Rt,ct,Yt,Ei,Fi,ht,Ot,Fe,bt,we,tn,l,i,d,u,xr,si,no,_n,me,W,X,ne,de,Ae,Pe,Be,Me]}class k4 extends Ut{constructor(e){super(),jt(this,e,x4,w4,Ft,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function X_(r){let e,t,i;return t=new k4({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"class","svelte-ixhnie")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function S4(r){let e,t,i=r[2]&&X_(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[2]?i?(i.p(l,u),u&4&&K(i,1)):(i=X_(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function T4(r,e,t){let i,{apiKey:l}=e,{map:u}=e,{country:d}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(y){return y?J0(y,to,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=y=>{"apiKey"in y&&t(0,l=y.apiKey),"map"in y&&t(4,u=y.map),"country"in y&&t(1,d=y.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,i=_(u))},[l,d,i,a,u]}class C4 extends Ut{constructor(e){super(),jt(this,e,T4,S4,Ft,{apiKey:0,map:4,country:1})}}const M4=Symbol.for("svelte-maplibre");function E4(){return Id(M4)}function I4(r){return"layerType"in r&&r.layerType==="deckgl"}const L4=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),K_=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function J_(r){let e,t,i=(r[4]||r[3]instanceof to.Marker)&&Y_(r);return{c(){e=re("div"),i&&i.c()},m(l,u){ae(l,e,u),i&&i.m(e,null),r[32](e),t=!0},p(l,u){l[4]||l[3]instanceof to.Marker?i?(i.p(l,u),u[0]&24&&K(i,1)):(i=Y_(l),i.c(),K(i,1),i.m(e,null)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(),r[32](null)}}}function Y_(r){let e;const t=r[30].default,i=Vi(t,r,r[29],K_);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[0]&536870933)&&Zi(i,t,l,l[29],e?qi(t,l[29],u,L4):Gi(l[29]),K_)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function A4(r){let e,t,i=r[9].default&&J_(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[9].default?i?(i.p(l,u),u[0]&512&&K(i,1)):(i=J_(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function P4(r,e,t){let i,l,u,d,a,_,{$$slots:y={},$$scope:x}=e;const S=ub(y);let{closeButton:C=void 0}=e,{closeOnClickOutside:L=!0}=e,{closeOnClickInside:P=!1}=e,{closeOnMove:R=!1}=e,{openOn:D="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:N=!0}=e,{anchor:$=void 0}=e,{offset:j=void 0}=e,{popupClass:le=void 0}=e,{maxWidth:ce=void 0}=e,{lngLat:J=void 0}=e,{html:te=void 0}=e,{open:ye=!1}=e;const Ue=rs(),{map:oe,popupTarget:ve,layerEvent:st,layer:ze,eventTopMost:Qe}=E4();lt(r,oe,Ne=>t(2,u=Ne)),lt(r,ve,Ne=>t(3,a=Ne)),lt(r,st,Ne=>t(28,d=Ne)),lt(r,ze,Ne=>t(35,_=Ne));const wt=["click","dblclick","contextmenu"];let pt,nt=!1,Ht;function oi(){if(!pt)return;let Ne=pt.getElement();!Ne||Ne===Ht||(Ht=Ne,D==="hover"&&(Ht.style.pointerEvents="none"),Ht.addEventListener("mouseenter",()=>{t(24,nt=!0)},{passive:!0}),Ht.addEventListener("mouseleave",()=>{t(24,nt=!1)},{passive:!0}),Ht.addEventListener("click",()=>{P&&t(0,ye=!1)},{passive:!0}))}Md(()=>{if(u)return u.on("click",Fi),u.on("contextmenu",Fi),typeof a=="string"&&(u.on("click",a,Pt),u.on("dblclick",a,Pt),u.on("contextmenu",a,Pt),u.on("mousemove",a,Ei),u.on("mouseleave",a,Yt),u.on("touchstart",a,ct),u.on("touchend",a,Jt)),()=>{u!=null&&u.loaded()&&(pt==null||pt.remove(),u.off("click",Fi),u.off("contextmenu",Fi),a instanceof to.Marker?a.getPopup()===pt&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Pt),u.off("dblclick",a,Pt),u.off("contextmenu",a,Pt),u.off("mousemove",a,Ei),u.off("mouseleave",a,Yt),u.off("touchstart",a,ct),u.off("touchend",a,Jt)))}});function Dt(Ne){return B?!("marker"in Ne)&&!I4(Ne)&&Qe(Ne)!==_:!1}let mt=null,ti="normal";function Pt(Ne){Ne.type===D&&(Dt(Ne)||("layerType"in Ne?Ne.layerType==="deckgl"?(t(10,J=Ne.coordinate),t(4,mt=Ne.object?[Ne.object]:null)):(t(10,J=Ne.lngLat),t(4,mt=Ne.features??[])):(t(10,J=Ne.lngLat),t(4,mt=Ne.features??[])),setTimeout(()=>t(0,ye=!0))))}let Rt=null;function ct(Ne){Rt=Ne.point}function Jt(Ne){if(!Rt||D!=="hover")return;let dt=Rt.dist(Ne.point);Rt=null,dt<3&&(t(10,J=Ne.lngLat),t(4,mt=Ne.features??[]),pt.isOpen()?t(25,ti="justOpened"):(t(25,ti="opening"),t(0,ye=!0)))}function Yt(Ne){D!=="hover"||Rt||ti!=="normal"||(t(0,ye=!1),t(4,mt=null))}function Ei(Ne){if(!(D!=="hover"||Rt||ti!=="normal")){if(Dt(Ne)){t(0,ye=!1),t(4,mt=null);return}t(0,ye=!0),t(4,mt=Ne.features??[]),t(10,J=Ne.lngLat)}}function Fi(Ne){if(ti==="justOpened"){t(25,ti="normal");return}if(!L)return;let dt=[Ht,a instanceof to.Marker?a==null?void 0:a.getElement():null];ye&&pt.isOpen()&&!dt.some(bt=>bt==null?void 0:bt.contains(Ne.originalEvent.target))&&(Ne.type==="contextmenu"&&D==="contextmenu"||Ne.type!=="contextmenu")&&t(0,ye=!1)}or(()=>{u&&(pt!=null&&pt.isOpen())&&pt.remove()});let ht;const Ot=()=>t(0,ye=!1);function Fe(Ne){Xi[Ne?"unshift":"push"](()=>{ht=Ne,t(1,ht)})}return r.$$set=Ne=>{"closeButton"in Ne&&t(11,C=Ne.closeButton),"closeOnClickOutside"in Ne&&t(12,L=Ne.closeOnClickOutside),"closeOnClickInside"in Ne&&t(13,P=Ne.closeOnClickInside),"closeOnMove"in Ne&&t(14,R=Ne.closeOnMove),"openOn"in Ne&&t(15,D=Ne.openOn),"openIfTopMost"in Ne&&t(16,B=Ne.openIfTopMost),"focusAfterOpen"in Ne&&t(17,N=Ne.focusAfterOpen),"anchor"in Ne&&t(18,$=Ne.anchor),"offset"in Ne&&t(19,j=Ne.offset),"popupClass"in Ne&&t(20,le=Ne.popupClass),"maxWidth"in Ne&&t(21,ce=Ne.maxWidth),"lngLat"in Ne&&t(10,J=Ne.lngLat),"html"in Ne&&t(22,te=Ne.html),"open"in Ne&&t(0,ye=Ne.open),"$$scope"in Ne&&t(29,x=Ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,i=C??(!L&&!P)),r.$$.dirty[0]&146685952&&(pt||(t(23,pt=new to.Popup({closeButton:i,closeOnClick:!1,closeOnMove:R,focusAfterOpen:N,maxWidth:ce,className:le,anchor:$,offset:j})),Ht=pt.getElement(),pt.on("open",()=>{t(0,ye=!0),oi(),Ue("open",pt)}),pt.on("close",()=>{t(0,ye=!1),Ue("close",pt)}),pt.on("hover",()=>{Ue("hover",pt)}))),r.$$.dirty[0]&8421384&&pt&&a instanceof to.Marker&&(D==="click"?a.setPopup(pt):a.getPopup()===pt&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&wt.includes(D)&&(d==null?void 0:d.type)===D&&(Pt(d),St(st,d=null,d)),r.$$.dirty[0]&268468224&&t(26,l=D==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),r.$$.dirty[0]&352354304&&D==="hover"&&st&&(l&&d&&(d.layerType==="deckgl"?(t(10,J=d.coordinate),t(4,mt=d.object?[d.object]:null)):(t(10,J=d.lngLat),t(4,mt=d.features??[]))),t(0,ye=(l||nt)??!1)),r.$$.dirty[0]&12582914&&(ht?pt.setDOMContent(ht):te&&pt.setHTML(te)),r.$$.dirty[0]&8389632&&J&&pt.setLngLat(J),r.$$.dirty[0]&41943045&&u){let Ne=pt.isOpen();ye&&!Ne?(pt.addTo(u),ti==="opening"&&t(25,ti="justOpened")):!ye&&Ne&&pt.remove()}},[ye,ht,u,a,mt,oe,ve,st,ze,S,J,C,L,P,R,D,B,N,$,j,le,ce,te,pt,nt,ti,l,i,d,x,y,Ot,Fe]}class z4 extends Ut{constructor(e){super(),jt(this,e,P4,A4,Ft,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const D4=r=>({props:r&8}),Q_=r=>({props:F4(r[3])});function R4(r){let e;const t=r[1].default,i=Vi(t,r,r[2],Q_);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&12)&&Zi(i,t,l,l[2],e?qi(t,l[2],u,D4):Gi(l[2]),Q_)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function B4(r){let e,t;return e=new z4({props:{openOn:r[0],$$slots:{default:[R4,({features:i})=>({3:i}),({features:i})=>i?8:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.openOn=i[0]),l&12&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function F4(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function O4(r,e,t){let{$$slots:i={},$$scope:l}=e,{openOn:u="hover"}=e;return r.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,i,l]}class os extends Ut{constructor(e){super(),jt(this,e,O4,B4,Ft,{openOn:0})}}const N4=["==",["geometry-type"],"Polygon"],$4=["==",["geometry-type"],"LineString"];function Lu(r,e,t){let i=["match",r];for(let[l,u]of Object.entries(e))i.push(l),i.push(u);return i.push(t),i}function j4(r,e,t){let i=["step",r];for(let l=1;l<e.length;l++)i.push(t[l-1]),i.push(e[l]);return i.push(t[t.length-1]),i}function ia(){return{type:"FeatureCollection",features:[]}}const U4=r=>({}),ey=r=>({}),V4=r=>({}),ty=r=>({}),q4=r=>({}),iy=r=>({});function Z4(r){let e,t,i,l,u,d,a,_;const y=r[1].top,x=Vi(y,r,r[0],iy),S=r[1].left,C=Vi(S,r,r[0],ty),L=r[1].main,P=Vi(L,r,r[0],ey);return{c(){e=re("div"),t=re("div"),x&&x.c(),i=Le(),l=re("div"),u=re("div"),C&&C.c(),d=Le(),a=re("div"),P&&P.c(),ke(t,"class","top svelte-29q570"),ke(u,"class","left svelte-29q570"),ke(a,"class","main svelte-29q570"),ke(l,"class","content svelte-29q570"),ke(e,"class","flex-container svelte-29q570")},m(R,D){ae(R,e,D),Z(e,t),x&&x.m(t,null),Z(e,i),Z(e,l),Z(l,u),C&&C.m(u,null),Z(l,d),Z(l,a),P&&P.m(a,null),_=!0},p(R,[D]){x&&x.p&&(!_||D&1)&&Zi(x,y,R,R[0],_?qi(y,R[0],D,q4):Gi(R[0]),iy),C&&C.p&&(!_||D&1)&&Zi(C,S,R,R[0],_?qi(S,R[0],D,V4):Gi(R[0]),ty),P&&P.p&&(!_||D&1)&&Zi(P,L,R,R[0],_?qi(L,R[0],D,U4):Gi(R[0]),ey)},i(R){_||(K(x,R),K(C,R),K(P,R),_=!0)},o(R){ie(x,R),ie(C,R),ie(P,R),_=!1},d(R){R&&se(e),x&&x.d(R),C&&C.d(R),P&&P.d(R)}}}function G4(r,e,t){let{$$slots:i={},$$scope:l}=e;return r.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,i]}class W4 extends Ut{constructor(e){super(),jt(this,e,G4,Z4,Ft,{})}}const H4=r=>({}),ny=r=>({}),X4=r=>({}),ry=r=>({}),K4=r=>({}),oy=r=>({});function J4(r){let e,t,i,l,u,d;const a=r[4].top,_=Vi(a,r,r[3],oy),y=r[4].sidebar,x=Vi(y,r,r[3],ry),S=r[4].map,C=Vi(S,r,r[3],ny);return{c(){e=re("div"),_&&_.c(),t=Le(),i=re("div"),x&&x.c(),l=Le(),u=re("div"),C&&C.c()},m(L,P){ae(L,e,P),_&&_.m(e,null),r[5](e),ae(L,t,P),ae(L,i,P),x&&x.m(i,null),r[6](i),ae(L,l,P),ae(L,u,P),C&&C.m(u,null),r[7](u),d=!0},p(L,[P]){_&&_.p&&(!d||P&8)&&Zi(_,a,L,L[3],d?qi(a,L[3],P,K4):Gi(L[3]),oy),x&&x.p&&(!d||P&8)&&Zi(x,y,L,L[3],d?qi(y,L[3],P,X4):Gi(L[3]),ry),C&&C.p&&(!d||P&8)&&Zi(C,S,L,L[3],d?qi(S,L[3],P,H4):Gi(L[3]),ny)},i(L){d||(K(_,L),K(x,L),K(C,L),d=!0)},o(L){ie(_,L),ie(x,L),ie(C,L),d=!1},d(L){L&&(se(e),se(t),se(i),se(l),se(u)),_&&_.d(L),r[5](null),x&&x.d(L),r[6](null),C&&C.d(L),r[7](null)}}}function Y4(r,e,t){let i,l,u;lt(r,wp,S=>t(0,i=S)),lt(r,xp,S=>t(1,l=S)),lt(r,kp,S=>t(2,u=S));let{$$slots:d={},$$scope:a}=e;function _(S){Xi[S?"unshift":"push"](()=>{i=S,wp.set(i)})}function y(S){Xi[S?"unshift":"push"](()=>{l=S,xp.set(l)})}function x(S){Xi[S?"unshift":"push"](()=>{u=S,kp.set(u)})}return r.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[i,l,u,a,d,_,y,x]}class go extends Ut{constructor(e){super(),jt(this,e,Y4,J4,Ft,{})}}let wp=Si(null),xp=Si(null),kp=Si(null);function Q4(r){let e,t,i,l,u,d,a,_,y;return{c(){e=re("label"),t=je(`Basemap:
  `),i=re("select"),l=re("option"),l.textContent="MapTiler Dataviz",u=re("option"),u.textContent="MapTiler Streets",d=re("option"),d.textContent="MapTiler Satellite",a=re("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",zn(l,l.__value),u.__value="streets-v2",zn(u,u.__value),d.__value="hybrid",zn(d,d.__value),a.__value="uk-openzoomstack-light",zn(a,a.__value),r[0]===void 0&&rc(()=>r[1].call(i))},m(x,S){ae(x,e,S),Z(e,t),Z(e,i),Z(i,l),Z(i,u),Z(i,d),Z(i,a),nc(i,r[0],!0),_||(y=Mt(i,"change",r[1]),_=!0)},p(x,[S]){S&1&&nc(i,x[0])},i:Ct,o:Ct,d(x){x&&se(e),_=!1,y()}}}function eS(r,e,t){let i;lt(r,cp,u=>t(0,i=u));function l(){i=Lp(this),cp.set(i)}return[i,l]}class tS extends Ut{constructor(e){super(),jt(this,e,eS,Q4,Ft,{})}}let md=Si(!0);function iS(r){let e,t;return e=new ns({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.layout={visibility:i[0]?"none":"visible"}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function nS(r){let e,t;return e=new tr({props:{data:r[1],$$slots:{default:[iS]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function rS(r,e,t){let i;return lt(r,md,u=>t(0,i=u)),[i,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class oS extends Ut{constructor(e){super(),jt(this,e,rS,nS,Ft,{})}}function sS(r){let e,t;return e=new Dd({props:{lngLat:r[0],$$slots:{default:[lS]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.lngLat=i[0]),l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function aS(r){let e,t,i;function l(d){r[3](d)}let u={draggable:!0,$$slots:{default:[cS]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.lngLat=r[0]),e=new Dd({props:u}),Xi.push(()=>pr(e,"lngLat",l)),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,a){const _={};a&16&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.lngLat=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function lS(r){let e,t;const i=r[2].default,l=Vi(i,r,r[4],null);return{c(){e=re("span"),l&&l.c(),ke(e,"class","dot svelte-1gcxp27")},m(u,d){ae(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Zi(l,i,u,u[4],t?qi(i,u[4],d,null):Gi(u[4]),null)},i(u){t||(K(l,u),t=!0)},o(u){ie(l,u),t=!1},d(u){u&&se(e),l&&l.d(u)}}}function cS(r){let e,t;const i=r[2].default,l=Vi(i,r,r[4],null);return{c(){e=re("span"),l&&l.c(),ke(e,"class","dot svelte-1gcxp27")},m(u,d){ae(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Zi(l,i,u,u[4],t?qi(i,u[4],d,null):Gi(u[4]),null)},i(u){t||(K(l,u),t=!0)},o(u){ie(l,u),t=!1},d(u){u&&se(e),l&&l.d(u)}}}function uS(r){let e,t,i,l;const u=[aS,sS],d=[];function a(_,y){return _[1]?0:1}return e=a(r),t=d[e]=u[e](r),{c(){t.c(),i=En()},m(_,y){d[e].m(_,y),ae(_,i,y),l=!0},p(_,[y]){let x=e;e=a(_),e===x?d[e].p(_,y):(gi(),ie(d[x],1,1,()=>{d[x]=null}),_i(),t=d[e],t?t.p(_,y):(t=d[e]=u[e](_),t.c()),K(t,1),t.m(i.parentNode,i))},i(_){l||(K(t),l=!0)},o(_){ie(t),l=!1},d(_){_&&se(i),d[e].d(_)}}}function hS(r,e,t){let{$$slots:i={},$$scope:l}=e,{lngLat:u}=e,{draggable:d=!1}=e;function a(_){u=_,t(0,u)}return r.$$set=_=>{"lngLat"in _&&t(0,u=_.lngLat),"draggable"in _&&t(1,d=_.draggable),"$$scope"in _&&t(4,l=_.$$scope)},[u,d,i,a,l]}class Va extends Ut{constructor(e){super(),jt(this,e,hS,uS,Ft,{lngLat:0,draggable:1})}}const dS="/ltn/assets/help-d011708a.svg";function sy(r){let e,t;return e=new Ld({props:{$$slots:{default:[fS]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function fS(r){let e,t,i;const l=r[1].default,u=Vi(l,r,r[4],null);return{c(){e=re("h2"),e.textContent="Help",t=Le(),u&&u.c()},m(d,a){ae(d,e,a),ae(d,t,a),u&&u.m(d,a),i=!0},p(d,a){u&&u.p&&(!i||a&16)&&Zi(u,l,d,d[4],i?qi(l,d[4],a,null):Gi(d[4]),null)},i(d){i||(K(u,d),i=!0)},o(d){ie(u,d),i=!1},d(d){d&&(se(e),se(t)),u&&u.d(d)}}}function pS(r){let e,t,i,l,u,d,a=r[0]&&sy(r);return{c(){e=re("button"),e.innerHTML=`<img src="${dS}" title="Help" alt="Help"/>`,t=Le(),a&&a.c(),i=En(),ke(e,"class","svelte-gb6dzm")},m(_,y){ae(_,e,y),ae(_,t,y),a&&a.m(_,y),ae(_,i,y),l=!0,u||(d=Mt(e,"click",r[2]),u=!0)},p(_,[y]){_[0]?a?(a.p(_,y),y&1&&K(a,1)):(a=sy(_),a.c(),K(a,1),a.m(i.parentNode,i)):a&&(gi(),ie(a,1,1,()=>{a=null}),_i())},i(_){l||(K(a),l=!0)},o(_){ie(a),l=!1},d(_){_&&(se(e),se(t),se(i)),a&&a.d(_),u=!1,d()}}}function mS(r,e,t){let{$$slots:i={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return r.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,i,d,a,l]}class Wp extends Ut{constructor(e){super(),jt(this,e,mS,pS,Ft,{})}}function gS(r){let e,t,i,l;const u=r[1].default,d=Vi(u,r,r[0],null);return{c(){e=re("a"),d&&d.c(),ke(e,"href","#")},m(a,_){ae(a,e,_),d&&d.m(e,null),t=!0,i||(l=Mt(e,"click",Ep(r[2])),i=!0)},p(a,[_]){d&&d.p&&(!t||_&1)&&Zi(d,u,a,a[0],t?qi(u,a[0],_,null):Gi(a[0]),null)},i(a){t||(K(d,a),t=!0)},o(a){ie(d,a),t=!1},d(a){a&&se(e),d&&d.d(a),i=!1,l()}}}function _S(r,e,t){let{$$slots:i={},$$scope:l}=e;function u(d){pi.call(this,r,d)}return r.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,i,u]}class bi extends Ut{constructor(e){super(),jt(this,e,_S,gS,Ft,{})}}function yS(r){let e,t,i,l,u,d=r[0]+1+"",a,_,y=r[1].length+"",x,S,C,L,P,R,D;return{c(){e=re("div"),t=re("button"),i=je("Previous"),u=Le(),a=je(d),_=je(" / "),x=je(y),S=Le(),C=re("button"),L=je("Next"),t.disabled=l=r[0]==0,ke(t,"data-tooltip","Left"),C.disabled=P=r[0]==r[1].length-1,ke(C,"data-tooltip","Right"),Ri(e,"display","flex"),Ri(e,"justify-content","space-between")},m(B,N){ae(B,e,N),Z(e,t),Z(t,i),Z(e,u),Z(e,a),Z(e,_),Z(e,x),Z(e,S),Z(e,C),Z(C,L),R||(D=[Mt(window,"keydown",r[2]),Mt(t,"click",r[3]),Mt(C,"click",r[4])],R=!0)},p(B,[N]){N&1&&l!==(l=B[0]==0)&&(t.disabled=l),N&1&&d!==(d=B[0]+1+"")&&ai(a,d),N&2&&y!==(y=B[1].length+"")&&ai(x,y),N&3&&P!==(P=B[0]==B[1].length-1)&&(C.disabled=P)},i:Ct,o:Ct,d(B){B&&se(e),R=!1,mn(D)}}}function vS(r,e,t){let i;lt(r,is,y=>t(5,i=y));let{list:l}=e,{idx:u=0}=e;Md(()=>{i==null||i.keyboard.disable()}),or(()=>{i==null||i.keyboard.enable()});function d(y){y.key=="ArrowLeft"&&(y.stopPropagation(),a()),y.key=="ArrowRight"&&(y.stopPropagation(),_())}function a(){u!=0&&t(0,u--,u)}function _(){u!=l.length-1&&t(0,u++,u)}return r.$$set=y=>{"list"in y&&t(1,l=y.list),"idx"in y&&t(0,u=y.idx)},[u,l,d,a,_]}class Hp extends Ut{constructor(e){super(),jt(this,e,vS,yS,Ft,{list:1,idx:0})}}function bS(r,e){let t=new Set(r.getStyle().layers.filter(i=>i.type=="line").map(i=>i.id));return e=="dataviz"?["Road network","Path"].filter(i=>t.has(i)):e=="hybrid"?["Path","Road","Tunnel"].filter(i=>t.has(i)):e=="streets-v2"?r.getStyle().layers.filter(i=>i["source-layer"]=="transportation"&&i.type=="line").map(i=>i.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(i=>i["source-layer"]=="roads"&&i.type=="line").map(i=>i.id):[]}const{window:wS}=Mp;function xS(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R;return L=i0(r[8][0]),{c(){e=re("button"),e.textContent="Stop StreetView",t=Le(),i=re("fieldset"),l=re("legend"),l.textContent="Source:",u=Le(),d=re("label"),a=re("input"),_=je(`
      Google Street View`),y=Le(),x=re("label"),S=re("input"),C=je(`
      Bing Streetside`),ke(e,"class","secondary"),ke(a,"type","radio"),a.__value="google",zn(a,a.__value),ke(S,"type","radio"),S.__value="bing",zn(S,S.__value),L.p(a,S)},m(D,B){ae(D,e,B),ae(D,t,B),ae(D,i,B),Z(i,l),Z(i,u),Z(i,d),Z(d,a),a.checked=a.__value===r[0],Z(d,_),Z(i,y),Z(i,x),Z(x,S),S.checked=S.__value===r[0],Z(x,C),P||(R=[Mt(e,"click",r[3]),Mt(a,"change",r[7]),Mt(S,"change",r[9])],P=!0)},p(D,B){B&1&&(a.checked=a.__value===D[0]),B&1&&(S.checked=S.__value===D[0])},d(D){D&&(se(e),se(t),se(i)),L.r(),P=!1,mn(R)}}}function kS(r){let e,t,i;return{c(){e=re("button"),e.textContent="StreetView",ke(e,"class","secondary")},m(l,u){ae(l,e,u),t||(i=Mt(e,"click",r[2]),t=!0)},p:Ct,d(l){l&&se(e),t=!1,i()}}}function SS(r){let e,t,i;function l(a,_){return a[1]?kS:xS}let u=l(r),d=u(r);return{c(){d.c(),e=En()},m(a,_){d.m(a,_),ae(a,e,_),t||(i=Mt(wS,"keydown",r[4]),t=!0)},p(a,[_]){u===(u=l(a))&&d?d.p(a,_):(d.d(1),d=u(a),d&&(d.c(),d.m(e.parentNode,e)))},i:Ct,o:Ct,d(a){a&&se(e),d.d(a),t=!1,i()}}}function TS(r,e,t){let i;lt(r,md,R=>t(1,i=R));let{map:l}=e,{maptilerBasemap:u}=e,d="google",a=[];function _(){St(md,i=!1,i),l.on("click",x),l.getCanvas().style.cursor="crosshair";for(let R of bS(l,u))a.push([R,l.getPaintProperty(R,"line-color")]),l.setPaintProperty(R,"line-color","cyan")}function y(){St(md,i=!0,i),l.off("click",x),l.getCanvas().style.cursor="inherit";for(let[R,D]of a)l.setPaintProperty(R,"line-color",D);a=[]}or(y);function x(R){let D=R.lngLat.lng,B=R.lngLat.lat;d=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${D}&cbp=11,0,0,0,0`,"_blank"):d=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${D}&style=x`,"_blank")}function S(R){!i&&R.key=="Escape"&&(R.stopPropagation(),y())}const C=[[]];function L(){d=this.__value,t(0,d)}function P(){d=this.__value,t(0,d)}return r.$$set=R=>{"map"in R&&t(5,l=R.map),"maptilerBasemap"in R&&t(6,u=R.maptilerBasemap)},[d,i,_,y,S,l,u,L,C,P]}class CS extends Ut{constructor(e){super(),jt(this,e,TS,SS,Ft,{map:5,maptilerBasemap:6})}}function nn(r,e=!0){return{id:r,beforeId:MS(r),eventsIfTopMost:e}}function MS(r){let e=Dr(is);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,i=!1;for(let l=ay.length-1;l>=0;l--){let u=ay[l];if(u==r){i=!0;break}e.getLayer(u)&&(t=u)}if(!i)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Qf=r=>r,ep=r=>r;const ay=[Qf(ep("Background")),"neighbourhood-boundaries",Qf("Ferry line"),"debug-borders","debug-filters","debug-intersections","debug-movements-outline","debug-movements-fill","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus","predict-impact",ep("Building"),"draw-area-lines","draw-area-preview","one-ways",ep("Road labels"),Qf("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function ES(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Qs(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function ea(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function IS(r){let e;return{c(){e=je("Back")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function LS(r){let e,t,i,l;return e=new bi({props:{$$slots:{default:[IS]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0,i||(l=Mt(window,"keydown",r[1]),i=!0)},p(u,[d]){const a={};d&8&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u),i=!1,l()}}}function AS(r){let e=rs();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class qa extends Ut{constructor(e){super(),jt(this,e,AS,LS,Ft,{})}}function Sp(r,e,t){let i=new Set(r.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(i.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function PS(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function zS(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function DS(r){let e,t,i,l,u,d,a,_,y,x,S;return u=new bi({props:{$$slots:{default:[PS]},$$scope:{ctx:r}}}),u.$on("click",r[10]),_=new bi({props:{$$slots:{default:[zS]},$$scope:{ctx:r}}}),_.$on("click",r[11]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),x.textContent="Use an auto-generated boundary",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(C,L){ae(C,e,L),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),S=!0},p(C,L){const P={};L&32768&&(P.$$scope={dirty:L,ctx:C}),u.$set(P);const R={};L&32768&&(R.$$scope={dirty:L,ctx:C}),_.$set(R)},i(C){S||(K(u.$$.fragment,C),K(_.$$.fragment,C),S=!0)},o(C){ie(u.$$.fragment,C),ie(_.$$.fragment,C),S=!1},d(C){C&&se(e),Te(u),Te(_)}}}function RS(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B;return t=new qa({}),t.$on("click",r[7]),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Le(),d=re("button"),d.textContent="Export to GeoJSON",a=Le(),_=re("label"),y=je(`Minimum area (km²)
      `),x=re("input"),S=Le(),C=re("label"),L=re("input"),P=je(`
      Remove areas not touching a big road`),ke(d,"class","secondary"),ke(x,"type","number"),ke(x,"min","0"),ke(x,"max","1"),ke(x,"step","0.01"),ke(L,"type","checkbox"),ke(e,"slot","sidebar")},m(N,$){ae(N,e,$),Se(t,e,null),Z(e,i),Z(e,l),Z(e,u),Z(e,d),Z(e,a),Z(e,_),Z(_,y),Z(_,x),zn(x,r[0]),Z(e,S),Z(e,C),Z(C,L),L.checked=r[1],Z(C,P),R=!0,D||(B=[Mt(d,"click",r[5]),Mt(x,"input",r[8]),Mt(L,"change",r[9])],D=!0)},p(N,$){$&1&&Ip(x.value)!==N[0]&&zn(x,N[0]),$&2&&(L.checked=N[1])},i(N){R||(K(t.$$.fragment,N),R=!0)},o(N){ie(t.$$.fragment,N),R=!1},d(N){N&&se(e),Te(t),D=!1,mn(B)}}}function BS(r){let e,t,i=r[14].area_km2.toFixed(1)+"",l,u,d,a,_,y=r[14].touches_big_road+"",x,S,C=r[14].touches_railway+"",L,P,R=r[14].touches_waterway+"",D;return{c(){e=re("p"),t=je("Area: "),l=je(i),u=je(" km²"),d=Le(),a=re("p"),_=je("Borders roads = "),x=je(y),S=je(", railway = "),L=je(C),P=je(`,
            water = `),D=je(R)},m(B,N){ae(B,e,N),Z(e,t),Z(e,l),Z(e,u),ae(B,d,N),ae(B,a,N),Z(a,_),Z(a,x),Z(a,S),Z(a,L),Z(a,P),Z(a,D)},p(B,N){N&16384&&i!==(i=B[14].area_km2.toFixed(1)+"")&&ai(l,i),N&16384&&y!==(y=B[14].touches_big_road+"")&&ai(x,y),N&16384&&C!==(C=B[14].touches_railway+"")&&ai(L,C),N&16384&&R!==(R=B[14].touches_waterway+"")&&ai(D,R)},d(B){B&&(se(e),se(d),se(a))}}}function FS(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[BS,({props:i})=>({14:i}),({props:i})=>i?16384:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function OS(r){let e,t,i,l;const u=[nn("auto-boundaries-areas"),{filter:r[6](r[0],r[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":ja(.3,.7)}},{hoverCursor:"pointer"}];let d={$$slots:{default:[FS]},$$scope:{ctx:r}};for(let y=0;y<u.length;y+=1)d=en(d,u[y]);e=new ns({props:d}),e.$on("click",r[4]);const a=[nn("auto-boundaries-severances"),{filter:$4},{manageHoverState:!0},{paint:{"line-color":ja("black","red"),"line-width":3}}];let _={};for(let y=0;y<a.length;y+=1)_=en(_,a[y]);return i=new Hr({props:_}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),l=!0},p(y,x){const S=x&67?Na(u,[u[0],{filter:y[6](y[0],y[1])},u[2],u[3],u[4]]):{};x&32768&&(S.$$scope={dirty:x,ctx:y}),e.$set(S);const C={};i.$set(C)},i(y){l||(K(e.$$.fragment,y),K(i.$$.fragment,y),l=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),l=!1},d(y){y&&se(t),Te(e,y),Te(i,y)}}}function NS(r){let e,t,i;return t=new tr({props:{data:r[3],generateId:!0,$$slots:{default:[OS]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","map")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p(l,u){const d={};u&32771&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function $S(r){let e,t;return e=new go({props:{$$slots:{map:[NS],sidebar:[RS],top:[DS]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function jS(r,e,t){let i,l,u;lt(r,Wt,B=>t(2,i=B)),lt(r,Fu,B=>t(12,l=B)),lt(r,Cn,B=>t(13,u=B));let d=u.renderAutoBoundaries(),a=0,_=!0;function y(B){let N=Sp(u,"What do you want to name the neighbourhood?","");if(N)try{let $={type:"Feature",properties:{},geometry:d.features[B.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(N,$),sc(),u.setCurrentNeighbourhood(N,l),St(Wt,i={mode:"neighbourhood"},i)}catch($){console.log($),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function x(){yd("auto_boundaries.geojson",JSON.stringify(d,null,"  "))}function S(B,N){let $=["all",N4,[">=",["get","area_km2"],B]];return N&&$.push(["get","touches_big_road"]),$}const C=()=>St(Wt,i={mode:"pick-neighbourhood"},i);function L(){a=Ip(this.value),t(0,a)}function P(){_=this.checked,t(1,_)}return[a,_,i,d,y,x,S,C,L,P,()=>St(Wt,i={mode:"title",firstLoad:!1},i),()=>St(Wt,i={mode:"pick-neighbourhood"},i)]}class US extends Ut{constructor(e){super(),jt(this,e,jS,$S,Ft,{})}}function VS(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function qS(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function ZS(r){let e,t,i,l,u,d,a,_,y,x,S;return u=new bi({props:{$$slots:{default:[VS]},$$scope:{ctx:r}}}),u.$on("click",r[8]),_=new bi({props:{$$slots:{default:[qS]},$$scope:{ctx:r}}}),_.$on("click",r[9]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),x.textContent="Debug intersections",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(C,L){ae(C,e,L),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),S=!0},p(C,L){const P={};L&1024&&(P.$$scope={dirty:L,ctx:C}),u.$set(P);const R={};L&1024&&(R.$$scope={dirty:L,ctx:C}),_.$set(R)},i(C){S||(K(u.$$.fragment,C),K(_.$$.fragment,C),S=!0)},o(C){ie(u.$$.fragment,C),ie(_.$$.fragment,C),S=!1},d(C){C&&se(e),Te(u),Te(_)}}}function ly(r){let e,t,i,l,u,d,a;function _(x){r[7](x)}let y={list:r[0].features};return r[1]!==void 0&&(y.idx=r[1]),i=new Hp({props:y}),Xi.push(()=>pr(i,"idx",_)),{c(){e=re("button"),e.textContent="Pick another intersection",t=Le(),Ce(i.$$.fragment),ke(e,"class","secondary")},m(x,S){ae(x,e,S),ae(x,t,S),Se(i,x,S),u=!0,d||(a=Mt(e,"click",r[6]),d=!0)},p(x,S){const C={};S&1&&(C.list=x[0].features),!l&&S&2&&(l=!0,C.idx=x[1],fr(()=>l=!1)),i.$set(C)},i(x){u||(K(i.$$.fragment,x),u=!0)},o(x){ie(i.$$.fragment,x),u=!1},d(x){x&&(se(e),se(t)),Te(i,x),d=!1,a()}}}function GS(r){let e,t,i,l,u,d;t=new qa({}),t.$on("click",r[5]);let a=r[0].features.length>0&&ly(r);return{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("p"),l.textContent="Purple intersections have some kind of turn restriction.",u=Le(),a&&a.c(),ke(e,"slot","sidebar")},m(_,y){ae(_,e,y),Se(t,e,null),Z(e,i),Z(e,l),Z(e,u),a&&a.m(e,null),d=!0},p(_,y){_[0].features.length>0?a?(a.p(_,y),y&1&&K(a,1)):(a=ly(_),a.c(),K(a,1),a.m(e,null)):a&&(gi(),ie(a,1,1,()=>{a=null}),_i())},i(_){d||(K(t.$$.fragment,_),K(a),d=!0)},o(_){ie(t.$$.fragment,_),ie(a),d=!1},d(_){_&&se(e),Te(t),a&&a.d()}}}function WS(r){let e,t;const i=[nn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new zd({props:l}),e.$on("click",r[4]),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function HS(r){let e,t,i,l;const u=[nn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let d={};for(let y=0;y<u.length;y+=1)d=en(d,u[y]);e=new Hr({props:d});const a=[nn("debug-movements-fill"),{filter:["==",["id"],r[1]]},{paint:{"fill-color":"cyan"}}];let _={};for(let y=0;y<a.length;y+=1)_=en(_,a[y]);return i=new ns({props:_}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),l=!0},p(y,x){const S={};e.$set(S);const C=x&2?Na(a,[a[0],{filter:["==",["id"],y[1]]},a[2]]):{};i.$set(C)},i(y){l||(K(e.$$.fragment,y),K(i.$$.fragment,y),l=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),l=!1},d(y){y&&se(t),Te(e,y),Te(i,y)}}}function XS(r){let e,t,i,l,u;return t=new tr({props:{data:sr(r[2]).getAllIntersections(),generateId:!0,$$slots:{default:[WS]},$$scope:{ctx:r}}}),l=new tr({props:{data:r[0],generateId:!0,$$slots:{default:[HS]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Se(t,e,null),Z(e,i),Se(l,e,null),u=!0},p(d,a){const _={};a&4&&(_.data=sr(d[2]).getAllIntersections()),a&1024&&(_.$$scope={dirty:a,ctx:d}),t.$set(_);const y={};a&1&&(y.data=d[0]),a&1026&&(y.$$scope={dirty:a,ctx:d}),l.$set(y)},i(d){u||(K(t.$$.fragment,d),K(l.$$.fragment,d),u=!0)},o(d){ie(t.$$.fragment,d),ie(l.$$.fragment,d),u=!1},d(d){d&&se(e),Te(t),Te(l)}}}function KS(r){let e,t;return e=new go({props:{$$slots:{map:[XS],sidebar:[GS],top:[ZS]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1039&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function JS(r,e,t){let i,l;lt(r,Cn,L=>t(2,i=L)),lt(r,Wt,L=>t(3,l=L));let u=ia(),d=0;function a(L){t(0,u=i.getMovements(L.detail.features[0].id)),t(1,d=0)}const _=()=>St(Wt,l={mode:"pick-neighbourhood"},l),y=()=>t(0,u=ia());function x(L){d=L,t(1,d)}return[u,d,i,l,a,_,y,x,()=>St(Wt,l={mode:"title",firstLoad:!1},l),()=>St(Wt,l={mode:"pick-neighbourhood"},l)]}class YS extends Ut{constructor(e){super(),jt(this,e,JS,KS,Ft,{})}}function QS(r){let e,t,i,l,u,d;const a=[nn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let _={};for(let L=0;L<a.length;L+=1)_=en(_,a[L]);e=new ns({props:_});const y=[nn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let x={};for(let L=0;L<y.length;L+=1)x=en(x,y[L]);i=new ns({props:x});const S=[nn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let C={};for(let L=0;L<S.length;L+=1)C=en(C,S[L]);return u=new Hr({props:C}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment)},m(L,P){Se(e,L,P),ae(L,t,P),Se(i,L,P),ae(L,l,P),Se(u,L,P),d=!0},p(L,[P]){const R=P&1?Na(a,[a[0],a[1],{layout:{visibility:L[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set(R);const D={};i.$set(D);const B={};u.$set(B)},i(L){d||(K(e.$$.fragment,L),K(i.$$.fragment,L),K(u.$$.fragment,L),d=!0)},o(L){ie(e.$$.fragment,L),ie(i.$$.fragment,L),ie(u.$$.fragment,L),d=!1},d(L){L&&(se(t),se(l)),Te(e,L),Te(i,L),Te(u,L)}}}function e3(r,e,t){let i;return lt(r,kd,l=>t(0,i=l)),[i]}class Bd extends Ut{constructor(e){super(),jt(this,e,e3,QS,Ft,{})}}function t3(r){let e,t;const i=[nn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new ns({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}class Fd extends Ut{constructor(e){super(),jt(this,e,null,t3,Ft,{})}}let e1=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],t1=[20,30,40,50,60,70];const i3=r=>({}),cy=r=>({});function uy(r){let e;const t=r[7]["line-popup"],i=Vi(t,r,r[9],cy);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&512)&&Zi(i,t,l,l[9],e?qi(t,l[9],u,i3):Gi(l[9]),cy)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function n3(r){let e,t,i=r[0]&&uy(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u&1&&K(i,1)):(i=uy(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function r3(r){let e,t,i,l;const u=[nn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let d={};for(let y=0;y<u.length;y+=1)d=en(d,u[y]);e=new Hr({props:d});const a=[nn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":ja(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let _={$$slots:{default:[n3]},$$scope:{ctx:r}};for(let y=0;y<a.length;y+=1)_=en(_,a[y]);return i=new Hr({props:_}),i.$on("click",r[8]),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),l=!0},p(y,[x]){const S=x&84?Na(u,[u[0],u[1],{paint:{"line-width":y[6](y[2],y[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(S);const C=x&125?Na(a,[a[0],a[1],x&124&&{paint:{"line-width":y[6](y[2],y[4].maxShortcuts,0),"line-color":y[5](y[3],y[4].maxShortcuts),"line-opacity":ja(1,.5)}},x&1&&{manageHoverState:y[0]},x&1&&{hoverCursor:y[0]?"pointer":void 0}]):{};x&513&&(C.$$scope={dirty:x,ctx:y}),i.$set(C)},i(y){l||(K(e.$$.fragment,y),K(i.$$.fragment,y),l=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),l=!1},d(y){y&&se(t),Te(e,y),Te(i,y)}}}function o3(r,e,t){let i,l;lt(r,hp,L=>t(2,i=L)),lt(r,kd,L=>t(3,l=L));let{$$slots:u={},$$scope:d}=e,a=Id("neighbourhoodGj"),{interactive:_=!0}=e,{onClickLine:y=(L,P)=>{}}=e;function x(L,P){return L=="cells"?["get","color"]:L=="edits"?["case",["get","edited"],"grey","white"]:L=="speeds"?j4(["get","speed_mph"],t1,e1):P<=2?ja("white","blue"):ja(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",P,"#A32015"],"blue")}function S(L,P,R){return!L||P<=2?ES(R):["interpolate",["linear"],["get","shortcuts"],0,5+R,P,25+R]}const C=L=>_&&y(L.detail.features[0],L.detail.event.lngLat);return r.$$set=L=>{"interactive"in L&&t(0,_=L.interactive),"onClickLine"in L&&t(1,y=L.onClickLine),"$$scope"in L&&t(9,d=L.$$scope)},[_,y,i,l,a,x,S,u,C,d]}class Hu extends Ut{constructor(e){super(),jt(this,e,o3,r3,Ft,{interactive:0,onClickLine:1})}}function s3(r){let e;const t=r[3].default,i=Vi(t,r,r[5],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&32)&&Zi(i,t,l,l[5],e?qi(t,l[5],u,null):Gi(l[5]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function a3(r){let e,t;const i=[nn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[s3]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new B0({props:l}),e.$on("click",r[4]),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};d&32&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function l3(r){let e,t;return e=new tr({props:{data:r[0],generateId:!0,$$slots:{default:[a3]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&32&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function c3(r,e,t){let i,l,u;lt(r,Cn,y=>t(1,l=y)),lt(r,ws,y=>t(2,u=y));let{$$slots:d={},$$scope:a}=e;function _(y){pi.call(this,r,y)}return r.$$set=y=>{"$$scope"in y&&t(5,a=y.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,i=u>0?l.renderModalFilters():ia())},[i,l,u,d,_,a]}class Za extends Ut{constructor(e){super(),jt(this,e,c3,l3,Ft,{})}}function u3(r){let e,t;const i=[nn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new B0({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}class Od extends Ut{constructor(e){super(),jt(this,e,null,u3,Ft,{})}}function h3(r){let e;const t=r[3].default,i=Vi(t,r,r[4],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16)&&Zi(i,t,l,l[4],e?qi(t,l[4],u,null):Gi(l[4]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function d3(r){let e,t;return e=new tr({props:{data:r[0],generateId:!0,$$slots:{default:[h3]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function f3(r,e,t){let i,l;lt(r,Cn,_=>t(2,l=_));let{$$slots:u={},$$scope:d}=e,{input:a=null}=e;return r.$$set=_=>{"input"in _&&t(1,a=_.input),"$$scope"in _&&t(4,d=_.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,i=a||l.renderNeighbourhood()),r.$$.dirty&1&&Ed("neighbourhoodGj",i)},[i,a,l,u,d]}class Xu extends Ut{constructor(e){super(),jt(this,e,f3,d3,Ft,{input:1})}}function p3(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function m3(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function g3(r){let e;return{c(){e=je("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function _3(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P;return u=new bi({props:{$$slots:{default:[p3]},$$scope:{ctx:r}}}),u.$on("click",r[4]),_=new bi({props:{$$slots:{default:[m3]},$$scope:{ctx:r}}}),_.$on("click",r[5]),S=new bi({props:{$$slots:{default:[g3]},$$scope:{ctx:r}}}),S.$on("click",r[6]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),Ce(S.$$.fragment),C=Le(),L=re("li"),L.textContent="Debug mode",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(R,D){ae(R,e,D),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),Se(S,x,null),Z(i,C),Z(i,L),P=!0},p(R,D){const B={};D&256&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const N={};D&256&&(N.$$scope={dirty:D,ctx:R}),_.$set(N);const $={};D&256&&($.$$scope={dirty:D,ctx:R}),S.$set($)},i(R){P||(K(u.$$.fragment,R),K(_.$$.fragment,R),K(S.$$.fragment,R),P=!0)},o(R){ie(u.$$.fragment,R),ie(_.$$.fragment,R),ie(S.$$.fragment,R),P=!1},d(R){R&&se(e),Te(u),Te(_),Te(S)}}}function y3(r){let e,t,i;return t=new qa({}),t.$on("click",r[3]),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","sidebar")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p:Ct,i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function v3(r){let e,t;return e=new Ap({props:{properties:r[7]}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function b3(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[v3,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function w3(r){let e,t;return e=new Ap({props:{properties:r[7]}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function x3(r){let e,t,i;return t=new os({props:{openOn:"hover",$$slots:{default:[w3,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p(l,u){const d={};u&384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function k3(r){let e,t,i,l,u,d,a,_,y,x;e=new Fd({}),i=new Bd({}),u=new Od({});const S=[nn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let C={$$slots:{default:[b3]},$$scope:{ctx:r}};for(let L=0;L<S.length;L+=1)C=en(C,S[L]);return a=new zd({props:C}),y=new Hu({props:{interactive:!0,onClickLine:r[2],$$slots:{"line-popup":[x3]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),Ce(a.$$.fragment),_=Le(),Ce(y.$$.fragment)},m(L,P){Se(e,L,P),ae(L,t,P),Se(i,L,P),ae(L,l,P),Se(u,L,P),ae(L,d,P),Se(a,L,P),ae(L,_,P),Se(y,L,P),x=!0},p(L,P){const R={};P&256&&(R.$$scope={dirty:P,ctx:L}),a.$set(R);const D={};P&256&&(D.$$scope={dirty:P,ctx:L}),y.$set(D)},i(L){x||(K(e.$$.fragment,L),K(i.$$.fragment,L),K(u.$$.fragment,L),K(a.$$.fragment,L),K(y.$$.fragment,L),x=!0)},o(L){ie(e.$$.fragment,L),ie(i.$$.fragment,L),ie(u.$$.fragment,L),ie(a.$$.fragment,L),ie(y.$$.fragment,L),x=!1},d(L){L&&(se(t),se(l),se(d),se(_)),Te(e,L),Te(i,L),Te(u,L),Te(a,L),Te(y,L)}}}function S3(r){let e,t;return e=new Ap({props:{properties:r[7]}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function T3(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[S3,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function C3(r){let e,t;const i=[nn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[T3]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new zd({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};d&256&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function M3(r){let e,t,i,l,u;return t=new Xu({props:{$$slots:{default:[k3]},$$scope:{ctx:r}}}),l=new tr({props:{data:sr(r[0]).renderModalFilters(),generateId:!0,$$slots:{default:[C3]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Se(t,e,null),Z(e,i),Se(l,e,null),u=!0},p(d,a){const _={};a&256&&(_.$$scope={dirty:a,ctx:d}),t.$set(_);const y={};a&1&&(y.data=sr(d[0]).renderModalFilters()),a&256&&(y.$$scope={dirty:a,ctx:d}),l.$set(y)},i(d){u||(K(t.$$.fragment,d),K(l.$$.fragment,d),u=!0)},o(d){ie(t.$$.fragment,d),ie(l.$$.fragment,d),u=!1},d(d){d&&se(e),Te(t),Te(l)}}}function E3(r){let e,t;return e=new go({props:{$$slots:{map:[M3],sidebar:[y3],top:[_3]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function I3(r,e,t){let i,l;return lt(r,Cn,x=>t(0,i=x)),lt(r,Wt,x=>t(1,l=x)),[i,l,(x,S)=>window.open(sr(x.properties).way,"_blank"),()=>St(Wt,l={mode:"neighbourhood"},l),()=>St(Wt,l={mode:"title",firstLoad:!1},l),()=>St(Wt,l={mode:"pick-neighbourhood"},l),()=>St(Wt,l={mode:"neighbourhood"},l)]}class L3 extends Ut{constructor(e){super(),jt(this,e,I3,E3,Ft,{})}}var fo=63710088e-1,i1={centimeters:fo*100,centimetres:fo*100,degrees:360/(2*Math.PI),feet:fo*3.28084,inches:fo*39.37,kilometers:fo/1e3,kilometres:fo/1e3,meters:fo,metres:fo,miles:fo/1609.344,millimeters:fo*1e3,millimetres:fo*1e3,nauticalmiles:fo/1852,radians:1,yards:fo*1.0936};function A3(r,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=r,i}function Tp(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!hy(r[0])||!hy(r[1]))throw new Error("coordinates must contain numbers");return A3({type:"Point",coordinates:r},e,t)}function P3(r,e="kilometers"){const t=i1[e];if(!t)throw new Error(e+" units is invalid");return r*t}function z3(r,e="kilometers"){const t=i1[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Cp(r){return r%(2*Math.PI)*180/Math.PI}function jo(r){return r%360*Math.PI/180}function hy(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Vu(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function D3(r){return r.type==="Feature"?r.geometry:r}function n1(r,e,t={}){if(t.final===!0)return R3(r,e);const i=Vu(r),l=Vu(e),u=jo(i[0]),d=jo(l[0]),a=jo(i[1]),_=jo(l[1]),y=Math.sin(d-u)*Math.cos(_),x=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Cp(Math.atan2(y,x))}function R3(r,e){let t=n1(e,r);return t=(t+180)%360,t}function B3(r,e,t,i={}){const l=Vu(r),u=jo(l[0]),d=jo(l[1]),a=jo(t),_=z3(e,i.units),y=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),x=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(y)),S=Cp(x),C=Cp(y);return Tp([S,C],i.properties)}function F3(r,e,t={}){var i=Vu(r),l=Vu(e),u=jo(l[1]-i[1]),d=jo(l[0]-i[0]),a=jo(i[1]),_=jo(l[1]),y=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return P3(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),t.units)}function O3(r,e,t={}){const l=D3(r).coordinates;let u=0;for(let d=0;d<l.length&&!(e>=u&&d===l.length-1);d++)if(u>=e){const a=e-u;if(a){const _=n1(l[d],l[d-1])-180;return B3(l[d],a,_,t)}else return Tp(l[d])}else u+=F3(l[d],l[d+1],t);return Tp(l[l.length-1])}var N3=O3;function $3(r){let e,t;const i=[nn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new zd({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function j3(r){let e,t;return e=new tr({props:{data:r[0],$$slots:{default:[$3]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&1024&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}let U3=50,V3=100,q3=.01;function Z3(r,e,t){let{paths:i}=e,l=_(),u=y(),d=S(),a=setInterval(C,V3);or(()=>clearInterval(a));function _(){return i.features.map(L=>1/L.properties.directness).reduce((L,P)=>L+P,0)}function y(){return i.features.length==0?[]:Array.from({length:U3},x)}function x(){let L=Math.random()*l,P=0;for(let[R,D]of i.features.entries())if(P+=1/D.properties.directness,L<P)return{idx:R,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function S(){return{type:"FeatureCollection",features:u.map(({idx:L,distance:P})=>N3(i.features[L],P,{units:"kilometers"}))}}function C(){for(let[L,P]of u.entries())P.distance+=q3,P.distance>=i.features[P.idx].properties.length_meters/1e3&&(u[L]=x());t(0,d=S())}return r.$$set=L=>{"paths"in L&&t(1,i=L.paths)},r.$$.update=()=>{r.$$.dirty&2&&i&&(l=_(),u=y())},[d,i]}class G3 extends Ut{constructor(e){super(),jt(this,e,Z3,j3,Ft,{paths:1})}}function dy(r,e,t){const i=r.slice();return i[7]=e[t][0],i[8]=e[t][1],i[9]=e[t][2],i}function fy(r){let e,t,i,l,u,d,a=r[8]+"",_,y,x,S,C;function L(){return r[3](r[7])}return{c(){e=re("button"),t=re("img"),l=Le(),u=re("br"),d=Le(),_=je(a),y=Le(),Dn(t.src,i=`/ltn//filters/${r[7]}_icon.gif`)||ke(t,"src",i),ke(t,"width","80"),ke(t,"alt",r[8]),ke(e,"class","outline"),Ri(e,"width","100%"),e.disabled=x=r[0]==r[7]},m(P,R){ae(P,e,R),Z(e,t),Z(e,l),Z(e,u),Z(e,d),Z(e,_),Z(e,y),S||(C=Mt(e,"click",L),S=!0)},p(P,R){r=P,R&1&&x!==(x=r[0]==r[7])&&(e.disabled=x)},d(P){P&&se(e),S=!1,C()}}}function W3(r){let e,t,i,l,u,d,a,_,y,x,S,C,L=r[1][2]+"",P,R,D,B,N,$,j=Tn(r[2]),le=[];for(let J=0;J<j.length;J+=1)le[J]=fy(dy(r,j,J));function ce(){return r[4](r[6])}return{c(){e=re("h3"),e.textContent="Choose a modal filter to place on streets",t=Le(),i=re("table"),l=re("tr"),u=re("td");for(let J=0;J<le.length;J+=1)le[J].c();d=Le(),a=re("td"),_=re("img"),S=Le(),C=re("p"),P=je(L),R=Le(),D=re("center"),B=re("button"),B.textContent="Confirm",Dn(_.src,y=`/ltn//filters/${r[0]}.gif`)||ke(_,"src",y),ke(_,"height","300"),ke(_,"alt",x=r[1][1])},m(J,te){ae(J,e,te),ae(J,t,te),ae(J,i,te),Z(i,l),Z(l,u);for(let ye=0;ye<le.length;ye+=1)le[ye]&&le[ye].m(u,null);Z(l,d),Z(l,a),Z(a,_),Z(a,S),Z(a,C),Z(C,P),ae(J,R,te),ae(J,D,te),Z(D,B),N||($=Mt(B,"click",ce),N=!0)},p(J,te){if(r=J,te&5){j=Tn(r[2]);let ye;for(ye=0;ye<j.length;ye+=1){const Ue=dy(r,j,ye);le[ye]?le[ye].p(Ue,te):(le[ye]=fy(Ue),le[ye].c(),le[ye].m(u,null))}for(;ye<le.length;ye+=1)le[ye].d(1);le.length=j.length}te&1&&!Dn(_.src,y=`/ltn//filters/${r[0]}.gif`)&&ke(_,"src",y),te&2&&x!==(x=r[1][1])&&ke(_,"alt",x),te&2&&L!==(L=r[1][2]+"")&&ai(P,L)},d(J){J&&(se(e),se(t),se(i),se(R),se(D)),Vo(le,J),N=!1,$()}}}function H3(r){let e,t;return e=new Ld({props:{$$slots:{default:[W3,({dialog:i})=>({6:i}),({dialog:i})=>i?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function X3(r,e,t){let i,l;lt(r,up,y=>t(0,l=y));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const d=y=>St(up,l=y,l),a=y=>sr(y).close();function _(y){pi.call(this,r,y)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,i=u.find(y=>y[0]==l))},[l,i,u,d,a,_]}class K3 extends Ut{constructor(e){super(),jt(this,e,X3,H3,Ft,{})}}function py(r){let e,t;return e=new tr({props:{data:r[0],$$slots:{default:[J3]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.data=i[0]),l&64&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function J3(r){let e,t;const i=[nn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function Y3(r){let e,t,i=r[0]&&py(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&K(i,1)):(i=py(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function Q3(r,e,t){let{map:i}=e,l=null;const u=rs();i.on("dragstart",d),i.on("mousemove",a),i.on("mouseup",_),or(()=>{i.dragPan.enable(),i.off("dragstart",d),i.off("mousemove",a),i.off("mouseup",_)});function d(){i.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(y){l&&(l.geometry.coordinates.push(y.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return r.$$set=y=>{"map"in y&&t(1,i=y.map)},[l,i]}class e5 extends Ut{constructor(e){super(),jt(this,e,Q3,Y3,Ft,{map:1})}}function t5(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function i5(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function n5(r){let e;return{c(){e=re("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function r5(r){let e;return{c(){e=je("View shortcuts")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function o5(r){let e;return{c(){e=je("Route")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function s5(r){let e;return{c(){e=je("Impact routing to one destination")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function a5(r){let e;return{c(){e=je("Change this boundary")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function l5(r){let e;return{c(){e=je("Debug")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function c5(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B,N,$,j,le,ce,J,te,ye,Ue,oe,ve,st,ze;return u=new bi({props:{$$slots:{default:[t5]},$$scope:{ctx:r}}}),u.$on("click",r[30]),_=new bi({props:{$$slots:{default:[i5]},$$scope:{ctx:r}}}),_.$on("click",r[31]),C=new Wp({props:{$$slots:{default:[n5]},$$scope:{ctx:r}}}),B=new bi({props:{$$slots:{default:[r5]},$$scope:{ctx:r}}}),B.$on("click",r[32]),j=new bi({props:{$$slots:{default:[o5]},$$scope:{ctx:r}}}),j.$on("click",r[33]),J=new bi({props:{$$slots:{default:[s5]},$$scope:{ctx:r}}}),J.$on("click",r[34]),Ue=new bi({props:{$$slots:{default:[a5]},$$scope:{ctx:r}}}),Ue.$on("click",r[35]),st=new bi({props:{$$slots:{default:[l5]},$$scope:{ctx:r}}}),st.$on("click",r[36]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),S=je(`Editing
          `),Ce(C.$$.fragment),L=Le(),P=re("nav"),R=re("ul"),D=re("li"),Ce(B.$$.fragment),N=Le(),$=re("li"),Ce(j.$$.fragment),le=Le(),ce=re("li"),Ce(J.$$.fragment),te=Le(),ye=re("li"),Ce(Ue.$$.fragment),oe=Le(),ve=re("li"),Ce(st.$$.fragment),ke(t,"aria-label","breadcrumb"),ke(e,"slot","top"),Ri(e,"display","flex"),Ri(e,"justify-content","space-between")},m(Qe,wt){ae(Qe,e,wt),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),Z(x,S),Se(C,x,null),Z(e,L),Z(e,P),Z(P,R),Z(R,D),Se(B,D,null),Z(R,N),Z(R,$),Se(j,$,null),Z(R,le),Z(R,ce),Se(J,ce,null),Z(R,te),Z(R,ye),Se(Ue,ye,null),Z(R,oe),Z(R,ve),Se(st,ve,null),ze=!0},p(Qe,wt){const pt={};wt[1]&512&&(pt.$$scope={dirty:wt,ctx:Qe}),u.$set(pt);const nt={};wt[1]&512&&(nt.$$scope={dirty:wt,ctx:Qe}),_.$set(nt);const Ht={};wt[1]&512&&(Ht.$$scope={dirty:wt,ctx:Qe}),C.$set(Ht);const oi={};wt[1]&512&&(oi.$$scope={dirty:wt,ctx:Qe}),B.$set(oi);const Dt={};wt[1]&512&&(Dt.$$scope={dirty:wt,ctx:Qe}),j.$set(Dt);const mt={};wt[1]&512&&(mt.$$scope={dirty:wt,ctx:Qe}),J.$set(mt);const ti={};wt[1]&512&&(ti.$$scope={dirty:wt,ctx:Qe}),Ue.$set(ti);const Pt={};wt[1]&512&&(Pt.$$scope={dirty:wt,ctx:Qe}),st.$set(Pt)},i(Qe){ze||(K(u.$$.fragment,Qe),K(_.$$.fragment,Qe),K(C.$$.fragment,Qe),K(B.$$.fragment,Qe),K(j.$$.fragment,Qe),K(J.$$.fragment,Qe),K(Ue.$$.fragment,Qe),K(st.$$.fragment,Qe),ze=!0)},o(Qe){ie(u.$$.fragment,Qe),ie(_.$$.fragment,Qe),ie(C.$$.fragment,Qe),ie(B.$$.fragment,Qe),ie(j.$$.fragment,Qe),ie(J.$$.fragment,Qe),ie(Ue.$$.fragment,Qe),ie(st.$$.fragment,Qe),ze=!1},d(Qe){Qe&&se(e),Te(u),Te(_),Te(C),Te(B),Te(j),Te(J),Te(Ue),Te(st)}}}function my(r){let e;return{c(){e=re("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function gy(r){let e,t;return e=new Pb({props:{colorScale:e1,limits:t1}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function u5(r){let e,t,i;return{c(){e=je("Undo ("),t=je(r[4]),i=je(")")},m(l,u){ae(l,e,u),ae(l,t,u),ae(l,i,u)},p(l,u){u[0]&16&&ai(t,l[4])},d(l){l&&(se(e),se(t),se(i))}}}function h5(r){let e;return{c(){e=je("Undo")},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function d5(r){let e,t,i;return{c(){e=je("Redo ("),t=je(r[5]),i=je(")")},m(l,u){ae(l,e,u),ae(l,t,u),ae(l,i,u)},p(l,u){u[0]&32&&ai(t,l[5])},d(l){l&&(se(e),se(t),se(i))}}}function f5(r){let e;return{c(){e=je("Redo")},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function _y(r){let e,t;return e=new K3({}),e.$on("close",r[29]),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function p5(r){let e,t,i,l,u=sr(r[6]).properties.name+"",d,a,_=r[1].area_km2.toFixed(1)+"",y,x,S,C,L,P,R,D,B,N,$,j,le,ce,J,te,ye,Ue,oe,ve,st,ze,Qe,wt,pt,nt,Ht,oi,Dt,mt,ti,Pt,Rt,ct,Jt,Yt,Ei,Fi,ht,Ot,Fe,Ne,dt,bt,we,Ii,qe,Je,Vt,Pi=r[8]>0&&my(),wi=r[12]=="speeds"&&gy();function gn(ii,Ni){return ii[4]==0?h5:u5}let In=gn(r),tn=In(r);function io(ii,Ni){return ii[5]==0?f5:d5}let Oi=io(r),rt=Oi(r),Li=r[3]&&_y(r);return{c(){e=re("div"),t=re("p"),i=je("Editing neighbourhood "),l=re("u"),d=je(u),a=je(`
      , with an area of `),y=je(_),x=je(" km²"),S=Le(),Pi&&Pi.c(),C=Le(),L=re("div"),P=re("button"),R=re("img"),B=je(`
        Add a modal filter`),$=Le(),j=re("button"),le=je("Add many modal filters along line"),J=Le(),te=re("button"),ye=je("Reverse directions"),oe=Le(),ve=re("button"),ve.textContent="Change modal filter type",st=Le(),ze=re("label"),Qe=re("input"),wt=je(`
      Animate shortcuts`),pt=Le(),nt=re("label"),Ht=re("input"),oi=je(`
      Include perimeter roads`),Dt=Le(),mt=re("div"),ti=re("label"),Pt=je(`Draw roads:
        `),Rt=re("select"),ct=re("option"),ct.textContent="Worst shortcuts",Jt=re("option"),Jt.textContent="Cell",Yt=re("option"),Yt.textContent="Edits (either filter or direction)",Ei=re("option"),Ei.textContent="Speed limit",Fi=Le(),wi&&wi.c(),ht=Le(),Ot=re("div"),Fe=re("button"),tn.c(),dt=Le(),bt=re("button"),rt.c(),Ii=Le(),Li&&Li.c(),Dn(R.src,D=`/ltn//filters/${r[9]}_icon.gif`)||ke(R,"src",D),ke(R,"width","30"),ke(R,"alt","Add a modal filter"),P.disabled=N=r[0]=="filter",ke(P,"data-tooltip","hotkey 1"),j.disabled=ce=r[0]=="freehand-filters",ke(j,"data-tooltip","hotkey 2"),te.disabled=Ue=r[0]=="oneway",ke(te,"data-tooltip","hotkey 3"),Ri(L,"display","flex"),Ri(L,"justify-content","space-between"),ke(Qe,"type","checkbox"),ke(Ht,"type","checkbox"),ct.__value="shortcuts",zn(ct,ct.__value),Jt.__value="cells",zn(Jt,Jt.__value),Yt.__value="edits",zn(Yt,Yt.__value),Ei.__value="speeds",zn(Ei,Ei.__value),r[12]===void 0&&rc(()=>r[28].call(Rt)),Ri(mt,"border","1px solid black"),Ri(mt,"padding","4px"),Fe.disabled=Ne=r[4]==0,ke(Fe,"data-tooltip","Ctrl+Z"),bt.disabled=we=r[5]==0,ke(bt,"data-tooltip","Ctrl+Y"),Ri(Ot,"display","flex"),Ri(Ot,"justify-content","space-between"),ke(e,"slot","sidebar")},m(ii,Ni){ae(ii,e,Ni),Z(e,t),Z(t,i),Z(t,l),Z(l,d),Z(t,a),Z(t,y),Z(t,x),Z(e,S),Pi&&Pi.m(e,null),Z(e,C),Z(e,L),Z(L,P),Z(P,R),Z(P,B),Z(L,$),Z(L,j),Z(j,le),Z(L,J),Z(L,te),Z(te,ye),Z(e,oe),Z(e,ve),Z(e,st),Z(e,ze),Z(ze,Qe),Qe.checked=r[11],Z(ze,wt),Z(e,pt),Z(e,nt),Z(nt,Ht),Ht.checked=r[10],Z(nt,oi),Z(e,Dt),Z(e,mt),Z(mt,ti),Z(ti,Pt),Z(ti,Rt),Z(Rt,ct),Z(Rt,Jt),Z(Rt,Yt),Z(Rt,Ei),nc(Rt,r[12],!0),Z(mt,Fi),wi&&wi.m(mt,null),Z(e,ht),Z(e,Ot),Z(Ot,Fe),tn.m(Fe,null),Z(Ot,dt),Z(Ot,bt),rt.m(bt,null),Z(e,Ii),Li&&Li.m(e,null),qe=!0,Je||(Vt=[Mt(P,"click",r[22]),Mt(j,"click",r[23]),Mt(te,"click",r[24]),Mt(ve,"click",r[25]),Mt(Qe,"change",r[26]),Mt(Ht,"change",r[27]),Mt(Ht,"change",r[14]),Mt(Rt,"change",r[28]),Mt(Fe,"click",r[18]),Mt(bt,"click",r[19])],Je=!0)},p(ii,Ni){(!qe||Ni[0]&64)&&u!==(u=sr(ii[6]).properties.name+"")&&ai(d,u),(!qe||Ni[0]&2)&&_!==(_=ii[1].area_km2.toFixed(1)+"")&&ai(y,_),ii[8]>0?Pi||(Pi=my(),Pi.c(),Pi.m(e,C)):Pi&&(Pi.d(1),Pi=null),(!qe||Ni[0]&512&&!Dn(R.src,D=`/ltn//filters/${ii[9]}_icon.gif`))&&ke(R,"src",D),(!qe||Ni[0]&1&&N!==(N=ii[0]=="filter"))&&(P.disabled=N),(!qe||Ni[0]&1&&ce!==(ce=ii[0]=="freehand-filters"))&&(j.disabled=ce),(!qe||Ni[0]&1&&Ue!==(Ue=ii[0]=="oneway"))&&(te.disabled=Ue),Ni[0]&2048&&(Qe.checked=ii[11]),Ni[0]&1024&&(Ht.checked=ii[10]),Ni[0]&4096&&nc(Rt,ii[12]),ii[12]=="speeds"?wi?Ni[0]&4096&&K(wi,1):(wi=gy(),wi.c(),K(wi,1),wi.m(mt,null)):wi&&(gi(),ie(wi,1,1,()=>{wi=null}),_i()),In===(In=gn(ii))&&tn?tn.p(ii,Ni):(tn.d(1),tn=In(ii),tn&&(tn.c(),tn.m(Fe,null))),(!qe||Ni[0]&16&&Ne!==(Ne=ii[4]==0))&&(Fe.disabled=Ne),Oi===(Oi=io(ii))&&rt?rt.p(ii,Ni):(rt.d(1),rt=Oi(ii),rt&&(rt.c(),rt.m(bt,null))),(!qe||Ni[0]&32&&we!==(we=ii[5]==0))&&(bt.disabled=we),ii[3]?Li?(Li.p(ii,Ni),Ni[0]&8&&K(Li,1)):(Li=_y(ii),Li.c(),K(Li,1),Li.m(e,null)):Li&&(gi(),ie(Li,1,1,()=>{Li=null}),_i())},i(ii){qe||(K(wi),K(Li),qe=!0)},o(ii){ie(wi),ie(Li),qe=!1},d(ii){ii&&se(e),Pi&&Pi.d(),wi&&wi.d(),tn.d(),rt.d(),Li&&Li.d(),Je=!1,mn(Vt)}}}function m5(r){let e;return{c(){e=re("p"),e.textContent="Click to change direction"},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function g5(r){let e,t,i,l;return{c(){e=re("div"),t=re("img"),l=je(`
                Click to add modal filter`),Dn(t.src,i=`/ltn//filters/${r[9]}_icon.gif`)||ke(t,"src",i),ke(t,"width","20"),ke(t,"alt","Add modal filter")},m(u,d){ae(u,e,d),Z(e,t),Z(e,l)},p(u,d){d[0]&512&&!Dn(t.src,i=`/ltn//filters/${u[9]}_icon.gif`)&&ke(t,"src",i)},d(u){u&&se(e)}}}function _5(r){let e,t=r[39].shortcuts+"",i,l,u=(r[39].name??"unnamed road")+"",d,a,_=Math.round(r[39].speed_mph)+"",y,x,S,C;function L(D,B){return D[0]=="filter"?g5:m5}let P=L(r),R=P(r);return{c(){e=re("p"),i=je(t),l=je(" shortcuts through "),d=je(u),a=je(`
              (`),y=je(_),x=je(" mph)"),S=Le(),R.c(),C=En()},m(D,B){ae(D,e,B),Z(e,i),Z(e,l),Z(e,d),Z(e,a),Z(e,y),Z(e,x),ae(D,S,B),R.m(D,B),ae(D,C,B)},p(D,B){B[1]&256&&t!==(t=D[39].shortcuts+"")&&ai(i,t),B[1]&256&&u!==(u=(D[39].name??"unnamed road")+"")&&ai(d,u),B[1]&256&&_!==(_=Math.round(D[39].speed_mph)+"")&&ai(y,_),P===(P=L(D))&&R?R.p(D,B):(R.d(1),R=P(D),R&&(R.c(),R.m(C.parentNode,C)))},d(D){D&&(se(e),se(S),se(C)),R.d(D)}}}function y5(r){let e,t,i;return t=new os({props:{openOn:"hover",$$slots:{default:[_5,({props:l})=>({39:l}),({props:l})=>[0,l?256:0]]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p(l,u){const d={};u[0]&513|u[1]&768&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function v5(r){let e,t,i,l,u,d,a,_;return e=new Fd({}),i=new Bd({}),u=new Od({}),a=new Hu({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[y5]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),Ce(a.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),ae(y,l,x),Se(u,y,x),ae(y,d,x),Se(a,y,x),_=!0},p(y,x){const S={};x[0]&1&&(S.interactive=y[0]=="filter"||y[0]=="oneway"),x[0]&513|x[1]&512&&(S.$$scope={dirty:x,ctx:y}),a.$set(S)},i(y){_||(K(e.$$.fragment,y),K(i.$$.fragment,y),K(u.$$.fragment,y),K(a.$$.fragment,y),_=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),ie(u.$$.fragment,y),ie(a.$$.fragment,y),_=!1},d(y){y&&(se(t),se(l),se(d)),Te(e,y),Te(i,y),Te(u,y),Te(a,y)}}}function yy(r){let e,t;return e=new G3({props:{paths:r[7]}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l[0]&128&&(u.paths=i[7]),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function b5(r){let e;return{c(){e=je("Click to delete")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function w5(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[b5]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l[1]&512&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function vy(r){let e,t;return e=new e5({props:{map:sr(r[2])}}),e.$on("done",r[20]),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l[0]&4&&(u.map=sr(i[2])),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function x5(r){let e,t,i,l,u,d,a;t=new Xu({props:{input:r[1],$$slots:{default:[v5]},$$scope:{ctx:r}}});let _=r[11]&&yy(r);u=new Za({props:{$$slots:{default:[w5]},$$scope:{ctx:r}}}),u.$on("click",r[16]);let y=r[0]=="freehand-filters"&&vy(r);return{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),_&&_.c(),l=Le(),Ce(u.$$.fragment),d=Le(),y&&y.c(),ke(e,"slot","map")},m(x,S){ae(x,e,S),Se(t,e,null),Z(e,i),_&&_.m(e,null),Z(e,l),Se(u,e,null),Z(e,d),y&&y.m(e,null),a=!0},p(x,S){const C={};S[0]&2&&(C.input=x[1]),S[0]&513|S[1]&512&&(C.$$scope={dirty:S,ctx:x}),t.$set(C),x[11]?_?(_.p(x,S),S[0]&2048&&K(_,1)):(_=yy(x),_.c(),K(_,1),_.m(e,l)):_&&(gi(),ie(_,1,1,()=>{_=null}),_i());const L={};S[1]&512&&(L.$$scope={dirty:S,ctx:x}),u.$set(L),x[0]=="freehand-filters"?y?(y.p(x,S),S[0]&1&&K(y,1)):(y=vy(x),y.c(),K(y,1),y.m(e,null)):y&&(gi(),ie(y,1,1,()=>{y=null}),_i())},i(x){a||(K(t.$$.fragment,x),K(_),K(u.$$.fragment,x),K(y),a=!0)},o(x){ie(t.$$.fragment,x),ie(_),ie(u.$$.fragment,x),ie(y),a=!1},d(x){x&&se(e),Te(t),_&&_.d(),Te(u),y&&y.d()}}}function k5(r){let e,t,i,l;return e=new go({props:{$$slots:{map:[x5],sidebar:[p5],top:[c5]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0,i||(l=Mt(window,"keydown",r[17]),i=!0)},p(u,d){const a={};d[0]&16383|d[1]&512&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u),i=!1,l()}}}function S5(r,e,t){let i,l,u,d,a,_,y,x,S;lt(r,ws,ct=>t(21,l=ct)),lt(r,up,ct=>t(9,u=ct)),lt(r,Cn,ct=>t(37,d=ct)),lt(r,Fu,ct=>t(10,a=ct)),lt(r,is,ct=>t(2,_=ct)),lt(r,Ng,ct=>t(11,y=ct)),lt(r,kd,ct=>t(12,x=ct)),lt(r,Wt,ct=>t(13,S=ct));let C="filter",L=!1,P=0,R=0,D,B,N=d.getAllShortcuts();or(()=>{_.doubleClickZoom.enable()});function $(ct){t(1,B=d.renderNeighbourhood()),t(6,D=B.features.find(Jt=>Jt.properties.kind=="boundary")),t(4,P=B.undo_length),t(5,R=B.redo_length),t(7,N=d.getAllShortcuts()),sc()}function j(){d.setCurrentNeighbourhood(D.properties.name,a),St(ws,l++,l)}function le(ct,Jt){C=="filter"?(d.addModalFilter(Jt,u),St(ws,l++,l)):C=="oneway"&&(d.toggleDirection(ct.properties.road),St(ws,l++,l))}function ce(ct){let Jt=ct.detail.features[0];d.deleteModalFilter(Jt.properties.road),St(ws,l++,l)}function J(ct){ct.target.tagName!="INPUT"&&(ct.ctrlKey&&ct.key=="z"&&te(),ct.ctrlKey&&ct.key=="y"&&ye(),ct.key=="1"&&t(0,C="filter"),ct.key=="2"&&t(0,C="freehand-filters"),ct.key=="3"&&t(0,C="oneway"))}function te(){d.undo(),St(ws,l++,l)}function ye(){d.redo(),St(ws,l++,l)}function Ue(ct){let Jt=ct.detail;Jt&&(d.addManyModalFilters(Jt,u),St(ws,l++,l)),t(0,C="filter")}const oe=()=>t(0,C="filter"),ve=()=>t(0,C="freehand-filters"),st=()=>t(0,C="oneway"),ze=()=>t(3,L=!0);function Qe(){y=this.checked,Ng.set(y)}function wt(){a=this.checked,Fu.set(a)}function pt(){x=Lp(this),kd.set(x)}const nt=()=>t(3,L=!1),Ht=()=>St(Wt,S={mode:"title",firstLoad:!1},S),oi=()=>St(Wt,S={mode:"pick-neighbourhood"},S),Dt=()=>St(Wt,S={mode:"view-shortcuts"},S),mt=()=>St(Wt,S={mode:"route",prevMode:"neighbourhood"},S),ti=()=>St(Wt,S={mode:"impact-one-destination"},S),Pt=()=>St(Wt,S={mode:"set-boundary",name:sr(D).properties.name,existing:D},S),Rt=()=>St(Wt,S={mode:"debug"},S);return r.$$.update=()=>{r.$$.dirty[0]&5&&(C=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),r.$$.dirty[0]&2097152&&$(),r.$$.dirty[0]&2&&t(8,i=B.features.filter(ct=>ct.properties.kind=="cell"&&ct.properties.cell_color=="disconnected").length)},[C,B,_,L,P,R,D,N,i,u,a,y,x,S,j,le,ce,J,te,ye,Ue,l,oe,ve,st,ze,Qe,wt,pt,nt,Ht,oi,Dt,mt,ti,Pt,Rt]}class T5 extends Ut{constructor(e){super(),jt(this,e,S5,k5,Ft,{},null,[-1,-1])}}function C5(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function M5(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function E5(r){let e,t,i,l,u,d,a,_,y,x,S;return u=new bi({props:{$$slots:{default:[C5]},$$scope:{ctx:r}}}),u.$on("click",r[7]),_=new bi({props:{$$slots:{default:[M5]},$$scope:{ctx:r}}}),_.$on("click",r[8]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),x.textContent="Predict impact",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(C,L){ae(C,e,L),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),S=!0},p(C,L){const P={};L&1024&&(P.$$scope={dirty:L,ctx:C}),u.$set(P);const R={};L&1024&&(R.$$scope={dirty:L,ctx:C}),_.$set(R)},i(C){S||(K(u.$$.fragment,C),K(_.$$.fragment,C),S=!0)},o(C){ie(u.$$.fragment,C),ie(_.$$.fragment,C),S=!1},d(C){C&&se(e),Te(u),Te(_)}}}function I5(r){let e;return{c(){e=je("Pick a different road")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function L5(r){let e,t,i,l,u,d,a,_;t=new bi({props:{$$slots:{default:[I5]},$$scope:{ctx:r}}}),t.$on("click",r[5]);function y(S){r[6](S)}let x={list:r[2]};return r[0]!==void 0&&(x.idx=r[0]),l=new Hp({props:x}),Xi.push(()=>pr(l,"idx",y)),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),d=Le(),a=re("p"),a.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,ke(e,"slot","sidebar")},m(S,C){ae(S,e,C),Se(t,e,null),Z(e,i),Se(l,e,null),Z(e,d),Z(e,a),_=!0},p(S,C){const L={};C&1024&&(L.$$scope={dirty:C,ctx:S}),t.$set(L);const P={};!u&&C&1&&(u=!0,P.idx=S[0],fr(()=>u=!1)),l.$set(P)},i(S){_||(K(t.$$.fragment,S),K(l.$$.fragment,S),_=!0)},o(S){ie(t.$$.fragment,S),ie(l.$$.fragment,S),_=!1},d(S){S&&se(e),Te(t),Te(l)}}}function A5(r){let e,t;const i=[nn("predict-impact"),{paint:{"line-width":Lu(["get","kind"],{focus:8},5),"line-color":Lu(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Lu(["get","kind"],{focus:1},.5)}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function P5(r){let e;return{c(){e=je("A")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function z5(r){let e;return{c(){e=je("B")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function D5(r){let e,t,i,l,u,d,a,_,y;return t=new tr({props:{data:r[3](r[0]),$$slots:{default:[A5]},$$scope:{ctx:r}}}),l=new Va({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[P5]},$$scope:{ctx:r}}}),d=new Va({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[z5]},$$scope:{ctx:r}}}),_=new Za({}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),u=Le(),Ce(d.$$.fragment),a=Le(),Ce(_.$$.fragment),ke(e,"slot","map")},m(x,S){ae(x,e,S),Se(t,e,null),Z(e,i),Se(l,e,null),Z(e,u),Se(d,e,null),Z(e,a),Se(_,e,null),y=!0},p(x,S){const C={};S&1&&(C.data=x[3](x[0])),S&1024&&(C.$$scope={dirty:S,ctx:x}),t.$set(C);const L={};S&1&&(L.lngLat=x[2][x[0]][0].geometry.coordinates[0]),S&1024&&(L.$$scope={dirty:S,ctx:x}),l.$set(L);const P={};S&1&&(P.lngLat=x[2][x[0]][0].geometry.coordinates[x[2][x[0]][0].geometry.coordinates.length-1]),S&1024&&(P.$$scope={dirty:S,ctx:x}),d.$set(P)},i(x){y||(K(t.$$.fragment,x),K(l.$$.fragment,x),K(d.$$.fragment,x),K(_.$$.fragment,x),y=!0)},o(x){ie(t.$$.fragment,x),ie(l.$$.fragment,x),ie(d.$$.fragment,x),ie(_.$$.fragment,x),y=!1},d(x){x&&se(e),Te(t),Te(l),Te(d),Te(_)}}}function R5(r){let e,t;return e=new go({props:{$$slots:{map:[D5],sidebar:[L5],top:[E5]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1027&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function B5(r,e,t){let i,l;lt(r,Cn,L=>t(9,i=L)),lt(r,Wt,L=>t(1,l=L));let{road:u}=e;u.properties.kind="focus";let d=i.getImpactsOnRoad(u.properties.id),a=0;function _(L){return{type:"FeatureCollection",features:[d[L][0],d[L][1],u]}}const y=()=>St(Wt,l={mode:"predict-impact"},l);function x(L){a=L,t(0,a)}const S=()=>St(Wt,l={mode:"title",firstLoad:!1},l),C=()=>St(Wt,l={mode:"pick-neighbourhood"},l);return r.$$set=L=>{"road"in L&&t(4,u=L.road)},[a,l,d,_,u,y,x,S,C]}class F5 extends Ut{constructor(e){super(),jt(this,e,B5,R5,Ft,{road:4})}}function O5(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function N5(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function $5(r){let e;return{c(){e=je("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function j5(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P;return u=new bi({props:{$$slots:{default:[O5]},$$scope:{ctx:r}}}),u.$on("click",r[12]),_=new bi({props:{$$slots:{default:[N5]},$$scope:{ctx:r}}}),_.$on("click",r[13]),S=new bi({props:{$$slots:{default:[$5]},$$scope:{ctx:r}}}),S.$on("click",r[5]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),Ce(S.$$.fragment),C=Le(),L=re("li"),L.textContent="Impact routing to one destination",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(R,D){ae(R,e,D),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),Se(S,x,null),Z(i,C),Z(i,L),P=!0},p(R,D){const B={};D&262144&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const N={};D&262144&&(N.$$scope={dirty:D,ctx:R}),_.$set(N);const $={};D&262144&&($.$$scope={dirty:D,ctx:R}),S.$set($)},i(R){P||(K(u.$$.fragment,R),K(_.$$.fragment,R),K(S.$$.fragment,R),P=!0)},o(R){ie(u.$$.fragment,R),ie(_.$$.fragment,R),ie(S.$$.fragment,R),P=!1},d(R){R&&se(e),Te(u),Te(_),Te(S)}}}function U5(r){let e,t,i,l,u,d,a,_=r[3].highest_time_ratio.toFixed(1)+"",y,x;return t=new qa({}),t.$on("click",r[5]),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,u=Le(),d=re("p"),a=je("Highest ratio is "),y=je(_),ke(e,"slot","sidebar")},m(S,C){ae(S,e,C),Se(t,e,null),Z(e,i),Z(e,l),Z(e,u),Z(e,d),Z(d,a),Z(d,y),x=!0},p(S,C){(!x||C&8)&&_!==(_=S[3].highest_time_ratio.toFixed(1)+"")&&ai(y,_)},i(S){x||(K(t.$$.fragment,S),x=!0)},o(S){ie(t.$$.fragment,S),x=!1},d(S){S&&se(e),Te(t)}}}function V5(r){let e,t;const i=[nn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new ns({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function q5(r){let e,t=Qs(r[17].distance_before)+"",i,l,u=ea(r[17].time_before)+"",d,a,_,y,x=Qs(r[17].distance_after)+"",S,C,L=ea(r[17].time_after)+"",P,R,D,B,N,$=(r[17].time_after/r[17].time_before).toFixed(1)+"",j;return{c(){e=re("p"),i=je(t),l=je(", "),d=je(u),a=je(" before"),_=Le(),y=re("p"),S=je(x),C=je(", "),P=je(L),R=je(" after"),D=Le(),B=re("p"),N=je("Time ratio: "),j=je($)},m(le,ce){ae(le,e,ce),Z(e,i),Z(e,l),Z(e,d),Z(e,a),ae(le,_,ce),ae(le,y,ce),Z(y,S),Z(y,C),Z(y,P),Z(y,R),ae(le,D,ce),ae(le,B,ce),Z(B,N),Z(B,j)},p(le,ce){ce&131072&&t!==(t=Qs(le[17].distance_before)+"")&&ai(i,t),ce&131072&&u!==(u=ea(le[17].time_before)+"")&&ai(d,u),ce&131072&&x!==(x=Qs(le[17].distance_after)+"")&&ai(S,x),ce&131072&&L!==(L=ea(le[17].time_after)+"")&&ai(P,L),ce&131072&&$!==($=(le[17].time_after/le[17].time_before).toFixed(1)+"")&&ai(j,$)},d(le){le&&(se(e),se(_),se(y),se(D),se(B))}}}function Z5(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[q5,({props:i})=>({17:i}),({props:i})=>i?131072:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&393216&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function G5(r){let e,t,i;const l=[nn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function u(a){r[9](a)}let d={$$slots:{default:[Z5]},$$scope:{ctx:r}};for(let a=0;a<l.length;a+=1)d=en(d,l[a]);return r[0]!==void 0&&(d.hovered=r[0]),e=new Hr({props:d}),Xi.push(()=>pr(e,"hovered",u)),e.$on("click",r[10]),{c(){Ce(e.$$.fragment)},m(a,_){Se(e,a,_),i=!0},p(a,_){const y=_&8?Na(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[3].highest_time_ratio,1.1),"red"],"line-width":5}},l[2]]):{};_&262144&&(y.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,y.hovered=a[0],fr(()=>t=!1)),e.$set(y)},i(a){i||(K(e.$$.fragment,a),i=!0)},o(a){ie(e.$$.fragment,a),i=!1},d(a){Te(e,a)}}}function W5(r){let e,t;const i=[nn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Lu(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function H5(r){let e;return{c(){e=je("X")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function X5(r){let e,t,i,l,u,d,a,_,y,x,S,C;t=new Xu({props:{$$slots:{default:[V5]},$$scope:{ctx:r}}}),l=new tr({props:{data:r[3],generateId:!0,$$slots:{default:[G5]},$$scope:{ctx:r}}}),d=new tr({props:{data:r[2],$$slots:{default:[W5]},$$scope:{ctx:r}}}),_=new Za({});function L(R){r[11](R)}let P={draggable:!0,$$slots:{default:[H5]},$$scope:{ctx:r}};return r[1]!==void 0&&(P.lngLat=r[1]),x=new Va({props:P}),Xi.push(()=>pr(x,"lngLat",L)),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),u=Le(),Ce(d.$$.fragment),a=Le(),Ce(_.$$.fragment),y=Le(),Ce(x.$$.fragment),ke(e,"slot","map")},m(R,D){ae(R,e,D),Se(t,e,null),Z(e,i),Se(l,e,null),Z(e,u),Se(d,e,null),Z(e,a),Se(_,e,null),Z(e,y),Se(x,e,null),C=!0},p(R,D){const B={};D&262144&&(B.$$scope={dirty:D,ctx:R}),t.$set(B);const N={};D&8&&(N.data=R[3]),D&262153&&(N.$$scope={dirty:D,ctx:R}),l.$set(N);const $={};D&4&&($.data=R[2]),D&262144&&($.$$scope={dirty:D,ctx:R}),d.$set($);const j={};D&262144&&(j.$$scope={dirty:D,ctx:R}),!S&&D&2&&(S=!0,j.lngLat=R[1],fr(()=>S=!1)),x.$set(j)},i(R){C||(K(t.$$.fragment,R),K(l.$$.fragment,R),K(d.$$.fragment,R),K(_.$$.fragment,R),K(x.$$.fragment,R),C=!0)},o(R){ie(t.$$.fragment,R),ie(l.$$.fragment,R),ie(d.$$.fragment,R),ie(_.$$.fragment,R),ie(x.$$.fragment,R),C=!1},d(R){R&&se(e),Te(t),Te(l),Te(d),Te(_),Te(x)}}}function K5(r){let e,t,i,l;return e=new L0({}),e.$on("contextmenu",r[7]),i=new go({props:{$$slots:{map:[X5],sidebar:[U5],top:[j5]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment)},m(u,d){Se(e,u,d),ae(u,t,d),Se(i,u,d),l=!0},p(u,[d]){const a={};d&262175&&(a.$$scope={dirty:d,ctx:u}),i.$set(a)},i(u){l||(K(e.$$.fragment,u),K(i.$$.fragment,u),l=!0)},o(u){ie(e.$$.fragment,u),ie(i.$$.fragment,u),l=!1},d(u){u&&se(t),Te(e,u),Te(i,u)}}}function J5(r,e,t){let i,l,u,d,a,_,y;lt(r,cd,j=>t(1,u=j)),lt(r,Wt,j=>t(4,d=j)),lt(r,Bu,j=>t(14,a=j)),lt(r,Ru,j=>t(15,_=j)),lt(r,Cn,j=>t(8,y=j));function x(){St(Wt,d={mode:"neighbourhood"},d)}let S=null;function C(j){return j?y.compareRoute(new Cs.LngLat(j.properties.pt1_x,j.properties.pt1_y),u,1):ia()}function L(j){St(Ru,_=new Cs.LngLat(j.properties.pt1_x,j.properties.pt1_y),_),St(Bu,a=u,a),St(Wt,d={mode:"route",prevMode:"impact-one-destination"},d)}function P(j){St(cd,u=j.detail.lngLat,u)}function R(j){S=j,t(0,S)}const D=j=>L(j.detail.features[0]);function B(j){u=j,cd.set(u)}const N=()=>St(Wt,d={mode:"title",firstLoad:!1},d),$=()=>St(Wt,d={mode:"pick-neighbourhood"},d);return r.$$.update=()=>{r.$$.dirty&258&&t(3,i=y.impactToOneDestination(u)),r.$$.dirty&1&&t(2,l=C(S))},[S,u,l,i,d,x,L,P,y,R,D,B,N,$]}class Y5 extends Ut{constructor(e){super(),jt(this,e,J5,K5,Ft,{})}}const r1="/ltn/assets/delete-ec75e756.svg",o1="/ltn/assets/edit-f3f51206.svg";function by(r,e,t){const i=r.slice();return i[23]=e[t],i}function Q5(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function eT(r){let e;return{c(){e=re("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function tT(r){let e;return{c(){e=je("Route")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function iT(r){let e;return{c(){e=je("Predict impact")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function nT(r){let e;return{c(){e=je("Debug intersections")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function rT(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B,N,$,j,le;return u=new bi({props:{$$slots:{default:[Q5]},$$scope:{ctx:r}}}),u.$on("click",r[17]),y=new Wp({props:{$$slots:{default:[eT]},$$scope:{ctx:r}}}),P=new bi({props:{$$slots:{default:[tT]},$$scope:{ctx:r}}}),P.$on("click",r[18]),B=new bi({props:{$$slots:{default:[iT]},$$scope:{ctx:r}}}),B.$on("click",r[19]),j=new bi({props:{$$slots:{default:[nT]},$$scope:{ctx:r}}}),j.$on("click",r[20]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),_=je(`Pick neighbourhood
          `),Ce(y.$$.fragment),x=Le(),S=re("nav"),C=re("ul"),L=re("li"),Ce(P.$$.fragment),R=Le(),D=re("li"),Ce(B.$$.fragment),N=Le(),$=re("li"),Ce(j.$$.fragment),ke(t,"aria-label","breadcrumb"),ke(e,"slot","top"),Ri(e,"display","flex"),Ri(e,"justify-content","space-between")},m(ce,J){ae(ce,e,J),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Z(a,_),Se(y,a,null),Z(e,x),Z(e,S),Z(S,C),Z(C,L),Se(P,L,null),Z(C,R),Z(C,D),Se(B,D,null),Z(C,N),Z(C,$),Se(j,$,null),le=!0},p(ce,J){const te={};J&67108864&&(te.$$scope={dirty:J,ctx:ce}),u.$set(te);const ye={};J&67108864&&(ye.$$scope={dirty:J,ctx:ce}),y.$set(ye);const Ue={};J&67108864&&(Ue.$$scope={dirty:J,ctx:ce}),P.$set(Ue);const oe={};J&67108864&&(oe.$$scope={dirty:J,ctx:ce}),B.$set(oe);const ve={};J&67108864&&(ve.$$scope={dirty:J,ctx:ce}),j.$set(ve)},i(ce){le||(K(u.$$.fragment,ce),K(y.$$.fragment,ce),K(P.$$.fragment,ce),K(B.$$.fragment,ce),K(j.$$.fragment,ce),le=!0)},o(ce){ie(u.$$.fragment,ce),ie(y.$$.fragment,ce),ie(P.$$.fragment,ce),ie(B.$$.fragment,ce),ie(j.$$.fragment,ce),le=!1},d(ce){ce&&se(e),Te(u),Te(y),Te(P),Te(B),Te(j)}}}function oT(r){let e;return{c(){e=je("Draw a new boundary")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function sT(r){let e;return{c(){e=je("Use an auto-generated boundary")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function aT(r){let e=r[23]+"",t;return{c(){t=je(e)},m(i,l){ae(i,t,l)},p(i,l){l&4&&e!==(e=i[23]+"")&&ai(t,e)},d(i){i&&se(t)}}}function wy(r){let e,t,i,l,u,d,a,_,y,x,S;function C(){return r[14](r[23])}i=new bi({props:{$$slots:{default:[aT]},$$scope:{ctx:r}}}),i.$on("click",C);function L(){return r[15](r[23])}function P(){return r[16](r[23])}return{c(){e=re("li"),t=re("span"),Ce(i.$$.fragment),l=Le(),u=re("button"),u.innerHTML=`<img src="${o1}" alt="Rename neighbourhood"/>`,d=Le(),a=re("button"),a.innerHTML=`<img src="${r1}" alt="Delete neighbourhood"/>`,_=Le(),ke(u,"class","secondary"),ke(a,"class","secondary"),Ri(t,"display","flex"),Ri(t,"justify-content","space-between")},m(R,D){ae(R,e,D),Z(e,t),Se(i,t,null),Z(t,l),Z(t,u),Z(t,d),Z(t,a),Z(e,_),y=!0,x||(S=[Mt(u,"click",L),Mt(a,"click",P)],x=!0)},p(R,D){r=R;const B={};D&67108868&&(B.$$scope={dirty:D,ctx:r}),i.$set(B)},i(R){y||(K(i.$$.fragment,R),y=!0)},o(R){ie(i.$$.fragment,R),y=!1},d(R){R&&se(e),Te(i),x=!1,mn(S)}}}function lT(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B=r[1].modalFilters+"",N,$,j,le,ce=r[1].deletedModalFilters+"",J,te,ye,Ue,oe=r[1].directions+"",ve,st,ze,Qe,wt,pt,nt,Ht,oi;i=new bi({props:{$$slots:{default:[oT]},$$scope:{ctx:r}}}),i.$on("click",r[8]),d=new bi({props:{$$slots:{default:[sT]},$$scope:{ctx:r}}}),d.$on("click",r[13]);let Dt=Tn(r[2]),mt=[];for(let Pt=0;Pt<Dt.length;Pt+=1)mt[Pt]=wy(by(r,Dt,Pt));const ti=Pt=>ie(mt[Pt],1,1,()=>{mt[Pt]=null});return{c(){e=re("div"),t=re("div"),Ce(i.$$.fragment),l=Le(),u=re("div"),Ce(d.$$.fragment),a=Le(),_=re("ul");for(let Pt=0;Pt<mt.length;Pt+=1)mt[Pt].c();y=Le(),x=re("hr"),S=Le(),C=re("p"),L=je("Current project: "),P=je(r[3]),R=Le(),D=re("p"),N=je(B),$=je(" new modal filter(s) added"),j=Le(),le=re("p"),J=je(ce),te=je(`
      existing modal filter(s) removed`),ye=Le(),Ue=re("p"),ve=je(oe),st=je(" road segment direction(s) changed"),ze=Le(),Qe=re("button"),Qe.textContent="Export project to GeoJSON",wt=Le(),pt=re("button"),pt.textContent="Debug route-snapper",ke(pt,"class","secondary"),ke(e,"slot","sidebar")},m(Pt,Rt){ae(Pt,e,Rt),Z(e,t),Se(i,t,null),Z(e,l),Z(e,u),Se(d,u,null),Z(e,a),Z(e,_);for(let ct=0;ct<mt.length;ct+=1)mt[ct]&&mt[ct].m(_,null);Z(e,y),Z(e,x),Z(e,S),Z(e,C),Z(C,L),Z(C,P),Z(e,R),Z(e,D),Z(D,N),Z(D,$),Z(e,j),Z(e,le),Z(le,J),Z(le,te),Z(e,ye),Z(e,Ue),Z(Ue,ve),Z(Ue,st),Z(e,ze),Z(e,Qe),Z(e,wt),Z(e,pt),nt=!0,Ht||(oi=[Mt(Qe,"click",r[9]),Mt(pt,"click",r[10])],Ht=!0)},p(Pt,Rt){const ct={};Rt&67108864&&(ct.$$scope={dirty:Rt,ctx:Pt}),i.$set(ct);const Jt={};if(Rt&67108864&&(Jt.$$scope={dirty:Rt,ctx:Pt}),d.$set(Jt),Rt&228){Dt=Tn(Pt[2]);let Yt;for(Yt=0;Yt<Dt.length;Yt+=1){const Ei=by(Pt,Dt,Yt);mt[Yt]?(mt[Yt].p(Ei,Rt),K(mt[Yt],1)):(mt[Yt]=wy(Ei),mt[Yt].c(),K(mt[Yt],1),mt[Yt].m(_,null))}for(gi(),Yt=Dt.length;Yt<mt.length;Yt+=1)ti(Yt);_i()}(!nt||Rt&8)&&ai(P,Pt[3]),(!nt||Rt&2)&&B!==(B=Pt[1].modalFilters+"")&&ai(N,B),(!nt||Rt&2)&&ce!==(ce=Pt[1].deletedModalFilters+"")&&ai(J,ce),(!nt||Rt&2)&&oe!==(oe=Pt[1].directions+"")&&ai(ve,oe)},i(Pt){if(!nt){K(i.$$.fragment,Pt),K(d.$$.fragment,Pt);for(let Rt=0;Rt<Dt.length;Rt+=1)K(mt[Rt]);nt=!0}},o(Pt){ie(i.$$.fragment,Pt),ie(d.$$.fragment,Pt),mt=mt.filter(Boolean);for(let Rt=0;Rt<mt.length;Rt+=1)ie(mt[Rt]);nt=!1},d(Pt){Pt&&se(e),Te(i),Te(d),Vo(mt,Pt),Ht=!1,mn(oi)}}}function cT(r){let e,t=r[22].name+"",i;return{c(){e=re("p"),i=je(t)},m(l,u){ae(l,e,u),Z(e,i)},p(l,u){u&4194304&&t!==(t=l[22].name+"")&&ai(i,t)},d(l){l&&se(e)}}}function uT(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[cT,({props:i})=>({22:i}),({props:i})=>i?4194304:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&71303168&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function hT(r){let e,t;const i=[nn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":ja(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[uT]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new ns({props:l}),e.$on("click",r[12]),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};d&67108864&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function dT(r){let e,t,i,l,u;return t=new tr({props:{data:r[0],generateId:!0,$$slots:{default:[hT]},$$scope:{ctx:r}}}),l=new Za({}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Se(t,e,null),Z(e,i),Se(l,e,null),u=!0},p(d,a){const _={};a&1&&(_.data=d[0]),a&67108864&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(K(t.$$.fragment,d),K(l.$$.fragment,d),u=!0)},o(d){ie(t.$$.fragment,d),ie(l.$$.fragment,d),u=!1},d(d){d&&se(e),Te(t),Te(l)}}}function fT(r){let e,t;return e=new go({props:{$$slots:{map:[dT],sidebar:[lT],top:[rT]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&67108895&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function pT(r){let e=0,t=0,i=0;for(let l of r.features)l.properties.kind=="modal_filter"?e++:l.properties.kind=="deleted_existing_modal_filter"?t++:l.properties.kind=="direction"&&i++;return{modalFilters:e,deletedModalFilters:t,directions:i}}function mT(r,e,t){let i,l,u,d,a,_,y;lt(r,Cn,ye=>t(11,d=ye)),lt(r,Ms,ye=>t(3,a=ye)),lt(r,Wt,ye=>t(4,_=ye)),lt(r,Fu,ye=>t(21,y=ye));function x(ye){d.setCurrentNeighbourhood(ye,y),St(Wt,_={mode:"neighbourhood"},_)}function S(ye){window.confirm(`Really delete neighbourhood ${ye}? You can't undo this.`)&&(d.deleteNeighbourhoodBoundary(ye),sc(),t(0,i=d.toSavefile()))}function C(ye){let Ue=Sp(d,`Rename neighbourhood ${ye} to what?`,ye);Ue&&(d.renameNeighbourhoodBoundary(ye,Ue),sc(),t(0,i=d.toSavefile()))}function L(){let ye=Sp(d,"What do you want to name the neighbourhood?","");ye&&St(Wt,_={mode:"set-boundary",name:ye,existing:null},_)}function P(){yd(a+".geojson",JSON.stringify(d.toSavefile()))}function R(){yd("debug_route_snapper.geojson",d.toRouteSnapperGj())}const D=ye=>x(sr(ye.detail.features[0].properties).name),B=()=>St(Wt,_={mode:"auto-boundaries"},_),N=ye=>x(ye),$=ye=>C(ye),j=ye=>S(ye),le=()=>St(Wt,_={mode:"title",firstLoad:!1},_),ce=()=>St(Wt,_={mode:"route",prevMode:"pick-neighbourhood"},_),J=()=>St(Wt,_={mode:"predict-impact"},_),te=()=>St(Wt,_={mode:"debug-intersections"},_);return r.$$.update=()=>{r.$$.dirty&2048&&t(0,i=d.toSavefile()),r.$$.dirty&1&&t(2,l=i.features.filter(ye=>ye.properties.kind=="boundary").map(ye=>ye.properties.name)),r.$$.dirty&1&&t(1,u=pT(i))},[i,u,l,a,_,x,S,C,L,P,R,d,D,B,N,$,j,le,ce,J,te]}class gT extends Ut{constructor(e){super(),jt(this,e,mT,fT,Ft,{})}}function _T(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function yT(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function vT(r){let e,t,i,l,u,d,a,_,y,x,S;return u=new bi({props:{$$slots:{default:[_T]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new bi({props:{$$slots:{default:[yT]},$$scope:{ctx:r}}}),_.$on("click",r[7]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),x.textContent="Predict impact",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(C,L){ae(C,e,L),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),S=!0},p(C,L){const P={};L&1024&&(P.$$scope={dirty:L,ctx:C}),u.$set(P);const R={};L&1024&&(R.$$scope={dirty:L,ctx:C}),_.$set(R)},i(C){S||(K(u.$$.fragment,C),K(_.$$.fragment,C),S=!0)},o(C){ie(u.$$.fragment,C),ie(_.$$.fragment,C),S=!1},d(C){C&&se(e),Te(u),Te(_)}}}function bT(r){let e,t,i,l,u,d,a,_,y;return t=new qa({}),t.$on("click",r[5]),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("p"),l.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,u=Le(),d=re("p"),d.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,a=Le(),_=re("p"),_.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,ke(e,"slot","sidebar")},m(x,S){ae(x,e,S),Se(t,e,null),Z(e,i),Z(e,l),Z(e,u),Z(e,d),Z(e,a),Z(e,_),y=!0},p:Ct,i(x){y||(K(t.$$.fragment,x),y=!0)},o(x){ie(t.$$.fragment,x),y=!1},d(x){x&&se(e),Te(t)}}}function wT(r){let e,t=r[9].before.toLocaleString()+"",i,l,u=r[9].after.toLocaleString()+"",d,a,_,y,x=Math.round(100*r[9].after/r[9].before)+"",S,C;return{c(){e=re("p"),i=je(t),l=je(" before, "),d=je(u),a=je(`
            after`),_=Le(),y=re("p"),S=je(x),C=je("%")},m(L,P){ae(L,e,P),Z(e,i),Z(e,l),Z(e,d),Z(e,a),ae(L,_,P),ae(L,y,P),Z(y,S),Z(y,C)},p(L,P){P&512&&t!==(t=L[9].before.toLocaleString()+"")&&ai(i,t),P&512&&u!==(u=L[9].after.toLocaleString()+"")&&ai(d,u),P&512&&x!==(x=Math.round(100*L[9].after/L[9].before)+"")&&ai(S,x)},d(L){L&&(se(e),se(_),se(y))}}}function xT(r){let e,t;return e=new os({props:{openOn:"hover",$$slots:{default:[wT,({props:i})=>({9:i}),({props:i})=>i?512:0]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function kT(r){let e,t;const i=[nn("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,xy,r[2].max_count,ky],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[xT]},$$scope:{ctx:r}};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),e.$on("click",r[4]),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a=d&6?Na(i,[i[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,xy,u[2].max_count,ky],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,u[1][0],50,u[1][1],100,u[1][2],150,u[1][3],200,u[1][4]]]}},i[2],i[3]]):{};d&1024&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function ST(r){let e,t,i,l,u;return t=new tr({props:{data:r[2],generateId:!0,$$slots:{default:[kT]},$$scope:{ctx:r}}}),l=new Za({}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),ke(e,"slot","map")},m(d,a){ae(d,e,a),Se(t,e,null),Z(e,i),Se(l,e,null),u=!0},p(d,a){const _={};a&1024&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(K(t.$$.fragment,d),K(l.$$.fragment,d),u=!0)},o(d){ie(t.$$.fragment,d),ie(l.$$.fragment,d),u=!1},d(d){d&&se(e),Te(t),Te(l)}}}function TT(r){let e,t;return e=new go({props:{$$slots:{map:[ST],sidebar:[bT],top:[vT]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1025&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}let xy=3,ky=10;function CT(r,e,t){let i,l;lt(r,Wt,C=>t(0,i=C)),lt(r,Cn,C=>t(8,l=C));let u=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d=l.predictImpact();function a(C){St(Wt,i={mode:"impact-detail",road:C},i)}return[i,u,d,a,C=>a(C.detail.features[0]),()=>St(Wt,i={mode:"pick-neighbourhood"},i),()=>St(Wt,i={mode:"title",firstLoad:!1},i),()=>St(Wt,i={mode:"pick-neighbourhood"},i)]}class MT extends Ut{constructor(e){super(),jt(this,e,CT,TT,Ft,{})}}function ET(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function IT(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function Sy(r){let e,t,i;return t=new bi({props:{$$slots:{default:[LT]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=re("li"),Ce(t.$$.fragment)},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p(l,u){const d={};u&16384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function LT(r){let e;return{c(){e=je("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function AT(r){let e,t,i,l,u,d,a,_,y,x,S,C;u=new bi({props:{$$slots:{default:[ET]},$$scope:{ctx:r}}}),u.$on("click",r[11]),_=new bi({props:{$$slots:{default:[IT]},$$scope:{ctx:r}}}),_.$on("click",r[12]);let L=r[0]=="neighbourhood"&&Sy(r);return{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),L&&L.c(),x=Le(),S=re("li"),S.textContent="Routing",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(P,R){ae(P,e,R),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),L&&L.m(i,null),Z(i,x),Z(i,S),C=!0},p(P,R){const D={};R&16384&&(D.$$scope={dirty:R,ctx:P}),u.$set(D);const B={};R&16384&&(B.$$scope={dirty:R,ctx:P}),_.$set(B),P[0]=="neighbourhood"?L?(L.p(P,R),R&1&&K(L,1)):(L=Sy(P),L.c(),K(L,1),L.m(i,x)):L&&(gi(),ie(L,1,1,()=>{L=null}),_i())},i(P){C||(K(u.$$.fragment,P),K(_.$$.fragment,P),K(L),C=!0)},o(P){ie(u.$$.fragment,P),ie(_.$$.fragment,P),ie(L),C=!1},d(P){P&&se(e),Te(u),Te(_),L&&L.d()}}}function Ty(r){let e,t,i,l=Qs(r[4].features[0].properties.distance)+"",u,d,a=ea(r[4].features[0].properties.time)+"",_,y,x,S,C,L=Qs(r[4].features[1].properties.distance)+"",P,R,D=ea(r[4].features[1].properties.time)+"",B;return{c(){e=re("p"),t=re("span"),t.textContent="Route before",i=je(`
        : `),u=je(l),d=je(", "),_=je(a),y=Le(),x=re("p"),S=re("span"),S.textContent="Route after",C=je(`
        : `),P=je(L),R=je(", "),B=je(D),Ri(t,"color","red"),Ri(S,"color","blue")},m(N,$){ae(N,e,$),Z(e,t),Z(e,i),Z(e,u),Z(e,d),Z(e,_),ae(N,y,$),ae(N,x,$),Z(x,S),Z(x,C),Z(x,P),Z(x,R),Z(x,B)},p(N,$){$&16&&l!==(l=Qs(N[4].features[0].properties.distance)+"")&&ai(u,l),$&16&&a!==(a=ea(N[4].features[0].properties.time)+"")&&ai(_,a),$&16&&L!==(L=Qs(N[4].features[1].properties.distance)+"")&&ai(P,L),$&16&&D!==(D=ea(N[4].features[1].properties.time)+"")&&ai(B,D)},d(N){N&&(se(e),se(y),se(x))}}}function PT(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D;t=new qa({}),t.$on("click",r[6]);let B=r[4].features.length==2&&Ty(r);return{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("p"),l.textContent="Drag markers for a route",u=Le(),B&&B.c(),d=Le(),a=re("label"),_=je("Slow-down factor for main roads: "),y=je(r[1]),x=Le(),S=re("input"),C=Le(),L=re("i"),L.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,ke(S,"type","range"),ke(S,"min","1.0"),ke(S,"max","5.0"),ke(S,"step","0.1"),ke(e,"slot","sidebar")},m(N,$){ae(N,e,$),Se(t,e,null),Z(e,i),Z(e,l),Z(e,u),B&&B.m(e,null),Z(e,d),Z(e,a),Z(a,_),Z(a,y),Z(a,x),Z(a,S),zn(S,r[1]),Z(e,C),Z(e,L),P=!0,R||(D=[Mt(S,"change",r[10]),Mt(S,"input",r[10])],R=!0)},p(N,$){N[4].features.length==2?B?B.p(N,$):(B=Ty(N),B.c(),B.m(e,d)):B&&(B.d(1),B=null),(!P||$&2)&&ai(y,N[1]),$&2&&zn(S,N[1])},i(N){P||(K(t.$$.fragment,N),P=!0)},o(N){ie(t.$$.fragment,N),P=!1},d(N){N&&se(e),Te(t),B&&B.d(),R=!1,mn(D)}}}function Cy(r){let e,t;return e=new Xu({props:{$$slots:{default:[zT]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function zT(r){let e,t,i,l,u,d,a,_;return e=new Fd({}),i=new Bd({}),u=new Od({}),a=new Hu({props:{interactive:!1}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),Ce(a.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),ae(y,l,x),Se(u,y,x),ae(y,d,x),Se(a,y,x),_=!0},p:Ct,i(y){_||(K(e.$$.fragment,y),K(i.$$.fragment,y),K(u.$$.fragment,y),K(a.$$.fragment,y),_=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),ie(u.$$.fragment,y),ie(a.$$.fragment,y),_=!1},d(y){y&&(se(t),se(l),se(d)),Te(e,y),Te(i,y),Te(u,y),Te(a,y)}}}function DT(r){let e,t;const i=[nn("compare-route"),{paint:{"line-width":10,"line-color":Lu(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function RT(r){let e;return{c(){e=je("A")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function BT(r){let e;return{c(){e=je("B")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function FT(r){let e,t,i,l,u,d,a,_,y,x,S,C,L=r[0]=="neighbourhood"&&Cy(r);i=new Za({}),u=new tr({props:{data:r[4],$$slots:{default:[DT]},$$scope:{ctx:r}}});function P(N){r[8](N)}let R={draggable:!0,$$slots:{default:[RT]},$$scope:{ctx:r}};r[3]!==void 0&&(R.lngLat=r[3]),a=new Va({props:R}),Xi.push(()=>pr(a,"lngLat",P));function D(N){r[9](N)}let B={draggable:!0,$$slots:{default:[BT]},$$scope:{ctx:r}};return r[2]!==void 0&&(B.lngLat=r[2]),x=new Va({props:B}),Xi.push(()=>pr(x,"lngLat",D)),{c(){e=re("div"),L&&L.c(),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),Ce(a.$$.fragment),y=Le(),Ce(x.$$.fragment),ke(e,"slot","map")},m(N,$){ae(N,e,$),L&&L.m(e,null),Z(e,t),Se(i,e,null),Z(e,l),Se(u,e,null),Z(e,d),Se(a,e,null),Z(e,y),Se(x,e,null),C=!0},p(N,$){N[0]=="neighbourhood"?L?$&1&&K(L,1):(L=Cy(N),L.c(),K(L,1),L.m(e,t)):L&&(gi(),ie(L,1,1,()=>{L=null}),_i());const j={};$&16&&(j.data=N[4]),$&16384&&(j.$$scope={dirty:$,ctx:N}),u.$set(j);const le={};$&16384&&(le.$$scope={dirty:$,ctx:N}),!_&&$&8&&(_=!0,le.lngLat=N[3],fr(()=>_=!1)),a.$set(le);const ce={};$&16384&&(ce.$$scope={dirty:$,ctx:N}),!S&&$&4&&(S=!0,ce.lngLat=N[2],fr(()=>S=!1)),x.$set(ce)},i(N){C||(K(L),K(i.$$.fragment,N),K(u.$$.fragment,N),K(a.$$.fragment,N),K(x.$$.fragment,N),C=!0)},o(N){ie(L),ie(i.$$.fragment,N),ie(u.$$.fragment,N),ie(a.$$.fragment,N),ie(x.$$.fragment,N),C=!1},d(N){N&&se(e),L&&L.d(),Te(i),Te(u),Te(a),Te(x)}}}function OT(r){let e,t;return e=new go({props:{$$slots:{map:[FT],sidebar:[PT],top:[AT]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&16447&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function NT(r,e,t){let i,l,u,d,a,_;lt(r,Wt,B=>t(5,l=B)),lt(r,Og,B=>t(1,u=B)),lt(r,Bu,B=>t(2,d=B)),lt(r,Ru,B=>t(3,a=B)),lt(r,Cn,B=>t(7,_=B));let{prevMode:y}=e;function x(){St(Wt,l={mode:y},l)}function S(B){a=B,Ru.set(a)}function C(B){d=B,Bu.set(d)}function L(){u=Ip(this.value),Og.set(u)}const P=()=>St(Wt,l={mode:"title",firstLoad:!1},l),R=()=>St(Wt,l={mode:"pick-neighbourhood"},l),D=()=>St(Wt,l={mode:"neighbourhood"},l);return r.$$set=B=>{"prevMode"in B&&t(0,y=B.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&t(4,i=_.compareRoute(a,d,u))},[y,u,d,a,i,l,x,_,S,C,L,P,R,D]}class $T extends Ut{constructor(e){super(),jt(this,e,NT,OT,Ft,{prevMode:0})}}let ac=Si(null);const Co=Si([]);function s1(r){if(r.length<3)return JSON.parse(Dr(ac).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Dr(ac).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:jT}=Mp,UT=r=>({}),My=r=>({}),VT=r=>({}),Ey=r=>({});function Iy(r,e,t){const i=r.slice();return i[44]=e[t],i[45]=e,i[46]=t,i}function Ly(r,e,t){const i=r.slice();return i[47]=e[t],i[48]=e,i[49]=t,i}function qT(r){let e,t;const i=r[24]["extra-top"],l=Vi(i,r,r[38],My);return{c(){e=re("div"),l&&l.c(),ke(e,"slot","top")},m(u,d){ae(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&128)&&Zi(l,i,u,u[38],t?qi(i,u[38],d,UT):Gi(u[38]),My)},i(u){t||(K(l,u),t=!0)},o(u){ie(l,u),t=!1},d(u){u&&se(e),l&&l.d(u)}}}function ZT(r){let e,t,i,l,u;return{c(){e=re("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Le(),i=re("p"),i.textContent="Keyboard shortcuts:",l=Le(),u=re("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(d,a){ae(d,e,a),ae(d,t,a),ae(d,i,a),ae(d,l,a),ae(d,u,a)},p:Ct,d(d){d&&(se(e),se(t),se(i),se(l),se(u))}}}function GT(r){let e,t=r[8].length+"",i,l;return{c(){e=je("Undo ("),i=je(t),l=je(")")},m(u,d){ae(u,e,d),ae(u,i,d),ae(u,l,d)},p(u,d){d[0]&256&&t!==(t=u[8].length+"")&&ai(i,t)},d(u){u&&(se(e),se(i),se(l))}}}function WT(r){let e;return{c(){e=je("Undo")},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function HT(r){let e;return{c(){e=re("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function XT(r){let e,t,i,l,u,d,a,_,y,x,S,C,L;return S=i0(r[36][0]),{c(){e=re("fieldset"),t=re("label"),i=re("input"),l=je(`
          Snap to roads`),u=Le(),d=re("label"),a=re("input"),_=je(`
          Draw anywhere`),y=Le(),x=re("p"),x.textContent="Click to add at least 3 points",ke(i,"type","radio"),i.__value="snap",zn(i,i.__value),ke(a,"type","radio"),a.__value="free",zn(a,a.__value),S.p(i,a)},m(P,R){ae(P,e,R),Z(e,t),Z(t,i),i.checked=i.__value===r[7],Z(t,l),Z(e,u),Z(e,d),Z(d,a),a.checked=a.__value===r[7],Z(d,_),ae(P,y,R),ae(P,x,R),C||(L=[Mt(i,"change",r[35]),Mt(a,"change",r[37])],C=!0)},p(P,R){R[0]&128&&(i.checked=i.__value===P[7]),R[0]&128&&(a.checked=a.__value===P[7])},d(P){P&&(se(e),se(y),se(x)),S.r(),C=!1,mn(L)}}}function KT(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P,R,D,B;const N=r[24]["extra-sidebar"],$=Vi(N,r,r[38],Ey);x=new Wp({props:{$$slots:{default:[ZT]},$$scope:{ctx:r}}});function j(Ue,oe){return Ue[8].length==0?WT:GT}let le=j(r),ce=le(r);function J(Ue,oe){return Ue[5].length<3?XT:HT}let te=J(r),ye=te(r);return{c(){e=re("div"),$&&$.c(),t=Le(),i=re("div"),l=re("button"),u=je("Finish"),a=Le(),_=re("button"),_.textContent="Cancel",y=Le(),Ce(x.$$.fragment),S=Le(),C=re("button"),ce.c(),P=Le(),ye.c(),l.disabled=d=r[5].length<3,ke(_,"class","secondary"),Ri(i,"display","flex"),ke(C,"class","secondary"),C.disabled=L=r[8].length==0,ke(e,"slot","sidebar")},m(Ue,oe){ae(Ue,e,oe),$&&$.m(e,null),Z(e,t),Z(e,i),Z(i,l),Z(l,u),Z(i,a),Z(i,_),Z(i,y),Se(x,i,null),Z(e,S),Z(e,C),ce.m(C,null),Z(e,P),ye.m(e,null),R=!0,D||(B=[Mt(l,"click",function(){ic(r[0])&&r[0].apply(this,arguments)}),Mt(_,"click",function(){ic(r[1])&&r[1].apply(this,arguments)}),Mt(C,"click",r[11])],D=!0)},p(Ue,oe){r=Ue,$&&$.p&&(!R||oe[1]&128)&&Zi($,N,r,r[38],R?qi(N,r[38],oe,VT):Gi(r[38]),Ey),(!R||oe[0]&32&&d!==(d=r[5].length<3))&&(l.disabled=d);const ve={};oe[1]&128&&(ve.$$scope={dirty:oe,ctx:r}),x.$set(ve),le===(le=j(r))&&ce?ce.p(r,oe):(ce.d(1),ce=le(r),ce&&(ce.c(),ce.m(C,null))),(!R||oe[0]&256&&L!==(L=r[8].length==0))&&(C.disabled=L),te===(te=J(r))&&ye?ye.p(r,oe):(ye.d(1),ye=te(r),ye&&(ye.c(),ye.m(e,null)))},i(Ue){R||(K($,Ue),K(x.$$.fragment,Ue),R=!0)},o(Ue){ie($,Ue),ie(x.$$.fragment,Ue),R=!1},d(Ue){Ue&&se(e),$&&$.d(Ue),Te(x),ce.d(),ye.d(),D=!1,mn(B)}}}function JT(r){let e;return{c(){e=re("span"),ke(e,"class","dot svelte-1cj4rwq"),dr(e,"snapped-node",r[47].snapped),dr(e,"free-node",!r[47].snapped),dr(e,"hide",r[4])},m(t,i){ae(t,e,i)},p(t,i){i[0]&512&&dr(e,"snapped-node",t[47].snapped),i[0]&512&&dr(e,"free-node",!t[47].snapped),i[0]&16&&dr(e,"hide",t[4])},d(t){t&&se(e)}}}function Ay(r){let e,t,i;function l(y){r[25](y,r[47])}function u(){return r[26](r[47])}function d(){return r[27](r[47])}function a(){return r[28](r[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[JT]},$$scope:{ctx:r}};return r[47].point!==void 0&&(_.lngLat=r[47].point),e=new Dd({props:_}),Xi.push(()=>pr(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",r[19]),e.$on("click",a),{c(){Ce(e.$$.fragment)},m(y,x){Se(e,y,x),i=!0},p(y,x){r=y;const S={};x[0]&528|x[1]&128&&(S.$$scope={dirty:x,ctx:r}),!t&&x[0]&512&&(t=!0,S.lngLat=r[47].point,fr(()=>t=!1)),e.$set(S)},i(y){i||(K(e.$$.fragment,y),i=!0)},o(y){ie(e.$$.fragment,y),i=!1},d(y){Te(e,y)}}}function YT(r){let e;return{c(){e=re("span"),e.textContent=`${r[46]+1}`,ke(e,"class","dot svelte-1cj4rwq"),dr(e,"snapped",r[44].snapped)},m(t,i){ae(t,e,i)},p(t,i){i[0]&32&&dr(e,"snapped",t[44].snapped)},d(t){t&&se(e)}}}function Py(r){let e,t,i;function l(_){r[29](_,r[44])}function u(){return r[30](r[46])}function d(){return r[31](r[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[YT]},$$scope:{ctx:r}};return r[44].point!==void 0&&(a.lngLat=r[44].point),e=new Dd({props:a}),Xi.push(()=>pr(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){Ce(e.$$.fragment)},m(_,y){Se(e,_,y),i=!0},p(_,y){r=_;const x={};y[0]&32|y[1]&128&&(x.$$scope={dirty:y,ctx:r}),!t&&y[0]&32&&(t=!0,x.lngLat=r[44].point,fr(()=>t=!1)),e.$set(x)},i(_){i||(K(e.$$.fragment,_),i=!0)},o(_){ie(e.$$.fragment,_),i=!1},d(_){Te(e,_)}}}function QT(r){let e,t,i,l;const u=[nn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let d={};for(let y=0;y<u.length;y+=1)d=en(d,u[y]);e=new Hr({props:d});const a=[nn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let y=0;y<a.length;y+=1)_=en(_,a[y]);return i=new ns({props:_}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),l=!0},p(y,x){const S={};e.$set(S);const C={};i.$set(C)},i(y){l||(K(e.$$.fragment,y),K(i.$$.fragment,y),l=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),l=!1},d(y){y&&se(t),Te(e,y),Te(i,y)}}}function eC(r){let e,t;return e=new Hr({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function tC(r){let e,t,i,l,u,d,a,_,y;t=new L0({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let x=Tn(r[9]),S=[];for(let D=0;D<x.length;D+=1)S[D]=Ay(Ly(r,x,D));const C=D=>ie(S[D],1,1,()=>{S[D]=null});let L=Tn(r[5]),P=[];for(let D=0;D<L.length;D+=1)P[D]=Py(Iy(r,L,D));const R=D=>ie(P[D],1,1,()=>{P[D]=null});return d=new tr({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[QT]},$$scope:{ctx:r}}}),_=new tr({props:{data:r[10],$$slots:{default:[eC]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le();for(let D=0;D<S.length;D+=1)S[D].c();l=Le();for(let D=0;D<P.length;D+=1)P[D].c();u=Le(),Ce(d.$$.fragment),a=Le(),Ce(_.$$.fragment),ke(e,"slot","map")},m(D,B){ae(D,e,B),Se(t,e,null),Z(e,i);for(let N=0;N<S.length;N+=1)S[N]&&S[N].m(e,null);Z(e,l);for(let N=0;N<P.length;N+=1)P[N]&&P[N].m(e,null);Z(e,u),Se(d,e,null),Z(e,a),Se(_,e,null),y=!0},p(D,B){if(B[0]&918032){x=Tn(D[9]);let j;for(j=0;j<x.length;j+=1){const le=Ly(D,x,j);S[j]?(S[j].p(le,B),K(S[j],1)):(S[j]=Ay(le),S[j].c(),K(S[j],1),S[j].m(e,l))}for(gi(),j=x.length;j<S.length;j+=1)C(j);_i()}if(B[0]&2146348){L=Tn(D[5]);let j;for(j=0;j<L.length;j+=1){const le=Iy(D,L,j);P[j]?(P[j].p(le,B),K(P[j],1)):(P[j]=Py(le),P[j].c(),K(P[j],1),P[j].m(e,u))}for(gi(),j=L.length;j<P.length;j+=1)R(j);_i()}const N={};B[0]&96&&(N.data=D[16](D[6],D[5])),B[1]&128&&(N.$$scope={dirty:B,ctx:D}),d.$set(N);const $={};B[0]&1024&&($.data=D[10]),B[1]&128&&($.$$scope={dirty:B,ctx:D}),_.$set($)},i(D){if(!y){K(t.$$.fragment,D);for(let B=0;B<x.length;B+=1)K(S[B]);for(let B=0;B<L.length;B+=1)K(P[B]);K(d.$$.fragment,D),K(_.$$.fragment,D),y=!0}},o(D){ie(t.$$.fragment,D),S=S.filter(Boolean);for(let B=0;B<S.length;B+=1)ie(S[B]);P=P.filter(Boolean);for(let B=0;B<P.length;B+=1)ie(P[B]);ie(d.$$.fragment,D),ie(_.$$.fragment,D),y=!1},d(D){D&&se(e),Te(t),Vo(S,D),Vo(P,D),Te(d),Te(_)}}}function iC(r){let e,t,i,l;return e=new go({props:{$$slots:{map:[tC],sidebar:[KT],top:[qT]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0,i||(l=Mt(jT,"keydown",r[20]),i=!0)},p(u,d){const a={};d[0]&2047|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u),i=!1,l()}}}function nC(r,e,t){let i,l,u;lt(r,Co,ht=>t(5,l=ht)),lt(r,ac,ht=>t(6,u=ht));let{$$slots:d={},$$scope:a}=e,{map:_}=e,{finish:y}=e,{cancel:x}=e;or(()=>{St(Co,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let S="snap",C=[],L=[],P=null,R=!1,D=!1,B=!1;function N(ht){let Ot=ht.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=Ot}function $(){let ht=C.pop();t(8,C),ht&&St(Co,l=ht,l)}function j(){C.length==100&&C.shift(),t(8,C=[...C,JSON.parse(JSON.stringify(l))])}function le(){t(7,S=S=="snap"?"free":"snap"),P&&t(23,P.snapped=S=="snap",P)}function ce(ht){l.length>=3||(j(),Co.update(Ot=>(Ot.push({point:ht.detail.lngLat.toArray(),snapped:S=="snap"}),Ot)))}function J(ht){t(23,P={point:ht.detail.lngLat.toArray(),snapped:S=="snap"})}function te(ht){j(),Co.update(Ot=>(Ot[ht].snapped=!Ot[ht].snapped,Ot))}function ye(ht){j(),Co.update(Ot=>(Ot.splice(ht,1),Ot)),t(2,R=!1)}function Ue(ht,Ot){try{if(ht)return s1(Ot)}catch{}return ia()}function oe(ht,Ot,Fe,Ne){if(Ne||Ot.length>=3)return ia();try{if(ht&&Ot.length>0&&Fe)return JSON.parse(ht.inner.calculateRoute([Ot[Ot.length-1],Fe]))}catch{}return ia()}function ve(ht,Ot,Fe){if(Fe)return;if(!ht||Ot.length<3){t(9,L=[]);return}let Ne=[],dt=1,bt=JSON.parse(JSON.stringify(Ot));bt.push(bt[0]);for(let we=0;we<bt.length-1;we++){let Ii=JSON.parse(ht.inner.getExtraNodes(bt[we],bt[we+1]));for(let[qe,Je,Vt]of Ii)Ne.push({point:[qe,Je],snapped:Vt,insertIdx:dt});dt++}t(9,L=Ne)}function st(ht){j(),Co.update(Ot=>(Ot.splice(ht.insertIdx,0,{point:ht.point,snapped:ht.snapped}),Ot)),t(4,B=!0)}function ze(ht){Co.update(Ot=>(Ot[ht.insertIdx].point=ht.point,Ot))}function Qe(){t(4,B=!1)}function wt(ht){let Ot=ht.target.tagName,Fe=Ot=="INPUT"||Ot=="TEXTAREA";ht.key=="Enter"&&!Fe||ht.key=="Escape"?(ht.stopPropagation(),l.length>=3?y():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ht.key=="s"&&!Fe?le():ht.key=="z"&&ht.ctrlKey&&(ht.stopPropagation(),$())}function pt(){j(),t(3,D=!0)}const nt=[[]];function Ht(ht,Ot){r.$$.not_equal(Ot.point,ht)&&(Ot.point=ht,t(9,L))}const oi=ht=>st(ht),Dt=ht=>ze(ht),mt=ht=>{st(ht),t(4,B=!1)};function ti(ht,Ot){r.$$.not_equal(Ot.point,ht)&&(Ot.point=ht,Co.set(l))}const Pt=ht=>te(ht),Rt=ht=>ye(ht),ct=()=>t(2,R=!0),Jt=()=>t(2,R=!1),Yt=()=>t(3,D=!1);function Ei(){S=this.__value,t(7,S)}function Fi(){S=this.__value,t(7,S)}return r.$$set=ht=>{"map"in ht&&t(22,_=ht.map),"finish"in ht&&t(0,y=ht.finish),"cancel"in ht&&t(1,x=ht.cancel),"$$scope"in ht&&t(38,a=ht.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&ve(u,l,B),r.$$.dirty[0]&8388716&&t(10,i=oe(u,l,P,R||D)),r.$$.dirty[0]&32&&N(l)},[y,x,R,D,B,l,u,S,C,L,i,$,ce,J,te,ye,Ue,st,ze,Qe,wt,pt,_,P,d,Ht,oi,Dt,mt,ti,Pt,Rt,ct,Jt,Yt,Ei,nt,Fi,a]}class rC extends Ut{constructor(e){super(),jt(this,e,nC,iC,Ft,{map:22,finish:0,cancel:1},null,[-1,-1])}}function oC(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function sC(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function aC(r){let e;return{c(){e=re("li"),e.textContent="Creating new neighbourhood boundary"},m(t,i){ae(t,e,i)},p:Ct,i:Ct,o:Ct,d(t){t&&se(e)}}}function lC(r){let e,t,i,l,u;return t=new bi({props:{$$slots:{default:[cC]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=re("li"),Ce(t.$$.fragment),i=Le(),l=re("li"),l.textContent="Changing neighbourhood boundary"},m(d,a){ae(d,e,a),Se(t,e,null),ae(d,i,a),ae(d,l,a),u=!0},p(d,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(K(t.$$.fragment,d),u=!0)},o(d){ie(t.$$.fragment,d),u=!1},d(d){d&&(se(e),se(i),se(l)),Te(t)}}}function cC(r){let e;return{c(){e=je("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function uC(r){let e,t,i,l,u,d,a,_,y,x,S,C;u=new bi({props:{$$slots:{default:[oC]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new bi({props:{$$slots:{default:[sC]},$$scope:{ctx:r}}}),_.$on("click",r[7]);const L=[lC,aC],P=[];function R(D,B){return D[1]?0:1}return x=R(r),S=P[x]=L[x](r),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),S.c(),ke(t,"aria-label","breadcrumb"),ke(e,"slot","extra-top")},m(D,B){ae(D,e,B),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),P[x].m(i,null),C=!0},p(D,B){const N={};B&4096&&(N.$$scope={dirty:B,ctx:D}),u.$set(N);const $={};B&4096&&($.$$scope={dirty:B,ctx:D}),_.$set($);let j=x;x=R(D),x===j?P[x].p(D,B):(gi(),ie(P[j],1,1,()=>{P[j]=null}),_i(),S=P[x],S?S.p(D,B):(S=P[x]=L[x](D),S.c()),K(S,1),S.m(i,null))},i(D){C||(K(u.$$.fragment,D),K(_.$$.fragment,D),K(S),C=!0)},o(D){ie(u.$$.fragment,D),ie(_.$$.fragment,D),ie(S),C=!1},d(D){D&&se(e),Te(u),Te(_),P[x].d()}}}function hC(r){let e,t,i,l;return{c(){e=re("div"),t=re("h1"),i=je("Draw your neighbourhood boundary for "),l=je(r[0]),ke(e,"slot","extra-sidebar")},m(u,d){ae(u,e,d),Z(e,t),Z(t,i),Z(t,l)},p(u,d){d&1&&ai(l,u[0])},d(u){u&&se(e)}}}function dC(r){let e,t;return e=new rC({props:{map:sr(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[hC],"extra-top":[uC]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&8&&(u.map=sr(i[3])),l&4103&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function fC(r,e,t){let i,l,u,d,a;lt(r,Wt,R=>t(2,i=R)),lt(r,Fu,R=>t(9,l=R)),lt(r,Cn,R=>t(10,u=R)),lt(r,Co,R=>t(11,d=R)),lt(r,is,R=>t(3,a=R));let{name:_}=e,{existing:y}=e;y&&(y.properties.waypoints?St(Co,d=y.properties.waypoints.map(R=>({point:[R.lon,R.lat],snapped:R.snapped})),d):St(Co,d=y.geometry.coordinates[0].slice(1).map(R=>({point:R,snapped:!1})),d));function x(){if(d.length>=3)try{let R=s1(d);u.setNeighbourhoodBoundary(_,R),sc(),u.setCurrentNeighbourhood(_,l),St(Wt,i={mode:"neighbourhood"},i)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){y?St(Wt,i={mode:"neighbourhood"},i):St(Wt,i={mode:"pick-neighbourhood"},i)}const C=()=>St(Wt,i={mode:"title",firstLoad:!1},i),L=()=>St(Wt,i={mode:"pick-neighbourhood"},i),P=()=>St(Wt,i={mode:"neighbourhood"},i);return r.$$set=R=>{"name"in R&&t(0,_=R.name),"existing"in R&&t(1,y=R.existing)},[_,y,i,a,x,S,C,L,P]}class pC extends Ut{constructor(e){super(),jt(this,e,fC,dC,Ft,{name:0,existing:1})}}const mC="/ltn/assets/settings-342fb430.svg";function zy(r){let e,t;return e=new Ld({props:{$$slots:{default:[gC]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&67&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function gC(r){let e,t,i,l,u,d,a,_,y,x,S,C,L;return i=new tS({}),{c(){e=re("h1"),e.textContent="Settings",t=Le(),Ce(i.$$.fragment),l=Le(),u=re("label"),d=re("input"),a=je(`
      Road thickness depends on shortcuts`),_=Le(),y=re("center"),x=re("button"),x.textContent="Confirm",ke(d,"type","checkbox")},m(P,R){ae(P,e,R),ae(P,t,R),Se(i,P,R),ae(P,l,R),ae(P,u,R),Z(u,d),d.checked=r[1],Z(u,a),ae(P,_,R),ae(P,y,R),Z(y,x),S=!0,C||(L=[Mt(d,"change",r[3]),Mt(x,"click",r[4])],C=!0)},p(P,R){R&2&&(d.checked=P[1])},i(P){S||(K(i.$$.fragment,P),S=!0)},o(P){ie(i.$$.fragment,P),S=!1},d(P){P&&(se(e),se(t),se(l),se(u),se(_),se(y)),Te(i,P),C=!1,mn(L)}}}function _C(r){let e,t,i,l,u,d,a=r[0]&&zy(r);return{c(){e=re("button"),e.innerHTML=`<img src="${mC}" alt="Settings"/>`,t=Le(),a&&a.c(),i=En(),ke(e,"class","outline")},m(_,y){ae(_,e,y),ae(_,t,y),a&&a.m(_,y),ae(_,i,y),l=!0,u||(d=Mt(e,"click",r[2]),u=!0)},p(_,[y]){_[0]?a?(a.p(_,y),y&1&&K(a,1)):(a=zy(_),a.c(),K(a,1),a.m(i.parentNode,i)):a&&(gi(),ie(a,1,1,()=>{a=null}),_i())},i(_){l||(K(a),l=!0)},o(_){ie(a),l=!1},d(_){_&&(se(e),se(t),se(i)),a&&a.d(_),u=!1,d()}}}function yC(r,e,t){let i;lt(r,hp,y=>t(1,i=y));let l=!1;const u=()=>t(0,l=!0);function d(){i=this.checked,hp.set(i)}return[l,i,u,d,()=>t(0,l=!1),()=>t(0,l=!1)]}class vC extends Ut{constructor(e){super(),jt(this,e,yC,_C,Ft,{})}}const bC=["==",["geometry-type"],"Polygon"],wC=["==",["geometry-type"],"LineString"],xC=["==",["geometry-type"],"Point"];function a1(){return{type:"FeatureCollection",features:[]}}function tp(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:l1(r)}}}function l1(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const c1=Si(a1()),u1=Si(0),kC=100;class SC{constructor(e){jn(this,"map");jn(this,"active");jn(this,"eventListenersSuccess");jn(this,"eventListenersUpdated");jn(this,"eventListenersFailure");jn(this,"points");jn(this,"cursor");jn(this,"hover");jn(this,"dragFrom");jn(this,"previousStates");jn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,i=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=i}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});jn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Dy(this.points).forEach((i,l)=>{t.push([l+1,Cw(i,this.cursor).properties.dist])}),t.sort((i,l)=>i[1]-l[1]),t.length>0){let i=t[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});jn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=tp(e.lngLat.toArray()),this.onClick(e),this.finish())});jn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});jn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});jn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});jn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=a1();this.points.forEach((l,u)=>{let d=tp(l);d.properties.hover=this.hover==u,d.properties.idx=u,e.features.push(d)}),e.features=e.features.concat(Dy(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),c1.set(e);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,u1.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=tp(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(l1),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>kC&&this.previousStates.shift()}}function Dy(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function TC(r){let e,t,i;return{c(){e=je("Undo ("),t=je(r[1]),i=je(")")},m(l,u){ae(l,e,u),ae(l,t,u),ae(l,i,u)},p(l,u){u&2&&ai(t,l[1])},d(l){l&&(se(e),se(t),se(i))}}}function CC(r){let e;return{c(){e=je("Undo")},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function MC(r){let e,t,i,l,u,d,a,_,y,x,S;function C(R,D){return R[1]==0?CC:TC}let L=C(r),P=L(r);return{c(){e=re("div"),t=re("button"),t.textContent="Finish",i=Le(),l=re("button"),l.textContent="Cancel",u=Le(),d=re("button"),P.c(),_=Le(),y=re("ul"),y.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,d.disabled=a=r[1]==0,Ri(e,"display","flex"),Ri(e,"justify-content","space-between")},m(R,D){ae(R,e,D),Z(e,t),Z(e,i),Z(e,l),Z(e,u),Z(e,d),P.m(d,null),ae(R,_,D),ae(R,y,D),x||(S=[Mt(t,"click",r[2]),Mt(l,"click",r[3]),Mt(d,"click",r[4])],x=!0)},p(R,[D]){L===(L=C(R))&&P?P.p(R,D):(P.d(1),P=L(R),P&&(P.c(),P.m(d,null))),D&2&&a!==(a=R[1]==0)&&(d.disabled=a)},i:Ct,o:Ct,d(R){R&&(se(e),se(_),se(y)),P.d(),x=!1,mn(S)}}}function EC(r,e,t){let i;lt(r,u1,_=>t(1,i=_));let{polygonTool:l}=e;const u=()=>l.finish(),d=()=>l.cancel(),a=()=>l.undo();return r.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,i,u,d,a]}class IC extends Ut{constructor(e){super(),jt(this,e,EC,MC,Ft,{polygonTool:0})}}let LC=Date.now();function Ku(r){return`${r}-${LC++}`}const h1=Symbol.for("svelte-maplibre");function AC(){return Id(h1)}function Ry(r){return{subscribe:r.subscribe}}function d1({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:i=!1}){let l=AC(),u=Si(null),d=Ry(u),a={...l,[r]:Ry(u)};if(e&&(a.popupTarget=d),i){let _=Si(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=Si()),Ed(h1,a),{...l,self:u}}function PC(){return d1({key:"source",setCluster:!0})}function zC(r=!0){return d1({key:"layer",setPopupTarget:r,setMouseEvent:r})}function By(r){let e;return t=>{if(t)for(let i in t){let l=e==null?void 0:e[i],u=t[i];l!==u&&r(i,u,l)}else if(e)for(let i in e)r(i,void 0,e[i]);e=t}}function DC(r,...e){let t=[r];for(let i of e)if(i)Array.isArray(i)&&i[0]===r?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function RC(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Fy(r){let e=r[0],t,i,l=Oy(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d[0]&1&&Ft(e,e=u[0])?(gi(),ie(l,1,1,Ct),_i(),l=Oy(u),l.c(),K(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(K(l),i=!0)},o(u){ie(l),i=!1},d(u){u&&se(t),l.d(u)}}}function Oy(r){let e;const t=r[36].default,i=Vi(t,r,r[35],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[1]&16)&&Zi(i,t,l,l[35],e?qi(t,l[35],u,null):Gi(l[35]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function BC(r){let e,t,i=r[0]&&Fy(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u[0]&1&&K(i,1)):(i=Fy(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function FC(r,e,t){let i,l,u,d,a,_,y,x,S,C,L,P,{$$slots:R={},$$scope:D}=e,{id:B=Ku("layer")}=e,{source:N=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:j=void 0}=e,{beforeLayerType:le=void 0}=e,{type:ce}=e,{paint:J=void 0}=e,{layout:te=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:Ue=void 0}=e,{minzoom:oe=void 0}=e,{maxzoom:ve=void 0}=e,{manageHoverState:st=!1}=e,{hovered:ze=null}=e,{interactive:Qe=!0}=e,{hoverCursor:wt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const nt=rs(),{map:Ht,source:oi,self:Dt,minzoom:mt,maxzoom:ti,eventTopMost:Pt,layerInfo:Rt}=zC();lt(r,Ht,Fe=>t(31,S=Fe)),lt(r,oi,Fe=>t(32,C=Fe)),lt(r,Dt,Fe=>t(0,x=Fe)),lt(r,mt,Fe=>t(34,P=Fe)),lt(r,ti,Fe=>t(33,L=Fe)),or(()=>{x&&S&&(Rt.delete(x),S==null||S.removeLayer(x))});let ct;function Jt(Fe){var we,Ii;if(!Qe||!x||!S||pt&&Pt(Fe)!==x)return;let Ne=Fe.features??[],dt=(Ii=(we=Ne[0])==null?void 0:we.properties)==null?void 0:Ii.cluster_id,bt={event:Fe,map:S,clusterId:dt,layer:x,source:a,features:Ne};nt(Fe.type,bt)}function Yt(Fe){var we,Ii;if(!Qe||!x||!S||pt&&Pt(Fe)!==x)return;wt&&(S.getCanvas().style.cursor=wt);let Ne=Fe.features??[];t(6,ze=Ne[0]??null);let dt=(Ii=(we=Ne[0])==null?void 0:we.properties)==null?void 0:Ii.cluster_id;nt("mouseenter",{event:Fe,map:S,clusterId:dt,layer:x,source:a,features:Ne})}function Ei(Fe){var we,Ii,qe;if(!Qe||!S)return;if(pt&&Pt(Fe)!==x){t(6,ze=null),st&&ct!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:$,id:ct},{hover:!1}),ct=void 0);return}S.getCanvas().style.cursor=wt;let Ne=Fe.features??[],dt=(Ii=(we=Ne[0])==null?void 0:we.properties)==null?void 0:Ii.cluster_id,bt=(qe=Ne[0])==null?void 0:qe.id;bt!==ct&&(st&&(ct!==void 0&&(S==null||S.setFeatureState({source:a,id:ct,sourceLayer:$},{hover:!1})),S==null||S.setFeatureState({source:a,id:bt,sourceLayer:$},{hover:!0})),ct=bt,t(6,ze=Ne[0]??null)),nt("mousemove",{event:Fe,map:S,clusterId:dt,layer:x,source:a,features:Ne})}function Fi(Fe){if(!(!Qe||!x||!S)){if(wt&&(S.getCanvas().style.cursor=""),t(6,ze=null),st&&ct!==void 0){const Ne={source:a,id:ct,sourceLayer:$};S==null||S.setFeatureState(Ne,{hover:!1}),ct=void 0}nt("mouseleave",{map:S,layer:x,source:a})}}let ht=!0;function Ot(Fe){S&&(S.off("click",Fe,Jt),S.off("dblclick",Fe,Jt),S.off("contextmenu",Fe,Jt),S.off("mouseenter",Fe,Yt),S.off("mousemove",Fe,Ei),S.off("mouseleave",Fe,Fi))}return or(()=>{S&&x&&Ot(x)}),r.$$set=Fe=>{"id"in Fe&&t(7,B=Fe.id),"source"in Fe&&t(8,N=Fe.source),"sourceLayer"in Fe&&t(9,$=Fe.sourceLayer),"beforeId"in Fe&&t(10,j=Fe.beforeId),"beforeLayerType"in Fe&&t(11,le=Fe.beforeLayerType),"type"in Fe&&t(12,ce=Fe.type),"paint"in Fe&&t(13,J=Fe.paint),"layout"in Fe&&t(14,te=Fe.layout),"filter"in Fe&&t(15,ye=Fe.filter),"applyToClusters"in Fe&&t(16,Ue=Fe.applyToClusters),"minzoom"in Fe&&t(17,oe=Fe.minzoom),"maxzoom"in Fe&&t(18,ve=Fe.maxzoom),"manageHoverState"in Fe&&t(19,st=Fe.manageHoverState),"hovered"in Fe&&t(6,ze=Fe.hovered),"interactive"in Fe&&t(20,Qe=Fe.interactive),"hoverCursor"in Fe&&t(21,wt=Fe.hoverCursor),"eventsIfTopMost"in Fe&&t(22,pt=Fe.eventsIfTopMost),"$$scope"in Fe&&t(35,D=Fe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,i=RC(Ue)),r.$$.dirty[0]&1073774592&&t(24,l=DC("all",i,ye)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=oe??P),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ve??L),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=N||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&x!==B&&a){x&&(Ot(x),Rt.delete(x));let Fe=j;if(!j&&le){let Ne=S.getStyle().layers,dt=typeof le=="function"?le:we=>we.type===le,bt=Ne==null?void 0:Ne.find(dt);bt&&(Fe=bt.id)}St(Dt,x=B,x),S.addLayer(Ua({id:x,type:ce,source:a,"source-layer":$,filter:l,paint:J,layout:te,minzoom:u,maxzoom:d}),Fe),t(23,ht=!0),S.on("click",x,Jt),S.on("dblclick",x,Jt),S.on("contextmenu",x,Jt),S.on("mouseenter",x,Yt),S.on("mousemove",x,Ei),S.on("mouseleave",x,Fi)}r.$$.dirty[0]&1048577&&x&&Rt.set(x,{interactive:Qe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=x?By((Fe,Ne)=>S==null?void 0:S.setPaintProperty(x,Fe,Ne)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,y=x?By((Fe,Ne)=>S==null?void 0:S.setLayoutProperty(x,Fe,Ne)):void 0),r.$$.dirty[0]&268443648&&(_==null||_(J)),r.$$.dirty[0]&134234112&&(y==null||y(te)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&x&&(S==null||S.setLayerZoomRange(x,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&x&&(ht?t(23,ht=!1):S==null||S.setFilter(x,l))},[x,Ht,oi,Dt,mt,ti,ze,B,N,$,j,le,ce,J,te,ye,Ue,oe,ve,st,Qe,wt,pt,ht,l,d,u,y,_,a,i,S,C,L,P,D,R]}class Xp extends Ut{constructor(e){super(),jt(this,e,FC,BC,Ft,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function OC(r){let e;const t=r[16].default,i=Vi(t,r,r[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Zi(i,t,l,l[24],e?qi(t,l[24],u,null):Gi(l[24]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function NC(r){let e,t,i;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[OC]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Xp({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function $C(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Ku("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:j=!0}=e;function le(ve){N=ve,t(0,N)}function ce(ve){pi.call(this,r,ve)}function J(ve){pi.call(this,r,ve)}function te(ve){pi.call(this,r,ve)}function ye(ve){pi.call(this,r,ve)}function Ue(ve){pi.call(this,r,ve)}function oe(ve){pi.call(this,r,ve)}return r.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,y=ve.beforeLayerType),"paint"in ve&&t(6,x=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,C=ve.filter),"applyToClusters"in ve&&t(9,L=ve.applyToClusters),"minzoom"in ve&&t(10,P=ve.minzoom),"maxzoom"in ve&&t(11,R=ve.maxzoom),"hoverCursor"in ve&&t(12,D=ve.hoverCursor),"manageHoverState"in ve&&t(13,B=ve.manageHoverState),"hovered"in ve&&t(0,N=ve.hovered),"eventsIfTopMost"in ve&&t(14,$=ve.eventsIfTopMost),"interactive"in ve&&t(15,j=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[N,u,d,a,_,y,x,S,C,L,P,R,D,B,$,j,i,le,ce,J,te,ye,Ue,oe,l]}class jC extends Ut{constructor(e){super(),jt(this,e,$C,NC,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function UC(r){let e;const t=r[15].default,i=Vi(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function VC(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[UC]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Xp({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function qC(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Ku("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:$=!0}=e;function j(oe){B=oe,t(0,B)}function le(oe){pi.call(this,r,oe)}function ce(oe){pi.call(this,r,oe)}function J(oe){pi.call(this,r,oe)}function te(oe){pi.call(this,r,oe)}function ye(oe){pi.call(this,r,oe)}function Ue(oe){pi.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,u=oe.id),"source"in oe&&t(2,d=oe.source),"sourceLayer"in oe&&t(3,a=oe.sourceLayer),"beforeId"in oe&&t(4,_=oe.beforeId),"beforeLayerType"in oe&&t(5,y=oe.beforeLayerType),"paint"in oe&&t(6,x=oe.paint),"layout"in oe&&t(7,S=oe.layout),"filter"in oe&&t(8,C=oe.filter),"minzoom"in oe&&t(9,L=oe.minzoom),"maxzoom"in oe&&t(10,P=oe.maxzoom),"hoverCursor"in oe&&t(11,R=oe.hoverCursor),"manageHoverState"in oe&&t(12,D=oe.manageHoverState),"hovered"in oe&&t(0,B=oe.hovered),"eventsIfTopMost"in oe&&t(13,N=oe.eventsIfTopMost),"interactive"in oe&&t(14,$=oe.interactive),"$$scope"in oe&&t(23,l=oe.$$scope)},[B,u,d,a,_,y,x,S,C,L,P,R,D,N,$,i,j,le,ce,J,te,ye,Ue,l]}class ZC extends Ut{constructor(e){super(),jt(this,e,qC,VC,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function GC(r,e,t,i,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{i(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function WC(r,e,t){o0().then(()=>{let i=Dr(r);if(!i)return;i.getSource(e)===t&&i.removeSource(e)})}function Ny(r){let e=r[0],t,i,l=$y(r);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),ae(u,t,d),i=!0},p(u,d){d&1&&Ft(e,e=u[0])?(gi(),ie(l,1,1,Ct),_i(),l=$y(u),l.c(),K(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(K(l),i=!0)},o(u){ie(l),i=!1},d(u){u&&se(t),l.d(u)}}}function $y(r){let e;const t=r[15].default,i=Vi(t,r,r[14],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16384)&&Zi(i,t,l,l[14],e?qi(t,l[14],u,null):Gi(l[14]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function HC(r){let e,t,i=r[0]&&Ny(r);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),ae(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&K(i,1)):(i=Ny(l),i.c(),K(i,1),i.m(e.parentNode,e)):i&&(gi(),ie(i,1,1,()=>{i=null}),_i())},i(l){t||(K(i),t=!0)},o(l){ie(i),t=!1},d(l){l&&se(e),i&&i.d(l)}}}function XC(r,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{id:_=Ku("geojson")}=e,{data:y}=e,{generateId:x=!1}=e,{promoteId:S=void 0}=e,{filter:C=void 0}=e,{lineMetrics:L=void 0}=e,{cluster:P=void 0}=e;const{map:R,cluster:D,self:B}=PC();lt(r,R,j=>t(13,l=j)),lt(r,D,j=>t(16,u=j)),lt(r,B,j=>t(0,i=j));let N,$=!0;return or(()=>{i&&N&&l&&(WC(R,i,N),St(B,i=null,i),t(11,N=void 0))}),r.$$set=j=>{"id"in j&&t(4,_=j.id),"data"in j&&t(5,y=j.data),"generateId"in j&&t(6,x=j.generateId),"promoteId"in j&&t(7,S=j.promoteId),"filter"in j&&t(8,C=j.filter),"lineMetrics"in j&&t(9,L=j.lineMetrics),"cluster"in j&&t(10,P=j.cluster),"$$scope"in j&&t(14,a=j.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&St(D,u=P,u),r.$$.dirty&12273&&l&&i!==_&&(St(B,i=_,i),GC(l,i,Ua({type:"geojson",data:y,filter:C,lineMetrics:L,generateId:x,promoteId:S,cluster:!!P,clusterMinPoints:P==null?void 0:P.minPoints,clusterMaxZoom:P==null?void 0:P.maxZoom,clusterRadius:P==null?void 0:P.radius,clusterProperties:P==null?void 0:P.properties}),j=>l&&j===i,()=>{i&&(t(11,N=l==null?void 0:l.getSource(i)),t(12,$=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,N=l==null?void 0:l.getSource(_))})),r.$$.dirty&6176&&N&&($?t(12,$=!1):N.setData(y)),r.$$.dirty&3072&&(N==null||N.setClusterOptions(Ua({cluster:!!P,clusterMaxZoom:P==null?void 0:P.maxZoom,clusterRadius:P==null?void 0:P.radius})))},[i,R,D,B,_,y,x,S,C,L,P,N,$,l,a,d]}class KC extends Ut{constructor(e){super(),jt(this,e,XC,HC,Ft,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function JC(r){let e;const t=r[15].default,i=Vi(t,r,r[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Zi(i,t,l,l[23],e?qi(t,l[23],u,null):Gi(l[23]),null)},i(l){e||(K(i,l),e=!0)},o(l){ie(i,l),e=!1},d(l){i&&i.d(l)}}}function YC(r){let e,t,i;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[JC]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Xp({props:u}),Xi.push(()=>pr(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ce(e.$$.fragment)},m(d,a){Se(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],fr(()=>t=!1)),e.$set(_)},i(d){i||(K(e.$$.fragment,d),i=!0)},o(d){ie(e.$$.fragment,d),i=!1},d(d){Te(e,d)}}}function QC(r,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Ku("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:x}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:$=!0}=e;function j(oe){B=oe,t(0,B)}function le(oe){pi.call(this,r,oe)}function ce(oe){pi.call(this,r,oe)}function J(oe){pi.call(this,r,oe)}function te(oe){pi.call(this,r,oe)}function ye(oe){pi.call(this,r,oe)}function Ue(oe){pi.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,u=oe.id),"source"in oe&&t(2,d=oe.source),"sourceLayer"in oe&&t(3,a=oe.sourceLayer),"beforeId"in oe&&t(4,_=oe.beforeId),"beforeLayerType"in oe&&t(5,y=oe.beforeLayerType),"paint"in oe&&t(6,x=oe.paint),"layout"in oe&&t(7,S=oe.layout),"filter"in oe&&t(8,C=oe.filter),"minzoom"in oe&&t(9,L=oe.minzoom),"maxzoom"in oe&&t(10,P=oe.maxzoom),"hoverCursor"in oe&&t(11,R=oe.hoverCursor),"manageHoverState"in oe&&t(12,D=oe.manageHoverState),"hovered"in oe&&t(0,B=oe.hovered),"eventsIfTopMost"in oe&&t(13,N=oe.eventsIfTopMost),"interactive"in oe&&t(14,$=oe.interactive),"$$scope"in oe&&t(23,l=oe.$$scope)},[B,u,d,a,_,y,x,S,C,L,P,R,D,N,$,i,j,le,ce,J,te,ye,Ue,l]}class eM extends Ut{constructor(e){super(),jt(this,e,QC,YC,Ft,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function tM(r){let e,t,i,l,u,d;return e=new ZC({props:{id:"edit-polygon-fill",filter:bC,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),i=new eM({props:{id:"edit-polygon-lines",filter:wC,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new jC({props:{id:"edit-polygon-vertices",filter:xC,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment)},m(a,_){Se(e,a,_),ae(a,t,_),Se(i,a,_),ae(a,l,_),Se(u,a,_),d=!0},p:Ct,i(a){d||(K(e.$$.fragment,a),K(i.$$.fragment,a),K(u.$$.fragment,a),d=!0)},o(a){ie(e.$$.fragment,a),ie(i.$$.fragment,a),ie(u.$$.fragment,a),d=!1},d(a){a&&(se(t),se(l)),Te(e,a),Te(i,a),Te(u,a)}}}function iM(r){let e,t;return e=new KC({props:{data:r[0],$$slots:{default:[tM]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&2&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function nM(r,e,t){let i;return lt(r,c1,l=>t(0,i=l)),[i]}class rM extends Ut{constructor(e){super(),jt(this,e,nM,iM,Ft,{})}}function oM(r){let e,t,i,l,u,d,a;return{c(){e=re("button"),e.textContent="Import current view",t=Le(),i=re("i"),i.textContent="or...",l=Le(),u=re("button"),u.textContent="Draw an area to import on the map",ke(e,"type","button"),ke(u,"type","button")},m(_,y){ae(_,e,y),ae(_,t,y),ae(_,i,y),ae(_,l,y),ae(_,u,y),d||(a=[Mt(e,"click",r[2]),Mt(u,"click",r[3])],d=!0)},p:Ct,i:Ct,o:Ct,d(_){_&&(se(e),se(t),se(i),se(l),se(u)),d=!1,mn(a)}}}function sM(r){let e,t;return e=new IC({props:{polygonTool:r[0]}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.polygonTool=i[0]),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function aM(r){let e,t,i,l,u,d,a,_,y;const x=[sM,oM],S=[];function C(L,P){return L[0]?0:1}return e=C(r),t=S[e]=x[e](r),{c(){t.c(),i=Le(),l=re("label"),u=re("input"),d=je(`Save a copy of the osm.xml
  after importing`),ke(u,"type","checkbox")},m(L,P){S[e].m(L,P),ae(L,i,P),ae(L,l,P),Z(l,u),u.checked=r[1],Z(l,d),a=!0,_||(y=Mt(u,"change",r[5]),_=!0)},p(L,[P]){let R=e;e=C(L),e===R?S[e].p(L,P):(gi(),ie(S[R],1,1,()=>{S[R]=null}),_i(),t=S[e],t?t.p(L,P):(t=S[e]=x[e](L),t.c()),K(t,1),t.m(i.parentNode,i)),P&2&&(u.checked=L[1])},i(L){a||(K(t),a=!0)},o(L){ie(t),a=!1},d(L){L&&(se(i),se(l)),S[e].d(L),_=!1,y()}}}function _u(r){return[r.lng,r.lat]}function lM(r,e,t){let{map:i}=e;const l=rs();let u=null,d=!1;async function a(C){try{l("loading","Loading from Overpass");let P=await(await fetch(f1(C))).text();d&&yd("osm.xml",P),l("gotXml",{xml:P,boundary:C})}catch(L){l("error",L.toString())}}function _(){let C=i.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[_u(C.getSouthWest()),_u(C.getNorthWest()),_u(C.getNorthEast()),_u(C.getSouthEast()),_u(C.getSouthWest())]],type:"Polygon"}}}async function y(){if(i){if(i.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function x(){i&&(t(0,u=new SC(i)),u.startNew(),u.addEventListenerSuccess(async C=>{t(0,u=null),await a(C)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function S(){d=this.checked,t(1,d)}return r.$$set=C=>{"map"in C&&t(4,i=C.map)},[u,d,y,x,i,S]}class cM extends Ut{constructor(e){super(),jt(this,e,lM,aM,Ft,{map:4})}}function f1(r){let e='poly:"';for(let[i,l]of r.geometry.coordinates[0])e+=`${l} ${i} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class p1{constructor(e,t,i){jn(this,"inner");this.inner=new Nw(e,t,i)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=uM(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,i){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,i))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}}function uM(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function gd(r){Ms.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get OSM input");let[t,i]=await hM(e);console.timeEnd("get OSM input"),console.time("load"),Cn.set(new p1(new Uint8Array(t),i,e.study_area_name||void 0)),Dr(Cn).loadSavefile(e),console.timeEnd("load"),m1()}catch(e){window.alert(`Couldn't open project: ${e}`),Ms.set("")}}async function hM(r){if(r.study_area_name){let e=Dr(Du)?`/osm/${r.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${r.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let i=await(await fetch(e)).arrayBuffer(),l=Dr(Du)?`/boundaries/${r.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${r.study_area_name}.geojson`,d=await(await fetch(l)).json();return[i,d]}else{console.log("Grabbing from Overpass");let e=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(f1(e))).arrayBuffer(),e]}}function m1(){Wt.set({mode:"pick-neighbourhood"}),ac.set(new Ew(Dr(is),Dr(Cn).toRouteSnapper(),Si(ia()),Si(!0),Si(0))),Dr(is).fitBounds(Dr(Cn).getBounds(),{animate:!1}),Ru.set(ip()),Bu.set(ip()),cd.set(ip());let r=new URL(window.location.href);r.searchParams.set("project",Dr(Ms)),window.history.replaceState(null,"",r.toString())}function ip(){let r=Dr(Cn).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new Cs.LngLat(e,t)}function jy(r,e,t){const i=r.slice();return i[17]=e[t][0],i[18]=e[t][1],i}function Uy(r,e,t){const i=r.slice();return i[21]=e[t][0],i[22]=e[t][1],i}function dM(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function fM(r){let e,t,i,l,u,d,a,_;return u=new bi({props:{$$slots:{default:[dM]},$$scope:{ctx:r}}}),u.$on("click",r[13]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),a.textContent="New project",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(y,x){ae(y,e,x),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),_=!0},p(y,x){const S={};x&33554432&&(S.$$scope={dirty:x,ctx:y}),u.$set(S)},i(y){_||(K(u.$$.fragment,y),_=!0)},o(y){ie(u.$$.fragment,y),_=!1},d(y){y&&se(e),Te(u)}}}function Vy(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P;e=new a0({props:{loading:r[4]}});let R=Tn(r[3]),D=[];for(let B=0;B<R.length;B+=1)D[B]=Zy(jy(r,R,B));return S=new cM({props:{map:r[5]}}),S.$on("gotXml",r[7]),S.$on("loading",r[11]),S.$on("error",r[12]),{c(){Ce(e.$$.fragment),t=Le(),i=re("label"),l=je(`Load a built-in area:
        `),u=re("select"),d=re("option");for(let B=0;B<D.length;B+=1)D[B].c();a=Le(),_=re("i"),_.textContent="or...",y=Le(),x=re("div"),Ce(S.$$.fragment),d.__value="",zn(d,d.__value),r[2]===void 0&&rc(()=>r[9].call(u))},m(B,N){Se(e,B,N),ae(B,t,N),ae(B,i,N),Z(i,l),Z(i,u),Z(u,d);for(let $=0;$<D.length;$+=1)D[$]&&D[$].m(u,null);nc(u,r[2],!0),ae(B,a,N),ae(B,_,N),ae(B,y,N),ae(B,x,N),Se(S,x,null),C=!0,L||(P=[Mt(u,"change",r[9]),Mt(u,"change",r[10])],L=!0)},p(B,N){const $={};if(N&16&&($.loading=B[4]),e.$set($),N&8){R=Tn(B[3]);let le;for(le=0;le<R.length;le+=1){const ce=jy(B,R,le);D[le]?D[le].p(ce,N):(D[le]=Zy(ce),D[le].c(),D[le].m(u,null))}for(;le<D.length;le+=1)D[le].d(1);D.length=R.length}N&12&&nc(u,B[2]);const j={};N&32&&(j.map=B[5]),S.$set(j)},i(B){C||(K(e.$$.fragment,B),K(S.$$.fragment,B),C=!0)},o(B){ie(e.$$.fragment,B),ie(S.$$.fragment,B),C=!1},d(B){B&&(se(t),se(i),se(a),se(_),se(y),se(x)),Te(e,B),Vo(D,B),Te(S),L=!1,mn(P)}}}function qy(r){let e,t=r[22]+"",i,l;return{c(){e=re("option"),i=je(t),e.__value=l=r[21],zn(e,e.__value)},m(u,d){ae(u,e,d),Z(e,i)},p(u,d){d&8&&t!==(t=u[22]+"")&&ai(i,t),d&8&&l!==(l=u[21])&&(e.__value=l,zn(e,e.__value))},d(u){u&&se(e)}}}function Zy(r){let e,t,i=Tn(r[18]),l=[];for(let u=0;u<i.length;u+=1)l[u]=qy(Uy(r,i,u));return{c(){e=re("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();ke(e,"label",t=r[17])},m(u,d){ae(u,e,d);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,d){if(d&8){i=Tn(u[18]);let a;for(a=0;a<i.length;a+=1){const _=Uy(u,i,a);l[a]?l[a].p(_,d):(l[a]=qy(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}d&8&&t!==(t=u[17])&&ke(e,"label",t)},d(u){u&&se(e),Vo(l,u)}}}function pM(r){let e,t,i,l,u,d,a,_,y,x=r[1]&&Vy(r);return{c(){e=re("div"),t=re("div"),i=re("label"),l=je(`Project name:
        `),u=re("input"),d=Le(),x&&x.c(),ke(u,"type","text"),ke(e,"slot","sidebar")},m(S,C){ae(S,e,C),Z(e,t),Z(t,i),Z(i,l),Z(i,u),zn(u,r[1]),Z(e,d),x&&x.m(e,null),a=!0,_||(y=Mt(u,"input",r[8]),_=!0)},p(S,C){C&2&&u.value!==S[1]&&zn(u,S[1]),S[1]?x?(x.p(S,C),C&2&&K(x,1)):(x=Vy(S),x.c(),K(x,1),x.m(e,null)):x&&(gi(),ie(x,1,1,()=>{x=null}),_i())},i(S){a||(K(x),a=!0)},o(S){ie(x),a=!1},d(S){S&&se(e),x&&x.d(),_=!1,y()}}}function mM(r){let e,t,i;return t=new rM({}),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","map")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p:Ct,i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function gM(r){let e,t;return e=new go({props:{$$slots:{map:[mM],sidebar:[pM],top:[fM]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function _M(r,e,t){let i,l,u,d,a;lt(r,Ms,j=>t(14,i=j)),lt(r,Cn,j=>t(15,l=j)),lt(r,Du,j=>t(16,u=j)),lt(r,is,j=>t(5,d=j)),lt(r,Wt,j=>t(6,a=j));let _="",y="",x=[],S="";Md(async()=>{let j=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,x=await j.json())});function C(j){t(4,S="Loading OSM");try{St(Cn,l=new p1(new TextEncoder().encode(j.detail.xml),j.detail.boundary,void 0),l),St(Ms,i=`ltn_${_}`,i),m1(),sc()}catch(le){window.alert(`Couldn't import from Overpass: ${le}`)}t(4,S="")}async function L(){if(y=="")return;let j=`ltn_${_}`;window.localStorage.setItem(j,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:y})),t(4,S=`Loading pre-clipped OSM area ${y}`),await gd(j),t(4,S="")}function P(){_=this.value,t(1,_)}function R(){y=Lp(this),t(2,y),t(3,x)}return[L,_,y,x,S,d,a,C,P,R,()=>L(),j=>t(4,S=j.detail),j=>window.alert(j.detail),()=>St(Wt,a={mode:"title",firstLoad:!1},a)]}class yM extends Ut{constructor(e){super(),jt(this,e,_M,gM,Ft,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Gy(r,e,t){const i=r.slice();return i[19]=e[t][0],i[20]=e[t][1],i}function Wy(r,e,t){const i=r.slice();return i[23]=e[t],i}function vM(r){let e;return{c(){e=re("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',ke(e,"slot","top")},m(t,i){ae(t,e,i)},p:Ct,d(t){t&&se(e)}}}function bM(r){let e;return{c(){e=re("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,i){ae(t,e,i)},p:Ct,i:Ct,o:Ct,d(t){t&&se(e)}}}function wM(r){let e,t,i,l,u,d,a,_,y,x,S,C,L;t=new bi({props:{$$slots:{default:[xM]},$$scope:{ctx:r}}}),t.$on("click",r[11]);let P=Tn(r[2]),R=[];for(let B=0;B<P.length;B+=1)R[B]=Xy(Gy(r,P,B));const D=B=>ie(R[B],1,1,()=>{R[B]=null});return{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),l=re("p"),l.textContent="Load a saved project:",u=Le(),d=re("ul");for(let B=0;B<R.length;B+=1)R[B].c();a=Le(),_=re("label"),y=je(`Load a project from a file
        `),x=re("input"),ke(x,"type","file")},m(B,N){ae(B,e,N),Se(t,e,null),ae(B,i,N),ae(B,l,N),ae(B,u,N),ae(B,d,N);for(let $=0;$<R.length;$+=1)R[$]&&R[$].m(d,null);ae(B,a,N),ae(B,_,N),Z(_,y),Z(_,x),r[15](x),S=!0,C||(L=Mt(x,"change",r[6]),C=!0)},p(B,N){const $={};if(N&67108864&&($.$$scope={dirty:N,ctx:B}),t.$set($),N&900){P=Tn(B[2]);let j;for(j=0;j<P.length;j+=1){const le=Gy(B,P,j);R[j]?(R[j].p(le,N),K(R[j],1)):(R[j]=Xy(le),R[j].c(),K(R[j],1),R[j].m(d,null))}for(gi(),j=P.length;j<R.length;j+=1)D(j);_i()}},i(B){if(!S){K(t.$$.fragment,B);for(let N=0;N<P.length;N+=1)K(R[N]);S=!0}},o(B){ie(t.$$.fragment,B),R=R.filter(Boolean);for(let N=0;N<R.length;N+=1)ie(R[N]);S=!1},d(B){B&&(se(e),se(i),se(l),se(u),se(d),se(a),se(_)),Te(t),Vo(R,B),r[15](null),C=!1,L()}}}function xM(r){let e;return{c(){e=je("New project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function kM(r){let e=r[23].slice(4)+"",t;return{c(){t=je(e)},m(i,l){ae(i,t,l)},p(i,l){l&4&&e!==(e=i[23].slice(4)+"")&&ai(t,e)},d(i){i&&se(t)}}}function Hy(r){let e,t,i,l,u,d,a,_,y,x,S;function C(){return r[12](r[23])}i=new bi({props:{$$slots:{default:[kM]},$$scope:{ctx:r}}}),i.$on("click",C);function L(){return r[13](r[23])}function P(){return r[14](r[23])}return{c(){e=re("li"),t=re("span"),Ce(i.$$.fragment),l=Le(),u=re("button"),u.innerHTML=`<img src="${o1}" alt="Rename project"/>`,d=Le(),a=re("button"),a.innerHTML=`<img src="${r1}" alt="Delete project"/>`,_=Le(),ke(u,"class","secondary"),ke(a,"class","secondary"),Ri(t,"display","flex"),Ri(t,"justify-content","space-between")},m(R,D){ae(R,e,D),Z(e,t),Se(i,t,null),Z(t,l),Z(t,u),Z(t,d),Z(t,a),Z(e,_),y=!0,x||(S=[Mt(u,"click",L),Mt(a,"click",P)],x=!0)},p(R,D){r=R;const B={};D&67108868&&(B.$$scope={dirty:D,ctx:r}),i.$set(B)},i(R){y||(K(i.$$.fragment,R),y=!0)},o(R){ie(i.$$.fragment,R),y=!1},d(R){R&&se(e),Te(i),x=!1,mn(S)}}}function Xy(r){let e,t=(r[19]??"custom area")+"",i,l,u,d,a=Tn(r[20]),_=[];for(let x=0;x<a.length;x+=1)_[x]=Hy(Wy(r,a,x));const y=x=>ie(_[x],1,1,()=>{_[x]=null});return{c(){e=re("u"),i=je(t),l=Le();for(let x=0;x<_.length;x+=1)_[x].c();u=En()},m(x,S){ae(x,e,S),Z(e,i),ae(x,l,S);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(x,S);ae(x,u,S),d=!0},p(x,S){if((!d||S&4)&&t!==(t=(x[19]??"custom area")+"")&&ai(i,t),S&900){a=Tn(x[20]);let C;for(C=0;C<a.length;C+=1){const L=Wy(x,a,C);_[C]?(_[C].p(L,S),K(_[C],1)):(_[C]=Hy(L),_[C].c(),K(_[C],1),_[C].m(u.parentNode,u))}for(gi(),C=a.length;C<_.length;C+=1)y(C);_i()}},i(x){if(!d){for(let S=0;S<a.length;S+=1)K(_[S]);d=!0}},o(x){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)ie(_[S]);d=!1},d(x){x&&(se(e),se(l),se(u)),Vo(_,x)}}}function SM(r){let e,t,i,l;const u=[wM,bM],d=[];function a(_,y){return _[4]&&_[0]?0:1}return t=a(r),i=d[t]=u[t](r),{c(){e=re("div"),i.c(),ke(e,"slot","sidebar")},m(_,y){ae(_,e,y),d[t].m(e,null),l=!0},p(_,y){let x=t;t=a(_),t===x?d[t].p(_,y):(gi(),ie(d[x],1,1,()=>{d[x]=null}),_i(),i=d[t],i?i.p(_,y):(i=d[t]=u[t](_),i.c()),K(i,1),i.m(e,null))},i(_){l||(K(i),l=!0)},o(_){ie(i),l=!1},d(_){_&&se(e),d[t].d()}}}function TM(r){let e,t,i,l;return e=new a0({props:{loading:r[1]}}),i=new go({props:{$$slots:{sidebar:[SM],top:[vM]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment)},m(u,d){Se(e,u,d),ae(u,t,d),Se(i,u,d),l=!0},p(u,[d]){const a={};d&2&&(a.loading=u[1]),e.$set(a);const _={};d&67108925&&(_.$$scope={dirty:d,ctx:u}),i.$set(_)},i(u){l||(K(e.$$.fragment,u),K(i.$$.fragment,u),l=!0)},o(u){ie(e.$$.fragment,u),ie(i.$$.fragment,u),l=!1},d(u){u&&se(t),Te(e,u),Te(i,u)}}}function sd(){let r=new Map,e=[];for(let i=0;i<window.localStorage.length;i++){let l=window.localStorage.key(i);if(l.startsWith("ltn_")){let u="";try{u=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}u&&u.length>0?(r.has(u)||r.set(u,[]),r.get(u).push(l)):e.push(l)}}let t=[...r.entries()];return t.sort((i,l)=>i[0].localeCompare(l[0])),t.push(["custom",e]),t}function CM(r,e,t){let i,l,u,d,a;lt(r,Ms,ce=>t(16,i=ce)),lt(r,ac,ce=>t(17,l=ce)),lt(r,Cn,ce=>t(18,u=ce)),lt(r,is,ce=>t(4,d=ce)),lt(r,Wt,ce=>t(5,a=ce));let{wasmReady:_}=e,{firstLoad:y}=e,x="";if(St(Cn,u=null,u),St(ac,l=null,l),St(Ms,i="",i),y){let J=new URLSearchParams(window.location.search).get("project");J&&gd(J)}else{let ce=new URL(window.location.href);ce.searchParams.delete("project"),window.history.replaceState(null,"",ce.toString())}let S=sd(),C;async function L(ce){let J="ltn_"+C.files[0].name;t(1,x=`Loading from file ${J}`),window.localStorage.setItem(J,await C.files[0].text()),t(2,S=sd()),await gd(J),t(1,x="")}function P(ce){window.confirm(`Really delete project ${ce}? You can't undo this.`)&&(window.localStorage.removeItem(ce),t(2,S=sd()))}function R(ce){let J=window.prompt(`Rename project ${ce} to what?`,ce);if(J){J.startsWith("ltn_")||(J=`ltn_${J}`);let te=window.localStorage.getItem(ce);window.localStorage.setItem(J,te),window.localStorage.removeItem(ce),t(2,S=sd())}}async function D(ce){t(1,x=`Loading project ${ce}`),await gd(ce),t(1,x="")}const B=()=>St(Wt,a={mode:"new-project"},a),N=ce=>D(ce),$=ce=>R(ce),j=ce=>P(ce);function le(ce){Xi[ce?"unshift":"push"](()=>{C=ce,t(3,C)})}return r.$$set=ce=>{"wasmReady"in ce&&t(0,_=ce.wasmReady),"firstLoad"in ce&&t(10,y=ce.firstLoad)},[_,x,S,C,d,a,L,P,R,D,y,B,N,$,j,le]}class MM extends Ut{constructor(e){super(),jt(this,e,CM,TM,Ft,{wasmReady:0,firstLoad:10})}}function EM(r){let e;return{c(){e=je("Choose project")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function IM(r){let e;return{c(){e=je("Pick neighbourhood")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function LM(r){let e;return{c(){e=je("Editing")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function AM(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P;return u=new bi({props:{$$slots:{default:[EM]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new bi({props:{$$slots:{default:[IM]},$$scope:{ctx:r}}}),_.$on("click",r[7]),S=new bi({props:{$$slots:{default:[LM]},$$scope:{ctx:r}}}),S.$on("click",r[3]),{c(){e=re("div"),t=re("nav"),i=re("ul"),l=re("li"),Ce(u.$$.fragment),d=Le(),a=re("li"),Ce(_.$$.fragment),y=Le(),x=re("li"),Ce(S.$$.fragment),C=Le(),L=re("li"),L.textContent="Viewing shortcuts",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(R,D){ae(R,e,D),Z(e,t),Z(t,i),Z(i,l),Se(u,l,null),Z(i,d),Z(i,a),Se(_,a,null),Z(i,y),Z(i,x),Se(S,x,null),Z(i,C),Z(i,L),P=!0},p(R,D){const B={};D&1024&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const N={};D&1024&&(N.$$scope={dirty:D,ctx:R}),_.$set(N);const $={};D&1024&&($.$$scope={dirty:D,ctx:R}),S.$set($)},i(R){P||(K(u.$$.fragment,R),K(_.$$.fragment,R),K(S.$$.fragment,R),P=!0)},o(R){ie(u.$$.fragment,R),ie(_.$$.fragment,R),ie(S.$$.fragment,R),P=!1},d(R){R&&se(e),Te(u),Te(_),Te(S)}}}function PM(r){let e,t,i,l,u,d,a,_,y,x,S=sr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",C,L,P,R,D,B;function N(j){r[5](j)}let $={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&($.idx=r[0].shortcutIndex),u=new Hp({props:$}),Xi.push(()=>pr(u,"idx",N)),{c(){e=re("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Le(),i=re("button"),i.textContent="Pick a different road",l=Le(),Ce(u.$$.fragment),a=Le(),_=re("p"),y=je("This shortcut is "),x=re("b"),C=je(S),L=je("x"),P=je(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(j,le){ae(j,e,le),ae(j,t,le),ae(j,i,le),ae(j,l,le),Se(u,j,le),ae(j,a,le),ae(j,_,le),Z(_,y),Z(_,x),Z(x,C),Z(x,L),Z(_,P),R=!0,D||(B=Mt(i,"click",r[4]),D=!0)},p(j,le){const ce={};le&1&&(ce.list=j[0].gj.features),!d&&le&1&&(d=!0,ce.idx=j[0].shortcutIndex,fr(()=>d=!1)),u.$set(ce),(!R||le&1)&&S!==(S=sr(j[0].gj.features[j[0].shortcutIndex].properties).directness.toFixed(1)+"")&&ai(C,S)},i(j){R||(K(u.$$.fragment,j),R=!0)},o(j){ie(u.$$.fragment,j),R=!1},d(j){j&&(se(e),se(t),se(i),se(l),se(a),se(_)),Te(u,j),D=!1,B()}}}function zM(r){let e;return{c(){e=re("p"),e.textContent="Click a road to see shortcuts"},m(t,i){ae(t,e,i)},p:Ct,i:Ct,o:Ct,d(t){t&&se(e)}}}function DM(r){let e,t,i,l,u,d;t=new qa({}),t.$on("click",r[3]);const a=[zM,PM],_=[];function y(x,S){return x[0].state=="neutral"?0:x[0].state=="chose-road"?1:-1}return~(l=y(r))&&(u=_[l]=a[l](r)),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),u&&u.c(),ke(e,"slot","sidebar")},m(x,S){ae(x,e,S),Se(t,e,null),Z(e,i),~l&&_[l].m(e,null),d=!0},p(x,S){let C=l;l=y(x),l===C?~l&&_[l].p(x,S):(u&&(gi(),ie(_[C],1,1,()=>{_[C]=null}),_i()),~l?(u=_[l],u?u.p(x,S):(u=_[l]=a[l](x),u.c()),K(u,1),u.m(e,null)):u=null)},i(x){d||(K(t.$$.fragment,x),K(u),d=!0)},o(x){ie(t.$$.fragment,x),ie(u),d=!1},d(x){x&&se(e),Te(t),~l&&_[l].d()}}}function RM(r){let e,t;return e=new Hu({props:{interactive:!1}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function BM(r){let e,t;return e=new Hu({props:{onClickLine:r[2],$$slots:{"line-popup":[OM]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&1024&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function FM(r){let e,t=r[9].shortcuts+"",i,l,u=(r[9].name??"unnamed road")+"",d;return{c(){e=re("p"),i=je(t),l=je(" shortcuts through "),d=je(u)},m(a,_){ae(a,e,_),Z(e,i),Z(e,l),Z(e,d)},p(a,_){_&512&&t!==(t=a[9].shortcuts+"")&&ai(i,t),_&512&&u!==(u=(a[9].name??"unnamed road")+"")&&ai(d,u)},d(a){a&&se(e)}}}function OM(r){let e,t,i;return t=new os({props:{openOn:"hover",$$slots:{default:[FM,({props:l})=>({9:l}),({props:l})=>l?512:0]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){ae(l,e,u),Se(t,e,null),i=!0},p(l,u){const d={};u&1536&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(K(t.$$.fragment,l),i=!0)},o(l){ie(t.$$.fragment,l),i=!1},d(l){l&&se(e),Te(t)}}}function NM(r){let e,t,i,l,u,d,a,_,y,x;e=new Fd({}),i=new Bd({}),u=new Od({});const S=[BM,RM],C=[];function L(P,R){return P[0].state=="neutral"?0:P[0].state=="chose-road"?1:-1}return~(a=L(r))&&(_=C[a]=S[a](r)),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),_&&_.c(),y=En()},m(P,R){Se(e,P,R),ae(P,t,R),Se(i,P,R),ae(P,l,R),Se(u,P,R),ae(P,d,R),~a&&C[a].m(P,R),ae(P,y,R),x=!0},p(P,R){let D=a;a=L(P),a===D?~a&&C[a].p(P,R):(_&&(gi(),ie(C[D],1,1,()=>{C[D]=null}),_i()),~a?(_=C[a],_?_.p(P,R):(_=C[a]=S[a](P),_.c()),K(_,1),_.m(y.parentNode,y)):_=null)},i(P){x||(K(e.$$.fragment,P),K(i.$$.fragment,P),K(u.$$.fragment,P),K(_),x=!0)},o(P){ie(e.$$.fragment,P),ie(i.$$.fragment,P),ie(u.$$.fragment,P),ie(_),x=!1},d(P){P&&(se(t),se(l),se(d),se(y)),Te(e,P),Te(i,P),Te(u,P),~a&&C[a].d(P)}}}function Ky(r){let e,t,i,l,u,d,a,_;return e=new tr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[$M]},$$scope:{ctx:r}}}),i=new tr({props:{data:r[0].roadGj,$$slots:{default:[jM]},$$scope:{ctx:r}}}),u=new Va({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[UM]},$$scope:{ctx:r}}}),a=new Va({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[VM]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),Ce(a.$$.fragment)},m(y,x){Se(e,y,x),ae(y,t,x),Se(i,y,x),ae(y,l,x),Se(u,y,x),ae(y,d,x),Se(a,y,x),_=!0},p(y,x){const S={};x&1&&(S.data=y[0].gj.features[y[0].shortcutIndex]),x&1024&&(S.$$scope={dirty:x,ctx:y}),e.$set(S);const C={};x&1&&(C.data=y[0].roadGj),x&1024&&(C.$$scope={dirty:x,ctx:y}),i.$set(C);const L={};x&1&&(L.lngLat=y[0].gj.features[y[0].shortcutIndex].geometry.coordinates[0]),x&1024&&(L.$$scope={dirty:x,ctx:y}),u.$set(L);const P={};x&1&&(P.lngLat=y[0].gj.features[y[0].shortcutIndex].geometry.coordinates[y[0].gj.features[y[0].shortcutIndex].geometry.coordinates.length-1]),x&1024&&(P.$$scope={dirty:x,ctx:y}),a.$set(P)},i(y){_||(K(e.$$.fragment,y),K(i.$$.fragment,y),K(u.$$.fragment,y),K(a.$$.fragment,y),_=!0)},o(y){ie(e.$$.fragment,y),ie(i.$$.fragment,y),ie(u.$$.fragment,y),ie(a.$$.fragment,y),_=!1},d(y){y&&(se(t),se(l),se(d)),Te(e,y),Te(i,y),Te(u,y),Te(a,y)}}}function $M(r){let e,t;const i=[nn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function jM(r){let e,t;const i=[nn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new Hr({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function UM(r){let e;return{c(){e=je("A")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function VM(r){let e;return{c(){e=je("B")},m(t,i){ae(t,e,i)},d(t){t&&se(e)}}}function qM(r){let e,t,i,l,u,d;t=new Xu({props:{$$slots:{default:[NM]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&Ky(r);return u=new Za({}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),a&&a.c(),l=Le(),Ce(u.$$.fragment),ke(e,"slot","map")},m(_,y){ae(_,e,y),Se(t,e,null),Z(e,i),a&&a.m(e,null),Z(e,l),Se(u,e,null),d=!0},p(_,y){const x={};y&1025&&(x.$$scope={dirty:y,ctx:_}),t.$set(x),_[0].state=="chose-road"?a?(a.p(_,y),y&1&&K(a,1)):(a=Ky(_),a.c(),K(a,1),a.m(e,l)):a&&(gi(),ie(a,1,1,()=>{a=null}),_i())},i(_){d||(K(t.$$.fragment,_),K(a),K(u.$$.fragment,_),d=!0)},o(_){ie(t.$$.fragment,_),ie(a),ie(u.$$.fragment,_),d=!1},d(_){_&&se(e),Te(t),a&&a.d(),Te(u)}}}function ZM(r){let e,t;return e=new go({props:{$$slots:{map:[qM],sidebar:[DM],top:[AM]},$$scope:{ctx:r}}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,[l]){const u={};l&1027&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function GM(r,e,t){let i,l;lt(r,Wt,C=>t(1,i=C)),lt(r,Cn,C=>t(8,l=C));let u={state:"neutral"};function d(C,L){let P=l.getShortcutsCrossingRoad(C.properties.id);if(P.features.length==0){window.alert("No shortcuts here");return}t(0,u={state:"chose-road",roadGj:C,gj:P,shortcutIndex:0})}function a(){St(Wt,i={mode:"neighbourhood"},i)}const _=()=>t(0,u={state:"neutral"});function y(C){r.$$.not_equal(u.shortcutIndex,C)&&(u.shortcutIndex=C,t(0,u))}return[u,i,d,a,_,y,()=>St(Wt,i={mode:"title",firstLoad:!1},i),()=>St(Wt,i={mode:"pick-neighbourhood"},i)]}class WM extends Ut{constructor(e){super(),jt(this,e,GM,ZM,Ft,{})}}function HM(r){let e,t,i,l,u,d,a,_,y;return l=new vC({}),{c(){e=re("div"),t=re("button"),t.innerHTML=`<img src="${bb}" style="height: 6vh;" alt="A/B Street logo"/>`,i=Le(),Ce(l.$$.fragment),u=Le(),d=re("span"),ke(t,"class","outline"),Ri(d,"width","100%"),ke(e,"slot","top"),ke(e,"class","pico"),Ri(e,"display","flex")},m(x,S){ae(x,e,S),Z(e,t),Z(e,i),Se(l,e,null),Z(e,u),Z(e,d),r[19](d),a=!0,_||(y=Mt(t,"click",r[18]),_=!0)},p:Ct,i(x){a||(K(l.$$.fragment,x),a=!0)},o(x){ie(l.$$.fragment,x),a=!1},d(x){x&&se(e),Te(l),r[19](null),_=!1,y()}}}function Jy(r){let e,t,i,l,u,d;return i=new CS({props:{map:sr(r[6]),maptilerBasemap:r[7]}}),{c(){e=re("button"),e.textContent="Zoom to fit study area",t=Le(),Ce(i.$$.fragment),ke(e,"class","secondary")},m(a,_){ae(a,e,_),ae(a,t,_),Se(i,a,_),l=!0,u||(d=Mt(e,"click",r[10]),u=!0)},p(a,_){const y={};_&64&&(y.map=sr(a[6])),_&128&&(y.maptilerBasemap=a[7]),i.$set(y)},i(a){l||(K(i.$$.fragment,a),l=!0)},o(a){ie(i.$$.fragment,a),l=!1},d(a){a&&(se(e),se(t)),Te(i,a),u=!1,d()}}}function XM(r){let e,t,i,l,u,d,a=r[5]&&Jy(r);return{c(){e=re("div"),t=re("div"),i=Le(),l=re("hr"),u=Le(),a&&a.c(),ke(e,"class","pico"),ke(e,"slot","left")},m(_,y){ae(_,e,y),Z(e,t),r[17](t),Z(e,i),Z(e,l),Z(e,u),a&&a.m(e,null),d=!0},p(_,y){_[5]?a?(a.p(_,y),y&32&&K(a,1)):(a=Jy(_),a.c(),K(a,1),a.m(e,null)):a&&(gi(),ie(a,1,1,()=>{a=null}),_i())},i(_){d||(K(a),d=!0)},o(_){ie(a),d=!1},d(_){_&&se(e),r[17](null),a&&a.d()}}}function KM(r){let e,t;return e=new yM({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function JM(r){let e,t;return e=new MM({props:{wasmReady:r[4],firstLoad:r[8].firstLoad}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&16&&(u.wasmReady=i[4]),l&256&&(u.firstLoad=i[8].firstLoad),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function Yy(r){let e,t,i,l,u,d;e=new tr({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[YM]},$$scope:{ctx:r}}});const a=[cE,lE,aE,sE,oE,rE,nE,iE,tE,eE,QM],_=[];function y(x,S){return x[8].mode=="pick-neighbourhood"?0:x[8].mode=="set-boundary"?1:x[8].mode=="auto-boundaries"?2:x[8].mode=="neighbourhood"?3:x[8].mode=="view-shortcuts"?4:x[8].mode=="impact-one-destination"?5:x[8].mode=="route"?6:x[8].mode=="predict-impact"?7:x[8].mode=="impact-detail"?8:x[8].mode=="debug"?9:x[8].mode=="debug-intersections"?10:-1}return~(i=y(r))&&(l=_[i]=a[i](r)),{c(){Ce(e.$$.fragment),t=Le(),l&&l.c(),u=En()},m(x,S){Se(e,x,S),ae(x,t,S),~i&&_[i].m(x,S),ae(x,u,S),d=!0},p(x,S){const C={};S&32&&(C.data=x[5].getInvertedBoundary()),S&2097152&&(C.$$scope={dirty:S,ctx:x}),e.$set(C);let L=i;i=y(x),i===L?~i&&_[i].p(x,S):(l&&(gi(),ie(_[L],1,1,()=>{_[L]=null}),_i()),~i?(l=_[i],l?l.p(x,S):(l=_[i]=a[i](x),l.c()),K(l,1),l.m(u.parentNode,u)):l=null)},i(x){d||(K(e.$$.fragment,x),K(l),d=!0)},o(x){ie(e.$$.fragment,x),ie(l),d=!1},d(x){x&&(se(t),se(u)),Te(e,x),~i&&_[i].d(x)}}}function YM(r){let e,t;const i=[nn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<i.length;u+=1)l=en(l,i[u]);return e=new ns({props:l}),{c(){Ce(e.$$.fragment)},m(u,d){Se(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(K(e.$$.fragment,u),t=!0)},o(u){ie(e.$$.fragment,u),t=!1},d(u){Te(e,u)}}}function QM(r){let e,t;return e=new YS({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function eE(r){let e,t;return e=new L3({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function tE(r){let e,t;return e=new F5({props:{road:r[8].road}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.road=i[8].road),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function iE(r){let e,t;return e=new MT({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function nE(r){let e,t;return e=new $T({props:{prevMode:r[8].prevMode}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.prevMode=i[8].prevMode),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function rE(r){let e,t;return e=new Y5({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function oE(r){let e,t;return e=new WM({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function sE(r){let e,t;return e=new T5({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function aE(r){let e,t;return e=new US({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function lE(r){let e,t;return e=new pC({props:{name:r[8].name,existing:r[8].existing}}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.name=i[8].name),l&256&&(u.existing=i[8].existing),e.$set(u)},i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function cE(r){let e,t;return e=new gT({}),{c(){Ce(e.$$.fragment)},m(i,l){Se(e,i,l),t=!0},p:Ct,i(i){t||(K(e.$$.fragment,i),t=!0)},o(i){ie(e.$$.fragment,i),t=!1},d(i){Te(e,i)}}}function uE(r){let e,t,i,l,u,d,a,_,y,x,S,C,L,P;e=new A0({}),i=new P0({}),u=new C4({props:{map:r[0],apiKey:lp,country:void 0}});const R=[JM,KM],D=[];function B($,j){return $[8].mode=="title"?0:$[8].mode=="new-project"?1:-1}~(y=B(r))&&(x=D[y]=R[y](r));let N=r[5]&&Yy(r);return L=new oS({}),{c(){Ce(e.$$.fragment),t=Le(),Ce(i.$$.fragment),l=Le(),Ce(u.$$.fragment),d=Le(),a=re("div"),_=Le(),x&&x.c(),S=Le(),N&&N.c(),C=Le(),Ce(L.$$.fragment)},m($,j){Se(e,$,j),ae($,t,j),Se(i,$,j),ae($,l,j),Se(u,$,j),ae($,d,j),ae($,a,j),r[14](a),ae($,_,j),~y&&D[y].m($,j),ae($,S,j),N&&N.m($,j),ae($,C,j),Se(L,$,j),P=!0},p($,j){const le={};j&1&&(le.map=$[0]),u.$set(le);let ce=y;y=B($),y===ce?~y&&D[y].p($,j):(x&&(gi(),ie(D[ce],1,1,()=>{D[ce]=null}),_i()),~y?(x=D[y],x?x.p($,j):(x=D[y]=R[y]($),x.c()),K(x,1),x.m(S.parentNode,S)):x=null),$[5]?N?(N.p($,j),j&32&&K(N,1)):(N=Yy($),N.c(),K(N,1),N.m(C.parentNode,C)):N&&(gi(),ie(N,1,1,()=>{N=null}),_i())},i($){P||(K(e.$$.fragment,$),K(i.$$.fragment,$),K(u.$$.fragment,$),K(x),K(N),K(L.$$.fragment,$),P=!0)},o($){ie(e.$$.fragment,$),ie(i.$$.fragment,$),ie(u.$$.fragment,$),ie(x),ie(N),ie(L.$$.fragment,$),P=!1},d($){$&&(se(t),se(l),se(d),se(a),se(_),se(S),se(C)),Te(e,$),Te(i,$),Te(u,$),r[14](null),~y&&D[y].d($),N&&N.d($),Te(L,$)}}}function hE(r){let e,t,i,l;function u(a){r[15](a)}let d={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${lp}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:vb}],$$slots:{default:[uE]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.map=r[0]),t=new Ix({props:d}),Xi.push(()=>pr(t,"map",u)),t.$on("error",r[16]),{c(){e=re("div"),Ce(t.$$.fragment),ke(e,"slot","main"),Ri(e,"position","relative"),Ri(e,"width","100%"),Ri(e,"height","100%")},m(a,_){ae(a,e,_),Se(t,e,null),l=!0},p(a,_){const y={};_&128&&(y.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${lp}`),_&2097465&&(y.$$scope={dirty:_,ctx:a}),!i&&_&1&&(i=!0,y.map=a[0],fr(()=>i=!1)),t.$set(y)},i(a){l||(K(t.$$.fragment,a),l=!0)},o(a){ie(t.$$.fragment,a),l=!1},d(a){a&&se(e),Te(t)}}}function dE(r){let e,t,i,l,u;return t=new Pw({}),l=new W4({props:{$$slots:{main:[hE],left:[XM],top:[HM]},$$scope:{ctx:r}}}),{c(){e=re("div"),Ce(t.$$.fragment),i=Le(),Ce(l.$$.fragment),ke(e,"class","pico")},m(d,a){ae(d,e,a),Se(t,e,null),ae(d,i,a),Se(l,d,a),u=!0},p(d,[a]){const _={};a&2098175&&(_.$$scope={dirty:a,ctx:d}),l.$set(_)},i(d){u||(K(t.$$.fragment,d),K(l.$$.fragment,d),u=!0)},o(d){ie(t.$$.fragment,d),ie(l.$$.fragment,d),u=!1},d(d){d&&(se(e),se(i)),Te(t),Te(l,d)}}}function fE(r,e,t){let i,l,u,d,a,_,y,x,S;lt(r,kp,te=>t(11,i=te)),lt(r,xp,te=>t(12,l=te)),lt(r,wp,te=>t(13,u=te)),lt(r,Cn,te=>t(5,d=te)),lt(r,is,te=>t(6,a=te)),lt(r,Du,te=>t(20,_=te)),lt(r,cp,te=>t(7,y=te)),lt(r,Wt,te=>t(8,x=te)),lt(r,xd,te=>t(9,S=te));let C=!1;Md(async()=>{await I0(),await f0(),t(4,C=!0);try{(await fetch("/osm/areas.json")).ok&&(St(Du,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let L=null;function P(){a.fitBounds(d.getBounds(),{animate:!1})}let R,D,B;function N(te){Xi[te?"unshift":"push"](()=>{B=te,t(3,B),t(11,i)})}function $(te){L=te,t(0,L)}const j=te=>{console.log(te.detail.error)};function le(te){Xi[te?"unshift":"push"](()=>{D=te,t(2,D),t(12,l)})}const ce=()=>St(xd,S=!0,S);function J(te){Xi[te?"unshift":"push"](()=>{R=te,t(1,R),t(13,u)})}return r.$$.update=()=>{r.$$.dirty&1&&L&&is.set(L),r.$$.dirty&8194&&R&&u&&(t(1,R.innerHTML="",R),R.appendChild(u)),r.$$.dirty&4100&&D&&l&&(t(2,D.innerHTML="",D),D.appendChild(l)),r.$$.dirty&2056&&B&&i&&(t(3,B.innerHTML="",B),B.appendChild(i))},[L,R,D,B,C,d,a,y,x,S,P,i,l,u,N,$,j,le,ce,J]}class pE extends Ut{constructor(e){super(),jt(this,e,fE,dE,Ft,{})}}new pE({target:document.getElementById("app")});
