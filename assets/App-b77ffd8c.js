var KA=Object.defineProperty;var JA=(r,e,t)=>e in r?KA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Qn=(r,e,t)=>(JA(r,typeof e!="symbol"?e+"":e,t),t);function YA(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function at(){}function zt(r,e){for(const t in e)r[t]=e[t];return r}function QA(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function Wb(r){return r()}function U0(){return Object.create(null)}function cr(r){r.forEach(Wb)}function da(r){return typeof r=="function"}function St(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let vd;function Sr(r,e){return r===e?!0:(vd||(vd=document.createElement("a")),vd.href=e,r===vd.href)}function ek(r){return Object.keys(r).length===0}function Eg(r,...e){if(r==null){for(const n of e)n(void 0);return at}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function pi(r){let e;return Eg(r,t=>e=t)(),e}function st(r,e,t){r.$$.on_destroy.push(Eg(e,t))}function vn(r,e,t,n){if(r){const i=Zb(r,e,t,n);return r[0](i)}}function Zb(r,e,t,n){return r[1]&&n?zt(t.ctx.slice(),r[1](n(e))):t.ctx}function bn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function wn(r,e,t,n,i,o){if(i){const u=Zb(e,t,n,o);r.p(u,i)}}function xn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function gr(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function V0(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Lg(r){const e={};for(const t in r)e[t]=!0;return e}function ec(r){return r??""}function ln(r,e,t){return r.set(t),e}function Vm(r){return r&&da(r.destroy)?r.destroy:at}const Xb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function F(r,e){r.appendChild(e)}function W(r,e,t){r.insertBefore(e,t||null)}function G(r){r.parentNode&&r.parentNode.removeChild(r)}function _i(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function ws(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Me(r){return document.createTextNode(r)}function ie(){return Me(" ")}function nr(){return Me("")}function Mt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Ig(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Mf(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function he(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function qd(r,e){for(const t in e)he(r,t,e[t])}function tk(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Pg(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function Dl(r){return r===""?null:+r}function nk(r){return Array.from(r.childNodes)}function kt(r,e){e=""+e,r.data!==e&&(r.data=e)}function Wn(r,e){r.value=e??""}function Ye(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Ki(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Fa(r){const e=r.querySelector(":checked");return e&&e.__value}function Wt(r,e,t){r.classList.toggle(e,!!t)}function rk(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let jf;function aa(r){jf=r}function lc(){if(!jf)throw new Error("Function called outside component initialization");return jf}function ks(r){lc().$$.on_mount.push(r)}function ri(r){lc().$$.on_destroy.push(r)}function js(){const r=lc();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=rk(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function ip(r,e){return lc().$$.context.set(r,e),e}function Qf(r){return lc().$$.context.get(r)}function Pn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const qu=[],dn=[];let Ku=[];const qm=[],Kb=Promise.resolve();let Hm=!1;function Jb(){Hm||(Hm=!0,Kb.then(zg))}function Yb(){return Jb(),Kb}function ys(r){Ku.push(r)}function zn(r){qm.push(r)}const Sm=new Set;let Fu=0;function zg(){if(Fu!==0)return;const r=jf;do{try{for(;Fu<qu.length;){const e=qu[Fu];Fu++,aa(e),ik(e.$$)}}catch(e){throw qu.length=0,Fu=0,e}for(aa(null),qu.length=0,Fu=0;dn.length;)dn.pop()();for(let e=0;e<Ku.length;e+=1){const t=Ku[e];Sm.has(t)||(Sm.add(t),t())}Ku.length=0}while(qu.length);for(;qm.length;)qm.pop()();Hm=!1,Sm.clear(),aa(r)}function ik(r){if(r.fragment!==null){r.update(),cr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ys)}}function ok(r){const e=[],t=[];Ku.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ku=e}const Id=new Set;let Ll;function Kt(){Ll={r:0,c:[],p:Ll}}function Jt(){Ll.r||cr(Ll.c),Ll=Ll.p}function N(r,e){r&&r.i&&(Id.delete(r),r.i(e))}function V(r,e,t,n){if(r&&r.o){if(Id.has(r))return;Id.add(r),Ll.c.push(()=>{Id.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function q0(r,e){const t=e.token={};function n(i,o,u,s){if(e.token!==t)return;e.resolved=s;let h=e.ctx;u!==void 0&&(h=h.slice(),h[u]=s);const p=i&&(e.current=i)(h);let g=!1;e.block&&(e.blocks?e.blocks.forEach((_,x)=>{x!==o&&_&&(Kt(),V(_,1,1,()=>{e.blocks[x]===_&&(e.blocks[x]=null)}),Jt())}):e.block.d(1),p.c(),N(p,1),p.m(e.mount(),e.anchor),g=!0),e.block=p,e.blocks&&(e.blocks[o]=p),g&&zg()}if(QA(r)){const i=lc();if(r.then(o=>{aa(i),n(e.then,1,e.value,o),aa(null)},o=>{if(aa(i),n(e.catch,2,e.error,o),aa(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function sk(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function On(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function ak(r,e){V(r,1,1,()=>{e.delete(r.key)})}function lk(r,e,t,n,i,o,u,s,h,p,g,_){let x=r.length,C=o.length,T=x;const z={};for(;T--;)z[r[T].key]=T;const L=[],E=new Map,I=new Map,O=[];for(T=C;T--;){const q=_(i,o,T),J=t(q);let fe=u.get(J);fe?n&&O.push(()=>fe.p(q,e)):(fe=p(J,q),fe.c()),E.set(J,L[T]=fe),J in z&&I.set(J,Math.abs(T-z[J]))}const B=new Set,K=new Set;function H(q){N(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=L[C-1],J=r[x-1],fe=q.key,Ee=J.key;q===J?(g=q.first,x--,C--):E.has(Ee)?!u.has(fe)||B.has(fe)?H(q):K.has(Ee)?x--:I.get(fe)>I.get(Ee)?(K.add(fe),H(q)):(B.add(Ee),x--):(h(J,u),x--)}for(;x--;){const q=r[x];E.has(q.key)||h(q,u)}for(;C;)H(L[C-1]);return cr(O),L}function In(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],s=e[o];if(s){for(const h in u)h in s||(n[h]=1);for(const h in s)i[h]||(t[h]=s[h],i[h]=1);r[o]=s}else for(const h in u)i[h]=1}for(const u in n)u in t||(t[u]=void 0);return t}function xo(r){return typeof r=="object"&&r!==null?r:{}}function Dn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ue(r){r&&r.c()}function ae(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ys(()=>{const o=r.$$.on_mount.map(Wb).filter(da);r.$$.on_destroy?r.$$.on_destroy.push(...o):cr(o),r.$$.on_mount=[]}),i.forEach(ys)}function le(r,e){const t=r.$$;t.fragment!==null&&(ok(t.after_update),cr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function uk(r,e){r.$$.dirty[0]===-1&&(qu.push(r),Jb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Et(r,e,t,n,i,o,u=null,s=[-1]){const h=jf;aa(r);const p=r.$$={fragment:null,ctx:[],props:o,update:at,not_equal:i,bound:U0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:U0(),dirty:s,skip_bound:!1,root:e.target||h.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=T)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](T),g&&uk(r,_)),x}):[],p.update(),g=!0,cr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=nk(e.target);p.fragment&&p.fragment.l(_),_.forEach(G)}else p.fragment&&p.fragment.c();e.intro&&N(r.$$.fragment),ae(r,e.target,e.anchor),zg()}aa(h)}class Lt{constructor(){Qn(this,"$$");Qn(this,"$$set")}$destroy(){le(this,1),this.$destroy=at}$on(e,t){if(!da(t))return at;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!ek(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ck="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ck);const fk="/ltn/assets/arrow-big-up-4ad5891e.png",hk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",dk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==",Qb="/ltn/assets/no_left_turn-dabd0fc9.png",Dg="/ltn/assets/no_right_turn-74f14f9d.png",ew="/ltn/assets/no_straight_turn-b5273de3.png",tw="/ltn/assets/no_u_left_to_right_turn-59028775.png",nw="/ltn/assets/no_u_right_to_left_turn-1ad8fc8a.png",pk="/ltn/assets/logo-97f2d067.svg",rw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function mk(r){let e,t,n,i,o;const u=r[5].default,s=vn(u,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),s&&s.c()},m(h,p){W(h,e,p),F(e,t),s&&s.m(t,null),r[6](e),n=!0,i||(o=[Mt(e,"click",Mf(r[1])),Mt(e,"keydown",r[2])],i=!0)},p(h,[p]){s&&s.p&&(!n||p&16)&&wn(s,u,h,h[4],n?bn(u,h[4],p,null):xn(h[4]),null)},i(h){n||(N(s,h),n=!0)},o(h){V(s,h),n=!1},d(h){h&&G(e),s&&s.d(h),r[6](null),i=!1,cr(o)}}}function gk(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function s(g){g.target==u&&t(3,o=!1)}function h(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){dn[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,s,h,o,i,n,p]}class Rg extends Lt{constructor(e){super(),Et(this,e,gk,mk,St,{show:3})}}function H0(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function G0(r){let e,t,n=r[1]+"",i,o,u,s=r[2]+"",h,p;return{c(){e=U("tr"),t=U("td"),i=Me(n),o=ie(),u=U("td"),h=Me(s),p=ie()},m(g,_){W(g,e,_),F(e,t),F(t,i),F(e,o),F(e,u),F(u,h),F(e,p)},p(g,_){_&1&&n!==(n=g[1]+"")&&kt(i,n),_&1&&s!==(s=g[2]+"")&&kt(h,s)},d(g){g&&G(e)}}}function _k(r){let e,t,n=On(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=G0(H0(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();he(e,"class","svelte-lh2o9l")},m(o,u){W(o,e,u),F(e,t);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[u]){if(u&1){n=On(Object.entries(o[0]));let s;for(s=0;s<n.length;s+=1){const h=H0(o,n,s);i[s]?i[s].p(h,u):(i[s]=G0(h),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}},i:at,o:at,d(o){o&&G(e),_i(i,o)}}}function yk(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class eh extends Lt{constructor(e){super(),Et(this,e,yk,_k,St,{properties:0})}}function op(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function mr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var iw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ow(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Bg(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var sw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(iw,function(){var t={},n={};function i(u,s,h){if(n[u]=h,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function s(c,a,f,m){return new(f||(f=Promise))(function(b,k){function S(j){try{R(m.next(j))}catch(X){k(X)}}function M(j){try{R(m.throw(j))}catch(X){k(X)}}function R(j){var X;j.done?b(j.value):(X=j.value,X instanceof f?X:new f(function(Y){Y(X)})).then(S,M)}R((m=m.apply(c,a||[])).next())})}function h(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,a){this.x=c,this.y=a}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,f=c.y-this.y;return a*a+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),f=Math.sin(c),m=f*this.x+a*this.y;return this.x=a*this.x-f*this.y,this.y=m,this},_rotateAround:function(c,a){var f=Math.cos(c),m=Math.sin(c),b=a.y+m*(this.x-a.x)+f*(this.y-a.y);return this.x=a.x+f*(this.x-a.x)-m*(this.y-a.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var _=h(p),x=C;function C(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}C.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var T=h(x);let z,L;function E(){return z==null&&(z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),z}function I(){if(L==null&&(L=!1,E())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<5*5;m++){const b=4*m;a.fillStyle=`rgb(${b},${b+1},${b+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const f=a.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&f[m]!==m){L=!0;break}}}return L||!1}function O(c,a,f,m){const b=new T(c,a,f,m);return function(k){return b.solve(k)}}const B=O(.25,.1,.25,1);function K(c,a,f){return Math.min(f,Math.max(a,c))}function H(c,a,f){const m=f-a,b=((c-a)%m+m)%m+a;return b===a?f:b}function q(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}let J=1;function fe(c,a,f){const m={};for(const b in c)m[b]=a.call(f||this,c[b],b,c);return m}function Ee(c,a,f){const m={};for(const b in c)a.call(f||this,c[b],b,c)&&(m[b]=c[b]);return m}function ee(c){return Array.isArray(c)?c.map(ee):typeof c=="object"&&c?fe(c,ee):c}const oe={};function xe(c){oe[c]||(typeof console<"u"&&console.warn(c),oe[c]=!0)}function me(c,a,f){return(f.y-c.y)*(a.x-c.x)>(a.y-c.y)*(f.x-c.x)}function tt(c){let a=0;for(let f,m,b=0,k=c.length,S=k-1;b<k;S=b++)f=c[b],m=c[S],a+=(m.x-f.x)*(f.y+m.y);return a}function Ue(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let ze=null;function Ie(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xe(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const k=new VideoFrame(c,{timestamp:0});try{const S=k==null?void 0:k.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const M=S.startsWith("BGR"),R=new Uint8ClampedArray(m*b*4);if(yield k.copyTo(R,function(j,X,Y,se,pe){const ye=4*Math.max(-X,0),be=(Math.max(0,Y)-Y)*se*4+ye,Ce=4*se,Pe=Math.max(0,X),Ze=Math.max(0,Y);return{rect:{x:Pe,y:Ze,width:Math.min(j.width,X+se)-Pe,height:Math.min(j.height,Y+pe)-Ze},layout:[{offset:be,stride:Ce}]}}(c,a,f,m,b)),M)for(let j=0;j<R.length;j+=4){const X=R[j];R[j]=R[j+2],R[j+2]=X}return R}finally{k.close()}})}let lt,pt;const _t="AbortError";function He(){return new Error(_t)}const gt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Pt(c){return gt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const jt="global-dispatcher";class un extends Error{constructor(a,f,m,b){super(`AJAXError: ${f} (${a}): ${m}`),this.status=a,this.statusText=f,this.url=m,this.body=b}}const nn=()=>Ue(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,rn=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Pt(c.url);if(m)return m(c,a);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:jt},a)}if(!(/^file:/.test(f=c.url)||/^file:/.test(nn())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return s(this,void 0,void 0,function*(){const k=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:nn(),signal:b.signal});m.type==="json"&&k.headers.set("Accept","application/json");const S=yield fetch(k);if(!S.ok){const j=yield S.blob();throw new un(S.status,S.statusText,m.url,j)}let M;M=m.type==="arrayBuffer"||m.type==="image"?S.arrayBuffer():m.type==="json"?S.json():S.text();const R=yield M;if(b.signal.aborted)throw He();return{data:R,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}})}(c,a);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:jt},a)}var f;return function(m,b){return new Promise((k,S)=>{const M=new XMLHttpRequest;M.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(M.responseType="arraybuffer");for(const R in m.headers)M.setRequestHeader(R,m.headers[R]);m.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=m.credentials==="include",M.onerror=()=>{S(new Error(M.statusText))},M.onload=()=>{if(!b.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let R=M.response;if(m.type==="json")try{R=JSON.parse(M.response)}catch(j){return void S(j)}k({data:R,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const R=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});S(new un(M.status,M.statusText,m.url,R))}},b.signal.addEventListener("abort",()=>{M.abort(),S(He())}),M.send(m.body)})}(c,a)};function pn(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),f=window.location;return a.protocol===f.protocol&&a.host===f.host}function yn(c,a,f){f[c]&&f[c].indexOf(a)!==-1||(f[c]=f[c]||[],f[c].push(a))}function qe(c,a,f){if(f&&f[c]){const m=f[c].indexOf(a);m!==-1&&f[c].splice(m,1)}}class Ge{constructor(a,f={}){q(this,f),this.type=a}}class At extends Ge{constructor(a,f={}){super("error",q({error:a},f))}}class nt{on(a,f){return this._listeners=this._listeners||{},yn(a,f,this._listeners),this}off(a,f){return qe(a,f,this._listeners),qe(a,f,this._oneTimeListeners),this}once(a,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},yn(a,f,this._oneTimeListeners),this):new Promise(m=>this.once(a,m))}fire(a,f){typeof a=="string"&&(a=new Ge(a,f||{}));const m=a.type;if(this.listens(m)){a.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of b)M.call(this,a);const k=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of k)qe(m,M,this._oneTimeListeners),M.call(this,a);const S=this._eventedParent;S&&(q(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(a))}else a instanceof At&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,f){return this._eventedParent=a,this._eventedParentData=f,this}}var de={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ke(c,a){const f={};for(const m in c)m!=="ref"&&(f[m]=c[m]);return cn.forEach(m=>{m in a&&(f[m]=a[m])}),f}function ut(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let f=0;f<c.length;f++)if(!ut(c[f],a[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const f in c)if(!ut(c[f],a[f]))return!1;return!0}return c===a}function Gt(c,a){c.push(a)}function Jn(c,a,f){Gt(f,{command:"addSource",args:[c,a[c]]})}function Zn(c,a,f){Gt(a,{command:"removeSource",args:[c]}),f[c]=!0}function fr(c,a,f,m){Zn(c,f,m),Jn(c,a,f)}function Cr(c,a,f){let m;for(m in c[f])if(Object.prototype.hasOwnProperty.call(c[f],m)&&m!=="data"&&!ut(c[f][m],a[f][m]))return!1;for(m in a[f])if(Object.prototype.hasOwnProperty.call(a[f],m)&&m!=="data"&&!ut(c[f][m],a[f][m]))return!1;return!0}function Tr(c,a,f,m,b,k){c=c||{},a=a||{};for(const S in c)Object.prototype.hasOwnProperty.call(c,S)&&(ut(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}));for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&!Object.prototype.hasOwnProperty.call(c,S)&&(ut(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}))}function xi(c){return c.id}function Un(c,a){return c[a.id]=a,c}class xt{constructor(a,f,m,b){this.message=(a?`${a}: `:"")+m,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)}}function zr(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}class br extends Error{constructor(a,f){super(f),this.message=f,this.key=a}}class Fi{constructor(a,f=[]){this.parent=a,this.bindings={};for(const[m,b]of f)this.bindings[m]=b}concat(a){return new Fi(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const $n={kind:"null"},Fe={kind:"number"},yt={kind:"string"},bt={kind:"boolean"},Rt={kind:"color"},Qt={kind:"object"},Yt={kind:"value"},vr={kind:"collator"},or={kind:"formatted"},Se={kind:"padding"},ne={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function _e(c,a){return{kind:"array",itemType:c,N:a}}function we(c){if(c.kind==="array"){const a=we(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const Oe=[$n,Fe,yt,bt,Rt,or,Qt,_e(Yt),Se,ne,ce];function $e(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!$e(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const f of Oe)if(!$e(f,a))return null}}return`Expected ${we(c)} but found ${we(a)} instead.`}function je(c,a){return a.some(f=>f.kind===c.kind)}function De(c,a){return a.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function re(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const Je=.96422,Qe=.82521,rt=4/29,ht=6/29,Dt=3*ht*ht,en=ht*ht*ht,mn=Math.PI/180,Cn=180/Math.PI;function Nn(c){return(c%=360)<0&&(c+=360),c}function Mr([c,a,f,m]){let b,k;const S=Tn((.2225045*(c=Xr(c))+.7168786*(a=Xr(a))+.0606169*(f=Xr(f)))/1);c===a&&a===f?b=k=S:(b=Tn((.4360747*c+.3850649*a+.1430804*f)/Je),k=Tn((.0139322*c+.0971045*a+.7141733*f)/Qe));const M=116*S-16;return[M<0?0:M,500*(b-S),200*(S-k),m]}function Xr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Tn(c){return c>en?Math.pow(c,1/3):c/Dt+rt}function Or([c,a,f,m]){let b=(c+16)/116,k=isNaN(a)?b:b+a/500,S=isNaN(f)?b:b-f/200;return b=1*Mi(b),k=Je*Mi(k),S=Qe*Mi(S),[ii(3.1338561*k-1.6168667*b-.4906146*S),ii(-.9787684*k+1.9161415*b+.033454*S),ii(.0719453*k-.2289914*b+1.4052427*S),m]}function ii(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Mi(c){return c>ht?c*c*c:Dt*(c-rt)}function Oi(c){return parseInt(c.padEnd(2,c),16)/255}function gi(c,a){return qo(a?c/100:c,0,1)}function qo(c,a,f){return Math.min(Math.max(a,c),f)}function ph(c){return!c.some(Number.isNaN)}const bp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class sr{constructor(a,f,m,b=1,k=!0){this.r=a,this.g=f,this.b=m,this.a=b,k||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,f,m,b]))}static parse(a){if(a instanceof sr)return a;if(typeof a!="string")return;const f=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=bp[m];if(b){const[S,M,R]=b;return[S/255,M/255,R/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const S=m.length<6?1:2;let M=1;return[Oi(m.slice(M,M+=S)),Oi(m.slice(M,M+=S)),Oi(m.slice(M,M+=S)),Oi(m.slice(M,M+S)||"ff")]}if(m.startsWith("rgb")){const S=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[M,R,j,X,Y,se,pe,ye,be,Ce,Pe,Ze]=S,Re=[X||" ",pe||" ",Ce].join("");if(Re==="  "||Re==="  /"||Re===",,"||Re===",,,"){const Ne=[j,se,be].join(""),dt=Ne==="%%%"?100:Ne===""?255:0;if(dt){const vt=[qo(+R/dt,0,1),qo(+Y/dt,0,1),qo(+ye/dt,0,1),Pe?gi(+Pe,Ze):1];if(ph(vt))return vt}}return}}const k=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[S,M,R,j,X,Y,se,pe,ye]=k,be=[R||" ",X||" ",se].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Ce=[+M,qo(+j,0,100),qo(+Y,0,100),pe?gi(+pe,ye):1];if(ph(Ce))return function([Pe,Ze,Re,Ne]){function dt(vt){const Ht=(vt+Pe/30)%12,tn=Ze*Math.min(Re,1-Re);return Re-tn*Math.max(-1,Math.min(Ht-3,9-Ht,1))}return Pe=Nn(Pe),Ze/=100,Re/=100,[dt(0),dt(8),dt(4),Ne]}(Ce)}}}(a);return f?new sr(...f,!1):void 0}get rgb(){const{r:a,g:f,b:m,a:b}=this,k=b||1/0;return this.overwriteGetter("rgb",[a/k,f/k,m/k,b])}get hcl(){return this.overwriteGetter("hcl",function(a){const[f,m,b,k]=Mr(a),S=Math.sqrt(m*m+b*b);return[Math.round(1e4*S)?Nn(Math.atan2(b,m)*Cn):NaN,S,f,k]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Mr(this.rgb))}overwriteGetter(a,f){return Object.defineProperty(this,a,{value:f}),f}toString(){const[a,f,m,b]=this.rgb;return`rgba(${[a,f,m].map(k=>Math.round(255*k)).join(",")},${b})`}}sr.black=new sr(0,0,0,1),sr.white=new sr(1,1,1,1),sr.transparent=new sr(0,0,0,0),sr.red=new sr(1,0,0,1);class cc{constructor(a,f,m){this.sensitivity=a?f?"variant":"case":f?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,f){return this.collator.compare(a,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fc{constructor(a,f,m,b,k){this.text=a,this.image=f,this.scale=m,this.fontStack=b,this.textColor=k}}class to{constructor(a){this.sections=a}static fromString(a){return new to([new fc(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof to?a:to.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class $i{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof $i)return a;if(typeof a=="number")return new $i([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const f of a)if(typeof f!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new $i(a)}}toString(){return JSON.stringify(this.values)}}const nl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof ho)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let f=0;f<a.length;f+=2){const m=a[f],b=a[f+1];if(typeof m!="string"||!nl.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new ho(a)}}toString(){return JSON.stringify(this.values)}}class po{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new po({name:a,available:!1}):null}}function ma(c,a,f,m){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,a,f,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,a,f,m]:[c,a,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof sr||c instanceof cc||c instanceof to||c instanceof $i||c instanceof ho||c instanceof po)return!0;if(Array.isArray(c)){for(const a of c)if(!Nl(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!Nl(c[a]))return!1;return!0}return!1}function Kr(c){if(c===null)return $n;if(typeof c=="string")return yt;if(typeof c=="boolean")return bt;if(typeof c=="number")return Fe;if(c instanceof sr)return Rt;if(c instanceof cc)return vr;if(c instanceof to)return or;if(c instanceof $i)return Se;if(c instanceof ho)return ce;if(c instanceof po)return ne;if(Array.isArray(c)){const a=c.length;let f;for(const m of c){const b=Kr(m);if(f){if(f===b)continue;f=Yt;break}f=b}return _e(f||Yt,a)}return Qt}function rl(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof sr||c instanceof to||c instanceof $i||c instanceof ho||c instanceof po?c.toString():JSON.stringify(c)}class Ss{constructor(a,f){this.type=a,this.value=f}static parse(a,f){if(a.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Nl(a[1]))return f.error("invalid value");const m=a[1];let b=Kr(m);const k=f.expectedType;return b.kind!=="array"||b.N!==0||!k||k.kind!=="array"||typeof k.N=="number"&&k.N!==0||(b=k),new Ss(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Dr{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const jl={string:yt,number:Fe,boolean:bt,object:Qt};class no{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");let m,b=1;const k=a[0];if(k==="array"){let M,R;if(a.length>2){const j=a[1];if(typeof j!="string"||!(j in jl)||j==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);M=jl[j],b++}else M=Yt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return f.error('The length argument to "array" must be a positive integer literal',2);R=a[2],b++}m=_e(M,R)}else{if(!jl[k])throw new Error(`Types doesn't contain name = ${k}`);m=jl[k]}const S=[];for(;b<a.length;b++){const M=f.parse(a[b],b,Yt);if(!M)return null;S.push(M)}return new no(m,S)}evaluate(a){for(let f=0;f<this.args.length;f++){const m=this.args[f].evaluate(a);if(!$e(this.type,Kr(m)))return m;if(f===this.args.length-1)throw new Dr(`Expected value to be of type ${we(this.type)}, but found ${we(Kr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Ul={"to-boolean":bt,"to-color":Rt,"to-number":Fe,"to-string":yt};class Ho{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[0];if(!Ul[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return f.error("Expected one argument.");const b=Ul[m],k=[];for(let S=1;S<a.length;S++){const M=f.parse(a[S],S,Yt);if(!M)return null;k.push(M)}return new Ho(b,k)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let f,m;for(const b of this.args){if(f=b.evaluate(a),m=null,f instanceof sr)return f;if(typeof f=="string"){const k=a.parseColor(f);if(k)return k}else if(Array.isArray(f)&&(m=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:ma(f[0],f[1],f[2],f[3]),!m))return new sr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Dr(m||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const m of this.args){f=m.evaluate(a);const b=$i.parse(f);if(b)return b}throw new Dr(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const m of this.args){f=m.evaluate(a);const b=ho.parse(f);if(b)return b}throw new Dr(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const m of this.args){if(f=m.evaluate(a),f===null)return 0;const b=Number(f);if(!isNaN(b))return b}throw new Dr(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return to.fromString(rl(this.args[0].evaluate(a)));case"resolvedImage":return po.fromString(rl(this.args[0].evaluate(a)));default:return rl(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const il=["Unknown","Point","LineString","Polygon"];class ar{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?il[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let f=this._parseColorCache[a];return f||(f=this._parseColorCache[a]=sr.parse(a)),f}}class Vl{constructor(a,f,m=[],b,k=new Fi,S=[]){this.registry=a,this.path=m,this.key=m.map(M=>`[${M}]`).join(""),this.scope=k,this.errors=S,this.expectedType=b,this._isConstant=f}parse(a,f,m,b,k={}){return f?this.concat(f,m,b)._parse(a,k):this._parse(a,k)}_parse(a,f){function m(b,k,S){return S==="assert"?new no(k,[b]):S==="coerce"?new Ho(k,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const k=this.registry[b];if(k){let S=k.parse(a,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,R=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||R.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(M.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(M,R))return null}else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"assert")}if(!(S instanceof Ss)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const M=new ar;try{S=new Ss(S.type,S.evaluate(M))}catch(R){return this.error(R.message),null}}return S}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,f,m){const b=typeof a=="number"?this.path.concat(a):this.path,k=m?this.scope.concat(m):this.scope;return new Vl(this.registry,this._isConstant,b,f||null,k,this.errors)}error(a,...f){const m=`${this.key}${f.map(b=>`[${b}]`).join("")}`;this.errors.push(new br(m,a))}checkSubtype(a,f){const m=$e(a,f);return m&&this.error(m),m}}class ga{constructor(a,f,m){this.type=vr,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=f}static parse(a,f){if(a.length!==2)return f.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return f.error("Collator options argument must be an object.");const b=f.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,bt);if(!b)return null;const k=f.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,bt);if(!k)return null;let S=null;return m.locale&&(S=f.parse(m.locale,1,yt),!S)?null:new ga(b,k,S)}evaluate(a){return new cc(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const Cs=8192;function ql(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function ol(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function wp(c,a){const f=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(f*b*Cs),Math.round(m*b*Cs)]}function mh(c,a,f){const m=c[0]-a[0],b=c[1]-a[1],k=c[0]-f[0],S=c[1]-f[1];return m*S-k*b==0&&m*k<=0&&b*S<=0}function Hl(c,a){let f=!1;for(let S=0,M=a.length;S<M;S++){const R=a[S];for(let j=0,X=R.length;j<X-1;j++){if(mh(c,R[j],R[j+1]))return!1;(b=R[j])[1]>(m=c)[1]!=(k=R[j+1])[1]>m[1]&&m[0]<(k[0]-b[0])*(m[1]-b[1])/(k[1]-b[1])+b[0]&&(f=!f)}}var m,b,k;return f}function xp(c,a){for(let f=0;f<a.length;f++)if(Hl(c,a[f]))return!0;return!1}function gh(c,a,f,m){const b=m[0]-f[0],k=m[1]-f[1],S=(c[0]-f[0])*k-b*(c[1]-f[1]),M=(a[0]-f[0])*k-b*(a[1]-f[1]);return S>0&&M<0||S<0&&M>0}function Ap(c,a,f){for(const j of f)for(let X=0;X<j.length-1;++X)if((M=[(S=j[X+1])[0]-(k=j[X])[0],S[1]-k[1]])[0]*(R=[(b=a)[0]-(m=c)[0],b[1]-m[1]])[1]-M[1]*R[0]!=0&&gh(m,b,k,S)&&gh(k,S,m,b))return!0;var m,b,k,S,M,R;return!1}function _h(c,a){for(let f=0;f<c.length;++f)if(!Hl(c[f],a))return!1;for(let f=0;f<c.length-1;++f)if(Ap(c[f],c[f+1],a))return!1;return!0}function yh(c,a){for(let f=0;f<a.length;f++)if(_h(c,a[f]))return!0;return!1}function Gl(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=[];for(let S=0;S<c[b].length;S++){const M=wp(c[b][S],f);ql(a,M),k.push(M)}m.push(k)}return m}function vh(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=Gl(c[b],a,f);m.push(k)}return m}function bh(c,a,f,m){if(c[0]<f[0]||c[0]>f[2]){const b=.5*m;let k=c[0]-f[0]>b?-m:f[0]-c[0]>b?m:0;k===0&&(k=c[0]-f[2]>b?-m:f[2]-c[0]>b?m:0),c[0]+=k}ql(a,c)}function Wl(c,a,f,m){const b=Math.pow(2,m.z)*Cs,k=[m.x*Cs,m.y*Cs],S=[];for(const M of c)for(const R of M){const j=[R.x+k[0],R.y+k[1]];bh(j,a,f,b),S.push(j)}return S}function wh(c,a,f,m){const b=Math.pow(2,m.z)*Cs,k=[m.x*Cs,m.y*Cs],S=[];for(const R of c){const j=[];for(const X of R){const Y=[X.x+k[0],X.y+k[1]];ql(a,Y),j.push(Y)}S.push(j)}if(a[2]-a[0]<=b/2){(M=a)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of S)for(const j of R)bh(j,a,f,b)}var M;return S}class Vs{constructor(a,f){this.type=bt,this.geojson=a,this.geometries=f}static parse(a,f){if(a.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Nl(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const b=[];for(const k of m.features){const{type:S,coordinates:M}=k.geometry;S==="Polygon"&&b.push(M),S==="MultiPolygon"&&b.push(...M)}if(b.length)return new Vs(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Vs(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Vs(m,m)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=Gl(m.coordinates,k,S),R=Wl(f.geometry(),b,k,S);if(!ol(b,k))return!1;for(const j of R)if(!Hl(j,M))return!1}if(m.type==="MultiPolygon"){const M=vh(m.coordinates,k,S),R=Wl(f.geometry(),b,k,S);if(!ol(b,k))return!1;for(const j of R)if(!xp(j,M))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=Gl(m.coordinates,k,S),R=wh(f.geometry(),b,k,S);if(!ol(b,k))return!1;for(const j of R)if(!_h(j,M))return!1}if(m.type==="MultiPolygon"){const M=vh(m.coordinates,k,S),R=wh(f.geometry(),b,k,S);if(!ol(b,k))return!1;for(const j of R)if(!yh(j,M))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Zl{constructor(a,f){this.type=f.type,this.name=a,this.boundExpression=f}static parse(a,f){if(a.length!==2||typeof a[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const m=a[1];return f.scope.has(m)?new Zl(m,f.scope.get(m)):f.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class ro{constructor(a,f,m,b){this.name=a,this.type=f,this._evaluate=m,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,f){const m=a[0],b=ro.definitions[m];if(!b)return f.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const k=Array.isArray(b)?b[0]:b.type,S=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=S.filter(([j])=>!Array.isArray(j)||j.length===a.length-1);let R=null;for(const[j,X]of M){R=new Vl(f.registry,sl,f.path,null,f.scope);const Y=[];let se=!1;for(let pe=1;pe<a.length;pe++){const ye=a[pe],be=Array.isArray(j)?j[pe-1]:j.type,Ce=R.parse(ye,1+Y.length,be);if(!Ce){se=!0;break}Y.push(Ce)}if(!se)if(Array.isArray(j)&&j.length!==Y.length)R.error(`Expected ${j.length} arguments, but found ${Y.length} instead.`);else{for(let pe=0;pe<Y.length;pe++){const ye=Array.isArray(j)?j[pe]:j.type,be=Y[pe];R.concat(pe+1).checkSubtype(ye,be.type)}if(R.errors.length===0)return new ro(m,k,X,Y)}}if(M.length===1)f.errors.push(...R.errors);else{const j=(M.length?M:S).map(([Y])=>{return se=Y,Array.isArray(se)?`(${se.map(we).join(", ")})`:`(${we(se.type)}...)`;var se}).join(" | "),X=[];for(let Y=1;Y<a.length;Y++){const se=f.parse(a[Y],1+X.length);if(!se)return null;X.push(we(se.type))}f.error(`Expected arguments of type ${j}, but found (${X.join(", ")}) instead.`)}return null}static register(a,f){ro.definitions=f;for(const m in f)a[m]=ro}}function sl(c){if(c instanceof Zl)return sl(c.boundExpression);if(c instanceof ro&&c.name==="error"||c instanceof ga||c instanceof Vs)return!1;const a=c instanceof Ho||c instanceof no;let f=!0;return c.eachChild(m=>{f=a?f&&sl(m):f&&m instanceof Ss}),!!f&&Xl(c)&&ll(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xl(c){if(c instanceof ro&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Vs)return!1;let a=!0;return c.eachChild(f=>{a&&!Xl(f)&&(a=!1)}),a}function al(c){if(c instanceof ro&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(f=>{a&&!al(f)&&(a=!1)}),a}function ll(c,a){if(c instanceof ro&&a.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(m=>{f&&!ll(m,a)&&(f=!1)}),f}function ul(c,a){const f=c.length-1;let m,b,k=0,S=f,M=0;for(;k<=S;)if(M=Math.floor((k+S)/2),m=c[M],b=c[M+1],m<=a){if(M===f||a<b)return M;k=M+1}else{if(!(m>a))throw new Dr("Input is not a number.");S=M-1}return 0}class cl{constructor(a,f,m){this.type=a,this.input=f,this.labels=[],this.outputs=[];for(const[b,k]of m)this.labels.push(b),this.outputs.push(k)}static parse(a,f){if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");const m=f.parse(a[1],1,Fe);if(!m)return null;const b=[];let k=null;f.expectedType&&f.expectedType.kind!=="value"&&(k=f.expectedType);for(let S=1;S<a.length;S+=2){const M=S===1?-1/0:a[S],R=a[S+1],j=S,X=S+1;if(typeof M!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(b.length&&b[b.length-1][0]>=M)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const Y=f.parse(R,X,k);if(!Y)return null;k=k||Y.type,b.push([M,Y])}return new cl(k,m,b)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;return b>=f[k-1]?m[k-1].evaluate(a):m[ul(f,b)].evaluate(a)}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function kp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Sp=xh;function xh(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}xh.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var Cp=kp(Sp);function qs(c,a,f){return c+f*(a-c)}function Kl(c,a,f){return c.map((m,b)=>qs(m,a[b],f))}const Ei={number:qs,color:function(c,a,f,m="rgb"){switch(m){case"rgb":{const[b,k,S,M]=Kl(c.rgb,a.rgb,f);return new sr(b,k,S,M,!1)}case"hcl":{const[b,k,S,M]=c.hcl,[R,j,X,Y]=a.hcl;let se,pe;if(isNaN(b)||isNaN(R))isNaN(b)?isNaN(R)?se=NaN:(se=R,S!==1&&S!==0||(pe=j)):(se=b,X!==1&&X!==0||(pe=k));else{let Ze=R-b;R>b&&Ze>180?Ze-=360:R<b&&b-R>180&&(Ze+=360),se=b+f*Ze}const[ye,be,Ce,Pe]=function([Ze,Re,Ne,dt]){return Ze=isNaN(Ze)?0:Ze*mn,Or([Ne,Math.cos(Ze)*Re,Math.sin(Ze)*Re,dt])}([se,pe??qs(k,j,f),qs(S,X,f),qs(M,Y,f)]);return new sr(ye,be,Ce,Pe,!1)}case"lab":{const[b,k,S,M]=Or(Kl(c.lab,a.lab,f));return new sr(b,k,S,M,!1)}}},array:Kl,padding:function(c,a,f){return new $i(Kl(c.values,a.values,f))},variableAnchorOffsetCollection:function(c,a,f){const m=c.values,b=a.values;if(m.length!==b.length)throw new Dr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const k=[];for(let S=0;S<m.length;S+=2){if(m[S]!==b[S])throw new Dr(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${m[S]}, to[${S}]: ${b[S]}`);k.push(m[S]);const[M,R]=m[S+1],[j,X]=b[S+1];k.push([qs(M,j,f),qs(R,X,f)])}return new ho(k)}};class Ai{constructor(a,f,m,b,k){this.type=a,this.operator=f,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[S,M]of k)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(a,f,m,b){let k=0;if(a.name==="exponential")k=Yn(f,a.base,m,b);else if(a.name==="linear")k=Yn(f,1,m,b);else if(a.name==="cubic-bezier"){const S=a.controlPoints;k=new Cp(S[0],S[1],S[2],S[3]).solve(Yn(f,1,m,b))}return k}static parse(a,f){let[m,b,k,...S]=a;if(!Array.isArray(b)||b.length===0)return f.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const j=b[1];if(typeof j!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:j}}else{if(b[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const j=b.slice(1);if(j.length!==4||j.some(X=>typeof X!="number"||X<0||X>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:j}}}if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(k=f.parse(k,2,Fe),!k)return null;const M=[];let R=null;m==="interpolate-hcl"||m==="interpolate-lab"?R=Rt:f.expectedType&&f.expectedType.kind!=="value"&&(R=f.expectedType);for(let j=0;j<S.length;j+=2){const X=S[j],Y=S[j+1],se=j+3,pe=j+4;if(typeof X!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(M.length&&M[M.length-1][0]>=X)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);const ye=f.parse(Y,pe,R);if(!ye)return null;R=R||ye.type,M.push([X,ye])}return re(R,Fe)||re(R,Rt)||re(R,Se)||re(R,ce)||re(R,_e(Fe))?new Ai(R,m,b,k,M):f.error(`Type ${we(R)} is not interpolatable.`)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;if(b>=f[k-1])return m[k-1].evaluate(a);const S=ul(f,b),M=Ai.interpolationFactor(this.interpolation,b,f[S],f[S+1]),R=m[S].evaluate(a),j=m[S+1].evaluate(a);switch(this.operator){case"interpolate":return Ei[this.type.kind](R,j,M);case"interpolate-hcl":return Ei.color(R,j,M,"hcl");case"interpolate-lab":return Ei.color(R,j,M,"lab")}}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Yn(c,a,f,m){const b=m-f,k=c-f;return b===0?0:a===1?k/b:(Math.pow(a,k)-1)/(Math.pow(a,b)-1)}class Jl{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expectected at least one argument.");let m=null;const b=f.expectedType;b&&b.kind!=="value"&&(m=b);const k=[];for(const M of a.slice(1)){const R=f.parse(M,1+k.length,m,void 0,{typeAnnotation:"omit"});if(!R)return null;m=m||R.type,k.push(R)}if(!m)throw new Error("No output type");const S=b&&k.some(M=>$e(b,M.type));return new Jl(S?Yt:m,k)}evaluate(a){let f,m=null,b=0;for(const k of this.args)if(b++,m=k.evaluate(a),m&&m instanceof po&&!m.available&&(f||(f=m.name),m=null,b===this.args.length&&(m=f)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class Yl{constructor(a,f){this.type=f.type,this.bindings=[].concat(a),this.result=f}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const f of this.bindings)a(f[1]);a(this.result)}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let k=1;k<a.length-1;k+=2){const S=a[k];if(typeof S!="string")return f.error(`Expected string, but found ${typeof S} instead.`,k);if(/[^a-zA-Z0-9_]/.test(S))return f.error("Variable names must contain only alphanumeric characters or '_'.",k);const M=f.parse(a[k+1],k+1);if(!M)return null;m.push([S,M])}const b=f.parse(a[a.length-1],a.length-1,f.expectedType,m);return b?new Yl(m,b):null}outputDefined(){return this.result.outputDefined()}}class hc{constructor(a,f,m){this.type=a,this.index=f,this.input=m}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Fe),b=f.parse(a[2],2,_e(f.expectedType||Yt));return m&&b?new hc(b.type.itemType,m,b):null}evaluate(a){const f=this.index.evaluate(a),m=this.input.evaluate(a);if(f<0)throw new Dr(`Array index out of bounds: ${f} < 0.`);if(f>=m.length)throw new Dr(`Array index out of bounds: ${f} > ${m.length-1}.`);if(f!==Math.floor(f))throw new Dr(`Array index must be an integer, but found ${f} instead.`);return m[f]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class dc{constructor(a,f){this.type=bt,this.needle=a,this.haystack=f}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Yt),b=f.parse(a[2],2,Yt);return m&&b?je(m.type,[bt,yt,Fe,$n,Yt])?new dc(m,b):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`):null}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!De(f,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${we(Kr(f))} instead.`);if(!De(m,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${we(Kr(m))} instead.`);return m.indexOf(f)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Ql{constructor(a,f,m){this.type=Fe,this.needle=a,this.haystack=f,this.fromIndex=m}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Yt),b=f.parse(a[2],2,Yt);if(!m||!b)return null;if(!je(m.type,[bt,yt,Fe,$n,Yt]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,Fe);return k?new Ql(m,b,k):null}return new Ql(m,b)}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!De(f,["boolean","string","number","null"]))throw new Dr(`Expected first argument to be of type boolean, string, number or null, but found ${we(Kr(f))} instead.`);if(!De(m,["string","array"]))throw new Dr(`Expected second argument to be of type array or string, but found ${we(Kr(m))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(a);return m.indexOf(f,b)}return m.indexOf(f)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class pc{constructor(a,f,m,b,k,S){this.inputType=a,this.type=f,this.input=m,this.cases=b,this.outputs=k,this.otherwise=S}static parse(a,f){if(a.length<5)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return f.error("Expected an even number of arguments.");let m,b;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);const k={},S=[];for(let j=2;j<a.length-1;j+=2){let X=a[j];const Y=a[j+1];Array.isArray(X)||(X=[X]);const se=f.concat(j);if(X.length===0)return se.error("Expected at least one branch label.");for(const ye of X){if(typeof ye!="number"&&typeof ye!="string")return se.error("Branch labels must be numbers or strings.");if(typeof ye=="number"&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ye=="number"&&Math.floor(ye)!==ye)return se.error("Numeric branch labels must be integer values.");if(m){if(se.checkSubtype(m,Kr(ye)))return null}else m=Kr(ye);if(k[String(ye)]!==void 0)return se.error("Branch labels must be unique.");k[String(ye)]=S.length}const pe=f.parse(Y,j,b);if(!pe)return null;b=b||pe.type,S.push(pe)}const M=f.parse(a[1],1,Yt);if(!M)return null;const R=f.parse(a[a.length-1],a.length-1,b);return R?M.type.kind!=="value"&&f.concat(1).checkSubtype(m,M.type)?null:new pc(m,b,M,k,S,R):null}evaluate(a){const f=this.input.evaluate(a);return(Kr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class mc{constructor(a,f,m){this.type=a,this.branches=f,this.otherwise=m}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return f.error("Expected an odd number of arguments.");let m;f.expectedType&&f.expectedType.kind!=="value"&&(m=f.expectedType);const b=[];for(let S=1;S<a.length-1;S+=2){const M=f.parse(a[S],S,bt);if(!M)return null;const R=f.parse(a[S+1],S+1,m);if(!R)return null;b.push([M,R]),m=m||R.type}const k=f.parse(a[a.length-1],a.length-1,m);if(!k)return null;if(!m)throw new Error("Can't infer output type");return new mc(m,b,k)}evaluate(a){for(const[f,m]of this.branches)if(f.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[f,m]of this.branches)a(f),a(m);a(this.otherwise)}outputDefined(){return this.branches.every(([a,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class eu{constructor(a,f,m,b){this.type=a,this.input=f,this.beginIndex=m,this.endIndex=b}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Yt),b=f.parse(a[2],2,Fe);if(!m||!b)return null;if(!je(m.type,[_e(Yt),yt,Yt]))return f.error(`Expected first argument to be of type array or string, but found ${we(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,Fe);return k?new eu(m.type,m,b,k):null}return new eu(m.type,m,b)}evaluate(a){const f=this.input.evaluate(a),m=this.beginIndex.evaluate(a);if(!De(f,["string","array"]))throw new Dr(`Expected first argument to be of type array or string, but found ${we(Kr(f))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(a);return f.slice(m,b)}return f.slice(m)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Ah(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function kh(c,a,f,m){return m.compare(a,f)===0}function _a(c,a,f){const m=c!=="=="&&c!=="!=";return class aw{constructor(k,S,M){this.type=bt,this.lhs=k,this.rhs=S,this.collator=M,this.hasUntypedArgument=k.type.kind==="value"||S.type.kind==="value"}static parse(k,S){if(k.length!==3&&k.length!==4)return S.error("Expected two or three arguments.");const M=k[0];let R=S.parse(k[1],1,Yt);if(!R)return null;if(!Ah(M,R.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${we(R.type)}'.`);let j=S.parse(k[2],2,Yt);if(!j)return null;if(!Ah(M,j.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${we(j.type)}'.`);if(R.type.kind!==j.type.kind&&R.type.kind!=="value"&&j.type.kind!=="value")return S.error(`Cannot compare types '${we(R.type)}' and '${we(j.type)}'.`);m&&(R.type.kind==="value"&&j.type.kind!=="value"?R=new no(j.type,[R]):R.type.kind!=="value"&&j.type.kind==="value"&&(j=new no(R.type,[j])));let X=null;if(k.length===4){if(R.type.kind!=="string"&&j.type.kind!=="string"&&R.type.kind!=="value"&&j.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(X=S.parse(k[3],3,vr),!X)return null}return new aw(R,j,X)}evaluate(k){const S=this.lhs.evaluate(k),M=this.rhs.evaluate(k);if(m&&this.hasUntypedArgument){const R=Kr(S),j=Kr(M);if(R.kind!==j.kind||R.kind!=="string"&&R.kind!=="number")throw new Dr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${R.kind}, ${j.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const R=Kr(S),j=Kr(M);if(R.kind!=="string"||j.kind!=="string")return a(k,S,M)}return this.collator?f(k,S,M,this.collator.evaluate(k)):a(k,S,M)}eachChild(k){k(this.lhs),k(this.rhs),this.collator&&k(this.collator)}outputDefined(){return!0}}}const Tp=_a("==",function(c,a,f){return a===f},kh),Mp=_a("!=",function(c,a,f){return a!==f},function(c,a,f,m){return!kh(0,a,f,m)}),Ep=_a("<",function(c,a,f){return a<f},function(c,a,f,m){return m.compare(a,f)<0}),Lp=_a(">",function(c,a,f){return a>f},function(c,a,f,m){return m.compare(a,f)>0}),Ip=_a("<=",function(c,a,f){return a<=f},function(c,a,f,m){return m.compare(a,f)<=0}),Pp=_a(">=",function(c,a,f){return a>=f},function(c,a,f,m){return m.compare(a,f)>=0});class gc{constructor(a,f,m,b,k){this.type=yt,this.number=a,this.locale=f,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=k}static parse(a,f){if(a.length!==3)return f.error("Expected two arguments.");const m=f.parse(a[1],1,Fe);if(!m)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return f.error("NumberFormat options argument must be an object.");let k=null;if(b.locale&&(k=f.parse(b.locale,1,yt),!k))return null;let S=null;if(b.currency&&(S=f.parse(b.currency,1,yt),!S))return null;let M=null;if(b["min-fraction-digits"]&&(M=f.parse(b["min-fraction-digits"],1,Fe),!M))return null;let R=null;return b["max-fraction-digits"]&&(R=f.parse(b["max-fraction-digits"],1,Fe),!R)?null:new gc(m,k,S,M,R)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class tu{constructor(a){this.type=or,this.sections=a}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return f.error("First argument must be an image or text section.");const b=[];let k=!1;for(let S=1;S<=a.length-1;++S){const M=a[S];if(k&&typeof M=="object"&&!Array.isArray(M)){k=!1;let R=null;if(M["font-scale"]&&(R=f.parse(M["font-scale"],1,Fe),!R))return null;let j=null;if(M["text-font"]&&(j=f.parse(M["text-font"],1,_e(yt)),!j))return null;let X=null;if(M["text-color"]&&(X=f.parse(M["text-color"],1,Rt),!X))return null;const Y=b[b.length-1];Y.scale=R,Y.font=j,Y.textColor=X}else{const R=f.parse(a[S],1,Yt);if(!R)return null;const j=R.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,b.push({content:R,scale:null,font:null,textColor:null})}}return new tu(b)}evaluate(a){return new to(this.sections.map(f=>{const m=f.content.evaluate(a);return Kr(m)===ne?new fc("",m,null,null,null):new fc(rl(m),null,f.scale?f.scale.evaluate(a):null,f.font?f.font.evaluate(a).join(","):null,f.textColor?f.textColor.evaluate(a):null)}))}eachChild(a){for(const f of this.sections)a(f.content),f.scale&&a(f.scale),f.font&&a(f.font),f.textColor&&a(f.textColor)}outputDefined(){return!1}}class _c{constructor(a){this.type=ne,this.input=a}static parse(a,f){if(a.length!==2)return f.error("Expected two arguments.");const m=f.parse(a[1],1,yt);return m?new _c(m):f.error("No image name provided.")}evaluate(a){const f=this.input.evaluate(a),m=po.fromString(f);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(f)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class yc{constructor(a){this.type=Fe,this.input=a}static parse(a,f){if(a.length!==2)return f.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=f.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${we(m.type)} instead.`):new yc(m):null}evaluate(a){const f=this.input.evaluate(a);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Dr(`Expected value to be of type string or array, but found ${we(Kr(f))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const ya={"==":Tp,"!=":Mp,">":Lp,"<":Ep,">=":Pp,"<=":Ip,array:no,at:hc,boolean:no,case:mc,coalesce:Jl,collator:ga,format:tu,image:_c,in:dc,"index-of":Ql,interpolate:Ai,"interpolate-hcl":Ai,"interpolate-lab":Ai,length:yc,let:Yl,literal:Ss,match:pc,number:no,"number-format":gc,object:no,slice:eu,step:cl,string:no,"to-boolean":Ho,"to-color":Ho,"to-number":Ho,"to-string":Ho,var:Zl,within:Vs};function Sh(c,[a,f,m,b]){a=a.evaluate(c),f=f.evaluate(c),m=m.evaluate(c);const k=b?b.evaluate(c):1,S=ma(a,f,m,k);if(S)throw new Dr(S);return new sr(a/255,f/255,m/255,k,!1)}function Ch(c,a){return c in a}function vc(c,a){const f=a[c];return f===void 0?null:f}function Hs(c){return{type:c}}function Th(c){return{result:"success",value:c}}function va(c){return{result:"error",value:c}}function ba(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Mh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function bc(c){return!!c.expression&&c.expression.interpolated}function Xn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function nu(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function zp(c){return c}function Eh(c,a){const f=a.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",b=m||!(m||c.property!==void 0),k=c.type||(bc(a)?"exponential":"interval");if(f||a.type==="padding"){const X=f?sr.parse:$i.parse;(c=zr({},c)).stops&&(c.stops=c.stops.map(Y=>[Y[0],X(Y[1])])),c.default=X(c.default?c.default:a.default)}if(c.colorSpace&&(S=c.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var S;let M,R,j;if(k==="exponential")M=Vn;else if(k==="interval")M=Dp;else if(k==="categorical"){M=Gr,R=Object.create(null);for(const X of c.stops)R[X[0]]=X[1];j=typeof c.stops[0][0]}else{if(k!=="identity")throw new Error(`Unknown function type "${k}"`);M=wc}if(m){const X={},Y=[];for(let ye=0;ye<c.stops.length;ye++){const be=c.stops[ye],Ce=be[0].zoom;X[Ce]===void 0&&(X[Ce]={zoom:Ce,type:c.type,property:c.property,default:c.default,stops:[]},Y.push(Ce)),X[Ce].stops.push([be[0].value,be[1]])}const se=[];for(const ye of Y)se.push([X[ye].zoom,Eh(X[ye],a)]);const pe={name:"linear"};return{kind:"composite",interpolationType:pe,interpolationFactor:Ai.interpolationFactor.bind(void 0,pe),zoomStops:se.map(ye=>ye[0]),evaluate:({zoom:ye},be)=>Vn({stops:se,base:c.base},a,ye).evaluate(ye,be)}}if(b){const X=k==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:Ai.interpolationFactor.bind(void 0,X),zoomStops:c.stops.map(Y=>Y[0]),evaluate:({zoom:Y})=>M(c,a,Y,R,j)}}return{kind:"source",evaluate(X,Y){const se=Y&&Y.properties?Y.properties[c.property]:void 0;return se===void 0?fl(c.default,a.default):M(c,a,se,R,j)}}}function fl(c,a,f){return c!==void 0?c:a!==void 0?a:f!==void 0?f:void 0}function Gr(c,a,f,m,b){return fl(typeof f===b?m[f]:void 0,c.default,a.default)}function Dp(c,a,f){if(Xn(f)!=="number")return fl(c.default,a.default);const m=c.stops.length;if(m===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[m-1][0])return c.stops[m-1][1];const b=ul(c.stops.map(k=>k[0]),f);return c.stops[b][1]}function Vn(c,a,f){const m=c.base!==void 0?c.base:1;if(Xn(f)!=="number")return fl(c.default,a.default);const b=c.stops.length;if(b===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[b-1][0])return c.stops[b-1][1];const k=ul(c.stops.map(X=>X[0]),f),S=function(X,Y,se,pe){const ye=pe-se,be=X-se;return ye===0?0:Y===1?be/ye:(Math.pow(Y,be)-1)/(Math.pow(Y,ye)-1)}(f,m,c.stops[k][0],c.stops[k+1][0]),M=c.stops[k][1],R=c.stops[k+1][1],j=Ei[a.type]||zp;return typeof M.evaluate=="function"?{evaluate(...X){const Y=M.evaluate.apply(void 0,X),se=R.evaluate.apply(void 0,X);if(Y!==void 0&&se!==void 0)return j(Y,se,S,c.colorSpace)}}:j(M,R,S,c.colorSpace)}function wc(c,a,f){switch(a.type){case"color":f=sr.parse(f);break;case"formatted":f=to.fromString(f.toString());break;case"resolvedImage":f=po.fromString(f.toString());break;case"padding":f=$i.parse(f);break;default:Xn(f)===a.type||a.type==="enum"&&a.values[f]||(f=void 0)}return fl(f,c.default,a.default)}ro.register(ya,{error:[{kind:"error"},[yt],(c,[a])=>{throw new Dr(a.evaluate(c))}],typeof:[yt,[Yt],(c,[a])=>we(Kr(a.evaluate(c)))],"to-rgba":[_e(Fe,4),[Rt],(c,[a])=>{const[f,m,b,k]=a.evaluate(c).rgb;return[255*f,255*m,255*b,k]}],rgb:[Rt,[Fe,Fe,Fe],Sh],rgba:[Rt,[Fe,Fe,Fe,Fe],Sh],has:{type:bt,overloads:[[[yt],(c,[a])=>Ch(a.evaluate(c),c.properties())],[[yt,Qt],(c,[a,f])=>Ch(a.evaluate(c),f.evaluate(c))]]},get:{type:Yt,overloads:[[[yt],(c,[a])=>vc(a.evaluate(c),c.properties())],[[yt,Qt],(c,[a,f])=>vc(a.evaluate(c),f.evaluate(c))]]},"feature-state":[Yt,[yt],(c,[a])=>vc(a.evaluate(c),c.featureState||{})],properties:[Qt,[],c=>c.properties()],"geometry-type":[yt,[],c=>c.geometryType()],id:[Yt,[],c=>c.id()],zoom:[Fe,[],c=>c.globals.zoom],"heatmap-density":[Fe,[],c=>c.globals.heatmapDensity||0],"line-progress":[Fe,[],c=>c.globals.lineProgress||0],accumulated:[Yt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Fe,Hs(Fe),(c,a)=>{let f=0;for(const m of a)f+=m.evaluate(c);return f}],"*":[Fe,Hs(Fe),(c,a)=>{let f=1;for(const m of a)f*=m.evaluate(c);return f}],"-":{type:Fe,overloads:[[[Fe,Fe],(c,[a,f])=>a.evaluate(c)-f.evaluate(c)],[[Fe],(c,[a])=>-a.evaluate(c)]]},"/":[Fe,[Fe,Fe],(c,[a,f])=>a.evaluate(c)/f.evaluate(c)],"%":[Fe,[Fe,Fe],(c,[a,f])=>a.evaluate(c)%f.evaluate(c)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(c,[a,f])=>Math.pow(a.evaluate(c),f.evaluate(c))],sqrt:[Fe,[Fe],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))],log2:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[Fe,[Fe],(c,[a])=>Math.sin(a.evaluate(c))],cos:[Fe,[Fe],(c,[a])=>Math.cos(a.evaluate(c))],tan:[Fe,[Fe],(c,[a])=>Math.tan(a.evaluate(c))],asin:[Fe,[Fe],(c,[a])=>Math.asin(a.evaluate(c))],acos:[Fe,[Fe],(c,[a])=>Math.acos(a.evaluate(c))],atan:[Fe,[Fe],(c,[a])=>Math.atan(a.evaluate(c))],min:[Fe,Hs(Fe),(c,a)=>Math.min(...a.map(f=>f.evaluate(c)))],max:[Fe,Hs(Fe),(c,a)=>Math.max(...a.map(f=>f.evaluate(c)))],abs:[Fe,[Fe],(c,[a])=>Math.abs(a.evaluate(c))],round:[Fe,[Fe],(c,[a])=>{const f=a.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[Fe,[Fe],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[Fe,[Fe],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[bt,[yt,Yt],(c,[a,f])=>c.properties()[a.value]===f.value],"filter-id-==":[bt,[Yt],(c,[a])=>c.id()===a.value],"filter-type-==":[bt,[yt],(c,[a])=>c.geometryType()===a.value],"filter-<":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<b}],"filter-id-<":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<m}],"filter->":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>b}],"filter-id->":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>m}],"filter-<=":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<=m}],"filter->=":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>=m}],"filter-has":[bt,[Yt],(c,[a])=>a.value in c.properties()],"filter-has-id":[bt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[bt,[_e(yt)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[bt,[_e(Yt)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[bt,[yt,_e(Yt)],(c,[a,f])=>f.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[bt,[yt,_e(Yt)],(c,[a,f])=>function(m,b,k,S){for(;k<=S;){const M=k+S>>1;if(b[M]===m)return!0;b[M]>m?S=M-1:k=M+1}return!1}(c.properties()[a.value],f.value,0,f.value.length-1)],all:{type:bt,overloads:[[[bt,bt],(c,[a,f])=>a.evaluate(c)&&f.evaluate(c)],[Hs(bt),(c,a)=>{for(const f of a)if(!f.evaluate(c))return!1;return!0}]]},any:{type:bt,overloads:[[[bt,bt],(c,[a,f])=>a.evaluate(c)||f.evaluate(c)],[Hs(bt),(c,a)=>{for(const f of a)if(f.evaluate(c))return!0;return!1}]]},"!":[bt,[bt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[bt,[yt],(c,[a])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(a.evaluate(c))}],upcase:[yt,[yt],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[yt,[yt],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[yt,Hs(Yt),(c,a)=>a.map(f=>rl(f.evaluate(c))).join("")],"resolved-locale":[yt,[vr],(c,[a])=>a.evaluate(c).resolvedLocale()]});class wr{constructor(a,f){var m;this.expression=a,this._warningHistory={},this._evaluator=new ar,this._defaultValue=f?(m=f).type==="color"&&nu(m.default)?new sr(0,0,0,0):m.type==="color"?sr.parse(m.default)||null:m.type==="padding"?$i.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._evaluator.globals=a,this._evaluator.feature=f,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(a,f,m,b,k,S){this._evaluator.globals=a,this._evaluator.feature=f||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Dr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function pr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in ya}function Gs(c,a){const f=new Vl(ya,sl,[],a?function(b){const k={color:Rt,string:yt,number:Fe,enum:yt,boolean:bt,formatted:or,padding:Se,resolvedImage:ne,variableAnchorOffsetCollection:ce};return b.type==="array"?_e(k[b.value]||Yt,b.length):k[b.type]}(a):void 0),m=f.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Th(new wr(m,a)):va(f.errors)}class ru{constructor(a,f){this.kind=a,this._styleExpression=f,this.isStateDependent=a!=="constant"&&!al(f.expression)}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}}class xc{constructor(a,f,m,b){this.kind=a,this.zoomStops=m,this._styleExpression=f,this.isStateDependent=a!=="camera"&&!al(f.expression),this.interpolationType=b}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}interpolationFactor(a,f,m){return this.interpolationType?Ai.interpolationFactor(this.interpolationType,a,f,m):0}}function Lh(c,a){const f=Gs(c,a);if(f.result==="error")return f;const m=f.value.expression,b=Xl(m);if(!b&&!ba(a))return va([new br("","data expressions not supported")]);const k=ll(m,["zoom"]);if(!k&&!Mh(a))return va([new br("","zoom expressions not supported")]);const S=ou(m);return S||k?S instanceof br?va([S]):S instanceof Ai&&!bc(a)?va([new br("",'"interpolate" expressions cannot be used with this property')]):Th(S?new xc(b?"camera":"composite",f.value,S.labels,S instanceof Ai?S.interpolation:void 0):new ru(b?"constant":"source",f.value)):va([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iu{constructor(a,f){this._parameters=a,this._specification=f,zr(this,Eh(this._parameters,this._specification))}static deserialize(a){return new iu(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function ou(c){let a=null;if(c instanceof Yl)a=ou(c.result);else if(c instanceof Jl){for(const f of c.args)if(a=ou(f),a)break}else(c instanceof cl||c instanceof Ai)&&c.input instanceof ro&&c.input.name==="zoom"&&(a=c);return a instanceof br||c.eachChild(f=>{const m=ou(f);m instanceof br?a=m:!a&&m?a=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function su(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!su(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Ih={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function au(c){if(c==null)return{filter:()=>!0,needGeometry:!1};su(c)||(c=uu(c));const a=Gs(c,Ih);if(a.result==="error")throw new Error(a.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,m,b)=>a.value.evaluate(f,m,{},b),needGeometry:lu(c)}}function Ph(c,a){return c<a?-1:c>a?1:0}function lu(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(lu(c[a]))return!0;return!1}function uu(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?Ac(c[1],c[2],"=="):a==="!="?cu(Ac(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Ac(c[1],c[2],a):a==="any"?(f=c.slice(1),["any"].concat(f.map(uu))):a==="all"?["all"].concat(c.slice(1).map(uu)):a==="none"?["all"].concat(c.slice(1).map(uu).map(cu)):a==="in"?zh(c[1],c.slice(2)):a==="!in"?cu(zh(c[1],c.slice(2))):a==="has"?Dh(c[1]):a==="!has"?cu(Dh(c[1])):a!=="within"||c;var f}function Ac(c,a,f){switch(c){case"$type":return[`filter-type-${f}`,a];case"$id":return[`filter-id-${f}`,a];default:return[`filter-${f}`,c,a]}}function zh(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(f=>typeof f!=typeof a[0])?["filter-in-large",c,["literal",a.sort(Ph)]]:["filter-in-small",c,["literal",a]]}}function Dh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function cu(c){return["!",c]}function kc(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let b="[";for(const k of c)b+=`${kc(k)},`;return`${b}]`}const f=Object.keys(c).sort();let m="{";for(let b=0;b<f.length;b++)m+=`${JSON.stringify(f[b])}:${kc(c[f[b]])},`;return`${m}}`}function Rp(c){let a="";for(const f of cn)a+=`/${kc(c[f])}`;return a}function Rh(c){const a=c.value;return a?[new xt(c.key,a,"constants have been deprecated as of v8")]:[]}function $r(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Ts(c){if(Array.isArray(c))return c.map(Ts);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const f in c)a[f]=Ts(c[f]);return a}return $r(c)}function Li(c){const a=c.key,f=c.value,m=c.valueSpec||{},b=c.objectElementValidators||{},k=c.style,S=c.styleSpec,M=c.validateSpec;let R=[];const j=Xn(f);if(j!=="object")return[new xt(a,f,`object expected, ${j} found`)];for(const X in f){const Y=X.split(".")[0],se=m[Y]||m["*"];let pe;if(b[Y])pe=b[Y];else if(m[Y])pe=M;else if(b["*"])pe=b["*"];else{if(!m["*"]){R.push(new xt(a,f[X],`unknown property "${X}"`));continue}pe=M}R=R.concat(pe({key:(a&&`${a}.`)+X,value:f[X],valueSpec:se,style:k,styleSpec:S,object:f,objectKey:X,validateSpec:M},f))}for(const X in m)b[X]||m[X].required&&m[X].default===void 0&&f[X]===void 0&&R.push(new xt(a,f,`missing required property "${X}"`));return R}function Sc(c){const a=c.value,f=c.valueSpec,m=c.style,b=c.styleSpec,k=c.key,S=c.arrayElementValidator||c.validateSpec;if(Xn(a)!=="array")return[new xt(k,a,`array expected, ${Xn(a)} found`)];if(f.length&&a.length!==f.length)return[new xt(k,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new xt(k,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let M={type:f.value,values:f.values};b.$version<7&&(M.function=f.function),Xn(f.value)==="object"&&(M=f.value);let R=[];for(let j=0;j<a.length;j++)R=R.concat(S({array:a,arrayIndex:j,value:a[j],valueSpec:M,validateSpec:c.validateSpec,style:m,styleSpec:b,key:`${k}[${j}]`}));return R}function fu(c){const a=c.key,f=c.value,m=c.valueSpec;let b=Xn(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new xt(a,f,`number expected, ${b} found`)]:"minimum"in m&&f<m.minimum?[new xt(a,f,`${f} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&f>m.maximum?[new xt(a,f,`${f} is greater than the maximum value ${m.maximum}`)]:[]}function Bh(c){const a=c.valueSpec,f=$r(c.value.type);let m,b,k,S={};const M=f!=="categorical"&&c.value.property===void 0,R=!M,j=Xn(c.value.stops)==="array"&&Xn(c.value.stops[0])==="array"&&Xn(c.value.stops[0][0])==="object",X=Li({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(pe){if(f==="identity")return[new xt(pe.key,pe.value,'identity function may not have a "stops" property')];let ye=[];const be=pe.value;return ye=ye.concat(Sc({key:pe.key,value:be,valueSpec:pe.valueSpec,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec,arrayElementValidator:Y})),Xn(be)==="array"&&be.length===0&&ye.push(new xt(pe.key,be,"array must have at least one stop")),ye},default:function(pe){return pe.validateSpec({key:pe.key,value:pe.value,valueSpec:a,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec})}}});return f==="identity"&&M&&X.push(new xt(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||X.push(new xt(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!bc(c.valueSpec)&&X.push(new xt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(R&&!ba(c.valueSpec)?X.push(new xt(c.key,c.value,"property functions not supported")):M&&!Mh(c.valueSpec)&&X.push(new xt(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!j||c.value.property!==void 0||X.push(new xt(c.key,c.value,'"property" property is required')),X;function Y(pe){let ye=[];const be=pe.value,Ce=pe.key;if(Xn(be)!=="array")return[new xt(Ce,be,`array expected, ${Xn(be)} found`)];if(be.length!==2)return[new xt(Ce,be,`array length 2 expected, length ${be.length} found`)];if(j){if(Xn(be[0])!=="object")return[new xt(Ce,be,`object expected, ${Xn(be[0])} found`)];if(be[0].zoom===void 0)return[new xt(Ce,be,"object stop key must have zoom")];if(be[0].value===void 0)return[new xt(Ce,be,"object stop key must have value")];if(k&&k>$r(be[0].zoom))return[new xt(Ce,be[0].zoom,"stop zoom values must appear in ascending order")];$r(be[0].zoom)!==k&&(k=$r(be[0].zoom),b=void 0,S={}),ye=ye.concat(Li({key:`${Ce}[0]`,value:be[0],valueSpec:{zoom:{}},validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec,objectElementValidators:{zoom:fu,value:se}}))}else ye=ye.concat(se({key:`${Ce}[0]`,value:be[0],valueSpec:{},validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec},be));return pr(Ts(be[1]))?ye.concat([new xt(`${Ce}[1]`,be[1],"expressions are not allowed in function stops.")]):ye.concat(pe.validateSpec({key:`${Ce}[1]`,value:be[1],valueSpec:a,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec}))}function se(pe,ye){const be=Xn(pe.value),Ce=$r(pe.value),Pe=pe.value!==null?pe.value:ye;if(m){if(be!==m)return[new xt(pe.key,Pe,`${be} stop domain type must match previous stop domain type ${m}`)]}else m=be;if(be!=="number"&&be!=="string"&&be!=="boolean")return[new xt(pe.key,Pe,"stop domain value must be a number, string, or boolean")];if(be!=="number"&&f!=="categorical"){let Ze=`number expected, ${be} found`;return ba(a)&&f===void 0&&(Ze+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(pe.key,Pe,Ze)]}return f!=="categorical"||be!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?f!=="categorical"&&be==="number"&&b!==void 0&&Ce<b?[new xt(pe.key,Pe,"stop domain values must appear in ascending order")]:(b=Ce,f==="categorical"&&Ce in S?[new xt(pe.key,Pe,"stop domain values must be unique")]:(S[Ce]=!0,[])):[new xt(pe.key,Pe,`integer expected, found ${Ce}`)]}}function Ms(c){const a=(c.expressionContext==="property"?Lh:Gs)(Ts(c.value),c.valueSpec);if(a.result==="error")return a.value.map(m=>new xt(`${c.key}${m.key}`,c.value,m.message));const f=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new xt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!al(f))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!al(f))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!ll(f,["zoom","feature-state"]))return[new xt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Xl(f))return[new xt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Es(c){const a=c.key,f=c.value,m=c.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf($r(f))===-1&&b.push(new xt(a,f,`expected one of [${m.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(m.values).indexOf($r(f))===-1&&b.push(new xt(a,f,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function wa(c){return su(Ts(c.value))?Ms(zr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cc(c)}function Cc(c){const a=c.value,f=c.key;if(Xn(a)!=="array")return[new xt(f,a,`array expected, ${Xn(a)} found`)];const m=c.styleSpec;let b,k=[];if(a.length<1)return[new xt(f,a,"filter array must have at least 1 element")];switch(k=k.concat(Es({key:`${f}[0]`,value:a[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),$r(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&$r(a[1])==="$type"&&k.push(new xt(f,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&k.push(new xt(f,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=Xn(a[1]),b!=="string"&&k.push(new xt(`${f}[1]`,a[1],`string expected, ${b} found`)));for(let S=2;S<a.length;S++)b=Xn(a[S]),$r(a[1])==="$type"?k=k.concat(Es({key:`${f}[${S}]`,value:a[S],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&k.push(new xt(`${f}[${S}]`,a[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)k=k.concat(Cc({key:`${f}[${S}]`,value:a[S],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Xn(a[1]),a.length!==2?k.push(new xt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&k.push(new xt(`${f}[1]`,a[1],`string expected, ${b} found`));break;case"within":b=Xn(a[1]),a.length!==2?k.push(new xt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="object"&&k.push(new xt(`${f}[1]`,a[1],`object expected, ${b} found`))}return k}function hu(c,a){const f=c.key,m=c.validateSpec,b=c.style,k=c.styleSpec,S=c.value,M=c.objectKey,R=k[`${a}_${c.layerType}`];if(!R)return[];const j=M.match(/^(.*)-transition$/);if(a==="paint"&&j&&R[j[1]]&&R[j[1]].transition)return m({key:f,value:S,valueSpec:k.transition,style:b,styleSpec:k});const X=c.valueSpec||R[M];if(!X)return[new xt(f,S,`unknown property "${M}"`)];let Y;if(Xn(S)==="string"&&ba(X)&&!X.tokens&&(Y=/^{([^}]+)}$/.exec(S)))return[new xt(f,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];const se=[];return c.layerType==="symbol"&&(M==="text-field"&&b&&!b.glyphs&&se.push(new xt(f,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&nu(Ts(S))&&$r(S.type)==="identity"&&se.push(new xt(f,S,'"text-font" does not support identity functions'))),se.concat(m({key:c.key,value:S,valueSpec:X,style:b,styleSpec:k,expressionContext:"property",propertyType:a,propertyKey:M}))}function Tc(c){return hu(c,"paint")}function Mc(c){return hu(c,"layout")}function hl(c){let a=[];const f=c.value,m=c.key,b=c.style,k=c.styleSpec;f.type||f.ref||a.push(new xt(m,f,'either "type" or "ref" is required'));let S=$r(f.type);const M=$r(f.ref);if(f.id){const R=$r(f.id);for(let j=0;j<c.arrayIndex;j++){const X=b.layers[j];$r(X.id)===R&&a.push(new xt(m,f.id,`duplicate layer id "${f.id}", previously used at line ${X.id.__line__}`))}}if("ref"in f){let R;["type","source","source-layer","filter","layout"].forEach(j=>{j in f&&a.push(new xt(m,f[j],`"${j}" is prohibited for ref layers`))}),b.layers.forEach(j=>{$r(j.id)===M&&(R=j)}),R?R.ref?a.push(new xt(m,f.ref,"ref cannot reference another ref layer")):S=$r(R.type):a.push(new xt(m,f.ref,`ref layer "${M}" not found`))}else if(S!=="background")if(f.source){const R=b.sources&&b.sources[f.source],j=R&&$r(R.type);R?j==="vector"&&S==="raster"?a.push(new xt(m,f.source,`layer "${f.id}" requires a raster source`)):j!=="raster-dem"&&S==="hillshade"?a.push(new xt(m,f.source,`layer "${f.id}" requires a raster-dem source`)):j==="raster"&&S!=="raster"?a.push(new xt(m,f.source,`layer "${f.id}" requires a vector source`)):j!=="vector"||f["source-layer"]?j==="raster-dem"&&S!=="hillshade"?a.push(new xt(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!f.paint||!f.paint["line-gradient"]||j==="geojson"&&R.lineMetrics||a.push(new xt(m,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new xt(m,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new xt(m,f.source,`source "${f.source}" not found`))}else a.push(new xt(m,f,'missing required property "source"'));return a=a.concat(Li({key:m,value:f,valueSpec:k.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:f.type,valueSpec:k.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:wa,layout:R=>Li({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":j=>Mc(zr({layerType:S},j))}}),paint:R=>Li({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":j=>Tc(zr({layerType:S},j))}})}})),a}function Ws(c){const a=c.value,f=c.key,m=Xn(a);return m!=="string"?[new xt(f,a,`string expected, ${m} found`)]:[]}const Fh={promoteId:function({key:c,value:a}){if(Xn(a)==="string")return Ws({key:c,value:a});{const f=[];for(const m in a)f.push(...Ws({key:`${c}.${m}`,value:a[m]}));return f}}};function Oh(c){const a=c.value,f=c.key,m=c.styleSpec,b=c.style,k=c.validateSpec;if(!a.type)return[new xt(f,a,'"type" is required')];const S=$r(a.type);let M;switch(S){case"vector":case"raster":return M=Li({key:f,value:a,valueSpec:m[`source_${S.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:Fh,validateSpec:k}),M;case"raster-dem":return M=function(R){var j;const X=(j=R.sourceName)!==null&&j!==void 0?j:"",Y=R.value,se=R.styleSpec,pe=se.source_raster_dem,ye=R.style;let be=[];const Ce=Xn(Y);if(Y===void 0)return be;if(Ce!=="object")return be.push(new xt("source_raster_dem",Y,`object expected, ${Ce} found`)),be;const Pe=$r(Y.encoding)==="custom",Ze=["redFactor","greenFactor","blueFactor","baseShift"],Re=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Ne in Y)!Pe&&Ze.includes(Ne)?be.push(new xt(Ne,Y[Ne],`In "${X}": "${Ne}" is only valid when "encoding" is set to "custom". ${Re} encoding found`)):pe[Ne]?be=be.concat(R.validateSpec({key:Ne,value:Y[Ne],valueSpec:pe[Ne],validateSpec:R.validateSpec,style:ye,styleSpec:se})):be.push(new xt(Ne,Y[Ne],`unknown property "${Ne}"`));return be}({sourceName:f,value:a,style:c.style,styleSpec:m,validateSpec:k}),M;case"geojson":if(M=Li({key:f,value:a,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:k,objectElementValidators:Fh}),a.cluster)for(const R in a.clusterProperties){const[j,X]=a.clusterProperties[R],Y=typeof j=="string"?[j,["accumulated"],["get",R]]:j;M.push(...Ms({key:`${f}.${R}.map`,value:X,validateSpec:k,expressionContext:"cluster-map"})),M.push(...Ms({key:`${f}.${R}.reduce`,value:Y,validateSpec:k,expressionContext:"cluster-reduce"}))}return M;case"video":return Li({key:f,value:a,valueSpec:m.source_video,style:b,validateSpec:k,styleSpec:m});case"image":return Li({key:f,value:a,valueSpec:m.source_image,style:b,validateSpec:k,styleSpec:m});case"canvas":return[new xt(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Es({key:`${f}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:k,styleSpec:m})}}function $h(c){const a=c.value,f=c.styleSpec,m=f.light,b=c.style;let k=[];const S=Xn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new xt("light",a,`object expected, ${S} found`)]),k;for(const M in a){const R=M.match(/^(.*)-transition$/);k=k.concat(R&&m[R[1]]&&m[R[1]].transition?c.validateSpec({key:M,value:a[M],valueSpec:f.transition,validateSpec:c.validateSpec,style:b,styleSpec:f}):m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new xt(M,a[M],`unknown property "${M}"`)])}return k}function Nh(c){const a=c.value,f=c.styleSpec,m=f.sky,b=c.style,k=Xn(a);if(a===void 0)return[];if(k!=="object")return[new xt("sky",a,`object expected, ${k} found`)];let S=[];for(const M in a)S=S.concat(m[M]?Go({key:M,value:a[M],valueSpec:m[M],style:b,styleSpec:f}):[new xt(M,a[M],`unknown property "${M}"`)]);return S}function dl(c){const a=c.value,f=c.styleSpec,m=f.terrain,b=c.style;let k=[];const S=Xn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new xt("terrain",a,`object expected, ${S} found`)]),k;for(const M in a)k=k.concat(m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new xt(M,a[M],`unknown property "${M}"`)]);return k}function pl(c){let a=[];const f=c.value,m=c.key;if(Array.isArray(f)){const b=[],k=[];for(const S in f)f[S].id&&b.includes(f[S].id)&&a.push(new xt(m,f,`all the sprites' ids must be unique, but ${f[S].id} is duplicated`)),b.push(f[S].id),f[S].url&&k.includes(f[S].url)&&a.push(new xt(m,f,`all the sprites' URLs must be unique, but ${f[S].url} is duplicated`)),k.push(f[S].url),a=a.concat(Li({key:`${m}[${S}]`,value:f[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return Ws({key:m,value:f})}const Ni={"*":()=>[],array:Sc,boolean:function(c){const a=c.value,f=c.key,m=Xn(a);return m!=="boolean"?[new xt(f,a,`boolean expected, ${m} found`)]:[]},number:fu,color:function(c){const a=c.key,f=c.value,m=Xn(f);return m!=="string"?[new xt(a,f,`color expected, ${m} found`)]:sr.parse(String(f))?[]:[new xt(a,f,`color expected, "${f}" found`)]},constants:Rh,enum:Es,filter:wa,function:Bh,layer:hl,object:Li,source:Oh,light:$h,sky:Nh,terrain:dl,string:Ws,formatted:function(c){return Ws(c).length===0?[]:Ms(c)},resolvedImage:function(c){return Ws(c).length===0?[]:Ms(c)},padding:function(c){const a=c.key,f=c.value;if(Xn(f)==="array"){if(f.length<1||f.length>4)return[new xt(a,f,`padding requires 1 to 4 values; ${f.length} values found`)];const m={type:"number"};let b=[];for(let k=0;k<f.length;k++)b=b.concat(c.validateSpec({key:`${a}[${k}]`,value:f[k],validateSpec:c.validateSpec,valueSpec:m}));return b}return fu({key:a,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,f=c.value,m=Xn(f),b=c.styleSpec;if(m!=="array"||f.length<1||f.length%2!=0)return[new xt(a,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let k=[];for(let S=0;S<f.length;S+=2)k=k.concat(Es({key:`${a}[${S}]`,value:f[S],valueSpec:b.layout_symbol["text-anchor"]})),k=k.concat(Sc({key:`${a}[${S+1}]`,value:f[S+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:b}));return k},sprite:pl};function Go(c){const a=c.value,f=c.valueSpec,m=c.styleSpec;return c.validateSpec=Go,f.expression&&nu($r(a))?Bh(c):f.expression&&pr(Ts(a))?Ms(c):f.type&&Ni[f.type]?Ni[f.type](c):Li(zr({},c,{valueSpec:f.type?m[f.type]:f}))}function Ec(c){const a=c.value,f=c.key,m=Ws(c);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new xt(f,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new xt(f,a,'"glyphs" url must include a "{range}" token'))),m}function Co(c,a=de){let f=[];return f=f.concat(Go({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:Go,objectElementValidators:{glyphs:Ec,"*":()=>[]}})),c.constants&&(f=f.concat(Rh({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:Go}))),xa(f)}function Wo(c){return function(a){return c({...a,validateSpec:Go})}}function xa(c){return[].concat(c).sort((a,f)=>a.line-f.line)}function To(c){return function(...a){return xa(c.apply(this,a))}}Co.source=To(Wo(Oh)),Co.sprite=To(Wo(pl)),Co.glyphs=To(Wo(Ec)),Co.light=To(Wo($h)),Co.sky=To(Wo(Nh)),Co.terrain=To(Wo(dl)),Co.layer=To(Wo(hl)),Co.filter=To(Wo(wa)),Co.paintProperty=To(Wo(Tc)),Co.layoutProperty=To(Wo(Mc));const Zs=Co,Bp=Zs.light,Lc=Zs.paintProperty,Fp=Zs.layoutProperty;function Aa(c,a){let f=!1;if(a&&a.length)for(const m of a)c.fire(new At(new Error(m.message))),f=!0;return f}class ml{constructor(a,f,m){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const S=new Int32Array(this.arrayBuffer);a=S[0],this.d=(f=S[1])+2*(m=S[2]);for(let R=0;R<this.d*this.d;R++){const j=S[3+R],X=S[3+R+1];b.push(j===X?null:S.subarray(j,X))}const M=S[3+b.length+1];this.keys=S.subarray(S[3+b.length],M),this.bboxes=S.subarray(M),this.insert=this._insertReadonly}else{this.d=f+2*m;for(let S=0;S<this.d*this.d;S++)b.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=a,this.padding=m,this.scale=f/a,this.uid=0;const k=m/f*a;this.min=-k,this.max=a+k}insert(a,f,m,b,k){this._forEachCell(f,m,b,k,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(k)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,f,m,b,k,S){this.cells[k].push(S)}query(a,f,m,b,k){const S=this.min,M=this.max;if(a<=S&&f<=S&&M<=m&&M<=b&&!k)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(a,f,m,b,this._queryCell,R,{},k),R}}_queryCell(a,f,m,b,k,S,M,R){const j=this.cells[k];if(j!==null){const X=this.keys,Y=this.bboxes;for(let se=0;se<j.length;se++){const pe=j[se];if(M[pe]===void 0){const ye=4*pe;(R?R(Y[ye+0],Y[ye+1],Y[ye+2],Y[ye+3]):a<=Y[ye+2]&&f<=Y[ye+3]&&m>=Y[ye+0]&&b>=Y[ye+1])?(M[pe]=!0,S.push(X[pe])):M[pe]=!1}}}}_forEachCell(a,f,m,b,k,S,M,R){const j=this._convertToCellCoord(a),X=this._convertToCellCoord(f),Y=this._convertToCellCoord(m),se=this._convertToCellCoord(b);for(let pe=j;pe<=Y;pe++)for(let ye=X;ye<=se;ye++){const be=this.d*ye+pe;if((!R||R(this._convertFromCellCoord(pe),this._convertFromCellCoord(ye),this._convertFromCellCoord(pe+1),this._convertFromCellCoord(ye+1)))&&k.call(this,a,f,m,b,be,S,M,R))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,f=3+this.cells.length+1+1;let m=0;for(let S=0;S<this.cells.length;S++)m+=this.cells[S].length;const b=new Int32Array(f+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let k=f;for(let S=0;S<a.length;S++){const M=a[S];b[3+S]=k,b.set(M,k),k+=M.length}return b[3+a.length]=k,b.set(this.keys,k),k+=this.keys.length,b[3+a.length+1]=k,b.set(this.bboxes,k),k+=this.bboxes.length,b.buffer}static serialize(a,f){const m=a.toArrayBuffer();return f&&f.push(m),{buffer:m}}static deserialize(a){return new ml(a.buffer)}}const Zo={};function Zt(c,a,f={}){if(Zo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),Zo[c]={klass:a,omit:f.omit||[],shallow:f.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",ml),Zt("Color",sr),Zt("Error",Error),Zt("AJAXError",un),Zt("ResolvedImage",po),Zt("StylePropertyFunction",iu),Zt("StyleExpression",wr,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",xc),Zt("ZoomConstantExpression",ru),Zt("CompoundExpression",ro,{omit:["_evaluate"]});for(const c in ya)ya[c]._classRegistryKey||Zt(`Expression_${c}`,ya[c]);function du(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ka(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(du(c)||Ie(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return a&&a.push(f.buffer),f}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const m of c)f.push(ka(m,a));return f}if(typeof c=="object"){const f=c.constructor,m=f._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${f.name}`);if(!Zo[m])throw new Error(`${m} is not registered.`);const b=f.serialize?f.serialize(c,a):{};if(f.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const k in c){if(!c.hasOwnProperty(k)||Zo[m].omit.indexOf(k)>=0)continue;const S=c[k];b[k]=Zo[m].shallow.indexOf(k)>=0?S:ka(S,a)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(b.$name=m),b}throw new Error("can't serialize object of type "+typeof c)}function Sa(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||du(c)||Ie(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Sa);if(typeof c=="object"){const a=c.$name||"Object";if(!Zo[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:f}=Zo[a];if(!f)throw new Error(`can't deserialize unregistered class ${a}`);if(f.deserialize)return f.deserialize(c);const m=Object.create(f.prototype);for(const b of Object.keys(c)){if(b==="$name")continue;const k=c[b];m[b]=Zo[a].shallow.indexOf(b)>=0?k:Sa(k)}return m}throw new Error("can't deserialize object of type "+typeof c)}class jh{constructor(){this.first=!0}update(a,f){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=f),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Ca(c){for(const a of c)if(pu(a.charCodeAt(0)))return!0;return!1}function Uh(c){for(const a of c)if(!Vh(a.charCodeAt(0)))return!1;return!0}function Vh(c){return!(Vt.Arabic(c)||Vt["Arabic Supplement"](c)||Vt["Arabic Extended-A"](c)||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c))}function pu(c){return!(c!==746&&c!==747&&(c<4352||!(Vt["Bopomofo Extended"](c)||Vt.Bopomofo(c)||Vt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Vt["CJK Compatibility Ideographs"](c)||Vt["CJK Compatibility"](c)||Vt["CJK Radicals Supplement"](c)||Vt["CJK Strokes"](c)||!(!Vt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Vt["CJK Unified Ideographs Extension A"](c)||Vt["CJK Unified Ideographs"](c)||Vt["Enclosed CJK Letters and Months"](c)||Vt["Hangul Compatibility Jamo"](c)||Vt["Hangul Jamo Extended-A"](c)||Vt["Hangul Jamo Extended-B"](c)||Vt["Hangul Jamo"](c)||Vt["Hangul Syllables"](c)||Vt.Hiragana(c)||Vt["Ideographic Description Characters"](c)||Vt.Kanbun(c)||Vt["Kangxi Radicals"](c)||Vt["Katakana Phonetic Extensions"](c)||Vt.Katakana(c)&&c!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Vt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](c)||Vt["Unified Canadian Aboriginal Syllabics Extended"](c)||Vt["Vertical Forms"](c)||Vt["Yijing Hexagram Symbols"](c)||Vt["Yi Syllables"](c)||Vt["Yi Radicals"](c))))}function Ic(c){return!(pu(c)||function(a){return!!(Vt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Vt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Vt["Letterlike Symbols"](a)||Vt["Number Forms"](a)||Vt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Vt["Control Pictures"](a)&&a!==9251||Vt["Optical Character Recognition"](a)||Vt["Enclosed Alphanumerics"](a)||Vt["Geometric Shapes"](a)||Vt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Vt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Vt["CJK Symbols and Punctuation"](a)||Vt.Katakana(a)||Vt["Private Use Area"](a)||Vt["CJK Compatibility Forms"](a)||Vt["Small Form Variants"](a)||Vt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function mu(c){return c>=1424&&c<=2303||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c)}function qh(c,a){return!(!a&&mu(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Vt.Khmer(c))}function Op(c){for(const a of c)if(mu(a.charCodeAt(0)))return!0;return!1}const Ls=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Er{constructor(a,f){this.zoom=a,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new jh,this.transition={})}isSupportedScript(a){return function(f,m){for(const b of f)if(!qh(b.charCodeAt(0),m))return!1;return!0}(a,Ls.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,f=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*f}}}class gl{constructor(a,f){this.property=a,this.value=f,this.expression=function(m,b){if(nu(m))return new iu(m,b);if(pr(m)){const k=Lh(m,b);if(k.result==="error")throw new Error(k.value.map(S=>`${S.key}: ${S.message}`).join(", "));return k.value}{let k=m;return b.type==="color"&&typeof m=="string"?k=sr.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(k=ho.parse(m)):k=$i.parse(m),{kind:"constant",evaluate:()=>k}}}(f===void 0?a.specification.default:f,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,f,m){return this.property.possiblyEvaluate(this,a,f,m)}}class gu{constructor(a){this.property=a,this.value=new gl(a,void 0)}transitioned(a,f){return new Hh(this.property,this.value,f,q({},a.transition,this.transition),a.now)}untransitioned(){return new Hh(this.property,this.value,null,{},0)}}class Pc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return ee(this._values[a].value.value)}setValue(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new gu(this._values[a].property)),this._values[a].value=new gl(this._values[a].property,f===null?void 0:ee(f))}getTransition(a){return ee(this._values[a].transition)}setTransition(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new gu(this._values[a].property)),this._values[a].transition=ee(f)||void 0}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m);const b=this.getTransition(f);b!==void 0&&(a[`${f}-transition`]=b)}return a}transitioned(a,f){const m=new Gh(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(a,f._values[b]);return m}untransitioned(){const a=new Gh(this._properties);for(const f of Object.keys(this._values))a._values[f]=this._values[f].untransitioned();return a}}class Hh{constructor(a,f,m,b,k){this.property=a,this.value=f,this.begin=k+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(a,f,m){const b=a.now||0,k=this.value.possiblyEvaluate(a,f,m),S=this.prior;if(S){if(b>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(b<this.begin)return S.possiblyEvaluate(a,f,m);{const M=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,f,m),k,function(R){if(R<=0)return 0;if(R>=1)return 1;const j=R*R,X=j*R;return 4*(R<.5?X:3*(R-j)+X-.75)}(M))}}return k}}class Gh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,f,m){const b=new _l(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Wh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return ee(this._values[a].value)}setValue(a,f){this._values[a]=new gl(this._values[a].property,f===null?void 0:ee(f))}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m)}return a}possiblyEvaluate(a,f,m){const b=new _l(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}}class Mo{constructor(a,f,m){this.property=a,this.value=f,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,f,m,b){return this.property.evaluate(this.value,this.parameters,a,f,m,b)}}class _l{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class sn{constructor(a){this.specification=a}possiblyEvaluate(a,f){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(f)}interpolate(a,f,m){const b=Ei[this.specification.type];return b?b(a,f,m):a}}class hn{constructor(a,f){this.specification=a,this.overrides=f}possiblyEvaluate(a,f,m,b){return new Mo(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(f,null,{},m,b)}:a.expression,f)}interpolate(a,f,m){if(a.value.kind!=="constant"||f.value.kind!=="constant")return a;if(a.value.value===void 0||f.value.value===void 0)return new Mo(this,{kind:"constant",value:void 0},a.parameters);const b=Ei[this.specification.type];if(b){const k=b(a.value.value,f.value.value,m);return new Mo(this,{kind:"constant",value:k},a.parameters)}return a}evaluate(a,f,m,b,k,S){return a.kind==="constant"?a.value:a.evaluate(f,m,b,k,S)}}class _u extends hn{possiblyEvaluate(a,f,m,b){if(a.value===void 0)return new Mo(this,{kind:"constant",value:void 0},f);if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b),S=a.property.specification.type==="resolvedImage"&&typeof k!="string"?k.name:k,M=this._calculate(S,S,S,f);return new Mo(this,{kind:"constant",value:M},f)}if(a.expression.kind==="camera"){const k=this._calculate(a.expression.evaluate({zoom:f.zoom-1}),a.expression.evaluate({zoom:f.zoom}),a.expression.evaluate({zoom:f.zoom+1}),f);return new Mo(this,{kind:"constant",value:k},f)}return new Mo(this,a.expression,f)}evaluate(a,f,m,b,k,S){if(a.kind==="source"){const M=a.evaluate(f,m,b,k,S);return this._calculate(M,M,M,f)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(f.zoom)-1},m,b),a.evaluate({zoom:Math.floor(f.zoom)},m,b),a.evaluate({zoom:Math.floor(f.zoom)+1},m,b),f):a.value}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class yl{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b);return this._calculate(k,k,k,f)}return this._calculate(a.expression.evaluate(new Er(Math.floor(f.zoom-1),f)),a.expression.evaluate(new Er(Math.floor(f.zoom),f)),a.expression.evaluate(new Er(Math.floor(f.zoom+1),f)),f)}}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class zc{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){return!!a.expression.evaluate(f,null,{},m,b)}interpolate(){return!1}}class ji{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in a){const m=a[f];m.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new gl(m,void 0),k=this.defaultTransitionablePropertyValues[f]=new gu(m);this.defaultTransitioningPropertyValues[f]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}}}Zt("DataDrivenProperty",hn),Zt("DataConstantProperty",sn),Zt("CrossFadedDataDrivenProperty",_u),Zt("CrossFadedProperty",yl),Zt("ColorRampProperty",zc);const Dc="-transition";class Eo extends nt{constructor(a,f){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),f.layout&&(this._unevaluatedLayout=new Wh(f.layout)),f.paint)){this._transitionablePaint=new Pc(f.paint);for(const m in a.paint)this.setPaintProperty(m,a.paint[m],{validate:!1});for(const m in a.layout)this.setLayoutProperty(m,a.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _l(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,f,m={}){f!=null&&this._validate(Fp,`layers.${this.id}.layout.${a}`,a,f,m)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,f):this.visibility=f)}getPaintProperty(a){return a.endsWith(Dc)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,f,m={}){if(f!=null&&this._validate(Lc,`layers.${this.id}.paint.${a}`,a,f,m))return!1;if(a.endsWith(Dc))return this._transitionablePaint.setTransition(a.slice(0,-11),f||void 0),!1;{const b=this._transitionablePaint._values[a],k=b.property.specification["property-type"]==="cross-faded-data-driven",S=b.value.isDataDriven(),M=b.value;this._transitionablePaint.setValue(a,f),this._handleSpecialPaintPropertyUpdate(a);const R=this._transitionablePaint._values[a].value;return R.isDataDriven()||S||k||this._handleOverridablePaintPropertyUpdate(a,M,R)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,f,m){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,f){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,f)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Ee(a,(f,m)=>!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length))}_validate(a,f,m,b,k={}){return(!k||k.validate!==!1)&&Aa(this,a.call(Zs,{key:f,layerType:this.type,objectKey:m,value:b,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const f=this.paint.get(a);if(f instanceof Mo&&ba(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Zh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vl{constructor(a,f){this._structArray=a,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,f){return a._trim(),f&&(a.isTransferred=!0,f.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const f=Object.create(this.prototype);return f.arrayBuffer=a.arrayBuffer,f.length=a.length,f.capacity=a.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wr(c,a=1){let f=0,m=0;return{members:c.map(b=>{const k=Zh[b.type].BYTES_PER_ELEMENT,S=f=Xh(f,Math.max(a,k)),M=b.components||1;return m=Math.max(m,k),f+=k*M,{name:b.name,type:b.type,components:M,offset:S}}),size:Xh(f,Math.max(m,a)),alignment:a}}function Xh(c,a){return Math.ceil(c/a)*a}class bl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.int16[b+0]=f,this.int16[b+1]=m,a}}bl.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",bl);class cs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.int16[k+0]=f,this.int16[k+1]=m,this.int16[k+2]=b,a}}cs.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",cs);class Rc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.int16[S+0]=f,this.int16[S+1]=m,this.int16[S+2]=b,this.int16[S+3]=k,a}}Rc.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Rc);class Bc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const R=6*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.int16[R+2]=b,this.int16[R+3]=k,this.int16[R+4]=S,this.int16[R+5]=M,a}}Bc.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Bc);class Fc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const R=4*a,j=8*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.uint8[j+4]=b,this.uint8[j+5]=k,this.uint8[j+6]=S,this.uint8[j+7]=M,a}}Fc.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Fc);class wl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.float32[b+0]=f,this.float32[b+1]=m,a}}wl.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",wl);class yu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,f,m,b,k,S,M,R,j,X)}emplace(a,f,m,b,k,S,M,R,j,X,Y){const se=10*a;return this.uint16[se+0]=f,this.uint16[se+1]=m,this.uint16[se+2]=b,this.uint16[se+3]=k,this.uint16[se+4]=S,this.uint16[se+5]=M,this.uint16[se+6]=R,this.uint16[se+7]=j,this.uint16[se+8]=X,this.uint16[se+9]=Y,a}}yu.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",yu);class Oc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X,Y,se){const pe=this.length;return this.resize(pe+1),this.emplace(pe,a,f,m,b,k,S,M,R,j,X,Y,se)}emplace(a,f,m,b,k,S,M,R,j,X,Y,se,pe){const ye=12*a;return this.int16[ye+0]=f,this.int16[ye+1]=m,this.int16[ye+2]=b,this.int16[ye+3]=k,this.uint16[ye+4]=S,this.uint16[ye+5]=M,this.uint16[ye+6]=R,this.uint16[ye+7]=j,this.int16[ye+8]=X,this.int16[ye+9]=Y,this.int16[ye+10]=se,this.int16[ye+11]=pe,a}}Oc.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Oc);class $c extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.float32[k+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}$c.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",$c);class fs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint32[1*a+0]=f,a}}fs.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",fs);class vu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j){const X=this.length;return this.resize(X+1),this.emplace(X,a,f,m,b,k,S,M,R,j)}emplace(a,f,m,b,k,S,M,R,j,X){const Y=10*a,se=5*a;return this.int16[Y+0]=f,this.int16[Y+1]=m,this.int16[Y+2]=b,this.int16[Y+3]=k,this.int16[Y+4]=S,this.int16[Y+5]=M,this.uint32[se+3]=R,this.uint16[Y+8]=j,this.uint16[Y+9]=X,a}}vu.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",vu);class xl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const R=6*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.int16[R+2]=b,this.int16[R+3]=k,this.int16[R+4]=S,this.int16[R+5]=M,a}}xl.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",xl);class bu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b,k)}emplace(a,f,m,b,k,S){const M=4*a,R=8*a;return this.float32[M+0]=f,this.float32[M+1]=m,this.float32[M+2]=b,this.int16[R+6]=k,this.int16[R+7]=S,a}}bu.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",bu);class Al extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=12*a,M=3*a;return this.uint8[S+0]=f,this.uint8[S+1]=m,this.float32[M+1]=b,this.float32[M+2]=k,a}}Al.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",Al);class wu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[k+0]=f,this.uint16[k+1]=m,this.uint16[k+2]=b,a}}wu.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",wu);class Ta extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be,Ce,Pe){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be,Ce,Pe)}emplace(a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be,Ce,Pe,Ze){const Re=24*a,Ne=12*a,dt=48*a;return this.int16[Re+0]=f,this.int16[Re+1]=m,this.uint16[Re+2]=b,this.uint16[Re+3]=k,this.uint32[Ne+2]=S,this.uint32[Ne+3]=M,this.uint32[Ne+4]=R,this.uint16[Re+10]=j,this.uint16[Re+11]=X,this.uint16[Re+12]=Y,this.float32[Ne+7]=se,this.float32[Ne+8]=pe,this.uint8[dt+36]=ye,this.uint8[dt+37]=be,this.uint8[dt+38]=Ce,this.uint32[Ne+10]=Pe,this.int16[Re+22]=Ze,a}}Ta.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ta);class Xs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be,Ce,Pe,Ze,Re,Ne,dt,vt,Ht,tn,qt,Ut,Ft,Xt){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be,Ce,Pe,Ze,Re,Ne,dt,vt,Ht,tn,qt,Ut,Ft,Xt)}emplace(a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be,Ce,Pe,Ze,Re,Ne,dt,vt,Ht,tn,qt,Ut,Ft,Xt,Nt){const It=32*a,fn=16*a;return this.int16[It+0]=f,this.int16[It+1]=m,this.int16[It+2]=b,this.int16[It+3]=k,this.int16[It+4]=S,this.int16[It+5]=M,this.int16[It+6]=R,this.int16[It+7]=j,this.uint16[It+8]=X,this.uint16[It+9]=Y,this.uint16[It+10]=se,this.uint16[It+11]=pe,this.uint16[It+12]=ye,this.uint16[It+13]=be,this.uint16[It+14]=Ce,this.uint16[It+15]=Pe,this.uint16[It+16]=Ze,this.uint16[It+17]=Re,this.uint16[It+18]=Ne,this.uint16[It+19]=dt,this.uint16[It+20]=vt,this.uint16[It+21]=Ht,this.uint16[It+22]=tn,this.uint32[fn+12]=qt,this.float32[fn+13]=Ut,this.float32[fn+14]=Ft,this.uint16[It+30]=Xt,this.uint16[It+31]=Nt,a}}Xs.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Xs);class xu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.float32[1*a+0]=f,a}}xu.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",xu);class Au extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[6*a+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}Au.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",Au);class Ks extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=4*a;return this.uint32[2*a+0]=f,this.uint16[k+2]=m,this.uint16[k+3]=b,a}}Ks.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Ks);class Nc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.uint16[b+0]=f,this.uint16[b+1]=m,a}}Nc.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",Nc);class jc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint16[1*a+0]=f,a}}jc.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",jc);class ku extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.float32[S+0]=f,this.float32[S+1]=m,this.float32[S+2]=b,this.float32[S+3]=k,a}}ku.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",ku);class Kh extends vl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}Kh.prototype.size=20;class w extends vu{get(a){return new Kh(this,a)}}Zt("CollisionBoxArray",w);class l extends vl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class d extends Ta{get(a){return new l(this,a)}}Zt("PlacedSymbolArray",d);class y extends vl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}y.prototype.size=64;class v extends Xs{get(a){return new y(this,a)}}Zt("SymbolInstanceArray",v);class A extends xu{getoffsetX(a){return this.float32[1*a+0]}}Zt("GlyphOffsetArray",A);class P extends cs{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Zt("SymbolLineVertexArray",P);class D extends vl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}D.prototype.size=12;class $ extends Au{get(a){return new D(this,a)}}Zt("TextAnchorOffsetArray",$);class Z extends vl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class Q extends Ks{get(a){return new Z(this,a)}}Zt("FeatureIndexArray",Q);class te extends bl{}class ge extends bl{}class ke extends bl{}class Ae extends Bc{}class Te extends Fc{}class ve extends wl{}class Be extends yu{}class et extends Oc{}class Le extends $c{}class Ve extends fs{}class it extends xl{}class ot extends Al{}class ft extends wu{}class Ct extends Nc{}const wt=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bt}=wt;class Ot{constructor(a=[]){this.segments=a}prepareSegment(a,f,m,b){let k=this.segments[this.segments.length-1];return a>Ot.MAX_VERTEX_ARRAY_LENGTH&&xe(`Max vertices per segment is ${Ot.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!k||k.vertexLength+a>Ot.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==b)&&(k={vertexOffset:f.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(k.sortKey=b),this.segments.push(k)),k}get(){return this.segments}destroy(){for(const a of this.segments)for(const f in a.vaos)a.vaos[f].destroy()}static simpleSegment(a,f,m,b){return new Ot([{vertexOffset:a,primitiveOffset:f,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function kn(c,a){return 256*(c=K(Math.floor(c),0,255))+K(Math.floor(a),0,255)}Ot.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Ot);const $t=Wr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gn={exports:{}},Sn={exports:{}};Sn.exports=function(c,a){var f,m,b,k,S,M,R,j;for(m=c.length-(f=3&c.length),b=a,S=3432918353,M=461845907,j=0;j<m;)R=255&c.charCodeAt(j)|(255&c.charCodeAt(++j))<<8|(255&c.charCodeAt(++j))<<16|(255&c.charCodeAt(++j))<<24,++j,b=27492+(65535&(k=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(R=0,f){case 3:R^=(255&c.charCodeAt(j+2))<<16;case 2:R^=(255&c.charCodeAt(j+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&c.charCodeAt(j)))*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var qn=Sn.exports,An={exports:{}};An.exports=function(c,a){for(var f,m=c.length,b=a^m,k=0;m>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24))+((1540483477*(f>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++k;switch(m){case 3:b^=(255&c.charCodeAt(k+2))<<16;case 2:b^=(255&c.charCodeAt(k+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(k)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var Mn=qn,Rn=An.exports;gn.exports=Mn,gn.exports.murmur3=Mn,gn.exports.murmur2=Rn;var jr=h(gn.exports);class lr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,f,m,b){this.ids.push(io(a)),this.positions.push(f,m,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=io(a);let m=0,b=this.ids.length-1;for(;m<b;){const S=m+b>>1;this.ids[S]>=f?b=S:m=S+1}const k=[];for(;this.ids[m]===f;)k.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return k}static serialize(a,f){const m=new Float64Array(a.ids),b=new Uint32Array(a.positions);return oi(m,b,0,m.length-1),f&&f.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(a){const f=new lr;return f.ids=a.ids,f.positions=a.positions,f.indexed=!0,f}}function io(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:jr(String(c))}function oi(c,a,f,m){for(;f<m;){const b=c[f+m>>1];let k=f-1,S=m+1;for(;;){do k++;while(c[k]<b);do S--;while(c[S]>b);if(k>=S)break;Rr(c,k,S),Rr(a,3*k,3*S),Rr(a,3*k+1,3*S+1),Rr(a,3*k+2,3*S+2)}S-f<m-S?(oi(c,a,f,S),f=S+1):(oi(c,a,S+1,m),m=S)}}function Rr(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}Zt("FeaturePositionMap",lr);class si{constructor(a,f){this.gl=a.gl,this.location=f}}class oo extends si{constructor(a,f){super(a,f),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Xo extends si{constructor(a,f){super(a,f),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Is extends si{constructor(a,f){super(a,f),this.current=sr.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const kl=new Float32Array(16);function Ps(c){return[kn(255*c.r,255*c.g),kn(255*c.b,255*c.a)]}class Ko{constructor(a,f,m){this.value=a,this.uniformNames=f.map(b=>`u_${b}`),this.type=m}setUniform(a,f,m){a.set(m.constantOr(this.value))}getBinding(a,f,m){return this.type==="color"?new Is(a,f):new oo(a,f)}}class Jr{constructor(a,f){this.uniformNames=f.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=a.tlbr}setUniform(a,f,m,b){const k=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;k&&a.set(k)}getBinding(a,f,m){return m.substr(0,9)==="u_pattern"?new Xo(a,f):new oo(a,f)}}class Br{constructor(a,f,m,b){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=f.map(k=>({name:`a_${k}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,f,m,b,k){const S=this.paintVertexArray.length,M=this.expression.evaluate(new Er(0),f,{},b,[],k);this.paintVertexArray.resize(a),this._setPaintValue(S,a,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(a,f,k)}_setPaintValue(a,f,m){if(this.type==="color"){const b=Ps(m);for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,b[0],b[1])}else{for(let b=a;b<f;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lr{constructor(a,f,m,b,k,S){this.expression=a,this.uniformNames=f.map(M=>`u_${M}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(a,f,m,b,k){const S=this.expression.evaluate(new Er(this.zoom),f,{},b,[],k),M=this.expression.evaluate(new Er(this.zoom+1),f,{},b,[],k),R=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(R,a,S,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:this.zoom},m,b),S=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(a,f,k,S)}_setPaintValue(a,f,m,b){if(this.type==="color"){const k=Ps(m),S=Ps(b);for(let M=a;M<f;M++)this.paintVertexArray.emplace(M,k[0],k[1],S[0],S[1])}else{for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,f){const m=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=K(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,f,m){return new oo(a,f)}}class mo{constructor(a,f,m,b,k,S){this.expression=a,this.type=f,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k}populatePaintArray(a,f,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,f.patterns&&f.patterns[this.layerId],m)}updatePaintArray(a,f,m,b,k){this._setPaintValues(a,f,m.patterns&&m.patterns[this.layerId],k)}_setPaintValues(a,f,m,b){if(!b||!m)return;const{min:k,mid:S,max:M}=m,R=b[k],j=b[S],X=b[M];if(R&&j&&X)for(let Y=a;Y<f;Y++)this.zoomInPaintVertexArray.emplace(Y,j.tl[0],j.tl[1],j.br[0],j.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],j.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,j.tl[0],j.tl[1],j.br[0],j.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],j.pixelRatio,X.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yr{constructor(a,f,m){this.binders={},this._buffers=[];const b=[];for(const k in a.paint._values){if(!m(k))continue;const S=a.paint.get(k);if(!(S instanceof Mo&&ba(S.property.specification)))continue;const M=go(k,a.type),R=S.value,j=S.property.specification.type,X=S.property.useIntegerZoom,Y=S.property.specification["property-type"],se=Y==="cross-faded"||Y==="cross-faded-data-driven";if(R.kind==="constant")this.binders[k]=se?new Jr(R.value,M):new Ko(R.value,M,j),b.push(`/u_${k}`);else if(R.kind==="source"||se){const pe=Qr(k,j,"source");this.binders[k]=se?new mo(R,j,X,f,pe,a.id):new Br(R,M,j,pe),b.push(`/a_${k}`)}else{const pe=Qr(k,j,"composite");this.binders[k]=new Lr(R,M,j,X,f,pe),b.push(`/z_${k}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const f=this.binders[a];return f instanceof Br||f instanceof Lr?f.maxValue:0}populatePaintArrays(a,f,m,b,k){for(const S in this.binders){const M=this.binders[S];(M instanceof Br||M instanceof Lr||M instanceof mo)&&M.populatePaintArray(a,f,m,b,k)}}setConstantPatternPositions(a,f){for(const m in this.binders){const b=this.binders[m];b instanceof Jr&&b.setConstantPatternPositions(a,f)}}updatePaintArrays(a,f,m,b,k){let S=!1;for(const M in a){const R=f.getPositions(M);for(const j of R){const X=m.feature(j.index);for(const Y in this.binders){const se=this.binders[Y];if((se instanceof Br||se instanceof Lr||se instanceof mo)&&se.expression.isStateDependent===!0){const pe=b.paint.get(Y);se.expression=pe.value,se.updatePaintArray(j.start,j.end,X,a[M],k),S=!0}}}}return S}defines(){const a=[];for(const f in this.binders){const m=this.binders[f];(m instanceof Ko||m instanceof Jr)&&a.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return a}getBinderAttributes(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Br||m instanceof Lr)for(let b=0;b<m.paintVertexAttributes.length;b++)a.push(m.paintVertexAttributes[b].name);else if(m instanceof mo)for(let b=0;b<$t.members.length;b++)a.push($t.members[b].name)}return a}getBinderUniforms(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Ko||m instanceof Jr||m instanceof Lr)for(const b of m.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,f){const m=[];for(const b in this.binders){const k=this.binders[b];if(k instanceof Ko||k instanceof Jr||k instanceof Lr){for(const S of k.uniformNames)if(f[S]){const M=k.getBinding(a,f[S],S);m.push({name:S,property:b,binding:M})}}}return m}setUniforms(a,f,m,b){for(const{name:k,property:S,binding:M}of f)this.binders[S].setUniform(M,b,m.get(S),k)}updatePaintBuffers(a){this._buffers=[];for(const f in this.binders){const m=this.binders[f];if(a&&m instanceof mo){const b=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof Br||m instanceof Lr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const f in this.binders){const m=this.binders[f];(m instanceof Br||m instanceof Lr||m instanceof mo)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const f=this.binders[a];(f instanceof Br||f instanceof Lr||f instanceof mo)&&f.destroy()}}}class Fr{constructor(a,f,m=()=>!0){this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new Yr(b,f,m);this.needsUpload=!1,this._featureMap=new lr,this._bufferOffset=0}populatePaintArrays(a,f,m,b,k,S){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(a,f,b,k,S);f.id!==void 0&&this._featureMap.add(f.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,f,m,b){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(a,this._featureMap,f,k,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function go(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function Qr(c,a,f){const m={color:{source:wl,composite:ku},number:{source:xu,composite:wl}},b=function(k){return{"line-pattern":{source:Be,composite:Be},"fill-pattern":{source:Be,composite:Be},"fill-extrusion-pattern":{source:Be,composite:Be}}[k]}(c);return b&&b[f]||m[a][f]}Zt("ConstantBinder",Ko),Zt("CrossFadedConstantBinder",Jr),Zt("SourceExpressionBinder",Br),Zt("CrossFadedCompositeBinder",mo),Zt("CompositeExpressionBinder",Lr),Zt("ProgramConfiguration",Yr,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Fr);const qr=8192,Uc=Math.pow(2,14)-1,Jh=-Uc-1;function Js(c){const a=qr/c.extent,f=c.loadGeometry();for(let m=0;m<f.length;m++){const b=f[m];for(let k=0;k<b.length;k++){const S=b[k],M=Math.round(S.x*a),R=Math.round(S.y*a);S.x=K(M,Jh,Uc),S.y=K(R,Jh,Uc),(M<S.x||M>S.x+1||R<S.y||R>S.y+1)&&xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Ys(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Js(c):[]}}function Su(c,a,f,m,b){c.emplaceBack(2*a+(m+1)/2,2*f+(b+1)/2)}class zs{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new ge,this.indexArray=new ft,this.segments=new Ot,this.programConfigurations=new Fr(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){const b=this.layers[0],k=[];let S=null,M=!1;b.type==="circle"&&(S=b.layout.get("circle-sort-key"),M=!S.isConstant());for(const{feature:R,id:j,index:X,sourceLayerIndex:Y}of a){const se=this.layers[0]._featureFilter.needGeometry,pe=Ys(R,se);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),pe,m))continue;const ye=M?S.evaluate(pe,{},m):void 0,be={id:j,properties:R.properties,type:R.type,sourceLayerIndex:Y,index:X,geometry:se?pe.geometry:Js(R),patterns:{},sortKey:ye};k.push(be)}M&&k.sort((R,j)=>R.sortKey-j.sortKey);for(const R of k){const{geometry:j,index:X,sourceLayerIndex:Y}=R,se=a[X].feature;this.addFeature(R,j,X,m),f.featureIndex.insert(se,j,X,Y,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Bt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,f,m,b){for(const k of f)for(const S of k){const M=S.x,R=S.y;if(M<0||M>=qr||R<0||R>=qr)continue;const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),X=j.vertexLength;Su(this.layoutVertexArray,M,R,-1,-1),Su(this.layoutVertexArray,M,R,1,-1),Su(this.layoutVertexArray,M,R,1,1),Su(this.layoutVertexArray,M,R,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+3,X+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{},b)}}function Vc(c,a){for(let f=0;f<c.length;f++)if(Tu(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Tu(c,a[f]))return!0;return!!Cu(c,a)}function Yh(c,a,f){return!!Tu(c,a)||!!$p(a,c,f)}function qc(c,a){if(c.length===1)return p_(a,c[0]);for(let f=0;f<a.length;f++){const m=a[f];for(let b=0;b<m.length;b++)if(Tu(c,m[b]))return!0}for(let f=0;f<c.length;f++)if(p_(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Cu(c,a[f]))return!0;return!1}function Hc(c,a,f){if(c.length>1){if(Cu(c,a))return!0;for(let m=0;m<a.length;m++)if($p(a[m],c,f))return!0}for(let m=0;m<c.length;m++)if($p(c[m],a,f))return!0;return!1}function Cu(c,a){if(c.length===0||a.length===0)return!1;for(let f=0;f<c.length-1;f++){const m=c[f],b=c[f+1];for(let k=0;k<a.length-1;k++)if(Gc(m,b,a[k],a[k+1]))return!0}return!1}function Gc(c,a,f,m){return me(c,f,m)!==me(a,f,m)&&me(c,a,f)!==me(c,a,m)}function $p(c,a,f){const m=f*f;if(a.length===1)return c.distSqr(a[0])<m;for(let b=1;b<a.length;b++)if(d_(c,a[b-1],a[b])<m)return!0;return!1}function d_(c,a,f){const m=a.distSqr(f);if(m===0)return c.distSqr(a);const b=((c.x-a.x)*(f.x-a.x)+(c.y-a.y)*(f.y-a.y))/m;return c.distSqr(b<0?a:b>1?f:f.sub(a)._mult(b)._add(a))}function p_(c,a){let f,m,b,k=!1;for(let S=0;S<c.length;S++){f=c[S];for(let M=0,R=f.length-1;M<f.length;R=M++)m=f[M],b=f[R],m.y>a.y!=b.y>a.y&&a.x<(b.x-m.x)*(a.y-m.y)/(b.y-m.y)+m.x&&(k=!k)}return k}function Tu(c,a){let f=!1;for(let m=0,b=c.length-1;m<c.length;b=m++){const k=c[m],S=c[b];k.y>a.y!=S.y>a.y&&a.x<(S.x-k.x)*(a.y-k.y)/(S.y-k.y)+k.x&&(f=!f)}return f}function sx(c,a,f){const m=f[0],b=f[2];if(c.x<m.x&&a.x<m.x||c.x>b.x&&a.x>b.x||c.y<m.y&&a.y<m.y||c.y>b.y&&a.y>b.y)return!1;const k=me(c,a,f[0]);return k!==me(c,a,f[1])||k!==me(c,a,f[2])||k!==me(c,a,f[3])}function Wc(c,a,f){const m=a.paint.get(c).value;return m.kind==="constant"?m.value:f.programConfigurations.get(a.id).getMaxValue(c)}function Qh(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function ed(c,a,f,m,b){if(!a[0]&&!a[1])return c;const k=_.convert(a)._mult(b);f==="viewport"&&k._rotate(-m);const S=[];for(let M=0;M<c.length;M++)S.push(c[M].sub(k));return S}let m_,g_;Zt("CircleBucket",zs,{omit:["layers"]});var ax={get paint(){return g_=g_||new ji({"circle-radius":new hn(de.paint_circle["circle-radius"]),"circle-color":new hn(de.paint_circle["circle-color"]),"circle-blur":new hn(de.paint_circle["circle-blur"]),"circle-opacity":new hn(de.paint_circle["circle-opacity"]),"circle-translate":new sn(de.paint_circle["circle-translate"]),"circle-translate-anchor":new sn(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sn(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sn(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hn(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hn(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hn(de.paint_circle["circle-stroke-opacity"])})},get layout(){return m_=m_||new ji({"circle-sort-key":new hn(de.layout_circle["circle-sort-key"])})}},Ui=1e-6,Mu=typeof Float32Array<"u"?Float32Array:Array;function Np(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function __(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3],M=a[4],R=a[5],j=a[6],X=a[7],Y=a[8],se=a[9],pe=a[10],ye=a[11],be=a[12],Ce=a[13],Pe=a[14],Ze=a[15],Re=f[0],Ne=f[1],dt=f[2],vt=f[3];return c[0]=Re*m+Ne*M+dt*Y+vt*be,c[1]=Re*b+Ne*R+dt*se+vt*Ce,c[2]=Re*k+Ne*j+dt*pe+vt*Pe,c[3]=Re*S+Ne*X+dt*ye+vt*Ze,c[4]=(Re=f[4])*m+(Ne=f[5])*M+(dt=f[6])*Y+(vt=f[7])*be,c[5]=Re*b+Ne*R+dt*se+vt*Ce,c[6]=Re*k+Ne*j+dt*pe+vt*Pe,c[7]=Re*S+Ne*X+dt*ye+vt*Ze,c[8]=(Re=f[8])*m+(Ne=f[9])*M+(dt=f[10])*Y+(vt=f[11])*be,c[9]=Re*b+Ne*R+dt*se+vt*Ce,c[10]=Re*k+Ne*j+dt*pe+vt*Pe,c[11]=Re*S+Ne*X+dt*ye+vt*Ze,c[12]=(Re=f[12])*m+(Ne=f[13])*M+(dt=f[14])*Y+(vt=f[15])*be,c[13]=Re*b+Ne*R+dt*se+vt*Ce,c[14]=Re*k+Ne*j+dt*pe+vt*Pe,c[15]=Re*S+Ne*X+dt*ye+vt*Ze,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var Zc,lx=__;function td(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3];return c[0]=f[0]*m+f[4]*b+f[8]*k+f[12]*S,c[1]=f[1]*m+f[5]*b+f[9]*k+f[13]*S,c[2]=f[2]*m+f[6]*b+f[10]*k+f[14]*S,c[3]=f[3]*m+f[7]*b+f[11]*k+f[15]*S,c}Zc=new Mu(4),Mu!=Float32Array&&(Zc[0]=0,Zc[1]=0,Zc[2]=0,Zc[3]=0);class ux extends Eo{constructor(a){super(a,ax)}createBucket(a){return new zs(a)}queryRadius(a){const f=a;return Wc("circle-radius",this,f)+Wc("circle-stroke-width",this,f)+Qh(this.paint.get("circle-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M,R){const j=ed(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,M),X=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),Y=this.paint.get("circle-pitch-alignment")==="map",se=Y?j:function(ye,be){return ye.map(Ce=>y_(Ce,be))}(j,R),pe=Y?X*M:X;for(const ye of b)for(const be of ye){const Ce=Y?be:y_(be,R);let Pe=pe;const Ze=td([],[be.x,be.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=Ze[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=S.cameraToCenterDistance/Ze[3]),Yh(se,Ce,Pe))return!0}return!1}}function y_(c,a){const f=td([],[c.x,c.y,0,1],a);return new _(f[0]/f[3],f[1]/f[3])}class v_ extends zs{}let b_;Zt("HeatmapBucket",v_,{omit:["layers"]});var cx={get paint(){return b_=b_||new ji({"heatmap-radius":new hn(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hn(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sn(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zc(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sn(de.paint_heatmap["heatmap-opacity"])})}};function jp(c,{width:a,height:f},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==a*f*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${a*f*m}`)}else b=new Uint8Array(a*f*m);return c.width=a,c.height=f,c.data=b,c}function w_(c,{width:a,height:f},m){if(a===c.width&&f===c.height)return;const b=jp({},{width:a,height:f},m);Up(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,f)},m),c.width=a,c.height=f,c.data=b.data}function Up(c,a,f,m,b,k){if(b.width===0||b.height===0)return a;if(b.width>c.width||b.height>c.height||f.x>c.width-b.width||f.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||m.x>a.width-b.width||m.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,M=a.data;if(S===M)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<b.height;R++){const j=((f.y+R)*c.width+f.x)*k,X=((m.y+R)*a.width+m.x)*k;for(let Y=0;Y<b.width*k;Y++)M[X+Y]=S[j+Y]}return a}class Xc{constructor(a,f){jp(this,a,1,f)}resize(a){w_(this,a,1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Up(a,f,m,b,k,1)}}class Lo{constructor(a,f){jp(this,a,4,f)}resize(a){w_(this,a,4)}replace(a,f){f?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Up(a,f,m,b,k,4)}}function x_(c){const a={},f=c.resolution||256,m=c.clips?c.clips.length:1,b=c.image||new Lo({width:f,height:m});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const k=(S,M,R)=>{a[c.evaluationKey]=R;const j=c.expression.evaluate(a);b.data[S+M+0]=Math.floor(255*j.r/j.a),b.data[S+M+1]=Math.floor(255*j.g/j.a),b.data[S+M+2]=Math.floor(255*j.b/j.a),b.data[S+M+3]=Math.floor(255*j.a)};if(c.clips)for(let S=0,M=0;S<m;++S,M+=4*f)for(let R=0,j=0;R<f;R++,j+=4){const X=R/(f-1),{start:Y,end:se}=c.clips[S];k(M,j,Y*(1-X)+se*X)}else for(let S=0,M=0;S<f;S++,M+=4)k(0,M,S/(f-1));return b}Zt("AlphaImage",Xc),Zt("RGBAImage",Lo);class fx extends Eo{createBucket(a){return new v_(a)}constructor(a){super(a,cx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=x_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let A_;var hx={get paint(){return A_=A_||new ji({"hillshade-illumination-direction":new sn(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sn(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sn(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sn(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sn(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sn(de.paint_hillshade["hillshade-accent-color"])})}};class dx extends Eo{constructor(a){super(a,hx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const px=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:mx}=px;var Vp={exports:{}};function nd(c,a,f){f=f||2;var m,b,k,S,M,R,j,X=a&&a.length,Y=X?a[0]*f:c.length,se=k_(c,0,Y,f,!0),pe=[];if(!se||se.next===se.prev)return pe;if(X&&(se=function(be,Ce,Pe,Ze){var Re,Ne,dt,vt=[];for(Re=0,Ne=Ce.length;Re<Ne;Re++)(dt=k_(be,Ce[Re]*Ze,Re<Ne-1?Ce[Re+1]*Ze:be.length,Ze,!1))===dt.next&&(dt.steiner=!0),vt.push(Ax(dt));for(vt.sort(bx),Re=0;Re<vt.length;Re++)Pe=wx(vt[Re],Pe);return Pe}(c,a,se,f)),c.length>80*f){m=k=c[0],b=S=c[1];for(var ye=f;ye<Y;ye+=f)(M=c[ye])<m&&(m=M),(R=c[ye+1])<b&&(b=R),M>k&&(k=M),R>S&&(S=R);j=(j=Math.max(k-m,S-b))!==0?32767/j:0}return Kc(se,pe,f,m,b,j,0),pe}function k_(c,a,f,m,b){var k,S;if(b===Gp(c,a,f,m)>0)for(k=a;k<f;k+=m)S=T_(k,c[k],c[k+1],S);else for(k=f-m;k>=a;k-=m)S=T_(k,c[k],c[k+1],S);return S&&rd(S,S.next)&&(Yc(S),S=S.next),S}function Sl(c,a){if(!c)return c;a||(a=c);var f,m=c;do if(f=!1,m.steiner||!rd(m,m.next)&&Zr(m.prev,m,m.next)!==0)m=m.next;else{if(Yc(m),(m=a=m.prev)===m.next)break;f=!0}while(f||m!==a);return a}function Kc(c,a,f,m,b,k,S){if(c){!S&&k&&function(X,Y,se,pe){var ye=X;do ye.z===0&&(ye.z=qp(ye.x,ye.y,Y,se,pe)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next;while(ye!==X);ye.prevZ.nextZ=null,ye.prevZ=null,function(be){var Ce,Pe,Ze,Re,Ne,dt,vt,Ht,tn=1;do{for(Pe=be,be=null,Ne=null,dt=0;Pe;){for(dt++,Ze=Pe,vt=0,Ce=0;Ce<tn&&(vt++,Ze=Ze.nextZ);Ce++);for(Ht=tn;vt>0||Ht>0&&Ze;)vt!==0&&(Ht===0||!Ze||Pe.z<=Ze.z)?(Re=Pe,Pe=Pe.nextZ,vt--):(Re=Ze,Ze=Ze.nextZ,Ht--),Ne?Ne.nextZ=Re:be=Re,Re.prevZ=Ne,Ne=Re;Pe=Ze}Ne.nextZ=null,tn*=2}while(dt>1)}(ye)}(c,m,b,k);for(var M,R,j=c;c.prev!==c.next;)if(M=c.prev,R=c.next,k?_x(c,m,b,k):gx(c))a.push(M.i/f|0),a.push(c.i/f|0),a.push(R.i/f|0),Yc(c),c=R.next,j=R.next;else if((c=R)===j){S?S===1?Kc(c=yx(Sl(c),a,f),a,f,m,b,k,2):S===2&&vx(c,a,f,m,b,k):Kc(Sl(c),a,f,m,b,k,1);break}}}function gx(c){var a=c.prev,f=c,m=c.next;if(Zr(a,f,m)>=0)return!1;for(var b=a.x,k=f.x,S=m.x,M=a.y,R=f.y,j=m.y,X=b<k?b<S?b:S:k<S?k:S,Y=M<R?M<j?M:j:R<j?R:j,se=b>k?b>S?b:S:k>S?k:S,pe=M>R?M>j?M:j:R>j?R:j,ye=m.next;ye!==a;){if(ye.x>=X&&ye.x<=se&&ye.y>=Y&&ye.y<=pe&&Eu(b,M,k,R,S,j,ye.x,ye.y)&&Zr(ye.prev,ye,ye.next)>=0)return!1;ye=ye.next}return!0}function _x(c,a,f,m){var b=c.prev,k=c,S=c.next;if(Zr(b,k,S)>=0)return!1;for(var M=b.x,R=k.x,j=S.x,X=b.y,Y=k.y,se=S.y,pe=M<R?M<j?M:j:R<j?R:j,ye=X<Y?X<se?X:se:Y<se?Y:se,be=M>R?M>j?M:j:R>j?R:j,Ce=X>Y?X>se?X:se:Y>se?Y:se,Pe=qp(pe,ye,a,f,m),Ze=qp(be,Ce,a,f,m),Re=c.prevZ,Ne=c.nextZ;Re&&Re.z>=Pe&&Ne&&Ne.z<=Ze;){if(Re.x>=pe&&Re.x<=be&&Re.y>=ye&&Re.y<=Ce&&Re!==b&&Re!==S&&Eu(M,X,R,Y,j,se,Re.x,Re.y)&&Zr(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,Ne.x>=pe&&Ne.x<=be&&Ne.y>=ye&&Ne.y<=Ce&&Ne!==b&&Ne!==S&&Eu(M,X,R,Y,j,se,Ne.x,Ne.y)&&Zr(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;Re&&Re.z>=Pe;){if(Re.x>=pe&&Re.x<=be&&Re.y>=ye&&Re.y<=Ce&&Re!==b&&Re!==S&&Eu(M,X,R,Y,j,se,Re.x,Re.y)&&Zr(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;Ne&&Ne.z<=Ze;){if(Ne.x>=pe&&Ne.x<=be&&Ne.y>=ye&&Ne.y<=Ce&&Ne!==b&&Ne!==S&&Eu(M,X,R,Y,j,se,Ne.x,Ne.y)&&Zr(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function yx(c,a,f){var m=c;do{var b=m.prev,k=m.next.next;!rd(b,k)&&S_(b,m,m.next,k)&&Jc(b,k)&&Jc(k,b)&&(a.push(b.i/f|0),a.push(m.i/f|0),a.push(k.i/f|0),Yc(m),Yc(m.next),m=c=k),m=m.next}while(m!==c);return Sl(m)}function vx(c,a,f,m,b,k){var S=c;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&kx(S,M)){var R=C_(S,M);return S=Sl(S,S.next),R=Sl(R,R.next),Kc(S,a,f,m,b,k,0),void Kc(R,a,f,m,b,k,0)}M=M.next}S=S.next}while(S!==c)}function bx(c,a){return c.x-a.x}function wx(c,a){var f=function(b,k){var S,M=k,R=b.x,j=b.y,X=-1/0;do{if(j<=M.y&&j>=M.next.y&&M.next.y!==M.y){var Y=M.x+(j-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(Y<=R&&Y>X&&(X=Y,S=M.x<M.next.x?M:M.next,Y===R))return S}M=M.next}while(M!==k);if(!S)return null;var se,pe=S,ye=S.x,be=S.y,Ce=1/0;M=S;do R>=M.x&&M.x>=ye&&R!==M.x&&Eu(j<be?R:X,j,ye,be,j<be?X:R,j,M.x,M.y)&&(se=Math.abs(j-M.y)/(R-M.x),Jc(M,b)&&(se<Ce||se===Ce&&(M.x>S.x||M.x===S.x&&xx(S,M)))&&(S=M,Ce=se)),M=M.next;while(M!==pe);return S}(c,a);if(!f)return a;var m=C_(f,c);return Sl(m,m.next),Sl(f,f.next)}function xx(c,a){return Zr(c.prev,c,a.prev)<0&&Zr(a.next,c,c.next)<0}function qp(c,a,f,m,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Ax(c){var a=c,f=c;do(a.x<f.x||a.x===f.x&&a.y<f.y)&&(f=a),a=a.next;while(a!==c);return f}function Eu(c,a,f,m,b,k,S,M){return(b-S)*(a-M)>=(c-S)*(k-M)&&(c-S)*(m-M)>=(f-S)*(a-M)&&(f-S)*(k-M)>=(b-S)*(m-M)}function kx(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(f,m){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==m.i&&b.next.i!==m.i&&S_(b,b.next,f,m))return!0;b=b.next}while(b!==f);return!1}(c,a)&&(Jc(c,a)&&Jc(a,c)&&function(f,m){var b=f,k=!1,S=(f.x+m.x)/2,M=(f.y+m.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&S<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(k=!k),b=b.next;while(b!==f);return k}(c,a)&&(Zr(c.prev,c,a.prev)||Zr(c,a.prev,a))||rd(c,a)&&Zr(c.prev,c,c.next)>0&&Zr(a.prev,a,a.next)>0)}function Zr(c,a,f){return(a.y-c.y)*(f.x-a.x)-(a.x-c.x)*(f.y-a.y)}function rd(c,a){return c.x===a.x&&c.y===a.y}function S_(c,a,f,m){var b=od(Zr(c,a,f)),k=od(Zr(c,a,m)),S=od(Zr(f,m,c)),M=od(Zr(f,m,a));return b!==k&&S!==M||!(b!==0||!id(c,f,a))||!(k!==0||!id(c,m,a))||!(S!==0||!id(f,c,m))||!(M!==0||!id(f,a,m))}function id(c,a,f){return a.x<=Math.max(c.x,f.x)&&a.x>=Math.min(c.x,f.x)&&a.y<=Math.max(c.y,f.y)&&a.y>=Math.min(c.y,f.y)}function od(c){return c>0?1:c<0?-1:0}function Jc(c,a){return Zr(c.prev,c,c.next)<0?Zr(c,a,c.next)>=0&&Zr(c,c.prev,a)>=0:Zr(c,a,c.prev)<0||Zr(c,c.next,a)<0}function C_(c,a){var f=new Hp(c.i,c.x,c.y),m=new Hp(a.i,a.x,a.y),b=c.next,k=a.prev;return c.next=a,a.prev=c,f.next=b,b.prev=f,m.next=f,f.prev=m,k.next=m,m.prev=k,m}function T_(c,a,f,m){var b=new Hp(c,a,f);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Yc(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Hp(c,a,f){this.i=c,this.x=a,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gp(c,a,f,m){for(var b=0,k=a,S=f-m;k<f;k+=m)b+=(c[S]-c[k])*(c[k+1]+c[S+1]),S=k;return b}Vp.exports=nd,Vp.exports.default=nd,nd.deviation=function(c,a,f,m){var b=a&&a.length,k=Math.abs(Gp(c,0,b?a[0]*f:c.length,f));if(b)for(var S=0,M=a.length;S<M;S++)k-=Math.abs(Gp(c,a[S]*f,S<M-1?a[S+1]*f:c.length,f));var R=0;for(S=0;S<m.length;S+=3){var j=m[S]*f,X=m[S+1]*f,Y=m[S+2]*f;R+=Math.abs((c[j]-c[Y])*(c[X+1]-c[j+1])-(c[j]-c[X])*(c[Y+1]-c[j+1]))}return k===0&&R===0?0:Math.abs((R-k)/k)},nd.flatten=function(c){for(var a=c[0][0].length,f={vertices:[],holes:[],dimensions:a},m=0,b=0;b<c.length;b++){for(var k=0;k<c[b].length;k++)for(var S=0;S<a;S++)f.vertices.push(c[b][k][S]);b>0&&f.holes.push(m+=c[b-1].length)}return f};var M_=h(Vp.exports);function Sx(c,a,f,m,b){E_(c,a,f||0,m||c.length-1,b||Cx)}function E_(c,a,f,m,b){for(;m>f;){if(m-f>600){var k=m-f+1,S=a-f+1,M=Math.log(k),R=.5*Math.exp(2*M/3),j=.5*Math.sqrt(M*R*(k-R)/k)*(S-k/2<0?-1:1);E_(c,a,Math.max(f,Math.floor(a-S*R/k+j)),Math.min(m,Math.floor(a+(k-S)*R/k+j)),b)}var X=c[a],Y=f,se=m;for(Qc(c,f,a),b(c[m],X)>0&&Qc(c,f,m);Y<se;){for(Qc(c,Y,se),Y++,se--;b(c[Y],X)<0;)Y++;for(;b(c[se],X)>0;)se--}b(c[f],X)===0?Qc(c,f,se):Qc(c,++se,m),se<=a&&(f=se+1),a<=se&&(m=se-1)}}function Qc(c,a,f){var m=c[a];c[a]=c[f],c[f]=m}function Cx(c,a){return c<a?-1:c>a?1:0}function Wp(c,a){const f=c.length;if(f<=1)return[c];const m=[];let b,k;for(let S=0;S<f;S++){const M=tt(c[S]);M!==0&&(c[S].area=Math.abs(M),k===void 0&&(k=M<0),k===M<0?(b&&m.push(b),b=[c[S]]):b.push(c[S]))}if(b&&m.push(b),a>1)for(let S=0;S<m.length;S++)m[S].length<=a||(Sx(m[S],a,1,m[S].length-1,Tx),m[S]=m[S].slice(0,a));return m}function Tx(c,a){return a.area-c.area}function Zp(c,a,f){const m=f.patternDependencies;let b=!1;for(const k of a){const S=k.paint.get(`${c}-pattern`);S.isConstant()||(b=!0);const M=S.constantOr(null);M&&(b=!0,m[M.to]=!0,m[M.from]=!0)}return b}function Xp(c,a,f,m,b){const k=b.patternDependencies;for(const S of a){const M=S.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let R=M.evaluate({zoom:m-1},f,{},b.availableImages),j=M.evaluate({zoom:m},f,{},b.availableImages),X=M.evaluate({zoom:m+1},f,{},b.availableImages);R=R&&R.name?R.name:R,j=j&&j.name?j.name:j,X=X&&X.name?X.name:X,k[R]=!0,k[j]=!0,k[X]=!0,f.patterns[S.id]={min:R,mid:j,max:X}}}return f}class Kp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new ft,this.indexArray2=new Ct,this.programConfigurations=new Fr(a.layers,a.zoom),this.segments=new Ot,this.segments2=new Ot,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Zp("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:R,index:j,sourceLayerIndex:X}of a){const Y=this.layers[0]._featureFilter.needGeometry,se=Ys(M,Y);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),se,m))continue;const pe=k?b.evaluate(se,{},m,f.availableImages):void 0,ye={id:R,properties:M.properties,type:M.type,sourceLayerIndex:X,index:j,geometry:Y?se.geometry:Js(M),patterns:{},sortKey:pe};S.push(ye)}k&&S.sort((M,R)=>M.sortKey-R.sortKey);for(const M of S){const{geometry:R,index:j,sourceLayerIndex:X}=M;if(this.hasPattern){const Y=Xp("fill",this.layers,M,this.zoom,f);this.patternFeatures.push(Y)}else this.addFeature(M,R,j,m,{});f.featureIndex.insert(a[j].feature,R,j,X,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,mx),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,f,m,b,k){for(const S of Wp(f,500)){let M=0;for(const pe of S)M+=pe.length;const R=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),j=R.vertexLength,X=[],Y=[];for(const pe of S){if(pe.length===0)continue;pe!==S[0]&&Y.push(X.length/2);const ye=this.segments2.prepareSegment(pe.length,this.layoutVertexArray,this.indexArray2),be=ye.vertexLength;this.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),this.indexArray2.emplaceBack(be+pe.length-1,be),X.push(pe[0].x),X.push(pe[0].y);for(let Ce=1;Ce<pe.length;Ce++)this.layoutVertexArray.emplaceBack(pe[Ce].x,pe[Ce].y),this.indexArray2.emplaceBack(be+Ce-1,be+Ce),X.push(pe[Ce].x),X.push(pe[Ce].y);ye.vertexLength+=pe.length,ye.primitiveLength+=pe.length}const se=M_(X,Y);for(let pe=0;pe<se.length;pe+=3)this.indexArray.emplaceBack(j+se[pe],j+se[pe+1],j+se[pe+2]);R.vertexLength+=M,R.primitiveLength+=se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}let L_,I_;Zt("FillBucket",Kp,{omit:["layers","patternFeatures"]});var Mx={get paint(){return I_=I_||new ji({"fill-antialias":new sn(de.paint_fill["fill-antialias"]),"fill-opacity":new hn(de.paint_fill["fill-opacity"]),"fill-color":new hn(de.paint_fill["fill-color"]),"fill-outline-color":new hn(de.paint_fill["fill-outline-color"]),"fill-translate":new sn(de.paint_fill["fill-translate"]),"fill-translate-anchor":new sn(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new _u(de.paint_fill["fill-pattern"])})},get layout(){return L_=L_||new ji({"fill-sort-key":new hn(de.layout_fill["fill-sort-key"])})}};class Ex extends Eo{constructor(a){super(a,Mx)}recalculate(a,f){super.recalculate(a,f);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Kp(a)}queryRadius(){return Qh(this.paint.get("fill-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){return qc(ed(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,M),b)}isTileClipped(){return!0}}const Lx=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Ix=Wr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Px}=Lx;var Ma={},zx=p,P_=Lu;function Lu(c,a,f,m,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=b,c.readFields(Dx,this,a)}function Dx(c,a,f){c==1?a.id=f.readVarint():c==2?function(m,b){for(var k=m.readVarint()+m.pos;m.pos<k;){var S=b._keys[m.readVarint()],M=b._values[m.readVarint()];b.properties[S]=M}}(f,a):c==3?a.type=f.readVarint():c==4&&(a._geometry=f.pos)}function Rx(c){for(var a,f,m=0,b=0,k=c.length,S=k-1;b<k;S=b++)m+=((f=c[S]).x-(a=c[b]).x)*(a.y+f.y);return m}Lu.types=["Unknown","Point","LineString","Polygon"],Lu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,f=c.readVarint()+c.pos,m=1,b=0,k=0,S=0,M=[];c.pos<f;){if(b<=0){var R=c.readVarint();m=7&R,b=R>>3}if(b--,m===1||m===2)k+=c.readSVarint(),S+=c.readSVarint(),m===1&&(a&&M.push(a),a=[]),a.push(new zx(k,S));else{if(m!==7)throw new Error("unknown command "+m);a&&a.push(a[0].clone())}}return a&&M.push(a),M},Lu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,f=1,m=0,b=0,k=0,S=1/0,M=-1/0,R=1/0,j=-1/0;c.pos<a;){if(m<=0){var X=c.readVarint();f=7&X,m=X>>3}if(m--,f===1||f===2)(b+=c.readSVarint())<S&&(S=b),b>M&&(M=b),(k+=c.readSVarint())<R&&(R=k),k>j&&(j=k);else if(f!==7)throw new Error("unknown command "+f)}return[S,R,M,j]},Lu.prototype.toGeoJSON=function(c,a,f){var m,b,k=this.extent*Math.pow(2,f),S=this.extent*c,M=this.extent*a,R=this.loadGeometry(),j=Lu.types[this.type];function X(pe){for(var ye=0;ye<pe.length;ye++){var be=pe[ye];pe[ye]=[360*(be.x+S)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+M)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(m=0;m<R.length;m++)Y[m]=R[m][0];X(R=Y);break;case 2:for(m=0;m<R.length;m++)X(R[m]);break;case 3:for(R=function(pe){var ye=pe.length;if(ye<=1)return[pe];for(var be,Ce,Pe=[],Ze=0;Ze<ye;Ze++){var Re=Rx(pe[Ze]);Re!==0&&(Ce===void 0&&(Ce=Re<0),Ce===Re<0?(be&&Pe.push(be),be=[pe[Ze]]):be.push(pe[Ze]))}return be&&Pe.push(be),Pe}(R),m=0;m<R.length;m++)for(b=0;b<R[m].length;b++)X(R[m][b])}R.length===1?R=R[0]:j="Multi"+j;var se={type:"Feature",geometry:{type:j,coordinates:R},properties:this.properties};return"id"in this&&(se.id=this.id),se};var Bx=P_,z_=D_;function D_(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Fx,this,a),this.length=this._features.length}function Fx(c,a,f){c===15?a.version=f.readVarint():c===1?a.name=f.readString():c===5?a.extent=f.readVarint():c===2?a._features.push(f.pos):c===3?a._keys.push(f.readString()):c===4&&a._values.push(function(m){for(var b=null,k=m.readVarint()+m.pos;m.pos<k;){var S=m.readVarint()>>3;b=S===1?m.readString():S===2?m.readFloat():S===3?m.readDouble():S===4?m.readVarint64():S===5?m.readVarint():S===6?m.readSVarint():S===7?m.readBoolean():null}return b}(f))}D_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new Bx(this._pbf,a,this.extent,this._keys,this._values)};var Ox=z_;function $x(c,a,f){if(c===3){var m=new Ox(f,f.readVarint()+f.pos);m.length&&(a[m.name]=m)}}Ma.VectorTile=function(c,a){this.layers=c.readFields($x,{},a)},Ma.VectorTileFeature=P_,Ma.VectorTileLayer=z_;const Nx=Ma.VectorTileFeature.types,Jp=Math.pow(2,13);function ef(c,a,f,m,b,k,S,M){c.emplaceBack(a,f,2*Math.floor(m*Jp)+S,b*Jp*2,k*Jp*2,Math.round(M))}class Yp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ae,this.centroidVertexArray=new te,this.indexArray=new ft,this.programConfigurations=new Fr(a.layers,a.zoom),this.segments=new Ot,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.features=[],this.hasPattern=Zp("fill-extrusion",this.layers,f);for(const{feature:b,id:k,index:S,sourceLayerIndex:M}of a){const R=this.layers[0]._featureFilter.needGeometry,j=Ys(b,R);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),j,m))continue;const X={id:k,sourceLayerIndex:M,index:S,geometry:R?j.geometry:Js(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(Xp("fill-extrusion",this.layers,X,this.zoom,f)):this.addFeature(X,X.geometry,S,m,{}),f.featureIndex.insert(b,X.geometry,S,M,this.index,!0)}}addFeatures(a,f,m){for(const b of this.features){const{geometry:k}=b;this.addFeature(b,k,b.index,f,m)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Px),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Ix.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,f,m,b,k){const S={x:0,y:0,vertexCount:0};for(const M of Wp(f,500)){let R=0;for(const ye of M)R+=ye.length;let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ye of M){if(ye.length===0||Ux(ye))continue;let be=0;for(let Ce=0;Ce<ye.length;Ce++){const Pe=ye[Ce];if(Ce>=1){const Ze=ye[Ce-1];if(!jx(Pe,Ze)){j.vertexLength+4>Ot.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=Pe.sub(Ze)._perp()._unit(),Ne=Ze.dist(Pe);be+Ne>32768&&(be=0),ef(this.layoutVertexArray,Pe.x,Pe.y,Re.x,Re.y,0,0,be),ef(this.layoutVertexArray,Pe.x,Pe.y,Re.x,Re.y,0,1,be),S.x+=2*Pe.x,S.y+=2*Pe.y,S.vertexCount+=2,be+=Ne,ef(this.layoutVertexArray,Ze.x,Ze.y,Re.x,Re.y,0,0,be),ef(this.layoutVertexArray,Ze.x,Ze.y,Re.x,Re.y,0,1,be),S.x+=2*Ze.x,S.y+=2*Ze.y,S.vertexCount+=2;const dt=j.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+R>Ot.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),Nx[a.type]!=="Polygon")continue;const X=[],Y=[],se=j.vertexLength;for(const ye of M)if(ye.length!==0){ye!==M[0]&&Y.push(X.length/2);for(let be=0;be<ye.length;be++){const Ce=ye[be];ef(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),S.x+=Ce.x,S.y+=Ce.y,S.vertexCount+=1,X.push(Ce.x),X.push(Ce.y)}}const pe=M_(X,Y);for(let ye=0;ye<pe.length;ye+=3)this.indexArray.emplaceBack(se+pe[ye],se+pe[ye+2],se+pe[ye+1]);j.primitiveLength+=pe.length/3,j.vertexLength+=R}for(let M=0;M<S.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}function jx(c,a){return c.x===a.x&&(c.x<0||c.x>qr)||c.y===a.y&&(c.y<0||c.y>qr)}function Ux(c){return c.every(a=>a.x<0)||c.every(a=>a.x>qr)||c.every(a=>a.y<0)||c.every(a=>a.y>qr)}let R_;Zt("FillExtrusionBucket",Yp,{omit:["layers","features"]});var Vx={get paint(){return R_=R_||new ji({"fill-extrusion-opacity":new sn(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hn(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sn(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sn(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _u(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hn(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hn(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sn(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qx extends Eo{constructor(a){super(a,Vx)}createBucket(a){return new Yp(a)}queryRadius(){return Qh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,f,m,b,k,S,M,R){const j=ed(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,M),X=this.paint.get("fill-extrusion-height").evaluate(f,m),Y=this.paint.get("fill-extrusion-base").evaluate(f,m),se=function(ye,be,Ce,Pe){const Ze=[];for(const Re of ye){const Ne=[Re.x,Re.y,0,1];td(Ne,Ne,be),Ze.push(new _(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return Ze}(j,R),pe=function(ye,be,Ce,Pe){const Ze=[],Re=[],Ne=Pe[8]*be,dt=Pe[9]*be,vt=Pe[10]*be,Ht=Pe[11]*be,tn=Pe[8]*Ce,qt=Pe[9]*Ce,Ut=Pe[10]*Ce,Ft=Pe[11]*Ce;for(const Xt of ye){const Nt=[],It=[];for(const fn of Xt){const on=fn.x,Bn=fn.y,xr=Pe[0]*on+Pe[4]*Bn+Pe[12],Ir=Pe[1]*on+Pe[5]*Bn+Pe[13],li=Pe[2]*on+Pe[6]*Bn+Pe[14],_o=Pe[3]*on+Pe[7]*Bn+Pe[15],Vi=li+vt,ei=_o+Ht,yi=xr+tn,Si=Ir+qt,qi=li+Ut,Hi=_o+Ft,ui=new _((xr+Ne)/ei,(Ir+dt)/ei);ui.z=Vi/ei,Nt.push(ui);const ci=new _(yi/Hi,Si/Hi);ci.z=qi/Hi,It.push(ci)}Ze.push(Nt),Re.push(It)}return[Ze,Re]}(b,Y,X,R);return function(ye,be,Ce){let Pe=1/0;qc(Ce,be)&&(Pe=B_(Ce,be[0]));for(let Ze=0;Ze<be.length;Ze++){const Re=be[Ze],Ne=ye[Ze];for(let dt=0;dt<Re.length-1;dt++){const vt=Re[dt],Ht=[vt,Re[dt+1],Ne[dt+1],Ne[dt],vt];Vc(Ce,Ht)&&(Pe=Math.min(Pe,B_(Ce,Ht)))}}return Pe!==1/0&&Pe}(pe[0],pe[1],se)}}function tf(c,a){return c.x*a.x+c.y*a.y}function B_(c,a){if(c.length===1){let f=0;const m=a[f++];let b;for(;!b||m.equals(b);)if(b=a[f++],!b)return 1/0;for(;f<a.length;f++){const k=a[f],S=c[0],M=b.sub(m),R=k.sub(m),j=S.sub(m),X=tf(M,M),Y=tf(M,R),se=tf(R,R),pe=tf(j,M),ye=tf(j,R),be=X*se-Y*Y,Ce=(se*pe-Y*ye)/be,Pe=(X*ye-Y*pe)/be,Ze=m.z*(1-Ce-Pe)+b.z*Ce+k.z*Pe;if(isFinite(Ze))return Ze}return 1/0}{let f=1/0;for(const m of a)f=Math.min(f,m.z);return f}}const Hx=Wr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Gx}=Hx,Wx=Wr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Zx}=Wx,Xx=Ma.VectorTileFeature.types,Kx=Math.cos(Math.PI/180*37.5),F_=Math.pow(2,14)/.5;class Qp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Te,this.layoutVertexArray2=new ve,this.indexArray=new ft,this.programConfigurations=new Fr(a.layers,a.zoom),this.segments=new Ot,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Zp("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:R,index:j,sourceLayerIndex:X}of a){const Y=this.layers[0]._featureFilter.needGeometry,se=Ys(M,Y);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),se,m))continue;const pe=k?b.evaluate(se,{},m):void 0,ye={id:R,properties:M.properties,type:M.type,sourceLayerIndex:X,index:j,geometry:Y?se.geometry:Js(M),patterns:{},sortKey:pe};S.push(ye)}k&&S.sort((M,R)=>M.sortKey-R.sortKey);for(const M of S){const{geometry:R,index:j,sourceLayerIndex:X}=M;if(this.hasPattern){const Y=Xp("line",this.layers,M,this.zoom,f);this.patternFeatures.push(Y)}else this.addFeature(M,R,j,m,{});f.featureIndex.insert(a[j].feature,R,j,X,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Zx)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Gx),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,f,m,b,k){const S=this.layers[0].layout,M=S.get("line-join").evaluate(a,{}),R=S.get("line-cap"),j=S.get("line-miter-limit"),X=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const Y of f)this.addLine(Y,a,M,R,j,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}addLine(a,f,m,b,k,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<a.length-1;Pe++)this.totalDistance+=a[Pe].dist(a[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Xx[f.type]==="Polygon";let R=a.length;for(;R>=2&&a[R-1].equals(a[R-2]);)R--;let j=0;for(;j<R-1&&a[j].equals(a[j+1]);)j++;if(R<(M?3:2))return;m==="bevel"&&(k=1.05);const X=this.overscaling<=16?15*qr/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let se,pe,ye,be,Ce;this.e1=this.e2=-1,M&&(se=a[R-2],Ce=a[j].sub(se)._unit()._perp());for(let Pe=j;Pe<R;Pe++){if(ye=Pe===R-1?M?a[j+1]:void 0:a[Pe+1],ye&&a[Pe].equals(ye))continue;Ce&&(be=Ce),se&&(pe=se),se=a[Pe],Ce=ye?ye.sub(se)._unit()._perp():be,be=be||Ce;let Ze=be.add(Ce);Ze.x===0&&Ze.y===0||Ze._unit();const Re=be.x*Ce.x+be.y*Ce.y,Ne=Ze.x*Ce.x+Ze.y*Ce.y,dt=Ne!==0?1/Ne:1/0,vt=2*Math.sqrt(2-2*Ne),Ht=Ne<Kx&&pe&&ye,tn=be.x*Ce.y-be.y*Ce.x>0;if(Ht&&Pe>j){const Ft=se.dist(pe);if(Ft>2*X){const Xt=se.sub(se.sub(pe)._mult(X/Ft)._round());this.updateDistance(pe,Xt),this.addCurrentVertex(Xt,be,0,0,Y),pe=Xt}}const qt=pe&&ye;let Ut=qt?m:M?"butt":b;if(qt&&Ut==="round"&&(dt<S?Ut="miter":dt<=2&&(Ut="fakeround")),Ut==="miter"&&dt>k&&(Ut="bevel"),Ut==="bevel"&&(dt>2&&(Ut="flipbevel"),dt<k&&(Ut="miter")),pe&&this.updateDistance(pe,se),Ut==="miter")Ze._mult(dt),this.addCurrentVertex(se,Ze,0,0,Y);else if(Ut==="flipbevel"){if(dt>100)Ze=Ce.mult(-1);else{const Ft=dt*be.add(Ce).mag()/be.sub(Ce).mag();Ze._perp()._mult(Ft*(tn?-1:1))}this.addCurrentVertex(se,Ze,0,0,Y),this.addCurrentVertex(se,Ze.mult(-1),0,0,Y)}else if(Ut==="bevel"||Ut==="fakeround"){const Ft=-Math.sqrt(dt*dt-1),Xt=tn?Ft:0,Nt=tn?0:Ft;if(pe&&this.addCurrentVertex(se,be,Xt,Nt,Y),Ut==="fakeround"){const It=Math.round(180*vt/Math.PI/20);for(let fn=1;fn<It;fn++){let on=fn/It;if(on!==.5){const xr=on-.5;on+=on*xr*(on-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*xr*xr+(.848013+Re*(.215638*Re-1.06021)))}const Bn=Ce.sub(be)._mult(on)._add(be)._unit()._mult(tn?-1:1);this.addHalfVertex(se,Bn.x,Bn.y,!1,tn,0,Y)}}ye&&this.addCurrentVertex(se,Ce,-Xt,-Nt,Y)}else if(Ut==="butt")this.addCurrentVertex(se,Ze,0,0,Y);else if(Ut==="square"){const Ft=pe?1:-1;this.addCurrentVertex(se,Ze,Ft,Ft,Y)}else Ut==="round"&&(pe&&(this.addCurrentVertex(se,be,0,0,Y),this.addCurrentVertex(se,be,1,1,Y,!0)),ye&&(this.addCurrentVertex(se,Ce,-1,-1,Y,!0),this.addCurrentVertex(se,Ce,0,0,Y)));if(Ht&&Pe<R-1){const Ft=se.dist(ye);if(Ft>2*X){const Xt=se.add(ye.sub(se)._mult(X/Ft)._round());this.updateDistance(se,Xt),this.addCurrentVertex(Xt,Ce,0,0,Y),se=Xt}}}}addCurrentVertex(a,f,m,b,k,S=!1){const M=f.y*b-f.x,R=-f.y-f.x*b;this.addHalfVertex(a,f.x+f.y*m,f.y-f.x*m,S,!1,m,k),this.addHalfVertex(a,M,R,S,!0,-b,k),this.distance>F_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,f,m,b,k,S))}addHalfVertex({x:a,y:f},m,b,k,S,M,R){const j=.5*(this.lineClips?this.scaledDistance*(F_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(k?1:0),(f<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(M===0?0:M<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,X),R.primitiveLength++),S?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,f){this.distance+=a.dist(f),this.updateScaledDistance()}}let O_,$_;Zt("LineBucket",Qp,{omit:["layers","patternFeatures"]});var N_={get paint(){return $_=$_||new ji({"line-opacity":new hn(de.paint_line["line-opacity"]),"line-color":new hn(de.paint_line["line-color"]),"line-translate":new sn(de.paint_line["line-translate"]),"line-translate-anchor":new sn(de.paint_line["line-translate-anchor"]),"line-width":new hn(de.paint_line["line-width"]),"line-gap-width":new hn(de.paint_line["line-gap-width"]),"line-offset":new hn(de.paint_line["line-offset"]),"line-blur":new hn(de.paint_line["line-blur"]),"line-dasharray":new yl(de.paint_line["line-dasharray"]),"line-pattern":new _u(de.paint_line["line-pattern"]),"line-gradient":new zc(de.paint_line["line-gradient"])})},get layout(){return O_=O_||new ji({"line-cap":new sn(de.layout_line["line-cap"]),"line-join":new hn(de.layout_line["line-join"]),"line-miter-limit":new sn(de.layout_line["line-miter-limit"]),"line-round-limit":new sn(de.layout_line["line-round-limit"]),"line-sort-key":new hn(de.layout_line["line-sort-key"])})}};class Jx extends hn{possiblyEvaluate(a,f){return f=new Er(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(a,f)}evaluate(a,f,m,b){return f=q({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(a,f,m,b)}}let sd;class Yx extends Eo{constructor(a){super(a,N_),this.gradientVersion=0,sd||(sd=new Jx(N_.paint.properties["line-width"].specification),sd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof cl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,f){super.recalculate(a,f),this.paint._values["line-floorwidth"]=sd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Qp(a)}queryRadius(a){const f=a,m=j_(Wc("line-width",this,f),Wc("line-gap-width",this,f)),b=Wc("line-offset",this,f);return m/2+Math.abs(b)+Qh(this.paint.get("line-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){const R=ed(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,M),j=M/2*j_(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),X=this.paint.get("line-offset").evaluate(f,m);return X&&(b=function(Y,se){const pe=[];for(let ye=0;ye<Y.length;ye++){const be=Y[ye],Ce=[];for(let Pe=0;Pe<be.length;Pe++){const Ze=be[Pe-1],Re=be[Pe],Ne=be[Pe+1],dt=Pe===0?new _(0,0):Re.sub(Ze)._unit()._perp(),vt=Pe===be.length-1?new _(0,0):Ne.sub(Re)._unit()._perp(),Ht=dt._add(vt)._unit(),tn=Ht.x*vt.x+Ht.y*vt.y;tn!==0&&Ht._mult(1/tn),Ce.push(Ht._mult(se)._add(Re))}pe.push(Ce)}return pe}(b,X*M)),function(Y,se,pe){for(let ye=0;ye<se.length;ye++){const be=se[ye];if(Y.length>=3){for(let Ce=0;Ce<be.length;Ce++)if(Tu(Y,be[Ce]))return!0}if(Hc(Y,be,pe))return!0}return!1}(R,b,j)}isTileClipped(){return!0}}function j_(c,a){return a>0?a+2*c:c}const Qx=Wr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),eA=Wr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tA=Wr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Wr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const U_=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nA=Wr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function rA(c,a,f){return c.sections.forEach(m=>{m.text=function(b,k,S){const M=k.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Ls.applyArabicShaping&&(b=Ls.applyArabicShaping(b)),b}(m.text,a,f)}),c}Wr([{name:"triangle",components:3,type:"Uint16"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wr([{type:"Float32",name:"offsetX"}]),Wr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ai=24,V_=hr,q_=function(c,a,f,m,b){var k,S,M=8*b-m-1,R=(1<<M)-1,j=R>>1,X=-7,Y=f?b-1:0,se=f?-1:1,pe=c[a+Y];for(Y+=se,k=pe&(1<<-X)-1,pe>>=-X,X+=M;X>0;k=256*k+c[a+Y],Y+=se,X-=8);for(S=k&(1<<-X)-1,k>>=-X,X+=m;X>0;S=256*S+c[a+Y],Y+=se,X-=8);if(k===0)k=1-j;else{if(k===R)return S?NaN:1/0*(pe?-1:1);S+=Math.pow(2,m),k-=j}return(pe?-1:1)*S*Math.pow(2,k-m)},H_=function(c,a,f,m,b,k){var S,M,R,j=8*k-b-1,X=(1<<j)-1,Y=X>>1,se=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,pe=m?0:k-1,ye=m?1:-1,be=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=X):(S=Math.floor(Math.log(a)/Math.LN2),a*(R=Math.pow(2,-S))<1&&(S--,R*=2),(a+=S+Y>=1?se/R:se*Math.pow(2,1-Y))*R>=2&&(S++,R/=2),S+Y>=X?(M=0,S=X):S+Y>=1?(M=(a*R-1)*Math.pow(2,b),S+=Y):(M=a*Math.pow(2,Y-1)*Math.pow(2,b),S=0));b>=8;c[f+pe]=255&M,pe+=ye,M/=256,b-=8);for(S=S<<b|M,j+=b;j>0;c[f+pe]=255&S,pe+=ye,S/=256,j-=8);c[f+pe-ye]|=128*be};function hr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}hr.Varint=0,hr.Fixed64=1,hr.Bytes=2,hr.Fixed32=5;var em=4294967296,G_=1/em,W_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qs(c){return c.type===hr.Bytes?c.readVarint()+c.pos:c.pos+1}function Iu(c,a,f){return f?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function Z_(c,a,f){var m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));f.realloc(m);for(var b=f.pos-1;b>=c;b--)f.buf[b+m]=f.buf[b]}function iA(c,a){for(var f=0;f<c.length;f++)a.writeVarint(c[f])}function oA(c,a){for(var f=0;f<c.length;f++)a.writeSVarint(c[f])}function sA(c,a){for(var f=0;f<c.length;f++)a.writeFloat(c[f])}function aA(c,a){for(var f=0;f<c.length;f++)a.writeDouble(c[f])}function lA(c,a){for(var f=0;f<c.length;f++)a.writeBoolean(c[f])}function uA(c,a){for(var f=0;f<c.length;f++)a.writeFixed32(c[f])}function cA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed32(c[f])}function fA(c,a){for(var f=0;f<c.length;f++)a.writeFixed64(c[f])}function hA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed64(c[f])}function ad(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Pu(c,a,f){c[f]=a,c[f+1]=a>>>8,c[f+2]=a>>>16,c[f+3]=a>>>24}function X_(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}hr.prototype={destroy:function(){this.buf=null},readFields:function(c,a,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),b=m>>3,k=this.pos;this.type=7&m,c(b,a,this),this.pos===k&&this.skip(m)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=ad(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=X_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=ad(this.buf,this.pos)+ad(this.buf,this.pos+4)*em;return this.pos+=8,c},readSFixed64:function(){var c=ad(this.buf,this.pos)+X_(this.buf,this.pos+4)*em;return this.pos+=8,c},readFloat:function(){var c=q_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=q_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,f,m=this.buf;return a=127&(f=m[this.pos++]),f<128?a:(a|=(127&(f=m[this.pos++]))<<7,f<128?a:(a|=(127&(f=m[this.pos++]))<<14,f<128?a:(a|=(127&(f=m[this.pos++]))<<21,f<128?a:function(b,k,S){var M,R,j=S.buf;if(M=(112&(R=j[S.pos++]))>>4,R<128||(M|=(127&(R=j[S.pos++]))<<3,R<128)||(M|=(127&(R=j[S.pos++]))<<10,R<128)||(M|=(127&(R=j[S.pos++]))<<17,R<128)||(M|=(127&(R=j[S.pos++]))<<24,R<128)||(M|=(1&(R=j[S.pos++]))<<31,R<128))return Iu(b,M,k);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(f=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&W_?function(f,m,b){return W_.decode(f.subarray(m,b))}(this.buf,a,c):function(f,m,b){for(var k="",S=m;S<b;){var M,R,j,X=f[S],Y=null,se=X>239?4:X>223?3:X>191?2:1;if(S+se>b)break;se===1?X<128&&(Y=X):se===2?(192&(M=f[S+1]))==128&&(Y=(31&X)<<6|63&M)<=127&&(Y=null):se===3?(R=f[S+2],(192&(M=f[S+1]))==128&&(192&R)==128&&((Y=(15&X)<<12|(63&M)<<6|63&R)<=2047||Y>=55296&&Y<=57343)&&(Y=null)):se===4&&(R=f[S+2],j=f[S+3],(192&(M=f[S+1]))==128&&(192&R)==128&&(192&j)==128&&((Y=(15&X)<<18|(63&M)<<12|(63&R)<<6|63&j)<=65535||Y>=1114112)&&(Y=null)),Y===null?(Y=65533,se=1):Y>65535&&(Y-=65536,k+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),k+=String.fromCharCode(Y),S+=se}return k}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==hr.Bytes)return c.push(this.readVarint(a));var f=Qs(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==hr.Bytes)return c.push(this.readSVarint());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==hr.Bytes)return c.push(this.readBoolean());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==hr.Bytes)return c.push(this.readFloat());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==hr.Bytes)return c.push(this.readDouble());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==hr.Bytes)return c.push(this.readFixed32());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==hr.Bytes)return c.push(this.readSFixed32());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==hr.Bytes)return c.push(this.readFixed64());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==hr.Bytes)return c.push(this.readSFixed64());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===hr.Varint)for(;this.buf[this.pos++]>127;);else if(a===hr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===hr.Fixed32)this.pos+=4;else{if(a!==hr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var f=new Uint8Array(a);f.set(this.buf),this.buf=f,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Pu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Pu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Pu(this.buf,-1&c,this.pos),Pu(this.buf,Math.floor(c*G_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Pu(this.buf,-1&c,this.pos),Pu(this.buf,Math.floor(c*G_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,f){var m,b;if(a>=0?(m=a%4294967296|0,b=a/4294967296|0):(b=~(-a/4294967296),4294967295^(m=~(-a%4294967296))?m=m+1|0:(m=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(k,S,M){M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,M.buf[M.pos]=127&(k>>>=7)}(m,0,f),function(k,S){var M=(7&k)<<4;S.buf[S.pos++]|=M|((k>>>=3)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k)))))}(b,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(m,b,k){for(var S,M,R=0;R<b.length;R++){if((S=b.charCodeAt(R))>55295&&S<57344){if(!M){S>56319||R+1===b.length?(m[k++]=239,m[k++]=191,m[k++]=189):M=S;continue}if(S<56320){m[k++]=239,m[k++]=191,m[k++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(m[k++]=239,m[k++]=191,m[k++]=189,M=null);S<128?m[k++]=S:(S<2048?m[k++]=S>>6|192:(S<65536?m[k++]=S>>12|224:(m[k++]=S>>18|240,m[k++]=S>>12&63|128),m[k++]=S>>6&63|128),m[k++]=63&S|128)}return k}(this.buf,c,this.pos);var f=this.pos-a;f>=128&&Z_(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),H_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),H_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var f=0;f<a;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,a){this.pos++;var f=this.pos;c(a,this);var m=this.pos-f;m>=128&&Z_(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,a,f){this.writeTag(c,hr.Bytes),this.writeRawMessage(a,f)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,iA,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,oA,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,lA,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,sA,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,aA,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,uA,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,cA,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,fA,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,hA,a)},writeBytesField:function(c,a){this.writeTag(c,hr.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,hr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,hr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,hr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,hr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,hr.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,hr.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,hr.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,hr.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,hr.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var tm=h(V_);const nm=3;function dA(c,a,f){c===1&&f.readMessage(pA,a)}function pA(c,a,f){if(c===3){const{id:m,bitmap:b,width:k,height:S,left:M,top:R,advance:j}=f.readMessage(mA,{});a.push({id:m,bitmap:new Xc({width:k+2*nm,height:S+2*nm},b),metrics:{width:k,height:S,left:M,top:R,advance:j}})}}function mA(c,a,f){c===1?a.id=f.readVarint():c===2?a.bitmap=f.readBytes():c===3?a.width=f.readVarint():c===4?a.height=f.readVarint():c===5?a.left=f.readSVarint():c===6?a.top=f.readSVarint():c===7&&(a.advance=f.readVarint())}const K_=nm;function J_(c){let a=0,f=0;for(const S of c)a+=S.w*S.h,f=Math.max(f,S.w);c.sort((S,M)=>M.h-S.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),f),h:1/0}];let b=0,k=0;for(const S of c)for(let M=m.length-1;M>=0;M--){const R=m[M];if(!(S.w>R.w||S.h>R.h)){if(S.x=R.x,S.y=R.y,k=Math.max(k,S.y+S.h),b=Math.max(b,S.x+S.w),S.w===R.w&&S.h===R.h){const j=m.pop();M<m.length&&(m[M]=j)}else S.h===R.h?(R.x+=S.w,R.w-=S.w):S.w===R.w?(R.y+=S.h,R.h-=S.h):(m.push({x:R.x+S.w,y:R.y,w:R.w-S.w,h:S.h}),R.y+=S.h,R.h-=S.h);break}}return{w:b,h:k,fill:a/(b*k)||0}}const so=1;class rm{constructor(a,{pixelRatio:f,version:m,stretchX:b,stretchY:k,content:S}){this.paddedRect=a,this.pixelRatio=f,this.stretchX=b,this.stretchY=k,this.content=S,this.version=m}get tl(){return[this.paddedRect.x+so,this.paddedRect.y+so]}get br(){return[this.paddedRect.x+this.paddedRect.w-so,this.paddedRect.y+this.paddedRect.h-so]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*so)/this.pixelRatio,(this.paddedRect.h-2*so)/this.pixelRatio]}}class Y_{constructor(a,f){const m={},b={};this.haveRenderCallbacks=[];const k=[];this.addImages(a,m,k),this.addImages(f,b,k);const{w:S,h:M}=J_(k),R=new Lo({width:S||1,height:M||1});for(const j in a){const X=a[j],Y=m[j].paddedRect;Lo.copy(X.data,R,{x:0,y:0},{x:Y.x+so,y:Y.y+so},X.data)}for(const j in f){const X=f[j],Y=b[j].paddedRect,se=Y.x+so,pe=Y.y+so,ye=X.data.width,be=X.data.height;Lo.copy(X.data,R,{x:0,y:0},{x:se,y:pe},X.data),Lo.copy(X.data,R,{x:0,y:be-1},{x:se,y:pe-1},{width:ye,height:1}),Lo.copy(X.data,R,{x:0,y:0},{x:se,y:pe+be},{width:ye,height:1}),Lo.copy(X.data,R,{x:ye-1,y:0},{x:se-1,y:pe},{width:1,height:be}),Lo.copy(X.data,R,{x:0,y:0},{x:se+ye,y:pe},{width:1,height:be})}this.image=R,this.iconPositions=m,this.patternPositions=b}addImages(a,f,m){for(const b in a){const k=a[b],S={x:0,y:0,w:k.data.width+2*so,h:k.data.height+2*so};m.push(S),f[b]=new rm(S,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,f){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),f),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),f)}patchUpdatedImage(a,f,m){if(!a||!f||a.version===f.version)return;a.version=f.version;const[b,k]=a.tl;m.update(f.data,void 0,{x:b,y:k})}}var Ea;Zt("ImagePosition",rm),Zt("ImageAtlas",Y_),u.ah=void 0,(Ea=u.ah||(u.ah={}))[Ea.none=0]="none",Ea[Ea.horizontal=1]="horizontal",Ea[Ea.vertical=2]="vertical",Ea[Ea.horizontalOnly=3]="horizontalOnly";const rf=-17;class of{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,f){const m=new of;return m.scale=a||1,m.fontStack=f,m}static forImage(a){const f=new of;return f.imageName=a,f}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,f){const m=new zu;for(let b=0;b<a.sections.length;b++){const k=a.sections[b];k.image?m.addImageSection(k):m.addTextSection(k,f)}return m}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let f="";for(let m=0;m<a.length;m++){const b=a.charCodeAt(m+1)||null,k=a.charCodeAt(m-1)||null;f+=b&&Ic(b)&&!nf[a[m+1]]||k&&Ic(k)&&!nf[a[m-1]]||!nf[a[m]]?a[m]:nf[a[m]]}return f}(this.text)}trim(){let a=0;for(let m=0;m<this.text.length&&ud[this.text.charCodeAt(m)];m++)a++;let f=this.text.length;for(let m=this.text.length-1;m>=0&&m>=a&&ud[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)}substring(a,f){const m=new zu;return m.text=this.text.substring(a,f),m.sectionIndex=this.sectionIndex.slice(a,f),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,f)=>Math.max(a,this.sections[f].scale),0)}addTextSection(a,f){this.text+=a.text,this.sections.push(of.forText(a.scale,a.fontStack||f));const m=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(m)}addImageSection(a){const f=a.image?a.image.name:"";if(f.length===0)return void xe("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(of.forImage(f)),this.sectionIndex.push(this.sections.length-1)):xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ld(c,a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye,be){const Ce=zu.fromFeature(c,b);let Pe;Y===u.ah.vertical&&Ce.verticalizePunctuation();const{processBidirectionalText:Ze,processStyledBidirectionalText:Re}=Ls;if(Ze&&Ce.sections.length===1){Pe=[];const vt=Ze(Ce.toString(),im(Ce,j,k,a,m,pe,ye));for(const Ht of vt){const tn=new zu;tn.text=Ht,tn.sections=Ce.sections;for(let qt=0;qt<Ht.length;qt++)tn.sectionIndex.push(0);Pe.push(tn)}}else if(Re){Pe=[];const vt=Re(Ce.text,Ce.sectionIndex,im(Ce,j,k,a,m,pe,ye));for(const Ht of vt){const tn=new zu;tn.text=Ht[0],tn.sectionIndex=Ht[1],tn.sections=Ce.sections,Pe.push(tn)}}else Pe=function(vt,Ht){const tn=[],qt=vt.text;let Ut=0;for(const Ft of Ht)tn.push(vt.substring(Ut,Ft)),Ut=Ft;return Ut<qt.length&&tn.push(vt.substring(Ut,qt.length)),tn}(Ce,im(Ce,j,k,a,m,pe,ye));const Ne=[],dt={positionedLines:Ne,text:Ce.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(vt,Ht,tn,qt,Ut,Ft,Xt,Nt,It,fn,on,Bn){let xr=0,Ir=rf,li=0,_o=0;const Vi=Nt==="right"?1:Nt==="left"?0:.5;let ei=0;for(const ui of Ut){ui.trim();const ci=ui.getMaxScale(),Ii=(ci-1)*ai,Gi={positionedGlyphs:[],lineOffset:0};vt.positionedLines[ei]=Gi;const Pi=Gi.positionedGlyphs;let ao=0;if(!ui.length()){Ir+=Ft,++ei;continue}for(let fi=0;fi<ui.length();fi++){const jn=ui.getSection(fi),zi=ui.getSectionIndex(fi),Ci=ui.getCharCode(fi);let hi=0,Jo=null,hs=null,ds=null,ea=ai;const Yo=!(It===u.ah.horizontal||!on&&!pu(Ci)||on&&(ud[Ci]||(yi=Ci,Vt.Arabic(yi)||Vt["Arabic Supplement"](yi)||Vt["Arabic Extended-A"](yi)||Vt["Arabic Presentation Forms-A"](yi)||Vt["Arabic Presentation Forms-B"](yi))));if(jn.imageName){const Po=qt[jn.imageName];if(!Po)continue;ds=jn.imageName,vt.iconsInText=vt.iconsInText||!0,hs=Po.paddedRect;const uo=Po.displaySize;jn.scale=jn.scale*ai/Bn,Jo={width:uo[0],height:uo[1],left:so,top:-K_,advance:Yo?uo[1]:uo[0]},hi=Ii+(ai-uo[1]*jn.scale),ea=Jo.advance;const ta=Yo?uo[0]*jn.scale-ai*ci:uo[1]*jn.scale-ai*ci;ta>0&&ta>ao&&(ao=ta)}else{const Po=tn[jn.fontStack],uo=Po&&Po[Ci];if(uo&&uo.rect)hs=uo.rect,Jo=uo.metrics;else{const ta=Ht[jn.fontStack],cf=ta&&ta[Ci];if(!cf)continue;Jo=cf.metrics}hi=(ci-jn.scale)*ai}Yo?(vt.verticalizable=!0,Pi.push({glyph:Ci,imageName:ds,x:xr,y:Ir+hi,vertical:Yo,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:zi,metrics:Jo,rect:hs}),xr+=ea*jn.scale+fn):(Pi.push({glyph:Ci,imageName:ds,x:xr,y:Ir+hi,vertical:Yo,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:zi,metrics:Jo,rect:hs}),xr+=Jo.advance*jn.scale+fn)}Pi.length!==0&&(li=Math.max(xr-fn,li),yA(Pi,0,Pi.length-1,Vi,ao)),xr=0;const lo=Ft*ci+ao;Gi.lineOffset=Math.max(ao,Ii),Ir+=lo,_o=Math.max(lo,_o),++ei}var yi;const Si=Ir-rf,{horizontalAlign:qi,verticalAlign:Hi}=om(Xt);(function(ui,ci,Ii,Gi,Pi,ao,lo,fi,jn){const zi=(ci-Ii)*Pi;let Ci=0;Ci=ao!==lo?-fi*Gi-rf:(-Gi*jn+.5)*lo;for(const hi of ui)for(const Jo of hi.positionedGlyphs)Jo.x+=zi,Jo.y+=Ci})(vt.positionedLines,Vi,qi,Hi,li,_o,Ft,Si,Ut.length),vt.top+=-Hi*Si,vt.bottom=vt.top+Si,vt.left+=-qi*li,vt.right=vt.left+li}(dt,a,f,m,Pe,S,M,R,Y,j,se,be),!function(vt){for(const Ht of vt)if(Ht.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&dt}const ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Q_(c,a,f,m,b,k){if(a.imageName){const S=m[a.imageName];return S?S.displaySize[0]*a.scale*ai/k+b:0}{const S=f[a.fontStack],M=S&&S[c];return M?M.metrics.advance*a.scale+b:0}}function e0(c,a,f,m){const b=Math.pow(c-a,2);return m?c<a?b/2:2*b:b+Math.abs(f)*f}function _A(c,a,f){let m=0;return c===10&&(m-=1e4),f&&(m+=150),c!==40&&c!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function t0(c,a,f,m,b,k){let S=null,M=e0(a,f,b,k);for(const R of m){const j=e0(a-R.x,f,b,k)+R.badness;j<=M&&(S=R,M=j)}return{index:c,x:a,priorBreak:S,badness:M}}function n0(c){return c?n0(c.priorBreak).concat(c.index):[]}function im(c,a,f,m,b,k,S){if(k!=="point")return[];if(!c)return[];const M=[],R=function(se,pe,ye,be,Ce,Pe){let Ze=0;for(let Re=0;Re<se.length();Re++){const Ne=se.getSection(Re);Ze+=Q_(se.getCharCode(Re),Ne,be,Ce,pe,Pe)}return Ze/Math.max(1,Math.ceil(Ze/ye))}(c,a,f,m,b,S),j=c.text.indexOf("​")>=0;let X=0;for(let se=0;se<c.length();se++){const pe=c.getSection(se),ye=c.getCharCode(se);if(ud[ye]||(X+=Q_(ye,pe,m,b,a,S)),se<c.length()-1){const be=!((Y=ye)<11904||!(Vt["Bopomofo Extended"](Y)||Vt.Bopomofo(Y)||Vt["CJK Compatibility Forms"](Y)||Vt["CJK Compatibility Ideographs"](Y)||Vt["CJK Compatibility"](Y)||Vt["CJK Radicals Supplement"](Y)||Vt["CJK Strokes"](Y)||Vt["CJK Symbols and Punctuation"](Y)||Vt["CJK Unified Ideographs Extension A"](Y)||Vt["CJK Unified Ideographs"](Y)||Vt["Enclosed CJK Letters and Months"](Y)||Vt["Halfwidth and Fullwidth Forms"](Y)||Vt.Hiragana(Y)||Vt["Ideographic Description Characters"](Y)||Vt["Kangxi Radicals"](Y)||Vt["Katakana Phonetic Extensions"](Y)||Vt.Katakana(Y)||Vt["Vertical Forms"](Y)||Vt["Yi Radicals"](Y)||Vt["Yi Syllables"](Y)));(gA[ye]||be||pe.imageName)&&M.push(t0(se+1,X,R,M,_A(ye,c.getCharCode(se+1),be&&j),!1))}}var Y;return n0(t0(c.length(),X,R,M,0,!0))}function om(c){let a=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:a,verticalAlign:f}}function yA(c,a,f,m,b){if(!m&&!b)return;const k=c[f],S=(c[f].x+k.metrics.advance*k.scale)*m;for(let M=a;M<=f;M++)c[M].x-=S,c[M].y+=b}function vA(c,a,f){const{horizontalAlign:m,verticalAlign:b}=om(f),k=a[0]-c.displaySize[0]*m,S=a[1]-c.displaySize[1]*b;return{image:c,top:S,bottom:S+c.displaySize[1],left:k,right:k+c.displaySize[0]}}function r0(c,a,f,m,b,k){const S=c.image;let M;if(S.content){const Ce=S.content,Pe=S.pixelRatio||1;M=[Ce[0]/Pe,Ce[1]/Pe,S.displaySize[0]-Ce[2]/Pe,S.displaySize[1]-Ce[3]/Pe]}const R=a.left*k,j=a.right*k;let X,Y,se,pe;f==="width"||f==="both"?(pe=b[0]+R-m[3],Y=b[0]+j+m[1]):(pe=b[0]+(R+j-S.displaySize[0])/2,Y=pe+S.displaySize[0]);const ye=a.top*k,be=a.bottom*k;return f==="height"||f==="both"?(X=b[1]+ye-m[0],se=b[1]+be+m[2]):(X=b[1]+(ye+be-S.displaySize[1])/2,se=X+S.displaySize[1]),{image:S,top:X,right:Y,bottom:se,left:pe,collisionPadding:M}}const sf=255,Ds=128,La=sf*Ds;function i0(c,a){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Er(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=f;let k=0;for(;k<m.length&&m[k]<=c;)k++;k=Math.max(0,k-1);let S=k;for(;S<m.length&&m[S]<c+1;)S++;S=Math.min(m.length-1,S);const M=m[k],R=m[S];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:R,minSize:f.evaluate(new Er(M)),maxSize:f.evaluate(new Er(R)),interpolationType:b}}}function sm(c,a,f){let m="never";const b=c.get(a);return b?m=b:c.get(f)&&(m="always"),m}const bA=Ma.VectorTileFeature.types,wA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function cd(c,a,f,m,b,k,S,M,R,j,X,Y,se){const pe=M?Math.min(La,Math.round(M[0])):0,ye=M?Math.min(La,Math.round(M[1])):0;c.emplaceBack(a,f,Math.round(32*m),Math.round(32*b),k,S,(pe<<1)+(R?1:0),ye,16*j,16*X,256*Y,256*se)}function am(c,a,f){c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f)}function xA(c){for(const a of c.sections)if(Op(a.text))return!0;return!1}class lm{constructor(a){this.layoutVertexArray=new et,this.indexArray=new ft,this.programConfigurations=a,this.segments=new Ot,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new d}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,f,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Qx.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,eA.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,wA,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",lm);class um{constructor(a,f,m){this.layoutVertexArray=new a,this.layoutAttributes=f,this.indexArray=new m,this.segments=new Ot,this.collisionVertexArray=new ot}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,tA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",um);class Du{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(S=>S.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Np([]),this.placementViewportMatrix=Np([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i0(this.zoom,f["text-size"]),this.iconSizeData=i0(this.zoom,f["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),k=m.get("symbol-z-order");this.canOverlap=sm(m,"text-overlap","text-allow-overlap")!=="never"||sm(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=k!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(k==="viewport-y"||k==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(S=>u.ah[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=a.sourceID}createArrays(){this.text=new lm(new Fr(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new lm(new Fr(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new A,this.lineVertexArray=new P,this.symbolInstances=new v,this.textAnchorOffsets=new $}calculateGlyphDependencies(a,f,m,b,k){for(let S=0;S<a.length;S++)if(f[a.charCodeAt(S)]=!0,(m||b)&&k){const M=nf[a.charAt(S)];M&&(f[M.charCodeAt(0)]=!0)}}populate(a,f,m){const b=this.layers[0],k=b.layout,S=k.get("text-font"),M=k.get("text-field"),R=k.get("icon-image"),j=(M.value.kind!=="constant"||M.value.value instanceof to&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),X=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,Y=k.get("symbol-sort-key");if(this.features=[],!j&&!X)return;const se=f.iconDependencies,pe=f.glyphDependencies,ye=f.availableImages,be=new Er(this.zoom);for(const{feature:Ce,id:Pe,index:Ze,sourceLayerIndex:Re}of a){const Ne=b._featureFilter.needGeometry,dt=Ys(Ce,Ne);if(!b._featureFilter.filter(be,dt,m))continue;let vt,Ht;if(Ne||(dt.geometry=Js(Ce)),j){const qt=b.getValueAndResolveTokens("text-field",dt,m,ye),Ut=to.factory(qt),Ft=this.hasRTLText=this.hasRTLText||xA(Ut);(!Ft||Ls.getRTLTextPluginStatus()==="unavailable"||Ft&&Ls.isParsed())&&(vt=rA(Ut,b,dt))}if(X){const qt=b.getValueAndResolveTokens("icon-image",dt,m,ye);Ht=qt instanceof po?qt:po.fromString(qt)}if(!vt&&!Ht)continue;const tn=this.sortFeaturesByKey?Y.evaluate(dt,{},m):void 0;if(this.features.push({id:Pe,text:vt,icon:Ht,index:Ze,sourceLayerIndex:Re,geometry:dt.geometry,properties:Ce.properties,type:bA[Ce.type],sortKey:tn}),Ht&&(se[Ht.name]=!0),vt){const qt=S.evaluate(dt,{},m).join(","),Ut=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Ft of vt.sections)if(Ft.image)se[Ft.image.name]=!0;else{const Xt=Ca(vt.toString()),Nt=Ft.fontStack||qt,It=pe[Nt]=pe[Nt]||{};this.calculateGlyphDependencies(Ft.text,It,Ut,this.allowVerticalPlacement,Xt)}}}k.get("symbol-placement")==="line"&&(this.features=function(Ce){const Pe={},Ze={},Re=[];let Ne=0;function dt(qt){Re.push(Ce[qt]),Ne++}function vt(qt,Ut,Ft){const Xt=Ze[qt];return delete Ze[qt],Ze[Ut]=Xt,Re[Xt].geometry[0].pop(),Re[Xt].geometry[0]=Re[Xt].geometry[0].concat(Ft[0]),Xt}function Ht(qt,Ut,Ft){const Xt=Pe[Ut];return delete Pe[Ut],Pe[qt]=Xt,Re[Xt].geometry[0].shift(),Re[Xt].geometry[0]=Ft[0].concat(Re[Xt].geometry[0]),Xt}function tn(qt,Ut,Ft){const Xt=Ft?Ut[0][Ut[0].length-1]:Ut[0][0];return`${qt}:${Xt.x}:${Xt.y}`}for(let qt=0;qt<Ce.length;qt++){const Ut=Ce[qt],Ft=Ut.geometry,Xt=Ut.text?Ut.text.toString():null;if(!Xt){dt(qt);continue}const Nt=tn(Xt,Ft),It=tn(Xt,Ft,!0);if(Nt in Ze&&It in Pe&&Ze[Nt]!==Pe[It]){const fn=Ht(Nt,It,Ft),on=vt(Nt,It,Re[fn].geometry);delete Pe[Nt],delete Ze[It],Ze[tn(Xt,Re[on].geometry,!0)]=on,Re[fn].geometry=null}else Nt in Ze?vt(Nt,It,Ft):It in Pe?Ht(Nt,It,Ft):(dt(qt),Pe[Nt]=Ne-1,Ze[It]=Ne-1)}return Re.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Pe)=>Ce.sortKey-Pe.sortKey)}update(a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,f,this.layers,m),this.icon.programConfigurations.updatePaintArrays(a,f,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,f){const m=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(f[a.segment+1]),k=a.dist(f[a.segment]);const S={};for(let M=a.segment+1;M<f.length;M++)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:b},M<f.length-1&&(b+=f[M+1].dist(f[M]));for(let M=a.segment||0;M>=0;M--)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:k},M>0&&(k+=f[M-1].dist(f[M]));for(let M=0;M<f.length;M++){const R=S[M];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,f,m,b,k,S,M,R,j,X,Y,se){const pe=a.indexArray,ye=a.layoutVertexArray,be=a.segments.prepareSegment(4*f.length,ye,pe,this.canOverlap?S.sortKey:void 0),Ce=this.glyphOffsetArray.length,Pe=be.vertexLength,Ze=this.allowVerticalPlacement&&M===u.ah.vertical?Math.PI/2:0,Re=S.text&&S.text.sections;for(let Ne=0;Ne<f.length;Ne++){const{tl:dt,tr:vt,bl:Ht,br:tn,tex:qt,pixelOffsetTL:Ut,pixelOffsetBR:Ft,minFontScaleX:Xt,minFontScaleY:Nt,glyphOffset:It,isSDF:fn,sectionIndex:on}=f[Ne],Bn=be.vertexLength,xr=It[1];cd(ye,R.x,R.y,dt.x,xr+dt.y,qt.x,qt.y,m,fn,Ut.x,Ut.y,Xt,Nt),cd(ye,R.x,R.y,vt.x,xr+vt.y,qt.x+qt.w,qt.y,m,fn,Ft.x,Ut.y,Xt,Nt),cd(ye,R.x,R.y,Ht.x,xr+Ht.y,qt.x,qt.y+qt.h,m,fn,Ut.x,Ft.y,Xt,Nt),cd(ye,R.x,R.y,tn.x,xr+tn.y,qt.x+qt.w,qt.y+qt.h,m,fn,Ft.x,Ft.y,Xt,Nt),am(a.dynamicLayoutVertexArray,R,Ze),pe.emplaceBack(Bn,Bn+1,Bn+2),pe.emplaceBack(Bn+1,Bn+2,Bn+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),Ne!==f.length-1&&on===f[Ne+1].sectionIndex||a.programConfigurations.populatePaintArrays(ye.length,S,S.index,{},se,Re&&Re[on])}a.placedSymbolArray.emplaceBack(R.x,R.y,Ce,this.glyphOffsetArray.length-Ce,Pe,j,X,R.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],M,0,!1,0,Y)}_addCollisionDebugVertex(a,f,m,b,k,S){return f.emplaceBack(0,0),a.emplaceBack(m.x,m.y,b,k,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(a,f,m,b,k,S,M){const R=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),j=R.vertexLength,X=k.layoutVertexArray,Y=k.collisionVertexArray,se=M.anchorX,pe=M.anchorY;this._addCollisionDebugVertex(X,Y,S,se,pe,new _(a,f)),this._addCollisionDebugVertex(X,Y,S,se,pe,new _(m,f)),this._addCollisionDebugVertex(X,Y,S,se,pe,new _(m,b)),this._addCollisionDebugVertex(X,Y,S,se,pe,new _(a,b)),R.vertexLength+=4;const ye=k.indexArray;ye.emplaceBack(j,j+1),ye.emplaceBack(j+1,j+2),ye.emplaceBack(j+2,j+3),ye.emplaceBack(j+3,j),R.primitiveLength+=4}addDebugCollisionBoxes(a,f,m,b){for(let k=a;k<f;k++){const S=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,b?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new um(it,U_.members,Ct),this.iconCollisionBox=new um(it,U_.members,Ct);for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(a,f,m,b,k,S,M,R,j){const X={};for(let Y=f;Y<m;Y++){const se=a.get(Y);X.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.textFeatureIndex=se.featureIndex;break}for(let Y=b;Y<k;Y++){const se=a.get(Y);X.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.verticalTextFeatureIndex=se.featureIndex;break}for(let Y=S;Y<M;Y++){const se=a.get(Y);X.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.iconFeatureIndex=se.featureIndex;break}for(let Y=R;Y<j;Y++){const se=a.get(Y);X.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.verticalIconFeatureIndex=se.featureIndex;break}return X}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,f){const m=a.placedSymbolArray.get(f),b=m.vertexStartIndex+4*m.numGlyphs;for(let k=m.vertexStartIndex;k<b;k+=4)a.indexArray.emplaceBack(k,k+1,k+2),a.indexArray.emplaceBack(k+1,k+2,k+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(a),m=Math.cos(a),b=[],k=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const R=this.symbolInstances.get(M);b.push(0|Math.round(f*R.anchorX+m*R.anchorY)),k.push(R.featureIndex)}return S.sort((M,R)=>b[M]-b[R]||k[R]-k[M]),S}addToSortKeyRanges(a,f){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===f?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const m=this.symbolInstances.get(f);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,k,S)=>{b>=0&&S.indexOf(b)===k&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let o0,s0;Zt("SymbolBucket",Du,{omit:["layers","collisionBoxArray","features","compareText"]}),Du.MAX_GLYPHS=65535,Du.addDynamicAttributes=am;var cm={get paint(){return s0=s0||new ji({"icon-opacity":new hn(de.paint_symbol["icon-opacity"]),"icon-color":new hn(de.paint_symbol["icon-color"]),"icon-halo-color":new hn(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new hn(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hn(de.paint_symbol["icon-halo-blur"]),"icon-translate":new sn(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new sn(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new hn(de.paint_symbol["text-opacity"]),"text-color":new hn(de.paint_symbol["text-color"],{runtimeType:Rt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new hn(de.paint_symbol["text-halo-color"]),"text-halo-width":new hn(de.paint_symbol["text-halo-width"]),"text-halo-blur":new hn(de.paint_symbol["text-halo-blur"]),"text-translate":new sn(de.paint_symbol["text-translate"]),"text-translate-anchor":new sn(de.paint_symbol["text-translate-anchor"])})},get layout(){return o0=o0||new ji({"symbol-placement":new sn(de.layout_symbol["symbol-placement"]),"symbol-spacing":new sn(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sn(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hn(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sn(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sn(de.layout_symbol["icon-allow-overlap"]),"icon-overlap":new sn(de.layout_symbol["icon-overlap"]),"icon-ignore-placement":new sn(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new sn(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sn(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new hn(de.layout_symbol["icon-size"]),"icon-text-fit":new sn(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new hn(de.layout_symbol["icon-image"]),"icon-rotate":new hn(de.layout_symbol["icon-rotate"]),"icon-padding":new hn(de.layout_symbol["icon-padding"]),"icon-keep-upright":new sn(de.layout_symbol["icon-keep-upright"]),"icon-offset":new hn(de.layout_symbol["icon-offset"]),"icon-anchor":new hn(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sn(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sn(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sn(de.layout_symbol["text-rotation-alignment"]),"text-field":new hn(de.layout_symbol["text-field"]),"text-font":new hn(de.layout_symbol["text-font"]),"text-size":new hn(de.layout_symbol["text-size"]),"text-max-width":new hn(de.layout_symbol["text-max-width"]),"text-line-height":new sn(de.layout_symbol["text-line-height"]),"text-letter-spacing":new hn(de.layout_symbol["text-letter-spacing"]),"text-justify":new hn(de.layout_symbol["text-justify"]),"text-radial-offset":new hn(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sn(de.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new hn(de.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new hn(de.layout_symbol["text-anchor"]),"text-max-angle":new sn(de.layout_symbol["text-max-angle"]),"text-writing-mode":new sn(de.layout_symbol["text-writing-mode"]),"text-rotate":new hn(de.layout_symbol["text-rotate"]),"text-padding":new sn(de.layout_symbol["text-padding"]),"text-keep-upright":new sn(de.layout_symbol["text-keep-upright"]),"text-transform":new hn(de.layout_symbol["text-transform"]),"text-offset":new hn(de.layout_symbol["text-offset"]),"text-allow-overlap":new sn(de.layout_symbol["text-allow-overlap"]),"text-overlap":new sn(de.layout_symbol["text-overlap"]),"text-ignore-placement":new sn(de.layout_symbol["text-ignore-placement"]),"text-optional":new sn(de.layout_symbol["text-optional"])})}};class a0{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:$n,this.defaultValue=a}evaluate(a){if(a.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(a.formattedSection))return f.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",a0,{omit:["defaultValue"]});class fd extends Eo{constructor(a){super(a,cm)}recalculate(a,f){if(super.recalculate(a,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const k of m)b.indexOf(k)<0&&b.push(k);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,f,m,b){const k=this.layout.get(a).evaluate(f,{},m,b),S=this._unevaluatedLayout._values[a];return S.isDataDriven()||pr(S.value)||!k?k:function(M,R){return R.replace(/{([^{}]+)}/g,(j,X)=>M&&X in M?String(M[X]):"")}(f.properties,k)}createBucket(a){return new Du(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of cm.paint.overridableProperties){if(!fd.hasPaintOverride(this.layout,a))continue;const f=this.paint.get(a),m=new a0(f),b=new wr(m,f.property.specification);let k=null;k=f.value.kind==="constant"||f.value.kind==="source"?new ru("source",b):new xc("composite",b,f.value.zoomStops),this.paint._values[a]=new Mo(f.property,k,f.parameters)}}_handleOverridablePaintPropertyUpdate(a,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&fd.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,f){const m=a.get("text-field"),b=cm.paint.properties[f];let k=!1;const S=M=>{for(const R of M)if(b.overrides&&b.overrides.hasOverride(R))return void(k=!0)};if(m.value.kind==="constant"&&m.value.value instanceof to)S(m.value.value.sections);else if(m.value.kind==="source"){const M=j=>{k||(j instanceof Ss&&Kr(j.value)===or?S(j.value.sections):j instanceof tu?S(j.sections):j.eachChild(M))},R=m.value;R._styleExpression&&M(R._styleExpression.expression)}return k}}let l0;var AA={get paint(){return l0=l0||new ji({"background-color":new sn(de.paint_background["background-color"]),"background-pattern":new yl(de.paint_background["background-pattern"]),"background-opacity":new sn(de.paint_background["background-opacity"])})}};class kA extends Eo{constructor(a){super(a,AA)}}let u0;var SA={get paint(){return u0=u0||new ji({"raster-opacity":new sn(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new sn(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sn(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sn(de.paint_raster["raster-brightness-max"]),"raster-saturation":new sn(de.paint_raster["raster-saturation"]),"raster-contrast":new sn(de.paint_raster["raster-contrast"]),"raster-resampling":new sn(de.paint_raster["raster-resampling"]),"raster-fade-duration":new sn(de.paint_raster["raster-fade-duration"])})}};class CA extends Eo{constructor(a){super(a,SA)}}class TA extends Eo{constructor(a){super(a,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class MA{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fm=63710088e-1;class Ia{constructor(a,f){if(isNaN(a)||isNaN(f))throw new Error(`Invalid LngLat object: (${a}, ${f})`);if(this.lng=+a,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ia(H(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const f=Math.PI/180,m=this.lat*f,b=a.lat*f,k=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((a.lng-this.lng)*f);return fm*Math.acos(Math.min(k,1))}static convert(a){if(a instanceof Ia)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ia(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ia(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const c0=2*Math.PI*fm;function f0(c){return c0*Math.cos(c*Math.PI/180)}function h0(c){return(180+c)/360}function d0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function p0(c,a){return c/f0(a)}function hm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class hd{constructor(a,f,m=0){this.x=+a,this.y=+f,this.z=+m}static fromLngLat(a,f=0){const m=Ia.convert(a);return new hd(h0(m.lng),d0(m.lat),p0(f,m.lat))}toLngLat(){return new Ia(360*this.x-180,hm(this.y))}toAltitude(){return this.z*f0(hm(this.y))}meterInMercatorCoordinateUnits(){return 1/c0*(a=hm(this.y),1/Math.cos(a*Math.PI/180));var a}}function m0(c,a,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[c*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class dm{constructor(a,f,m){if(a<0||a>25||m<0||m>=Math.pow(2,a)||f<0||f>=Math.pow(2,a))throw new Error(`x=${f}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=f,this.y=m,this.key=af(0,a,a,f,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,f,m){const b=(S=this.y,M=this.z,R=m0(256*(k=this.x),256*(S=Math.pow(2,M)-S-1),M),j=m0(256*(k+1),256*(S+1),M),R[0]+","+R[1]+","+j[0]+","+j[1]);var k,S,M,R,j;const X=function(Y,se,pe){let ye,be="";for(let Ce=Y;Ce>0;Ce--)ye=1<<Ce-1,be+=(se&ye?1:0)+(pe&ye?2:0);return be}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,X).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const f=this.z-a.z;return f>0&&a.x===this.x>>f&&a.y===this.y>>f}getTilePoint(a){const f=Math.pow(2,this.z);return new _((a.x*f-this.x)*qr,(a.y*f-this.y)*qr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class g0{constructor(a,f){this.wrap=a,this.canonical=f,this.key=af(a,f.z,f.z,f.x,f.y)}}class Io{constructor(a,f,m,b,k){if(a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=f,this.canonical=new dm(m,+b,+k),this.key=af(f,a,m,b,k)}clone(){return new Io(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?new Io(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Io(a,this.wrap,a,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(a,f){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?af(this.wrap*+f,a,this.canonical.z,this.canonical.x,this.canonical.y):af(this.wrap*+f,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const f=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>f&&a.canonical.y===this.canonical.y>>f}children(a){if(this.overscaledZ>=a)return[new Io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new Io(f,this.wrap,f,m,b),new Io(f,this.wrap,f,m+1,b),new Io(f,this.wrap,f,m,b+1),new Io(f,this.wrap,f,m+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Io(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new g0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new hd(a.x-this.wrap,a.y))}}function af(c,a,f,m,b){(c*=2)<0&&(c=-1*c-1);const k=1<<f;return(k*k*c+k*b+m).toString(36)+f.toString(36)+a.toString(36)}Zt("CanonicalTileID",dm),Zt("OverscaledTileID",Io,{omit:["posMatrix"]});class _0{constructor(a,f,m,b=1,k=1,S=1,M=0){if(this.uid=a,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void xe(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const R=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=k,this.blueFactor=S,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<R;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(R,j)]=this.data[this._idx(R-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,R)]=this.data[this._idx(j,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<R;j++)for(let X=0;X<R;X++){const Y=this.get(j,X);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(a,f){const m=new Uint8Array(this.data.buffer),b=4*this._idx(a,f);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,f){if(a<-1||a>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(a+1)}unpack(a,f,m){return a*this.redFactor+f*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,f,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=f*this.dim,k=f*this.dim+this.dim,S=m*this.dim,M=m*this.dim+this.dim;switch(f){case-1:b=k-1;break;case 1:k=b+1}switch(m){case-1:S=M-1;break;case 1:M=S+1}const R=-f*this.dim,j=-m*this.dim;for(let X=S;X<M;X++)for(let Y=b;Y<k;Y++)this.data[this._idx(Y,X)]=a.data[this._idx(Y+R,X+j)]}}Zt("DEMData",_0);class y0{constructor(a){this._stringToNumber={},this._numberToString=[];for(let f=0;f<a.length;f++){const m=a[f];this._stringToNumber[m]=f,this._numberToString[f]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class v0{constructor(a,f,m,b,k){this.type="Feature",this._vectorTileFeature=a,a._z=f,a._x=m,a._y=b,this.properties=a.properties,this.id=k}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(a[f]=this[f]);return a}}class b0{constructor(a,f){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new ml(qr,16,0),this.grid3D=new ml(qr,16,0),this.featureIndexArray=new Q,this.promoteId=f}insert(a,f,m,b,k,S){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,k);const R=S?this.grid3D:this.grid;for(let j=0;j<f.length;j++){const X=f[j],Y=[1/0,1/0,-1/0,-1/0];for(let se=0;se<X.length;se++){const pe=X[se];Y[0]=Math.min(Y[0],pe.x),Y[1]=Math.min(Y[1],pe.y),Y[2]=Math.max(Y[2],pe.x),Y[3]=Math.max(Y[3],pe.y)}Y[0]<qr&&Y[1]<qr&&Y[2]>=0&&Y[3]>=0&&R.insert(M,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ma.VectorTile(new tm(this.rawTileData)).layers,this.sourceLayerCoder=new y0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,f,m,b){this.loadVTLayers();const k=a.params||{},S=qr/a.tileSize/a.scale,M=au(k.filter),R=a.queryGeometry,j=a.queryPadding*S,X=x0(R),Y=this.grid.query(X.minX-j,X.minY-j,X.maxX+j,X.maxY+j),se=x0(a.cameraQueryGeometry),pe=this.grid3D.query(se.minX-j,se.minY-j,se.maxX+j,se.maxY+j,(Ce,Pe,Ze,Re)=>function(Ne,dt,vt,Ht,tn){for(const Ut of Ne)if(dt<=Ut.x&&vt<=Ut.y&&Ht>=Ut.x&&tn>=Ut.y)return!0;const qt=[new _(dt,vt),new _(dt,tn),new _(Ht,tn),new _(Ht,vt)];if(Ne.length>2){for(const Ut of qt)if(Tu(Ne,Ut))return!0}for(let Ut=0;Ut<Ne.length-1;Ut++)if(sx(Ne[Ut],Ne[Ut+1],qt))return!0;return!1}(a.cameraQueryGeometry,Ce-j,Pe-j,Ze+j,Re+j));for(const Ce of pe)Y.push(Ce);Y.sort(EA);const ye={};let be;for(let Ce=0;Ce<Y.length;Ce++){const Pe=Y[Ce];if(Pe===be)continue;be=Pe;const Ze=this.featureIndexArray.get(Pe);let Re=null;this.loadMatchingFeature(ye,Ze.bucketIndex,Ze.sourceLayerIndex,Ze.featureIndex,M,k.layers,k.availableImages,f,m,b,(Ne,dt,vt)=>(Re||(Re=Js(Ne)),dt.queryIntersectsFeature(R,Ne,vt,Re,this.z,a.transform,S,a.pixelPosMatrix)))}return ye}loadMatchingFeature(a,f,m,b,k,S,M,R,j,X,Y){const se=this.bucketLayerIDs[f];if(S&&!function(Ce,Pe){for(let Ze=0;Ze<Ce.length;Ze++)if(Pe.indexOf(Ce[Ze])>=0)return!0;return!1}(S,se))return;const pe=this.sourceLayerCoder.decode(m),ye=this.vtLayers[pe].feature(b);if(k.needGeometry){const Ce=Ys(ye,!0);if(!k.filter(new Er(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!k.filter(new Er(this.tileID.overscaledZ),ye))return;const be=this.getId(ye,pe);for(let Ce=0;Ce<se.length;Ce++){const Pe=se[Ce];if(S&&S.indexOf(Pe)<0)continue;const Ze=R[Pe];if(!Ze)continue;let Re={};be&&X&&(Re=X.getState(Ze.sourceLayer||"_geojsonTileLayer",be));const Ne=q({},j[Pe]);Ne.paint=w0(Ne.paint,Ze.paint,ye,Re,M),Ne.layout=w0(Ne.layout,Ze.layout,ye,Re,M);const dt=!Y||Y(ye,Ze,Re);if(!dt)continue;const vt=new v0(ye,this.z,this.x,this.y,be);vt.layer=Ne;let Ht=a[Pe];Ht===void 0&&(Ht=a[Pe]=[]),Ht.push({featureIndex:b,feature:vt,intersectionZ:dt})}}lookupSymbolFeatures(a,f,m,b,k,S,M,R){const j={};this.loadVTLayers();const X=au(k);for(const Y of a)this.loadMatchingFeature(j,m,b,Y,X,S,M,R,f);return j}hasLayer(a){for(const f of this.bucketLayerIDs)for(const m of f)if(a===m)return!0;return!1}getId(a,f){let m=a.id;return this.promoteId&&(m=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof m=="boolean"&&(m=Number(m))),m}}function w0(c,a,f,m,b){return fe(c,(k,S)=>{const M=a instanceof _l?a.get(S):null;return M&&M.evaluate?M.evaluate(f,m,b):M})}function x0(c){let a=1/0,f=1/0,m=-1/0,b=-1/0;for(const k of c)a=Math.min(a,k.x),f=Math.min(f,k.y),m=Math.max(m,k.x),b=Math.max(b,k.y);return{minX:a,minY:f,maxX:m,maxY:b}}function EA(c,a){return a-c}function A0(c,a,f,m,b){const k=[];for(let S=0;S<c.length;S++){const M=c[S];let R;for(let j=0;j<M.length-1;j++){let X=M[j],Y=M[j+1];X.x<a&&Y.x<a||(X.x<a?X=new _(a,X.y+(a-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x<a&&(Y=new _(a,X.y+(a-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y<f&&Y.y<f||(X.y<f?X=new _(X.x+(f-X.y)/(Y.y-X.y)*(Y.x-X.x),f)._round():Y.y<f&&(Y=new _(X.x+(f-X.y)/(Y.y-X.y)*(Y.x-X.x),f)._round()),X.x>=m&&Y.x>=m||(X.x>=m?X=new _(m,X.y+(m-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x>=m&&(Y=new _(m,X.y+(m-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y>=b&&Y.y>=b||(X.y>=b?X=new _(X.x+(b-X.y)/(Y.y-X.y)*(Y.x-X.x),b)._round():Y.y>=b&&(Y=new _(X.x+(b-X.y)/(Y.y-X.y)*(Y.x-X.x),b)._round()),R&&X.equals(R[R.length-1])||(R=[X],k.push(R)),R.push(Y)))))}}return k}Zt("FeatureIndex",b0,{omit:["rawTileData","sourceLayerCoder"]});class Pa extends _{constructor(a,f,m,b){super(a,f),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Pa(this.x,this.y,this.angle,this.segment)}}function k0(c,a,f,m,b){if(a.segment===void 0||f===0)return!0;let k=a,S=a.segment+1,M=0;for(;M>-f/2;){if(S--,S<0)return!1;M-=c[S].dist(k),k=c[S]}M+=c[S].dist(c[S+1]),S++;const R=[];let j=0;for(;M<f/2;){const X=c[S],Y=c[S+1];if(!Y)return!1;let se=c[S-1].angleTo(X)-X.angleTo(Y);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:se}),j+=se;M-R[0].distance>m;)j-=R.shift().angleDelta;if(j>b)return!1;S++,M+=X.dist(Y)}return!0}function S0(c){let a=0;for(let f=0;f<c.length-1;f++)a+=c[f].dist(c[f+1]);return a}function C0(c,a,f){return c?.6*a*f:0}function T0(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function LA(c,a,f,m,b,k){const S=C0(f,b,k),M=T0(f,m)*k;let R=0;const j=S0(c)/2;for(let X=0;X<c.length-1;X++){const Y=c[X],se=c[X+1],pe=Y.dist(se);if(R+pe>j){const ye=(j-R)/pe,be=Ei.number(Y.x,se.x,ye),Ce=Ei.number(Y.y,se.y,ye),Pe=new Pa(be,Ce,se.angleTo(Y),X);return Pe._round(),!S||k0(c,Pe,M,S,a)?Pe:void 0}R+=pe}}function IA(c,a,f,m,b,k,S,M,R){const j=C0(m,k,S),X=T0(m,b),Y=X*S,se=c[0].x===0||c[0].x===R||c[0].y===0||c[0].y===R;return a-Y<a/4&&(a=Y+a/4),M0(c,se?a/2*M%a:(X/2+2*k)*S*M%a,a,j,f,Y,se,!1,R)}function M0(c,a,f,m,b,k,S,M,R){const j=k/2,X=S0(c);let Y=0,se=a-f,pe=[];for(let ye=0;ye<c.length-1;ye++){const be=c[ye],Ce=c[ye+1],Pe=be.dist(Ce),Ze=Ce.angleTo(be);for(;se+f<Y+Pe;){se+=f;const Re=(se-Y)/Pe,Ne=Ei.number(be.x,Ce.x,Re),dt=Ei.number(be.y,Ce.y,Re);if(Ne>=0&&Ne<R&&dt>=0&&dt<R&&se-j>=0&&se+j<=X){const vt=new Pa(Ne,dt,Ze,ye);vt._round(),m&&!k0(c,vt,k,m,b)||pe.push(vt)}}Y+=Pe}return M||pe.length||S||(pe=M0(c,Y/2,f,m,b,k,S,!0,R)),pe}Zt("Anchor",Pa);const Ru=so;function E0(c,a,f,m){const b=[],k=c.image,S=k.pixelRatio,M=k.paddedRect.w-2*Ru,R=k.paddedRect.h-2*Ru,j=c.right-c.left,X=c.bottom-c.top,Y=k.stretchX||[[0,M]],se=k.stretchY||[[0,R]],pe=(Ft,Xt)=>Ft+Xt[1]-Xt[0],ye=Y.reduce(pe,0),be=se.reduce(pe,0),Ce=M-ye,Pe=R-be;let Ze=0,Re=ye,Ne=0,dt=be,vt=0,Ht=Ce,tn=0,qt=Pe;if(k.content&&m){const Ft=k.content;Ze=dd(Y,0,Ft[0]),Ne=dd(se,0,Ft[1]),Re=dd(Y,Ft[0],Ft[2]),dt=dd(se,Ft[1],Ft[3]),vt=Ft[0]-Ze,tn=Ft[1]-Ne,Ht=Ft[2]-Ft[0]-Re,qt=Ft[3]-Ft[1]-dt}const Ut=(Ft,Xt,Nt,It)=>{const fn=pd(Ft.stretch-Ze,Re,j,c.left),on=md(Ft.fixed-vt,Ht,Ft.stretch,ye),Bn=pd(Xt.stretch-Ne,dt,X,c.top),xr=md(Xt.fixed-tn,qt,Xt.stretch,be),Ir=pd(Nt.stretch-Ze,Re,j,c.left),li=md(Nt.fixed-vt,Ht,Nt.stretch,ye),_o=pd(It.stretch-Ne,dt,X,c.top),Vi=md(It.fixed-tn,qt,It.stretch,be),ei=new _(fn,Bn),yi=new _(Ir,Bn),Si=new _(Ir,_o),qi=new _(fn,_o),Hi=new _(on/S,xr/S),ui=new _(li/S,Vi/S),ci=a*Math.PI/180;if(ci){const Pi=Math.sin(ci),ao=Math.cos(ci),lo=[ao,-Pi,Pi,ao];ei._matMult(lo),yi._matMult(lo),qi._matMult(lo),Si._matMult(lo)}const Ii=Ft.stretch+Ft.fixed,Gi=Xt.stretch+Xt.fixed;return{tl:ei,tr:yi,bl:qi,br:Si,tex:{x:k.paddedRect.x+Ru+Ii,y:k.paddedRect.y+Ru+Gi,w:Nt.stretch+Nt.fixed-Ii,h:It.stretch+It.fixed-Gi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Hi,pixelOffsetBR:ui,minFontScaleX:Ht/S/j,minFontScaleY:qt/S/X,isSDF:f}};if(m&&(k.stretchX||k.stretchY)){const Ft=L0(Y,Ce,ye),Xt=L0(se,Pe,be);for(let Nt=0;Nt<Ft.length-1;Nt++){const It=Ft[Nt],fn=Ft[Nt+1];for(let on=0;on<Xt.length-1;on++)b.push(Ut(It,Xt[on],fn,Xt[on+1]))}}else b.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return b}function dd(c,a,f){let m=0;for(const b of c)m+=Math.max(a,Math.min(f,b[1]))-Math.max(a,Math.min(f,b[0]));return m}function L0(c,a,f){const m=[{fixed:-Ru,stretch:0}];for(const[b,k]of c){const S=m[m.length-1];m.push({fixed:b-S.stretch,stretch:S.stretch}),m.push({fixed:b-S.stretch,stretch:S.stretch+(k-b)})}return m.push({fixed:a+Ru,stretch:f}),m}function pd(c,a,f,m){return c/a*f+m}function md(c,a,f,m){return c-a*f/m}class gd{constructor(a,f,m,b,k,S,M,R,j,X){if(this.boxStartIndex=a.length,j){let Y=S.top,se=S.bottom;const pe=S.collisionPadding;pe&&(Y-=pe[1],se+=pe[3]);let ye=se-Y;ye>0&&(ye=Math.max(10,ye),this.circleDiameter=ye)}else{let Y=S.top*M-R[0],se=S.bottom*M+R[2],pe=S.left*M-R[3],ye=S.right*M+R[1];const be=S.collisionPadding;if(be&&(pe-=be[0]*M,Y-=be[1]*M,ye+=be[2]*M,se+=be[3]*M),X){const Ce=new _(pe,Y),Pe=new _(ye,Y),Ze=new _(pe,se),Re=new _(ye,se),Ne=X*Math.PI/180;Ce._rotate(Ne),Pe._rotate(Ne),Ze._rotate(Ne),Re._rotate(Ne),pe=Math.min(Ce.x,Pe.x,Ze.x,Re.x),ye=Math.max(Ce.x,Pe.x,Ze.x,Re.x),Y=Math.min(Ce.y,Pe.y,Ze.y,Re.y),se=Math.max(Ce.y,Pe.y,Ze.y,Re.y)}a.emplaceBack(f.x,f.y,pe,Y,ye,se,m,b,k)}this.boxEndIndex=a.length}}class PA{constructor(a=[],f=zA){if(this.data=a,this.length=this.data.length,this.compare=f,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:f,compare:m}=this,b=f[a];for(;a>0;){const k=a-1>>1,S=f[k];if(m(b,S)>=0)break;f[a]=S,a=k}f[a]=b}_down(a){const{data:f,compare:m}=this,b=this.length>>1,k=f[a];for(;a<b;){let S=1+(a<<1),M=f[S];const R=S+1;if(R<this.length&&m(f[R],M)<0&&(S=R,M=f[R]),m(M,k)>=0)break;f[a]=M,a=S}f[a]=k}}function zA(c,a){return c<a?-1:c>a?1:0}function DA(c,a=1,f=!1){let m=1/0,b=1/0,k=-1/0,S=-1/0;const M=c[0];for(let pe=0;pe<M.length;pe++){const ye=M[pe];(!pe||ye.x<m)&&(m=ye.x),(!pe||ye.y<b)&&(b=ye.y),(!pe||ye.x>k)&&(k=ye.x),(!pe||ye.y>S)&&(S=ye.y)}const R=Math.min(k-m,S-b);let j=R/2;const X=new PA([],RA);if(R===0)return new _(m,b);for(let pe=m;pe<k;pe+=R)for(let ye=b;ye<S;ye+=R)X.push(new Bu(pe+j,ye+j,j,c));let Y=function(pe){let ye=0,be=0,Ce=0;const Pe=pe[0];for(let Ze=0,Re=Pe.length,Ne=Re-1;Ze<Re;Ne=Ze++){const dt=Pe[Ze],vt=Pe[Ne],Ht=dt.x*vt.y-vt.x*dt.y;be+=(dt.x+vt.x)*Ht,Ce+=(dt.y+vt.y)*Ht,ye+=3*Ht}return new Bu(be/ye,Ce/ye,0,pe)}(c),se=X.length;for(;X.length;){const pe=X.pop();(pe.d>Y.d||!Y.d)&&(Y=pe,f&&console.log("found best %d after %d probes",Math.round(1e4*pe.d)/1e4,se)),pe.max-Y.d<=a||(j=pe.h/2,X.push(new Bu(pe.p.x-j,pe.p.y-j,j,c)),X.push(new Bu(pe.p.x+j,pe.p.y-j,j,c)),X.push(new Bu(pe.p.x-j,pe.p.y+j,j,c)),X.push(new Bu(pe.p.x+j,pe.p.y+j,j,c)),se+=4)}return f&&(console.log(`num probes: ${se}`),console.log(`best distance: ${Y.d}`)),Y.p}function RA(c,a){return a.max-c.max}function Bu(c,a,f,m){this.p=new _(c,a),this.h=f,this.d=function(b,k){let S=!1,M=1/0;for(let R=0;R<k.length;R++){const j=k[R];for(let X=0,Y=j.length,se=Y-1;X<Y;se=X++){const pe=j[X],ye=j[se];pe.y>b.y!=ye.y>b.y&&b.x<(ye.x-pe.x)*(b.y-pe.y)/(ye.y-pe.y)+pe.x&&(S=!S),M=Math.min(M,d_(b,pe,ye))}}return(S?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var ki;u.ap=void 0,(ki=u.ap||(u.ap={}))[ki.center=1]="center",ki[ki.left=2]="left",ki[ki.right=3]="right",ki[ki.top=4]="top",ki[ki.bottom=5]="bottom",ki[ki["top-left"]=6]="top-left",ki[ki["top-right"]=7]="top-right",ki[ki["bottom-left"]=8]="bottom-left",ki[ki["bottom-right"]=9]="bottom-right";const za=7,pm=Number.POSITIVE_INFINITY;function I0(c,a){return a[1]!==pm?function(f,m,b){let k=0,S=0;switch(m=Math.abs(m),b=Math.abs(b),f){case"top-right":case"top-left":case"top":S=b-za;break;case"bottom-right":case"bottom-left":case"bottom":S=-b+za}switch(f){case"top-right":case"bottom-right":case"right":k=-m;break;case"top-left":case"bottom-left":case"left":k=m}return[k,S]}(c,a[0],a[1]):function(f,m){let b=0,k=0;m<0&&(m=0);const S=m/Math.SQRT2;switch(f){case"top-right":case"top-left":k=S-za;break;case"bottom-right":case"bottom-left":k=-S+za;break;case"bottom":k=-m+za;break;case"top":k=m-za}switch(f){case"top-right":case"bottom-right":b=-S;break;case"top-left":case"bottom-left":b=S;break;case"left":b=m;break;case"right":b=-m}return[b,k]}(c,a[0])}function P0(c,a,f){var m;const b=c.layout,k=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},f);if(k){const M=k.values,R=[];for(let j=0;j<M.length;j+=2){const X=R[j]=M[j],Y=M[j+1].map(se=>se*ai);X.startsWith("top")?Y[1]-=za:X.startsWith("bottom")&&(Y[1]+=za),R[j+1]=Y}return new ho(R)}const S=b.get("text-variable-anchor");if(S){let M;M=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},f)*ai,pm]:b.get("text-offset").evaluate(a,{},f).map(j=>j*ai);const R=[];for(const j of S)R.push(j,I0(j,M));return new ho(R)}return null}function mm(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BA(c,a,f,m,b,k,S,M,R,j,X){let Y=k.textMaxSize.evaluate(a,{});Y===void 0&&(Y=S);const se=c.layers[0].layout,pe=se.get("icon-offset").evaluate(a,{},X),ye=D0(f.horizontal),be=S/24,Ce=c.tilePixelRatio*be,Pe=c.tilePixelRatio*Y/24,Ze=c.tilePixelRatio*M,Re=c.tilePixelRatio*se.get("symbol-spacing"),Ne=se.get("text-padding")*c.tilePixelRatio,dt=function(It,fn,on,Bn=1){const xr=It.get("icon-padding").evaluate(fn,{},on),Ir=xr&&xr.values;return[Ir[0]*Bn,Ir[1]*Bn,Ir[2]*Bn,Ir[3]*Bn]}(se,a,X,c.tilePixelRatio),vt=se.get("text-max-angle")/180*Math.PI,Ht=se.get("text-rotation-alignment")!=="viewport"&&se.get("symbol-placement")!=="point",tn=se.get("icon-rotation-alignment")==="map"&&se.get("symbol-placement")!=="point",qt=se.get("symbol-placement"),Ut=Re/2,Ft=se.get("icon-text-fit");let Xt;m&&Ft!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(Xt=r0(m,f.vertical,Ft,se.get("icon-text-fit-padding"),pe,be)),ye&&(m=r0(m,ye,Ft,se.get("icon-text-fit-padding"),pe,be)));const Nt=(It,fn)=>{fn.x<0||fn.x>=qr||fn.y<0||fn.y>=qr||function(on,Bn,xr,Ir,li,_o,Vi,ei,yi,Si,qi,Hi,ui,ci,Ii,Gi,Pi,ao,lo,fi,jn,zi,Ci,hi,Jo){const hs=on.addToLineVertexArray(Bn,xr);let ds,ea,Yo,Po,uo=0,ta=0,cf=0,O0=0,Am=-1,km=-1;const na={};let $0=jr("");if(on.allowVerticalPlacement&&Ir.vertical){const Di=ei.layout.get("text-rotate").evaluate(jn,{},hi)+90;Yo=new gd(yi,Bn,Si,qi,Hi,Ir.vertical,ui,ci,Ii,Di),Vi&&(Po=new gd(yi,Bn,Si,qi,Hi,Vi,Pi,ao,Ii,Di))}if(li){const Di=ei.layout.get("icon-rotate").evaluate(jn,{}),zo=ei.layout.get("icon-text-fit")!=="none",Cl=E0(li,Di,Ci,zo),ms=Vi?E0(Vi,Di,Ci,zo):void 0;ea=new gd(yi,Bn,Si,qi,Hi,li,Pi,ao,!1,Di),uo=4*Cl.length;const Tl=on.iconSizeData;let Rs=null;Tl.kind==="source"?(Rs=[Ds*ei.layout.get("icon-size").evaluate(jn,{})],Rs[0]>La&&xe(`${on.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)):Tl.kind==="composite"&&(Rs=[Ds*zi.compositeIconSizes[0].evaluate(jn,{},hi),Ds*zi.compositeIconSizes[1].evaluate(jn,{},hi)],(Rs[0]>La||Rs[1]>La)&&xe(`${on.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)),on.addSymbols(on.icon,Cl,Rs,fi,lo,jn,u.ah.none,Bn,hs.lineStartIndex,hs.lineLength,-1,hi),Am=on.icon.placedSymbolArray.length-1,ms&&(ta=4*ms.length,on.addSymbols(on.icon,ms,Rs,fi,lo,jn,u.ah.vertical,Bn,hs.lineStartIndex,hs.lineLength,-1,hi),km=on.icon.placedSymbolArray.length-1)}const N0=Object.keys(Ir.horizontal);for(const Di of N0){const zo=Ir.horizontal[Di];if(!ds){$0=jr(zo.text);const ms=ei.layout.get("text-rotate").evaluate(jn,{},hi);ds=new gd(yi,Bn,Si,qi,Hi,zo,ui,ci,Ii,ms)}const Cl=zo.positionedLines.length===1;if(cf+=z0(on,Bn,zo,_o,ei,Ii,jn,Gi,hs,Ir.vertical?u.ah.horizontal:u.ah.horizontalOnly,Cl?N0:[Di],na,Am,zi,hi),Cl)break}Ir.vertical&&(O0+=z0(on,Bn,Ir.vertical,_o,ei,Ii,jn,Gi,hs,u.ah.vertical,["vertical"],na,km,zi,hi));const $A=ds?ds.boxStartIndex:on.collisionBoxArray.length,NA=ds?ds.boxEndIndex:on.collisionBoxArray.length,jA=Yo?Yo.boxStartIndex:on.collisionBoxArray.length,UA=Yo?Yo.boxEndIndex:on.collisionBoxArray.length,VA=ea?ea.boxStartIndex:on.collisionBoxArray.length,qA=ea?ea.boxEndIndex:on.collisionBoxArray.length,HA=Po?Po.boxStartIndex:on.collisionBoxArray.length,GA=Po?Po.boxEndIndex:on.collisionBoxArray.length;let ps=-1;const yd=(Di,zo)=>Di&&Di.circleDiameter?Math.max(Di.circleDiameter,zo):zo;ps=yd(ds,ps),ps=yd(Yo,ps),ps=yd(ea,ps),ps=yd(Po,ps);const j0=ps>-1?1:0;j0&&(ps*=Jo/ai),on.glyphOffsetArray.length>=Du.MAX_GLYPHS&&xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jn.sortKey!==void 0&&on.addToSortKeyRanges(on.symbolInstances.length,jn.sortKey);const WA=P0(ei,jn,hi),[ZA,XA]=function(Di,zo){const Cl=Di.length,ms=zo==null?void 0:zo.values;if((ms==null?void 0:ms.length)>0)for(let Tl=0;Tl<ms.length;Tl+=2){const Rs=ms[Tl+1];Di.emplaceBack(u.ap[ms[Tl]],Rs[0],Rs[1])}return[Cl,Di.length]}(on.textAnchorOffsets,WA);on.symbolInstances.emplaceBack(Bn.x,Bn.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical||-1,Am,km,$0,$A,NA,jA,UA,VA,qA,HA,GA,Si,cf,O0,uo,ta,j0,0,ui,ps,ZA,XA)}(c,fn,It,f,m,b,Xt,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,Ce,[Ne,Ne,Ne,Ne],Ht,R,Ze,dt,tn,pe,a,k,j,X,S)};if(qt==="line")for(const It of A0(a.geometry,0,0,qr,qr)){const fn=IA(It,Re,vt,f.vertical||ye,m,24,Pe,c.overscaling,qr);for(const on of fn)ye&&FA(c,ye.text,Ut,on)||Nt(It,on)}else if(qt==="line-center"){for(const It of a.geometry)if(It.length>1){const fn=LA(It,vt,f.vertical||ye,m,24,Pe);fn&&Nt(It,fn)}}else if(a.type==="Polygon")for(const It of Wp(a.geometry,0)){const fn=DA(It,16);Nt(It[0],new Pa(fn.x,fn.y,0))}else if(a.type==="LineString")for(const It of a.geometry)Nt(It,new Pa(It[0].x,It[0].y,0));else if(a.type==="Point")for(const It of a.geometry)for(const fn of It)Nt([fn],new Pa(fn.x,fn.y,0))}function z0(c,a,f,m,b,k,S,M,R,j,X,Y,se,pe,ye){const be=function(Ze,Re,Ne,dt,vt,Ht,tn,qt){const Ut=dt.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Ft=[];for(const Xt of Re.positionedLines)for(const Nt of Xt.positionedGlyphs){if(!Nt.rect)continue;const It=Nt.rect||{};let fn=K_+1,on=!0,Bn=1,xr=0;const Ir=(vt||qt)&&Nt.vertical,li=Nt.metrics.advance*Nt.scale/2;if(qt&&Re.verticalizable&&(xr=Xt.lineOffset/2-(Nt.imageName?-(ai-Nt.metrics.width*Nt.scale)/2:(Nt.scale-1)*ai)),Nt.imageName){const fi=tn[Nt.imageName];on=fi.sdf,Bn=fi.pixelRatio,fn=so/Bn}const _o=vt?[Nt.x+li,Nt.y]:[0,0];let Vi=vt?[0,0]:[Nt.x+li+Ne[0],Nt.y+Ne[1]-xr],ei=[0,0];Ir&&(ei=Vi,Vi=[0,0]);const yi=Nt.metrics.isDoubleResolution?2:1,Si=(Nt.metrics.left-fn)*Nt.scale-li+Vi[0],qi=(-Nt.metrics.top-fn)*Nt.scale+Vi[1],Hi=Si+It.w/yi*Nt.scale/Bn,ui=qi+It.h/yi*Nt.scale/Bn,ci=new _(Si,qi),Ii=new _(Hi,qi),Gi=new _(Si,ui),Pi=new _(Hi,ui);if(Ir){const fi=new _(-li,li-rf),jn=-Math.PI/2,zi=ai/2-li,Ci=new _(5-rf-zi,-(Nt.imageName?zi:0)),hi=new _(...ei);ci._rotateAround(jn,fi)._add(Ci)._add(hi),Ii._rotateAround(jn,fi)._add(Ci)._add(hi),Gi._rotateAround(jn,fi)._add(Ci)._add(hi),Pi._rotateAround(jn,fi)._add(Ci)._add(hi)}if(Ut){const fi=Math.sin(Ut),jn=Math.cos(Ut),zi=[jn,-fi,fi,jn];ci._matMult(zi),Ii._matMult(zi),Gi._matMult(zi),Pi._matMult(zi)}const ao=new _(0,0),lo=new _(0,0);Ft.push({tl:ci,tr:Ii,bl:Gi,br:Pi,tex:It,writingMode:Re.writingMode,glyphOffset:_o,sectionIndex:Nt.sectionIndex,isSDF:on,pixelOffsetTL:ao,pixelOffsetBR:lo,minFontScaleX:0,minFontScaleY:0})}return Ft}(0,f,M,b,k,S,m,c.allowVerticalPlacement),Ce=c.textSizeData;let Pe=null;Ce.kind==="source"?(Pe=[Ds*b.layout.get("text-size").evaluate(S,{})],Pe[0]>La&&xe(`${c.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Pe=[Ds*pe.compositeTextSizes[0].evaluate(S,{},ye),Ds*pe.compositeTextSizes[1].evaluate(S,{},ye)],(Pe[0]>La||Pe[1]>La)&&xe(`${c.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)),c.addSymbols(c.text,be,Pe,M,k,S,j,a,R.lineStartIndex,R.lineLength,se,ye);for(const Ze of X)Y[Ze]=c.text.placedSymbolArray.length-1;return 4*be.length}function D0(c){for(const a in c)return c[a];return null}function FA(c,a,f,m){const b=c.compareText;if(a in b){const k=b[a];for(let S=k.length-1;S>=0;S--)if(m.dist(k[S])<f)return!0}else b[a]=[];return b[a].push(m),!1}const R0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gm{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,m]=new Uint8Array(a,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const k=R0[15&m];if(!k)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(a,2,1),[M]=new Uint32Array(a,4,1);return new gm(M,S,k,a)}constructor(a,f=64,m=Float64Array,b){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const k=R0.indexOf(this.ArrayType),S=2*a*this.ArrayType.BYTES_PER_ELEMENT,M=a*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-M%8)%8;if(k<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+R,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+R),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+R,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+k]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=a)}add(a,f){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=f,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return _m(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,f,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:k,coords:S,nodeSize:M}=this,R=[0,k.length-1,0],j=[];for(;R.length;){const X=R.pop()||0,Y=R.pop()||0,se=R.pop()||0;if(Y-se<=M){for(let Ce=se;Ce<=Y;Ce++){const Pe=S[2*Ce],Ze=S[2*Ce+1];Pe>=a&&Pe<=m&&Ze>=f&&Ze<=b&&j.push(k[Ce])}continue}const pe=se+Y>>1,ye=S[2*pe],be=S[2*pe+1];ye>=a&&ye<=m&&be>=f&&be<=b&&j.push(k[pe]),(X===0?a<=ye:f<=be)&&(R.push(se),R.push(pe-1),R.push(1-X)),(X===0?m>=ye:b>=be)&&(R.push(pe+1),R.push(Y),R.push(1-X))}return j}within(a,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:k,nodeSize:S}=this,M=[0,b.length-1,0],R=[],j=m*m;for(;M.length;){const X=M.pop()||0,Y=M.pop()||0,se=M.pop()||0;if(Y-se<=S){for(let Ce=se;Ce<=Y;Ce++)F0(k[2*Ce],k[2*Ce+1],a,f)<=j&&R.push(b[Ce]);continue}const pe=se+Y>>1,ye=k[2*pe],be=k[2*pe+1];F0(ye,be,a,f)<=j&&R.push(b[pe]),(X===0?a-m<=ye:f-m<=be)&&(M.push(se),M.push(pe-1),M.push(1-X)),(X===0?a+m>=ye:f+m>=be)&&(M.push(pe+1),M.push(Y),M.push(1-X))}return R}}function _m(c,a,f,m,b,k){if(b-m<=f)return;const S=m+b>>1;B0(c,a,S,m,b,k),_m(c,a,f,m,S-1,1-k),_m(c,a,f,S+1,b,1-k)}function B0(c,a,f,m,b,k){for(;b>m;){if(b-m>600){const j=b-m+1,X=f-m+1,Y=Math.log(j),se=.5*Math.exp(2*Y/3),pe=.5*Math.sqrt(Y*se*(j-se)/j)*(X-j/2<0?-1:1);B0(c,a,f,Math.max(m,Math.floor(f-X*se/j+pe)),Math.min(b,Math.floor(f+(j-X)*se/j+pe)),k)}const S=a[2*f+k];let M=m,R=b;for(lf(c,a,m,f),a[2*b+k]>S&&lf(c,a,m,b);M<R;){for(lf(c,a,M,R),M++,R--;a[2*M+k]<S;)M++;for(;a[2*R+k]>S;)R--}a[2*m+k]===S?lf(c,a,m,R):(R++,lf(c,a,R,b)),R<=f&&(m=R+1),f<=R&&(b=R-1)}}function lf(c,a,f,m){ym(c,f,m),ym(a,2*f,2*m),ym(a,2*f+1,2*m+1)}function ym(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}function F0(c,a,f,m){const b=c-f,k=a-m;return b*b+k*k}var vm;u.bd=void 0,(vm=u.bd||(u.bd={})).create="create",vm.load="load",vm.fullLoad="fullLoad";let _d=null,uf=[];const bm=1e3/60,wm="loadTime",xm="fullLoadTime",OA={mark(c){performance.mark(c)},frame(c){const a=c;_d!=null&&uf.push(a-_d),_d=a},clearMetrics(){_d=null,uf=[],performance.clearMeasures(wm),performance.clearMeasures(xm);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(wm,u.bd.create,u.bd.load),performance.measure(xm,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(wm)[0].duration,a=performance.getEntriesByName(xm)[0].duration,f=uf.length,m=1/(uf.reduce((k,S)=>k+S,0)/f/1e3),b=uf.filter(k=>k>bm).reduce((k,S)=>k+(S-bm)/bm,0);return{loadTime:c,fullLoadTime:a,fps:m,percentDroppedFrames:b/(f+b)*100,totalFrames:f}}};u.$=Ot,u.A=Mu,u.B=function(c){if(ze==null){const a=c.navigator?c.navigator.userAgent:null;ze=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ze},u.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new MA(()=>this.process()),this.subscription=function(f,m,b,k){return f.addEventListener(m,b,!1),{unsubscribe:()=>{f.removeEventListener(m,b,!1)}}}(this.target,"message",f=>this.receive(f)),this.globalScope=Ue(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((f,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:f,reject:m},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const M={id:b,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const k=[],S=Object.assign(Object.assign({},c),{id:b,sourceMapId:this.mapId,origin:location.origin,data:ka(c.data,k)});this.target.postMessage(S,{transfer:k})})}receive(c){const a=c.data,f=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[f];const m=this.abortControllers[f];return delete this.abortControllers[f],void(m&&m.abort())}if(Ue(self)||a.mustQueue)return this.tasks[f]=a,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return s(this,void 0,void 0,function*(){if(a.type==="<response>"){const b=this.resolveRejects[c];return delete this.resolveRejects[c],b?void(a.error?b.reject(Sa(a.error)):b.resolve(Sa(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=Sa(a.data),m=new AbortController;this.abortControllers[c]=m;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,f,m);this.completeTask(c,null,b)}catch(b){this.completeTask(c,b)}})}completeTask(c,a,f){const m=[];delete this.abortControllers[c];const b={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?ka(a):null,data:ka(f,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=sn,u.E=nt,u.F=function(){var c=new Mu(16);return Mu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=jt,u.H=function(c,a,f){var m,b,k,S,M,R,j,X,Y,se,pe,ye,be=f[0],Ce=f[1],Pe=f[2];return a===c?(c[12]=a[0]*be+a[4]*Ce+a[8]*Pe+a[12],c[13]=a[1]*be+a[5]*Ce+a[9]*Pe+a[13],c[14]=a[2]*be+a[6]*Ce+a[10]*Pe+a[14],c[15]=a[3]*be+a[7]*Ce+a[11]*Pe+a[15]):(b=a[1],k=a[2],S=a[3],M=a[4],R=a[5],j=a[6],X=a[7],Y=a[8],se=a[9],pe=a[10],ye=a[11],c[0]=m=a[0],c[1]=b,c[2]=k,c[3]=S,c[4]=M,c[5]=R,c[6]=j,c[7]=X,c[8]=Y,c[9]=se,c[10]=pe,c[11]=ye,c[12]=m*be+M*Ce+Y*Pe+a[12],c[13]=b*be+R*Ce+se*Pe+a[13],c[14]=k*be+j*Ce+pe*Pe+a[14],c[15]=S*be+X*Ce+ye*Pe+a[15]),c},u.I=rm,u.J=function(c,a,f){var m=f[0],b=f[1],k=f[2];return c[0]=a[0]*m,c[1]=a[1]*m,c[2]=a[2]*m,c[3]=a[3]*m,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*k,c[9]=a[9]*k,c[10]=a[10]*k,c[11]=a[11]*k,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.K=__,u.L=function(c,a){const f={};for(let m=0;m<a.length;m++){const b=a[m];b in c&&(f[b]=c[b])}return f},u.M=Ia,u.N=h0,u.O=d0,u.P=_,u.Q=Io,u.R=Lo,u.S=E,u.T=Pc,u.U=I,u.V=Xe,u.W=qr,u.X=Wr,u.Y=hd,u.Z=class extends Rc{},u._=s,u.a=gt,u.a$=function(c,a,f){return c[0]=a[0]*f[0],c[1]=a[1]*f[1],c[2]=a[2]*f[2],c[3]=a[3]*f[3],c},u.a0=dm,u.a1=xt,u.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(f=>{a.onloadstart=()=>{f(a)};for(const m of c){const b=window.document.createElement("source");pn(m)||(a.crossOrigin="Anonymous"),b.src=m,a.appendChild(b)}})},u.a3=function(){return J++},u.a4=w,u.a5=Du,u.a6=au,u.a7=Ys,u.a8=Er,u.a9=v0,u.aA=ee,u.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let f=[];try{if(!ut(c.version,a.version))return[{command:"setStyle",args:[a]}];ut(c.center,a.center)||f.push({command:"setCenter",args:[a.center]}),ut(c.zoom,a.zoom)||f.push({command:"setZoom",args:[a.zoom]}),ut(c.bearing,a.bearing)||f.push({command:"setBearing",args:[a.bearing]}),ut(c.pitch,a.pitch)||f.push({command:"setPitch",args:[a.pitch]}),ut(c.sprite,a.sprite)||f.push({command:"setSprite",args:[a.sprite]}),ut(c.glyphs,a.glyphs)||f.push({command:"setGlyphs",args:[a.glyphs]}),ut(c.transition,a.transition)||f.push({command:"setTransition",args:[a.transition]}),ut(c.light,a.light)||f.push({command:"setLight",args:[a.light]}),ut(c.terrain,a.terrain)||f.push({command:"setTerrain",args:[a.terrain]}),ut(c.sky,a.sky)||f.push({command:"setSky",args:[a.sky]});const m={},b=[];(function(S,M,R,j){let X;for(X in M=M||{},S=S||{})Object.prototype.hasOwnProperty.call(S,X)&&(Object.prototype.hasOwnProperty.call(M,X)||Zn(X,R,j));for(X in M)Object.prototype.hasOwnProperty.call(M,X)&&(Object.prototype.hasOwnProperty.call(S,X)?ut(S[X],M[X])||(S[X].type==="geojson"&&M[X].type==="geojson"&&Cr(S,M,X)?Gt(R,{command:"setGeoJSONSourceData",args:[X,M[X].data]}):fr(X,M,R,j)):Jn(X,M,R))})(c.sources,a.sources,b,m);const k=[];c.layers&&c.layers.forEach(S=>{"source"in S&&m[S.source]?f.push({command:"removeLayer",args:[S.id]}):k.push(S)}),f=f.concat(b),function(S,M,R){M=M||[];const j=(S=S||[]).map(xi),X=M.map(xi),Y=S.reduce(Un,{}),se=M.reduce(Un,{}),pe=j.slice(),ye=Object.create(null);let be,Ce,Pe,Ze,Re;for(let Ne=0,dt=0;Ne<j.length;Ne++)be=j[Ne],Object.prototype.hasOwnProperty.call(se,be)?dt++:(Gt(R,{command:"removeLayer",args:[be]}),pe.splice(pe.indexOf(be,dt),1));for(let Ne=0,dt=0;Ne<X.length;Ne++)be=X[X.length-1-Ne],pe[pe.length-1-Ne]!==be&&(Object.prototype.hasOwnProperty.call(Y,be)?(Gt(R,{command:"removeLayer",args:[be]}),pe.splice(pe.lastIndexOf(be,pe.length-dt),1)):dt++,Ze=pe[pe.length-Ne],Gt(R,{command:"addLayer",args:[se[be],Ze]}),pe.splice(pe.length-Ne,0,be),ye[be]=!0);for(let Ne=0;Ne<X.length;Ne++)if(be=X[Ne],Ce=Y[be],Pe=se[be],!ye[be]&&!ut(Ce,Pe))if(ut(Ce.source,Pe.source)&&ut(Ce["source-layer"],Pe["source-layer"])&&ut(Ce.type,Pe.type)){for(Re in Tr(Ce.layout,Pe.layout,R,be,null,"setLayoutProperty"),Tr(Ce.paint,Pe.paint,R,be,null,"setPaintProperty"),ut(Ce.filter,Pe.filter)||Gt(R,{command:"setFilter",args:[be,Pe.filter]}),ut(Ce.minzoom,Pe.minzoom)&&ut(Ce.maxzoom,Pe.maxzoom)||Gt(R,{command:"setLayerZoomRange",args:[be,Pe.minzoom,Pe.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?Tr(Ce[Re],Pe[Re],R,be,Re.slice(6),"setPaintProperty"):ut(Ce[Re],Pe[Re])||Gt(R,{command:"setLayerProperty",args:[be,Re,Pe[Re]]}));for(Re in Pe)Object.prototype.hasOwnProperty.call(Pe,Re)&&!Object.prototype.hasOwnProperty.call(Ce,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?Tr(Ce[Re],Pe[Re],R,be,Re.slice(6),"setPaintProperty"):ut(Ce[Re],Pe[Re])||Gt(R,{command:"setLayerProperty",args:[be,Re,Pe[Re]]}))}else Gt(R,{command:"removeLayer",args:[be]}),Ze=pe[pe.lastIndexOf(be)+1],Gt(R,{command:"addLayer",args:[Pe,Ze]})}(k,a.layers,f)}catch(m){console.warn("Unable to compute style diff:",m),f=[{command:"setStyle",args:[a]}]}return f},u.aC=function(c){const a=[],f=c.id;return f===void 0&&a.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),a},u.aD=function c(a,f){if(Array.isArray(a)){if(!Array.isArray(f)||a.length!==f.length)return!1;for(let m=0;m<a.length;m++)if(!c(a[m],f[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&f!==null){if(typeof f!="object"||Object.keys(a).length!==Object.keys(f).length)return!1;for(const m in a)if(!c(a[m],f[m]))return!1;return!0}return a===f},u.aE=fe,u.aF=Ee,u.aG=class extends si{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=oo,u.aI=class extends si{constructor(c,a){super(c,a),this.current=kl}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Xo,u.aK=class extends si{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends si{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=Is,u.aN=function(c,a,f,m,b,k,S){var M=1/(a-f),R=1/(m-b),j=1/(k-S);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*R,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*j,c[11]=0,c[12]=(a+f)*M,c[13]=(b+m)*R,c[14]=(S+k)*j,c[15]=1,c},u.aO=sr,u.aP=lx,u.aQ=class extends bu{},u.aR=nA,u.aS=class extends wu{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=x_,u.aV=te,u.aW=class extends jc{},u.aX=ft,u.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},u.aZ=function(c,a){var f=c[0],m=c[1],b=c[2],k=c[3],S=c[4],M=c[5],R=c[6],j=c[7],X=c[8],Y=c[9],se=c[10],pe=c[11],ye=c[12],be=c[13],Ce=c[14],Pe=c[15],Ze=a[0],Re=a[1],Ne=a[2],dt=a[3],vt=a[4],Ht=a[5],tn=a[6],qt=a[7],Ut=a[8],Ft=a[9],Xt=a[10],Nt=a[11],It=a[12],fn=a[13],on=a[14],Bn=a[15];return Math.abs(f-Ze)<=Ui*Math.max(1,Math.abs(f),Math.abs(Ze))&&Math.abs(m-Re)<=Ui*Math.max(1,Math.abs(m),Math.abs(Re))&&Math.abs(b-Ne)<=Ui*Math.max(1,Math.abs(b),Math.abs(Ne))&&Math.abs(k-dt)<=Ui*Math.max(1,Math.abs(k),Math.abs(dt))&&Math.abs(S-vt)<=Ui*Math.max(1,Math.abs(S),Math.abs(vt))&&Math.abs(M-Ht)<=Ui*Math.max(1,Math.abs(M),Math.abs(Ht))&&Math.abs(R-tn)<=Ui*Math.max(1,Math.abs(R),Math.abs(tn))&&Math.abs(j-qt)<=Ui*Math.max(1,Math.abs(j),Math.abs(qt))&&Math.abs(X-Ut)<=Ui*Math.max(1,Math.abs(X),Math.abs(Ut))&&Math.abs(Y-Ft)<=Ui*Math.max(1,Math.abs(Y),Math.abs(Ft))&&Math.abs(se-Xt)<=Ui*Math.max(1,Math.abs(se),Math.abs(Xt))&&Math.abs(pe-Nt)<=Ui*Math.max(1,Math.abs(pe),Math.abs(Nt))&&Math.abs(ye-It)<=Ui*Math.max(1,Math.abs(ye),Math.abs(It))&&Math.abs(be-fn)<=Ui*Math.max(1,Math.abs(be),Math.abs(fn))&&Math.abs(Ce-on)<=Ui*Math.max(1,Math.abs(Ce),Math.abs(on))&&Math.abs(Pe-Bn)<=Ui*Math.max(1,Math.abs(Pe),Math.abs(Bn))},u.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,m,b,k)=>{const S=b||k;return a[m]=!S||S.toLowerCase(),""}),a["max-age"]){const f=parseInt(a["max-age"],10);isNaN(f)?delete a["max-age"]:a["max-age"]=f}return a},u.ab=function(c,a){const f=[];for(const m in c)m in a||f.push(m);return f},u.ac=K,u.ad=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[0],S=a[1],M=a[2],R=a[3],j=a[4],X=a[5],Y=a[6],se=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=k*b+j*m,c[1]=S*b+X*m,c[2]=M*b+Y*m,c[3]=R*b+se*m,c[4]=j*b-k*m,c[5]=X*b-S*m,c[6]=Y*b-M*m,c[7]=se*b-R*m,c},u.ae=function(c){var a=new Mu(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},u.af=td,u.ag=function(c,a){let f=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:b,minZoom:k,maxZoom:S}=c,M=b?K(Ai.interpolationFactor(b,a,k,S),0,1):0;c.kind==="camera"?m=Ei.number(c.minSize,c.maxSize,M):f=M}return{uSizeT:f,uSize:m}},u.ai=function(c,{uSize:a,uSizeT:f},{lowerSize:m,upperSize:b}){return c.kind==="source"?m/Ds:c.kind==="composite"?Ei.number(m/Ds,b/Ds,f):a},u.aj=am,u.ak=function(c,a,f,m){const b=a.y-c.y,k=a.x-c.x,S=m.y-f.y,M=m.x-f.x,R=S*k-M*b;if(R===0)return null;const j=(M*(c.y-f.y)-S*(c.x-f.x))/R;return new _(c.x+j*k,c.y+j*b)},u.al=A0,u.am=Vc,u.an=Np,u.ao=ai,u.aq=sm,u.ar=function(c,a){var f=a[0],m=a[1],b=a[2],k=a[3],S=a[4],M=a[5],R=a[6],j=a[7],X=a[8],Y=a[9],se=a[10],pe=a[11],ye=a[12],be=a[13],Ce=a[14],Pe=a[15],Ze=f*M-m*S,Re=f*R-b*S,Ne=f*j-k*S,dt=m*R-b*M,vt=m*j-k*M,Ht=b*j-k*R,tn=X*be-Y*ye,qt=X*Ce-se*ye,Ut=X*Pe-pe*ye,Ft=Y*Ce-se*be,Xt=Y*Pe-pe*be,Nt=se*Pe-pe*Ce,It=Ze*Nt-Re*Xt+Ne*Ft+dt*Ut-vt*qt+Ht*tn;return It?(c[0]=(M*Nt-R*Xt+j*Ft)*(It=1/It),c[1]=(b*Xt-m*Nt-k*Ft)*It,c[2]=(be*Ht-Ce*vt+Pe*dt)*It,c[3]=(se*vt-Y*Ht-pe*dt)*It,c[4]=(R*Ut-S*Nt-j*qt)*It,c[5]=(f*Nt-b*Ut+k*qt)*It,c[6]=(Ce*Ne-ye*Ht-Pe*Re)*It,c[7]=(X*Ht-se*Ne+pe*Re)*It,c[8]=(S*Xt-M*Ut+j*tn)*It,c[9]=(m*Ut-f*Xt-k*tn)*It,c[10]=(ye*vt-be*Ne+Pe*Ze)*It,c[11]=(Y*Ne-X*vt-pe*Ze)*It,c[12]=(M*qt-S*Ft-R*tn)*It,c[13]=(f*Ft-m*qt+b*tn)*It,c[14]=(be*Re-ye*dt-Ce*Ze)*It,c[15]=(X*dt-Y*Re+se*Ze)*It,c):null},u.as=mm,u.at=om,u.au=gm,u.av=function(){const c={},a=de.$version;for(const f in de.$root){const m=de.$root[f];if(m.required){let b=null;b=f==="version"?a:m.type==="array"?[]:{},b!=null&&(c[f]=b)}}return c},u.aw=jh,u.ax=nn,u.ay=function(c){c=c.slice();const a=Object.create(null);for(let f=0;f<c.length;f++)a[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=Ke(c[f],a[c[f].ref]));return c},u.az=function(c){if(c.type==="custom")return new TA(c);switch(c.type){case"background":return new kA(c);case"circle":return new ux(c);case"fill":return new Ex(c);case"fill-extrusion":return new qx(c);case"heatmap":return new fx(c);case"hillshade":return new dx(c);case"line":return new Yx(c);case"raster":return new CA(c);case"symbol":return new fd(c)}},u.b=Ie,u.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},u.b1=H,u.b2=g0,u.b3=p0,u.b4=function(c,a,f,m,b){var k,S=1/Math.tan(a/2);return c[0]=S/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,b!=null&&b!==1/0?(c[10]=(b+m)*(k=1/(m-b)),c[14]=2*b*m*k):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[4],S=a[5],M=a[6],R=a[7],j=a[8],X=a[9],Y=a[10],se=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=k*b+j*m,c[5]=S*b+X*m,c[6]=M*b+Y*m,c[7]=R*b+se*m,c[8]=j*b-k*m,c[9]=X*b-S*m,c[10]=Y*b-M*m,c[11]=se*b-R*m,c},u.b6=O,u.b7=B,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=Ls,u.ba=class extends cs{},u.bb=fm,u.bc=OA,u.be=un,u.bf=function(c,a){gt.REGISTERED_PROTOCOLS[c]=a},u.bg=function(c){delete gt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,a){const f={};for(let b=0;b<c.length;b++){const k=a&&a[c[b].id]||Rp(c[b]);a&&(a[c[b].id]=k);let S=f[k];S||(S=f[k]=[]),S.push(c[b])}const m=[];for(const b in f)m.push(f[b]);return m},u.bi=Zt,u.bj=y0,u.bk=b0,u.bl=Y_,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=qr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],f=a.layout,m=a._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Er(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Er(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Er(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=c.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Er(j),c.canonical),m["text-size"].possiblyEvaluate(new Er(X),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=c.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Er(j),c.canonical),m["icon-size"].possiblyEvaluate(new Er(X),c.canonical)]}const k=f.get("text-line-height")*ai,S=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",M=f.get("text-keep-upright"),R=f.get("text-size");for(const j of c.bucket.features){const X=f.get("text-font").evaluate(j,{},c.canonical).join(","),Y=R.evaluate(j,{},c.canonical),se=b.layoutTextSize.evaluate(j,{},c.canonical),pe=b.layoutIconSize.evaluate(j,{},c.canonical),ye={horizontal:{},vertical:void 0},be=j.text;let Ce,Pe=[0,0];if(be){const Ne=be.toString(),dt=f.get("text-letter-spacing").evaluate(j,{},c.canonical)*ai,vt=Uh(Ne)?dt:0,Ht=f.get("text-anchor").evaluate(j,{},c.canonical),tn=P0(a,j,c.canonical);if(!tn){const Nt=f.get("text-radial-offset").evaluate(j,{},c.canonical);Pe=Nt?I0(Ht,[Nt*ai,pm]):f.get("text-offset").evaluate(j,{},c.canonical).map(It=>It*ai)}let qt=S?"center":f.get("text-justify").evaluate(j,{},c.canonical);const Ut=f.get("symbol-placement"),Ft=Ut==="point"?f.get("text-max-width").evaluate(j,{},c.canonical)*ai:0,Xt=()=>{c.bucket.allowVerticalPlacement&&Ca(Ne)&&(ye.vertical=ld(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,Ht,"left",vt,Pe,u.ah.vertical,!0,Ut,se,Y))};if(!S&&tn){const Nt=new Set;if(qt==="auto")for(let fn=0;fn<tn.values.length;fn+=2)Nt.add(mm(tn.values[fn]));else Nt.add(qt);let It=!1;for(const fn of Nt)if(!ye.horizontal[fn])if(It)ye.horizontal[fn]=ye.horizontal[0];else{const on=ld(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,"center",fn,vt,Pe,u.ah.horizontal,!1,Ut,se,Y);on&&(ye.horizontal[fn]=on,It=on.positionedLines.length===1)}Xt()}else{qt==="auto"&&(qt=mm(Ht));const Nt=ld(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,Ht,qt,vt,Pe,u.ah.horizontal,!1,Ut,se,Y);Nt&&(ye.horizontal[qt]=Nt),Xt(),Ca(Ne)&&S&&M&&(ye.vertical=ld(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,Ht,qt,vt,Pe,u.ah.vertical,!1,Ut,se,Y))}}let Ze=!1;if(j.icon&&j.icon.name){const Ne=c.imageMap[j.icon.name];Ne&&(Ce=vA(c.imagePositions[j.icon.name],f.get("icon-offset").evaluate(j,{},c.canonical),f.get("icon-anchor").evaluate(j,{},c.canonical)),Ze=!!Ne.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ze:c.bucket.sdfIcons!==Ze&&xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Re=D0(ye.horizontal)||ye.vertical;c.bucket.iconsInText=!!Re&&Re.iconsInText,(Re||Ce)&&BA(c.bucket,j,ye,Ce,c.imageMap,b,se,pe,Pe,Ze,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=Qp,u.bo=Kp,u.bp=Yp,u.bq=Ma,u.br=tm,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(I())try{return yield Xe(c,a,f,m,b)}catch{}return function(k,S,M,R,j){const X=k.width,Y=k.height;lt&&pt||(lt=new OffscreenCanvas(X,Y),pt=lt.getContext("2d",{willReadFrequently:!0})),lt.width=X,lt.height=Y,pt.drawImage(k,0,0,X,Y);const se=pt.getImageData(S,M,R,j);return pt.clearRect(0,0,X,Y),se.data}(c,a,f,m,b)})},u.bu=_0,u.bv=h,u.bw=p,u.bx=V_,u.by=Gs,u.bz=function(c){return c.message===_t},u.c=He,u.d=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=q,u.f=c=>new Promise((a,f)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=ct})},m.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(b):ct}),u.g=Pt,u.h=(c,a)=>rn(q(c,{type:"json"}),a),u.i=Ue,u.j=At,u.k=Ge,u.l=(c,a)=>rn(q(c,{type:"arrayBuffer"}),a),u.m=rn,u.n=function(c){return new tm(c).readFields(dA,[])},u.o=Xc,u.p=J_,u.q=ji,u.r=Bp,u.s=pn,u.t=Aa,u.u=Vt,u.v=de,u.w=xe,u.x=Zs,u.y=function([c,a,f]){return a+=90,a*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(f),y:c*Math.sin(a)*Math.sin(f),z:c*Math.cos(f)}},u.z=Ei}),i("worker",["./shared"],function(u){class s{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,ce){for(const we of ne){this._layerConfigs[we.id]=we;const Oe=this._layers[we.id]=u.az(we);Oe._featureFilter=u.a6(Oe.filter),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of ce)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const _e=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const we of _e){const Oe=we.map(Qe=>this._layers[Qe.id]),$e=Oe[0];if($e.visibility==="none")continue;const je=$e.source||"";let De=this.familiesBySource[je];De||(De=this.familiesBySource[je]={});const re=$e.sourceLayer||"_geojsonTileLayer";let Je=De[re];Je||(Je=De[re]=[]),Je.push(Oe)}}}class h{constructor(ne){const ce={},_e=[];for(const je in ne){const De=ne[je],re=ce[je]={};for(const Je in De){const Qe=De[+Je];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const rt={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};_e.push(rt),re[Je]={rect:rt,metrics:Qe.metrics}}}const{w:we,h:Oe}=u.p(_e),$e=new u.o({width:we||1,height:Oe||1});for(const je in ne){const De=ne[je];for(const re in De){const Je=De[+re];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const Qe=ce[je][re].rect;u.o.copy(Je.bitmap,$e,{x:0,y:0},{x:Qe.x+1,y:Qe.y+1},Je.bitmap)}}this.image=$e,this.positions=ce}}u.bi("GlyphAtlas",h);class p{constructor(ne){this.tileID=new u.Q(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[]}parse(ne,ce,_e,we){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new u.a4;const Oe=new u.bj(Object.keys(ne.layers).sort()),$e=new u.bk(this.tileID,this.promoteId);$e.bucketLayerIDs=[];const je={},De={featureIndex:$e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:_e},re=ce.familiesBySource[this.source];for(const Tn in re){const Or=ne.layers[Tn];if(!Or)continue;Or.version===1&&u.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ii=Oe.encode(Tn),Mi=[];for(let Oi=0;Oi<Or.length;Oi++){const gi=Or.feature(Oi),qo=$e.getId(gi,Tn);Mi.push({feature:gi,id:qo,index:Oi,sourceLayerIndex:ii})}for(const Oi of re[Tn]){const gi=Oi[0];gi.source!==this.source&&u.w(`layer.source = ${gi.source} does not equal this.source = ${this.source}`),gi.minzoom&&this.zoom<Math.floor(gi.minzoom)||gi.maxzoom&&this.zoom>=gi.maxzoom||gi.visibility!=="none"&&(g(Oi,this.zoom,_e),(je[gi.id]=gi.createBucket({index:$e.bucketLayerIDs.length,layers:Oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source})).populate(Mi,De,this.tileID.canonical),$e.bucketLayerIDs.push(Oi.map(qo=>qo.id)))}}const Je=u.aE(De.glyphDependencies,Tn=>Object.keys(Tn).map(Number));this.inFlightDependencies.forEach(Tn=>Tn==null?void 0:Tn.abort()),this.inFlightDependencies=[];let Qe=Promise.resolve({});if(Object.keys(Je).length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),Qe=we.sendAsync({type:"GG",data:{stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"}},Tn)}const rt=Object.keys(De.iconDependencies);let ht=Promise.resolve({});if(rt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),ht=we.sendAsync({type:"GI",data:{icons:rt,source:this.source,tileID:this.tileID,type:"icons"}},Tn)}const Dt=Object.keys(De.patternDependencies);let en=Promise.resolve({});if(Dt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),en=we.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Tn)}const[mn,Cn,Nn]=yield Promise.all([Qe,ht,en]),Mr=new h(mn),Xr=new u.bl(Cn,Nn);for(const Tn in je){const Or=je[Tn];Or instanceof u.a5?(g(Or.layers,this.zoom,_e),u.bm({bucket:Or,glyphMap:mn,glyphPositions:Mr.positions,imageMap:Cn,imagePositions:Xr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Or.hasPattern&&(Or instanceof u.bn||Or instanceof u.bo||Or instanceof u.bp)&&(g(Or.layers,this.zoom,_e),Or.addFeatures(De,this.tileID.canonical,Xr.patternPositions))}return this.status="done",{buckets:Object.values(je).filter(Tn=>!Tn.isEmpty()),featureIndex:$e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mr.image,imageAtlas:Xr,glyphMap:this.returnDependencies?mn:null,iconMap:this.returnDependencies?Cn:null,glyphPositions:this.returnDependencies?Mr.positions:null}})}}function g(Se,ne,ce){const _e=new u.a8(ne);for(const we of Se)we.recalculate(_e,ce)}class _{constructor(ne,ce,_e){this.actor=ne,this.layerIndex=ce,this.availableImages=_e,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const _e=yield u.l(ne.request,ce);try{return{vectorTile:new u.bq.VectorTile(new u.br(_e.data)),rawData:_e.data,cacheControl:_e.cacheControl,expires:_e.expires}}catch(we){const Oe=new Uint8Array(_e.data);let $e=`Unable to parse the tile at ${ne.request.url}, `;throw $e+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.messge}`,new Error($e)}})}loadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid,_e=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request),we=new p(ne);this.loading[ce]=we;const Oe=new AbortController;we.abort=Oe;try{const $e=yield this.loadVectorTile(ne,Oe);if(delete this.loading[ce],!$e)return null;const je=$e.rawData,De={};$e.expires&&(De.expires=$e.expires),$e.cacheControl&&(De.cacheControl=$e.cacheControl);const re={};if(_e){const Qe=_e.finish();Qe&&(re.resourceTiming=JSON.parse(JSON.stringify(Qe)))}we.vectorTile=$e.vectorTile;const Je=we.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ce]=we,this.fetching[ce]={rawTileData:je,cacheControl:De,resourceTiming:re};try{const Qe=yield Je;return u.e({rawTileData:je.slice(0)},Qe,De,re)}finally{delete this.fetching[ce]}}catch($e){throw delete this.loading[ce],we.status="done",this.loaded[ce]=we,$e}})}reloadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const _e=this.loaded[ce];if(_e.showCollisionBoxes=ne.showCollisionBoxes,_e.status==="parsing"){const we=yield _e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor);let Oe;if(this.fetching[ce]){const{rawTileData:$e,cacheControl:je,resourceTiming:De}=this.fetching[ce];delete this.fetching[ce],Oe=u.e({rawTileData:$e.slice(0)},we,je,De)}else Oe=we;return Oe}if(_e.status==="done"&&_e.vectorTile)return _e.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ne){return u._(this,void 0,void 0,function*(){const ce=this.loading,_e=ne.uid;ce&&ce[_e]&&ce[_e].abort&&(ce[_e].abort.abort(),delete ce[_e])})}removeTile(ne){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]})}}class x{constructor(){this.loaded={}}loadTile(ne){return u._(this,void 0,void 0,function*(){const{uid:ce,encoding:_e,rawImageData:we,redFactor:Oe,greenFactor:$e,blueFactor:je,baseShift:De}=ne,re=we.width+2,Je=we.height+2,Qe=u.b(we)?new u.R({width:re,height:Je},yield u.bt(we,-1,-1,re,Je)):we,rt=new u.bu(ce,Qe,_e,Oe,$e,je,De);return this.loaded=this.loaded||{},this.loaded[ce]=rt,rt})}removeTile(ne){const ce=this.loaded,_e=ne.uid;ce&&ce[_e]&&delete ce[_e]}}function C(Se,ne){if(Se.length!==0){T(Se[0],ne);for(var ce=1;ce<Se.length;ce++)T(Se[ce],!ne)}}function T(Se,ne){for(var ce=0,_e=0,we=0,Oe=Se.length,$e=Oe-1;we<Oe;$e=we++){var je=(Se[we][0]-Se[$e][0])*(Se[$e][1]+Se[we][1]),De=ce+je;_e+=Math.abs(ce)>=Math.abs(je)?ce-De+je:je-De+ce,ce=De}ce+_e>=0!=!!ne&&Se.reverse()}var z=u.bv(function Se(ne,ce){var _e,we=ne&&ne.type;if(we==="FeatureCollection")for(_e=0;_e<ne.features.length;_e++)Se(ne.features[_e],ce);else if(we==="GeometryCollection")for(_e=0;_e<ne.geometries.length;_e++)Se(ne.geometries[_e],ce);else if(we==="Feature")Se(ne.geometry,ce);else if(we==="Polygon")C(ne.coordinates,ce);else if(we==="MultiPolygon")for(_e=0;_e<ne.coordinates.length;_e++)C(ne.coordinates[_e],ce);return ne});const L=u.bq.VectorTileFeature.prototype.toGeoJSON;var E={exports:{}},I=u.bw,O=u.bq.VectorTileFeature,B=K;function K(Se,ne){this.options=ne||{},this.features=Se,this.length=Se.length}function H(Se,ne){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=ne||4096}K.prototype.feature=function(Se){return new H(this.features[Se],this.options.extent)},H.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Se.length;ne++){for(var ce=Se[ne],_e=[],we=0;we<ce.length;we++)_e.push(new I(ce[we][0],ce[we][1]));this.geometry.push(_e)}return this.geometry},H.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,ne=1/0,ce=-1/0,_e=1/0,we=-1/0,Oe=0;Oe<Se.length;Oe++)for(var $e=Se[Oe],je=0;je<$e.length;je++){var De=$e[je];ne=Math.min(ne,De.x),ce=Math.max(ce,De.x),_e=Math.min(_e,De.y),we=Math.max(we,De.y)}return[ne,_e,ce,we]},H.prototype.toGeoJSON=O.prototype.toGeoJSON;var q=u.bx,J=B;function fe(Se){var ne=new q;return function(ce,_e){for(var we in ce.layers)_e.writeMessage(3,Ee,ce.layers[we])}(Se,ne),ne.finish()}function Ee(Se,ne){var ce;ne.writeVarintField(15,Se.version||1),ne.writeStringField(1,Se.name||""),ne.writeVarintField(5,Se.extent||4096);var _e={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Se.length;ce++)_e.feature=Se.feature(ce),ne.writeMessage(2,ee,_e);var we=_e.keys;for(ce=0;ce<we.length;ce++)ne.writeStringField(3,we[ce]);var Oe=_e.values;for(ce=0;ce<Oe.length;ce++)ne.writeMessage(4,Ue,Oe[ce])}function ee(Se,ne){var ce=Se.feature;ce.id!==void 0&&ne.writeVarintField(1,ce.id),ne.writeMessage(2,oe,Se),ne.writeVarintField(3,ce.type),ne.writeMessage(4,tt,ce)}function oe(Se,ne){var ce=Se.feature,_e=Se.keys,we=Se.values,Oe=Se.keycache,$e=Se.valuecache;for(var je in ce.properties){var De=ce.properties[je],re=Oe[je];if(De!==null){re===void 0&&(_e.push(je),Oe[je]=re=_e.length-1),ne.writeVarint(re);var Je=typeof De;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(De=JSON.stringify(De));var Qe=Je+":"+De,rt=$e[Qe];rt===void 0&&(we.push(De),$e[Qe]=rt=we.length-1),ne.writeVarint(rt)}}}function xe(Se,ne){return(ne<<3)+(7&Se)}function me(Se){return Se<<1^Se>>31}function tt(Se,ne){for(var ce=Se.loadGeometry(),_e=Se.type,we=0,Oe=0,$e=ce.length,je=0;je<$e;je++){var De=ce[je],re=1;_e===1&&(re=De.length),ne.writeVarint(xe(1,re));for(var Je=_e===3?De.length-1:De.length,Qe=0;Qe<Je;Qe++){Qe===1&&_e!==1&&ne.writeVarint(xe(2,Je-1));var rt=De[Qe].x-we,ht=De[Qe].y-Oe;ne.writeVarint(me(rt)),ne.writeVarint(me(ht)),we+=rt,Oe+=ht}_e===3&&ne.writeVarint(xe(7,1))}}function Ue(Se,ne){var ce=typeof Se;ce==="string"?ne.writeStringField(1,Se):ce==="boolean"?ne.writeBooleanField(7,Se):ce==="number"&&(Se%1!=0?ne.writeDoubleField(3,Se):Se<0?ne.writeSVarintField(6,Se):ne.writeVarintField(5,Se))}E.exports=fe,E.exports.fromVectorTileJs=fe,E.exports.fromGeojsonVt=function(Se,ne){ne=ne||{};var ce={};for(var _e in Se)ce[_e]=new J(Se[_e].features,ne),ce[_e].name=_e,ce[_e].version=ne.version,ce[_e].extent=ne.extent;return fe({layers:ce})},E.exports.GeoJSONWrapper=J;var ze=u.bv(E.exports);const Ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},ct=Math.fround||(Xe=new Float32Array(1),Se=>(Xe[0]=+Se,Xe[0]));var Xe;const lt=3,pt=5,_t=6;class He{constructor(ne){this.options=Object.assign(Object.create(Ie),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:_e,maxZoom:we}=this.options;ce&&console.time("total time");const Oe=`prepare ${ne.length} points`;ce&&console.time(Oe),this.points=ne;const $e=[];for(let De=0;De<ne.length;De++){const re=ne[De];if(!re.geometry)continue;const[Je,Qe]=re.geometry.coordinates,rt=ct(jt(Je)),ht=ct(un(Qe));$e.push(rt,ht,1/0,De,-1,1),this.options.reduce&&$e.push(0)}let je=this.trees[we+1]=this._createTree($e);ce&&console.timeEnd(Oe);for(let De=we;De>=_e;De--){const re=+Date.now();je=this.trees[De]=this._createTree(this._cluster(je,De)),ce&&console.log("z%d: %d clusters in %dms",De,je.numItems,+Date.now()-re)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let _e=((ne[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,ne[1]));let Oe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)_e=-180,Oe=180;else if(_e>Oe){const Qe=this.getClusters([_e,we,180,$e],ce),rt=this.getClusters([-180,we,Oe,$e],ce);return Qe.concat(rt)}const je=this.trees[this._limitZoom(ce)],De=je.range(jt(_e),un($e),jt(Oe),un(we)),re=je.data,Je=[];for(const Qe of De){const rt=this.stride*Qe;Je.push(re[rt+pt]>1?gt(re,rt,this.clusterProps):this.points[re[rt+lt]])}return Je}getChildren(ne){const ce=this._getOriginId(ne),_e=this._getOriginZoom(ne),we="No cluster with the specified id.",Oe=this.trees[_e];if(!Oe)throw new Error(we);const $e=Oe.data;if(ce*this.stride>=$e.length)throw new Error(we);const je=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),De=Oe.within($e[ce*this.stride],$e[ce*this.stride+1],je),re=[];for(const Je of De){const Qe=Je*this.stride;$e[Qe+4]===ne&&re.push($e[Qe+pt]>1?gt($e,Qe,this.clusterProps):this.points[$e[Qe+lt]])}if(re.length===0)throw new Error(we);return re}getLeaves(ne,ce,_e){const we=[];return this._appendLeaves(we,ne,ce=ce||10,_e=_e||0,0),we}getTile(ne,ce,_e){const we=this.trees[this._limitZoom(ne)],Oe=Math.pow(2,ne),{extent:$e,radius:je}=this.options,De=je/$e,re=(_e-De)/Oe,Je=(_e+1+De)/Oe,Qe={features:[]};return this._addTileFeatures(we.range((ce-De)/Oe,re,(ce+1+De)/Oe,Je),we.data,ce,_e,Oe,Qe),ce===0&&this._addTileFeatures(we.range(1-De/Oe,re,1,Je),we.data,Oe,_e,Oe,Qe),ce===Oe-1&&this._addTileFeatures(we.range(0,re,De/Oe,Je),we.data,-1,_e,Oe,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const _e=this.getChildren(ne);if(ce++,_e.length!==1)break;ne=_e[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,_e,we,Oe){const $e=this.getChildren(ce);for(const je of $e){const De=je.properties;if(De&&De.cluster?Oe+De.point_count<=we?Oe+=De.point_count:Oe=this._appendLeaves(ne,De.cluster_id,_e,we,Oe):Oe<we?Oe++:ne.push(je),ne.length===_e)break}return Oe}_createTree(ne){const ce=new u.au(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let _e=0;_e<ne.length;_e+=this.stride)ce.add(ne[_e],ne[_e+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,_e,we,Oe,$e){for(const je of ne){const De=je*this.stride,re=ce[De+pt]>1;let Je,Qe,rt;if(re)Je=Pt(ce,De,this.clusterProps),Qe=ce[De],rt=ce[De+1];else{const en=this.points[ce[De+lt]];Je=en.properties;const[mn,Cn]=en.geometry.coordinates;Qe=jt(mn),rt=un(Cn)}const ht={type:1,geometry:[[Math.round(this.options.extent*(Qe*Oe-_e)),Math.round(this.options.extent*(rt*Oe-we))]],tags:Je};let Dt;Dt=re||this.options.generateId?ce[De+lt]:this.points[ce[De+lt]].id,Dt!==void 0&&(ht.id=Dt),$e.features.push(ht)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:_e,extent:we,reduce:Oe,minPoints:$e}=this.options,je=_e/(we*Math.pow(2,ce)),De=ne.data,re=[],Je=this.stride;for(let Qe=0;Qe<De.length;Qe+=Je){if(De[Qe+2]<=ce)continue;De[Qe+2]=ce;const rt=De[Qe],ht=De[Qe+1],Dt=ne.within(De[Qe],De[Qe+1],je),en=De[Qe+pt];let mn=en;for(const Cn of Dt){const Nn=Cn*Je;De[Nn+2]>ce&&(mn+=De[Nn+pt])}if(mn>en&&mn>=$e){let Cn,Nn=rt*en,Mr=ht*en,Xr=-1;const Tn=((Qe/Je|0)<<5)+(ce+1)+this.points.length;for(const Or of Dt){const ii=Or*Je;if(De[ii+2]<=ce)continue;De[ii+2]=ce;const Mi=De[ii+pt];Nn+=De[ii]*Mi,Mr+=De[ii+1]*Mi,De[ii+4]=Tn,Oe&&(Cn||(Cn=this._map(De,Qe,!0),Xr=this.clusterProps.length,this.clusterProps.push(Cn)),Oe(Cn,this._map(De,ii)))}De[Qe+4]=Tn,re.push(Nn/mn,Mr/mn,1/0,Tn,-1,mn),Oe&&re.push(Xr)}else{for(let Cn=0;Cn<Je;Cn++)re.push(De[Qe+Cn]);if(mn>1)for(const Cn of Dt){const Nn=Cn*Je;if(!(De[Nn+2]<=ce)){De[Nn+2]=ce;for(let Mr=0;Mr<Je;Mr++)re.push(De[Nn+Mr])}}}}return re}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,_e){if(ne[ce+pt]>1){const $e=this.clusterProps[ne[ce+_t]];return _e?Object.assign({},$e):$e}const we=this.points[ne[ce+lt]].properties,Oe=this.options.map(we);return _e&&Oe===we?Object.assign({},Oe):Oe}}function gt(Se,ne,ce){return{type:"Feature",id:Se[ne+lt],properties:Pt(Se,ne,ce),geometry:{type:"Point",coordinates:[(_e=Se[ne],360*(_e-.5)),nn(Se[ne+1])]}};var _e}function Pt(Se,ne,ce){const _e=Se[ne+pt],we=_e>=1e4?`${Math.round(_e/1e3)}k`:_e>=1e3?Math.round(_e/100)/10+"k":_e,Oe=Se[ne+_t],$e=Oe===-1?{}:Object.assign({},ce[Oe]);return Object.assign($e,{cluster:!0,cluster_id:Se[ne+lt],point_count:_e,point_count_abbreviated:we})}function jt(Se){return Se/360+.5}function un(Se){const ne=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function nn(Se){const ne=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function rn(Se,ne,ce,_e){for(var we,Oe=_e,$e=ce-ne>>1,je=ce-ne,De=Se[ne],re=Se[ne+1],Je=Se[ce],Qe=Se[ce+1],rt=ne+3;rt<ce;rt+=3){var ht=pn(Se[rt],Se[rt+1],De,re,Je,Qe);if(ht>Oe)we=rt,Oe=ht;else if(ht===Oe){var Dt=Math.abs(rt-$e);Dt<je&&(we=rt,je=Dt)}}Oe>_e&&(we-ne>3&&rn(Se,ne,we,_e),Se[we+2]=Oe,ce-we>3&&rn(Se,we,ce,_e))}function pn(Se,ne,ce,_e,we,Oe){var $e=we-ce,je=Oe-_e;if($e!==0||je!==0){var De=((Se-ce)*$e+(ne-_e)*je)/($e*$e+je*je);De>1?(ce=we,_e=Oe):De>0&&(ce+=$e*De,_e+=je*De)}return($e=Se-ce)*$e+(je=ne-_e)*je}function yn(Se,ne,ce,_e){var we={id:Se===void 0?null:Se,type:ne,geometry:ce,tags:_e,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var $e=Oe.geometry,je=Oe.type;if(je==="Point"||je==="MultiPoint"||je==="LineString")qe(Oe,$e);else if(je==="Polygon"||je==="MultiLineString")for(var De=0;De<$e.length;De++)qe(Oe,$e[De]);else if(je==="MultiPolygon")for(De=0;De<$e.length;De++)for(var re=0;re<$e[De].length;re++)qe(Oe,$e[De][re])}(we),we}function qe(Se,ne){for(var ce=0;ce<ne.length;ce+=3)Se.minX=Math.min(Se.minX,ne[ce]),Se.minY=Math.min(Se.minY,ne[ce+1]),Se.maxX=Math.max(Se.maxX,ne[ce]),Se.maxY=Math.max(Se.maxY,ne[ce+1])}function Ge(Se,ne,ce,_e){if(ne.geometry){var we=ne.geometry.coordinates,Oe=ne.geometry.type,$e=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),je=[],De=ne.id;if(ce.promoteId?De=ne.properties[ce.promoteId]:ce.generateId&&(De=_e||0),Oe==="Point")At(we,je);else if(Oe==="MultiPoint")for(var re=0;re<we.length;re++)At(we[re],je);else if(Oe==="LineString")nt(we,je,$e,!1);else if(Oe==="MultiLineString"){if(ce.lineMetrics){for(re=0;re<we.length;re++)nt(we[re],je=[],$e,!1),Se.push(yn(De,"LineString",je,ne.properties));return}de(we,je,$e,!1)}else if(Oe==="Polygon")de(we,je,$e,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(re=0;re<ne.geometry.geometries.length;re++)Ge(Se,{id:De,geometry:ne.geometry.geometries[re],properties:ne.properties},ce,_e);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<we.length;re++){var Je=[];de(we[re],Je,$e,!0),je.push(Je)}}Se.push(yn(De,Oe,je,ne.properties))}}function At(Se,ne){ne.push(cn(Se[0])),ne.push(Ke(Se[1])),ne.push(0)}function nt(Se,ne,ce,_e){for(var we,Oe,$e=0,je=0;je<Se.length;je++){var De=cn(Se[je][0]),re=Ke(Se[je][1]);ne.push(De),ne.push(re),ne.push(0),je>0&&($e+=_e?(we*re-De*Oe)/2:Math.sqrt(Math.pow(De-we,2)+Math.pow(re-Oe,2))),we=De,Oe=re}var Je=ne.length-3;ne[2]=1,rn(ne,0,Je,ce),ne[Je+2]=1,ne.size=Math.abs($e),ne.start=0,ne.end=ne.size}function de(Se,ne,ce,_e){for(var we=0;we<Se.length;we++){var Oe=[];nt(Se[we],Oe,ce,_e),ne.push(Oe)}}function cn(Se){return Se/360+.5}function Ke(Se){var ne=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function ut(Se,ne,ce,_e,we,Oe,$e,je){if(_e/=ne,Oe>=(ce/=ne)&&$e<_e)return Se;if($e<ce||Oe>=_e)return null;for(var De=[],re=0;re<Se.length;re++){var Je=Se[re],Qe=Je.geometry,rt=Je.type,ht=we===0?Je.minX:Je.minY,Dt=we===0?Je.maxX:Je.maxY;if(ht>=ce&&Dt<_e)De.push(Je);else if(!(Dt<ce||ht>=_e)){var en=[];if(rt==="Point"||rt==="MultiPoint")Gt(Qe,en,ce,_e,we);else if(rt==="LineString")Jn(Qe,en,ce,_e,we,!1,je.lineMetrics);else if(rt==="MultiLineString")fr(Qe,en,ce,_e,we,!1);else if(rt==="Polygon")fr(Qe,en,ce,_e,we,!0);else if(rt==="MultiPolygon")for(var mn=0;mn<Qe.length;mn++){var Cn=[];fr(Qe[mn],Cn,ce,_e,we,!0),Cn.length&&en.push(Cn)}if(en.length){if(je.lineMetrics&&rt==="LineString"){for(mn=0;mn<en.length;mn++)De.push(yn(Je.id,rt,en[mn],Je.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(en.length===1?(rt="LineString",en=en[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=en.length===3?"Point":"MultiPoint"),De.push(yn(Je.id,rt,en,Je.tags))}}}return De.length?De:null}function Gt(Se,ne,ce,_e,we){for(var Oe=0;Oe<Se.length;Oe+=3){var $e=Se[Oe+we];$e>=ce&&$e<=_e&&(ne.push(Se[Oe]),ne.push(Se[Oe+1]),ne.push(Se[Oe+2]))}}function Jn(Se,ne,ce,_e,we,Oe,$e){for(var je,De,re=Zn(Se),Je=we===0?Tr:xi,Qe=Se.start,rt=0;rt<Se.length-3;rt+=3){var ht=Se[rt],Dt=Se[rt+1],en=Se[rt+2],mn=Se[rt+3],Cn=Se[rt+4],Nn=we===0?ht:Dt,Mr=we===0?mn:Cn,Xr=!1;$e&&(je=Math.sqrt(Math.pow(ht-mn,2)+Math.pow(Dt-Cn,2))),Nn<ce?Mr>ce&&(De=Je(re,ht,Dt,mn,Cn,ce),$e&&(re.start=Qe+je*De)):Nn>_e?Mr<_e&&(De=Je(re,ht,Dt,mn,Cn,_e),$e&&(re.start=Qe+je*De)):Cr(re,ht,Dt,en),Mr<ce&&Nn>=ce&&(De=Je(re,ht,Dt,mn,Cn,ce),Xr=!0),Mr>_e&&Nn<=_e&&(De=Je(re,ht,Dt,mn,Cn,_e),Xr=!0),!Oe&&Xr&&($e&&(re.end=Qe+je*De),ne.push(re),re=Zn(Se)),$e&&(Qe+=je)}var Tn=Se.length-3;ht=Se[Tn],Dt=Se[Tn+1],en=Se[Tn+2],(Nn=we===0?ht:Dt)>=ce&&Nn<=_e&&Cr(re,ht,Dt,en),Tn=re.length-3,Oe&&Tn>=3&&(re[Tn]!==re[0]||re[Tn+1]!==re[1])&&Cr(re,re[0],re[1],re[2]),re.length&&ne.push(re)}function Zn(Se){var ne=[];return ne.size=Se.size,ne.start=Se.start,ne.end=Se.end,ne}function fr(Se,ne,ce,_e,we,Oe){for(var $e=0;$e<Se.length;$e++)Jn(Se[$e],ne,ce,_e,we,Oe,!1)}function Cr(Se,ne,ce,_e){Se.push(ne),Se.push(ce),Se.push(_e)}function Tr(Se,ne,ce,_e,we,Oe){var $e=(Oe-ne)/(_e-ne);return Se.push(Oe),Se.push(ce+(we-ce)*$e),Se.push(1),$e}function xi(Se,ne,ce,_e,we,Oe){var $e=(Oe-ce)/(we-ce);return Se.push(ne+(_e-ne)*$e),Se.push(Oe),Se.push(1),$e}function Un(Se,ne){for(var ce=[],_e=0;_e<Se.length;_e++){var we,Oe=Se[_e],$e=Oe.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")we=xt(Oe.geometry,ne);else if($e==="MultiLineString"||$e==="Polygon"){we=[];for(var je=0;je<Oe.geometry.length;je++)we.push(xt(Oe.geometry[je],ne))}else if($e==="MultiPolygon")for(we=[],je=0;je<Oe.geometry.length;je++){for(var De=[],re=0;re<Oe.geometry[je].length;re++)De.push(xt(Oe.geometry[je][re],ne));we.push(De)}ce.push(yn(Oe.id,$e,we,Oe.tags))}return ce}function xt(Se,ne){var ce=[];ce.size=Se.size,Se.start!==void 0&&(ce.start=Se.start,ce.end=Se.end);for(var _e=0;_e<Se.length;_e+=3)ce.push(Se[_e]+ne,Se[_e+1],Se[_e+2]);return ce}function zr(Se,ne){if(Se.transformed)return Se;var ce,_e,we,Oe=1<<Se.z,$e=Se.x,je=Se.y;for(ce=0;ce<Se.features.length;ce++){var De=Se.features[ce],re=De.geometry,Je=De.type;if(De.geometry=[],Je===1)for(_e=0;_e<re.length;_e+=2)De.geometry.push(br(re[_e],re[_e+1],ne,Oe,$e,je));else for(_e=0;_e<re.length;_e++){var Qe=[];for(we=0;we<re[_e].length;we+=2)Qe.push(br(re[_e][we],re[_e][we+1],ne,Oe,$e,je));De.geometry.push(Qe)}}return Se.transformed=!0,Se}function br(Se,ne,ce,_e,we,Oe){return[Math.round(ce*(Se*_e-we)),Math.round(ce*(ne*_e-Oe))]}function Fi(Se,ne,ce,_e,we){for(var Oe=ne===we.maxZoom?0:we.tolerance/((1<<ne)*we.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:_e,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},je=0;je<Se.length;je++){$e.numFeatures++,$n($e,Se[je],Oe,we);var De=Se[je].minX,re=Se[je].minY,Je=Se[je].maxX,Qe=Se[je].maxY;De<$e.minX&&($e.minX=De),re<$e.minY&&($e.minY=re),Je>$e.maxX&&($e.maxX=Je),Qe>$e.maxY&&($e.maxY=Qe)}return $e}function $n(Se,ne,ce,_e){var we=ne.geometry,Oe=ne.type,$e=[];if(Oe==="Point"||Oe==="MultiPoint")for(var je=0;je<we.length;je+=3)$e.push(we[je]),$e.push(we[je+1]),Se.numPoints++,Se.numSimplified++;else if(Oe==="LineString")Fe($e,we,Se,ce,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(je=0;je<we.length;je++)Fe($e,we[je],Se,ce,Oe==="Polygon",je===0);else if(Oe==="MultiPolygon")for(var De=0;De<we.length;De++){var re=we[De];for(je=0;je<re.length;je++)Fe($e,re[je],Se,ce,!0,je===0)}if($e.length){var Je=ne.tags||null;if(Oe==="LineString"&&_e.lineMetrics){for(var Qe in Je={},ne.tags)Je[Qe]=ne.tags[Qe];Je.mapbox_clip_start=we.start/we.size,Je.mapbox_clip_end=we.end/we.size}var rt={geometry:$e,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:Je};ne.id!==null&&(rt.id=ne.id),Se.features.push(rt)}}function Fe(Se,ne,ce,_e,we,Oe){var $e=_e*_e;if(_e>0&&ne.size<(we?$e:_e))ce.numPoints+=ne.length/3;else{for(var je=[],De=0;De<ne.length;De+=3)(_e===0||ne[De+2]>$e)&&(ce.numSimplified++,je.push(ne[De]),je.push(ne[De+1])),ce.numPoints++;we&&function(re,Je){for(var Qe=0,rt=0,ht=re.length,Dt=ht-2;rt<ht;Dt=rt,rt+=2)Qe+=(re[rt]-re[Dt])*(re[rt+1]+re[Dt+1]);if(Qe>0===Je)for(rt=0,ht=re.length;rt<ht/2;rt+=2){var en=re[rt],mn=re[rt+1];re[rt]=re[ht-2-rt],re[rt+1]=re[ht-1-rt],re[ht-2-rt]=en,re[ht-1-rt]=mn}}(je,Oe),Se.push(je)}}function yt(Se,ne){var ce=(ne=this.options=function(we,Oe){for(var $e in Oe)we[$e]=Oe[$e];return we}(Object.create(this.options),ne)).debug;if(ce&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var _e=function(we,Oe){var $e=[];if(we.type==="FeatureCollection")for(var je=0;je<we.features.length;je++)Ge($e,we.features[je],Oe,je);else Ge($e,we.type==="Feature"?we:{geometry:we},Oe);return $e}(Se,ne);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_e=function(we,Oe){var $e=Oe.buffer/Oe.extent,je=we,De=ut(we,1,-1-$e,$e,0,-1,2,Oe),re=ut(we,1,1-$e,2+$e,0,-1,2,Oe);return(De||re)&&(je=ut(we,1,-$e,1+$e,0,-1,2,Oe)||[],De&&(je=Un(De,1).concat(je)),re&&(je=je.concat(Un(re,-1)))),je}(_e,ne),_e.length&&this.splitTile(_e,0,0,0),ce&&(_e.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bt(Se,ne,ce){return 32*((1<<Se)*ce+ne)+Se}function Rt(Se,ne){return ne?Se.properties[ne]:Se.id}function Qt(Se,ne){if(Se==null)return!0;if(Se.type==="Feature")return Rt(Se,ne)!=null;if(Se.type==="FeatureCollection"){const ce=new Set;for(const _e of Se.features){const we=Rt(_e,ne);if(we==null||ce.has(we))return!1;ce.add(we)}return!0}return!1}function Yt(Se,ne){const ce=new Map;if(Se!=null)if(Se.type==="Feature")ce.set(Rt(Se,ne),Se);else for(const _e of Se.features)ce.set(Rt(_e,ne),_e);return ce}yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(Se,ne,ce,_e,we,Oe,$e){for(var je=[Se,ne,ce,_e],De=this.options,re=De.debug;je.length;){_e=je.pop(),ce=je.pop(),ne=je.pop(),Se=je.pop();var Je=1<<ne,Qe=bt(ne,ce,_e),rt=this.tiles[Qe];if(!rt&&(re>1&&console.time("creation"),rt=this.tiles[Qe]=Fi(Se,ne,ce,_e,De),this.tileCoords.push({z:ne,x:ce,y:_e}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ce,_e,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));var ht="z"+ne;this.stats[ht]=(this.stats[ht]||0)+1,this.total++}if(rt.source=Se,we){if(ne===De.maxZoom||ne===we)continue;var Dt=1<<we-ne;if(ce!==Math.floor(Oe/Dt)||_e!==Math.floor($e/Dt))continue}else if(ne===De.indexMaxZoom||rt.numPoints<=De.indexMaxPoints)continue;if(rt.source=null,Se.length!==0){re>1&&console.time("clipping");var en,mn,Cn,Nn,Mr,Xr,Tn=.5*De.buffer/De.extent,Or=.5-Tn,ii=.5+Tn,Mi=1+Tn;en=mn=Cn=Nn=null,Mr=ut(Se,Je,ce-Tn,ce+ii,0,rt.minX,rt.maxX,De),Xr=ut(Se,Je,ce+Or,ce+Mi,0,rt.minX,rt.maxX,De),Se=null,Mr&&(en=ut(Mr,Je,_e-Tn,_e+ii,1,rt.minY,rt.maxY,De),mn=ut(Mr,Je,_e+Or,_e+Mi,1,rt.minY,rt.maxY,De),Mr=null),Xr&&(Cn=ut(Xr,Je,_e-Tn,_e+ii,1,rt.minY,rt.maxY,De),Nn=ut(Xr,Je,_e+Or,_e+Mi,1,rt.minY,rt.maxY,De),Xr=null),re>1&&console.timeEnd("clipping"),je.push(en||[],ne+1,2*ce,2*_e),je.push(mn||[],ne+1,2*ce,2*_e+1),je.push(Cn||[],ne+1,2*ce+1,2*_e),je.push(Nn||[],ne+1,2*ce+1,2*_e+1)}}},yt.prototype.getTile=function(Se,ne,ce){var _e=this.options,we=_e.extent,Oe=_e.debug;if(Se<0||Se>24)return null;var $e=1<<Se,je=bt(Se,ne=(ne%$e+$e)%$e,ce);if(this.tiles[je])return zr(this.tiles[je],we);Oe>1&&console.log("drilling down to z%d-%d-%d",Se,ne,ce);for(var De,re=Se,Je=ne,Qe=ce;!De&&re>0;)re--,Je=Math.floor(Je/2),Qe=Math.floor(Qe/2),De=this.tiles[bt(re,Je,Qe)];return De&&De.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",re,Je,Qe),Oe>1&&console.time("drilling down"),this.splitTile(De.source,re,Je,Qe,Se,ne,ce),Oe>1&&console.timeEnd("drilling down"),this.tiles[je]?zr(this.tiles[je],we):null):null};class vr extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const _e=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(_e.z,_e.x,_e.y);if(!we)return null;const Oe=new class{constructor(je){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=je.length,this._features=je}feature(je){return new class{constructor(De){this._feature=De,this.extent=u.W,this.type=De.type,this.properties=De.tags,"id"in De&&!isNaN(De.id)&&(this.id=parseInt(De.id,10))}loadGeometry(){if(this._feature.type===1){const De=[];for(const re of this._feature.geometry)De.push([new u.P(re[0],re[1])]);return De}{const De=[];for(const re of this._feature.geometry){const Je=[];for(const Qe of re)Je.push(new u.P(Qe[0],Qe[1]));De.push(Je)}return De}}toGeoJSON(De,re,Je){return L.call(this,De,re,Je)}}(this._features[je])}}(we.features);let $e=ze(Oe);return $e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),{vectorTile:Oe,rawData:$e.buffer}})}loadData(ne){return u._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const _e=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request);this._pendingRequest=new AbortController;try{let we=yield this.loadGeoJSON(ne,this._pendingRequest);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(z(we,!0),ne.filter){const $e=u.by(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(De=>`${De.key}: ${De.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(De=>$e.value.evaluate({zoom:0},De))}}this._geoJSONIndex=ne.cluster?new He(function({superclusterOptions:$e,clusterProperties:je}){if(!je||!$e)return $e;const De={},re={},Je={accumulated:null,zoom:0},Qe={properties:null},rt=Object.keys(je);for(const ht of rt){const[Dt,en]=je[ht],mn=u.by(en),Cn=u.by(typeof Dt=="string"?[Dt,["accumulated"],["get",ht]]:Dt);De[ht]=mn.value,re[ht]=Cn.value}return $e.map=ht=>{Qe.properties=ht;const Dt={};for(const en of rt)Dt[en]=De[en].evaluate(Je,Qe);return Dt},$e.reduce=(ht,Dt)=>{Qe.properties=Dt;for(const en of rt)Je.accumulated=ht[en],ht[en]=re[en].evaluate(Je,Qe)},$e}(ne)).load(we.features):function($e,je){return new yt($e,je)}(we,ne.geojsonVtOptions),this.loaded={};const Oe={};if(_e){const $e=_e.finish();$e&&(Oe.resourceTiming={},Oe.resourceTiming[ne.source]=JSON.parse(JSON.stringify($e)))}return Oe}catch(we){if(delete this._pendingRequest,u.bz(we))return{abandoned:!0};throw we}})}reloadTile(ne){const ce=this.loaded;return ce&&ce[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadGeoJSON(ne,ce){return u._(this,void 0,void 0,function*(){const{promoteId:_e}=ne;if(ne.request){const we=yield u.h(ne.request,ce);return this._dataUpdateable=Qt(we.data,_e)?Yt(we.data,_e):void 0,we.data}if(typeof ne.data=="string")try{const we=JSON.parse(ne.data);return this._dataUpdateable=Qt(we,_e)?Yt(we,_e):void 0,we}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return function(we,Oe,$e){var je,De,re,Je;if(Oe.removeAll&&we.clear(),Oe.remove)for(const Qe of Oe.remove)we.delete(Qe);if(Oe.add)for(const Qe of Oe.add){const rt=Rt(Qe,$e);rt!=null&&we.set(rt,Qe)}if(Oe.update)for(const Qe of Oe.update){let rt=we.get(Qe.id);if(rt==null)continue;const ht=!Qe.removeAllProperties&&(((je=Qe.removeProperties)===null||je===void 0?void 0:je.length)>0||((De=Qe.addOrUpdateProperties)===null||De===void 0?void 0:De.length)>0);if((Qe.newGeometry||Qe.removeAllProperties||ht)&&(rt=Object.assign({},rt),we.set(Qe.id,rt),ht&&(rt.properties=Object.assign({},rt.properties))),Qe.newGeometry&&(rt.geometry=Qe.newGeometry),Qe.removeAllProperties)rt.properties={};else if(((re=Qe.removeProperties)===null||re===void 0?void 0:re.length)>0)for(const Dt of Qe.removeProperties)Object.prototype.hasOwnProperty.call(rt.properties,Dt)&&delete rt.properties[Dt];if(((Je=Qe.addOrUpdateProperties)===null||Je===void 0?void 0:Je.length)>0)for(const{key:Dt,value:en}of Qe.addOrUpdateProperties)rt.properties[Dt]=en}}(this._dataUpdateable,ne.dataDiff,_e),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ne){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class or{constructor(ne){this.self=ne,this.actor=new u.C(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,_e)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=_e},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=ce=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,_e)=>this._getDEMWorkerSource(ce,_e.source).loadTile(_e)),this.actor.registerMessageHandler("RDT",(ce,_e)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,_e.source).removeTile(_e)})),this.actor.registerMessageHandler("GCEZ",(ce,_e)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,_e.type,_e.source).getClusterExpansionZoom(_e)})),this.actor.registerMessageHandler("GCC",(ce,_e)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,_e.type,_e.source).getClusterChildren(_e)})),this.actor.registerMessageHandler("GCL",(ce,_e)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,_e.type,_e.source).getClusterLeaves(_e)})),this.actor.registerMessageHandler("LD",(ce,_e)=>this._getWorkerSource(ce,_e.type,_e.source).loadData(_e)),this.actor.registerMessageHandler("LT",(ce,_e)=>this._getWorkerSource(ce,_e.type,_e.source).loadTile(_e)),this.actor.registerMessageHandler("RT",(ce,_e)=>this._getWorkerSource(ce,_e.type,_e.source).reloadTile(_e)),this.actor.registerMessageHandler("AT",(ce,_e)=>this._getWorkerSource(ce,_e.type,_e.source).abortTile(_e)),this.actor.registerMessageHandler("RMT",(ce,_e)=>this._getWorkerSource(ce,_e.type,_e.source).removeTile(_e)),this.actor.registerMessageHandler("RS",(ce,_e)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][_e.type]||!this.workerSources[ce][_e.type][_e.source])return;const we=this.workerSources[ce][_e.type][_e.source];delete this.workerSources[ce][_e.type][_e.source],we.removeSource!==void 0&&we.removeSource(_e)})),this.actor.registerMessageHandler("RM",ce=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,_e)=>u._(this,void 0,void 0,function*(){this.referrer=_e})),this.actor.registerMessageHandler("SRPS",(ce,_e)=>this._syncRTLPluginState(ce,_e)),this.actor.registerMessageHandler("IS",(ce,_e)=>u._(this,void 0,void 0,function*(){this.self.importScripts(_e)})),this.actor.registerMessageHandler("SI",(ce,_e)=>this._setImages(ce,_e)),this.actor.registerMessageHandler("UL",(ce,_e)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(_e.layers,_e.removedIds)})),this.actor.registerMessageHandler("SL",(ce,_e)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(_e)}))}_setImages(ne,ce){return u._(this,void 0,void 0,function*(){this.availableImages[ne]=ce;for(const _e in this.workerSources[ne]){const we=this.workerSources[ne][_e];for(const Oe in we)we[Oe].availableImages=ce}})}_syncRTLPluginState(ne,ce){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(ce.pluginStatus!=="loading")return u.bA.setState(ce),ce;const _e=ce.pluginURL;if(this.self.importScripts(_e),u.bA.isParsed()){const we={pluginStatus:"loaded",pluginURL:_e};return u.bA.setState(we),we}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${_e}`)})}_getAvailableImages(ne){let ce=this.availableImages[ne];return ce||(ce=[]),ce}_getLayerIndex(ne){let ce=this.layerIndexes[ne];return ce||(ce=this.layerIndexes[ne]=new s),ce}_getWorkerSource(ne,ce,_e){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][ce]||(this.workerSources[ne][ce]={}),!this.workerSources[ne][ce][_e]){const we={sendAsync:(Oe,$e)=>(Oe.targetMapId=ne,this.actor.sendAsync(Oe,$e))};switch(ce){case"vector":this.workerSources[ne][ce][_e]=new _(we,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][ce][_e]=new vr(we,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][ce][_e]=new this.externalWorkerSourceTypes[ce](we,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][ce][_e]}_getDEMWorkerSource(ne,ce){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ce]||(this.demWorkerSources[ne][ce]=new x),this.demWorkerSources[ne][ce]}}return u.i(self)&&(self.worker=new or(self)),or}),i("index",["exports","./shared"],function(u,s){var h="4.1.3";let p,g;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,d)=>{const y=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),d(s.c())})}),getImageData(w,l=0){return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),d=l.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,d.drawImage(w,0,0,w.width,w.height),d},resolveURL:w=>(p||(p=document.createElement("a")),p.href=w,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let d=0;d<l.length;d++)if(l[d]in x.docStyle)return l[d];return l[0]}static create(l,d,y){const v=window.document.createElement(l);return d!==void 0&&(v.className=d),y&&y.appendChild(v),v}static createNS(l,d){return window.document.createElementNS(l,d)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,d){l.style[x.transformProp]=d}static addEventListener(l,d,y,v={}){l.addEventListener(d,y,"passive"in v?v:v.capture)}static removeEventListener(l,d,y,v={}){l.removeEventListener(d,y,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const d=l.getBoundingClientRect();return{x:d.width/l.offsetWidth||1,y:d.height/l.offsetHeight||1,boundingClientRect:d}}static getPoint(l,d,y){const v=d.boundingClientRect;return new s.P((y.clientX-v.left)/d.x-l.clientLeft,(y.clientY-v.top)/d.y-l.clientTop)}static mousePos(l,d){const y=x.getScale(l);return x.getPoint(l,y,d)}static touchPos(l,d){const y=[],v=x.getScale(l);for(let A=0;A<d.length;A++)y.push(x.getPoint(l,v,d[A]));return y}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(w){!L&&z&&(E?I(w):T=w)}};let T,z,L=!1,E=!1;function I(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,z),w.isContextLost())return;C.supported=!0}catch{}w.deleteTexture(l),L=!0}var O;typeof document<"u"&&(z=document.createElement("img"),z.onload=function(){T&&I(T),T=null,E=!0},z.onerror=function(){L=!0,T=null},z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,d,y,v;w.resetRequestQueue=()=>{l=[],d=0,y=0,v={}},w.addThrottleControl=$=>{const Z=y++;return v[Z]=$,Z},w.removeThrottleControl=$=>{delete v[$],P()},w.getImage=($,Z,Q=!0)=>new Promise((te,ge)=>{C.supported&&($.headers||($.headers={}),$.headers.accept="image/webp,*/*"),s.e($,{type:"image"}),l.push({abortController:Z,requestParameters:$,supportImageRefresh:Q,state:"queued",onError:ke=>{ge(ke)},onSuccess:ke=>{te(ke)}}),P()});const A=$=>s._(this,void 0,void 0,function*(){$.state="running";const{requestParameters:Z,supportImageRefresh:Q,onError:te,onSuccess:ge,abortController:ke}=$,Ae=Q===!1&&!s.i(self)&&!s.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((Be,et)=>Be&&et==="accept",!0));d++;const Te=Ae?D(Z,ke):s.m(Z,ke);try{const Be=yield Te;delete $.abortController,$.state="completed",Be.data instanceof HTMLImageElement||s.b(Be.data)?ge(Be):Be.data&&ge({data:yield(ve=Be.data,typeof createImageBitmap=="function"?s.d(ve):s.f(ve)),cacheControl:Be.cacheControl,expires:Be.expires})}catch(Be){delete $.abortController,te(Be)}finally{d--,P()}var ve}),P=()=>{const $=(()=>{for(const Z of Object.keys(v))if(v[Z]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=d;Z<$&&l.length>0;Z++){const Q=l.shift();Q.abortController.signal.aborted?Z--:A(Q)}},D=($,Z)=>new Promise((Q,te)=>{const ge=new Image,ke=$.url,Ae=$.credentials;Ae&&Ae==="include"?ge.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!s.s(ke))&&(ge.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{ge.src="",te(s.c())}),ge.fetchPriority="high",ge.onload=()=>{ge.onerror=ge.onload=null,Q({data:ge})},ge.onerror=()=>{ge.onerror=ge.onload=null,Z.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ge.src=ke})}(O||(O={})),O.resetRequestQueue();class B{constructor(l){this._transformRequestFn=l}transformRequest(l,d){return this._transformRequestFn&&this._transformRequestFn(l,d)||{url:l}}normalizeSpriteURL(l,d,y){const v=function(A){const P=A.match(K);if(!P)throw new Error(`Unable to parse URL "${A}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(l);return v.path+=`${d}${y}`,function(A){const P=A.params.length?`?${A.params.join("&")}`:"";return`${A.protocol}://${A.authority}${A.path}${P}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function H(w){var l=new s.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var q,J=function(w,l,d){return w[0]=l[0]-d[0],w[1]=l[1]-d[1],w[2]=l[2]-d[2],w};q=new s.A(3),s.A!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0);var fe=function(w){var l=w[0],d=w[1];return l*l+d*d};function Ee(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const d=[];for(const{id:y,url:v}of w){const A=`${y}${v}`;d.indexOf(A)===-1&&(d.push(A),l.push({id:y,url:v}))}}return l}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class ee{constructor(l,d,y,v){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(d,v)}update(l,d,y){const{width:v,height:A}=l,P=!(this.size&&this.size[0]===v&&this.size[1]===A||y),{context:D}=this,{gl:$}=D;if(this.useMipmap=!!(d&&d.useMipmap),$.bindTexture($.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===$.RGBA&&(!d||d.premultiply!==!1)),P)this.size=[v,A],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texImage2D($.TEXTURE_2D,0,this.format,this.format,$.UNSIGNED_BYTE,l):$.texImage2D($.TEXTURE_2D,0,this.format,v,A,0,this.format,$.UNSIGNED_BYTE,l.data);else{const{x:Z,y:Q}=y||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texSubImage2D($.TEXTURE_2D,0,Z,Q,$.RGBA,$.UNSIGNED_BYTE,l):$.texSubImage2D($.TEXTURE_2D,0,Z,Q,v,A,$.RGBA,$.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&$.generateMipmap($.TEXTURE_2D)}bind(l,d,y){const{context:v}=this,{gl:A}=v;A.bindTexture(A.TEXTURE_2D,this.texture),y!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=A.LINEAR),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,y||l),this.filter=l),d!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,d),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function oe(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class xe extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,promiseResolve:y}of this.requestors)y(this._getImagesForIds(d));this.requestors=[]}}getImage(l){const d=this.images[l];if(d&&!d.data&&d.spriteData){const y=d.spriteData;d.data=new s.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),d.spriteData=null}return d}addImage(l,d){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let y=!0;const v=d.data||d.spriteData;return this._validateStretch(d.stretchX,v&&v.width)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,v&&v.height)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,d){if(!l)return!0;let y=0;for(const v of l){if(v[0]<y||v[1]<v[0]||d<v[1])return!1;y=v[1]}return!0}_validateContent(l,d){if(!l)return!0;if(l.length!==4)return!1;const y=d.spriteData,v=y&&y.width||d.data.width,A=y&&y.height||d.data.height;return!(l[0]<0||v<l[0]||l[1]<0||A<l[1]||l[2]<0||v<l[2]||l[3]<0||A<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,d,y=!0){const v=this.getImage(l);if(y&&(v.data.width!==d.data.width||v.data.height!==d.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=v.version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((d,y)=>{let v=!0;if(!this.isLoaded())for(const A of l)this.images[A]||(v=!1);this.isLoaded()||v?d(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:d})})}_getImagesForIds(l){const d={};for(const y of l){let v=this.getImage(y);v||(this.fire(new s.k("styleimagemissing",{id:y})),v=this.getImage(y)),v?d[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],y=this.getImage(l);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const v={w:y.data.width+2,h:y.data.height+2,x:0,y:0},A=new s.I(v,y);this.patterns[l]={bin:v,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ee(l,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:d,h:y}=s.p(l),v=this.atlasImage;v.resize({width:d||1,height:y||1});for(const A in this.patterns){const{bin:P}=this.patterns[A],D=P.x+1,$=P.y+1,Z=this.getImage(A).data,Q=Z.width,te=Z.height;s.R.copy(Z,v,{x:0,y:0},{x:D,y:$},{width:Q,height:te}),s.R.copy(Z,v,{x:0,y:te-1},{x:D,y:$-1},{width:Q,height:1}),s.R.copy(Z,v,{x:0,y:0},{x:D,y:$+te},{width:Q,height:1}),s.R.copy(Z,v,{x:Q-1,y:0},{x:D-1,y:$},{width:1,height:te}),s.R.copy(Z,v,{x:0,y:0},{x:D+Q,y:$},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.getImage(d);y||s.w(`Image with ID: "${d}" was not found`),oe(y)&&this.updateImage(d,y)}}}const me=1e20;function tt(w,l,d,y,v,A,P,D,$){for(let Z=l;Z<l+y;Z++)Ue(w,d*A+Z,A,v,P,D,$);for(let Z=d;Z<d+v;Z++)Ue(w,Z*A+l,1,y,P,D,$)}function Ue(w,l,d,y,v,A,P){A[0]=0,P[0]=-me,P[1]=me,v[0]=w[l];for(let D=1,$=0,Z=0;D<y;D++){v[D]=w[l+D*d];const Q=D*D;do{const te=A[$];Z=(v[D]-v[te]+Q-te*te)/(D-te)/2}while(Z<=P[$]&&--$>-1);$++,A[$]=D,P[$]=Z,P[$+1]=me}for(let D=0,$=0;D<y;D++){for(;P[$+1]<D;)$++;const Z=A[$],Q=D-Z;w[l+D*d]=v[Z]+Q*Q}}class ze{constructor(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,function*(){const d=[];for(const A in l)for(const P of l[A])d.push(this._getAndCacheGlyphsPromise(A,P));const y=yield Promise.all(d),v={};for(const{stack:A,id:P,glyph:D}of y)v[A]||(v[A]={}),v[A][P]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return v})}_getAndCacheGlyphsPromise(l,d){return s._(this,void 0,void 0,function*(){let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{}});let v=y.glyphs[d];if(v!==void 0)return{stack:l,id:d,glyph:v};if(v=this._tinySDF(y,l,d),v)return y.glyphs[d]=v,{stack:l,id:d,glyph:v};const A=Math.floor(d/256);if(256*A>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[A])return{stack:l,id:d,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[A]){const D=ze.loadGlyphRange(l,A,this.url,this.requestManager);y.requests[A]=D}const P=yield y.requests[A];for(const D in P)this._doesCharSupportLocalGlyph(+D)||(y.glyphs[+D]=P[+D]);return y.ranges[A]=!0,{stack:l,id:d,glyph:P[d]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](l)||s.u["Hangul Syllables"](l)||s.u.Hiragana(l)||s.u.Katakana(l))}_tinySDF(l,d,y){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(y))return;let A=l.tinySDF;if(!A){let D="400";/bold/i.test(d)?D="900":/medium/i.test(d)?D="500":/light/i.test(d)&&(D="200"),A=l.tinySDF=new ze.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:D})}const P=A.draw(String.fromCharCode(y));return{id:y,bitmap:new s.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}ze.loadGlyphRange=function(w,l,d,y){return s._(this,void 0,void 0,function*(){const v=256*l,A=v+255,P=y.transformRequest(d.replace("{fontstack}",w).replace("{range}",`${v}-${A}`),"Glyphs"),D=yield s.l(P,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${l}, ${v}-${A}`);const $={};for(const Z of s.n(D.data))$[Z.id]=Z;return $})},ze.TinySDF=class{constructor({fontSize:w=24,buffer:l=3,radius:d=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:A="normal",fontStyle:P="normal"}={}){this.buffer=l,this.cutoff=y,this.radius=d;const D=this.size=w+4*l,$=this._createCanvas(D),Z=this.ctx=$.getContext("2d",{willReadFrequently:!0});Z.font=`${P} ${A} ${w}px ${v}`,Z.textBaseline="alphabetic",Z.textAlign="left",Z.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:d,actualBoundingBoxDescent:y,actualBoundingBoxLeft:v,actualBoundingBoxRight:A}=this.ctx.measureText(w),P=Math.ceil(d),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-v))),$=Math.min(this.size-this.buffer,P+Math.ceil(y)),Z=D+2*this.buffer,Q=$+2*this.buffer,te=Math.max(Z*Q,0),ge=new Uint8ClampedArray(te),ke={data:ge,width:Z,height:Q,glyphWidth:D,glyphHeight:$,glyphTop:P,glyphLeft:0,glyphAdvance:l};if(D===0||$===0)return ke;const{ctx:Ae,buffer:Te,gridInner:ve,gridOuter:Be}=this;Ae.clearRect(Te,Te,D,$),Ae.fillText(w,Te,Te+P);const et=Ae.getImageData(Te,Te,D,$);Be.fill(me,0,te),ve.fill(0,0,te);for(let Le=0;Le<$;Le++)for(let Ve=0;Ve<D;Ve++){const it=et.data[4*(Le*D+Ve)+3]/255;if(it===0)continue;const ot=(Le+Te)*Z+Ve+Te;if(it===1)Be[ot]=0,ve[ot]=me;else{const ft=.5-it;Be[ot]=ft>0?ft*ft:0,ve[ot]=ft<0?ft*ft:0}}tt(Be,0,0,Z,Q,Z,this.f,this.v,this.z),tt(ve,Te,Te,D,$,Z,this.f,this.v,this.z);for(let Le=0;Le<te;Le++){const Ve=Math.sqrt(Be[Le])-Math.sqrt(ve[Le]);ge[Le]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return ke}};class Ie{constructor(){this.specification=s.v.light.position}possiblyEvaluate(l,d){return s.y(l.expression.evaluate(d))}interpolate(l,d,y){return{x:s.z.number(l.x,d.x,y),y:s.z.number(l.y,d.y,y),z:s.z.number(l.z,d.z,y)}}}let ct;class Xe extends s.E{constructor(l){super(),ct=ct||new s.q({anchor:new s.D(s.v.light.anchor),position:new Ie,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ct),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(s.r,l,d))for(const y in l){const v=l[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),v):this._transitionable.setValue(y,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&s.t(this,l.call(s.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class lt{constructor(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,d){const y=l.join(",")+String(d);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(l,d)),this.dashEntry[y]}getDashRanges(l,d,y){const v=[];let A=l.length%2==1?-l[l.length-1]*y:0,P=l[0]*y,D=!0;v.push({left:A,right:P,isDash:D,zeroLength:l[0]===0});let $=l[0];for(let Z=1;Z<l.length;Z++){D=!D;const Q=l[Z];A=$*y,$+=Q,P=$*y,v.push({left:A,right:P,isDash:D,zeroLength:Q===0})}return v}addRoundDash(l,d,y){const v=d/2;for(let A=-y;A<=y;A++){const P=this.width*(this.nextRow+y+A);let D=0,$=l[D];for(let Z=0;Z<this.width;Z++){Z/$.right>1&&($=l[++D]);const Q=Math.abs(Z-$.left),te=Math.abs(Z-$.right),ge=Math.min(Q,te);let ke;const Ae=A/y*(v+1);if($.isDash){const Te=v-Math.abs(Ae);ke=Math.sqrt(ge*ge+Te*Te)}else ke=v-Math.sqrt(ge*ge+Ae*Ae);this.data[P+Z]=Math.max(0,Math.min(255,ke+128))}}}addRegularDash(l){for(let D=l.length-1;D>=0;--D){const $=l[D],Z=l[D+1];$.zeroLength?l.splice(D,1):Z&&Z.isDash===$.isDash&&(Z.left=$.left,l.splice(D,1))}const d=l[0],y=l[l.length-1];d.isDash===y.isDash&&(d.left=y.left-this.width,y.right=d.right+this.width);const v=this.width*this.nextRow;let A=0,P=l[A];for(let D=0;D<this.width;D++){D/P.right>1&&(P=l[++A]);const $=Math.abs(D-P.left),Z=Math.abs(D-P.right),Q=Math.min($,Z);this.data[v+D]=Math.max(0,Math.min(255,(P.isDash?Q:-Q)+128))}}addDash(l,d){const y=d?7:0,v=2*y+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let A=0;for(let D=0;D<l.length;D++)A+=l[D];if(A!==0){const D=this.width/A,$=this.getDashRanges(l,this.width,D);d?this.addRoundDash($,D,y):this.addRegularDash($)}const P={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:A};return this.nextRow+=v,this.dirty=!0,P}bind(l){const d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const pt="maplibre_preloaded_worker_pool";class _t{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<_t.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pt]}numActive(){return Object.keys(this.active).length}}const He=Math.floor(_.hardwareConcurrency/2);let gt,Pt;function jt(){return gt||(gt=new _t),gt}_t.workerCount=s.B(globalThis)?Math.max(Math.min(He,3),1):1;class un{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=d;const y=this.workerPool.acquire(d);for(let v=0;v<y.length;v++){const A=new s.C(y[v],d);A.name=`Worker ${v}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,d){const y=[];for(const v of this.actors)y.push(v.sendAsync({type:l,data:d}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,d){for(const y of this.actors)y.registerMessageHandler(l,d)}}function nn(){return Pt||(Pt=new un(jt(),s.G),Pt.registerMessageHandler("GR",(w,l,d)=>s.m(l,d))),Pt}function rn(w,l){const d=s.F();return s.H(d,d,[1,1,0]),s.J(d,d,[.5*w.width,.5*w.height,1]),s.K(d,d,w.calculatePosMatrix(l.toUnwrapped()))}function pn(w,l,d,y,v,A){const P=function(te,ge,ke){if(te)for(const Ae of te){const Te=ge[Ae];if(Te&&Te.source===ke&&Te.type==="fill-extrusion")return!0}else for(const Ae in ge){const Te=ge[Ae];if(Te.source===ke&&Te.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,w.id),D=A.maxPitchScaleFactor(),$=w.tilesIn(y,D,P);$.sort(yn);const Z=[];for(const te of $)Z.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,d,w._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,v,A,D,rn(w.transform,te.tileID))});const Q=function(te){const ge={},ke={};for(const Ae of te){const Te=Ae.queryResults,ve=Ae.wrappedTileID,Be=ke[ve]=ke[ve]||{};for(const et in Te){const Le=Te[et],Ve=Be[et]=Be[et]||{},it=ge[et]=ge[et]||[];for(const ot of Le)Ve[ot.featureIndex]||(Ve[ot.featureIndex]=!0,it.push(ot))}}return ge}(Z);for(const te in Q)Q[te].forEach(ge=>{const ke=ge.feature,Ae=w.getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Ae});return Q}function yn(w,l){const d=w.tileID,y=l.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function qe(w,l,d){return s._(this,void 0,void 0,function*(){let y=w;if(w.url?y=(yield s.h(l.transformRequest(w.url,"Source"),d)).data:yield _.frameAsync(d),!y)return null;const v=s.L(s.e(y,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(A=>A.id)),v})}class Ge{constructor(l,d){l&&(d?this.setSouthWest(l).setNorthEast(d):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}extend(l){const d=this._sw,y=this._ne;let v,A;if(l instanceof s.M)v=l,A=l;else{if(!(l instanceof Ge))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ge.convert(l)):this.extend(s.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.M.convert(l)):this;if(v=l._sw,A=l._ne,!v||!A)return this}return d||y?(d.lng=Math.min(v.lng,d.lng),d.lat=Math.min(v.lat,d.lat),y.lng=Math.max(A.lng,y.lng),y.lat=Math.max(A.lat,y.lat)):(this._sw=new s.M(v.lng,v.lat),this._ne=new s.M(A.lng,A.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:d,lat:y}=s.M.convert(l);let v=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&v}static convert(l){return l instanceof Ge?l:l&&new Ge(l)}static fromLngLat(l,d=0){const y=360*d/40075017,v=y/Math.cos(Math.PI/180*l.lat);return new Ge(new s.M(l.lng-v,l.lat-y),new s.M(l.lng+v,l.lat+y))}}class At{constructor(l,d,y){this.bounds=Ge.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),y=Math.floor(s.N(this.bounds.getWest())*d),v=Math.floor(s.O(this.bounds.getNorth())*d),A=Math.ceil(s.N(this.bounds.getEast())*d),P=Math.ceil(s.O(this.bounds.getSouth())*d);return l.x>=y&&l.x<A&&l.y>=v&&l.y<P}}class nt extends s.E{constructor(l,d,y,v){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(d,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new At(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(d,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((A,P)=>{l.reloadPromise={resolve:A,reject:P}})}else l.actor=this.dispatcher.getActor(),v="LT";l.abortController=new AbortController;try{const A=yield l.actor.sendAsync({type:v,data:y},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,A)}catch(A){if(delete l.abortController,l.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,d){if(d&&d.resourceTiming&&(l.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&l.setExpiryData(d),l.loadVectorData(d,this.map.painter),l.reloadPromise){const y=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(y.resolve).catch(y.reject)}}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class de extends s.E{constructor(l,d,y,v){super(),this.id=l,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.L(d,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new At(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const y=yield O.getImage(this.map._requestManager.transformRequest(d,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const v=this.map.painter.context,A=v.gl,P=y.data;l.texture=this.map.painter.getTileTexture(P.width),l.texture?l.texture.update(P,{useMipmap:!0}):(l.texture=new ee(v,P,A.RGBA,{useMipmap:!0}),l.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class cn extends de{constructor(l,d,y,v){super(l,d,y,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(l){return s._(this,void 0,void 0,function*(){const d=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(d,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const v=yield O.getImage(y,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){const A=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const P=s.b(A)&&s.S()?A:yield this.readImageNow(A),D={type:this.type,uid:l.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const $=yield l.actor.sendAsync({type:"LDT",data:D});l.dem=$,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}})}readImageNow(l){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const d=l.width+2,y=l.height+2;try{return new s.R({width:d,height:y},yield s.V(l,-1,-1,d,y))}catch{}}return _.getImageData(l,1)})}_getNeighboringTiles(l){const d=l.canonical,y=Math.pow(2,d.z),v=(d.x-1+y)%y,A=d.x===0?l.wrap-1:l.wrap,P=(d.x+1+y)%y,D=d.x+1===y?l.wrap+1:l.wrap,$={};return $[new s.Q(l.overscaledZ,A,d.z,v,d.y).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,d.z,P,d.y).key]={backfilled:!1},d.y>0&&($[new s.Q(l.overscaledZ,A,d.z,v,d.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,d.z,P,d.y-1).key]={backfilled:!1}),d.y+1<y&&($[new s.Q(l.overscaledZ,A,d.z,v,d.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,d.z,P,d.y+1).key]={backfilled:!1}),$}unloadTile(l){return s._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Ke extends s.E{constructor(l,d,y,v){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=d.data,this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const A=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*A,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*A,extent:s.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.W,radius:(d.clusterRadius||50)*A,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,d,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:d,offset:y}})}_updateWorkerData(l){return s._(this,void 0,void 0,function*(){const d=s.e({type:this.type},this.workerOptions);l?d.dataDiff=l:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:d});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let v=null;y.resourceTiming&&y.resourceTiming[this.id]&&(v=y.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(A,{resourceTiming:v}),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(l){return s._(this,void 0,void 0,function*(){const d=l.actor?"RT":"LT";l.actor=this.actor;const y={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const v=yield this.actor.sendAsync({type:d,data:y},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(v,this.map.painter,d==="RT")})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ut=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gt extends s.E{constructor(l,d,y,v){super(),this.id=l,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=d}load(l){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield O.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,l&&(this.coordinates=l),this._finishLoading())}catch(d){this._request=null,this._loaded=!0,this.fire(new s.j(d))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const d=l.map(s.Y.fromLngLat);this.tileID=function(v){let A=1/0,P=1/0,D=-1/0,$=-1/0;for(const ge of v)A=Math.min(A,ge.x),P=Math.min(P,ge.y),D=Math.max(D,ge.x),$=Math.max($,ge.y);const Z=Math.max(D-A,$-P),Q=Math.max(0,Math.floor(-Math.log(Z)/Math.LN2)),te=Math.pow(2,Q);return new s.a0(Q,Math.floor((A+D)/2*te),Math.floor((P+$)/2*te))}(d),this.minzoom=this.maxzoom=this.tileID.z;const y=d.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,s.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,s.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,d=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ee(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Jn extends Gt{constructor(l,d,y,v){super(l,d,y,v),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const d of l.urls)this.urls.push(this.map._requestManager.transformRequest(d,"Source").url);try{const d=yield s.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const d=this.video.seekable;l<d.start(0)||l>d.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,d=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new ee(l,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Zn extends Gt{constructor(l,d,y,v){super(l,d,y,v),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(P=>typeof P!="number"))||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,y=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,ut.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ee(d,this.canvas,y.RGBA,{premultiply:!0});let v=!1;for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,v=!0)}v&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const fr={},Cr=w=>{switch(w){case"geojson":return Ke;case"image":return Gt;case"raster":return de;case"raster-dem":return cn;case"vector":return nt;case"video":return Jn;case"canvas":return Zn}return fr[w]},Tr="RTLPluginLoaded";class xi extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nn()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,function*(d,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(Tr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Un=null;function xt(){return Un||(Un=new xi),Un}class zr{constructor(l,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=s.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const d=l+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,d,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,A){const P={};if(!A)return P;for(const D of v){const $=D.layerIds.map(Z=>A.getLayer(Z)).filter(Boolean);if($.length!==0){D.layers=$,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(Z=>$.filter(Q=>Q.id===Z)[0]));for(const Z of $)P[Z.id]=D}}return P}(l.buckets,d.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5){if(this.hasSymbolBuckets=!0,!y)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5&&A.hasRTLText){this.hasRTLText=!0,xt().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const A=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(v).queryRadius(A))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(l)}const d=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ee(l,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ee(l,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,d,y,v,A,P,D,$,Z,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:A,scale:P,tileSize:this.tileSize,pixelPosMatrix:Q,transform:$,params:D,queryPadding:this.queryPadding*Z},l,d,y):{}}querySourceFeatures(l,d){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const v=y.loadVTLayers(),A=d&&d.sourceLayer?d.sourceLayer:"",P=v._geojsonTileLayer||v[A];if(!P)return;const D=s.a6(d&&d.filter),{z:$,x:Z,y:Q}=this.tileID.canonical,te={z:$,x:Z,y:Q};for(let ge=0;ge<P.length;ge++){const ke=P.feature(ge);if(D.needGeometry){const ve=s.a7(ke,!0);if(!D.filter(new s.a8(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!D.filter(new s.a8(this.tileID.overscaledZ),ke))continue;const Ae=y.getId(ke,A),Te=new s.a9(ke,$,Z,Q,Ae);Te.tile=te,l.push(Te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const d=this.expirationTime;if(l.cacheControl){const y=s.aa(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let v=!1;if(this.expirationTime>y)v=!1;else if(d)if(this.expirationTime<d)v=!0;else{const A=this.expirationTime-d;A?this.expirationTime=y+Math.max(A,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!d.style.hasLayer(v))continue;const A=this.buckets[v],P=A.layers[0].sourceLayer||"_geojsonTileLayer",D=y[P],$=l[P];if(!D||!$||Object.keys($).length===0)continue;A.update($,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Z=d&&d.style&&d.style.getLayer(v);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=_.now()+l}setDependencies(l,d){const y={};for(const v of d)y[v]=!0;this.dependencies[l]=y}hasDependency(l,d){for(const y of l){const v=this.dependencies[y];if(v){for(const A of d)if(v[A])return!0}}return!1}}class br{constructor(l,d){this.max=l,this.onRemove=d,this.reset()}reset(){for(const l in this.data)for(const d of this.data[l])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(l,d,y){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const A={value:d,timeout:void 0};if(y!==void 0&&(A.timeout=setTimeout(()=>{this.remove(l,A)},y)),this.data[v].push(A),this.order.push(v),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value}getByKey(l){const d=this.data[l];return d?d[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,d){if(!this.has(l))return this;const y=l.wrapped().key,v=d===void 0?0:this.data[y].indexOf(d),A=this.data[y][v];return this.data[y].splice(v,1),A.timeout&&clearTimeout(A.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(A.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(l){const d=[];for(const y in this.data)for(const v of this.data[y])l(v.value)||d.push(v);for(const y of d)this.remove(y.value.tileID,y)}}class Fi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,d,y){const v=String(d);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},s.e(this.stateChanges[l][v],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const A in this.state[l])A!==v&&(this.deletedStates[l][A]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const A in this.state[l][v])y[A]||(this.deletedStates[l][v][A]=null)}else for(const A in y)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][A]===null&&delete this.deletedStates[l][v][A]}removeFeatureState(l,d,y){if(this.deletedStates[l]===null)return;const v=String(d);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&d!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][y]=null);else if(d!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(y in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][y]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,d){const y=String(d),v=s.e({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const A=this.deletedStates[l][d];if(A===null)return{};for(const P in A)delete v[P]}return v}initializeTileState(l,d){l.setFeatureState(this.state,d)}coalesceChanges(l,d){const y={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const A={};for(const P in this.stateChanges[v])this.state[v][P]||(this.state[v][P]={}),s.e(this.state[v][P],this.stateChanges[v][P]),A[P]=this.state[v][P];y[v]=A}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const A={};if(this.deletedStates[v]===null)for(const P in this.state[v])A[P]={},this.state[v][P]={};else for(const P in this.deletedStates[v]){if(this.deletedStates[v][P]===null)this.state[v][P]={};else for(const D of Object.keys(this.deletedStates[v][P]))delete this.state[v][P][D];A[P]=this.state[v][P]}y[v]=y[v]||{},s.e(y[v],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const v in l)l[v].setFeatureState(y,d)}}class $n extends s.E{constructor(l,d,y){super(),this.id=l,this.dispatcher=y,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,A,P,D)=>{const $=new(Cr(A.type))(v,A,P,D);if($.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${$.id}`);return $})(l,d,y,this),this._tiles={},this._cache=new br(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Fi,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const d=this._tiles[l];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,d,y){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,d,y)}catch(v){l.state="errored",v.status!==404?this._source.fire(new s.j(v,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const y=this._tiles[d];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Fe).map(l=>l.key)}getRenderableIds(l){const d=[];for(const y in this._tiles)this._isIdRenderable(y,l)&&d.push(this._tiles[y]);return l?d.sort((y,v)=>{const A=y.tileID,P=v.tileID,D=new s.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),$=new s.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-P.overscaledZ||$.y-D.y||$.x-D.x}).map(y=>y.tileID.key):d.map(y=>y.tileID).sort(Fe).map(y=>y.key)}hasRenderableParent(l){const d=this.findLoadedParent(l,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(l,d){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(d||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,d){return s._(this,void 0,void 0,function*(){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=d),yield this._loadTile(y,l,d))})}_tileLoaded(l,d,y){l.timeAdded=_.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(d,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const d=this.getRenderableIds();for(let v=0;v<d.length;v++){const A=d[v];if(l.neighboringTiles&&l.neighboringTiles[A]){const P=this.getTileByID(A);y(l,P),y(P,l)}}function y(v,A){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let P=A.tileID.canonical.x-v.tileID.canonical.x;const D=A.tileID.canonical.y-v.tileID.canonical.y,$=Math.pow(2,v.tileID.canonical.z),Z=A.tileID.key;P===0&&D===0||Math.abs(D)>1||(Math.abs(P)>1&&(Math.abs(P+$)===1?P+=$:Math.abs(P-$)===1&&(P-=$)),A.dem&&v.dem&&(v.dem.backfillBorder(A.dem,P,D),v.neighboringTiles&&v.neighboringTiles[Z]&&(v.neighboringTiles[Z].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,d,y,v){for(const A in this._tiles){let P=this._tiles[A];if(v[A]||!P.hasData()||P.tileID.overscaledZ<=d||P.tileID.overscaledZ>y)continue;let D=P.tileID;for(;P&&P.tileID.overscaledZ>d+1;){const Z=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[Z.key],P&&P.hasData()&&(D=Z)}let $=D;for(;$.overscaledZ>d;)if($=$.scaledTo($.overscaledZ-1),l[$.key]){v[D.key]=D;break}}}findLoadedParent(l,d){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=d?y:null}for(let y=l.overscaledZ-1;y>=d;y--){const v=l.scaledTo(y),A=this._getLoadedTile(v);if(A)return A}}_getLoadedTile(l){const d=this._tiles[l.key];return d&&d.hasData()?d:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const d=Math.ceil(l.width/this._source.tileSize)+1,y=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(d*y*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(A)}handleWrapJump(l){const d=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,d){const y={};for(const v in this._tiles){const A=this._tiles[v];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),y[A.tileID.key]=A}this._tiles=y;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,d){if(!this._sourceLoaded||this._paused)return;let y;this.transform=l,this.terrain=d,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(Q=>new s.Q(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y)):(y=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(y=y.filter(Q=>this._source.hasTile(Q)))):y=[];const v=l.coveringZoomLevel(this._source),A=Math.max(v-$n.maxOverzooming,this._source.minzoom),P=Math.max(v+$n.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Q={};for(const te of y)if(te.canonical.z>this._source.minzoom){const ge=te.scaledTo(te.canonical.z-1);Q[ge.key]=ge;const ke=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));Q[ke.key]=ke}y=y.concat(Object.values(Q))}const D=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const $=this._updateRetainedTiles(y,v);if(yt(this._source.type)){const Q={},te={},ge=Object.keys($),ke=_.now();for(const Ae of ge){const Te=$[Ae],ve=this._tiles[Ae];if(!ve||ve.fadeEndTime!==0&&ve.fadeEndTime<=ke)continue;const Be=this.findLoadedParent(Te,A);Be&&(this._addTile(Be.tileID),Q[Be.tileID.key]=Be.tileID),te[Ae]=Te}this._retainLoadedChildren(te,v,P,$);for(const Ae in Q)$[Ae]||(this._coveredTiles[Ae]=!0,$[Ae]=Q[Ae]);if(d){const Ae={},Te={};for(const ve of y)this._tiles[ve.key].hasData()?Ae[ve.key]=ve:Te[ve.key]=ve;for(const ve in Te){const Be=Te[ve].children(this._source.maxzoom);this._tiles[Be[0].key]&&this._tiles[Be[1].key]&&this._tiles[Be[2].key]&&this._tiles[Be[3].key]&&(Ae[Be[0].key]=$[Be[0].key]=Be[0],Ae[Be[1].key]=$[Be[1].key]=Be[1],Ae[Be[2].key]=$[Be[2].key]=Be[2],Ae[Be[3].key]=$[Be[3].key]=Be[3],delete Te[ve])}for(const ve in Te){const Be=this.findLoadedParent(Te[ve],this._source.minzoom);if(Be){Ae[Be.tileID.key]=$[Be.tileID.key]=Be.tileID;for(const et in Ae)Ae[et].isChildOf(Be.tileID)&&delete Ae[et]}}for(const ve in this._tiles)Ae[ve]||(this._coveredTiles[ve]=!0)}}for(const Q in $)this._tiles[Q].clearFadeHold();const Z=s.ab(this._tiles,$);for(const Q of Z){const te=this._tiles[Q];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(Q)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,d){const y={},v={},A=Math.max(d-$n.maxOverzooming,this._source.minzoom),P=Math.max(d+$n.maxUnderzooming,this._source.minzoom),D={};for(const $ of l){const Z=this._addTile($);y[$.key]=$,Z.hasData()||d<this._source.maxzoom&&(D[$.key]=$)}this._retainLoadedChildren(D,d,P,y);for(const $ of l){let Z=this._tiles[$.key];if(Z.hasData())continue;if(d+1>this._source.maxzoom){const te=$.children(this._source.maxzoom)[0],ge=this.getTile(te);if(ge&&ge.hasData()){y[te.key]=te;continue}}else{const te=$.children(this._source.maxzoom);if(y[te[0].key]&&y[te[1].key]&&y[te[2].key]&&y[te[3].key])continue}let Q=Z.wasRequested();for(let te=$.overscaledZ-1;te>=A;--te){const ge=$.scaledTo(te);if(v[ge.key])break;if(v[ge.key]=!0,Z=this.getTile(ge),!Z&&Q&&(Z=this._addTile(ge)),Z){const ke=Z.hasData();if((Q||ke)&&(y[ge.key]=ge),Q=Z.wasRequested(),ke)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const d=[];let y,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){y=this._loadedParentTiles[v.key];break}d.push(v.key);const A=v.scaledTo(v.overscaledZ-1);if(y=this._getLoadedTile(A),y)break;v=A}for(const A of d)this._loadedParentTiles[A]=y}}_addTile(l){let d=this._tiles[l.key];if(d)return d;d=this._cache.getAndRemove(l),d&&(this._setTileReloadTimer(l.key,d),d.tileID=l,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,d)));const y=d;return d||(d=new zr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(d,l.key,d.state)),d.uses++,this._tiles[l.key]=d,y||this._source.fire(new s.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(l,d){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=d.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const d=this._tiles[l];d&&(d.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}_dataHandler(l){const d=l.sourceDataType;l.dataType==="source"&&d==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&d==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,d,y){const v=[],A=this.transform;if(!A)return v;const P=y?A.getCameraQueryGeometry(l):l,D=l.map(Ae=>A.pointCoordinate(Ae,this.terrain)),$=P.map(Ae=>A.pointCoordinate(Ae,this.terrain)),Z=this.getIds();let Q=1/0,te=1/0,ge=-1/0,ke=-1/0;for(const Ae of $)Q=Math.min(Q,Ae.x),te=Math.min(te,Ae.y),ge=Math.max(ge,Ae.x),ke=Math.max(ke,Ae.y);for(let Ae=0;Ae<Z.length;Ae++){const Te=this._tiles[Z[Ae]];if(Te.holdingForFade())continue;const ve=Te.tileID,Be=Math.pow(2,A.zoom-Te.tileID.overscaledZ),et=d*Te.queryPadding*s.W/Te.tileSize/Be,Le=[ve.getTilePoint(new s.Y(Q,te)),ve.getTilePoint(new s.Y(ge,ke))];if(Le[0].x-et<s.W&&Le[0].y-et<s.W&&Le[1].x+et>=0&&Le[1].y+et>=0){const Ve=D.map(ot=>ve.getTilePoint(ot)),it=$.map(ot=>ve.getTilePoint(ot));v.push({tile:Te,tileID:ve,queryGeometry:Ve,cameraQueryGeometry:it,scale:Be})}}return v}getVisibleCoordinates(l){const d=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of d)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(yt(this._source.type)){const l=_.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=l)return!0}return!1}setFeatureState(l,d,y){this._state.updateState(l=l||"_geojsonTileLayer",d,y)}removeFeatureState(l,d,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",d,y)}getFeatureState(l,d){return this._state.getState(l=l||"_geojsonTileLayer",d)}setDependencies(l,d,y){const v=this._tiles[l];v&&v.setDependencies(d,y)}reloadTilesForDependencies(l,d){for(const y in this._tiles)this._tiles[y].hasDependency(l,d)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(l,d))}}function Fe(w,l){const d=Math.abs(2*w.wrap)-+(w.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||y-d||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function yt(w){return w==="raster"||w==="image"||w==="video"}$n.maxOverzooming=10,$n.maxUnderzooming=3;class bt{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ac(l,0,1);let d=1,y=this._distances[d];const v=l*this.paddedLength+this.padding;for(;y<v&&d<this._distances.length;)y=this._distances[++d];const A=d-1,P=this._distances[A],D=y-P,$=D>0?(v-P)/D:0;return this.points[A].mult(1-$).add(this.points[d].mult($))}}function Rt(w,l){let d=!0;return w==="always"||w!=="never"&&l!=="never"||(d=!1),d}class Qt{constructor(l,d,y){const v=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(d/y);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,y,v,A){this._forEachCell(d,y,v,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(A)}insertCircle(l,d,y,v){this._forEachCell(d-v,y-v,d+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(y),this.circles.push(v)}_insertBoxCell(l,d,y,v,A,P){this.boxCells[A].push(P)}_insertCircleCell(l,d,y,v,A,P){this.circleCells[A].push(P)}_query(l,d,y,v,A,P,D){if(y<0||l>this.width||v<0||d>this.height)return[];const $=[];if(l<=0&&d<=0&&this.width<=y&&this.height<=v){if(A)return[{key:null,x1:l,y1:d,x2:y,y2:v}];for(let Z=0;Z<this.boxKeys.length;Z++)$.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const Q=this.circles[3*Z],te=this.circles[3*Z+1],ge=this.circles[3*Z+2];$.push({key:this.circleKeys[Z],x1:Q-ge,y1:te-ge,x2:Q+ge,y2:te+ge})}}else this._forEachCell(l,d,y,v,this._queryCell,$,{hitTest:A,overlapMode:P,seenUids:{box:{},circle:{}}},D);return $}query(l,d,y,v){return this._query(l,d,y,v,!1,null)}hitTest(l,d,y,v,A,P){return this._query(l,d,y,v,!0,A,P).length>0}hitTestCircle(l,d,y,v,A){const P=l-y,D=l+y,$=d-y,Z=d+y;if(D<0||P>this.width||Z<0||$>this.height)return!1;const Q=[];return this._forEachCell(P,$,D,Z,this._queryCellCircle,Q,{hitTest:!0,overlapMode:v,circle:{x:l,y:d,radius:y},seenUids:{box:{},circle:{}}},A),Q.length>0}_queryCell(l,d,y,v,A,P,D,$){const{seenUids:Z,hitTest:Q,overlapMode:te}=D,ge=this.boxCells[A];if(ge!==null){const Ae=this.bboxes;for(const Te of ge)if(!Z.box[Te]){Z.box[Te]=!0;const ve=4*Te,Be=this.boxKeys[Te];if(l<=Ae[ve+2]&&d<=Ae[ve+3]&&y>=Ae[ve+0]&&v>=Ae[ve+1]&&(!$||$(Be))&&(!Q||!Rt(te,Be.overlapMode))&&(P.push({key:Be,x1:Ae[ve],y1:Ae[ve+1],x2:Ae[ve+2],y2:Ae[ve+3]}),Q))return!0}}const ke=this.circleCells[A];if(ke!==null){const Ae=this.circles;for(const Te of ke)if(!Z.circle[Te]){Z.circle[Te]=!0;const ve=3*Te,Be=this.circleKeys[Te];if(this._circleAndRectCollide(Ae[ve],Ae[ve+1],Ae[ve+2],l,d,y,v)&&(!$||$(Be))&&(!Q||!Rt(te,Be.overlapMode))){const et=Ae[ve],Le=Ae[ve+1],Ve=Ae[ve+2];if(P.push({key:Be,x1:et-Ve,y1:Le-Ve,x2:et+Ve,y2:Le+Ve}),Q)return!0}}}return!1}_queryCellCircle(l,d,y,v,A,P,D,$){const{circle:Z,seenUids:Q,overlapMode:te}=D,ge=this.boxCells[A];if(ge!==null){const Ae=this.bboxes;for(const Te of ge)if(!Q.box[Te]){Q.box[Te]=!0;const ve=4*Te,Be=this.boxKeys[Te];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,Ae[ve+0],Ae[ve+1],Ae[ve+2],Ae[ve+3])&&(!$||$(Be))&&!Rt(te,Be.overlapMode))return P.push(!0),!0}}const ke=this.circleCells[A];if(ke!==null){const Ae=this.circles;for(const Te of ke)if(!Q.circle[Te]){Q.circle[Te]=!0;const ve=3*Te,Be=this.circleKeys[Te];if(this._circlesCollide(Ae[ve],Ae[ve+1],Ae[ve+2],Z.x,Z.y,Z.radius)&&(!$||$(Be))&&!Rt(te,Be.overlapMode))return P.push(!0),!0}}}_forEachCell(l,d,y,v,A,P,D,$){const Z=this._convertToXCellCoord(l),Q=this._convertToYCellCoord(d),te=this._convertToXCellCoord(y),ge=this._convertToYCellCoord(v);for(let ke=Z;ke<=te;ke++)for(let Ae=Q;Ae<=ge;Ae++)if(A.call(this,l,d,y,v,this.xCellCount*Ae+ke,P,D,$))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,y,v,A,P){const D=v-l,$=A-d,Z=y+P;return Z*Z>D*D+$*$}_circleAndRectCollide(l,d,y,v,A,P,D){const $=(P-v)/2,Z=Math.abs(l-(v+$));if(Z>$+y)return!1;const Q=(D-A)/2,te=Math.abs(d-(A+Q));if(te>Q+y)return!1;if(Z<=$||te<=Q)return!0;const ge=Z-$,ke=te-Q;return ge*ge+ke*ke<=y*y}}function Yt(w,l,d,y,v){const A=s.F();return l?(s.J(A,A,[1/v,1/v,1]),d||s.ad(A,A,y.angle)):s.K(A,y.labelPlaneMatrix,w),A}function vr(w,l,d,y,v){if(l){const A=s.ae(w);return s.J(A,A,[v,v,1]),d||s.ad(A,A,-y.angle),A}return y.glCoordMatrix}function or(w,l,d){let y;d?(y=[w.x,w.y,d(w.x,w.y),1],s.af(y,y,l)):(y=[w.x,w.y,0,1],ht(y,y,l));const v=y[3];return{point:new s.P(y[0]/v,y[1]/v),signedDistanceFromCamera:v}}function Se(w,l){return .5+w/l*.5}function ne(w,l){const d=w[0]/w[3],y=w[1]/w[3];return d>=-l[0]&&d<=l[0]&&y>=-l[1]&&y<=l[1]}function ce(w,l,d,y,v,A,P,D,$,Z){const Q=y?w.textSizeData:w.iconSizeData,te=s.ag(Q,d.transform.zoom),ge=[256/d.width*2+1,256/d.height*2+1],ke=y?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;ke.clear();const Ae=w.lineVertexArray,Te=y?w.text.placedSymbolArray:w.icon.placedSymbolArray,ve=d.transform.width/d.transform.height;let Be=!1;for(let et=0;et<Te.length;et++){const Le=Te.get(et);if(Le.hidden||Le.writingMode===s.ah.vertical&&!Be){rt(Le.numGlyphs,ke);continue}let Ve;if(Be=!1,Z?(Ve=[Le.anchorX,Le.anchorY,Z(Le.anchorX,Le.anchorY),1],s.af(Ve,Ve,l)):(Ve=[Le.anchorX,Le.anchorY,0,1],ht(Ve,Ve,l)),!ne(Ve,ge)){rt(Le.numGlyphs,ke);continue}const it=Se(d.transform.cameraToCenterDistance,Ve[3]),ot=s.ai(Q,te,Le),ft=P?ot/it:ot*it,Ct=new s.P(Le.anchorX,Le.anchorY),wt=or(Ct,v,Z).point,Bt={projections:{},offsets:{}},Ot=Oe(Le,ft,!1,D,l,v,A,w.glyphOffsetArray,Ae,ke,wt,Ct,Bt,ve,$,Z);Be=Ot.useVertical,(Ot.notEnoughRoom||Be||Ot.needsFlipping&&Oe(Le,ft,!0,D,l,v,A,w.glyphOffsetArray,Ae,ke,wt,Ct,Bt,ve,$,Z).notEnoughRoom)&&rt(Le.numGlyphs,ke)}y?w.text.dynamicLayoutVertexBuffer.updateData(ke):w.icon.dynamicLayoutVertexBuffer.updateData(ke)}function _e(w,l,d,y,v,A,P,D,$,Z,Q,te,ge){const ke=D.glyphStartIndex+D.numGlyphs,Ae=D.lineStartIndex,Te=D.lineStartIndex+D.lineLength,ve=l.getoffsetX(D.glyphStartIndex),Be=l.getoffsetX(ke-1),et=Je(w*ve,d,y,v,A,P,D.segment,Ae,Te,$,Z,Q,te,ge);if(!et)return null;const Le=Je(w*Be,d,y,v,A,P,D.segment,Ae,Te,$,Z,Q,te,ge);return Le?{first:et,last:Le}:null}function we(w,l,d,y){return w===s.ah.horizontal&&Math.abs(d.y-l.y)>Math.abs(d.x-l.x)*y?{useVertical:!0}:(w===s.ah.vertical?l.y<d.y:l.x>d.x)?{needsFlipping:!0}:null}function Oe(w,l,d,y,v,A,P,D,$,Z,Q,te,ge,ke,Ae,Te){const ve=l/24,Be=w.lineOffsetX*ve,et=w.lineOffsetY*ve;let Le;if(w.numGlyphs>1){const Ve=w.glyphStartIndex+w.numGlyphs,it=w.lineStartIndex,ot=w.lineStartIndex+w.lineLength,ft=_e(ve,D,Be,et,d,Q,te,w,$,A,ge,Ae,Te);if(!ft)return{notEnoughRoom:!0};const Ct=or(ft.first.point,P,Te).point,wt=or(ft.last.point,P,Te).point;if(y&&!d){const Bt=we(w.writingMode,Ct,wt,ke);if(Bt)return Bt}Le=[ft.first];for(let Bt=w.glyphStartIndex+1;Bt<Ve-1;Bt++)Le.push(Je(ve*D.getoffsetX(Bt),Be,et,d,Q,te,w.segment,it,ot,$,A,ge,Ae,Te));Le.push(ft.last)}else{if(y&&!d){const it=or(te,v,Te).point,ot=w.lineStartIndex+w.segment+1,ft=new s.P($.getx(ot),$.gety(ot)),Ct=or(ft,v,Te),wt=Ct.signedDistanceFromCamera>0?Ct.point:$e(te,ft,it,1,v,Te),Bt=we(w.writingMode,it,wt,ke);if(Bt)return Bt}const Ve=Je(ve*D.getoffsetX(w.glyphStartIndex),Be,et,d,Q,te,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,$,A,ge,Ae,Te);if(!Ve)return{notEnoughRoom:!0};Le=[Ve]}for(const Ve of Le)s.aj(Z,Ve.point,Ve.angle);return{}}function $e(w,l,d,y,v,A){const P=or(w.add(w.sub(l)._unit()),v,A).point,D=d.sub(P);return d.add(D._mult(y/D.mag()))}function je(w,l){const{projectionCache:d,lineVertexArray:y,labelPlaneMatrix:v,tileAnchorPoint:A,distanceFromAnchor:P,getElevation:D,previousVertex:$,direction:Z,absOffsetX:Q}=l;if(d.projections[w])return d.projections[w];const te=new s.P(y.getx(w),y.gety(w)),ge=or(te,v,D);if(ge.signedDistanceFromCamera>0)return d.projections[w]=ge.point,ge.point;const ke=w-Z;return $e(P===0?A:new s.P(y.getx(ke),y.gety(ke)),te,$,Q-P+1,v,D)}function De(w,l,d){return w._unit()._perp()._mult(l*d)}function re(w,l,d,y,v,A,P,D){const{projectionCache:$,direction:Z}=D;if($.offsets[w])return $.offsets[w];const Q=d.add(l);if(w+Z<y||w+Z>=v)return $.offsets[w]=Q,Q;const te=je(w+Z,D),ge=De(te.sub(d),P,Z),ke=d.add(ge),Ae=te.add(ge);return $.offsets[w]=s.ak(A,Q,ke,Ae)||Q,$.offsets[w]}function Je(w,l,d,y,v,A,P,D,$,Z,Q,te,ge,ke){const Ae=y?w-l:w+l;let Te=Ae>0?1:-1,ve=0;y&&(Te*=-1,ve=Math.PI),Te<0&&(ve+=Math.PI);let Be,et,Le=Te>0?D+P:D+P+1,Ve=v,it=v,ot=0,ft=0;const Ct=Math.abs(Ae),wt=[];let Bt;for(;ot+ft<=Ct;){if(Le+=Te,Le<D||Le>=$)return null;ot+=ft,it=Ve,et=Be;const $t={projectionCache:te,lineVertexArray:Z,labelPlaneMatrix:Q,tileAnchorPoint:A,distanceFromAnchor:ot,getElevation:ke,previousVertex:it,direction:Te,absOffsetX:Ct};if(Ve=je(Le,$t),d===0)wt.push(it),Bt=Ve.sub(it);else{let gn;const Sn=Ve.sub(it);gn=Sn.mag()===0?De(je(Le+Te,$t).sub(Ve),d,Te):De(Sn,d,Te),et||(et=it.add(gn)),Be=re(Le,gn,Ve,D,$,et,d,$t),wt.push(et),Bt=Be.sub(et)}ft=Bt.mag()}const Ot=Bt._mult((Ct-ot)/ft)._add(et||it),kn=ve+Math.atan2(Ve.y-it.y,Ve.x-it.x);return wt.push(Ot),{point:Ot,angle:ge?kn:0,path:wt}}const Qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function rt(w,l){for(let d=0;d<w;d++){const y=l.length;l.resize(y+4),l.float32.set(Qe,3*y)}}function ht(w,l,d){const y=l[0],v=l[1];return w[0]=d[0]*y+d[4]*v+d[12],w[1]=d[1]*y+d[5]*v+d[13],w[3]=d[3]*y+d[7]*v+d[15],w}const Dt=100;class en{constructor(l,d=new Qt(l.width+200,l.height+200,25),y=new Qt(l.width+200,l.height+200,25)){this.transform=l,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Dt,this.screenBottomBoundary=l.height+Dt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,d,y,v,A,P){const D=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,P),$=y*D.perspectiveRatio,Z=l.x1*$+D.point.x,Q=l.y1*$+D.point.y,te=l.x2*$+D.point.x,ge=l.y2*$+D.point.y;return!this.isInsideGrid(Z,Q,te,ge)||d!=="always"&&this.grid.hitTest(Z,Q,te,ge,d,A)||D.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[Z,Q,te,ge],offscreen:this.isOffscreen(Z,Q,te,ge)}}placeCollisionCircles(l,d,y,v,A,P,D,$,Z,Q,te,ge,ke,Ae){const Te=[],ve=new s.P(d.anchorX,d.anchorY),Be=or(ve,P,Ae),et=Se(this.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),Le=(Q?A/et:A*et)/s.ao,Ve=or(ve,D,Ae).point,it=_e(Le,v,d.lineOffsetX*Le,d.lineOffsetY*Le,!1,Ve,ve,d,y,D,{projections:{},offsets:{}},!1,Ae);let ot=!1,ft=!1,Ct=!0;if(it){const wt=.5*ge*et+ke,Bt=new s.P(-100,-100),Ot=new s.P(this.screenRightBoundary,this.screenBottomBoundary),kn=new bt,$t=it.first,gn=it.last;let Sn=[];for(let Mn=$t.path.length-1;Mn>=1;Mn--)Sn.push($t.path[Mn]);for(let Mn=1;Mn<gn.path.length;Mn++)Sn.push(gn.path[Mn]);const qn=2.5*wt;if($){const Mn=Sn.map(Rn=>or(Rn,$,Ae));Sn=Mn.some(Rn=>Rn.signedDistanceFromCamera<=0)?[]:Mn.map(Rn=>Rn.point)}let An=[];if(Sn.length>0){const Mn=Sn[0].clone(),Rn=Sn[0].clone();for(let jr=1;jr<Sn.length;jr++)Mn.x=Math.min(Mn.x,Sn[jr].x),Mn.y=Math.min(Mn.y,Sn[jr].y),Rn.x=Math.max(Rn.x,Sn[jr].x),Rn.y=Math.max(Rn.y,Sn[jr].y);An=Mn.x>=Bt.x&&Rn.x<=Ot.x&&Mn.y>=Bt.y&&Rn.y<=Ot.y?[Sn]:Rn.x<Bt.x||Mn.x>Ot.x||Rn.y<Bt.y||Mn.y>Ot.y?[]:s.al([Sn],Bt.x,Bt.y,Ot.x,Ot.y)}for(const Mn of An){kn.reset(Mn,.25*wt);let Rn=0;Rn=kn.length<=.5*wt?1:Math.ceil(kn.paddedLength/qn)+1;for(let jr=0;jr<Rn;jr++){const lr=jr/Math.max(Rn-1,1),io=kn.lerp(lr),oi=io.x+Dt,Rr=io.y+Dt;Te.push(oi,Rr,wt,0);const si=oi-wt,oo=Rr-wt,Xo=oi+wt,Is=Rr+wt;if(Ct=Ct&&this.isOffscreen(si,oo,Xo,Is),ft=ft||this.isInsideGrid(si,oo,Xo,Is),l!=="always"&&this.grid.hitTestCircle(oi,Rr,wt,l,te)&&(ot=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:ot}}}}return{circles:!Z&&ot||!ft||et<this.perspectiveRatioCutoff?[]:Te,offscreen:Ct,collisionDetected:ot}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,v=1/0,A=-1/0,P=-1/0;for(const Q of l){const te=new s.P(Q.x+Dt,Q.y+Dt);y=Math.min(y,te.x),v=Math.min(v,te.y),A=Math.max(A,te.x),P=Math.max(P,te.y),d.push(te)}const D=this.grid.query(y,v,A,P).concat(this.ignoredGrid.query(y,v,A,P)),$={},Z={};for(const Q of D){const te=Q.key;if($[te.bucketInstanceId]===void 0&&($[te.bucketInstanceId]={}),$[te.bucketInstanceId][te.featureIndex])continue;const ge=[new s.P(Q.x1,Q.y1),new s.P(Q.x2,Q.y1),new s.P(Q.x2,Q.y2),new s.P(Q.x1,Q.y2)];s.am(d,ge)&&($[te.bucketInstanceId][te.featureIndex]=!0,Z[te.bucketInstanceId]===void 0&&(Z[te.bucketInstanceId]=[]),Z[te.bucketInstanceId].push(te.featureIndex))}return Z}insertCollisionBox(l,d,y,v,A,P){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:A,collisionGroupID:P,overlapMode:d},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,y,v,A,P){const D=y?this.ignoredGrid:this.grid,$={bucketInstanceId:v,featureIndex:A,collisionGroupID:P,overlapMode:d};for(let Z=0;Z<l.length;Z+=4)D.insertCircle($,l[Z],l[Z+1],l[Z+2])}projectAndGetPerspectiveRatio(l,d,y,v){let A;return v?(A=[d,y,v(d,y),1],s.af(A,A,l)):(A=[d,y,0,1],ht(A,A,l)),{point:new s.P((A[0]/A[3]+1)/2*this.transform.width+Dt,(-A[1]/A[3]+1)/2*this.transform.height+Dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A[3]*.5}}isOffscreen(l,d,y,v){return y<Dt||l>=this.screenRightBoundary||v<Dt||d>this.screenBottomBoundary}isInsideGrid(l,d,y,v){return y>=0&&l<this.gridRightBoundary&&v>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=s.an([]);return s.H(l,l,[-100,-100,0]),l}}function mn(w,l,d){return l*(s.W/(w.tileSize*Math.pow(2,d-w.tileID.overscaledZ)))}class Cn{constructor(l,d,y,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Nn{constructor(l,d,y,v,A){this.text=new Cn(l?l.text:null,d,y,A),this.icon=new Cn(l?l.icon:null,d,v,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mr{constructor(l,d,y){this.text=l,this.icon=d,this.skipFade=y}}class Xr{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class Tn{constructor(l,d,y,v,A){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=A}}class Or{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[l]}}function ii(w,l,d,y,v){const{horizontalAlign:A,verticalAlign:P}=s.at(w);return new s.P(-(A-.5)*l+y[0]*v,-(P-.5)*d+y[1]*v)}function Mi(w,l,d,y,v,A){const{x1:P,x2:D,y1:$,y2:Z,anchorPointX:Q,anchorPointY:te}=w,ge=new s.P(l,d);return y&&ge._rotate(v?A:-A),{x1:P+ge.x,y1:$+ge.y,x2:D+ge.x,y2:Z+ge.y,anchorPointX:Q,anchorPointY:te}}class Oi{constructor(l,d,y,v,A){this.transform=l.clone(),this.terrain=d,this.collisionIndex=new en(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Or(v),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,y,v){const A=y.getBucket(d),P=y.latestFeatureIndex;if(!A||!P||d.id!==A.layerIds[0])return;const D=y.collisionBoxArray,$=A.layers[0].layout,Z=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Q=y.tileSize/s.W,te=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),ge=$.get("text-pitch-alignment")==="map",ke=$.get("text-rotation-alignment")==="map",Ae=mn(y,1,this.transform.zoom),Te=Yt(te,ge,ke,this.transform,Ae);let ve=null;if(ge){const et=vr(te,ge,ke,this.transform,Ae);ve=s.K([],this.transform.labelPlaneMatrix,et)}this.retainedQueryData[A.bucketInstanceId]=new Tn(A.bucketInstanceId,P,A.sourceLayerIndex,A.index,y.tileID);const Be={bucket:A,layout:$,posMatrix:te,textLabelPlaneMatrix:Te,labelToScreenMatrix:ve,scale:Z,textPixelRatio:Q,holdingForFade:y.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.ag(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(v)for(const et of A.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ve,symbolInstanceEnd:it}=et;l.push({sortKey:Le,symbolInstanceStart:Ve,symbolInstanceEnd:it,parameters:Be})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(l,d,y,v,A,P,D,$,Z,Q,te,ge,ke,Ae,Te,ve){const Be=s.ap[l.textAnchor],et=[l.textOffset0,l.textOffset1],Le=ii(Be,y,v,et,A),Ve=this.collisionIndex.placeCollisionBox(Mi(d,Le.x,Le.y,P,D,this.transform.angle),te,$,Z,Q.predicate,ve);if((!Te||this.collisionIndex.placeCollisionBox(Mi(Te,Le.x,Le.y,P,D,this.transform.angle),te,$,Z,Q.predicate,ve).box.length!==0)&&Ve.box.length>0){let it;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(it=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),ge.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ge.crossTileID]={textOffset:et,width:y,height:v,anchor:Be,textBoxScale:A,prevAnchor:it},this.markUsedJustification(ke,Be,ge,Ae),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Ae,ge),this.placedOrientations[ge.crossTileID]=Ae),{shift:Le,placedGlyphBoxes:Ve}}}placeLayerBucketPart(l,d,y){const{bucket:v,layout:A,posMatrix:P,textLabelPlaneMatrix:D,labelToScreenMatrix:$,textPixelRatio:Z,holdingForFade:Q,collisionBoxArray:te,partiallyEvaluatedTextSize:ge,collisionGroup:ke}=l.parameters,Ae=A.get("text-optional"),Te=A.get("icon-optional"),ve=s.aq(A,"text-overlap","text-allow-overlap"),Be=ve==="always",et=s.aq(A,"icon-overlap","icon-allow-overlap"),Le=et==="always",Ve=A.get("text-rotation-alignment")==="map",it=A.get("text-pitch-alignment")==="map",ot=A.get("icon-text-fit")!=="none",ft=A.get("symbol-z-order")==="viewport-y",Ct=Be&&(Le||!v.hasIconData()||Te),wt=Le&&(Be||!v.hasTextData()||Ae);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te);const Bt=this.retainedQueryData[v.bucketInstanceId].tileID,Ot=this.terrain?($t,gn)=>this.terrain.getElevation(Bt,$t,gn):null,kn=($t,gn)=>{var Sn,qn;if(d[$t.crossTileID])return;if(Q)return void(this.placements[$t.crossTileID]=new Mr(!1,!1,!1));let An=!1,Mn=!1,Rn=!0,jr=null,lr={box:null,offscreen:null},io={box:null,offscreen:null},oi=null,Rr=null,si=null,oo=0,Xo=0,Is=0;gn.textFeatureIndex?oo=gn.textFeatureIndex:$t.useRuntimeCollisionCircles&&(oo=$t.featureIndex),gn.verticalTextFeatureIndex&&(Xo=gn.verticalTextFeatureIndex);const kl=gn.textBox;if(kl){const Jr=Yr=>{let Fr=s.ah.horizontal;if(v.allowVerticalPlacement&&!Yr&&this.prevPlacement){const go=this.prevPlacement.placedOrientations[$t.crossTileID];go&&(this.placedOrientations[$t.crossTileID]=go,Fr=go,this.markUsedOrientation(v,Fr,$t))}return Fr},Br=(Yr,Fr)=>{if(v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&gn.verticalTextBox){for(const go of v.writingModes)if(go===s.ah.vertical?(lr=Fr(),io=lr):lr=Yr(),lr&&lr.box&&lr.box.length)break}else lr=Yr()},Lr=$t.textAnchorOffsetStartIndex,mo=$t.textAnchorOffsetEndIndex;if(mo===Lr){const Yr=(Fr,go)=>{const Qr=this.collisionIndex.placeCollisionBox(Fr,ve,Z,P,ke.predicate,Ot);return Qr&&Qr.box&&Qr.box.length&&(this.markUsedOrientation(v,go,$t),this.placedOrientations[$t.crossTileID]=go),Qr};Br(()=>Yr(kl,s.ah.horizontal),()=>{const Fr=gn.verticalTextBox;return v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Fr?Yr(Fr,s.ah.vertical):{box:null,offscreen:null}}),Jr(lr&&lr.box&&lr.box.length)}else{let Yr=s.ap[(qn=(Sn=this.prevPlacement)===null||Sn===void 0?void 0:Sn.variableOffsets[$t.crossTileID])===null||qn===void 0?void 0:qn.anchor];const Fr=(Qr,qr,Uc)=>{const Jh=Qr.x2-Qr.x1,Js=Qr.y2-Qr.y1,Ys=$t.textBoxScale,Su=ot&&et==="never"?qr:null;let zs={box:[],offscreen:!1},Vc=ve==="never"?1:2,Yh="never";Yr&&Vc++;for(let qc=0;qc<Vc;qc++){for(let Hc=Lr;Hc<mo;Hc++){const Cu=v.textAnchorOffsets.get(Hc);if(Yr&&Cu.textAnchor!==Yr)continue;const Gc=this.attemptAnchorPlacement(Cu,Qr,Jh,Js,Ys,Ve,it,Z,P,ke,Yh,$t,v,Uc,Su,Ot);if(Gc&&(zs=Gc.placedGlyphBoxes,zs&&zs.box&&zs.box.length))return An=!0,jr=Gc.shift,zs}Yr?Yr=null:Yh=ve}return zs};Br(()=>Fr(kl,gn.iconBox,s.ah.horizontal),()=>{const Qr=gn.verticalTextBox;return v.allowVerticalPlacement&&!(lr&&lr.box&&lr.box.length)&&$t.numVerticalGlyphVertices>0&&Qr?Fr(Qr,gn.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),lr&&(An=lr.box,Rn=lr.offscreen);const go=Jr(lr&&lr.box);if(!An&&this.prevPlacement){const Qr=this.prevPlacement.variableOffsets[$t.crossTileID];Qr&&(this.variableOffsets[$t.crossTileID]=Qr,this.markUsedJustification(v,Qr.anchor,$t,go))}}}if(oi=lr,An=oi&&oi.box&&oi.box.length>0,Rn=oi&&oi.offscreen,$t.useRuntimeCollisionCircles){const Jr=v.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),Br=s.ai(v.textSizeData,ge,Jr),Lr=A.get("text-padding");Rr=this.collisionIndex.placeCollisionCircles(ve,Jr,v.lineVertexArray,v.glyphOffsetArray,Br,P,D,$,y,it,ke.predicate,$t.collisionCircleDiameter,Lr,Ot),Rr.circles.length&&Rr.collisionDetected&&!y&&s.w("Collisions detected, but collision boxes are not shown"),An=Be||Rr.circles.length>0&&!Rr.collisionDetected,Rn=Rn&&Rr.offscreen}if(gn.iconFeatureIndex&&(Is=gn.iconFeatureIndex),gn.iconBox){const Jr=Br=>{const Lr=ot&&jr?Mi(Br,jr.x,jr.y,Ve,it,this.transform.angle):Br;return this.collisionIndex.placeCollisionBox(Lr,et,Z,P,ke.predicate,Ot)};io&&io.box&&io.box.length&&gn.verticalIconBox?(si=Jr(gn.verticalIconBox),Mn=si.box.length>0):(si=Jr(gn.iconBox),Mn=si.box.length>0),Rn=Rn&&si.offscreen}const Ps=Ae||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,Ko=Te||$t.numIconVertices===0;if(Ps||Ko?Ko?Ps||(Mn=Mn&&An):An=Mn&&An:Mn=An=Mn&&An,An&&oi&&oi.box&&this.collisionIndex.insertCollisionBox(oi.box,ve,A.get("text-ignore-placement"),v.bucketInstanceId,io&&io.box&&Xo?Xo:oo,ke.ID),Mn&&si&&this.collisionIndex.insertCollisionBox(si.box,et,A.get("icon-ignore-placement"),v.bucketInstanceId,Is,ke.ID),Rr&&(An&&this.collisionIndex.insertCollisionCircles(Rr.circles,ve,A.get("text-ignore-placement"),v.bucketInstanceId,oo,ke.ID),y)){const Jr=v.bucketInstanceId;let Br=this.collisionCircleArrays[Jr];Br===void 0&&(Br=this.collisionCircleArrays[Jr]=new Xr);for(let Lr=0;Lr<Rr.circles.length;Lr+=4)Br.circles.push(Rr.circles[Lr+0]),Br.circles.push(Rr.circles[Lr+1]),Br.circles.push(Rr.circles[Lr+2]),Br.circles.push(Rr.collisionDetected?1:0)}if($t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new Mr(An||Ct,Mn||wt,Rn||v.justReloaded),d[$t.crossTileID]=!0};if(ft){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=v.getSortedSymbolIndexes(this.transform.angle);for(let gn=$t.length-1;gn>=0;--gn){const Sn=$t[gn];kn(v.symbolInstances.get(Sn),v.collisionArrays[Sn])}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)kn(v.symbolInstances.get($t),v.collisionArrays[$t]);if(y&&v.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[v.bucketInstanceId];s.ar($t.invProjMatrix,P),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,d,y,v){let A;A=v===s.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[s.as(d)];const P=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const D of P)D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=A>=0&&D!==A?0:y.crossTileID)}markUsedOrientation(l,d,y){const v=d===s.ah.horizontal||d===s.ah.horizontalOnly?d:0,A=d===s.ah.vertical?d:0,P=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const D of P)l.text.placedSymbolArray.get(D).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const v=d?d.symbolFadeChange(l):1,A=d?d.opacities:{},P=d?d.variableOffsets:{},D=d?d.placedOrientations:{};for(const $ in this.placements){const Z=this.placements[$],Q=A[$];Q?(this.opacities[$]=new Nn(Q,v,Z.text,Z.icon),y=y||Z.text!==Q.text.placed||Z.icon!==Q.icon.placed):(this.opacities[$]=new Nn(null,v,Z.text,Z.icon,Z.skipFade),y=y||Z.text||Z.icon)}for(const $ in A){const Z=A[$];if(!this.opacities[$]){const Q=new Nn(Z,v,!1,!1);Q.isHidden()||(this.opacities[$]=Q,y=y||Z.text.placed||Z.icon.placed)}}for(const $ in P)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=P[$]);for(const $ in D)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=D[$]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const y={};for(const v of d){const A=v.getBucket(l);A&&v.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,y,v.collisionBoxArray)}}updateBucketOpacities(l,d,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],A=v.layout,P=new Nn(null,0,!1,!1,!0),D=A.get("text-allow-overlap"),$=A.get("icon-allow-overlap"),Z=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Q=A.get("text-rotation-alignment")==="map",te=A.get("text-pitch-alignment")==="map",ge=A.get("icon-text-fit")!=="none",ke=new Nn(null,0,D&&($||!l.hasIconData()||A.get("icon-optional")),$&&(D||!l.hasTextData()||A.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const Ae=(Te,ve,Be)=>{for(let et=0;et<ve/4;et++)Te.opacityVertexArray.emplaceBack(Be);Te.hasVisibleVertices=Te.hasVisibleVertices||Be!==nl};for(let Te=0;Te<l.symbolInstances.length;Te++){const ve=l.symbolInstances.get(Te),{numHorizontalGlyphVertices:Be,numVerticalGlyphVertices:et,crossTileID:Le}=ve;let Ve=this.opacities[Le];d[Le]?Ve=P:Ve||(Ve=ke,this.opacities[Le]=Ve),d[Le]=!0;const it=ve.numIconVertices>0,ot=this.placedOrientations[ve.crossTileID],ft=ot===s.ah.vertical,Ct=ot===s.ah.horizontal||ot===s.ah.horizontalOnly;if(Be>0||et>0){const wt=$i(Ve.text);Ae(l.text,Be,ft?nl:wt),Ae(l.text,et,Ct?nl:wt);const Bt=Ve.text.isHidden();[ve.rightJustifiedTextSymbolIndex,ve.centerJustifiedTextSymbolIndex,ve.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(l.text.placedSymbolArray.get($t).hidden=Bt||ft?1:0)}),ve.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(ve.verticalPlacedTextSymbolIndex).hidden=Bt||Ct?1:0);const Ot=this.variableOffsets[ve.crossTileID];Ot&&this.markUsedJustification(l,Ot.anchor,ve,ot);const kn=this.placedOrientations[ve.crossTileID];kn&&(this.markUsedJustification(l,"left",ve,kn),this.markUsedOrientation(l,kn,ve))}if(it){const wt=$i(Ve.icon),Bt=!(ge&&ve.verticalPlacedIconSymbolIndex&&ft);ve.placedIconSymbolIndex>=0&&(Ae(l.icon,ve.numIconVertices,Bt?wt:nl),l.icon.placedSymbolArray.get(ve.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),ve.verticalPlacedIconSymbolIndex>=0&&(Ae(l.icon,ve.numVerticalIconVertices,Bt?nl:wt),l.icon.placedSymbolArray.get(ve.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const wt=l.collisionArrays[Te];if(wt){let Bt=new s.P(0,0);if(wt.textBox||wt.verticalTextBox){let kn=!0;if(Z){const $t=this.variableOffsets[Le];$t?(Bt=ii($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),Q&&Bt._rotate(te?this.transform.angle:-this.transform.angle)):kn=!1}wt.textBox&&gi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!kn||ft,Bt.x,Bt.y),wt.verticalTextBox&&gi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!kn||Ct,Bt.x,Bt.y)}const Ot=!!(!Ct&&wt.verticalIconBox);wt.iconBox&&gi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,Ot,ge?Bt.x:0,ge?Bt.y:0),wt.verticalIconBox&&gi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!Ot,ge?Bt.x:0,ge?Bt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Te.invProjMatrix,l.placementViewportMatrix=Te.viewportMatrix,l.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function gi(w,l,d,y,v){w.emplaceBack(l?1:0,d?1:0,y||0,v||0),w.emplaceBack(l?1:0,d?1:0,y||0,v||0),w.emplaceBack(l?1:0,d?1:0,y||0,v||0),w.emplaceBack(l?1:0,d?1:0,y||0,v||0)}const qo=Math.pow(2,25),ph=Math.pow(2,24),bp=Math.pow(2,17),sr=Math.pow(2,16),cc=Math.pow(2,9),fc=Math.pow(2,8),to=Math.pow(2,1);function $i(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,d=Math.floor(127*w.opacity);return d*qo+l*ph+d*bp+l*sr+d*cc+l*fc+d*to+l}const nl=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,d,y,v,A){const P=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(P,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((D,$)=>D.sortKey-$.sortKey));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,A())return!0;return!1}}class po{constructor(l,d,y,v,A,P,D,$){this.placement=new Oi(l,d,P,D,$),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(l,d,y){const v=_.now(),A=()=>!this._forceFullPlacement&&_.now()-v>2;for(;this._currentPlacementIndex>=0;){const P=d[l[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new ho(P)),this._inProgressLayer.continuePlacement(y[P.source],this.placement,this._showCollisionBoxes,P,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ma=512/s.W/2;class Nl{constructor(l,d,y){this.tileID=l,this.bucketInstanceId=y,this._symbolsByKey={};const v=new Map;for(let A=0;A<d.length;A++){const P=d.get(A),D=P.key,$=v.get(D);$?$.push(P):v.set(D,[P])}for(const[A,P]of v){const D={positions:P.map($=>({x:Math.floor($.anchorX*ma),y:Math.floor($.anchorY*ma)})),crossTileIDs:P.map($=>$.crossTileID)};if(D.positions.length>128){const $=new s.au(D.positions.length,16,Uint16Array);for(const{x:Z,y:Q}of D.positions)$.add(Z,Q);$.finish(),delete D.positions,D.index=$}this._symbolsByKey[A]=D}}getScaledCoordinates(l,d){const{x:y,y:v,z:A}=this.tileID.canonical,{x:P,y:D,z:$}=d.canonical,Z=ma/Math.pow(2,$-A),Q=(D*s.W+l.anchorY)*Z,te=v*s.W*ma;return{x:Math.floor((P*s.W+l.anchorX)*Z-y*s.W*ma),y:Math.floor(Q-te)}}findMatches(l,d,y){const v=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let A=0;A<l.length;A++){const P=l.get(A);if(P.crossTileID)continue;const D=this._symbolsByKey[P.key];if(!D)continue;const $=this.getScaledCoordinates(P,d);if(D.index){const Z=D.index.range($.x-v,$.y-v,$.x+v,$.y+v).sort();for(const Q of Z){const te=D.crossTileIDs[Q];if(!y[te]){y[te]=!0,P.crossTileID=te;break}}}else if(D.positions)for(let Z=0;Z<D.positions.length;Z++){const Q=D.positions[Z],te=D.crossTileIDs[Z];if(Math.abs(Q.x-$.x)<=v&&Math.abs(Q.y-$.y)<=v&&!y[te]){y[te]=!0,P.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Kr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const y in this.indexes){const v=this.indexes[y],A={};for(const P in v){const D=v[P];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+d),A[D.tileID.key]=D}this.indexes[y]=A}this.lng=l}addBucket(l,d,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<d.symbolInstances.length;A++)d.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const P=this.indexes[A];if(Number(A)>l.overscaledZ)for(const D in P){const $=P[D];$.tileID.isChildOf(l)&&$.findMatches(d.symbolInstances,l,v)}else{const D=P[l.scaledTo(Number(A)).key];D&&D.findMatches(d.symbolInstances,l,v)}}for(let A=0;A<d.symbolInstances.length;A++){const P=d.symbolInstances.get(A);P.crossTileID||(P.crossTileID=y.generate(),v[P.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Nl(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const y of d.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let d=!1;for(const y in this.indexes){const v=this.indexes[y];for(const A in v)l[v[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,v[A]),delete v[A],d=!0)}return d}}class Ss{constructor(){this.layerIndexes={},this.crossTileIDs=new Kr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,y){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new rl);let A=!1;const P={};v.handleWrapJump(y);for(const D of d){const $=D.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,$,this.crossTileIDs)&&(A=!0),P[$.bucketInstanceId]=!0)}return v.removeStaleBuckets(P)&&(A=!0),A}pruneUnusedLayers(l){const d={};l.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const Dr=(w,l)=>s.t(w,l&&l.filter(d=>d.identifier!=="source.canvas")),jl=s.av();class no extends s.E{constructor(l,d={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const v=this.sourceCaches[y].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[y].reload()}},this.map=l,this.dispatcher=new un(jt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new xe,this.imageManager.setEventedParent(this),this.glyphManager=new ze(l._requestManager,d.localIdeographFontFamily),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new Ss,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ax()),xt().on(Tr,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.sourceCaches[y.sourceId];if(!v)return;const A=v.getSource();if(A&&A.vectorLayerIds)for(const P in this._layers){const D=this._layers[P];D.source===A.id&&this._validateLayer(D)}})}loadURL(l,d={},y){this.fire(new s.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const v=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,s.h(v,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,d,y)}).catch(A=>{this._loadStyleRequest=null,A&&this.fire(new s.j(A))})}loadJSON(l,d={},y){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(l,d,y)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(jl,{validate:!1})}_load(l,d,y){var v;const A=d.transformStyle?d.transformStyle(y,l):l;if(!d.validate||!Dr(this,s.x(A))){this._loaded=!0,this.stylesheet=A;for(const P in A.sources)this.addSource(P,A.sources[P],{validate:!1});A.sprite?this._loadSprite(A.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(A.glyphs),this._createLayers(),this.light=new Xe(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const l=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of l){const y=s.az(d);y.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=y}}_loadSprite(l,d=!1,y=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(A,P,D,$){return s._(this,void 0,void 0,function*(){const Z=Ee(A),Q=D>1?"@2x":"",te={},ge={};for(const{id:ke,url:Ae}of Z){const Te=P.transformRequest(P.normalizeSpriteURL(Ae,Q,".json"),"SpriteJSON");te[ke]=s.h(Te,$);const ve=P.transformRequest(P.normalizeSpriteURL(Ae,Q,".png"),"SpriteImage");ge[ke]=O.getImage(ve,$)}return yield Promise.all([...Object.values(te),...Object.values(ge)]),function(ke,Ae){return s._(this,void 0,void 0,function*(){const Te={};for(const ve in ke){Te[ve]={};const Be=_.getImageCanvasContext((yield Ae[ve]).data),et=(yield ke[ve]).data;for(const Le in et){const{width:Ve,height:it,x:ot,y:ft,sdf:Ct,pixelRatio:wt,stretchX:Bt,stretchY:Ot,content:kn}=et[Le];Te[ve][Le]={data:null,pixelRatio:wt,sdf:Ct,stretchX:Bt,stretchY:Ot,content:kn,spriteData:{width:Ve,height:it,x:ot,y:ft,context:Be}}}}return Te})}(te,ge)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(A=>{if(this._spriteRequest=null,A)for(const P in A){this._spritesImagesIds[P]=[];const D=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter($=>!($ in A)):[];for(const $ of D)this.imageManager.removeImage($),this._changedImages[$]=!0;for(const $ in A[P]){const Z=P==="default"?$:`${P}:${$}`;this._spritesImagesIds[P].push(Z),Z in this.imageManager.images?this.imageManager.updateImage(Z,A[P][$],!1):this.imageManager.addImage(Z,A[P][$]),d&&(this._changedImages[Z]=!0)}}}).catch(A=>{this._spriteRequest=null,v=A,this.fire(new s.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(l){const d=this.sourceCaches[l.source];if(!d)return;const y=l.sourceLayer;if(!y)return;const v=d.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.j(new Error(`Source layer "${y}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const d=this._serializedAllLayers();if(!l||l.length===0)return Object.values(d);const y=[];for(const v of l)d[v]&&y.push(d[v]);return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const d=Object.keys(this._layers);for(const y of d){const v=this._layers[y];v.type!=="custom"&&(l[y]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const d=this._changed;if(d){const v=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(v.length||A.length)&&this._updateWorkerLayers(v,A);for(const P in this._updatedSources){const D=this._updatedSources[P];if(D==="reload")this._reloadSource(P);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const y={};for(const v in this.sourceCaches){const A=this.sourceCaches[v];y[v]=A.used,A.used=!1}for(const v of this._order){const A=this._layers[v];A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const v in y){const A=this.sourceCaches[v];!!y[v]!=!!A.used&&A.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,d&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,d={}){var y;this._checkLoaded();const v=this.serialize();if(l=d.transformStyle?d.transformStyle(v,l):l,((y=d.validate)===null||y===void 0||y)&&Dr(this,s.x(l)))return!1;(l=s.aA(l)).layers=s.ay(l.layers);const A=s.aB(v,l),P=this._getOperationsToPerform(A);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const D of P.operations)D();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const d=[],y=[];for(const v of l)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":d.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":d.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":d.push(()=>{});break;default:y.push(v.command)}return{operations:d,unimplemented:y}}addImage(l,d){if(this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,d),this._afterImageUpdated(l)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,d,y={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.x.source,`sources.${l}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const v=this.sourceCaches[l]=new $n(l,d,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===l)return this.fire(new s.j(new Error(`Source "${l}" cannot be removed while layer "${y}" is using it.`)));const d=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],d.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,d){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const y=this.sourceCaches[l].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(d),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,d,y={}){this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new s.j(new Error(`Layer "${v}" already exists on this map.`)));let A;if(l.type==="custom"){if(Dr(this,s.aC(l)))return;A=s.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=s.aA(l),l=s.e(l,{source:v})),this._validate(s.x.layer,`layers.${v}`,l,{arrayIndex:-1},y))return;A=s.az(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:v}})}const P=d?this._order.indexOf(d):this._order.length;if(d&&P===-1)this.fire(new s.j(new Error(`Cannot add layer "${v}" before non-existing layer "${d}".`)));else{if(this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=A,this._removedLayers[v]&&A.source&&A.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const y=this._order.indexOf(l);this._order.splice(y,1);const v=d?this._order.indexOf(d):this._order.length;d&&v===-1?this.fire(new s.j(new Error(`Cannot move layer "${l}" before non-existing layer "${d}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${l}".`)));d.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,d,y){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===d&&v.maxzoom===y||(d!=null&&(v.minzoom=d),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,d,y={}){this._checkLoaded();const v=this.getLayer(l);if(v){if(!s.aD(v.filter,d))return d==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.x.filter,`layers.${v.id}.filter`,d,null,y)||(v.filter=s.aA(d),this._updateLayer(v)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.aA(this.getLayer(l).filter)}setLayoutProperty(l,d,y,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getLayoutProperty(d),y)||(A.setLayoutProperty(d,y,v),this._updateLayer(A)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,d){const y=this.getLayer(l);if(y)return y.getLayoutProperty(d);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,d,y,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getPaintProperty(d),y)||(A.setPaintProperty(d,y,v)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,d){return this.getLayer(l).getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const y=l.source,v=l.sourceLayer,A=this.sourceCaches[y];if(A===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const P=A.getSource().type;P==="geojson"&&v?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||v?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),A.setFeatureState(v,l.id,d)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,d){this._checkLoaded();const y=l.source,v=this.sourceCaches[y];if(v===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const A=v.getSource().type,P=A==="vector"?l.sourceLayer:void 0;A!=="vector"||P?d&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(P,l.id,d):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const d=l.source,y=l.sourceLayer,v=this.sourceCaches[d];if(v!==void 0)return v.getSource().type!=="vector"||y?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,l.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.aE(this.sourceCaches,A=>A.serialize()),d=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet;return s.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:d,terrain:y},A=>A!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const d=P=>this._layers[P].type==="fill-extrusion",y={},v=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(d(D)){y[D]=P;for(const $ of l){const Z=$[D];if(Z)for(const Q of Z)v.push(Q)}}}v.sort((P,D)=>D.intersectionZ-P.intersectionZ);const A=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(d(D))for(let $=v.length-1;$>=0;$--){const Z=v[$].feature;if(y[Z.layer.id]<P)break;A.push(Z),v.pop()}else for(const $ of l){const Z=$[D];if(Z)for(const Q of Z)A.push(Q.feature)}}return A}queryRenderedFeatures(l,d,y){d&&d.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const v={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const D of d.layers){const $=this._layers[D];if(!$)return this.fire(new s.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[$.source]=!0}}const A=[];d.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const D in this.sourceCaches)d.layers&&!v[D]||A.push(pn(this.sourceCaches[D],this._layers,P,l,d,y));return this.placement&&A.push(function(D,$,Z,Q,te,ge,ke){const Ae={},Te=ge.queryRenderedSymbols(Q),ve=[];for(const Be of Object.keys(Te).map(Number))ve.push(ke[Be]);ve.sort(yn);for(const Be of ve){const et=Be.featureIndex.lookupSymbolFeatures(Te[Be.bucketInstanceId],$,Be.bucketIndex,Be.sourceLayerIndex,te.filter,te.layers,te.availableImages,D);for(const Le in et){const Ve=Ae[Le]=Ae[Le]||[],it=et[Le];it.sort((ot,ft)=>{const Ct=Be.featureSortOrder;if(Ct){const wt=Ct.indexOf(ot.featureIndex);return Ct.indexOf(ft.featureIndex)-wt}return ft.featureIndex-ot.featureIndex});for(const ot of it)Ve.push(ot)}}for(const Be in Ae)Ae[Be].forEach(et=>{const Le=et.feature,Ve=Z[D[Be].source].getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=Ve});return Ae}(this._layers,P,this.sourceCaches,l,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,d){d&&d.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",d.filter,null,d);const y=this.sourceCaches[l];return y?function(v,A){const P=v.getRenderableIds().map(Z=>v.getTileByID(Z)),D=[],$={};for(let Z=0;Z<P.length;Z++){const Q=P[Z],te=Q.tileID.canonical.key;$[te]||($[te]=!0,Q.querySourceFeatures(D,A))}return D}(y,d):[]}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const P in l)if(!s.aD(l[P],y[P])){v=!0;break}if(!v)return;const A={now:_.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,d),this.light.updateTransitions(A)}_validate(l,d,y,v,A={}){return(!A||A.validate!==!1)&&Dr(this,l.call(s.x,s.e({key:d,style:this.serialize(),value:y,styleSpec:s.v},v)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),xt().off(Tr,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const y=this.sourceCaches[d];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const d in this.sourceCaches)this.sourceCaches[d].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,d,y,v,A=!1){let P=!1,D=!1;const $={};for(const Z of this._order){const Q=this._layers[Z];if(Q.type!=="symbol")continue;if(!$[Q.source]){const ge=this.sourceCaches[Q.source];$[Q.source]=ge.getRenderableIds(!0).map(ke=>ge.getTileByID(ke)).sort((ke,Ae)=>Ae.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Ae.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(Q,$[Q.source],l.center.lng);P=P||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),l.zoom))&&(this.pauseablePlacement=new po(l,this.map.terrain,this._order,A,d,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),D=!0),P&&this.pauseablePlacement.placement.setStale()),D||P)for(const Z of this._order){const Q=this._layers[Z];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,$[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d){return s._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,d.icons),y})}getGlyphs(l,d){return s._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(d.stacks),v=this.sourceCaches[d.source];return v&&v.setDependencies(d.tileID.key,d.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,d={}){this._checkLoaded(),l&&this._validate(s.x.glyphs,"glyphs",l,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,d,y={},v){this._checkLoaded();const A=[{id:l,url:d}],P=[...Ee(this.stylesheet.sprite),...A];this._validate(s.x.sprite,"sprite",P,null,y)||(this.stylesheet.sprite=P,this._loadSprite(A,!0,v))}removeSprite(l){this._checkLoaded();const d=Ee(this.stylesheet.sprite);if(d.find(y=>y.id===l)){if(this._spritesImagesIds[l])for(const y of this._spritesImagesIds[l])this.imageManager.removeImage(y),this._changedImages[y]=!0;d.splice(d.findIndex(y=>y.id===l),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ee(this.stylesheet.sprite)}setSprite(l,d={},y){this._checkLoaded(),l&&this._validate(s.x.sprite,"sprite",l,null,d)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,y):(this._unloadSprite(),y&&y(null)))}}var Ul=s.X([{name:"a_pos",type:"Int16",components:2}]),Ho="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const il={prelude:ar(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ar(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ar(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ar(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ar("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ar(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ar("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ar("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ar(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ar(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ar(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ar(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ar(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ar(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ar(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ar(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ar(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ar(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ar("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ho),terrainDepth:ar("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ho),terrainCoords:ar("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ho)};function ar(w,l){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=l.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=A?A.concat(v):v,D={};return{fragmentSource:w=w.replace(d,($,Z,Q,te,ge)=>(D[ge]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${ge}
varying ${Q} ${te} ${ge};
#else
uniform ${Q} ${te} u_${ge};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ge}
    ${Q} ${te} ${ge} = u_${ge};
#endif
`)),vertexSource:l=l.replace(d,($,Z,Q,te,ge)=>{const ke=te==="float"?"vec2":"vec4",Ae=ge.match(/color/)?"color":ke;return D[ge]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${ge}
uniform lowp float u_${ge}_t;
attribute ${Q} ${ke} a_${ge};
varying ${Q} ${te} ${ge};
#else
uniform ${Q} ${te} u_${ge};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ge}
    ${ge} = a_${ge};
#else
    ${Q} ${te} ${ge} = u_${ge};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ge}
    ${ge} = unpack_mix_${Ae}(a_${ge}, u_${ge}_t);
#else
    ${Q} ${te} ${ge} = u_${ge};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${ge}
uniform lowp float u_${ge}_t;
attribute ${Q} ${ke} a_${ge};
#else
uniform ${Q} ${te} u_${ge};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${ge}
    ${Q} ${te} ${ge} = a_${ge};
#else
    ${Q} ${te} ${ge} = u_${ge};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ge}
    ${Q} ${te} ${ge} = unpack_mix_${Ae}(a_${ge}, u_${ge}_t);
#else
    ${Q} ${te} ${ge} = u_${ge};
#endif
`}),staticAttributes:y,staticUniforms:P}}class Vl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,d,y,v,A,P,D,$,Z){this.context=l;let Q=this.boundPaintVertexBuffers.length!==v.length;for(let te=0;!Q&&te<v.length;te++)this.boundPaintVertexBuffers[te]!==v[te]&&(Q=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||Q||this.boundIndexBuffer!==A||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==$||this.boundDynamicVertexBuffer3!==Z?this.freshBind(d,y,v,A,P,D,$,Z):(l.bindVertexArray.set(this.vao),D&&D.bind(),A&&A.dynamicDraw&&A.bind(),$&&$.bind(),Z&&Z.bind())}freshBind(l,d,y,v,A,P,D,$){const Z=l.numAttributes,Q=this.context,te=Q.gl;this.vao&&this.destroy(),this.vao=Q.createVertexArray(),Q.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=$,d.enableAttributes(te,l);for(const ge of y)ge.enableAttributes(te,l);P&&P.enableAttributes(te,l),D&&D.enableAttributes(te,l),$&&$.enableAttributes(te,l),d.bind(),d.setVertexAttribPointers(te,l,A);for(const ge of y)ge.bind(),ge.setVertexAttribPointers(te,l,A);P&&(P.bind(),P.setVertexAttribPointers(te,l,A)),v&&v.bind(),D&&(D.bind(),D.setVertexAttribPointers(te,l,A)),$&&($.bind(),$.setVertexAttribPointers(te,l,A)),Q.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ga(w){const l=[];for(let d=0;d<w.length;d++){if(w[d]===null)continue;const y=w[d].split(" ");l.push(y.pop())}return l}class Cs{constructor(l,d,y,v,A,P){const D=l.gl;this.program=D.createProgram();const $=ga(d.staticAttributes),Z=y?y.getBinderAttributes():[],Q=$.concat(Z),te=il.prelude.staticUniforms?ga(il.prelude.staticUniforms):[],ge=d.staticUniforms?ga(d.staticUniforms):[],ke=y?y.getBinderUniforms():[],Ae=te.concat(ge).concat(ke),Te=[];for(const ot of Ae)Te.indexOf(ot)<0&&Te.push(ot);const ve=y?y.defines():[];A&&ve.push("#define OVERDRAW_INSPECTOR;"),P&&ve.push("#define TERRAIN3D;");const Be=ve.concat(il.prelude.fragmentSource,d.fragmentSource).join(`
`),et=ve.concat(il.prelude.vertexSource,d.vertexSource).join(`
`),Le=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Le,Be),D.compileShader(Le),!D.getShaderParameter(Le,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Le)}`);D.attachShader(this.program,Le);const Ve=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ve,et),D.compileShader(Ve),!D.getShaderParameter(Ve,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ve)}`);D.attachShader(this.program,Ve),this.attributes={};const it={};this.numAttributes=Q.length;for(let ot=0;ot<this.numAttributes;ot++)Q[ot]&&(D.bindAttribLocation(this.program,ot,Q[ot]),this.attributes[Q[ot]]=ot);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ve),D.deleteShader(Le);for(let ot=0;ot<Te.length;ot++){const ft=Te[ot];if(ft&&!it[ft]){const Ct=D.getUniformLocation(this.program,ft);Ct&&(it[ft]=Ct)}}this.fixedUniforms=v(l,it),this.terrainUniforms=((ot,ft)=>({u_depth:new s.aG(ot,ft.u_depth),u_terrain:new s.aG(ot,ft.u_terrain),u_terrain_dim:new s.aH(ot,ft.u_terrain_dim),u_terrain_matrix:new s.aI(ot,ft.u_terrain_matrix),u_terrain_unpack:new s.aJ(ot,ft.u_terrain_unpack),u_terrain_exaggeration:new s.aH(ot,ft.u_terrain_exaggeration)}))(l,it),this.binderUniforms=y?y.getUniforms(l,it):[]}draw(l,d,y,v,A,P,D,$,Z,Q,te,ge,ke,Ae,Te,ve,Be,et){const Le=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(y),l.setStencilMode(v),l.setColorMode(A),l.setCullFace(P),$){l.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,$.depthTexture),l.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,$.texture);for(const it in this.terrainUniforms)this.terrainUniforms[it].set($[it])}for(const it in this.fixedUniforms)this.fixedUniforms[it].set(D[it]);Te&&Te.setUniforms(l,this.binderUniforms,ke,{zoom:Ae});let Ve=0;switch(d){case Le.LINES:Ve=2;break;case Le.TRIANGLES:Ve=3;break;case Le.LINE_STRIP:Ve=1}for(const it of ge.get()){const ot=it.vaos||(it.vaos={});(ot[Z]||(ot[Z]=new Vl)).bind(l,this,Q,Te?Te.getPaintVertexBuffers():[],te,it.vertexOffset,ve,Be,et),Le.drawElements(d,it.primitiveLength*Ve,Le.UNSIGNED_SHORT,it.primitiveOffset*Ve*2)}}}function ql(w,l,d){const y=1/mn(d,1,l.transform.tileZoom),v=Math.pow(2,d.tileID.overscaledZ),A=d.tileSize*Math.pow(2,l.transform.tileZoom)/v,P=A*(d.tileID.canonical.x+d.tileID.wrap*v),D=A*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[y,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}const ol=(w,l,d,y)=>{const v=l.style.light,A=v.properties.get("position"),P=[A.x,A.y,A.z],D=function(){var Z=new s.A(9);return s.A!=Float32Array&&(Z[1]=0,Z[2]=0,Z[3]=0,Z[5]=0,Z[6]=0,Z[7]=0),Z[0]=1,Z[4]=1,Z[8]=1,Z}();v.properties.get("anchor")==="viewport"&&function(Z,Q){var te=Math.sin(Q),ge=Math.cos(Q);Z[0]=ge,Z[1]=te,Z[2]=0,Z[3]=-te,Z[4]=ge,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}(D,-l.transform.angle),function(Z,Q,te){var ge=Q[0],ke=Q[1],Ae=Q[2];Z[0]=ge*te[0]+ke*te[3]+Ae*te[6],Z[1]=ge*te[1]+ke*te[4]+Ae*te[7],Z[2]=ge*te[2]+ke*te[5]+Ae*te[8]}(P,P,D);const $=v.properties.get("color");return{u_matrix:w,u_lightpos:P,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+d,u_opacity:y}},wp=(w,l,d,y,v,A,P)=>s.e(ol(w,l,d,y),ql(A,l,P),{u_height_factor:-Math.pow(2,v.overscaledZ)/P.tileSize/8}),mh=w=>({u_matrix:w}),Hl=(w,l,d,y)=>s.e(mh(w),ql(d,l,y)),xp=(w,l)=>({u_matrix:w,u_world:l}),gh=(w,l,d,y,v)=>s.e(Hl(w,l,d,y),{u_world:v}),Ap=(w,l,d,y)=>{const v=w.transform;let A,P;if(y.paint.get("circle-pitch-alignment")==="map"){const D=mn(d,1,v.zoom);A=!0,P=[D,D]}else A=!1,P=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,d,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:P}},_h=(w,l,d)=>{const y=mn(d,1,l.zoom),v=Math.pow(2,l.zoom-d.tileID.overscaledZ),A=d.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[l.pixelsToGLUnits[0]/(y*v),l.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:A}},yh=(w,l,d=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:d}),Gl=w=>({u_matrix:w}),vh=(w,l,d,y)=>({u_matrix:w,u_extrude_scale:mn(l,1,d),u_intensity:y});function bh(w,l){const d=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new s.Y(0,y/d).toLngLat().lat,new s.Y(0,(y+1)/d).toLngLat().lat]}const Wl=(w,l,d,y)=>{const v=w.transform;return{u_matrix:sl(w,l,d,y),u_ratio:1/mn(l,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},wh=(w,l,d,y,v)=>s.e(Wl(w,l,d,v),{u_image:0,u_image_height:y}),Vs=(w,l,d,y,v)=>{const A=w.transform,P=ro(l,A);return{u_matrix:sl(w,l,d,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/mn(l,1,A.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[P,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Zl=(w,l,d,y,v,A)=>{const P=w.lineAtlas,D=ro(l,w.transform),$=d.layout.get("line-cap")==="round",Z=P.getDash(y.from,$),Q=P.getDash(y.to,$),te=Z.width*v.fromScale,ge=Q.width*v.toScale;return s.e(Wl(w,l,d,A),{u_patternscale_a:[D/te,-Z.height/2],u_patternscale_b:[D/ge,-Q.height/2],u_sdfgamma:P.width/(256*Math.min(te,ge)*w.pixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:Q.y,u_mix:v.t})};function ro(w,l){return 1/mn(w,1,l.tileZoom)}function sl(w,l,d,y){return w.translatePosMatrix(y?y.posMatrix:l.tileID.posMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Xl=(w,l,d,y,v)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:d,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(P=v.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(A=v.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:al(v.paint.get("raster-hue-rotate"))};var A,P};function al(w){w*=Math.PI/180;const l=Math.sin(w),d=Math.cos(w);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const ll=(w,l,d,y,v,A,P,D,$,Z)=>{const Q=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:Q.width/Q.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+$,u_pitch_with_map:+y,u_texsize:Z,u_texture:0}},ul=(w,l,d,y,v,A,P,D,$,Z,Q)=>{const te=v.transform;return s.e(ll(w,l,d,y,v,A,P,D,$,Z),{u_gamma_scale:y?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+Q})},cl=(w,l,d,y,v,A,P,D,$,Z)=>s.e(ul(w,l,d,y,v,A,P,D,!0,$,!0),{u_texsize_icon:Z,u_texture_icon:1}),kp=(w,l,d)=>({u_matrix:w,u_opacity:l,u_color:d}),Sp=(w,l,d,y,v,A)=>s.e(function(P,D,$,Z){const Q=$.imageManager.getPattern(P.from.toString()),te=$.imageManager.getPattern(P.to.toString()),{width:ge,height:ke}=$.imageManager.getPixelSize(),Ae=Math.pow(2,Z.tileID.overscaledZ),Te=Z.tileSize*Math.pow(2,$.transform.tileZoom)/Ae,ve=Te*(Z.tileID.canonical.x+Z.tileID.wrap*Ae),Be=Te*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[ge,ke],u_mix:D.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/mn(Z,1,$.transform.tileZoom),u_pixel_coord_upper:[ve>>16,Be>>16],u_pixel_coord_lower:[65535&ve,65535&Be]}}(y,A,d,v),{u_matrix:w,u_opacity:l}),xh={fillExtrusion:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_opacity:new s.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_height_factor:new s.aH(w,l.u_height_factor),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade),u_opacity:new s.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,l.u_scale_with_map),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_matrix:new s.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_overscale_factor:new s.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_inv_matrix:new s.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_viewport_size:new s.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new s.aM(w,l.u_color),u_matrix:new s.aI(w,l.u_matrix),u_overlay:new s.aG(w,l.u_overlay),u_overlay_scale:new s.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new s.aH(w,l.u_extrude_scale),u_intensity:new s.aH(w,l.u_intensity),u_matrix:new s.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_color_ramp:new s.aG(w,l.u_color_ramp),u_opacity:new s.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_latrange:new s.aL(w,l.u_latrange),u_light:new s.aL(w,l.u_light),u_shadow:new s.aM(w,l.u_shadow),u_highlight:new s.aM(w,l.u_highlight),u_accent:new s.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_dimension:new s.aL(w,l.u_dimension),u_zoom:new s.aH(w,l.u_zoom),u_unpack:new s.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_image:new s.aG(w,l.u_image),u_image_height:new s.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texsize:new s.aL(w,l.u_texsize),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_image:new s.aG(w,l.u_image),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_patternscale_a:new s.aL(w,l.u_patternscale_a),u_patternscale_b:new s.aL(w,l.u_patternscale_b),u_sdfgamma:new s.aH(w,l.u_sdfgamma),u_image:new s.aG(w,l.u_image),u_tex_y_a:new s.aH(w,l.u_tex_y_a),u_tex_y_b:new s.aH(w,l.u_tex_y_b),u_mix:new s.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_tl_parent:new s.aL(w,l.u_tl_parent),u_scale_parent:new s.aH(w,l.u_scale_parent),u_buffer_scale:new s.aH(w,l.u_buffer_scale),u_fade_t:new s.aH(w,l.u_fade_t),u_opacity:new s.aH(w,l.u_opacity),u_image0:new s.aG(w,l.u_image0),u_image1:new s.aG(w,l.u_image1),u_brightness_low:new s.aH(w,l.u_brightness_low),u_brightness_high:new s.aH(w,l.u_brightness_high),u_saturation_factor:new s.aH(w,l.u_saturation_factor),u_contrast_factor:new s.aH(w,l.u_contrast_factor),u_spin_weights:new s.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texsize_icon:new s.aL(w,l.u_texsize_icon),u_texture:new s.aG(w,l.u_texture),u_texture_icon:new s.aG(w,l.u_texture_icon),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_color:new s.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_image:new s.aG(w,l.u_image),u_pattern_tl_a:new s.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,l.u_pattern_br_b),u_texsize:new s.aL(w,l.u_texsize),u_mix:new s.aH(w,l.u_mix),u_pattern_size_a:new s.aL(w,l.u_pattern_size_a),u_pattern_size_b:new s.aL(w,l.u_pattern_size_b),u_scale_a:new s.aH(w,l.u_scale_a),u_scale_b:new s.aH(w,l.u_scale_b),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_terrain_coords_id:new s.aH(w,l.u_terrain_coords_id),u_ele_delta:new s.aH(w,l.u_ele_delta)})};class Cp{constructor(l,d,y){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(l,d,y,v){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=v,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let y=0;y<this.attributes.length;y++){const v=d.attributes[this.attributes[y].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,d,y){for(let v=0;v<this.attributes.length;v++){const A=this.attributes[v],P=d.attributes[A.name];P!==void 0&&l.vertexAttribPointer(P,A.components,l[qs[A.type]],!1,this.itemSize,A.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ei=new WeakMap;function Ai(w){var l;if(Ei.has(w))return Ei.get(w);{const d=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Ei.set(w,d),d}}class Yn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jl extends Yn{getDefault(){return s.aO.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Yl extends Yn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class hc extends Yn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class dc extends Yn{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ql extends Yn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class pc extends Yn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class mc extends Yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class eu extends Yn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Ah extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class kh extends Yn{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class _a extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Tp extends Yn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Mp extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Ep extends Yn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Lp extends Yn{getDefault(){return s.aO.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ip extends Yn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Pp extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class gc extends Yn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class tu extends Yn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class _c extends Yn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class yc extends Yn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ya extends Yn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Sh extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Ch extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class vc extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Hs extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Th extends Yn{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class va extends Yn{getDefault(){return null}set(l){var d;if(l===this.current&&!this.dirty)return;const y=this.gl;Ai(y)?y.bindVertexArray(l):(d=y.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class ba extends Yn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Mh extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class bc extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Xn extends Yn{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class nu extends Xn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class zp extends Xn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Eh extends Xn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class fl{constructor(l,d,y,v,A){this.context=l,this.width=d,this.height=y;const P=l.gl,D=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new nu(l,D),v)this.depthAttachment=A?new Eh(l,D):new zp(l,D);else if(A)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&l.deleteRenderbuffer(y)}l.deleteFramebuffer(this.framebuffer)}}class Gr{constructor(l,d,y){this.blendFunction=l,this.blendColor=d,this.mask=y}}Gr.Replace=[1,0],Gr.disabled=new Gr(Gr.Replace,s.aO.transparent,[!1,!1,!1,!1]),Gr.unblended=new Gr(Gr.Replace,s.aO.transparent,[!0,!0,!0,!0]),Gr.alphaBlended=new Gr([1,771],s.aO.transparent,[!0,!0,!0,!0]);class Dp{constructor(l){var d,y;if(this.gl=l,this.clearColor=new Jl(this),this.clearDepth=new Yl(this),this.clearStencil=new hc(this),this.colorMask=new dc(this),this.depthMask=new Ql(this),this.stencilMask=new pc(this),this.stencilFunc=new mc(this),this.stencilOp=new eu(this),this.stencilTest=new Ah(this),this.depthRange=new kh(this),this.depthTest=new _a(this),this.depthFunc=new Tp(this),this.blend=new Mp(this),this.blendFunc=new Ep(this),this.blendColor=new Lp(this),this.blendEquation=new Ip(this),this.cullFace=new Pp(this),this.cullFaceSide=new gc(this),this.frontFace=new tu(this),this.program=new _c(this),this.activeTexture=new yc(this),this.viewport=new ya(this),this.bindFramebuffer=new Sh(this),this.bindRenderbuffer=new Ch(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new Hs(this),this.bindElementBuffer=new Th(this),this.bindVertexArray=new va(this),this.pixelStoreUnpack=new ba(this),this.pixelStoreUnpackPremultiplyAlpha=new Mh(this),this.pixelStoreUnpackFlipY=new bc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),Ai(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=l.RGBA16F)!==null&&d!==void 0?d:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(y=l.RGB16F)!==null&&y!==void 0?y:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new Cp(this,l,d)}createVertexBuffer(l,d,y){return new Kl(this,l,d,y)}createRenderbuffer(l,d,y){const v=this.gl,A=v.createRenderbuffer();return this.bindRenderbuffer.set(A),v.renderbufferStorage(v.RENDERBUFFER,l,d,y),this.bindRenderbuffer.set(null),A}createFramebuffer(l,d,y,v){return new fl(this,l,d,y,v)}clear({color:l,depth:d,stencil:y}){const v=this.gl;let A=0;l&&(A|=v.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(A|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(A|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.aD(l.blendFunction,Gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return Ai(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var d;return Ai(this.gl)?this.gl.deleteVertexArray(l):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Vn{constructor(l,d,y){this.func=l,this.mask=d,this.range=y}}Vn.ReadOnly=!1,Vn.ReadWrite=!0,Vn.disabled=new Vn(519,Vn.ReadOnly,[0,1]);const wc=7680;class wr{constructor(l,d,y,v,A,P){this.test=l,this.ref=d,this.mask=y,this.fail=v,this.depthFail=A,this.pass=P}}wr.disabled=new wr({func:519,mask:0},0,0,wc,wc,wc);class pr{constructor(l,d,y){this.enable=l,this.mode=d,this.frontFace=y}}let Gs;function ru(w,l,d,y,v,A,P){const D=w.context,$=D.gl,Z=w.useProgram("collisionBox"),Q=[];let te=0,ge=0;for(let Le=0;Le<y.length;Le++){const Ve=y[Le],it=l.getTile(Ve),ot=it.getBucket(d);if(!ot)continue;let ft=Ve.posMatrix;v[0]===0&&v[1]===0||(ft=w.translatePosMatrix(Ve.posMatrix,it,v,A));const Ct=P?ot.textCollisionBox:ot.iconCollisionBox,wt=ot.collisionCircleArray;if(wt.length>0){const Bt=s.F(),Ot=ft;s.aP(Bt,ot.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(Bt,Bt,ot.placementViewportMatrix),Q.push({circleArray:wt,circleOffset:ge,transform:Ot,invTransform:Bt,coord:Ve}),te+=wt.length/4,ge=te}Ct&&Z.draw(D,$.LINES,Vn.disabled,wr.disabled,w.colorModeForRenderPass(),pr.disabled,_h(ft,w.transform,it),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),d.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,w.transform.zoom,null,null,Ct.collisionVertexBuffer)}if(!P||!Q.length)return;const ke=w.useProgram("collisionCircle"),Ae=new s.aQ;Ae.resize(4*te),Ae._trim();let Te=0;for(const Le of Q)for(let Ve=0;Ve<Le.circleArray.length/4;Ve++){const it=4*Ve,ot=Le.circleArray[it+0],ft=Le.circleArray[it+1],Ct=Le.circleArray[it+2],wt=Le.circleArray[it+3];Ae.emplace(Te++,ot,ft,Ct,wt,0),Ae.emplace(Te++,ot,ft,Ct,wt,1),Ae.emplace(Te++,ot,ft,Ct,wt,2),Ae.emplace(Te++,ot,ft,Ct,wt,3)}(!Gs||Gs.length<2*te)&&(Gs=function(Le){const Ve=2*Le,it=new s.aS;it.resize(Ve),it._trim();for(let ot=0;ot<Ve;ot++){const ft=6*ot;it.uint16[ft+0]=4*ot+0,it.uint16[ft+1]=4*ot+1,it.uint16[ft+2]=4*ot+2,it.uint16[ft+3]=4*ot+2,it.uint16[ft+4]=4*ot+3,it.uint16[ft+5]=4*ot+0}return it}(te));const ve=D.createIndexBuffer(Gs,!0),Be=D.createVertexBuffer(Ae,s.aR.members,!0);for(const Le of Q){const Ve={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(et=w.transform).cameraToCenterDistance,u_viewport_size:[et.width,et.height]};ke.draw(D,$.TRIANGLES,Vn.disabled,wr.disabled,w.colorModeForRenderPass(),pr.disabled,Ve,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Le.coord),d.id,Be,ve,s.$.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,w.transform.zoom,null,null,null)}var et;Be.destroy(),ve.destroy()}pr.disabled=new pr(!1,1029,2305),pr.backCCW=new pr(!0,1029,2305);const xc=s.an(new Float32Array(16));function Lh(w,l,d,y,v,A){const{horizontalAlign:P,verticalAlign:D}=s.at(w);return new s.P((-(P-.5)*l/v+y[0])*A,(-(D-.5)*d/v+y[1])*A)}function iu(w,l,d,y,v,A,P,D,$,Z,Q){const te=w.text.placedSymbolArray,ge=w.text.dynamicLayoutVertexArray,ke=w.icon.dynamicLayoutVertexArray,Ae={};ge.clear();for(let Te=0;Te<te.length;Te++){const ve=te.get(Te),Be=ve.hidden||!ve.crossTileID||w.allowVerticalPlacement&&!ve.placedOrientation?null:y[ve.crossTileID];if(Be){const et=new s.P(ve.anchorX,ve.anchorY),Le=or(et,d?P:A,Q),Ve=Se(v.cameraToCenterDistance,Le.signedDistanceFromCamera);let it=s.ai(w.textSizeData,$,ve)*Ve/s.ao;d&&(it*=w.tilePixelRatio/D);const{width:ot,height:ft,anchor:Ct,textOffset:wt,textBoxScale:Bt}=Be,Ot=Lh(Ct,ot,ft,wt,Bt,it),kn=d?or(et.add(Ot),A,Q).point:Le.point.add(l?Ot.rotate(-v.angle):Ot),$t=w.allowVerticalPlacement&&ve.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let gn=0;gn<ve.numGlyphs;gn++)s.aj(ge,kn,$t);Z&&ve.associatedIconIndex>=0&&(Ae[ve.associatedIconIndex]={shiftedAnchor:kn,angle:$t})}else rt(ve.numGlyphs,ge)}if(Z){ke.clear();const Te=w.icon.placedSymbolArray;for(let ve=0;ve<Te.length;ve++){const Be=Te.get(ve);if(Be.hidden)rt(Be.numGlyphs,ke);else{const et=Ae[ve];if(et)for(let Le=0;Le<Be.numGlyphs;Le++)s.aj(ke,et.shiftedAnchor,et.angle);else rt(Be.numGlyphs,ke)}}w.icon.dynamicLayoutVertexBuffer.updateData(ke)}w.text.dynamicLayoutVertexBuffer.updateData(ge)}function ou(w,l,d){return d.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function su(w,l,d,y,v,A,P,D,$,Z,Q,te){const ge=w.context,ke=ge.gl,Ae=w.transform,Te=D==="map",ve=$==="map",Be=D!=="viewport"&&d.layout.get("symbol-placement")!=="point",et=Te&&!ve&&!Be,Le=!d.layout.get("symbol-sort-key").isConstant();let Ve=!1;const it=w.depthModeForSublayer(0,Vn.ReadOnly),ot=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ft=[];for(const Ct of y){const wt=l.getTile(Ct),Bt=wt.getBucket(d);if(!Bt)continue;const Ot=v?Bt.text:Bt.icon;if(!Ot||!Ot.segments.get().length||!Ot.hasVisibleVertices)continue;const kn=Ot.programConfigurations.get(d.id),$t=v||Bt.sdfIcons,gn=v?Bt.textSizeData:Bt.iconSizeData,Sn=ve||Ae.pitch!==0,qn=w.useProgram(ou($t,v,Bt),kn),An=s.ag(gn,Ae.zoom),Mn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ct);let Rn,jr,lr,io,oi=[0,0],Rr=null;if(v)jr=wt.glyphAtlasTexture,lr=ke.LINEAR,Rn=wt.glyphAtlasTexture.size,Bt.iconsInText&&(oi=wt.imageAtlasTexture.size,Rr=wt.imageAtlasTexture,io=Sn||w.options.rotating||w.options.zooming||gn.kind==="composite"||gn.kind==="camera"?ke.LINEAR:ke.NEAREST);else{const Yr=d.layout.get("icon-size").constantOr(0)!==1||Bt.iconsNeedLinear;jr=wt.imageAtlasTexture,lr=$t||w.options.rotating||w.options.zooming||Yr||Sn?ke.LINEAR:ke.NEAREST,Rn=wt.imageAtlasTexture.size}const si=mn(wt,1,w.transform.zoom),oo=Yt(Ct.posMatrix,ve,Te,w.transform,si),Xo=vr(Ct.posMatrix,ve,Te,w.transform,si),Is=ot&&Bt.hasTextData(),kl=d.layout.get("icon-text-fit")!=="none"&&Is&&Bt.hasIconData();if(Be){const Yr=w.style.map.terrain?(go,Qr)=>w.style.map.terrain.getElevation(Ct,go,Qr):null,Fr=d.layout.get("text-rotation-alignment")==="map";ce(Bt,Ct.posMatrix,w,v,oo,Xo,ve,Z,Fr,Yr)}const Ps=w.translatePosMatrix(Ct.posMatrix,wt,A,P),Ko=Be||v&&ot||kl?xc:oo,Jr=w.translatePosMatrix(Xo,wt,A,P,!0),Br=$t&&d.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Lr;Lr=$t?Bt.iconsInText?cl(gn.kind,An,et,ve,w,Ps,Ko,Jr,Rn,oi):ul(gn.kind,An,et,ve,w,Ps,Ko,Jr,v,Rn,!0):ll(gn.kind,An,et,ve,w,Ps,Ko,Jr,v,Rn);const mo={program:qn,buffers:Ot,uniformValues:Lr,atlasTexture:jr,atlasTextureIcon:Rr,atlasInterpolation:lr,atlasInterpolationIcon:io,isSDF:$t,hasHalo:Br};if(Le&&Bt.canOverlap){Ve=!0;const Yr=Ot.segments.get();for(const Fr of Yr)ft.push({segments:new s.$([Fr]),sortKey:Fr.sortKey,state:mo,terrainData:Mn})}else ft.push({segments:Ot.segments,sortKey:0,state:mo,terrainData:Mn})}Ve&&ft.sort((Ct,wt)=>Ct.sortKey-wt.sortKey);for(const Ct of ft){const wt=Ct.state;if(ge.activeTexture.set(ke.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,ke.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(ge.activeTexture.set(ke.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,ke.CLAMP_TO_EDGE)),wt.isSDF){const Bt=wt.uniformValues;wt.hasHalo&&(Bt.u_is_halo=1,Ih(wt.buffers,Ct.segments,d,w,wt.program,it,Q,te,Bt,Ct.terrainData)),Bt.u_is_halo=0}Ih(wt.buffers,Ct.segments,d,w,wt.program,it,Q,te,wt.uniformValues,Ct.terrainData)}}function Ih(w,l,d,y,v,A,P,D,$,Z){const Q=y.context;v.draw(Q,Q.gl.TRIANGLES,A,P,D,pr.disabled,$,Z,d.id,w.layoutVertexBuffer,w.indexBuffer,l,d.paint,y.transform.zoom,w.programConfigurations.get(d.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function au(w,l,d,y,v){if(!d||!y||!y.imageAtlas)return;const A=y.imageAtlas.patternPositions;let P=A[d.to.toString()],D=A[d.from.toString()];if(!P&&D&&(P=D),!D&&P&&(D=P),!P||!D){const $=v.getPaintProperty(l);P=A[$],D=A[$]}P&&D&&w.setConstantPatternPositions(P,D)}function Ph(w,l,d,y,v,A,P){const D=w.context.gl,$="fill-pattern",Z=d.paint.get($),Q=Z&&Z.constantOr(1),te=d.getCrossfadeParameters();let ge,ke,Ae,Te,ve;P?(ke=Q&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ge=D.LINES):(ke=Q?"fillPattern":"fill",ge=D.TRIANGLES);const Be=Z.constantOr(null);for(const et of y){const Le=l.getTile(et);if(Q&&!Le.patternsLoaded())continue;const Ve=Le.getBucket(d);if(!Ve)continue;const it=Ve.programConfigurations.get(d.id),ot=w.useProgram(ke,it),ft=w.style.map.terrain&&w.style.map.terrain.getTerrainData(et);Q&&(w.context.activeTexture.set(D.TEXTURE0),Le.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),it.updatePaintBuffers(te)),au(it,$,Be,Le,d);const Ct=ft?et:null,wt=w.translatePosMatrix(Ct?Ct.posMatrix:et.posMatrix,Le,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(P){Te=Ve.indexBuffer2,ve=Ve.segments2;const Bt=[D.drawingBufferWidth,D.drawingBufferHeight];Ae=ke==="fillOutlinePattern"&&Q?gh(wt,w,te,Le,Bt):xp(wt,Bt)}else Te=Ve.indexBuffer,ve=Ve.segments,Ae=Q?Hl(wt,w,te,Le):mh(wt);ot.draw(w.context,ge,v,w.stencilModeForClipping(et),A,pr.disabled,Ae,ft,d.id,Ve.layoutVertexBuffer,Te,ve,d.paint,w.transform.zoom,it)}}function lu(w,l,d,y,v,A,P){const D=w.context,$=D.gl,Z="fill-extrusion-pattern",Q=d.paint.get(Z),te=Q.constantOr(1),ge=d.getCrossfadeParameters(),ke=d.paint.get("fill-extrusion-opacity"),Ae=Q.constantOr(null);for(const Te of y){const ve=l.getTile(Te),Be=ve.getBucket(d);if(!Be)continue;const et=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Te),Le=Be.programConfigurations.get(d.id),Ve=w.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Le);te&&(w.context.activeTexture.set($.TEXTURE0),ve.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Le.updatePaintBuffers(ge)),au(Le,Z,Ae,ve,d);const it=w.translatePosMatrix(Te.posMatrix,ve,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ot=d.paint.get("fill-extrusion-vertical-gradient"),ft=te?wp(it,w,ot,ke,Te,ge,ve):ol(it,w,ot,ke);Ve.draw(D,D.gl.TRIANGLES,v,A,P,pr.backCCW,ft,et,d.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,d.paint,w.transform.zoom,Le,w.style.map.terrain&&Be.centroidVertexBuffer)}}function uu(w,l,d,y,v,A,P){const D=w.context,$=D.gl,Z=d.fbo;if(!Z)return;const Q=w.useProgram("hillshade"),te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);D.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Z.colorAttachment.get()),Q.draw(D,$.TRIANGLES,v,A,P,pr.disabled,((ge,ke,Ae,Te)=>{const ve=Ae.paint.get("hillshade-shadow-color"),Be=Ae.paint.get("hillshade-highlight-color"),et=Ae.paint.get("hillshade-accent-color");let Le=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Le-=ge.transform.angle);const Ve=!ge.options.moving;return{u_matrix:Te?Te.posMatrix:ge.transform.calculatePosMatrix(ke.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:bh(0,ke.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),Le],u_shadow:ve,u_highlight:Be,u_accent:et}})(w,d,y,te?l:null),te,y.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function Ac(w,l,d,y,v,A){const P=w.context,D=P.gl,$=l.dem;if($&&$.data){const Z=$.dim,Q=$.stride,te=$.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(Q),l.demTexture){const ke=l.demTexture;ke.update(te,{premultiply:!1}),ke.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else l.demTexture=new ee(P,te,D.RGBA,{premultiply:!1}),l.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);let ge=l.fbo;if(!ge){const ke=new ee(P,{width:Z,height:Z,data:null},D.RGBA);ke.bind(D.LINEAR,D.CLAMP_TO_EDGE),ge=l.fbo=P.createFramebuffer(Z,Z,!0,!1),ge.colorAttachment.set(ke.texture)}P.bindFramebuffer.set(ge.framebuffer),P.viewport.set([0,0,Z,Z]),w.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,y,v,A,pr.disabled,((ke,Ae)=>{const Te=Ae.stride,ve=s.F();return s.aN(ve,0,s.W,-s.W,0,0,1),s.H(ve,ve,[0,-s.W,0]),{u_matrix:ve,u_image:1,u_dimension:[Te,Te],u_zoom:ke.overscaledZ,u_unpack:Ae.getUnpackVector()}})(l.tileID,$),null,d.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function zh(w,l,d,y,v,A){const P=y.paint.get("raster-fade-duration");if(!A&&P>0){const D=_.now(),$=(D-w.timeAdded)/P,Z=l?(D-l.timeAdded)/P:-1,Q=d.getSource(),te=v.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),ge=!l||Math.abs(l.tileID.overscaledZ-te)>Math.abs(w.tileID.overscaledZ-te),ke=ge&&w.refreshedUponExpiration?1:s.ac(ge?$:1-Z,0,1);return w.refreshedUponExpiration&&$>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ke}:{opacity:ke,mix:0}}return{opacity:1,mix:0}}const Dh=new s.aO(1,0,0,1),cu=new s.aO(0,1,0,1),kc=new s.aO(0,0,1,1),Rp=new s.aO(1,0,1,1),Rh=new s.aO(0,1,1,1);function $r(w,l,d,y){Li(w,0,l+d/2,w.transform.width,d,y)}function Ts(w,l,d,y){Li(w,l-d/2,0,d,w.transform.height,y)}function Li(w,l,d,y,v,A){const P=w.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(l*w.pixelRatio,d*w.pixelRatio,y*w.pixelRatio,v*w.pixelRatio),P.clear({color:A}),D.disable(D.SCISSOR_TEST)}function Sc(w,l,d){const y=w.context,v=y.gl,A=d.posMatrix,P=w.useProgram("debug"),D=Vn.disabled,$=wr.disabled,Z=w.colorModeForRenderPass(),Q="$debug",te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(d);y.activeTexture.set(v.TEXTURE0);const ge=l.getTileByID(d.key).latestRawTileData,ke=Math.floor((ge&&ge.byteLength||0)/1024),Ae=l.getTile(d).tileSize,Te=512/Math.min(Ae,512)*(d.overscaledZ/w.transform.zoom)*.5;let ve=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ve+=` => ${d.overscaledZ}`),function(Be,et){Be.initDebugOverlayCanvas();const Le=Be.debugOverlayCanvas,Ve=Be.context.gl,it=Be.debugOverlayCanvas.getContext("2d");it.clearRect(0,0,Le.width,Le.height),it.shadowColor="white",it.shadowBlur=2,it.lineWidth=1.5,it.strokeStyle="white",it.textBaseline="top",it.font="bold 36px Open Sans, sans-serif",it.fillText(et,5,5),it.strokeText(et,5,5),Be.debugOverlayTexture.update(Le),Be.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(w,`${ve} ${ke}kB`),P.draw(y,v.TRIANGLES,D,$,Gr.alphaBlended,pr.disabled,yh(A,s.aO.transparent,Te),null,Q,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),P.draw(y,v.LINE_STRIP,D,$,Z,pr.disabled,yh(A,s.aO.red),te,Q,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function fu(w,l,d){const y=w.context,v=y.gl,A=w.colorModeForRenderPass(),P=new Vn(v.LEQUAL,Vn.ReadWrite,w.depthRangeFor3D),D=w.useProgram("terrain"),$=l.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,w.width,w.height]);for(const Z of d){const Q=w.renderToTexture.getTexture(Z),te=l.getTerrainData(Z.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Q.texture);const ge={u_matrix:w.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};D.draw(y,v.TRIANGLES,P,wr.disabled,A,pr.backCCW,ge,te,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}class Bh{constructor(l,d){this.context=new Dp(l),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=$n.maxUnderzooming+$n.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss}resize(l,d,y){if(this.width=Math.floor(l*y),this.height=Math.floor(d*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,d=new s.aV;d.emplaceBack(0,0),d.emplaceBack(s.W,0),d.emplaceBack(0,s.W),d.emplaceBack(s.W,s.W),this.tileExtentBuffer=l.createVertexBuffer(d,Ul.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const y=new s.aV;y.emplaceBack(0,0),y.emplaceBack(s.W,0),y.emplaceBack(0,s.W),y.emplaceBack(s.W,s.W),this.debugBuffer=l.createVertexBuffer(y,Ul.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const v=new s.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(s.W,0,s.W,0),v.emplaceBack(0,s.W,0,s.W),v.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=l.createVertexBuffer(v,ut.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const A=new s.aV;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(A,Ul.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const P=new s.aW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);const D=new s.aX;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D);const $=this.context.gl;this.stencilClearMode=new wr({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO)}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=s.F();s.aN(y,0,this.width,this.height,0,0,1),s.J(y,y,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,Vn.disabled,this.stencilClearMode,Gr.disabled,pr.disabled,Gl(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,d){if(this.currentStencilSource===l.source||!l.isTileClipped()||!d||!d.length)return;this.currentStencilSource=l.source;const y=this.context,v=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(Gr.disabled),y.setDepthMode(Vn.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);A.draw(y,v.TRIANGLES,Vn.disabled,new wr({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Gr.disabled,pr.disabled,Gl(P.posMatrix),$,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new wr({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){const d=this.context.gl;return new wr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,y=l.sort((P,D)=>D.overscaledZ-P.overscaledZ),v=y[y.length-1].overscaledZ,A=y[0].overscaledZ-v+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const P={};for(let D=0;D<A;D++)P[D+v]=new wr({func:d.GEQUAL,mask:255},D+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=A,[P,y]}return[{[v]:wr.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Gr([l.CONSTANT_COLOR,l.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gr.unblended:Gr.alphaBlended}depthModeForSublayer(l,d,y){if(!this.opaquePassEnabledForLayer())return Vn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Vn(y||this.context.gl.LEQUAL,d,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const y=this.style._order,v=this.style.sourceCaches,A={},P={},D={};for(const $ in v){const Z=v[$];Z.used&&Z.prepare(this.context),A[$]=Z.getVisibleCoordinates(),P[$]=A[$].slice().reverse(),D[$]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<y.length;$++)if(this.style._layers[y[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of y){const Z=this.style._layers[$];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const Q=P[Z.source];(Z.type==="custom"||Q.length)&&this.renderLayer(this,v[Z.source],Z,Q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[y[this.currentLayer]],Z=v[$.source],Q=A[$.source];this._renderTileClippingMasks($,Q),this.renderLayer(this,Z,$,Q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const $=this.style._layers[y[this.currentLayer]],Z=v[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($))continue;const Q=($.type==="symbol"?D:P)[$.source];this._renderTileClippingMasks($,A[$.source]),this.renderLayer(this,Z,$,Q)}if(this.options.showTileBoundaries){const $=function(Z,Q){let te=null;const ge=Object.values(Z._layers).flatMap(ve=>ve.source&&!ve.isHidden(Q)?[Z.sourceCaches[ve.source]]:[]),ke=ge.filter(ve=>ve.getSource().type==="vector"),Ae=ge.filter(ve=>ve.getSource().type!=="vector"),Te=ve=>{(!te||te.getSource().maxzoom<ve.getSource().maxzoom)&&(te=ve)};return ke.forEach(ve=>Te(ve)),te||Ae.forEach(ve=>Te(ve)),te}(this.style,this.transform.zoom);$&&function(Z,Q,te){for(let ge=0;ge<te.length;ge++)Sc(Z,Q,te[ge])}(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const Z=$.transform.padding;$r($,$.transform.height-(Z.top||0),3,Dh),$r($,Z.bottom||0,3,cu),Ts($,Z.left||0,3,kc),Ts($,$.transform.width-(Z.right||0),3,Rp);const Q=$.transform.centerPoint;(function(te,ge,ke,Ae){Li(te,ge-1,ke-10,2,20,Ae),Li(te,ge-10,ke-1,20,2,Ae)})($,Q.x,$.transform.height-Q.y,Rh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=l?!s.aY(d,y):!s.aZ(d,y)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(s.a_(d,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,P){const D=A.context,$=D.gl,Z=Gr.unblended,Q=new Vn($.LEQUAL,Vn.ReadWrite,[0,1]),te=P.getTerrainMesh(),ge=P.sourceCache.getRenderableTiles(),ke=A.useProgram("terrainDepth");D.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1});for(const Ae of ge){const Te=P.getTerrainData(Ae.tileID),ve={u_matrix:A.transform.calculatePosMatrix(Ae.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};ke.draw(D,$.TRIANGLES,Q,wr.disabled,Z,pr.backCCW,ve,Te,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,P){const D=A.context,$=D.gl,Z=Gr.unblended,Q=new Vn($.LEQUAL,Vn.ReadWrite,[0,1]),te=P.getTerrainMesh(),ge=P.getCoordsTexture(),ke=P.sourceCache.getRenderableTiles(),Ae=A.useProgram("terrainCoords");D.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1}),P.coordsIndex=[];for(const Te of ke){const ve=P.getTerrainData(Te.tileID);D.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,ge.texture);const Be={u_matrix:A.transform.calculatePosMatrix(Te.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};Ae.draw(D,$.TRIANGLES,Q,wr.disabled,Z,pr.backCCW,Be,ve,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),P.coordsIndex.push(Te.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}renderLayer(l,d,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(A,P,D,$,Z){if(A.renderPass!=="translucent")return;const Q=wr.disabled,te=A.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ge,ke,Ae,Te,ve,Be,et){const Le=ke.transform,Ve=ve==="map",it=Be==="map";for(const ot of ge){const ft=Te.getTile(ot),Ct=ft.getBucket(Ae);if(!Ct||!Ct.text||!Ct.text.segments.get().length)continue;const wt=s.ag(Ct.textSizeData,Le.zoom),Bt=mn(ft,1,ke.transform.zoom),Ot=Yt(ot.posMatrix,it,Ve,ke.transform,Bt),kn=Ae.layout.get("icon-text-fit")!=="none"&&Ct.hasIconData();if(wt){const $t=Math.pow(2,Le.zoom-ft.tileID.overscaledZ);iu(Ct,Ve,it,et,Le,Ot,ot.posMatrix,$t,wt,kn,ke.style.map.terrain?(gn,Sn)=>ke.style.map.terrain.getElevation(ot,gn,Sn):null)}}}($,A,D,P,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),Z),D.paint.get("icon-opacity").constantOr(1)!==0&&su(A,P,D,$,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Q,te),D.paint.get("text-opacity").constantOr(1)!==0&&su(A,P,D,$,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Q,te),P.map.showCollisionBoxes&&(ru(A,P,D,$,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),!0),ru(A,P,D,$,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),!1))})(l,d,y,v,this.style.placement.variableOffsets);break;case"circle":(function(A,P,D,$){if(A.renderPass!=="translucent")return;const Z=D.paint.get("circle-opacity"),Q=D.paint.get("circle-stroke-width"),te=D.paint.get("circle-stroke-opacity"),ge=!D.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(Q.constantOr(1)===0||te.constantOr(1)===0))return;const ke=A.context,Ae=ke.gl,Te=A.depthModeForSublayer(0,Vn.ReadOnly),ve=wr.disabled,Be=A.colorModeForRenderPass(),et=[];for(let Le=0;Le<$.length;Le++){const Ve=$[Le],it=P.getTile(Ve),ot=it.getBucket(D);if(!ot)continue;const ft=ot.programConfigurations.get(D.id),Ct=A.useProgram("circle",ft),wt=ot.layoutVertexBuffer,Bt=ot.indexBuffer,Ot=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ve),kn={programConfiguration:ft,program:Ct,layoutVertexBuffer:wt,indexBuffer:Bt,uniformValues:Ap(A,Ve,it,D),terrainData:Ot};if(ge){const $t=ot.segments.get();for(const gn of $t)et.push({segments:new s.$([gn]),sortKey:gn.sortKey,state:kn})}else et.push({segments:ot.segments,sortKey:0,state:kn})}ge&&et.sort((Le,Ve)=>Le.sortKey-Ve.sortKey);for(const Le of et){const{programConfiguration:Ve,program:it,layoutVertexBuffer:ot,indexBuffer:ft,uniformValues:Ct,terrainData:wt}=Le.state;it.draw(ke,Ae.TRIANGLES,Te,ve,Be,pr.disabled,Ct,wt,D.id,ot,ft,Le.segments,D.paint,A.transform.zoom,Ve)}})(l,d,y,v);break;case"heatmap":(function(A,P,D,$){if(D.paint.get("heatmap-opacity")!==0)if(A.renderPass==="offscreen"){const Z=A.context,Q=Z.gl,te=wr.disabled,ge=new Gr([Q.ONE,Q.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(ke,Ae,Te){const ve=ke.gl;ke.activeTexture.set(ve.TEXTURE1),ke.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Be=Te.heatmapFbo;if(Be)ve.bindTexture(ve.TEXTURE_2D,Be.colorAttachment.get()),ke.bindFramebuffer.set(Be.framebuffer);else{const et=ve.createTexture();ve.bindTexture(ve.TEXTURE_2D,et),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MAG_FILTER,ve.LINEAR),Be=Te.heatmapFbo=ke.createFramebuffer(Ae.width/4,Ae.height/4,!1,!1),function(Le,Ve,it,ot){var ft,Ct;const wt=Le.gl,Bt=(ft=Le.HALF_FLOAT)!==null&&ft!==void 0?ft:wt.UNSIGNED_BYTE,Ot=(Ct=Le.RGBA16F)!==null&&Ct!==void 0?Ct:wt.RGBA;wt.texImage2D(wt.TEXTURE_2D,0,Ot,Ve.width/4,Ve.height/4,0,wt.RGBA,Bt,null),ot.colorAttachment.set(it)}(ke,Ae,et,Be)}})(Z,A,D),Z.clear({color:s.aO.transparent});for(let ke=0;ke<$.length;ke++){const Ae=$[ke];if(P.hasRenderableParent(Ae))continue;const Te=P.getTile(Ae),ve=Te.getBucket(D);if(!ve)continue;const Be=ve.programConfigurations.get(D.id),et=A.useProgram("heatmap",Be),{zoom:Le}=A.transform;et.draw(Z,Q.TRIANGLES,Vn.disabled,te,ge,pr.disabled,vh(Ae.posMatrix,Te,Le,D.paint.get("heatmap-intensity")),null,D.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,D.paint,A.transform.zoom,Be)}Z.viewport.set([0,0,A.width,A.height])}else A.renderPass==="translucent"&&(A.context.setColorMode(A.colorModeForRenderPass()),function(Z,Q){const te=Z.context,ge=te.gl,ke=Q.heatmapFbo;if(!ke)return;te.activeTexture.set(ge.TEXTURE0),ge.bindTexture(ge.TEXTURE_2D,ke.colorAttachment.get()),te.activeTexture.set(ge.TEXTURE1);let Ae=Q.colorRampTexture;Ae||(Ae=Q.colorRampTexture=new ee(te,Q.colorRamp,ge.RGBA)),Ae.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(te,ge.TRIANGLES,Vn.disabled,wr.disabled,Z.colorModeForRenderPass(),pr.disabled,((Te,ve,Be,et)=>{const Le=s.F();s.aN(Le,0,Te.width,Te.height,0,0,1);const Ve=Te.context.gl;return{u_matrix:Le,u_world:[Ve.drawingBufferWidth,Ve.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ve.paint.get("heatmap-opacity")}})(Z,Q),null,Q.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,Q.paint,Z.transform.zoom)}(A,D))})(l,d,y,v);break;case"line":(function(A,P,D,$){if(A.renderPass!=="translucent")return;const Z=D.paint.get("line-opacity"),Q=D.paint.get("line-width");if(Z.constantOr(1)===0||Q.constantOr(1)===0)return;const te=A.depthModeForSublayer(0,Vn.ReadOnly),ge=A.colorModeForRenderPass(),ke=D.paint.get("line-dasharray"),Ae=D.paint.get("line-pattern"),Te=Ae.constantOr(1),ve=D.paint.get("line-gradient"),Be=D.getCrossfadeParameters(),et=Te?"linePattern":ke?"lineSDF":ve?"lineGradient":"line",Le=A.context,Ve=Le.gl;let it=!0;for(const ot of $){const ft=P.getTile(ot);if(Te&&!ft.patternsLoaded())continue;const Ct=ft.getBucket(D);if(!Ct)continue;const wt=Ct.programConfigurations.get(D.id),Bt=A.context.program.get(),Ot=A.useProgram(et,wt),kn=it||Ot.program!==Bt,$t=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ot),gn=Ae.constantOr(null);if(gn&&ft.imageAtlas){const An=ft.imageAtlas,Mn=An.patternPositions[gn.to.toString()],Rn=An.patternPositions[gn.from.toString()];Mn&&Rn&&wt.setConstantPatternPositions(Mn,Rn)}const Sn=$t?ot:null,qn=Te?Vs(A,ft,D,Be,Sn):ke?Zl(A,ft,D,ke,Be,Sn):ve?wh(A,ft,D,Ct.lineClipsArray.length,Sn):Wl(A,ft,D,Sn);if(Te)Le.activeTexture.set(Ve.TEXTURE0),ft.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),wt.updatePaintBuffers(Be);else if(ke&&(kn||A.lineAtlas.dirty))Le.activeTexture.set(Ve.TEXTURE0),A.lineAtlas.bind(Le);else if(ve){const An=Ct.gradients[D.id];let Mn=An.texture;if(D.gradientVersion!==An.version){let Rn=256;if(D.stepInterpolant){const jr=P.getSource().maxzoom,lr=ot.canonical.z===jr?Math.ceil(1<<A.transform.maxZoom-ot.canonical.z):1;Rn=s.ac(s.aT(Ct.maxLineLength/s.W*1024*lr),256,Le.maxTextureSize)}An.gradient=s.aU({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Rn,image:An.gradient||void 0,clips:Ct.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new ee(Le,An.gradient,Ve.RGBA),An.version=D.gradientVersion,Mn=An.texture}Le.activeTexture.set(Ve.TEXTURE0),Mn.bind(D.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Ot.draw(Le,Ve.TRIANGLES,te,A.stencilModeForClipping(ot),ge,pr.disabled,qn,$t,D.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,D.paint,A.transform.zoom,wt,Ct.layoutVertexBuffer2),it=!1}})(l,d,y,v);break;case"fill":(function(A,P,D,$){const Z=D.paint.get("fill-color"),Q=D.paint.get("fill-opacity");if(Q.constantOr(1)===0)return;const te=A.colorModeForRenderPass(),ge=D.paint.get("fill-pattern"),ke=A.opaquePassEnabledForLayer()&&!ge.constantOr(1)&&Z.constantOr(s.aO.transparent).a===1&&Q.constantOr(0)===1?"opaque":"translucent";if(A.renderPass===ke){const Ae=A.depthModeForSublayer(1,A.renderPass==="opaque"?Vn.ReadWrite:Vn.ReadOnly);Ph(A,P,D,$,Ae,te,!1)}if(A.renderPass==="translucent"&&D.paint.get("fill-antialias")){const Ae=A.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Vn.ReadOnly);Ph(A,P,D,$,Ae,te,!0)}})(l,d,y,v);break;case"fill-extrusion":(function(A,P,D,$){const Z=D.paint.get("fill-extrusion-opacity");if(Z!==0&&A.renderPass==="translucent"){const Q=new Vn(A.context.gl.LEQUAL,Vn.ReadWrite,A.depthRangeFor3D);if(Z!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))lu(A,P,D,$,Q,wr.disabled,Gr.disabled),lu(A,P,D,$,Q,A.stencilModeFor3D(),A.colorModeForRenderPass());else{const te=A.colorModeForRenderPass();lu(A,P,D,$,Q,wr.disabled,te)}}})(l,d,y,v);break;case"hillshade":(function(A,P,D,$){if(A.renderPass!=="offscreen"&&A.renderPass!=="translucent")return;const Z=A.context,Q=A.depthModeForSublayer(0,Vn.ReadOnly),te=A.colorModeForRenderPass(),[ge,ke]=A.renderPass==="translucent"?A.stencilConfigForOverlap($):[{},$];for(const Ae of ke){const Te=P.getTile(Ae);Te.needsHillshadePrepare!==void 0&&Te.needsHillshadePrepare&&A.renderPass==="offscreen"?Ac(A,Te,D,Q,wr.disabled,te):A.renderPass==="translucent"&&uu(A,Ae,Te,D,Q,ge[Ae.overscaledZ],te)}Z.viewport.set([0,0,A.width,A.height])})(l,d,y,v);break;case"raster":(function(A,P,D,$){if(A.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!$.length)return;const Z=A.context,Q=Z.gl,te=P.getSource(),ge=A.useProgram("raster"),ke=A.colorModeForRenderPass(),[Ae,Te]=te instanceof Gt?[{},$]:A.stencilConfigForOverlap($),ve=Te[Te.length-1].overscaledZ,Be=!A.options.moving;for(const et of Te){const Le=A.depthModeForSublayer(et.overscaledZ-ve,D.paint.get("raster-opacity")===1?Vn.ReadWrite:Vn.ReadOnly,Q.LESS),Ve=P.getTile(et);Ve.registerFadeDuration(D.paint.get("raster-fade-duration"));const it=P.findLoadedParent(et,0),ot=zh(Ve,it,P,D,A.transform,A.style.map.terrain);let ft,Ct;const wt=D.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR;Z.activeTexture.set(Q.TEXTURE0),Ve.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(Q.TEXTURE1),it?(it.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,it.tileID.overscaledZ-Ve.tileID.overscaledZ),Ct=[Ve.tileID.canonical.x*ft%1,Ve.tileID.canonical.y*ft%1]):Ve.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST);const Bt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(et),Ot=Bt?et:null,kn=Ot?Ot.posMatrix:A.transform.calculatePosMatrix(et.toUnwrapped(),Be),$t=Xl(kn,Ct||[0,0],ft||1,ot,D);te instanceof Gt?ge.draw(Z,Q.TRIANGLES,Le,wr.disabled,ke,pr.disabled,$t,Bt,D.id,te.boundsBuffer,A.quadTriangleIndexBuffer,te.boundsSegments):ge.draw(Z,Q.TRIANGLES,Le,Ae[et.overscaledZ],ke,pr.disabled,$t,Bt,D.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments)}})(l,d,y,v);break;case"background":(function(A,P,D,$){const Z=D.paint.get("background-color"),Q=D.paint.get("background-opacity");if(Q===0)return;const te=A.context,ge=te.gl,ke=A.transform,Ae=ke.tileSize,Te=D.paint.get("background-pattern");if(A.isPatternMissing(Te))return;const ve=!Te&&Z.a===1&&Q===1&&A.opaquePassEnabledForLayer()?"opaque":"translucent";if(A.renderPass!==ve)return;const Be=wr.disabled,et=A.depthModeForSublayer(0,ve==="opaque"?Vn.ReadWrite:Vn.ReadOnly),Le=A.colorModeForRenderPass(),Ve=A.useProgram(Te?"backgroundPattern":"background"),it=$||ke.coveringTiles({tileSize:Ae,terrain:A.style.map.terrain});Te&&(te.activeTexture.set(ge.TEXTURE0),A.imageManager.bind(A.context));const ot=D.getCrossfadeParameters();for(const ft of it){const Ct=$?ft.posMatrix:A.transform.calculatePosMatrix(ft.toUnwrapped()),wt=Te?Sp(Ct,Q,A,Te,{tileID:ft,tileSize:Ae},ot):kp(Ct,Q,Z),Bt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ft);Ve.draw(te,ge.TRIANGLES,et,Be,Le,pr.disabled,wt,Bt,D.id,A.tileExtentBuffer,A.quadTriangleIndexBuffer,A.tileExtentSegments)}})(l,0,y,v);break;case"custom":(function(A,P,D){const $=A.context,Z=D.implementation;if(A.renderPass==="offscreen"){const Q=Z.prerender;Q&&(A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),Q.call(Z,$.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState())}else if(A.renderPass==="translucent"){A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),$.setStencilMode(wr.disabled);const Q=Z.renderingMode==="3d"?new Vn(A.context.gl.LEQUAL,Vn.ReadWrite,A.depthRangeFor3D):A.depthModeForSublayer(0,Vn.ReadOnly);$.setDepthMode(Q),Z.render($.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState(),$.bindFramebuffer.set(null)}})(l,0,y)}}translatePosMatrix(l,d,y,v,A){if(!y[0]&&!y[1])return l;const P=A?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(P){const Z=Math.sin(P),Q=Math.cos(P);y=[y[0]*Q-y[1]*Z,y[0]*Z+y[1]*Q]}const D=[A?y[0]:mn(d,y[0],this.transform.zoom),A?y[1]:mn(d,y[1],this.transform.zoom),0],$=new Float32Array(16);return s.H($,l,D),$}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const d=this.imageManager.getPattern(l.from.toString()),y=this.imageManager.getPattern(l.to.toString());return!d||!y}useProgram(l,d){this.cache=this.cache||{};const y=l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Cs(this.context,il[l],d,xh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ee(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:d}=this.context.gl;return this.width!==l||this.height!==d}}class Ms{constructor(l,d){this.points=l,this.planes=d}static fromInvProjectionMatrix(l,d,y){const v=Math.pow(2,y),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const $=1/(D=s.af([],D,l))[3]/d*v;return s.a$(D,D,[$,$,1/D[3],$])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const $=function(ge,ke){var Ae=ke[0],Te=ke[1],ve=ke[2],Be=Ae*Ae+Te*Te+ve*ve;return Be>0&&(Be=1/Math.sqrt(Be)),ge[0]=ke[0]*Be,ge[1]=ke[1]*Be,ge[2]=ke[2]*Be,ge}([],function(ge,ke,Ae){var Te=ke[0],ve=ke[1],Be=ke[2],et=Ae[0],Le=Ae[1],Ve=Ae[2];return ge[0]=ve*Ve-Be*Le,ge[1]=Be*et-Te*Ve,ge[2]=Te*Le-ve*et,ge}([],J([],A[D[0]],A[D[1]]),J([],A[D[2]],A[D[1]]))),Z=-((Q=$)[0]*(te=A[D[1]])[0]+Q[1]*te[1]+Q[2]*te[2]);var Q,te;return $.concat(Z)});return new Ms(A,P)}}class Es{constructor(l,d){this.min=l,this.max=d,this.center=function(y,v,A){return y[0]=.5*v[0],y[1]=.5*v[1],y[2]=.5*v[2],y}([],function(y,v,A){return y[0]=v[0]+A[0],y[1]=v[1]+A[1],y[2]=v[2]+A[2],y}([],this.min,this.max))}quadrant(l){const d=[l%2==0,l<2],y=H(this.min),v=H(this.max);for(let A=0;A<d.length;A++)y[A]=d[A]?this.min[A]:this.center[A],v[A]=d[A]?this.center[A]:this.max[A];return v[2]=this.max[2],new Es(y,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let v=0;v<l.planes.length;v++){const A=l.planes[v];let P=0;for(let D=0;D<d.length;D++)s.b0(A,d[D])>=0&&P++;if(P===0)return 0;P!==d.length&&(y=!1)}if(y)return 2;for(let v=0;v<3;v++){let A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let D=0;D<l.points.length;D++){const $=l.points[D][v]-this.min[v];A=Math.min(A,$),P=Math.max(P,$)}if(P<0||A>this.max[v]-this.min[v])return 0}return 1}}class wa{constructor(l=0,d=0,y=0,v=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=y,this.right=v}interpolate(l,d,y){return d.top!=null&&l.top!=null&&(this.top=s.z.number(l.top,d.top,y)),d.bottom!=null&&l.bottom!=null&&(this.bottom=s.z.number(l.bottom,d.bottom,y)),d.left!=null&&l.left!=null&&(this.left=s.z.number(l.left,d.left,y)),d.right!=null&&l.right!=null&&(this.right=s.z.number(l.right,d.right,y)),this}getCenter(l,d){const y=s.ac((this.left+l-this.right)/2,0,l),v=s.ac((this.top+d-this.bottom)/2,0,d);return new s.P(y,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new wa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Cc=85.051129;class hu{constructor(l,d,y,v,A){this.tileSize=512,this._renderWorldCopies=A===void 0||!!A,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wa,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new hu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const d=-s.b1(l,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var y=new s.A(4);return s.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,v,A){var P=v[0],D=v[1],$=v[2],Z=v[3],Q=Math.sin(A),te=Math.cos(A);y[0]=P*te+$*Q,y[1]=D*te+Z*Q,y[2]=P*-Q+$*te,y[3]=D*-Q+Z*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=s.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,y){this._unmodified=!1,this._edgeInsets.interpolate(l,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new s.b2(0,l)];if(this._renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),A=this.pointCoordinate(new s.P(this.width,this.height)),P=this.pointCoordinate(new s.P(0,this.height)),D=Math.floor(Math.min(y.x,v.x,A.x,P.x)),$=Math.floor(Math.max(y.x,v.x,A.x,P.x)),Z=1;for(let Q=D-Z;Q<=$+Z;Q++)Q!==0&&d.push(new s.b2(Q,l))}return d}coveringTiles(l){var d,y;let v=this.coveringZoomLevel(l);const A=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),D=s.Y.fromLngLat(this.center),$=Math.pow(2,v),Z=[$*P.x,$*P.y,0],Q=[$*D.x,$*D.y,0],te=Ms.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let ge=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ge=v);const ke=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,Ae=Le=>({aabb:new Es([Le*$,0,0],[(Le+1)*$,$,0]),zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Te=[],ve=[],Be=v,et=l.reparseOverscaled?A:v;if(this._renderWorldCopies)for(let Le=1;Le<=3;Le++)Te.push(Ae(-Le)),Te.push(Ae(Le));for(Te.push(Ae(0));Te.length>0;){const Le=Te.pop(),Ve=Le.x,it=Le.y;let ot=Le.fullyVisible;if(!ot){const Ot=Le.aabb.intersects(te);if(Ot===0)continue;ot=Ot===2}const ft=l.terrain?Z:Q,Ct=Le.aabb.distanceX(ft),wt=Le.aabb.distanceY(ft),Bt=Math.max(Math.abs(Ct),Math.abs(wt));if(Le.zoom===Be||Bt>ke+(1<<Be-Le.zoom)-2&&Le.zoom>=ge){const Ot=Be-Le.zoom,kn=Z[0]-.5-(Ve<<Ot),$t=Z[1]-.5-(it<<Ot);ve.push({tileID:new s.Q(Le.zoom===Be?et:Le.zoom,Le.wrap,Le.zoom,Ve,it),distanceSq:fe([Q[0]-.5-Ve,Q[1]-.5-it]),tileDistanceToCamera:Math.sqrt(kn*kn+$t*$t)})}else for(let Ot=0;Ot<4;Ot++){const kn=(Ve<<1)+Ot%2,$t=(it<<1)+(Ot>>1),gn=Le.zoom+1;let Sn=Le.aabb.quadrant(Ot);if(l.terrain){const qn=new s.Q(gn,Le.wrap,gn,kn,$t),An=l.terrain.getMinMaxElevation(qn),Mn=(d=An.minElevation)!==null&&d!==void 0?d:this.elevation,Rn=(y=An.maxElevation)!==null&&y!==void 0?y:this.elevation;Sn=new Es([Sn.min[0],Sn.min[1],Mn],[Sn.max[0],Sn.max[1],Rn])}Te.push({aabb:Sn,zoom:gn,x:kn,y:$t,wrap:Le.wrap,fullyVisible:ot})}}return ve.sort((Le,Ve)=>Le.distanceSq-Ve.distanceSq).map(Le=>Le.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=s.ac(l.lat,-85.051129,Cc);return new s.P(s.N(l.lng)*this.worldSize,s.O(d)*this.worldSize)}unproject(l){return new s.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const d=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,l),A=l.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-A))return;const P=y+d-A,D=Math.cos(this._pitch)*this.cameraToCenterDistance/P/s.b3(1,v.lat),$=this.scaleZoom(D/this.tileSize);this._elevation=A,this._center=v,this.zoom=$}setLocationAtPoint(l,d){const y=this.pointCoordinate(d),v=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(l),P=new s.Y(A.x-(y.x-v.x),A.y-(y.y-v.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,d){return d?this.coordinatePoint(this.locationCoordinate(l),d.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,d){return this.coordinateLocation(this.pointCoordinate(l,d))}locationCoordinate(l){return s.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,d){if(d){const ge=d.pointCoordinate(l);if(ge!=null)return ge}const y=[l.x,l.y,0,1],v=[l.x,l.y,1,1];s.af(y,y,this.pixelMatrixInverse),s.af(v,v,this.pixelMatrixInverse);const A=y[3],P=v[3],D=y[1]/A,$=v[1]/P,Z=y[2]/A,Q=v[2]/P,te=Z===Q?0:(0-Z)/(Q-Z);return new s.Y(s.z.number(y[0]/A,v[0]/P,te)/this.worldSize,s.z.number(D,$,te)/this.worldSize)}coordinatePoint(l,d=0,y=this.pixelMatrix){const v=[l.x*this.worldSize,l.y*this.worldSize,d,1];return s.af(v,v,y),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Ge().extend(this.pointLocation(new s.P(0,l))).extend(this.pointLocation(new s.P(this.width,l))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Cc])}calculatePosMatrix(l,d=!1){const y=l.key,v=d?this._alignedPosMatrixCache:this._posMatrixCache;if(v[y])return v[y];const A=l.canonical,P=this.worldSize/this.zoomScale(A.z),D=A.x+Math.pow(2,A.z)*l.wrap,$=s.an(new Float64Array(16));return s.H($,$,[D*P,A.y*P,0]),s.J($,$,[P/s.W,P/s.W,1]),s.K($,d?this.alignedProjMatrix:this.projMatrix,$),v[y]=new Float32Array($),v[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,d){d=s.ac(+d,this.minZoom,this.maxZoom);const y={center:new s.M(l.lng,l.lat),zoom:d};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const Le=179.9999999999;v=[-Le,Le]}const A=this.tileSize*this.zoomScale(y.zoom);let P=0,D=A,$=0,Z=A,Q=0,te=0;const{x:ge,y:ke}=this.size;if(this.latRange){const Le=this.latRange;P=s.O(Le[1])*A,D=s.O(Le[0])*A,D-P<ke&&(Q=ke/(D-P))}v&&($=s.b1(s.N(v[0])*A,0,A),Z=s.b1(s.N(v[1])*A,0,A),Z<$&&(Z+=A),Z-$<ge&&(te=ge/(Z-$)));const{x:Ae,y:Te}=this.project.call({worldSize:A},l);let ve,Be;const et=Math.max(te||0,Q||0);if(et){const Le=new s.P(te?(Z+$)/2:Ae,Q?(D+P)/2:Te);return y.center=this.unproject.call({worldSize:A},Le).wrap(),y.zoom+=this.scaleZoom(et),y}if(this.latRange){const Le=ke/2;Te-Le<P&&(Be=P+Le),Te+Le>D&&(Be=D-Le)}if(v){const Le=($+Z)/2;let Ve=Ae;this._renderWorldCopies&&(Ve=s.b1(Ae,Le-A/2,Le+A/2));const it=ge/2;Ve-it<$&&(ve=$+it),Ve+it>Z&&(ve=Z-it)}if(ve!==void 0||Be!==void 0){const Le=new s.P(ve??Ae,Be??Te);y.center=this.unproject.call({worldSize:A},Le).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:d,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=y,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let v=s.an(new Float64Array(16));s.J(v,v,[this.width/2,-this.height/2,1]),s.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=s.an(new Float64Array(16)),s.J(v,v,[1,-1,1]),s.H(v,v,[-1,-1,0]),s.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const A=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),D=A-P*this._pixelPerMeter/Math.cos(this._pitch),$=P<0?D:A,Z=Math.PI/2+this._pitch,Q=this._fov*(.5+l.y/this.height),te=Math.sin(Q)*$/Math.sin(s.ac(Math.PI-Z-Q,.01,Math.PI-.01)),ge=this.getHorizon(),ke=2*Math.atan(ge/this.cameraToCenterDistance)*(.5+l.y/(2*ge)),Ae=Math.sin(ke)*$/Math.sin(s.ac(Math.PI-Z-ke,.01,Math.PI-.01)),Te=Math.min(te,Ae),ve=1.01*(Math.cos(Math.PI/2-this._pitch)*Te+$),Be=this.height/50;v=new Float64Array(16),s.b4(v,this._fov,this.width/this.height,Be,ve),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,s.J(v,v,[1,-1,1]),s.H(v,v,[0,0,-this.cameraToCenterDistance]),s.b5(v,v,this._pitch),s.ad(v,v,this.angle),s.H(v,v,[-d,-y,0]),this.mercatorMatrix=s.J([],v,[this.worldSize,this.worldSize,this.worldSize]),s.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,v),s.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=s.ar([],v),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,v);const et=this.width%2/2,Le=this.height%2/2,Ve=Math.cos(this.angle),it=Math.sin(this.angle),ot=d-Math.round(d)+Ve*et+it*Le,ft=y-Math.round(y)+Ve*Le+it*et,Ct=new Float64Array(v);if(s.H(Ct,Ct,[ot>.5?ot-1:ot,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=Ct,v=s.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new s.P(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}getCameraQueryGeometry(l){const d=this.getCameraPoint();if(l.length===1)return[l[0],d];{let y=d.x,v=d.y,A=d.x,P=d.y;for(const D of l)y=Math.min(y,D.x),v=Math.min(v,D.y),A=Math.max(A,D.x),P=Math.max(P,D.y);return[new s.P(y,v),new s.P(A,v),new s.P(A,P),new s.P(y,P),new s.P(y,v)]}}lngLatToCameraDepth(l,d){const y=this.locationCoordinate(l),v=[y.x*this.worldSize,y.y*this.worldSize,d,1];return s.af(v,v,this.projMatrix),v[2]/v[3]}}function Tc(w,l){let d,y=!1,v=null,A=null;const P=()=>{v=null,y&&(w.apply(A,d),v=setTimeout(P,l),y=!1)};return(...D)=>(y=!0,A=this,d=D,v||P(),v)}class Mc{constructor(l){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let y;return d.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=Tc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const d=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,v),P=Math.round(d.lng*A)/A,D=Math.round(d.lat*A)/A,$=this._map.getBearing(),Z=this._map.getPitch();let Q="";if(Q+=l?`/${P}/${D}/${y}`:`${y}/${D}/${P}`,($||Z)&&(Q+="/"+Math.round(10*$)/10),Z&&(Q+=`/${Math.round(Z)}`),this._hashName){const te=this._hashName;let ge=!1;const ke=window.location.hash.slice(1).split("&").map(Ae=>{const Te=Ae.split("=")[0];return Te===te?(ge=!0,`${Te}=${Q}`):Ae}).filter(Ae=>Ae);return ge||ke.push(`${te}=${Q}`),`#${ke.join("&")}`}return`#${Q}`}}const hl={linearity:.3,easing:s.b6(0,0,.3,1)},Ws=s.e({deceleration:2500,maxSpeed:1400},hl),Fh=s.e({deceleration:20,maxSpeed:1400},hl),Oh=s.e({deceleration:1e3,maxSpeed:360},hl),$h=s.e({deceleration:1e3,maxSpeed:90},hl);class Nh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=_.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)d.zoom+=A.zoomDelta||0,d.bearing+=A.bearingDelta||0,d.pitch+=A.pitchDelta||0,A.panDelta&&d.pan._add(A.panDelta),A.around&&(d.around=A.around),A.pinchAround&&(d.pinchAround=A.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(d.pan.mag()){const A=pl(d.pan.mag(),y,s.e({},Ws,l||{}));v.offset=d.pan.mult(A.amount/d.pan.mag()),v.center=this._map.transform.center,dl(v,A)}if(d.zoom){const A=pl(d.zoom,y,Fh);v.zoom=this._map.transform.zoom+A.amount,dl(v,A)}if(d.bearing){const A=pl(d.bearing,y,Oh);v.bearing=this._map.transform.bearing+s.ac(A.amount,-179,179),dl(v,A)}if(d.pitch){const A=pl(d.pitch,y,$h);v.pitch=this._map.transform.pitch+A.amount,dl(v,A)}if(v.zoom||v.bearing){const A=d.pinchAround===void 0?d.around:d.pinchAround;v.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function dl(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function pl(w,l,d){const{maxSpeed:y,linearity:v,deceleration:A}=d,P=s.ac(w*v/(l/1e3),-y,y),D=Math.abs(P)/(A*v);return{easing:d.easing,duration:1e3*D,amount:P*(D/2)}}class Ni extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y,v={}){const A=x.mousePos(d.getCanvas(),y),P=d.unproject(A);super(l,s.e({point:A,lngLat:P,originalEvent:y},v)),this._defaultPrevented=!1,this.target=d}}class Go extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){const v=l==="touchend"?y.changedTouches:y.touches,A=x.touchPos(d.getCanvasContainer(),v),P=A.map($=>d.unproject($)),D=A.reduce(($,Z,Q,te)=>$.add(Z.div(te.length)),new s.P(0,0));super(l,{points:A,point:D,lngLats:P,lngLat:d.unproject(D),originalEvent:y}),this._defaultPrevented=!1}}class Ec extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){super(l,{originalEvent:y}),this._defaultPrevented=!1}}class Co{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Ec(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Ni(l.type,this._map,l))}mouseup(l){this._map.fire(new Ni(l.type,this._map,l))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Ni(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ni(l.type,this._map,l))}mouseover(l){this._map.fire(new Ni(l.type,this._map,l))}mouseout(l){this._map.fire(new Ni(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Go(l.type,this._map,l))}touchmove(l){this._map.fire(new Go(l.type,this._map,l))}touchend(l){this._map.fire(new Go(l.type,this._map,l))}touchcancel(l){this._map.fire(new Go(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ni(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ni("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ni(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xa{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(s.P.convert(l),this._map.terrain)}}class To{constructor(l,d){this._map=l,this._tr=new xa(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const y=d;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=y,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(v.x,y.x),P=Math.max(v.x,y.x),D=Math.min(v.y,y.y),$=Math.max(v.y,y.y);x.setTransform(this._box,`translate(${A}px,${D}px)`),this._box.style.width=P-A+"px",this._box.style.height=$-D+"px"}mouseupWindow(l,d){if(!this._active||l.button!==0)return;const y=this._startPos,v=d;if(this.reset(),x.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new s.k(l,{originalEvent:d}))}}function Zs(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const d={};for(let y=0;y<w.length;y++)d[w[y].identifier]=l[y];return d}class Bp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(v){const A=new s.P(0,0);for(const P of v)A._add(P);return A.div(v.length)}(d),this.touches=Zs(y,d)))}touchmove(l,d,y){if(this.aborted||!this.centroid)return;const v=Zs(y,d);for(const A in this.touches){const P=v[A];(!P||P.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(l,d,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Lc{constructor(l){this.singleTap=new Bp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,d,y){this.singleTap.touchstart(l,d,y)}touchmove(l,d,y){this.singleTap.touchmove(l,d,y)}touchend(l,d,y){const v=this.singleTap.touchend(l,d,y);if(v){const A=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(v)<30;if(A&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Fp{constructor(l){this._tr=new xa(l),this._zoomIn=new Lc({numTouches:1,numTaps:2}),this._zoomOut=new Lc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,y){this._zoomIn.touchstart(l,d,y),this._zoomOut.touchstart(l,d,y)}touchmove(l,d,y){this._zoomIn.touchmove(l,d,y),this._zoomOut.touchmove(l,d,y)}touchend(l,d,y){const v=this._zoomIn.touchend(l,d,y),A=this._zoomOut.touchend(l,d,y),P=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(v)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Aa{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const d=this._moveFunction(...l);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(l,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,d){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=d.length?d[0]:d;return!this._moved&&v.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(y,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ml={0:1,2:2};class Zo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const d=x.mouseButton(l);this._eventButton=d}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(d,y){const v=ml[y];return d.buttons===void 0||(d.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class Zt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const du=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},ka=({enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:d=.8})=>{const y=new Zo({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new Aa({clickTolerance:l,move:(v,A)=>({bearingDelta:(A.x-v.x)*d}),moveStateManager:y,enable:w,assignEvents:du})},Sa=({enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:d=-.5})=>{const y=new Zo({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new Aa({clickTolerance:l,move:(v,A)=>({pitchDelta:(A.y-v.y)*d}),moveStateManager:y,enable:w,assignEvents:du})};class jh{constructor(l,d){this._clickTolerance=l.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,d,y){return this._calculateTransform(l,d,y)}touchmove(l,d,y){if(this._active&&!(y.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,d,y)}touchend(l,d,y){this._calculateTransform(l,d,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,y){y.length>0&&(this._active=!0);const v=Zs(y,d),A=new s.P(0,0),P=new s.P(0,0);let D=0;for(const Z in v){const Q=v[Z],te=this._touches[Z];te&&(A._add(Q),P._add(Q.sub(te)),D++,v[Z]=Q)}if(this._touches=v,D<this.minTouchs()||!P.mag())return;const $=P.div(D);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(D),panDelta:$}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,y){if(!this._firstTwoTouches)return;l.preventDefault();const[v,A]=this._firstTwoTouches,P=Ca(y,d,v),D=Ca(y,d,A);if(!P||!D)return;const $=this._aroundCenter?null:P.add(D).div(2);return this._move([P,D],$,l)}touchend(l,d,y){if(!this._firstTwoTouches)return;const[v,A]=this._firstTwoTouches,P=Ca(y,d,v),D=Ca(y,d,A);P&&D||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ca(w,l,d){for(let y=0;y<w.length;y++)if(w[y].identifier===d)return l[y]}function Uh(w,l){return Math.log(w/l)/Math.LN2}class Vh extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Uh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uh(this._distance,y),pinchAround:d}}}function pu(w,l){return 180*w.angleWith(l)/Math.PI}class Ic extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d,y){const v=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pu(this._vector,v),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,y=pu(l,this._startVector);return Math.abs(y)<d}}function mu(w){return Math.abs(w.y)>Math.abs(w.x)}class qh extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,d,y){super.touchstart(l,d,y),this._currentTouchCount=y.length}_start(l){this._lastPoints=l,mu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),A=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,A,y.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(l,d,y){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,A=d.mag()>=2;if(!v&&!A)return;if(!v||!A)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const P=l.y>0==d.y>0;return mu(l)&&mu(d)&&P}}const Op={panStep:100,bearingStep:15,pitchStep:10};class Ls{constructor(l){this._tr=new xa(l);const d=Op;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,y=0,v=0,A=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:D=>{const $=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:Er,zoom:d?Math.round($.zoom)+d*(l.shiftKey?2:1):$.zoom,bearing:$.bearing+y*this._bearingStep,pitch:$.pitch+v*this._pitchStep,offset:[-A*this._panStep,-P*this._panStep],center:$.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Er(w){return w*(2-w)}const gl=4.000244140625;class gu{constructor(l,d){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=l,this._tr=new xa(l),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=_.now(),v=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%gl==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=x.mousePos(this._map.getCanvas(),l),y=this._tr;this._around=d.y>y.transform.height/2-y.transform.getHorizon()?s.M.convert(this._aroundCenter?y.center:y.unproject(d)):s.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>gl?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&$!==0&&($=1/$);const Z=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Z*$))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,y=this._startZoom,v=this._easing;let A,P=!1;if(this._type==="wheel"&&y&&v){const D=Math.min((_.now()-this._lastWheelEventTime)/200,1),$=v(D);A=s.z.number(y,d,$),D<1?this._frameId||(this._frameId=!0):P=!0}else A=d,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:A-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=s.b7;if(this._prevEase){const y=this._prevEase,v=(_.now()-y.start)/y.duration,A=y.easing(v+.01)-y.easing(v),P=.27/Math.sqrt(A*A+1e-4)*.01,D=Math.sqrt(.0729-P*P);d=s.b6(P,D,.25,1)}return this._prevEase={start:_.now(),duration:l,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pc{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Hh{constructor(l){this._tr=new xa(l),this.reset()}reset(){this._active=!1}dblclick(l,d){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gh{constructor(){this._tap=new Lc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,d,y){if(!this._swipePoint)if(this._tapTime){const v=d[0],A=l.timeStamp-this._tapTime<500,P=this._tapPoint.dist(v)<30;A&&P?y.length>0&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(l,d,y)}touchmove(l,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const v=d[0],A=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,d,y)}touchend(l,d,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const v=this._tap.touchend(l,d,y);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(l,d,y){this._el=l,this._mousePan=d,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mo{constructor(l,d,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _l{constructor(l,d,y,v){this._el=l,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class sn{constructor(l,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=d,this._container.appendChild(v);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=y,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const hn=w=>w.zoom||w.drag||w.pitch||w.rotate;class _u extends s.k{}function yl(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class zc{constructor(l,d){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,A)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=v.type==="renderFrame"?void 0:v,D={needsRenderFrame:!1},$={},Z={},Q=v.touches,te=Q?this._getMapTouches(Q):void 0,ge=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),v);for(const{handlerName:Te,handler:ve,allowed:Be}of this._handlers){if(!ve.isEnabled())continue;let et;this._blockedByActive(Z,Be,Te)?ve.reset():ve[A||v.type]&&(et=ve[A||v.type](v,ge,te),this.mergeHandlerResult(D,$,et,Te,P),et&&et.needsRenderFrame&&this._triggerRenderFrame()),(et||ve.isActive())&&(Z[Te]=ve)}const ke={};for(const Te in this._previousActiveHandlers)Z[Te]||(ke[Te]=P);this._previousActiveHandlers=Z,(Object.keys(ke).length||yl(D))&&(this._changes.push([D,$,ke]),this._triggerRenderFrame()),(Object.keys(Z).length||yl(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ae}=D;Ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ae(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Nh(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,A,P]of this._listeners)x.addEventListener(v,A,v===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[l,d,y]of this._listeners)x.removeEventListener(l,d,l===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(l){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new Co(d,l));const v=d.boxZoom=new To(d,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const A=d.cooperativeGestures=new sn(d,l.cooperativeGestures);this._add("cooperativeGestures",A),l.cooperativeGestures&&A.enable();const P=new Fp(d),D=new Hh(d);d.doubleClickZoom=new Pc(D,P),this._add("tapZoom",P),this._add("clickZoom",D),l.interactive&&l.doubleClickZoom&&d.doubleClickZoom.enable();const $=new Gh;this._add("tapDragZoom",$);const Z=d.touchPitch=new qh(d);this._add("touchPitch",Z),l.interactive&&l.touchPitch&&d.touchPitch.enable(l.touchPitch);const Q=ka(l),te=Sa(l);d.dragRotate=new Mo(l,Q,te),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),l.interactive&&l.dragRotate&&d.dragRotate.enable();const ge=(({enable:et,clickTolerance:Le})=>{const Ve=new Zo({checkCorrectEvent:it=>x.mouseButton(it)===0&&!it.ctrlKey});return new Aa({clickTolerance:Le,move:(it,ot)=>({around:ot,panDelta:ot.sub(it)}),activateOnStart:!0,moveStateManager:Ve,enable:et,assignEvents:du})})(l),ke=new jh(l,d);d.dragPan=new Wh(y,ge,ke),this._add("mousePan",ge),this._add("touchPan",ke,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&d.dragPan.enable(l.dragPan);const Ae=new Ic,Te=new Vh;d.touchZoomRotate=new _l(y,Te,Ae,$),this._add("touchRotate",Ae,["touchPan","touchZoom"]),this._add("touchZoom",Te,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&d.touchZoomRotate.enable(l.touchZoomRotate);const ve=d.scrollZoom=new gu(d,()=>this._triggerRenderFrame());this._add("scrollZoom",ve,["mousePan"]),l.interactive&&l.scrollZoom&&d.scrollZoom.enable(l.scrollZoom);const Be=d.keyboard=new Ls(d);this._add("keyboard",Be),l.interactive&&l.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Wo(d))}_add(l,d,y){this._handlers.push({handlerName:l,handler:d,allowed:y}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hn(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,d,y){for(const v in l)if(v!==y&&(!d||d.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const d=[];for(const y of l)this._el.contains(y.target)&&d.push(y);return d}mergeHandlerResult(l,d,y,v,A){if(!y)return;s.e(l,y);const P={handlerName:v,originalEvent:y.originalEvent||A};y.zoomDelta!==void 0&&(d.zoom=P),y.panDelta!==void 0&&(d.drag=P),y.pitchDelta!==void 0&&(d.pitch=P),y.bearingDelta!==void 0&&(d.rotate=P)}_applyChanges(){const l={},d={},y={};for(const[v,A,P]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),s.e(d,A),s.e(y,P);this._updateMapTransform(l,d,y),this._changes=[]}_updateMapTransform(l,d,y){const v=this._map,A=v._getTransformForUpdate(),P=v.terrain;if(!(yl(l)||P&&this._terrainMovement))return this._fireEvents(d,y,!0);let{panDelta:D,zoomDelta:$,bearingDelta:Z,pitchDelta:Q,around:te,pinchAround:ge}=l;ge!==void 0&&(te=ge),v._stop(!0),te=te||v.transform.centerPoint;const ke=A.pointLocation(D?te.sub(D):te);Z&&(A.bearing+=Z),Q&&(A.pitch+=Q),$&&(A.zoom+=$),P?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?A.center=A.pointLocation(A.centerPoint.sub(D)):A.setLocationAtPoint(ke,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,A.setLocationAtPoint(ke,te),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,A.recalculateZoom(v.terrain)})):A.setLocationAtPoint(ke,te),v._applyUpdatedTransform(A),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,y,!0)}_fireEvents(l,d,y){const v=hn(this._eventsInProgress),A=hn(l),P={};for(const Q in l){const{originalEvent:te}=l[Q];this._eventsInProgress[Q]||(P[`${Q}start`]=te),this._eventsInProgress[Q]=l[Q]}!v&&A&&this._fireEvent("movestart",A.originalEvent);for(const Q in P)this._fireEvent(Q,P[Q]);A&&this._fireEvent("move",A.originalEvent);for(const Q in l){const{originalEvent:te}=l[Q];this._fireEvent(Q,te)}const D={};let $;for(const Q in this._eventsInProgress){const{handlerName:te,originalEvent:ge}=this._eventsInProgress[Q];this._handlersById[te].isActive()||(delete this._eventsInProgress[Q],$=d[te]||ge,D[`${Q}end`]=$)}for(const Q in D)this._fireEvent(Q,D[Q]);const Z=hn(this._eventsInProgress);if(y&&(v||A)&&!Z){this._updatingCamera=!0;const Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=ge=>ge!==0&&-this._bearingSnap<ge&&ge<this._bearingSnap;!Q||!Q.essential&&_.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:$})),te(this._map.getBearing())&&this._map.resetNorth()):(te(Q.bearing||this._map.getBearing())&&(Q.bearing=0),Q.freezeElevation=!0,this._map.easeTo(Q,{originalEvent:$})),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new s.k(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new _u("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ji extends s.E{constructor(l,d){super(),this._renderFrameCallback=()=>{const y=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,y){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},d),y)}panTo(l,d,y){return this.easeTo(s.e({center:l},d),y)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,y){return this.easeTo(s.e({zoom:l},d),y)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,y){return this.easeTo(s.e({bearing:l},d),y)}resetNorth(l,d){return this.rotateTo(0,s.e({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=Ge.convert(l);const y=d&&d.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),y,d)}_cameraForBoxAndBearing(l,d,y,v){const A={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const Ot=v.padding;v.padding={top:Ot,bottom:Ot,right:Ot,left:Ot}}v.padding=s.e(A,v.padding);const P=this.transform,D=P.padding,$=new Ge(l,d),Z=P.project($.getNorthWest()),Q=P.project($.getNorthEast()),te=P.project($.getSouthEast()),ge=P.project($.getSouthWest()),ke=s.b8(-y),Ae=Z.rotate(ke),Te=Q.rotate(ke),ve=te.rotate(ke),Be=ge.rotate(ke),et=new s.P(Math.max(Ae.x,Te.x,Be.x,ve.x),Math.max(Ae.y,Te.y,Be.y,ve.y)),Le=new s.P(Math.min(Ae.x,Te.x,Be.x,ve.x),Math.min(Ae.y,Te.y,Be.y,ve.y)),Ve=et.sub(Le),it=(P.width-(D.left+D.right+v.padding.left+v.padding.right))/Ve.x,ot=(P.height-(D.top+D.bottom+v.padding.top+v.padding.bottom))/Ve.y;if(ot<0||it<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ft=Math.min(P.scaleZoom(P.scale*Math.min(it,ot)),v.maxZoom),Ct=s.P.convert(v.offset),wt=new s.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(s.b8(y)),Bt=Ct.add(wt).mult(P.scale/P.zoomScale(ft));return{center:P.unproject(Z.add(te).div(2).sub(Bt)),zoom:ft,bearing:y}}fitBounds(l,d,y){return this._fitInternal(this.cameraForBounds(l,d),d,y)}fitScreenCoordinates(l,d,y,v,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(l)),this.transform.pointLocation(s.P.convert(d)),y,v),v,A)}_fitInternal(l,d,y){return l?(delete(d=s.e(l,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(l,d){this.stop();const y=this._getTransformForUpdate();let v=!1,A=!1,P=!1;return"zoom"in l&&y.zoom!==+l.zoom&&(v=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=s.M.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(A=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(P=!0,y.pitch=+l.pitch),l.padding==null||y.isPaddingEqual(l.padding)||(y.padding=l.padding),this._applyUpdatedTransform(y),this.fire(new s.k("movestart",d)).fire(new s.k("move",d)),v&&this.fire(new s.k("zoomstart",d)).fire(new s.k("zoom",d)).fire(new s.k("zoomend",d)),A&&this.fire(new s.k("rotatestart",d)).fire(new s.k("rotate",d)).fire(new s.k("rotateend",d)),P&&this.fire(new s.k("pitchstart",d)).fire(new s.k("pitch",d)).fire(new s.k("pitchend",d)),this.fire(new s.k("moveend",d))}calculateCameraOptionsFromTo(l,d,y,v=0){const A=s.Y.fromLngLat(l,d),P=s.Y.fromLngLat(y,v),D=P.x-A.x,$=P.y-A.y,Z=P.z-A.z,Q=Math.hypot(D,$,Z);if(Q===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(D,$),ge=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Q/this.transform.tileSize),ke=180*Math.atan2(D,-$)/Math.PI;let Ae=180*Math.acos(te/Q)/Math.PI;return Ae=Z<0?90-Ae:90+Ae,{center:P.toLngLat(),zoom:ge,pitch:Ae,bearing:ke}}easeTo(l,d){var y;this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.b7},l)).animate===!1||!l.essential&&_.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),A=this.getZoom(),P=this.getBearing(),D=this.getPitch(),$=this.getPadding(),Z="bearing"in l?this._normalizeBearing(l.bearing,P):P,Q="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,ge=s.P.convert(l.offset);let ke=v.centerPoint.add(ge);const Ae=v.pointLocation(ke),{center:Te,zoom:ve}=v.getConstrained(s.M.convert(l.center||Ae),(y=l.zoom)!==null&&y!==void 0?y:A);this._normalizeCenter(Te);const Be=v.project(Ae),et=v.project(Te).sub(Be),Le=v.zoomScale(ve-A);let Ve,it;l.around&&(Ve=s.M.convert(l.around),it=v.locationPoint(Ve));const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==A,this._rotating=this._rotating||P!==Z,this._pitching=this._pitching||Q!==D,this._padding=!v.isPaddingEqual(te),this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,ot),this.terrain&&this._prepareElevation(Te),this._ease(ft=>{if(this._zooming&&(v.zoom=s.z.number(A,ve,ft)),this._rotating&&(v.bearing=s.z.number(P,Z,ft)),this._pitching&&(v.pitch=s.z.number(D,Q,ft)),this._padding&&(v.interpolatePadding($,te,ft),ke=v.centerPoint.add(ge)),this.terrain&&!l.freezeElevation&&this._updateElevation(ft),Ve)v.setLocationAtPoint(Ve,it);else{const Ct=v.zoomScale(v.zoom-A),wt=ve>A?Math.min(2,Le):Math.max(.5,Le),Bt=Math.pow(wt,1-ft),Ot=v.unproject(Be.add(et.mult(ft*Bt)).mult(Ct));v.setLocationAtPoint(v.renderWorldCopies?Ot.wrap():Ot,ke)}this._applyUpdatedTransform(v),this._fireMoveEvents(d)},ft=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,ft)},l),this}_prepareEase(l,d,y={}){this._moving=!0,d||y.moving||this.fire(new s.k("movestart",l)),this._zooming&&!y.zooming&&this.fire(new s.k("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new s.k("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new s.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&d!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(y-(d-(y*l+this._elevationStart))/(1-l)),this._elevationTarget=d}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const d=l.clone(),{center:y,zoom:v,pitch:A,bearing:P,elevation:D}=this.transformCameraUpdate(d);y&&(d.center=y),v!==void 0&&(d.zoom=v),A!==void 0&&(d.pitch=A),P!==void 0&&(d.bearing=P),D!==void 0&&(d.elevation=D),this.transform.apply(d)}_fireMoveEvents(l){this.fire(new s.k("move",l)),this._zooming&&this.fire(new s.k("zoom",l)),this._rotating&&this.fire(new s.k("rotate",l)),this._pitching&&this.fire(new s.k("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const y=this._zooming,v=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.k("zoomend",l)),v&&this.fire(new s.k("rotateend",l)),A&&this.fire(new s.k("pitchend",l)),this.fire(new s.k("moveend",l))}flyTo(l,d){var y;if(!l.essential&&_.prefersReducedMotion){const qn=s.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qn,d)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},l);const v=this._getTransformForUpdate(),A=this.getZoom(),P=this.getBearing(),D=this.getPitch(),$=this.getPadding(),Z="bearing"in l?this._normalizeBearing(l.bearing,P):P,Q="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,ge=s.P.convert(l.offset);let ke=v.centerPoint.add(ge);const Ae=v.pointLocation(ke),{center:Te,zoom:ve}=v.getConstrained(s.M.convert(l.center||Ae),(y=l.zoom)!==null&&y!==void 0?y:A);this._normalizeCenter(Te);const Be=v.zoomScale(ve-A),et=v.project(Ae),Le=v.project(Te).sub(et);let Ve=l.curve;const it=Math.max(v.width,v.height),ot=it/Be,ft=Le.mag();if("minZoom"in l){const qn=s.ac(Math.min(l.minZoom,A,ve),v.minZoom,v.maxZoom),An=it/v.zoomScale(qn-A);Ve=Math.sqrt(An/ft*2)}const Ct=Ve*Ve;function wt(qn){const An=(ot*ot-it*it+(qn?-1:1)*Ct*Ct*ft*ft)/(2*(qn?ot:it)*Ct*ft);return Math.log(Math.sqrt(An*An+1)-An)}function Bt(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function Ot(qn){return(Math.exp(qn)+Math.exp(-qn))/2}const kn=wt(!1);let $t=function(qn){return Ot(kn)/Ot(kn+Ve*qn)},gn=function(qn){return it*((Ot(kn)*(Bt(An=kn+Ve*qn)/Ot(An))-Bt(kn))/Ct)/ft;var An},Sn=(wt(!0)-kn)/Ve;if(Math.abs(ft)<1e-6||!isFinite(Sn)){if(Math.abs(it-ot)<1e-6)return this.easeTo(l,d);const qn=ot<it?-1:1;Sn=Math.abs(Math.log(ot/it))/Ve,gn=function(){return 0},$t=function(An){return Math.exp(qn*Ve*An)}}return l.duration="duration"in l?+l.duration:1e3*Sn/("screenSpeed"in l?+l.screenSpeed/Ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=P!==Z,this._pitching=Q!==D,this._padding=!v.isPaddingEqual(te),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(Te),this._ease(qn=>{const An=qn*Sn,Mn=1/$t(An);v.zoom=qn===1?ve:A+v.scaleZoom(Mn),this._rotating&&(v.bearing=s.z.number(P,Z,qn)),this._pitching&&(v.pitch=s.z.number(D,Q,qn)),this._padding&&(v.interpolatePadding($,te,qn),ke=v.centerPoint.add(ge)),this.terrain&&!l.freezeElevation&&this._updateElevation(qn);const Rn=qn===1?Te:v.unproject(et.add(Le.mult(gn(An))).mult(Mn));v.setLocationAtPoint(v.renderWorldCopies?Rn.wrap():Rn,ke),this._applyUpdatedTransform(v),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,d)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,d,y){y.animate===!1||y.duration===0?(l(1),d()):(this._easeStart=_.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,d){l=s.b1(l,-180,180);const y=Math.abs(l-d);return Math.abs(l-360-d)<y&&(l-=360),Math.abs(l+360-d)<y&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const y=l.lng-d.center.lng;l.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const Dc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Eo{constructor(l=Dc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const y=this._map._getUIString(`AttributionControl.${d}`);l.title=y,l.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const d=this._map.style.sourceCaches;for(const v in d){const A=d[v];if(A.used||A.usedForTerrain){const P=A.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,A)=>v.length-A.length),l=l.filter((v,A)=>{for(let P=A+1;P<l.length;P++)if(l[P].indexOf(v)>=0)return!1;return!0});const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Zh{constructor(l={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const y=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const d=x.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const v of y)if(v.id===l)return void(v.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nr=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class Wr extends s.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,d){this.sourceCache.update(l,d),this._renderableTilesKeys=[];const y={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),s.aN(v.posMatrix,0,s.W,0,s.W,0,1),this._tiles[v.key]=new zr(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(l){for(const d in this._tiles){const y=this._tiles[d];(!l||y.tileID.equals(l)||y.tileID.isChildOf(l)||l.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const d={};for(const y of this._renderableTilesKeys){const v=this._tiles[y].tileID;if(v.canonical.equals(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16),s.aN(A.posMatrix,0,s.W,0,s.W,0,1),d[y]=A}else if(v.canonical.isChildOf(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const P=v.canonical.z-l.canonical.z,D=v.canonical.x-(v.canonical.x>>P<<P),$=v.canonical.y-(v.canonical.y>>P<<P),Z=s.W>>P;s.aN(A.posMatrix,0,Z,0,Z,0,1),s.H(A.posMatrix,A.posMatrix,[-D*Z,-$*Z,0]),d[y]=A}else if(l.canonical.isChildOf(v.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const P=l.canonical.z-v.canonical.z,D=l.canonical.x-(l.canonical.x>>P<<P),$=l.canonical.y-(l.canonical.y>>P<<P),Z=s.W>>P;s.aN(A.posMatrix,0,s.W,0,s.W,0,1),s.H(A.posMatrix,A.posMatrix,[D*Z,$*Z,0]),s.J(A.posMatrix,A.posMatrix,[1/2**P,1/2**P,0]),d[y]=A}}return d}getSourceTile(l,d){const y=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>y.maxzoom&&(v=y.maxzoom),v<y.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!A||!A.dem)&&d)for(;v>=y.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(l.scaledTo(v--).key);return A}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=l)}}class Xh{constructor(l,d,y){this.painter=l,this.sourceCache=new Wr(d),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,d,y,v=s.W){var A;if(!(d>=0&&d<v&&y>=0&&y<v))return 0;const P=this.getTerrainData(l),D=(A=P.tile)===null||A===void 0?void 0:A.dem;if(!D)return 0;const $=function(Ae,Te,ve){var Be=Te[0],et=Te[1];return Ae[0]=ve[0]*Be+ve[4]*et+ve[12],Ae[1]=ve[1]*Be+ve[5]*et+ve[13],Ae}([],[d/v*s.W,y/v*s.W],P.u_terrain_matrix),Z=[$[0]*D.dim,$[1]*D.dim],Q=Math.floor(Z[0]),te=Math.floor(Z[1]),ge=Z[0]-Q,ke=Z[1]-te;return D.get(Q,te)*(1-ge)*(1-ke)+D.get(Q+1,te)*ge*(1-ke)+D.get(Q,te+1)*(1-ge)*ke+D.get(Q+1,te+1)*ge*ke}getElevationForLngLatZoom(l,d){const{tileID:y,mercatorX:v,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(l,d);return this.getElevation(y,v%s.W,A%s.W,s.W)}getElevation(l,d,y,v=s.W){return this.getDEMElevation(l,d,y,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,A=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ee(v,A,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ee(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const d=this.sourceCache.getSourceTile(l,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const v=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new ee(v,d.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),d.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const y=d&&d+d.tileID.key+l.key;if(y&&!this._demMatrixCache[y]){const v=this.sourceCache.sourceCache._source.maxzoom;let A=l.canonical.z-d.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?A=l.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=l.canonical.x-(l.canonical.x>>A<<A),D=l.canonical.y-(l.canonical.y>>A<<A),$=s.b9(new Float64Array(16),[1/(s.W<<A),1/(s.W<<A),0]);s.H($,$,[P*s.W,D*s.W,0]),this._demMatrixCache[l.key]={matrix:$,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(l){const d=this.painter,y=d.width/devicePixelRatio,v=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ee(d.context,{width:y,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ee(d.context,{width:y,height:v,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,P=0;A<this._coordsTextureSize;A++)for(let D=0;D<this._coordsTextureSize;D++,P+=4)d[P+0]=255&D,d[P+1]=255&A,d[P+2]=D>>8<<4|A>>8,d[P+3]=0;const y=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),v=new ee(l,y,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),y=this.painter.context,v=y.gl,A=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(A,D-P-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null);const $=d[0]+(d[2]>>4<<8),Z=d[1]+((15&d[2])<<8),Q=this.coordsIndex[255-d[3]],te=Q&&this.sourceCache.getTileByID(Q);if(!te)return null;const ge=this._coordsTextureSize,ke=(1<<te.tileID.canonical.z)*ge;return new s.Y((te.tileID.canonical.x*ge+$)/ke+te.tileID.wrap,(te.tileID.canonical.y*ge+Z)/ke,this.getElevation(te.tileID,$,Z,ge))}depthAtPoint(l){const d=new Uint8Array(4),y=this.painter.context,v=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,d),y.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,d=new s.ba,y=new s.aX,v=this.meshSize,A=s.W/v,P=v*v;for(let te=0;te<=v;te++)for(let ge=0;ge<=v;ge++)d.emplaceBack(ge*A,te*A,0);for(let te=0;te<P;te+=v+1)for(let ge=0;ge<v;ge++)y.emplaceBack(ge+te,v+ge+te+1,v+ge+te+2),y.emplaceBack(ge+te,v+ge+te+2,ge+te+1);const D=d.length,$=D+2*(v+1);for(const te of[0,1])for(let ge=0;ge<=v;ge++)for(const ke of[0,1])d.emplaceBack(ge*A,te*s.W,ke);for(let te=0;te<2*v;te+=2)y.emplaceBack($+te,$+te+1,$+te+3),y.emplaceBack($+te,$+te+3,$+te+2),y.emplaceBack(D+te,D+te+3,D+te+1),y.emplaceBack(D+te,D+te+2,D+te+3);const Z=d.length,Q=Z+2*(v+1);for(const te of[0,1])for(let ge=0;ge<=v;ge++)for(const ke of[0,1])d.emplaceBack(te*s.W,ge*A,ke);for(let te=0;te<2*v;te+=2)y.emplaceBack(Z+te,Z+te+1,Z+te+3),y.emplaceBack(Z+te,Z+te+3,Z+te+2),y.emplaceBack(Q+te,Q+te+3,Q+te+1),y.emplaceBack(Q+te,Q+te+2,Q+te+3);return this._mesh={indexBuffer:l.createIndexBuffer(y),vertexBuffer:l.createVertexBuffer(d,Nr.members),segments:s.$.simpleSegment(0,0,d.length,y.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*s.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,d){var y;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,d);return(y=this.getMinMaxElevation(v).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(l){const d=this.getTerrainData(l).tile,y={minElevation:null,maxElevation:null};return d&&d.dem&&(y.minElevation=d.dem.min*this.exaggeration,y.maxElevation=d.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(l,d){const y=s.Y.fromLngLat(l.wrap()),v=(1<<d)*s.W,A=y.x*v,P=y.y*v,D=Math.floor(A/s.W),$=Math.floor(P/s.W);return{tileID:new s.Q(d,0,d,D,$),mercatorX:A,mercatorY:P}}}class bl{constructor(l,d,y){this._context=l,this._size=d,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new ee(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(y.texture),{id:l,fbo:d,texture:y,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>l.id!==d),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const cs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Rc{constructor(l,d){this.painter=l,this.terrain=d,this.pool=new bl(l.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(y=>!l._layers[y].isHidden(d)),this._coordsDescendingInv={};for(const y in l.sourceCaches){this._coordsDescendingInv[y]={};const v=l.sourceCaches[y].getVisibleCoordinates();for(const A of v){const P=this.terrain.sourceCache.getTerrainCoords(A);for(const D in P)this._coordsDescendingInv[y][D]||(this._coordsDescendingInv[y][D]=[]),this._coordsDescendingInv[y][D].push(P[D])}}this._coordsDescendingInvStr={};for(const y of l._order){const v=l._layers[y],A=v.source;if(cs[v.type]&&!this._coordsDescendingInvStr[A]){this._coordsDescendingInvStr[A]={};for(const P in this._coordsDescendingInv[A])this._coordsDescendingInvStr[A][P]=this._coordsDescendingInv[A][P].map(D=>D.key).sort().join()}}for(const y of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const A=this._coordsDescendingInvStr[v][y.tileID.key];A&&A!==y.rttCoords[v]&&(y.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const d=l.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(cs[d]&&(this._prevType&&cs[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(cs[this._prevType]||cs[d]&&v){this._prevType=d;const A=this._stacks.length-1,P=this._stacks[A]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[A]){const Z=this.pool.getObjectForId(D.rtt[A].id);if(Z.stamp===D.rtt[A].stamp){this.pool.useObject(Z);continue}}const $=this.pool.getOrCreateFreeObject();this.pool.useObject($),this.pool.stampObject($),D.rtt[A]={id:$.id,stamp:$.stamp},y.context.bindFramebuffer.set($.fbo.framebuffer),y.context.clear({color:s.aO.transparent,stencil:0}),y.currentStencilSource=void 0;for(let Z=0;Z<P.length;Z++){const Q=y.style._layers[P[Z]],te=Q.source?this._coordsDescendingInv[Q.source][D.tileID.key]:[D.tileID];y.context.viewport.set([0,0,$.fbo.width,$.fbo.height]),y._renderTileClippingMasks(Q,te),y.renderLayer(y,y.style.sourceCaches[Q.source],Q,te),Q.source&&(D.rttCoords[Q.source]=this._coordsDescendingInvStr[Q.source][D.tileID.key])}}return fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),cs[d]}return!1}}const Bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Fc=h,wl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Dc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},yu=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Oc={showCompass:!0,showZoom:!0,visualizePitch:!1};class $c{constructor(l,d,y=!1){this.mousedown=P=>{this.startMouse(s.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),x.mousePos(this.element,P)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,x.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),A=l.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=ka({clickTolerance:v,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:D,bearingDegreesPerPixelMoved:$=.8})=>{const Z=new Zt;return new Aa({clickTolerance:D,move:(Q,te)=>({bearingDelta:(te.x-Q.x)*$}),moveStateManager:Z,enable:P,assignEvents:yu})})({clickTolerance:v,enable:!0}),this.map=l,y&&(this.mousePitch=Sa({clickTolerance:A,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:D,pitchDegreesPerPixelMoved:$=-.5})=>{const Z=new Zt;return new Aa({clickTolerance:D,move:(Q,te)=>({pitchDelta:(te.y-Q.y)*$}),moveStateManager:Z,enable:P,assignEvents:yu})})({clickTolerance:A,enable:!0})),x.addEventListener(d,"mousedown",this.mousedown),x.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(d,"touchcancel",this.reset)}startMouse(l,d){this.mouseRotate.dragStart(l,d),this.mousePitch&&this.mousePitch.dragStart(l,d),x.disableDrag()}startTouch(l,d){this.touchRotate.dragStart(l,d),this.touchPitch&&this.touchPitch.dragStart(l,d),x.disableDrag()}moveMouse(l,d){const y=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,d)||{};if(v&&y.setBearing(y.getBearing()+v),this.mousePitch){const{pitchDelta:A}=this.mousePitch.dragMove(l,d)||{};A&&y.setPitch(y.getPitch()+A)}}moveTouch(l,d){const y=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,d)||{};if(v&&y.setBearing(y.getBearing()+v),this.touchPitch){const{pitchDelta:A}=this.touchPitch.dragMove(l,d)||{};A&&y.setPitch(y.getPitch()+A)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let fs;function vu(w,l,d){const y=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),l){const v=new s.M(w.lng-360,w.lat),A=new s.M(w.lng+360,w.lat),P=d.locationPoint(w).distSqr(l);d.locationPoint(v).distSqr(l)<P?w=v:d.locationPoint(A).distSqr(l)<P&&(w=A)}for(;Math.abs(w.lng-d.center.lng)>180;){const v=d.locationPoint(w);if(v.x>=0&&v.y>=0&&v.x<=d.width&&v.y<=d.height)break;w.lng>d.center.lng?w.lng-=360:w.lng+=360}return w.lng!==y.lng&&d.locationPoint(w).y>d.height/2-d.getHorizon()?w:y}const xl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bu(w,l,d){const y=w.classList;for(const v in xl)y.remove(`maplibregl-${d}-anchor-${v}`);y.add(`maplibregl-${d}-anchor-${l}`)}class Al extends s.E{constructor(l){if(super(),this._onKeyPress=d=>{const y=d.code,v=d.charCode||d.keyCode;y!=="Space"&&y!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=d=>{const y=d.originalEvent.target,v=this._element;this._popup&&(y===v||v.contains(y))&&this.togglePopup()},this._update=d=>{var y;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?vu(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${xl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${A}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const d=x.createNS("http://www.w3.org/2000/svg","svg"),y=41,v=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${y}px`),d.setAttributeNS(null,"width",`${v}px`),d.setAttributeNS(null,"viewBox",`0 0 ${v} ${y}`);const A=x.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const P=x.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const D=x.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Be of $){const et=x.createNS("http://www.w3.org/2000/svg","ellipse");et.setAttributeNS(null,"opacity","0.04"),et.setAttributeNS(null,"cx","10.5"),et.setAttributeNS(null,"cy","5.80029008"),et.setAttributeNS(null,"rx",Be.rx),et.setAttributeNS(null,"ry",Be.ry),D.appendChild(et)}const Z=x.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const Q=x.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(Q);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const ge=x.createNS("http://www.w3.org/2000/svg","path");ge.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(ge);const ke=x.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ke.setAttributeNS(null,"fill","#FFFFFF");const Ae=x.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Te=x.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#000000"),Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962");const ve=x.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#FFFFFF"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Te),Ae.appendChild(ve),P.appendChild(D),P.appendChild(Z),P.appendChild(te),P.appendChild(ke),P.appendChild(Ae),d.appendChild(P),d.setAttributeNS(null,"height",y*this._scale+"px"),d.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),bu(this._element,this._anchor,"marker"),l&&l.className)for(const d of l.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var d,y;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,A=v.terrain.depthAtPoint(this._pos),P=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,P)-A<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/v.transform._pixelPerMeter,$=Math.sin(v.getPitch()*Math.PI/180)*D,Z=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),Q=v.transform.lngLatToCameraDepth(this._lngLat,P+$)-Z>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&Q&&this._popup.remove(),this._element.style.opacity=Q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,d){return l===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const wu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ta=0,Xs=!1;const xu={maxWidth:100,unit:"metric"};function Au(w,l,d){const y=d&&d.maxWidth||100,v=w._container.clientHeight/2,A=w.unproject([0,v]),P=w.unproject([y,v]),D=A.distanceTo(P);if(d&&d.unit==="imperial"){const $=3.2808*D;$>5280?Ks(l,y,$/5280,w._getUIString("ScaleControl.Miles")):Ks(l,y,$,w._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Ks(l,y,D/1852,w._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Ks(l,y,D/1e3,w._getUIString("ScaleControl.Kilometers")):Ks(l,y,D,w._getUIString("ScaleControl.Meters"))}function Ks(w,l,d,y){const v=function(A){const P=Math.pow(10,`${Math.floor(A)}`.length-1);let D=A/P;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function($){const Z=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*Z)/Z}(D),P*D}(d);w.style.width=l*(v/d)+"px",w.innerHTML=`${v}&nbsp;${y}`}const Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ku(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-w),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const l=s.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return ku(new s.P(0,0))}const Kh=h;u.AJAXError=s.be,u.Evented=s.E,u.LngLat=s.M,u.MercatorCoordinate=s.Y,u.Point=s.P,u.addProtocol=s.bf,u.config=s.a,u.removeProtocol=s.bg,u.AttributionControl=Eo,u.BoxZoomHandler=To,u.CanvasSource=Zn,u.CooperativeGesturesHandler=sn,u.DoubleClickZoomHandler=Pc,u.DragPanHandler=Wh,u.DragRotateHandler=Mo,u.EdgeInsets=wa,u.FullscreenControl=class extends s.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var l;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=d==null?void 0:d.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Ke,u.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const d=new s.M(l.coords.longitude,l.coords.latitude),y=l.coords.accuracy,v=this._map.getBearing(),A=s.e({bearing:v},this.options.fitBoundsOptions),P=Ge.fromLngLat(d,y);this._map.fitBounds(P,A,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const d=new s.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Xs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Al({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},wu,w)}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function*(l=!1){if(fs!==void 0&&!l)return fs;if(window.navigator.permissions===void 0)return fs=!!window.navigator.geolocation,fs;try{fs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{fs=!!window.navigator.geolocation}return fs})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ta=0,Xs=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),d=w.coords;return l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),d=w.getNorthEast(),y=l.distanceTo(d),v=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ta--,Xs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ta++,Ta>1?(w={maximumAge:6e5,timeout:0},Xs=!0):(w=this.options.positionOptions,Xs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Mc,u.ImageSource=Gt,u.KeyboardHandler=Ls,u.LngLatBounds=Ge,u.LogoControl=Zh,u.Map=class extends ji{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},wl,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hu(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new vl,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Bc,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=O.addThrottleControl(()=>this.isMoving()),this._requestManager=new B(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const d=Tc(y=>{this._trackResize&&!this._removed&&this.resize(y)._update()},50);this._resizeObserver=new ResizeObserver(y=>{l?d(y):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,w),this._hash=w.hash&&new Mc(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Eo(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Zh,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=w.onAdd(this);this._controls.push(w);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,d,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,d,y)}resize(w){var l;const d=this._containerDimensions(),y=d[0],v=d[1],A=this._getClampedPixelRatio(y,v);if(this._resizeCanvas(y,v,A),this.painter.resize(y,v,A),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const $=this._getClampedPixelRatio(y,v);this._resizeCanvas(y,v,$),this.painter.resize(y,v,$)}this.transform.resize(y,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(y,v);const P=!this._moving;return P&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),P&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:d,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),A=w*v,P=l*v;return Math.min(A>d?d/A:1,P>y?y/P:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Ge.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,d){if(w==="mouseenter"||w==="mouseover"){let y=!1;return{layer:l,listener:d,delegates:{mousemove:A=>{const P=this.getLayer(l)?this.queryRenderedFeatures(A.point,{layers:[l]}):[];P.length?y||(y=!0,d.call(this,new Ni(w,this,A.originalEvent,{features:P}))):y=!1},mouseout:()=>{y=!1}}}}if(w==="mouseleave"||w==="mouseout"){let y=!1;return{layer:l,listener:d,delegates:{mousemove:P=>{(this.getLayer(l)?this.queryRenderedFeatures(P.point,{layers:[l]}):[]).length?y=!0:y&&(y=!1,d.call(this,new Ni(w,this,P.originalEvent)))},mouseout:P=>{y&&(y=!1,d.call(this,new Ni(w,this,P.originalEvent)))}}}}{const y=v=>{const A=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];A.length&&(v.features=A,d.call(this,v),delete v.features)};return{layer:l,listener:d,delegates:{[w]:y}}}}on(w,l,d){if(d===void 0)return super.on(w,l);const y=this._createDelegatedListener(w,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(w,l,d){if(d===void 0)return super.once(w,l);const y=this._createDelegatedListener(w,l,d);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(w,l,d){return d===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(y=>{const v=this._delegatedListeners[w];for(let A=0;A<v.length;A++){const P=v[A];if(P.layer===l&&P.listener===d){for(const D in P.delegates)this.off(D,P.delegates[D]);return v.splice(A,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let d;const y=w instanceof s.P||Array.isArray(w),v=y?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(y?{}:w)||{},v instanceof s.P||typeof v[0]=="number")d=[s.P.convert(v)];else{const A=s.P.convert(v[0]),P=s.P.convert(v[1]);d=[A,new s.P(P.x,A.y),P,new s.P(A.x,P.y),A]}return this.style.queryRenderedFeatures(d,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const d=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new no(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,d):this.style.loadJSON(w,l,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new no(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const d=this._requestManager.transformRequest(w,"Style");s.h(d,new AbortController).then(y=>{this._updateDiff(y.data,l)}).catch(y=>{y&&this.fire(new s.j(y))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const d in this.style._layers){const y=this.style._layers[d];y.type==="hillshade"&&y.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Xh(this.painter,l,w),this.painter.renderToTexture=new Rc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const d=w[l]._tiles;for(const y in d){const v=d[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,d={}){const{pixelRatio:y=1,sdf:v=!1,stretchX:A,stretchY:P,content:D}=d;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:Z,data:Q}=l,te=l;return this.style.addImage(w,{data:new s.R({width:$,height:Z},new Uint8Array(Q)),pixelRatio:y,stretchX:A,stretchY:P,content:D,sdf:v,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:$,height:Z,data:Q}=_.getImageData(l);this.style.addImage(w,{data:new s.R({width:$,height:Z},Q),pixelRatio:y,stretchX:A,stretchY:P,content:D,sdf:v,version:0})}}updateImage(w,l){const d=this.style.getImage(w);if(!d)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||s.b(l)?_.getImageData(l):l,{width:v,height:A,data:P}=y;if(v===void 0||A===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==d.data.width||A!==d.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(l instanceof HTMLImageElement||s.b(l));return d.data.replace(P,D),this.style.updateImage(w,d),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return O.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,d){return this.style.setLayerZoomRange(w,l,d),this._update(!0)}setFilter(w,l,d={}){return this.style.setFilter(w,l,d),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,d,y={}){return this.style.setPaintProperty(w,l,d,y),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,d,y={}){return this.style.setLayoutProperty(w,l,d,y),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,d,y=>{y||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,d=>{d||this._update(!0)}),this}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),y=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],y);const v=this._controlContainer=x.create("div","maplibregl-control-container",w),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{A[P]=x.create("div",`maplibregl-ctrl-${P} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,d){this._canvas.width=Math.floor(d*w),this._canvas.height=Math.floor(d*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{l={requestedAttributes:w},y&&(l.statusMessage=y.statusMessage,l.type=y.type)},{once:!0});const d=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!d){const y="Failed to initialize WebGL";throw l?(l.message=y,new Error(JSON.stringify(l))):new Error(y)}this.painter=new Bh(d,this.transform),C.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,A=_.now();this.style.zoomHistory.update(v,A);const P=new s.a8(v,{now:A,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=P.crossFadingFactor();D===1&&D===this._crossFadingFactor||(d=!0,this._crossFadingFactor=D),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),O.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Fc}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Ni,u.MapTouchEvent=Go,u.MapWheelEvent=Ec,u.Marker=Al,u.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),d=l===this._map.getMaxZoom(),y=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,d)=>{const y=this._map._getUIString(`NavigationControl.${d}`);l.title=y,l.setAttribute("aria-label",y)},this.options=s.e({},Oc,w),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $c(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const d=x.create("button",w,this._container);return d.type="button",d.addEventListener("click",l),d}},u.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?vu(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!l)return;const y=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const A=ku(this.options.offset);if(!v){const D=this._container.offsetWidth,$=this._container.offsetHeight;let Z;Z=y.y+A.bottom.y<$?["top"]:y.y>this._map.transform.height-$?["bottom"]:[],y.x<D/2?Z.push("left"):y.x>this._map.transform.width-D/2&&Z.push("right"),v=Z.length===0?"bottom":Z.join("-")}let P=y.add(A[v]);this.options.subpixelPositioning||(P=P.round()),x.setTransform(this._container,`${xl[v]} translate(${P.x}px,${P.y}px)`),bu(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Nc),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=w;y=d.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(jc);w&&w.focus()}},u.RasterDEMTileSource=cn,u.RasterTileSource=de,u.ScaleControl=class{constructor(w){this._onMove=()=>{Au(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,Au(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xu),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=gu,u.Style=no,u.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=qh,u.TwoFingersTouchRotateHandler=Ic,u.TwoFingersTouchZoomHandler=Vh,u.TwoFingersTouchZoomRotateHandler=_l,u.VectorTileSource=nt,u.VideoSource=Jn,u.addSourceType=(w,l)=>s._(void 0,void 0,void 0,function*(){if(Cr(w))throw new Error(`A source type called "${w}" already exists.`);((d,y)=>{fr[d]=y})(w,l)}),u.clearPrewarmedResources=function(){const w=gt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(pt),gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return xt().getRTLTextPluginStatus()},u.getVersion=function(){return Kh},u.getWorkerCount=function(){return _t.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(w){return nn().broadcast("IS",w)},u.prewarm=function(){jt().acquire(pt)},u.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},u.setRTLTextPlugin=function(w,l){return xt().setRTLTextPlugin(w,l)},u.setWorkerCount=function(w){_t.workerCount=w},u.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(sw);var ua=sw.exports;const ni=ow(ua),vk=YA({__proto__:null,default:ni},[ua]);let an;const lw=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&lw.decode();let wf=null;function Ef(){return(wf===null||wf.byteLength===0)&&(wf=new Uint8Array(an.memory.buffer)),wf}function Qo(r,e){return r=r>>>0,lw.decode(Ef().subarray(r,r+e))}const oa=new Array(128).fill(void 0);oa.push(void 0,null,!0,!1);let Lf=oa.length;function ti(r){Lf===oa.length&&oa.push(oa.length+1);const e=Lf;return Lf=oa[e],oa[e]=r,e}function Hn(r){return oa[r]}function bk(r){r<132||(oa[r]=Lf,Lf=r)}function Hu(r){const e=Hn(r);return bk(r),e}function Cm(r){return r==null}let xf=null;function wk(){return(xf===null||xf.byteLength===0)&&(xf=new Float64Array(an.memory.buffer)),xf}let Af=null;function er(){return(Af===null||Af.byteLength===0)&&(Af=new Int32Array(an.memory.buffer)),Af}let Oa=0;const Pd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},xk=typeof Pd.encodeInto=="function"?function(r,e){return Pd.encodeInto(r,e)}:function(r,e){const t=Pd.encode(r);return e.set(t),{read:r.length,written:t.length}};function bd(r,e,t){if(t===void 0){const s=Pd.encode(r),h=e(s.length,1)>>>0;return Ef().subarray(h,h+s.length).set(s),Oa=s.length,h}let n=r.length,i=e(n,1)>>>0;const o=Ef();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Ef().subarray(i+u,i+n),h=xk(r,s);u+=h.written}return Oa=u,i}function Gm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Gm(r[0]));for(let u=1;u<i;u++)o+=", "+Gm(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Ak(r,e){const t=e(r.length*1,1)>>>0;return Ef().set(r,t/1),Oa=r.length,t}function Tm(r,e){try{return r.apply(this,e)}catch(t){an.__wbindgen_exn_store(ti(t))}}class Hd{static __wrap(e){e=e>>>0;const t=Object.create(Hd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();an.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=an.__wbindgen_add_to_stack_pointer(-16),u=Ak(e,an.__wbindgen_malloc),s=Oa;an.jsroutesnapper_new(o,u,s);var t=er()[o/4+0],n=er()[o/4+1],i=er()[o/4+2];if(i)throw Hu(n);return Hd.__wrap(t)}finally{an.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){an.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ti(e))}setAreaMode(){an.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=er()[o/4+0],i=er()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=er()[n/4+0],t=er()[n/4+1];let i;return e!==0&&(i=Qo(e,t).slice(),an.__wbindgen_free(e,t*1)),i}finally{an.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=er()[o/4+0],i=er()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}toggleSnapMode(){an.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return an.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){an.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return an.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return an.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){an.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_editExisting(i,this.__wbg_ptr,ti(e));var t=er()[i/4+0],n=er()[i/4+1];if(n)throw Hu(t)}finally{an.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=er()[o/4+0],i=er()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=er()[o/4+0],i=er()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,ti(e));var i=er()[g/4+0],o=er()[g/4+1],u=er()[g/4+2],s=er()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Hu(u);return t=h,n=p,Qo(h,p)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){an.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){an.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,ti(e));var i=er()[g/4+0],o=er()[g/4+1],u=er()[g/4+2],s=er()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Hu(u);return t=h,n=p,Qo(h,p)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const _=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_getExtraNodes(_,this.__wbg_ptr,ti(e),ti(t));var o=er()[_/4+0],u=er()[_/4+1],s=er()[_/4+2],h=er()[_/4+3],p=o,g=u;if(h)throw p=0,g=0,Hu(s);return n=p,i=g,Qo(p,g)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(n,i,1)}}}async function kk(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Sk(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Qo(e,t);return ti(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Hu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Qo(e,t));return ti(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Hn(t),i=typeof n=="number"?n:void 0;wk()[e/8+1]=Cm(i)?0:i,er()[e/4+0]=!Cm(i)},r.wbg.__wbindgen_is_object=function(e){const t=Hn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Hn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Hn(e)in Hn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Hn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Hn(e)==Hn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Hn(t),i=typeof n=="string"?n:void 0;var o=Cm(i)?0:bd(i,an.__wbindgen_malloc,an.__wbindgen_realloc),u=Oa;er()[e/4+1]=u,er()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Hn(t)),i=bd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Oa;er()[e/4+1]=o,er()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Hn(e);return ti(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Hn(e)[Hn(t)];return ti(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ti(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Hn(t).stack,i=bd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Oa;er()[e/4+1]=o,er()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Qo(e,t))}finally{an.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Hn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Hn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Hn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Hn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Hn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Hn(e)[t>>>0];return ti(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Hn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Hn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Hn(e).next;return ti(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Tm(function(e){const t=Hn(e).next();return ti(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Hn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Hn(e).value;return ti(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ti(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Tm(function(e,t){const n=Reflect.get(Hn(e),Hn(t));return ti(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Tm(function(e,t){const n=Hn(e).call(Hn(t));return ti(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Hn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Hn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Hn(e).buffer;return ti(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Hn(e));return ti(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Hn(e).set(Hn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Hn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Hn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Gm(Hn(t)),i=bd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Oa;er()[e/4+1]=o,er()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Qo(e,t))},r.wbg.__wbindgen_memory=function(){const e=an.memory;return ti(e)},r}function Ck(r,e){return an=r.exports,uw.__wbindgen_wasm_module=e,xf=null,Af=null,wf=null,an}async function uw(r){if(an!==void 0)return an;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Sk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await kk(await r,e);return Ck(t,n)}var Zi=63710088e-1,Fg={centimeters:Zi*100,centimetres:Zi*100,degrees:Zi/111325,feet:Zi*3.28084,inches:Zi*39.37,kilometers:Zi/1e3,kilometres:Zi/1e3,meters:Zi,metres:Zi,miles:Zi/1609.344,millimeters:Zi*1e3,millimetres:Zi*1e3,nauticalmiles:Zi/1852,radians:1,yards:Zi*1.0936},Tk={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Zi,yards:1.0936133},Wm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ss(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Mk(r,e,t){switch(r){case"Point":return yo(e).geometry;case"LineString":return ts(e).geometry;case"Polygon":return Og(e).geometry;case"MultiPoint":return fw(e).geometry;case"MultiLineString":return cw(e).geometry;case"MultiPolygon":return hw(e).geometry;default:throw new Error(r+" is invalid")}}function yo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gd(r[0])||!Gd(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ss(n,e,t)}function Ek(r,e,t){return t===void 0&&(t={}),Rl(r.map(function(n){return yo(n,e)}),t)}function Og(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return ss(s,e,t)}function Lk(r,e,t){return t===void 0&&(t={}),Rl(r.map(function(n){return Og(n,e)}),t)}function ts(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ss(n,e,t)}function Ik(r,e,t){return t===void 0&&(t={}),Rl(r.map(function(n){return ts(n,e)}),t)}function Rl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function cw(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ss(n,e,t)}function fw(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ss(n,e,t)}function hw(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ss(n,e,t)}function Pk(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ss(n,e,t)}function zk(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function $g(r,e){e===void 0&&(e="kilometers");var t=Fg[e];if(!t)throw new Error(e+" units is invalid");return r*t}function sp(r,e){e===void 0&&(e="kilometers");var t=Fg[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Dk(r,e){return Uf(sp(r,e))}function Rk(r){var e=r%360;return e<0&&(e+=360),e}function Uf(r){var e=r%(2*Math.PI);return e*180/Math.PI}function ns(r){var e=r%360;return e*Math.PI/180}function Bk(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return $g(sp(r,e),t)}function Fk(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Wm[e];if(!n)throw new Error("invalid original units");var i=Wm[t];if(!i)throw new Error("invalid final units");return r/n*i}function Gd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ng(r){return!!r&&r.constructor===Object}function Ok(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Gd(e))throw new Error("bbox must only contain numbers")})}function $k(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Nk=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Wm,bearingToAzimuth:Rk,convertArea:Fk,convertLength:Bk,degreesToRadians:ns,earthRadius:Zi,factors:Fg,feature:ss,featureCollection:Rl,geometry:Mk,geometryCollection:Pk,isNumber:Gd,isObject:Ng,lengthToDegrees:Dk,lengthToRadians:sp,lineString:ts,lineStrings:Ik,multiLineString:cw,multiPoint:fw,multiPolygon:hw,point:yo,points:Ek,polygon:Og,polygons:Lk,radiansToDegrees:Uf,radiansToLength:$g,round:zk,unitsFactors:Tk,validateBBox:Ok,validateId:$k},Symbol.toStringTag,{value:"Module"}));function Vf(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function th(r,e,t){if(r!==null)for(var n,i,o,u,s,h,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",z=C==="Feature",L=T?r.features.length:1,E=0;E<L;E++){p=T?r.features[E].geometry:z?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var O=0,B=0;if(u=x?p.geometries[I]:p,u!==null){h=u.coordinates;var K=u.type;switch(g=t&&(K==="Polygon"||K==="MultiPolygon")?1:0,K){case null:break;case"Point":if(e(h,_,E,O,B)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(e(h[n],_,E,O,B)===!1)return!1;_++,K==="MultiPoint"&&O++}K==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(i=0;i<h[n].length-g;i++){if(e(h[n][i],_,E,O,B)===!1)return!1;_++}K==="MultiLineString"&&O++,K==="Polygon"&&B++}K==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(B=0,i=0;i<h[n].length;i++){for(o=0;o<h[n][i].length-g;o++){if(e(h[n][i][o],_,E,O,B)===!1)return!1;_++}B++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(th(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function jk(r,e,t,n){var i=t;return th(r,function(o,u,s,h,p){u===0&&t===void 0?i=o:i=e(i,o,u,s,h,p)},n),i}function dw(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Uk(r,e,t){var n=t;return dw(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Wd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Vk(r,e,t){var n=t;return Wd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function qk(r){var e=[];return th(r,function(t){e.push(t)}),e}function jg(r,e){var t,n,i,o,u,s,h,p,g,_,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",z=C?r.features.length:1;for(t=0;t<z;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,_=C?r.features[t].id:T?r.id:void 0,h=s?s.type==="GeometryCollection":!1,u=h?s.geometries.length:1,i=0;i<u;i++){if(o=h?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function Hk(r,e,t){var n=t;return jg(r,function(i,o,u,s,h){o===0&&t===void 0?n=i:n=e(n,i,o,u,s,h)}),n}function uc(r,e){jg(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(ss(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var h;switch(s){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:h,coordinates:g};if(e(ss(_,i),n,p)===!1)return!1}})}function Gk(r,e,t){var n=t;return uc(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function pw(r,e){uc(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var s,h=0,p=0,g=0;if(th(t,function(_,x,C,T,z){if(s===void 0||n>h||T>p||z>g){s=_,h=n,p=T,g=z,o=0;return}var L=ts([s,_],t.properties);if(e(L,n,i,z,o)===!1)return!1;o++,s=_})===!1)return!1}}})}function Wk(r,e,t){var n=t,i=!1;return pw(r,function(o,u,s,h,p){i===!1&&t===void 0?n=o:n=e(n,o,u,s,h,p),i=!0}),n}function mw(r,e){if(!r)throw new Error("geojson is required");uc(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<u.length;s++)if(e(ts(u[s],t.properties),n,i,s)===!1)return!1;break}}})}function Zk(r,e,t){var n=t;return mw(r,function(i,o,u,s){o===0&&t===void 0?n=i:n=e(n,i,o,u,s)}),n}function Xk(r,e){if(e=e||{},!Ng(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var h=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=h.length+o-1),ts([h[o],h[o+1]],u,e);case"Polygon":return i<0&&(i=h.length+i),o<0&&(o=h[i].length+o-1),ts([h[i][o],h[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=h.length+n),o<0&&(o=h[n].length+o-1),ts([h[n][o],h[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=h.length+n),i<0&&(i=h[n].length+i),o<0&&(o=h[n][i].length-o-1),ts([h[n][i][o],h[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function Kk(r,e){if(e=e||{},!Ng(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var h=s.coordinates;switch(s.type){case"Point":return yo(h,u,e);case"MultiPoint":return n<0&&(n=h.length+n),yo(h[n],u,e);case"LineString":return o<0&&(o=h.length+o),yo(h[o],u,e);case"Polygon":return i<0&&(i=h.length+i),o<0&&(o=h[i].length+o),yo(h[i][o],u,e);case"MultiLineString":return n<0&&(n=h.length+n),o<0&&(o=h[n].length+o),yo(h[n][o],u,e);case"MultiPolygon":return n<0&&(n=h.length+n),i<0&&(i=h[n].length+i),o<0&&(o=h[n][i].length-o),yo(h[n][i][o],u,e)}throw new Error("geojson is invalid")}const Jk=Object.freeze(Object.defineProperty({__proto__:null,coordAll:qk,coordEach:th,coordReduce:jk,featureEach:Wd,featureReduce:Vk,findPoint:Kk,findSegment:Xk,flattenEach:uc,flattenReduce:Gk,geomEach:jg,geomReduce:Hk,lineEach:mw,lineReduce:Zk,propEach:dw,propReduce:Uk,segmentEach:pw,segmentReduce:Wk},Symbol.toStringTag,{value:"Module"}));function gw(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Yk(r,e);var n=Vf(r),i=Vf(e),o=ns(n[0]),u=ns(i[0]),s=ns(n[1]),h=ns(i[1]),p=Math.sin(u-o)*Math.cos(h),g=Math.cos(s)*Math.sin(h)-Math.sin(s)*Math.cos(h)*Math.cos(u-o);return Uf(Math.atan2(p,g))}function Yk(r,e){var t=gw(e,r);return t=(t+180)%360,t}function ff(r,e,t){t===void 0&&(t={});var n=Vf(r),i=Vf(e),o=ns(i[1]-n[1]),u=ns(i[0]-n[0]),s=ns(n[1]),h=ns(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(h);return $g(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function W0(r,e,t,n){n===void 0&&(n={});var i=Vf(r),o=ns(i[0]),u=ns(i[1]),s=ns(t),h=sp(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(h)+Math.cos(u)*Math.sin(h)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(h)*Math.cos(u),Math.cos(h)-Math.sin(u)*Math.sin(p)),_=Uf(g),x=Uf(p);return yo([_,x],n.properties)}function Z0(r){if(!r)throw new Error("geojson is required");var e=[];return uc(r,function(t){Qk(t,e)}),Rl(e)}function Qk(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=tc(n);break;case"LineString":t=[tc(n)]}t.forEach(function(i){var o=e3(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function e3(r,e){var t=[];return r.reduce(function(n,i){var o=ts([n,i],e);return o.bbox=t3(n,i),t.push(o),i}),t}function t3(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,s=n<o?n:o,h=t>i?t:i,p=n>o?n:o;return[u,s,h,p]}var Ug={exports:{}},_w={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(iw,function(){function t(I,O,B,K,H){(function q(J,fe,Ee,ee,oe){for(;ee>Ee;){if(ee-Ee>600){var xe=ee-Ee+1,me=fe-Ee+1,tt=Math.log(xe),Ue=.5*Math.exp(2*tt/3),ze=.5*Math.sqrt(tt*Ue*(xe-Ue)/xe)*(me-xe/2<0?-1:1),Ie=Math.max(Ee,Math.floor(fe-me*Ue/xe+ze)),ct=Math.min(ee,Math.floor(fe+(xe-me)*Ue/xe+ze));q(J,fe,Ie,ct,oe)}var Xe=J[fe],lt=Ee,pt=ee;for(n(J,Ee,fe),oe(J[ee],Xe)>0&&n(J,Ee,ee);lt<pt;){for(n(J,lt,pt),lt++,pt--;oe(J[lt],Xe)<0;)lt++;for(;oe(J[pt],Xe)>0;)pt--}oe(J[Ee],Xe)===0?n(J,Ee,pt):n(J,++pt,ee),pt<=fe&&(Ee=pt+1),fe<=pt&&(ee=pt-1)}})(I,O,B||0,K||I.length-1,H||i)}function n(I,O,B){var K=I[O];I[O]=I[B],I[B]=K}function i(I,O){return I<O?-1:I>O?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(I,O,B){if(!B)return O.indexOf(I);for(var K=0;K<O.length;K++)if(B(I,O[K]))return K;return-1}function s(I,O){h(I,0,I.children.length,O,I)}function h(I,O,B,K,H){H||(H=L(null)),H.minX=1/0,H.minY=1/0,H.maxX=-1/0,H.maxY=-1/0;for(var q=O;q<B;q++){var J=I.children[q];p(H,I.leaf?K(J):J)}return H}function p(I,O){return I.minX=Math.min(I.minX,O.minX),I.minY=Math.min(I.minY,O.minY),I.maxX=Math.max(I.maxX,O.maxX),I.maxY=Math.max(I.maxY,O.maxY),I}function g(I,O){return I.minX-O.minX}function _(I,O){return I.minY-O.minY}function x(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function C(I){return I.maxX-I.minX+(I.maxY-I.minY)}function T(I,O){return I.minX<=O.minX&&I.minY<=O.minY&&O.maxX<=I.maxX&&O.maxY<=I.maxY}function z(I,O){return O.minX<=I.maxX&&O.minY<=I.maxY&&O.maxX>=I.minX&&O.maxY>=I.minY}function L(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(I,O,B,K,H){for(var q=[O,B];q.length;)if(!((B=q.pop())-(O=q.pop())<=K)){var J=O+Math.ceil((B-O)/K/2)*K;t(I,J,O,B,H),q.push(O,J,J,B)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var O=this.data,B=[];if(!z(I,O))return B;for(var K=this.toBBox,H=[];O;){for(var q=0;q<O.children.length;q++){var J=O.children[q],fe=O.leaf?K(J):J;z(I,fe)&&(O.leaf?B.push(J):T(I,fe)?this._all(J,B):H.push(J))}O=H.pop()}return B},o.prototype.collides=function(I){var O=this.data;if(!z(I,O))return!1;for(var B=[];O;){for(var K=0;K<O.children.length;K++){var H=O.children[K],q=O.leaf?this.toBBox(H):H;if(z(I,q)){if(O.leaf||T(I,q))return!0;B.push(H)}}O=B.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var O=0;O<I.length;O++)this.insert(I[O]);return this}var B=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===B.height)this._splitRoot(this.data,B);else{if(this.data.height<B.height){var K=this.data;this.data=B,B=K}this._insert(B,this.data.height-B.height-1,!0)}else this.data=B;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=L([]),this},o.prototype.remove=function(I,O){if(!I)return this;for(var B,K,H,q=this.data,J=this.toBBox(I),fe=[],Ee=[];q||fe.length;){if(q||(q=fe.pop(),K=fe[fe.length-1],B=Ee.pop(),H=!0),q.leaf){var ee=u(I,q.children,O);if(ee!==-1)return q.children.splice(ee,1),fe.push(q),this._condense(fe),this}H||q.leaf||!T(q,J)?K?(B++,q=K.children[B],H=!1):q=null:(fe.push(q),Ee.push(B),B=0,K=q,q=q.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,O){return I.minX-O.minX},o.prototype.compareMinY=function(I,O){return I.minY-O.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,O){for(var B=[];I;)I.leaf?O.push.apply(O,I.children):B.push.apply(B,I.children),I=B.pop();return O},o.prototype._build=function(I,O,B,K){var H,q=B-O+1,J=this._maxEntries;if(q<=J)return s(H=L(I.slice(O,B+1)),this.toBBox),H;K||(K=Math.ceil(Math.log(q)/Math.log(J)),J=Math.ceil(q/Math.pow(J,K-1))),(H=L([])).leaf=!1,H.height=K;var fe=Math.ceil(q/J),Ee=fe*Math.ceil(Math.sqrt(J));E(I,O,B,Ee,this.compareMinX);for(var ee=O;ee<=B;ee+=Ee){var oe=Math.min(ee+Ee-1,B);E(I,ee,oe,fe,this.compareMinY);for(var xe=ee;xe<=oe;xe+=fe){var me=Math.min(xe+fe-1,oe);H.children.push(this._build(I,xe,me,K-1))}}return s(H,this.toBBox),H},o.prototype._chooseSubtree=function(I,O,B,K){for(;K.push(O),!O.leaf&&K.length-1!==B;){for(var H=1/0,q=1/0,J=void 0,fe=0;fe<O.children.length;fe++){var Ee=O.children[fe],ee=x(Ee),oe=(xe=I,me=Ee,(Math.max(me.maxX,xe.maxX)-Math.min(me.minX,xe.minX))*(Math.max(me.maxY,xe.maxY)-Math.min(me.minY,xe.minY))-ee);oe<q?(q=oe,H=ee<H?ee:H,J=Ee):oe===q&&ee<H&&(H=ee,J=Ee)}O=J||O.children[0]}var xe,me;return O},o.prototype._insert=function(I,O,B){var K=B?I:this.toBBox(I),H=[],q=this._chooseSubtree(K,this.data,O,H);for(q.children.push(I),p(q,K);O>=0&&H[O].children.length>this._maxEntries;)this._split(H,O),O--;this._adjustParentBBoxes(K,H,O)},o.prototype._split=function(I,O){var B=I[O],K=B.children.length,H=this._minEntries;this._chooseSplitAxis(B,H,K);var q=this._chooseSplitIndex(B,H,K),J=L(B.children.splice(q,B.children.length-q));J.height=B.height,J.leaf=B.leaf,s(B,this.toBBox),s(J,this.toBBox),O?I[O-1].children.push(J):this._splitRoot(B,J)},o.prototype._splitRoot=function(I,O){this.data=L([I,O]),this.data.height=I.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,O,B){for(var K,H,q,J,fe,Ee,ee,oe=1/0,xe=1/0,me=O;me<=B-O;me++){var tt=h(I,0,me,this.toBBox),Ue=h(I,me,B,this.toBBox),ze=(H=tt,q=Ue,J=void 0,fe=void 0,Ee=void 0,ee=void 0,J=Math.max(H.minX,q.minX),fe=Math.max(H.minY,q.minY),Ee=Math.min(H.maxX,q.maxX),ee=Math.min(H.maxY,q.maxY),Math.max(0,Ee-J)*Math.max(0,ee-fe)),Ie=x(tt)+x(Ue);ze<oe?(oe=ze,K=me,xe=Ie<xe?Ie:xe):ze===oe&&Ie<xe&&(xe=Ie,K=me)}return K||B-O},o.prototype._chooseSplitAxis=function(I,O,B){var K=I.leaf?this.compareMinX:g,H=I.leaf?this.compareMinY:_;this._allDistMargin(I,O,B,K)<this._allDistMargin(I,O,B,H)&&I.children.sort(K)},o.prototype._allDistMargin=function(I,O,B,K){I.children.sort(K);for(var H=this.toBBox,q=h(I,0,O,H),J=h(I,B-O,B,H),fe=C(q)+C(J),Ee=O;Ee<B-O;Ee++){var ee=I.children[Ee];p(q,I.leaf?H(ee):ee),fe+=C(q)}for(var oe=B-O-1;oe>=O;oe--){var xe=I.children[oe];p(J,I.leaf?H(xe):xe),fe+=C(J)}return fe},o.prototype._adjustParentBBoxes=function(I,O,B){for(var K=B;K>=0;K--)p(O[K],I)},o.prototype._condense=function(I){for(var O=I.length-1,B=void 0;O>=0;O--)I[O].children.length===0?O>0?(B=I[O-1].children).splice(B.indexOf(I[O]),1):this.clear():s(I[O],this.toBBox)},o})})(_w);var n3=_w.exports;const r3=Bg(Nk),i3=Bg(Jk);function yw(r,e,t){if(r!==null)for(var n,i,o,u,s,h,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",z=C==="Feature",L=T?r.features.length:1,E=0;E<L;E++){p=T?r.features[E].geometry:z?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var O=0,B=0;if(u=x?p.geometries[I]:p,u!==null){h=u.coordinates;var K=u.type;switch(g=t&&(K==="Polygon"||K==="MultiPolygon")?1:0,K){case null:break;case"Point":if(e(h,_,E,O,B)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(e(h[n],_,E,O,B)===!1)return!1;_++,K==="MultiPoint"&&O++}K==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(i=0;i<h[n].length-g;i++){if(e(h[n][i],_,E,O,B)===!1)return!1;_++}K==="MultiLineString"&&O++,K==="Polygon"&&B++}K==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(B=0,i=0;i<h[n].length;i++){for(o=0;o<h[n][i].length-g;o++){if(e(h[n][i][o],_,E,O,B)===!1)return!1;_++}B++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(yw(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function vw(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return yw(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var o3=vw;const s3=Object.freeze(Object.defineProperty({__proto__:null,bbox:vw,default:o3},Symbol.toStringTag,{value:"Module"})),a3=Bg(s3);var Bs=n3,bw=r3,ww=i3,Ou=a3.default,l3=ww.featureEach;ww.coordEach;bw.polygon;var X0=bw.featureCollection;function xw(r){var e=new Bs(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ou(t),Bs.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Ou(i),n.push(i)}):l3(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Ou(i),n.push(i)}),Bs.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ou(t),Bs.prototype.remove.call(this,t,n)},e.clear=function(){return Bs.prototype.clear.call(this)},e.search=function(t){var n=Bs.prototype.search.call(this,this.toBBox(t));return X0(n)},e.collides=function(t){return Bs.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Bs.prototype.all.call(this);return X0(t)},e.toJSON=function(){return Bs.prototype.toJSON.call(this)},e.fromJSON=function(t){return Bs.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Ou(t);else if(t.type==="FeatureCollection")n=Ou(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ug.exports=xw;Ug.exports.default=xw;var u3=Ug.exports;const c3=ow(u3);function f3(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ss(r)),e.type==="LineString"&&(e=ss(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=K0(r,e);return i&&n.push(i),Rl(n)}var o=c3();return o.load(Z0(e)),Wd(Z0(r),function(u){Wd(o.search(u),function(s){var h=K0(u,s);if(h){var p=tc(h).join(",");t[p]||(t[p]=!0,n.push(h))}})}),Rl(n)}function K0(r,e){var t=tc(r),n=tc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],s=t[1][1],h=n[0][0],p=n[0][1],g=n[1][0],_=n[1][1],x=(_-p)*(u-i)-(g-h)*(s-o),C=(g-h)*(o-p)-(_-p)*(i-h),T=(u-i)*(o-p)-(s-o)*(i-h);if(x===0)return null;var z=C/x,L=T/x;if(z>=0&&z<=1&&L>=0&&L<=1){var E=i+z*(u-i),I=o+z*(s-o);return yo([E,I])}return null}function h3(r,e,t){t===void 0&&(t={});var n=yo([1/0,1/0],{dist:1/0}),i=0;return uc(r,function(o){for(var u=tc(o),s=0;s<u.length-1;s++){var h=yo(u[s]);h.properties.dist=ff(e,h,t);var p=yo(u[s+1]);p.properties.dist=ff(e,p,t);var g=ff(h,p,t),_=Math.max(h.properties.dist,p.properties.dist),x=gw(h,p),C=W0(e,_,x+90,t),T=W0(e,_,x-90,t),z=f3(ts([C.geometry.coordinates,T.geometry.coordinates]),ts([h.geometry.coordinates,p.geometry.coordinates])),L=null;z.features.length>0&&(L=z.features[0],L.properties.dist=ff(e,L,t),L.properties.location=i+ff(h,L,t)),h.properties.dist<n.properties.dist&&(n=h,n.properties.index=s,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=s+1,n.properties.location=i+g),L&&L.properties.dist<n.properties.dist&&(n=L,n.properties.index=s),i+=g}}),n}const d3=30;class p3{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const s=[u.point.x-d3,u.point.y],h=this.map.unproject(u.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,h)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Hd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const $u=[];function zd(r,e){return{subscribe:En(r,e).subscribe}}function En(r,e=at){let t;const n=new Set;function i(s){if(St(r,s)&&(r=s,t)){const h=!$u.length;for(const p of n)p[1](),$u.push(p,r);if(h){for(let p=0;p<$u.length;p+=2)$u[p][0]($u[p+1]);$u.length=0}}}function o(s){i(s(r))}function u(s,h=at){const p=[s,h];return n.add(p),n.size===1&&(t=e(i,o)||at),s(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}function Aw(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return zd(t,(u,s)=>{let h=!1;const p=[];let g=0,_=at;const x=()=>{if(g)return;_();const T=e(n?p[0]:p,u,s);o?u(T):_=da(T)?T:at},C=i.map((T,z)=>Eg(T,L=>{p[z]=L,g&=~(1<<z),h&&x()},()=>{g|=1<<z}));return h=!0,x(),function(){cr(C),_(),h=!1}})}class m3{constructor(){Qn(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty — nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new Mm(n,1,Dd);for(const[o,u]of g3(n))for(const{projectKey:s,projectName:h}of u){let p=window.localStorage.getItem(s);if(!p){console.warn(`Project features not found for ${s}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=h,console.log(`migrating project ${s}`);let _=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${s} -> ${i.projectKey(_)}`),window.localStorage.removeItem(s)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new Mm(n,2,Dd);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new Mm(e,this.storedSchemaVersion,Dd)}}const Dd=Symbol("internal_method_token");class Mm{constructor(e,t,n){Qn(this,"appFocus");Qn(this,"dbSchemaVersion");if(n!==Dd)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t="My neighbourhood",i=this.project(e).features.filter(s=>{var h;return((h=s.properties)==null?void 0:h.kind)=="boundary"}),o=t,u=1;for(;i.some(s=>{var h;return((h=s.properties)==null?void 0:h.name)==o});)u++,o=`${t} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function g3(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,s,h]=o.split("/");e.has(s)||e.set(s,[]),e.get(s).push({projectKey:o,projectName:h})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),s=u[u.length-1],h="";try{h=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}h&&h.length>0?(e.has(h)||e.set(h,[]),e.get(h).push({projectKey:o,projectName:s})):t.push({projectKey:o,projectName:s})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const kw="MZEJTanw3WpxRvt7qDfo";let as=En(null),As=En("global"),$s=En(void 0),_3=Aw($s,r=>{if(r)return pi(Wa).project(r)}),Ra=En(void 0),Sw=new m3,Wa=Aw(As,r=>Sw.projectStorage(r)),J0=En(!0),Zd=En(!1),kr=En(null),nh=En({population_density:[0,1,2,3,4,5],collision_density:[0,1,2,3,4,5],poi_density:[0,1,2,3,4,5]}),If=En(new ua.LngLat(0,0)),Pf=En(new ua.LngLat(0,0)),wd=En(new ua.LngLat(0,0)),Y0=En(1),Xi=En(1),tr=En({mode:"title",firstLoad:!0}),zf=En(!1),Zm=En("streets-v2"),Xm=En("walk_cycle_only"),Q0=En(!1),Km=En(!0),Xd=En(!0),Kd=En("shortcuts"),Jm=En(!1),Ym=En(!0),ey=En(500);function qf(){const r=pi($s);try{pi(Wa).saveProject(r,pi(kr).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let Qm=En(!1);function No(r){return pi(Qm)?`/${r}`:`https://assets.od2net.org/${r}`}function eg(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const s=i.getNorth()-i.getSouth();let h=i.getSouth()+Math.random()*s;return new ua.LngLat(u,h)}const t=(n=pi(as))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(pi(r))||r.set(e(t))}function y3(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=ie(),n=U("p"),n.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,i=ie(),o=U("ul"),o.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,u=ie(),s=U("p"),s.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the tool’s development, particular thanks to:`,h=ie(),p=U("ul"),p.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li>',g=ie(),_=U("p"),_.textContent="This tool would not be possible without:",x=ie(),C=U("ul"),C.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',T=ie(),z=U("p"),z.textContent="Some road signs images © Crown copyright."},m(L,E){W(L,e,E),W(L,t,E),W(L,n,E),W(L,i,E),W(L,o,E),W(L,u,E),W(L,s,E),W(L,h,E),W(L,p,E),W(L,g,E),W(L,_,E),W(L,x,E),W(L,C,E),W(L,T,E),W(L,z,E)},p:at,d(L){L&&(G(e),G(t),G(n),G(i),G(o),G(u),G(s),G(h),G(p),G(g),G(_),G(x),G(C),G(T),G(z))}}}function v3(r){let e,t,n;function i(u){r[1](u)}let o={$$slots:{default:[y3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Rg({props:o}),dn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&4&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.show=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function b3(r,e,t){let n;st(r,Zd,o=>t(0,n=o));function i(o){n=o,Zd.set(n)}return[n,i]}class w3 extends Lt{constructor(e){super(),Et(this,e,b3,v3,St,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const x3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},ty=x3;function ny(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Em(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=zt(n,t[i]);return{c(){e=ws(r[11]),qd(e,n)},m(i,o){W(i,e,o)},p(i,o){qd(e,n=In(t,[o&32&&i[12]]))},d(i){i&&G(e)}}}function ry(r){let e=r[11],t,n=r[11]&&Em(r);return{c(){n&&n.c(),t=nr()},m(i,o){n&&n.m(i,o),W(i,t,o)},p(i,o){i[11]?e?St(e,i[11])?(n.d(1),n=Em(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Em(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&G(t),n&&n.d(i)}}}function A3(r){let e,t,n,i,o,u=On(r[5]),s=[];for(let x=0;x<u.length;x+=1)s[x]=ry(ny(r,u,x));const h=r[10].default,p=vn(h,r,r[9],null);let g=[ty,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],_={};for(let x=0;x<g.length;x+=1)_=zt(_,g[x]);return{c(){e=ws("svg");for(let x=0;x<s.length;x+=1)s[x].c();t=nr(),p&&p.c(),qd(e,_)},m(x,C){W(x,e,C);for(let T=0;T<s.length;T+=1)s[T]&&s[T].m(e,null);F(e,t),p&&p.m(e,null),o=!0},p(x,[C]){if(C&32){u=On(x[5]);let T;for(T=0;T<u.length;T+=1){const z=ny(x,u,T);s[T]?s[T].p(z,C):(s[T]=ry(z),s[T].c(),s[T].m(e,t))}for(;T<s.length;T+=1)s[T].d(1);s.length=u.length}p&&p.p&&(!o||C&512)&&wn(p,h,x,x[9],o?bn(h,x[9],C,null):xn(x[9]),null),qd(e,_=In(g,[ty,C&128&&x[7],(!o||C&4)&&{width:x[2]},(!o||C&4)&&{height:x[2]},(!o||C&2)&&{stroke:x[1]},(!o||C&28&&n!==(n=x[4]?Number(x[3])*24/Number(x[2]):x[3]))&&{"stroke-width":n},(!o||C&257&&i!==(i=x[6]("lucide-icon","lucide",x[0]?`lucide-${x[0]}`:"",x[8].class)))&&{class:i}]))},i(x){o||(N(p,x),o=!0)},o(x){V(p,x),o=!1},d(x){x&&G(e),_i(s,x),p&&p.d(x)}}}function k3(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=V0(e,n),{$$slots:o={},$$scope:u}=e,{name:s=void 0}=e,{color:h="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:_=!1}=e,{iconNode:x=[]}=e;const C=(...T)=>T.filter((z,L,E)=>!!z&&E.indexOf(z)===L).join(" ");return r.$$set=T=>{t(8,e=zt(zt({},e),gr(T))),t(7,i=V0(e,n)),"name"in T&&t(0,s=T.name),"color"in T&&t(1,h=T.color),"size"in T&&t(2,p=T.size),"strokeWidth"in T&&t(3,g=T.strokeWidth),"absoluteStrokeWidth"in T&&t(4,_=T.absoluteStrokeWidth),"iconNode"in T&&t(5,x=T.iconNode),"$$scope"in T&&t(9,u=T.$$scope)},e=gr(e),[s,h,p,g,_,x,C,i,e,u,o]}class S3 extends Lt{constructor(e){super(),Et(this,e,k3,A3,St,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Ao=S3;function C3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function T3(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[C3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function M3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class E3 extends Lt{constructor(e){super(),Et(this,e,M3,T3,St,{})}}const L3=E3;function I3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function P3(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[I3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function z3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class D3 extends Lt{constructor(e){super(),Et(this,e,z3,P3,St,{})}}const R3=D3;function B3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function F3(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[B3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function O3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class $3 extends Lt{constructor(e){super(),Et(this,e,O3,F3,St,{})}}const N3=$3;function j3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function U3(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[j3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function V3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class q3 extends Lt{constructor(e){super(),Et(this,e,V3,U3,St,{})}}const H3=q3;function G3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function W3(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[G3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Z3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class X3 extends Lt{constructor(e){super(),Et(this,e,Z3,W3,St,{})}}const K3=X3;function J3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Y3(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[J3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Q3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class e4 extends Lt{constructor(e){super(),Et(this,e,Q3,Y3,St,{})}}const Cw=e4;function t4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function n4(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[t4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function r4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class i4 extends Lt{constructor(e){super(),Et(this,e,r4,n4,St,{})}}const o4=i4;function s4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function a4(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[s4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function l4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class u4 extends Lt{constructor(e){super(),Et(this,e,l4,a4,St,{})}}const c4=u4;function f4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function h4(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[f4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function d4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class p4 extends Lt{constructor(e){super(),Et(this,e,d4,h4,St,{})}}const Tw=p4;function m4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function g4(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[m4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function _4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class y4 extends Lt{constructor(e){super(),Et(this,e,_4,g4,St,{})}}const Vg=y4;function v4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function b4(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[v4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function w4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class x4 extends Lt{constructor(e){super(),Et(this,e,w4,b4,St,{})}}const Mw=x4;function A4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function k4(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[A4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function S4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class C4 extends Lt{constructor(e){super(),Et(this,e,S4,k4,St,{})}}const T4=C4;function M4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function E4(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[M4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function L4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class I4 extends Lt{constructor(e){super(),Et(this,e,L4,E4,St,{})}}const qg=I4;function P4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function z4(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[P4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function D4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class R4 extends Lt{constructor(e){super(),Et(this,e,D4,z4,St,{})}}const B4=R4;let F4=Date.now();function Ol(r){return`${r}-${F4++}`}const Hg=Symbol.for("svelte-maplibre");function Za(){return Qf(Hg)}function O4(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(s=>{var h;return(h=r.get(s.layer.id))==null?void 0:h.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function $4(){let r=new Map;return ip(Hg,{map:En(null),source:zd(null),layer:zd(null),popupTarget:zd(null),cluster:En(),loadedImages:En(new Set),minzoom:En(0),maxzoom:En(24),layerEvent:En(null),layerInfo:r,eventTopMost:O4(r),markerClickManager:new U4})}function iy(r){return{subscribe:r.subscribe}}function Gg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Za(),o=En(null),u=iy(o),s={...i,[r]:iy(o)};if(e&&(s.popupTarget=u),n){let h=En(null);s.layerEvent=h,i.layerEvent=h}return t&&(s.cluster=En()),ip(Hg,s),{...i,self:o}}function Ew(){return Gg({key:"source",setCluster:!0})}function Lw(r=!0){return Gg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function N4(){return Gg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function j4(r){return"layerType"in r&&r.layerType==="deckgl"}class U4{constructor(){Qn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function oy(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function V4(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function q4(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Gn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var ja=H4;function H4(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],s=r[u];s!=null&&(e[u]=s)}return e}}}function sy(r){let e=r[0],t,n,i=ay(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=ay(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function ay(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function G4(r){let e,t,n=r[0]&&sy(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=sy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function W4(r,e,t){let n,i,o,u,s,h,p,g,_,x,C,T,{$$slots:z={},$$scope:L}=e,{id:E=Ol("layer")}=e,{source:I=void 0}=e,{sourceLayer:O=void 0}=e,{beforeId:B=void 0}=e,{beforeLayerType:K=void 0}=e,{type:H}=e,{paint:q=void 0}=e,{layout:J=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:Ee=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:oe=void 0}=e,{manageHoverState:xe=!1}=e,{hovered:me=null}=e,{interactive:tt=!0}=e,{hoverCursor:Ue=void 0}=e,{eventsIfTopMost:ze=!1}=e;const Ie=js(),{map:ct,source:Xe,self:lt,minzoom:pt,maxzoom:_t,eventTopMost:He,layerInfo:gt}=Lw();st(r,ct,qe=>t(31,_=qe)),st(r,Xe,qe=>t(32,x=qe)),st(r,lt,qe=>t(0,g=qe)),st(r,pt,qe=>t(34,T=qe)),st(r,_t,qe=>t(33,C=qe)),ri(()=>{g&&_&&(gt.delete(g),_==null||_.removeLayer(g))});let Pt;function jt(qe){var de,cn;if(!tt||!g||!_||ze&&He(qe)!==g)return;let Ge=qe.features??[],At=(cn=(de=Ge[0])==null?void 0:de.properties)==null?void 0:cn.cluster_id,nt={event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge};Ie(qe.type,nt)}function un(qe){var de,cn;if(!tt||!g||!_||ze&&He(qe)!==g)return;Ue&&(_.getCanvas().style.cursor=Ue);let Ge=qe.features??[];t(6,me=Ge[0]??null);let At=(cn=(de=Ge[0])==null?void 0:de.properties)==null?void 0:cn.cluster_id;Ie("mouseenter",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function nn(qe){var de,cn,Ke;if(!tt||!_)return;if(ze&&He(qe)!==g){t(6,me=null),xe&&Pt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:O,id:Pt},{hover:!1}),Pt=void 0);return}_.getCanvas().style.cursor=Ue;let Ge=qe.features??[],At=(cn=(de=Ge[0])==null?void 0:de.properties)==null?void 0:cn.cluster_id,nt=(Ke=Ge[0])==null?void 0:Ke.id;nt!==Pt&&(xe&&(Pt!==void 0&&(_==null||_.setFeatureState({source:s,id:Pt,sourceLayer:O},{hover:!1})),_==null||_.setFeatureState({source:s,id:nt,sourceLayer:O},{hover:!0})),Pt=nt,t(6,me=Ge[0]??null)),Ie("mousemove",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function rn(qe){if(!(!tt||!g||!_)){if(Ue&&(_.getCanvas().style.cursor=""),t(6,me=null),xe&&Pt!==void 0){const Ge={source:s,id:Pt,sourceLayer:O};_==null||_.setFeatureState(Ge,{hover:!1}),Pt=void 0}Ie("mouseleave",{map:_,layer:g,source:s})}}let pn=!0;function yn(qe){_&&(_.off("click",qe,jt),_.off("dblclick",qe,jt),_.off("contextmenu",qe,jt),_.off("mouseenter",qe,un),_.off("mousemove",qe,nn),_.off("mouseleave",qe,rn))}return ri(()=>{_&&g&&yn(g)}),r.$$set=qe=>{"id"in qe&&t(7,E=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,O=qe.sourceLayer),"beforeId"in qe&&t(10,B=qe.beforeId),"beforeLayerType"in qe&&t(11,K=qe.beforeLayerType),"type"in qe&&t(12,H=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,J=qe.layout),"filter"in qe&&t(15,fe=qe.filter),"applyToClusters"in qe&&t(16,Ee=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,oe=qe.maxzoom),"manageHoverState"in qe&&t(19,xe=qe.manageHoverState),"hovered"in qe&&t(6,me=qe.hovered),"interactive"in qe&&t(20,tt=qe.interactive),"hoverCursor"in qe&&t(21,Ue=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,ze=qe.eventsIfTopMost),"$$scope"in qe&&t(35,L=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=q4(Ee)),r.$$.dirty[0]&1073774592&&t(24,i=V4("all",n,fe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=oe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=I||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==E&&s){g&&(yn(g),gt.delete(g));let qe=B;if(!B&&K){let Ge=_.getStyle().layers,At=typeof K=="function"?K:de=>de.type===K,nt=Ge==null?void 0:Ge.find(At);nt&&(qe=nt.id)}ln(lt,g=E,g),_.addLayer(ja({id:g,type:H,source:s,"source-layer":O,filter:i,paint:q,layout:J,minzoom:o,maxzoom:u}),qe),t(23,pn=!0),_.on("click",g,jt),_.on("dblclick",g,jt),_.on("contextmenu",g,jt),_.on("mouseenter",g,un),_.on("mousemove",g,nn),_.on("mouseleave",g,rn)}r.$$.dirty[0]&1048577&&g&&gt.set(g,{interactive:tt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,h=g?oy((qe,Ge)=>{_!=null&&_.style._loaded?_.setPaintProperty(g,qe,Ge):_==null||_.once("styledata",()=>_==null?void 0:_.setPaintProperty(g,qe,Ge))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?oy((qe,Ge)=>{_!=null&&_.style._loaded?_.setLayoutProperty(g,qe,Ge):_==null||_.once("styledata",()=>_==null?void 0:_.setLayoutProperty(g,qe,Ge))}):void 0),r.$$.dirty[0]&268443648&&(h==null||h(q)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(pn?t(23,pn=!1):_==null||_.setFilter(g,i))},[g,ct,Xe,lt,pt,_t,me,E,I,O,B,K,H,q,J,fe,Ee,ee,oe,xe,tt,Ue,ze,pn,i,u,o,p,h,s,n,_,x,C,T,L,z]}let ap=class extends Lt{constructor(e){super(),Et(this,e,W4,G4,St,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Z4(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function X4(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Z4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ap({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.applyToClusters=u[9]),s&1024&&(h.minzoom=u[10]),s&2048&&(h.maxzoom=u[11]),s&4096&&(h.hoverCursor=u[12]),s&8192&&(h.manageHoverState=u[13]),s&16384&&(h.eventsIfTopMost=u[14]),s&32768&&(h.interactive=u[15]),s&16777216&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function K4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:B=!0}=e;function K(oe){I=oe,t(0,I)}function H(oe){Pn.call(this,r,oe)}function q(oe){Pn.call(this,r,oe)}function J(oe){Pn.call(this,r,oe)}function fe(oe){Pn.call(this,r,oe)}function Ee(oe){Pn.call(this,r,oe)}function ee(oe){Pn.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,o=oe.id),"source"in oe&&t(2,u=oe.source),"sourceLayer"in oe&&t(3,s=oe.sourceLayer),"beforeId"in oe&&t(4,h=oe.beforeId),"beforeLayerType"in oe&&t(5,p=oe.beforeLayerType),"paint"in oe&&t(6,g=oe.paint),"layout"in oe&&t(7,_=oe.layout),"filter"in oe&&t(8,x=oe.filter),"applyToClusters"in oe&&t(9,C=oe.applyToClusters),"minzoom"in oe&&t(10,T=oe.minzoom),"maxzoom"in oe&&t(11,z=oe.maxzoom),"hoverCursor"in oe&&t(12,L=oe.hoverCursor),"manageHoverState"in oe&&t(13,E=oe.manageHoverState),"hovered"in oe&&t(0,I=oe.hovered),"eventsIfTopMost"in oe&&t(14,O=oe.eventsIfTopMost),"interactive"in oe&&t(15,B=oe.interactive),"$$scope"in oe&&t(24,i=oe.$$scope)},[I,o,u,s,h,p,g,_,x,C,T,z,L,E,O,B,n,K,H,q,J,fe,Ee,ee,i]}let $l=class extends Lt{constructor(e){super(),Et(this,e,K4,X4,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function J4(r){let e,t;const n=r[7].default,i=vn(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),he(e,"class",r[1]),Wt(e,"maplibregl-ctrl",r[0])},m(o,u){W(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,null):xn(o[6]),null),(!t||u&2)&&he(e,"class",o[1]),(!t||u&3)&&Wt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o),r[8](null)}}}function Y4(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:s="top-right"}=e,{class:h=void 0}=e;const{map:p}=Za();st(r,p,C=>t(5,n=C));let g,_={onAdd(){return g},onRemove(){var C;(C=g==null?void 0:g.parentNode)==null||C.removeChild(g)}};ri(()=>{n==null||n.removeControl(_)});function x(C){dn[C?"unshift":"push"](()=>{g=C,t(2,g)})}return r.$$set=C=>{"defaultStyling"in C&&t(0,u=C.defaultStyling),"position"in C&&t(4,s=C.position),"class"in C&&t(1,h=C.class),"$$scope"in C&&t(6,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(_,s)},[u,h,g,p,s,n,o,i,x]}class tg extends Lt{constructor(e){super(),Et(this,e,Y4,J4,St,{defaultStyling:0,position:4,class:1})}}function Q4(r){let e,t,n,i,o,u;const s=r[5].default,h=vn(s,r,r[4],null);return{c(){e=U("button"),t=U("div"),h&&h.c(),he(t,"class",n=ec(r[3])+" svelte-1s83zbq"),Wt(t,"maplibregl-ctrl-icon",r[0]),Wt(t,"ctrl-btn-center",r[1]),he(e,"type","button"),he(e,"title",r[2])},m(p,g){W(p,e,g),F(e,t),h&&h.m(t,null),i=!0,o||(u=Mt(e,"click",r[6]),o=!0)},p(p,[g]){h&&h.p&&(!i||g&16)&&wn(h,s,p,p[4],i?bn(s,p[4],g,null):xn(p[4]),null),(!i||g&8&&n!==(n=ec(p[3])+" svelte-1s83zbq"))&&he(t,"class",n),(!i||g&9)&&Wt(t,"maplibregl-ctrl-icon",p[0]),(!i||g&10)&&Wt(t,"ctrl-btn-center",p[1]),(!i||g&4)&&he(e,"title",p[2])},i(p){i||(N(h,p),i=!0)},o(p){V(h,p),i=!1},d(p){p&&G(e),h&&h.d(p),o=!1,u()}}}function eS(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:s=void 0}=e,{class:h=void 0}=e;function p(g){Pn.call(this,r,g)}return r.$$set=g=>{"icon"in g&&t(0,o=g.icon),"center"in g&&t(1,u=g.center),"title"in g&&t(2,s=g.title),"class"in g&&t(3,h=g.class),"$$scope"in g&&t(4,i=g.$$scope)},[o,u,s,h,i,n,p]}class Iw extends Lt{constructor(e){super(),Et(this,e,eS,Q4,St,{icon:0,center:1,title:2,class:3})}}function tS(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[1],null);return{c(){e=U("div"),o&&o.c(),he(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,s){W(u,e,s),o&&o.m(e,null),n=!0},p(u,[s]){o&&o.p&&(!n||s&2)&&wn(o,i,u,u[1],n?bn(i,u[1],s,null):xn(u[1]),null),(!n||s&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&he(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&G(e),o&&o.d(u)}}}function nS(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class Pw extends Lt{constructor(e){super(),Et(this,e,nS,tS,St,{class:0})}}function rS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function iS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[rS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ap({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.minzoom=u[9]),s&1024&&(h.maxzoom=u[10]),s&2048&&(h.hoverCursor=u[11]),s&4096&&(h.manageHoverState=u[12]),s&8192&&(h.eventsIfTopMost=u[13]),s&16384&&(h.interactive=u[14]),s&8388608&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function oS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(ee){E=ee,t(0,E)}function K(ee){Pn.call(this,r,ee)}function H(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,h=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,z=ee.hoverCursor),"manageHoverState"in ee&&t(12,L=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,h,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,fe,Ee,i]}let Yi=class extends Lt{constructor(e){super(),Et(this,e,oS,iS,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function sS(r,e,t){let n;const{map:i}=Za();st(r,i,h=>t(4,n=h));let{position:o="top-left"}=e,{container:u=void 0}=e,s=null;return ri(()=>{n!=null&&n.loaded()&&s&&n.removeControl(s)}),r.$$set=h=>{"position"in h&&t(1,o=h.position),"container"in h&&t(2,u=h.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!s){let h;typeof u=="string"?h=document.querySelector(u)??void 0:h=u,t(3,s=new ni.FullscreenControl({container:h})),n.addControl(s,o)}},[i,o,u,s,n]}class aS extends Lt{constructor(e){super(),Et(this,e,sS,null,St,{position:1,container:2})}}function zw(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function Dw(r,e,t){Yb().then(()=>{let n=pi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function ly(r){let e=r[0],t,n,i=uy(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=uy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function uy(r){let e;const t=r[19].default,n=vn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&wn(n,t,i,i[18],e?bn(t,i[18],o,null):xn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function lS(r){let e,t,n=r[0]&&ly(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=ly(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function uS(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:h=Ol("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e,{maxzoom:z=void 0}=e,{attribution:L=void 0}=e,{buffer:E=void 0}=e,{tolerance:I=void 0}=e;const{map:O,cluster:B,self:K}=Ew();st(r,O,J=>t(17,i=J)),st(r,B,J=>t(20,o=J)),st(r,K,J=>t(0,n=J));let H,q=!0;return ri(()=>{n&&H&&i&&(Dw(O,n,H),ln(K,n=null,n),t(15,H=void 0))}),r.$$set=J=>{"id"in J&&t(4,h=J.id),"data"in J&&t(5,p=J.data),"generateId"in J&&t(6,g=J.generateId),"promoteId"in J&&t(7,_=J.promoteId),"filter"in J&&t(8,x=J.filter),"lineMetrics"in J&&t(9,C=J.lineMetrics),"cluster"in J&&t(10,T=J.cluster),"maxzoom"in J&&t(11,z=J.maxzoom),"attribution"in J&&t(12,L=J.attribution),"buffer"in J&&t(13,E=J.buffer),"tolerance"in J&&t(14,I=J.tolerance),"$$scope"in J&&t(18,s=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ln(B,o=T,o),r.$$.dirty&196593&&i&&n!==h&&(ln(K,n=h,n),zw(i,n,ja({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties,maxzoom:z,attribution:L,buffer:E,tolerance:I}),J=>i&&J===n,()=>{n&&(t(15,H=i==null?void 0:i.getSource(n)),t(16,q=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,H=i==null?void 0:i.getSource(h))})),r.$$.dirty&98336&&H&&(q?t(16,q=!1):H.setData(p)),r.$$.dirty&33792&&(H==null||H.setClusterOptions(ja({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,O,B,K,h,p,g,_,x,C,T,z,L,E,I,H,q,i,s,u]}let _r=class extends Lt{constructor(e){super(),Et(this,e,uS,lS,St,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function cS(r,e,t){let n;const{map:i}=Za();st(r,i,x=>t(8,n=x));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:s=void 0}=e,{trackUserLocation:h=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:_=null}=e;return ri(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=x=>{"position"in x&&t(2,o=x.position),"positionOptions"in x&&t(3,u=x.positionOptions),"fitBoundsOptions"in x&&t(4,s=x.fitBoundsOptions),"trackUserLocation"in x&&t(5,h=x.trackUserLocation),"showAccuracyCircle"in x&&t(6,p=x.showAccuracyCircle),"showUserLocation"in x&&t(7,g=x.showUserLocation),"control"in x&&t(1,_=x.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!_&&(t(1,_=new ni.GeolocateControl({positionOptions:u,fitBoundsOptions:s,trackUserLocation:h,showAccuracyCircle:p,showUserLocation:g})),n.addControl(_,o))},[i,_,o,u,s,h,p,g,n]}class fS extends Lt{constructor(e){super(),Et(this,e,cS,null,St,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function hS(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:s=void 0}=e,h=new Set;const{map:p,source:g}=Lw();return st(r,p,_=>t(6,n=_)),st(r,g,_=>t(7,i=_)),r.$$set=_=>{"data"in _&&t(2,o=_.data),"idCol"in _&&t(3,u=_.idCol),"sourceLayer"in _&&t(4,s=_.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let _=new Set;for(const x of o){const C=x[u];if(!C)continue;h.delete(C),_.add(C);const T={id:C,source:i,sourceLayer:s},z=n.getFeatureState(T);let L=!1;for(const E of Object.keys(x))if(z[E]!==x[E]){L=!0;break}L&&n.setFeatureState(T,x)}for(const x of h){const C={id:x,source:i,sourceLayer:s},T=n.getFeatureState(C);for(const z of Object.keys(T))n.removeFeatureState(C,z)}t(5,h=_)}},[p,g,o,u,s,h,n,i]}class dS extends Lt{constructor(e){super(),Et(this,e,hS,null,St,{data:2,idCol:3,sourceLayer:4})}}function pS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function mS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[pS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ap({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.minzoom=u[9]),s&1024&&(h.maxzoom=u[10]),s&2048&&(h.hoverCursor=u[11]),s&4096&&(h.manageHoverState=u[12]),s&8192&&(h.eventsIfTopMost=u[13]),s&16384&&(h.interactive=u[14]),s&8388608&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function gS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(ee){E=ee,t(0,E)}function K(ee){Pn.call(this,r,ee)}function H(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,h=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,z=ee.hoverCursor),"manageHoverState"in ee&&t(12,L=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,h,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,fe,Ee,i]}let ur=class extends Lt{constructor(e){super(),Et(this,e,gS,mS,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function _S(r,e,t){let n;const i=js();let{layer:o=void 0}=e;const{map:u}=Za();st(r,u,g=>t(2,n=g));function s(g){i(g.type,{...g,map:u})}const h=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ri(()=>{if(n)if(o)for(const g of h)n.off(g,o,s);else for(const g of p)n.off(g,s)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of h)n.on(g,o,s);else for(const g of p)n.on(g,s)},[u,o,n]}class Wg extends Lt{constructor(e){super(),Et(this,e,_S,null,St,{layer:1})}}function yS(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,s=`${t}/${o}/${u}`,h=r.getBearing(),p=r.getPitch();return(h||p)&&(s+=`/${Math.round(h*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function vS(r){return r.replace("#","").split("/").map(parseFloat)}var Nu=Zg;function Zg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?cy(r,e):{}.toString.call(r)=="[object Set]"?cy(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?wS(r,e):bS(r,e)}function bS(r,e){return r.toString()===e.toString()}function cy(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Zg(r[n],e[n]))return!1;return!0}function wS(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Zg(r[o],e[o])))return!1}return!0}function xS(r,e,t){let n;const{map:i}=Za();st(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:s=!0}=e,{visualizePitch:h=!1}=e,p=null;return ri(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,s=g.showZoom),"visualizePitch"in g&&t(4,h=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new ni.NavigationControl({showCompass:u,showZoom:s,visualizePitch:h})),n.addControl(p,o))},[i,o,u,s,h,p,n]}class Rw extends Lt{constructor(e){super(),Et(this,e,xS,null,St,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function AS(r,e,t){let n;const{map:i}=Za();st(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:s="metric"}=e,h=null;return ri(()=>{n!=null&&n.loaded()&&h&&n.removeControl(h)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,s=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!h&&(t(4,h=new ni.ScaleControl({maxWidth:u,unit:s})),n.addControl(h,o))},[i,o,u,s,h,n]}class Bw extends Lt{constructor(e){super(),Et(this,e,AS,null,St,{position:1,maxWidth:2,unit:3})}}const{window:kS}=Xb,SS=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),fy=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function hy(r){let e,t,n=r[3]&&dy(r);const i=r[46].default,o=vn(i,r,r[45],fy);return{c(){n&&n.c(),e=ie(),o&&o.c()},m(u,s){n&&n.m(u,s),W(u,e,s),o&&o.m(u,s),t=!0},p(u,s){u[3]?n?(n.p(u,s),s[0]&8&&N(n,1)):(n=dy(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt()),o&&o.p&&(!t||s[0]&112|s[1]&16384)&&wn(o,i,u,u[45],t?bn(i,u[45],s,SS):xn(u[45]),fy)},i(u){t||(N(n),N(o,u),t=!0)},o(u){V(n),V(o,u),t=!1},d(u){u&&G(e),n&&n.d(u),o&&o.d(u)}}}function dy(r){let e,t,n,i,o,u,s,h;return e=new Rw({props:{position:r[7]}}),n=new fS({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new aS({props:{position:r[7]}}),s=new Bw({props:{position:r[7]}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),h=!0},p(p,g){const _={};g[0]&128&&(_.position=p[7]),e.$set(_);const x={};g[0]&128&&(x.position=p[7]),n.$set(x);const C={};g[0]&128&&(C.position=p[7]),o.$set(C);const T={};g[0]&128&&(T.position=p[7]),s.$set(T)},i(p){h||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),h=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),h=!1},d(p){p&&(G(t),G(i),G(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function CS(r){let e,t,n,i,o,u=r[4]&&r[0]&&hy(r);return{c(){e=U("div"),u&&u.c(),he(e,"class",t=ec(r[2])+" svelte-p00lfq"),he(e,"data-testid","map-container"),Wt(e,"expand-map",!r[2])},m(s,h){W(s,e,h),u&&u.m(e,null),r[47](e),n=!0,i||(o=[Mt(kS,"hashchange",r[11]),Vm(r[10].call(null,e))],i=!0)},p(s,h){s[4]&&s[0]?u?(u.p(s,h),h[0]&17&&N(u,1)):(u=hy(s),u.c(),N(u,1),u.m(e,null)):u&&(Kt(),V(u,1,1,()=>{u=null}),Jt()),(!n||h[0]&4&&t!==(t=ec(s[2])+" svelte-p00lfq"))&&he(e,"class",t),(!n||h[0]&4)&&Wt(e,"expand-map",!s[2])},i(s){n||(N(u),n=!0)},o(s){V(u),n=!1},d(s){s&&G(e),u&&u.d(),r[47](null),i=!1,cr(o)}}}function TS(r,e,t){let n,i,o,u,{$$slots:s={},$$scope:h}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:_=void 0}=e,{style:x}=e,{diffStyleUpdates:C=!1}=e,{center:T=void 0}=e,{zoom:z=void 0}=e,{pitch:L=0}=e,{bearing:E=0}=e,{bounds:I=void 0}=e,{hash:O=!1}=e,{updateHash:B=Ke=>{window.history.replaceState(window.history.state,"",Ke)}}=e,{loaded:K=!1}=e,{minZoom:H=0}=e,{maxZoom:q=22}=e,{minPitch:J=0}=e,{maxPitch:fe=60}=e,{renderWorldCopies:Ee=void 0}=e,{dragPan:ee=void 0}=e,{dragRotate:oe=void 0}=e,{pitchWithRotate:xe=void 0}=e,{antialias:me=void 0}=e,{zoomOnDoubleClick:tt=!0}=e,{locale:Ue=void 0}=e,{interactive:ze=!0}=e,{attributionControl:Ie=!0}=e,{cooperativeGestures:ct=!1}=e,{preserveDrawingBuffer:Xe=!1}=e,{maxBounds:lt=void 0}=e,{images:pt=[]}=e,{standardControls:_t=!1}=e,{filterLayers:He=void 0}=e,{transformRequest:gt=void 0}=e;const Pt=js(),{map:jt,loadedImages:un}=$4();st(r,jt,Ke=>t(4,o=Ke)),st(r,un,Ke=>t(5,u=Ke));let nn=new Set;async function rn(Ke,ut=!1){if(o&&!(!o.loaded()&&!ut))if("url"in Ke){nn.add(Ke.id);try{let Gt=await o.loadImage(Ke.url);o==null||o.addImage(Ke.id,Gt.data,Ke.options),u.add(Ke.id),un.set(u)}catch(Gt){Pt("error",Gt)}finally{nn.delete(Ke.id)}}else o.addImage(Ke.id,Ke.data,Ke.options),u.add(Ke.id),un.set(u)}let pn,yn,qe,Ge;function At(Ke){return de(),ln(jt,o=new ni.Map(ja({container:Ke,style:x,locale:Ue,center:T,zoom:z,pitch:L,bearing:E,minZoom:H,maxZoom:q,minPitch:J,maxPitch:fe,renderWorldCopies:Ee,dragPan:ee,dragRotate:oe,pitchWithRotate:xe,antialias:me,interactive:ze,preserveDrawingBuffer:Xe,maxBounds:lt,bounds:I,attributionControl:Ie,transformRequest:gt,cooperativeGestures:ct})),o),o.on("load",ut=>{ut.target.getContainer().setAttribute("data-testid","map"),ut.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,K=!0),Pt("load",o)}),o.on("error",ut=>Pt("error",{...ut,map:o})),o.on("movestart",ut=>Pt("movestart",{...ut,map:o})),o.on("moveend",ut=>{if(t(12,T=ut.target.getCenter()),t(13,z=ut.target.getZoom()),t(14,L=ut.target.getPitch()),t(15,E=ut.target.getBearing()),t(16,I=ut.target.getBounds()),Pt("moveend",{...ut,map:o}),O){let Gt=new URL(window.location.href.replace(/(#.+)?$/,yS(o)));B(Gt)}}),o.on("click",ut=>Pt("click",{...ut,map:o})),o.on("dblclick",ut=>Pt("dblclick",{...ut,map:o})),o.on("contextmenu",ut=>Pt("contextmenu",{...ut,map:o})),o.on("zoomstart",ut=>Pt("zoomstart",{...ut,map:o})),o.on("zoom",ut=>{Pt("zoom",{...ut,map:o})}),o.on("zoomend",ut=>{Pt("zoomend",{...ut,map:o})}),o.on("style.load",()=>{if(o){const ut=o.getStyle();if(t(42,pn=ut.layers.map(Gt=>Gt.id)),t(43,yn=Object.keys(ut.sources)),Ge)for(const[Gt,Jn]of Object.entries(Ge))o.addSource(Gt,Jn);if(qe)for(const Gt of qe)o.addLayer(Gt);for(const Gt of pt)rn(Gt,!0)}}),o.on("styledata",ut=>{if(o&&He){const Gt=o.getStyle().layers;if(Gt)for(let Jn of Gt)He(Jn)||o.setLayoutProperty(Jn.id,"visibility","none")}Pt("styledata",{...ut,map:o})}),{destroy(){t(0,K=!1),o==null||o.remove(),ln(jt,o=null,o)}}}let nt=x;function de(){if(O){let Ke=vS(window.location.hash);Ke.length>=3&&(t(13,z=Ke[0]),t(12,T=[Ke[2],Ke[1]])),Ke.length==5&&(t(15,E=Ke[3]),t(14,L=Ke[4]))}}function cn(Ke){dn[Ke?"unshift":"push"](()=>{g=Ke,t(1,g)})}return r.$$set=Ke=>{"map"in Ke&&t(17,p=Ke.map),"mapContainer"in Ke&&t(1,g=Ke.mapContainer),"class"in Ke&&t(2,_=Ke.class),"style"in Ke&&t(18,x=Ke.style),"diffStyleUpdates"in Ke&&t(19,C=Ke.diffStyleUpdates),"center"in Ke&&t(12,T=Ke.center),"zoom"in Ke&&t(13,z=Ke.zoom),"pitch"in Ke&&t(14,L=Ke.pitch),"bearing"in Ke&&t(15,E=Ke.bearing),"bounds"in Ke&&t(16,I=Ke.bounds),"hash"in Ke&&t(20,O=Ke.hash),"updateHash"in Ke&&t(21,B=Ke.updateHash),"loaded"in Ke&&t(0,K=Ke.loaded),"minZoom"in Ke&&t(22,H=Ke.minZoom),"maxZoom"in Ke&&t(23,q=Ke.maxZoom),"minPitch"in Ke&&t(24,J=Ke.minPitch),"maxPitch"in Ke&&t(25,fe=Ke.maxPitch),"renderWorldCopies"in Ke&&t(26,Ee=Ke.renderWorldCopies),"dragPan"in Ke&&t(27,ee=Ke.dragPan),"dragRotate"in Ke&&t(28,oe=Ke.dragRotate),"pitchWithRotate"in Ke&&t(29,xe=Ke.pitchWithRotate),"antialias"in Ke&&t(30,me=Ke.antialias),"zoomOnDoubleClick"in Ke&&t(31,tt=Ke.zoomOnDoubleClick),"locale"in Ke&&t(32,Ue=Ke.locale),"interactive"in Ke&&t(33,ze=Ke.interactive),"attributionControl"in Ke&&t(34,Ie=Ke.attributionControl),"cooperativeGestures"in Ke&&t(35,ct=Ke.cooperativeGestures),"preserveDrawingBuffer"in Ke&&t(36,Xe=Ke.preserveDrawingBuffer),"maxBounds"in Ke&&t(37,lt=Ke.maxBounds),"images"in Ke&&t(38,pt=Ke.images),"standardControls"in Ke&&t(3,_t=Ke.standardControls),"filterLayers"in Ke&&t(39,He=Ke.filterLayers),"transformRequest"in Ke&&t(40,gt=Ke.transformRequest),"$$scope"in Ke&&t(45,h=Ke.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof _t=="boolean"?void 0:_t),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Nu(x,nt)){const Ke=o.getStyle();if(pn&&(qe=Ke.layers.filter(ut=>!pn.includes(ut.id))),yn){const ut=Object.keys(Ke.sources).filter(Gt=>!yn.includes(Gt));Ge={};for(const Gt of ut)Ge[Gt]=Ke.sources[Gt]}t(44,nt=x),o.setStyle(x,{diff:C}),ln(un,u=new Set,u),t(41,nn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&K&&o!=null&&o.loaded())for(let Ke of pt)!u.has(Ke.id)&&!nn.has(Ke.id)&&!o.hasImage(Ke.id)&&rn(Ke);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=pt.every(Ke=>u.has(Ke.id))),r.$$.dirty[0]&61456&&o){let Ke={};T!=null&&!Nu(T,o==null?void 0:o.getCenter())&&(Ke.center=T),z!=null&&!Nu(z,o==null?void 0:o.getZoom())&&(Ke.zoom=z),E!=null&&!Nu(E,o==null?void 0:o.getBearing())&&(Ke.bearing=E),L!=null&&!Nu(L,o==null?void 0:o.getPitch())&&(Ke.pitch=L),Object.keys(Ke).length&&o.easeTo(Ke)}r.$$.dirty[0]&65552&&I&&!Nu(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(tt?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[K,g,_,_t,o,u,i,n,jt,un,At,de,T,z,L,E,I,p,x,C,O,B,H,q,J,fe,Ee,ee,oe,xe,me,tt,Ue,ze,Ie,ct,Xe,lt,pt,He,gt,nn,pn,yn,nt,h,s,cn]}class MS extends Lt{constructor(e){super(),Et(this,e,TS,CS,St,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const ES=r=>({marker:r&8}),py=r=>({marker:r[3]});function LS(r){let e,t,n,i,o,u,s;const h=r[19].default,p=vn(h,r,r[18],py);return{c(){e=U("div"),p&&p.c(),he(e,"tabindex",t=r[1]?0:void 0),he(e,"role",n=r[1]?"button":void 0),Ye(e,"z-index",r[2])},m(g,_){W(g,e,_),p&&p.m(e,null),o=!0,u||(s=[Vm(r[7].call(null,e)),Vm(i=IS.call(null,e,r[0])),Mt(e,"click",Mf(r[20])),Mt(e,"dblclick",Mf(r[21])),Mt(e,"contextmenu",Mf(Ig(r[22]))),Mt(e,"mouseenter",r[23]),Mt(e,"mouseleave",r[24]),Mt(e,"mousemove",r[25]),Mt(e,"keydown",r[8])],u=!0)},p(g,[_]){p&&p.p&&(!o||_&262152)&&wn(p,h,g,g[18],o?bn(h,g[18],_,ES):xn(g[18]),py),(!o||_&2&&t!==(t=g[1]?0:void 0))&&he(e,"tabindex",t),(!o||_&2&&n!==(n=g[1]?"button":void 0))&&he(e,"role",n),i&&da(i.update)&&_&1&&i.update.call(null,g[0]),_&4&&Ye(e,"z-index",g[2])},i(g){o||(N(p,g),o=!0)},o(g){V(p,g),o=!1},d(g){g&&G(e),p&&p.d(g),u=!1,cr(s)}}}function IS(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function PS(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{marker:h=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:_=!0}=e,{asButton:x=!1}=e,{draggable:C=!1}=e,{feature:T=null}=e,{offset:z=void 0}=e,{zIndex:L=void 0}=e,{rotation:E=0}=e,{opacity:I=1}=e;const O=js(),{map:B,layerEvent:K,self:H,markerClickManager:q}=N4();st(r,B,Ie=>t(27,o=Ie)),st(r,K,Ie=>t(26,n=Ie)),st(r,H,Ie=>t(3,i=Ie));function J(Ie){ln(H,i=new ni.Marker({element:Ie,rotation:E,draggable:C,offset:z,opacity:I.toString()}).setLngLat(p).addTo(o),i),t(11,h=i);const ct=()=>ee("dragstart"),Xe=()=>{fe(),ee("drag")},lt=()=>{fe(),ee("dragend")};return C&&(i.on("dragstart",ct),i.on("drag",Xe),i.on("dragend",lt)),{destroy(){C&&(i==null||i.off("dragstart",ct),i==null||i.off("drag",Xe),i==null||i.off("dragend",lt)),t(11,h=void 0),i==null||i.remove()}}}function fe(){let Ie=i==null?void 0:i.getLngLat();Ie&&(Array.isArray(p)?t(10,p=[Ie.lng,Ie.lat]):p&&"lon"in p?t(10,p={lon:Ie.lng,lat:Ie.lat}):t(10,p=Ie))}function Ee(Ie){Ie.key===" "&&(Ie.preventDefault(),Ie.stopPropagation(),ee("click"))}function ee(Ie){if(!_)return;let ct=i==null?void 0:i.getLngLat();if(!ct)return;const Xe=[ct.lng,ct.lat];let lt={map:o,marker:i,lngLat:Xe,features:[{type:"Feature",properties:(T==null?void 0:T.properties)??{},geometry:{type:"Point",coordinates:Xe}}]};(Ie==="click"||Ie==="contextmenu")&&q.handleClick(lt),ln(K,n={...lt,layerType:"marker",type:Ie},n),O(Ie,lt)}const oe=()=>ee("click"),xe=()=>ee("dblclick"),me=()=>{ee("contextmenu")},tt=()=>{ee("mouseenter")},Ue=()=>{ee("mouseleave")},ze=()=>ee("mousemove");return r.$$set=Ie=>{"marker"in Ie&&t(11,h=Ie.marker),"lngLat"in Ie&&t(10,p=Ie.lngLat),"class"in Ie&&t(0,g=Ie.class),"interactive"in Ie&&t(12,_=Ie.interactive),"asButton"in Ie&&t(1,x=Ie.asButton),"draggable"in Ie&&t(13,C=Ie.draggable),"feature"in Ie&&t(14,T=Ie.feature),"offset"in Ie&&t(15,z=Ie.offset),"zIndex"in Ie&&t(2,L=Ie.zIndex),"rotation"in Ie&&t(16,E=Ie.rotation),"opacity"in Ie&&t(17,I=Ie.opacity),"$$scope"in Ie&&t(18,s=Ie.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(z??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(E)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[g,x,L,i,B,K,H,J,Ee,ee,p,h,_,C,T,z,E,I,s,u,oe,xe,me,tt,Ue,ze]}class lp extends Lt{constructor(e){super(),Et(this,e,PS,LS,St,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const zS=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),my=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function gy(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof ni.Marker)&&_y(r);return{c(){e=U("div"),n&&n.c()},m(o,u){W(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var s;(s=o[4])!=null&&s.length||o[3]instanceof ni.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=_y(o),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(o){t||(N(n),t=!0)},o(o){V(n),t=!1},d(o){o&&G(e),n&&n.d(),r[32](null)}}}function _y(r){let e;const t=r[30].default,n=vn(t,r,r[29],my);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,zS):xn(i[29]),my)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function DS(r){let e,t,n=r[9].default&&gy(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=gy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function RS(r,e,t){let n,i,o,u,s,h,{$$slots:p={},$$scope:g}=e;const _=Lg(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:z=!1}=e,{openOn:L="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:O=void 0}=e,{offset:B=void 0}=e,{popupClass:K=void 0}=e,{maxWidth:H=void 0}=e,{lngLat:q=void 0}=e,{html:J=void 0}=e,{open:fe=!1}=e;const Ee=js(),{map:ee,popupTarget:oe,layerEvent:xe,layer:me,eventTopMost:tt,markerClickManager:Ue}=Za();st(r,ee,de=>t(2,o=de)),st(r,oe,de=>t(3,s=de)),st(r,xe,de=>t(28,u=de)),st(r,me,de=>t(35,h=de));const ze=["click","dblclick","contextmenu"];let Ie,ct=!1,Xe;function lt(){if(!Ie)return;let de=Ie.getElement();!de||de===Xe||(Xe=de,L==="hover"&&(Xe.style.pointerEvents="none"),Xe.addEventListener("mouseenter",()=>{t(24,ct=!0)},{passive:!0}),Xe.addEventListener("mouseleave",()=>{t(24,ct=!1)},{passive:!0}),Xe.addEventListener("click",()=>{T&&t(0,fe=!1)},{passive:!0}))}ks(()=>{if(o)return o.on("click",yn),o.on("contextmenu",yn),Ue.add(qe),typeof s=="string"&&(o.on("click",s,Pt),o.on("dblclick",s,Pt),o.on("contextmenu",s,Pt),o.on("mousemove",s,pn),o.on("mouseleave",s,rn),o.on("touchstart",s,un),o.on("touchend",s,nn)),()=>{o!=null&&o.loaded()&&(Ie==null||Ie.remove(),o.off("click",yn),o.off("contextmenu",yn),Ue.remove(qe),s instanceof ni.Marker?s.getPopup()===Ie&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Pt),o.off("dblclick",s,Pt),o.off("contextmenu",s,Pt),o.off("mousemove",s,pn),o.off("mouseleave",s,rn),o.off("touchstart",s,un),o.off("touchend",s,nn)))}});function pt(de){return E?!("marker"in de)&&!j4(de)&&tt(de)!==h:!1}let _t=null,He="normal";function gt(de){"layerType"in de&&de.layerType==="deckgl"?(t(10,q=de.coordinate),t(4,_t=de.object?[de.object]:null)):(t(10,q=de.lngLat),t(4,_t=de.features??[]))}function Pt(de){de.type!==L||pt(de)||(gt(de),setTimeout(()=>t(0,fe=!0)))}let jt=null;function un(de){jt=de.point}function nn(de){if(!jt||L!=="hover")return;let cn=jt.dist(de.point);jt=null,cn<3&&(t(10,q=de.lngLat),t(4,_t=de.features??[]),Ie.isOpen()?t(25,He="justOpened"):(t(25,He="opening"),t(0,fe=!0)))}function rn(de){L!=="hover"||jt||He!=="normal"||(t(0,fe=!1),t(4,_t=null))}function pn(de){if(!(L!=="hover"||jt||He!=="normal")){if(pt(de)){t(0,fe=!1),t(4,_t=null);return}t(0,fe=!0),t(4,_t=de.features??[]),t(10,q=de.lngLat)}}function yn(de){if(He==="justOpened"){t(25,He="normal");return}if(!C)return;let cn=[Xe,s instanceof ni.Marker?s==null?void 0:s.getElement():null];fe&&Ie.isOpen()&&!cn.some(Ke=>Ke==null?void 0:Ke.contains(de.originalEvent.target))&&(de.type==="contextmenu"&&L==="contextmenu"||de.type!=="contextmenu")&&t(0,fe=!1)}function qe(de){C&&fe&&Ie.isOpen()&&de.marker!==s&&t(0,fe=!1)}ri(()=>{o&&(Ie!=null&&Ie.isOpen())&&Ie.remove()});let Ge;const At=()=>t(0,fe=!1);function nt(de){dn[de?"unshift":"push"](()=>{Ge=de,t(1,Ge)})}return r.$$set=de=>{"closeButton"in de&&t(11,x=de.closeButton),"closeOnClickOutside"in de&&t(12,C=de.closeOnClickOutside),"closeOnClickInside"in de&&t(13,T=de.closeOnClickInside),"closeOnMove"in de&&t(14,z=de.closeOnMove),"openOn"in de&&t(15,L=de.openOn),"openIfTopMost"in de&&t(16,E=de.openIfTopMost),"focusAfterOpen"in de&&t(17,I=de.focusAfterOpen),"anchor"in de&&t(18,O=de.anchor),"offset"in de&&t(19,B=de.offset),"popupClass"in de&&t(20,K=de.popupClass),"maxWidth"in de&&t(21,H=de.maxWidth),"lngLat"in de&&t(10,q=de.lngLat),"html"in de&&t(22,J=de.html),"open"in de&&t(0,fe=de.open),"$$scope"in de&&t(29,g=de.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(Ie||(t(23,Ie=new ni.Popup({closeButton:n,closeOnClick:!1,closeOnMove:z,focusAfterOpen:I,maxWidth:H,className:K,anchor:O,offset:B})),Xe=Ie.getElement(),Ie.on("open",()=>{t(0,fe=!0),lt(),Ee("open",Ie)}),Ie.on("close",()=>{t(0,fe=!1),Ee("close",Ie)}),Ie.on("hover",()=>{Ee("hover",Ie)}))),r.$$.dirty[0]&8421384&&Ie&&s instanceof ni.Marker&&(L==="click"?s.setPopup(Ie):s.getPopup()===Ie&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&ze.includes(L)&&(u==null?void 0:u.type)===L&&(Pt(u),ln(xe,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=L==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&L==="hover"&&xe&&(i&&u&&gt(u),t(0,fe=(i||ct)??!1)),r.$$.dirty[0]&12582914&&(Ge?Ie.setDOMContent(Ge):J&&Ie.setHTML(J)),r.$$.dirty[0]&8389632&&q&&Ie.setLngLat(q),r.$$.dirty[0]&41943045&&o){let de=Ie.isOpen();fe&&!de?(Ie.addTo(o),He==="opening"&&t(25,He="justOpened")):!fe&&de&&Ie.remove()}},[fe,Ge,o,s,_t,ee,oe,xe,me,_,q,x,C,T,z,L,E,I,O,B,K,H,J,Ie,ct,He,i,n,u,g,p,At,nt]}let Fw=class extends Lt{constructor(e){super(),Et(this,e,RS,DS,St,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Ju=Math.pow,Ji=(r,e,t)=>new Promise((n,i)=>{var o=h=>{try{s(t.next(h))}catch(p){i(p)}},u=h=>{try{s(t.throw(h))}catch(p){i(p)}},s=h=>h.done?n(h.value):Promise.resolve(h.value).then(o,u);s((t=t.apply(r,e)).next())}),Uo=Uint8Array,Xu=Uint16Array,BS=Int32Array,Ow=new Uo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$w=new Uo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),FS=new Uo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nw=function(r,e){for(var t=new Xu(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new BS(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},jw=Nw(Ow,2),Uw=jw.b,OS=jw.r;Uw[28]=258,OS[258]=28;var $S=Nw($w,0),NS=$S.b,ng=new Xu(32768);for(dr=0;dr<32768;++dr)ra=(dr&43690)>>1|(dr&21845)<<1,ra=(ra&52428)>>2|(ra&13107)<<2,ra=(ra&61680)>>4|(ra&3855)<<4,ng[dr]=((ra&65280)>>8|(ra&255)<<8)>>1;var ra,dr,Df=function(r,e,t){for(var n=r.length,i=0,o=new Xu(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Xu(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var s;if(t){s=new Xu(1<<e);var h=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],_=u[r[i]-1]++<<g,x=_|(1<<g)-1;_<=x;++_)s[ng[_]>>h]=p}else for(s=new Xu(n),i=0;i<n;++i)r[i]&&(s[i]=ng[u[r[i]-1]++]>>15-r[i]);return s},rh=new Uo(288);for(dr=0;dr<144;++dr)rh[dr]=8;var dr;for(dr=144;dr<256;++dr)rh[dr]=9;var dr;for(dr=256;dr<280;++dr)rh[dr]=7;var dr;for(dr=280;dr<288;++dr)rh[dr]=8;var dr,Vw=new Uo(32);for(dr=0;dr<32;++dr)Vw[dr]=5;var dr,jS=Df(rh,9,1),US=Df(Vw,5,1),Lm=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},gs=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Im=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},VS=function(r){return(r+7)/8|0},qS=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new Uo(t-e);return n.set(r.subarray(e,t)),n},HS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oo=function(r,e,t){var n=new Error(e||HS[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Oo),!t)throw n;return n},Xg=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new Uo(0);var u=!t||e.i!=2,s=e.i;t||(t=new Uo(i*3));var h=function(rn){var pn=t.length;if(rn>pn){var yn=new Uo(Math.max(pn*2,rn));yn.set(t),t=yn}},p=e.f||0,g=e.p||0,_=e.b||0,x=e.l,C=e.d,T=e.m,z=e.n,L=i*8;do{if(!x){p=gs(r,g,1);var E=gs(r,g+1,3);if(g+=3,E)if(E==1)x=jS,C=US,T=9,z=5;else if(E==2){var K=gs(r,g,31)+257,H=gs(r,g+10,15)+4,q=K+gs(r,g+5,31)+1;g+=14;for(var J=new Uo(q),fe=new Uo(19),Ee=0;Ee<H;++Ee)fe[FS[Ee]]=gs(r,g+Ee*3,7);g+=H*3;for(var ee=Lm(fe),oe=(1<<ee)-1,xe=Df(fe,ee,1),Ee=0;Ee<q;){var me=xe[gs(r,g,oe)];g+=me&15;var I=me>>4;if(I<16)J[Ee++]=I;else{var tt=0,Ue=0;for(I==16?(Ue=3+gs(r,g,3),g+=2,tt=J[Ee-1]):I==17?(Ue=3+gs(r,g,7),g+=3):I==18&&(Ue=11+gs(r,g,127),g+=7);Ue--;)J[Ee++]=tt}}var ze=J.subarray(0,K),Ie=J.subarray(K);T=Lm(ze),z=Lm(Ie),x=Df(ze,T,1),C=Df(Ie,z,1)}else Oo(1);else{var I=VS(g)+4,O=r[I-4]|r[I-3]<<8,B=I+O;if(B>i){s&&Oo(0);break}u&&h(_+O),t.set(r.subarray(I,B),_),e.b=_+=O,e.p=g=B*8,e.f=p;continue}if(g>L){s&&Oo(0);break}}u&&h(_+131072);for(var ct=(1<<T)-1,Xe=(1<<z)-1,lt=g;;lt=g){var tt=x[Im(r,g)&ct],pt=tt>>4;if(g+=tt&15,g>L){s&&Oo(0);break}if(tt||Oo(2),pt<256)t[_++]=pt;else if(pt==256){lt=g,x=null;break}else{var _t=pt-254;if(pt>264){var Ee=pt-257,He=Ow[Ee];_t=gs(r,g,(1<<He)-1)+Uw[Ee],g+=He}var gt=C[Im(r,g)&Xe],Pt=gt>>4;gt||Oo(3),g+=gt&15;var Ie=NS[Pt];if(Pt>3){var He=$w[Pt];Ie+=Im(r,g)&(1<<He)-1,g+=He}if(g>L){s&&Oo(0);break}u&&h(_+131072);var jt=_+_t;if(_<Ie){var un=o-Ie,nn=Math.min(Ie,jt);for(un+_<0&&Oo(3);_<nn;++_)t[_]=n[un+_]}for(;_<jt;_+=4)t[_]=t[_-Ie],t[_+1]=t[_+1-Ie],t[_+2]=t[_+2-Ie],t[_+3]=t[_+3-Ie];_=jt}}e.l=x,e.p=lt,e.b=_,e.f=p,x&&(p=1,e.m=T,e.d=C,e.n=z)}while(!p);return _==t.length?t:qS(t,0,_)},GS=new Uo(0),WS=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Oo(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},ZS=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},XS=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Oo(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Oo(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function KS(r,e){return Xg(r,{i:2},e&&e.out,e&&e.dictionary)}function JS(r,e){var t=WS(r);return t+8>r.length&&Oo(6,"invalid gzip data"),Xg(r.subarray(t,-8),{i:2},e&&e.out||new Uo(ZS(r)),e&&e.dictionary)}function YS(r,e){return Xg(r.subarray(XS(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function rg(r,e){return r[0]==31&&r[1]==139&&r[2]==8?JS(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?KS(r,e):YS(r,e)}var QS=typeof TextDecoder<"u"&&new TextDecoder,e5=0;try{QS.decode(GS,{stream:!0}),e5=1}catch{}var qw=(r,e)=>r*Ju(2,e),hf=(r,e)=>Math.floor(r/Ju(2,e)),Jd=(r,e)=>qw(r.getUint16(e+1,!0),8)+r.getUint8(e),Hw=(r,e)=>qw(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),t5=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=Jd(n,i+1);if(e!==o)return e-o;const u=Jd(n,i+4);return t!==u?t-u:0},n5=(r,e,t,n)=>{const i=Gw(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},yy=(r,e,t,n)=>{const i=Gw(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},Gw=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,s=t5(e,t,n,r,u*17);if(s>0)i=u+1;else if(s<0)o=u-1;else return[Hw(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},r5=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Ww=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Jd(r,e*17+1),y:Jd(r,e*17+4),offset:Hw(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},vy=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(Ww(t,n));return i5(e)},i5=r=>{r.sort(r5);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=hf(i.offset,8)&255,t[n*17+9]=hf(i.offset,16)&255,t[n*17+10]=hf(i.offset,24)&255,t[n*17+11]=hf(i.offset,32)&255,t[n*17+12]=hf(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},o5=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=Ww(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:s}}return null};function s5(r){return Ji(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let s=0;u.compression==="gzip"&&(s=2);let h=0;"minzoom"in u&&(h=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,_=0,x=0,C=-180,T=-85,z=180,L=85;if(u.bounds){const I=u.bounds.split(",");C=+I[0],T=+I[1],z=+I[2],L=+I[3]}if(u.center){const I=u.center.split(",");g=+I[0],_=+I[1],x=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:h,maxZoom:p,minLon:C,minLat:T,maxLon:z,maxLat:L,centerZoom:x,centerLon:g,centerLat:_,etag:e.etag}})}function a5(r,e,t,n,i,o,u){return Ji(this,null,function*(){let s=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(s=vy(s));const h=yy(new DataView(s),n,i,o);if(h){let _=(yield e.getBytes(h.offset,h.length,u)).data;const x=new DataView(_);return x.getUint8(0)===31&&x.getUint8(1)===139&&(_=rg(new Uint8Array(_))),{data:_}}const p=o5(new DataView(s),{z:n,x:i,y:o});if(p){const g=n5(new DataView(s),p.z,p.x,p.y);if(g){let _=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(_=vy(_));const x=yy(new DataView(_),n,i,o);if(x){let T=(yield e.getBytes(x.offset,x.length,u)).data;const z=new DataView(T);return z.getUint8(0)===31&&z.getUint8(1)===139&&(T=rg(new Uint8Array(T))),{data:T}}}}})}var Zw={getHeader:s5,getZxy:a5},l5=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},u5=class{constructor(){this.tilev4=(r,e)=>Ji(this,null,function*(){if(r.type==="json"){const _=r.url.substr(10);let x=this.tiles.get(_);x||(x=new by(_),this.tiles.set(_,x));const C=yield x.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new by(i),this.tiles.set(i,o));const u=n[2],s=n[3],h=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+s,+h,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=l5(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function ju(r,e){return(e>>>0)*4294967296+(r>>>0)}function c5(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return ju(r,i);throw new Error("Expected varint not more than 10 bytes")}function df(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,c5(n,r))}function f5(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var h5=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function d5(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Ju(2,r)-1||t>Ju(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=h5[r],i=Ju(2,r);let o=0,u=0,s=0;const h=[e,t];let p=i/2;for(;p>0;)o=(h[0]&p)>0?1:0,u=(h[1]&p)>0?1:0,s+=p*p*(3*o^u),f5(p,h,o,u),p=p/2;return n+s}function Xw(r,e){return Ji(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return rg(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var p5=127;function m5(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var g5=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Ji(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let s;this.mustReload&&(s="reload");let h=yield fetch(this.url,{signal:o,cache:s,headers:u});if(r===0&&h.status===416){const x=h.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const C=+x.substr(8);h=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${C-1}`}})}let p=h.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),h.status===416||n&&p&&p!==n)throw this.mustReload=!0,new ig(n);if(h.status>=300)throw Error(`Bad response code: ${h.status}`);const g=h.headers.get("Content-Length");if(h.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:p||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};function _s(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Ju(2,32)+n}function _5(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:_s(t,8),rootDirectoryLength:_s(t,16),jsonMetadataOffset:_s(t,24),jsonMetadataLength:_s(t,32),leafDirectoryOffset:_s(t,40),leafDirectoryLength:_s(t,48),tileDataOffset:_s(t,56),tileDataLength:_s(t,64),numAddressedTiles:_s(t,72),numTileEntries:_s(t,80),numTileContents:_s(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Kw(r){const e={buf:new Uint8Array(r),pos:0},t=df(e),n=[];let i=0;for(let o=0;o<t;o++){const u=df(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=df(e);for(let o=0;o<t;o++)n[o].length=df(e);for(let o=0;o<t;o++){const u=df(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function y5(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ig=class extends Error{};function v5(r,e){return Ji(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(y5(t.data)<3)return[yield Zw.getHeader(r)];const i=t.data.slice(0,p5),o=_5(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,h=Kw(yield e(u,o.internalCompression));return[o,[s,h.length,h]]})}function b5(r,e,t,n,i){return Ji(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),s=Kw(u);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var w5=class{constructor(r=100,e=!0,t=Xw){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Ji(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{v5(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Ji(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,h)=>{b5(r,this.decompress,e,t,n).then(p=>{s(p),this.prune()}).catch(p=>{h(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Ji(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,h)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{s(p.data),this.cache.has(i),this.prune()}).catch(p=>{h(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Ji(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},by=class{constructor(r,e,t){typeof r=="string"?this.source=new g5(r):this.source=r,t?this.decompress=t:this.decompress=Xw,e?this.cache=e:this.cache=new w5}getHeader(){return Ji(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Ji(this,null,function*(){const i=d5(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Zw.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let h=0;h<=3;h++){const p=yield this.cache.getDirectory(this.source,u,s,o),g=m5(p,i);if(g){if(g.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}u=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Ji(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof ig)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Ji(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Ji(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ig)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function x5(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function A5(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[x5]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new ap({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.applyToClusters=u[9]),s&1024&&(h.minzoom=u[10]),s&2048&&(h.maxzoom=u[11]),s&4096&&(h.hoverCursor=u[12]),s&8192&&(h.manageHoverState=u[13]),s&16384&&(h.eventsIfTopMost=u[14]),s&32768&&(h.interactive=u[15]),s&16777216&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function k5(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("symbol")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:B=!0}=e;function K(oe){I=oe,t(0,I)}function H(oe){Pn.call(this,r,oe)}function q(oe){Pn.call(this,r,oe)}function J(oe){Pn.call(this,r,oe)}function fe(oe){Pn.call(this,r,oe)}function Ee(oe){Pn.call(this,r,oe)}function ee(oe){Pn.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,o=oe.id),"source"in oe&&t(2,u=oe.source),"sourceLayer"in oe&&t(3,s=oe.sourceLayer),"beforeId"in oe&&t(4,h=oe.beforeId),"beforeLayerType"in oe&&t(5,p=oe.beforeLayerType),"paint"in oe&&t(6,g=oe.paint),"layout"in oe&&t(7,_=oe.layout),"filter"in oe&&t(8,x=oe.filter),"applyToClusters"in oe&&t(9,C=oe.applyToClusters),"minzoom"in oe&&t(10,T=oe.minzoom),"maxzoom"in oe&&t(11,z=oe.maxzoom),"hoverCursor"in oe&&t(12,L=oe.hoverCursor),"manageHoverState"in oe&&t(13,E=oe.manageHoverState),"hovered"in oe&&t(0,I=oe.hovered),"eventsIfTopMost"in oe&&t(14,O=oe.eventsIfTopMost),"interactive"in oe&&t(15,B=oe.interactive),"$$scope"in oe&&t(24,i=oe.$$scope)},[I,o,u,s,h,p,g,_,x,C,T,z,L,E,O,B,n,K,H,q,J,fe,Ee,ee,i]}class nc extends Lt{constructor(e){super(),Et(this,e,k5,A5,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function wy(r){let e=r[0],t,n,i=xy(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=xy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function xy(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function S5(r){let e,t,n=r[0]&&wy(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=wy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function C5(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:s=Ol("vector")}=e,{url:h=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:_=null}=e,{scheme:x=null}=e,{attribution:C=null}=e,{minzoom:T=null}=e,{maxzoom:z=null}=e,{volatile:L=null}=e;if(h&&h.includes("pmtiles://")&&!ni.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let B=new u5;ni.addProtocol("pmtiles",B.tile)}const{map:E,self:I}=Ew();st(r,E,B=>t(13,i=B)),st(r,I,B=>t(0,n=B));let O;return ri(()=>{n&&i&&(Dw(E,n,O),ln(I,n=null,n),O=void 0)}),r.$$set=B=>{"id"in B&&t(3,s=B.id),"url"in B&&t(4,h=B.url),"tiles"in B&&t(5,p=B.tiles),"promoteId"in B&&t(6,g=B.promoteId),"bounds"in B&&t(7,_=B.bounds),"scheme"in B&&t(8,x=B.scheme),"attribution"in B&&t(9,C=B.attribution),"minzoom"in B&&t(10,T=B.minzoom),"maxzoom"in B&&t(11,z=B.maxzoom),"volatile"in B&&t(12,L=B.volatile),"$$scope"in B&&t(14,u=B.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==s&&(ln(I,n=s,n),zw(i,n,ja({type:"vector",url:h,tiles:p,promoteId:g,bounds:_,scheme:x,attribution:C,minzoom:T,maxzoom:z,volatile:L}),B=>i&&B===n,()=>{n&&(O=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{O=i==null?void 0:i.getSource(s)}))},[n,E,I,s,h,p,g,_,x,C,T,z,L,i,u,o]}class ih extends Lt{constructor(e){super(),Et(this,e,C5,S5,St,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}var bo="top",ls="bottom",us="right",wo="left",Kg="auto",oh=[bo,ls,us,wo],rc="start",Hf="end",T5="clippingParents",Jw="viewport",pf="popper",M5="reference",Ay=oh.reduce(function(r,e){return r.concat([e+"-"+rc,e+"-"+Hf])},[]),Yw=[].concat(oh,[Kg]).reduce(function(r,e){return r.concat([e,e+"-"+rc,e+"-"+Hf])},[]),E5="beforeRead",L5="read",I5="afterRead",P5="beforeMain",z5="main",D5="afterMain",R5="beforeWrite",B5="write",F5="afterWrite",O5=[E5,L5,I5,P5,z5,D5,R5,B5,F5];function Ns(r){return r?(r.nodeName||"").toLowerCase():null}function Vo(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Bl(r){var e=Vo(r).Element;return r instanceof e||r instanceof Element}function is(r){var e=Vo(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Jg(r){if(typeof ShadowRoot>"u")return!1;var e=Vo(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function $5(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];!is(o)||!Ns(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(u){var s=i[u];s===!1?o.removeAttribute(u):o.setAttribute(u,s===!0?"":s)}))})}function N5(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),s=u.reduce(function(h,p){return h[p]="",h},{});!is(i)||!Ns(i)||(Object.assign(i.style,s),Object.keys(o).forEach(function(h){i.removeAttribute(h)}))})}}const Qw={name:"applyStyles",enabled:!0,phase:"write",fn:$5,effect:N5,requires:["computeStyles"]};function Os(r){return r.split("-")[0]}var zl=Math.max,Yd=Math.min,ic=Math.round;function og(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function e2(){return!/^((?!chrome|android).)*safari/i.test(og())}function oc(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=r.getBoundingClientRect(),i=1,o=1;e&&is(r)&&(i=r.offsetWidth>0&&ic(n.width)/r.offsetWidth||1,o=r.offsetHeight>0&&ic(n.height)/r.offsetHeight||1);var u=Bl(r)?Vo(r):window,s=u.visualViewport,h=!e2()&&t,p=(n.left+(h&&s?s.offsetLeft:0))/i,g=(n.top+(h&&s?s.offsetTop:0))/o,_=n.width/i,x=n.height/o;return{width:_,height:x,top:g,right:p+_,bottom:g+x,left:p,x:p,y:g}}function Yg(r){var e=oc(r),t=r.offsetWidth,n=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:n}}function t2(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Jg(t)){var n=e;do{if(n&&r.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function ca(r){return Vo(r).getComputedStyle(r)}function j5(r){return["table","td","th"].indexOf(Ns(r))>=0}function Xa(r){return((Bl(r)?r.ownerDocument:r.document)||window.document).documentElement}function up(r){return Ns(r)==="html"?r:r.assignedSlot||r.parentNode||(Jg(r)?r.host:null)||Xa(r)}function ky(r){return!is(r)||ca(r).position==="fixed"?null:r.offsetParent}function U5(r){var e=/firefox/i.test(og()),t=/Trident/i.test(og());if(t&&is(r)){var n=ca(r);if(n.position==="fixed")return null}var i=up(r);for(Jg(i)&&(i=i.host);is(i)&&["html","body"].indexOf(Ns(i))<0;){var o=ca(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function sh(r){for(var e=Vo(r),t=ky(r);t&&j5(t)&&ca(t).position==="static";)t=ky(t);return t&&(Ns(t)==="html"||Ns(t)==="body"&&ca(t).position==="static")?e:t||U5(r)||e}function Qg(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Rf(r,e,t){return zl(r,Yd(e,t))}function V5(r,e,t){var n=Rf(r,e,t);return n>t?t:n}function n2(){return{top:0,right:0,bottom:0,left:0}}function r2(r){return Object.assign({},n2(),r)}function i2(r,e){return e.reduce(function(t,n){return t[n]=r,t},{})}var q5=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,r2(typeof e!="number"?e:i2(e,oh))};function H5(r){var e,t=r.state,n=r.name,i=r.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,s=Os(t.placement),h=Qg(s),p=[wo,us].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!u)){var _=q5(i.padding,t),x=Yg(o),C=h==="y"?bo:wo,T=h==="y"?ls:us,z=t.rects.reference[g]+t.rects.reference[h]-u[h]-t.rects.popper[g],L=u[h]-t.rects.reference[h],E=sh(o),I=E?h==="y"?E.clientHeight||0:E.clientWidth||0:0,O=z/2-L/2,B=_[C],K=I-x[g]-_[T],H=I/2-x[g]/2+O,q=Rf(B,H,K),J=h;t.modifiersData[n]=(e={},e[J]=q,e.centerOffset=q-H,e)}}function G5(r){var e=r.state,t=r.options,n=t.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||t2(e.elements.popper,i)&&(e.elements.arrow=i))}const W5={name:"arrow",enabled:!0,phase:"main",fn:H5,effect:G5,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function sc(r){return r.split("-")[1]}var Z5={top:"auto",right:"auto",bottom:"auto",left:"auto"};function X5(r,e){var t=r.x,n=r.y,i=e.devicePixelRatio||1;return{x:ic(t*i)/i||0,y:ic(n*i)/i||0}}function Sy(r){var e,t=r.popper,n=r.popperRect,i=r.placement,o=r.variation,u=r.offsets,s=r.position,h=r.gpuAcceleration,p=r.adaptive,g=r.roundOffsets,_=r.isFixed,x=u.x,C=x===void 0?0:x,T=u.y,z=T===void 0?0:T,L=typeof g=="function"?g({x:C,y:z}):{x:C,y:z};C=L.x,z=L.y;var E=u.hasOwnProperty("x"),I=u.hasOwnProperty("y"),O=wo,B=bo,K=window;if(p){var H=sh(t),q="clientHeight",J="clientWidth";if(H===Vo(t)&&(H=Xa(t),ca(H).position!=="static"&&s==="absolute"&&(q="scrollHeight",J="scrollWidth")),H=H,i===bo||(i===wo||i===us)&&o===Hf){B=ls;var fe=_&&H===K&&K.visualViewport?K.visualViewport.height:H[q];z-=fe-n.height,z*=h?1:-1}if(i===wo||(i===bo||i===ls)&&o===Hf){O=us;var Ee=_&&H===K&&K.visualViewport?K.visualViewport.width:H[J];C-=Ee-n.width,C*=h?1:-1}}var ee=Object.assign({position:s},p&&Z5),oe=g===!0?X5({x:C,y:z},Vo(t)):{x:C,y:z};if(C=oe.x,z=oe.y,h){var xe;return Object.assign({},ee,(xe={},xe[B]=I?"0":"",xe[O]=E?"0":"",xe.transform=(K.devicePixelRatio||1)<=1?"translate("+C+"px, "+z+"px)":"translate3d("+C+"px, "+z+"px, 0)",xe))}return Object.assign({},ee,(e={},e[B]=I?z+"px":"",e[O]=E?C+"px":"",e.transform="",e))}function K5(r){var e=r.state,t=r.options,n=t.gpuAcceleration,i=n===void 0?!0:n,o=t.adaptive,u=o===void 0?!0:o,s=t.roundOffsets,h=s===void 0?!0:s,p={placement:Os(e.placement),variation:sc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Sy(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:h})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Sy(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:h})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const J5={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:K5,data:{}};var xd={passive:!0};function Y5(r){var e=r.state,t=r.instance,n=r.options,i=n.scroll,o=i===void 0?!0:i,u=n.resize,s=u===void 0?!0:u,h=Vo(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,xd)}),s&&h.addEventListener("resize",t.update,xd),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,xd)}),s&&h.removeEventListener("resize",t.update,xd)}}const Q5={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Y5,data:{}};var eC={left:"right",right:"left",bottom:"top",top:"bottom"};function Rd(r){return r.replace(/left|right|bottom|top/g,function(e){return eC[e]})}var tC={start:"end",end:"start"};function Cy(r){return r.replace(/start|end/g,function(e){return tC[e]})}function e_(r){var e=Vo(r),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function t_(r){return oc(Xa(r)).left+e_(r).scrollLeft}function nC(r,e){var t=Vo(r),n=Xa(r),i=t.visualViewport,o=n.clientWidth,u=n.clientHeight,s=0,h=0;if(i){o=i.width,u=i.height;var p=e2();(p||!p&&e==="fixed")&&(s=i.offsetLeft,h=i.offsetTop)}return{width:o,height:u,x:s+t_(r),y:h}}function rC(r){var e,t=Xa(r),n=e_(r),i=(e=r.ownerDocument)==null?void 0:e.body,o=zl(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=zl(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-n.scrollLeft+t_(r),h=-n.scrollTop;return ca(i||t).direction==="rtl"&&(s+=zl(t.clientWidth,i?i.clientWidth:0)-o),{width:o,height:u,x:s,y:h}}function n_(r){var e=ca(r),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function o2(r){return["html","body","#document"].indexOf(Ns(r))>=0?r.ownerDocument.body:is(r)&&n_(r)?r:o2(up(r))}function Bf(r,e){var t;e===void 0&&(e=[]);var n=o2(r),i=n===((t=r.ownerDocument)==null?void 0:t.body),o=Vo(n),u=i?[o].concat(o.visualViewport||[],n_(n)?n:[]):n,s=e.concat(u);return i?s:s.concat(Bf(up(u)))}function sg(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function iC(r,e){var t=oc(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Ty(r,e,t){return e===Jw?sg(nC(r,t)):Bl(e)?iC(e,t):sg(rC(Xa(r)))}function oC(r){var e=Bf(up(r)),t=["absolute","fixed"].indexOf(ca(r).position)>=0,n=t&&is(r)?sh(r):r;return Bl(n)?e.filter(function(i){return Bl(i)&&t2(i,n)&&Ns(i)!=="body"}):[]}function sC(r,e,t,n){var i=e==="clippingParents"?oC(r):[].concat(e),o=[].concat(i,[t]),u=o[0],s=o.reduce(function(h,p){var g=Ty(r,p,n);return h.top=zl(g.top,h.top),h.right=Yd(g.right,h.right),h.bottom=Yd(g.bottom,h.bottom),h.left=zl(g.left,h.left),h},Ty(r,u,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function s2(r){var e=r.reference,t=r.element,n=r.placement,i=n?Os(n):null,o=n?sc(n):null,u=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,h;switch(i){case bo:h={x:u,y:e.y-t.height};break;case ls:h={x:u,y:e.y+e.height};break;case us:h={x:e.x+e.width,y:s};break;case wo:h={x:e.x-t.width,y:s};break;default:h={x:e.x,y:e.y}}var p=i?Qg(i):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case rc:h[p]=h[p]-(e[g]/2-t[g]/2);break;case Hf:h[p]=h[p]+(e[g]/2-t[g]/2);break}}return h}function Gf(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?r.placement:n,o=t.strategy,u=o===void 0?r.strategy:o,s=t.boundary,h=s===void 0?T5:s,p=t.rootBoundary,g=p===void 0?Jw:p,_=t.elementContext,x=_===void 0?pf:_,C=t.altBoundary,T=C===void 0?!1:C,z=t.padding,L=z===void 0?0:z,E=r2(typeof L!="number"?L:i2(L,oh)),I=x===pf?M5:pf,O=r.rects.popper,B=r.elements[T?I:x],K=sC(Bl(B)?B:B.contextElement||Xa(r.elements.popper),h,g,u),H=oc(r.elements.reference),q=s2({reference:H,element:O,strategy:"absolute",placement:i}),J=sg(Object.assign({},O,q)),fe=x===pf?J:H,Ee={top:K.top-fe.top+E.top,bottom:fe.bottom-K.bottom+E.bottom,left:K.left-fe.left+E.left,right:fe.right-K.right+E.right},ee=r.modifiersData.offset;if(x===pf&&ee){var oe=ee[i];Object.keys(Ee).forEach(function(xe){var me=[us,ls].indexOf(xe)>=0?1:-1,tt=[bo,ls].indexOf(xe)>=0?"y":"x";Ee[xe]+=oe[tt]*me})}return Ee}function aC(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=t.boundary,o=t.rootBoundary,u=t.padding,s=t.flipVariations,h=t.allowedAutoPlacements,p=h===void 0?Yw:h,g=sc(n),_=g?s?Ay:Ay.filter(function(T){return sc(T)===g}):oh,x=_.filter(function(T){return p.indexOf(T)>=0});x.length===0&&(x=_);var C=x.reduce(function(T,z){return T[z]=Gf(r,{placement:z,boundary:i,rootBoundary:o,padding:u})[Os(z)],T},{});return Object.keys(C).sort(function(T,z){return C[T]-C[z]})}function lC(r){if(Os(r)===Kg)return[];var e=Rd(r);return[Cy(r),e,Cy(e)]}function uC(r){var e=r.state,t=r.options,n=r.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!0:u,h=t.fallbackPlacements,p=t.padding,g=t.boundary,_=t.rootBoundary,x=t.altBoundary,C=t.flipVariations,T=C===void 0?!0:C,z=t.allowedAutoPlacements,L=e.options.placement,E=Os(L),I=E===L,O=h||(I||!T?[Rd(L)]:lC(L)),B=[L].concat(O).reduce(function(He,gt){return He.concat(Os(gt)===Kg?aC(e,{placement:gt,boundary:g,rootBoundary:_,padding:p,flipVariations:T,allowedAutoPlacements:z}):gt)},[]),K=e.rects.reference,H=e.rects.popper,q=new Map,J=!0,fe=B[0],Ee=0;Ee<B.length;Ee++){var ee=B[Ee],oe=Os(ee),xe=sc(ee)===rc,me=[bo,ls].indexOf(oe)>=0,tt=me?"width":"height",Ue=Gf(e,{placement:ee,boundary:g,rootBoundary:_,altBoundary:x,padding:p}),ze=me?xe?us:wo:xe?ls:bo;K[tt]>H[tt]&&(ze=Rd(ze));var Ie=Rd(ze),ct=[];if(o&&ct.push(Ue[oe]<=0),s&&ct.push(Ue[ze]<=0,Ue[Ie]<=0),ct.every(function(He){return He})){fe=ee,J=!1;break}q.set(ee,ct)}if(J)for(var Xe=T?3:1,lt=function(gt){var Pt=B.find(function(jt){var un=q.get(jt);if(un)return un.slice(0,gt).every(function(nn){return nn})});if(Pt)return fe=Pt,"break"},pt=Xe;pt>0;pt--){var _t=lt(pt);if(_t==="break")break}e.placement!==fe&&(e.modifiersData[n]._skip=!0,e.placement=fe,e.reset=!0)}}const cC={name:"flip",enabled:!0,phase:"main",fn:uC,requiresIfExists:["offset"],data:{_skip:!1}};function My(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function Ey(r){return[bo,us,ls,wo].some(function(e){return r[e]>=0})}function fC(r){var e=r.state,t=r.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,u=Gf(e,{elementContext:"reference"}),s=Gf(e,{altBoundary:!0}),h=My(u,n),p=My(s,i,o),g=Ey(h),_=Ey(p);e.modifiersData[t]={referenceClippingOffsets:h,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":_})}const hC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:fC};function dC(r,e,t){var n=Os(r),i=[wo,bo].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,u=o[0],s=o[1];return u=u||0,s=(s||0)*i,[wo,us].indexOf(n)>=0?{x:s,y:u}:{x:u,y:s}}function pC(r){var e=r.state,t=r.options,n=r.name,i=t.offset,o=i===void 0?[0,0]:i,u=Yw.reduce(function(g,_){return g[_]=dC(_,e.rects,o),g},{}),s=u[e.placement],h=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=h,e.modifiersData.popperOffsets.y+=p),e.modifiersData[n]=u}const mC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:pC};function gC(r){var e=r.state,t=r.name;e.modifiersData[t]=s2({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const _C={name:"popperOffsets",enabled:!0,phase:"read",fn:gC,data:{}};function yC(r){return r==="x"?"y":"x"}function vC(r){var e=r.state,t=r.options,n=r.name,i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!1:u,h=t.boundary,p=t.rootBoundary,g=t.altBoundary,_=t.padding,x=t.tether,C=x===void 0?!0:x,T=t.tetherOffset,z=T===void 0?0:T,L=Gf(e,{boundary:h,rootBoundary:p,padding:_,altBoundary:g}),E=Os(e.placement),I=sc(e.placement),O=!I,B=Qg(E),K=yC(B),H=e.modifiersData.popperOffsets,q=e.rects.reference,J=e.rects.popper,fe=typeof z=="function"?z(Object.assign({},e.rects,{placement:e.placement})):z,Ee=typeof fe=="number"?{mainAxis:fe,altAxis:fe}:Object.assign({mainAxis:0,altAxis:0},fe),ee=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,oe={x:0,y:0};if(H){if(o){var xe,me=B==="y"?bo:wo,tt=B==="y"?ls:us,Ue=B==="y"?"height":"width",ze=H[B],Ie=ze+L[me],ct=ze-L[tt],Xe=C?-J[Ue]/2:0,lt=I===rc?q[Ue]:J[Ue],pt=I===rc?-J[Ue]:-q[Ue],_t=e.elements.arrow,He=C&&_t?Yg(_t):{width:0,height:0},gt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:n2(),Pt=gt[me],jt=gt[tt],un=Rf(0,q[Ue],He[Ue]),nn=O?q[Ue]/2-Xe-un-Pt-Ee.mainAxis:lt-un-Pt-Ee.mainAxis,rn=O?-q[Ue]/2+Xe+un+jt+Ee.mainAxis:pt+un+jt+Ee.mainAxis,pn=e.elements.arrow&&sh(e.elements.arrow),yn=pn?B==="y"?pn.clientTop||0:pn.clientLeft||0:0,qe=(xe=ee==null?void 0:ee[B])!=null?xe:0,Ge=ze+nn-qe-yn,At=ze+rn-qe,nt=Rf(C?Yd(Ie,Ge):Ie,ze,C?zl(ct,At):ct);H[B]=nt,oe[B]=nt-ze}if(s){var de,cn=B==="x"?bo:wo,Ke=B==="x"?ls:us,ut=H[K],Gt=K==="y"?"height":"width",Jn=ut+L[cn],Zn=ut-L[Ke],fr=[bo,wo].indexOf(E)!==-1,Cr=(de=ee==null?void 0:ee[K])!=null?de:0,Tr=fr?Jn:ut-q[Gt]-J[Gt]-Cr+Ee.altAxis,xi=fr?ut+q[Gt]+J[Gt]-Cr-Ee.altAxis:Zn,Un=C&&fr?V5(Tr,ut,xi):Rf(C?Tr:Jn,ut,C?xi:Zn);H[K]=Un,oe[K]=Un-ut}e.modifiersData[n]=oe}}const bC={name:"preventOverflow",enabled:!0,phase:"main",fn:vC,requiresIfExists:["offset"]};function wC(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function xC(r){return r===Vo(r)||!is(r)?e_(r):wC(r)}function AC(r){var e=r.getBoundingClientRect(),t=ic(e.width)/r.offsetWidth||1,n=ic(e.height)/r.offsetHeight||1;return t!==1||n!==1}function kC(r,e,t){t===void 0&&(t=!1);var n=is(e),i=is(e)&&AC(e),o=Xa(e),u=oc(r,i,t),s={scrollLeft:0,scrollTop:0},h={x:0,y:0};return(n||!n&&!t)&&((Ns(e)!=="body"||n_(o))&&(s=xC(e)),is(e)?(h=oc(e,!0),h.x+=e.clientLeft,h.y+=e.clientTop):o&&(h.x=t_(o))),{x:u.left+s.scrollLeft-h.x,y:u.top+s.scrollTop-h.y,width:u.width,height:u.height}}function SC(r){var e=new Map,t=new Set,n=[];r.forEach(function(o){e.set(o.name,o)});function i(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(s){if(!t.has(s)){var h=e.get(s);h&&i(h)}}),n.push(o)}return r.forEach(function(o){t.has(o.name)||i(o)}),n}function CC(r){var e=SC(r);return O5.reduce(function(t,n){return t.concat(e.filter(function(i){return i.phase===n}))},[])}function TC(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function MC(r){var e=r.reduce(function(t,n){var i=t[n.name];return t[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var Ly={placement:"bottom",modifiers:[],strategy:"absolute"};function Iy(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function EC(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?Ly:i;return function(s,h,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ly,o),modifiersData:{},elements:{reference:s,popper:h},attributes:{},styles:{}},_=[],x=!1,C={state:g,setOptions:function(E){var I=typeof E=="function"?E(g.options):E;z(),g.options=Object.assign({},o,g.options,I),g.scrollParents={reference:Bl(s)?Bf(s):s.contextElement?Bf(s.contextElement):[],popper:Bf(h)};var O=CC(MC([].concat(n,g.options.modifiers)));return g.orderedModifiers=O.filter(function(B){return B.enabled}),T(),C.update()},forceUpdate:function(){if(!x){var E=g.elements,I=E.reference,O=E.popper;if(Iy(I,O)){g.rects={reference:kC(I,sh(O),g.options.strategy==="fixed"),popper:Yg(O)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(Ee){return g.modifiersData[Ee.name]=Object.assign({},Ee.data)});for(var B=0;B<g.orderedModifiers.length;B++){if(g.reset===!0){g.reset=!1,B=-1;continue}var K=g.orderedModifiers[B],H=K.fn,q=K.options,J=q===void 0?{}:q,fe=K.name;typeof H=="function"&&(g=H({state:g,options:J,name:fe,instance:C})||g)}}}},update:TC(function(){return new Promise(function(L){C.forceUpdate(),L(g)})}),destroy:function(){z(),x=!0}};if(!Iy(s,h))return C;C.setOptions(p).then(function(L){!x&&p.onFirstUpdate&&p.onFirstUpdate(L)});function T(){g.orderedModifiers.forEach(function(L){var E=L.name,I=L.options,O=I===void 0?{}:I,B=L.effect;if(typeof B=="function"){var K=B({state:g,name:E,instance:C,options:O}),H=function(){};_.push(K||H)}})}function z(){_.forEach(function(L){return L()}),_=[]}return C}}var LC=[Q5,_C,J5,Qw,mC,cC,bC,W5,hC],IC=EC({defaultModifiers:LC}),PC="tippy-box",a2="tippy-content",zC="tippy-backdrop",l2="tippy-arrow",u2="tippy-svg-arrow",El={passive:!0,capture:!0},c2=function(){return document.body};function Pm(r,e,t){if(Array.isArray(r)){var n=r[e];return n??(Array.isArray(t)?t[e]:t)}return r}function r_(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function f2(r,e){return typeof r=="function"?r.apply(void 0,e):r}function Py(r,e){if(e===0)return r;var t;return function(n){clearTimeout(t),t=setTimeout(function(){r(n)},e)}}function DC(r){return r.split(/\s+/).filter(Boolean)}function Gu(r){return[].concat(r)}function zy(r,e){r.indexOf(e)===-1&&r.push(e)}function RC(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function BC(r){return r.split("-")[0]}function Qd(r){return[].slice.call(r)}function Dy(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function Ff(){return document.createElement("div")}function cp(r){return["Element","Fragment"].some(function(e){return r_(r,e)})}function FC(r){return r_(r,"NodeList")}function OC(r){return r_(r,"MouseEvent")}function $C(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function NC(r){return cp(r)?[r]:FC(r)?Qd(r):Array.isArray(r)?r:Qd(document.querySelectorAll(r))}function zm(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Ry(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function jC(r){var e,t=Gu(r),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function UC(r,e){var t=e.clientX,n=e.clientY;return r.every(function(i){var o=i.popperRect,u=i.popperState,s=i.props,h=s.interactiveBorder,p=BC(u.placement),g=u.modifiersData.offset;if(!g)return!0;var _=p==="bottom"?g.top.y:0,x=p==="top"?g.bottom.y:0,C=p==="right"?g.left.x:0,T=p==="left"?g.right.x:0,z=o.top-n+_>h,L=n-o.bottom-x>h,E=o.left-t+C>h,I=t-o.right-T>h;return z||L||E||I})}function Dm(r,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){r[n](i,t)})}function By(r,e){for(var t=e;t;){var n;if(r.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Fs={isTouch:!1},Fy=0;function VC(){Fs.isTouch||(Fs.isTouch=!0,window.performance&&document.addEventListener("mousemove",h2))}function h2(){var r=performance.now();r-Fy<20&&(Fs.isTouch=!1,document.removeEventListener("mousemove",h2)),Fy=r}function qC(){var r=document.activeElement;if($C(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function HC(){document.addEventListener("touchstart",VC,El),window.addEventListener("blur",qC)}var GC=typeof window<"u"&&typeof document<"u",WC=GC?!!window.msCrypto:!1,ZC={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},XC={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},vs=Object.assign({appendTo:c2,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},ZC,XC),KC=Object.keys(vs),JC=function(e){var t=Object.keys(e);t.forEach(function(n){vs[n]=e[n]})};function d2(r){var e=r.plugins||[],t=e.reduce(function(n,i){var o=i.name,u=i.defaultValue;if(o){var s;n[o]=r[o]!==void 0?r[o]:(s=vs[o])!=null?s:u}return n},{});return Object.assign({},r,t)}function YC(r,e){var t=e?Object.keys(d2(Object.assign({},vs,{plugins:e}))):KC,n=t.reduce(function(i,o){var u=(r.getAttribute("data-tippy-"+o)||"").trim();if(!u)return i;if(o==="content")i[o]=u;else try{i[o]=JSON.parse(u)}catch{i[o]=u}return i},{});return n}function Oy(r,e){var t=Object.assign({},e,{content:f2(e.content,[r])},e.ignoreAttributes?{}:YC(r,e.plugins));return t.aria=Object.assign({},vs.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var QC=function(){return"innerHTML"};function ag(r,e){r[QC()]=e}function $y(r){var e=Ff();return r===!0?e.className=l2:(e.className=u2,cp(r)?e.appendChild(r):ag(e,r)),e}function Ny(r,e){cp(e.content)?(ag(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?ag(r,e.content):r.textContent=e.content)}function lg(r){var e=r.firstElementChild,t=Qd(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(a2)}),arrow:t.find(function(n){return n.classList.contains(l2)||n.classList.contains(u2)}),backdrop:t.find(function(n){return n.classList.contains(zC)})}}function p2(r){var e=Ff(),t=Ff();t.className=PC,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Ff();n.className=a2,n.setAttribute("data-state","hidden"),Ny(n,r.props),e.appendChild(t),t.appendChild(n),i(r.props,r.props);function i(o,u){var s=lg(e),h=s.box,p=s.content,g=s.arrow;u.theme?h.setAttribute("data-theme",u.theme):h.removeAttribute("data-theme"),typeof u.animation=="string"?h.setAttribute("data-animation",u.animation):h.removeAttribute("data-animation"),u.inertia?h.setAttribute("data-inertia",""):h.removeAttribute("data-inertia"),h.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?h.setAttribute("role",u.role):h.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&Ny(p,r.props),u.arrow?g?o.arrow!==u.arrow&&(h.removeChild(g),h.appendChild($y(u.arrow))):h.appendChild($y(u.arrow)):g&&h.removeChild(g)}return{popper:e,onUpdate:i}}p2.$$tippy=!0;var eT=1,Ad=[],Rm=[];function tT(r,e){var t=Oy(r,Object.assign({},vs,d2(Dy(e)))),n,i,o,u=!1,s=!1,h=!1,p=!1,g,_,x,C=[],T=Py(Ge,t.interactiveDebounce),z,L=eT++,E=null,I=RC(t.plugins),O={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},B={id:L,reference:r,popper:Ff(),popperInstance:E,props:t,state:O,plugins:I,clearDelayTimeouts:Tr,setProps:xi,setContent:Un,show:xt,hide:zr,hideWithInteractivity:br,enable:fr,disable:Cr,unmount:Fi,destroy:$n};if(!t.render)return B;var K=t.render(B),H=K.popper,q=K.onUpdate;H.setAttribute("data-tippy-root",""),H.id="tippy-"+B.id,B.popper=H,r._tippy=B,H._tippy=B;var J=I.map(function(Fe){return Fe.fn(B)}),fe=r.hasAttribute("aria-expanded");return pn(),Xe(),ze(),Ie("onCreate",[B]),t.showOnCreate&&Jn(),H.addEventListener("mouseenter",function(){B.props.interactive&&B.state.isVisible&&B.clearDelayTimeouts()}),H.addEventListener("mouseleave",function(){B.props.interactive&&B.props.trigger.indexOf("mouseenter")>=0&&me().addEventListener("mousemove",T)}),B;function Ee(){var Fe=B.props.touch;return Array.isArray(Fe)?Fe:[Fe,0]}function ee(){return Ee()[0]==="hold"}function oe(){var Fe;return!!((Fe=B.props.render)!=null&&Fe.$$tippy)}function xe(){return z||r}function me(){var Fe=xe().parentNode;return Fe?jC(Fe):document}function tt(){return lg(H)}function Ue(Fe){return B.state.isMounted&&!B.state.isVisible||Fs.isTouch||g&&g.type==="focus"?0:Pm(B.props.delay,Fe?0:1,vs.delay)}function ze(Fe){Fe===void 0&&(Fe=!1),H.style.pointerEvents=B.props.interactive&&!Fe?"":"none",H.style.zIndex=""+B.props.zIndex}function Ie(Fe,yt,bt){if(bt===void 0&&(bt=!0),J.forEach(function(Qt){Qt[Fe]&&Qt[Fe].apply(Qt,yt)}),bt){var Rt;(Rt=B.props)[Fe].apply(Rt,yt)}}function ct(){var Fe=B.props.aria;if(Fe.content){var yt="aria-"+Fe.content,bt=H.id,Rt=Gu(B.props.triggerTarget||r);Rt.forEach(function(Qt){var Yt=Qt.getAttribute(yt);if(B.state.isVisible)Qt.setAttribute(yt,Yt?Yt+" "+bt:bt);else{var vr=Yt&&Yt.replace(bt,"").trim();vr?Qt.setAttribute(yt,vr):Qt.removeAttribute(yt)}})}}function Xe(){if(!(fe||!B.props.aria.expanded)){var Fe=Gu(B.props.triggerTarget||r);Fe.forEach(function(yt){B.props.interactive?yt.setAttribute("aria-expanded",B.state.isVisible&&yt===xe()?"true":"false"):yt.removeAttribute("aria-expanded")})}}function lt(){me().removeEventListener("mousemove",T),Ad=Ad.filter(function(Fe){return Fe!==T})}function pt(Fe){if(!(Fs.isTouch&&(h||Fe.type==="mousedown"))){var yt=Fe.composedPath&&Fe.composedPath()[0]||Fe.target;if(!(B.props.interactive&&By(H,yt))){if(Gu(B.props.triggerTarget||r).some(function(bt){return By(bt,yt)})){if(Fs.isTouch||B.state.isVisible&&B.props.trigger.indexOf("click")>=0)return}else Ie("onClickOutside",[B,Fe]);B.props.hideOnClick===!0&&(B.clearDelayTimeouts(),B.hide(),s=!0,setTimeout(function(){s=!1}),B.state.isMounted||Pt())}}}function _t(){h=!0}function He(){h=!1}function gt(){var Fe=me();Fe.addEventListener("mousedown",pt,!0),Fe.addEventListener("touchend",pt,El),Fe.addEventListener("touchstart",He,El),Fe.addEventListener("touchmove",_t,El)}function Pt(){var Fe=me();Fe.removeEventListener("mousedown",pt,!0),Fe.removeEventListener("touchend",pt,El),Fe.removeEventListener("touchstart",He,El),Fe.removeEventListener("touchmove",_t,El)}function jt(Fe,yt){nn(Fe,function(){!B.state.isVisible&&H.parentNode&&H.parentNode.contains(H)&&yt()})}function un(Fe,yt){nn(Fe,yt)}function nn(Fe,yt){var bt=tt().box;function Rt(Qt){Qt.target===bt&&(Dm(bt,"remove",Rt),yt())}if(Fe===0)return yt();Dm(bt,"remove",_),Dm(bt,"add",Rt),_=Rt}function rn(Fe,yt,bt){bt===void 0&&(bt=!1);var Rt=Gu(B.props.triggerTarget||r);Rt.forEach(function(Qt){Qt.addEventListener(Fe,yt,bt),C.push({node:Qt,eventType:Fe,handler:yt,options:bt})})}function pn(){ee()&&(rn("touchstart",qe,{passive:!0}),rn("touchend",At,{passive:!0})),DC(B.props.trigger).forEach(function(Fe){if(Fe!=="manual")switch(rn(Fe,qe),Fe){case"mouseenter":rn("mouseleave",At);break;case"focus":rn(WC?"focusout":"blur",nt);break;case"focusin":rn("focusout",nt);break}})}function yn(){C.forEach(function(Fe){var yt=Fe.node,bt=Fe.eventType,Rt=Fe.handler,Qt=Fe.options;yt.removeEventListener(bt,Rt,Qt)}),C=[]}function qe(Fe){var yt,bt=!1;if(!(!B.state.isEnabled||de(Fe)||s)){var Rt=((yt=g)==null?void 0:yt.type)==="focus";g=Fe,z=Fe.currentTarget,Xe(),!B.state.isVisible&&OC(Fe)&&Ad.forEach(function(Qt){return Qt(Fe)}),Fe.type==="click"&&(B.props.trigger.indexOf("mouseenter")<0||u)&&B.props.hideOnClick!==!1&&B.state.isVisible?bt=!0:Jn(Fe),Fe.type==="click"&&(u=!bt),bt&&!Rt&&Zn(Fe)}}function Ge(Fe){var yt=Fe.target,bt=xe().contains(yt)||H.contains(yt);if(!(Fe.type==="mousemove"&&bt)){var Rt=Gt().concat(H).map(function(Qt){var Yt,vr=Qt._tippy,or=(Yt=vr.popperInstance)==null?void 0:Yt.state;return or?{popperRect:Qt.getBoundingClientRect(),popperState:or,props:t}:null}).filter(Boolean);UC(Rt,Fe)&&(lt(),Zn(Fe))}}function At(Fe){var yt=de(Fe)||B.props.trigger.indexOf("click")>=0&&u;if(!yt){if(B.props.interactive){B.hideWithInteractivity(Fe);return}Zn(Fe)}}function nt(Fe){B.props.trigger.indexOf("focusin")<0&&Fe.target!==xe()||B.props.interactive&&Fe.relatedTarget&&H.contains(Fe.relatedTarget)||Zn(Fe)}function de(Fe){return Fs.isTouch?ee()!==Fe.type.indexOf("touch")>=0:!1}function cn(){Ke();var Fe=B.props,yt=Fe.popperOptions,bt=Fe.placement,Rt=Fe.offset,Qt=Fe.getReferenceClientRect,Yt=Fe.moveTransition,vr=oe()?lg(H).arrow:null,or=Qt?{getBoundingClientRect:Qt,contextElement:Qt.contextElement||xe()}:r,Se={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(_e){var we=_e.state;if(oe()){var Oe=tt(),$e=Oe.box;["placement","reference-hidden","escaped"].forEach(function(je){je==="placement"?$e.setAttribute("data-placement",we.placement):we.attributes.popper["data-popper-"+je]?$e.setAttribute("data-"+je,""):$e.removeAttribute("data-"+je)}),we.attributes.popper={}}}},ne=[{name:"offset",options:{offset:Rt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Yt}},Se];oe()&&vr&&ne.push({name:"arrow",options:{element:vr,padding:3}}),ne.push.apply(ne,(yt==null?void 0:yt.modifiers)||[]),B.popperInstance=IC(or,H,Object.assign({},yt,{placement:bt,onFirstUpdate:x,modifiers:ne}))}function Ke(){B.popperInstance&&(B.popperInstance.destroy(),B.popperInstance=null)}function ut(){var Fe=B.props.appendTo,yt,bt=xe();B.props.interactive&&Fe===c2||Fe==="parent"?yt=bt.parentNode:yt=f2(Fe,[bt]),yt.contains(H)||yt.appendChild(H),B.state.isMounted=!0,cn()}function Gt(){return Qd(H.querySelectorAll("[data-tippy-root]"))}function Jn(Fe){B.clearDelayTimeouts(),Fe&&Ie("onTrigger",[B,Fe]),gt();var yt=Ue(!0),bt=Ee(),Rt=bt[0],Qt=bt[1];Fs.isTouch&&Rt==="hold"&&Qt&&(yt=Qt),yt?n=setTimeout(function(){B.show()},yt):B.show()}function Zn(Fe){if(B.clearDelayTimeouts(),Ie("onUntrigger",[B,Fe]),!B.state.isVisible){Pt();return}if(!(B.props.trigger.indexOf("mouseenter")>=0&&B.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Fe.type)>=0&&u)){var yt=Ue(!1);yt?i=setTimeout(function(){B.state.isVisible&&B.hide()},yt):o=requestAnimationFrame(function(){B.hide()})}}function fr(){B.state.isEnabled=!0}function Cr(){B.hide(),B.state.isEnabled=!1}function Tr(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function xi(Fe){if(!B.state.isDestroyed){Ie("onBeforeUpdate",[B,Fe]),yn();var yt=B.props,bt=Oy(r,Object.assign({},yt,Dy(Fe),{ignoreAttributes:!0}));B.props=bt,pn(),yt.interactiveDebounce!==bt.interactiveDebounce&&(lt(),T=Py(Ge,bt.interactiveDebounce)),yt.triggerTarget&&!bt.triggerTarget?Gu(yt.triggerTarget).forEach(function(Rt){Rt.removeAttribute("aria-expanded")}):bt.triggerTarget&&r.removeAttribute("aria-expanded"),Xe(),ze(),q&&q(yt,bt),B.popperInstance&&(cn(),Gt().forEach(function(Rt){requestAnimationFrame(Rt._tippy.popperInstance.forceUpdate)})),Ie("onAfterUpdate",[B,Fe])}}function Un(Fe){B.setProps({content:Fe})}function xt(){var Fe=B.state.isVisible,yt=B.state.isDestroyed,bt=!B.state.isEnabled,Rt=Fs.isTouch&&!B.props.touch,Qt=Pm(B.props.duration,0,vs.duration);if(!(Fe||yt||bt||Rt)&&!xe().hasAttribute("disabled")&&(Ie("onShow",[B],!1),B.props.onShow(B)!==!1)){if(B.state.isVisible=!0,oe()&&(H.style.visibility="visible"),ze(),gt(),B.state.isMounted||(H.style.transition="none"),oe()){var Yt=tt(),vr=Yt.box,or=Yt.content;zm([vr,or],0)}x=function(){var ne;if(!(!B.state.isVisible||p)){if(p=!0,H.offsetHeight,H.style.transition=B.props.moveTransition,oe()&&B.props.animation){var ce=tt(),_e=ce.box,we=ce.content;zm([_e,we],Qt),Ry([_e,we],"visible")}ct(),Xe(),zy(Rm,B),(ne=B.popperInstance)==null||ne.forceUpdate(),Ie("onMount",[B]),B.props.animation&&oe()&&un(Qt,function(){B.state.isShown=!0,Ie("onShown",[B])})}},ut()}}function zr(){var Fe=!B.state.isVisible,yt=B.state.isDestroyed,bt=!B.state.isEnabled,Rt=Pm(B.props.duration,1,vs.duration);if(!(Fe||yt||bt)&&(Ie("onHide",[B],!1),B.props.onHide(B)!==!1)){if(B.state.isVisible=!1,B.state.isShown=!1,p=!1,u=!1,oe()&&(H.style.visibility="hidden"),lt(),Pt(),ze(!0),oe()){var Qt=tt(),Yt=Qt.box,vr=Qt.content;B.props.animation&&(zm([Yt,vr],Rt),Ry([Yt,vr],"hidden"))}ct(),Xe(),B.props.animation?oe()&&jt(Rt,B.unmount):B.unmount()}}function br(Fe){me().addEventListener("mousemove",T),zy(Ad,T),T(Fe)}function Fi(){B.state.isVisible&&B.hide(),B.state.isMounted&&(Ke(),Gt().forEach(function(Fe){Fe._tippy.unmount()}),H.parentNode&&H.parentNode.removeChild(H),Rm=Rm.filter(function(Fe){return Fe!==B}),B.state.isMounted=!1,Ie("onHidden",[B]))}function $n(){B.state.isDestroyed||(B.clearDelayTimeouts(),B.unmount(),yn(),delete r._tippy,B.state.isDestroyed=!0,Ie("onDestroy",[B]))}}function ah(r,e){e===void 0&&(e={});var t=vs.plugins.concat(e.plugins||[]);HC();var n=Object.assign({},e,{plugins:t}),i=NC(r),o=i.reduce(function(u,s){var h=s&&tT(s,n);return h&&u.push(h),u},[]);return cp(r)?o[0]:o}ah.defaultProps=vs;ah.setDefaultProps=JC;ah.currentInput=Fs;Object.assign({},Qw,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});ah.setDefaultProps({render:p2});const nT=r=>({}),jy=r=>({}),rT=r=>({}),Uy=r=>({});function Vy(r){let e,t,n;return t=new i_({props:{$$slots:{default:[iT]},$$scope:{ctx:r}}}),{c(){e=U("span"),ue(t.$$.fragment),Ye(e,"margin-left","auto")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&128&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function iT(r){let e,t;const n=r[4].help,i=vn(n,r,r[7],Uy);return{c(){e=U("div"),i&&i.c(),he(e,"class","context-layer-help-content")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&wn(i,n,o,o[7],t?bn(n,o[7],u,rT):xn(o[7]),Uy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function qy(r){let e,t;const n=r[4].legend,i=vn(n,r,r[7],jy);return{c(){e=U("div"),i&&i.c(),he(e,"class","legend svelte-1cu2wie")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&wn(i,n,o,o[7],t?bn(n,o[7],u,nT):xn(o[7]),jy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function oT(r){let e,t,n,i,o,u,s,h,p,g,_=r[3].help&&Vy(r),x=r[0]&&r[3].legend&&qy(r);return{c(){e=U("button"),t=U("input"),n=ie(),i=Me(r[1]),o=ie(),_&&_.c(),u=ie(),x&&x.c(),s=nr(),Ye(t,"aspect-ratio","1.0"),he(t,"type","checkbox"),he(e,"class","context-control"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"justify-content","leading"),Ye(e,"gap","8px"),Ye(e,"text-align","left")},m(C,T){W(C,e,T),F(e,t),t.checked=r[0],F(e,n),F(e,i),F(e,o),_&&_.m(e,null),W(C,u,T),x&&x.m(C,T),W(C,s,T),h=!0,p||(g=[Mt(t,"change",r[5]),Mt(t,"change",function(){da(r[2])&&r[2].apply(this,arguments)}),Mt(e,"click",r[6])],p=!0)},p(C,[T]){r=C,T&1&&(t.checked=r[0]),(!h||T&2)&&kt(i,r[1]),r[3].help?_?(_.p(r,T),T&8&&N(_,1)):(_=Vy(r),_.c(),N(_,1),_.m(e,null)):_&&(Kt(),V(_,1,1,()=>{_=null}),Jt()),r[0]&&r[3].legend?x?(x.p(r,T),T&9&&N(x,1)):(x=qy(r),x.c(),N(x,1),x.m(s.parentNode,s)):x&&(Kt(),V(x,1,1,()=>{x=null}),Jt())},i(C){h||(N(_),N(x),h=!0)},o(C){V(_),V(x),h=!1},d(C){C&&(G(e),G(u),G(s)),_&&_.d(),x&&x.d(C),p=!1,cr(g)}}}function sT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Lg(n);let{label:u}=e,{show:s=!1}=e,{onChange:h=()=>{}}=e;function p(){s=this.checked,t(0,s)}const g=()=>{t(0,s=!s),h()};return r.$$set=_=>{"label"in _&&t(1,u=_.label),"show"in _&&t(0,s=_.show),"onChange"in _&&t(2,h=_.onChange),"$$scope"in _&&t(7,i=_.$$scope)},[s,u,h,o,n,p,g,i]}class os extends Lt{constructor(e){super(),Et(this,e,sT,oT,St,{label:1,show:0,onChange:2})}}let Bd=En(!0);function aT(r){let e,t;return e=new Yi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function lT(r){let e,t;return e=new _r({props:{data:r[1],$$slots:{default:[aT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function uT(r,e,t){let n;return st(r,Bd,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class cT extends Lt{constructor(e){super(),Et(this,e,uT,lT,St,{})}}function fT(r){let e,t;return e=new lp({props:{lngLat:r[0],$$slots:{default:[dT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hT(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[pT]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new lp({props:o}),dn.push(()=>Dn(e,"lngLat",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const h={};s&16&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.lngLat=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function dT(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),he(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function pT(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),he(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function mT(r){let e,t,n,i;const o=[hT,fT],u=[];function s(h,p){return h[1]?0:1}return e=s(r),t=u[e]=o[e](r),{c(){t.c(),n=nr()},m(h,p){u[e].m(h,p),W(h,n,p),i=!0},p(h,[p]){let g=e;e=s(h),e===g?u[e].p(h,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Jt(),t=u[e],t?t.p(h,p):(t=u[e]=o[e](h),t.c()),N(t,1),t.m(n.parentNode,n))},i(h){i||(N(t),i=!0)},o(h){V(t),i=!1},d(h){h&&G(n),u[e].d(h)}}}function gT(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function s(h){o=h,t(0,o)}return r.$$set=h=>{"lngLat"in h&&t(0,o=h.lngLat),"draggable"in h&&t(1,u=h.draggable),"$$scope"in h&&t(4,i=h.$$scope)},[o,u,n,s,i]}class Fl extends Lt{constructor(e){super(),Et(this,e,gT,mT,St,{lngLat:0,draggable:1})}}function _T(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=ie(),o&&o.c()},m(u,s){W(u,e,s),W(u,t,s),o&&o.m(u,s),n=!0},p(u,s){o&&o.p&&(!n||s&32)&&wn(o,i,u,u[5],n?bn(i,u[5],s,null):xn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&(G(e),G(t)),o&&o.d(u)}}}function yT(r){let e,t,n,i,o,u,s,h;t=new L3({props:{color:r[0]}});function p(_){r[4](_)}let g={$$slots:{default:[_T]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new Rg({props:g}),dn.push(()=>Dn(i,"show",p)),{c(){e=U("button"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),he(e,"class","icon-btn help svelte-my65h"),he(e,"title","Help")},m(_,x){W(_,e,x),ae(t,e,null),W(_,n,x),ae(i,_,x),u=!0,s||(h=Mt(e,"click",Mf(r[3])),s=!0)},p(_,[x]){const C={};x&1&&(C.color=_[0]),t.$set(C);const T={};x&32&&(T.$$scope={dirty:x,ctx:_}),!o&&x&2&&(o=!0,T.show=_[1],zn(()=>o=!1)),i.$set(T)},i(_){u||(N(t.$$.fragment,_),N(i.$$.fragment,_),u=!0)},o(_){V(t.$$.fragment,_),V(i.$$.fragment,_),u=!1},d(_){_&&(G(e),G(n)),le(t),le(i,_),s=!1,h()}}}function vT(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const s=()=>t(1,o=!0);function h(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,s,h,i]}class i_ extends Lt{constructor(e){super(),Et(this,e,vT,yT,St,{color:0})}}function bT(r){let e,t,n,i;const o=r[1].default,u=vn(o,r,r[0],null);return{c(){e=U("a"),u&&u.c(),he(e,"href","#")},m(s,h){W(s,e,h),u&&u.m(e,null),t=!0,n||(i=Mt(e,"click",Ig(r[2])),n=!0)},p(s,[h]){u&&u.p&&(!t||h&1)&&wn(u,o,s,s[0],t?bn(o,s[0],h,null):xn(s[0]),null)},i(s){t||(N(u,s),t=!0)},o(s){V(u,s),t=!1},d(s){s&&G(e),u&&u.d(s),n=!1,i()}}}function wT(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Pn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class lh extends Lt{constructor(e){super(),Et(this,e,wT,bT,St,{})}}function Hy(r){let e,t,n,i=r[1]!=null&&Gy(r);return{c(){e=U("div"),t=Me(r[0]),n=ie(),i&&i.c(),he(e,"class","cover svelte-1w7hi45")},m(o,u){W(o,e,u),F(e,t),F(e,n),i&&i.m(e,null)},p(o,u){u&1&&kt(t,o[0]),o[1]!=null?i?i.p(o,u):(i=Gy(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&G(e),i&&i.d()}}}function Gy(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],Ye(t,"width","100%")},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&G(e)}}}function xT(r){let e,t=r[0]&&Hy(r);return{c(){t&&t.c(),e=nr()},m(n,i){t&&t.m(n,i),W(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=Hy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:at,o:at,d(n){n&&G(e),t&&t.d(n)}}}function AT(r,e,t){let{loading:n}=e,{progress:i=null}=e,o,u;return r.$$set=s=>{"loading"in s&&t(0,n=s.loading),"progress"in s&&t(1,i=s.progress)},r.$$.update=()=>{if(r.$$.dirty&13){if(n&&!o)t(2,o=Date.now()),t(3,u=n);else if(!n&&o){const s=Date.now()-o;console.log(`Loading "${u}" took ${s}ms`),t(2,o=void 0)}}},[n,i,o,u]}class uh extends Lt{constructor(e){super(),Et(this,e,AT,xT,St,{loading:0,progress:1})}}function yr(r){var e;switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return((e=pi(_3))==null?void 0:e.project_name)||"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return pi(Ra)||"Editing";case"view-shortcuts":return"Shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function kT(r){let e,t=yr(r[0].mode)+"",n;return{c(){e=U("span"),n=Me(t),he(e,"class","page-title svelte-1o8s136")},m(i,o){W(i,e,o),F(e,n)},p(i,o){o&1&&t!==(t=yr(i[0].mode)+"")&&kt(n,t)},d(i){i&&G(e)}}}function ST(r){let e;const t=r[2].default,n=vn(t,r,r[4],null),i=n||kT(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&16)&&wn(n,t,o,o[4],e?bn(t,o[4],u,null):xn(o[4]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){V(i,o),e=!1},d(o){i&&i.d(o)}}}function CT(r){let e,t;return e=new lh({props:{$$slots:{default:[ST]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&17&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function TT(r,e,t){let n;st(r,tr,h=>t(1,n=h));let{$$slots:i={},$$scope:o}=e,{mode:u}=e;const s=()=>ln(tr,n=u,n);return r.$$set=h=>{"mode"in h&&t(0,u=h.mode),"$$scope"in h&&t(4,o=h.$$scope)},[u,n,i,s,o]}class Fn extends Lt{constructor(e){super(),Et(this,e,TT,CT,St,{mode:0})}}function MT(r){let e,t,n,i,o,u=r[0]+1+"",s,h,p=r[1].length+"",g,_,x,C,T,z,L;return{c(){e=U("div"),t=U("button"),n=Me("Previous"),o=ie(),s=Me(u),h=Me(" / "),g=Me(p),_=ie(),x=U("button"),C=Me("Next"),t.disabled=i=r[0]==0,he(t,"data-tippy-content","Left"),x.disabled=T=r[0]==r[1].length-1,he(x,"data-tippy-content","Right"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between"),Ye(e,"align-items","center")},m(E,I){W(E,e,I),F(e,t),F(t,n),F(e,o),F(e,s),F(e,h),F(e,g),F(e,_),F(e,x),F(x,C),z||(L=[Mt(window,"keydown",r[2]),Mt(t,"click",r[3]),Mt(x,"click",r[4])],z=!0)},p(E,[I]){I&1&&i!==(i=E[0]==0)&&(t.disabled=i),I&1&&u!==(u=E[0]+1+"")&&kt(s,u),I&2&&p!==(p=E[1].length+"")&&kt(g,p),I&3&&T!==(T=E[0]==E[1].length-1)&&(x.disabled=T)},i:at,o:at,d(E){E&&G(e),z=!1,cr(L)}}}function ET(r,e,t){let n;st(r,as,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;ks(()=>{n==null||n.keyboard.disable(),w2()}),ri(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),s()),p.key=="ArrowRight"&&(p.stopPropagation(),h())}function s(){o!=0&&t(0,o--,o)}function h(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,s,h]}class fp extends Lt{constructor(e){super(),Et(this,e,ET,MT,St,{list:1,idx:0})}}function Wy(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Zy(r){let e,t,n,i,o=r[4]+"",u,s;return{c(){e=U("div"),t=U("span"),i=ie(),u=Me(o),s=ie(),he(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Ye(t,"background",r[5]),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","6px")},m(h,p){W(h,e,p),F(e,t),F(e,i),F(e,u),F(e,s)},p(h,p){p&2&&n!==(n="color-swatch "+h[1]+" svelte-1enycr6")&&he(t,"class",n),p&1&&Ye(t,"background",h[5]),p&1&&o!==(o=h[4]+"")&&kt(u,o)},d(h){h&&G(e)}}}function LT(r){let e,t=On(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=Zy(Wy(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();Ye(e,"display","grid"),Ye(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Ye(e,"gap","10px")},m(i,o){W(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=On(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const s=Wy(i,t,u);n[u]?n[u].p(s,o):(n[u]=Zy(s),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:at,o:at,d(i){i&&G(e),_i(n,i)}}}function IT(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=s=>{"labelColors"in s&&t(0,n=s.labelColors),"swatchClass"in s&&t(1,i=s.swatchClass),"itemsPerRow"in s&&t(3,o=s.itemsPerRow)},[n,i,u,o]}class o_ extends Lt{constructor(e){super(),Et(this,e,IT,LT,St,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Xy(r,e,t){const n=r.slice();return n[6]=e[t],n}function Ky(r,e,t){const n=r.slice();return n[9]=e[t],n}function Jy(r){let e,t;return{c(){e=U("span"),t=Me(" "),he(e,"class","bucket svelte-3plrz9"),Ye(e,"background",r[9])},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&1&&Ye(e,"background",n[9])},d(n){n&&G(e)}}}function Yy(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,he(e,"class","svelte-3plrz9")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function PT(r){let e,t,n,i,o=On(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=Jy(Ky(r,o,p));let s=On(r[3]),h=[];for(let p=0;p<s.length;p+=1)h[p]=Yy(Xy(r,s,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<u.length;p+=1)u[p].c();n=ie(),i=U("div");for(let p=0;p<h.length;p+=1)h[p].c();he(t,"class","colors svelte-3plrz9"),he(i,"class","labels svelte-3plrz9"),he(e,"class","svelte-3plrz9"),Wt(e,"full-width-bucket-legend",r[2]),Wt(e,"bucketed",r[1].hasOwnProperty("buckets")),Wt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){W(p,e,g),F(e,t);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(t,null);F(e,n),F(e,i);for(let _=0;_<h.length;_+=1)h[_]&&h[_].m(i,null)},p(p,[g]){if(g&1){o=On(p[0]);let _;for(_=0;_<o.length;_+=1){const x=Ky(p,o,_);u[_]?u[_].p(x,g):(u[_]=Jy(x),u[_].c(),u[_].m(t,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=o.length}if(g&8){s=On(p[3]);let _;for(_=0;_<s.length;_+=1){const x=Xy(p,s,_);h[_]?h[_].p(x,g):(h[_]=Yy(x),h[_].c(),h[_].m(i,null))}for(;_<h.length;_+=1)h[_].d(1);h.length=s.length}g&4&&Wt(e,"full-width-bucket-legend",p[2]),g&2&&Wt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&Wt(e,"limits",p[1].hasOwnProperty("limits"))},i:at,o:at,d(p){p&&G(e),_i(u,p),_i(h,p)}}}function zT(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,s=[];"limits"in i?s=i.limits:s=i.buckets;let h=s.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,h,o]}class ko extends Lt{constructor(e){super(),Et(this,e,zT,PT,St,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function DT(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:RT}=Xb;function BT(r){let e,t;return e=new K3({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function FT(r){let e,t;return e=new H3({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Qy(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I;return L=Pg(r[9][0]),{c(){e=U("div"),t=Me(`Click the map to see street view
      `),n=U("br"),i=ie(),o=U("br"),u=ie(),s=U("b"),s.textContent="Street view source",h=ie(),p=U("label"),g=U("input"),_=Me(`
        Google Street View`),x=ie(),C=U("label"),T=U("input"),z=Me(`
        Bing Streetside`),he(g,"type","radio"),g.__value="google",Wn(g,g.__value),he(g,"class","svelte-1kgc7zz"),he(p,"class","svelte-1kgc7zz"),he(T,"type","radio"),T.__value="bing",Wn(T,T.__value),he(T,"class","svelte-1kgc7zz"),he(C,"class","svelte-1kgc7zz"),he(e,"class","street-view-control-source svelte-1kgc7zz"),Wt(e,"expanded",r[0]),L.p(g,T)},m(O,B){W(O,e,B),F(e,t),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),F(e,h),F(e,p),F(p,g),g.checked=g.__value===r[1],F(p,_),F(e,x),F(e,C),F(C,T),T.checked=T.__value===r[1],F(C,z),E||(I=[Mt(g,"change",r[8]),Mt(T,"change",r[10])],E=!0)},p(O,B){B&2&&(g.checked=g.__value===O[1]),B&2&&(T.checked=T.__value===O[1]),B&1&&Wt(e,"expanded",O[0])},d(O){O&&G(e),L.r(),E=!1,cr(I)}}}function OT(r){let e,t,n,i,o,u,s,h,p;const g=[FT,BT],_=[];function x(T,z){return T[0]?0:1}n=x(r),i=_[n]=g[n](r);let C=r[0]&&Qy(r);return{c(){e=U("button"),t=U("div"),i.c(),o=ie(),C&&C.c(),u=nr(),he(t,"class","ltn-map-btn"),he(e,"title","Street view")},m(T,z){W(T,e,z),F(e,t),_[n].m(t,null),W(T,o,z),C&&C.m(T,z),W(T,u,z),s=!0,h||(p=Mt(e,"click",r[7]),h=!0)},p(T,z){let L=n;n=x(T),n!==L&&(Kt(),V(_[L],1,1,()=>{_[L]=null}),Jt(),i=_[n],i||(i=_[n]=g[n](T),i.c()),N(i,1),i.m(t,null)),T[0]?C?C.p(T,z):(C=Qy(T),C.c(),C.m(u.parentNode,u)):C&&(C.d(1),C=null)},i(T){s||(N(i),s=!0)},o(T){V(i),s=!1},d(T){T&&(G(e),G(o),G(u)),_[n].d(),C&&C.d(T),h=!1,p()}}}function $T(r){let e,t,n,i;return e=new Iw({props:{$$slots:{default:[OT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Mt(RT,"keydown",r[4]),n=!0)},p(o,[u]){const s={};u&16387&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function NT(r,e,t){let n;st(r,Bd,E=>t(12,n=E));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,s="google",h=[];function p(){ln(Bd,n=!1,n),i.on("click",_),i.getCanvas().style.cursor="crosshair";for(let E of DT(i,o))h.push([E,i.getPaintProperty(E,"line-color")]),i.setPaintProperty(E,"line-color","cyan")}function g(){ln(Bd,n=!0,n),i.off("click",_),i.getCanvas().style.cursor="inherit";for(let[E,I]of h)i.setPaintProperty(E,"line-color",I);h=[]}ri(g);function _(E){let I=E.lngLat.lng,O=E.lngLat.lat;s=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${O},${I}&cbp=11,0,0,0,0`,"_blank"):s=="bing"&&window.open(`https://www.bing.com/maps?cp=${O}~${I}&style=x`,"_blank")}function x(E){!n&&E.key=="Escape"&&(E.stopPropagation(),g())}const C=[[]],T=()=>{t(0,u=!u),u?p():g()};function z(){s=this.__value,t(1,s)}function L(){s=this.__value,t(1,s)}return r.$$set=E=>{"map"in E&&t(5,i=E.map),"maptilerBasemap"in E&&t(6,o=E.maptilerBasemap)},[u,s,p,g,x,i,o,T,z,C,L]}class jT extends Lt{constructor(e){super(),Et(this,e,NT,$T,St,{map:5,maptilerBasemap:6})}}function _n(r,e=!0){return{id:r,beforeId:UT(r),eventsIfTopMost:e}}function UT(r){let e=pi(as);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=e1.length-1;i>=0;i--){let o=e1[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Bm=r=>r,Fm=r=>r;const e1=[Bm(Fm("Background")),"neighbourhood-boundaries",Bm("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Fm("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Fm("Road labels"),Bm("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let m2=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],g2=[20,30,40,50,60,70],Ka=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],hp=Ka,dp=[0,20,40,60,80,100],Wf=Ka.toReversed(),Fd=Ka.toReversed(),VT=[0,.3,.6,1,1.5,2],qT=Ka.toReversed(),_2=Ka.toReversed(),y2=Ka.toReversed(),pp=[0,20,40,60,80,100],mp=Ka,v2=Ka.toReversed();function b2(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const HT="#0C793A",vo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function w2(){ah("[data-tippy-content]")}function ia(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Ua(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Va(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function ac(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function Of(r){return r?pi(As)=="cnt"?cg(r,"LAD_"):r:"custom area"}function x2(r){let e=pi(Wa).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;op(n,JSON.stringify(e))}function ug(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function Da(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function t1(r){return r.reduce((e,t)=>e+t,0)}function cg(r,e){return r.startsWith(e)?r.slice(e.length):r}function n1(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function GT(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function WT(r){let e,t;const n=[_n("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":ia(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?In(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function ZT(r){let e,t,n,i,o;function u(h){r[1](h)}let s={label:"Bus routes",$$slots:{help:[GT]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new ih({props:{url:`pmtiles://${No("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[WT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(h,p){ae(e,h,p),W(h,n,p),ae(i,h,p),o=!0},p(h,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:h}),!t&&p&1&&(t=!0,g.show=h[0],zn(()=>t=!1)),e.$set(g);const _={};p&5&&(_.$$scope={dirty:p,ctx:h}),i.$set(_)},i(h){o||(N(e.$$.fragment,h),N(i.$$.fragment,h),o=!0)},o(h){V(e.$$.fragment,h),V(i.$$.fragment,h),o=!1},d(h){h&&G(n),le(e,h),le(i,h)}}}function XT(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class KT extends Lt{constructor(e){super(),Et(this,e,XT,ZT,St,{})}}var JT=Object.defineProperty,A2=r=>{throw TypeError(r)},YT=(r,e,t)=>e in r?JT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Bo=(r,e,t)=>YT(r,typeof e!="symbol"?e+"":e,t),k2=(r,e,t)=>e.has(r)||A2("Cannot "+t),vi=(r,e,t)=>(k2(r,e,"read from private field"),t?t.call(r):e.get(r)),r1=(r,e,t)=>e.has(r)?A2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),i1=(r,e,t,n)=>(k2(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Ur(){}function QT(r,e){for(const t in e)r[t]=e[t];return r}function S2(r){return r()}function o1(){return Object.create(null)}function pa(r){r.forEach(S2)}function C2(r){return typeof r=="function"}function Ja(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let kd;function Qi(r,e){return r===e?!0:(kd||(kd=document.createElement("a")),kd.href=e,r===kd.href)}function eM(r){return Object.keys(r).length===0}function tM(r,e,t,n){if(r){const i=T2(r,e,t,n);return r[0](i)}}function T2(r,e,t,n){return r[1]&&n?QT(t.ctx.slice(),r[1](n(e))):t.ctx}function nM(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function rM(r,e,t,n,i,o){if(i){const u=T2(e,t,n,o);r.p(u,i)}}function iM(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function s1(r){return r??""}function rr(r,e){r.appendChild(e)}function Hr(r,e,t){r.insertBefore(e,t||null)}function Vr(r){r.parentNode&&r.parentNode.removeChild(r)}function Ar(r){return document.createElement(r)}function xs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function qa(r){return document.createTextNode(r)}function $o(){return qa(" ")}function oM(){return qa("")}function fo(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function sM(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Tt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function aM(r){return Array.from(r.childNodes)}function Zf(r,e){e=""+e,r.data!==e&&(r.data=e)}function a1(r,e){r.value=e??""}function rs(r,e,t){r.classList.toggle(e,!!t)}function lM(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Xf;function $f(r){Xf=r}function M2(){if(!Xf)throw new Error("Function called outside component initialization");return Xf}function uM(r){M2().$$.on_destroy.push(r)}function cM(){const r=M2();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=lM(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function l1(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Wu=[],fg=[];let Yu=[];const u1=[],fM=Promise.resolve();let hg=!1;function hM(){hg||(hg=!0,fM.then(E2))}function dg(r){Yu.push(r)}const Om=new Set;let Uu=0;function E2(){if(Uu!==0)return;const r=Xf;do{try{for(;Uu<Wu.length;){const e=Wu[Uu];Uu++,$f(e),dM(e.$$)}}catch(e){throw Wu.length=0,Uu=0,e}for($f(null),Wu.length=0,Uu=0;fg.length;)fg.pop()();for(let e=0;e<Yu.length;e+=1){const t=Yu[e];Om.has(t)||(Om.add(t),t())}Yu.length=0}while(Wu.length);for(;u1.length;)u1.pop()();hg=!1,Om.clear(),$f(r)}function dM(r){if(r.fragment!==null){r.update(),pa(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(dg)}}function pM(r){const e=[],t=[];Yu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Yu=e}const Od=new Set;let Il;function $d(){Il={r:0,c:[],p:Il}}function Nd(){Il.r||pa(Il.c),Il=Il.p}function di(r,e){r&&r.i&&(Od.delete(r),r.i(e))}function Ti(r,e,t,n){if(r&&r.o){if(Od.has(r))return;Od.add(r),Il.c.push(()=>{Od.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function c1(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function mM(r,e){Ti(r,1,1,()=>{e.delete(r.key)})}function gM(r,e,t,n,i,o,u,s,h,p,g,_){let x=r.length,C=o.length,T=x;const z={};for(;T--;)z[r[T].key]=T;const L=[],E=new Map,I=new Map,O=[];for(T=C;T--;){const q=_(i,o,T),J=t(q);let fe=u.get(J);fe?O.push(()=>fe.p(q,e)):(fe=p(J,q),fe.c()),E.set(J,L[T]=fe),J in z&&I.set(J,Math.abs(T-z[J]))}const B=new Set,K=new Set;function H(q){di(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=L[C-1],J=r[x-1],fe=q.key,Ee=J.key;q===J?(g=q.first,x--,C--):E.has(Ee)?!u.has(fe)||B.has(fe)?H(q):K.has(Ee)?x--:I.get(fe)>I.get(Ee)?(K.add(fe),H(q)):(B.add(Ee),x--):(h(J,u),x--)}for(;x--;){const q=r[x];E.has(q.key)||h(q,u)}for(;C;)H(L[C-1]);return pa(O),L}function Ha(r){r&&r.c()}function fa(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),dg(()=>{const o=r.$$.on_mount.map(S2).filter(C2);r.$$.on_destroy?r.$$.on_destroy.push(...o):pa(o),r.$$.on_mount=[]}),i.forEach(dg)}function ha(r,e){const t=r.$$;t.fragment!==null&&(pM(t.after_update),pa(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function _M(r,e){r.$$.dirty[0]===-1&&(Wu.push(r),hM(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ya(r,e,t,n,i,o,u=null,s=[-1]){const h=Xf;$f(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Ur,not_equal:i,bound:o1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(h?h.$$.context:[])),callbacks:o1(),dirty:s,skip_bound:!1,root:e.target||h.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=T)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](T),g&&_M(r,_)),x}):[],p.update(),g=!0,pa(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=aM(e.target);p.fragment&&p.fragment.l(_),_.forEach(Vr)}else p.fragment&&p.fragment.c();e.intro&&di(r.$$.fragment),fa(r,e.target,e.anchor),E2()}$f(h)}class Qa{constructor(){Bo(this,"$$"),Bo(this,"$$set")}$destroy(){ha(this,1),this.$destroy=Ur}$on(e,t){if(!C2(t))return Ur;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!eM(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const yM="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yM);function vM(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Tt(e,"viewBox","0 0 14 14"),Tt(e,"width","13"),Tt(e,"height","13"),Tt(e,"class","svelte-en2qvf")},m(n,i){Hr(n,e,i),rr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class L2 extends Qa{constructor(e){super(),Ya(this,e,null,vM,Ja,{})}}function bM(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Tt(e,"viewBox","0 0 30 30"),Tt(e,"fill","none"),Tt(e,"xmlns","http://www.w3.org/2000/svg"),Tt(e,"class","svelte-d2loi5")},m(n,i){Hr(n,e,i),rr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class I2 extends Qa{constructor(e){super(),Ya(this,e,null,bM,Ja,{})}}function wM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"area.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"area.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function xM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"reverse.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"reverse.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function AM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"poi.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"poi.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function kM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"postal_code.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"postal_code.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function SM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"street.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"street.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function CM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"road.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"road.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function TM(r){let e,t;return{c(){e=Ar("img"),Qi(e.src,t=r[3]+"housenumber.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Qi(e.src,t=n[3]+"housenumber.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function MM(r){let e,t,n,i;return{c(){e=Ar("img"),Qi(e.src,t=r[5])||Tt(e,"src",t),Tt(e,"alt",r[4]),Tt(e,"class","svelte-ltkwvy")},m(o,u){Hr(o,e,u),n||(i=fo(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Qi(e.src,t=o[5])&&Tt(e,"src",t),u&16&&Tt(e,"alt",o[4])},d(o){o&&Vr(e),n=!1,i()}}}function f1(r){let e,t;return{c(){e=Ar("span"),t=qa(r[6]),Tt(e,"class","secondary svelte-ltkwvy")},m(n,i){Hr(n,e,i),rr(e,t)},p(n,i){i&64&&Zf(t,n[6])},d(n){n&&Vr(e)}}}function EM(r){let e,t,n,i,o,u,s,h,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,z,L=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,I,O;function B(J,fe){return fe&1&&(t=null),fe&1&&(n=null),fe&1&&(i=null),fe&1&&(o=null),J[5]?MM:J[0].address?TM:(t==null&&(t=!!J[0].id.startsWith("road.")),t?CM:(n==null&&(n=!!J[0].id.startsWith("address.")),n?SM:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?kM:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?AM:J[7]?xM:wM))))}let K=B(r,-1),H=K(r),q=C&&f1(r);return{c(){e=Ar("li"),H.c(),u=$o(),s=Ar("span"),h=Ar("span"),p=Ar("span"),_=qa(g),x=$o(),q&&q.c(),T=$o(),z=Ar("span"),E=qa(L),Tt(p,"class","primary svelte-ltkwvy"),Tt(h,"class","svelte-ltkwvy"),Tt(z,"class","line2 svelte-ltkwvy"),Tt(s,"class","texts svelte-ltkwvy"),Tt(e,"tabindex","0"),Tt(e,"data-selected",r[1]),Tt(e,"class","svelte-ltkwvy"),rs(e,"selected",r[1])},m(J,fe){Hr(J,e,fe),H.m(e,null),rr(e,u),rr(e,s),rr(s,h),rr(h,p),rr(p,_),rr(h,x),q&&q.m(h,null),rr(s,T),rr(s,z),rr(z,E),I||(O=[fo(e,"mouseenter",r[12]),fo(e,"focus",r[13])],I=!0)},p(J,[fe]){K===(K=B(J,fe))&&H?H.p(J,fe):(H.d(1),H=K(J),H&&(H.c(),H.m(e,u))),fe&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&Zf(_,g),fe&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?q?q.p(J,fe):(q=f1(J),q.c(),q.m(h,null)):q&&(q.d(1),q=null),fe&1&&L!==(L=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Zf(E,L),fe&2&&Tt(e,"data-selected",J[1]),fe&2&&rs(e,"selected",J[1])},i:Ur,o:Ur,d(J){J&&Vr(e),H.d(),q&&q.d(),I=!1,pa(O)}}}function LM(r,e,t){var n;let i,o,{feature:u}=e,{selected:s=!1}=e,{showPlaceType:h}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const _=(n=u.properties)==null?void 0:n.categories;let x,C,T=0,z=u.place_type[0]==="reverse";function L(){C&&p.add(C),t(10,T++,T)}function E(B){l1.call(this,r,B)}function I(B){l1.call(this,r,B)}const O=()=>L();return r.$$set=B=>{"feature"in B&&t(0,u=B.feature),"selected"in B&&t(1,s=B.selected),"showPlaceType"in B&&t(2,h=B.showPlaceType),"missingIconsCache"in B&&t(9,p=B.missingIconsCache),"iconsBaseUrl"in B&&t(3,g=B.iconsBaseUrl)},r.$$.update=()=>{var B,K,H,q;if(r.$$.dirty&3640)do t(11,i--,i),t(4,x=_==null?void 0:_[i]),t(5,C=x?g+x.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||p.has(C)));r.$$.dirty&1&&t(6,o=((K=(B=u.properties)==null?void 0:B.categories)==null?void 0:K.join(", "))??((q=(H=u.properties)==null?void 0:H.place_type_name)==null?void 0:q[0])??u.place_type[0])},t(11,i=(_==null?void 0:_.length)??0),[u,s,h,g,x,C,o,z,L,p,T,i,E,I,O]}class IM extends Qa{constructor(e){super(),Ya(this,e,LM,EM,Ja,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function PM(r){let e;return{c(){e=Ar("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Tt(e,"class","svelte-7cmwmc")},m(t,n){Hr(t,e,n)},p:Ur,i:Ur,o:Ur,d(t){t&&Vr(e)}}}class zM extends Qa{constructor(e){super(),Ya(this,e,null,PM,Ja,{})}}function DM(r){let e,t,n;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"stroke-width","4"),Tt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Tt(t,"class","svelte-gzo3ar"),Tt(e,"width",n=r[0]==="list"?20:void 0),Tt(e,"viewBox","0 0 70 85"),Tt(e,"fill","none"),Tt(e,"class","svelte-gzo3ar"),rs(e,"in-map",r[0]!=="list"),rs(e,"list-icon",r[0]==="list")},m(i,o){Hr(i,e,o),rr(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&Tt(e,"width",n),o&1&&rs(e,"in-map",i[0]!=="list"),o&1&&rs(e,"list-icon",i[0]==="list")},i:Ur,o:Ur,d(i){i&&Vr(e)}}}function RM(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class BM extends Qa{constructor(e){super(),Ya(this,e,RM,DM,Ja,{displayIn:0})}}function FM(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Tt(e,"viewBox","0 0 60.006 21.412"),Tt(e,"width","14"),Tt(e,"height","20"),Tt(e,"class","svelte-en2qvf")},m(n,i){Hr(n,e,i),rr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class OM extends Qa{constructor(e){super(),Ya(this,e,null,FM,Ja,{})}}function $M(r){let e,t,n;return{c(){e=xs("svg"),t=xs("circle"),n=xs("path"),Tt(t,"cx","4.789"),Tt(t,"cy","4.787"),Tt(t,"r","3.85"),Tt(t,"class","svelte-1aq105l"),Tt(n,"d","M12.063 12.063 7.635 7.635"),Tt(n,"class","svelte-1aq105l"),Tt(e,"xmlns","http://www.w3.org/2000/svg"),Tt(e,"width","13"),Tt(e,"height","13"),Tt(e,"viewBox","0 0 13 13"),Tt(e,"class","svelte-1aq105l")},m(i,o){Hr(i,e,o),rr(e,t),rr(e,n)},p:Ur,i:Ur,o:Ur,d(i){i&&Vr(e)}}}class NM extends Qa{constructor(e){super(),Ya(this,e,null,$M,Ja,{})}}function jM(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function ep(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let mf;async function UM(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(mf&&i.cachedLocationExpiry&&mf.time+i.cachedLocationExpiry>Date.now()){if(!mf.coords)break e;return mf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(h=>{u([h.coords.longitude,h.coords.latitude].map(p=>p.toFixed(6)).join(","))},h=>{s(h)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(mf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const VM=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,h1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,d1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,p1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,m1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,g1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function qM(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let h;r=="DD"&&(h=`${i}° ${u}, ${o}° ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=_1(_,3).toFixed(3).padStart(6,"0"),T=_1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),h=`${p}° ${C}' ${u}, ${g}° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(_),T=Math.floor(x);let z=((_-C)*60).toFixed(1).padStart(4,"0"),L=((x-T)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),I=T.toString().padStart(2,"0");z.endsWith(".0")&&L.endsWith(".0")&&(z=z.replace(/\.0$/,""),L=L.replace(/\.0$/,"")),h=`${p}° ${E}' ${z}" ${u}, ${g}° ${I}' ${L}" ${s}`}return h}else throw new Error("no decimal coordinates to convert")}function _1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function s_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],h=!1;if(VM.test(r))throw new Error("invalid coordinate value");if(h1.test(r))if(s=h1.exec(r),h=gf(s),h)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(d1.test(r))if(s=d1.exec(r),h=gf(s),h){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(p1.test(r))if(s=p1.exec(r),h=gf(s),h)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(m1.test(r))if(s=m1.exec(r),h=gf(s),h)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(g1.test(r)){if(s=g1.exec(r),h=gf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(h)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(h){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const E=Math.floor(r.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;T.length%2==1?E=Math.floor(T.length/2):E=T.length/2-1;let I=0;if(E==0)I=g.indexOf(T[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let O=0,B=0;for(;O<=E;)I=g.indexOf(T[O],B),B=I+1,O++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const z=_.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");const L=x.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:HM,toCoordinateFormat:qM})}else throw new Error("coordinates pattern match failed")}function gf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],h=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(h||p||g)continue;return!1}}return!0}function y1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function HM(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return y1(this.decimalLatitude,Number(e[0]))&&y1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const GM=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});s_.to=GM;const WM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],ZM={decimalLatitude:40.123,decimalLongitude:-74.123},XM=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],KM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function JM(){const r=[];return WM.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...ZM})}),[...r,...XM,...KM]}const YM=JM();s_.formats=YM.map(r=>r.verbatimCoordinates);const QM=s_;function v1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function b1(r){let e,t;return e=new zM({}),{c(){Ha(e.$$.fragment)},m(n,i){fa(e,n,i),t=!0},i(n){t||(di(e.$$.fragment,n),t=!0)},o(n){Ti(e.$$.fragment,n),t=!1},d(n){ha(e,n)}}}function w1(r){let e,t,n,i,o;return t=new OM({}),{c(){e=Ar("button"),Ha(t.$$.fragment),Tt(e,"type","button"),Tt(e,"title",r[9]),Tt(e,"class","svelte-bz0zu3"),rs(e,"active",r[0])},m(u,s){Hr(u,e,s),fa(t,e,null),n=!0,i||(o=fo(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&Tt(e,"title",u[9]),(!n||s[0]&1)&&rs(e,"active",u[0])},i(u){n||(di(t.$$.fragment,u),n=!0)},o(u){Ti(t.$$.fragment,u),n=!1},d(u){u&&Vr(e),ha(t),i=!1,o()}}}function eE(r){let e,t=[],n=new Map,i,o,u,s=c1(r[14]);const h=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=v1(r,s,p),_=h(g);n.set(_,t[p]=x1(_,g))}return{c(){e=Ar("ul");for(let p=0;p<t.length;p+=1)t[p].c();Tt(e,"class","options svelte-bz0zu3")},m(p,g){Hr(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[fo(e,"mouseleave",r[73]),fo(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=c1(p[14]),$d(),t=gM(t,g,h,1,p,s,n,e,mM,x1,null,v1),Nd())},i(p){if(!i){for(let g=0;g<s.length;g+=1)di(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Ti(t[g]);i=!1},d(p){p&&Vr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,pa(u)}}}function tE(r){let e,t,n,i,o,u;return t=new I2({}),{c(){e=Ar("div"),Ha(t.$$.fragment),n=$o(),i=Ar("div"),o=qa(r[7]),Tt(i,"class","svelte-bz0zu3"),Tt(e,"class","no-results svelte-bz0zu3")},m(s,h){Hr(s,e,h),fa(t,e,null),rr(e,n),rr(e,i),rr(i,o),u=!0},p(s,h){(!u||h[0]&128)&&Zf(o,s[7])},i(s){u||(di(t.$$.fragment,s),u=!0)},o(s){Ti(t.$$.fragment,s),u=!1},d(s){s&&Vr(e),ha(t)}}}function nE(r){let e="",t;return{c(){t=qa(e)},m(n,i){Hr(n,t,i)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(t)}}}function rE(r){let e,t,n,i,o,u,s,h,p,g,_;return t=new I2({}),h=new L2({}),{c(){e=Ar("div"),Ha(t.$$.fragment),n=$o(),i=Ar("div"),o=qa(r[6]),u=$o(),s=Ar("button"),Ha(h.$$.fragment),Tt(i,"class","svelte-bz0zu3"),Tt(s,"class","svelte-bz0zu3"),Tt(e,"class","error svelte-bz0zu3")},m(x,C){Hr(x,e,C),fa(t,e,null),rr(e,n),rr(e,i),rr(i,o),rr(e,u),rr(e,s),fa(h,s,null),p=!0,g||(_=fo(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&Zf(o,x[6])},i(x){p||(di(t.$$.fragment,x),di(h.$$.fragment,x),p=!0)},o(x){Ti(t.$$.fragment,x),Ti(h.$$.fragment,x),p=!1},d(x){x&&Vr(e),ha(t),ha(h),g=!1,_()}}}function x1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new IM({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=oM(),Ha(n.$$.fragment),this.first=t},m(s,h){Hr(s,t,h),fa(n,s,h),i=!0},p(s,h){e=s;const p={};h[0]&16384&&(p.feature=e[84]),h[0]&1024&&(p.showPlaceType=e[10]),h[0]&49152&&(p.selected=e[15]===e[86]),h[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(di(n.$$.fragment,s),i=!0)},o(s){Ti(n.$$.fragment,s),i=!1},d(s){s&&Vr(t),ha(n,s)}}}function iE(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H=!1;o=new NM({}),_=new L2({});let q=r[19]&&b1(),J=r[5]==="button"&&w1(r);const fe=r[61].default,Ee=tM(fe,r,r[60],null),ee=[rE,nE,tE,eE],oe=[];function xe(me,tt){var Ue,ze;return me[18]?0:me[16]?((Ue=me[14])==null?void 0:Ue.length)===0?2:me[16]&&(ze=me[14])!=null&&ze.length?3:-1:1}return~(L=xe(r))&&(E=oe[L]=ee[L](r)),{c(){e=$o(),t=Ar("form"),n=Ar("div"),i=Ar("button"),Ha(o.$$.fragment),u=$o(),s=Ar("input"),h=$o(),p=Ar("div"),g=Ar("button"),Ha(_.$$.fragment),x=$o(),q&&q.c(),C=$o(),J&&J.c(),T=$o(),Ee&&Ee.c(),z=$o(),E&&E.c(),Tt(i,"class","search-button svelte-bz0zu3"),Tt(i,"type","button"),Tt(s,"placeholder",r[8]),Tt(s,"aria-label",r[8]),Tt(s,"class","svelte-bz0zu3"),Tt(g,"type","button"),Tt(g,"title",r[3]),Tt(g,"class","svelte-bz0zu3"),Tt(p,"class","clear-button-container svelte-bz0zu3"),rs(p,"displayable",r[1]!==""),Tt(n,"class","input-group svelte-bz0zu3"),Tt(t,"tabindex","0"),Tt(t,"class",I=s1(r[2])+" svelte-bz0zu3"),rs(t,"can-collapse",r[4]&&r[1]==="")},m(me,tt){Hr(me,e,tt),Hr(me,t,tt),rr(t,n),rr(n,i),fa(o,i,null),rr(n,u),rr(n,s),r[63](s),a1(s,r[1]),rr(n,h),rr(n,p),rr(p,g),fa(_,g,null),rr(p,x),q&&q.m(p,null),rr(n,C),J&&J.m(n,null),rr(n,T),Ee&&Ee.m(n,null),rr(t,z),~L&&oe[L].m(t,null),O=!0,B||(K=[fo(i,"click",r[62]),fo(s,"input",r[64]),fo(s,"focus",r[65]),fo(s,"blur",r[66]),fo(s,"keydown",r[22]),fo(s,"input",r[67]),fo(g,"click",r[68]),fo(t,"submit",sM(r[21]))],B=!0)},p(me,tt){(!O||tt[0]&256)&&Tt(s,"placeholder",me[8]),(!O||tt[0]&256)&&Tt(s,"aria-label",me[8]),tt[0]&2&&s.value!==me[1]&&a1(s,me[1]),(!O||tt[0]&8)&&Tt(g,"title",me[3]),me[19]?q?tt[0]&524288&&di(q,1):(q=b1(),q.c(),di(q,1),q.m(p,null)):q&&($d(),Ti(q,1,1,()=>{q=null}),Nd()),(!O||tt[0]&2)&&rs(p,"displayable",me[1]!==""),me[5]==="button"?J?(J.p(me,tt),tt[0]&32&&di(J,1)):(J=w1(me),J.c(),di(J,1),J.m(n,T)):J&&($d(),Ti(J,1,1,()=>{J=null}),Nd()),Ee&&Ee.p&&(!O||tt[1]&536870912)&&rM(Ee,fe,me,me[60],O?nM(fe,me[60],tt,null):iM(me[60]),null);let Ue=L;L=xe(me),L===Ue?~L&&oe[L].p(me,tt):(E&&($d(),Ti(oe[Ue],1,1,()=>{oe[Ue]=null}),Nd()),~L?(E=oe[L],E?E.p(me,tt):(E=oe[L]=ee[L](me),E.c()),di(E,1),E.m(t,null)):E=null),(!O||tt[0]&4&&I!==(I=s1(me[2])+" svelte-bz0zu3"))&&Tt(t,"class",I),(!O||tt[0]&22)&&rs(t,"can-collapse",me[4]&&me[1]==="")},i(me){O||(di(H),di(o.$$.fragment,me),di(_.$$.fragment,me),di(q),di(J),di(Ee,me),di(E),O=!0)},o(me){Ti(H),Ti(o.$$.fragment,me),Ti(_.$$.fragment,me),Ti(q),Ti(J),Ti(Ee,me),Ti(E),O=!1},d(me){me&&(Vr(e),Vr(t)),ha(o),r[63](null),ha(_),q&&q.d(),J&&J.d(),Ee&&Ee.d(me),~L&&oe[L].d(),B=!1,pa(K)}}}function oE(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:h=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:z=200}=e,{enableReverse:L="never"}=e,{errorMessage:E="Something went wrong…"}=e,{filter:I=()=>!0}=e,{flyTo:O=!0}=e,{fuzzyMatch:B=!0}=e,{language:K=void 0}=e,{limit:H=void 0}=e,{mapController:q=void 0}=e,{minLength:J=2}=e,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ee="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:oe=L==="always"}=e,{reverseButtonTitle:xe="toggle reverse geocoding"}=e,{searchValue:me=""}=e,{pickedResultStyle:tt="full-geometry"}=e,{showPlaceType:Ue="if-needed"}=e,{showResultsWhileTyping:ze=!0}=e,{selectFirst:Ie=!0}=e,{flyToSelected:ct=!1}=e,{markerOnSelected:Xe=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:pt=!1}=e,{excludeTypes:_t=!1}=e,{zoom:He=s}=e,{apiUrl:gt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:un=()=>{}}=e;function nn(){Ke.focus()}function rn(){Ke.blur()}function pn(re,Je=!0,Qe=!1){t(1,me=re),Je?(t(15,ut=-1),xt()):(bt(!Qe,Qe),setTimeout(()=>{Ke.focus(),Ke.select()}))}function yn(){t(14,At=void 0),t(56,de=void 0),t(15,ut=-1)}function qe(){t(55,nt=[]),t(56,de=void 0)}let Ge=!1,At,nt,de,cn="",Ke,ut=-1,Gt,Jn=[],Zn,fr,Cr,Tr;const xi=new Set,Un=cM();uM(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function xt(re){if(fr&&(clearTimeout(fr),fr=void 0),ut>-1&&At)t(56,de=At[ut]),t(1,me=de.place_type[0]==="reverse"?de.place_name:de.place_name.replace(/,.*/,"")),t(18,Gt=void 0),t(55,nt=void 0),t(15,ut=-1);else if(me){const Je=re||!zr(me);br(me,{exact:!0}).then(()=>{t(55,nt=At),t(56,de=void 0),Je&&Fi()}).catch(Qe=>t(18,Gt=Qe))}}function zr(re){try{return QM(re,6)}catch{return!1}}async function br(re,{byId:Je=!1,exact:Qe=!1}={}){t(18,Gt=void 0),Zn==null||Zn.abort();const rt=new AbortController;t(19,Zn=rt);try{const ht=zr(re),Dt=new URLSearchParams;if(K!==void 0&&Dt.set("language",Array.isArray(K)?K.join(","):K??""),lt&&Dt.set("types",lt.join(",")),_t&&Dt.set("excludeTypes",String(_t)),g&&Dt.set("bbox",g.map(Nn=>Nn.toFixed(6)).join(",")),T&&Dt.set("country",Array.isArray(T)?T.join(","):T),!Je&&!ht){const Nn=await UM(q,ee,rt);Nn&&Dt.set("proximity",Nn),(Qe||!ze)&&Dt.set("autocomplete","false"),Dt.set("fuzzyMatch",String(B))}H!==void 0&&(pt||!ht||(lt==null?void 0:lt.length)===1)&&Dt.set("limit",String(H)),Dt.set("key",p),un(Dt);const en=gt+"/"+encodeURIComponent(ht?ht.decimalLongitude+","+ht.decimalLatitude:re)+".json?"+Dt.toString();if(en===cn){Je?(t(14,At=void 0),t(56,de=Jn[0])):t(14,At=Jn);return}cn=en;const mn=await fetch(en,{signal:rt.signal,...Pt});if(!mn.ok)throw new Error(await mn.text());const Cn=await mn.json();Un("response",{url:en,featureCollection:Cn}),Je?(t(14,At=void 0),t(56,de=Cn.features[0]),Jn=[de]):(t(14,At=Cn.features.filter(I)),ht&&At.unshift({type:"Feature",properties:{},id:"reverse_"+ht.decimalLongitude+"_"+ht.decimalLatitude,text:ht.decimalLatitude+", "+ht.decimalLongitude,place_name:ht.decimalLatitude+", "+ht.decimalLongitude,place_type:["reverse"],center:[ht.decimalLongitude,ht.decimalLatitude],bbox:[ht.decimalLongitude,ht.decimalLatitude,ht.decimalLongitude,ht.decimalLatitude],geometry:{type:"Point",coordinates:[ht.decimalLongitude,ht.decimalLatitude]}}),Jn=At,ht&&Ke.focus())}catch(ht){if(ht&&typeof ht=="object"&&"name"in ht&&ht.name==="AbortError")return;throw ht}finally{rt===Zn&&t(19,Zn=void 0)}}function Fi(){var re;if(!(nt!=null&&nt.length)||!O)return;const Je=[180,90,-180,-90],Qe=!nt.some(ht=>!ht.matching_text);let rt;for(const ht of nt){const Dt=$n(ht);if(rt=rt===void 0?Dt:Dt===void 0?rt:Math.max(rt,Dt),Qe||!ht.matching_text)for(const en of[0,1,2,3])Je[en]=Math[en<2?"min":"max"](Je[en],((re=ht.bbox)==null?void 0:re[en])??ht.center[en%2])}q&&nt.length>0&&(de&&Je[0]===Je[2]&&Je[1]===Je[3]?q.flyTo(de.center,$n(de)):q.fitBounds(ep(Je),50,rt))}function $n(re){var Je;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Qe=re.id.replace(/\..*/,"");return(Array.isArray((Je=re.properties)==null?void 0:Je.categories)?re.properties.categories.reduce((rt,ht)=>{const Dt=He[Qe+"."+ht];return rt===void 0?Dt:Dt===void 0?rt:Math.max(rt,Dt)},void 0):void 0)??He[Qe]}function Fe(re){t(0,oe=L==="always"),t(14,At=void 0),t(56,de=void 0),t(15,ut=-1),pn(re[1].toFixed(6)+", "+jM(re[0],[-180,180],!0).toFixed(6),!1,!0)}function yt(re){if(!At)return;let Je=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Je&&(ut===(Ie?0:-1)&&Je===-1&&t(15,ut=At.length),t(15,ut+=Je),ut>=At.length&&t(15,ut=-1),ut<0&&Ie&&t(15,ut=0),re.preventDefault())}function bt(re=!0,Je=!1){if(t(18,Gt=void 0),ze||Je){if(fr&&clearTimeout(fr),me.length<J)return;const Qe=me;fr=window.setTimeout(()=>{br(Qe).catch(rt=>t(18,Gt=rt))},re?z:0)}else t(14,At=void 0),t(18,Gt=void 0)}function Rt(re){t(56,de=re),t(1,me=re.place_name),t(15,ut=-1)}const Qt=()=>Ke.focus();function Yt(re){fg[re?"unshift":"push"](()=>{Ke=re,t(17,Ke)})}function vr(){me=this.value,t(1,me),t(13,Ge),t(28,x)}const or=()=>t(13,Ge=!0),Se=()=>t(13,Ge=!1),ne=()=>bt(),ce=()=>{t(1,me=""),Ke.focus()},_e=()=>t(0,oe=!oe),we=()=>t(18,Gt=void 0),Oe=re=>t(15,ut=re),$e=re=>Rt(re),je=()=>{Ie||t(15,ut=-1)},De=()=>{};return r.$$set=re=>{"class"in re&&t(2,h=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,T=re.country),"debounceSearch"in re&&t(30,z=re.debounceSearch),"enableReverse"in re&&t(5,L=re.enableReverse),"errorMessage"in re&&t(6,E=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,O=re.flyTo),"fuzzyMatch"in re&&t(33,B=re.fuzzyMatch),"language"in re&&t(34,K=re.language),"limit"in re&&t(35,H=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,J=re.minLength),"noResultsMessage"in re&&t(7,fe=re.noResultsMessage),"placeholder"in re&&t(8,Ee=re.placeholder),"proximity"in re&&t(38,ee=re.proximity),"reverseActive"in re&&t(0,oe=re.reverseActive),"reverseButtonTitle"in re&&t(9,xe=re.reverseButtonTitle),"searchValue"in re&&t(1,me=re.searchValue),"pickedResultStyle"in re&&t(39,tt=re.pickedResultStyle),"showPlaceType"in re&&t(10,Ue=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,ze=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Ie=re.selectFirst),"flyToSelected"in re&&t(41,ct=re.flyToSelected),"markerOnSelected"in re&&t(42,Xe=re.markerOnSelected),"types"in re&&t(43,lt=re.types),"exhaustiveReverseGeocoding"in re&&t(44,pt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,_t=re.excludeTypes),"zoom"in re&&t(46,He=re.zoom),"apiUrl"in re&&t(47,gt=re.apiUrl),"fetchParameters"in re&&t(48,Pt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,jt=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,un=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,oe=L==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Cr=Ge),x&&!Ge&&t(1,me="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&me.length<J&&(t(56,de=void 0),t(14,At=void 0),t(18,Gt=void 0),t(55,nt=At)),r.$$.dirty[1]&33554688&&tt!=="marker-only"&&de&&!de.address&&de.geometry.type==="Point"&&de.place_type[0]!=="reverse"&&br(de.id,{byId:!0}).catch(re=>t(18,Gt=re)),r.$$.dirty[1]&100663330&&(q&&de&&de.id!==Tr&&O&&(!de.bbox||de.bbox[0]===de.bbox[2]&&de.bbox[1]===de.bbox[3]?q.flyTo(de.center,$n(de)):q.fitBounds(ep(de.bbox),50,$n(de)),t(14,At=void 0),t(55,nt=void 0),t(15,ut=-1)),t(57,Tr=de==null?void 0:de.id)),r.$$.dirty[0]&18432&&Ie&&At!=null&&At.length&&t(15,ut=0),r.$$.dirty[0]&2&&t(15,ut=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&nt!==At&&t(55,nt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":oe&&Fe(re.coordinates);break;case"markerClick":{const Je=At==null?void 0:At.find(Qe=>Qe.id===re.id);Je&&Rt(Je)}break;case"markerMouseEnter":nt&&t(15,ut=Cr?(At==null?void 0:At.findIndex(Je=>Je.id===re.id))??-1:-1);break;case"markerMouseLeave":nt&&t(15,ut=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=At==null?void 0:At[ut]),r.$$.dirty[1]&134218786&&q&&i&&O&&ct&&q.flyTo(i.center,$n(i)),r.$$.dirty[1]&256&&t(59,n=tt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Xe||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Xe&&!nt&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(nt,de,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&nt&&q&&q.setSelectedMarker(ut),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=zr(me);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Un("select",{feature:i}),r.$$.dirty[1]&33554432&&Un("pick",{feature:de}),r.$$.dirty[0]&81920&&Un("optionsvisibilitychange",{optionsVisible:Cr&&!!At}),r.$$.dirty[0]&16384&&Un("featureslisted",{features:At}),r.$$.dirty[1]&16777216&&Un("featuresmarked",{features:nt}),r.$$.dirty[0]&1&&Un("reversetoggle",{reverse:oe}),r.$$.dirty[0]&2&&Un("querychange",{query:me}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(oe)},[oe,me,h,_,C,L,E,fe,Ee,xe,Ue,Ie,jt,Ge,At,ut,Cr,Ke,Gt,Zn,xi,xt,yt,bt,Rt,s,p,g,x,T,z,I,O,B,K,H,q,J,ee,tt,ze,ct,Xe,lt,pt,_t,He,gt,Pt,un,nn,rn,pn,yn,qe,nt,de,Tr,i,n,u,o,Qt,Yt,vr,or,Se,ne,ce,_e,we,Oe,$e,je,De]}let sE=class extends Qa{constructor(r){super(),Ya(this,r,oE,iE,Ja,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Kf(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function a_(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return Kf({type:"Polygon",coordinates:r},e,t)}function Jf(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function P2(r,e,t={}){return Kf({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function aE(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(p){return function(g){return h([p,g])}}function h(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var Ga=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function lE(r,e){return r>e?1:r<e?-1:0}function Ba(r,e,t){for(var n=new Ga(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function $m(r,e,t,n){var i=new Ga(r,e);if(t===null)return i.left=i.right=null,i;t=Ba(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function A1(r,e,t){var n=null,i=null;if(e){e=Ba(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function uE(r,e,t){return e===null?r:(r===null||(e=Ba(r.key,e,t),e.left=r),e)}function pg(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&pg(r.left,o,!1,n,i),r.right&&pg(r.right,o,!0,n,i)}}var l_=function(){function r(e){e===void 0&&(e=lE),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=$m(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ga(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ba(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ba(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ba(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ba(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ba(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,s=this._root,h;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),h=u(s.key,t),h>0)break;if(u(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return fE(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&_g(e,t,0,i-1,o),this._root===null)this._root=mg(e,t,0,i),this._size=i;else{var u=hE(this.toList(),cE(e,t),o);i=this._size+i,this._root=gg({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return pg(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=A1(e,this._root,i),u=o.left,s=o.right;i(e,t)<0?s=$m(t,n,s,i):u=$m(t,n,u,i),this._root=uE(u,s,i)},r.prototype.split=function(e){return A1(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return aE(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function mg(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],s=e[o],h=new Ga(u,s);return h.left=mg(r,e,t,o),h.right=mg(r,e,o+1,n),h}return null}function cE(r,e){for(var t=new Ga(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ga(r[i],e[i]);return n.next=null,t.next}function fE(r){for(var e=r,t=[],n=!1,i=new Ga(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function gg(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=gg(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=gg(r,i+1,t),u}return null}function hE(r,e,t){for(var n=new Ga(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function _g(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,s=n+1;;){do u++;while(i(r[u],o)<0);do s--;while(i(r[s],o)>0);if(u>=s)break;var h=r[u];r[u]=r[s],r[s]=h,h=e[u],e[u]=e[s],e[s]=h}_g(r,e,t,s,i),_g(r,e,s+1,n,i)}}const la=11102230246251565e-32,Wi=134217729,dE=(3+8*la)*la;function Nm(r,e,t,n,i){let o,u,s,h,p=e[0],g=n[0],_=0,x=0;g>p==g>-p?(o=p,p=e[++_]):(o=g,g=n[++x]);let C=0;if(_<r&&x<t)for(g>p==g>-p?(u=p+o,s=o-(u-p),p=e[++_]):(u=g+o,s=o-(u-g),g=n[++x]),o=u,s!==0&&(i[C++]=s);_<r&&x<t;)g>p==g>-p?(u=o+p,h=u-o,s=o-(u-h)+(p-h),p=e[++_]):(u=o+g,h=u-o,s=o-(u-h)+(g-h),g=n[++x]),o=u,s!==0&&(i[C++]=s);for(;_<r;)u=o+p,h=u-o,s=o-(u-h)+(p-h),p=e[++_],o=u,s!==0&&(i[C++]=s);for(;x<t;)u=o+g,h=u-o,s=o-(u-h)+(g-h),g=n[++x],o=u,s!==0&&(i[C++]=s);return(o!==0||C===0)&&(i[C++]=o),C}function pE(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function ch(r){return new Float64Array(r)}const mE=(3+16*la)*la,gE=(2+12*la)*la,_E=(9+64*la)*la*la,Vu=ch(4),k1=ch(8),S1=ch(12),C1=ch(16),co=ch(4);function yE(r,e,t,n,i,o,u){let s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J;const fe=r-i,Ee=t-i,ee=e-o,oe=n-o;B=fe*oe,x=Wi*fe,C=x-(x-fe),T=fe-C,x=Wi*oe,z=x-(x-oe),L=oe-z,K=T*L-(B-C*z-T*z-C*L),H=ee*Ee,x=Wi*ee,C=x-(x-ee),T=ee-C,x=Wi*Ee,z=x-(x-Ee),L=Ee-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,Vu[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,Vu[1]=O-(E+_)+(_-H),J=I+E,_=J-I,Vu[2]=I-(J-_)+(E-_),Vu[3]=J;let xe=pE(4,Vu),me=gE*u;if(xe>=me||-xe>=me||(_=r-fe,s=r-(fe+_)+(_-i),_=t-Ee,p=t-(Ee+_)+(_-i),_=e-ee,h=e-(ee+_)+(_-o),_=n-oe,g=n-(oe+_)+(_-o),s===0&&h===0&&p===0&&g===0)||(me=_E*u+dE*Math.abs(xe),xe+=fe*g+oe*s-(ee*p+Ee*h),xe>=me||-xe>=me))return xe;B=s*oe,x=Wi*s,C=x-(x-s),T=s-C,x=Wi*oe,z=x-(x-oe),L=oe-z,K=T*L-(B-C*z-T*z-C*L),H=h*Ee,x=Wi*h,C=x-(x-h),T=h-C,x=Wi*Ee,z=x-(x-Ee),L=Ee-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,co[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,co[1]=O-(E+_)+(_-H),J=I+E,_=J-I,co[2]=I-(J-_)+(E-_),co[3]=J;const tt=Nm(4,Vu,4,co,k1);B=fe*g,x=Wi*fe,C=x-(x-fe),T=fe-C,x=Wi*g,z=x-(x-g),L=g-z,K=T*L-(B-C*z-T*z-C*L),H=ee*p,x=Wi*ee,C=x-(x-ee),T=ee-C,x=Wi*p,z=x-(x-p),L=p-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,co[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,co[1]=O-(E+_)+(_-H),J=I+E,_=J-I,co[2]=I-(J-_)+(E-_),co[3]=J;const Ue=Nm(tt,k1,4,co,S1);B=s*g,x=Wi*s,C=x-(x-s),T=s-C,x=Wi*g,z=x-(x-g),L=g-z,K=T*L-(B-C*z-T*z-C*L),H=h*p,x=Wi*h,C=x-(x-h),T=h-C,x=Wi*p,z=x-(x-p),L=p-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,co[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,co[1]=O-(E+_)+(_-H),J=I+E,_=J-I,co[2]=I-(J-_)+(E-_),co[3]=J;const ze=Nm(Ue,S1,4,co,C1);return C1[ze-1]}function vE(r,e,t,n,i,o){const u=(e-o)*(t-i),s=(r-i)*(n-o),h=u-s,p=Math.abs(u+s);return Math.abs(h)>=mE*p?h:-yE(r,e,t,n,i,o,p)}const _f=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,yg=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let $a=Number.EPSILON;$a===void 0&&($a=Math.pow(2,-52));const bE=$a*$a,T1=(r,e)=>{if(-$a<r&&r<$a&&-$a<e&&e<$a)return 0;const t=r-e;return t*t<bE*r*e?0:r<e?-1:1};class wE{constructor(){this.reset()}reset(){this.xRounder=new M1,this.yRounder=new M1}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class M1{constructor(){this.tree=new l_,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&T1(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&T1(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const Yf=new wE,jd=(r,e)=>r.x*e.y-r.y*e.x,z2=(r,e)=>r.x*e.x+r.y*e.y,E1=(r,e,t)=>{const n=vE(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},tp=r=>Math.sqrt(z2(r,r)),xE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return jd(i,n)/tp(i)/tp(n)},AE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return z2(i,n)/tp(i)/tp(n)},L1=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},I1=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},kE=(r,e,t,n)=>{if(e.x===0)return I1(t,n,r.x);if(n.x===0)return I1(r,e,t.x);if(e.y===0)return L1(t,n,r.y);if(n.y===0)return L1(r,e,t.y);const i=jd(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=jd(o,e)/i,s=jd(o,n)/i,h=r.x+s*e.x,p=t.x+u*n.x,g=r.y+s*e.y,_=t.y+u*n.y,x=(h+p)/2,C=(g+_)/2;return{x,y:C}};class es{static compare(e,t){const n=es.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Na.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:xE(this.point,e.point,o.point),cosine:AE(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:s}=t.get(i),{sine:h,cosine:p}=t.get(o);return u>=0&&h>=0?s<p?1:s>p?-1:0:u<0&&h<0?s<p?-1:s>p?1:0:h<u?-1:h>u?1:0}}}let SE=0;class Na{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const s=e.leftSE.point.y,h=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(h<s&&h<p)return 1;if(h>s&&h>p)return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(n>i){if(s<h&&s<g)return-1;if(s>h&&s>g)return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s<h)return-1;if(s>h)return 1;if(o<u){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o>u){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(o!==u){const _=p-s,x=o-n,C=g-h,T=u-i;if(_>x&&C<T)return 1;if(_<x&&C>T)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++SE,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const s=es.comparePoints(e,t);if(s<0)i=e,o=t,u=1;else if(s>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const h=new es(i,!0),p=new es(o,!1);return new Na(h,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const s=(e.x-t.x)/i.x,h=t.y+s*i.y;return e.y===h?0:e.y<h?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=yg(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,s=e.leftSE.point,h=e.rightSE.point,p=_f(t,s)&&this.comparePoint(s)===0,g=_f(n,o)&&e.comparePoint(o)===0,_=_f(t,h)&&this.comparePoint(h)===0,x=_f(n,u)&&e.comparePoint(u)===0;if(g&&p)return x&&!_?u:!x&&_?h:null;if(g)return _&&o.x===h.x&&o.y===h.y?null:o;if(p)return x&&u.x===s.x&&u.y===s.y?null:s;if(x&&_)return null;if(x)return u;if(_)return h;const C=kE(o,this.vector(),s,e.vector());return C===null||!_f(i,C)?null:Yf.round(C.x,C.y)}split(e){const t=[],n=e.events!==void 0,i=new es(e,!0),o=new es(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const s=new Na(i,u,this.rings.slice(),this.windings.slice());return es.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),es.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Na.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const s=n.rings[o],h=n.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(h)):t.windings[p]+=h}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,h=this.rings.length;s<h;s++){const p=this.rings[s],g=this.windings[s],_=t.indexOf(p);_===-1?(t.push(p),n.push(g)):n[_]+=g}const o=[],u=[];for(let s=0,h=t.length;s<h;s++){if(n[s]===0)continue;const p=t[s],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let s=0,h=o.length;s<h;s++){const p=o[s].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(bs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===bs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${bs.type}`)}return this._isInResult}}class P1{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Yf.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,s=e.length;u<s;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let h=Yf.round(e[u][0],e[u][1]);h.x===o.x&&h.y===o.y||(this.segments.push(Na.fromRing(o,h,this)),h.x<this.bbox.ll.x&&(this.bbox.ll.x=h.x),h.y<this.bbox.ll.y&&(this.bbox.ll.y=h.y),h.x>this.bbox.ur.x&&(this.bbox.ur.x=h.x),h.y>this.bbox.ur.y&&(this.bbox.ur.y=h.y),o=h)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Na.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class CE{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new P1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new P1(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class z1{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new CE(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class np{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,s=o.leftSE,h=o.rightSE;const p=[s],g=s.point,_=[];for(;u=s,s=h,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const z=p[0].point,L=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${z.x}, ${z.y}]. Last matching segment found ends at [${L.x}, ${L.y}].`)}if(x.length===1){h=x[0].otherSE;break}let C=null;for(let z=0,L=_.length;z<L;z++)if(_[z].point===s.point){C=z;break}if(C!==null){const z=_.splice(C)[0],L=p.splice(z.index);L.unshift(L[0].otherSE),t.push(new np(L.reverse()));continue}_.push({index:p.length,point:s.point});const T=s.getLeftmostComparator(u);h=x.sort(T)[0].otherSE;break}t.push(new np(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const _=this.events[p].point,x=this.events[p+1].point;E1(_,e,x)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const n=t[0],i=t[1];E1(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,h=[];for(let p=u;p!=s;p+=o)h.push([t[p].x,t[p].y]);return h}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];es.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class D1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class TE{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new D1(o));else{const u=o.enclosingRing();u.poly||t.push(new D1(u)),u.poly.addInterior(o)}}return t}}class ME{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Na.compare;this.queue=e,this.tree=new l_(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,s,h;for(;s===void 0;)o=this.tree.prev(o),o===null?s=null:o.key.consumedBy===void 0&&(s=o.key);for(;h===void 0;)u=this.tree.next(u),u===null?h=null:u.key.consumedBy===void 0&&(h=u.key);if(e.isLeft){let p=null;if(s){const _=s.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(p=_),!s.isAnEndpoint(_))){const x=this._splitSafely(s,_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}let g=null;if(h){const _=h.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(g=_),!h.isAnEndpoint(_))){const x=this._splitSafely(h,_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}if(p!==null||g!==null){let _=null;p===null?_=g:g===null?_=p:_=es.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const x=t.split(_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&h){const p=s.getIntersection(h);if(p!==null){if(!s.isAnEndpoint(p)){const g=this._splitSafely(s,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}if(!h.isAnEndpoint(p)){const g=this._splitSafely(h,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const R1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,EE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class LE{run(e,t,n){bs.type=e,Yf.reset();const i=[new z1(t,!0)];for(let g=0,_=n.length;g<_;g++)i.push(new z1(n[g],!1));if(bs.numMultiPolys=i.length,bs.type==="difference"){const g=i[0];let _=1;for(;_<i.length;)yg(i[_].bbox,g.bbox)!==null?_++:i.splice(_,1)}if(bs.type==="intersection")for(let g=0,_=i.length;g<_;g++){const x=i[g];for(let C=g+1,T=i.length;C<T;C++)if(yg(x.bbox,i[C].bbox)===null)return[]}const o=new l_(es.compare);for(let g=0,_=i.length;g<_;g++){const x=i[g].getSweepEvents();for(let C=0,T=x.length;C<T;C++)if(o.insert(x[C]),o.size>R1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new ME(o);let s=o.size,h=o.pop();for(;h;){const g=h.key;if(o.size===s){const x=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(o.size>R1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>EE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const _=u.process(g);for(let x=0,C=_.length;x<C;x++){const T=_[x];T.consumedBy===void 0&&o.insert(T)}s=o.size,h=o.pop()}Yf.reset();const p=np.factory(u.segments);return new TE(p).getGeom()}}const bs=new LE,IE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("union",r,t)},PE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("intersection",r,t)},zE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("xor",r,t)},DE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("difference",r,t)};var D2={union:IE,intersection:PE,xor:zE,difference:DE};function R2(r,e,t){if(r!==null)for(var n,i,o,u,s,h,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",z=C==="Feature",L=T?r.features.length:1,E=0;E<L;E++){p=T?r.features[E].geometry:z?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var O=0,B=0;if(u=x?p.geometries[I]:p,u!==null){h=u.coordinates;var K=u.type;switch(g=0,K){case null:break;case"Point":if(e(h,_,E,O,B)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<h.length;n++){if(e(h[n],_,E,O,B)===!1)return!1;_++,K==="MultiPoint"&&O++}K==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<h.length;n++){for(i=0;i<h[n].length-g;i++){if(e(h[n][i],_,E,O,B)===!1)return!1;_++}K==="MultiLineString"&&O++,K==="Polygon"&&B++}K==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<h.length;n++){for(B=0,i=0;i<h[n].length;i++){for(o=0;o<h[n][i].length-g;o++){if(e(h[n][i][o],_,E,O,B)===!1)return!1;_++}B++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(R2(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function u_(r,e){var t,n,i,o,u,s,h,p,g,_,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",z=C?r.features.length:1;for(t=0;t<z;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,_=C?r.features[t].id:T?r.id:void 0,h=s?s.type==="GeometryCollection":!1,u=h?s.geometries.length:1,i=0;i<u;i++){if(o=h?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function RE(r,e){u_(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Kf(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var h;switch(s){case"MultiPoint":h="Point";break;case"MultiLineString":h="LineString";break;case"MultiPolygon":h="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:h,coordinates:g};if(e(Kf(_,i),n,p)===!1)return!1}})}function BE(r,e={}){const t=[];if(u_(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=D2.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?a_(n[0],e.properties):P2(n,e.properties)}var B2=BE;function FE(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return R2(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var B1=FE;function OE(r){const e=[];if(u_(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=D2.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?a_(n[0],t):P2(n,t)}var $E=OE;function NE(r){if(!r)throw new Error("geojson is required");var e=[];return RE(r,function(t){e.push(t)}),Jf(e)}var jE=NE;function F1(r,e){const t=$E(Jf([a_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=ep(B1(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,s=jE(r);if(s.features.length>1&&(o||u))for(const h of s.features){const p=ep(B1(h));if(u&&p[0]<-180+i)for(const g of h.geometry.coordinates)for(const _ of g)_[0]+=360-i;if(o&&p[2]>180-i)for(const g of h.geometry.coordinates)for(const _ of g)_[0]-=360-i}e(Jf([s.features.length<2?r:B2(s)??r,t]))}const O1={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Sd="mtlr-gc-full-geom",$1="mtlr-gc-full-geom-fill",N1="mtlr-gc-full-geom-line";function F2(r,e,t=!0,n=!0,i={},o={},u=O1){let s;const h=[];let p,g,_;function x(){if(!r.loaded){r.once("load",x);return}const L=u?u===!0?O1:u:void 0;if(!(L!=null&&L.fill)&&!(L!=null&&L.line))return;const E=r.getSource(Sd);if(E)E.setData(_??Jf([]));else if(_)r.addSource(Sd,{type:"geojson",data:_});else return;!r.getLayer($1)&&L!=null&&L.fill&&r.addLayer({...L==null?void 0:L.fill,id:$1,type:"fill",source:Sd}),!r.getLayer(N1)&&L!=null&&L.line&&r.addLayer({...L==null?void 0:L.line,id:N1,type:"line",source:Sd})}function C(L){_=L,x()}r.on("styledata",()=>{setTimeout(()=>{_&&x()})});const T=L=>{s==null||s({type:"mapClick",coordinates:[L.lngLat.lng,L.lngLat.lat]})};function z(L=!1){if(!e)throw new Error;const E=document.createElement("div");return L&&E.classList.add("marker-interactive"),new BM({props:{displayIn:"maplibre"},target:E}),new e.Marker({element:E,offset:[1,-13]})}return{setEventHandler(L){L?(s=L,r.on("click",T)):(s=void 0,r.off("click",T))},flyTo(L,E){r.flyTo({center:L,...E?{zoom:E}:{},...i})},fitBounds(L,E,I){r.fitBounds([[L[0],L[1]],[L[2],L[3]]],{padding:E,...I?{maxZoom:I}:{},...o})},indicateReverse(L){r.getCanvasContainer().style.cursor=L?"crosshair":""},setReverseMarker(L){!e||!t||(g?L?g.setLngLat(L):(g.remove(),g=void 0):L&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):z()).setLngLat(L).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(L,E,I){for(const O of h)O.remove();if(h.length=0,C(void 0),!!e){if(E){let O=!1;if(E.geometry.type==="GeometryCollection"){const B=E.geometry.geometries.filter(K=>K.type==="Polygon"||K.type==="MultiPolygon");e:if(B.length>0){const K=B2(Jf(B.map(H=>Kf(H))));if(!K)break e;F1({...E,geometry:K.geometry},C),O=!0}else{const K=E.geometry.geometries.filter(H=>H.type==="LineString"||H.type==="MultiLineString");K.length>0&&(C({...E,geometry:{type:"GeometryCollection",geometries:K}}),O=!0)}}if(!O){if(E.geometry.type==="Polygon"||E.geometry.type==="MultiPolygon")F1(E,C);else if(E.geometry.type==="LineString"||E.geometry.type==="MultiLineString"){C(E);return}}if(!I&&E.geometry.type!=="Point")return;if(t instanceof Function){const B=t(r,E);B&&h.push(B)}else t&&h.push(typeof t=="object"?new e.Marker(t):z().setLngLat(E.center).addTo(r))}if(n)for(const O of L??[]){if(O===E)continue;let B;if(n instanceof Function){if(B=n(r,O),!B)continue}else B=(typeof n=="object"?new e.Marker(n):z(!0)).setLngLat(O.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(O.place_type[0]==="reverse"?O.place_name:O.place_name.replace(/,.*/,""))).addTo(r);const K=B.getElement();K.addEventListener("click",H=>{H.stopPropagation(),s==null||s({type:"markerClick",id:O.id})}),K.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:O.id}),B.togglePopup()}),K.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:O.id}),B.togglePopup()}),h.push(B)}}},setSelectedMarker(L){p&&p.getElement().classList.toggle("marker-selected",!1),p=L>-1?h[L]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const L=r.getCenter();return[r.getZoom(),L.lng,L.lat]}}}function UE(r,e,t){var n,i;class o{constructor(L,E){Bo(this,"type"),Bo(this,"target"),this.type=E,this.target=L}}class u extends o{constructor(L,E){super(L,"select"),Bo(this,"feature"),Object.assign(this,E)}}class s extends o{constructor(L,E){super(L,"featureslisted"),Bo(this,"features"),this.features=E}}class h extends o{constructor(L,E){super(L,"featuresmarked"),Bo(this,"features"),this.features=E}}class p extends o{constructor(L,E){super(L,"optionsvisibilitychange"),Bo(this,"optionsVisible"),this.optionsVisible=E}}class g extends o{constructor(L,E){super(L,"pick"),Bo(this,"feature"),this.feature=E}}class _ extends o{constructor(L,E){super(L,"querychange"),Bo(this,"query"),this.query=E}}class x extends o{constructor(L,E,I){super(L,"response"),Bo(this,"url"),Bo(this,"featureCollection"),this.url=E,this.featureCollection=I}}class C extends o{constructor(L,E){super(L,"reversetoggle"),Bo(this,"reverse"),this.reverse=E}}class T extends r{constructor(L={}){super(),r1(this,n),r1(this,i),i1(this,i,L)}onAddInt(L){const E=document.createElement("div");E.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:I,showResultMarkers:O,flyTo:B,fullGeometryStyle:K,...H}=vi(this,i),q=typeof B=="boolean"?{}:B,J={mapController:F2(L,e,I,O,q,q,K),flyTo:B===void 0?!0:!!B,apiKey:"",...t==null?void 0:t(L,E),...H};if(!J.apiKey)throw new Error("no apiKey provided");return i1(this,n,new sE({target:E,props:J})),vi(this,n).$on("select",fe=>{this.fire(new u(this,fe.detail))}),vi(this,n).$on("pick",fe=>{this.fire(new g(this,fe.detail.feature))}),vi(this,n).$on("featureslisted",fe=>{this.fire(new s(this,fe.detail.features))}),vi(this,n).$on("featuresmarked",fe=>{this.fire(new h(this,fe.detail.features))}),vi(this,n).$on("response",fe=>{this.fire(new x(this,fe.detail.url,fe.detail.featureCollection))}),vi(this,n).$on("optionsvisibilitychange",fe=>{this.fire(new p(this,fe.detail.optionsVisible))}),vi(this,n).$on("reversetoggle",fe=>{this.fire(new C(this,fe.detail.reverse))}),vi(this,n).$on("querychange",fe=>{this.fire(new _(this,fe.detail.query))}),E}on(L,E){return super.on(L,E)}once(L,E){return super.once(L,E)}off(L,E){return super.off(L,E)}listens(L){return super.listens(L)}setOptions(L){var E;Object.assign(vi(this,i),L);const{marker:I,showResultMarkers:O,flyTo:B,fullGeometryStyle:K,...H}=vi(this,i);(E=vi(this,n))==null||E.$set(H)}setQuery(L,E=!0){var I;(I=vi(this,n))==null||I.setQuery(L,E)}clearMap(){var L;(L=vi(this,n))==null||L.clearMap()}clearList(){var L;(L=vi(this,n))==null||L.clearList()}setReverseMode(L){var E;(E=vi(this,n))==null||E.$set({reverseActive:L})}focus(){var L;(L=vi(this,n))==null||L.focus()}blur(){var L;(L=vi(this,n))==null||L.blur()}onRemove(){var L;(L=vi(this,n))==null||L.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:T,events:{SelectEvent:u,FeaturesListedEvent:s,FeaturesMarkedEvent:h,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:_,ResponseEvent:x,ReverseToggleEvent:C}}}const{MapLibreBasedGeocodingControl:zB,events:el}=UE(ua.Evented,vk);el.SelectEvent;el.FeaturesListedEvent;el.FeaturesMarkedEvent;el.OptionsVisibilityChangeEvent;el.PickEvent;el.QueryChangeEvent;el.ResponseEvent;el.ReverseToggleEvent;function VE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),he(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),he(e,"viewBox","0 0 14 14"),he(e,"width","13"),he(e,"height","13"),he(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),F(e,t)},p:at,i:at,o:at,d(n){n&&G(e)}}}class O2 extends Lt{constructor(e){super(),Et(this,e,null,VE,St,{})}}function qE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),he(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),he(e,"viewBox","0 0 30 30"),he(e,"fill","none"),he(e,"xmlns","http://www.w3.org/2000/svg"),he(e,"class","svelte-d2loi5")},m(n,i){W(n,e,i),F(e,t)},p:at,i:at,o:at,d(n){n&&G(e)}}}class $2 extends Lt{constructor(e){super(),Et(this,e,null,qE,St,{})}}function HE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"area.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"area.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function GE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"reverse.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"reverse.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function WE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"poi.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"poi.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function ZE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"postal_code.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"postal_code.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function XE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"street.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"street.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function KE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"road.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"road.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function JE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"housenumber.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"housenumber.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&G(e)}}}function YE(r){let e,t,n,i;return{c(){e=U("img"),Sr(e.src,t=r[5])||he(e,"src",t),he(e,"alt",r[4]),he(e,"class","svelte-ltkwvy")},m(o,u){W(o,e,u),n||(i=Mt(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Sr(e.src,t=o[5])&&he(e,"src",t),u&16&&he(e,"alt",o[4])},d(o){o&&G(e),n=!1,i()}}}function j1(r){let e,t;return{c(){e=U("span"),t=Me(r[6]),he(e,"class","secondary svelte-ltkwvy")},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&64&&kt(t,n[6])},d(n){n&&G(e)}}}function QE(r){let e,t,n,i,o,u,s,h,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,z,L=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,I,O;function B(J,fe){return fe&1&&(t=null),fe&1&&(n=null),fe&1&&(i=null),fe&1&&(o=null),J[5]?YE:J[0].address?JE:(t==null&&(t=!!J[0].id.startsWith("road.")),t?KE:(n==null&&(n=!!J[0].id.startsWith("address.")),n?XE:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?ZE:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?WE:J[7]?GE:HE))))}let K=B(r,-1),H=K(r),q=C&&j1(r);return{c(){e=U("li"),H.c(),u=ie(),s=U("span"),h=U("span"),p=U("span"),_=Me(g),x=ie(),q&&q.c(),T=ie(),z=U("span"),E=Me(L),he(p,"class","primary svelte-ltkwvy"),he(h,"class","svelte-ltkwvy"),he(z,"class","line2 svelte-ltkwvy"),he(s,"class","texts svelte-ltkwvy"),he(e,"tabindex","0"),he(e,"data-selected",r[1]),he(e,"class","svelte-ltkwvy"),Wt(e,"selected",r[1])},m(J,fe){W(J,e,fe),H.m(e,null),F(e,u),F(e,s),F(s,h),F(h,p),F(p,_),F(h,x),q&&q.m(h,null),F(s,T),F(s,z),F(z,E),I||(O=[Mt(e,"mouseenter",r[12]),Mt(e,"focus",r[13])],I=!0)},p(J,[fe]){K===(K=B(J,fe))&&H?H.p(J,fe):(H.d(1),H=K(J),H&&(H.c(),H.m(e,u))),fe&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&kt(_,g),fe&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?q?q.p(J,fe):(q=j1(J),q.c(),q.m(h,null)):q&&(q.d(1),q=null),fe&1&&L!==(L=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&kt(E,L),fe&2&&he(e,"data-selected",J[1]),fe&2&&Wt(e,"selected",J[1])},i:at,o:at,d(J){J&&G(e),H.d(),q&&q.d(),I=!1,cr(O)}}}function e6(r,e,t){var O;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:s}=e,{missingIconsCache:h}=e,{iconsBaseUrl:p}=e;const g=(O=o.properties)==null?void 0:O.categories;let _,x,C=0,T=o.place_type[0]==="reverse";function z(){x&&h.add(x),t(10,C++,C)}function L(B){Pn.call(this,r,B)}function E(B){Pn.call(this,r,B)}const I=()=>z();return r.$$set=B=>{"feature"in B&&t(0,o=B.feature),"selected"in B&&t(1,u=B.selected),"showPlaceType"in B&&t(2,s=B.showPlaceType),"missingIconsCache"in B&&t(9,h=B.missingIconsCache),"iconsBaseUrl"in B&&t(3,p=B.iconsBaseUrl)},r.$$.update=()=>{var B,K,H,q;if(r.$$.dirty&3640)do t(11,n--,n),t(4,_=g==null?void 0:g[n]),t(5,x=_?p+_.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!x||h.has(x)));r.$$.dirty&1&&t(6,i=((K=(B=o.properties)==null?void 0:B.categories)==null?void 0:K.join(", "))??((q=(H=o.properties)==null?void 0:H.place_type_name)==null?void 0:q[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,s,p,_,x,i,T,z,h,C,n,L,E,I]}class t6 extends Lt{constructor(e){super(),Et(this,e,e6,QE,St,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function n6(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',he(e,"class","svelte-7cmwmc")},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&G(e)}}}class r6 extends Lt{constructor(e){super(),Et(this,e,null,n6,St,{})}}function i6(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),he(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),he(e,"viewBox","0 0 60.006 21.412"),he(e,"width","14"),he(e,"height","20"),he(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),F(e,t)},p:at,i:at,o:at,d(n){n&&G(e)}}}class o6 extends Lt{constructor(e){super(),Et(this,e,null,i6,St,{})}}function s6(r){let e,t,n;return{c(){e=ws("svg"),t=ws("circle"),n=ws("path"),he(t,"cx","4.789"),he(t,"cy","4.787"),he(t,"r","3.85"),he(t,"class","svelte-1aq105l"),he(n,"d","M12.063 12.063 7.635 7.635"),he(n,"class","svelte-1aq105l"),he(e,"xmlns","http://www.w3.org/2000/svg"),he(e,"width","13"),he(e,"height","13"),he(e,"viewBox","0 0 13 13"),he(e,"class","svelte-1aq105l")},m(i,o){W(i,e,o),F(e,t),F(e,n)},p:at,i:at,o:at,d(i){i&&G(e)}}}class a6 extends Lt{constructor(e){super(),Et(this,e,null,s6,St,{})}}function l6(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function U1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let yf;async function u6(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(yf&&i.cachedLocationExpiry&&yf.time+i.cachedLocationExpiry>Date.now()){if(!yf.coords)break e;return yf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(h=>{u([h.coords.longitude,h.coords.latitude].map(p=>p.toFixed(6)).join(","))},h=>{s(h)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(yf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const c6=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,V1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,q1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,H1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,G1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,W1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function f6(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let h;r=="DD"&&(h=`${i}° ${u}, ${o}° ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=Z1(_,3).toFixed(3).padStart(6,"0"),T=Z1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),h=`${p}° ${C}' ${u}, ${g}° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(_),T=Math.floor(x);let z=((_-C)*60).toFixed(1).padStart(4,"0"),L=((x-T)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),I=T.toString().padStart(2,"0");z.endsWith(".0")&&L.endsWith(".0")&&(z=z.replace(/\.0$/,""),L=L.replace(/\.0$/,"")),h=`${p}° ${E}' ${z}" ${u}, ${g}° ${I}' ${L}" ${s}`}return h}else throw new Error("no decimal coordinates to convert")}function Z1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function c_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],h=!1;if(c6.test(r))throw new Error("invalid coordinate value");if(V1.test(r))if(s=V1.exec(r),h=vf(s),h)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(q1.test(r))if(s=q1.exec(r),h=vf(s),h){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(H1.test(r))if(s=H1.exec(r),h=vf(s),h)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(G1.test(r))if(s=G1.exec(r),h=vf(s),h)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(W1.test(r)){if(s=W1.exec(r),h=vf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(h)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(h){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const E=Math.floor(r.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;T.length%2==1?E=Math.floor(T.length/2):E=T.length/2-1;let I=0;if(E==0)I=g.indexOf(T[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let O=0,B=0;for(;O<=E;)I=g.indexOf(T[O],B),B=I+1,O++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const z=_.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");const L=x.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:h6,toCoordinateFormat:f6})}else throw new Error("coordinates pattern match failed")}function vf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],h=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(h||p||g)continue;return!1}}return!0}function X1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function h6(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return X1(this.decimalLatitude,Number(e[0]))&&X1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const d6=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});c_.to=d6;const p6=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],m6={decimalLatitude:40.123,decimalLongitude:-74.123},g6=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],_6=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function y6(){const r=[];return p6.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...m6})}),[...r,...g6,..._6]}const v6=y6();c_.formats=v6.map(r=>r.verbatimCoordinates);const b6=c_;function K1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function J1(r){let e,t;return e=new r6({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Y1(r){let e,t,n,i,o;return t=new o6({}),{c(){e=U("button"),ue(t.$$.fragment),he(e,"type","button"),he(e,"title",r[9]),he(e,"class","svelte-bz0zu3"),Wt(e,"active",r[0])},m(u,s){W(u,e,s),ae(t,e,null),n=!0,i||(o=Mt(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&he(e,"title",u[9]),(!n||s[0]&1)&&Wt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){V(t.$$.fragment,u),n=!1},d(u){u&&G(e),le(t),i=!1,o()}}}function w6(r){let e,t=[],n=new Map,i,o,u,s=On(r[14]);const h=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=K1(r,s,p),_=h(g);n.set(_,t[p]=Q1(_,g))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();he(e,"class","options svelte-bz0zu3")},m(p,g){W(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[Mt(e,"mouseleave",r[73]),Mt(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=On(p[14]),Kt(),t=lk(t,g,h,1,p,s,n,e,ak,Q1,null,K1),Jt())},i(p){if(!i){for(let g=0;g<s.length;g+=1)N(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)V(t[g]);i=!1},d(p){p&&G(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,cr(u)}}}function x6(r){let e,t,n,i,o,u;return t=new $2({}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),o=Me(r[7]),he(i,"class","svelte-bz0zu3"),he(e,"class","no-results svelte-bz0zu3")},m(s,h){W(s,e,h),ae(t,e,null),F(e,n),F(e,i),F(i,o),u=!0},p(s,h){(!u||h[0]&128)&&kt(o,s[7])},i(s){u||(N(t.$$.fragment,s),u=!0)},o(s){V(t.$$.fragment,s),u=!1},d(s){s&&G(e),le(t)}}}function A6(r){let e="",t;return{c(){t=Me(e)},m(n,i){W(n,t,i)},p:at,i:at,o:at,d(n){n&&G(t)}}}function k6(r){let e,t,n,i,o,u,s,h,p,g,_;return t=new $2({}),h=new O2({}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),o=Me(r[6]),u=ie(),s=U("button"),ue(h.$$.fragment),he(i,"class","svelte-bz0zu3"),he(s,"class","svelte-bz0zu3"),he(e,"class","error svelte-bz0zu3")},m(x,C){W(x,e,C),ae(t,e,null),F(e,n),F(e,i),F(i,o),F(e,u),F(e,s),ae(h,s,null),p=!0,g||(_=Mt(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&kt(o,x[6])},i(x){p||(N(t.$$.fragment,x),N(h.$$.fragment,x),p=!0)},o(x){V(t.$$.fragment,x),V(h.$$.fragment,x),p=!1},d(x){x&&G(e),le(t),le(h),g=!1,_()}}}function Q1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new t6({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=nr(),ue(n.$$.fragment),this.first=t},m(s,h){W(s,t,h),ae(n,s,h),i=!0},p(s,h){e=s;const p={};h[0]&16384&&(p.feature=e[84]),h[0]&1024&&(p.showPlaceType=e[10]),h[0]&49152&&(p.selected=e[15]===e[86]),h[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(N(n.$$.fragment,s),i=!0)},o(s){V(n.$$.fragment,s),i=!1},d(s){s&&G(t),le(n,s)}}}function S6(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H=!1;o=new a6({}),_=new O2({});let q=r[19]&&J1(),J=r[5]==="button"&&Y1(r);const fe=r[61].default,Ee=vn(fe,r,r[60],null),ee=[k6,A6,x6,w6],oe=[];function xe(me,tt){var Ue,ze;return me[18]?0:me[16]?((Ue=me[14])==null?void 0:Ue.length)===0?2:me[16]&&((ze=me[14])!=null&&ze.length)?3:-1:1}return~(L=xe(r))&&(E=oe[L]=ee[L](r)),{c(){e=ie(),t=U("form"),n=U("div"),i=U("button"),ue(o.$$.fragment),u=ie(),s=U("input"),h=ie(),p=U("div"),g=U("button"),ue(_.$$.fragment),x=ie(),q&&q.c(),C=ie(),J&&J.c(),T=ie(),Ee&&Ee.c(),z=ie(),E&&E.c(),he(i,"class","search-button svelte-bz0zu3"),he(i,"type","button"),he(s,"placeholder",r[8]),he(s,"aria-label",r[8]),he(s,"class","svelte-bz0zu3"),he(g,"type","button"),he(g,"title",r[3]),he(g,"class","svelte-bz0zu3"),he(p,"class","clear-button-container svelte-bz0zu3"),Wt(p,"displayable",r[1]!==""),he(n,"class","input-group svelte-bz0zu3"),he(t,"tabindex","0"),he(t,"class",I=ec(r[2])+" svelte-bz0zu3"),Wt(t,"can-collapse",r[4]&&r[1]==="")},m(me,tt){W(me,e,tt),W(me,t,tt),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),r[63](s),Wn(s,r[1]),F(n,h),F(n,p),F(p,g),ae(_,g,null),F(p,x),q&&q.m(p,null),F(n,C),J&&J.m(n,null),F(n,T),Ee&&Ee.m(n,null),F(t,z),~L&&oe[L].m(t,null),O=!0,B||(K=[Mt(i,"click",r[62]),Mt(s,"input",r[64]),Mt(s,"focus",r[65]),Mt(s,"blur",r[66]),Mt(s,"keydown",r[22]),Mt(s,"input",r[67]),Mt(g,"click",r[68]),Mt(t,"submit",Ig(r[21]))],B=!0)},p(me,tt){(!O||tt[0]&256)&&he(s,"placeholder",me[8]),(!O||tt[0]&256)&&he(s,"aria-label",me[8]),tt[0]&2&&s.value!==me[1]&&Wn(s,me[1]),(!O||tt[0]&8)&&he(g,"title",me[3]),me[19]?q?tt[0]&524288&&N(q,1):(q=J1(),q.c(),N(q,1),q.m(p,null)):q&&(Kt(),V(q,1,1,()=>{q=null}),Jt()),(!O||tt[0]&2)&&Wt(p,"displayable",me[1]!==""),me[5]==="button"?J?(J.p(me,tt),tt[0]&32&&N(J,1)):(J=Y1(me),J.c(),N(J,1),J.m(n,T)):J&&(Kt(),V(J,1,1,()=>{J=null}),Jt()),Ee&&Ee.p&&(!O||tt[1]&536870912)&&wn(Ee,fe,me,me[60],O?bn(fe,me[60],tt,null):xn(me[60]),null);let Ue=L;L=xe(me),L===Ue?~L&&oe[L].p(me,tt):(E&&(Kt(),V(oe[Ue],1,1,()=>{oe[Ue]=null}),Jt()),~L?(E=oe[L],E?E.p(me,tt):(E=oe[L]=ee[L](me),E.c()),N(E,1),E.m(t,null)):E=null),(!O||tt[0]&4&&I!==(I=ec(me[2])+" svelte-bz0zu3"))&&he(t,"class",I),(!O||tt[0]&22)&&Wt(t,"can-collapse",me[4]&&me[1]==="")},i(me){O||(N(H),N(o.$$.fragment,me),N(_.$$.fragment,me),N(q),N(J),N(Ee,me),N(E),O=!0)},o(me){V(H),V(o.$$.fragment,me),V(_.$$.fragment,me),V(q),V(J),V(Ee,me),V(E),O=!1},d(me){me&&(G(e),G(t)),le(o),r[63](null),le(_),q&&q.d(),J&&J.d(),Ee&&Ee.d(me),~L&&oe[L].d(),B=!1,cr(K)}}}function C6(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:h=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:z=200}=e,{enableReverse:L="never"}=e,{errorMessage:E="Something went wrong…"}=e,{filter:I=()=>!0}=e,{flyTo:O=!0}=e,{fuzzyMatch:B=!0}=e,{language:K=void 0}=e,{limit:H=void 0}=e,{mapController:q=void 0}=e,{minLength:J=2}=e,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ee="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:oe=L==="always"}=e,{reverseButtonTitle:xe="toggle reverse geocoding"}=e,{searchValue:me=""}=e,{pickedResultStyle:tt="full-geometry"}=e,{showPlaceType:Ue="if-needed"}=e,{showResultsWhileTyping:ze=!0}=e,{selectFirst:Ie=!0}=e,{flyToSelected:ct=!1}=e,{markerOnSelected:Xe=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:pt=!1}=e,{excludeTypes:_t=!1}=e,{zoom:He=s}=e,{apiUrl:gt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:un=()=>{}}=e;function nn(){Ke.focus()}function rn(){Ke.blur()}function pn(re,Je=!0,Qe=!1){t(1,me=re),Je?(t(15,ut=-1),xt()):(bt(!Qe,Qe),setTimeout(()=>{Ke.focus(),Ke.select()}))}function yn(){t(14,At=void 0),t(56,de=void 0),t(15,ut=-1)}function qe(){t(55,nt=[]),t(56,de=void 0)}let Ge=!1,At,nt,de,cn="",Ke,ut=-1,Gt,Jn=[],Zn,fr,Cr,Tr;const xi=new Set,Un=js();ri(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function xt(re){if(fr&&(clearTimeout(fr),fr=void 0),ut>-1&&At)t(56,de=At[ut]),t(1,me=de.place_type[0]==="reverse"?de.place_name:de.place_name.replace(/,.*/,"")),t(18,Gt=void 0),t(55,nt=void 0),t(15,ut=-1);else if(me){const Je=re||!zr(me);br(me,{exact:!0}).then(()=>{t(55,nt=At),t(56,de=void 0),Je&&Fi()}).catch(Qe=>t(18,Gt=Qe))}}function zr(re){try{return b6(re,6)}catch{return!1}}async function br(re,{byId:Je=!1,exact:Qe=!1}={}){t(18,Gt=void 0),Zn==null||Zn.abort();const rt=new AbortController;t(19,Zn=rt);try{const ht=zr(re),Dt=new URLSearchParams;if(K!==void 0&&Dt.set("language",Array.isArray(K)?K.join(","):K??""),lt&&Dt.set("types",lt.join(",")),_t&&Dt.set("excludeTypes",String(_t)),g&&Dt.set("bbox",g.map(Nn=>Nn.toFixed(6)).join(",")),T&&Dt.set("country",Array.isArray(T)?T.join(","):T),!Je&&!ht){const Nn=await u6(q,ee,rt);Nn&&Dt.set("proximity",Nn),(Qe||!ze)&&Dt.set("autocomplete","false"),Dt.set("fuzzyMatch",String(B))}H!==void 0&&(pt||!ht||(lt==null?void 0:lt.length)===1)&&Dt.set("limit",String(H)),Dt.set("key",p),un(Dt);const en=gt+"/"+encodeURIComponent(ht?ht.decimalLongitude+","+ht.decimalLatitude:re)+".json?"+Dt.toString();if(en===cn){Je?(t(14,At=void 0),t(56,de=Jn[0])):t(14,At=Jn);return}cn=en;const mn=await fetch(en,{signal:rt.signal,...Pt});if(!mn.ok)throw new Error(await mn.text());const Cn=await mn.json();Un("response",{url:en,featureCollection:Cn}),Je?(t(14,At=void 0),t(56,de=Cn.features[0]),Jn=[de]):(t(14,At=Cn.features.filter(I)),ht&&At.unshift({type:"Feature",properties:{},id:"reverse_"+ht.decimalLongitude+"_"+ht.decimalLatitude,text:ht.decimalLatitude+", "+ht.decimalLongitude,place_name:ht.decimalLatitude+", "+ht.decimalLongitude,place_type:["reverse"],center:[ht.decimalLongitude,ht.decimalLatitude],bbox:[ht.decimalLongitude,ht.decimalLatitude,ht.decimalLongitude,ht.decimalLatitude],geometry:{type:"Point",coordinates:[ht.decimalLongitude,ht.decimalLatitude]}}),Jn=At,ht&&Ke.focus())}catch(ht){if(ht&&typeof ht=="object"&&"name"in ht&&ht.name==="AbortError")return;throw ht}finally{rt===Zn&&t(19,Zn=void 0)}}function Fi(){var rt;if(!(nt!=null&&nt.length)||!O)return;const re=[180,90,-180,-90],Je=!nt.some(ht=>!ht.matching_text);let Qe;for(const ht of nt){const Dt=$n(ht);if(Qe=Qe===void 0?Dt:Dt===void 0?Qe:Math.max(Qe,Dt),Je||!ht.matching_text)for(const en of[0,1,2,3])re[en]=Math[en<2?"min":"max"](re[en],((rt=ht.bbox)==null?void 0:rt[en])??ht.center[en%2])}q&&nt.length>0&&(de&&re[0]===re[2]&&re[1]===re[3]?q.flyTo(de.center,$n(de)):q.fitBounds(U1(re),50,Qe))}function $n(re){var Qe;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Je=re.id.replace(/\..*/,"");return(Array.isArray((Qe=re.properties)==null?void 0:Qe.categories)?re.properties.categories.reduce((rt,ht)=>{const Dt=He[Je+"."+ht];return rt===void 0?Dt:Dt===void 0?rt:Math.max(rt,Dt)},void 0):void 0)??He[Je]}function Fe(re){t(0,oe=L==="always"),t(14,At=void 0),t(56,de=void 0),t(15,ut=-1),pn(re[1].toFixed(6)+", "+l6(re[0],[-180,180],!0).toFixed(6),!1,!0)}function yt(re){if(!At)return;let Je=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Je&&(ut===(Ie?0:-1)&&Je===-1&&t(15,ut=At.length),t(15,ut+=Je),ut>=At.length&&t(15,ut=-1),ut<0&&Ie&&t(15,ut=0),re.preventDefault())}function bt(re=!0,Je=!1){if(t(18,Gt=void 0),ze||Je){if(fr&&clearTimeout(fr),me.length<J)return;const Qe=me;fr=window.setTimeout(()=>{br(Qe).catch(rt=>t(18,Gt=rt))},re?z:0)}else t(14,At=void 0),t(18,Gt=void 0)}function Rt(re){t(56,de=re),t(1,me=re.place_name),t(15,ut=-1)}const Qt=()=>Ke.focus();function Yt(re){dn[re?"unshift":"push"](()=>{Ke=re,t(17,Ke)})}function vr(){me=this.value,t(1,me),t(13,Ge),t(28,x)}const or=()=>t(13,Ge=!0),Se=()=>t(13,Ge=!1),ne=()=>bt(),ce=()=>{t(1,me=""),Ke.focus()},_e=()=>t(0,oe=!oe),we=()=>t(18,Gt=void 0),Oe=re=>t(15,ut=re),$e=re=>Rt(re),je=()=>{Ie||t(15,ut=-1)},De=()=>{};return r.$$set=re=>{"class"in re&&t(2,h=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,T=re.country),"debounceSearch"in re&&t(30,z=re.debounceSearch),"enableReverse"in re&&t(5,L=re.enableReverse),"errorMessage"in re&&t(6,E=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,O=re.flyTo),"fuzzyMatch"in re&&t(33,B=re.fuzzyMatch),"language"in re&&t(34,K=re.language),"limit"in re&&t(35,H=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,J=re.minLength),"noResultsMessage"in re&&t(7,fe=re.noResultsMessage),"placeholder"in re&&t(8,Ee=re.placeholder),"proximity"in re&&t(38,ee=re.proximity),"reverseActive"in re&&t(0,oe=re.reverseActive),"reverseButtonTitle"in re&&t(9,xe=re.reverseButtonTitle),"searchValue"in re&&t(1,me=re.searchValue),"pickedResultStyle"in re&&t(39,tt=re.pickedResultStyle),"showPlaceType"in re&&t(10,Ue=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,ze=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Ie=re.selectFirst),"flyToSelected"in re&&t(41,ct=re.flyToSelected),"markerOnSelected"in re&&t(42,Xe=re.markerOnSelected),"types"in re&&t(43,lt=re.types),"exhaustiveReverseGeocoding"in re&&t(44,pt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,_t=re.excludeTypes),"zoom"in re&&t(46,He=re.zoom),"apiUrl"in re&&t(47,gt=re.apiUrl),"fetchParameters"in re&&t(48,Pt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,jt=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,un=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,oe=L==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Cr=Ge),x&&!Ge&&t(1,me="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&me.length<J&&(t(56,de=void 0),t(14,At=void 0),t(18,Gt=void 0),t(55,nt=At)),r.$$.dirty[1]&33554688&&tt!=="marker-only"&&de&&!de.address&&de.geometry.type==="Point"&&de.place_type[0]!=="reverse"&&br(de.id,{byId:!0}).catch(re=>t(18,Gt=re)),r.$$.dirty[1]&100663330&&(q&&de&&de.id!==Tr&&O&&(!de.bbox||de.bbox[0]===de.bbox[2]&&de.bbox[1]===de.bbox[3]?q.flyTo(de.center,$n(de)):q.fitBounds(U1(de.bbox),50,$n(de)),t(14,At=void 0),t(55,nt=void 0),t(15,ut=-1)),t(57,Tr=de==null?void 0:de.id)),r.$$.dirty[0]&18432&&Ie&&At!=null&&At.length&&t(15,ut=0),r.$$.dirty[0]&2&&t(15,ut=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&nt!==At&&t(55,nt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":oe&&Fe(re.coordinates);break;case"markerClick":{const Je=At==null?void 0:At.find(Qe=>Qe.id===re.id);Je&&Rt(Je)}break;case"markerMouseEnter":nt&&t(15,ut=Cr?(At==null?void 0:At.findIndex(Je=>Je.id===re.id))??-1:-1);break;case"markerMouseLeave":nt&&t(15,ut=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=At==null?void 0:At[ut]),r.$$.dirty[1]&134218786&&q&&i&&O&&ct&&q.flyTo(i.center,$n(i)),r.$$.dirty[1]&256&&t(59,n=tt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Xe||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Xe&&!nt&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(nt,de,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&nt&&q&&q.setSelectedMarker(ut),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=zr(me);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Un("select",{feature:i}),r.$$.dirty[1]&33554432&&Un("pick",{feature:de}),r.$$.dirty[0]&81920&&Un("optionsvisibilitychange",{optionsVisible:Cr&&!!At}),r.$$.dirty[0]&16384&&Un("featureslisted",{features:At}),r.$$.dirty[1]&16777216&&Un("featuresmarked",{features:nt}),r.$$.dirty[0]&1&&Un("reversetoggle",{reverse:oe}),r.$$.dirty[0]&2&&Un("querychange",{query:me}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(oe)},[oe,me,h,_,C,L,E,fe,Ee,xe,Ue,Ie,jt,Ge,At,ut,Cr,Ke,Gt,Zn,xi,xt,yt,bt,Rt,s,p,g,x,T,z,I,O,B,K,H,q,J,ee,tt,ze,ct,Xe,lt,pt,_t,He,gt,Pt,un,nn,rn,pn,yn,qe,nt,de,Tr,i,n,u,o,Qt,Yt,vr,or,Se,ne,ce,_e,we,Oe,$e,je,De]}class T6 extends Lt{constructor(e){super(),Et(this,e,C6,S6,St,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function ev(r){let e,t,n;return t=new T6({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"class","svelte-ixhnie")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function M6(r){let e,t,n=r[2]&&ev(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=ev(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function E6(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function h(p){return p?F2(p,ni,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=h(o))},[i,u,n,s,o]}class L6 extends Lt{constructor(e){super(),Et(this,e,E6,M6,St,{apiKey:0,map:4,country:1})}}const I6=Symbol.for("svelte-maplibre");function P6(){return Qf(I6)}function z6(r){return"layerType"in r&&r.layerType==="deckgl"}const D6=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),tv=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function nv(r){let e,t,n=(r[4]||r[3]instanceof ni.Marker)&&rv(r);return{c(){e=U("div"),n&&n.c()},m(i,o){W(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof ni.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=rv(i),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(),r[32](null)}}}function rv(r){let e;const t=r[30].default,n=vn(t,r,r[29],tv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,D6):xn(i[29]),tv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function R6(r){let e,t,n=r[9].default&&nv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=nv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function B6(r,e,t){let n,i,o,u,s,h,{$$slots:p={},$$scope:g}=e;const _=Lg(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:z=!1}=e,{openOn:L="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:O=void 0}=e,{offset:B=void 0}=e,{popupClass:K=void 0}=e,{maxWidth:H=void 0}=e,{lngLat:q=void 0}=e,{html:J=void 0}=e,{open:fe=!1}=e;const Ee=js(),{map:ee,popupTarget:oe,layerEvent:xe,layer:me,eventTopMost:tt}=P6();st(r,ee,Ge=>t(2,o=Ge)),st(r,oe,Ge=>t(3,s=Ge)),st(r,xe,Ge=>t(28,u=Ge)),st(r,me,Ge=>t(35,h=Ge));const Ue=["click","dblclick","contextmenu"];let ze,Ie=!1,ct;function Xe(){if(!ze)return;let Ge=ze.getElement();!Ge||Ge===ct||(ct=Ge,L==="hover"&&(ct.style.pointerEvents="none"),ct.addEventListener("mouseenter",()=>{t(24,Ie=!0)},{passive:!0}),ct.addEventListener("mouseleave",()=>{t(24,Ie=!1)},{passive:!0}),ct.addEventListener("click",()=>{T&&t(0,fe=!1)},{passive:!0}))}ks(()=>{if(o)return o.on("click",rn),o.on("contextmenu",rn),typeof s=="string"&&(o.on("click",s,He),o.on("dblclick",s,He),o.on("contextmenu",s,He),o.on("mousemove",s,nn),o.on("mouseleave",s,un),o.on("touchstart",s,Pt),o.on("touchend",s,jt)),()=>{o!=null&&o.loaded()&&(ze==null||ze.remove(),o.off("click",rn),o.off("contextmenu",rn),s instanceof ni.Marker?s.getPopup()===ze&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,He),o.off("dblclick",s,He),o.off("contextmenu",s,He),o.off("mousemove",s,nn),o.off("mouseleave",s,un),o.off("touchstart",s,Pt),o.off("touchend",s,jt)))}});function lt(Ge){return E?!("marker"in Ge)&&!z6(Ge)&&tt(Ge)!==h:!1}let pt=null,_t="normal";function He(Ge){Ge.type===L&&(lt(Ge)||("layerType"in Ge?Ge.layerType==="deckgl"?(t(10,q=Ge.coordinate),t(4,pt=Ge.object?[Ge.object]:null)):(t(10,q=Ge.lngLat),t(4,pt=Ge.features??[])):(t(10,q=Ge.lngLat),t(4,pt=Ge.features??[])),setTimeout(()=>t(0,fe=!0))))}let gt=null;function Pt(Ge){gt=Ge.point}function jt(Ge){if(!gt||L!=="hover")return;let At=gt.dist(Ge.point);gt=null,At<3&&(t(10,q=Ge.lngLat),t(4,pt=Ge.features??[]),ze.isOpen()?t(25,_t="justOpened"):(t(25,_t="opening"),t(0,fe=!0)))}function un(Ge){L!=="hover"||gt||_t!=="normal"||(t(0,fe=!1),t(4,pt=null))}function nn(Ge){if(!(L!=="hover"||gt||_t!=="normal")){if(lt(Ge)){t(0,fe=!1),t(4,pt=null);return}t(0,fe=!0),t(4,pt=Ge.features??[]),t(10,q=Ge.lngLat)}}function rn(Ge){if(_t==="justOpened"){t(25,_t="normal");return}if(!C)return;let At=[ct,s instanceof ni.Marker?s==null?void 0:s.getElement():null];fe&&ze.isOpen()&&!At.some(nt=>nt==null?void 0:nt.contains(Ge.originalEvent.target))&&(Ge.type==="contextmenu"&&L==="contextmenu"||Ge.type!=="contextmenu")&&t(0,fe=!1)}ri(()=>{o&&(ze!=null&&ze.isOpen())&&ze.remove()});let pn;const yn=()=>t(0,fe=!1);function qe(Ge){dn[Ge?"unshift":"push"](()=>{pn=Ge,t(1,pn)})}return r.$$set=Ge=>{"closeButton"in Ge&&t(11,x=Ge.closeButton),"closeOnClickOutside"in Ge&&t(12,C=Ge.closeOnClickOutside),"closeOnClickInside"in Ge&&t(13,T=Ge.closeOnClickInside),"closeOnMove"in Ge&&t(14,z=Ge.closeOnMove),"openOn"in Ge&&t(15,L=Ge.openOn),"openIfTopMost"in Ge&&t(16,E=Ge.openIfTopMost),"focusAfterOpen"in Ge&&t(17,I=Ge.focusAfterOpen),"anchor"in Ge&&t(18,O=Ge.anchor),"offset"in Ge&&t(19,B=Ge.offset),"popupClass"in Ge&&t(20,K=Ge.popupClass),"maxWidth"in Ge&&t(21,H=Ge.maxWidth),"lngLat"in Ge&&t(10,q=Ge.lngLat),"html"in Ge&&t(22,J=Ge.html),"open"in Ge&&t(0,fe=Ge.open),"$$scope"in Ge&&t(29,g=Ge.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(ze||(t(23,ze=new ni.Popup({closeButton:n,closeOnClick:!1,closeOnMove:z,focusAfterOpen:I,maxWidth:H,className:K,anchor:O,offset:B})),ct=ze.getElement(),ze.on("open",()=>{t(0,fe=!0),Xe(),Ee("open",ze)}),ze.on("close",()=>{t(0,fe=!1),Ee("close",ze)}),ze.on("hover",()=>{Ee("hover",ze)}))),r.$$.dirty[0]&8421384&&ze&&s instanceof ni.Marker&&(L==="click"?s.setPopup(ze):s.getPopup()===ze&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ue.includes(L)&&(u==null?void 0:u.type)===L&&(He(u),ln(xe,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=L==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&L==="hover"&&xe&&(i&&u&&(u.layerType==="deckgl"?(t(10,q=u.coordinate),t(4,pt=u.object?[u.object]:null)):(t(10,q=u.lngLat),t(4,pt=u.features??[]))),t(0,fe=(i||Ie)??!1)),r.$$.dirty[0]&12582914&&(pn?ze.setDOMContent(pn):J&&ze.setHTML(J)),r.$$.dirty[0]&8389632&&q&&ze.setLngLat(q),r.$$.dirty[0]&41943045&&o){let Ge=ze.isOpen();fe&&!Ge?(ze.addTo(o),_t==="opening"&&t(25,_t="justOpened")):!fe&&Ge&&ze.remove()}},[fe,pn,o,s,pt,ee,oe,xe,me,_,q,x,C,T,z,L,E,I,O,B,K,H,J,ze,Ie,_t,i,n,u,g,p,yn,qe]}class F6 extends Lt{constructor(e){super(),Et(this,e,B6,R6,St,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const O6=r=>({props:r&8}),iv=r=>({props:j6(r[3])});function $6(r){let e;const t=r[1].default,n=vn(t,r,r[2],iv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&wn(n,t,i,i[2],e?bn(t,i[2],o,O6):xn(i[2]),iv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function N6(r){let e,t;return e=new F6({props:{openOn:r[0],$$slots:{default:[$6,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function j6(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function U6(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class mi extends Lt{constructor(e){super(),Et(this,e,U6,N6,St,{openOn:0})}}function jo(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function Bi(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function eo(){return{type:"FeatureCollection",features:[]}}function ov(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function sv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function av(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function lv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function uv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function cv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function V6(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function fv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&G(e)}}}function hv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&G(e)}}}function dv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&G(e)}}}function pv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&G(e)}}}function q6(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O=On(r[7]),B=[];for(let ee=0;ee<O.length;ee+=1)B[ee]=fv(cv(r,O,ee));let K=On(r[8]),H=[];for(let ee=0;ee<K.length;ee+=1)H[ee]=hv(uv(r,K,ee));let q=On(r[9]),J=[];for(let ee=0;ee<q.length;ee+=1)J[ee]=dv(lv(r,q,ee));let fe=On(r[10]),Ee=[];for(let ee=0;ee<fe.length;ee+=1)Ee[ee]=pv(av(r,fe,ee));return{c(){e=U("div"),t=U("label"),n=Me(`Trip purpose:
      `),i=U("select");for(let ee=0;ee<B.length;ee+=1)B[ee].c();o=ie(),u=U("label"),s=Me(`Scenario:
      `),h=U("select");for(let ee=0;ee<H.length;ee+=1)H[ee].c();p=ie(),g=U("label"),_=Me(`Network type:
      `),x=U("select");for(let ee=0;ee<J.length;ee+=1)J[ee].c();C=ie(),T=U("label"),z=Me(`Color by:
      `),L=U("select");for(let ee=0;ee<Ee.length;ee+=1)Ee[ee].c();r[0]===void 0&&ys(()=>r[11].call(i)),r[1]===void 0&&ys(()=>r[12].call(h)),r[2]===void 0&&ys(()=>r[13].call(x)),r[3]===void 0&&ys(()=>r[14].call(L)),he(e,"slot","legend")},m(ee,oe){W(ee,e,oe),F(e,t),F(t,n),F(t,i);for(let xe=0;xe<B.length;xe+=1)B[xe]&&B[xe].m(i,null);Ki(i,r[0],!0),F(e,o),F(e,u),F(u,s),F(u,h);for(let xe=0;xe<H.length;xe+=1)H[xe]&&H[xe].m(h,null);Ki(h,r[1],!0),F(e,p),F(e,g),F(g,_),F(g,x);for(let xe=0;xe<J.length;xe+=1)J[xe]&&J[xe].m(x,null);Ki(x,r[2],!0),F(e,C),F(e,T),F(T,z),F(T,L);for(let xe=0;xe<Ee.length;xe+=1)Ee[xe]&&Ee[xe].m(L,null);Ki(L,r[3],!0),E||(I=[Mt(i,"change",r[11]),Mt(h,"change",r[12]),Mt(x,"change",r[13]),Mt(L,"change",r[14])],E=!0)},p(ee,oe){if(oe[0]&128){O=On(ee[7]);let xe;for(xe=0;xe<O.length;xe+=1){const me=cv(ee,O,xe);B[xe]?B[xe].p(me,oe):(B[xe]=fv(me),B[xe].c(),B[xe].m(i,null))}for(;xe<B.length;xe+=1)B[xe].d(1);B.length=O.length}if(oe[0]&129&&Ki(i,ee[0]),oe[0]&256){K=On(ee[8]);let xe;for(xe=0;xe<K.length;xe+=1){const me=uv(ee,K,xe);H[xe]?H[xe].p(me,oe):(H[xe]=hv(me),H[xe].c(),H[xe].m(h,null))}for(;xe<H.length;xe+=1)H[xe].d(1);H.length=K.length}if(oe[0]&258&&Ki(h,ee[1]),oe[0]&512){q=On(ee[9]);let xe;for(xe=0;xe<q.length;xe+=1){const me=lv(ee,q,xe);J[xe]?J[xe].p(me,oe):(J[xe]=dv(me),J[xe].c(),J[xe].m(x,null))}for(;xe<J.length;xe+=1)J[xe].d(1);J.length=q.length}if(oe[0]&516&&Ki(x,ee[2]),oe[0]&1024){fe=On(ee[10]);let xe;for(xe=0;xe<fe.length;xe+=1){const me=av(ee,fe,xe);Ee[xe]?Ee[xe].p(me,oe):(Ee[xe]=pv(me),Ee[xe].c(),Ee[xe].m(L,null))}for(;xe<Ee.length;xe+=1)Ee[xe].d(1);Ee.length=fe.length}oe[0]&1032&&Ki(L,ee[3])},d(ee){ee&&G(e),_i(B,ee),_i(H,ee),_i(J,ee),_i(Ee,ee),E=!1,cr(I)}}}function mv(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,s,h,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",T,z;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=ie(),i=U("td"),u=Me(o),s=ie(),h=U("td"),g=Me(p),_=ie(),x=U("td"),T=Me(C),z=ie()},m(L,E){W(L,e,E),F(e,t),F(e,n),F(e,i),F(i,u),F(e,s),F(e,h),F(h,g),F(e,_),F(e,x),F(x,T),F(e,z)},p(L,E){E[0]&131072&&o!==(o=L[17][`${L[18]}_fastest_bicycle`].toLocaleString()+"")&&kt(u,o),E[0]&131072&&p!==(p=L[17][`${L[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&kt(g,p),E[0]&131072&&C!==(C=L[17][`${L[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&kt(T,C)},d(L){L&&G(e)}}}function gv(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,s,h,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",T,z;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=ie(),i=U("td"),u=Me(o),s=ie(),h=U("td"),g=Me(p),_=ie(),x=U("td"),T=Me(C),z=ie()},m(L,E){W(L,e,E),F(e,t),F(e,n),F(e,i),F(i,u),F(e,s),F(e,h),F(h,g),F(e,_),F(e,x),F(x,T),F(e,z)},p(L,E){E[0]&131072&&o!==(o=L[17][`${L[18]}_quietest_bicycle`].toLocaleString()+"")&&kt(u,o),E[0]&131072&&p!==(p=L[17][`${L[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&kt(g,p),E[0]&131072&&C!==(C=L[17][`${L[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&kt(T,C)},d(L){L&&G(e)}}}function H6(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,s,h,p=r[17].gradient+"",g,_,x,C,T,z=r[17].quietness+"",L,E,I,O,B,K,H,q,J,fe,Ee,ee,oe,xe,me,tt,Ue,ze=On(r[7]),Ie=[];for(let lt=0;lt<ze.length;lt+=1)Ie[lt]=mv(sv(r,ze,lt));let ct=On(r[7]),Xe=[];for(let lt=0;lt<ct.length;lt+=1)Xe[lt]=gv(ov(r,ct,lt));return{c(){e=U("div"),t=U("p"),n=Me("Cyclists: "),o=Me(i),u=ie(),s=U("p"),h=Me("Gradient: "),g=Me(p),_=Me("%"),x=ie(),C=U("p"),T=Me("Cycle-friendliness: "),L=Me(z),E=Me("%"),I=ie(),O=U("details"),B=U("summary"),B.textContent="All network details",K=ie(),H=U("p"),H.textContent="Fast/Direct network",q=ie(),J=U("table"),fe=U("tr"),fe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ee=ie();for(let lt=0;lt<Ie.length;lt+=1)Ie[lt].c();ee=ie(),oe=U("p"),oe.textContent="Quiet/Indirect network",xe=ie(),me=U("table"),tt=U("tr"),tt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ue=ie();for(let lt=0;lt<Xe.length;lt+=1)Xe[lt].c();Ye(e,"max-width","30vw"),Ye(e,"max-height","60vh"),Ye(e,"overflow","auto")},m(lt,pt){W(lt,e,pt),F(e,t),F(t,n),F(t,o),F(e,u),F(e,s),F(s,h),F(s,g),F(s,_),F(e,x),F(e,C),F(C,T),F(C,L),F(C,E),F(e,I),F(e,O),F(O,B),F(O,K),F(O,H),F(O,q),F(O,J),F(J,fe),F(J,Ee);for(let _t=0;_t<Ie.length;_t+=1)Ie[_t]&&Ie[_t].m(J,null);F(O,ee),F(O,oe),F(O,xe),F(O,me),F(me,tt),F(me,Ue);for(let _t=0;_t<Xe.length;_t+=1)Xe[_t]&&Xe[_t].m(me,null)},p(lt,pt){if(pt[0]&131088&&i!==(i=lt[17][lt[4]].toLocaleString()+"")&&kt(o,i),pt[0]&131072&&p!==(p=lt[17].gradient+"")&&kt(g,p),pt[0]&131072&&z!==(z=lt[17].quietness+"")&&kt(L,z),pt[0]&131200){ze=On(lt[7]);let _t;for(_t=0;_t<ze.length;_t+=1){const He=sv(lt,ze,_t);Ie[_t]?Ie[_t].p(He,pt):(Ie[_t]=mv(He),Ie[_t].c(),Ie[_t].m(J,null))}for(;_t<Ie.length;_t+=1)Ie[_t].d(1);Ie.length=ze.length}if(pt[0]&131200){ct=On(lt[7]);let _t;for(_t=0;_t<ct.length;_t+=1){const He=ov(lt,ct,_t);Xe[_t]?Xe[_t].p(He,pt):(Xe[_t]=gv(He),Xe[_t].c(),Xe[_t].m(me,null))}for(;_t<Xe.length;_t+=1)Xe[_t].d(1);Xe.length=ct.length}},d(lt){lt&&G(e),_i(Ie,lt),_i(Xe,lt)}}}function G6(r){let e,t;return e=new mi({props:{openOn:"click",$$slots:{default:[H6,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function W6(r){let e,t;const n=[_n("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":_v(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[G6]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u[0]&112?In(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":_v(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Z6(r){let e,t,n,i,o;function u(h){r[15](h)}let s={label:"Estimated cycling demand",$$slots:{legend:[q6],help:[V6]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new ih({props:{url:`pmtiles://${No("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[W6]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(h,p){ae(e,h,p),W(h,n,p),ae(i,h,p),o=!0},p(h,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:h}),!t&&p[0]&32&&(t=!0,g.show=h[5],zn(()=>t=!1)),e.$set(g);const _={};p[0]&112|p[1]&2&&(_.$$scope={dirty:p,ctx:h}),i.$set(_)},i(h){o||(N(e.$$.fragment,h),N(i.$$.fragment,h),o=!0)},o(h){V(e.$$.fragment,h),V(i.$$.fragment,h),o=!1},d(h){h&&G(n),le(e,h),le(i,h)}}}function _v(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function X6(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function K6(r,e,t){let n,i,o=!1,u="all",s="bicycle_go_dutch",h="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],_=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],x=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],C=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],T={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function z(){u=Fa(this),t(0,u),t(7,g)}function L(){s=Fa(this),t(1,s),t(8,_)}function E(){h=Fa(this),t(2,h),t(9,x)}function I(){p=Fa(this),t(3,p),t(10,C)}function O(B){o=B,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${h}_${s}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:X6(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Bi(["abs",["get","gradient"]],T.limits,T.colorScale)}[p])},[u,s,h,p,n,o,i,g,_,x,C,z,L,E,I,O]}class J6 extends Lt{constructor(e){super(),Et(this,e,K6,Z6,St,{},null,[-1,-1])}}function Y6(r){let e,t,n;return t=new o_({props:{labelColors:r[5]}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Q6(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function eL(r){let e,t,n;return t=new ko({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function tL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function nL(r){let e,t,n;return t=new ko({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function rL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function iL(r){let e,t,n,i,o,u;const s=[_n("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":jo(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":ia(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let h={};for(let C=0;C<s.length;C+=1)h=zt(h,s[C]);e=new ur({props:h});const p=[_n("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":jo(["get","Level of Service"],r[4],"cyan"),"line-width":ia(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let C=0;C<p.length;C+=1)g=zt(g,p[C]);n=new ur({props:g});const _=[_n("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":jo(["get","Infrastructure type"],r[5],"cyan"),"line-width":ia(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={};for(let C=0;C<_.length;C+=1)x=zt(x,_[C]);return o=new ur({props:x}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment)},m(C,T){ae(e,C,T),W(C,t,T),ae(n,C,T),W(C,i,T),ae(o,C,T),u=!0},p(C,T){const z=T&9?In(s,[s[0],s[1],s[2],T&8&&{paint:{"line-color":jo(["get","Traffic volume category"],{"0 to 1999":C[3].colorScale[0],"2000 to 3999":C[3].colorScale[1],"4000+":C[3].colorScale[2]},"cyan"),"line-width":ia(0)}},T&1&&{layout:{visibility:C[0]?"visible":"none"}}]):{};e.$set(z);const L=T&18?In(p,[p[0],p[1],T&16&&{paint:{"line-color":jo(["get","Level of Service"],C[4],"cyan"),"line-width":ia(1)}},T&2&&{layout:{visibility:C[1]?"visible":"none"}}]):{};n.$set(L);const E=T&36?In(_,[_[0],_[1],_[2],T&32&&{paint:{"line-color":jo(["get","Infrastructure type"],C[5],"cyan"),"line-width":ia(1)}},T&4&&{layout:{visibility:C[2]?"visible":"none"}}]):{};o.$set(E)},i(C){u||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),u=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),u=!1},d(C){C&&(G(t),G(i)),le(e,C),le(n,C),le(o,C)}}}function oL(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z;function L(H){r[6](H)}let E={label:"Existing cycling infrastructure",$$slots:{help:[Q6],legend:[Y6]},$$scope:{ctx:r}};r[2]!==void 0&&(E.show=r[2]),e=new os({props:E}),dn.push(()=>Dn(e,"show",L));function I(H){r[7](H)}let O={label:"Cycling safety Level of Service",$$slots:{help:[tL],legend:[eL]},$$scope:{ctx:r}};r[1]!==void 0&&(O.show=r[1]),i=new os({props:O}),dn.push(()=>Dn(i,"show",I)),s=new J6({});function B(H){r[8](H)}let K={label:"Estimated traffic",$$slots:{help:[rL],legend:[nL]},$$scope:{ctx:r}};return r[0]!==void 0&&(K.show=r[0]),_=new os({props:K}),dn.push(()=>Dn(_,"show",B)),T=new ih({props:{url:`pmtiles://${No("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[iL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment),u=ie(),ue(s.$$.fragment),h=ie(),p=U("div"),p.textContent="Other",g=ie(),ue(_.$$.fragment),C=ie(),ue(T.$$.fragment),he(p,"class","layer-group")},m(H,q){ae(e,H,q),W(H,n,q),ae(i,H,q),W(H,u,q),ae(s,H,q),W(H,h,q),W(H,p,q),W(H,g,q),ae(_,H,q),W(H,C,q),ae(T,H,q),z=!0},p(H,[q]){const J={};q&512&&(J.$$scope={dirty:q,ctx:H}),!t&&q&4&&(t=!0,J.show=H[2],zn(()=>t=!1)),e.$set(J);const fe={};q&512&&(fe.$$scope={dirty:q,ctx:H}),!o&&q&2&&(o=!0,fe.show=H[1],zn(()=>o=!1)),i.$set(fe);const Ee={};q&512&&(Ee.$$scope={dirty:q,ctx:H}),!x&&q&1&&(x=!0,Ee.show=H[0],zn(()=>x=!1)),_.$set(Ee);const ee={};q&519&&(ee.$$scope={dirty:q,ctx:H}),T.$set(ee)},i(H){z||(N(e.$$.fragment,H),N(i.$$.fragment,H),N(s.$$.fragment,H),N(_.$$.fragment,H),N(T.$$.fragment,H),z=!0)},o(H){V(e.$$.fragment,H),V(i.$$.fragment,H),V(s.$$.fragment,H),V(_.$$.fragment,H),V(T.$$.fragment,H),z=!1},d(H){H&&(G(n),G(u),G(h),G(p),G(g),G(C)),le(e,H),le(i,H),le(s,H),le(_,H),le(T,H)}}}function sL(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},h={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(x){o=x,t(2,o)}function g(x){i=x,t(1,i)}function _(x){n=x,t(0,n)}return[n,i,o,u,s,h,p,g,_]}class aL extends Lt{constructor(e){super(),Et(this,e,sL,oL,St,{})}}function lL(r){let e,t,n;return t=new o_({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function uL(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function yv(r){let e,t;return e=new _r({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[hL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cL(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Me(e)},m(n,i){W(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&kt(t,e)},d(n){n&&G(t)}}}function fL(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[cL,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hL(r){let e,t;const n=[_n("context-pois"),{paint:{"circle-color":jo(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[fL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&5?In(n,[n[0],u&4&&{paint:{"circle-color":jo(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function dL(r){let e,t,n,i,o;function u(p){r[3](p)}let s={label:"POIs",$$slots:{help:[uL],legend:[lL]},$$scope:{ctx:r}};r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u));let h=r[1]&&yv(r);return{c(){ue(e.$$.fragment),n=ie(),h&&h.c(),i=nr()},m(p,g){ae(e,p,g),W(p,n,g),h&&h.m(p,g),W(p,i,g),o=!0},p(p,[g]){const _={};g&32&&(_.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,_.show=p[0],zn(()=>t=!1)),e.$set(_),p[1]?h?(h.p(p,g),g&2&&N(h,1)):(h=yv(p),h.c(),N(h,1),h.m(i.parentNode,i)):h&&(Kt(),V(h,1,1,()=>{h=null}),Jt())},i(p){o||(N(e.$$.fragment,p),N(h),o=!0)},o(p){V(e.$$.fragment,p),V(h),o=!1},d(p){p&&(G(n),G(i)),le(e,p),h&&h.d(p)}}}function pL(r,e,t){let n;st(r,kr,s=>t(1,n=s));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99",Recreation:"#f0027f"};function u(s){i=s,t(0,i)}return[i,n,o,u]}class mL extends Lt{constructor(e){super(),Et(this,e,pL,dL,St,{})}}function gL(r){let e,t,n,i,o;return t=new ko({props:{colorScale:hp,labels:{buckets:b2(dp)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),he(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),F(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),le(t)}}}function _L(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function yL(r){let e,t,n,i,o;return t=new ko({props:{colorScale:Wf,labels:{limits:r[3].population_density}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / km²</span> <span>More dense</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),he(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),F(e,i),o=!0},p(u,s){const h={};s&8&&(h.labels={limits:u[3].population_density}),t.$set(h)},i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),le(t)}}}function vL(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function bL(r){let e,t,n,i,o;return t=new ko({props:{colorScale:mp,labels:{limits:pp.map(LL)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),he(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),F(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),le(t)}}}function wL(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function xL(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",s,h,p=r[10].imd_rank+"",g,_,x=r[10].imd_percentile+"",C,T;return{c(){e=U("p"),t=Me("Data zone "),i=Me(n),o=Me(`
        has `),s=Me(u),h=Me(`
        people, and a SIMD rank of `),g=Me(p),_=Me(`, making it less deprived
        than `),C=Me(x),T=Me("% of data zones.")},m(z,L){W(z,e,L),F(e,t),F(e,i),F(e,o),F(e,s),F(e,h),F(e,g),F(e,_),F(e,C),F(e,T)},p(z,L){L&1024&&n!==(n=z[10].id+"")&&kt(i,n),L&1024&&u!==(u=z[10].population.toLocaleString()+"")&&kt(s,u),L&1024&&p!==(p=z[10].imd_rank+"")&&kt(g,p),L&1024&&x!==(x=z[10].imd_percentile+"")&&kt(C,x)},d(z){z&&G(e)}}}function AL(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[xL,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kL(r){let e,t,n=r[10].id+"",i,o,u=ac(r[10].households_with_cars_or_vans,r[10].total_households)+"",s,h,p=r[10].total_households.toLocaleString()+"",g,_;return{c(){e=U("p"),t=Me("In data zone "),i=Me(n),o=ie(),s=Me(u),h=Me(" of approximately "),g=Me(p),_=Me(`
        households have at least one car or van.`)},m(x,C){W(x,e,C),F(e,t),F(e,i),F(e,o),F(e,s),F(e,h),F(e,g),F(e,_)},p(x,C){C&1024&&n!==(n=x[10].id+"")&&kt(i,n),C&1024&&u!==(u=ac(x[10].households_with_cars_or_vans,x[10].total_households)+"")&&kt(s,u),C&1024&&p!==(p=x[10].total_households.toLocaleString()+"")&&kt(g,p)},d(x){x&&G(e)}}}function SL(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[kL,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function CL(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",s,h,p=Math.round(r[10].population/(r[10].area/1e6)).toLocaleString()+"",g,_;return{c(){e=U("p"),t=Me("Data zone "),i=Me(n),o=Me(`
        has `),s=Me(u),h=Me(`
        people, with a density of `),g=Me(p),_=Me(" people per square kilometer")},m(x,C){W(x,e,C),F(e,t),F(e,i),F(e,o),F(e,s),F(e,h),F(e,g),F(e,_)},p(x,C){C&1024&&n!==(n=x[10].id+"")&&kt(i,n),C&1024&&u!==(u=x[10].population.toLocaleString()+"")&&kt(s,u),C&1024&&p!==(p=Math.round(x[10].population/(x[10].area/1e6)).toLocaleString()+"")&&kt(g,p)},d(x){x&&G(e)}}}function TL(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[CL,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ML(r){let e,t,n,i,o,u,s,h;const p=[_n("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["get","imd_percentile"],dp,hp),"fill-opacity":Gn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[AL]},$$scope:{ctx:r}};for(let E=0;E<p.length;E+=1)g=zt(g,p[E]);e=new Yi({props:g});const _=[_n("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],pp,mp),"fill-opacity":Gn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={$$slots:{default:[SL]},$$scope:{ctx:r}};for(let E=0;E<_.length;E+=1)x=zt(x,_[E]);n=new Yi({props:x});const C=[_n("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["/",["get","population"],["/",["get","area"],1e6]],r[3].population_density,Wf),"fill-opacity":Gn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let T={$$slots:{default:[TL]},$$scope:{ctx:r}};for(let E=0;E<C.length;E+=1)T=zt(T,C[E]);o=new Yi({props:T});const z=[_n("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let L={};for(let E=0;E<z.length;E+=1)L=zt(L,z[E]);return s=new ur({props:L}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(E,I){ae(e,E,I),W(E,t,I),ae(n,E,I),W(E,i,I),ae(o,E,I),W(E,u,I),ae(s,E,I),h=!0},p(E,I){const O=I&1?In(p,[p[0],p[1],p[2],p[3],{layout:{visibility:E[0]?"visible":"none"}}]):{};I&2048&&(O.$$scope={dirty:I,ctx:E}),e.$set(O);const B=I&4?In(_,[_[0],_[1],_[2],_[3],{layout:{visibility:E[2]?"visible":"none"}}]):{};I&2048&&(B.$$scope={dirty:I,ctx:E}),n.$set(B);const K=I&10?In(C,[C[0],C[1],C[2],I&8&&{paint:{"fill-color":Bi(["/",["get","population"],["/",["get","area"],1e6]],E[3].population_density,Wf),"fill-opacity":Gn(.7,.9)}},I&2&&{layout:{visibility:E[1]?"visible":"none"}}]):{};I&2048&&(K.$$scope={dirty:I,ctx:E}),o.$set(K);const H=I&7?In(z,[z[0],z[1],z[2],{layout:{visibility:E[0]||E[1]||E[2]?"visible":"none"}}]):{};s.$set(H)},i(E){h||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),h=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),h=!1},d(E){E&&(G(t),G(i),G(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function EL(r){let e,t,n,i,o,u,s,h,p,g,_;function x(I){r[5](I)}let C={label:"SIMD",onChange:r[4],$$slots:{help:[_L],legend:[gL]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new os({props:C}),dn.push(()=>Dn(e,"show",x));function T(I){r[7](I)}let z={label:"Population density",onChange:r[6],$$slots:{help:[vL],legend:[yL]},$$scope:{ctx:r}};r[1]!==void 0&&(z.show=r[1]),i=new os({props:z}),dn.push(()=>Dn(i,"show",T));function L(I){r[9](I)}let E={label:"Car ownership",onChange:r[8],$$slots:{help:[wL],legend:[bL]},$$scope:{ctx:r}};return r[2]!==void 0&&(E.show=r[2]),s=new os({props:E}),dn.push(()=>Dn(s,"show",L)),g=new ih({props:{url:`pmtiles://${No("cnt_layers/population.pmtiles")}`,$$slots:{default:[ML]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment),u=ie(),ue(s.$$.fragment),p=ie(),ue(g.$$.fragment)},m(I,O){ae(e,I,O),W(I,n,O),ae(i,I,O),W(I,u,O),ae(s,I,O),W(I,p,O),ae(g,I,O),_=!0},p(I,[O]){const B={};O&7&&(B.onChange=I[4]),O&2048&&(B.$$scope={dirty:O,ctx:I}),!t&&O&1&&(t=!0,B.show=I[0],zn(()=>t=!1)),e.$set(B);const K={};O&7&&(K.onChange=I[6]),O&2056&&(K.$$scope={dirty:O,ctx:I}),!o&&O&2&&(o=!0,K.show=I[1],zn(()=>o=!1)),i.$set(K);const H={};O&7&&(H.onChange=I[8]),O&2048&&(H.$$scope={dirty:O,ctx:I}),!h&&O&4&&(h=!0,H.show=I[2],zn(()=>h=!1)),s.$set(H);const q={};O&2063&&(q.$$scope={dirty:O,ctx:I}),g.$set(q)},i(I){_||(N(e.$$.fragment,I),N(i.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(e.$$.fragment,I),V(i.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&(G(n),G(u),G(p)),le(e,I),le(i,I),le(s,I),le(g,I)}}}const LL=r=>`${r}%`;function IL(r,e,t){let n;st(r,nh,C=>t(3,n=C));let i=!1,o=!1,u=!1;const s=()=>{i&&(t(1,o=!1),t(2,u=!1))};function h(C){i=C,t(0,i)}const p=()=>{o&&(t(0,i=!1),t(2,u=!1))};function g(C){o=C,t(1,o)}const _=()=>{u&&(t(0,i=!1),t(1,o=!1))};function x(C){u=C,t(2,u)}return[i,o,u,n,s,h,p,g,_,x]}class PL extends Lt{constructor(e){super(),Et(this,e,IL,EL,St,{})}}function zL(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${rw}" alt="National Rail logo"/>
    Station`,he(e,"slot","legend"),Ye(e,"display","flex"),Ye(e,"gap","8px"),Ye(e,"align-items","center")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function DL(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function RL(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=Me(t)},m(i,o){W(i,e,o),F(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&kt(n,t)},d(i){i&&G(e)}}}function BL(r){let e,t;return e=new mi({props:{$$slots:{default:[RL,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function FL(r){let e,t;const n=[_n("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[BL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new nc({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?In(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function OL(r){let e,t,n,i,o;function u(h){r[1](h)}let s={label:"Railway stations",$$slots:{help:[DL],legend:[zL]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new _r({props:{data:No("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[FL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(h,p){ae(e,h,p),W(h,n,p),ae(i,h,p),o=!0},p(h,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:h}),!t&&p&1&&(t=!0,g.show=h[0],zn(()=>t=!1)),e.$set(g);const _={};p&9&&(_.$$scope={dirty:p,ctx:h}),i.$set(_)},i(h){o||(N(e.$$.fragment,h),N(i.$$.fragment,h),o=!0)},o(h){V(e.$$.fragment,h),V(i.$$.fragment,h),o=!1},d(h){h&&G(n),le(e,h),le(i,h)}}}function $L(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class NL extends Lt{constructor(e){super(),Et(this,e,$L,OL,St,{})}}function jL(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.</p>`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function UL(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q;return B=new o_({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=Me(`
        Pedestrians`),u=ie(),s=U("label"),h=U("input"),p=Me(`
        Cyclists`),g=ie(),_=U("fieldset"),x=U("label"),C=Me(`From
        `),T=U("input"),z=ie(),L=U("label"),E=Me(`To
        `),I=U("input"),O=ie(),ue(B.$$.fragment),he(i,"type","checkbox"),he(i,"class","svelte-rvrx5w"),he(h,"type","checkbox"),he(h,"class","svelte-rvrx5w"),Ye(t,"display","flex"),Ye(t,"gap","3em"),he(t,"class","svelte-rvrx5w"),he(T,"type","number"),he(T,"min",2017),he(T,"max",2023),he(T,"class","svelte-rvrx5w"),he(I,"type","number"),he(I,"min",2017),he(I,"max",2023),he(I,"class","svelte-rvrx5w"),he(_,"class","year-filter svelte-rvrx5w"),he(e,"slot","legend")},m(J,fe){W(J,e,fe),F(e,t),F(t,n),F(n,i),i.checked=r[1].pedestrians,F(n,o),F(t,u),F(t,s),F(s,h),h.checked=r[1].cyclists,F(s,p),F(e,g),F(e,_),F(_,x),F(x,C),F(x,T),Wn(T,r[1].minYear),F(_,z),F(_,L),F(L,E),F(L,I),Wn(I,r[1].maxYear),F(e,O),ae(B,e,null),K=!0,H||(q=[Mt(i,"change",r[7]),Mt(h,"change",r[8]),Mt(T,"input",r[9]),Mt(I,"input",r[10])],H=!0)},p(J,fe){fe&2&&(i.checked=J[1].pedestrians),fe&2&&(h.checked=J[1].cyclists),fe&2&&Dl(T.value)!==J[1].minYear&&Wn(T,J[1].minYear),fe&2&&Dl(I.value)!==J[1].maxYear&&Wn(I,J[1].maxYear)},i(J){K||(N(B.$$.fragment,J),K=!0)},o(J){V(B.$$.fragment,J),K=!1},d(J){J&&G(e),le(B),H=!1,cr(q)}}}function vv(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=Me("Pedestrian location: "),n=U("b"),o=Me(i)},m(u,s){W(u,e,s),F(e,t),F(e,n),F(n,o)},p(u,s){s&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&kt(o,i)},d(u){u&&G(e)}}}function bv(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=Me("Pedestrian movement: "),n=U("b"),o=Me(i)},m(u,s){W(u,e,s),F(e,t),F(e,n),F(n,o)},p(u,s){s&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&kt(o,i)},d(u){u&&G(e)}}}function VL(r){let e,t,n,i=r[12].year+"",o,u,s,h,p,g=r[5][r[12].severity]+"",_,x,C,T,z,L=wv(r[12])+"",E,I,O,B,K,H=r[12].pedestrian_location&&vv(r),q=r[12].pedestrian_movement&&bv(r);return{c(){e=U("p"),t=Me("Year: "),n=U("b"),o=Me(i),u=ie(),s=U("p"),h=Me("Severity: "),p=U("b"),_=Me(g),x=ie(),C=U("p"),T=Me("Casualties: "),z=U("b"),E=Me(L),I=ie(),H&&H.c(),O=ie(),q&&q.c(),B=ie(),K=U("p"),K.textContent="Click to open full report in CycleStreets"},m(J,fe){W(J,e,fe),F(e,t),F(e,n),F(n,o),W(J,u,fe),W(J,s,fe),F(s,h),F(s,p),F(p,_),W(J,x,fe),W(J,C,fe),F(C,T),F(C,z),F(z,E),W(J,I,fe),H&&H.m(J,fe),W(J,O,fe),q&&q.m(J,fe),W(J,B,fe),W(J,K,fe)},p(J,fe){fe&4096&&i!==(i=J[12].year+"")&&kt(o,i),fe&4096&&g!==(g=J[5][J[12].severity]+"")&&kt(_,g),fe&4096&&L!==(L=wv(J[12])+"")&&kt(E,L),J[12].pedestrian_location?H?H.p(J,fe):(H=vv(J),H.c(),H.m(O.parentNode,O)):H&&(H.d(1),H=null),J[12].pedestrian_movement?q?q.p(J,fe):(q=bv(J),q.c(),q.m(B.parentNode,B)):q&&(q.d(1),q=null)},d(J){J&&(G(e),G(u),G(s),G(x),G(C),G(I),G(O),G(B),G(K)),H&&H.d(J),q&&q.d(J)}}}function qL(r){let e,t;return e=new mi({props:{$$slots:{default:[VL,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function HL(r){let e,t;const n=[_n("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":Bi(["get","severity"],[1,2,3],[vg,bg,wg]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[qL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),e.$on("click",WL),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&7?In(n,[n[0],n[1],u&0&&{paint:{"circle-color":Bi(["get","severity"],[1,2,3],[vg,bg,wg]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},u&6&&{filter:o[2](o[1])},u&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};u&8192&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function GL(r){let e,t,n,i,o;function u(h){r[11](h)}let s={label:"Collisions",$$slots:{legend:[UL],help:[jL]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new ih({props:{url:`pmtiles://${No("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[HL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(h,p){ae(e,h,p),W(h,n,p),ae(i,h,p),o=!0},p(h,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:h}),!t&&p&1&&(t=!0,g.show=h[0],zn(()=>t=!1)),e.$set(g);const _={};p&8195&&(_.$$scope={dirty:p,ctx:h}),i.$set(_)},i(h){o||(N(e.$$.fragment,h),N(i.$$.fragment,h),o=!0)},o(h){V(e.$$.fragment,h),V(i.$$.fragment,h),o=!1},d(h){h&&G(n),le(e,h),le(i,h)}}}let vg="#080C54",bg="#1F9EB7",wg="#CDE594";function wv(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function WL(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function ZL(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(z){let L=["any"];return i.pedestrians&&L.push(["get","pedestrian"]),i.cyclists&&L.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],L]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},h={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:wg,Serious:bg,Fatal:vg};function g(){i.pedestrians=this.checked,t(1,i)}function _(){i.cyclists=this.checked,t(1,i)}function x(){i.minYear=Dl(this.value),t(1,i)}function C(){i.maxYear=Dl(this.value),t(1,i)}function T(z){n=z,t(0,n)}return[n,i,o,u,s,h,p,g,_,x,C,T]}class XL extends Lt{constructor(e){super(),Et(this,e,ZL,GL,St,{})}}function xv(r){let e;return{c(){e=Me("Layers")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Av(r){let e,t,n,i,o;function u(p){r[6](p)}let s={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(s.show=r[2]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u));let h=r[3]=="cnt"&&kv();return{c(){ue(e.$$.fragment),n=ie(),h&&h.c(),i=nr()},m(p,g){ae(e,p,g),W(p,n,g),h&&h.m(p,g),W(p,i,g),o=!0},p(p,g){const _={};!t&&g&4&&(t=!0,_.show=p[2],zn(()=>t=!1)),e.$set(_),p[3]=="cnt"?h?g&8&&N(h,1):(h=kv(),h.c(),N(h,1),h.m(i.parentNode,i)):h&&(Kt(),V(h,1,1,()=>{h=null}),Jt())},i(p){o||(N(e.$$.fragment,p),N(h),o=!0)},o(p){V(e.$$.fragment,p),V(h),o=!1},d(p){p&&(G(n),G(i)),le(e,p),h&&h.d(p)}}}function kv(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I;return n=new PL({}),o=new mL({}),s=new XL({}),_=new NL({}),C=new KT({}),E=new aL({}),{c(){e=U("div"),e.textContent="Metrics",t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),h=ie(),p=U("div"),p.textContent="Public transport integration",g=ie(),ue(_.$$.fragment),x=ie(),ue(C.$$.fragment),T=ie(),z=U("div"),z.textContent="Active travel",L=ie(),ue(E.$$.fragment),he(e,"class","layer-group"),he(p,"class","layer-group"),he(z,"class","layer-group")},m(O,B){W(O,e,B),W(O,t,B),ae(n,O,B),W(O,i,B),ae(o,O,B),W(O,u,B),ae(s,O,B),W(O,h,B),W(O,p,B),W(O,g,B),ae(_,O,B),W(O,x,B),ae(C,O,B),W(O,T,B),W(O,z,B),W(O,L,B),ae(E,O,B),I=!0},i(O){I||(N(n.$$.fragment,O),N(o.$$.fragment,O),N(s.$$.fragment,O),N(_.$$.fragment,O),N(C.$$.fragment,O),N(E.$$.fragment,O),I=!0)},o(O){V(n.$$.fragment,O),V(o.$$.fragment,O),V(s.$$.fragment,O),V(_.$$.fragment,O),V(C.$$.fragment,O),V(E.$$.fragment,O),I=!1},d(O){O&&(G(e),G(t),G(i),G(u),G(h),G(p),G(g),G(x),G(T),G(z),G(L)),le(n,O),le(o,O),le(s,O),le(_,O),le(C,O),le(E,O)}}}function KL(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B;i=new c4({props:{color:"#333"}});let K=r[0]&&xv(),H=r[1]&&Av(r);return{c(){e=U("div"),t=U("button"),n=U("div"),ue(i.$$.fragment),o=ie(),K&&K.c(),s=ie(),h=U("div"),H&&H.c(),p=ie(),g=U("div"),_=U("span"),_.textContent="Basemap",x=ie(),C=U("select"),T=U("option"),T.textContent="MapTiler Dataviz",z=U("option"),z.textContent="MapTiler Streets",L=U("option"),L.textContent="MapTiler Satellite",E=U("option"),E.textContent="OS Open Zoomstack",Ye(n,"display","flex"),Ye(n,"gap","12px"),Ye(n,"color","#333"),Ye(n,"align-items","center"),Ye(n,"justify-content","center"),he(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1skef0p"),he(t,"aria-label","Layers"),Ye(_,"font-size","20px"),Ye(_,"margin-left","8px"),Ye(_,"margin-top","4px"),T.__value="dataviz",Wn(T,T.__value),z.__value="streets-v2",Wn(z,z.__value),L.__value="hybrid",Wn(L,L.__value),E.__value="uk-openzoomstack-light",Wn(E,E.__value),Ye(C,"width","auto"),Ye(C,"font-size","20px"),Ye(C,"margin","8px"),Ye(C,"padding","8px"),Ye(C,"text-overflow","ellipsis"),r[4]===void 0&&ys(()=>r[7].call(C)),he(g,"class","context-control"),he(h,"class","contextual-layer-controls svelte-1skef0p"),Ye(h,"flex-direction","column"),Ye(h,"display",r[0]?"flex":"none"),he(e,"class","pico contextual-layers svelte-1skef0p"),Ye(e,"display","flex"),Ye(e,"flex-direction","column"),Ye(e,"border-radius","5px"),Ye(e,"width",r[0]?"300px":"auto")},m(q,J){W(q,e,J),F(e,t),F(t,n),ae(i,n,null),F(n,o),K&&K.m(n,null),F(e,s),F(e,h),H&&H.m(h,null),F(h,p),F(h,g),F(g,_),F(g,x),F(g,C),F(C,T),F(C,z),F(C,L),F(C,E),Ki(C,r[4],!0),I=!0,O||(B=[Mt(t,"click",r[5]),Mt(C,"change",r[7])],O=!0)},p(q,J){q[0]?K||(K=xv(),K.c(),K.m(n,null)):K&&(K.d(1),K=null),(!I||J&1&&u!==(u="show-layers-button icon-btn "+(q[0]?"expanded":"")+" svelte-1skef0p"))&&he(t,"class",u),q[1]?H?(H.p(q,J),J&2&&N(H,1)):(H=Av(q),H.c(),N(H,1),H.m(h,p)):H&&(Kt(),V(H,1,1,()=>{H=null}),Jt()),J&16&&Ki(C,q[4]),J&1&&Ye(h,"display",q[0]?"flex":"none"),J&1&&Ye(e,"width",q[0]?"300px":"auto")},i(q){I||(N(i.$$.fragment,q),N(H),I=!0)},o(q){V(i.$$.fragment,q),V(H),I=!1},d(q){q&&G(e),le(i),K&&K.d(),H&&H.d(),O=!1,cr(B)}}}function JL(r){let e,t;return e=new tg({props:{defaultStyling:!0,$$slots:{default:[KL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function YL(r,e,t){let n,i,o,u;st(r,kr,_=>t(1,n=_)),st(r,Xd,_=>t(2,i=_)),st(r,As,_=>t(3,o=_)),st(r,Zm,_=>t(4,u=_));let s=!1;const h=()=>t(0,s=!s);function p(_){i=_,Xd.set(i)}function g(){u=Fa(this),Zm.set(u)}return[s,n,i,o,u,h,p,g]}class QL extends Lt{constructor(e){super(),Et(this,e,YL,JL,St,{})}}let We;const N2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&N2.decode();let kf=null;function Qu(){return(kf===null||kf.byteLength===0)&&(kf=new Uint8Array(We.memory.buffer)),kf}function Pr(r,e){return r=r>>>0,N2.decode(Qu().subarray(r,r+e))}const sa=new Array(128).fill(void 0);sa.push(void 0,null,!0,!1);let Nf=sa.length;function ir(r){Nf===sa.length&&sa.push(sa.length+1);const e=Nf;return Nf=sa[e],sa[e]=r,e}function Ln(r){return sa[r]}function eI(r){r<132||(sa[r]=Nf,Nf=r)}function Kn(r){const e=Ln(r);return eI(r),e}let wi=0;const Ud=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},tI=typeof Ud.encodeInto=="function"?function(r,e){return Ud.encodeInto(r,e)}:function(r,e){const t=Ud.encode(r);return e.set(t),{read:r.length,written:t.length}};function Fo(r,e,t){if(t===void 0){const s=Ud.encode(r),h=e(s.length,1)>>>0;return Qu().subarray(h,h+s.length).set(s),wi=s.length,h}let n=r.length,i=e(n,1)>>>0;const o=Qu();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Qu().subarray(i+u,i+n),h=tI(r,s);u+=h.written}return wi=u,i}function Zu(r){return r==null}let Sf=null;function mt(){return(Sf===null||Sf.byteLength===0)&&(Sf=new Int32Array(We.memory.buffer)),Sf}let Cf=null;function j2(){return(Cf===null||Cf.byteLength===0)&&(Cf=new Float64Array(We.memory.buffer)),Cf}let Tf=null;function nI(){return(Tf===null||Tf.byteLength===0)&&(Tf=new BigInt64Array(We.memory.buffer)),Tf}function xg(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=xg(r[0]));for(let u=1;u<i;u++)o+=", "+xg(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function jm(r,e){const t=e(r.length*1,1)>>>0;return Qu().set(r,t/1),wi=r.length,t}function rI(r,e){return r=r>>>0,j2().subarray(r/8,r/8+e)}function iI(r,e){return r=r>>>0,Qu().subarray(r/1,r/1+e)}function Ml(r,e){try{return r.apply(this,e)}catch(t){We.__wbindgen_exn_store(ir(t))}}class oI{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();We.__wbg_ltn_free(e)}constructor(e,t,n,i,o,u,s,h){try{const T=We.__wbindgen_add_to_stack_pointer(-16),z=jm(e,We.__wbindgen_malloc),L=wi,E=jm(t,We.__wbindgen_malloc),I=wi,O=jm(n,We.__wbindgen_malloc),B=wi,K=Fo(o,We.__wbindgen_malloc,We.__wbindgen_realloc),H=wi;var p=Zu(u)?0:Fo(u,We.__wbindgen_malloc,We.__wbindgen_realloc),g=wi;const q=Fo(s,We.__wbindgen_malloc,We.__wbindgen_realloc),J=wi;We.ltn_new(T,z,L,E,I,O,B,ir(i),K,H,p,g,q,J,h);var _=mt()[T/4+0],x=mt()[T/4+1],C=mt()[T/4+2];if(C)throw Kn(x);return this.__wbg_ptr=_>>>0,this}finally{We.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getBounds(){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getBounds(i,this.__wbg_ptr);var e=mt()[i/4+0],t=mt()[i/4+1],n=rI(e,t).slice();return We.__wbindgen_free(e,t*8,8),n}finally{We.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=mt()[i/4+0],t=mt()[i/4+1],n=iI(e,t).slice();return We.__wbindgen_free(e,t*1,1),n}finally{We.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderModalFilters(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const g=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_generateMergedBoundary(g,this.__wbg_ptr,ir(e));var i=mt()[g/4+0],o=mt()[g/4+1],u=mt()[g/4+2],s=mt()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Kn(u);return t=h,n=p,Pr(h,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}extractWaypointsFromRing(e){let t,n;try{const g=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_extractWaypointsFromRing(g,this.__wbg_ptr,ir(e));var i=mt()[g/4+0],o=mt()[g/4+1],u=mt()[g/4+2],s=mt()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Kn(u);return t=h,n=p,Pr(h,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}setCurrentNeighbourhoodBoundary(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),u=Fo(e,We.__wbindgen_malloc,We.__wbindgen_realloc),s=wi;We.ltn_setCurrentNeighbourhoodBoundary(o,this.__wbg_ptr,u,s,ir(t));var n=mt()[o/4+0],i=mt()[o/4+1];if(i)throw Kn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Fo(e,We.__wbindgen_malloc,We.__wbindgen_realloc),n=wi;We.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Fo(e,We.__wbindgen_malloc,We.__wbindgen_realloc),i=wi,o=Fo(t,We.__wbindgen_malloc,We.__wbindgen_realloc),u=wi;We.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16),o=Fo(e,We.__wbindgen_malloc,We.__wbindgen_realloc),u=wi;We.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,u);var t=mt()[i/4+0],n=mt()[i/4+1];if(n)throw Kn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),u=Fo(t,We.__wbindgen_malloc,We.__wbindgen_realloc),s=wi;We.ltn_addModalFilter(o,this.__wbg_ptr,ir(e),u,s);var n=mt()[o/4+0],i=mt()[o/4+1];if(i)throw Kn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),u=Fo(t,We.__wbindgen_malloc,We.__wbindgen_realloc),s=wi;We.ltn_addManyModalFilters(o,this.__wbg_ptr,ir(e),u,s);var n=mt()[o/4+0],i=mt()[o/4+1];if(i)throw Kn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){We.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=mt()[i/4+0],n=mt()[i/4+1];if(n)throw Kn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=mt()[i/4+0],n=mt()[i/4+1];if(n)throw Kn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=mt()[i/4+0],n=mt()[i/4+1];if(n)throw Kn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=mt()[o/4+0],i=mt()[o/4+1];if(i)throw Kn(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const u=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_deleteTurnRestriction(u,this.__wbg_ptr,e,t,n);var i=mt()[u/4+0],o=mt()[u/4+1];if(o)throw Kn(i)}finally{We.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const g=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getTurnRestrictionTargets(g,this.__wbg_ptr,e);var i=mt()[g/4+0],o=mt()[g/4+1],u=mt()[g/4+2],s=mt()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Kn(u);return t=h,n=p,Pr(h,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){We.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=mt()[i/4+0],n=mt()[i/4+1];if(n)throw Kn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}reclassifyRoadsAlongLine(e,t,n){try{const u=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_reclassifyRoadsAlongLine(u,this.__wbg_ptr,ir(e),t,n);var i=mt()[u/4+0],o=mt()[u/4+1];if(o)throw Kn(i)}finally{We.__wbindgen_add_to_stack_pointer(16)}}undo(){try{const n=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_undo(n,this.__wbg_ptr);var e=mt()[n/4+0],t=mt()[n/4+1];if(t)throw Kn(e)}finally{We.__wbindgen_add_to_stack_pointer(16)}}redo(){try{const n=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_redo(n,this.__wbg_ptr);var e=mt()[n/4+0],t=mt()[n/4+1];if(t)throw Kn(e)}finally{We.__wbindgen_add_to_stack_pointer(16)}}getShortcutsCrossingRoad(e){let t,n;try{const g=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getShortcutsCrossingRoad(g,this.__wbg_ptr,e);var i=mt()[g/4+0],o=mt()[g/4+1],u=mt()[g/4+2],s=mt()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Kn(u);return t=h,n=p,Pr(h,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toSavefile(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_loadSavefile(i,this.__wbg_ptr,ir(e));var t=mt()[i/4+0],n=mt()[i/4+1];if(n)throw Kn(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let u,s;try{const T=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_compareRoute(T,this.__wbg_ptr,e,t,n,i,o);var h=mt()[T/4+0],p=mt()[T/4+1],g=mt()[T/4+2],_=mt()[T/4+3],x=h,C=p;if(_)throw x=0,C=0,Kn(g);return u=x,s=C,Pr(x,C)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(u,s,1)}}impactToOneDestination(e,t){let n,i;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_impactToOneDestination(_,this.__wbg_ptr,e,t);var o=mt()[_/4+0],u=mt()[_/4+1],s=mt()[_/4+2],h=mt()[_/4+3],p=o,g=u;if(h)throw p=0,g=0,Kn(s);return n=p,i=g,Pr(p,g)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const g=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_predictImpact(g,this.__wbg_ptr,e);var i=mt()[g/4+0],o=mt()[g/4+1],u=mt()[g/4+2],s=mt()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Kn(u);return t=h,n=p,Pr(h,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getImpactsOnRoad(_,this.__wbg_ptr,e,t);var o=mt()[_/4+0],u=mt()[_/4+1],s=mt()[_/4+2],h=mt()[_/4+3],p=o,g=u;if(h)throw p=0,g=0,Kn(s);return n=p,i=g,Pr(p,g)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllIntersections(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const g=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getMovements(g,this.__wbg_ptr,e);var i=mt()[g/4+0],o=mt()[g/4+1],u=mt()[g/4+2],s=mt()[g/4+3],h=i,p=o;if(s)throw h=0,p=0,Kn(u);return t=h,n=p,Pr(h,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getDemandModel(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getPOIs(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getMetricBuckets(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getMetricBuckets(p,this.__wbg_ptr);var n=mt()[p/4+0],i=mt()[p/4+1],o=mt()[p/4+2],u=mt()[p/4+3],s=n,h=i;if(u)throw s=0,h=0,Kn(o);return e=s,t=h,Pr(s,h)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}}async function sI(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function aI(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Pr(e,t));return ir(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Kn(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=Ln(t),i=typeof n=="string"?n:void 0;var o=Zu(i)?0:Fo(i,We.__wbindgen_malloc,We.__wbindgen_realloc),u=wi;mt()[e/4+1]=u,mt()[e/4+0]=o},r.wbg.__wbindgen_boolean_get=function(e){const t=Ln(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Ln(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=Ln(t),i=typeof n=="number"?n:void 0;j2()[e/8+1]=Zu(i)?0:i,mt()[e/4+0]=!Zu(i)},r.wbg.__wbindgen_is_object=function(e){const t=Ln(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Ln(e)in Ln(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return ir(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Ln(e)===Ln(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ir(t)},r.wbg.__wbindgen_is_undefined=function(e){return Ln(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=Pr(e,t);return ir(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ln(e)==Ln(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Ln(e);return ir(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=Ln(e)[Ln(t)];return ir(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Ln(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Ln(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Ln(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Ln(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Ln(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ir(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ln(t).stack,i=Fo(n,We.__wbindgen_malloc,We.__wbindgen_realloc),o=wi;mt()[e/4+1]=o,mt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Pr(e,t))}finally{We.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=Ln(e).performance;return ir(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Ln(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=Ln(e)[t>>>0];return ir(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Ln(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ln(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Pr(e,t));return ir(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=Ln(e).next;return ir(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ml(function(e){const t=Ln(e).next();return ir(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Ln(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=Ln(e).value;return ir(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ir(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ml(function(e,t){const n=Reflect.get(Ln(e),Ln(t));return ir(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Ml(function(e,t){const n=Ln(e).call(Ln(t));return ir(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Ml(function(){const e=self.self;return ir(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Ml(function(){const e=window.window;return ir(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Ml(function(){const e=globalThis.globalThis;return ir(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Ml(function(){const e=global.global;return ir(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Ln(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=Ln(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Ln(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(Ln(e));return ir(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=Ln(e).buffer;return ir(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(Ln(e));return ir(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){Ln(e).set(Ln(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Ln(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=Ln(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Ln(t),i=typeof n=="bigint"?n:void 0;nI()[e/8+1]=Zu(i)?BigInt(0):i,mt()[e/4+0]=!Zu(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=xg(Ln(t)),i=Fo(n,We.__wbindgen_malloc,We.__wbindgen_realloc),o=wi;mt()[e/4+1]=o,mt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Pr(e,t))},r.wbg.__wbindgen_memory=function(){const e=We.memory;return ir(e)},r}function lI(r,e){return We=r.exports,U2.__wbindgen_wasm_module=e,Tf=null,Cf=null,Sf=null,kf=null,We}async function U2(r){if(We!==void 0)return We;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=aI();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await sI(await r,e);return lI(t,n)}const uI=r=>({}),Sv=r=>({}),cI=r=>({}),Cv=r=>({}),fI=r=>({}),Tv=r=>({});function hI(r){let e,t,n,i,o,u,s,h;const p=r[1].top,g=vn(p,r,r[0],Tv),_=r[1].left,x=vn(_,r,r[0],Cv),C=r[1].main,T=vn(C,r,r[0],Sv);return{c(){e=U("div"),t=U("div"),g&&g.c(),n=ie(),i=U("div"),o=U("div"),x&&x.c(),u=ie(),s=U("div"),T&&T.c(),he(t,"class","top svelte-29q570"),he(o,"class","left svelte-29q570"),he(s,"class","main svelte-29q570"),he(i,"class","content svelte-29q570"),he(e,"class","flex-container svelte-29q570")},m(z,L){W(z,e,L),F(e,t),g&&g.m(t,null),F(e,n),F(e,i),F(i,o),x&&x.m(o,null),F(i,u),F(i,s),T&&T.m(s,null),h=!0},p(z,[L]){g&&g.p&&(!h||L&1)&&wn(g,p,z,z[0],h?bn(p,z[0],L,fI):xn(z[0]),Tv),x&&x.p&&(!h||L&1)&&wn(x,_,z,z[0],h?bn(_,z[0],L,cI):xn(z[0]),Cv),T&&T.p&&(!h||L&1)&&wn(T,C,z,z[0],h?bn(C,z[0],L,uI):xn(z[0]),Sv)},i(z){h||(N(g,z),N(x,z),N(T,z),h=!0)},o(z){V(g,z),V(x,z),V(T,z),h=!1},d(z){z&&G(e),g&&g.d(z),x&&x.d(z),T&&T.d(z)}}}function dI(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class pI extends Lt{constructor(e){super(),Et(this,e,dI,hI,St,{})}}const mI=r=>({}),Mv=r=>({}),gI=r=>({}),Ev=r=>({}),_I=r=>({}),Lv=r=>({});function yI(r){let e,t,n,i,o,u;const s=r[4].top,h=vn(s,r,r[3],Lv),p=r[4].sidebar,g=vn(p,r,r[3],Ev),_=r[4].map,x=vn(_,r,r[3],Mv);return{c(){e=U("div"),h&&h.c(),t=ie(),n=U("div"),g&&g.c(),i=ie(),o=U("div"),x&&x.c()},m(C,T){W(C,e,T),h&&h.m(e,null),r[5](e),W(C,t,T),W(C,n,T),g&&g.m(n,null),r[6](n),W(C,i,T),W(C,o,T),x&&x.m(o,null),r[7](o),u=!0},p(C,[T]){h&&h.p&&(!u||T&8)&&wn(h,s,C,C[3],u?bn(s,C[3],T,_I):xn(C[3]),Lv),g&&g.p&&(!u||T&8)&&wn(g,p,C,C[3],u?bn(p,C[3],T,gI):xn(C[3]),Ev),x&&x.p&&(!u||T&8)&&wn(x,_,C,C[3],u?bn(_,C[3],T,mI):xn(C[3]),Mv)},i(C){u||(N(h,C),N(g,C),N(x,C),u=!0)},o(C){V(h,C),V(g,C),V(x,C),u=!1},d(C){C&&(G(e),G(t),G(n),G(i),G(o)),h&&h.d(C),r[5](null),g&&g.d(C),r[6](null),x&&x.d(C),r[7](null)}}}function vI(r,e,t){let n,i,o;st(r,Ag,_=>t(0,n=_)),st(r,kg,_=>t(1,i=_)),st(r,Sg,_=>t(2,o=_));let{$$slots:u={},$$scope:s}=e;function h(_){dn[_?"unshift":"push"](()=>{n=_,Ag.set(n)})}function p(_){dn[_?"unshift":"push"](()=>{i=_,kg.set(i)})}function g(_){dn[_?"unshift":"push"](()=>{o=_,Sg.set(o)})}return r.$$set=_=>{"$$scope"in _&&t(3,s=_.$$scope)},[n,i,o,s,u,h,p,g]}class So extends Lt{constructor(e){super(),Et(this,e,vI,yI,St,{})}}let Ag=En(null),kg=En(null),Sg=En(null);const bI="/ltn/assets/streets-v2-style-b76f3b8b.json";function wI(r){let e;return{c(){e=Me("Back")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function xI(r){let e,t,n,i;return e=new lh({props:{$$slots:{default:[wI]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Mt(window,"keydown",r[2]),n=!0)},p(o,[u]){const s={};u&16&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function AI(r,e,t){let n;st(r,tr,s=>t(1,n=s));let{mode:i}=e;function o(s){s.key=="Escape"&&(s.stopPropagation(),ln(tr,n=i,n))}const u=()=>ln(tr,n=i,n);return r.$$set=s=>{"mode"in s&&t(0,i=s.mode)},[i,n,o,u]}class Us extends Lt{constructor(e){super(),Et(this,e,AI,xI,St,{mode:0})}}let rp=En(null);function Iv(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function Pv(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function kI(r){let e,t=r[6].length+"",n,i;return{c(){e=Me("Undo ("),n=Me(t),i=Me(")")},m(o,u){W(o,e,u),W(o,n,u),W(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&kt(n,t)},d(o){o&&(G(e),G(n),G(i))}}}function SI(r){let e;return{c(){e=Me("Undo")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function CI(r){let e;return{c(){e=U("span"),he(e,"class","dot svelte-11yzwwb"),Wt(e,"snapped-node",r[40].snapped),Wt(e,"free-node",!r[40].snapped),Wt(e,"hide",r[4])},m(t,n){W(t,e,n)},p(t,n){n[0]&128&&Wt(e,"snapped-node",t[40].snapped),n[0]&128&&Wt(e,"free-node",!t[40].snapped),n[0]&16&&Wt(e,"hide",t[4])},d(t){t&&G(e)}}}function zv(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function s(){return r[26](r[40])}let h={draggable:!0,zIndex:0,$$slots:{default:[CI]},$$scope:{ctx:r}};return r[40].point!==void 0&&(h.lngLat=r[40].point),e=new lp({props:h}),dn.push(()=>Dn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",s),{c(){ue(e.$$.fragment)},m(p,g){ae(e,p,g),n=!0},p(p,g){r=p;const _={};g[0]&144|g[1]&4096&&(_.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,_.lngLat=r[40].point,zn(()=>t=!1)),e.$set(_)},i(p){n||(N(e.$$.fragment,p),n=!0)},o(p){V(e.$$.fragment,p),n=!1},d(p){le(e,p)}}}function TI(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Ye(e,"padding-right","0"),Ye(e,"padding-left","20px"),Ye(e,"margin","0")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function MI(r){let e,t,n,i;return n=new Fw({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[TI]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=ie(),ue(n.$$.fragment),he(e,"class","dot svelte-11yzwwb"),Wt(e,"snapped",r[37].snapped)},m(o,u){W(o,e,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Wt(e,"snapped",o[37].snapped);const s={};u[1]&4096&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(G(e),G(t)),le(n,o)}}}function Dv(r){let e,t,n;function i(h){r[27](h,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let s={draggable:!0,zIndex:1,$$slots:{default:[MI]},$$scope:{ctx:r}};return r[37].point!==void 0&&(s.lngLat=r[37].point),e=new lp({props:s}),dn.push(()=>Dn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){ue(e.$$.fragment)},m(h,p){ae(e,h,p),n=!0},p(h,p){r=h;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,zn(()=>t=!1)),e.$set(g)},i(h){n||(N(e.$$.fragment,h),n=!0)},o(h){V(e.$$.fragment,h),n=!1},d(h){le(e,h)}}}function EI(r){let e,t,n,i;const o=[_n("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new Yi({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function LI(r){let e,t;const n=[_n("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function II(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H;function q(Ue,ze){return Ue[6].length==0?SI:kI}let J=q(r),fe=J(r);x=new Wg({}),x.$on("click",r[10]),x.$on("mousemove",r[11]);let Ee=On(r[7]),ee=[];for(let Ue=0;Ue<Ee.length;Ue+=1)ee[Ue]=zv(Pv(r,Ee,Ue));const oe=Ue=>V(ee[Ue],1,1,()=>{ee[Ue]=null});let xe=On(r[0]),me=[];for(let Ue=0;Ue<xe.length;Ue+=1)me[Ue]=Dv(Iv(r,xe,Ue));const tt=Ue=>V(me[Ue],1,1,()=>{me[Ue]=null});return L=new _r({props:{data:r[1]||eo(),generateId:!0,$$slots:{default:[EI]},$$scope:{ctx:r}}}),I=new _r({props:{data:r[8],$$slots:{default:[LI]},$$scope:{ctx:r}}}),B=Pg(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=ie(),n=U("div"),i=U("label"),o=U("input"),s=Me(`
    Snap boundary to roads`),h=ie(),p=U("button"),fe.c(),_=ie(),ue(x.$$.fragment),C=ie();for(let Ue=0;Ue<ee.length;Ue+=1)ee[Ue].c();T=ie();for(let Ue=0;Ue<me.length;Ue+=1)me[Ue].c();z=ie(),ue(L.$$.fragment),E=ie(),ue(I.$$.fragment),o.disabled=u=r[0].length>=3,he(o,"type","checkbox"),o.__value="snap",Wn(o,o.__value),he(p,"class","secondary"),p.disabled=g=r[6].length==0,Ye(n,"display","flex"),Ye(n,"gap","16px"),B.p(o)},m(Ue,ze){W(Ue,e,ze),W(Ue,t,ze),W(Ue,n,ze),F(n,i),F(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),F(i,s),F(n,h),F(n,p),fe.m(p,null),W(Ue,_,ze),ae(x,Ue,ze),W(Ue,C,ze);for(let Ie=0;Ie<ee.length;Ie+=1)ee[Ie]&&ee[Ie].m(Ue,ze);W(Ue,T,ze);for(let Ie=0;Ie<me.length;Ie+=1)me[Ie]&&me[Ie].m(Ue,ze);W(Ue,z,ze),ae(L,Ue,ze),W(Ue,E,ze),ae(I,Ue,ze),O=!0,K||(H=[Mt(o,"change",r[21]),Mt(p,"click",r[9])],K=!0)},p(Ue,ze){if((!O||ze[0]&1&&u!==(u=Ue[0].length>=3))&&(o.disabled=u),ze[0]&32&&(o.checked=~(Ue[5]||[]).indexOf(o.__value)),J===(J=q(Ue))&&fe?fe.p(Ue,ze):(fe.d(1),fe=J(Ue),fe&&(fe.c(),fe.m(p,null))),(!O||ze[0]&64&&g!==(g=Ue[6].length==0))&&(p.disabled=g),ze[0]&114832){Ee=On(Ue[7]);let Xe;for(Xe=0;Xe<Ee.length;Xe+=1){const lt=Pv(Ue,Ee,Xe);ee[Xe]?(ee[Xe].p(lt,ze),N(ee[Xe],1)):(ee[Xe]=zv(lt),ee[Xe].c(),N(ee[Xe],1),ee[Xe].m(T.parentNode,T))}for(Kt(),Xe=Ee.length;Xe<ee.length;Xe+=1)oe(Xe);Jt()}if(ze[0]&143373){xe=On(Ue[0]);let Xe;for(Xe=0;Xe<xe.length;Xe+=1){const lt=Iv(Ue,xe,Xe);me[Xe]?(me[Xe].p(lt,ze),N(me[Xe],1)):(me[Xe]=Dv(lt),me[Xe].c(),N(me[Xe],1),me[Xe].m(z.parentNode,z))}for(Kt(),Xe=xe.length;Xe<me.length;Xe+=1)tt(Xe);Jt()}const Ie={};ze[0]&2&&(Ie.data=Ue[1]||eo()),ze[1]&4096&&(Ie.$$scope={dirty:ze,ctx:Ue}),L.$set(Ie);const ct={};ze[0]&256&&(ct.data=Ue[8]),ze[1]&4096&&(ct.$$scope={dirty:ze,ctx:Ue}),I.$set(ct)},i(Ue){if(!O){N(x.$$.fragment,Ue);for(let ze=0;ze<Ee.length;ze+=1)N(ee[ze]);for(let ze=0;ze<xe.length;ze+=1)N(me[ze]);N(L.$$.fragment,Ue),N(I.$$.fragment,Ue),O=!0}},o(Ue){V(x.$$.fragment,Ue),ee=ee.filter(Boolean);for(let ze=0;ze<ee.length;ze+=1)V(ee[ze]);me=me.filter(Boolean);for(let ze=0;ze<me.length;ze+=1)V(me[ze]);V(L.$$.fragment,Ue),V(I.$$.fragment,Ue),O=!1},d(Ue){Ue&&(G(e),G(t),G(n),G(_),G(C),G(T),G(z),G(E)),fe.d(),le(x,Ue),_i(ee,Ue),_i(me,Ue),le(L,Ue),le(I,Ue),B.r(),K=!1,cr(H)}}}function PI(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function zI(r,e,t){let n,i;st(r,rp,He=>t(20,i=He));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:s=void 0}=e;ri(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let h="snap",p=[],g=[],_=null,x=!1,C=!1,T=!1;function z(He){let gt=He.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=gt}function L(){let He=p.pop();t(6,p),He&&t(0,u=He)}function E(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function I(He){u.length>=3||(E(),u.push({point:He.detail.lngLat.toArray(),snapped:h=="snap"}),t(0,u))}function O(He){t(19,_={point:He.detail.lngLat.toArray(),snapped:h=="snap"})}function B(He){E(),t(0,u[He].snapped=!u[He].snapped,u),t(0,u)}function K(He){E(),u.splice(He,1),t(0,u),t(2,x=!1)}function H(He,gt,Pt,jt){if(jt||gt.length>=3)return eo();try{if(He&&gt.length>0&&Pt)return JSON.parse(He.inner.calculateRoute([gt[gt.length-1],Pt]))}catch{}return eo()}function q(He,gt,Pt){if(Pt)return;if(!He||gt.length<3){t(7,g=[]);return}let jt=[],un=1,nn=JSON.parse(JSON.stringify(gt));nn.push(nn[0]);for(let rn=0;rn<nn.length-1;rn++){let pn=JSON.parse(He.inner.getExtraNodes(nn[rn],nn[rn+1]));for(let[yn,qe,Ge]of pn)jt.push({point:[yn,qe],snapped:Ge,insertIdx:un});un++}t(7,g=jt)}function J(He){E(),u.splice(He.insertIdx,0,{point:He.point,snapped:He.snapped}),t(0,u),t(4,T=!0)}function fe(He){t(0,u[He.insertIdx].point=He.point,u),t(0,u)}function Ee(){t(4,T=!1)}function ee(){E(),t(3,C=!0)}const oe=[[]];function xe(){h=tk(oe[0],this.__value,this.checked),t(5,h)}function me(He,gt){r.$$.not_equal(gt.point,He)&&(gt.point=He,t(7,g))}const tt=He=>J(He),Ue=He=>fe(He),ze=He=>{J(He),t(4,T=!1)};function Ie(He,gt){r.$$.not_equal(gt.point,He)&&(gt.point=He,t(0,u))}const ct=He=>B(He),Xe=He=>K(He),lt=()=>t(2,x=!0),pt=()=>t(2,x=!1),_t=()=>t(3,C=!1);return r.$$set=He=>{"map"in He&&t(18,o=He.map),"waypoints"in He&&t(0,u=He.waypoints),"drawnShapeOut"in He&&t(1,s=He.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,s=PI(i,u))}catch(He){console.log("error drawing shape",He),t(1,s=void 0)}r.$$.dirty[0]&1048593&&q(i,u,T),r.$$.dirty[0]&1572877&&t(8,n=H(i,u,_,x||C)),r.$$.dirty[0]&1&&z(u)},[u,s,x,C,T,h,p,g,n,L,I,O,B,K,J,fe,Ee,ee,o,_,i,xe,oe,me,tt,Ue,ze,Ie,ct,Xe,lt,pt,_t]}class V2 extends Lt{constructor(e){super(),Et(this,e,zI,II,St,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function Rv(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",u,s,h,p,g,_,x,C=r[0].properties.simd.toFixed(1)+"",T,z,L,E,I,O,B,K=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",H,q,J,fe,Ee,ee,oe,xe=ac(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",me,tt,Ue,ze,Ie,ct,Xe,lt=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",pt,_t;return{c(){e=U("tr"),t=U("th"),t.textContent="Population density",n=ie(),i=U("td"),u=Me(o),s=Me(" people / km²"),h=ie(),p=U("tr"),g=U("th"),g.textContent="SIMD",_=ie(),x=U("td"),T=Me(C),z=Me("%"),L=ie(),E=U("tr"),I=U("th"),I.textContent="Collision density",O=ie(),B=U("td"),H=Me(K),q=Me(" / km²"),J=ie(),fe=U("tr"),Ee=U("th"),Ee.textContent="Car ownership",ee=ie(),oe=U("td"),me=Me(xe),tt=Me(" of households"),Ue=ie(),ze=U("tr"),Ie=U("th"),Ie.textContent="POI density",ct=ie(),Xe=U("td"),pt=Me(lt),_t=Me(" / km²")},m(He,gt){W(He,e,gt),F(e,t),F(e,n),F(e,i),F(i,u),F(i,s),W(He,h,gt),W(He,p,gt),F(p,g),F(p,_),F(p,x),F(x,T),F(x,z),W(He,L,gt),W(He,E,gt),F(E,I),F(E,O),F(E,B),F(B,H),F(B,q),W(He,J,gt),W(He,fe,gt),F(fe,Ee),F(fe,ee),F(fe,oe),F(oe,me),F(oe,tt),W(He,Ue,gt),W(He,ze,gt),F(ze,Ie),F(ze,ct),F(ze,Xe),F(Xe,pt),F(Xe,_t)},p(He,gt){gt&1&&o!==(o=Math.round(He[0].properties.population/He[0].properties.area_km2).toLocaleString()+"")&&kt(u,o),gt&1&&C!==(C=He[0].properties.simd.toFixed(1)+"")&&kt(T,C),gt&1&&K!==(K=(He[0].properties.number_stats19_collisions/He[0].properties.area_km2).toFixed(1)+"")&&kt(H,K),gt&1&&xe!==(xe=ac(He[0].properties.households_with_cars_or_vans,He[0].properties.total_households)+"")&&kt(me,xe),gt&1&&lt!==(lt=(He[0].properties.number_pois/He[0].properties.area_km2).toFixed(1)+"")&&kt(pt,lt)},d(He){He&&(G(e),G(h),G(p),G(L),G(E),G(J),G(fe),G(Ue),G(ze))}}}function DI(r){let e,t,n,i,o,u=r[0].properties.area_km2.toFixed(1)+"",s,h,p,g=r[1]=="cnt"&&Rv(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=ie(),o=U("td"),s=Me(u),h=Me(" km²"),p=ie(),g&&g.c(),he(e,"class","svelte-1kpsyee")},m(_,x){W(_,e,x),F(e,t),F(t,n),F(t,i),F(t,o),F(o,s),F(o,h),F(e,p),g&&g.m(e,null)},p(_,[x]){x&1&&u!==(u=_[0].properties.area_km2.toFixed(1)+"")&&kt(s,u),_[1]=="cnt"?g?g.p(_,x):(g=Rv(_),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i:at,o:at,d(_){_&&G(e),g&&g.d()}}}function RI(r,e,t){let n;st(r,As,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class q2 extends Lt{constructor(e){super(),Et(this,e,RI,DI,St,{neighbourhoodBoundary:0})}}function H2(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function BI(r){let e,t,n,i,o,u,s,h;return e=new ko({props:{colorScale:v2,labels:{limits:[1,2,3,4,5]}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>Least important</span> <span>Most important</span>",i=ie(),o=U("br"),u=ie(),s=U("p"),s.textContent=`This metric combines the other five by averaging each of the metrics, on the
    1-5 scale.`,he(n,"class","sub-labels svelte-3xhwrh")},m(p,g){ae(e,p,g),W(p,t,g),W(p,n,g),W(p,i,g),W(p,o,g),W(p,u,g),W(p,s,g),h=!0},p:at,i(p){h||(N(e.$$.fragment,p),h=!0)},o(p){V(e.$$.fragment,p),h=!1},d(p){p&&(G(t),G(n),G(i),G(o),G(u),G(s)),le(e,p)}}}function FI(r){let e,t,n,i;return e=new ko({props:{colorScale:y2,labels:{limits:r[1].poi_density}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.textContent="POIs / km²",Ye(n,"text-align","center")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].poi_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function OI(r){let e,t,n,i;return e=new ko({props:{colorScale:_2,labels:{limits:r[1].collision_density}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.textContent="collisions / km²",Ye(n,"text-align","center")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].collision_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function $I(r){let e,t,n,i;return e=new ko({props:{colorScale:hp,labels:{buckets:b2(dp)}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",he(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:at,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function NI(r){let e,t,n,i;return e=new ko({props:{colorScale:mp,labels:{limits:pp.map(VI)}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(n,"display","flex"),Ye(n,"justify-content","space-between")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:at,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function jI(r){let e,t,n,i;return e=new ko({props:{colorScale:Wf,labels:{limits:r[1].population_density}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / km²</span> <span>More dense</span>",he(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].population_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function UI(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I;const O=[jI,NI,$I,OI,FI,BI],B=[];function K(H,q){return H[0]=="density"?0:H[0]=="car_ownership"?1:H[0]=="simd"?2:H[0]=="stats19"?3:H[0]=="pois"?4:H[0]=="combined"?5:-1}return~(C=K(r))&&(T=B[C]=O[C](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=ie(),i=U("select"),o=U("option"),o.textContent="None",u=U("option"),u.textContent="Density",s=U("option"),s.textContent="Collisions",h=U("option"),h.textContent="SIMD",p=U("option"),p.textContent="Points of interest",g=U("option"),g.textContent="Car ownership",_=U("option"),_.textContent="Combined",x=ie(),T&&T.c(),z=nr(),Ye(t,"margin","0"),Ye(t,"padding","0"),he(t,"for","prioritization-selection"),o.__value="none",Wn(o,o.__value),u.__value="density",Wn(u,u.__value),s.__value="stats19",Wn(s,s.__value),h.__value="simd",Wn(h,h.__value),p.__value="pois",Wn(p,p.__value),g.__value="car_ownership",Wn(g,g.__value),_.__value="combined",Wn(_,_.__value),he(i,"id","prioritization-selection"),r[0]===void 0&&ys(()=>r[2].call(i)),Ye(e,"display","flex"),Ye(e,"gap","16px"),Ye(e,"align-items","center"),Ye(e,"width","fit-content")},m(H,q){W(H,e,q),F(e,t),F(e,n),F(e,i),F(i,o),F(i,u),F(i,s),F(i,h),F(i,p),F(i,g),F(i,_),Ki(i,r[0],!0),W(H,x,q),~C&&B[C].m(H,q),W(H,z,q),L=!0,E||(I=Mt(i,"change",r[2]),E=!0)},p(H,[q]){q&1&&Ki(i,H[0]);let J=C;C=K(H),C===J?~C&&B[C].p(H,q):(T&&(Kt(),V(B[J],1,1,()=>{B[J]=null}),Jt()),~C?(T=B[C],T?T.p(H,q):(T=B[C]=O[C](H),T.c()),N(T,1),T.m(z.parentNode,z)):T=null)},i(H){L||(N(T),L=!0)},o(H){V(T),L=!1},d(H){H&&(G(e),G(x),G(z)),~C&&B[C].d(H),E=!1,I()}}}const VI=r=>`${r}%`;function qI(r,e,t){let n,i;st(r,As,h=>t(3,n=h)),st(r,nh,h=>t(1,i=h));let{selectedPrioritization:o}=e;function u(){let h=new URL(window.location.href).searchParams.get("prioritizationMetric");h=="density"?t(0,o="density"):h=="simd"?t(0,o="simd"):h=="stats19"?t(0,o="stats19"):h=="pois"?t(0,o="pois"):h=="car_ownership"?t(0,o="car_ownership"):h=="combined"&&t(0,o="combined")}n=="cnt"?u():o="none";function s(){o=Fa(this),t(0,o)}return r.$$set=h=>{"selectedPrioritization"in h&&t(0,o=h.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const h=new URL(window.location.href);o=="none"?h.searchParams.delete("prioritizationMetric"):h.searchParams.set("prioritizationMetric",o),history.replaceState({},"",h)}},[o,i,s]}class G2 extends Lt{constructor(e){super(),Et(this,e,qI,UI,St,{selectedPrioritization:0})}}function W2(r,e,t){return{none:r.none,area:Bi(["get","area_km2"],VT,qT),car_ownership:Bi(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],pp,mp),density:Bi(["/",["get","population"],["get","area_km2"]],t.population_density,Wf),pois:Bi(["/",["get","number_pois"],["get","area_km2"]],t.poi_density,y2),simd:Bi(["get","simd"],dp,hp),stats19:Bi(["/",["get","number_stats19_collisions"],["get","area_km2"]],t.collision_density,_2),combined:Bi(["get","combined_score"],[1,2,3,4,5],v2)}[e]}function HI(r){let e,t,n,i,o,u,s,h,p,g,_=yr(r[8].mode)+"",x,C;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),x=Me(_),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(T,z){W(T,e,z),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),F(g,x),C=!0},p(T,z){(!C||z[0]&256)&&_!==(_=yr(T[8].mode)+"")&&kt(x,_)},i(T){C||(N(o.$$.fragment,T),N(h.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(h.$$.fragment,T),C=!1},d(T){T&&G(e),le(o),le(h)}}}function Bv(r){let e,t,n,i,o,u,s;function h(g){r[20](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new G2({props:p}),dn.push(()=>Dn(o,"selectedPrioritization",h)),{c(){e=U("h3"),e.textContent="Prioritization",t=ie(),n=U("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=ie(),ue(o.$$.fragment)},m(g,_){W(g,e,_),W(g,t,_),W(g,n,_),W(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};!u&&_[0]&16&&(u=!0,x.selectedPrioritization=g[4],zn(()=>u=!1)),o.$set(x)},i(g){s||(N(o.$$.fragment,g),s=!0)},o(g){V(o.$$.fragment,g),s=!1},d(g){g&&(G(e),G(t),G(n),G(i)),le(o,g)}}}function Fv(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function GI(r){let e,t,n,i,o,u,s,h;function p(x){r[23](x)}function g(x){r[24](x)}let _={map:mr(r[10])};return r[6]!==void 0&&(_.waypoints=r[6]),r[1]!==void 0&&(_.drawnShapeOut=r[1]),n=new V2({props:_}),dn.push(()=>Dn(n,"waypoints",p)),dn.push(()=>Dn(n,"drawnShapeOut",g)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-iaefgo">1. Draw your neighbourhood</h3>',t=ie(),ue(n.$$.fragment),u=ie(),s=U("div"),s.innerHTML=`<h3 class="svelte-iaefgo">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,he(e,"class","step svelte-iaefgo"),Wt(e,"active",!r[7]),Wt(e,"complete",r[7]),he(s,"class","step svelte-iaefgo"),Ye(s,"margin-top","16px"),Wt(s,"active",r[7]),Wt(s,"complete",r[5].size>1)},m(x,C){W(x,e,C),W(x,t,C),ae(n,x,C),W(x,u,C),W(x,s,C),h=!0},p(x,C){(!h||C[0]&128)&&Wt(e,"active",!x[7]),(!h||C[0]&128)&&Wt(e,"complete",x[7]);const T={};C[0]&1024&&(T.map=mr(x[10])),!i&&C[0]&64&&(i=!0,T.waypoints=x[6],zn(()=>i=!1)),!o&&C[0]&2&&(o=!0,T.drawnShapeOut=x[1],zn(()=>o=!1)),n.$set(T),(!h||C[0]&128)&&Wt(s,"active",x[7]),(!h||C[0]&32)&&Wt(s,"complete",x[5].size>1)},i(x){h||(N(n.$$.fragment,x),h=!0)},o(x){V(n.$$.fragment,x),h=!1},d(x){x&&(G(e),G(t),G(u),G(s)),le(n,x)}}}function WI(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-iaefgo">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=ie(),n=U("div"),n.innerHTML='<h3 class="svelte-iaefgo">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',he(e,"class","step svelte-iaefgo"),Wt(e,"active",!r[7]),Wt(e,"complete",r[7]),he(n,"class","step svelte-iaefgo"),Wt(n,"active",r[7]),Wt(n,"complete",r[5].size>1)},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o[0]&128&&Wt(e,"active",!i[7]),o[0]&128&&Wt(e,"complete",i[7]),o[0]&128&&Wt(n,"active",i[7]),o[0]&32&&Wt(n,"complete",i[5].size>1)},i:at,o:at,d(i){i&&(G(e),G(t),G(n))}}}function ZI(r){let e;function t(o,u){if(o[0]=="choose-area")return JI;if(o[0]=="draw-area")return KI}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),Ye(e,"text-align","center")},m(o,u){W(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:at,o:at,d(o){o&&G(e),i&&i.d()}}}function XI(r){let e,t;return e=new q2({props:{neighbourhoodBoundary:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function KI(r){let e;function t(o,u){return o[6].length<3?QI:YI}let n=t(r),i=n(r);return{c(){i.c(),e=nr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i.d(o)}}}function JI(r){let e;return{c(){e=Me("Empty so far. Click a colored area to get started.")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function YI(r){let e;return{c(){e=Me(`Not a valid shape yet — try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function QI(r){let e;return{c(){e=Me(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function e8(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,fe,Ee,ee,oe,xe,me,tt,Ue,ze,Ie,ct,Xe,lt,pt,_t,He,gt,Pt,jt,un;t=new Us({props:{mode:{mode:"pick-neighbourhood"}}});let nn=r[9]=="cnt"&&Bv(r),rn=r[4]=="none"&&Fv();_=new Mw({}),z=new Vg({});const pn=[WI,GI],yn=[];function qe(de,cn){return de[0]=="choose-area"?0:de[0]=="draw-area"?1:-1}~(I=qe(r))&&(O=yn[I]=pn[I](r)),xe=new qg({});const Ge=[XI,ZI],At=[];function nt(de,cn){return de[7]?0:1}return Xe=nt(r),lt=At[Xe]=Ge[Xe](r),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),nn&&nn.c(),i=ie(),rn&&rn.c(),o=ie(),u=U("hr"),s=ie(),h=U("div"),p=U("div"),g=U("button"),ue(_.$$.fragment),x=Me(`
          Choose area`),C=Me(`
        or
        `),T=U("button"),ue(z.$$.fragment),L=Me(`
          Draw area`),E=ie(),O&&O.c(),B=ie(),K=U("div"),K.innerHTML='<h3 class="svelte-iaefgo">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',H=ie(),q=U("div"),J=U("button"),fe=Me("Create neighborhood"),ee=ie(),oe=U("button"),ue(xe.$$.fragment),me=Me(" Start over"),Ue=ie(),ze=U("h3"),ze.textContent="Your neighbourhood overall",Ie=ie(),ct=U("div"),lt.c(),pt=ie(),_t=U("hr"),He=ie(),gt=U("button"),gt.textContent="Export metrics to GeoJSON",Wt(g,"active",r[0]=="choose-area"),Wt(T,"active",r[0]=="draw-area"),he(p,"class","tool-palette svelte-iaefgo"),Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","16px"),he(K,"class","step svelte-iaefgo"),Wt(K,"active",r[7]),J.disabled=Ee=!r[7],he(oe,"class","destructive"),Ye(oe,"display","flex"),Ye(oe,"gap","8px"),Ye(oe,"align-items","center"),oe.disabled=tt=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Ye(q,"display","flex"),Ye(q,"gap","16px"),Ye(q,"justify-content","space-between"),Ye(q,"margin-bottom","16px"),he(ct,"class","neighbourhood-boundary-summary svelte-iaefgo"),he(gt,"class","secondary"),he(e,"slot","sidebar")},m(de,cn){W(de,e,cn),ae(t,e,null),F(e,n),nn&&nn.m(e,null),F(e,i),rn&&rn.m(e,null),F(e,o),F(e,u),F(e,s),F(e,h),F(h,p),F(p,g),ae(_,g,null),F(g,x),F(p,C),F(p,T),ae(z,T,null),F(T,L),F(h,E),~I&&yn[I].m(h,null),F(h,B),F(h,K),F(h,H),F(h,q),F(q,J),F(J,fe),F(q,ee),F(q,oe),ae(xe,oe,null),F(oe,me),F(h,Ue),F(h,ze),F(h,Ie),F(h,ct),At[Xe].m(ct,null),F(e,pt),F(e,_t),F(e,He),F(e,gt),Pt=!0,jt||(un=[Mt(g,"click",r[21]),Mt(T,"click",r[22]),Mt(J,"click",r[25]),Mt(oe,"click",r[16]),Mt(gt,"click",r[13])],jt=!0)},p(de,cn){de[9]=="cnt"?nn?(nn.p(de,cn),cn[0]&512&&N(nn,1)):(nn=Bv(de),nn.c(),N(nn,1),nn.m(e,i)):nn&&(Kt(),V(nn,1,1,()=>{nn=null}),Jt()),de[4]=="none"?rn||(rn=Fv(),rn.c(),rn.m(e,o)):rn&&(rn.d(1),rn=null),(!Pt||cn[0]&1)&&Wt(g,"active",de[0]=="choose-area"),(!Pt||cn[0]&1)&&Wt(T,"active",de[0]=="draw-area");let Ke=I;I=qe(de),I===Ke?~I&&yn[I].p(de,cn):(O&&(Kt(),V(yn[Ke],1,1,()=>{yn[Ke]=null}),Jt()),~I?(O=yn[I],O?O.p(de,cn):(O=yn[I]=pn[I](de),O.c()),N(O,1),O.m(h,B)):O=null),(!Pt||cn[0]&128)&&Wt(K,"active",de[7]),(!Pt||cn[0]&128&&Ee!==(Ee=!de[7]))&&(J.disabled=Ee),(!Pt||cn[0]&193&&tt!==(tt=!(de[7]||de[0]=="draw-area"&&de[6].length>0)))&&(oe.disabled=tt);let ut=Xe;Xe=nt(de),Xe===ut?At[Xe].p(de,cn):(Kt(),V(At[ut],1,1,()=>{At[ut]=null}),Jt(),lt=At[Xe],lt?lt.p(de,cn):(lt=At[Xe]=Ge[Xe](de),lt.c()),N(lt,1),lt.m(ct,null))},i(de){Pt||(N(t.$$.fragment,de),N(nn),N(_.$$.fragment,de),N(z.$$.fragment,de),N(O),N(xe.$$.fragment,de),N(lt),Pt=!0)},o(de){V(t.$$.fragment,de),V(nn),V(_.$$.fragment,de),V(z.$$.fragment,de),V(O),V(xe.$$.fragment,de),V(lt),Pt=!1},d(de){de&&G(e),le(t),nn&&nn.d(),rn&&rn.d(),le(_),le(z),~I&&yn[I].d(),le(xe),At[Xe].d(),jt=!1,cr(un)}}}function Ov(r){let e,t;return e=new _r({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[t8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function t8(r){let e,t,n,i;const o=[_n("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new ur({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function $v(r){let e,t;return e=new _r({props:{data:r[3],generateId:!0,$$slots:{default:[c8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Nv(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[l8,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741840|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function n8(r){let e,t,n,i,o=r[30].combined_score+"",u;return{c(){e=U("b"),e.textContent="Combined score",t=ie(),n=U("br"),i=ie(),u=Me(o)},m(s,h){W(s,e,h),W(s,t,h),W(s,n,h),W(s,i,h),W(s,u,h)},p(s,h){h[0]&1073741824&&o!==(o=s[30].combined_score+"")&&kt(u,o)},d(s){s&&(G(e),G(t),G(n),G(i),G(u))}}}function r8(r){let e,t,n,i,o=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Points of interest",t=ie(),n=U("br"),i=ie(),u=Me(o),s=Me(" / km²")},m(h,p){W(h,e,p),W(h,t,p),W(h,n,p),W(h,i,p),W(h,u,p),W(h,s,p)},p(h,p){p[0]&1073741824&&o!==(o=(h[30].number_pois/h[30].area_km2).toFixed(1)+"")&&kt(u,o)},d(h){h&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function i8(r){let e,t,n,i,o=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=ie(),n=U("br"),i=ie(),u=Me(o),s=Me(` /
                km²`)},m(h,p){W(h,e,p),W(h,t,p),W(h,n,p),W(h,i,p),W(h,u,p),W(h,s,p)},p(h,p){p[0]&1073741824&&o!==(o=(h[30].number_stats19_collisions/h[30].area_km2).toFixed(1)+"")&&kt(u,o)},d(h){h&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function o8(r){let e,t,n,i,o=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",u,s;return{c(){e=U("b"),e.textContent="Population density",t=ie(),n=U("br"),i=ie(),u=Me(o),s=Me(`
                people / km²`)},m(h,p){W(h,e,p),W(h,t,p),W(h,n,p),W(h,i,p),W(h,u,p),W(h,s,p)},p(h,p){p[0]&1073741824&&o!==(o=Math.round(h[30].population/h[30].area_km2).toLocaleString()+"")&&kt(u,o)},d(h){h&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function s8(r){let e,t,n,i,o=ac(r[30].households_with_cars_or_vans,r[30].total_households)+"",u,s,h=r[30].total_households.toLocaleString()+"",p,g;return{c(){e=U("b"),e.textContent="Car or van ownership",t=ie(),n=U("br"),i=ie(),u=Me(o),s=Me(" of approximately "),p=Me(h),g=Me(`
                households have at least one car or van.`)},m(_,x){W(_,e,x),W(_,t,x),W(_,n,x),W(_,i,x),W(_,u,x),W(_,s,x),W(_,p,x),W(_,g,x)},p(_,x){x[0]&1073741824&&o!==(o=ac(_[30].households_with_cars_or_vans,_[30].total_households)+"")&&kt(u,o),x[0]&1073741824&&h!==(h=_[30].total_households.toLocaleString()+"")&&kt(p,h)},d(_){_&&(G(e),G(t),G(n),G(i),G(u),G(s),G(p),G(g))}}}function a8(r){let e,t,n=r[30].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=ie(),i=Me(n),o=Me(" km²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&1073741824&&n!==(n=u[30].area_km2.toFixed(1)+"")&&kt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function l8(r){let e;function t(o,u){if(o[4]=="none")return a8;if(o[4]=="car_ownership")return s8;if(o[4]=="density")return o8;if(o[4]=="stats19")return i8;if(o[4]=="pois")return r8;if(o[4]=="combined")return n8}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=nr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i&&i.d(o)}}}function u8(r){let e,t,n=r[4]!="simd"&&Nv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&N(n,1)):(n=Nv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function c8(r){let e,t,n,i;const o=[_n("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[u8]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new Yi({props:u}),e.$on("click",r[11]);const s=[_n("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new ur({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g[0]&49168?In(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g[0]&16|g[1]&1&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function f8(r){let e,t,n,i=r[7]&&Ov(r),o=r[0]=="choose-area"&&$v(r);return{c(){e=U("div"),i&&i.c(),t=ie(),o&&o.c(),he(e,"slot","map")},m(u,s){W(u,e,s),i&&i.m(e,null),F(e,t),o&&o.m(e,null),n=!0},p(u,s){u[7]?i?(i.p(u,s),s[0]&128&&N(i,1)):(i=Ov(u),i.c(),N(i,1),i.m(e,t)):i&&(Kt(),V(i,1,1,()=>{i=null}),Jt()),u[0]=="choose-area"?o?(o.p(u,s),s[0]&1&&N(o,1)):(o=$v(u),o.c(),N(o,1),o.m(e,null)):o&&(Kt(),V(o,1,1,()=>{o=null}),Jt())},i(u){n||(N(i),N(o),n=!0)},o(u){V(i),V(o),n=!1},d(u){u&&G(e),i&&i.d(),o&&o.d()}}}function h8(r){let e,t,n,i;return e=new uh({props:{loading:r[2]}}),n=new So({props:{$$slots:{map:[f8],sidebar:[e8],top:[HI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u[0]&4&&(s.loading=o[2]),e.$set(s);const h={};u[0]&2043|u[1]&1&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function d8(r,e,t){let n,i,o,u,s,h,p,g;st(r,nh,ze=>t(26,n=ze)),st(r,tr,ze=>t(8,i=ze)),st(r,Ra,ze=>t(27,o=ze)),st(r,kr,ze=>t(19,u=ze)),st(r,$s,ze=>t(28,s=ze)),st(r,Wa,ze=>t(29,h=ze)),st(r,As,ze=>t(9,p=ze)),st(r,as,ze=>t(10,g=ze));let _="Generating severance boundaries...",x=eo(),C="choose-area",T="none",z=null,L=new Map,E=[],I,O=null,B=null;ks(async()=>{await new Promise(ze=>{requestAnimationFrame(()=>{requestAnimationFrame(ze)})}),t(3,x=u.generatedBoundaries()),t(2,_="")});function K(ze){let Ie=ze.detail.features[0].id,ct=x.features[Ie],Xe=new Map(L);if(Xe.has(Ie)?Xe.delete(Ie):Xe.set(Ie,ct),Xe.size===0)t(17,z=null),t(5,L=Xe);else if(Xe.size===1)t(17,z=Xe.values().next().value),t(5,L=Xe);else{let lt={type:"FeatureCollection",features:Array.from(Xe.values())};try{t(17,z=u.generateMergedBoundary(lt)),t(5,L=Xe)}catch(pt){console.log(`error merging boundaries: ${pt}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${pt}`)}}}function H(ze){var Xe;let Ie=h.nextAvailableNeighbourhoodName(s),ct=H2(u,"What do you want to name the neighbourhood?",Ie);if(ct)try{const lt={};C=="draw-area"&&((Xe=I==null?void 0:I.properties)!=null&&Xe.waypoints)&&(lt.waypoints=I.properties.waypoints);let pt={type:"Feature",properties:lt,geometry:ze.geometry};u.setCurrentNeighbourhoodBoundary(ct,pt),ln(Ra,o=ct,o),qf(),ln(tr,i={mode:"neighbourhood"},i)}catch(lt){window.alert(`Sorry, this boundary is invalid: ${lt}`)}}function q(){op("auto_boundaries.geojson",JSON.stringify(x,null,"  "))}function J(ze){return W2({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},ze,n)}function fe(ze){return{none:Gn(.3,.5),area:Gn(.7,.9),car_ownership:Gn(.7,.9),density:Gn(.7,.9),pois:Gn(.7,.9),simd:Gn(.7,.9),stats19:Gn(.7,.9),combined:Gn(.7,.9)}[ze]}function Ee(){t(17,z=null),L.clear(),t(5,L),t(6,E=[]),t(18,O=null),t(7,B=null)}function ee(ze){T=ze,t(4,T)}const oe=()=>t(0,C="choose-area"),xe=()=>t(0,C="draw-area");function me(ze){E=ze,t(6,E)}function tt(ze){I=ze,t(1,I)}const Ue=()=>H(mr(B));return r.$$.update=()=>{if(r.$$.dirty[0]&524290){let ze=null;if(I&&I.geometry.coordinates[0].length>3){let Ie={type:"FeatureCollection",features:[I]};try{ze=u.generateMergedBoundary(Ie)}catch(ct){console.log(`error merging boundaries: ${ct}`)}}t(18,O=ze)}r.$$.dirty[0]&393217&&(C=="draw-area"?t(7,B=O):t(7,B=z))},[C,I,_,x,T,L,E,B,i,p,g,K,H,q,J,fe,Ee,z,O,u,ee,oe,xe,me,tt,Ue]}class p8 extends Lt{constructor(e){super(),Et(this,e,d8,h8,St,{},null,[-1,-1])}}const m8="/ltn/assets/bus_gate_icon-5ea86d80.gif",g8="/ltn/assets/bus_gate-fc08b133.gif",_8="/ltn/assets/no_entry_icon-a9bfd826.gif",y8="/ltn/assets/no_entry-6857cf3d.gif",v8="/ltn/assets/school_street_icon-38e9058e.gif",b8="/ltn/assets/school_street-a0b77e20.gif",w8="/ltn/assets/walk_cycle_only_icon-4c8b48c0.gif",x8="/ltn/assets/walk_cycle_only-03bfc59f.gif",bi=class bi{constructor(e,t,n,i,o){Qn(this,"filterType");Qn(this,"label");Qn(this,"description");Qn(this,"imageUrl");Qn(this,"iconUrl");this.filterType=e,this.label=t,this.description=n,this.imageUrl=i,this.iconUrl=o}get iconURL(){return this.iconUrl}get largeImageURL(){return this.imageUrl}static getFilter(e){switch(e){case"walk_cycle_only":return bi.walkCycleOnly;case"no_entry":return bi.noEntry;case"bus_gate":return bi.busGate;case"school_street":return bi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};Qn(bi,"walkCycleOnly",new bi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.",x8,w8)),Qn(bi,"noEntry",new bi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.",y8,_8)),Qn(bi,"busGate",new bi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.",g8,m8)),Qn(bi,"schoolStreet",new bi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.",b8,v8)),Qn(bi,"allTypes",[bi.walkCycleOnly,bi.noEntry,bi.busGate,bi.schoolStreet]);let Ri=bi;function A8(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T=yr(r[7].mode)+"",z,L;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Me(T),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(E,I){W(E,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,z),L=!0},p(E,I){(!L||I&128)&&T!==(T=yr(E[7].mode)+"")&&kt(z,T)},i(E){L||(N(o.$$.fragment,E),N(h.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(h.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(h),le(_)}}}function k8(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function S8(r){let e,t=r[6].properties.name+"",n,i,o,u,s=r[6].properties.sum_from.toLocaleString()+"",h,p,g,_,x=r[6].properties.sum_to.toLocaleString()+"",C,T,z,L,E=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=U("u"),n=Me(t),i=ie(),o=U("p"),u=Me("Total trips from here: "),h=Me(s),p=ie(),g=U("p"),_=Me("Total trips to here: "),C=Me(x),T=ie(),z=U("p"),L=Me("Total intra-zonal trips starting and ending here: "),I=Me(E)},m(O,B){W(O,e,B),F(e,n),W(O,i,B),W(O,o,B),F(o,u),F(o,h),W(O,p,B),W(O,g,B),F(g,_),F(g,C),W(O,T,B),W(O,z,B),F(z,L),F(z,I)},p(O,B){B&64&&t!==(t=O[6].properties.name+"")&&kt(n,t),B&64&&s!==(s=O[6].properties.sum_from.toLocaleString()+"")&&kt(h,s),B&64&&x!==(x=O[6].properties.sum_to.toLocaleString()+"")&&kt(C,x),B&72&&E!==(E=O[6].properties.counts_from[O[3]]+"")&&kt(I,E)},d(O){O&&(G(e),G(i),G(o),G(p),G(g),G(T),G(z))}}}function C8(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",s,h,p,g,_,x,C,T,z,L,E=r[1]?"from":"to",I,O,B=r[3]==null?"each zone":"this zone",K,H,q,J,fe,Ee,ee,oe,xe,me;t=new Us({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),J=new ko({props:{colorScale:Fd,labels:{limits:r[5]}}});function tt(Ie,ct){return Ie[6]&&Ie[3]!=null?S8:k8}let Ue=tt(r),ze=Ue(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),o=Me("Trips begin and end in "),s=Me(u),h=Me(" zones"),p=ie(),g=U("label"),_=Me(`Trips from
      `),x=U("input"),C=Me(`
      Trips to`),T=ie(),z=U("p"),L=Me("Trips "),I=Me(E),O=ie(),K=Me(B),H=Me(":"),q=ie(),ue(J.$$.fragment),fe=ie(),Ee=U("hr"),ee=ie(),ze.c(),he(x,"type","checkbox"),he(x,"role","switch"),he(e,"slot","sidebar")},m(Ie,ct){W(Ie,e,ct),ae(t,e,null),F(e,n),F(e,i),F(i,o),F(i,s),F(i,h),F(e,p),F(e,g),F(g,_),F(g,x),x.checked=r[1],F(g,C),F(e,T),F(e,z),F(z,L),F(z,I),F(z,O),F(z,K),F(z,H),F(e,q),ae(J,e,null),F(e,fe),F(e,Ee),F(e,ee),ze.m(e,null),oe=!0,xe||(me=Mt(x,"change",r[9]),xe=!0)},p(Ie,ct){(!oe||ct&1)&&u!==(u=Ie[0].features.length.toLocaleString()+"")&&kt(s,u),ct&2&&(x.checked=Ie[1]),(!oe||ct&2)&&E!==(E=Ie[1]?"from":"to")&&kt(I,E),(!oe||ct&8)&&B!==(B=Ie[3]==null?"each zone":"this zone")&&kt(K,B);const Xe={};ct&32&&(Xe.labels={limits:Ie[5]}),J.$set(Xe),Ue===(Ue=tt(Ie))&&ze?ze.p(Ie,ct):(ze.d(1),ze=Ue(Ie),ze&&(ze.c(),ze.m(e,null)))},i(Ie){oe||(N(t.$$.fragment,Ie),N(J.$$.fragment,Ie),oe=!0)},o(Ie){V(t.$$.fragment,Ie),V(J.$$.fragment,Ie),oe=!1},d(Ie){Ie&&G(e),le(t),le(J),ze.d(),xe=!1,me()}}}function T8(r){let e,t,n,i,o;const u=[_n("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Gn(.5,.1)}},{manageHoverState:!0}];function s(_){r[8](_)}let h={};for(let _=0;_<u.length;_+=1)h=zt(h,u[_]);r[2]!==void 0&&(h.hovered=r[2]),e=new Yi({props:h}),dn.push(()=>Dn(e,"hovered",s));const p=[_n("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let _=0;_<p.length;_+=1)g=zt(g,p[_]);return i=new ur({props:g}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(_,x){ae(e,_,x),W(_,n,x),ae(i,_,x),o=!0},p(_,x){const C=x&16?In(u,[u[0],{paint:{"fill-color":_[4],"fill-opacity":Gn(.5,.1)}},u[2]]):{};!t&&x&4&&(t=!0,C.hovered=_[2],zn(()=>t=!1)),e.$set(C);const T={};i.$set(T)},i(_){o||(N(e.$$.fragment,_),N(i.$$.fragment,_),o=!0)},o(_){V(e.$$.fragment,_),V(i.$$.fragment,_),o=!1},d(_){_&&G(n),le(e,_),le(i,_)}}}function M8(r){let e,t,n;return t=new _r({props:{data:r[0],generateId:!0,$$slots:{default:[T8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","map")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function E8(r){let e,t;return e=new So({props:{$$slots:{map:[M8],sidebar:[C8],top:[A8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function L8(r,e,t){let n,i,o,u,s,h;st(r,tr,L=>t(7,s=L)),st(r,kr,L=>t(10,h=L));let p=eo();try{p=h.getDemandModel()}catch{window.alert("No demand model for this area"),ln(tr,s={mode:"pick-neighbourhood"},s)}let g=!1,_=null;function x(L,E){if(L==null){let I=E?"sum_to":"sum_from",O=Math.max(...p.features.map(K=>K.properties[I])),B=C(O);return[B,Bi(["get",I],B,Fd)]}else{let I=E?"counts_to":"counts_from",O=[...p.features.map(H=>H.properties[I][L])],B=Math.max(...O),K=C(B);return[K,Bi(["at",["id"],["literal",O]],K,Fd)]}}function C(L){let E=Fd.length+1;return Array.from(Array(E).keys()).map(I=>Math.round(L/(E-1)*I))}function T(L){_=L,t(2,_)}function z(){g=this.checked,t(1,g)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=_==null?null:_.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=x(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,_)))},[p,g,_,n,u,o,i,s,T,z]}class I8 extends Lt{constructor(e){super(),Et(this,e,L8,E8,St,{})}}function P8(r){let e,t,n,i,o,u,s,h,p,g,_=yr(r[4].mode)+"",x,C;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),x=Me(_),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(T,z){W(T,e,z),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),F(g,x),C=!0},p(T,z){(!C||z&16)&&_!==(_=yr(T[4].mode)+"")&&kt(x,_)},i(T){C||(N(o.$$.fragment,T),N(h.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(h.$$.fragment,T),C=!1},d(T){T&&G(e),le(o),le(h)}}}function jv(r){let e,t,n,i,o,u,s;function h(g){r[7](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new fp({props:p}),dn.push(()=>Dn(n,"idx",h)),{c(){e=U("button"),e.textContent="Pick another intersection",t=ie(),ue(n.$$.fragment),he(e,"class","secondary")},m(g,_){W(g,e,_),W(g,t,_),ae(n,g,_),o=!0,u||(s=Mt(e,"click",r[6]),u=!0)},p(g,_){const x={};_&2&&(x.list=g[1].features),!i&&_&4&&(i=!0,x.idx=g[2],zn(()=>i=!1)),n.$set(x)},i(g){o||(N(n.$$.fragment,g),o=!0)},o(g){V(n.$$.fragment,g),o=!1},d(g){g&&(G(e),G(t)),le(n,g),u=!1,s()}}}function Uv(r){let e,t;return{c(){e=U("a"),t=Me("Open OSM"),he(e,"href",r[0]),he(e,"target","_blank")},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&1&&he(e,"href",n[0])},d(n){n&&G(e)}}}function z8(r){let e,t,n,i,o,u,s;t=new Us({props:{mode:{mode:"pick-neighbourhood"}}});let h=r[1].features.length>0&&jv(r),p=r[0]&&Uv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=ie(),h&&h.c(),u=ie(),p&&p.c(),he(e,"slot","sidebar")},m(g,_){W(g,e,_),ae(t,e,null),F(e,n),F(e,i),F(e,o),h&&h.m(e,null),F(e,u),p&&p.m(e,null),s=!0},p(g,_){g[1].features.length>0?h?(h.p(g,_),_&2&&N(h,1)):(h=jv(g),h.c(),N(h,1),h.m(e,u)):h&&(Kt(),V(h,1,1,()=>{h=null}),Jt()),g[0]?p?p.p(g,_):(p=Uv(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){s||(N(t.$$.fragment,g),N(h),s=!0)},o(g){V(t.$$.fragment,g),V(h),s=!1},d(g){g&&G(e),le(t),h&&h.d(),p&&p.d()}}}function D8(r){let e,t;const n=[_n("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),e.$on("click",r[5]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function R8(r){let e,t,n,i;const o=[_n("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new Yi({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&4?In(s,[s[0],{filter:["==",["id"],p[2]]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function B8(r){let e,t,n,i,o;return t=new _r({props:{data:mr(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[D8]},$$scope:{ctx:r}}}),i=new _r({props:{data:r[1],generateId:!0,$$slots:{default:[R8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),he(e,"slot","map")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),ae(i,e,null),o=!0},p(u,s){const h={};s&8&&(h.data=mr(u[3]).getAllIntersections()),s&256&&(h.$$scope={dirty:s,ctx:u}),t.$set(h);const p={};s&2&&(p.data=u[1]),s&260&&(p.$$scope={dirty:s,ctx:u}),i.$set(p)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&G(e),le(t),le(i)}}}function F8(r){let e,t;return e=new So({props:{$$slots:{map:[B8],sidebar:[z8],top:[P8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function O8(r,e,t){let n,i;st(r,kr,_=>t(3,n=_)),st(r,tr,_=>t(4,i=_));let o=null,u=eo(),s=0;function h(_){t(0,o=_.detail.features[0].properties.osm),t(1,u=n.getMovements(_.detail.features[0].id)),t(2,s=0)}const p=()=>t(1,u=eo());function g(_){s=_,t(2,s)}return[o,u,s,n,i,h,p,g]}class $8 extends Lt{constructor(e){super(),Et(this,e,O8,F8,St,{})}}function N8(r){let e,t,n,i;const o=[_n("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":Vd(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new Yi({props:u});const s=[_n("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Cd(1),"icon-offset":Vv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":Vd(),"icon-halo-color":"black","icon-opacity":qv(),"icon-halo-width":Cd(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new nc({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,[g]){const _=g&1?In(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(_);const x=g&2?In(s,[s[0],s[1],g&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Cd(1),"icon-offset":Vv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},g&0&&{paint:{"icon-color":Vd(),"icon-halo-color":"black","icon-opacity":qv(),"icon-halo-width":Cd(1.5),"icon-halo-blur":0}},s[4],s[5]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function Cd(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function Vv(r){return[0,-50*r]}function qv(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function j8(r,e,t){let n,i;return st(r,Kd,o=>t(0,n=o)),st(r,Km,o=>t(1,i=o)),[n,i]}class gp extends Lt{constructor(e){super(),Et(this,e,j8,N8,St,{})}}function U8(r){let e,t;const n=[_n("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Yi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class _p extends Lt{constructor(e){super(),Et(this,e,null,U8,St,{})}}const V8=r=>({}),Hv=r=>({}),q8=r=>({}),Gv=r=>({});function Wv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Gv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,q8):xn(i[10]),Gv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function H8(r){let e,t,n=r[0]&&Wv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Wv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function Zv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Hv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,V8):xn(i[10]),Hv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function G8(r){let e,t,n=r[0]&&Zv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Zv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function W8(r){let e,t,n,i,o,u,s,h;const p=[_n("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let E=0;E<p.length;E+=1)g=zt(g,p[E]);e=new ur({props:g});const _=[_n("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Gn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let x={$$slots:{default:[H8]},$$scope:{ctx:r}};for(let E=0;E<_.length;E+=1)x=zt(x,_[E]);n=new ur({props:x}),n.$on("click",r[8]);const C=[_n("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let T={};for(let E=0;E<C.length;E+=1)T=zt(T,C[E]);o=new ur({props:T});const z=[_n("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Gn("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":Gn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let L={$$slots:{default:[G8]},$$scope:{ctx:r}};for(let E=0;E<z.length;E+=1)L=zt(L,z[E]);return s=new ur({props:L}),s.$on("click",r[9]),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(E,I){ae(e,E,I),W(E,t,I),ae(n,E,I),W(E,i,I),ae(o,E,I),W(E,u,I),ae(s,E,I),h=!0},p(E,[I]){const O=I&84?In(p,[p[0],p[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(O);const B=I&125?In(_,[_[0],_[1],I&124&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,0),"line-color":E[5](E[3],E[4].maxShortcuts),"line-opacity":Gn(1,.5)}},_[3],_[4],I&1&&{manageHoverState:E[0]},I&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};I&1025&&(B.$$scope={dirty:I,ctx:E}),n.$set(B);const K=I&84?In(C,[C[0],C[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,6),"line-color":"black"}},C[3]]):{};o.$set(K);const H=I&85?In(z,[z[0],z[1],I&84&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,4),"line-color":Gn("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":Gn(1,.5)}},z[3],z[4],I&1&&{manageHoverState:E[0]},I&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};I&1025&&(H.$$scope={dirty:I,ctx:E}),s.$set(H)},i(E){h||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),h=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),h=!1},d(E){E&&(G(t),G(i),G(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function Z8(r,e,t){let n,i;st(r,Jm,T=>t(2,n=T)),st(r,Kd,T=>t(3,i=T));let{$$slots:o={},$$scope:u}=e,s=Qf("neighbourhoodGj"),{interactive:h=!0}=e,{onClickLine:p=(T,z)=>{}}=e;function g(T,z){return T=="cells"?Vd():T=="edits"?Gn(["case",["get","edited"],HT,"white"],vo.mapFeature.hover.backgroundColor):T=="speeds"?Bi(["get","speed_mph"],g2,m2):z<=2?Gn("white","blue"):(console.assert(T=="shortcuts"),Gn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",z,"#A32015"],vo.mapFeature.hover.backgroundColor))}function _(T,z,L){return!T||z<=2?ia(L):["interpolate",["linear"],["get","shortcuts"],0,5+L,z,25+L]}const x=T=>h&&p(T.detail.features[0],T.detail.event.lngLat),C=T=>h&&p(T.detail.features[0],T.detail.event.lngLat);return r.$$set=T=>{"interactive"in T&&t(0,h=T.interactive),"onClickLine"in T&&t(1,p=T.onClickLine),"$$scope"in T&&t(10,u=T.$$scope)},[h,p,n,i,s,g,_,o,x,C,u]}class fh extends Lt{constructor(e){super(),Et(this,e,Z8,W8,St,{interactive:0,onClickLine:1})}}function X8(r){let e;const t=r[7].default,n=vn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&wn(n,t,i,i[9],e?bn(t,i[9],o,null):xn(i[9]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function K8(r){let e,t,n;const i=[_n("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(s){r[8](s)}let u={$$slots:{default:[X8]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=zt(u,i[s]);return r[1]!==void 0&&(u.hovered=r[1]),e=new nc({props:u}),dn.push(()=>Dn(e,"hovered",o)),e.$on("click",function(){da(r[0])&&r[0].apply(this,arguments)}),{c(){ue(e.$$.fragment)},m(s,h){ae(e,s,h),n=!0},p(s,h){r=s;const p=h&16?In(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};h&512&&(p.$$scope={dirty:h,ctx:r}),!t&&h&2&&(t=!0,p.hovered=r[1],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function J8(r){let e,t;const n=[_n("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Y8(r){let e,t,n,i;return e=new _r({props:{data:r[2],generateId:!0,$$slots:{default:[K8]},$$scope:{ctx:r}}}),n=new _r({props:{data:r[3],$$slots:{default:[J8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.data=o[2]),u&531&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const h={};u&8&&(h.data=o[3]),u&512&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function Q8(r,e,t){let n,i,o,u,s;st(r,kr,C=>t(5,o=C)),st(r,Xi,C=>t(6,u=C)),st(r,Xd,C=>t(4,s=C));let{$$slots:h={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,_=null;function x(C){_=C,t(1,_)}return r.$$set=C=>{"onClickTurnRestriction"in C&&t(0,g=C.onClickTurnRestriction),"$$scope"in C&&t(9,p=C.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=_==null?eo():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(_.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(_.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():eo())},[g,_,i,n,s,o,u,h,x,p]}class eP extends Lt{constructor(e){super(),Et(this,e,Q8,Y8,St,{onClickTurnRestriction:0})}}const tP=r=>({}),Xv=r=>({}),nP=r=>({}),Kv=r=>({});function rP(r){let e;const t=r[7]["modal-filter"],n=vn(t,r,r[8],Kv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,nP):xn(i[8]),Kv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function iP(r){let e,t,n,i;const o=[_n("modal-filters"),{interactive:r[2]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},{minzoom:Td},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[rP]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new nc({props:u}),e.$on("click",function(){da(r[0])&&r[0].apply(this,arguments)});const s=[_n("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Td},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new nc({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){r=p;const _=g&20?In(o,[o[0],g&4&&{interactive:r[2]},g&16&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Td},o[4],o[5]]):{};g&256&&(_.$$scope={dirty:g,ctx:r}),e.$set(_);const x=g&0?In(s,[s[0],s[1],{minzoom:Td},s[3],s[4]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function oP(r){let e;const t=r[7]["turn-restriction"],n=vn(t,r,r[8],Xv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,tP):xn(i[8]),Xv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function sP(r){let e,t,n,i;return e=new _r({props:{data:r[3],generateId:!0,$$slots:{default:[iP]},$$scope:{ctx:r}}}),n=new eP({props:{onClickTurnRestriction:r[1],$$slots:{default:[oP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&8&&(s.data=o[3]),u&277&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const h={};u&2&&(h.onClickTurnRestriction=o[1]),u&256&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}let Td=13;function aP(r,e,t){let n,i,o,u;st(r,kr,x=>t(5,i=x)),st(r,Xi,x=>t(6,o=x)),st(r,Xd,x=>t(4,u=x));let{$$slots:s={},$$scope:h}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e,{interactive:_}=e;return r.$$set=x=>{"onClickModalFilter"in x&&t(0,p=x.onClickModalFilter),"onClickTurnRestriction"in x&&t(1,g=x.onClickTurnRestriction),"interactive"in x&&t(2,_=x.interactive),"$$scope"in x&&t(8,h=x.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&t(3,n=o>0?i.renderModalFilters():eo())},[p,g,_,n,u,i,o,s,h]}class tl extends Lt{constructor(e){super(),Et(this,e,aP,sP,St,{onClickModalFilter:0,onClickTurnRestriction:1,interactive:2})}}function lP(r){let e,t;const n=[_n("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new nc({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class yp extends Lt{constructor(e){super(),Et(this,e,null,lP,St,{})}}function uP(r){let e;const t=r[3].default,n=vn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&wn(n,t,i,i[4],e?bn(t,i[4],o,null):xn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function cP(r){let e,t;return e=new _r({props:{data:r[0],generateId:!0,$$slots:{default:[uP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function fP(r,e,t){let n,i;st(r,kr,h=>t(2,i=h));let{$$slots:o={},$$scope:u}=e,{input:s=null}=e;return r.$$set=h=>{"input"in h&&t(1,s=h.input),"$$scope"in h&&t(4,u=h.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||i.renderNeighbourhood()),r.$$.dirty&1&&ip("neighbourhoodGj",n)},[n,s,i,o,u]}class hh extends Lt{constructor(e){super(),Et(this,e,fP,cP,St,{input:1})}}function Vd(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function hP(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T=yr(r[2].mode)+"",z,L;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Me(T),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(E,I){W(E,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,z),L=!0},p(E,I){(!L||I&4)&&T!==(T=yr(E[2].mode)+"")&&kt(z,T)},i(E){L||(N(o.$$.fragment,E),N(h.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(h.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(h),le(_)}}}function Jv(r){let e,t,n;return{c(){e=U("button"),e.textContent="Ⓧ",he(e,"class","close-btn svelte-khnvno")},m(i,o){W(i,e,o),t||(n=Mt(e,"click",r[5]),t=!0)},p:at,d(i){i&&G(e),t=!1,n()}}}function dP(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&G(e)}}}function pP(r){let e,t,n,i,o,u,s;e=new eh({props:{properties:r[0].feature.properties}});function h(g){r[6](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new fp({props:p}),dn.push(()=>Dn(o,"idx",h)),{c(){ue(e.$$.fragment),t=ie(),n=U("h5"),n.textContent="Turn restrictions:",i=ie(),ue(o.$$.fragment)},m(g,_){ae(e,g,_),W(g,t,_),W(g,n,_),W(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};_&1&&(x.properties=g[0].feature.properties),e.$set(x);const C={};_&1&&(C.list=g[0].movements.features),!u&&_&1&&(u=!0,C.idx=g[0].movementIdx,zn(()=>u=!1)),o.$set(C)},i(g){s||(N(e.$$.fragment,g),N(o.$$.fragment,g),s=!0)},o(g){V(e.$$.fragment,g),V(o.$$.fragment,g),s=!1},d(g){g&&(G(t),G(n),G(i)),le(e,g),le(o,g)}}}function mP(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T;t=new Us({props:{mode:{mode:"neighbourhood"}}});let z=r[0]&&Jv(r);const L=[pP,dP],E=[];function I(O,B){return O[0]?0:1}return x=I(r),C=E[x]=L[x](r),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("h4"),i.textContent="Roads",o=ie(),u=U("p"),u.textContent="Click a road to visit its OSM object.",s=ie(),h=U("div"),p=U("h4"),p.textContent="Intersections",g=ie(),z&&z.c(),_=ie(),C.c(),Ye(h,"display","flex"),Ye(h,"align-items","start"),Ye(h,"justify-content","space-between"),he(e,"slot","sidebar")},m(O,B){W(O,e,B),ae(t,e,null),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),F(e,h),F(h,p),F(h,g),z&&z.m(h,null),F(e,_),E[x].m(e,null),T=!0},p(O,B){O[0]?z?z.p(O,B):(z=Jv(O),z.c(),z.m(h,null)):z&&(z.d(1),z=null);let K=x;x=I(O),x===K?E[x].p(O,B):(Kt(),V(E[K],1,1,()=>{E[K]=null}),Jt(),C=E[x],C?C.p(O,B):(C=E[x]=L[x](O),C.c()),N(C,1),C.m(e,null))},i(O){T||(N(t.$$.fragment,O),N(C),T=!0)},o(O){V(t.$$.fragment,O),V(C),T=!1},d(O){O&&G(e),le(t),z&&z.d(),E[x].d()}}}function gP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function _P(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[gP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function vP(r){let e,t,n;return t=new mi({props:{openOn:"hover",$$slots:{default:[yP,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function bP(r){let e,t,n,i,o,u,s,h,p,g;e=new _p({}),n=new gp({}),o=new yp({});const _=[_n("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let x={$$slots:{default:[_P]},$$scope:{ctx:r}};for(let C=0;C<_.length;C+=1)x=zt(x,_[C]);return s=new $l({props:x}),p=new fh({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[vP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),h=ie(),ue(p.$$.fragment)},m(C,T){ae(e,C,T),W(C,t,T),ae(n,C,T),W(C,i,T),ae(o,C,T),W(C,u,T),ae(s,C,T),W(C,h,T),ae(p,C,T),g=!0},p(C,T){const z={};T&256&&(z.$$scope={dirty:T,ctx:C}),s.$set(z);const L={};T&256&&(L.$$scope={dirty:T,ctx:C}),p.$set(L)},i(C){g||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(s.$$.fragment,C),N(p.$$.fragment,C),g=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),V(s.$$.fragment,C),V(p.$$.fragment,C),g=!1},d(C){C&&(G(t),G(i),G(u),G(h)),le(e,C),le(n,C),le(o,C),le(s,C),le(p,C)}}}function wP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function xP(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[wP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function AP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kP(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[AP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function SP(r){var o,u,s;let e,t;const n=[_n("debug-intersections"),{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Gn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:s.intersection_id)??-1],.3,Gn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[kP]},$$scope:{ctx:r}};for(let h=0;h<n.length;h+=1)i=zt(i,n[h]);return e=new $l({props:i}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(h,p){ae(e,h,p),t=!0},p(h,p){var _,x,C;const g=p&1?In(n,[n[0],{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Gn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((C=(x=(_=h[0])==null?void 0:_.feature)==null?void 0:x.properties)==null?void 0:C.intersection_id)??-1],.3,Gn(0,.5)]}},n[2],n[3]]):{};p&256&&(g.$$scope={dirty:p,ctx:h}),e.$set(g)},i(h){t||(N(e.$$.fragment,h),t=!0)},o(h){V(e.$$.fragment,h),t=!1},d(h){le(e,h)}}}function Yv(r){let e,t;return e=new _r({props:{data:r[0].movements,generateId:!0,$$slots:{default:[CP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function CP(r){let e,t,n,i;const o=[_n("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let h={};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new Yi({props:h}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&1?In(s,[s[0],{filter:["==",["id"],p[0].movementIdx]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function TP(r){let e,t,n,i,o,u,s,h;t=new hh({props:{$$slots:{default:[bP]},$$scope:{ctx:r}}}),i=new tl({props:{interactive:!0,$$slots:{default:[xP]},$$scope:{ctx:r}}}),u=new _r({props:{data:mr(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[SP]},$$scope:{ctx:r}}});let p=r[0]&&Yv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),s=ie(),p&&p.c(),he(e,"slot","map")},m(g,_){W(g,e,_),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),ae(u,e,null),F(e,s),p&&p.m(e,null),h=!0},p(g,_){const x={};_&256&&(x.$$scope={dirty:_,ctx:g}),t.$set(x);const C={};_&256&&(C.$$scope={dirty:_,ctx:g}),i.$set(C);const T={};_&2&&(T.data=mr(g[1]).getAllIntersections()),_&257&&(T.$$scope={dirty:_,ctx:g}),u.$set(T),g[0]?p?(p.p(g,_),_&1&&N(p,1)):(p=Yv(g),p.c(),N(p,1),p.m(e,null)):p&&(Kt(),V(p,1,1,()=>{p=null}),Jt())},i(g){h||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(u.$$.fragment,g),N(p),h=!0)},o(g){V(t.$$.fragment,g),V(i.$$.fragment,g),V(u.$$.fragment,g),V(p),h=!1},d(g){g&&G(e),le(t),le(i),le(u),p&&p.d()}}}function MP(r){let e,t;return e=new So({props:{$$slots:{map:[TP],sidebar:[mP],top:[hP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function EP(r,e,t){let n,i;st(r,kr,g=>t(1,n=g)),st(r,tr,g=>t(2,i=g));let o=null;function u(g){let _=g.detail.features[0],x=n.getMovements(_.properties.intersection_id);t(0,o={feature:_,movements:x,movementIdx:0})}const s=(g,_)=>window.open(mr(g.properties).way,"_blank"),h=()=>t(0,o=null);function p(g){r.$$.not_equal(o.movementIdx,g)&&(o.movementIdx=g,t(0,o))}return[o,n,i,u,s,h,p]}class LP extends Lt{constructor(e){super(),Et(this,e,EP,MP,St,{})}}const IP="/ltn/assets/eraser-894c4bbc.svg",PP="/ltn/assets/paintbrush-511a1297.svg",Qv="/ltn/assets/one_way_left-9368d5dd.svg",zP="/ltn/assets/traffic_1-a90740ec.svg";var Do=63710088e-1,DP={centimeters:Do*100,centimetres:Do*100,degrees:360/(2*Math.PI),feet:Do*3.28084,inches:Do*39.37,kilometers:Do/1e3,kilometres:Do/1e3,meters:Do,metres:Do,miles:Do/1609.344,millimeters:Do*1e3,millimetres:Do*1e3,nauticalmiles:Do/1852,radians:1,yards:Do*1.0936};function RP(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Cg(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!eb(r[0])||!eb(r[1]))throw new Error("coordinates must contain numbers");return RP({type:"Point",coordinates:r},e,t)}function BP(r,e="kilometers"){const t=DP[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Tg(r){return r%(2*Math.PI)*180/Math.PI}function Pl(r){return r%360*Math.PI/180}function eb(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Mg(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function FP(r){return r.type==="Feature"?r.geometry:r}function Z2(r,e,t={}){if(t.final===!0)return OP(r,e);const n=Mg(r),i=Mg(e),o=Pl(n[0]),u=Pl(i[0]),s=Pl(n[1]),h=Pl(i[1]),p=Math.sin(u-o)*Math.cos(h),g=Math.cos(s)*Math.sin(h)-Math.sin(s)*Math.cos(h)*Math.cos(u-o);return Tg(Math.atan2(p,g))}function OP(r,e){let t=Z2(e,r);return t=(t+180)%360,t}function $P(r,e,t,n={}){const i=Mg(r),o=Pl(i[0]),u=Pl(i[1]),s=Pl(t),h=BP(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(h)+Math.cos(u)*Math.sin(h)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(h)*Math.cos(u),Math.cos(h)-Math.sin(u)*Math.sin(p)),_=Tg(g),x=Tg(p);return Cg([_,x],n.properties)}var Ro=63710088e-1,NP={centimeters:Ro*100,centimetres:Ro*100,degrees:360/(2*Math.PI),feet:Ro*3.28084,inches:Ro*39.37,kilometers:Ro/1e3,kilometres:Ro/1e3,meters:Ro,metres:Ro,miles:Ro/1609.344,millimeters:Ro*1e3,millimetres:Ro*1e3,nauticalmiles:Ro/1852,radians:1,yards:Ro*1.0936};function jP(r,e="kilometers"){const t=NP[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Md(r){return r%360*Math.PI/180}function tb(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function X2(r,e,t={}){var n=tb(r),i=tb(e),o=Md(i[1]-n[1]),u=Md(i[0]-n[0]),s=Md(n[1]),h=Md(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(h);return jP(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}var UP=X2;function VP(r,e,t={}){const i=FP(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const s=e-o;if(s){const h=Z2(i[u],i[u-1])-180;return $P(i[u],s,h,t)}else return Cg(i[u])}else o+=X2(i[u],i[u+1],t);return Cg(i[i.length-1])}var qP=VP;function HP(r){let e,t;const n=[_n("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function GP(r){let e,t;return e=new _r({props:{data:r[0],$$slots:{default:[HP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}let WP=50,ZP=100,XP=.01;function KP(r,e,t){let{paths:n}=e,i=h(),o=p(),u=_(),s=setInterval(x,ZP);ri(()=>clearInterval(s));function h(){return n.features.map(C=>1/C.properties.directness).reduce((C,T)=>C+T,0)}function p(){return n.features.length==0?[]:Array.from({length:WP},g)}function g(){let C=Math.random()*i,T=0;for(let[z,L]of n.features.entries())if(T+=1/L.properties.directness,C<T)return{idx:z,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function _(){return{type:"FeatureCollection",features:o.map(({idx:C,distance:T})=>qP(n.features[C],T,{units:"kilometers"}))}}function x(){for(let[C,T]of o.entries())T.distance+=XP,T.distance>=n.features[T.idx].properties.length_meters/1e3&&(o[C]=g());t(0,u=_())}return r.$$set=C=>{"paths"in C&&t(1,n=C.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=h(),o=p())},[u,n]}class JP extends Lt{constructor(e){super(),Et(this,e,KP,GP,St,{paths:1})}}class YP{constructor(e){Qn(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}const f_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==";function QP(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=ie(),n=U("img"),o=Me(`
    Add diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"margin-top","-12px"),he(e,"class","icon"),Sr(n.src,i=f_)||he(n,"src",i),he(n,"alt","Add diagonal filter"),Ye(n,"transform","rotate(135deg)"),he(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},p:at,d(u){u&&(G(e),G(t),G(n),G(o))}}}function ez(r){let e;function t(o,u){return o[0].hasRotatedFilter?nz:tz}let n=t(r),i=n(r);return{c(){i.c(),e=nr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i.d(o)}}}function tz(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="↻",t=ie(),n=U("img"),o=Me(`
      Rotate diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"padding-bottom","4px"),he(e,"class","icon"),Sr(n.src,i=f_)||he(n,"src",i),he(n,"alt","Rotate diagonal filter"),Ye(n,"transform","rotate(45deg)"),he(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(G(e),G(t),G(n),G(o))}}}function nz(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="❌",t=ie(),n=U("img"),o=Me(`
      Delete diagonal filter`),he(e,"class","icon"),Sr(n.src,i=f_)||he(n,"src",i),he(n,"alt","Remove diagonal filter"),Ye(n,"transform","rotate(45deg)"),he(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(G(e),G(t),G(n),G(o))}}}function rz(r){let e;function t(o,u){return o[0].filter?ez:QP}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),Ye(e,"display","flex"),Ye(e,"align-items","center")},m(o,u){W(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:at,o:at,d(o){o&&G(e),i.d()}}}function iz(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class oz extends Lt{constructor(e){super(),Et(this,e,iz,rz,St,{intersection:0})}}function sz(r){let e,t;return e=new oz({props:{intersection:r[2](r[6])}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function az(r){let e,t;return e=new Fw({props:{openOn:"hover",$$slots:{default:[sz,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function lz(r){let e,t;const n=[_n("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-opacity":Gn(0,.5),"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Gn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[az]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),e.$on("click",r[4]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&2?In(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function uz(r,e,t){let{neighbourhood:n=Qf("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new YP(g)}function s(p){return u(p[0].id)}const h=p=>i(s(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,s,n,h]}class cz extends Lt{constructor(e){super(),Et(this,e,uz,lz,St,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function nb(r,e,t){const n=r.slice();return n[6]=e[t],n}function rb(r){let e,t,n,i,o,u,s=r[6].label+"",h,p,g,_,x;function C(){return r[3](r[6])}return{c(){e=U("button"),t=U("img"),i=ie(),o=U("br"),u=ie(),h=Me(s),p=ie(),Sr(t.src,n=r[6].iconURL)||he(t,"src",n),he(t,"width","80"),he(t,"alt",r[6].label),he(e,"class","outline"),Ye(e,"width","100%"),e.disabled=g=r[1]==r[6].filterType},m(T,z){W(T,e,z),F(e,t),F(e,i),F(e,o),F(e,u),F(e,h),F(e,p),_||(x=Mt(e,"click",C),_=!0)},p(T,z){r=T,z&2&&g!==(g=r[1]==r[6].filterType)&&(e.disabled=g)},d(T){T&&G(e),_=!1,x()}}}function fz(r){let e,t,n,i,o,u,s,h,p,g,_,x,C=r[2].description+"",T,z,L,E,I,O,B=On(Ri.allTypes),K=[];for(let H=0;H<B.length;H+=1)K[H]=rb(nb(r,B,H));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=ie(),n=U("table"),i=U("tr"),o=U("td");for(let H=0;H<K.length;H+=1)K[H].c();u=ie(),s=U("td"),h=U("img"),_=ie(),x=U("p"),T=Me(C),z=ie(),L=U("center"),E=U("button"),E.textContent="Confirm",Sr(h.src,p=r[2].largeImageURL)||he(h,"src",p),he(h,"height","300"),he(h,"alt",g=r[2].label)},m(H,q){W(H,e,q),W(H,t,q),W(H,n,q),F(n,i),F(i,o);for(let J=0;J<K.length;J+=1)K[J]&&K[J].m(o,null);F(i,u),F(i,s),F(s,h),F(s,_),F(s,x),F(x,T),W(H,z,q),W(H,L,q),F(L,E),I||(O=Mt(E,"click",r[4]),I=!0)},p(H,q){if(q&2){B=On(Ri.allTypes);let J;for(J=0;J<B.length;J+=1){const fe=nb(H,B,J);K[J]?K[J].p(fe,q):(K[J]=rb(fe),K[J].c(),K[J].m(o,null))}for(;J<K.length;J+=1)K[J].d(1);K.length=B.length}q&4&&!Sr(h.src,p=H[2].largeImageURL)&&he(h,"src",p),q&4&&g!==(g=H[2].label)&&he(h,"alt",g),q&4&&C!==(C=H[2].description+"")&&kt(T,C)},d(H){H&&(G(e),G(t),G(n),G(z),G(L)),_i(K,H),I=!1,O()}}}function hz(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[fz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Rg({props:o}),dn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&519&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.show=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function dz(r,e,t){let n,i;st(r,Xm,p=>t(1,i=p));let{show:o}=e;const u=p=>ln(Xm,i=p.filterType,i),s=()=>t(0,o=!1);function h(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=Ri.allTypes.find(p=>p.filterType==i))},[o,i,n,u,s,h]}class pz extends Lt{constructor(e){super(),Et(this,e,dz,hz,St,{show:0})}}function ib(r){let e,t;return e=new _r({props:{data:r[0],$$slots:{default:[mz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function mz(r){let e,t;const n=[_n("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function gz(r){let e,t,n=r[0]&&ib(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=ib(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function _z(r,e,t){let{map:n}=e,i=null;const o=js();n.on("dragstart",u),n.on("mousemove",s),n.on("mouseup",h),ri(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",s),n.off("mouseup",h)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(p){if(i){let g=p.lngLat.toArray(),_=i.geometry.coordinates.at(-1);if(_&&UP(_,g)*1e3<.5)return;i.geometry.coordinates.push(g),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function h(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class K2 extends Lt{constructor(e){super(),Et(this,e,_z,gz,St,{map:1})}}function yz(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function ob(r){let e,t,n;return t=new Fn({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[vz]},$$scope:{ctx:r}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function vz(r){let e;return{c(){e=Me("Debug")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function bz(r){let e,t,n,i,o,u,s,h,p,g,_=yr(r[14].mode)+"",x,C,T,z,L,E,I,O,B,K,H,q,J,fe,Ee,ee,oe,xe,me,tt,Ue,ze;o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),T=new i_({props:{$$slots:{default:[yz]},$$scope:{ctx:r}}}),O=new Fn({props:{mode:{mode:"view-shortcuts"}}}),H=new Fn({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),fe=new Fn({props:{mode:{mode:"predict-impact",prevMode:"neighbourhood"}}}),oe=new Fn({props:{mode:{mode:"impact-one-destination"}}}),tt=new Fn({props:{mode:{mode:"set-boundary",name:mr(r[6]).properties.name,existing:mr(r[6])}}});let Ie=r[15]&&ob(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),x=Me(_),C=ie(),ue(T.$$.fragment),z=ie(),L=U("nav"),E=U("ul"),I=U("li"),ue(O.$$.fragment),B=ie(),K=U("li"),ue(H.$$.fragment),q=ie(),J=U("li"),ue(fe.$$.fragment),Ee=ie(),ee=U("li"),ue(oe.$$.fragment),xe=ie(),me=U("li"),ue(tt.$$.fragment),Ue=ie(),Ie&&Ie.c(),he(t,"aria-label","breadcrumb"),he(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(ct,Xe){W(ct,e,Xe),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),F(g,x),F(g,C),ae(T,g,null),F(e,z),F(e,L),F(L,E),F(E,I),ae(O,I,null),F(E,B),F(E,K),ae(H,K,null),F(E,q),F(E,J),ae(fe,J,null),F(E,Ee),F(E,ee),ae(oe,ee,null),F(E,xe),F(E,me),ae(tt,me,null),F(E,Ue),Ie&&Ie.m(E,null),ze=!0},p(ct,Xe){(!ze||Xe[0]&16384)&&_!==(_=yr(ct[14].mode)+"")&&kt(x,_);const lt={};Xe[1]&524288&&(lt.$$scope={dirty:Xe,ctx:ct}),T.$set(lt);const pt={};Xe[0]&64&&(pt.mode={mode:"set-boundary",name:mr(ct[6]).properties.name,existing:mr(ct[6])}),tt.$set(pt),ct[15]?Ie?Xe[0]&32768&&N(Ie,1):(Ie=ob(ct),Ie.c(),N(Ie,1),Ie.m(E,null)):Ie&&(Kt(),V(Ie,1,1,()=>{Ie=null}),Jt())},i(ct){ze||(N(o.$$.fragment,ct),N(h.$$.fragment,ct),N(T.$$.fragment,ct),N(O.$$.fragment,ct),N(H.$$.fragment,ct),N(fe.$$.fragment,ct),N(oe.$$.fragment,ct),N(tt.$$.fragment,ct),N(Ie),ze=!0)},o(ct){V(o.$$.fragment,ct),V(h.$$.fragment,ct),V(T.$$.fragment,ct),V(O.$$.fragment,ct),V(H.$$.fragment,ct),V(fe.$$.fragment,ct),V(oe.$$.fragment,ct),V(tt.$$.fragment,ct),V(Ie),ze=!1},d(ct){ct&&G(e),le(o),le(h),le(T),le(O),le(H),le(fe),le(oe),le(tt),Ie&&Ie.d()}}}function wz(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,fe,Ee,ee;return g=new Mw({}),L=new Tw({}),H=new N3({}),{c(){e=U("h3"),e.textContent="Reclassify main roads",t=ie(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=ie(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`,u=ie(),s=U("div"),h=U("button"),p=U("div"),ue(g.$$.fragment),_=ie(),x=U("span"),x.textContent="Toggle segment or pan map",C=ie(),T=U("button"),z=U("div"),ue(L.$$.fragment),E=ie(),I=U("span"),I.textContent="Mark as main along a line",O=ie(),B=U("button"),K=U("div"),ue(H.$$.fragment),q=ie(),J=U("span"),J.textContent="Erase main classification",Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","8px"),he(h,"data-tippy-content","Click a road to reclassify it"),Wt(h,"active",!r[0].freehand),Wt(h,"outline",r[0].freehand),Ye(z,"display","flex"),Ye(z,"align-items","center"),Ye(z,"gap","8px"),he(T,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Wt(T,"active",r[0].freehand&&r[0].isMain),Wt(T,"outline",!(r[0].freehand&&r[0].isMain)),Ye(K,"display","flex"),Ye(K,"align-items","center"),Ye(K,"gap","8px"),he(B,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Wt(B,"active",r[0].freehand&&!r[0].isMain),Wt(B,"outline",!(r[0].freehand&&!r[0].isMain)),he(s,"class","classification-buttons svelte-b4nchc"),Ye(s,"display","flex"),Ye(s,"flex-direction","column"),Ye(s,"gap","8px"),Ye(s,"justify-content","left")},m(oe,xe){W(oe,e,xe),W(oe,t,xe),W(oe,n,xe),W(oe,i,xe),W(oe,o,xe),W(oe,u,xe),W(oe,s,xe),F(s,h),F(h,p),ae(g,p,null),F(p,_),F(p,x),F(s,C),F(s,T),F(T,z),ae(L,z,null),F(z,E),F(z,I),F(s,O),F(s,B),F(B,K),ae(H,K,null),F(K,q),F(K,J),fe=!0,Ee||(ee=[Mt(h,"click",r[40]),Mt(T,"click",r[41]),Mt(B,"click",r[42])],Ee=!0)},p(oe,xe){(!fe||xe[0]&1)&&Wt(h,"active",!oe[0].freehand),(!fe||xe[0]&1)&&Wt(h,"outline",oe[0].freehand),(!fe||xe[0]&1)&&Wt(T,"active",oe[0].freehand&&oe[0].isMain),(!fe||xe[0]&1)&&Wt(T,"outline",!(oe[0].freehand&&oe[0].isMain)),(!fe||xe[0]&1)&&Wt(B,"active",oe[0].freehand&&!oe[0].isMain),(!fe||xe[0]&1)&&Wt(B,"outline",!(oe[0].freehand&&!oe[0].isMain))},i(oe){fe||(N(g.$$.fragment,oe),N(L.$$.fragment,oe),N(H.$$.fragment,oe),fe=!0)},o(oe){V(g.$$.fragment,oe),V(L.$$.fragment,oe),V(H.$$.fragment,oe),fe=!1},d(oe){oe&&(G(e),G(t),G(n),G(i),G(o),G(u),G(s)),le(g),le(L),le(H),Ee=!1,cr(ee)}}}function xz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Restrict turns",t=ie(),n=U("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:at,i:at,o:at,d(i){i&&(G(e),G(t),G(n))}}}function Az(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Toggle one-way",t=ie(),n=U("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:at,i:at,o:at,d(i){i&&(G(e),G(t),G(n))}}}function kz(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I;function O(K){r[36](K)}let B={};return r[3]!==void 0&&(B.show=r[3]),o=new pz({props:B}),dn.push(()=>Dn(o,"show",O)),C=new Tw({}),{c(){e=U("h3"),e.textContent="Add modal filter",t=ie(),n=U("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=ie(),ue(o.$$.fragment),s=ie(),h=U("div"),p=U("button"),p.textContent="Change modal filter type",g=ie(),_=U("button"),x=U("div"),ue(C.$$.fragment),T=ie(),z=U("span"),z.textContent="Add along a line",he(p,"class","outline"),Ye(x,"display","flex"),Ye(x,"align-items","center"),Ye(x,"gap","8px"),he(_,"data-tippy-content","Add many modal filters along a line"),Wt(_,"active",r[0].freehand),Wt(_,"outline",!r[0].freehand),Ye(h,"display","flex"),Ye(h,"gap","8px"),Ye(h,"align-items","leading"),Ye(h,"flex-direction","column"),Ye(h,"width","fit-content")},m(K,H){W(K,e,H),W(K,t,H),W(K,n,H),W(K,i,H),ae(o,K,H),W(K,s,H),W(K,h,H),F(h,p),F(h,g),F(h,_),F(_,x),ae(C,x,null),F(x,T),F(x,z),L=!0,E||(I=[Mt(p,"click",r[37]),Mt(_,"click",function(){da(r[0].freehand?r[38]:r[39])&&(r[0].freehand?r[38]:r[39]).apply(this,arguments)})],E=!0)},p(K,H){r=K;const q={};!u&&H[0]&8&&(u=!0,q.show=r[3],zn(()=>u=!1)),o.$set(q),(!L||H[0]&1)&&Wt(_,"active",r[0].freehand),(!L||H[0]&1)&&Wt(_,"outline",!r[0].freehand)},i(K){L||(N(o.$$.fragment,K),N(C.$$.fragment,K),L=!0)},o(K){V(o.$$.fragment,K),V(C.$$.fragment,K),L=!1},d(K){K&&(G(e),G(t),G(n),G(i),G(s),G(h)),le(o,K),le(C),E=!1,cr(I)}}}function sb(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function ab(r){let e,t;return e=new ko({props:{colorScale:m2,labels:{limits:g2}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Sz(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,fe,Ee,ee,oe,xe,me,tt,Ue,ze,Ie,ct,Xe,lt,pt,_t,He,gt,Pt,jt,un,nn,rn,pn,yn,qe,Ge,At,nt,de,cn,Ke,ut,Gt,Jn,Zn,fr,Cr,Tr,xi,Un,xt,zr,br;I=new B4({}),q=new T4({});const Fi=[kz,Az,xz,wz],$n=[];function Fe(Rt,Qt){return Rt[0].kind=="filter"?0:Rt[0].kind=="oneway"?1:Rt[0].kind=="turn_restriction"?2:Rt[0].kind=="main-roads"?3:-1}~(oe=Fe(r))&&(xe=$n[oe]=Fi[oe](r));let yt=r[8]>0&&sb(),bt=r[13]=="speeds"&&ab();return Un=new q2({props:{neighbourhoodBoundary:mr(r[6])}}),{c(){e=U("div"),t=U("h2"),t.textContent="Editing tools",n=ie(),i=U("div"),o=U("div"),u=U("button"),s=U("img"),p=ie(),g=U("button"),g.innerHTML=`<div style="height: 100%; width: 100%; position: relative;"><img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${Qv}" alt="Reverse directions"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${Qv}" alt="Reverse directions"/></div>`,_=ie(),x=U("button"),x.innerHTML=`<img src="${Dg}" alt="Restrict turns"/>`,C=ie(),T=U("button"),T.innerHTML=`<img src="${zP}" alt="Change main/minor roads"/>`,z=ie(),L=U("div"),E=U("button"),ue(I.$$.fragment),K=ie(),H=U("button"),ue(q.$$.fragment),Ee=ie(),ee=U("div"),xe&&xe.c(),me=ie(),yt&&yt.c(),tt=ie(),Ue=U("h2"),Ue.textContent="Map style",ze=ie(),Ie=U("label"),ct=U("input"),Xe=Me(`
      Animate shortcuts`),lt=U("span"),pt=Me("1"),_t=ie(),He=U("label"),gt=U("input"),Pt=Me(`
      Show entries into cells`),jt=U("span"),un=Me("2"),nn=ie(),rn=U("label"),pn=U("input"),yn=Me(`
      Road thickness depends on shortcuts`),qe=U("span"),Ge=Me("1"),At=ie(),nt=U("label"),de=U("span"),de.textContent="Draw roads:",cn=ie(),Ke=U("select"),ut=U("option"),ut.textContent="Worst shortcuts",Gt=U("option"),Gt.textContent="Cell",Jn=U("option"),Jn.textContent="Edits (either filter or direction)",Zn=U("option"),Zn.textContent="Speed limit",fr=ie(),bt&&bt.c(),Cr=ie(),Tr=U("h2"),Tr.textContent="Neighbourhood stats",xi=ie(),ue(Un.$$.fragment),Sr(s.src,h=mr(Ri.getFilter(r[9])).iconURL)||he(s,"src",h),he(s,"alt","Add a modal filter"),he(u,"class","icon-btn"),he(u,"data-tippy-content","Add a modal filter (hotkey 1)"),Wt(u,"active",r[0].kind=="filter"),he(g,"class","icon-btn"),he(g,"data-tippy-content","Toggle one-way (hotkey 2)"),Wt(g,"active",r[0].kind=="oneway"),he(x,"class","icon-btn"),he(x,"data-tippy-content","Restrict turns (hotkey 3)"),Wt(x,"active",r[0].kind=="turn_restriction"),he(T,"class","icon-btn"),he(T,"data-tippy-content","Reclassify main roads (hotkey 4)"),Wt(T,"active",r[0].kind=="main-roads"),Ye(o,"height","50px"),Ye(o,"display","flex"),Ye(o,"justify-content","left"),Ye(o,"gap","6px"),he(E,"class","outline icon-btn"),E.disabled=O=r[4]==0,he(E,"data-tippy-content",B=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),he(H,"class","outline icon-btn"),H.disabled=J=r[5]==0,he(H,"data-tippy-content",fe=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),Ye(L,"height","50px"),Ye(L,"display","flex"),Ye(L,"justify-content","right"),Ye(L,"gap","6px"),he(i,"class","tool-palette"),Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),Ye(i,"flex-wrap","wrap"),Ye(i,"gap","6px"),Ye(ee,"min-height","200px"),Ye(ee,"padding-bottom","16px"),Ye(ee,"border-bottom","solid var(--pico-muted-border-color) 1px"),he(ct,"type","checkbox"),he(lt,"class","footnote-ref svelte-b4nchc"),he(lt,"data-tippy-content",cb),he(gt,"type","checkbox"),he(jt,"class","footnote-ref svelte-b4nchc"),he(jt,"data-tippy-content",Gz),he(pn,"type","checkbox"),he(qe,"class","footnote-ref svelte-b4nchc"),he(qe,"data-tippy-content",cb),Ye(de,"text-wrap","nowrap"),ut.__value="shortcuts",Wn(ut,ut.__value),Gt.__value="cells",Wn(Gt,Gt.__value),Jn.__value="edits",Wn(Jn,Jn.__value),Zn.__value="speeds",Wn(Zn,Zn.__value),Ye(Ke,"margin","0"),Ye(Ke,"padding","8px"),Ye(Ke,"width","auto"),r[13]===void 0&&ys(()=>r[46].call(Ke)),Ye(nt,"display","flex"),Ye(nt,"align-items","center"),Ye(nt,"gap","8px"),Ye(nt,"flex-wrap","wrap"),he(e,"slot","sidebar")},m(Rt,Qt){W(Rt,e,Qt),F(e,t),F(e,n),F(e,i),F(i,o),F(o,u),F(u,s),F(o,p),F(o,g),F(o,_),F(o,x),F(o,C),F(o,T),F(i,z),F(i,L),F(L,E),ae(I,E,null),F(L,K),F(L,H),ae(q,H,null),F(e,Ee),F(e,ee),~oe&&$n[oe].m(ee,null),F(e,me),yt&&yt.m(e,null),F(e,tt),F(e,Ue),F(e,ze),F(e,Ie),F(Ie,ct),ct.checked=r[10],F(Ie,Xe),F(Ie,lt),F(lt,pt),F(e,_t),F(e,He),F(He,gt),gt.checked=r[11],F(He,Pt),F(He,jt),F(jt,un),F(e,nn),F(e,rn),F(rn,pn),pn.checked=r[12],F(rn,yn),F(rn,qe),F(qe,Ge),F(e,At),F(e,nt),F(nt,de),F(nt,cn),F(nt,Ke),F(Ke,ut),F(Ke,Gt),F(Ke,Jn),F(Ke,Zn),Ki(Ke,r[13],!0),F(e,fr),bt&&bt.m(e,null),F(e,Cr),F(e,Tr),F(e,xi),ae(Un,e,null),xt=!0,zr||(br=[Mt(u,"click",r[32]),Mt(g,"click",r[33]),Mt(x,"click",r[34]),Mt(T,"click",r[35]),Mt(E,"click",r[24]),Mt(H,"click",r[25]),Mt(ct,"change",r[43]),Mt(gt,"change",r[44]),Mt(pn,"change",r[45]),Mt(Ke,"change",r[46])],zr=!0)},p(Rt,Qt){(!xt||Qt[0]&512&&!Sr(s.src,h=mr(Ri.getFilter(Rt[9])).iconURL))&&he(s,"src",h),(!xt||Qt[0]&1)&&Wt(u,"active",Rt[0].kind=="filter"),(!xt||Qt[0]&1)&&Wt(g,"active",Rt[0].kind=="oneway"),(!xt||Qt[0]&1)&&Wt(x,"active",Rt[0].kind=="turn_restriction"),(!xt||Qt[0]&1)&&Wt(T,"active",Rt[0].kind=="main-roads"),(!xt||Qt[0]&16&&O!==(O=Rt[4]==0))&&(E.disabled=O),(!xt||Qt[0]&16&&B!==(B=Rt[4]==0?"Undo Ctrl+Z":`Undo (${Rt[4]}) Ctrl+Z`))&&he(E,"data-tippy-content",B),(!xt||Qt[0]&32&&J!==(J=Rt[5]==0))&&(H.disabled=J),(!xt||Qt[0]&32&&fe!==(fe=Rt[5]==0?"Redo Ctrl+Y":`Redo (${Rt[5]}) Ctrl+Y`))&&he(H,"data-tippy-content",fe);let Yt=oe;oe=Fe(Rt),oe===Yt?~oe&&$n[oe].p(Rt,Qt):(xe&&(Kt(),V($n[Yt],1,1,()=>{$n[Yt]=null}),Jt()),~oe?(xe=$n[oe],xe?xe.p(Rt,Qt):(xe=$n[oe]=Fi[oe](Rt),xe.c()),N(xe,1),xe.m(ee,null)):xe=null),Rt[8]>0?yt||(yt=sb(),yt.c(),yt.m(e,tt)):yt&&(yt.d(1),yt=null),Qt[0]&1024&&(ct.checked=Rt[10]),Qt[0]&2048&&(gt.checked=Rt[11]),Qt[0]&4096&&(pn.checked=Rt[12]),Qt[0]&8192&&Ki(Ke,Rt[13]),Rt[13]=="speeds"?bt?Qt[0]&8192&&N(bt,1):(bt=ab(),bt.c(),N(bt,1),bt.m(e,Cr)):bt&&(Kt(),V(bt,1,1,()=>{bt=null}),Jt());const vr={};Qt[0]&64&&(vr.neighbourhoodBoundary=mr(Rt[6])),Un.$set(vr)},i(Rt){xt||(N(I.$$.fragment,Rt),N(q.$$.fragment,Rt),N(xe),N(bt),N(Un.$$.fragment,Rt),xt=!0)},o(Rt){V(I.$$.fragment,Rt),V(q.$$.fragment,Rt),V(xe),V(bt),V(Un.$$.fragment,Rt),xt=!1},d(Rt){Rt&&G(e),le(I),le(q),~oe&&$n[oe].d(),yt&&yt.d(),bt&&bt.d(),le(Un),zr=!1,cr(br)}}}function Cz(r){let e,t,n=(r[49].name??"unnamed road")+"",i,o,u=Math.round(r[49].speed_mph)+"",s,h;return{c(){e=U("p"),t=Me("Main road: "),i=Me(n),o=Me(`
                (`),s=Me(u),h=Me(" mph)")},m(p,g){W(p,e,g),F(e,t),F(e,i),F(e,o),F(e,s),F(e,h)},p(p,g){g[1]&262144&&n!==(n=(p[49].name??"unnamed road")+"")&&kt(i,n),g[1]&262144&&u!==(u=Math.round(p[49].speed_mph)+"")&&kt(s,u)},d(p){p&&G(e)}}}function Tz(r){let e,t=r[49].shortcuts+"",n,i,o=(r[49].name??"unnamed road")+"",u,s,h=Math.round(r[49].speed_mph)+"",p,g;return{c(){e=U("p"),n=Me(t),i=Me(" shortcuts through "),u=Me(o),s=Me(`
                (`),p=Me(h),g=Me(" mph)")},m(_,x){W(_,e,x),F(e,n),F(e,i),F(e,u),F(e,s),F(e,p),F(e,g)},p(_,x){x[1]&262144&&t!==(t=_[49].shortcuts+"")&&kt(n,t),x[1]&262144&&o!==(o=(_[49].name??"unnamed road")+"")&&kt(u,o),x[1]&262144&&h!==(h=Math.round(_[49].speed_mph)+"")&&kt(p,h)},d(_){_&&G(e)}}}function Mz(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function Ez(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function Lz(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function Iz(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=Me(`
                Click to add modal filter`),Sr(t.src,n=mr(Ri.getFilter(r[9])).iconURL)||he(t,"src",n),he(t,"width","20"),he(t,"alt","Add modal filter")},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u[0]&512&&!Sr(t.src,n=mr(Ri.getFilter(o[9])).iconURL)&&he(t,"src",n)},d(o){o&&G(e)}}}function Pz(r){let e,t;function n(p,g){if(p[49].kind=="interior_road")return Tz;if(p[49].kind=="main_road")return Cz}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return Iz;if(p[0].kind=="oneway")return Lz;if(p[0].kind=="main-roads"&&!p[0].freehand)return Ez;if(p[0].kind=="turn_restriction")return Mz}let s=u(r),h=s&&s(r);return{c(){o&&o.c(),e=ie(),h&&h.c(),t=nr()},m(p,g){o&&o.m(p,g),W(p,e,g),h&&h.m(p,g),W(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),s===(s=u(p))&&h?h.p(p,g):(h&&h.d(1),h=s&&s(p),h&&(h.c(),h.m(t.parentNode,t)))},d(p){p&&(G(e),G(t)),o&&o.d(p),h&&h.d(p)}}}function zz(r){let e,t,n;return t=new mi({props:{openOn:"hover",$$slots:{default:[Pz,({props:i})=>({49:i}),({props:i})=>[0,i?262144:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[0]&513|o[1]&786432&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Dz(r){let e,t,n,i,o,u,s,h,p,g;return e=new _p({}),n=new gp({}),o=new yp({}),s=new fh({props:{interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&!r[0].freehand||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[17],$$slots:{"line-popup":[zz]},$$scope:{ctx:r}}}),p=new cz({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[22]}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),h=ie(),ue(p.$$.fragment)},m(_,x){ae(e,_,x),W(_,t,x),ae(n,_,x),W(_,i,x),ae(o,_,x),W(_,u,x),ae(s,_,x),W(_,h,x),ae(p,_,x),g=!0},p(_,x){const C={};x[0]&1&&(C.interactive=_[0].kind=="filter"&&!_[0].freehand||_[0].kind=="oneway"||_[0].kind=="main-roads"&&!_[0].freehand||_[0].kind=="turn_restriction"&&_[0].from_road_id==null),x[0]&513|x[1]&524288&&(C.$$scope={dirty:x,ctx:_}),s.$set(C);const T={};x[0]&1&&(T.interactive=_[0].kind=="filter"),x[0]&2&&(T.neighbourhood=_[1]),p.$set(T)},i(_){g||(N(e.$$.fragment,_),N(n.$$.fragment,_),N(o.$$.fragment,_),N(s.$$.fragment,_),N(p.$$.fragment,_),g=!0)},o(_){V(e.$$.fragment,_),V(n.$$.fragment,_),V(o.$$.fragment,_),V(s.$$.fragment,_),V(p.$$.fragment,_),g=!1},d(_){_&&(G(t),G(i),G(u),G(h)),le(e,_),le(n,_),le(o,_),le(s,_),le(p,_)}}}function lb(r){let e,t;return e=new JP({props:{paths:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Rz(r){let e;return{c(){e=Me("Click to delete filter")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Bz(r){let e,t,n;return t=new mi({props:{openOn:"hover",$$slots:{default:[Rz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","modal-filter")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&524288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Fz(r){let e;return{c(){e=Me("Click to delete turn restriction")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Oz(r){let e,t,n;return t=new mi({props:{openOn:"hover",$$slots:{default:[Fz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","turn-restriction")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&524288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function $z(r){let e,t;return e=new K2({props:{map:mr(r[2])}}),e.$on("done",r[30]),e.$on("progress",r[31]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=mr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Nz(r){let e,t;return e=new K2({props:{map:mr(r[2])}}),e.$on("done",r[26]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=mr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ub(r){let e,t;return e=new _r({props:{data:r[0].possible_targets||eo(),generateId:!0,$$slots:{default:[Vz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||eo()),i[0]&1|i[1]&524288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function jz(r){let e,t,n,i,o=r[0].from_road_name+"",u,s,h=(r[49].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=Me(`

              Create a turn restriction from `),u=Me(o),s=Me(" to "),p=Me(h),Sr(t.src,n=r[28][r[49].kind])||he(t,"src",n),he(t,"width","20"),he(t,"alt","Add turn restriction")},m(g,_){W(g,e,_),F(e,t),F(e,i),F(e,u),F(e,s),F(e,p)},p(g,_){_[1]&262144&&!Sr(t.src,n=g[28][g[49].kind])&&he(t,"src",n),_[0]&1&&o!==(o=g[0].from_road_name+"")&&kt(u,o),_[1]&262144&&h!==(h=(g[49].name||"unnamed road")+"")&&kt(p,h)},d(g){g&&G(e)}}}function Uz(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[jz,({props:n})=>({49:n}),({props:n})=>[0,n?262144:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Vz(r){let e,t;const n=[_n("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Gn(.5,1),"line-width":ia(1)}}];let i={$$slots:{default:[Uz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),e.$on("click",r[19]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};u[0]&1|u[1]&524288&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function qz(r){let e,t,n,i,o,u,s,h,p,g,_,x;t=new Wg({}),t.$on("click",r[18]),i=new hh({props:{input:r[1],$$slots:{default:[Dz]},$$scope:{ctx:r}}});let C=r[10]&&lb(r);s=new tl({props:{onClickModalFilter:r[20],onClickTurnRestriction:r[21],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[Oz],"modal-filter":[Bz]},$$scope:{ctx:r}}});const T=[Nz,$z],z=[];function L(I,O){return I[0].kind=="filter"&&I[0].freehand?0:I[0].kind=="main-roads"&&I[0].freehand?1:-1}~(p=L(r))&&(g=z[p]=T[p](r));let E=r[0].kind=="turn_restriction"&&ub(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),C&&C.c(),u=ie(),ue(s.$$.fragment),h=ie(),g&&g.c(),_=ie(),E&&E.c(),he(e,"slot","map")},m(I,O){W(I,e,O),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),C&&C.m(e,null),F(e,u),ae(s,e,null),F(e,h),~p&&z[p].m(e,null),F(e,_),E&&E.m(e,null),x=!0},p(I,O){const B={};O[0]&2&&(B.input=I[1]),O[0]&515|O[1]&524288&&(B.$$scope={dirty:O,ctx:I}),i.$set(B),I[10]?C?(C.p(I,O),O[0]&1024&&N(C,1)):(C=lb(I),C.c(),N(C,1),C.m(e,u)):C&&(Kt(),V(C,1,1,()=>{C=null}),Jt());const K={};O[0]&1&&(K.interactive=I[0].kind=="filter"),O[1]&524288&&(K.$$scope={dirty:O,ctx:I}),s.$set(K);let H=p;p=L(I),p===H?~p&&z[p].p(I,O):(g&&(Kt(),V(z[H],1,1,()=>{z[H]=null}),Jt()),~p?(g=z[p],g?g.p(I,O):(g=z[p]=T[p](I),g.c()),N(g,1),g.m(e,_)):g=null),I[0].kind=="turn_restriction"?E?(E.p(I,O),O[0]&1&&N(E,1)):(E=ub(I),E.c(),N(E,1),E.m(e,null)):E&&(Kt(),V(E,1,1,()=>{E=null}),Jt())},i(I){x||(N(t.$$.fragment,I),N(i.$$.fragment,I),N(C),N(s.$$.fragment,I),N(g),N(E),x=!0)},o(I){V(t.$$.fragment,I),V(i.$$.fragment,I),V(C),V(s.$$.fragment,I),V(g),V(E),x=!1},d(I){I&&G(e),le(t),le(i),C&&C.d(),le(s),~p&&z[p].d(),E&&E.d()}}}function Hz(r){let e,t,n,i;return e=new So({props:{$$slots:{map:[qz],sidebar:[Sz],top:[bz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Mt(window,"keydown",r[23]),n=!0)},p(o,u){const s={};u[0]&65535|u[1]&524288&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}let cb="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",Gz="Cells are the colored area reachable without travelling along a main road.";function Wz(r,e,t){let n,i,o,u,s,h,p,g,_,x,C;st(r,Xi,nt=>t(29,i=nt)),st(r,kr,nt=>t(47,o=nt)),st(r,Xm,nt=>t(9,u=nt)),st(r,as,nt=>t(2,s=nt)),st(r,Q0,nt=>t(10,h=nt)),st(r,Km,nt=>t(11,p=nt)),st(r,Jm,nt=>t(12,g=nt)),st(r,Kd,nt=>t(13,_=nt)),st(r,tr,nt=>t(14,x=nt)),st(r,zf,nt=>t(15,C=nt));function T(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:eo()}}let z={kind:"filter",freehand:!1},L=!1,E=0,I=0,O,B,K=o.getAllShortcuts();ks(()=>{w2()}),ri(()=>{s.doubleClickZoom.enable()});function H(nt){t(1,B=o.renderNeighbourhood()),t(6,O=B.features.find(de=>de.properties.kind=="boundary")),t(4,E=B.undo_length),t(5,I=B.redo_length),t(7,K=o.getAllShortcuts()),qf()}function q(nt,de){z.kind=="filter"?(o.addModalFilter(de,u),ln(Xi,i++,i)):z.kind=="oneway"?(o.toggleTravelFlow(nt.properties.road),ln(Xi,i++,i)):z.kind=="main-roads"&&!z.freehand?(o.toggleMainRoad(nt.properties.road),ln(Xi,i++,i)):z.kind=="turn_restriction"&&(t(0,z.from_road_id=nt.properties.road,z),t(0,z.from_road_name=nt.properties.name||"unnamed road",z),t(0,z.possible_targets=o.getTurnRestrictionTargets(nt.properties.road),z))}function J(nt){z.kind=="turn_restriction"&&(s.queryRenderedFeatures(nt.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,z=T()))}function fe(nt){if(z.kind=="turn_restriction"&&z.from_road_id!=null){let de=nt.detail.features[0].properties.road;o.addTurnRestriction(z.from_road_id,de),ln(Xi,i++,i)}t(0,z=T())}function Ee(nt){let de=nt.detail.features[0];o.deleteModalFilter(de.properties.road),ln(Xi,i++,i)}function ee(nt){let de=nt.detail.features[0];o.deleteTurnRestriction(de.properties.intersection,de.properties.from_road,de.properties.to_road),ln(Xi,i++,i)}function oe(nt){if(z.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${z.kind}`);return}nt.hasRotatedFilter?(o.deleteDiagonalFilter(nt),ln(Xi,i++,i)):nt.filter?(o.rotateDiagonalFilter(nt),ln(Xi,i++,i)):(o.addDiagonalFilter(nt),ln(Xi,i++,i))}function xe(nt){nt.target.tagName!="INPUT"&&(nt.ctrlKey&&nt.key=="z"&&me(),nt.ctrlKey&&nt.key=="y"&&tt(),nt.key=="1"&&t(0,z={kind:"filter",freehand:!1}),nt.key=="2"&&t(0,z={kind:"oneway"}),nt.key=="3"&&t(0,z=T()),nt.key=="4"&&t(0,z={kind:"main-roads",freehand:!1,isMain:!1}))}function me(){o.undo(),ln(Xi,i++,i)}function tt(){o.redo(),ln(Xi,i++,i)}function Ue(nt){let de=nt.detail;de&&(o.addManyModalFilters(de,u),ln(Xi,i++,i)),t(0,z={kind:"filter",freehand:!1})}function ze(nt,de){if(z.kind!="main-roads"){console.assert(!1,"cant paint line unless in main-roads mode");return}let cn=nt.detail;cn&&(o.reclassifyRoadsAlongLine(cn,z.isMain,de),ln(Xi,i++,i))}let Ie={left:Qb,right:Dg,straight:ew,u_left_to_right:nw,u_right_to_left:tw};const ct=nt=>ze(nt,!0),Xe=nt=>ze(nt,!1),lt=()=>t(0,z={kind:"filter",freehand:!1}),pt=()=>t(0,z={kind:"oneway"}),_t=()=>t(0,z=T()),He=()=>t(0,z={kind:"main-roads",freehand:!1,isMain:!1});function gt(nt){L=nt,t(3,L)}const Pt=()=>t(3,L=!0),jt=()=>t(0,z={kind:"filter",freehand:!1}),un=()=>t(0,z={kind:"filter",freehand:!0}),nn=()=>{t(0,z={kind:"main-roads",freehand:!1,isMain:!0})},rn=()=>{t(0,z={kind:"main-roads",freehand:!0,isMain:!0})},pn=()=>{t(0,z={kind:"main-roads",freehand:!0,isMain:!1})};function yn(){h=this.checked,Q0.set(h)}function qe(){p=this.checked,Km.set(p)}function Ge(){g=this.checked,Jm.set(g)}function At(){_=Fa(this),Kd.set(_)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(z.kind=="oneway"||z.kind=="main-roads"?s.doubleClickZoom.disable():s.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(z.kind=="filter"&&z.freehand||z.kind=="main-roads"&&z.freehand&&z.isMain?s.getCanvas().style.cursor=`url(${PP}) 8 22, cell`:z.kind=="main-roads"&&z.freehand&&!z.isMain?s.getCanvas().style.cursor=`url(${IP}) 8 22, cell`:s.getCanvas().style.cursor=""),r.$$.dirty[0]&536870912&&H(),r.$$.dirty[0]&2&&t(8,n=B.features.filter(nt=>nt.properties.kind=="cell"&&nt.properties.cell_color=="disconnected").length)},[z,B,s,L,E,I,O,K,n,u,h,p,g,_,x,C,T,q,J,fe,Ee,ee,oe,xe,me,tt,Ue,ze,Ie,i,ct,Xe,lt,pt,_t,He,gt,Pt,jt,un,nn,rn,pn,yn,qe,Ge,At]}class Zz extends Lt{constructor(e){super(),Et(this,e,Wz,Hz,St,{},null,[-1,-1])}}function fb(r){let e,t,n;return t=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Xz(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z=yr(r[5].mode)+"",L,E;o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}});let I=r[0]=="neighbourhood"&&fb();return x=new Fn({props:{mode:{mode:"predict-impact",prevMode:r[0]}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),I&&I.c(),g=ie(),_=U("li"),ue(x.$$.fragment),C=ie(),T=U("li"),L=Me(z),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(O,B){W(O,e,B),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),I&&I.m(n,null),F(n,g),F(n,_),ae(x,_,null),F(n,C),F(n,T),F(T,L),E=!0},p(O,B){O[0]=="neighbourhood"?I?B&1&&N(I,1):(I=fb(),I.c(),N(I,1),I.m(n,g)):I&&(Kt(),V(I,1,1,()=>{I=null}),Jt());const K={};B&1&&(K.mode={mode:"predict-impact",prevMode:O[0]}),x.$set(K),(!E||B&32)&&z!==(z=yr(O[5].mode)+"")&&kt(L,z)},i(O){E||(N(o.$$.fragment,O),N(h.$$.fragment,O),N(I),N(x.$$.fragment,O),E=!0)},o(O){V(o.$$.fragment,O),V(h.$$.fragment,O),V(I),V(x.$$.fragment,O),E=!1},d(O){O&&G(e),le(o),le(h),I&&I.d(),le(x)}}}function hb(r){let e,t,n,i,o,u,s;function h(C){r[10](C)}let p={list:r[2]};r[3]!==void 0&&(p.idx=r[3]),e=new fp({props:p}),dn.push(()=>Dn(e,"idx",h));let g=r[2][r[3]].count>1&&db(r),_=r[2][r[3]].before==null&&pb(),x=r[2][r[3]].after==null&&mb();return{c(){ue(e.$$.fragment),n=ie(),g&&g.c(),i=ie(),_&&_.c(),o=ie(),x&&x.c(),u=nr()},m(C,T){ae(e,C,T),W(C,n,T),g&&g.m(C,T),W(C,i,T),_&&_.m(C,T),W(C,o,T),x&&x.m(C,T),W(C,u,T),s=!0},p(C,T){const z={};T&4&&(z.list=C[2]),!t&&T&8&&(t=!0,z.idx=C[3],zn(()=>t=!1)),e.$set(z),C[2][C[3]].count>1?g?g.p(C,T):(g=db(C),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),C[2][C[3]].before==null?_||(_=pb(),_.c(),_.m(o.parentNode,o)):_&&(_.d(1),_=null),C[2][C[3]].after==null?x||(x=mb(),x.c(),x.m(u.parentNode,u)):x&&(x.d(1),x=null)},i(C){s||(N(e.$$.fragment,C),s=!0)},o(C){V(e.$$.fragment,C),s=!1},d(C){C&&(G(n),G(i),G(o),G(u)),le(e,C),g&&g.d(C),_&&_.d(C),x&&x.d(C)}}}function db(r){let e,t,n=r[2][r[3]].count.toLocaleString()+"",i,o,u,s;return{c(){e=U("p"),t=Me(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Me(n),o=Me(` trips between the
          same points.`),u=ie(),s=U("i"),s.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(h,p){W(h,e,p),F(e,t),F(e,i),F(e,o),W(h,u,p),W(h,s,p)},p(h,p){p&12&&n!==(n=h[2][h[3]].count.toLocaleString()+"")&&kt(i,n)},d(h){h&&(G(e),G(u),G(s))}}}function pb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","red")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function mb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","blue")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Kz(r){let e,t,n,i,o=r[1].before.toLocaleString()+"",u,s,h,p,g=r[1].after.toLocaleString()+"",_,x,C,T,z=Math.round(100*r[1].after/r[1].before)+"",L,E,I,O;t=new Us({props:{mode:{mode:"predict-impact",prevMode:r[0]}}});let B=r[2].length>0&&hb(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),u=Me(o),s=Me(` routes cross here
      `),h=U("span"),h.textContent="before your changes",p=Me(`
      , and `),_=Me(g),x=ie(),C=U("span"),C.textContent="after your changes",T=Me(`
      . That's
      `),L=Me(z),E=Me("% of the original traffic."),I=ie(),B&&B.c(),Ye(h,"color","red"),Ye(C,"color","blue"),he(e,"slot","sidebar")},m(K,H){W(K,e,H),ae(t,e,null),F(e,n),F(e,i),F(i,u),F(i,s),F(i,h),F(i,p),F(i,_),F(i,x),F(i,C),F(i,T),F(i,L),F(i,E),F(e,I),B&&B.m(e,null),O=!0},p(K,H){const q={};H&1&&(q.mode={mode:"predict-impact",prevMode:K[0]}),t.$set(q),(!O||H&2)&&o!==(o=K[1].before.toLocaleString()+"")&&kt(u,o),(!O||H&2)&&g!==(g=K[1].after.toLocaleString()+"")&&kt(_,g),(!O||H&2)&&z!==(z=Math.round(100*K[1].after/K[1].before)+"")&&kt(L,z),K[2].length>0?B?(B.p(K,H),H&4&&N(B,1)):(B=hb(K),B.c(),N(B,1),B.m(e,null)):B&&(Kt(),V(B,1,1,()=>{B=null}),Jt())},i(K){O||(N(t.$$.fragment,K),N(B),O=!0)},o(K){V(t.$$.fragment,K),V(B),O=!1},d(K){K&&G(e),le(t),B&&B.d()}}}function gb(r){let e,t,n,i,o,u;return e=new _r({props:{data:r[6](r[3]),$$slots:{default:[Jz]},$$scope:{ctx:r}}}),n=new Fl({props:{lngLat:r[7](r[3]),$$slots:{default:[Yz]},$$scope:{ctx:r}}}),o=new Fl({props:{lngLat:r[8](r[3]),$$slots:{default:[Qz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment)},m(s,h){ae(e,s,h),W(s,t,h),ae(n,s,h),W(s,i,h),ae(o,s,h),u=!0},p(s,h){const p={};h&8&&(p.data=s[6](s[3])),h&8192&&(p.$$scope={dirty:h,ctx:s}),e.$set(p);const g={};h&8&&(g.lngLat=s[7](s[3])),h&8192&&(g.$$scope={dirty:h,ctx:s}),n.$set(g);const _={};h&8&&(_.lngLat=s[8](s[3])),h&8192&&(_.$$scope={dirty:h,ctx:s}),o.$set(_)},i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),le(e,s),le(n,s),le(o,s)}}}function Jz(r){let e,t;const n=[_n("predict-impact"),{paint:{"line-width":jo(["get","kind"],{focus:8},5),"line-color":jo(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":jo(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Yz(r){let e;return{c(){e=Me("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Qz(r){let e;return{c(){e=Me("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function e7(r){let e,t,n,i,o=r[2].length>0&&gb(r);return n=new tl({props:{interactive:!1}}),{c(){e=U("div"),o&&o.c(),t=ie(),ue(n.$$.fragment),he(e,"slot","map")},m(u,s){W(u,e,s),o&&o.m(e,null),F(e,t),ae(n,e,null),i=!0},p(u,s){u[2].length>0?o?(o.p(u,s),s&4&&N(o,1)):(o=gb(u),o.c(),N(o,1),o.m(e,t)):o&&(Kt(),V(o,1,1,()=>{o=null}),Jt())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){V(o),V(n.$$.fragment,u),i=!1},d(u){u&&G(e),o&&o.d(),le(n)}}}function t7(r){let e,t,n,i;return e=new uh({props:{loading:r[4]}}),n=new So({props:{$$slots:{map:[e7],sidebar:[Kz],top:[Xz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&16&&(s.loading=o[4]),e.$set(s);const h={};u&8239&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function n7(r,e,t){let n,i,o;st(r,tr,L=>t(5,n=L)),st(r,Ym,L=>t(11,i=L)),st(r,kr,L=>t(12,o=L));let{road:u}=e,{prevPrevMode:s}=e,h=u.properties;h.kind="focus";let p=[],g=0,_="Finding changes to this road";ks(async()=>{await new Promise(L=>{requestAnimationFrame(()=>{requestAnimationFrame(L)})}),t(2,p=o.getImpactsOnRoad(h.id,i)),t(4,_=""),p.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),ln(tr,n={mode:"predict-impact",prevMode:s},n))});function x(L){return{type:"FeatureCollection",features:[p[L].before,p[L].after,u].filter(E=>E!=null)}}function C(L){return p[L].before!=null?p[L].before.geometry.coordinates[0]:p[L].after.geometry.coordinates[0]}function T(L){let E=p[L].before!=null?p[L].before.geometry.coordinates:p[L].after.geometry.coordinates;return E[E.length-1]}function z(L){g=L,t(3,g)}return r.$$set=L=>{"road"in L&&t(9,u=L.road),"prevPrevMode"in L&&t(0,s=L.prevPrevMode)},[s,h,p,g,_,n,x,C,T,u,z]}class r7 extends Lt{constructor(e){super(),Et(this,e,n7,t7,St,{road:9,prevPrevMode:0})}}function i7(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T=yr(r[6].mode)+"",z,L;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Me(T),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(E,I){W(E,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,z),L=!0},p(E,I){(!L||I&64)&&T!==(T=yr(E[6].mode)+"")&&kt(z,T)},i(E){L||(N(o.$$.fragment,E),N(h.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(h.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(h),le(_)}}}function o7(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function s7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function a7(r){let e,t=Ua(r[4].properties.distance)+"",n,i,o=Va(r[4].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,h){W(s,e,h),F(e,n),F(e,i),F(e,u)},p(s,h){h&16&&t!==(t=Ua(s[4].properties.distance)+"")&&kt(n,t),h&16&&o!==(o=Va(s[4].properties.time)+"")&&kt(u,o)},d(s){s&&G(e)}}}function l7(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function u7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function c7(r){let e,t=Ua(r[3].properties.distance)+"",n,i,o=Va(r[3].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,h){W(s,e,h),F(e,n),F(e,i),F(e,u)},p(s,h){h&8&&t!==(t=Ua(s[3].properties.distance)+"")&&kt(n,t),h&8&&o!==(o=Va(s[3].properties.time)+"")&&kt(u,o)},d(s){s&&G(e)}}}function f7(r){let e,t,n,i,o,u,s,h,p,g,_;t=new Us({props:{mode:{mode:"neighbourhood"}}});function x(I,O){return I[4]?a7:I[3]?s7:o7}let C=x(r),T=C(r);function z(I,O){return I[3]?c7:I[4]?u7:l7}let L=z(r),E=L(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=ie(),u=U("u"),u.textContent="Route before changes",s=ie(),T.c(),h=ie(),p=U("u"),p.textContent="Route after changes",g=ie(),E.c(),Ye(u,"color","red"),Ye(p,"color","blue"),he(e,"slot","sidebar")},m(I,O){W(I,e,O),ae(t,e,null),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),T.m(e,null),F(e,h),F(e,p),F(e,g),E.m(e,null),_=!0},p(I,O){C===(C=x(I))&&T?T.p(I,O):(T.d(1),T=C(I),T&&(T.c(),T.m(e,h))),L===(L=z(I))&&E?E.p(I,O):(E.d(1),E=L(I),E&&(E.c(),E.m(e,null)))},i(I){_||(N(t.$$.fragment,I),_=!0)},o(I){V(t.$$.fragment,I),_=!1},d(I){I&&G(e),le(t),T.d(),E.d()}}}function h7(r){let e,t;const n=[_n("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Yi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function d7(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=Me("Time ratio: "),i=Me(n)},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&kt(i,n)},d(o){o&&G(e)}}}function p7(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[d7,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function m7(r){let e,t,n;const i=[_n("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[10](s)}let u={$$slots:{default:[p7]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=zt(u,i[s]);return r[0]!==void 0&&(u.hovered=r[0]),e=new ur({props:u}),dn.push(()=>Dn(e,"hovered",o)),e.$on("click",r[11]),{c(){ue(e.$$.fragment)},m(s,h){ae(e,s,h),n=!0},p(s,h){const p=h&32?In(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};h&131072&&(p.$$scope={dirty:h,ctx:s}),!t&&h&1&&(t=!0,p.hovered=s[0],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function g7(r){let e,t;const n=[_n("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":jo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function _7(r){let e;return{c(){e=Me("X")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function y7(r){let e,t,n,i,o,u,s,h,p,g,_,x;t=new hh({props:{$$slots:{default:[h7]},$$scope:{ctx:r}}}),i=new _r({props:{data:r[5],generateId:!0,$$slots:{default:[m7]},$$scope:{ctx:r}}}),u=new _r({props:{data:r[1],$$slots:{default:[g7]},$$scope:{ctx:r}}}),h=new tl({props:{interactive:!1}});function C(z){r[12](z)}let T={draggable:!0,$$slots:{default:[_7]},$$scope:{ctx:r}};return r[2]!==void 0&&(T.lngLat=r[2]),g=new Fl({props:T}),dn.push(()=>Dn(g,"lngLat",C)),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),s=ie(),ue(h.$$.fragment),p=ie(),ue(g.$$.fragment),he(e,"slot","map")},m(z,L){W(z,e,L),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),ae(u,e,null),F(e,s),ae(h,e,null),F(e,p),ae(g,e,null),x=!0},p(z,L){const E={};L&131072&&(E.$$scope={dirty:L,ctx:z}),t.$set(E);const I={};L&32&&(I.data=z[5]),L&131105&&(I.$$scope={dirty:L,ctx:z}),i.$set(I);const O={};L&2&&(O.data=z[1]),L&131072&&(O.$$scope={dirty:L,ctx:z}),u.$set(O);const B={};L&131072&&(B.$$scope={dirty:L,ctx:z}),!_&&L&4&&(_=!0,B.lngLat=z[2],zn(()=>_=!1)),g.$set(B)},i(z){x||(N(t.$$.fragment,z),N(i.$$.fragment,z),N(u.$$.fragment,z),N(h.$$.fragment,z),N(g.$$.fragment,z),x=!0)},o(z){V(t.$$.fragment,z),V(i.$$.fragment,z),V(u.$$.fragment,z),V(h.$$.fragment,z),V(g.$$.fragment,z),x=!1},d(z){z&&G(e),le(t),le(i),le(u),le(h),le(g)}}}function v7(r){let e,t,n,i;return e=new Wg({}),e.$on("contextmenu",r[8]),n=new So({props:{$$slots:{map:[y7],sidebar:[f7],top:[i7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&131199&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function b7(r,e,t){let n,i,o,u,s,h,p,g,_;st(r,wd,O=>t(2,s=O)),st(r,tr,O=>t(6,h=O)),st(r,Pf,O=>t(13,p=O)),st(r,If,O=>t(14,g=O)),st(r,kr,O=>t(9,_=O));let x=null;ks(()=>{setTimeout(()=>{s&&eg(wd)},10)});function C(O){return O?_.compareRoute(new ua.LngLat(O.properties.pt1_x,O.properties.pt1_y),s,1):eo()}function T(O){ln(If,g=new ua.LngLat(O.properties.pt1_x,O.properties.pt1_y),g),ln(Pf,p=s,p),ln(tr,h={mode:"route",prevMode:"impact-one-destination"},h)}function z(O){ln(wd,s=O.detail.lngLat,s)}function L(O){x=O,t(0,x)}const E=O=>T(O.detail.features[0]);function I(O){s=O,wd.set(s)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=_.impactToOneDestination(s)),r.$$.dirty&1&&t(1,i=C(x)),r.$$.dirty&2&&t(4,o=i.features.find(O=>O.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find(O=>O.properties.kind=="after"))},[x,i,s,u,o,n,h,T,z,_,L,E,I]}class w7 extends Lt{constructor(e){super(),Et(this,e,b7,v7,St,{})}}function _b(r,e,t){const n=r.slice();return n[28]=e[t].properties.name,n}function x7(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function yb(r){let e,t,n;return t=new Fn({props:{mode:{mode:"debug-intersections"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function A7(r){let e,t,n,i,o,u,s,h=yr(r[5].mode)+"",p,g,_,x,C,T,z,L,E,I,O,B,K;o=new Fn({props:{mode:{mode:"title"}}}),_=new i_({props:{$$slots:{default:[x7]},$$scope:{ctx:r}}}),L=new Fn({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),O=new Fn({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}});let H=r[8]&&yb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),p=Me(h),g=ie(),ue(_.$$.fragment),x=ie(),C=U("nav"),T=U("ul"),z=U("li"),ue(L.$$.fragment),E=ie(),I=U("li"),ue(O.$$.fragment),B=ie(),H&&H.c(),he(t,"aria-label","breadcrumb"),he(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(q,J){W(q,e,J),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),F(s,p),F(s,g),ae(_,s,null),F(e,x),F(e,C),F(C,T),F(T,z),ae(L,z,null),F(T,E),F(T,I),ae(O,I,null),F(T,B),H&&H.m(T,null),K=!0},p(q,J){(!K||J[0]&32)&&h!==(h=yr(q[5].mode)+"")&&kt(p,h);const fe={};J[1]&1&&(fe.$$scope={dirty:J,ctx:q}),_.$set(fe),q[8]?H?J[0]&256&&N(H,1):(H=yb(),H.c(),N(H,1),H.m(T,null)):H&&(Kt(),V(H,1,1,()=>{H=null}),Jt())},i(q){K||(N(o.$$.fragment,q),N(_.$$.fragment,q),N(L.$$.fragment,q),N(O.$$.fragment,q),N(H),K=!0)},o(q){V(o.$$.fragment,q),V(_.$$.fragment,q),V(L.$$.fragment,q),V(O.$$.fragment,q),V(H),K=!1},d(q){q&&G(e),le(o),le(_),le(L),le(O),H&&H.d()}}}function k7(r){let e=r[28]+"",t;return{c(){t=Me(e)},m(n,i){W(n,t,i)},p(n,i){i[0]&1&&e!==(e=n[28]+"")&&kt(t,e)},d(n){n&&G(t)}}}function vb(r){let e,t,n,i,o,u,s,h,p,g,_,x,C;function T(){return r[19](r[28])}n=new lh({props:{$$slots:{default:[k7]},$$scope:{ctx:r}}}),n.$on("click",T),s=new Vg({props:{color:"black"}});function z(){return r[20](r[28])}g=new qg({props:{color:"white"}});function L(){return r[21](r[28])}function E(){return r[22](r[28])}return{c(){var I;e=U("li"),t=U("h3"),ue(n.$$.fragment),i=ie(),o=U("span"),u=U("button"),ue(s.$$.fragment),h=ie(),p=U("button"),ue(g.$$.fragment),he(u,"class","outline icon-btn"),he(u,"title","Rename neighbourhood"),he(p,"class","icon-btn destructive"),he(p,"title","Delete neighbourhood"),he(o,"class","actions"),he(e,"class","actionable-cell svelte-qhjp0j"),Wt(e,"highlighted",((I=r[3])==null?void 0:I.properties.name)==r[28]||r[2]==r[28])},m(I,O){W(I,e,O),F(e,t),ae(n,t,null),F(e,i),F(e,o),F(o,u),ae(s,u,null),F(o,h),F(o,p),ae(g,p,null),_=!0,x||(C=[Mt(u,"click",z),Mt(p,"click",L),Mt(e,"mouseenter",E),Mt(e,"mouseleave",r[23])],x=!0)},p(I,O){var K;r=I;const B={};O[0]&1|O[1]&1&&(B.$$scope={dirty:O,ctx:r}),n.$set(B),(!_||O[0]&13)&&Wt(e,"highlighted",((K=r[3])==null?void 0:K.properties.name)==r[28]||r[2]==r[28])},i(I){_||(N(n.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(n.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&G(e),le(n),le(s),le(g),x=!1,cr(C)}}}function S7(r){let e,t,n;return e=new R3({}),{c(){ue(e.$$.fragment),t=Me(`
          Add a new neighbourhood`)},m(i,o){ae(e,i,o),W(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){V(e.$$.fragment,i),n=!1},d(i){i&&G(t),le(e,i)}}}function bb(r){let e,t,n,i,o,u,s,h,p;function g(x){r[24](x)}let _={};return r[1]!==void 0&&(_.selectedPrioritization=r[1]),o=new G2({props:_}),dn.push(()=>Dn(o,"selectedPrioritization",g)),{c(){e=U("h3"),e.textContent="Prioritization",t=ie(),n=U("p"),n.textContent="Compare metrics across your neighbourhoods.",i=ie(),ue(o.$$.fragment),s=ie(),h=U("hr")},m(x,C){W(x,e,C),W(x,t,C),W(x,n,C),W(x,i,C),ae(o,x,C),W(x,s,C),W(x,h,C),p=!0},p(x,C){const T={};!u&&C[0]&2&&(u=!0,T.selectedPrioritization=x[1],zn(()=>u=!1)),o.$set(T)},i(x){p||(N(o.$$.fragment,x),p=!0)},o(x){V(o.$$.fragment,x),p=!1},d(x){x&&(G(e),G(t),G(n),G(i),G(s),G(h)),le(o,x)}}}function wb(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",he(e,"class","secondary")},m(i,o){W(i,e,o),t||(n=Mt(e,"click",r[12]),t=!0)},p:at,d(i){i&&G(e),t=!1,n()}}}function C7(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I=r[4].modalFilters+"",O,B,K,H,q=r[4].deletedModalFilters+"",J,fe,Ee,ee,oe=r[4].travelFlows+"",xe,me,tt,Ue,ze,Ie;s=new Cw({});let ct=On(r[0].features),Xe=[];for(let He=0;He<ct.length;He+=1)Xe[He]=vb(_b(r,ct,He));const lt=He=>V(Xe[He],1,1,()=>{Xe[He]=null});T=new Fn({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[S7]},$$scope:{ctx:r}}});let pt=r[7]=="cnt"&&bb(r),_t=r[8]&&wb(r);return{c(){e=U("div"),t=U("div"),n=U("h2"),n.textContent="Neighbourhoods",i=ie(),o=U("button"),u=U("div"),ue(s.$$.fragment),h=ie(),p=U("span"),p.textContent="Export",g=ie(),_=U("ul");for(let He=0;He<Xe.length;He+=1)Xe[He].c();x=ie(),C=U("li"),ue(T.$$.fragment),z=ie(),pt&&pt.c(),L=ie(),E=U("p"),O=Me(I),B=Me(" new modal filter(s) added"),K=ie(),H=U("p"),J=Me(q),fe=Me(`
      existing modal filter(s) removed`),Ee=ie(),ee=U("p"),xe=Me(oe),me=Me(" road segment direction(s) changed"),tt=ie(),_t&&_t.c(),Ye(p,"margin-right","2px"),Ye(u,"display","flex"),Ye(u,"align-items","center"),Ye(u,"gap","8px"),Ye(u,"color","black"),he(o,"class","outline"),Ye(o,"margin-right","8px"),he(o,"title","Download project as GeoJSON"),Ye(t,"display","flex"),Ye(t,"justify-content","space-between"),Ye(t,"align-items","center"),Ye(t,"gap","16px"),he(_,"class","navigable-list"),he(e,"slot","sidebar")},m(He,gt){W(He,e,gt),F(e,t),F(t,n),F(t,i),F(t,o),F(o,u),ae(s,u,null),F(u,h),F(u,p),F(e,g),F(e,_);for(let Pt=0;Pt<Xe.length;Pt+=1)Xe[Pt]&&Xe[Pt].m(_,null);F(_,x),F(_,C),ae(T,C,null),F(e,z),pt&&pt.m(e,null),F(e,L),F(e,E),F(E,O),F(E,B),F(e,K),F(e,H),F(H,J),F(H,fe),F(e,Ee),F(e,ee),F(ee,xe),F(ee,me),F(e,tt),_t&&_t.m(e,null),Ue=!0,ze||(Ie=Mt(o,"click",r[18]),ze=!0)},p(He,gt){if(gt[0]&3597){ct=On(He[0].features);let jt;for(jt=0;jt<ct.length;jt+=1){const un=_b(He,ct,jt);Xe[jt]?(Xe[jt].p(un,gt),N(Xe[jt],1)):(Xe[jt]=vb(un),Xe[jt].c(),N(Xe[jt],1),Xe[jt].m(_,x))}for(Kt(),jt=ct.length;jt<Xe.length;jt+=1)lt(jt);Jt()}const Pt={};gt[1]&1&&(Pt.$$scope={dirty:gt,ctx:He}),T.$set(Pt),He[7]=="cnt"?pt?(pt.p(He,gt),gt[0]&128&&N(pt,1)):(pt=bb(He),pt.c(),N(pt,1),pt.m(e,L)):pt&&(Kt(),V(pt,1,1,()=>{pt=null}),Jt()),(!Ue||gt[0]&16)&&I!==(I=He[4].modalFilters+"")&&kt(O,I),(!Ue||gt[0]&16)&&q!==(q=He[4].deletedModalFilters+"")&&kt(J,q),(!Ue||gt[0]&16)&&oe!==(oe=He[4].travelFlows+"")&&kt(xe,oe),He[8]?_t?_t.p(He,gt):(_t=wb(He),_t.c(),_t.m(e,null)):_t&&(_t.d(1),_t=null)},i(He){if(!Ue){N(s.$$.fragment,He);for(let gt=0;gt<ct.length;gt+=1)N(Xe[gt]);N(T.$$.fragment,He),N(pt),Ue=!0}},o(He){V(s.$$.fragment,He),Xe=Xe.filter(Boolean);for(let gt=0;gt<Xe.length;gt+=1)V(Xe[gt]);V(T.$$.fragment,He),V(pt),Ue=!1},d(He){He&&G(e),le(s),_i(Xe,He),le(T),pt&&pt.d(),_t&&_t.d(),ze=!1,Ie()}}}function T7(r){let e,t,n=(r[27].number_pois/r[27].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=ie(),i=Me(n),o=Me(" / km²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=(u[27].number_pois/u[27].area_km2).toFixed(1)+"")&&kt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function M7(r){let e,t,n=(r[27].number_stats19_collisions/r[27].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=ie(),i=Me(n),o=Me(" / km²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=(u[27].number_stats19_collisions/u[27].area_km2).toFixed(1)+"")&&kt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function E7(r){let e,t,n=Math.round(r[27].population/r[27].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=ie(),i=Me(n),o=Me(` people
            / km²`)},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=Math.round(u[27].population/u[27].area_km2).toLocaleString()+"")&&kt(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function L7(r){let e,t=r[27].name+"",n,i,o;function u(p,g){if(p[1]=="density")return E7;if(p[1]=="stats19")return M7;if(p[1]=="pois")return T7}let s=u(r),h=s&&s(r);return{c(){e=U("h2"),n=Me(t),i=ie(),h&&h.c(),o=nr()},m(p,g){W(p,e,g),F(e,n),W(p,i,g),h&&h.m(p,g),W(p,o,g)},p(p,g){g[0]&134217728&&t!==(t=p[27].name+"")&&kt(n,t),s===(s=u(p))&&h?h.p(p,g):(h&&h.d(1),h=s&&s(p),h&&(h.c(),h.m(o.parentNode,o)))},d(p){p&&(G(e),G(i),G(o)),h&&h.d(p)}}}function I7(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[L7,({props:n})=>({27:n}),({props:n})=>[n?134217728:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&134217730|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function P7(r){let e,t,n,i,o,u,s,h,p;e=new dS({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},_n("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let _={};for(let E=0;E<g.length;E+=1)_=zt(_,g[E]);n=new ur({props:_});const x=[{filter:["==",["get","kind"],"boundary"]},_n("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let C={};for(let E=0;E<x.length;E+=1)C=zt(C,x[E]);o=new ur({props:C});const T=[_n("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function z(E){r[16](E)}let L={$$slots:{default:[I7]},$$scope:{ctx:r}};for(let E=0;E<T.length;E+=1)L=zt(L,T[E]);return r[3]!==void 0&&(L.hovered=r[3]),s=new Yi({props:L}),dn.push(()=>Dn(s,"hovered",z)),s.$on("click",r[17]),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(E,I){ae(e,E,I),W(E,t,I),ae(n,E,I),W(E,i,I),ae(o,E,I),W(E,u,I),ae(s,E,I),p=!0},p(E,I){const O={};I[0]&4&&(O.data=E[2]?[{name:E[2],highlight:"yes"}]:[]),e.$set(O);const B={};n.$set(B);const K={};o.$set(K);const H=I[0]&24578?In(T,[T[0],T[1],{paint:{"fill-color":E[13](E[1]),"fill-opacity":E[14](E[1])}},T[3],T[4]]):{};I[0]&2|I[1]&1&&(H.$$scope={dirty:I,ctx:E}),!h&&I[0]&8&&(h=!0,H.hovered=E[3],zn(()=>h=!1)),s.$set(H)},i(E){p||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),p=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),p=!1},d(E){E&&(G(t),G(i),G(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function z7(r){let e,t,n,i,o;return t=new _r({props:{data:r[0],promoteId:"name",$$slots:{default:[P7]},$$scope:{ctx:r}}}),i=new tl({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),he(e,"slot","map")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),ae(i,e,null),o=!0},p(u,s){const h={};s[0]&1&&(h.data=u[0]),s[0]&14|s[1]&1&&(h.$$scope={dirty:s,ctx:u}),t.$set(h)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&G(e),le(t),le(i)}}}function D7(r){let e,t;return e=new So({props:{$$slots:{map:[z7],sidebar:[C7],top:[A7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&511|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function R7(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function B7(r,e,t){let n,i,o,u,s,h,p,g,_;st(r,nh,me=>t(25,o=me)),st(r,kr,me=>t(15,u=me)),st(r,Ra,me=>t(26,s=me)),st(r,tr,me=>t(5,h=me)),st(r,$s,me=>t(6,p=me)),st(r,As,me=>t(7,g=me)),st(r,zf,me=>t(8,_=me));let x="none",C=null,T=null;ln(Ra,s=void 0,s);function z(me){u.setCurrentNeighbourhood(me),ln(Ra,s=me,s),ln(tr,h={mode:"neighbourhood"},h)}function L(me){window.confirm(`Really delete neighbourhood ${me}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(me),console.assert(!Ra),qf(),t(0,n=u.getAllNeighbourhoods()))}function E(me){let tt=H2(u,`Rename neighbourhood ${me} to what?`,me);tt&&(u.renameNeighbourhoodBoundary(me,tt),ln(Ra,s=tt,s),qf(),t(0,n=u.getAllNeighbourhoods()))}function I(){op("debug_route_snapper.geojson",u.toRouteSnapperGj())}function O(me){let tt=vo.mapFeature.hover.backgroundColor,Ue=W2({none:tt},me,o);return["case",["==",["feature-state","highlight"],"yes"],tt,Ue]}function B(me){let tt=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],tt,Gn(.3,tt)],area:Gn(.7,.9),density:Gn(.7,.9),simd:Gn(.7,.9),stats19:Gn(.7,.9),pois:Gn(.7,.9),car_ownership:Gn(.7,.9),combined:Gn(.7,.9)}[me]}function K(me){T=me,t(3,T)}const H=me=>z(mr(me.detail.features[0].properties).name),q=()=>x2(mr(p)),J=me=>z(me),fe=me=>E(me),Ee=me=>L(me),ee=me=>t(2,C=me),oe=()=>t(2,C=null);function xe(me){x=me,t(1,x)}return r.$$.update=()=>{r.$$.dirty[0]&32768&&t(0,n=u.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,i=R7(n))},[n,x,C,T,i,h,p,g,_,z,L,E,I,O,B,u,K,H,q,J,fe,Ee,ee,oe,xe]}class F7 extends Lt{constructor(e){super(),Et(this,e,B7,D7,St,{},null,[-1,-1])}}function xb(r){let e,t,n;return t=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function O7(r){let e,t,n,i,o,u,s,h,p,g,_,x=yr(r[4].mode)+"",C,T;o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}});let z=r[0]=="neighbourhood"&&xb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),z&&z.c(),g=ie(),_=U("li"),C=Me(x),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,E){W(L,e,E),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),z&&z.m(n,null),F(n,g),F(n,_),F(_,C),T=!0},p(L,E){L[0]=="neighbourhood"?z?E&1&&N(z,1):(z=xb(),z.c(),N(z,1),z.m(n,g)):z&&(Kt(),V(z,1,1,()=>{z=null}),Jt()),(!T||E&16)&&x!==(x=yr(L[4].mode)+"")&&kt(C,x)},i(L){T||(N(o.$$.fragment,L),N(h.$$.fragment,L),N(z),T=!0)},o(L){V(o.$$.fragment,L),V(h.$$.fragment,L),V(z),T=!1},d(L){L&&G(e),le(o),le(h),z&&z.d()}}}function $7(r){let e;return{c(){e=Me("Explore the origin/destination demand data used")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function N7(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,fe,Ee,ee;return t=new Us({props:{mode:{mode:r[0]}}}),u=new Fn({props:{mode:{mode:"debug-demand"},$$slots:{default:[$7]},$$scope:{ctx:r}}}),q=new ko({props:{colorScale:r[6],labels:{limits:["0%","50%","same","150%","200%"]}}}),fe=Pg(r[13][0]),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),o=Me(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),ue(u.$$.fragment),s=ie(),h=U("fieldset"),p=U("label"),g=U("input"),_=Me(`
        Calculate quickly`),x=ie(),C=U("label"),T=U("input"),z=Me(`
        Calculate more accurately`),L=ie(),E=U("p"),E.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,I=ie(),O=U("label"),B=Me(`Only show roads with at least this many daily trips before or after
      `),K=U("input"),H=ie(),ue(q.$$.fragment),he(g,"type","radio"),g.__value="fast",Wn(g,g.__value),he(T,"type","radio"),T.__value="accurate",Wn(T,T.__value),he(K,"type","number"),he(K,"min",0),he(e,"slot","sidebar"),fe.p(g,T)},m(oe,xe){W(oe,e,xe),ae(t,e,null),F(e,n),F(e,i),F(i,o),ae(u,i,null),F(e,s),F(e,h),F(h,p),F(p,g),g.checked=g.__value===r[3],F(p,_),F(h,x),F(h,C),F(C,T),T.checked=T.__value===r[3],F(C,z),F(e,L),F(e,E),F(e,I),F(e,O),F(O,B),F(O,K),Wn(K,r[5]),F(e,H),ae(q,e,null),J=!0,Ee||(ee=[Mt(g,"change",r[12]),Mt(g,"change",r[9]),Mt(T,"change",r[14]),Mt(T,"change",r[9]),Mt(K,"input",r[15])],Ee=!0)},p(oe,xe){const me={};xe&1&&(me.mode={mode:oe[0]}),t.$set(me);const tt={};xe&524288&&(tt.$$scope={dirty:xe,ctx:oe}),u.$set(tt),xe&8&&(g.checked=g.__value===oe[3]),xe&8&&(T.checked=T.__value===oe[3]),xe&32&&Dl(K.value)!==oe[5]&&Wn(K,oe[5])},i(oe){J||(N(t.$$.fragment,oe),N(u.$$.fragment,oe),N(q.$$.fragment,oe),J=!0)},o(oe){V(t.$$.fragment,oe),V(u.$$.fragment,oe),V(q.$$.fragment,oe),J=!1},d(oe){oe&&G(e),le(t),le(u),le(q),fe.r(),Ee=!1,cr(ee)}}}function j7(r){let e,t;const n=[_n("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Yi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function U7(r){let e,t=r[18].before.toLocaleString()+"",n,i,o=r[18].after.toLocaleString()+"",u,s,h,p,g=Math.round(100*r[18].after/r[18].before)+"",_,x;return{c(){e=U("p"),n=Me(t),i=Me(" before, "),u=Me(o),s=Me(`
            after`),h=ie(),p=U("p"),_=Me(g),x=Me("%")},m(C,T){W(C,e,T),F(e,n),F(e,i),F(e,u),F(e,s),W(C,h,T),W(C,p,T),F(p,_),F(p,x)},p(C,T){T&262144&&t!==(t=C[18].before.toLocaleString()+"")&&kt(n,t),T&262144&&o!==(o=C[18].after.toLocaleString()+"")&&kt(u,o),T&262144&&g!==(g=Math.round(100*C[18].after/C[18].before)+"")&&kt(_,g)},d(C){C&&(G(e),G(h),G(p))}}}function V7(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[U7,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function q7(r){let e,t,n,i;const o=[_n("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ed,r[2].max_count,1.5*Ld],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ed,r[2].max_count,Ld],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[6][0],50,r[6][1],100,r[6][2],150,r[6][3],200,r[6][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let h={$$slots:{default:[V7]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)h=zt(h,s[p]);return n=new ur({props:h}),n.$on("click",r[11]),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&36?In(o,[o[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&4&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ed,p[2].max_count,1.5*Ld],"line-color":"black"}}]):{};e.$set(_);const x=g&100?In(s,[s[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&68&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ed,p[2].max_count,Ld],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[6][0],50,p[6][1],100,p[6][2],150,p[6][3],200,p[6][4]]]}},s[3],s[4]]):{};g&524288&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function H7(r){let e,t,n,i,o,u,s;return t=new _r({props:{data:r[7],$$slots:{default:[j7]},$$scope:{ctx:r}}}),i=new _r({props:{data:r[2],generateId:!0,$$slots:{default:[q7]},$$scope:{ctx:r}}}),u=new tl({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),he(e,"slot","map")},m(h,p){W(h,e,p),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),ae(u,e,null),s=!0},p(h,p){const g={};p&524288&&(g.$$scope={dirty:p,ctx:h}),t.$set(g);const _={};p&4&&(_.data=h[2]),p&524324&&(_.$$scope={dirty:p,ctx:h}),i.$set(_)},i(h){s||(N(t.$$.fragment,h),N(i.$$.fragment,h),N(u.$$.fragment,h),s=!0)},o(h){V(t.$$.fragment,h),V(i.$$.fragment,h),V(u.$$.fragment,h),s=!1},d(h){h&&G(e),le(t),le(i),le(u)}}}function G7(r){let e,t,n,i;return e=new uh({props:{loading:r[1]}}),n=new So({props:{$$slots:{map:[H7],sidebar:[N7],top:[O7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const h={};u&524349&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}let Ed=3,Ld=10;function W7(r,e,t){let n,i,o,u;st(r,Ym,K=>t(10,n=K)),st(r,kr,K=>t(16,i=K)),st(r,tr,K=>t(4,o=K)),st(r,ey,K=>t(5,u=K));let{prevMode:s}=e,h=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],p="",g={type:"FeatureCollection",features:[],max_count:1},_=i.getAllNeighbourhoods();function x(K){ln(tr,o={mode:"impact-detail",road:K,prevPrevMode:s},o)}async function C(K){t(1,p="Calculating impact"),await new Promise(H=>{requestAnimationFrame(()=>{requestAnimationFrame(H)})}),t(2,g=i.predictImpact(K)),t(1,p="")}let T=n?"fast":"accurate";function z(){ln(Ym,n=T=="fast",n)}const L=[[]],E=K=>x(K.detail.features[0]);function I(){T=this.__value,t(3,T)}function O(){T=this.__value,t(3,T)}function B(){u=Dl(this.value),ey.set(u)}return r.$$set=K=>{"prevMode"in K&&t(0,s=K.prevMode)},r.$$.update=()=>{r.$$.dirty&1024&&C(n)},[s,p,g,T,o,u,h,_,x,z,n,E,I,L,O,B]}class Z7 extends Lt{constructor(e){super(),Et(this,e,W7,G7,St,{prevMode:0})}}function Ab(r){let e,t,n;return t=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function X7(r){let e,t,n,i,o,u,s,h,p,g,_,x=yr(r[7].mode)+"",C,T;o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}});let z=r[0]=="neighbourhood"&&Ab();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),z&&z.c(),g=ie(),_=U("li"),C=Me(x),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,E){W(L,e,E),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),z&&z.m(n,null),F(n,g),F(n,_),F(_,C),T=!0},p(L,E){L[0]=="neighbourhood"?z?E&1&&N(z,1):(z=Ab(),z.c(),N(z,1),z.m(n,g)):z&&(Kt(),V(z,1,1,()=>{z=null}),Jt()),(!T||E&128)&&x!==(x=yr(L[7].mode)+"")&&kt(C,x)},i(L){T||(N(o.$$.fragment,L),N(h.$$.fragment,L),N(z),T=!0)},o(L){V(o.$$.fragment,L),V(h.$$.fragment,L),V(z),T=!1},d(L){L&&G(e),le(o),le(h),z&&z.d()}}}function K7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function J7(r){let e,t=Ua(r[6].properties.distance)+"",n,i,o=Va(r[6].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,h){W(s,e,h),F(e,n),F(e,i),F(e,u)},p(s,h){h&64&&t!==(t=Ua(s[6].properties.distance)+"")&&kt(n,t),h&64&&o!==(o=Va(s[6].properties.time)+"")&&kt(u,o)},d(s){s&&G(e)}}}function Y7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function Q7(r){let e,t=Ua(r[5].properties.distance)+"",n,i,o=Va(r[5].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,h){W(s,e,h),F(e,n),F(e,i),F(e,u)},p(s,h){h&32&&t!==(t=Ua(s[5].properties.distance)+"")&&kt(n,t),h&32&&o!==(o=Va(s[5].properties.time)+"")&&kt(u,o)},d(s){s&&G(e)}}}function eD(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I,O,B,K;t=new Us({props:{mode:{mode:r[0]}}});function H(oe,xe){return oe[6]?J7:K7}let q=H(r),J=q(r);function fe(oe,xe){return oe[5]?Q7:Y7}let Ee=fe(r),ee=Ee(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),i.textContent="Drag markers for a route",o=ie(),u=U("u"),u.textContent="Route before changes",s=ie(),J.c(),h=ie(),p=U("u"),p.textContent="Route after changes",g=ie(),ee.c(),_=ie(),x=U("label"),C=Me("Slow-down factor for main roads: "),T=Me(r[2]),z=ie(),L=U("input"),E=ie(),I=U("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ye(u,"color","red"),Ye(p,"color","blue"),he(L,"type","range"),he(L,"min","1.0"),he(L,"max","5.0"),he(L,"step","0.1"),he(e,"slot","sidebar")},m(oe,xe){W(oe,e,xe),ae(t,e,null),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),J.m(e,null),F(e,h),F(e,p),F(e,g),ee.m(e,null),F(e,_),F(e,x),F(x,C),F(x,T),F(x,z),F(x,L),Wn(L,r[2]),F(e,E),F(e,I),O=!0,B||(K=[Mt(L,"change",r[11]),Mt(L,"input",r[11])],B=!0)},p(oe,xe){const me={};xe&1&&(me.mode={mode:oe[0]}),t.$set(me),q===(q=H(oe))&&J?J.p(oe,xe):(J.d(1),J=q(oe),J&&(J.c(),J.m(e,h))),Ee===(Ee=fe(oe))&&ee?ee.p(oe,xe):(ee.d(1),ee=Ee(oe),ee&&(ee.c(),ee.m(e,_))),(!O||xe&4)&&kt(T,oe[2]),xe&4&&Wn(L,oe[2])},i(oe){O||(N(t.$$.fragment,oe),O=!0)},o(oe){V(t.$$.fragment,oe),O=!1},d(oe){oe&&G(e),le(t),J.d(),ee.d(),B=!1,cr(K)}}}function kb(r){let e,t;return e=new hh({props:{$$slots:{default:[tD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function tD(r){let e,t,n,i,o,u,s,h;return e=new _p({}),n=new gp({}),o=new yp({}),s=new fh({props:{interactive:!1}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),h=!0},p:at,i(p){h||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),h=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),h=!1},d(p){p&&(G(t),G(i),G(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function nD(r){let e,t;const n=[_n("compare-route"),{paint:{"line-width":10,"line-color":jo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function rD(r){let e;return{c(){e=Me("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function iD(r){let e;return{c(){e=Me("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function oD(r){let e,t,n,i,o,u,s,h,p,g,_,x,C=r[0]=="neighbourhood"&&kb(r);n=new tl({props:{interactive:!1}}),o=new _r({props:{data:r[1],$$slots:{default:[nD]},$$scope:{ctx:r}}});function T(I){r[9](I)}let z={draggable:!0,$$slots:{default:[rD]},$$scope:{ctx:r}};r[4]!==void 0&&(z.lngLat=r[4]),s=new Fl({props:z}),dn.push(()=>Dn(s,"lngLat",T));function L(I){r[10](I)}let E={draggable:!0,$$slots:{default:[iD]},$$scope:{ctx:r}};return r[3]!==void 0&&(E.lngLat=r[3]),g=new Fl({props:E}),dn.push(()=>Dn(g,"lngLat",L)),{c(){e=U("div"),C&&C.c(),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),p=ie(),ue(g.$$.fragment),he(e,"slot","map")},m(I,O){W(I,e,O),C&&C.m(e,null),F(e,t),ae(n,e,null),F(e,i),ae(o,e,null),F(e,u),ae(s,e,null),F(e,p),ae(g,e,null),x=!0},p(I,O){I[0]=="neighbourhood"?C?O&1&&N(C,1):(C=kb(I),C.c(),N(C,1),C.m(e,t)):C&&(Kt(),V(C,1,1,()=>{C=null}),Jt());const B={};O&2&&(B.data=I[1]),O&4096&&(B.$$scope={dirty:O,ctx:I}),o.$set(B);const K={};O&4096&&(K.$$scope={dirty:O,ctx:I}),!h&&O&16&&(h=!0,K.lngLat=I[4],zn(()=>h=!1)),s.$set(K);const H={};O&4096&&(H.$$scope={dirty:O,ctx:I}),!_&&O&8&&(_=!0,H.lngLat=I[3],zn(()=>_=!1)),g.$set(H)},i(I){x||(N(C),N(n.$$.fragment,I),N(o.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),x=!0)},o(I){V(C),V(n.$$.fragment,I),V(o.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),x=!1},d(I){I&&G(e),C&&C.d(),le(n),le(o),le(s),le(g)}}}function sD(r){let e,t;return e=new So({props:{$$slots:{map:[oD],sidebar:[eD],top:[X7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function aD(r,e,t){let n,i,o,u,s,h,p,g;st(r,Y0,z=>t(2,u=z)),st(r,Pf,z=>t(3,s=z)),st(r,If,z=>t(4,h=z)),st(r,kr,z=>t(8,p=z)),st(r,tr,z=>t(7,g=z));let{prevMode:_}=e;ks(()=>{setTimeout(()=>{eg(If),eg(Pf)},10)});function x(z){h=z,If.set(h)}function C(z){s=z,Pf.set(s)}function T(){u=Dl(this.value),Y0.set(u)}return r.$$set=z=>{"prevMode"in z&&t(0,_=z.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=p.compareRoute(h,s,u)),r.$$.dirty&2&&t(6,i=n.features.find(z=>z.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(z=>z.properties.kind=="after"))},[_,n,u,s,h,o,i,g,p,x,C,T]}class lD extends Lt{constructor(e){super(),Et(this,e,aD,sD,St,{prevMode:0})}}function uD(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T=yr(r[2].mode)+"",z,L;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Me(T),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(E,I){W(E,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,z),L=!0},p(E,I){(!L||I&4)&&T!==(T=yr(E[2].mode)+"")&&kt(z,T)},i(E){L||(N(o.$$.fragment,E),N(h.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(h.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(h),le(_)}}}function cD(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E,I;t=new Us({props:{mode:{mode:"neighbourhood"}}});function O(H){r[8](H)}function B(H){r[9](H)}let K={map:mr(r[3])};return r[0]!==void 0&&(K.waypoints=r[0]),r[1]!==void 0&&(K.drawnShapeOut=r[1]),u=new V2({props:K}),dn.push(()=>Dn(u,"waypoints",O)),dn.push(()=>Dn(u,"drawnShapeOut",B)),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("h1"),i.textContent="Adjust boundary",o=ie(),ue(u.$$.fragment),p=ie(),g=U("div"),_=U("button"),x=Me("Finish"),T=ie(),z=U("button"),z.textContent="Cancel",_.disabled=C=r[0].length<3,he(z,"class","secondary"),Ye(g,"display","flex"),Ye(g,"gap","16px"),he(e,"slot","sidebar")},m(H,q){W(H,e,q),ae(t,e,null),F(e,n),F(e,i),F(e,o),ae(u,e,null),F(e,p),F(e,g),F(g,_),F(_,x),F(g,T),F(g,z),L=!0,E||(I=[Mt(_,"click",r[4]),Mt(z,"click",r[5])],E=!0)},p(H,q){const J={};q&8&&(J.map=mr(H[3])),!s&&q&1&&(s=!0,J.waypoints=H[0],zn(()=>s=!1)),!h&&q&2&&(h=!0,J.drawnShapeOut=H[1],zn(()=>h=!1)),u.$set(J),(!L||q&1&&C!==(C=H[0].length<3))&&(_.disabled=C)},i(H){L||(N(t.$$.fragment,H),N(u.$$.fragment,H),L=!0)},o(H){V(t.$$.fragment,H),V(u.$$.fragment,H),L=!1},d(H){H&&G(e),le(t),le(u),E=!1,cr(I)}}}function fD(r){let e,t;return e=new So({props:{$$slots:{sidebar:[cD],top:[uD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4111&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hD(r,e,t){let n,i,o;st(r,tr,z=>t(2,n=z)),st(r,kr,z=>t(11,i=z)),st(r,as,z=>t(3,o=z));let{name:u}=e,{existing:s}=e,h=[],p,g=s.properties.waypoints;if(!g){let z={type:"LineString",coordinates:s.geometry.coordinates[1]};g=i.extractWaypointsFromRing(z)}h=g.map(z=>({point:[z.lon,z.lat],snapped:z.snapped}));function _(){if(p)try{i.setCurrentNeighbourhoodBoundary(u,p),qf(),ln(tr,n={mode:"neighbourhood"},n)}catch(z){window.alert(`Sorry, this boundary is invalid: ${z}`),x()}}function x(){ln(tr,n={mode:"neighbourhood"},n)}function C(z){h=z,t(0,h)}function T(z){p=z,t(1,p)}return r.$$set=z=>{"name"in z&&t(6,u=z.name),"existing"in z&&t(7,s=z.existing)},[h,p,n,o,_,x,u,s,C,T]}class dD extends Lt{constructor(e){super(),Et(this,e,hD,fD,St,{name:6,existing:7})}}const pD=["==",["geometry-type"],"Polygon"],mD=["==",["geometry-type"],"LineString"],gD=["==",["geometry-type"],"Point"];function J2(){return{type:"FeatureCollection",features:[]}}function Um(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Y2(r)}}}function Y2(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Q2=En(J2()),ex=En(0),_D=100;class yD{constructor(e){Qn(this,"map");Qn(this,"active");Qn(this,"eventListenersSuccess");Qn(this,"eventListenersUpdated");Qn(this,"eventListenersFailure");Qn(this,"points");Qn(this,"cursor");Qn(this,"hover");Qn(this,"dragFrom");Qn(this,"previousStates");Qn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Qn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Sb(this.points).forEach((n,i)=>{t.push([i+1,h3(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Qn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Um(e.lngLat.toArray()),this.onClick(e),this.finish())});Qn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Qn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Qn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Qn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=J2();this.points.forEach((i,o)=>{let u=Um(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(Sb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Q2.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,ex.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Um(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Y2),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>_D&&this.previousStates.shift()}}function Sb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function vD(r){let e,t,n;return{c(){e=Me("Undo ("),t=Me(r[1]),n=Me(")")},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o&2&&kt(t,i[1])},d(i){i&&(G(e),G(t),G(n))}}}function bD(r){let e;return{c(){e=Me("Undo")},m(t,n){W(t,e,n)},p:at,d(t){t&&G(e)}}}function wD(r){let e,t,n,i,o,u,s,h,p,g,_;function x(z,L){return z[1]==0?bD:vD}let C=x(r),T=C(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=ie(),i=U("button"),i.textContent="Cancel",o=ie(),u=U("button"),T.c(),h=ie(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=s=r[1]==0,Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(z,L){W(z,e,L),F(e,t),F(e,n),F(e,i),F(e,o),F(e,u),T.m(u,null),W(z,h,L),W(z,p,L),g||(_=[Mt(t,"click",r[2]),Mt(i,"click",r[3]),Mt(u,"click",r[4])],g=!0)},p(z,[L]){C===(C=x(z))&&T?T.p(z,L):(T.d(1),T=C(z),T&&(T.c(),T.m(u,null))),L&2&&s!==(s=z[1]==0)&&(u.disabled=s)},i:at,o:at,d(z){z&&(G(e),G(h),G(p)),T.d(),g=!1,cr(_)}}}function xD(r,e,t){let n;st(r,ex,h=>t(1,n=h));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),s=()=>i.undo();return r.$$set=h=>{"polygonTool"in h&&t(0,i=h.polygonTool)},[i,n,o,u,s]}class AD extends Lt{constructor(e){super(),Et(this,e,xD,wD,St,{polygonTool:0})}}let kD=Date.now();function dh(r){return`${r}-${kD++}`}const tx=Symbol.for("svelte-maplibre");function SD(){return Qf(tx)}function Cb(r){return{subscribe:r.subscribe}}function nx({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=SD(),o=En(null),u=Cb(o),s={...i,[r]:Cb(o)};if(e&&(s.popupTarget=u),n){let h=En(null);s.layerEvent=h,i.layerEvent=h}return t&&(s.cluster=En()),ip(tx,s),{...i,self:o}}function CD(){return nx({key:"source",setCluster:!0})}function TD(r=!0){return nx({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Tb(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function MD(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function ED(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Mb(r){let e=r[0],t,n,i=Eb(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=Eb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Eb(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function LD(r){let e,t,n=r[0]&&Mb(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Mb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function ID(r,e,t){let n,i,o,u,s,h,p,g,_,x,C,T,{$$slots:z={},$$scope:L}=e,{id:E=dh("layer")}=e,{source:I=void 0}=e,{sourceLayer:O=void 0}=e,{beforeId:B=void 0}=e,{beforeLayerType:K=void 0}=e,{type:H}=e,{paint:q=void 0}=e,{layout:J=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:Ee=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:oe=void 0}=e,{manageHoverState:xe=!1}=e,{hovered:me=null}=e,{interactive:tt=!0}=e,{hoverCursor:Ue=void 0}=e,{eventsIfTopMost:ze=!1}=e;const Ie=js(),{map:ct,source:Xe,self:lt,minzoom:pt,maxzoom:_t,eventTopMost:He,layerInfo:gt}=TD();st(r,ct,qe=>t(31,_=qe)),st(r,Xe,qe=>t(32,x=qe)),st(r,lt,qe=>t(0,g=qe)),st(r,pt,qe=>t(34,T=qe)),st(r,_t,qe=>t(33,C=qe)),ri(()=>{g&&_&&(gt.delete(g),_==null||_.removeLayer(g))});let Pt;function jt(qe){var de,cn;if(!tt||!g||!_||ze&&He(qe)!==g)return;let Ge=qe.features??[],At=(cn=(de=Ge[0])==null?void 0:de.properties)==null?void 0:cn.cluster_id,nt={event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge};Ie(qe.type,nt)}function un(qe){var de,cn;if(!tt||!g||!_||ze&&He(qe)!==g)return;Ue&&(_.getCanvas().style.cursor=Ue);let Ge=qe.features??[];t(6,me=Ge[0]??null);let At=(cn=(de=Ge[0])==null?void 0:de.properties)==null?void 0:cn.cluster_id;Ie("mouseenter",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function nn(qe){var de,cn,Ke;if(!tt||!_)return;if(ze&&He(qe)!==g){t(6,me=null),xe&&Pt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:O,id:Pt},{hover:!1}),Pt=void 0);return}_.getCanvas().style.cursor=Ue;let Ge=qe.features??[],At=(cn=(de=Ge[0])==null?void 0:de.properties)==null?void 0:cn.cluster_id,nt=(Ke=Ge[0])==null?void 0:Ke.id;nt!==Pt&&(xe&&(Pt!==void 0&&(_==null||_.setFeatureState({source:s,id:Pt,sourceLayer:O},{hover:!1})),_==null||_.setFeatureState({source:s,id:nt,sourceLayer:O},{hover:!0})),Pt=nt,t(6,me=Ge[0]??null)),Ie("mousemove",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function rn(qe){if(!(!tt||!g||!_)){if(Ue&&(_.getCanvas().style.cursor=""),t(6,me=null),xe&&Pt!==void 0){const Ge={source:s,id:Pt,sourceLayer:O};_==null||_.setFeatureState(Ge,{hover:!1}),Pt=void 0}Ie("mouseleave",{map:_,layer:g,source:s})}}let pn=!0;function yn(qe){_&&(_.off("click",qe,jt),_.off("dblclick",qe,jt),_.off("contextmenu",qe,jt),_.off("mouseenter",qe,un),_.off("mousemove",qe,nn),_.off("mouseleave",qe,rn))}return ri(()=>{_&&g&&yn(g)}),r.$$set=qe=>{"id"in qe&&t(7,E=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,O=qe.sourceLayer),"beforeId"in qe&&t(10,B=qe.beforeId),"beforeLayerType"in qe&&t(11,K=qe.beforeLayerType),"type"in qe&&t(12,H=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,J=qe.layout),"filter"in qe&&t(15,fe=qe.filter),"applyToClusters"in qe&&t(16,Ee=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,oe=qe.maxzoom),"manageHoverState"in qe&&t(19,xe=qe.manageHoverState),"hovered"in qe&&t(6,me=qe.hovered),"interactive"in qe&&t(20,tt=qe.interactive),"hoverCursor"in qe&&t(21,Ue=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,ze=qe.eventsIfTopMost),"$$scope"in qe&&t(35,L=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=ED(Ee)),r.$$.dirty[0]&1073774592&&t(24,i=MD("all",n,fe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=oe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=I||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==E&&s){g&&(yn(g),gt.delete(g));let qe=B;if(!B&&K){let Ge=_.getStyle().layers,At=typeof K=="function"?K:de=>de.type===K,nt=Ge==null?void 0:Ge.find(At);nt&&(qe=nt.id)}ln(lt,g=E,g),_.addLayer(ja({id:g,type:H,source:s,"source-layer":O,filter:i,paint:q,layout:J,minzoom:o,maxzoom:u}),qe),t(23,pn=!0),_.on("click",g,jt),_.on("dblclick",g,jt),_.on("contextmenu",g,jt),_.on("mouseenter",g,un),_.on("mousemove",g,nn),_.on("mouseleave",g,rn)}r.$$.dirty[0]&1048577&&g&&gt.set(g,{interactive:tt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,h=g?Tb((qe,Ge)=>_==null?void 0:_.setPaintProperty(g,qe,Ge)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Tb((qe,Ge)=>_==null?void 0:_.setLayoutProperty(g,qe,Ge)):void 0),r.$$.dirty[0]&268443648&&(h==null||h(q)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(pn?t(23,pn=!1):_==null||_.setFilter(g,i))},[g,ct,Xe,lt,pt,_t,me,E,I,O,B,K,H,q,J,fe,Ee,ee,oe,xe,tt,Ue,ze,pn,i,u,o,p,h,s,n,_,x,C,T,L,z]}class h_ extends Lt{constructor(e){super(),Et(this,e,ID,LD,St,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function PD(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function zD(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[PD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new h_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.applyToClusters=u[9]),s&1024&&(h.minzoom=u[10]),s&2048&&(h.maxzoom=u[11]),s&4096&&(h.hoverCursor=u[12]),s&8192&&(h.manageHoverState=u[13]),s&16384&&(h.eventsIfTopMost=u[14]),s&32768&&(h.interactive=u[15]),s&16777216&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function DD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=dh("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:B=!0}=e;function K(oe){I=oe,t(0,I)}function H(oe){Pn.call(this,r,oe)}function q(oe){Pn.call(this,r,oe)}function J(oe){Pn.call(this,r,oe)}function fe(oe){Pn.call(this,r,oe)}function Ee(oe){Pn.call(this,r,oe)}function ee(oe){Pn.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,o=oe.id),"source"in oe&&t(2,u=oe.source),"sourceLayer"in oe&&t(3,s=oe.sourceLayer),"beforeId"in oe&&t(4,h=oe.beforeId),"beforeLayerType"in oe&&t(5,p=oe.beforeLayerType),"paint"in oe&&t(6,g=oe.paint),"layout"in oe&&t(7,_=oe.layout),"filter"in oe&&t(8,x=oe.filter),"applyToClusters"in oe&&t(9,C=oe.applyToClusters),"minzoom"in oe&&t(10,T=oe.minzoom),"maxzoom"in oe&&t(11,z=oe.maxzoom),"hoverCursor"in oe&&t(12,L=oe.hoverCursor),"manageHoverState"in oe&&t(13,E=oe.manageHoverState),"hovered"in oe&&t(0,I=oe.hovered),"eventsIfTopMost"in oe&&t(14,O=oe.eventsIfTopMost),"interactive"in oe&&t(15,B=oe.interactive),"$$scope"in oe&&t(24,i=oe.$$scope)},[I,o,u,s,h,p,g,_,x,C,T,z,L,E,O,B,n,K,H,q,J,fe,Ee,ee,i]}class RD extends Lt{constructor(e){super(),Et(this,e,DD,zD,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function BD(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function FD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[BD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new h_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.minzoom=u[9]),s&1024&&(h.maxzoom=u[10]),s&2048&&(h.hoverCursor=u[11]),s&4096&&(h.manageHoverState=u[12]),s&8192&&(h.eventsIfTopMost=u[13]),s&16384&&(h.interactive=u[14]),s&8388608&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function OD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=dh("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(ee){E=ee,t(0,E)}function K(ee){Pn.call(this,r,ee)}function H(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,h=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,z=ee.hoverCursor),"manageHoverState"in ee&&t(12,L=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,h,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,fe,Ee,i]}class $D extends Lt{constructor(e){super(),Et(this,e,OD,FD,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function ND(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function jD(r,e,t){Yb().then(()=>{let n=pi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Lb(r){let e=r[0],t,n,i=Ib(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=Ib(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Ib(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function UD(r){let e,t,n=r[0]&&Lb(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Lb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function VD(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:h=dh("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e;const{map:z,cluster:L,self:E}=CD();st(r,z,B=>t(13,i=B)),st(r,L,B=>t(16,o=B)),st(r,E,B=>t(0,n=B));let I,O=!0;return ri(()=>{n&&I&&i&&(jD(z,n,I),ln(E,n=null,n),t(11,I=void 0))}),r.$$set=B=>{"id"in B&&t(4,h=B.id),"data"in B&&t(5,p=B.data),"generateId"in B&&t(6,g=B.generateId),"promoteId"in B&&t(7,_=B.promoteId),"filter"in B&&t(8,x=B.filter),"lineMetrics"in B&&t(9,C=B.lineMetrics),"cluster"in B&&t(10,T=B.cluster),"$$scope"in B&&t(14,s=B.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ln(L,o=T,o),r.$$.dirty&12273&&i&&n!==h&&(ln(E,n=h,n),ND(i,n,ja({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties}),B=>i&&B===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,O=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(h))})),r.$$.dirty&6176&&I&&(O?t(12,O=!1):I.setData(p)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(ja({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,z,L,E,h,p,g,_,x,C,T,I,O,i,s,u]}class qD extends Lt{constructor(e){super(),Et(this,e,VD,UD,St,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function HD(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function GD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[HD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new h_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const h={};s&2&&(h.id=u[1]),s&4&&(h.source=u[2]),s&8&&(h.sourceLayer=u[3]),s&16&&(h.beforeId=u[4]),s&32&&(h.beforeLayerType=u[5]),s&64&&(h.paint=u[6]),s&128&&(h.layout=u[7]),s&256&&(h.filter=u[8]),s&512&&(h.minzoom=u[9]),s&1024&&(h.maxzoom=u[10]),s&2048&&(h.hoverCursor=u[11]),s&4096&&(h.manageHoverState=u[12]),s&8192&&(h.eventsIfTopMost=u[13]),s&16384&&(h.interactive=u[14]),s&8388608&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.hovered=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function WD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=dh("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:h=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(ee){E=ee,t(0,E)}function K(ee){Pn.call(this,r,ee)}function H(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,h=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,z=ee.hoverCursor),"manageHoverState"in ee&&t(12,L=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,h,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,fe,Ee,i]}class ZD extends Lt{constructor(e){super(),Et(this,e,WD,GD,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function XD(r){let e,t,n,i,o,u;return e=new $D({props:{id:"edit-polygon-fill",filter:pD,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new ZD({props:{id:"edit-polygon-lines",filter:mD,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new RD({props:{id:"edit-polygon-vertices",filter:gD,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment)},m(s,h){ae(e,s,h),W(s,t,h),ae(n,s,h),W(s,i,h),ae(o,s,h),u=!0},p:at,i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),le(e,s),le(n,s),le(o,s)}}}function KD(r){let e,t;return e=new qD({props:{data:r[0],$$slots:{default:[XD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function JD(r,e,t){let n;return st(r,Q2,i=>t(0,n=i)),[n]}class YD extends Lt{constructor(e){super(),Et(this,e,JD,KD,St,{})}}function QD(r){let e,t,n,i,o,u,s;return{c(){e=U("button"),e.textContent="Import current view",t=ie(),n=U("i"),n.textContent="or...",i=ie(),o=U("button"),o.textContent="Draw an area to import on the map",he(e,"type","button"),he(o,"type","button")},m(h,p){W(h,e,p),W(h,t,p),W(h,n,p),W(h,i,p),W(h,o,p),u||(s=[Mt(e,"click",r[2]),Mt(o,"click",r[3])],u=!0)},p:at,i:at,o:at,d(h){h&&(G(e),G(t),G(n),G(i),G(o)),u=!1,cr(s)}}}function eR(r){let e,t;return e=new AD({props:{polygonTool:r[0]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function tR(r){let e,t,n,i,o,u,s,h,p;const g=[eR,QD],_=[];function x(C,T){return C[0]?0:1}return e=x(r),t=_[e]=g[e](r),{c(){t.c(),n=ie(),i=U("label"),o=U("input"),u=Me(`Save a copy of the osm.xml
  after importing`),he(o,"type","checkbox")},m(C,T){_[e].m(C,T),W(C,n,T),W(C,i,T),F(i,o),o.checked=r[1],F(i,u),s=!0,h||(p=Mt(o,"change",r[5]),h=!0)},p(C,[T]){let z=e;e=x(C),e===z?_[e].p(C,T):(Kt(),V(_[z],1,1,()=>{_[z]=null}),Jt(),t=_[e],t?t.p(C,T):(t=_[e]=g[e](C),t.c()),N(t,1),t.m(n.parentNode,n)),T&2&&(o.checked=C[1])},i(C){s||(N(t),s=!0)},o(C){V(t),s=!1},d(C){C&&(G(n),G(i)),_[e].d(C),h=!1,p()}}}function bf(r){return[r.lng,r.lat]}function nR(r,e,t){let{map:n}=e;const i=js();let o=null,u=!1;async function s(x){try{i("loading","Loading from Overpass");let T=await(await fetch(rx(x))).text();u&&op("osm.xml",T),i("gotXml",{xml:T,boundary:x})}catch(C){i("error",C.toString())}}function h(){let x=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[bf(x.getSouthWest()),bf(x.getNorthWest()),bf(x.getNorthEast()),bf(x.getSouthEast()),bf(x.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await s(h())}}function g(){n&&(t(0,o=new yD(n)),o.startNew(),o.addEventListenerSuccess(async x=>{t(0,o=null),await s(x)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function _(){u=this.checked,t(1,u)}return r.$$set=x=>{"map"in x&&t(4,n=x.map)},[o,u,p,g,n,_]}class rR extends Lt{constructor(e){super(),Et(this,e,nR,tR,St,{map:4})}}function rx(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class ix{constructor(e,t,n,i,o,u,s,h){Qn(this,"inner");this.inner=new oI(e,t||new Uint8Array,n||new Uint8Array,i,o,u,s,h)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setCurrentNeighbourhoodBoundary(e,t){this.inner.setCurrentNeighbourhoodBoundary(e,t)}extractWaypointsFromRing(e){let t=this.inner.extractWaypointsFromRing(e);return JSON.parse(t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}reclassifyRoadsAlongLine(e,t,n){this.inner.reclassifyRoadsAlongLine(e,t,n)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=t1(t.properties.counts_from),t.properties.sum_to=t1(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}getMetricBuckets(){try{return JSON.parse(this.inner.getMetricBuckets())}catch{return null}}}async function vp(r){let e=pi(Wa).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await iR(e);console.timeEnd("get input files"),console.time("load"),kr.set(new ix(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),pi(kr).loadSavefile(e),$s.set(r),console.timeEnd("load"),ox(r)}catch(t){window.alert(`Couldn't open project: ${t}`),$s.set(void 0)}}async function iR(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=No(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await Da(e)).arrayBuffer(),i=No(`cnt_boundaries/${r.study_area_name}.geojson`),u=await(await Da(i)).json(),s=No(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${s}`);let h;try{h=await(await Da(s)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let p=No(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let g;try{g=await(await Da(p)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:n,boundary:u,demandBuffer:h,contextDataBuffer:g}}else if(r.study_area_name){let e=No(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await Da(e)).arrayBuffer(),i=No(`boundaries/${r.study_area_name}.geojson`),u=await(await Da(i)).json();return{osmBuffer:n,boundary:u}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await Da(rx(e))).arrayBuffer(),boundary:e}}}function ox(r){rp.set(new p3(pi(as),pi(kr).toRouteSnapper(),En(eo()),En(!0),En(0))),pi(as).fitBounds(pi(kr).getBounds(),{duration:500});let e=pi(kr).getMetricBuckets();e&&nh.set(e);let t=new URL(window.location.href);t.searchParams.set("project",r),window.history.replaceState(null,"",t.toString())}function Pb(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function zb(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function oR(r){let e,t,n,i,o,u,s,h=yr(r[5].mode)+"",p,g;return o=new Fn({props:{mode:{mode:"title"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),p=Me(h),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(_,x){W(_,e,x),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),F(s,p),g=!0},p(_,x){(!g||x&32)&&h!==(h=yr(_[5].mode)+"")&&kt(p,h)},i(_){g||(N(o.$$.fragment,_),g=!0)},o(_){V(o.$$.fragment,_),g=!1},d(_){_&&G(e),le(o)}}}function Db(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T;e=new uh({props:{loading:r[4]}});let z=On(r[3]),L=[];for(let E=0;E<z.length;E+=1)L[E]=Bb(Pb(r,z,E));return _=new rR({props:{map:r[6]}}),_.$on("gotXml",r[7]),_.$on("loading",r[11]),_.$on("error",r[12]),{c(){ue(e.$$.fragment),t=ie(),n=U("label"),i=Me(`Load a built-in area:
        `),o=U("select"),u=U("option");for(let E=0;E<L.length;E+=1)L[E].c();s=ie(),h=U("i"),h.textContent="or...",p=ie(),g=U("div"),ue(_.$$.fragment),u.__value="",Wn(u,u.__value),r[2]===void 0&&ys(()=>r[9].call(o))},m(E,I){ae(e,E,I),W(E,t,I),W(E,n,I),F(n,i),F(n,o),F(o,u);for(let O=0;O<L.length;O+=1)L[O]&&L[O].m(o,null);Ki(o,r[2],!0),W(E,s,I),W(E,h,I),W(E,p,I),W(E,g,I),ae(_,g,null),x=!0,C||(T=[Mt(o,"change",r[9]),Mt(o,"change",r[10])],C=!0)},p(E,I){const O={};if(I&16&&(O.loading=E[4]),e.$set(O),I&8){z=On(E[3]);let K;for(K=0;K<z.length;K+=1){const H=Pb(E,z,K);L[K]?L[K].p(H,I):(L[K]=Bb(H),L[K].c(),L[K].m(o,null))}for(;K<L.length;K+=1)L[K].d(1);L.length=z.length}I&12&&Ki(o,E[2]);const B={};I&64&&(B.map=E[6]),_.$set(B)},i(E){x||(N(e.$$.fragment,E),N(_.$$.fragment,E),x=!0)},o(E){V(e.$$.fragment,E),V(_.$$.fragment,E),x=!1},d(E){E&&(G(t),G(n),G(s),G(h),G(p),G(g)),le(e,E),_i(L,E),le(_),C=!1,cr(T)}}}function Rb(r){let e,t=r[22]+"",n,i;return{c(){e=U("option"),n=Me(t),e.__value=i=r[21],Wn(e,e.__value)},m(o,u){W(o,e,u),F(e,n)},p(o,u){u&8&&t!==(t=o[22]+"")&&kt(n,t),u&8&&i!==(i=o[21])&&(e.__value=i,Wn(e,e.__value))},d(o){o&&G(e)}}}function Bb(r){let e,t,n=On(r[18]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Rb(zb(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();he(e,"label",t=r[17])},m(o,u){W(o,e,u);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(e,null)},p(o,u){if(u&8){n=On(o[18]);let s;for(s=0;s<n.length;s+=1){const h=zb(o,n,s);i[s]?i[s].p(h,u):(i[s]=Rb(h),i[s].c(),i[s].m(e,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}u&8&&t!==(t=o[17])&&he(e,"label",t)},d(o){o&&G(e),_i(i,o)}}}function sR(r){let e,t,n,i,o,u,s,h,p,g=r[1]&&Db(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=Me(`Project name:
        `),o=U("input"),u=ie(),g&&g.c(),he(o,"type","text"),he(e,"slot","sidebar")},m(_,x){W(_,e,x),F(e,t),F(t,n),F(n,i),F(n,o),Wn(o,r[1]),F(e,u),g&&g.m(e,null),s=!0,h||(p=Mt(o,"input",r[8]),h=!0)},p(_,x){x&2&&o.value!==_[1]&&Wn(o,_[1]),_[1]?g?(g.p(_,x),x&2&&N(g,1)):(g=Db(_),g.c(),N(g,1),g.m(e,null)):g&&(Kt(),V(g,1,1,()=>{g=null}),Jt())},i(_){s||(N(g),s=!0)},o(_){V(g),s=!1},d(_){_&&G(e),g&&g.d(),h=!1,p()}}}function aR(r){let e,t,n;return t=new YD({}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","map")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function lR(r){let e,t;return e=new So({props:{$$slots:{map:[aR],sidebar:[sR],top:[oR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&33554558&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function uR(r,e,t){let n,i,o,u,s,h;st(r,tr,B=>t(5,n=B)),st(r,Wa,B=>t(13,i=B)),st(r,$s,B=>t(14,o=B)),st(r,kr,B=>t(15,u=B)),st(r,As,B=>t(16,s=B)),st(r,as,B=>t(6,h=B));let p="",g=null,_=[],x="";ks(async()=>{let B=await Da(No("severance_pbfs/areas.json"));t(3,_=await B.json())});async function C(B){t(4,x="Loading OSM");try{let K;ln(kr,u=new ix(new TextEncoder().encode(B.detail.xml),void 0,void 0,B.detail.boundary,s,K,p,i.dbSchemaVersion),u);const H=i.createProject(u.toSavefile());ln($s,o=H,o),ox(H),ln(tr,n={mode:"add-neighbourhood"},n)}catch(K){window.alert(`Couldn't import from Overpass: ${K}`)}t(4,x="")}async function T(){if(!g)return;let B;try{B=i.createEmptyProject(p,g)}catch(K){t(2,g=null),window.alert(`Couldn't create project: ${K}`);return}t(4,x=`Loading pre-clipped OSM area ${g}`),await vp(B),ln(tr,n={mode:"add-neighbourhood"},n),t(4,x="")}function z(){p=this.value,t(1,p)}function L(){g=Fa(this),t(2,g),t(3,_)}return[T,p,g,_,x,n,h,C,z,L,()=>T(),B=>t(4,x=B.detail),B=>window.alert(B.detail)]}class cR extends Lt{constructor(e){super(),Et(this,e,uR,lR,St,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const fR="/ltn/assets/boundaries-2701bb3b.geojson";function Fb(r,e,t){const n=r.slice();return n[9]=e[t],n}function hR(r){let e=r[9]+"",t;return{c(){t=Me(e)},m(n,i){W(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&kt(t,e)},d(n){n&&G(t)}}}function Ob(r){let e,t,n;function i(){return r[5](r[9])}return t=new lh({props:{$$slots:{default:[hR]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),ue(t.$$.fragment)},m(o,u){W(o,e,u),ae(t,e,null),n=!0},p(o,u){r=o;const s={};u&4098&&(s.$$scope={dirty:u,ctx:r}),t.$set(s)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&G(e),le(t)}}}function dR(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=Me("Click to start a new project in "),i=Me(n)},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u&256&&n!==(n=o[8].name+"")&&kt(i,n)},d(o){o&&G(e)}}}function pR(r){let e,t;return e=new mi({props:{openOn:"hover",$$slots:{default:[dR,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function mR(r){let e,t,n,i;return e=new Yi({props:{paint:{"fill-color":vo.mapFeature.hover.backgroundColor,"fill-outline-color":vo.mapFeature.hover.backgroundColor,"fill-opacity":Gn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[pR]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new ur({props:{paint:{"line-color":vo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&4096&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function gR(r){let e,t,n,i,o,u,s=On(r[1]),h=[];for(let g=0;g<s.length;g+=1)h[g]=Ob(Fb(r,s,g));const p=g=>V(h[g],1,1,()=>{h[g]=null});return o=new _r({props:{data:r[0],generateId:!0,$$slots:{default:[mR]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=ie(),n=U("ul");for(let g=0;g<h.length;g+=1)h[g].c();i=ie(),ue(o.$$.fragment),Ye(n,"columns","3")},m(g,_){W(g,e,_),W(g,t,_),W(g,n,_);for(let x=0;x<h.length;x+=1)h[x]&&h[x].m(n,null);W(g,i,_),ae(o,g,_),u=!0},p(g,[_]){if(_&10){s=On(g[1]);let C;for(C=0;C<s.length;C+=1){const T=Fb(g,s,C);h[C]?(h[C].p(T,_),N(h[C],1)):(h[C]=Ob(T),h[C].c(),N(h[C],1),h[C].m(n,null))}for(Kt(),C=s.length;C<h.length;C+=1)p(C);Jt()}const x={};_&1&&(x.data=g[0]),_&4096&&(x.$$scope={dirty:_,ctx:g}),o.$set(x)},i(g){if(!u){for(let _=0;_<s.length;_+=1)N(h[_]);N(o.$$.fragment,g),u=!0}},o(g){h=h.filter(Boolean);for(let _=0;_<h.length;_+=1)V(h[_]);V(o.$$.fragment,g),u=!1},d(g){g&&(G(e),G(t),G(n),G(i)),_i(h,g),le(o,g)}}}function _R(r,e,t){let n,i;st(r,tr,_=>t(6,n=_)),st(r,Wa,_=>t(7,i=_));let{activityIndicatorText:o}=e,u={type:"FeatureCollection",features:[]},s=[];ks(async()=>{let _=await fetch(fR);t(0,u=await _.json());for(let x of u.features)s.push(x.properties.name);s.sort(),t(1,s)});function h(_){let x=_.detail.features[0].properties;p(`${x.kind}_${x.name}`)}async function p(_){let x,C=!1;for(;!C;){let T=x||i.nextAvailableProjectName(Of(_));if(x=window.prompt(`Please pick a project name to create in ${Of(_)}`,T),x===null)return;if(x=x.trim(),x===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${Of(_)}`);try{let z=i.createEmptyProject(x,_);await vp(z),ln(tr,n={mode:"add-neighbourhood"},n),C=!0}catch(z){window.alert(z)}t(4,o="")}}const g=_=>p(`LAD_${_}`);return r.$$set=_=>{"activityIndicatorText"in _&&t(4,o=_.activityIndicatorText)},[u,s,h,p,o,g]}class yR extends Lt{constructor(e){super(),Et(this,e,_R,gR,St,{activityIndicatorText:4})}}function vR(r){let e,t,n,i,o,u;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=ie(),i=U("input"),he(i,"type","file"),Ye(e,"margin-top","16px")},m(s,h){W(s,e,h),F(e,t),F(e,n),F(e,i),r[3](i),o||(u=Mt(i,"change",r[1]),o=!0)},p:at,i:at,o:at,d(s){s&&G(e),r[3](null),o=!1,u()}}}function bR(r,e,t){let n;st(r,tr,h=>t(4,n=h));let{loading:i}=e,o;async function u(h){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let g=await o.files[0].text(),_=JSON.parse(g),x,C,T;_.app_focus&&(console.assert(_.app_focus=="global"||_.app_focus=="cnt"),x=_.app_focus),_.study_area_name&&(C=_.study_area_name),_.project_name&&(T=_.project_name),(!_.app_focus||!_.project_name)&&(_.study_area_name&&_.study_area_name.startsWith("LAD_")?(x="cnt",T=n1(cg(p,`ltn_cnt_${_.study_area_name}_`),".geojson")):(x="global",T=n1(cg(p,"ltn_"),".geojson"))),T=T,x=x;let z=Sw.projectStorage(x);T=z.nextAvailableProjectName(T),_.project_name=T,_.app_focus=x,_.study_area_name=C;let L=z.createProject(_);await vp(L),ln(tr,n={mode:"pick-neighbourhood"},n),t(2,i="")}function s(h){dn[h?"unshift":"push"](()=>{o=h,t(0,o)})}return r.$$set=h=>{"loading"in h&&t(2,i=h.loading)},[o,u,i,s]}class wR extends Lt{constructor(e){super(),Et(this,e,bR,vR,St,{loading:2})}}function $b(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function Nb(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function xR(r){let e,t,n,i,o=yr(r[3].mode)+"",u;return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),u=Me(o),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(s,h){W(s,e,h),F(e,t),F(t,n),F(n,i),F(i,u)},p(s,h){h&8&&o!==(o=yr(s[3].mode)+"")&&kt(u,o)},d(s){s&&G(e)}}}function AR(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&G(e)}}}function kR(r){let e,t,n,i,o,u,s,h,p,g=r[2].length>0&&jb(r);const _=[TR,CR],x=[];function C(L,E){return L[5]=="global"?0:L[5]=="cnt"?1:-1}~(i=C(r))&&(o=x[i]=_[i](r));function T(L){r[15](L)}let z={};return r[1]!==void 0&&(z.loading=r[1]),s=new wR({props:z}),dn.push(()=>Dn(s,"loading",T)),{c(){g&&g.c(),e=ie(),t=U("h1"),t.textContent="Start a new project",n=ie(),o&&o.c(),u=ie(),ue(s.$$.fragment)},m(L,E){g&&g.m(L,E),W(L,e,E),W(L,t,E),W(L,n,E),~i&&x[i].m(L,E),W(L,u,E),ae(s,L,E),p=!0},p(L,E){L[2].length>0?g?(g.p(L,E),E&4&&N(g,1)):(g=jb(L),g.c(),N(g,1),g.m(e.parentNode,e)):g&&(Kt(),V(g,1,1,()=>{g=null}),Jt());let I=i;i=C(L),i===I?~i&&x[i].p(L,E):(o&&(Kt(),V(x[I],1,1,()=>{x[I]=null}),Jt()),~i?(o=x[i],o?o.p(L,E):(o=x[i]=_[i](L),o.c()),N(o,1),o.m(u.parentNode,u)):o=null);const O={};!h&&E&2&&(h=!0,O.loading=L[1],zn(()=>h=!1)),s.$set(O)},i(L){p||(N(g),N(o),N(s.$$.fragment,L),p=!0)},o(L){V(g),V(o),V(s.$$.fragment,L),p=!1},d(L){L&&(G(e),G(t),G(n),G(u)),g&&g.d(L),~i&&x[i].d(L),le(s,L)}}}function jb(r){let e,t,n,i,o=On(r[2]),u=[];for(let h=0;h<o.length;h+=1)u[h]=Vb($b(r,o,h));const s=h=>V(u[h],1,1,()=>{u[h]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=ie(),n=U("div");for(let h=0;h<u.length;h+=1)u[h].c();he(n,"class","project-list svelte-s5f8l2")},m(h,p){W(h,e,p),W(h,t,p),W(h,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(h,p){if(p&452){o=On(h[2]);let g;for(g=0;g<o.length;g+=1){const _=$b(h,o,g);u[g]?(u[g].p(_,p),N(u[g],1)):(u[g]=Vb(_),u[g].c(),N(u[g],1),u[g].m(n,null))}for(Kt(),g=o.length;g<u.length;g+=1)s(g);Jt()}},i(h){if(!i){for(let p=0;p<o.length;p+=1)N(u[p]);i=!0}},o(h){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)V(u[p]);i=!1},d(h){h&&(G(e),G(t),G(n)),_i(u,h)}}}function SR(r){let e=r[27]+"",t;return{c(){t=Me(e)},m(n,i){W(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&kt(t,e)},d(n){n&&G(t)}}}function Ub(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L;function E(){return r[9](r[26],r[27])}n=new lh({props:{$$slots:{default:[SR]},$$scope:{ctx:r}}}),n.$on("click",E),s=new Cw({props:{color:"black"}});function I(){return r[10](r[26])}g=new Vg({props:{color:"black"}});function O(){return r[11](r[26],r[27])}C=new qg({props:{color:"white"}});function B(){return r[12](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),ue(n.$$.fragment),i=ie(),o=U("span"),u=U("button"),ue(s.$$.fragment),h=ie(),p=U("button"),ue(g.$$.fragment),_=ie(),x=U("button"),ue(C.$$.fragment),he(u,"class","outline icon-btn"),he(u,"title","Download project as GeoJSON"),he(p,"class","outline icon-btn"),he(p,"title","Rename project"),he(x,"class","icon-btn destructive"),he(x,"title","Delete project"),he(o,"class","actions"),he(e,"class","actionable-cell svelte-s5f8l2")},m(K,H){W(K,e,H),F(e,t),ae(n,t,null),F(e,i),F(e,o),F(o,u),ae(s,u,null),F(o,h),F(o,p),ae(g,p,null),F(o,_),F(o,x),ae(C,x,null),T=!0,z||(L=[Mt(u,"click",I),Mt(p,"click",O),Mt(x,"click",B)],z=!0)},p(K,H){r=K;const q={};H&1073741828&&(q.$$scope={dirty:H,ctx:r}),n.$set(q)},i(K){T||(N(n.$$.fragment,K),N(s.$$.fragment,K),N(g.$$.fragment,K),N(C.$$.fragment,K),T=!0)},o(K){V(n.$$.fragment,K),V(s.$$.fragment,K),V(g.$$.fragment,K),V(C.$$.fragment,K),T=!1},d(K){K&&G(e),le(n),le(s),le(g),le(C),z=!1,cr(L)}}}function Vb(r){let e,t=Of(r[22])+"",n,i,o,u,s,h=On(r[23]),p=[];for(let _=0;_<h.length;_+=1)p[_]=Ub(Nb(r,h,_));const g=_=>V(p[_],1,1,()=>{p[_]=null});return{c(){e=U("h2"),n=Me(t),i=ie(),o=U("ul");for(let _=0;_<p.length;_+=1)p[_].c();u=ie(),he(e,"class","study-area-name svelte-s5f8l2"),he(o,"class","navigable-list")},m(_,x){W(_,e,x),F(e,n),W(_,i,x),W(_,o,x);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(o,null);F(o,u),s=!0},p(_,x){if((!s||x&4)&&t!==(t=Of(_[22])+"")&&kt(n,t),x&452){h=On(_[23]);let C;for(C=0;C<h.length;C+=1){const T=Nb(_,h,C);p[C]?(p[C].p(T,x),N(p[C],1)):(p[C]=Ub(T),p[C].c(),N(p[C],1),p[C].m(o,u))}for(Kt(),C=h.length;C<p.length;C+=1)g(C);Jt()}},i(_){if(!s){for(let x=0;x<h.length;x+=1)N(p[x]);s=!0}},o(_){p=p.filter(Boolean);for(let x=0;x<p.length;x+=1)V(p[x]);s=!1},d(_){_&&(G(e),G(i),G(o)),_i(p,_)}}}function CR(r){let e,t,n;function i(u){r[14](u)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new yR({props:o}),dn.push(()=>Dn(e,"activityIndicatorText",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const h={};!t&&s&2&&(t=!0,h.activityIndicatorText=u[1],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function TR(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){W(i,e,o),t||(n=Mt(e,"click",r[13]),t=!0)},p:at,i:at,o:at,d(i){i&&G(e),t=!1,n()}}}function MR(r){let e,t,n,i;const o=[kR,AR],u=[];function s(h,p){return h[4]&&h[0]?0:1}return t=s(r),n=u[t]=o[t](r),{c(){e=U("div"),n.c(),he(e,"slot","sidebar")},m(h,p){W(h,e,p),u[t].m(e,null),i=!0},p(h,p){let g=t;t=s(h),t===g?u[t].p(h,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Jt(),n=u[t],n?n.p(h,p):(n=u[t]=o[t](h),n.c()),N(n,1),n.m(e,null))},i(h){i||(N(n),i=!0)},o(h){V(n),i=!1},d(h){h&&G(e),u[t].d()}}}function ER(r){let e,t,n,i;return e=new uh({props:{loading:r[1]}}),n=new So({props:{$$slots:{sidebar:[MR],top:[xR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const h={};u&1073741887&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function LR(r,e,t){let n,i,o,u,s,h,p,g;st(r,tr,fe=>t(3,n=fe)),st(r,Wa,fe=>t(16,i=fe)),st(r,as,fe=>t(4,o=fe)),st(r,As,fe=>t(5,u=fe)),st(r,J0,fe=>t(17,s=fe)),st(r,$s,fe=>t(18,h=fe)),st(r,rp,fe=>t(19,p=fe)),st(r,kr,fe=>t(20,g=fe));let{wasmReady:_}=e,x="";if(ln(kr,g=null,g),ln(rp,p=null,p),ln($s,h=void 0,h),s){let Ee=new URLSearchParams(window.location.search).get("project");Ee&&T(Ee),ln(J0,s=!1,s)}else{let fe=new URL(window.location.href);fe.searchParams.delete("project"),window.history.replaceState(null,"",fe.toString())}if(o&&!s){let fe=[-180,-90,180,90];u=="cnt"&&(fe=[-8.943,54.631,-.901,59.489]),o.fitBounds(fe,{duration:500})}let C=i.studyAreaProjects();function T(fe){let Ee=fe;try{let ee=i.projectName(Ee);if(!ee){console.error(`Project ${Ee} from URL not found`);return}E(Ee,ee)}catch{console.error(`Error trying to fetch project from URL: ${Ee}`)}}function z(fe,Ee){window.confirm(`Really delete project ${Ee}? You can't undo this.`)&&(i.removeProject(fe),t(2,C=i.studyAreaProjects()))}function L(fe,Ee){let ee=window.prompt(`Rename project ${Ee} to what?`,Ee);if(ee){try{i.renameProject(fe,ee)}catch(oe){window.alert(`Couldn't rename project: ${oe}`)}t(2,C=i.studyAreaProjects())}}async function E(fe,Ee){t(1,x=`Loading project ${Ee}`),await vp(fe),ln(tr,n={mode:"pick-neighbourhood"},n),t(1,x="")}const I=(fe,Ee)=>E(fe,Ee),O=fe=>x2(fe),B=(fe,Ee)=>L(fe,Ee),K=(fe,Ee)=>z(fe,Ee),H=()=>ln(tr,n={mode:"new-project"},n);function q(fe){x=fe,t(1,x)}function J(fe){x=fe,t(1,x)}return r.$$set=fe=>{"wasmReady"in fe&&t(0,_=fe.wasmReady)},[_,x,C,n,o,u,z,L,E,I,O,B,K,H,q,J]}class IR extends Lt{constructor(e){super(),Et(this,e,LR,ER,St,{wasmReady:0})}}function PR(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T=yr(r[1].mode)+"",z,L;return o=new Fn({props:{mode:{mode:"title"}}}),h=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(h.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Me(T),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(E,I){W(E,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(h,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,z),L=!0},p(E,I){(!L||I&2)&&T!==(T=yr(E[1].mode)+"")&&kt(z,T)},i(E){L||(N(o.$$.fragment,E),N(h.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(h.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(h),le(_)}}}function zR(r){let e,t,n,i,o,u,s,h,p,g,_=mr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",x,C,T,z,L,E;function I(B){r[4](B)}let O={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(O.idx=r[0].shortcutIndex),o=new fp({props:O}),dn.push(()=>Dn(o,"idx",I)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ie(),n=U("button"),n.textContent="Pick a different road",i=ie(),ue(o.$$.fragment),s=ie(),h=U("p"),p=Me("This shortcut is "),g=U("b"),x=Me(_),C=Me("x"),T=Me(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(B,K){W(B,e,K),W(B,t,K),W(B,n,K),W(B,i,K),ae(o,B,K),W(B,s,K),W(B,h,K),F(h,p),F(h,g),F(g,x),F(g,C),F(h,T),z=!0,L||(E=Mt(n,"click",r[3]),L=!0)},p(B,K){const H={};K&1&&(H.list=B[0].gj.features),!u&&K&1&&(u=!0,H.idx=B[0].shortcutIndex,zn(()=>u=!1)),o.$set(H),(!z||K&1)&&_!==(_=mr(B[0].gj.features[B[0].shortcutIndex].properties).directness.toFixed(1)+"")&&kt(x,_)},i(B){z||(N(o.$$.fragment,B),z=!0)},o(B){V(o.$$.fragment,B),z=!1},d(B){B&&(G(e),G(t),G(n),G(i),G(s),G(h)),le(o,B),L=!1,E()}}}function DR(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&G(e)}}}function RR(r){let e,t,n,i,o,u;t=new Us({props:{mode:{mode:"neighbourhood"}}});const s=[DR,zR],h=[];function p(g,_){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=h[i]=s[i](r)),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),o&&o.c(),he(e,"slot","sidebar")},m(g,_){W(g,e,_),ae(t,e,null),F(e,n),~i&&h[i].m(e,null),u=!0},p(g,_){let x=i;i=p(g),i===x?~i&&h[i].p(g,_):(o&&(Kt(),V(h[x],1,1,()=>{h[x]=null}),Jt()),~i?(o=h[i],o?o.p(g,_):(o=h[i]=s[i](g),o.c()),N(o,1),o.m(e,null)):o=null)},i(g){u||(N(t.$$.fragment,g),N(o),u=!0)},o(g){V(t.$$.fragment,g),V(o),u=!1},d(g){g&&G(e),le(t),~i&&h[i].d()}}}function BR(r){let e,t;return e=new fh({props:{interactive:!1}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function FR(r){let e,t;return e=new fh({props:{onClickLine:r[2],$$slots:{"line-popup":[jR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function OR(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=U("p"),t=Me("Main road: "),i=Me(n)},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&kt(i,n)},d(o){o&&G(e)}}}function $R(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=U("p"),n=Me(t),i=Me(" shortcuts through "),u=Me(o)},m(s,h){W(s,e,h),F(e,n),F(e,i),F(e,u)},p(s,h){h&64&&t!==(t=s[6].shortcuts+"")&&kt(n,t),h&64&&o!==(o=(s[6].name??"unnamed road")+"")&&kt(u,o)},d(s){s&&G(e)}}}function NR(r){let e;function t(o,u){if(o[6].kind=="interior_road")return $R;if(o[6].kind=="main_road")return OR}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=nr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i&&i.d(o)}}}function jR(r){let e,t,n;return t=new mi({props:{openOn:"hover",$$slots:{default:[NR,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function UR(r){let e,t,n,i,o,u,s,h,p,g;e=new _p({}),n=new gp({}),o=new yp({});const _=[FR,BR],x=[];function C(T,z){return T[0].state=="neutral"?0:T[0].state=="chose-road"?1:-1}return~(s=C(r))&&(h=x[s]=_[s](r)),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),h&&h.c(),p=nr()},m(T,z){ae(e,T,z),W(T,t,z),ae(n,T,z),W(T,i,z),ae(o,T,z),W(T,u,z),~s&&x[s].m(T,z),W(T,p,z),g=!0},p(T,z){let L=s;s=C(T),s===L?~s&&x[s].p(T,z):(h&&(Kt(),V(x[L],1,1,()=>{x[L]=null}),Jt()),~s?(h=x[s],h?h.p(T,z):(h=x[s]=_[s](T),h.c()),N(h,1),h.m(p.parentNode,p)):h=null)},i(T){g||(N(e.$$.fragment,T),N(n.$$.fragment,T),N(o.$$.fragment,T),N(h),g=!0)},o(T){V(e.$$.fragment,T),V(n.$$.fragment,T),V(o.$$.fragment,T),V(h),g=!1},d(T){T&&(G(t),G(i),G(u),G(p)),le(e,T),le(n,T),le(o,T),~s&&x[s].d(T)}}}function qb(r){let e,t,n,i,o,u,s,h;return e=new _r({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[VR]},$$scope:{ctx:r}}}),n=new _r({props:{data:r[0].roadGj,$$slots:{default:[qR]},$$scope:{ctx:r}}}),o=new Fl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[HR]},$$scope:{ctx:r}}}),s=new Fl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[GR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),h=!0},p(p,g){const _={};g&1&&(_.data=p[0].gj.features[p[0].shortcutIndex]),g&128&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};g&1&&(x.data=p[0].roadGj),g&128&&(x.$$scope={dirty:g,ctx:p}),n.$set(x);const C={};g&1&&(C.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&128&&(C.$$scope={dirty:g,ctx:p}),o.$set(C);const T={};g&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&128&&(T.$$scope={dirty:g,ctx:p}),s.$set(T)},i(p){h||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),h=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),h=!1},d(p){p&&(G(t),G(i),G(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function VR(r){let e,t;const n=[_n("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function qR(r){let e,t;const n=[_n("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function HR(r){let e;return{c(){e=Me("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function GR(r){let e;return{c(){e=Me("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function WR(r){let e,t,n,i,o,u;t=new hh({props:{$$slots:{default:[UR]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&qb(r);return o=new tl({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),s&&s.c(),i=ie(),ue(o.$$.fragment),he(e,"slot","map")},m(h,p){W(h,e,p),ae(t,e,null),F(e,n),s&&s.m(e,null),F(e,i),ae(o,e,null),u=!0},p(h,p){const g={};p&129&&(g.$$scope={dirty:p,ctx:h}),t.$set(g),h[0].state=="chose-road"?s?(s.p(h,p),p&1&&N(s,1)):(s=qb(h),s.c(),N(s,1),s.m(e,i)):s&&(Kt(),V(s,1,1,()=>{s=null}),Jt())},i(h){u||(N(t.$$.fragment,h),N(s),N(o.$$.fragment,h),u=!0)},o(h){V(t.$$.fragment,h),V(s),V(o.$$.fragment,h),u=!1},d(h){h&&G(e),le(t),s&&s.d(),le(o)}}}function ZR(r){let e,t;return e=new So({props:{$$slots:{map:[WR],sidebar:[RR],top:[PR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function XR(r,e,t){let n,i;st(r,kr,p=>t(5,n=p)),st(r,tr,p=>t(1,i=p));let o={state:"neutral"};function u(p,g){let _=n.getShortcutsCrossingRoad(p.properties.id);if(_.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:p,gj:_,shortcutIndex:0})}const s=()=>t(0,o={state:"neutral"});function h(p){r.$$.not_equal(o.shortcutIndex,p)&&(o.shortcutIndex=p,t(0,o))}return[o,i,u,s,h]}class KR extends Lt{constructor(e){super(),Et(this,e,XR,ZR,St,{})}}function JR(r){let e,t,n,i,o,u;return{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${pk}" style="height: 32px;" alt="A/B Street logo"/>`,n=ie(),i=U("span"),he(t,"class","outline"),Ye(i,"width","100%"),he(e,"slot","top"),he(e,"class","pico"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","8px")},m(s,h){W(s,e,h),F(e,t),F(e,n),F(e,i),r[24](i),o||(u=Mt(t,"click",r[23]),o=!0)},p:at,d(s){s&&G(e),r[24](null),o=!1,u()}}}function YR(r){let e,t;return{c(){e=U("div"),t=U("div"),he(e,"class","pico"),he(e,"slot","left")},m(n,i){W(n,e,i),F(e,t),r[22](t)},p:at,d(n){n&&G(e),r[22](null)}}}function QR(r){return{c:at,m:at,p:at,i:at,o:at,d:at}}function eB(r){let e,t,n;function i(u){r[20](u)}let o={style:r[27],hash:!0,bounds:r[5],maxZoom:19,images:[{id:Ri.walkCycleOnly.filterType,url:Ri.walkCycleOnly.iconURL},{id:Ri.noEntry.filterType,url:Ri.noEntry.iconURL},{id:Ri.busGate.filterType,url:Ri.busGate.iconURL},{id:Ri.schoolStreet.filterType,url:Ri.schoolStreet.iconURL},{id:"diagonal_filter",url:dk},{id:"no_straight_turn",url:ew},{id:"no_left_turn",url:Qb},{id:"no_right_turn",url:Dg},{id:"no_u_left_to_right_turn",url:nw},{id:"no_u_right_to_left_turn",url:tw},{id:"oneway_arrow",url:hk},{id:"border_entry_arrow",url:fk,options:{sdf:!0}},{id:"national_rail",url:rw}],$$slots:{default:[wB]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new MS({props:o}),dn.push(()=>Dn(e,"map",i)),e.$on("error",r[21]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const h={};s&512&&(h.style=u[27]),s&32&&(h.bounds=u[5]),s&268437209&&(h.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,h.map=u[0],zn(()=>t=!1)),e.$set(h)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function Hb(r){let e,t,n,i;return e=new tg({props:{position:"top-left",$$slots:{default:[rB]},$$scope:{ctx:r}}}),n=new tg({props:{position:"top-left",$$slots:{default:[oB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&268435456&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const h={};u&268436096&&(h.$$scope={dirty:u,ctx:o}),n.$set(h)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function tB(r){let e,t,n;return t=new o4({}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function nB(r){let e,t;return e=new Iw({props:{title:"Zoom to fit study area",$$slots:{default:[tB]},$$scope:{ctx:r}}}),e.$on("click",r[18]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function rB(r){let e,t;return e=new Pw({props:{$$slots:{default:[nB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function iB(r){let e,t;return e=new jT({props:{map:mr(r[7]),maptilerBasemap:r[9]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.map=mr(n[7])),i&512&&(o.maptilerBasemap=n[9]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function oB(r){let e,t;return e=new Pw({props:{$$slots:{default:[iB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268436096&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function sB(r){let e,t;return e=new cR({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function aB(r){let e,t;return e=new IR({props:{wasmReady:r[4]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Gb(r){let e,t,n,i,o,u;e=new _r({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[lB]},$$scope:{ctx:r}}});const s=[bB,vB,yB,_B,gB,mB,pB,dB,hB,fB,cB,uB],h=[];function p(g,_){return g[10].mode=="pick-neighbourhood"?0:g[10].mode=="set-boundary"?1:g[10].mode=="add-neighbourhood"?2:g[10].mode=="neighbourhood"?3:g[10].mode=="view-shortcuts"?4:g[10].mode=="impact-one-destination"?5:g[10].mode=="route"?6:g[10].mode=="predict-impact"?7:g[10].mode=="impact-detail"?8:g[10].mode=="debug-neighbourhood"?9:g[10].mode=="debug-intersections"?10:g[10].mode=="debug-demand"?11:-1}return~(n=p(r))&&(i=h[n]=s[n](r)),{c(){ue(e.$$.fragment),t=ie(),i&&i.c(),o=nr()},m(g,_){ae(e,g,_),W(g,t,_),~n&&h[n].m(g,_),W(g,o,_),u=!0},p(g,_){const x={};_&64&&(x.data=g[6].getInvertedBoundary()),_&268435456&&(x.$$scope={dirty:_,ctx:g}),e.$set(x);let C=n;n=p(g),n===C?~n&&h[n].p(g,_):(i&&(Kt(),V(h[C],1,1,()=>{h[C]=null}),Jt()),~n?(i=h[n],i?i.p(g,_):(i=h[n]=s[n](g),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(g){u||(N(e.$$.fragment,g),N(i),u=!0)},o(g){V(e.$$.fragment,g),V(i),u=!1},d(g){g&&(G(t),G(o)),le(e,g),~n&&h[n].d(g)}}}function lB(r){let e,t;const n=[_n("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Yi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function uB(r){let e,t;return e=new I8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cB(r){let e,t;return e=new $8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function fB(r){let e,t;return e=new LP({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hB(r){let e,t;return e=new r7({props:{road:r[10].road,prevPrevMode:r[10].prevPrevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),i&1024&&(o.prevPrevMode=n[10].prevPrevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function dB(r){let e,t;return e=new Z7({props:{prevMode:r[10].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function pB(r){let e,t;return e=new lD({props:{prevMode:r[10].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function mB(r){let e,t;return e=new w7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gB(r){let e,t;return e=new KR({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function _B(r){let e,t;return e=new Zz({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yB(r){let e,t;return e=new p8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function vB(r){let e,t;return e=new dD({props:{name:r[10].name,existing:r[10].existing}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function bB(r){let e,t;return e=new F7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wB(r){let e,t,n,i,o,u,s,h,p,g,_,x,C,T,z,L,E;e=new Rw({props:{showCompass:!1}});let I=r[6]&&Hb(r);i=new L6({props:{map:r[0],apiKey:kw,country:void 0}}),u=new Bw({});const O=[aB,sB],B=[];function K(q,J){return q[10].mode=="title"?0:q[10].mode=="new-project"?1:-1}~(g=K(r))&&(_=B[g]=O[g](r)),C=new QL({});let H=r[6]&&Gb(r);return L=new cT({}),{c(){ue(e.$$.fragment),t=ie(),I&&I.c(),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),s=ie(),h=U("div"),p=ie(),_&&_.c(),x=ie(),ue(C.$$.fragment),T=ie(),H&&H.c(),z=ie(),ue(L.$$.fragment)},m(q,J){ae(e,q,J),W(q,t,J),I&&I.m(q,J),W(q,n,J),ae(i,q,J),W(q,o,J),ae(u,q,J),W(q,s,J),W(q,h,J),r[19](h),W(q,p,J),~g&&B[g].m(q,J),W(q,x,J),ae(C,q,J),W(q,T,J),H&&H.m(q,J),W(q,z,J),ae(L,q,J),E=!0},p(q,J){q[6]?I?(I.p(q,J),J&64&&N(I,1)):(I=Hb(q),I.c(),N(I,1),I.m(n.parentNode,n)):I&&(Kt(),V(I,1,1,()=>{I=null}),Jt());const fe={};J&1&&(fe.map=q[0]),i.$set(fe);let Ee=g;g=K(q),g===Ee?~g&&B[g].p(q,J):(_&&(Kt(),V(B[Ee],1,1,()=>{B[Ee]=null}),Jt()),~g?(_=B[g],_?_.p(q,J):(_=B[g]=O[g](q),_.c()),N(_,1),_.m(x.parentNode,x)):_=null),q[6]?H?(H.p(q,J),J&64&&N(H,1)):(H=Gb(q),H.c(),N(H,1),H.m(z.parentNode,z)):H&&(Kt(),V(H,1,1,()=>{H=null}),Jt())},i(q){E||(N(e.$$.fragment,q),N(I),N(i.$$.fragment,q),N(u.$$.fragment,q),N(_),N(C.$$.fragment,q),N(H),N(L.$$.fragment,q),E=!0)},o(q){V(e.$$.fragment,q),V(I),V(i.$$.fragment,q),V(u.$$.fragment,q),V(_),V(C.$$.fragment,q),V(H),V(L.$$.fragment,q),E=!1},d(q){q&&(G(t),G(n),G(o),G(s),G(h),G(p),G(x),G(T),G(z)),le(e,q),I&&I.d(q),le(i,q),le(u,q),r[19](null),~g&&B[g].d(q),le(C,q),H&&H.d(q),le(L,q)}}}function xB(r){return{c:at,m:at,p:at,i:at,o:at,d:at}}function AB(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:xB,then:eB,catch:QR,value:27,blocks:[,,,]};return q0(t=r[13](r[9]),i),{c(){e=U("div"),i.block.c(),he(e,"slot","main"),Ye(e,"position","relative"),Ye(e,"width","100%"),Ye(e,"height","100%")},m(o,u){W(o,e,u),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,u){r=o,i.ctx=r,u&512&&t!==(t=r[13](r[9]))&&q0(t,i)||sk(i,r,u)},i(o){n||(N(i.block),n=!0)},o(o){for(let u=0;u<3;u+=1){const s=i.blocks[u];V(s)}n=!1},d(o){o&&G(e),i.block.d(),i.token=null,i=null}}}function kB(r){let e,t,n,i,o,u,s;return t=new w3({}),o=new pI({props:{$$slots:{main:[AB],left:[YR],top:[JR]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),ue(o.$$.fragment),he(e,"class","pico"),he(i,"class",u="app-focus-"+r[8])},m(h,p){W(h,e,p),ae(t,e,null),W(h,n,p),W(h,i,p),ae(o,i,null),s=!0},p(h,[p]){const g={};p&268439295&&(g.$$scope={dirty:p,ctx:h}),o.$set(g),(!s||p&256&&u!==(u="app-focus-"+h[8]))&&he(i,"class",u)},i(h){s||(N(t.$$.fragment,h),N(o.$$.fragment,h),s=!0)},o(h){V(t.$$.fragment,h),V(o.$$.fragment,h),s=!1},d(h){h&&(G(e),G(n),G(i)),le(t),le(o)}}}function SB(r,e,t){let n,i,o,u,s,h,p,g,_,x,C;st(r,Sg,me=>t(15,n=me)),st(r,kg,me=>t(16,i=me)),st(r,Ag,me=>t(17,o=me)),st(r,kr,me=>t(6,u=me)),st(r,as,me=>t(7,s=me)),st(r,zf,me=>t(25,h=me)),st(r,Qm,me=>t(26,p=me)),st(r,As,me=>t(8,g=me)),st(r,Zm,me=>t(9,_=me)),st(r,tr,me=>t(10,x=me)),st(r,Zd,me=>t(11,C=me));let{appFocus:T="global"}=e;As.set(T);let z=!1;ks(async()=>{await U2(),await uw(),t(4,z=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(ln(Qm,p=!0,p),console.log("Using local cache, not od2net.org"))}catch{}let me=new URLSearchParams(window.location.search).get("dev");me==="true"||me===""?ln(zf,h=!0,h):(console.assert(me===null||me=="false",`unknown dev mode value: ${me}, should be "true", "false", or empty`),ln(zf,h=!1,h))});let L=null;function E(me){s.fitBounds(u.getBounds(),{animate:me})}let I,O,B,K;T=="cnt"&&(K=[-8.943,54.631,-.901,59.489]);async function H(me){return me=="streets-v2"?bI:`https://api.maptiler.com/maps/${me}/style.json?key=${kw}`}const q=()=>E(!0);function J(me){dn[me?"unshift":"push"](()=>{B=me,t(3,B),t(15,n)})}function fe(me){L=me,t(0,L)}const Ee=me=>{console.log(me.detail.error)};function ee(me){dn[me?"unshift":"push"](()=>{O=me,t(2,O),t(16,i)})}const oe=()=>ln(Zd,C=!0,C);function xe(me){dn[me?"unshift":"push"](()=>{I=me,t(1,I),t(17,o)})}return r.$$set=me=>{"appFocus"in me&&t(14,T=me.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&L&&(L.keyboard.disableRotation(),L.dragRotate.disable(),L.touchZoomRotate.disableRotation(),as.set(L)),r.$$.dirty&131074&&I&&o&&(t(1,I.innerHTML="",I),I.appendChild(o)),r.$$.dirty&65540&&O&&i&&(t(2,O.innerHTML="",O),O.appendChild(i)),r.$$.dirty&32776&&B&&n&&(t(3,B.innerHTML="",B),B.appendChild(n))},[L,I,O,B,z,K,u,s,g,_,x,C,E,H,T,n,i,o,q,J,fe,Ee,ee,oe,xe]}class DB extends Lt{constructor(e){super(),Et(this,e,SB,kB,St,{appFocus:14})}}export{DB as A};
