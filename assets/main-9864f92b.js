var Hi=Object.defineProperty;var Gi=(r,e,t)=>e in r?Hi(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var rt=(r,e,t)=>(Gi(r,typeof e!="symbol"?e+"":e,t),t);import{S as le,i as ie,s as oe,e as et,a as L,n as Q,d as M,b as $,t as N,c as C,f as p,g as fe,h as He,l as V,u as Ge,j as Je,k as We,m as k,o as S,r as at,p as Pe,q as Ne,v as qe,w as Nt,x as P,y as _e,z as Ji,A as qr,B as Wi,C as ve,D as ke,E as Z,F as rr,G as T,H as A,I as E,J as K,L as Ol,K as ft,M as ct,N as Rl,O as nn,P as Nl,Q as Ft,R as lo,T as vr,U as zl,V as Tr,W as qi,X as Vt,Y as Zi,Z as ur,_ as Xi,$ as Xt,a0 as gt,a1 as ze,a2 as io,a3 as Ye,a4 as Yi,a5 as Ki,a6 as Vi,a7 as Qi,a8 as vt,a9 as Zr,aa as gn,ab as Ar,ac as Xr,ad as xe,ae as jt,af as Ht,ag as Dl,ah as Ul,ai as pt,aj as he,ak as ee,al as Bn,am as Ze,an as Yr,ao as pn,ap as wt,aq as Ie,ar as dt,as as zt,at as or,au as Er,av as Kr,aw as Tt,ax as Hl,ay as Pr,az as so,aA as Qn,aB as On,aC as Rn,aD as Ir,aE as tn,aF as ao,aG as Fr,aH as xi,aI as Kt,aJ as jr,aK as es,aL as ts,aM as ns}from"./Link-259400e4.js";function Gt(r,e){const t={},n={},o={$$scope:1};let l=r.length;for(;l--;){const i=r[l],s=e[l];if(s){for(const a in i)a in s||(n[a]=1);for(const a in s)o[a]||(t[a]=s[a],o[a]=1);r[l]=s}else for(const a in i)o[a]=1}for(const i in n)i in t||(t[i]=void 0);return t}const rs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",os="/ltn/assets/logo-97f2d067.svg";function uo(r){let e,t;return{c(){e=$("div"),t=N(r[0]),C(e,"class","svelte-1uuov7f")},m(n,o){L(n,e,o),p(e,t)},p(n,o){o&1&&fe(t,n[0])},d(n){n&&M(e)}}}function ls(r){let e,t=r[0]&&uo(r);return{c(){t&&t.c(),e=et()},m(n,o){t&&t.m(n,o),L(n,e,o)},p(n,[o]){n[0]?t?t.p(n,o):(t=uo(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Q,o:Q,d(n){n&&M(e),t&&t.d(n)}}}function is(r,e,t){let{loading:n}=e;return r.$$set=o=>{"loading"in o&&t(0,n=o.loading)},[n]}class Gl extends le{constructor(e){super(),ie(this,e,is,ls,oe,{loading:0})}}const ss=r=>({dialog:r&1}),fo=r=>({dialog:r[0]});function as(r){let e,t,n,o,l;const i=r[4].default,s=He(i,r,r[3],fo);return{c(){e=$("dialog"),t=$("article"),s&&s.c(),e.open=!0},m(a,u){L(a,e,u),p(e,t),s&&s.m(t,null),r[6](e),n=!0,o||(l=[V(window,"click",r[1]),V(window,"keydown",r[2]),V(e,"close",r[5])],o=!0)},p(a,[u]){s&&s.p&&(!n||u&9)&&Ge(s,i,a,a[3],n?We(i,a[3],u,ss):Je(a[3]),fo)},i(a){n||(k(s,a),n=!0)},o(a){S(s,a),n=!1},d(a){a&&M(e),s&&s.d(a),r[6](null),o=!1,at(l)}}}function us(r,e,t){let{$$slots:n={},$$scope:o}=e,l;function i(f){l.open&&f.target==l&&l.close()}function s(f){(f.key=="Escape"||f.key=="Enter")&&(f.stopPropagation(),l.close())}function a(f){Pe.call(this,r,f)}function u(f){Ne[f?"unshift":"push"](()=>{l=f,t(0,l)})}return r.$$set=f=>{"$$scope"in f&&t(3,o=f.$$scope)},[l,i,s,o,n,a,u]}class fr extends le{constructor(e){super(),ie(this,e,us,as,oe,{})}}function co(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function _o(r){let e,t,n=r[1]+"",o,l,i,s=r[2]+"",a,u;return{c(){e=$("tr"),t=$("td"),o=N(n),l=P(),i=$("td"),a=N(s),u=P()},m(f,c){L(f,e,c),p(e,t),p(t,o),p(e,l),p(e,i),p(i,a),p(e,u)},p(f,c){c&1&&n!==(n=f[1]+"")&&fe(o,n),c&1&&s!==(s=f[2]+"")&&fe(a,s)},d(f){f&&M(e)}}}function fs(r){let e,t,n=qe(Object.entries(r[0])),o=[];for(let l=0;l<n.length;l+=1)o[l]=_o(co(r,n,l));return{c(){e=$("table"),t=$("tbody");for(let l=0;l<o.length;l+=1)o[l].c();C(e,"class","svelte-lh2o9l")},m(l,i){L(l,e,i),p(e,t);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(t,null)},p(l,[i]){if(i&1){n=qe(Object.entries(l[0]));let s;for(s=0;s<n.length;s+=1){const a=co(l,n,s);o[s]?o[s].p(a,i):(o[s]=_o(a),o[s].c(),o[s].m(t,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},i:Q,o:Q,d(l){l&&M(e),Nt(o,l)}}}function cs(r,e,t){let{properties:n}=e;return r.$$set=o=>{"properties"in o&&t(0,n=o.properties)},[n]}class Un extends le{constructor(e){super(),ie(this,e,cs,fs,oe,{properties:0})}}function mo(r,e,t){const n=r.slice();return n[3]=e[t],n}function go(r,e,t){const n=r.slice();return n[6]=e[t],n}function po(r){let e,t;return{c(){e=$("span"),t=N(`Â 
    `),_e(e,"background",r[6]),_e(e,"width","100%"),_e(e,"border","1px solid black")},m(n,o){L(n,e,o),p(e,t)},p(n,o){o&1&&_e(e,"background",n[6])},d(n){n&&M(e)}}}function ds(r){let e,t=r[3]+"",n;return{c(){e=$("span"),n=N(t)},m(o,l){L(o,e,l),p(e,n)},p(o,l){l&2&&t!==(t=o[3]+"")&&fe(n,t)},d(o){o&&M(e)}}}function _s(r){let e,t=r[3].toFixed(r[2])+"",n;return{c(){e=$("span"),n=N(t)},m(o,l){L(o,e,l),p(e,n)},p(o,l){l&6&&t!==(t=o[3].toFixed(o[2])+"")&&fe(n,t)},d(o){o&&M(e)}}}function ho(r){let e;function t(l,i){return l[2]>0?_s:ds}let n=t(r),o=n(r);return{c(){o.c(),e=et()},m(l,i){o.m(l,i),L(l,e,i)},p(l,i){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&M(e),o.d(l)}}}function ms(r){let e,t,n,o=qe(r[0]),l=[];for(let a=0;a<o.length;a+=1)l[a]=po(go(r,o,a));let i=qe(r[1]),s=[];for(let a=0;a<i.length;a+=1)s[a]=ho(mo(r,i,a));return{c(){e=$("div");for(let a=0;a<l.length;a+=1)l[a].c();t=P(),n=$("div");for(let a=0;a<s.length;a+=1)s[a].c();_e(e,"display","flex"),_e(n,"display","flex"),_e(n,"justify-content","space-between")},m(a,u){L(a,e,u);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(e,null);L(a,t,u),L(a,n,u);for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(n,null)},p(a,[u]){if(u&1){o=qe(a[0]);let f;for(f=0;f<o.length;f+=1){const c=go(a,o,f);l[f]?l[f].p(c,u):(l[f]=po(c),l[f].c(),l[f].m(e,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=o.length}if(u&6){i=qe(a[1]);let f;for(f=0;f<i.length;f+=1){const c=mo(a,i,f);s[f]?s[f].p(c,u):(s[f]=ho(c),s[f].c(),s[f].m(n,null))}for(;f<s.length;f+=1)s[f].d(1);s.length=i.length}},i:Q,o:Q,d(a){a&&(M(e),M(t),M(n)),Nt(l,a),Nt(s,a)}}}function gs(r,e,t){let{colorScale:n}=e,{limits:o}=e,{decimalPlaces:l=0}=e;return r.$$set=i=>{"colorScale"in i&&t(0,n=i.colorScale),"limits"in i&&t(1,o=i.limits),"decimalPlaces"in i&&t(2,l=i.decimalPlaces)},[n,o,l]}class ps extends le{constructor(e){super(),ie(this,e,gs,ms,oe,{colorScale:0,limits:1,decimalPlaces:2})}}function lr(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function st(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let re;const Jl=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Jl.decode();let Ln=null;function Pn(){return(Ln===null||Ln.byteLength===0)&&(Ln=new Uint8Array(re.memory.buffer)),Ln}function Et(r,e){return r=r>>>0,Jl.decode(Pn().subarray(r,r+e))}const qt=new Array(128).fill(void 0);qt.push(void 0,null,!0,!1);let In=qt.length;function Qe(r){In===qt.length&&qt.push(qt.length+1);const e=In;return In=qt[e],qt[e]=r,e}function Se(r){return qt[r]}function hs(r){r<132||(qt[r]=In,In=r)}function dn(r){const e=Se(r);return hs(r),e}function kr(r){return r==null}let Mn=null;function bs(){return(Mn===null||Mn.byteLength===0)&&(Mn=new Float64Array(re.memory.buffer)),Mn}let Sn=null;function Ee(){return(Sn===null||Sn.byteLength===0)&&(Sn=new Int32Array(re.memory.buffer)),Sn}let Qt=0;const xn=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ys=typeof xn.encodeInto=="function"?function(r,e){return xn.encodeInto(r,e)}:function(r,e){const t=xn.encode(r);return e.set(t),{read:r.length,written:t.length}};function Yn(r,e,t){if(t===void 0){const s=xn.encode(r),a=e(s.length,1)>>>0;return Pn().subarray(a,a+s.length).set(s),Qt=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=Pn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=Pn().subarray(o+i,o+n),a=ys(r,s);i+=a.written}return Qt=i,o}function Br(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=Br(r[0]));for(let i=1;i<o;i++)l+=", "+Br(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ws(r,e){const t=e(r.length*1,1)>>>0;return Pn().set(r,t/1),Qt=r.length,t}function $r(r,e){try{return r.apply(this,e)}catch(t){re.__wbindgen_exn_store(Qe(t))}}class ir{static __wrap(e){e=e>>>0;const t=Object.create(ir.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();re.__wbg_jsroutesnapper_free(e)}constructor(e){try{const l=re.__wbindgen_add_to_stack_pointer(-16),i=ws(e,re.__wbindgen_malloc),s=Qt;re.jsroutesnapper_new(l,i,s);var t=Ee()[l/4+0],n=Ee()[l/4+1],o=Ee()[l/4+2];if(o)throw dn(n);return ir.__wrap(t)}finally{re.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){re.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Qe(e))}setAreaMode(){re.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const l=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_getConfig(l,this.__wbg_ptr);var n=Ee()[l/4+0],o=Ee()[l/4+1];return e=n,t=o,Et(n,o)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Ee()[n/4+0],t=Ee()[n/4+1];let o;return e!==0&&(o=Et(e,t).slice(),re.__wbindgen_free(e,t*1)),o}finally{re.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const l=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_renderGeojson(l,this.__wbg_ptr);var n=Ee()[l/4+0],o=Ee()[l/4+1];return e=n,t=o,Et(n,o)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,t,1)}}toggleSnapMode(){re.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return re.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){re.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return re.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return re.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){re.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const o=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_editExisting(o,this.__wbg_ptr,Qe(e));var t=Ee()[o/4+0],n=Ee()[o/4+1];if(n)throw dn(t)}finally{re.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const l=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_debugRenderGraph(l,this.__wbg_ptr);var n=Ee()[l/4+0],o=Ee()[l/4+1];return e=n,t=o,Et(n,o)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const l=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_debugSnappableNodes(l,this.__wbg_ptr);var n=Ee()[l/4+0],o=Ee()[l/4+1];return e=n,t=o,Et(n,o)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const f=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_routeNameForWaypoints(f,this.__wbg_ptr,Qe(e));var o=Ee()[f/4+0],l=Ee()[f/4+1],i=Ee()[f/4+2],s=Ee()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,dn(i);return t=a,n=u,Et(a,u)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){re.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){re.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const f=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_calculateRoute(f,this.__wbg_ptr,Qe(e));var o=Ee()[f/4+0],l=Ee()[f/4+1],i=Ee()[f/4+2],s=Ee()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,dn(i);return t=a,n=u,Et(a,u)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,o;try{const c=re.__wbindgen_add_to_stack_pointer(-16);re.jsroutesnapper_getExtraNodes(c,this.__wbg_ptr,Qe(e),Qe(t));var l=Ee()[c/4+0],i=Ee()[c/4+1],s=Ee()[c/4+2],a=Ee()[c/4+3],u=l,f=i;if(a)throw u=0,f=0,dn(s);return n=u,o=f,Et(u,f)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(n,o,1)}}}async function vs(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function ks(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Et(e,t);return Qe(n)},r.wbg.__wbindgen_object_drop_ref=function(e){dn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Et(e,t));return Qe(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Se(t),o=typeof n=="number"?n:void 0;bs()[e/8+1]=kr(o)?0:o,Ee()[e/4+0]=!kr(o)},r.wbg.__wbindgen_is_object=function(e){const t=Se(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Se(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Se(e)in Se(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Se(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Se(e)==Se(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Se(t),o=typeof n=="string"?n:void 0;var l=kr(o)?0:Yn(o,re.__wbindgen_malloc,re.__wbindgen_realloc),i=Qt;Ee()[e/4+1]=i,Ee()[e/4+0]=l},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Se(t)),o=Yn(n,re.__wbindgen_malloc,re.__wbindgen_realloc),l=Qt;Ee()[e/4+1]=l,Ee()[e/4+0]=o},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Se(e);return Qe(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Se(e)[Se(t)];return Qe(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Qe(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Se(t).stack,o=Yn(n,re.__wbindgen_malloc,re.__wbindgen_realloc),l=Qt;Ee()[e/4+1]=l,Ee()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(Et(e,t))}finally{re.__wbindgen_free(n,o,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Se(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Se(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Se(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Se(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Se(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Se(e)[t>>>0];return Qe(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Se(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Se(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Se(e).next;return Qe(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return $r(function(e){const t=Se(e).next();return Qe(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Se(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Se(e).value;return Qe(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Qe(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return $r(function(e,t){const n=Reflect.get(Se(e),Se(t));return Qe(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return $r(function(e,t){const n=Se(e).call(Se(t));return Qe(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Se(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Se(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Se(e).buffer;return Qe(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Se(e));return Qe(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Se(e).set(Se(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Se(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Se(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Br(Se(t)),o=Yn(n,re.__wbindgen_malloc,re.__wbindgen_realloc),l=Qt;Ee()[e/4+1]=l,Ee()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Et(e,t))},r.wbg.__wbindgen_memory=function(){const e=re.memory;return Qe(e)},r}function $s(r,e){return re=r.exports,Wl.__wbindgen_wasm_module=e,Mn=null,Sn=null,Ln=null,re}async function Wl(r){if(re!==void 0)return re;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=ks();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await vs(await r,e);return $s(t,n)}var _t=63710088e-1,Vr={centimeters:_t*100,centimetres:_t*100,degrees:_t/111325,feet:_t*3.28084,inches:_t*39.37,kilometers:_t/1e3,kilometres:_t/1e3,meters:_t,metres:_t,miles:_t/1609.344,millimeters:_t*1e3,millimetres:_t*1e3,nauticalmiles:_t/1852,radians:1,yards:_t*1.0936},Ls={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/_t,yards:1.0936133},Or={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Bt(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ms(r,e,t){switch(r){case"Point":return yt(e).geometry;case"LineString":return Pt(e).geometry;case"Polygon":return Qr(e).geometry;case"MultiPoint":return Zl(e).geometry;case"MultiLineString":return ql(e).geometry;case"MultiPolygon":return Xl(e).geometry;default:throw new Error(r+" is invalid")}}function yt(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!sr(r[0])||!sr(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Bt(n,e,t)}function Ss(r,e,t){return t===void 0&&(t={}),an(r.map(function(n){return yt(n,e)}),t)}function Qr(r,e,t){t===void 0&&(t={});for(var n=0,o=r;n<o.length;n++){var l=o[n];if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var i=0;i<l[l.length-1].length;i++)if(l[l.length-1][i]!==l[0][i])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return Bt(s,e,t)}function Cs(r,e,t){return t===void 0&&(t={}),an(r.map(function(n){return Qr(n,e)}),t)}function Pt(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Bt(n,e,t)}function Ts(r,e,t){return t===void 0&&(t={}),an(r.map(function(n){return Pt(n,e)}),t)}function an(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function ql(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return Bt(n,e,t)}function Zl(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return Bt(n,e,t)}function Xl(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Bt(n,e,t)}function As(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return Bt(n,e,t)}function Es(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function xr(r,e){e===void 0&&(e="kilometers");var t=Vr[e];if(!t)throw new Error(e+" units is invalid");return r*t}function cr(r,e){e===void 0&&(e="kilometers");var t=Vr[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ps(r,e){return Nn(cr(r,e))}function Is(r){var e=r%360;return e<0&&(e+=360),e}function Nn(r){var e=r%(2*Math.PI);return e*180/Math.PI}function It(r){var e=r%360;return e*Math.PI/180}function Fs(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return xr(cr(r,e),t)}function js(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Or[e];if(!n)throw new Error("invalid original units");var o=Or[t];if(!o)throw new Error("invalid final units");return r/n*o}function sr(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function eo(r){return!!r&&r.constructor===Object}function Bs(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!sr(e))throw new Error("bbox must only contain numbers")})}function Os(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Rs=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Or,bearingToAzimuth:Is,convertArea:js,convertLength:Fs,degreesToRadians:It,earthRadius:_t,factors:Vr,feature:Bt,featureCollection:an,geometry:Ms,geometryCollection:As,isNumber:sr,isObject:eo,lengthToDegrees:Ps,lengthToRadians:cr,lineString:Pt,lineStrings:Ts,multiLineString:ql,multiPoint:Zl,multiPolygon:Xl,point:yt,points:Ss,polygon:Qr,polygons:Cs,radiansToDegrees:Nn,radiansToLength:xr,round:Es,unitsFactors:Ls,validateBBox:Bs,validateId:Os},Symbol.toStringTag,{value:"Module"}));function zn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function hn(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function vn(r,e,t){t===void 0&&(t={});var n=zn(r),o=zn(e),l=It(o[1]-n[1]),i=It(o[0]-n[0]),s=It(n[1]),a=It(o[1]),u=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return xr(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Hn(r,e,t){if(r!==null)for(var n,o,l,i,s,a,u,f=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",b=m?r.features.length:1,w=0;w<b;w++){u=m?r.features[w].geometry:g?r.geometry:r,_=u?u.type==="GeometryCollection":!1,s=_?u.geometries.length:1;for(var h=0;h<s;h++){var y=0,v=0;if(i=_?u.geometries[h]:u,i!==null){a=i.coordinates;var I=i.type;switch(f=t&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(e(a,c,w,y,v)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,w,y,v)===!1)return!1;c++,I==="MultiPoint"&&y++}I==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-f;o++){if(e(a[n][o],c,w,y,v)===!1)return!1;c++}I==="MultiLineString"&&y++,I==="Polygon"&&v++}I==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(v=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-f;l++){if(e(a[n][o][l],c,w,y,v)===!1)return!1;c++}v++}y++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(Hn(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ns(r,e,t,n){var o=t;return Hn(r,function(l,i,s,a,u){i===0&&t===void 0?o=l:o=e(o,l,i,s,a,u)},n),o}function Yl(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function zs(r,e,t){var n=t;return Yl(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function ar(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Ds(r,e,t){var n=t;return ar(r,function(o,l){l===0&&t===void 0?n=o:n=e(n,o,l)}),n}function Us(r){var e=[];return Hn(r,function(t){e.push(t)}),e}function to(r,e){var t,n,o,l,i,s,a,u,f,c,_=0,d=r.type==="FeatureCollection",m=r.type==="Feature",g=d?r.features.length:1;for(t=0;t<g;t++){for(s=d?r.features[t].geometry:m?r.geometry:r,u=d?r.features[t].properties:m?r.properties:{},f=d?r.features[t].bbox:m?r.bbox:void 0,c=d?r.features[t].id:m?r.id:void 0,a=s?s.type==="GeometryCollection":!1,i=a?s.geometries.length:1,o=0;o<i;o++){if(l=a?s.geometries[o]:s,l===null){if(e(null,_,u,f,c)===!1)return!1;continue}switch(l.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(l,_,u,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<l.geometries.length;n++)if(e(l.geometries[n],_,u,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}_++}}function Hs(r,e,t){var n=t;return to(r,function(o,l,i,s,a){l===0&&t===void 0?n=o:n=e(n,o,l,i,s,a)}),n}function yn(r,e){to(r,function(t,n,o,l,i){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Bt(t,o,{bbox:l,id:i}),n,0)===!1?!1:void 0}var a;switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var f=t.coordinates[u],c={type:a,coordinates:f};if(e(Bt(c,o),n,u)===!1)return!1}})}function Gs(r,e,t){var n=t;return yn(r,function(o,l,i){l===0&&i===0&&t===void 0?n=o:n=e(n,o,l,i)}),n}function Kl(r,e){yn(r,function(t,n,o){var l=0;if(t.geometry){var i=t.geometry.type;if(!(i==="Point"||i==="MultiPoint")){var s,a=0,u=0,f=0;if(Hn(t,function(c,_,d,m,g){if(s===void 0||n>a||m>u||g>f){s=c,a=n,u=m,f=g,l=0;return}var b=Pt([s,c],t.properties);if(e(b,n,o,g,l)===!1)return!1;l++,s=c})===!1)return!1}}})}function Js(r,e,t){var n=t,o=!1;return Kl(r,function(l,i,s,a,u){o===!1&&t===void 0?n=l:n=e(n,l,i,s,a,u),o=!0}),n}function Vl(r,e){if(!r)throw new Error("geojson is required");yn(r,function(t,n,o){if(t.geometry!==null){var l=t.geometry.type,i=t.geometry.coordinates;switch(l){case"LineString":if(e(t,n,o,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<i.length;s++)if(e(Pt(i[s],t.properties),n,o,s)===!1)return!1;break}}})}function Ws(r,e,t){var n=t;return Vl(r,function(o,l,i,s){l===0&&t===void 0?n=o:n=e(n,o,l,i,s)}),n}function qs(r,e){if(e=e||{},!eo(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.segmentIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return l<0&&(l=a.length+l-1),Pt([a[l],a[l+1]],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l-1),Pt([a[o][l],a[o][l+1]],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l-1),Pt([a[n][l],a[n][l+1]],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l-1),Pt([a[n][o][l],a[n][o][l+1]],i,e)}throw new Error("geojson is invalid")}function Zs(r,e){if(e=e||{},!eo(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,l=e.coordIndex||0,i=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),i=i||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":i=i||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var a=s.coordinates;switch(s.type){case"Point":return yt(a,i,e);case"MultiPoint":return n<0&&(n=a.length+n),yt(a[n],i,e);case"LineString":return l<0&&(l=a.length+l),yt(a[l],i,e);case"Polygon":return o<0&&(o=a.length+o),l<0&&(l=a[o].length+l),yt(a[o][l],i,e);case"MultiLineString":return n<0&&(n=a.length+n),l<0&&(l=a[n].length+l),yt(a[n][l],i,e);case"MultiPolygon":return n<0&&(n=a.length+n),o<0&&(o=a[n].length+o),l<0&&(l=a[n][o].length-l),yt(a[n][o][l],i,e)}throw new Error("geojson is invalid")}const Xs=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Us,coordEach:Hn,coordReduce:Ns,featureEach:ar,featureReduce:Ds,findPoint:Zs,findSegment:qs,flattenEach:yn,flattenReduce:Gs,geomEach:to,geomReduce:Hs,lineEach:Vl,lineReduce:Ws,propEach:Yl,propReduce:zs,segmentEach:Kl,segmentReduce:Js},Symbol.toStringTag,{value:"Module"}));function Ql(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Ys(r,e);var n=zn(r),o=zn(e),l=It(n[0]),i=It(o[0]),s=It(n[1]),a=It(o[1]),u=Math.sin(i-l)*Math.cos(a),f=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return Nn(Math.atan2(u,f))}function Ys(r,e){var t=Ql(e,r);return t=(t+180)%360,t}function bo(r,e,t,n){n===void 0&&(n={});var o=zn(r),l=It(o[0]),i=It(o[1]),s=It(t),a=cr(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),f=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(u)),c=Nn(f),_=Nn(u);return yt([c,_],n.properties)}function yo(r){if(!r)throw new Error("geojson is required");var e=[];return yn(r,function(t){Ks(t,e)}),an(e)}function Ks(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=hn(n);break;case"LineString":t=[hn(n)]}t.forEach(function(o){var l=Vs(o,r.properties);l.forEach(function(i){i.id=e.length,e.push(i)})})}}function Vs(r,e){var t=[];return r.reduce(function(n,o){var l=Pt([n,o],e);return l.bbox=Qs(n,o),t.push(l),o}),t}function Qs(r,e){var t=r[0],n=r[1],o=e[0],l=e[1],i=t<o?t:o,s=n<l?n:l,a=t>o?t:o,u=n>l?n:l;return[i,s,a,u]}var no={exports:{}},xl={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Ji,function(){function t(h,y,v,I,O){(function F(B,z,D,R,j){for(;R>D;){if(R-D>600){var te=R-D+1,W=z-D+1,X=Math.log(te),se=.5*Math.exp(2*X/3),Le=.5*Math.sqrt(X*se*(te-se)/te)*(W-te/2<0?-1:1),J=Math.max(D,Math.floor(z-W*se/te+Le)),Ce=Math.min(R,Math.floor(z+(te-W)*se/te+Le));F(B,z,J,Ce,j)}var Me=B[z],be=D,ae=R;for(n(B,D,z),j(B[R],Me)>0&&n(B,D,R);be<ae;){for(n(B,be,ae),be++,ae--;j(B[be],Me)<0;)be++;for(;j(B[ae],Me)>0;)ae--}j(B[D],Me)===0?n(B,D,ae):n(B,++ae,R),ae<=z&&(D=ae+1),z<=ae&&(R=ae-1)}})(h,y,v||0,I||h.length-1,O||o)}function n(h,y,v){var I=h[y];h[y]=h[v],h[v]=I}function o(h,y){return h<y?-1:h>y?1:0}var l=function(h){h===void 0&&(h=9),this._maxEntries=Math.max(4,h),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(h,y,v){if(!v)return y.indexOf(h);for(var I=0;I<y.length;I++)if(v(h,y[I]))return I;return-1}function s(h,y){a(h,0,h.children.length,y,h)}function a(h,y,v,I,O){O||(O=b(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var F=y;F<v;F++){var B=h.children[F];u(O,h.leaf?I(B):B)}return O}function u(h,y){return h.minX=Math.min(h.minX,y.minX),h.minY=Math.min(h.minY,y.minY),h.maxX=Math.max(h.maxX,y.maxX),h.maxY=Math.max(h.maxY,y.maxY),h}function f(h,y){return h.minX-y.minX}function c(h,y){return h.minY-y.minY}function _(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function d(h){return h.maxX-h.minX+(h.maxY-h.minY)}function m(h,y){return h.minX<=y.minX&&h.minY<=y.minY&&y.maxX<=h.maxX&&y.maxY<=h.maxY}function g(h,y){return y.minX<=h.maxX&&y.minY<=h.maxY&&y.maxX>=h.minX&&y.maxY>=h.minY}function b(h){return{children:h,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function w(h,y,v,I,O){for(var F=[y,v];F.length;)if(!((v=F.pop())-(y=F.pop())<=I)){var B=y+Math.ceil((v-y)/I/2)*I;t(h,B,y,v,O),F.push(y,B,B,v)}}return l.prototype.all=function(){return this._all(this.data,[])},l.prototype.search=function(h){var y=this.data,v=[];if(!g(h,y))return v;for(var I=this.toBBox,O=[];y;){for(var F=0;F<y.children.length;F++){var B=y.children[F],z=y.leaf?I(B):B;g(h,z)&&(y.leaf?v.push(B):m(h,z)?this._all(B,v):O.push(B))}y=O.pop()}return v},l.prototype.collides=function(h){var y=this.data;if(!g(h,y))return!1;for(var v=[];y;){for(var I=0;I<y.children.length;I++){var O=y.children[I],F=y.leaf?this.toBBox(O):O;if(g(h,F)){if(y.leaf||m(h,F))return!0;v.push(O)}}y=v.pop()}return!1},l.prototype.load=function(h){if(!h||!h.length)return this;if(h.length<this._minEntries){for(var y=0;y<h.length;y++)this.insert(h[y]);return this}var v=this._build(h.slice(),0,h.length-1,0);if(this.data.children.length)if(this.data.height===v.height)this._splitRoot(this.data,v);else{if(this.data.height<v.height){var I=this.data;this.data=v,v=I}this._insert(v,this.data.height-v.height-1,!0)}else this.data=v;return this},l.prototype.insert=function(h){return h&&this._insert(h,this.data.height-1),this},l.prototype.clear=function(){return this.data=b([]),this},l.prototype.remove=function(h,y){if(!h)return this;for(var v,I,O,F=this.data,B=this.toBBox(h),z=[],D=[];F||z.length;){if(F||(F=z.pop(),I=z[z.length-1],v=D.pop(),O=!0),F.leaf){var R=i(h,F.children,y);if(R!==-1)return F.children.splice(R,1),z.push(F),this._condense(z),this}O||F.leaf||!m(F,B)?I?(v++,F=I.children[v],O=!1):F=null:(z.push(F),D.push(v),v=0,I=F,F=F.children[0])}return this},l.prototype.toBBox=function(h){return h},l.prototype.compareMinX=function(h,y){return h.minX-y.minX},l.prototype.compareMinY=function(h,y){return h.minY-y.minY},l.prototype.toJSON=function(){return this.data},l.prototype.fromJSON=function(h){return this.data=h,this},l.prototype._all=function(h,y){for(var v=[];h;)h.leaf?y.push.apply(y,h.children):v.push.apply(v,h.children),h=v.pop();return y},l.prototype._build=function(h,y,v,I){var O,F=v-y+1,B=this._maxEntries;if(F<=B)return s(O=b(h.slice(y,v+1)),this.toBBox),O;I||(I=Math.ceil(Math.log(F)/Math.log(B)),B=Math.ceil(F/Math.pow(B,I-1))),(O=b([])).leaf=!1,O.height=I;var z=Math.ceil(F/B),D=z*Math.ceil(Math.sqrt(B));w(h,y,v,D,this.compareMinX);for(var R=y;R<=v;R+=D){var j=Math.min(R+D-1,v);w(h,R,j,z,this.compareMinY);for(var te=R;te<=j;te+=z){var W=Math.min(te+z-1,j);O.children.push(this._build(h,te,W,I-1))}}return s(O,this.toBBox),O},l.prototype._chooseSubtree=function(h,y,v,I){for(;I.push(y),!y.leaf&&I.length-1!==v;){for(var O=1/0,F=1/0,B=void 0,z=0;z<y.children.length;z++){var D=y.children[z],R=_(D),j=(te=h,W=D,(Math.max(W.maxX,te.maxX)-Math.min(W.minX,te.minX))*(Math.max(W.maxY,te.maxY)-Math.min(W.minY,te.minY))-R);j<F?(F=j,O=R<O?R:O,B=D):j===F&&R<O&&(O=R,B=D)}y=B||y.children[0]}var te,W;return y},l.prototype._insert=function(h,y,v){var I=v?h:this.toBBox(h),O=[],F=this._chooseSubtree(I,this.data,y,O);for(F.children.push(h),u(F,I);y>=0&&O[y].children.length>this._maxEntries;)this._split(O,y),y--;this._adjustParentBBoxes(I,O,y)},l.prototype._split=function(h,y){var v=h[y],I=v.children.length,O=this._minEntries;this._chooseSplitAxis(v,O,I);var F=this._chooseSplitIndex(v,O,I),B=b(v.children.splice(F,v.children.length-F));B.height=v.height,B.leaf=v.leaf,s(v,this.toBBox),s(B,this.toBBox),y?h[y-1].children.push(B):this._splitRoot(v,B)},l.prototype._splitRoot=function(h,y){this.data=b([h,y]),this.data.height=h.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},l.prototype._chooseSplitIndex=function(h,y,v){for(var I,O,F,B,z,D,R,j=1/0,te=1/0,W=y;W<=v-y;W++){var X=a(h,0,W,this.toBBox),se=a(h,W,v,this.toBBox),Le=(O=X,F=se,B=void 0,z=void 0,D=void 0,R=void 0,B=Math.max(O.minX,F.minX),z=Math.max(O.minY,F.minY),D=Math.min(O.maxX,F.maxX),R=Math.min(O.maxY,F.maxY),Math.max(0,D-B)*Math.max(0,R-z)),J=_(X)+_(se);Le<j?(j=Le,I=W,te=J<te?J:te):Le===j&&J<te&&(te=J,I=W)}return I||v-y},l.prototype._chooseSplitAxis=function(h,y,v){var I=h.leaf?this.compareMinX:f,O=h.leaf?this.compareMinY:c;this._allDistMargin(h,y,v,I)<this._allDistMargin(h,y,v,O)&&h.children.sort(I)},l.prototype._allDistMargin=function(h,y,v,I){h.children.sort(I);for(var O=this.toBBox,F=a(h,0,y,O),B=a(h,v-y,v,O),z=d(F)+d(B),D=y;D<v-y;D++){var R=h.children[D];u(F,h.leaf?O(R):R),z+=d(F)}for(var j=v-y-1;j>=y;j--){var te=h.children[j];u(B,h.leaf?O(te):te),z+=d(B)}return z},l.prototype._adjustParentBBoxes=function(h,y,v){for(var I=v;I>=0;I--)u(y[I],h)},l.prototype._condense=function(h){for(var y=h.length-1,v=void 0;y>=0;y--)h[y].children.length===0?y>0?(v=h[y-1].children).splice(v.indexOf(h[y]),1):this.clear():s(h[y],this.toBBox)},l})})(xl);var xs=xl.exports;const ea=qr(Rs),ta=qr(Xs);function ei(r,e,t){if(r!==null)for(var n,o,l,i,s,a,u,f=0,c=0,_,d=r.type,m=d==="FeatureCollection",g=d==="Feature",b=m?r.features.length:1,w=0;w<b;w++){u=m?r.features[w].geometry:g?r.geometry:r,_=u?u.type==="GeometryCollection":!1,s=_?u.geometries.length:1;for(var h=0;h<s;h++){var y=0,v=0;if(i=_?u.geometries[h]:u,i!==null){a=i.coordinates;var I=i.type;switch(f=t&&(I==="Polygon"||I==="MultiPolygon")?1:0,I){case null:break;case"Point":if(e(a,c,w,y,v)===!1)return!1;c++,y++;break;case"LineString":case"MultiPoint":for(n=0;n<a.length;n++){if(e(a[n],c,w,y,v)===!1)return!1;c++,I==="MultiPoint"&&y++}I==="LineString"&&y++;break;case"Polygon":case"MultiLineString":for(n=0;n<a.length;n++){for(o=0;o<a[n].length-f;o++){if(e(a[n][o],c,w,y,v)===!1)return!1;c++}I==="MultiLineString"&&y++,I==="Polygon"&&v++}I==="Polygon"&&y++;break;case"MultiPolygon":for(n=0;n<a.length;n++){for(v=0,o=0;o<a[n].length;o++){for(l=0;l<a[n][o].length-f;l++){if(e(a[n][o][l],c,w,y,v)===!1)return!1;c++}v++}y++}break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(ei(i.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ti(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return ei(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var na=ti;const ra=Object.freeze(Object.defineProperty({__proto__:null,bbox:ti,default:na},Symbol.toStringTag,{value:"Module"})),oa=qr(ra);var Ut=xs,ni=ea,ri=ta,fn=oa.default,la=ri.featureEach;ri.coordEach;ni.polygon;var wo=ni.featureCollection;function oi(r){var e=new Ut(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:fn(t),Ut.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:fn(o),n.push(o)}):la(t,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:fn(o),n.push(o)}),Ut.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:fn(t),Ut.prototype.remove.call(this,t,n)},e.clear=function(){return Ut.prototype.clear.call(this)},e.search=function(t){var n=Ut.prototype.search.call(this,this.toBBox(t));return wo(n)},e.collides=function(t){return Ut.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ut.prototype.all.call(this);return wo(t)},e.toJSON=function(){return Ut.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ut.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=fn(t);else if(t.type==="FeatureCollection")n=fn(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}no.exports=oi;no.exports.default=oi;var ia=no.exports;const sa=Wi(ia);function aa(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Bt(r)),e.type==="LineString"&&(e=Bt(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var o=vo(r,e);return o&&n.push(o),an(n)}var l=sa();return l.load(yo(e)),ar(yo(r),function(i){ar(l.search(i),function(s){var a=vo(i,s);if(a){var u=hn(a).join(",");t[u]||(t[u]=!0,n.push(a))}})}),an(n)}function vo(r,e){var t=hn(r),n=hn(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=t[0][0],l=t[0][1],i=t[1][0],s=t[1][1],a=n[0][0],u=n[0][1],f=n[1][0],c=n[1][1],_=(c-u)*(i-o)-(f-a)*(s-l),d=(f-a)*(l-u)-(c-u)*(o-a),m=(i-o)*(l-u)-(s-l)*(o-a);if(_===0)return null;var g=d/_,b=m/_;if(g>=0&&g<=1&&b>=0&&b<=1){var w=o+g*(i-o),h=l+g*(s-l);return yt([w,h])}return null}function ua(r,e,t){t===void 0&&(t={});var n=yt([1/0,1/0],{dist:1/0}),o=0;return yn(r,function(l){for(var i=hn(l),s=0;s<i.length-1;s++){var a=yt(i[s]);a.properties.dist=vn(e,a,t);var u=yt(i[s+1]);u.properties.dist=vn(e,u,t);var f=vn(a,u,t),c=Math.max(a.properties.dist,u.properties.dist),_=Ql(a,u),d=bo(e,c,_+90,t),m=bo(e,c,_-90,t),g=aa(Pt([d.geometry.coordinates,m.geometry.coordinates]),Pt([a.geometry.coordinates,u.geometry.coordinates])),b=null;g.features.length>0&&(b=g.features[0],b.properties.dist=vn(e,b,t),b.properties.location=o+vn(a,b,t)),a.properties.dist<n.properties.dist&&(n=a,n.properties.index=s,n.properties.location=o),u.properties.dist<n.properties.dist&&(n=u,n.properties.index=s+1,n.properties.location=o+f),b&&b.properties.dist<n.properties.dist&&(n=b,n.properties.index=s),o+=f}}),n}const fa=30;class ca{constructor(e,t,n,o,l){this.onMouseMove=i=>{if(!this.active)return;const s=[i.point.x-fa,i.point.y],a=this.map.unproject(i.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(i.lngLat.lng,i.lngLat.lat,a)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=i=>{this.active&&(i.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||i.key=="Escape"&&(i.stopPropagation(),this.cancel())},this.onKeyPress=i=>{if(!this.active)return;let s=i.target.tagName;s=="INPUT"||s=="TEXTAREA"||(i.key=="Enter"?(i.stopPropagation(),this.finish()):i.key=="s"||i.key=="S"?(i.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):i.key=="z"&&i.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new ir(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=o,this.undoLength=l,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}function ko(r){let e,t;return e=new fr({props:{$$slots:{default:[da,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&24&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function da(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;function g(){return r[1](r[3])}return{c(){e=$("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=P(),n=$("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,o=P(),l=$("p"),l.textContent="To use this tool, you need to:",i=P(),s=$("ol"),s.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,a=P(),u=$("p"),u.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,f=P(),c=$("center"),_=$("button"),_.textContent="Start!"},m(b,w){L(b,e,w),L(b,t,w),L(b,n,w),L(b,o,w),L(b,l,w),L(b,i,w),L(b,s,w),L(b,a,w),L(b,u,w),L(b,f,w),L(b,c,w),p(c,_),d||(m=V(_,"click",g),d=!0)},p(b,w){r=b},d(b){b&&(M(e),M(t),M(n),M(o),M(l),M(i),M(s),M(a),M(u),M(f),M(c)),d=!1,m()}}}function _a(r){let e,t,n=r[0]&&ko(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&k(n,1)):(n=ko(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function ma(r,e,t){let n;return Z(r,rr,i=>t(0,n=i)),[n,i=>st(i).close(),()=>K(rr,n=!1,n)]}class ga extends le{constructor(e){super(),ie(this,e,ma,_a,oe,{})}}let H;const li=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&li.decode();let Cn=null;function mn(){return(Cn===null||Cn.byteLength===0)&&(Cn=new Uint8Array(H.memory.buffer)),Cn}function ot(r,e){return r=r>>>0,li.decode(mn().subarray(r,r+e))}const Zt=new Array(128).fill(void 0);Zt.push(void 0,null,!0,!1);let Fn=Zt.length;function Oe(r){Fn===Zt.length&&Zt.push(Zt.length+1);const e=Fn;return Fn=Zt[e],Zt[e]=r,e}function ge(r){return Zt[r]}function pa(r){r<132||(Zt[r]=Fn,Fn=r)}function Ue(r){const e=ge(r);return pa(r),e}let mt=0;const er=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ha=typeof er.encodeInto=="function"?function(r,e){return er.encodeInto(r,e)}:function(r,e){const t=er.encode(r);return e.set(t),{read:r.length,written:t.length}};function Ot(r,e,t){if(t===void 0){const s=er.encode(r),a=e(s.length,1)>>>0;return mn().subarray(a,a+s.length).set(s),mt=s.length,a}let n=r.length,o=e(n,1)>>>0;const l=mn();let i=0;for(;i<n;i++){const s=r.charCodeAt(i);if(s>127)break;l[o+i]=s}if(i!==n){i!==0&&(r=r.slice(i)),o=t(o,n,n=i+r.length*3,1)>>>0;const s=mn().subarray(o+i,o+n),a=ha(r,s);i+=a.written}return mt=i,o}function _n(r){return r==null}let Tn=null;function Y(){return(Tn===null||Tn.byteLength===0)&&(Tn=new Int32Array(H.memory.buffer)),Tn}let An=null;function ii(){return(An===null||An.byteLength===0)&&(An=new Float64Array(H.memory.buffer)),An}let En=null;function ba(){return(En===null||En.byteLength===0)&&(En=new BigInt64Array(H.memory.buffer)),En}function Rr(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const o=r.description;return o==null?"Symbol":`Symbol(${o})`}if(e=="function"){const o=r.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(r)){const o=r.length;let l="[";o>0&&(l+=Rr(r[0]));for(let i=1;i<o;i++)l+=", "+Rr(r[i]);return l+="]",l}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function $o(r,e){const t=e(r.length*1,1)>>>0;return mn().set(r,t/1),mt=r.length,t}function ya(r,e){return r=r>>>0,ii().subarray(r/8,r/8+e)}function wa(r,e){return r=r>>>0,mn().subarray(r/1,r/1+e)}function ln(r,e){try{return r.apply(this,e)}catch(t){H.__wbindgen_exn_store(Oe(t))}}class va{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();H.__wbg_ltn_free(e)}constructor(e,t,n,o){try{const f=H.__wbindgen_add_to_stack_pointer(-16),c=$o(e,H.__wbindgen_malloc),_=mt,d=$o(t,H.__wbindgen_malloc),m=mt;var l=_n(o)?0:Ot(o,H.__wbindgen_malloc,H.__wbindgen_realloc),i=mt;H.ltn_new(f,c,_,d,m,Oe(n),l,i);var s=Y()[f/4+0],a=Y()[f/4+1],u=Y()[f/4+2];if(u)throw Ue(a);return this.__wbg_ptr=s>>>0,this}finally{H.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getInvertedBoundary(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}getBounds(){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getBounds(o,this.__wbg_ptr);var e=Y()[o/4+0],t=Y()[o/4+1],n=ya(e,t).slice();return H.__wbindgen_free(e,t*8,8),n}finally{H.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_toRouteSnapper(o,this.__wbg_ptr);var e=Y()[o/4+0],t=Y()[o/4+1],n=wa(e,t).slice();return H.__wbindgen_free(e,t*1,1),n}finally{H.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_toRouteSnapperGj(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_renderModalFilters(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_renderNeighbourhood(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_renderAutoBoundaries(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const l=H.__wbindgen_add_to_stack_pointer(-16),i=Ot(e,H.__wbindgen_malloc,H.__wbindgen_realloc),s=mt;H.ltn_setNeighbourhoodBoundary(l,this.__wbg_ptr,i,s,Oe(t));var n=Y()[l/4+0],o=Y()[l/4+1];if(o)throw Ue(n)}finally{H.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Ot(e,H.__wbindgen_malloc,H.__wbindgen_realloc),n=mt;H.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Ot(e,H.__wbindgen_malloc,H.__wbindgen_realloc),o=mt,l=Ot(t,H.__wbindgen_malloc,H.__wbindgen_realloc),i=mt;H.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,o,l,i)}setCurrentNeighbourhood(e,t){try{const l=H.__wbindgen_add_to_stack_pointer(-16),i=Ot(e,H.__wbindgen_malloc,H.__wbindgen_realloc),s=mt;H.ltn_setCurrentNeighbourhood(l,this.__wbg_ptr,i,s,t);var n=Y()[l/4+0],o=Y()[l/4+1];if(o)throw Ue(n)}finally{H.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const l=H.__wbindgen_add_to_stack_pointer(-16),i=Ot(t,H.__wbindgen_malloc,H.__wbindgen_realloc),s=mt;H.ltn_addModalFilter(l,this.__wbg_ptr,Oe(e),i,s);var n=Y()[l/4+0],o=Y()[l/4+1];if(o)throw Ue(n)}finally{H.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const l=H.__wbindgen_add_to_stack_pointer(-16),i=Ot(t,H.__wbindgen_malloc,H.__wbindgen_realloc),s=mt;H.ltn_addManyModalFilters(l,this.__wbg_ptr,Oe(e),i,s);var n=Y()[l/4+0],o=Y()[l/4+1];if(o)throw Ue(n)}finally{H.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){H.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_addDiagonalFilter(o,this.__wbg_ptr,e);var t=Y()[o/4+0],n=Y()[o/4+1];if(n)throw Ue(t)}finally{H.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_rotateDiagonalFilter(o,this.__wbg_ptr,e);var t=Y()[o/4+0],n=Y()[o/4+1];if(n)throw Ue(t)}finally{H.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_deleteDiagonalFilter(o,this.__wbg_ptr,e);var t=Y()[o/4+0],n=Y()[o/4+1];if(n)throw Ue(t)}finally{H.__wbindgen_add_to_stack_pointer(16)}}toggleDirection(e){H.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){H.ltn_undo(this.__wbg_ptr)}redo(){H.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const f=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getShortcutsCrossingRoad(f,this.__wbg_ptr,e);var o=Y()[f/4+0],l=Y()[f/4+1],i=Y()[f/4+2],s=Y()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ue(i);return t=a,n=u,ot(a,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getAllShortcuts(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_toSavefile(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const o=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_loadSavefile(o,this.__wbg_ptr,Oe(e));var t=Y()[o/4+0],n=Y()[o/4+1];if(n)throw Ue(t)}finally{H.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,o,l){let i,s;try{const m=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_compareRoute(m,this.__wbg_ptr,e,t,n,o,l);var a=Y()[m/4+0],u=Y()[m/4+1],f=Y()[m/4+2],c=Y()[m/4+3],_=a,d=u;if(c)throw _=0,d=0,Ue(f);return i=_,s=d,ot(_,d)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(i,s,1)}}impactToOneDestination(e,t){let n,o;try{const c=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_impactToOneDestination(c,this.__wbg_ptr,e,t);var l=Y()[c/4+0],i=Y()[c/4+1],s=Y()[c/4+2],a=Y()[c/4+3],u=l,f=i;if(a)throw u=0,f=0,Ue(s);return n=u,o=f,ot(u,f)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(n,o,1)}}predictImpact(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_predictImpact(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,n;try{const f=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getImpactsOnRoad(f,this.__wbg_ptr,e);var o=Y()[f/4+0],l=Y()[f/4+1],i=Y()[f/4+2],s=Y()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ue(i);return t=a,n=u,ot(a,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(t,n,1)}}getAllIntersections(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getAllIntersections(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const f=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getMovements(f,this.__wbg_ptr,e);var o=Y()[f/4+0],l=Y()[f/4+1],i=Y()[f/4+2],s=Y()[f/4+3],a=o,u=l;if(s)throw a=0,u=0,Ue(i);return t=a,n=u,ot(a,u)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const u=H.__wbindgen_add_to_stack_pointer(-16);H.ltn_getDemandModel(u,this.__wbg_ptr);var n=Y()[u/4+0],o=Y()[u/4+1],l=Y()[u/4+2],i=Y()[u/4+3],s=n,a=o;if(i)throw s=0,a=0,Ue(l);return e=s,t=a,ot(s,a)}finally{H.__wbindgen_add_to_stack_pointer(16),H.__wbindgen_free(e,t,1)}}}async function ka(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function $a(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(ot(e,t));return Oe(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Ue(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=ge(t),o=typeof n=="string"?n:void 0;var l=_n(o)?0:Ot(o,H.__wbindgen_malloc,H.__wbindgen_realloc),i=mt;Y()[e/4+1]=i,Y()[e/4+0]=l},r.wbg.__wbindgen_boolean_get=function(e){const t=ge(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof ge(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=ge(t),o=typeof n=="number"?n:void 0;ii()[e/8+1]=_n(o)?0:o,Y()[e/4+0]=!_n(o)},r.wbg.__wbindgen_is_object=function(e){const t=ge(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return ge(e)in ge(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Oe(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return ge(e)===ge(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Oe(t)},r.wbg.__wbindgen_is_undefined=function(e){return ge(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=ot(e,t);return Oe(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return ge(e)==ge(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=ge(e);return Oe(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=ge(e)[ge(t)];return Oe(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(ge(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(ge(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(ge(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(ge(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(ge(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Oe(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=ge(t).stack,o=Ot(n,H.__wbindgen_malloc,H.__wbindgen_realloc),l=mt;Y()[e/4+1]=l,Y()[e/4+0]=o},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,o;try{n=e,o=t,console.error(ot(e,t))}finally{H.__wbindgen_free(n,o,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=ge(e).performance;return Oe(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return ge(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=ge(e)[t>>>0];return Oe(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return ge(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof ge(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(ot(e,t));return Oe(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=ge(e).next;return Oe(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return ln(function(e){const t=ge(e).next();return Oe(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return ge(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=ge(e).value;return Oe(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Oe(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return ln(function(e,t){const n=Reflect.get(ge(e),ge(t));return Oe(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return ln(function(e,t){const n=ge(e).call(ge(t));return Oe(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return ln(function(){const e=self.self;return Oe(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return ln(function(){const e=window.window;return Oe(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return ln(function(){const e=globalThis.globalThis;return Oe(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return ln(function(){const e=global.global;return Oe(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(ge(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=ge(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(ge(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(ge(e));return Oe(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=ge(e).buffer;return Oe(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(ge(e));return Oe(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){ge(e).set(ge(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return ge(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=ge(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=ge(t),o=typeof n=="bigint"?n:void 0;ba()[e/8+1]=_n(o)?BigInt(0):o,Y()[e/4+0]=!_n(o)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Rr(ge(t)),o=Ot(n,H.__wbindgen_malloc,H.__wbindgen_realloc),l=mt;Y()[e/4+1]=l,Y()[e/4+0]=o},r.wbg.__wbindgen_throw=function(e,t){throw new Error(ot(e,t))},r.wbg.__wbindgen_memory=function(){const e=H.memory;return Oe(e)},r}function La(r,e){return H=r.exports,si.__wbindgen_wasm_module=e,En=null,An=null,Tn=null,Cn=null,H}async function si(r){if(H!==void 0)return H;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=$a();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ka(await r,e);return La(t,n)}function Ma(r){let e;const t=r[16].default,n=He(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Ge(n,t,o,o[24],e?We(t,o[24],l,null):Je(o[24]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Sa(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Ma]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Ol({props:l}),Ne.push(()=>ft(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],ct(()=>t=!1)),e.$set(a)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){E(e,i)}}}function Ca(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=Rl("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:b=void 0}=e,{manageHoverState:w=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function I(j){h=j,t(0,h)}function O(j){Pe.call(this,r,j)}function F(j){Pe.call(this,r,j)}function B(j){Pe.call(this,r,j)}function z(j){Pe.call(this,r,j)}function D(j){Pe.call(this,r,j)}function R(j){Pe.call(this,r,j)}return r.$$set=j=>{"id"in j&&t(1,l=j.id),"source"in j&&t(2,i=j.source),"sourceLayer"in j&&t(3,s=j.sourceLayer),"beforeId"in j&&t(4,a=j.beforeId),"beforeLayerType"in j&&t(5,u=j.beforeLayerType),"paint"in j&&t(6,f=j.paint),"layout"in j&&t(7,c=j.layout),"filter"in j&&t(8,_=j.filter),"applyToClusters"in j&&t(9,d=j.applyToClusters),"minzoom"in j&&t(10,m=j.minzoom),"maxzoom"in j&&t(11,g=j.maxzoom),"hoverCursor"in j&&t(12,b=j.hoverCursor),"manageHoverState"in j&&t(13,w=j.manageHoverState),"hovered"in j&&t(0,h=j.hovered),"eventsIfTopMost"in j&&t(14,y=j.eventsIfTopMost),"interactive"in j&&t(15,v=j.interactive),"$$scope"in j&&t(24,o=j.$$scope)},[h,l,i,s,a,u,f,c,_,d,m,g,b,w,y,v,n,I,O,F,B,z,D,R,o]}let Gn=class extends le{constructor(e){super(),ie(this,e,Ca,Sa,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Ta(r,e,t){let n;const o=nn();let{layer:l=void 0}=e;const{map:i}=Nl();Z(r,i,f=>t(2,n=f));function s(f){o(f.type,{...f,map:i})}const a=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],u=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Ft(()=>{if(n)if(l)for(const f of a)n.off(f,l,s);else for(const f of u)n.off(f,s)}),r.$$set=f=>{"layer"in f&&t(1,l=f.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(l)for(const f of a)n.on(f,l,s);else for(const f of u)n.on(f,s)},[i,l,n]}class ai extends le{constructor(e){super(),ie(this,e,Ta,null,oe,{layer:1})}}const Aa=r=>({marker:r&8}),Lo=r=>({marker:r[3]});function Ea(r){let e,t,n,o,l,i,s;const a=r[19].default,u=He(a,r,r[18],Lo);return{c(){e=$("div"),u&&u.c(),C(e,"tabindex",t=r[1]?0:void 0),C(e,"role",n=r[1]?"button":void 0),_e(e,"z-index",r[2])},m(f,c){L(f,e,c),u&&u.m(e,null),l=!0,i||(s=[lo(r[7].call(null,e)),lo(o=Pa.call(null,e,r[0])),V(e,"click",vr(r[20])),V(e,"dblclick",vr(r[21])),V(e,"contextmenu",vr(zl(r[22]))),V(e,"mouseenter",r[23]),V(e,"mouseleave",r[24]),V(e,"mousemove",r[25]),V(e,"keydown",r[8])],i=!0)},p(f,[c]){u&&u.p&&(!l||c&262152)&&Ge(u,a,f,f[18],l?We(a,f[18],c,Aa):Je(f[18]),Lo),(!l||c&2&&t!==(t=f[1]?0:void 0))&&C(e,"tabindex",t),(!l||c&2&&n!==(n=f[1]?"button":void 0))&&C(e,"role",n),o&&Tr(o.update)&&c&1&&o.update.call(null,f[0]),c&4&&_e(e,"z-index",f[2])},i(f){l||(k(u,f),l=!0)},o(f){S(u,f),l=!1},d(f){f&&M(e),u&&u.d(f),i=!1,at(s)}}}function Pa(r,e){const t=r.className;function n(o){o?r.className=`${t} ${o}`:r.className=t}return n(e),{update:n}}function Ia(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{marker:a=void 0}=e,{lngLat:u}=e,{class:f=void 0}=e,{interactive:c=!0}=e,{asButton:_=!1}=e,{draggable:d=!1}=e,{feature:m=null}=e,{offset:g=void 0}=e,{zIndex:b=void 0}=e,{rotation:w=0}=e,{opacity:h=1}=e;const y=nn(),{map:v,layerEvent:I,self:O,markerClickManager:F}=qi();Z(r,v,J=>t(27,l=J)),Z(r,I,J=>t(26,n=J)),Z(r,O,J=>t(3,o=J));function B(J){K(O,o=new Vt.Marker({element:J,rotation:w,draggable:d,offset:g,opacity:h.toString()}).setLngLat(u).addTo(l),o),t(11,a=o);const Ce=()=>R("dragstart"),Me=()=>{z(),R("drag")},be=()=>{z(),R("dragend")};return d&&(o.on("dragstart",Ce),o.on("drag",Me),o.on("dragend",be)),{destroy(){d&&(o==null||o.off("dragstart",Ce),o==null||o.off("drag",Me),o==null||o.off("dragend",be)),t(11,a=void 0),o==null||o.remove()}}}function z(){let J=o==null?void 0:o.getLngLat();J&&(Array.isArray(u)?t(10,u=[J.lng,J.lat]):u&&"lon"in u?t(10,u={lon:J.lng,lat:J.lat}):t(10,u=J))}function D(J){J.key===" "&&(J.preventDefault(),J.stopPropagation(),R("click"))}function R(J){if(!c)return;let Ce=o==null?void 0:o.getLngLat();if(!Ce)return;const Me=[Ce.lng,Ce.lat];let be={map:l,marker:o,lngLat:Me,features:[{type:"Feature",properties:(m==null?void 0:m.properties)??{},geometry:{type:"Point",coordinates:Me}}]};(J==="click"||J==="contextmenu")&&F.handleClick(be),K(I,n={...be,layerType:"marker",type:J},n),y(J,be)}const j=()=>R("click"),te=()=>R("dblclick"),W=()=>{R("contextmenu")},X=()=>{R("mouseenter")},se=()=>{R("mouseleave")},Le=()=>R("mousemove");return r.$$set=J=>{"marker"in J&&t(11,a=J.marker),"lngLat"in J&&t(10,u=J.lngLat),"class"in J&&t(0,f=J.class),"interactive"in J&&t(12,c=J.interactive),"asButton"in J&&t(1,_=J.asButton),"draggable"in J&&t(13,d=J.draggable),"feature"in J&&t(14,m=J.feature),"offset"in J&&t(15,g=J.offset),"zIndex"in J&&t(2,b=J.zIndex),"rotation"in J&&t(16,w=J.rotation),"opacity"in J&&t(17,h=J.opacity),"$$scope"in J&&t(18,s=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(o==null||o.setLngLat(u)),r.$$.dirty&32776&&(o==null||o.setOffset(g??[0,0])),r.$$.dirty&65544&&(o==null||o.setRotation(w)),r.$$.dirty&131080&&(o==null||o.setOpacity(h.toString()))},[f,_,b,o,v,I,O,B,D,R,u,a,c,d,m,g,w,h,s,i,j,te,W,X,se,Le]}class dr extends le{constructor(e){super(),ie(this,e,Ia,Ea,oe,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const Fa=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Mo=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function So(r){var o;let e,t,n=(((o=r[4])==null?void 0:o.length)||r[3]instanceof Vt.Marker)&&Co(r);return{c(){e=$("div"),n&&n.c()},m(l,i){L(l,e,i),n&&n.m(e,null),r[32](e),t=!0},p(l,i){var s;(s=l[4])!=null&&s.length||l[3]instanceof Vt.Marker?n?(n.p(l,i),i[0]&24&&k(n,1)):(n=Co(l),n.c(),k(n,1),n.m(e,null)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(l){t||(k(n),t=!0)},o(l){S(n),t=!1},d(l){l&&M(e),n&&n.d(),r[32](null)}}}function Co(r){let e;const t=r[30].default,n=He(t,r,r[29],Mo);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[0]&536870933)&&Ge(n,t,o,o[29],e?We(t,o[29],l,Fa):Je(o[29]),Mo)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function ja(r){let e,t,n=r[9].default&&So(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,l){o[9].default?n?(n.p(o,l),l[0]&512&&k(n,1)):(n=So(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function Ba(r,e,t){let n,o,l,i,s,a,{$$slots:u={},$$scope:f}=e;const c=Zi(u);let{closeButton:_=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:m=!1}=e,{closeOnMove:g=!1}=e,{openOn:b="click"}=e,{openIfTopMost:w=!0}=e,{focusAfterOpen:h=!0}=e,{anchor:y=void 0}=e,{offset:v=void 0}=e,{popupClass:I=void 0}=e,{maxWidth:O=void 0}=e,{lngLat:F=void 0}=e,{html:B=void 0}=e,{open:z=!1}=e;const D=nn(),{map:R,popupTarget:j,layerEvent:te,layer:W,eventTopMost:X,markerClickManager:se}=Nl();Z(r,R,U=>t(2,l=U)),Z(r,j,U=>t(3,s=U)),Z(r,te,U=>t(28,i=U)),Z(r,W,U=>t(35,a=U));const Le=["click","dblclick","contextmenu"];let J,Ce=!1,Me;function be(){if(!J)return;let U=J.getElement();!U||U===Me||(Me=U,b==="hover"&&(Me.style.pointerEvents="none"),Me.addEventListener("mouseenter",()=>{t(24,Ce=!0)},{passive:!0}),Me.addEventListener("mouseleave",()=>{t(24,Ce=!1)},{passive:!0}),Me.addEventListener("click",()=>{m&&t(0,z=!1)},{passive:!0}))}ur(()=>{if(l)return l.on("click",ce),l.on("contextmenu",ce),se.add(q),typeof s=="string"&&(l.on("click",s,$e),l.on("dblclick",s,$e),l.on("contextmenu",s,$e),l.on("mousemove",s,x),l.on("mouseleave",s,Ct),l.on("touchstart",s,we),l.on("touchend",s,lt)),()=>{l!=null&&l.loaded()&&(J==null||J.remove(),l.off("click",ce),l.off("contextmenu",ce),se.remove(q),s instanceof Vt.Marker?s.getPopup()===J&&s.setPopup(void 0):typeof s=="string"&&(l.off("click",s,$e),l.off("dblclick",s,$e),l.off("contextmenu",s,$e),l.off("mousemove",s,x),l.off("mouseleave",s,Ct),l.off("touchstart",s,we),l.off("touchend",s,lt)))}});function ae(U){return w?!("marker"in U)&&!Xi(U)&&X(U)!==a:!1}let Re=null,ue="normal";function pe(U){"layerType"in U&&U.layerType==="deckgl"?(t(10,F=U.coordinate),t(4,Re=U.object?[U.object]:null)):(t(10,F=U.lngLat),t(4,Re=U.features??[]))}function $e(U){U.type!==b||ae(U)||(pe(U),setTimeout(()=>t(0,z=!0)))}let ne=null;function we(U){ne=U.point}function lt(U){if(!ne||b!=="hover")return;let tt=ne.dist(U.point);ne=null,tt<3&&(t(10,F=U.lngLat),t(4,Re=U.features??[]),J.isOpen()?t(25,ue="justOpened"):(t(25,ue="opening"),t(0,z=!0)))}function Ct(U){b!=="hover"||ne||ue!=="normal"||(t(0,z=!1),t(4,Re=null))}function x(U){if(!(b!=="hover"||ne||ue!=="normal")){if(ae(U)){t(0,z=!1),t(4,Re=null);return}t(0,z=!0),t(4,Re=U.features??[]),t(10,F=U.lngLat)}}function ce(U){if(ue==="justOpened"){t(25,ue="normal");return}if(!d)return;let tt=[Me,s instanceof Vt.Marker?s==null?void 0:s.getElement():null];z&&J.isOpen()&&!tt.some(je=>je==null?void 0:je.contains(U.originalEvent.target))&&(U.type==="contextmenu"&&b==="contextmenu"||U.type!=="contextmenu")&&t(0,z=!1)}function q(U){d&&z&&J.isOpen()&&U.marker!==s&&t(0,z=!1)}Ft(()=>{l&&(J!=null&&J.isOpen())&&J.remove()});let ye;const de=()=>t(0,z=!1);function me(U){Ne[U?"unshift":"push"](()=>{ye=U,t(1,ye)})}return r.$$set=U=>{"closeButton"in U&&t(11,_=U.closeButton),"closeOnClickOutside"in U&&t(12,d=U.closeOnClickOutside),"closeOnClickInside"in U&&t(13,m=U.closeOnClickInside),"closeOnMove"in U&&t(14,g=U.closeOnMove),"openOn"in U&&t(15,b=U.openOn),"openIfTopMost"in U&&t(16,w=U.openIfTopMost),"focusAfterOpen"in U&&t(17,h=U.focusAfterOpen),"anchor"in U&&t(18,y=U.anchor),"offset"in U&&t(19,v=U.offset),"popupClass"in U&&t(20,I=U.popupClass),"maxWidth"in U&&t(21,O=U.maxWidth),"lngLat"in U&&t(10,F=U.lngLat),"html"in U&&t(22,B=U.html),"open"in U&&t(0,z=U.open),"$$scope"in U&&t(29,f=U.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=_??(!d&&!m)),r.$$.dirty[0]&146685952&&(J||(t(23,J=new Vt.Popup({closeButton:n,closeOnClick:!1,closeOnMove:g,focusAfterOpen:h,maxWidth:O,className:I,anchor:y,offset:v})),Me=J.getElement(),J.on("open",()=>{t(0,z=!0),be(),D("open",J)}),J.on("close",()=>{t(0,z=!1),D("close",J)}),J.on("hover",()=>{D("hover",J)}))),r.$$.dirty[0]&8421384&&J&&s instanceof Vt.Marker&&(b==="click"?s.setPopup(J):s.getPopup()===J&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Le.includes(b)&&(i==null?void 0:i.type)===b&&($e(i),K(te,i=null,i)),r.$$.dirty[0]&268468224&&t(26,o=b==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),r.$$.dirty[0]&352354304&&b==="hover"&&te&&(o&&i&&pe(i),t(0,z=(o||Ce)??!1)),r.$$.dirty[0]&12582914&&(ye?J.setDOMContent(ye):B&&J.setHTML(B)),r.$$.dirty[0]&8389632&&F&&J.setLngLat(F),r.$$.dirty[0]&41943045&&l){let U=J.isOpen();z&&!U?(J.addTo(l),ue==="opening"&&t(25,ue="justOpened")):!z&&U&&J.remove()}},[z,ye,l,s,Re,R,j,te,W,c,F,_,d,m,g,b,w,h,y,v,I,O,B,J,Ce,ue,o,n,i,f,u,de,me]}class Oa extends le{constructor(e){super(),ie(this,e,Ba,ja,oe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Ra(r){let e;const t=r[16].default,n=He(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Ge(n,t,o,o[24],e?We(t,o[24],l,null):Je(o[24]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Na(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Ra]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new Ol({props:l}),Ne.push(()=>ft(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],ct(()=>t=!1)),e.$set(a)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){E(e,i)}}}function za(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=Rl("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f=void 0}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:b=void 0}=e,{manageHoverState:w=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function I(j){h=j,t(0,h)}function O(j){Pe.call(this,r,j)}function F(j){Pe.call(this,r,j)}function B(j){Pe.call(this,r,j)}function z(j){Pe.call(this,r,j)}function D(j){Pe.call(this,r,j)}function R(j){Pe.call(this,r,j)}return r.$$set=j=>{"id"in j&&t(1,l=j.id),"source"in j&&t(2,i=j.source),"sourceLayer"in j&&t(3,s=j.sourceLayer),"beforeId"in j&&t(4,a=j.beforeId),"beforeLayerType"in j&&t(5,u=j.beforeLayerType),"paint"in j&&t(6,f=j.paint),"layout"in j&&t(7,c=j.layout),"filter"in j&&t(8,_=j.filter),"applyToClusters"in j&&t(9,d=j.applyToClusters),"minzoom"in j&&t(10,m=j.minzoom),"maxzoom"in j&&t(11,g=j.maxzoom),"hoverCursor"in j&&t(12,b=j.hoverCursor),"manageHoverState"in j&&t(13,w=j.manageHoverState),"hovered"in j&&t(0,h=j.hovered),"eventsIfTopMost"in j&&t(14,y=j.eventsIfTopMost),"interactive"in j&&t(15,v=j.interactive),"$$scope"in j&&t(24,o=j.$$scope)},[h,l,i,s,a,u,f,c,_,d,m,g,b,w,y,v,n,I,O,F,B,z,D,R,o]}class Nr extends le{constructor(e){super(),ie(this,e,za,Na,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Da(r){let e,t;return{c(){e=Xt("svg"),t=Xt("path"),C(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),C(e,"viewBox","0 0 14 14"),C(e,"width","13"),C(e,"height","13"),C(e,"class","svelte-en2qvf")},m(n,o){L(n,e,o),p(e,t)},p:Q,i:Q,o:Q,d(n){n&&M(e)}}}class ui extends le{constructor(e){super(),ie(this,e,null,Da,oe,{})}}function Ua(r){let e,t;return{c(){e=Xt("svg"),t=Xt("path"),C(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),C(e,"viewBox","0 0 30 30"),C(e,"fill","none"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"class","svelte-d2loi5")},m(n,o){L(n,e,o),p(e,t)},p:Q,i:Q,o:Q,d(n){n&&M(e)}}}class fi extends le{constructor(e){super(),ie(this,e,null,Ua,oe,{})}}function Ha(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"area.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"area.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function Ga(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"reverse.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"reverse.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function Ja(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"poi.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"poi.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function Wa(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"postal_code.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"postal_code.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function qa(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"street.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"street.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function Za(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"road.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"road.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function Xa(r){let e,t;return{c(){e=$("img"),ze(e.src,t=r[3]+"housenumber.svg")||C(e,"src",t),C(e,"alt",r[6]),C(e,"class","svelte-ltkwvy")},m(n,o){L(n,e,o)},p(n,o){o&8&&!ze(e.src,t=n[3]+"housenumber.svg")&&C(e,"src",t),o&64&&C(e,"alt",n[6])},d(n){n&&M(e)}}}function Ya(r){let e,t,n,o;return{c(){e=$("img"),ze(e.src,t=r[5])||C(e,"src",t),C(e,"alt",r[4]),C(e,"class","svelte-ltkwvy")},m(l,i){L(l,e,i),n||(o=V(e,"error",r[14]),n=!0)},p(l,i){i&32&&!ze(e.src,t=l[5])&&C(e,"src",t),i&16&&C(e,"alt",l[4])},d(l){l&&M(e),n=!1,o()}}}function To(r){let e,t;return{c(){e=$("span"),t=N(r[6]),C(e,"class","secondary svelte-ltkwvy")},m(n,o){L(n,e,o),p(e,t)},p(n,o){o&64&&fe(t,n[6])},d(n){n&&M(e)}}}function Ka(r){let e,t,n,o,l,i,s,a,u,f=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",c,_,d=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],m,g,b=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",w,h,y;function v(B,z){return z&1&&(t=null),z&1&&(n=null),z&1&&(o=null),z&1&&(l=null),B[5]?Ya:B[0].address?Xa:(t==null&&(t=!!B[0].id.startsWith("road.")),t?Za:(n==null&&(n=!!B[0].id.startsWith("address.")),n?qa:(o==null&&(o=!!B[0].id.startsWith("postal_code.")),o?Wa:(l==null&&(l=!!B[0].id.startsWith("poi.")),l?Ja:B[7]?Ga:Ha))))}let I=v(r,-1),O=I(r),F=d&&To(r);return{c(){e=$("li"),O.c(),i=P(),s=$("span"),a=$("span"),u=$("span"),c=N(f),_=P(),F&&F.c(),m=P(),g=$("span"),w=N(b),C(u,"class","primary svelte-ltkwvy"),C(a,"class","svelte-ltkwvy"),C(g,"class","line2 svelte-ltkwvy"),C(s,"class","texts svelte-ltkwvy"),C(e,"tabindex","0"),C(e,"data-selected",r[1]),C(e,"class","svelte-ltkwvy"),gt(e,"selected",r[1])},m(B,z){L(B,e,z),O.m(e,null),p(e,i),p(e,s),p(s,a),p(a,u),p(u,c),p(a,_),F&&F.m(a,null),p(s,m),p(s,g),p(g,w),h||(y=[V(e,"mouseenter",r[12]),V(e,"focus",r[13])],h=!0)},p(B,[z]){I===(I=v(B,z))&&O?O.p(B,z):(O.d(1),O=I(B),O&&(O.c(),O.m(e,i))),z&1&&f!==(f=(B[7]?B[0].place_name:B[0].place_name.replace(/,.*/,""))+"")&&fe(c,f),z&37&&(d=B[2]==="always"||B[2]!=="never"&&!B[0].address&&!B[0].id.startsWith("road.")&&!B[0].id.startsWith("address.")&&!B[0].id.startsWith("postal_code.")&&(!B[0].id.startsWith("poi.")||!B[5])&&!B[7]),d?F?F.p(B,z):(F=To(B),F.c(),F.m(a,null)):F&&(F.d(1),F=null),z&1&&b!==(b=(B[7]?"":B[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&fe(w,b),z&2&&C(e,"data-selected",B[1]),z&2&&gt(e,"selected",B[1])},i:Q,o:Q,d(B){B&&M(e),O.d(),F&&F.d(),h=!1,at(y)}}}function Va(r,e,t){var y;let n,o,{feature:l}=e,{selected:i=!1}=e,{showPlaceType:s}=e,{missingIconsCache:a}=e,{iconsBaseUrl:u}=e;const f=(y=l.properties)==null?void 0:y.categories;let c,_,d=0,m=l.place_type[0]==="reverse";function g(){_&&a.add(_),t(10,d++,d)}function b(v){Pe.call(this,r,v)}function w(v){Pe.call(this,r,v)}const h=()=>g();return r.$$set=v=>{"feature"in v&&t(0,l=v.feature),"selected"in v&&t(1,i=v.selected),"showPlaceType"in v&&t(2,s=v.showPlaceType),"missingIconsCache"in v&&t(9,a=v.missingIconsCache),"iconsBaseUrl"in v&&t(3,u=v.iconsBaseUrl)},r.$$.update=()=>{var v,I,O,F;if(r.$$.dirty&3640)do t(11,n--,n),t(4,c=f==null?void 0:f[n]),t(5,_=c?u+c.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!_||a.has(_)));r.$$.dirty&1&&t(6,o=((I=(v=l.properties)==null?void 0:v.categories)==null?void 0:I.join(", "))??((F=(O=l.properties)==null?void 0:O.place_type_name)==null?void 0:F[0])??l.place_type[0])},t(11,n=(f==null?void 0:f.length)??0),[l,i,s,u,c,_,o,m,g,a,d,n,b,w,h]}class Qa extends le{constructor(e){super(),ie(this,e,Va,Ka,oe,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function xa(r){let e;return{c(){e=$("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',C(e,"class","svelte-7cmwmc")},m(t,n){L(t,e,n)},p:Q,i:Q,o:Q,d(t){t&&M(e)}}}class eu extends le{constructor(e){super(),ie(this,e,null,xa,oe,{})}}function tu(r){let e,t;return{c(){e=Xt("svg"),t=Xt("path"),C(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),C(e,"viewBox","0 0 60.006 21.412"),C(e,"width","14"),C(e,"height","20"),C(e,"class","svelte-en2qvf")},m(n,o){L(n,e,o),p(e,t)},p:Q,i:Q,o:Q,d(n){n&&M(e)}}}class nu extends le{constructor(e){super(),ie(this,e,null,tu,oe,{})}}function ru(r){let e,t,n;return{c(){e=Xt("svg"),t=Xt("circle"),n=Xt("path"),C(t,"cx","4.789"),C(t,"cy","4.787"),C(t,"r","3.85"),C(t,"class","svelte-1aq105l"),C(n,"d","M12.063 12.063 7.635 7.635"),C(n,"class","svelte-1aq105l"),C(e,"xmlns","http://www.w3.org/2000/svg"),C(e,"width","13"),C(e,"height","13"),C(e,"viewBox","0 0 13 13"),C(e,"class","svelte-1aq105l")},m(o,l){L(o,e,l),p(e,t),p(e,n)},p:Q,i:Q,o:Q,d(o){o&&M(e)}}}class ou extends le{constructor(e){super(),ie(this,e,null,ru,oe,{})}}function lu(r,e,t){const n=e[1],o=e[0],l=n-o;return r===n&&t?r:((r-o)%l+l)%l+o}function Ao(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let kn;async function iu(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const o of e??[])if(!(n&&(o.minZoom!=null&&o.minZoom>n[0]||o.maxZoom!=null&&o.maxZoom<n[0]))){if(o.type==="fixed")return o.coordinates.join(",");e:if(o.type==="client-geolocation"){if(kn&&o.cachedLocationExpiry&&kn.time+o.cachedLocationExpiry>Date.now()){if(!kn.coords)break e;return kn.coords}let l;try{return l=await new Promise((i,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(a=>{i([a.coords.longitude,a.coords.latitude].map(u=>u.toFixed(6)).join(","))},a=>{s(a)},o)}),l}catch{}finally{o.cachedLocationExpiry&&(kn={time:Date.now(),coords:l})}if(t.signal.aborted)return}if(o.type==="server-geolocation")return"ip";if(n&&o.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}function Eo(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function Po(r){let e,t;return e=new eu({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Io(r){let e,t,n,o,l;return t=new nu({}),{c(){e=$("button"),T(t.$$.fragment),C(e,"type","button"),C(e,"title",r[9]),C(e,"class","svelte-bz0zu3"),gt(e,"active",r[0])},m(i,s){L(i,e,s),A(t,e,null),n=!0,o||(l=V(e,"click",r[69]),o=!0)},p(i,s){(!n||s[0]&512)&&C(e,"title",i[9]),(!n||s[0]&1)&&gt(e,"active",i[0])},i(i){n||(k(t.$$.fragment,i),n=!0)},o(i){S(t.$$.fragment,i),n=!1},d(i){i&&M(e),E(t),o=!1,l()}}}function su(r){let e,t=[],n=new Map,o,l,i,s=qe(r[14]);const a=u=>u[84].id+(u[84].address?","+u[84].address:"");for(let u=0;u<s.length;u+=1){let f=Eo(r,s,u),c=a(f);n.set(c,t[u]=Fo(c,f))}return{c(){e=$("ul");for(let u=0;u<t.length;u+=1)t[u].c();C(e,"class","options svelte-bz0zu3")},m(u,f){L(u,e,f);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);o=!0,l||(i=[V(e,"mouseleave",r[73]),V(e,"blur",r[74])],l=!0)},p(u,f){f[0]&17880064&&(s=qe(u[14]),ve(),t=Ki(t,f,a,1,u,s,n,e,Vi,Fo,null,Eo),ke())},i(u){if(!o){for(let f=0;f<s.length;f+=1)k(t[f]);o=!0}},o(u){for(let f=0;f<t.length;f+=1)S(t[f]);o=!1},d(u){u&&M(e);for(let f=0;f<t.length;f+=1)t[f].d();l=!1,at(i)}}}function au(r){let e,t,n,o,l,i;return t=new fi({}),{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("div"),l=N(r[7]),C(o,"class","svelte-bz0zu3"),C(e,"class","no-results svelte-bz0zu3")},m(s,a){L(s,e,a),A(t,e,null),p(e,n),p(e,o),p(o,l),i=!0},p(s,a){(!i||a[0]&128)&&fe(l,s[7])},i(s){i||(k(t.$$.fragment,s),i=!0)},o(s){S(t.$$.fragment,s),i=!1},d(s){s&&M(e),E(t)}}}function uu(r){let e="",t;return{c(){t=N(e)},m(n,o){L(n,t,o)},p:Q,i:Q,o:Q,d(n){n&&M(t)}}}function fu(r){let e,t,n,o,l,i,s,a,u,f,c;return t=new fi({}),a=new ui({}),{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("div"),l=N(r[6]),i=P(),s=$("button"),T(a.$$.fragment),C(o,"class","svelte-bz0zu3"),C(s,"class","svelte-bz0zu3"),C(e,"class","error svelte-bz0zu3")},m(_,d){L(_,e,d),A(t,e,null),p(e,n),p(e,o),p(o,l),p(e,i),p(e,s),A(a,s,null),u=!0,f||(c=V(s,"click",r[70]),f=!0)},p(_,d){(!u||d[0]&64)&&fe(l,_[6])},i(_){u||(k(t.$$.fragment,_),k(a.$$.fragment,_),u=!0)},o(_){S(t.$$.fragment,_),S(a.$$.fragment,_),u=!1},d(_){_&&M(e),E(t),E(a),f=!1,c()}}}function Fo(r,e){let t,n,o;function l(){return e[71](e[86])}function i(){return e[72](e[84])}return n=new Qa({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",l),n.$on("focus",i),{key:r,first:null,c(){t=et(),T(n.$$.fragment),this.first=t},m(s,a){L(s,t,a),A(n,s,a),o=!0},p(s,a){e=s;const u={};a[0]&16384&&(u.feature=e[84]),a[0]&1024&&(u.showPlaceType=e[10]),a[0]&49152&&(u.selected=e[15]===e[86]),a[0]&4096&&(u.iconsBaseUrl=e[12]),n.$set(u)},i(s){o||(k(n.$$.fragment,s),o=!0)},o(s){S(n.$$.fragment,s),o=!1},d(s){s&&M(t),E(n,s)}}}function cu(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b,w,h,y,v,I,O=!1;l=new ou({}),c=new ui({});let F=r[19]&&Po(),B=r[5]==="button"&&Io(r);const z=r[61].default,D=He(z,r,r[60],null),R=[fu,uu,au,su],j=[];function te(W,X){var se,Le;return W[18]?0:W[16]?((se=W[14])==null?void 0:se.length)===0?2:W[16]&&((Le=W[14])!=null&&Le.length)?3:-1:1}return~(b=te(r))&&(w=j[b]=R[b](r)),{c(){e=P(),t=$("form"),n=$("div"),o=$("button"),T(l.$$.fragment),i=P(),s=$("input"),a=P(),u=$("div"),f=$("button"),T(c.$$.fragment),_=P(),F&&F.c(),d=P(),B&&B.c(),m=P(),D&&D.c(),g=P(),w&&w.c(),C(o,"class","search-button svelte-bz0zu3"),C(o,"type","button"),C(s,"placeholder",r[8]),C(s,"aria-label",r[8]),C(s,"class","svelte-bz0zu3"),C(f,"type","button"),C(f,"title",r[3]),C(f,"class","svelte-bz0zu3"),C(u,"class","clear-button-container svelte-bz0zu3"),gt(u,"displayable",r[1]!==""),C(n,"class","input-group svelte-bz0zu3"),C(t,"tabindex","0"),C(t,"class",h=io(r[2])+" svelte-bz0zu3"),gt(t,"can-collapse",r[4]&&r[1]==="")},m(W,X){L(W,e,X),L(W,t,X),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),r[63](s),Ye(s,r[1]),p(n,a),p(n,u),p(u,f),A(c,f,null),p(u,_),F&&F.m(u,null),p(n,d),B&&B.m(n,null),p(n,m),D&&D.m(n,null),p(t,g),~b&&j[b].m(t,null),y=!0,v||(I=[V(o,"click",r[62]),V(s,"input",r[64]),V(s,"focus",r[65]),V(s,"blur",r[66]),V(s,"keydown",r[22]),V(s,"input",r[67]),V(f,"click",r[68]),V(t,"submit",zl(r[21]))],v=!0)},p(W,X){(!y||X[0]&256)&&C(s,"placeholder",W[8]),(!y||X[0]&256)&&C(s,"aria-label",W[8]),X[0]&2&&s.value!==W[1]&&Ye(s,W[1]),(!y||X[0]&8)&&C(f,"title",W[3]),W[19]?F?X[0]&524288&&k(F,1):(F=Po(),F.c(),k(F,1),F.m(u,null)):F&&(ve(),S(F,1,1,()=>{F=null}),ke()),(!y||X[0]&2)&&gt(u,"displayable",W[1]!==""),W[5]==="button"?B?(B.p(W,X),X[0]&32&&k(B,1)):(B=Io(W),B.c(),k(B,1),B.m(n,m)):B&&(ve(),S(B,1,1,()=>{B=null}),ke()),D&&D.p&&(!y||X[1]&536870912)&&Ge(D,z,W,W[60],y?We(z,W[60],X,null):Je(W[60]),null);let se=b;b=te(W),b===se?~b&&j[b].p(W,X):(w&&(ve(),S(j[se],1,1,()=>{j[se]=null}),ke()),~b?(w=j[b],w?w.p(W,X):(w=j[b]=R[b](W),w.c()),k(w,1),w.m(t,null)):w=null),(!y||X[0]&4&&h!==(h=io(W[2])+" svelte-bz0zu3"))&&C(t,"class",h),(!y||X[0]&22)&&gt(t,"can-collapse",W[4]&&W[1]==="")},i(W){y||(k(O),k(l.$$.fragment,W),k(c.$$.fragment,W),k(F),k(B),k(D,W),k(w),y=!0)},o(W){S(O),S(l.$$.fragment,W),S(c.$$.fragment,W),S(F),S(B),S(D,W),S(w),y=!1},d(W){W&&(M(e),M(t)),E(l),r[63](null),E(c),F&&F.d(),B&&B.d(),D&&D.d(W),~b&&j[b].d(),v=!1,at(I)}}}function du(r,e,t){let n,o,{$$slots:l={},$$scope:i}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:a=void 0}=e,{apiKey:u}=e,{bbox:f=void 0}=e,{clearButtonTitle:c="clear"}=e,{clearOnBlur:_=!1}=e,{collapsed:d=!1}=e,{country:m=void 0}=e,{debounceSearch:g=200}=e,{enableReverse:b="never"}=e,{errorMessage:w="Something went wrongâ¦"}=e,{filter:h=()=>!0}=e,{flyTo:y=!0}=e,{fuzzyMatch:v=!0}=e,{language:I=void 0}=e,{limit:O=void 0}=e,{mapController:F=void 0}=e,{minLength:B=2}=e,{noResultsMessage:z="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:D="Search"}=e,{proximity:R=[{type:"server-geolocation"}]}=e,{reverseActive:j=b==="always"}=e,{reverseButtonTitle:te="toggle reverse geocoding"}=e,{searchValue:W=""}=e,{pickedResultStyle:X="full-geometry"}=e,{showPlaceType:se="if-needed"}=e,{showResultsWhileTyping:Le=!0}=e,{selectFirst:J=!0}=e,{flyToSelected:Ce=!1}=e,{markerOnSelected:Me=!0}=e,{types:be=void 0}=e,{exhaustiveReverseGeocoding:ae=!1}=e,{excludeTypes:Re=!1}=e,{zoom:ue=s}=e,{apiUrl:pe="https://api.maptiler.com/geocoding"}=e,{fetchParameters:$e={}}=e,{iconsBaseUrl:ne="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:we=()=>{}}=e;function lt(){je.focus()}function Ct(){je.blur()}function x(G,Xe=!0,it=!1){t(1,W=G),Xe?(t(15,Be=-1),Lt()):(hr(!it,it),setTimeout(()=>{je.focus(),je.select()}))}function ce(){t(14,de=void 0),t(56,U=void 0),t(15,Be=-1)}function q(){t(55,me=[]),t(56,U=void 0)}let ye=!1,de,me,U,tt="",je,Be=-1,ht,ut=[],De,Jt,Wt,bt;const Zn=new Set,$t=nn();Ft(()=>{F&&(F.setEventHandler(void 0),F.indicateReverse(!1),F.setSelectedMarker(-1),F.setFeatures(void 0,void 0,!1))});function Lt(G){if(Jt&&(clearTimeout(Jt),Jt=void 0),Be>-1&&de)t(56,U=de[Be]),t(1,W=U.place_type[0]==="reverse"?U.place_name:U.place_name.replace(/,.*/,"")),t(18,ht=void 0),t(55,me=void 0),t(15,Be=-1);else if(W){const Xe=G||!Ke(W);Te(W,{exact:!0}).then(()=>{t(55,me=de),t(56,U=void 0),Xe&&Ve()}).catch(it=>t(18,ht=it))}}function Ke(G){try{return Yi(G,6)}catch{return!1}}async function Te(G,{byId:Xe=!1,exact:it=!1}={}){t(18,ht=void 0),De==null||De.abort();const Mt=new AbortController;t(19,De=Mt);try{const Ae=Ke(G),nt=new URLSearchParams;if(I!==void 0&&nt.set("language",Array.isArray(I)?I.join(","):I??""),be&&nt.set("types",be.join(",")),Re&&nt.set("excludeTypes",String(Re)),f&&nt.set("bbox",f.map(Xn=>Xn.toFixed(6)).join(",")),m&&nt.set("country",Array.isArray(m)?m.join(","):m),!Xe&&!Ae){const Xn=await iu(F,R,Mt);Xn&&nt.set("proximity",Xn),(it||!Le)&&nt.set("autocomplete","false"),nt.set("fuzzyMatch",String(v))}O!==void 0&&(ae||!Ae||(be==null?void 0:be.length)===1)&&nt.set("limit",String(O)),nt.set("key",u),we(nt);const Dt=pe+"/"+encodeURIComponent(Ae?Ae.decimalLongitude+","+Ae.decimalLatitude:G)+".json?"+nt.toString();if(Dt===tt){Xe?(t(14,de=void 0),t(56,U=ut[0])):t(14,de=ut);return}tt=Dt;const yr=await fetch(Dt,{signal:Mt.signal,...$e});if(!yr.ok)throw new Error(await yr.text());const wr=await yr.json();$t("response",{url:Dt,featureCollection:wr}),Xe?(t(14,de=void 0),t(56,U=wr.features[0]),ut=[U]):(t(14,de=wr.features.filter(h)),Ae&&de.unshift({type:"Feature",properties:{},id:"reverse_"+Ae.decimalLongitude+"_"+Ae.decimalLatitude,text:Ae.decimalLatitude+", "+Ae.decimalLongitude,place_name:Ae.decimalLatitude+", "+Ae.decimalLongitude,place_type:["reverse"],center:[Ae.decimalLongitude,Ae.decimalLatitude],bbox:[Ae.decimalLongitude,Ae.decimalLatitude,Ae.decimalLongitude,Ae.decimalLatitude],geometry:{type:"Point",coordinates:[Ae.decimalLongitude,Ae.decimalLatitude]}}),ut=de,Ae&&je.focus())}catch(Ae){if(Ae&&typeof Ae=="object"&&"name"in Ae&&Ae.name==="AbortError")return;throw Ae}finally{Mt===De&&t(19,De=void 0)}}function Ve(){var Mt;if(!(me!=null&&me.length)||!y)return;const G=[180,90,-180,-90],Xe=!me.some(Ae=>!Ae.matching_text);let it;for(const Ae of me){const nt=wn(Ae);if(it=it===void 0?nt:nt===void 0?it:Math.max(it,nt),Xe||!Ae.matching_text)for(const Dt of[0,1,2,3])G[Dt]=Math[Dt<2?"min":"max"](G[Dt],((Mt=Ae.bbox)==null?void 0:Mt[Dt])??Ae.center[Dt%2])}F&&me.length>0&&(U&&G[0]===G[2]&&G[1]===G[3]?F.flyTo(U.center,wn(U)):F.fitBounds(Ao(G),50,it))}function wn(G){var it;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Xe=G.id.replace(/\..*/,"");return(Array.isArray((it=G.properties)==null?void 0:it.categories)?G.properties.categories.reduce((Mt,Ae)=>{const nt=ue[Xe+"."+Ae];return Mt===void 0?nt:nt===void 0?Mt:Math.max(Mt,nt)},void 0):void 0)??ue[Xe]}function Ci(G){t(0,j=b==="always"),t(14,de=void 0),t(56,U=void 0),t(15,Be=-1),x(G[1].toFixed(6)+", "+lu(G[0],[-180,180],!0).toFixed(6),!1,!0)}function Ti(G){if(!de)return;let Xe=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Xe&&(Be===(J?0:-1)&&Xe===-1&&t(15,Be=de.length),t(15,Be+=Xe),Be>=de.length&&t(15,Be=-1),Be<0&&J&&t(15,Be=0),G.preventDefault())}function hr(G=!0,Xe=!1){if(t(18,ht=void 0),Le||Xe){if(Jt&&clearTimeout(Jt),W.length<B)return;const it=W;Jt=window.setTimeout(()=>{Te(it).catch(Mt=>t(18,ht=Mt))},G?g:0)}else t(14,de=void 0),t(18,ht=void 0)}function br(G){t(56,U=G),t(1,W=G.place_name),t(15,Be=-1)}const Ai=()=>je.focus();function Ei(G){Ne[G?"unshift":"push"](()=>{je=G,t(17,je)})}function Pi(){W=this.value,t(1,W),t(13,ye),t(28,_)}const Ii=()=>t(13,ye=!0),Fi=()=>t(13,ye=!1),ji=()=>hr(),Bi=()=>{t(1,W=""),je.focus()},Oi=()=>t(0,j=!j),Ri=()=>t(18,ht=void 0),Ni=G=>t(15,Be=G),zi=G=>br(G),Di=()=>{J||t(15,Be=-1)},Ui=()=>{};return r.$$set=G=>{"class"in G&&t(2,a=G.class),"apiKey"in G&&t(26,u=G.apiKey),"bbox"in G&&t(27,f=G.bbox),"clearButtonTitle"in G&&t(3,c=G.clearButtonTitle),"clearOnBlur"in G&&t(28,_=G.clearOnBlur),"collapsed"in G&&t(4,d=G.collapsed),"country"in G&&t(29,m=G.country),"debounceSearch"in G&&t(30,g=G.debounceSearch),"enableReverse"in G&&t(5,b=G.enableReverse),"errorMessage"in G&&t(6,w=G.errorMessage),"filter"in G&&t(31,h=G.filter),"flyTo"in G&&t(32,y=G.flyTo),"fuzzyMatch"in G&&t(33,v=G.fuzzyMatch),"language"in G&&t(34,I=G.language),"limit"in G&&t(35,O=G.limit),"mapController"in G&&t(36,F=G.mapController),"minLength"in G&&t(37,B=G.minLength),"noResultsMessage"in G&&t(7,z=G.noResultsMessage),"placeholder"in G&&t(8,D=G.placeholder),"proximity"in G&&t(38,R=G.proximity),"reverseActive"in G&&t(0,j=G.reverseActive),"reverseButtonTitle"in G&&t(9,te=G.reverseButtonTitle),"searchValue"in G&&t(1,W=G.searchValue),"pickedResultStyle"in G&&t(39,X=G.pickedResultStyle),"showPlaceType"in G&&t(10,se=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,Le=G.showResultsWhileTyping),"selectFirst"in G&&t(11,J=G.selectFirst),"flyToSelected"in G&&t(41,Ce=G.flyToSelected),"markerOnSelected"in G&&t(42,Me=G.markerOnSelected),"types"in G&&t(43,be=G.types),"exhaustiveReverseGeocoding"in G&&t(44,ae=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Re=G.excludeTypes),"zoom"in G&&t(46,ue=G.zoom),"apiUrl"in G&&t(47,pe=G.apiUrl),"fetchParameters"in G&&t(48,$e=G.fetchParameters),"iconsBaseUrl"in G&&t(12,ne=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,we=G.adjustUrlQuery),"$$scope"in G&&t(60,i=G.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,j=b==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Wt=ye),_&&!ye&&t(1,W="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&W.length<B&&(t(56,U=void 0),t(14,de=void 0),t(18,ht=void 0),t(55,me=de)),r.$$.dirty[1]&33554688&&X!=="marker-only"&&U&&!U.address&&U.geometry.type==="Point"&&U.place_type[0]!=="reverse"&&Te(U.id,{byId:!0}).catch(G=>t(18,ht=G)),r.$$.dirty[1]&100663330&&(F&&U&&U.id!==bt&&y&&(!U.bbox||U.bbox[0]===U.bbox[2]&&U.bbox[1]===U.bbox[3]?F.flyTo(U.center,wn(U)):F.fitBounds(Ao(U.bbox),50,wn(U)),t(14,de=void 0),t(55,me=void 0),t(15,Be=-1)),t(57,bt=U==null?void 0:U.id)),r.$$.dirty[0]&18432&&J&&de!=null&&de.length&&t(15,Be=0),r.$$.dirty[0]&2&&t(15,Be=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&me!==de&&t(55,me=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&F&&F.setEventHandler(G=>{switch(G.type){case"mapClick":j&&Ci(G.coordinates);break;case"markerClick":{const Xe=de==null?void 0:de.find(it=>it.id===G.id);Xe&&br(Xe)}break;case"markerMouseEnter":me&&t(15,Be=Wt?(de==null?void 0:de.findIndex(Xe=>Xe.id===G.id))??-1:-1);break;case"markerMouseLeave":me&&t(15,Be=-1);break}}),r.$$.dirty[0]&49152&&t(58,o=de==null?void 0:de[Be]),r.$$.dirty[1]&134218786&&F&&o&&y&&Ce&&F.flyTo(o.center,wn(o)),r.$$.dirty[1]&256&&t(59,n=X==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Me||F==null||F.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&F&&Me&&!me&&(F.setFeatures(o?[o]:void 0,void 0,n),F.setSelectedMarker(o?0:-1)),r.$$.dirty[1]&318767136&&F&&F.setFeatures(me,U,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&me&&F&&F.setSelectedMarker(Be),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&F){const G=Ke(W);F.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&$t("select",{feature:o}),r.$$.dirty[1]&33554432&&$t("pick",{feature:U}),r.$$.dirty[0]&81920&&$t("optionsvisibilitychange",{optionsVisible:Wt&&!!de}),r.$$.dirty[0]&16384&&$t("featureslisted",{features:de}),r.$$.dirty[1]&16777216&&$t("featuresmarked",{features:me}),r.$$.dirty[0]&1&&$t("reversetoggle",{reverse:j}),r.$$.dirty[0]&2&&$t("querychange",{query:W}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&F&&F.indicateReverse(j)},[j,W,a,c,d,b,w,z,D,te,se,J,ne,ye,de,Be,Wt,je,ht,De,Zn,Lt,Ti,hr,br,s,u,f,_,m,g,h,y,v,I,O,F,B,R,X,Le,Ce,Me,be,ae,Re,ue,pe,$e,we,lt,Ct,x,ce,q,me,U,bt,o,n,i,l,Ai,Ei,Pi,Ii,Fi,ji,Bi,Oi,Ri,Ni,zi,Di,Ui]}class _u extends le{constructor(e){super(),ie(this,e,du,cu,oe,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function jo(r){let e,t,n;return t=new _u({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=$("div"),T(t.$$.fragment),C(e,"class","svelte-ixhnie")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&4&&(i.mapController=o[2]),l&1&&(i.apiKey=o[0]),l&2&&(i.country=o[1]),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function mu(r){let e,t,n=r[2]&&jo(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,[l]){o[2]?n?(n.p(o,l),l&4&&k(n,1)):(n=jo(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function gu(r,e,t){let n,{apiKey:o}=e,{map:l}=e,{country:i}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function a(u){return u?Qi(u,Vt,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=u=>{"apiKey"in u&&t(0,o=u.apiKey),"map"in u&&t(4,l=u.map),"country"in u&&t(1,i=u.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=a(l))},[o,i,n,s,l]}class pu extends le{constructor(e){super(),ie(this,e,gu,mu,oe,{apiKey:0,map:4,country:1})}}const hu=["==",["geometry-type"],"Polygon"],bu=["==",["geometry-type"],"LineString"];function jn(r,e,t){let n=["match",r];for(let[o,l]of Object.entries(e))n.push(o),n.push(l);return n.push(t),n}function yu(r,e,t){let n=["step",r];for(let o=1;o<e.length;o++)n.push(t[o-1]),n.push(e[o]);return n.push(t[t.length-1]),n}function Yt(){return{type:"FeatureCollection",features:[]}}const wu=r=>({}),Bo=r=>({}),vu=r=>({}),Oo=r=>({}),ku=r=>({}),Ro=r=>({});function $u(r){let e,t,n,o,l,i,s,a;const u=r[1].top,f=He(u,r,r[0],Ro),c=r[1].left,_=He(c,r,r[0],Oo),d=r[1].main,m=He(d,r,r[0],Bo);return{c(){e=$("div"),t=$("div"),f&&f.c(),n=P(),o=$("div"),l=$("div"),_&&_.c(),i=P(),s=$("div"),m&&m.c(),C(t,"class","top svelte-29q570"),C(l,"class","left svelte-29q570"),C(s,"class","main svelte-29q570"),C(o,"class","content svelte-29q570"),C(e,"class","flex-container svelte-29q570")},m(g,b){L(g,e,b),p(e,t),f&&f.m(t,null),p(e,n),p(e,o),p(o,l),_&&_.m(l,null),p(o,i),p(o,s),m&&m.m(s,null),a=!0},p(g,[b]){f&&f.p&&(!a||b&1)&&Ge(f,u,g,g[0],a?We(u,g[0],b,ku):Je(g[0]),Ro),_&&_.p&&(!a||b&1)&&Ge(_,c,g,g[0],a?We(c,g[0],b,vu):Je(g[0]),Oo),m&&m.p&&(!a||b&1)&&Ge(m,d,g,g[0],a?We(d,g[0],b,wu):Je(g[0]),Bo)},i(g){a||(k(f,g),k(_,g),k(m,g),a=!0)},o(g){S(f,g),S(_,g),S(m,g),a=!1},d(g){g&&M(e),f&&f.d(g),_&&_.d(g),m&&m.d(g)}}}function Lu(r,e,t){let{$$slots:n={},$$scope:o}=e;return r.$$set=l=>{"$$scope"in l&&t(0,o=l.$$scope)},[o,n]}class Mu extends le{constructor(e){super(),ie(this,e,Lu,$u,oe,{})}}const Su=r=>({}),No=r=>({}),Cu=r=>({}),zo=r=>({}),Tu=r=>({}),Do=r=>({});function Au(r){let e,t,n,o,l,i;const s=r[4].top,a=He(s,r,r[3],Do),u=r[4].sidebar,f=He(u,r,r[3],zo),c=r[4].map,_=He(c,r,r[3],No);return{c(){e=$("div"),a&&a.c(),t=P(),n=$("div"),f&&f.c(),o=P(),l=$("div"),_&&_.c()},m(d,m){L(d,e,m),a&&a.m(e,null),r[5](e),L(d,t,m),L(d,n,m),f&&f.m(n,null),r[6](n),L(d,o,m),L(d,l,m),_&&_.m(l,null),r[7](l),i=!0},p(d,[m]){a&&a.p&&(!i||m&8)&&Ge(a,s,d,d[3],i?We(s,d[3],m,Tu):Je(d[3]),Do),f&&f.p&&(!i||m&8)&&Ge(f,u,d,d[3],i?We(u,d[3],m,Cu):Je(d[3]),zo),_&&_.p&&(!i||m&8)&&Ge(_,c,d,d[3],i?We(c,d[3],m,Su):Je(d[3]),No)},i(d){i||(k(a,d),k(f,d),k(_,d),i=!0)},o(d){S(a,d),S(f,d),S(_,d),i=!1},d(d){d&&(M(e),M(t),M(n),M(o),M(l)),a&&a.d(d),r[5](null),f&&f.d(d),r[6](null),_&&_.d(d),r[7](null)}}}function Eu(r,e,t){let n,o,l;Z(r,zr,c=>t(0,n=c)),Z(r,Dr,c=>t(1,o=c)),Z(r,Ur,c=>t(2,l=c));let{$$slots:i={},$$scope:s}=e;function a(c){Ne[c?"unshift":"push"](()=>{n=c,zr.set(n)})}function u(c){Ne[c?"unshift":"push"](()=>{o=c,Dr.set(o)})}function f(c){Ne[c?"unshift":"push"](()=>{l=c,Ur.set(l)})}return r.$$set=c=>{"$$scope"in c&&t(3,s=c.$$scope)},[n,o,l,s,i,a,u,f]}class kt extends le{constructor(e){super(),ie(this,e,Eu,Au,oe,{})}}let zr=vt(null),Dr=vt(null),Ur=vt(null);function Pu(r){let e,t,n,o,l,i,s,a,u;return{c(){e=$("label"),t=N(`Basemap:
  `),n=$("select"),o=$("option"),o.textContent="MapTiler Dataviz",l=$("option"),l.textContent="MapTiler Streets",i=$("option"),i.textContent="MapTiler Satellite",s=$("option"),s.textContent="OS Open Zoomstack",o.__value="dataviz",Ye(o,o.__value),l.__value="streets-v2",Ye(l,l.__value),i.__value="hybrid",Ye(i,i.__value),s.__value="uk-openzoomstack-light",Ye(s,s.__value),r[0]===void 0&&Zr(()=>r[1].call(n))},m(f,c){L(f,e,c),p(e,t),p(e,n),p(n,o),p(n,l),p(n,i),p(n,s),gn(n,r[0],!0),a||(u=V(n,"change",r[1]),a=!0)},p(f,[c]){c&1&&gn(n,f[0])},i:Q,o:Q,d(f){f&&M(e),a=!1,u()}}}function Iu(r,e,t){let n;Z(r,Ar,l=>t(0,n=l));function o(){n=Xr(this),Ar.set(n)}return[n,o]}class Fu extends le{constructor(e){super(),ie(this,e,Iu,Pu,oe,{})}}let tr=vt(!0);function ju(r){let e,t;return e=new jt({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.layout={visibility:n[0]?"none":"visible"}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Bu(r){let e,t;return e=new xe({props:{data:r[1],$$slots:{default:[ju]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&5&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Ou(r,e,t){let n;return Z(r,tr,l=>t(0,n=l)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class Ru extends le{constructor(e){super(),ie(this,e,Ou,Bu,oe,{})}}function Nu(r){let e,t;return e=new dr({props:{lngLat:r[0],$$slots:{default:[Du]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.lngLat=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function zu(r){let e,t,n;function o(i){r[3](i)}let l={draggable:!0,$$slots:{default:[Uu]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.lngLat=r[0]),e=new dr({props:l}),Ne.push(()=>ft(e,"lngLat",o)),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,s){const a={};s&16&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.lngLat=i[0],ct(()=>t=!1)),e.$set(a)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){E(e,i)}}}function Du(r){let e,t;const n=r[2].default,o=He(n,r,r[4],null);return{c(){e=$("span"),o&&o.c(),C(e,"class","dot svelte-1gcxp27")},m(l,i){L(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Ge(o,n,l,l[4],t?We(n,l[4],i,null):Je(l[4]),null)},i(l){t||(k(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&M(e),o&&o.d(l)}}}function Uu(r){let e,t;const n=r[2].default,o=He(n,r,r[4],null);return{c(){e=$("span"),o&&o.c(),C(e,"class","dot svelte-1gcxp27")},m(l,i){L(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i&16)&&Ge(o,n,l,l[4],t?We(n,l[4],i,null):Je(l[4]),null)},i(l){t||(k(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&M(e),o&&o.d(l)}}}function Hu(r){let e,t,n,o;const l=[zu,Nu],i=[];function s(a,u){return a[1]?0:1}return e=s(r),t=i[e]=l[e](r),{c(){t.c(),n=et()},m(a,u){i[e].m(a,u),L(a,n,u),o=!0},p(a,[u]){let f=e;e=s(a),e===f?i[e].p(a,u):(ve(),S(i[f],1,1,()=>{i[f]=null}),ke(),t=i[e],t?t.p(a,u):(t=i[e]=l[e](a),t.c()),k(t,1),t.m(n.parentNode,n))},i(a){o||(k(t),o=!0)},o(a){S(t),o=!1},d(a){a&&M(n),i[e].d(a)}}}function Gu(r,e,t){let{$$slots:n={},$$scope:o}=e,{lngLat:l}=e,{draggable:i=!1}=e;function s(a){l=a,t(0,l)}return r.$$set=a=>{"lngLat"in a&&t(0,l=a.lngLat),"draggable"in a&&t(1,i=a.draggable),"$$scope"in a&&t(4,o=a.$$scope)},[l,i,n,s,o]}class un extends le{constructor(e){super(),ie(this,e,Gu,Hu,oe,{lngLat:0,draggable:1})}}const Ju="/ltn/assets/help-d011708a.svg";function Uo(r){let e,t;return e=new fr({props:{$$slots:{default:[Wu]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Wu(r){let e,t,n;const o=r[1].default,l=He(o,r,r[4],null);return{c(){e=$("h2"),e.textContent="Help",t=P(),l&&l.c()},m(i,s){L(i,e,s),L(i,t,s),l&&l.m(i,s),n=!0},p(i,s){l&&l.p&&(!n||s&16)&&Ge(l,o,i,i[4],n?We(o,i[4],s,null):Je(i[4]),null)},i(i){n||(k(l,i),n=!0)},o(i){S(l,i),n=!1},d(i){i&&(M(e),M(t)),l&&l.d(i)}}}function qu(r){let e,t,n,o,l,i,s=r[0]&&Uo(r);return{c(){e=$("button"),e.innerHTML=`<img src="${Ju}" title="Help" alt="Help"/>`,t=P(),s&&s.c(),n=et(),C(e,"class","svelte-gb6dzm")},m(a,u){L(a,e,u),L(a,t,u),s&&s.m(a,u),L(a,n,u),o=!0,l||(i=V(e,"click",r[2]),l=!0)},p(a,[u]){a[0]?s?(s.p(a,u),u&1&&k(s,1)):(s=Uo(a),s.c(),k(s,1),s.m(n.parentNode,n)):s&&(ve(),S(s,1,1,()=>{s=null}),ke())},i(a){o||(k(s),o=!0)},o(a){S(s),o=!1},d(a){a&&(M(e),M(t),M(n)),s&&s.d(a),l=!1,i()}}}function Zu(r,e,t){let{$$slots:n={},$$scope:o}=e,l=!1;const i=()=>t(0,l=!0),s=()=>t(0,l=!1);return r.$$set=a=>{"$$scope"in a&&t(4,o=a.$$scope)},[l,n,i,s,o]}class ro extends le{constructor(e){super(),ie(this,e,Zu,qu,oe,{})}}function Xu(r){let e,t,n,o,l,i=r[0]+1+"",s,a,u=r[1].length+"",f,c,_,d,m,g,b;return{c(){e=$("div"),t=$("button"),n=N("Previous"),l=P(),s=N(i),a=N(" / "),f=N(u),c=P(),_=$("button"),d=N("Next"),t.disabled=o=r[0]==0,C(t,"data-tooltip","Left"),_.disabled=m=r[0]==r[1].length-1,C(_,"data-tooltip","Right"),_e(e,"display","flex"),_e(e,"justify-content","space-between"),_e(e,"align-items","center")},m(w,h){L(w,e,h),p(e,t),p(t,n),p(e,l),p(e,s),p(e,a),p(e,f),p(e,c),p(e,_),p(_,d),g||(b=[V(window,"keydown",r[2]),V(t,"click",r[3]),V(_,"click",r[4])],g=!0)},p(w,[h]){h&1&&o!==(o=w[0]==0)&&(t.disabled=o),h&1&&i!==(i=w[0]+1+"")&&fe(s,i),h&2&&u!==(u=w[1].length+"")&&fe(f,u),h&3&&m!==(m=w[0]==w[1].length-1)&&(_.disabled=m)},i:Q,o:Q,d(w){w&&M(e),g=!1,at(b)}}}function Yu(r,e,t){let n;Z(r,Ht,u=>t(5,n=u));let{list:o}=e,{idx:l=0}=e;ur(()=>{n==null||n.keyboard.disable()}),Ft(()=>{n==null||n.keyboard.enable()});function i(u){u.key=="ArrowLeft"&&(u.stopPropagation(),s()),u.key=="ArrowRight"&&(u.stopPropagation(),a())}function s(){l!=0&&t(0,l--,l)}function a(){l!=o.length-1&&t(0,l++,l)}return r.$$set=u=>{"list"in u&&t(1,o=u.list),"idx"in u&&t(0,l=u.idx)},[l,o,i,s,a]}class _r extends le{constructor(e){super(),ie(this,e,Yu,Xu,oe,{list:1,idx:0})}}function Ku(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:Vu}=Dl;function Qu(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g;return d=Ul(r[8][0]),{c(){e=$("button"),e.textContent="Stop StreetView",t=P(),n=$("fieldset"),o=$("legend"),o.textContent="Source:",l=P(),i=$("label"),s=$("input"),a=N(`
      Google Street View`),u=P(),f=$("label"),c=$("input"),_=N(`
      Bing Streetside`),C(e,"class","secondary"),C(s,"type","radio"),s.__value="google",Ye(s,s.__value),C(c,"type","radio"),c.__value="bing",Ye(c,c.__value),d.p(s,c)},m(b,w){L(b,e,w),L(b,t,w),L(b,n,w),p(n,o),p(n,l),p(n,i),p(i,s),s.checked=s.__value===r[0],p(i,a),p(n,u),p(n,f),p(f,c),c.checked=c.__value===r[0],p(f,_),m||(g=[V(e,"click",r[3]),V(s,"change",r[7]),V(c,"change",r[9])],m=!0)},p(b,w){w&1&&(s.checked=s.__value===b[0]),w&1&&(c.checked=c.__value===b[0])},d(b){b&&(M(e),M(t),M(n)),d.r(),m=!1,at(g)}}}function xu(r){let e,t,n;return{c(){e=$("button"),e.textContent="StreetView",C(e,"class","secondary")},m(o,l){L(o,e,l),t||(n=V(e,"click",r[2]),t=!0)},p:Q,d(o){o&&M(e),t=!1,n()}}}function ef(r){let e,t,n;function o(s,a){return s[1]?xu:Qu}let l=o(r),i=l(r);return{c(){i.c(),e=et()},m(s,a){i.m(s,a),L(s,e,a),t||(n=V(Vu,"keydown",r[4]),t=!0)},p(s,[a]){l===(l=o(s))&&i?i.p(s,a):(i.d(1),i=l(s),i&&(i.c(),i.m(e.parentNode,e)))},i:Q,o:Q,d(s){s&&M(e),i.d(s),t=!1,n()}}}function tf(r,e,t){let n;Z(r,tr,g=>t(1,n=g));let{map:o}=e,{maptilerBasemap:l}=e,i="google",s=[];function a(){K(tr,n=!1,n),o.on("click",f),o.getCanvas().style.cursor="crosshair";for(let g of Ku(o,l))s.push([g,o.getPaintProperty(g,"line-color")]),o.setPaintProperty(g,"line-color","cyan")}function u(){K(tr,n=!0,n),o.off("click",f),o.getCanvas().style.cursor="inherit";for(let[g,b]of s)o.setPaintProperty(g,"line-color",b);s=[]}Ft(u);function f(g){let b=g.lngLat.lng,w=g.lngLat.lat;i=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${w},${b}&cbp=11,0,0,0,0`,"_blank"):i=="bing"&&window.open(`https://www.bing.com/maps?cp=${w}~${b}&style=x`,"_blank")}function c(g){!n&&g.key=="Escape"&&(g.stopPropagation(),u())}const _=[[]];function d(){i=this.__value,t(0,i)}function m(){i=this.__value,t(0,i)}return r.$$set=g=>{"map"in g&&t(5,o=g.map),"maptilerBasemap"in g&&t(6,l=g.maptilerBasemap)},[i,n,a,u,c,o,l,d,_,m]}class nf extends le{constructor(e){super(),ie(this,e,tf,ef,oe,{map:5,maptilerBasemap:6})}}function Fe(r,e=!0){return{id:r,beforeId:rf(r),eventsIfTopMost:e}}function rf(r){let e=pt(Ht);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let o=Ho.length-1;o>=0;o--){let l=Ho[o];if(l==r){n=!0;break}e.getLayer(l)&&(t=l)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Lr=r=>r,Mr=r=>r;const Ho=[Lr(Mr("Background")),"neighbourhood-boundaries",Lr("Ferry line"),"debug-borders","debug-filters","cells","interior-roads-outlines","interior-roads","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact",Mr("Building"),"draw-area-lines","draw-area-preview","debug-demand-fill","debug-demand-outline","one-ways",Mr("Road labels"),Lr("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function of(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function xt(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function en(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Hr(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function cn(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function Kn(r){return r.reduce((e,t)=>e+t,0)}function lf(r){let e;return{c(){e=N("Back")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function sf(r){let e,t,n,o;return e=new he({props:{$$slots:{default:[lf]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0,n||(o=V(window,"keydown",r[1]),n=!0)},p(l,[i]){const s={};i&8&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l),n=!1,o()}}}function af(r){let e=nn();function t(o){o.key=="Escape"&&(o.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class rn extends le{constructor(e){super(),ie(this,e,af,sf,oe,{})}}function Gr(r,e,t){let n=new Set(r.toSavefile().features.filter(o=>o.properties.kind=="boundary").map(o=>o.properties.name));for(;;){let o=window.prompt(e,t);if(!o)return null;if(n.has(o))window.alert(`There is already a neighbourhood called ${o}; please pick another name`);else return o}}function uf(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function ff(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function cf(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new he({props:{$$slots:{default:[uf]},$$scope:{ctx:r}}}),l.$on("click",r[10]),a=new he({props:{$$slots:{default:[ff]},$$scope:{ctx:r}}}),a.$on("click",r[11]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),f.textContent="Use an auto-generated boundary",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(_,d){L(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),c=!0},p(_,d){const m={};d&32768&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&32768&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(k(l.$$.fragment,_),k(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&M(e),E(l),E(a)}}}function df(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b,w;return t=new rn({}),t.$on("click",r[7]),{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),o.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,l=P(),i=$("button"),i.textContent="Export to GeoJSON",s=P(),a=$("label"),u=N(`Minimum area (kmÂ²)
      `),f=$("input"),c=P(),_=$("label"),d=$("input"),m=N(`
      Remove areas not touching a big road`),C(i,"class","secondary"),C(f,"type","number"),C(f,"min","0"),C(f,"max","1"),C(f,"step","0.01"),C(d,"type","checkbox"),C(e,"slot","sidebar")},m(h,y){L(h,e,y),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),p(a,u),p(a,f),Ye(f,r[0]),p(e,c),p(e,_),p(_,d),d.checked=r[1],p(_,m),g=!0,b||(w=[V(i,"click",r[5]),V(f,"input",r[8]),V(d,"change",r[9])],b=!0)},p(h,y){y&1&&Yr(f.value)!==h[0]&&Ye(f,h[0]),y&2&&(d.checked=h[1])},i(h){g||(k(t.$$.fragment,h),g=!0)},o(h){S(t.$$.fragment,h),g=!1},d(h){h&&M(e),E(t),b=!1,at(w)}}}function _f(r){let e,t,n=r[14].area_km2.toFixed(1)+"",o,l,i,s,a,u=r[14].touches_big_road+"",f,c,_=r[14].touches_railway+"",d,m,g=r[14].touches_waterway+"",b;return{c(){e=$("p"),t=N("Area: "),o=N(n),l=N(" kmÂ²"),i=P(),s=$("p"),a=N("Borders roads = "),f=N(u),c=N(", railway = "),d=N(_),m=N(`,
            water = `),b=N(g)},m(w,h){L(w,e,h),p(e,t),p(e,o),p(e,l),L(w,i,h),L(w,s,h),p(s,a),p(s,f),p(s,c),p(s,d),p(s,m),p(s,b)},p(w,h){h&16384&&n!==(n=w[14].area_km2.toFixed(1)+"")&&fe(o,n),h&16384&&u!==(u=w[14].touches_big_road+"")&&fe(f,u),h&16384&&_!==(_=w[14].touches_railway+"")&&fe(d,_),h&16384&&g!==(g=w[14].touches_waterway+"")&&fe(b,g)},d(w){w&&(M(e),M(i),M(s))}}}function mf(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[_f,({props:n})=>({14:n}),({props:n})=>n?16384:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&49152&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function gf(r){let e,t,n,o;const l=[Fe("auto-boundaries-areas"),{filter:r[6](r[0],r[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":wt(.3,.7)}},{hoverCursor:"pointer"}];let i={$$slots:{default:[mf]},$$scope:{ctx:r}};for(let u=0;u<l.length;u+=1)i=Ie(i,l[u]);e=new jt({props:i}),e.$on("click",r[4]);const s=[Fe("auto-boundaries-severances"),{filter:bu},{manageHoverState:!0},{paint:{"line-color":wt("black","red"),"line-width":3}}];let a={};for(let u=0;u<s.length;u+=1)a=Ie(a,s[u]);return n=new dt({props:a}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),o=!0},p(u,f){const c=f&67?Gt(l,[l[0],{filter:u[6](u[0],u[1])},l[2],l[3],l[4]]):{};f&32768&&(c.$$scope={dirty:f,ctx:u}),e.$set(c);const _={};n.$set(_)},i(u){o||(k(e.$$.fragment,u),k(n.$$.fragment,u),o=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),o=!1},d(u){u&&M(t),E(e,u),E(n,u)}}}function pf(r){let e,t,n;return t=new xe({props:{data:r[3],generateId:!0,$$slots:{default:[gf]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","map")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&32771&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function hf(r){let e,t;return e=new kt({props:{$$slots:{map:[pf],sidebar:[df],top:[cf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&32775&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function bf(r,e,t){let n,o,l;Z(r,ee,w=>t(2,n=w)),Z(r,Bn,w=>t(12,o=w)),Z(r,Ze,w=>t(13,l=w));let i=l.renderAutoBoundaries(),s=0,a=!0;function u(w){let h=Gr(l,"What do you want to name the neighbourhood?","");if(h)try{let y={type:"Feature",properties:{},geometry:i.features[w.detail.features[0].id].geometry};l.setNeighbourhoodBoundary(h,y),pn(),l.setCurrentNeighbourhood(h,o),K(ee,n={mode:"neighbourhood"},n)}catch(y){console.log(y),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function f(){lr("auto_boundaries.geojson",JSON.stringify(i,null,"  "))}function c(w,h){let y=["all",hu,[">=",["get","area_km2"],w]];return h&&y.push(["get","touches_big_road"]),y}const _=()=>K(ee,n={mode:"pick-neighbourhood"},n);function d(){s=Yr(this.value),t(0,s)}function m(){a=this.checked,t(1,a)}return[s,a,n,i,u,f,c,_,d,m,()=>K(ee,n={mode:"title",firstLoad:!1},n),()=>K(ee,n={mode:"pick-neighbourhood"},n)]}class yf extends le{constructor(e){super(),ie(this,e,bf,hf,oe,{})}}function wf(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function vf(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function kf(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new he({props:{$$slots:{default:[wf]},$$scope:{ctx:r}}}),l.$on("click",r[7]),a=new he({props:{$$slots:{default:[vf]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),f.textContent="Debug demand model",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(_,d){L(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(k(l.$$.fragment,_),k(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&M(e),E(l),E(a)}}}function $f(r){let e;return{c(){e=$("p"),e.textContent="Hover on a zone"},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function Lf(r){let e,t=r[3].properties.name+"",n,o,l,i,s=Kn(r[3].properties.counts_from).toLocaleString()+"",a,u,f,c,_=Kn(r[3].properties.counts_to).toLocaleString()+"",d,m,g,b,w=r[3].properties.counts_from[r[2]]+"",h;return{c(){e=$("u"),n=N(t),o=P(),l=$("p"),i=N("Total trips from here: "),a=N(s),u=P(),f=$("p"),c=N("Total trips to here: "),d=N(_),m=P(),g=$("p"),b=N("Total intra-zonal trips starting and ending here: "),h=N(w)},m(y,v){L(y,e,v),p(e,n),L(y,o,v),L(y,l,v),p(l,i),p(l,a),L(y,u,v),L(y,f,v),p(f,c),p(f,d),L(y,m,v),L(y,g,v),p(g,b),p(g,h)},p(y,v){v&8&&t!==(t=y[3].properties.name+"")&&fe(n,t),v&8&&s!==(s=Kn(y[3].properties.counts_from).toLocaleString()+"")&&fe(a,s),v&8&&_!==(_=Kn(y[3].properties.counts_to).toLocaleString()+"")&&fe(d,_),v&12&&w!==(w=y[3].properties.counts_from[y[2]]+"")&&fe(h,w)},d(y){y&&(M(e),M(o),M(l),M(u),M(f),M(m),M(g))}}}function Mf(r){let e,t,n,o,l=r[0].features.length.toLocaleString()+"",i,s,a,u;t=new rn({}),t.$on("click",r[6]);function f(d,m){return d[3]&&d[2]!=null?Lf:$f}let c=f(r),_=c(r);return{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),i=N(l),s=N(" zones"),a=P(),_.c(),C(e,"slot","sidebar")},m(d,m){L(d,e,m),A(t,e,null),p(e,n),p(e,o),p(o,i),p(o,s),p(e,a),_.m(e,null),u=!0},p(d,m){(!u||m&1)&&l!==(l=d[0].features.length.toLocaleString()+"")&&fe(i,l),c===(c=f(d))&&_?_.p(d,m):(_.d(1),_=c(d),_&&(_.c(),_.m(e,null)))},i(d){u||(k(t.$$.fragment,d),u=!0)},o(d){S(t.$$.fragment,d),u=!1},d(d){d&&M(e),E(t),_.d()}}}function Sf(r){let e,t,n,o,l;const i=[Fe("debug-demand-fill"),{paint:{"fill-color":"grey","fill-opacity":wt(.5,.1)}},{manageHoverState:!0}];function s(c){r[5](c)}let a={};for(let c=0;c<i.length;c+=1)a=Ie(a,i[c]);r[1]!==void 0&&(a.hovered=r[1]),e=new jt({props:a}),Ne.push(()=>ft(e,"hovered",s));const u=[Fe("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let f={};for(let c=0;c<u.length;c+=1)f=Ie(f,u[c]);return o=new dt({props:f}),{c(){T(e.$$.fragment),n=P(),T(o.$$.fragment)},m(c,_){A(e,c,_),L(c,n,_),A(o,c,_),l=!0},p(c,_){const d={};!t&&_&2&&(t=!0,d.hovered=c[1],ct(()=>t=!1)),e.$set(d);const m={};o.$set(m)},i(c){l||(k(e.$$.fragment,c),k(o.$$.fragment,c),l=!0)},o(c){S(e.$$.fragment,c),S(o.$$.fragment,c),l=!1},d(c){c&&M(n),E(e,c),E(o,c)}}}function Cf(r){let e,t,n;return t=new xe({props:{data:r[0],generateId:!0,$$slots:{default:[Sf]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","map")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&1&&(i.data=o[0]),l&1026&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function Tf(r){let e,t;return e=new kt({props:{$$slots:{map:[Cf],sidebar:[Mf],top:[kf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1055&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Af(r,e,t){let n,o,l,i;Z(r,ee,d=>t(4,l=d)),Z(r,Ze,d=>t(9,i=d));let s=Yt();try{s=i.getDemandModel(),console.log(s)}catch{window.alert("No demand model for this area"),K(ee,l={mode:"pick-neighbourhood"},l)}let a=null;function u(d){a=d,t(1,a)}const f=()=>K(ee,l={mode:"pick-neighbourhood"},l),c=()=>K(ee,l={mode:"title",firstLoad:!1},l),_=()=>K(ee,l={mode:"pick-neighbourhood"},l);return r.$$.update=()=>{r.$$.dirty&2&&t(2,n=a==null?null:a.id),r.$$.dirty&5&&t(3,o=n!=null?s.features[n]:null)},[s,a,n,o,l,u,f,c,_]}class Ef extends le{constructor(e){super(),ie(this,e,Af,Tf,oe,{})}}function Pf(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function If(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Ff(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new he({props:{$$slots:{default:[Pf]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new he({props:{$$slots:{default:[If]},$$scope:{ctx:r}}}),a.$on("click",r[9]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),f.textContent="Debug intersections",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(_,d){L(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(k(l.$$.fragment,_),k(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&M(e),E(l),E(a)}}}function Go(r){let e,t,n,o,l,i,s;function a(f){r[7](f)}let u={list:r[0].features};return r[1]!==void 0&&(u.idx=r[1]),n=new _r({props:u}),Ne.push(()=>ft(n,"idx",a)),{c(){e=$("button"),e.textContent="Pick another intersection",t=P(),T(n.$$.fragment),C(e,"class","secondary")},m(f,c){L(f,e,c),L(f,t,c),A(n,f,c),l=!0,i||(s=V(e,"click",r[6]),i=!0)},p(f,c){const _={};c&1&&(_.list=f[0].features),!o&&c&2&&(o=!0,_.idx=f[1],ct(()=>o=!1)),n.$set(_)},i(f){l||(k(n.$$.fragment,f),l=!0)},o(f){S(n.$$.fragment,f),l=!1},d(f){f&&(M(e),M(t)),E(n,f),i=!1,s()}}}function jf(r){let e,t,n,o,l,i;t=new rn({}),t.$on("click",r[5]);let s=r[0].features.length>0&&Go(r);return{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),o.textContent="Purple intersections have some kind of turn restriction.",l=P(),s&&s.c(),C(e,"slot","sidebar")},m(a,u){L(a,e,u),A(t,e,null),p(e,n),p(e,o),p(e,l),s&&s.m(e,null),i=!0},p(a,u){a[0].features.length>0?s?(s.p(a,u),u&1&&k(s,1)):(s=Go(a),s.c(),k(s,1),s.m(e,null)):s&&(ve(),S(s,1,1,()=>{s=null}),ke())},i(a){i||(k(t.$$.fragment,a),k(s),i=!0)},o(a){S(t.$$.fragment,a),S(s),i=!1},d(a){a&&M(e),E(t),s&&s.d()}}}function Bf(r){let e,t;const n=[Fe("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new Gn({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Of(r){let e,t,n,o;const l=[Fe("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let u=0;u<l.length;u+=1)i=Ie(i,l[u]);e=new dt({props:i});const s=[Fe("debug-movements-fill"),{filter:["==",["id"],r[1]]},{paint:{"fill-color":"cyan"}}];let a={};for(let u=0;u<s.length;u+=1)a=Ie(a,s[u]);return n=new jt({props:a}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _=f&2?Gt(s,[s[0],{filter:["==",["id"],u[1]]},s[2]]):{};n.$set(_)},i(u){o||(k(e.$$.fragment,u),k(n.$$.fragment,u),o=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),o=!1},d(u){u&&M(t),E(e,u),E(n,u)}}}function Rf(r){let e,t,n,o,l;return t=new xe({props:{data:st(r[2]).getAllIntersections(),generateId:!0,$$slots:{default:[Bf]},$$scope:{ctx:r}}}),o=new xe({props:{data:r[0],generateId:!0,$$slots:{default:[Of]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),C(e,"slot","map")},m(i,s){L(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&4&&(a.data=st(i[2]).getAllIntersections()),s&1024&&(a.$$scope={dirty:s,ctx:i}),t.$set(a);const u={};s&1&&(u.data=i[0]),s&1026&&(u.$$scope={dirty:s,ctx:i}),o.$set(u)},i(i){l||(k(t.$$.fragment,i),k(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&M(e),E(t),E(o)}}}function Nf(r){let e,t;return e=new kt({props:{$$slots:{map:[Rf],sidebar:[jf],top:[Ff]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1039&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function zf(r,e,t){let n,o;Z(r,Ze,d=>t(2,n=d)),Z(r,ee,d=>t(3,o=d));let l=Yt(),i=0;function s(d){t(0,l=n.getMovements(d.detail.features[0].id)),t(1,i=0)}const a=()=>K(ee,o={mode:"pick-neighbourhood"},o),u=()=>t(0,l=Yt());function f(d){i=d,t(1,i)}return[l,i,n,o,s,a,u,f,()=>K(ee,o={mode:"title",firstLoad:!1},o),()=>K(ee,o={mode:"pick-neighbourhood"},o)]}class Df extends le{constructor(e){super(),ie(this,e,zf,Nf,oe,{})}}let ci=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],di=[20,30,40,50,60,70];const sn={mapFeature:{hover:{backgroundColor:"blue"}}};function Uf(r){let e,t,n,o,l,i;const s=[Fe("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let a={};for(let d=0;d<s.length;d+=1)a=Ie(a,s[d]);e=new jt({props:a});const u=[Fe("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let f={};for(let d=0;d<u.length;d+=1)f=Ie(f,u[d]);n=new jt({props:f});const c=[Fe("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let _={};for(let d=0;d<c.length;d+=1)_=Ie(_,c[d]);return l=new dt({props:_}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment)},m(d,m){A(e,d,m),L(d,t,m),A(n,d,m),L(d,o,m),A(l,d,m),i=!0},p(d,[m]){const g=m&1?Gt(s,[s[0],s[1],{layout:{visibility:d[0]=="cells"?"none":"visible"}},s[3]]):{};e.$set(g);const b={};n.$set(b);const w={};l.$set(w)},i(d){i||(k(e.$$.fragment,d),k(n.$$.fragment,d),k(l.$$.fragment,d),i=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(l.$$.fragment,d),i=!1},d(d){d&&(M(t),M(o)),E(e,d),E(n,d),E(l,d)}}}function Hf(r,e,t){let n;return Z(r,or,o=>t(0,n=o)),[n]}class mr extends le{constructor(e){super(),ie(this,e,Hf,Uf,oe,{})}}function Gf(r){let e,t;const n=[Fe("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new jt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}class gr extends le{constructor(e){super(),ie(this,e,null,Gf,oe,{})}}const Jf=r=>({}),Jo=r=>({});function Wo(r){let e;const t=r[7]["line-popup"],n=He(t,r,r[9],Jo);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&512)&&Ge(n,t,o,o[9],e?We(t,o[9],l,Jf):Je(o[9]),Jo)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Wf(r){let e,t,n=r[0]&&Wo(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l&1&&k(n,1)):(n=Wo(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function qf(r){let e,t,n,o;const l=[Fe("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":"black"}}];let i={};for(let u=0;u<l.length;u+=1)i=Ie(i,l[u]);e=new dt({props:i});const s=[Fe("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":wt(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let a={$$slots:{default:[Wf]},$$scope:{ctx:r}};for(let u=0;u<s.length;u+=1)a=Ie(a,s[u]);return n=new dt({props:a}),n.$on("click",r[8]),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),o=!0},p(u,[f]){const c=f&84?Gt(l,[l[0],l[1],{paint:{"line-width":u[6](u[2],u[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(c);const _=f&125?Gt(s,[s[0],s[1],f&124&&{paint:{"line-width":u[6](u[2],u[4].maxShortcuts,0),"line-color":u[5](u[3],u[4].maxShortcuts),"line-opacity":wt(1,.5)}},f&1&&{manageHoverState:u[0]},f&1&&{hoverCursor:u[0]?"pointer":void 0}]):{};f&513&&(_.$$scope={dirty:f,ctx:u}),n.$set(_)},i(u){o||(k(e.$$.fragment,u),k(n.$$.fragment,u),o=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),o=!1},d(u){u&&M(t),E(e,u),E(n,u)}}}function Zf(r,e,t){let n,o;Z(r,Er,d=>t(2,n=d)),Z(r,or,d=>t(3,o=d));let{$$slots:l={},$$scope:i}=e,s=Kr("neighbourhoodGj"),{interactive:a=!0}=e,{onClickLine:u=(d,m)=>{}}=e;function f(d,m){return d=="cells"?["get","color"]:d=="edits"?["case",["get","edited"],"grey","white"]:d=="speeds"?yu(["get","speed_mph"],di,ci):m<=2?wt("white","blue"):wt(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",m,"#A32015"],sn.mapFeature.hover.backgroundColor)}function c(d,m,g){return!d||m<=2?of(g):["interpolate",["linear"],["get","shortcuts"],0,5+g,m,25+g]}const _=d=>a&&u(d.detail.features[0],d.detail.event.lngLat);return r.$$set=d=>{"interactive"in d&&t(0,a=d.interactive),"onClickLine"in d&&t(1,u=d.onClickLine),"$$scope"in d&&t(9,i=d.$$scope)},[a,u,n,o,s,f,c,l,_,i]}class Jn extends le{constructor(e){super(),ie(this,e,Zf,qf,oe,{interactive:0,onClickLine:1})}}function Xf(r){let e;const t=r[3].default,n=He(t,r,r[5],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&32)&&Ge(n,t,o,o[5],e?We(t,o[5],l,null):Je(o[5]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Yf(r){let e,t,n,o;const l=[Fe("modal-filters"),{filter:["!=",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let i={$$slots:{default:[Xf]},$$scope:{ctx:r}};for(let u=0;u<l.length;u+=1)i=Ie(i,l[u]);e=new Nr({props:i}),e.$on("click",r[4]);const s=[Fe("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let a={};for(let u=0;u<s.length;u+=1)a=Ie(a,s[u]);return n=new Nr({props:a}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),o=!0},p(u,f){const c={};f&32&&(c.$$scope={dirty:f,ctx:u}),e.$set(c);const _={};n.$set(_)},i(u){o||(k(e.$$.fragment,u),k(n.$$.fragment,u),o=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),o=!1},d(u){u&&M(t),E(e,u),E(n,u)}}}function Kf(r){let e,t;return e=new xe({props:{data:r[0],generateId:!0,$$slots:{default:[Yf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&32&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Vf(r,e,t){let n,o,l;Z(r,Ze,u=>t(1,o=u)),Z(r,Tt,u=>t(2,l=u));let{$$slots:i={},$$scope:s}=e;function a(u){Pe.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(5,s=u.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=l>0?o.renderModalFilters():Yt())},[n,o,l,i,a,s]}class on extends le{constructor(e){super(),ie(this,e,Vf,Kf,oe,{})}}function Qf(r){let e,t;const n=[Fe("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}},{interactive:!1},{hoverCursor:"pointer"}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new Nr({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}class pr extends le{constructor(e){super(),ie(this,e,null,Qf,oe,{})}}function xf(r){let e;const t=r[3].default,n=He(t,r,r[4],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16)&&Ge(n,t,o,o[4],e?We(t,o[4],l,null):Je(o[4]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function ec(r){let e,t;return e=new xe({props:{data:r[0],generateId:!0,$$slots:{default:[xf]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function tc(r,e,t){let n,o;Z(r,Ze,a=>t(2,o=a));let{$$slots:l={},$$scope:i}=e,{input:s=null}=e;return r.$$set=a=>{"input"in a&&t(1,s=a.input),"$$scope"in a&&t(4,i=a.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||o.renderNeighbourhood()),r.$$.dirty&1&&Hl("neighbourhoodGj",n)},[n,s,o,l,i]}class Wn extends le{constructor(e){super(),ie(this,e,tc,ec,oe,{input:1})}}function nc(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function rc(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function oc(r){let e;return{c(){e=N("Editing")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function lc(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;return l=new he({props:{$$slots:{default:[nc]},$$scope:{ctx:r}}}),l.$on("click",r[8]),a=new he({props:{$$slots:{default:[rc]},$$scope:{ctx:r}}}),a.$on("click",r[9]),c=new he({props:{$$slots:{default:[oc]},$$scope:{ctx:r}}}),c.$on("click",r[10]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),T(c.$$.fragment),_=P(),d=$("li"),d.textContent="Debug mode",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(g,b){L(g,e,b),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),A(c,f,null),p(n,_),p(n,d),m=!0},p(g,b){const w={};b&4096&&(w.$$scope={dirty:b,ctx:g}),l.$set(w);const h={};b&4096&&(h.$$scope={dirty:b,ctx:g}),a.$set(h);const y={};b&4096&&(y.$$scope={dirty:b,ctx:g}),c.$set(y)},i(g){m||(k(l.$$.fragment,g),k(a.$$.fragment,g),k(c.$$.fragment,g),m=!0)},o(g){S(l.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&M(e),E(l),E(a),E(c)}}}function qo(r){let e,t,n;return{c(){e=$("button"),e.textContent="â",C(e,"class","close-btn svelte-khnvno")},m(o,l){L(o,e,l),t||(n=V(e,"click",r[6]),t=!0)},p:Q,d(o){o&&M(e),t=!1,n()}}}function ic(r){let e;return{c(){e=$("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){L(t,e,n)},p:Q,i:Q,o:Q,d(t){t&&M(e)}}}function sc(r){let e,t,n,o,l,i,s;e=new Un({props:{properties:r[0].feature.properties}});function a(f){r[7](f)}let u={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(u.idx=r[0].movementIdx),l=new _r({props:u}),Ne.push(()=>ft(l,"idx",a)),{c(){T(e.$$.fragment),t=P(),n=$("h5"),n.textContent="Turn restrictions:",o=P(),T(l.$$.fragment)},m(f,c){A(e,f,c),L(f,t,c),L(f,n,c),L(f,o,c),A(l,f,c),s=!0},p(f,c){const _={};c&1&&(_.properties=f[0].feature.properties),e.$set(_);const d={};c&1&&(d.list=f[0].movements.features),!i&&c&1&&(i=!0,d.idx=f[0].movementIdx,ct(()=>i=!1)),l.$set(d)},i(f){s||(k(e.$$.fragment,f),k(l.$$.fragment,f),s=!0)},o(f){S(e.$$.fragment,f),S(l.$$.fragment,f),s=!1},d(f){f&&(M(t),M(n),M(o)),E(e,f),E(l,f)}}}function ac(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;t=new rn({}),t.$on("click",r[5]);let g=r[0]&&qo(r);const b=[sc,ic],w=[];function h(y,v){return y[0]?0:1}return _=h(r),d=w[_]=b[_](r),{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("h4"),o.textContent="Roads",l=P(),i=$("p"),i.textContent="Click a road to visit its OSM object.",s=P(),a=$("div"),u=$("h4"),u.textContent="Intersections",f=P(),g&&g.c(),c=P(),d.c(),_e(a,"display","flex"),_e(a,"align-items","start"),_e(a,"justify-content","space-between"),C(e,"slot","sidebar")},m(y,v){L(y,e,v),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),p(a,u),p(a,f),g&&g.m(a,null),p(e,c),w[_].m(e,null),m=!0},p(y,v){y[0]?g?g.p(y,v):(g=qo(y),g.c(),g.m(a,null)):g&&(g.d(1),g=null);let I=_;_=h(y),_===I?w[_].p(y,v):(ve(),S(w[I],1,1,()=>{w[I]=null}),ke(),d=w[_],d?d.p(y,v):(d=w[_]=b[_](y),d.c()),k(d,1),d.m(e,null))},i(y){m||(k(t.$$.fragment,y),k(d),m=!0)},o(y){S(t.$$.fragment,y),S(d),m=!1},d(y){y&&M(e),E(t),g&&g.d(),w[_].d()}}}function uc(r){let e,t;return e=new Un({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function fc(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[uc,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function cc(r){let e,t;return e=new Un({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function dc(r){let e,t,n;return t=new zt({props:{openOn:"hover",$$slots:{default:[cc,({props:o})=>({11:o}),({props:o})=>o?2048:0]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","line-popup")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&6144&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function _c(r){let e,t,n,o,l,i,s,a,u,f;e=new gr({}),n=new mr({}),l=new pr({});const c=[Fe("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let _={$$slots:{default:[fc]},$$scope:{ctx:r}};for(let d=0;d<c.length;d+=1)_=Ie(_,c[d]);return s=new Gn({props:_}),u=new Jn({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[dc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),T(s.$$.fragment),a=P(),T(u.$$.fragment)},m(d,m){A(e,d,m),L(d,t,m),A(n,d,m),L(d,o,m),A(l,d,m),L(d,i,m),A(s,d,m),L(d,a,m),A(u,d,m),f=!0},p(d,m){const g={};m&4096&&(g.$$scope={dirty:m,ctx:d}),s.$set(g);const b={};m&4096&&(b.$$scope={dirty:m,ctx:d}),u.$set(b)},i(d){f||(k(e.$$.fragment,d),k(n.$$.fragment,d),k(l.$$.fragment,d),k(s.$$.fragment,d),k(u.$$.fragment,d),f=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(l.$$.fragment,d),S(s.$$.fragment,d),S(u.$$.fragment,d),f=!1},d(d){d&&(M(t),M(o),M(i),M(a)),E(e,d),E(n,d),E(l,d),E(s,d),E(u,d)}}}function mc(r){let e,t;return e=new Un({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function gc(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[mc,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function pc(r){let e,t;return e=new Un({props:{properties:r[11]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&2048&&(l.properties=n[11]),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function hc(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[pc,({props:n})=>({11:n}),({props:n})=>n?2048:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&6144&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function bc(r){var l,i,s;let e,t;const n=[Fe("debug-intersections"),{paint:{"circle-radius":Hr(30),"circle-color":sn.mapFeature.hover.backgroundColor,"circle-stroke-color":sn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":wt(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(i=(l=r[0])==null?void 0:l.feature)==null?void 0:i.properties)==null?void 0:s.intersection_id)??-1],.3,wt(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[hc]},$$scope:{ctx:r}};for(let a=0;a<n.length;a+=1)o=Ie(o,n[a]);return e=new Gn({props:o}),e.$on("click",r[3]),{c(){T(e.$$.fragment)},m(a,u){A(e,a,u),t=!0},p(a,u){var c,_,d;const f=u&1?Gt(n,[n[0],{paint:{"circle-radius":Hr(30),"circle-color":sn.mapFeature.hover.backgroundColor,"circle-stroke-color":sn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":wt(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((d=(_=(c=a[0])==null?void 0:c.feature)==null?void 0:_.properties)==null?void 0:d.intersection_id)??-1],.3,wt(0,.5)]}},n[2],n[3]]):{};u&4096&&(f.$$scope={dirty:u,ctx:a}),e.$set(f)},i(a){t||(k(e.$$.fragment,a),t=!0)},o(a){S(e.$$.fragment,a),t=!1},d(a){E(e,a)}}}function Zo(r){let e,t;return e=new xe({props:{data:r[0].movements,generateId:!0,$$slots:{default:[yc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0].movements),o&4097&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function yc(r){let e,t,n,o;const l=[Fe("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let i={};for(let u=0;u<l.length;u+=1)i=Ie(i,l[u]);e=new dt({props:i});const s=[Fe("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let a={};for(let u=0;u<s.length;u+=1)a=Ie(a,s[u]);return n=new jt({props:a}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _=f&1?Gt(s,[s[0],{filter:["==",["id"],u[0].movementIdx]},s[2]]):{};n.$set(_)},i(u){o||(k(e.$$.fragment,u),k(n.$$.fragment,u),o=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),o=!1},d(u){u&&M(t),E(e,u),E(n,u)}}}function wc(r){let e,t,n,o,l,i,s,a;t=new Wn({props:{$$slots:{default:[_c]},$$scope:{ctx:r}}}),o=new on({props:{$$slots:{default:[gc]},$$scope:{ctx:r}}}),i=new xe({props:{data:st(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[bc]},$$scope:{ctx:r}}});let u=r[0]&&Zo(r);return{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),l=P(),T(i.$$.fragment),s=P(),u&&u.c(),C(e,"slot","map")},m(f,c){L(f,e,c),A(t,e,null),p(e,n),A(o,e,null),p(e,l),A(i,e,null),p(e,s),u&&u.m(e,null),a=!0},p(f,c){const _={};c&4096&&(_.$$scope={dirty:c,ctx:f}),t.$set(_);const d={};c&4096&&(d.$$scope={dirty:c,ctx:f}),o.$set(d);const m={};c&2&&(m.data=st(f[1]).getAllIntersections()),c&4097&&(m.$$scope={dirty:c,ctx:f}),i.$set(m),f[0]?u?(u.p(f,c),c&1&&k(u,1)):(u=Zo(f),u.c(),k(u,1),u.m(e,null)):u&&(ve(),S(u,1,1,()=>{u=null}),ke())},i(f){a||(k(t.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),k(u),a=!0)},o(f){S(t.$$.fragment,f),S(o.$$.fragment,f),S(i.$$.fragment,f),S(u),a=!1},d(f){f&&M(e),E(t),E(o),E(i),u&&u.d()}}}function vc(r){let e,t;return e=new kt({props:{$$slots:{map:[wc],sidebar:[ac],top:[lc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function kc(r,e,t){let n,o;Z(r,Ze,m=>t(1,n=m)),Z(r,ee,m=>t(2,o=m));let l=null;function i(m){let g=m.detail.features[0],b=n.getMovements(g.properties.intersection_id);t(0,l={feature:g,movements:b,movementIdx:0})}const s=(m,g)=>window.open(st(m.properties).way,"_blank"),a=()=>K(ee,o={mode:"neighbourhood"},o),u=()=>t(0,l=null);function f(m){r.$$.not_equal(l.movementIdx,m)&&(l.movementIdx=m,t(0,l))}return[l,n,o,i,s,a,u,f,()=>K(ee,o={mode:"title",firstLoad:!1},o),()=>K(ee,o={mode:"pick-neighbourhood"},o),()=>K(ee,o={mode:"neighbourhood"},o)]}class $c extends le{constructor(e){super(),ie(this,e,kc,vc,oe,{})}}var St=63710088e-1,_i={centimeters:St*100,centimetres:St*100,degrees:360/(2*Math.PI),feet:St*3.28084,inches:St*39.37,kilometers:St/1e3,kilometres:St/1e3,meters:St,metres:St,miles:St/1609.344,millimeters:St*1e3,millimetres:St*1e3,nauticalmiles:St/1852,radians:1,yards:St*1.0936};function Lc(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Jr(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xo(r[0])||!Xo(r[1]))throw new Error("coordinates must contain numbers");return Lc({type:"Point",coordinates:r},e,t)}function Mc(r,e="kilometers"){const t=_i[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Sc(r,e="kilometers"){const t=_i[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Wr(r){return r%(2*Math.PI)*180/Math.PI}function Rt(r){return r%360*Math.PI/180}function Xo(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Dn(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Cc(r){return r.type==="Feature"?r.geometry:r}function mi(r,e,t={}){if(t.final===!0)return Tc(r,e);const n=Dn(r),o=Dn(e),l=Rt(n[0]),i=Rt(o[0]),s=Rt(n[1]),a=Rt(o[1]),u=Math.sin(i-l)*Math.cos(a),f=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return Wr(Math.atan2(u,f))}function Tc(r,e){let t=mi(e,r);return t=(t+180)%360,t}function Ac(r,e,t,n={}){const o=Dn(r),l=Rt(o[0]),i=Rt(o[1]),s=Rt(t),a=Sc(e,n.units),u=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),f=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(u)),c=Wr(f),_=Wr(u);return Jr([c,_],n.properties)}function Ec(r,e,t={}){var n=Dn(r),o=Dn(e),l=Rt(o[1]-n[1]),i=Rt(o[0]-n[0]),s=Rt(n[1]),a=Rt(o[1]),u=Math.pow(Math.sin(l/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(a);return Mc(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),t.units)}function Pc(r,e,t={}){const o=Cc(r).coordinates;let l=0;for(let i=0;i<o.length&&!(e>=l&&i===o.length-1);i++)if(l>=e){const s=e-l;if(s){const a=mi(o[i],o[i-1])-180;return Ac(o[i],s,a,t)}else return Jr(o[i])}else l+=Ec(o[i],o[i+1],t);return Jr(o[o.length-1])}var Ic=Pc;function Fc(r){let e,t;const n=[Fe("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new Gn({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function jc(r){let e,t;return e=new xe({props:{data:r[0],$$slots:{default:[Fc]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}let Bc=50,Oc=100,Rc=.01;function Nc(r,e,t){let{paths:n}=e,o=a(),l=u(),i=c(),s=setInterval(_,Oc);Ft(()=>clearInterval(s));function a(){return n.features.map(d=>1/d.properties.directness).reduce((d,m)=>d+m,0)}function u(){return n.features.length==0?[]:Array.from({length:Bc},f)}function f(){let d=Math.random()*o,m=0;for(let[g,b]of n.features.entries())if(m+=1/b.properties.directness,d<m)return{idx:g,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${o}`)}function c(){return{type:"FeatureCollection",features:l.map(({idx:d,distance:m})=>Ic(n.features[d],m,{units:"kilometers"}))}}function _(){for(let[d,m]of l.entries())m.distance+=Rc,m.distance>=n.features[m.idx].properties.length_meters/1e3&&(l[d]=f());t(0,i=c())}return r.$$set=d=>{"paths"in d&&t(1,n=d.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(o=a(),l=u())},[i,n]}class zc extends le{constructor(e){super(),ie(this,e,Nc,jc,oe,{paths:1})}}class Dc{constructor(e){rt(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function Uc(r){let e,t,n,o,l;return{c(){e=$("div"),e.textContent="+",t=P(),n=$("img"),l=N(`
    Add diagonal filter`),_e(e,"font-size","200%"),_e(e,"margin-top","-12px"),C(e,"class","icon"),ze(n.src,o="/ltn//filters/diagonal_filter_icon.png")||C(n,"src",o),C(n,"alt","Add diagonal filter"),_e(n,"transform","rotate(135deg)"),C(n,"class","svelte-j2s60j")},m(i,s){L(i,e,s),L(i,t,s),L(i,n,s),L(i,l,s)},p:Q,d(i){i&&(M(e),M(t),M(n),M(l))}}}function Hc(r){let e;function t(l,i){return l[0].hasRotatedFilter?Jc:Gc}let n=t(r),o=n(r);return{c(){o.c(),e=et()},m(l,i){o.m(l,i),L(l,e,i)},p(l,i){n!==(n=t(l))&&(o.d(1),o=n(l),o&&(o.c(),o.m(e.parentNode,e)))},d(l){l&&M(e),o.d(l)}}}function Gc(r){let e,t,n,o,l;return{c(){e=$("div"),e.textContent="â»",t=P(),n=$("img"),l=N(`
      Rotate diagonal filter`),_e(e,"font-size","200%"),_e(e,"padding-bottom","4px"),C(e,"class","icon"),ze(n.src,o="/ltn//filters/diagonal_filter_icon.png")||C(n,"src",o),C(n,"alt","Rotate diagonal filter"),_e(n,"transform","rotate(45deg)"),C(n,"class","svelte-j2s60j")},m(i,s){L(i,e,s),L(i,t,s),L(i,n,s),L(i,l,s)},d(i){i&&(M(e),M(t),M(n),M(l))}}}function Jc(r){let e,t,n,o,l;return{c(){e=$("div"),e.textContent="â",t=P(),n=$("img"),l=N(`
      Delete diagonal filter`),C(e,"class","icon"),ze(n.src,o="/ltn//filters/diagonal_filter_icon.png")||C(n,"src",o),C(n,"alt","Remove diagonal filter"),_e(n,"transform","rotate(45deg)"),C(n,"class","svelte-j2s60j")},m(i,s){L(i,e,s),L(i,t,s),L(i,n,s),L(i,l,s)},d(i){i&&(M(e),M(t),M(n),M(l))}}}function Wc(r){let e;function t(l,i){return l[0].filter?Hc:Uc}let n=t(r),o=n(r);return{c(){e=$("div"),o.c(),_e(e,"display","flex"),_e(e,"align-items","center")},m(l,i){L(l,e,i),o.m(e,null)},p(l,[i]){n===(n=t(l))&&o?o.p(l,i):(o.d(1),o=n(l),o&&(o.c(),o.m(e,null)))},i:Q,o:Q,d(l){l&&M(e),o.d()}}}function qc(r,e,t){let{intersection:n}=e;return r.$$set=o=>{"intersection"in o&&t(0,n=o.intersection)},[n]}class Zc extends le{constructor(e){super(),ie(this,e,qc,Wc,oe,{intersection:0})}}function Xc(r){let e,t;return e=new Zc({props:{intersection:r[2](r[6])}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&64&&(l.intersection=n[2](n[6])),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Yc(r){let e,t;return e=new Oa({props:{openOn:"hover",$$slots:{default:[Xc,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&192&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Kc(r){let e,t;const n=[Fe("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":Hr(30),"circle-color":sn.mapFeature.hover.backgroundColor,"circle-opacity":wt(0,.5),"circle-stroke-color":sn.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":wt(0,3)}},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[Yc]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new Gn({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,[i]){const s=i&2?Gt(n,[n[0],n[1],n[2],{interactive:l[1]},n[4],n[5]]):{};i&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Vc(r,e,t){let{neighbourhood:n=Kr("neighbourhoodGj")}=e,{onClickIntersection:o=u=>{}}=e,{interactive:l=!1}=e;function i(u){let f=n.features[u];return new Dc(f)}function s(u){return i(u[0].id)}const a=u=>o(s(u.detail.features));return r.$$set=u=>{"neighbourhood"in u&&t(3,n=u.neighbourhood),"onClickIntersection"in u&&t(0,o=u.onClickIntersection),"interactive"in u&&t(1,l=u.interactive)},[o,l,s,n,a]}class Qc extends le{constructor(e){super(),ie(this,e,Vc,Kc,oe,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function Yo(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function Ko(r){let e,t,n,o,l,i,s=r[8]+"",a,u,f,c,_;function d(){return r[3](r[7])}return{c(){e=$("button"),t=$("img"),o=P(),l=$("br"),i=P(),a=N(s),u=P(),ze(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||C(t,"src",n),C(t,"width","80"),C(t,"alt",r[8]),C(e,"class","outline"),_e(e,"width","100%"),e.disabled=f=r[0]==r[7]},m(m,g){L(m,e,g),p(e,t),p(e,o),p(e,l),p(e,i),p(e,a),p(e,u),c||(_=V(e,"click",d),c=!0)},p(m,g){r=m,g&1&&f!==(f=r[0]==r[7])&&(e.disabled=f)},d(m){m&&M(e),c=!1,_()}}}function xc(r){let e,t,n,o,l,i,s,a,u,f,c,_,d=r[1][2]+"",m,g,b,w,h,y,v=qe(r[2]),I=[];for(let F=0;F<v.length;F+=1)I[F]=Ko(Yo(r,v,F));function O(){return r[4](r[6])}return{c(){e=$("h3"),e.textContent="Choose a modal filter to place on streets",t=P(),n=$("table"),o=$("tr"),l=$("td");for(let F=0;F<I.length;F+=1)I[F].c();i=P(),s=$("td"),a=$("img"),c=P(),_=$("p"),m=N(d),g=P(),b=$("center"),w=$("button"),w.textContent="Confirm",ze(a.src,u=`/ltn//filters/${r[0]}.gif`)||C(a,"src",u),C(a,"height","300"),C(a,"alt",f=r[1][1])},m(F,B){L(F,e,B),L(F,t,B),L(F,n,B),p(n,o),p(o,l);for(let z=0;z<I.length;z+=1)I[z]&&I[z].m(l,null);p(o,i),p(o,s),p(s,a),p(s,c),p(s,_),p(_,m),L(F,g,B),L(F,b,B),p(b,w),h||(y=V(w,"click",O),h=!0)},p(F,B){if(r=F,B&5){v=qe(r[2]);let z;for(z=0;z<v.length;z+=1){const D=Yo(r,v,z);I[z]?I[z].p(D,B):(I[z]=Ko(D),I[z].c(),I[z].m(l,null))}for(;z<I.length;z+=1)I[z].d(1);I.length=v.length}B&1&&!ze(a.src,u=`/ltn//filters/${r[0]}.gif`)&&C(a,"src",u),B&2&&f!==(f=r[1][1])&&C(a,"alt",f),B&2&&d!==(d=r[1][2]+"")&&fe(m,d)},d(F){F&&(M(e),M(t),M(n),M(g),M(b)),Nt(I,F),h=!1,y()}}}function ed(r){let e,t;return e=new fr({props:{$$slots:{default:[xc,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&4163&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function td(r,e,t){let n,o;Z(r,Pr,u=>t(0,o=u));let l=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const i=u=>K(Pr,o=u,o),s=u=>st(u).close();function a(u){Pe.call(this,r,u)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,n=l.find(u=>u[0]==o))},[o,n,l,i,s,a]}class nd extends le{constructor(e){super(),ie(this,e,td,ed,oe,{})}}function Vo(r){let e,t;return e=new xe({props:{data:r[0],$$slots:{default:[rd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.data=n[0]),o&64&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function rd(r){let e,t;const n=[Fe("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function od(r){let e,t,n=r[0]&&Vo(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&k(n,1)):(n=Vo(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function ld(r,e,t){let{map:n}=e,o=null;const l=nn();n.on("dragstart",i),n.on("mousemove",s),n.on("mouseup",a),Ft(()=>{n.dragPan.enable(),n.off("dragstart",i),n.off("mousemove",s),n.off("mouseup",a)});function i(){n.dragPan.disable(),t(0,o={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(u){o&&(o.geometry.coordinates.push(u.lngLat.toArray()),t(0,o))}function a(){o&&(l("done",o),t(0,o=null))}return r.$$set=u=>{"map"in u&&t(1,n=u.map)},[o,n]}class id extends le{constructor(e){super(),ie(this,e,ld,od,oe,{map:1})}}function sd(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function ad(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function ud(r){let e;return{c(){e=$("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function fd(r){let e;return{c(){e=N("View shortcuts")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function cd(r){let e;return{c(){e=N("Route")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function dd(r){let e;return{c(){e=N("Impact routing to one destination")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function _d(r){let e;return{c(){e=N("Change this boundary")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function md(r){let e;return{c(){e=N("Debug")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function gd(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b,w,h,y,v,I,O,F,B,z,D,R,j,te,W;return l=new he({props:{$$slots:{default:[sd]},$$scope:{ctx:r}}}),l.$on("click",r[31]),a=new he({props:{$$slots:{default:[ad]},$$scope:{ctx:r}}}),a.$on("click",r[32]),_=new ro({props:{$$slots:{default:[ud]},$$scope:{ctx:r}}}),w=new he({props:{$$slots:{default:[fd]},$$scope:{ctx:r}}}),w.$on("click",r[33]),v=new he({props:{$$slots:{default:[cd]},$$scope:{ctx:r}}}),v.$on("click",r[34]),F=new he({props:{$$slots:{default:[dd]},$$scope:{ctx:r}}}),F.$on("click",r[35]),D=new he({props:{$$slots:{default:[_d]},$$scope:{ctx:r}}}),D.$on("click",r[36]),te=new he({props:{$$slots:{default:[md]},$$scope:{ctx:r}}}),te.$on("click",r[37]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),c=N(`Editing
          `),T(_.$$.fragment),d=P(),m=$("nav"),g=$("ul"),b=$("li"),T(w.$$.fragment),h=P(),y=$("li"),T(v.$$.fragment),I=P(),O=$("li"),T(F.$$.fragment),B=P(),z=$("li"),T(D.$$.fragment),R=P(),j=$("li"),T(te.$$.fragment),C(t,"aria-label","breadcrumb"),C(e,"slot","top"),_e(e,"display","flex"),_e(e,"justify-content","space-between")},m(X,se){L(X,e,se),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),p(f,c),A(_,f,null),p(e,d),p(e,m),p(m,g),p(g,b),A(w,b,null),p(g,h),p(g,y),A(v,y,null),p(g,I),p(g,O),A(F,O,null),p(g,B),p(g,z),A(D,z,null),p(g,R),p(g,j),A(te,j,null),W=!0},p(X,se){const Le={};se[1]&1024&&(Le.$$scope={dirty:se,ctx:X}),l.$set(Le);const J={};se[1]&1024&&(J.$$scope={dirty:se,ctx:X}),a.$set(J);const Ce={};se[1]&1024&&(Ce.$$scope={dirty:se,ctx:X}),_.$set(Ce);const Me={};se[1]&1024&&(Me.$$scope={dirty:se,ctx:X}),w.$set(Me);const be={};se[1]&1024&&(be.$$scope={dirty:se,ctx:X}),v.$set(be);const ae={};se[1]&1024&&(ae.$$scope={dirty:se,ctx:X}),F.$set(ae);const Re={};se[1]&1024&&(Re.$$scope={dirty:se,ctx:X}),D.$set(Re);const ue={};se[1]&1024&&(ue.$$scope={dirty:se,ctx:X}),te.$set(ue)},i(X){W||(k(l.$$.fragment,X),k(a.$$.fragment,X),k(_.$$.fragment,X),k(w.$$.fragment,X),k(v.$$.fragment,X),k(F.$$.fragment,X),k(D.$$.fragment,X),k(te.$$.fragment,X),W=!0)},o(X){S(l.$$.fragment,X),S(a.$$.fragment,X),S(_.$$.fragment,X),S(w.$$.fragment,X),S(v.$$.fragment,X),S(F.$$.fragment,X),S(D.$$.fragment,X),S(te.$$.fragment,X),W=!1},d(X){X&&M(e),E(l),E(a),E(_),E(w),E(v),E(F),E(D),E(te)}}}function Qo(r){let e;return{c(){e=$("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function xo(r){let e,t;return e=new ps({props:{colorScale:ci,limits:di}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function pd(r){let e,t,n;return{c(){e=N("Undo ("),t=N(r[4]),n=N(")")},m(o,l){L(o,e,l),L(o,t,l),L(o,n,l)},p(o,l){l[0]&16&&fe(t,o[4])},d(o){o&&(M(e),M(t),M(n))}}}function hd(r){let e;return{c(){e=N("Undo")},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function bd(r){let e,t,n;return{c(){e=N("Redo ("),t=N(r[5]),n=N(")")},m(o,l){L(o,e,l),L(o,t,l),L(o,n,l)},p(o,l){l[0]&32&&fe(t,o[5])},d(o){o&&(M(e),M(t),M(n))}}}function yd(r){let e;return{c(){e=N("Redo")},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function el(r){let e,t;return e=new nd({}),e.$on("close",r[30]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function wd(r){let e,t,n,o,l=st(r[6]).properties.name+"",i,s,a=r[1].area_km2.toFixed(1)+"",u,f,c,_,d,m,g,b,w,h,y,v,I,O,F,B,z,D,R,j,te,W,X,se,Le,J,Ce,Me,be,ae,Re,ue,pe,$e,ne,we,lt,Ct,x,ce,q,ye,de,me,U,tt,je,Be,ht,ut=r[8]>0&&Qo(),De=r[12]=="speeds"&&xo();function Jt(Te,Ve){return Te[4]==0?hd:pd}let Wt=Jt(r),bt=Wt(r);function Zn(Te,Ve){return Te[5]==0?yd:bd}let $t=Zn(r),Lt=$t(r),Ke=r[3]&&el(r);return{c(){e=$("div"),t=$("p"),n=N("Editing neighbourhood "),o=$("u"),i=N(l),s=N(`
      , with an area of `),u=N(a),f=N(" kmÂ²"),c=P(),ut&&ut.c(),_=P(),d=$("div"),m=$("button"),g=$("img"),w=N(`
        Add a modal filter`),y=P(),v=$("button"),I=N("Add many modal filters along line"),F=P(),B=$("button"),z=N("Reverse directions"),R=P(),j=$("button"),j.textContent="Change modal filter type",te=P(),W=$("label"),X=$("input"),se=N(`
      Animate shortcuts`),Le=P(),J=$("label"),Ce=$("input"),Me=N(`
      Include perimeter roads`),be=P(),ae=$("div"),Re=$("label"),ue=N(`Draw roads:
        `),pe=$("select"),$e=$("option"),$e.textContent="Worst shortcuts",ne=$("option"),ne.textContent="Cell",we=$("option"),we.textContent="Edits (either filter or direction)",lt=$("option"),lt.textContent="Speed limit",Ct=P(),De&&De.c(),x=P(),ce=$("div"),q=$("button"),bt.c(),de=P(),me=$("button"),Lt.c(),tt=P(),Ke&&Ke.c(),ze(g.src,b=`/ltn//filters/${r[9]}_icon.gif`)||C(g,"src",b),C(g,"width","30"),C(g,"alt","Add a modal filter"),m.disabled=h=r[0]=="filter",C(m,"data-tooltip","hotkey 1"),v.disabled=O=r[0]=="freehand-filters",C(v,"data-tooltip","hotkey 2"),B.disabled=D=r[0]=="oneway",C(B,"data-tooltip","hotkey 3"),_e(d,"display","flex"),_e(d,"justify-content","space-between"),C(X,"type","checkbox"),C(Ce,"type","checkbox"),$e.__value="shortcuts",Ye($e,$e.__value),ne.__value="cells",Ye(ne,ne.__value),we.__value="edits",Ye(we,we.__value),lt.__value="speeds",Ye(lt,lt.__value),r[12]===void 0&&Zr(()=>r[29].call(pe)),_e(ae,"border","1px solid black"),_e(ae,"padding","4px"),q.disabled=ye=r[4]==0,C(q,"data-tooltip","Ctrl+Z"),me.disabled=U=r[5]==0,C(me,"data-tooltip","Ctrl+Y"),_e(ce,"display","flex"),_e(ce,"justify-content","space-between"),C(e,"slot","sidebar")},m(Te,Ve){L(Te,e,Ve),p(e,t),p(t,n),p(t,o),p(o,i),p(t,s),p(t,u),p(t,f),p(e,c),ut&&ut.m(e,null),p(e,_),p(e,d),p(d,m),p(m,g),p(m,w),p(d,y),p(d,v),p(v,I),p(d,F),p(d,B),p(B,z),p(e,R),p(e,j),p(e,te),p(e,W),p(W,X),X.checked=r[11],p(W,se),p(e,Le),p(e,J),p(J,Ce),Ce.checked=r[10],p(J,Me),p(e,be),p(e,ae),p(ae,Re),p(Re,ue),p(Re,pe),p(pe,$e),p(pe,ne),p(pe,we),p(pe,lt),gn(pe,r[12],!0),p(ae,Ct),De&&De.m(ae,null),p(e,x),p(e,ce),p(ce,q),bt.m(q,null),p(ce,de),p(ce,me),Lt.m(me,null),p(e,tt),Ke&&Ke.m(e,null),je=!0,Be||(ht=[V(m,"click",r[23]),V(v,"click",r[24]),V(B,"click",r[25]),V(j,"click",r[26]),V(X,"change",r[27]),V(Ce,"change",r[28]),V(Ce,"change",r[14]),V(pe,"change",r[29]),V(q,"click",r[19]),V(me,"click",r[20])],Be=!0)},p(Te,Ve){(!je||Ve[0]&64)&&l!==(l=st(Te[6]).properties.name+"")&&fe(i,l),(!je||Ve[0]&2)&&a!==(a=Te[1].area_km2.toFixed(1)+"")&&fe(u,a),Te[8]>0?ut||(ut=Qo(),ut.c(),ut.m(e,_)):ut&&(ut.d(1),ut=null),(!je||Ve[0]&512&&!ze(g.src,b=`/ltn//filters/${Te[9]}_icon.gif`))&&C(g,"src",b),(!je||Ve[0]&1&&h!==(h=Te[0]=="filter"))&&(m.disabled=h),(!je||Ve[0]&1&&O!==(O=Te[0]=="freehand-filters"))&&(v.disabled=O),(!je||Ve[0]&1&&D!==(D=Te[0]=="oneway"))&&(B.disabled=D),Ve[0]&2048&&(X.checked=Te[11]),Ve[0]&1024&&(Ce.checked=Te[10]),Ve[0]&4096&&gn(pe,Te[12]),Te[12]=="speeds"?De?Ve[0]&4096&&k(De,1):(De=xo(),De.c(),k(De,1),De.m(ae,null)):De&&(ve(),S(De,1,1,()=>{De=null}),ke()),Wt===(Wt=Jt(Te))&&bt?bt.p(Te,Ve):(bt.d(1),bt=Wt(Te),bt&&(bt.c(),bt.m(q,null))),(!je||Ve[0]&16&&ye!==(ye=Te[4]==0))&&(q.disabled=ye),$t===($t=Zn(Te))&&Lt?Lt.p(Te,Ve):(Lt.d(1),Lt=$t(Te),Lt&&(Lt.c(),Lt.m(me,null))),(!je||Ve[0]&32&&U!==(U=Te[5]==0))&&(me.disabled=U),Te[3]?Ke?(Ke.p(Te,Ve),Ve[0]&8&&k(Ke,1)):(Ke=el(Te),Ke.c(),k(Ke,1),Ke.m(e,null)):Ke&&(ve(),S(Ke,1,1,()=>{Ke=null}),ke())},i(Te){je||(k(De),k(Ke),je=!0)},o(Te){S(De),S(Ke),je=!1},d(Te){Te&&M(e),ut&&ut.d(),De&&De.d(),bt.d(),Lt.d(),Ke&&Ke.d(),Be=!1,at(ht)}}}function vd(r){let e;return{c(){e=$("p"),e.textContent="Click to change direction"},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function kd(r){let e,t,n,o;return{c(){e=$("div"),t=$("img"),o=N(`
                Click to add modal filter`),ze(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||C(t,"src",n),C(t,"width","20"),C(t,"alt","Add modal filter")},m(l,i){L(l,e,i),p(e,t),p(e,o)},p(l,i){i[0]&512&&!ze(t.src,n=`/ltn//filters/${l[9]}_icon.gif`)&&C(t,"src",n)},d(l){l&&M(e)}}}function $d(r){let e,t=r[40].shortcuts+"",n,o,l=(r[40].name??"unnamed road")+"",i,s,a=Math.round(r[40].speed_mph)+"",u,f,c,_;function d(b,w){return b[0]=="filter"?kd:vd}let m=d(r),g=m(r);return{c(){e=$("p"),n=N(t),o=N(" shortcuts through "),i=N(l),s=N(`
              (`),u=N(a),f=N(" mph)"),c=P(),g.c(),_=et()},m(b,w){L(b,e,w),p(e,n),p(e,o),p(e,i),p(e,s),p(e,u),p(e,f),L(b,c,w),g.m(b,w),L(b,_,w)},p(b,w){w[1]&512&&t!==(t=b[40].shortcuts+"")&&fe(n,t),w[1]&512&&l!==(l=(b[40].name??"unnamed road")+"")&&fe(i,l),w[1]&512&&a!==(a=Math.round(b[40].speed_mph)+"")&&fe(u,a),m===(m=d(b))&&g?g.p(b,w):(g.d(1),g=m(b),g&&(g.c(),g.m(_.parentNode,_)))},d(b){b&&(M(e),M(c),M(_)),g.d(b)}}}function Ld(r){let e,t,n;return t=new zt({props:{openOn:"hover",$$slots:{default:[$d,({props:o})=>({40:o}),({props:o})=>[0,o?512:0]]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","line-popup")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l[0]&513|l[1]&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function Md(r){let e,t,n,o,l,i,s,a,u,f;return e=new gr({}),n=new mr({}),l=new pr({}),s=new Jn({props:{interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[15],$$slots:{"line-popup":[Ld]},$$scope:{ctx:r}}}),u=new Qc({props:{interactive:r[0]=="filter",neighbourhood:r[1],onClickIntersection:r[17]}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),T(s.$$.fragment),a=P(),T(u.$$.fragment)},m(c,_){A(e,c,_),L(c,t,_),A(n,c,_),L(c,o,_),A(l,c,_),L(c,i,_),A(s,c,_),L(c,a,_),A(u,c,_),f=!0},p(c,_){const d={};_[0]&1&&(d.interactive=c[0]=="filter"||c[0]=="oneway"),_[0]&513|_[1]&1024&&(d.$$scope={dirty:_,ctx:c}),s.$set(d);const m={};_[0]&1&&(m.interactive=c[0]=="filter"),_[0]&2&&(m.neighbourhood=c[1]),u.$set(m)},i(c){f||(k(e.$$.fragment,c),k(n.$$.fragment,c),k(l.$$.fragment,c),k(s.$$.fragment,c),k(u.$$.fragment,c),f=!0)},o(c){S(e.$$.fragment,c),S(n.$$.fragment,c),S(l.$$.fragment,c),S(s.$$.fragment,c),S(u.$$.fragment,c),f=!1},d(c){c&&(M(t),M(o),M(i),M(a)),E(e,c),E(n,c),E(l,c),E(s,c),E(u,c)}}}function tl(r){let e,t;return e=new zc({props:{paths:r[7]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[0]&128&&(l.paths=n[7]),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Sd(r){let e;return{c(){e=N("Click to delete")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Cd(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[Sd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[1]&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function nl(r){let e,t;return e=new id({props:{map:st(r[2])}}),e.$on("done",r[21]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o[0]&4&&(l.map=st(n[2])),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Td(r){let e,t,n,o,l,i,s;t=new Wn({props:{input:r[1],$$slots:{default:[Md]},$$scope:{ctx:r}}});let a=r[11]&&tl(r);l=new on({props:{$$slots:{default:[Cd]},$$scope:{ctx:r}}}),l.$on("click",r[16]);let u=r[0]=="freehand-filters"&&nl(r);return{c(){e=$("div"),T(t.$$.fragment),n=P(),a&&a.c(),o=P(),T(l.$$.fragment),i=P(),u&&u.c(),C(e,"slot","map")},m(f,c){L(f,e,c),A(t,e,null),p(e,n),a&&a.m(e,null),p(e,o),A(l,e,null),p(e,i),u&&u.m(e,null),s=!0},p(f,c){const _={};c[0]&2&&(_.input=f[1]),c[0]&515|c[1]&1024&&(_.$$scope={dirty:c,ctx:f}),t.$set(_),f[11]?a?(a.p(f,c),c[0]&2048&&k(a,1)):(a=tl(f),a.c(),k(a,1),a.m(e,o)):a&&(ve(),S(a,1,1,()=>{a=null}),ke());const d={};c[1]&1024&&(d.$$scope={dirty:c,ctx:f}),l.$set(d),f[0]=="freehand-filters"?u?(u.p(f,c),c[0]&1&&k(u,1)):(u=nl(f),u.c(),k(u,1),u.m(e,null)):u&&(ve(),S(u,1,1,()=>{u=null}),ke())},i(f){s||(k(t.$$.fragment,f),k(a),k(l.$$.fragment,f),k(u),s=!0)},o(f){S(t.$$.fragment,f),S(a),S(l.$$.fragment,f),S(u),s=!1},d(f){f&&M(e),E(t),a&&a.d(),E(l),u&&u.d()}}}function Ad(r){let e,t,n,o;return e=new kt({props:{$$slots:{map:[Td],sidebar:[wd],top:[gd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0,n||(o=V(window,"keydown",r[18]),n=!0)},p(l,i){const s={};i[0]&16383|i[1]&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l),n=!1,o()}}}function Ed(r,e,t){let n,o,l,i,s,a,u,f,c;Z(r,Tt,ne=>t(22,o=ne)),Z(r,Pr,ne=>t(9,l=ne)),Z(r,Ze,ne=>t(38,i=ne)),Z(r,Bn,ne=>t(10,s=ne)),Z(r,Ht,ne=>t(2,a=ne)),Z(r,so,ne=>t(11,u=ne)),Z(r,or,ne=>t(12,f=ne)),Z(r,ee,ne=>t(13,c=ne));let _="filter",d=!1,m=0,g=0,b,w,h=i.getAllShortcuts();Ft(()=>{a.doubleClickZoom.enable()});function y(ne){t(1,w=i.renderNeighbourhood()),t(6,b=w.features.find(we=>we.properties.kind=="boundary")),t(4,m=w.undo_length),t(5,g=w.redo_length),t(7,h=i.getAllShortcuts()),pn()}function v(){i.setCurrentNeighbourhood(b.properties.name,s),K(Tt,o++,o)}function I(ne,we){_=="filter"?(i.addModalFilter(we,l),K(Tt,o++,o)):_=="oneway"&&(i.toggleDirection(ne.properties.road),K(Tt,o++,o))}function O(ne){let we=ne.detail.features[0];i.deleteModalFilter(we.properties.road),K(Tt,o++,o)}function F(ne){if(_!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${_}`);return}ne.hasRotatedFilter?(i.deleteDiagonalFilter(ne),K(Tt,o++,o)):ne.filter?(i.rotateDiagonalFilter(ne),K(Tt,o++,o)):(i.addDiagonalFilter(ne),K(Tt,o++,o))}function B(ne){ne.target.tagName!="INPUT"&&(ne.ctrlKey&&ne.key=="z"&&z(),ne.ctrlKey&&ne.key=="y"&&D(),ne.key=="1"&&t(0,_="filter"),ne.key=="2"&&t(0,_="freehand-filters"),ne.key=="3"&&t(0,_="oneway"))}function z(){i.undo(),K(Tt,o++,o)}function D(){i.redo(),K(Tt,o++,o)}function R(ne){let we=ne.detail;we&&(i.addManyModalFilters(we,l),K(Tt,o++,o)),t(0,_="filter")}const j=()=>t(0,_="filter"),te=()=>t(0,_="freehand-filters"),W=()=>t(0,_="oneway"),X=()=>t(3,d=!0);function se(){u=this.checked,so.set(u)}function Le(){s=this.checked,Bn.set(s)}function J(){f=Xr(this),or.set(f)}const Ce=()=>t(3,d=!1),Me=()=>K(ee,c={mode:"title",firstLoad:!1},c),be=()=>K(ee,c={mode:"pick-neighbourhood"},c),ae=()=>K(ee,c={mode:"view-shortcuts"},c),Re=()=>K(ee,c={mode:"route",prevMode:"neighbourhood"},c),ue=()=>K(ee,c={mode:"impact-one-destination"},c),pe=()=>K(ee,c={mode:"set-boundary",name:st(b).properties.name,existing:b},c),$e=()=>K(ee,c={mode:"debug-neighbourhood"},c);return r.$$.update=()=>{r.$$.dirty[0]&5&&(_=="oneway"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&4194304&&y(),r.$$.dirty[0]&2&&t(8,n=w.features.filter(ne=>ne.properties.kind=="cell"&&ne.properties.cell_color=="disconnected").length)},[_,w,a,d,m,g,b,h,n,l,s,u,f,c,v,I,O,F,B,z,D,R,o,j,te,W,X,se,Le,J,Ce,Me,be,ae,Re,ue,pe,$e]}class Pd extends le{constructor(e){super(),ie(this,e,Ed,Ad,oe,{},null,[-1,-1])}}function Id(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Fd(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function jd(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new he({props:{$$slots:{default:[Id]},$$scope:{ctx:r}}}),l.$on("click",r[7]),a=new he({props:{$$slots:{default:[Fd]},$$scope:{ctx:r}}}),a.$on("click",r[8]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),f.textContent="Predict impact",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(_,d){L(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(k(l.$$.fragment,_),k(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&M(e),E(l),E(a)}}}function Bd(r){let e;return{c(){e=N("Pick a different road")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Od(r){let e,t,n,o,l,i,s,a;t=new he({props:{$$slots:{default:[Bd]},$$scope:{ctx:r}}}),t.$on("click",r[5]);function u(c){r[6](c)}let f={list:r[2]};return r[0]!==void 0&&(f.idx=r[0]),o=new _r({props:f}),Ne.push(()=>ft(o,"idx",u)),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),i=P(),s=$("p"),s.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,C(e,"slot","sidebar")},m(c,_){L(c,e,_),A(t,e,null),p(e,n),A(o,e,null),p(e,i),p(e,s),a=!0},p(c,_){const d={};_&1024&&(d.$$scope={dirty:_,ctx:c}),t.$set(d);const m={};!l&&_&1&&(l=!0,m.idx=c[0],ct(()=>l=!1)),o.$set(m)},i(c){a||(k(t.$$.fragment,c),k(o.$$.fragment,c),a=!0)},o(c){S(t.$$.fragment,c),S(o.$$.fragment,c),a=!1},d(c){c&&M(e),E(t),E(o)}}}function Rd(r){let e,t;const n=[Fe("predict-impact"),{paint:{"line-width":jn(["get","kind"],{focus:8},5),"line-color":jn(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":jn(["get","kind"],{focus:1},.5)}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Nd(r){let e;return{c(){e=N("A")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function zd(r){let e;return{c(){e=N("B")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Dd(r){let e,t,n,o,l,i,s,a,u;return t=new xe({props:{data:r[3](r[0]),$$slots:{default:[Rd]},$$scope:{ctx:r}}}),o=new un({props:{lngLat:r[2][r[0]][0].geometry.coordinates[0],$$slots:{default:[Nd]},$$scope:{ctx:r}}}),i=new un({props:{lngLat:r[2][r[0]][0].geometry.coordinates[r[2][r[0]][0].geometry.coordinates.length-1],$$slots:{default:[zd]},$$scope:{ctx:r}}}),a=new on({}),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),l=P(),T(i.$$.fragment),s=P(),T(a.$$.fragment),C(e,"slot","map")},m(f,c){L(f,e,c),A(t,e,null),p(e,n),A(o,e,null),p(e,l),A(i,e,null),p(e,s),A(a,e,null),u=!0},p(f,c){const _={};c&1&&(_.data=f[3](f[0])),c&1024&&(_.$$scope={dirty:c,ctx:f}),t.$set(_);const d={};c&1&&(d.lngLat=f[2][f[0]][0].geometry.coordinates[0]),c&1024&&(d.$$scope={dirty:c,ctx:f}),o.$set(d);const m={};c&1&&(m.lngLat=f[2][f[0]][0].geometry.coordinates[f[2][f[0]][0].geometry.coordinates.length-1]),c&1024&&(m.$$scope={dirty:c,ctx:f}),i.$set(m)},i(f){u||(k(t.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),k(a.$$.fragment,f),u=!0)},o(f){S(t.$$.fragment,f),S(o.$$.fragment,f),S(i.$$.fragment,f),S(a.$$.fragment,f),u=!1},d(f){f&&M(e),E(t),E(o),E(i),E(a)}}}function Ud(r){let e,t;return e=new kt({props:{$$slots:{map:[Dd],sidebar:[Od],top:[jd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Hd(r,e,t){let n,o;Z(r,Ze,d=>t(9,n=d)),Z(r,ee,d=>t(1,o=d));let{road:l}=e;l.properties.kind="focus";let i=n.getImpactsOnRoad(l.properties.id),s=0;function a(d){return{type:"FeatureCollection",features:[i[d][0],i[d][1],l]}}const u=()=>K(ee,o={mode:"predict-impact"},o);function f(d){s=d,t(0,s)}const c=()=>K(ee,o={mode:"title",firstLoad:!1},o),_=()=>K(ee,o={mode:"pick-neighbourhood"},o);return r.$$set=d=>{"road"in d&&t(4,l=d.road)},[s,o,i,a,l,u,f,c,_]}class Gd extends le{constructor(e){super(),ie(this,e,Hd,Ud,oe,{road:4})}}function Jd(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Wd(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function qd(r){let e;return{c(){e=N("Editing")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Zd(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;return l=new he({props:{$$slots:{default:[Jd]},$$scope:{ctx:r}}}),l.$on("click",r[12]),a=new he({props:{$$slots:{default:[Wd]},$$scope:{ctx:r}}}),a.$on("click",r[13]),c=new he({props:{$$slots:{default:[qd]},$$scope:{ctx:r}}}),c.$on("click",r[5]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),T(c.$$.fragment),_=P(),d=$("li"),d.textContent="Impact routing to one destination",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(g,b){L(g,e,b),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),A(c,f,null),p(n,_),p(n,d),m=!0},p(g,b){const w={};b&262144&&(w.$$scope={dirty:b,ctx:g}),l.$set(w);const h={};b&262144&&(h.$$scope={dirty:b,ctx:g}),a.$set(h);const y={};b&262144&&(y.$$scope={dirty:b,ctx:g}),c.$set(y)},i(g){m||(k(l.$$.fragment,g),k(a.$$.fragment,g),k(c.$$.fragment,g),m=!0)},o(g){S(l.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&M(e),E(l),E(a),E(c)}}}function Xd(r){let e,t,n,o,l,i,s,a=r[3].highest_time_ratio.toFixed(1)+"",u,f;return t=new rn({}),t.$on("click",r[5]),{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),o.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,l=P(),i=$("p"),s=N("Highest ratio is "),u=N(a),C(e,"slot","sidebar")},m(c,_){L(c,e,_),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(i,s),p(i,u),f=!0},p(c,_){(!f||_&8)&&a!==(a=c[3].highest_time_ratio.toFixed(1)+"")&&fe(u,a)},i(c){f||(k(t.$$.fragment,c),f=!0)},o(c){S(t.$$.fragment,c),f=!1},d(c){c&&M(e),E(t)}}}function Yd(r){let e,t;const n=[Fe("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new jt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Kd(r){let e,t=xt(r[17].distance_before)+"",n,o,l=en(r[17].time_before)+"",i,s,a,u,f=xt(r[17].distance_after)+"",c,_,d=en(r[17].time_after)+"",m,g,b,w,h,y=(r[17].time_after/r[17].time_before).toFixed(1)+"",v;return{c(){e=$("p"),n=N(t),o=N(", "),i=N(l),s=N(" before"),a=P(),u=$("p"),c=N(f),_=N(", "),m=N(d),g=N(" after"),b=P(),w=$("p"),h=N("Time ratio: "),v=N(y)},m(I,O){L(I,e,O),p(e,n),p(e,o),p(e,i),p(e,s),L(I,a,O),L(I,u,O),p(u,c),p(u,_),p(u,m),p(u,g),L(I,b,O),L(I,w,O),p(w,h),p(w,v)},p(I,O){O&131072&&t!==(t=xt(I[17].distance_before)+"")&&fe(n,t),O&131072&&l!==(l=en(I[17].time_before)+"")&&fe(i,l),O&131072&&f!==(f=xt(I[17].distance_after)+"")&&fe(c,f),O&131072&&d!==(d=en(I[17].time_after)+"")&&fe(m,d),O&131072&&y!==(y=(I[17].time_after/I[17].time_before).toFixed(1)+"")&&fe(v,y)},d(I){I&&(M(e),M(a),M(u),M(b),M(w))}}}function Vd(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[Kd,({props:n})=>({17:n}),({props:n})=>n?131072:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&393216&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Qd(r){let e,t,n;const o=[Fe("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[3].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function l(s){r[9](s)}let i={$$slots:{default:[Vd]},$$scope:{ctx:r}};for(let s=0;s<o.length;s+=1)i=Ie(i,o[s]);return r[0]!==void 0&&(i.hovered=r[0]),e=new dt({props:i}),Ne.push(()=>ft(e,"hovered",l)),e.$on("click",r[10]),{c(){T(e.$$.fragment)},m(s,a){A(e,s,a),n=!0},p(s,a){const u=a&8?Gt(o,[o[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[3].highest_time_ratio,1.1),"red"],"line-width":5}},o[2]]):{};a&262144&&(u.$$scope={dirty:a,ctx:s}),!t&&a&1&&(t=!0,u.hovered=s[0],ct(()=>t=!1)),e.$set(u)},i(s){n||(k(e.$$.fragment,s),n=!0)},o(s){S(e.$$.fragment,s),n=!1},d(s){E(e,s)}}}function xd(r){let e,t;const n=[Fe("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":jn(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function e_(r){let e;return{c(){e=N("X")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function t_(r){let e,t,n,o,l,i,s,a,u,f,c,_;t=new Wn({props:{$$slots:{default:[Yd]},$$scope:{ctx:r}}}),o=new xe({props:{data:r[3],generateId:!0,$$slots:{default:[Qd]},$$scope:{ctx:r}}}),i=new xe({props:{data:r[2],$$slots:{default:[xd]},$$scope:{ctx:r}}}),a=new on({});function d(g){r[11](g)}let m={draggable:!0,$$slots:{default:[e_]},$$scope:{ctx:r}};return r[1]!==void 0&&(m.lngLat=r[1]),f=new un({props:m}),Ne.push(()=>ft(f,"lngLat",d)),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),l=P(),T(i.$$.fragment),s=P(),T(a.$$.fragment),u=P(),T(f.$$.fragment),C(e,"slot","map")},m(g,b){L(g,e,b),A(t,e,null),p(e,n),A(o,e,null),p(e,l),A(i,e,null),p(e,s),A(a,e,null),p(e,u),A(f,e,null),_=!0},p(g,b){const w={};b&262144&&(w.$$scope={dirty:b,ctx:g}),t.$set(w);const h={};b&8&&(h.data=g[3]),b&262153&&(h.$$scope={dirty:b,ctx:g}),o.$set(h);const y={};b&4&&(y.data=g[2]),b&262144&&(y.$$scope={dirty:b,ctx:g}),i.$set(y);const v={};b&262144&&(v.$$scope={dirty:b,ctx:g}),!c&&b&2&&(c=!0,v.lngLat=g[1],ct(()=>c=!1)),f.$set(v)},i(g){_||(k(t.$$.fragment,g),k(o.$$.fragment,g),k(i.$$.fragment,g),k(a.$$.fragment,g),k(f.$$.fragment,g),_=!0)},o(g){S(t.$$.fragment,g),S(o.$$.fragment,g),S(i.$$.fragment,g),S(a.$$.fragment,g),S(f.$$.fragment,g),_=!1},d(g){g&&M(e),E(t),E(o),E(i),E(a),E(f)}}}function n_(r){let e,t,n,o;return e=new ai({}),e.$on("contextmenu",r[7]),n=new kt({props:{$$slots:{map:[t_],sidebar:[Xd],top:[Zd]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(l,i){A(e,l,i),L(l,t,i),A(n,l,i),o=!0},p(l,[i]){const s={};i&262175&&(s.$$scope={dirty:i,ctx:l}),n.$set(s)},i(l){o||(k(e.$$.fragment,l),k(n.$$.fragment,l),o=!0)},o(l){S(e.$$.fragment,l),S(n.$$.fragment,l),o=!1},d(l){l&&M(t),E(e,l),E(n,l)}}}function r_(r,e,t){let n,o,l,i,s,a,u;Z(r,Qn,v=>t(1,l=v)),Z(r,ee,v=>t(4,i=v)),Z(r,On,v=>t(14,s=v)),Z(r,Rn,v=>t(15,a=v)),Z(r,Ze,v=>t(8,u=v));function f(){K(ee,i={mode:"neighbourhood"},i)}let c=null;function _(v){return v?u.compareRoute(new Ir.LngLat(v.properties.pt1_x,v.properties.pt1_y),l,1):Yt()}function d(v){K(Rn,a=new Ir.LngLat(v.properties.pt1_x,v.properties.pt1_y),a),K(On,s=l,s),K(ee,i={mode:"route",prevMode:"impact-one-destination"},i)}function m(v){K(Qn,l=v.detail.lngLat,l)}function g(v){c=v,t(0,c)}const b=v=>d(v.detail.features[0]);function w(v){l=v,Qn.set(l)}const h=()=>K(ee,i={mode:"title",firstLoad:!1},i),y=()=>K(ee,i={mode:"pick-neighbourhood"},i);return r.$$.update=()=>{r.$$.dirty&258&&t(3,n=u.impactToOneDestination(l)),r.$$.dirty&1&&t(2,o=_(c))},[c,l,o,n,i,f,d,m,u,g,b,w,h,y]}class o_ extends le{constructor(e){super(),ie(this,e,r_,n_,oe,{})}}const gi="/ltn/assets/delete-ec75e756.svg",pi="/ltn/assets/edit-f3f51206.svg";function rl(r,e,t){const n=r.slice();return n[24]=e[t],n}function l_(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function i_(r){let e;return{c(){e=$("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function s_(r){let e;return{c(){e=N("Route")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function a_(r){let e;return{c(){e=N("Predict impact")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function u_(r){let e;return{c(){e=N("Debug intersections")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function f_(r){let e;return{c(){e=N("Debug demand")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function c_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b,w,h,y,v,I,O,F,B;return l=new he({props:{$$slots:{default:[l_]},$$scope:{ctx:r}}}),l.$on("click",r[17]),u=new ro({props:{$$slots:{default:[i_]},$$scope:{ctx:r}}}),m=new he({props:{$$slots:{default:[s_]},$$scope:{ctx:r}}}),m.$on("click",r[18]),w=new he({props:{$$slots:{default:[a_]},$$scope:{ctx:r}}}),w.$on("click",r[19]),v=new he({props:{$$slots:{default:[u_]},$$scope:{ctx:r}}}),v.$on("click",r[20]),F=new he({props:{$$slots:{default:[f_]},$$scope:{ctx:r}}}),F.$on("click",r[21]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),a=N(`Pick neighbourhood
          `),T(u.$$.fragment),f=P(),c=$("nav"),_=$("ul"),d=$("li"),T(m.$$.fragment),g=P(),b=$("li"),T(w.$$.fragment),h=P(),y=$("li"),T(v.$$.fragment),I=P(),O=$("li"),T(F.$$.fragment),C(t,"aria-label","breadcrumb"),C(e,"slot","top"),_e(e,"display","flex"),_e(e,"justify-content","space-between")},m(z,D){L(z,e,D),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),p(s,a),A(u,s,null),p(e,f),p(e,c),p(c,_),p(_,d),A(m,d,null),p(_,g),p(_,b),A(w,b,null),p(_,h),p(_,y),A(v,y,null),p(_,I),p(_,O),A(F,O,null),B=!0},p(z,D){const R={};D&134217728&&(R.$$scope={dirty:D,ctx:z}),l.$set(R);const j={};D&134217728&&(j.$$scope={dirty:D,ctx:z}),u.$set(j);const te={};D&134217728&&(te.$$scope={dirty:D,ctx:z}),m.$set(te);const W={};D&134217728&&(W.$$scope={dirty:D,ctx:z}),w.$set(W);const X={};D&134217728&&(X.$$scope={dirty:D,ctx:z}),v.$set(X);const se={};D&134217728&&(se.$$scope={dirty:D,ctx:z}),F.$set(se)},i(z){B||(k(l.$$.fragment,z),k(u.$$.fragment,z),k(m.$$.fragment,z),k(w.$$.fragment,z),k(v.$$.fragment,z),k(F.$$.fragment,z),B=!0)},o(z){S(l.$$.fragment,z),S(u.$$.fragment,z),S(m.$$.fragment,z),S(w.$$.fragment,z),S(v.$$.fragment,z),S(F.$$.fragment,z),B=!1},d(z){z&&M(e),E(l),E(u),E(m),E(w),E(v),E(F)}}}function d_(r){let e;return{c(){e=N("Draw a new boundary")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function __(r){let e;return{c(){e=N("Use an auto-generated boundary")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function m_(r){let e=r[24]+"",t;return{c(){t=N(e)},m(n,o){L(n,t,o)},p(n,o){o&4&&e!==(e=n[24]+"")&&fe(t,e)},d(n){n&&M(t)}}}function ol(r){let e,t,n,o,l,i,s,a,u,f,c;function _(){return r[14](r[24])}n=new he({props:{$$slots:{default:[m_]},$$scope:{ctx:r}}}),n.$on("click",_);function d(){return r[15](r[24])}function m(){return r[16](r[24])}return{c(){e=$("li"),t=$("span"),T(n.$$.fragment),o=P(),l=$("button"),l.innerHTML=`<img src="${pi}" alt="Rename neighbourhood"/>`,i=P(),s=$("button"),s.innerHTML=`<img src="${gi}" alt="Delete neighbourhood"/>`,a=P(),C(l,"class","secondary"),C(s,"class","secondary"),_e(t,"display","flex"),_e(t,"justify-content","space-between")},m(g,b){L(g,e,b),p(e,t),A(n,t,null),p(t,o),p(t,l),p(t,i),p(t,s),p(e,a),u=!0,f||(c=[V(l,"click",d),V(s,"click",m)],f=!0)},p(g,b){r=g;const w={};b&134217732&&(w.$$scope={dirty:b,ctx:r}),n.$set(w)},i(g){u||(k(n.$$.fragment,g),u=!0)},o(g){S(n.$$.fragment,g),u=!1},d(g){g&&M(e),E(n),f=!1,at(c)}}}function g_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b,w=r[1].modalFilters+"",h,y,v,I,O=r[1].deletedModalFilters+"",F,B,z,D,R=r[1].directions+"",j,te,W,X,se,Le,J,Ce,Me;n=new he({props:{$$slots:{default:[d_]},$$scope:{ctx:r}}}),n.$on("click",r[8]),i=new he({props:{$$slots:{default:[__]},$$scope:{ctx:r}}}),i.$on("click",r[13]);let be=qe(r[2]),ae=[];for(let ue=0;ue<be.length;ue+=1)ae[ue]=ol(rl(r,be,ue));const Re=ue=>S(ae[ue],1,1,()=>{ae[ue]=null});return{c(){e=$("div"),t=$("div"),T(n.$$.fragment),o=P(),l=$("div"),T(i.$$.fragment),s=P(),a=$("ul");for(let ue=0;ue<ae.length;ue+=1)ae[ue].c();u=P(),f=$("hr"),c=P(),_=$("p"),d=N("Current project: "),m=N(r[3]),g=P(),b=$("p"),h=N(w),y=N(" new modal filter(s) added"),v=P(),I=$("p"),F=N(O),B=N(`
      existing modal filter(s) removed`),z=P(),D=$("p"),j=N(R),te=N(" road segment direction(s) changed"),W=P(),X=$("button"),X.textContent="Export project to GeoJSON",se=P(),Le=$("button"),Le.textContent="Debug route-snapper",C(Le,"class","secondary"),C(e,"slot","sidebar")},m(ue,pe){L(ue,e,pe),p(e,t),A(n,t,null),p(e,o),p(e,l),A(i,l,null),p(e,s),p(e,a);for(let $e=0;$e<ae.length;$e+=1)ae[$e]&&ae[$e].m(a,null);p(e,u),p(e,f),p(e,c),p(e,_),p(_,d),p(_,m),p(e,g),p(e,b),p(b,h),p(b,y),p(e,v),p(e,I),p(I,F),p(I,B),p(e,z),p(e,D),p(D,j),p(D,te),p(e,W),p(e,X),p(e,se),p(e,Le),J=!0,Ce||(Me=[V(X,"click",r[9]),V(Le,"click",r[10])],Ce=!0)},p(ue,pe){const $e={};pe&134217728&&($e.$$scope={dirty:pe,ctx:ue}),n.$set($e);const ne={};if(pe&134217728&&(ne.$$scope={dirty:pe,ctx:ue}),i.$set(ne),pe&228){be=qe(ue[2]);let we;for(we=0;we<be.length;we+=1){const lt=rl(ue,be,we);ae[we]?(ae[we].p(lt,pe),k(ae[we],1)):(ae[we]=ol(lt),ae[we].c(),k(ae[we],1),ae[we].m(a,null))}for(ve(),we=be.length;we<ae.length;we+=1)Re(we);ke()}(!J||pe&8)&&fe(m,ue[3]),(!J||pe&2)&&w!==(w=ue[1].modalFilters+"")&&fe(h,w),(!J||pe&2)&&O!==(O=ue[1].deletedModalFilters+"")&&fe(F,O),(!J||pe&2)&&R!==(R=ue[1].directions+"")&&fe(j,R)},i(ue){if(!J){k(n.$$.fragment,ue),k(i.$$.fragment,ue);for(let pe=0;pe<be.length;pe+=1)k(ae[pe]);J=!0}},o(ue){S(n.$$.fragment,ue),S(i.$$.fragment,ue),ae=ae.filter(Boolean);for(let pe=0;pe<ae.length;pe+=1)S(ae[pe]);J=!1},d(ue){ue&&M(e),E(n),E(i),Nt(ae,ue),Ce=!1,at(Me)}}}function p_(r){let e,t=r[23].name+"",n;return{c(){e=$("p"),n=N(t)},m(o,l){L(o,e,l),p(e,n)},p(o,l){l&8388608&&t!==(t=o[23].name+"")&&fe(n,t)},d(o){o&&M(e)}}}function h_(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[p_,({props:n})=>({23:n}),({props:n})=>n?8388608:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&142606336&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function b_(r){let e,t;const n=[Fe("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":wt(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[h_]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new jt({props:o}),e.$on("click",r[12]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};i&134217728&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function y_(r){let e,t,n,o,l;return t=new xe({props:{data:r[0],generateId:!0,$$slots:{default:[b_]},$$scope:{ctx:r}}}),o=new on({}),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),C(e,"slot","map")},m(i,s){L(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&1&&(a.data=i[0]),s&134217728&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(k(t.$$.fragment,i),k(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&M(e),E(t),E(o)}}}function w_(r){let e,t;return e=new kt({props:{$$slots:{map:[y_],sidebar:[g_],top:[c_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&134217759&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function v_(r){let e=0,t=0,n=0;for(let o of r.features)o.properties.kind=="modal_filter"?e++:o.properties.kind=="deleted_existing_modal_filter"?t++:o.properties.kind=="direction"&&n++;return{modalFilters:e,deletedModalFilters:t,directions:n}}function k_(r,e,t){let n,o,l,i,s,a,u;Z(r,Ze,D=>t(11,i=D)),Z(r,tn,D=>t(3,s=D)),Z(r,ee,D=>t(4,a=D)),Z(r,Bn,D=>t(22,u=D));function f(D){i.setCurrentNeighbourhood(D,u),K(ee,a={mode:"neighbourhood"},a)}function c(D){window.confirm(`Really delete neighbourhood ${D}? You can't undo this.`)&&(i.deleteNeighbourhoodBoundary(D),pn(),t(0,n=i.toSavefile()))}function _(D){let R=Gr(i,`Rename neighbourhood ${D} to what?`,D);R&&(i.renameNeighbourhoodBoundary(D,R),pn(),t(0,n=i.toSavefile()))}function d(){let D=Gr(i,"What do you want to name the neighbourhood?","");D&&K(ee,a={mode:"set-boundary",name:D,existing:null},a)}function m(){lr(s+".geojson",JSON.stringify(i.toSavefile()))}function g(){lr("debug_route_snapper.geojson",i.toRouteSnapperGj())}const b=D=>f(st(D.detail.features[0].properties).name),w=()=>K(ee,a={mode:"auto-boundaries"},a),h=D=>f(D),y=D=>_(D),v=D=>c(D),I=()=>K(ee,a={mode:"title",firstLoad:!1},a),O=()=>K(ee,a={mode:"route",prevMode:"pick-neighbourhood"},a),F=()=>K(ee,a={mode:"predict-impact"},a),B=()=>K(ee,a={mode:"debug-intersections"},a),z=()=>K(ee,a={mode:"debug-demand"},a);return r.$$.update=()=>{r.$$.dirty&2048&&t(0,n=i.toSavefile()),r.$$.dirty&1&&t(2,o=n.features.filter(D=>D.properties.kind=="boundary").map(D=>D.properties.name)),r.$$.dirty&1&&t(1,l=v_(n))},[n,l,o,s,a,f,c,_,d,m,g,i,b,w,h,y,v,I,O,F,B,z]}class $_ extends le{constructor(e){super(),ie(this,e,k_,w_,oe,{})}}function L_(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function M_(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function S_(r){let e,t,n,o,l,i,s,a,u,f,c;return l=new he({props:{$$slots:{default:[L_]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new he({props:{$$slots:{default:[M_]},$$scope:{ctx:r}}}),a.$on("click",r[7]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),f.textContent="Predict impact",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(_,d){L(_,e,d),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),c=!0},p(_,d){const m={};d&1024&&(m.$$scope={dirty:d,ctx:_}),l.$set(m);const g={};d&1024&&(g.$$scope={dirty:d,ctx:_}),a.$set(g)},i(_){c||(k(l.$$.fragment,_),k(a.$$.fragment,_),c=!0)},o(_){S(l.$$.fragment,_),S(a.$$.fragment,_),c=!1},d(_){_&&M(e),E(l),E(a)}}}function C_(r){let e,t,n,o,l,i,s,a,u;return t=new rn({}),t.$on("click",r[5]),{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),o.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,l=P(),i=$("p"),i.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,s=P(),a=$("p"),a.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${r[2].max_count.toLocaleString()}`,C(e,"slot","sidebar")},m(f,c){L(f,e,c),A(t,e,null),p(e,n),p(e,o),p(e,l),p(e,i),p(e,s),p(e,a),u=!0},p:Q,i(f){u||(k(t.$$.fragment,f),u=!0)},o(f){S(t.$$.fragment,f),u=!1},d(f){f&&M(e),E(t)}}}function T_(r){let e,t=r[9].before.toLocaleString()+"",n,o,l=r[9].after.toLocaleString()+"",i,s,a,u,f=Math.round(100*r[9].after/r[9].before)+"",c,_;return{c(){e=$("p"),n=N(t),o=N(" before, "),i=N(l),s=N(`
            after`),a=P(),u=$("p"),c=N(f),_=N("%")},m(d,m){L(d,e,m),p(e,n),p(e,o),p(e,i),p(e,s),L(d,a,m),L(d,u,m),p(u,c),p(u,_)},p(d,m){m&512&&t!==(t=d[9].before.toLocaleString()+"")&&fe(n,t),m&512&&l!==(l=d[9].after.toLocaleString()+"")&&fe(i,l),m&512&&f!==(f=Math.round(100*d[9].after/d[9].before)+"")&&fe(c,f)},d(d){d&&(M(e),M(a),M(u))}}}function A_(r){let e,t;return e=new zt({props:{openOn:"hover",$$slots:{default:[T_,({props:n})=>({9:n}),({props:n})=>n?512:0]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1536&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function E_(r){let e,t;const n=[Fe("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,ll,r[2].max_count,il],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[1][0],50,r[1][1],100,r[1][2],150,r[1][3],200,r[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let o={$$slots:{default:[A_]},$$scope:{ctx:r}};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),e.$on("click",r[4]),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s=i&6?Gt(n,[n[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,ll,l[2].max_count,il],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,l[1][0],50,l[1][1],100,l[1][2],150,l[1][3],200,l[1][4]]]}},n[2],n[3]]):{};i&1024&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function P_(r){let e,t,n,o,l;return t=new xe({props:{data:r[2],generateId:!0,$$slots:{default:[E_]},$$scope:{ctx:r}}}),o=new on({}),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),C(e,"slot","map")},m(i,s){L(i,e,s),A(t,e,null),p(e,n),A(o,e,null),l=!0},p(i,s){const a={};s&1024&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(k(t.$$.fragment,i),k(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&M(e),E(t),E(o)}}}function I_(r){let e,t;return e=new kt({props:{$$slots:{map:[P_],sidebar:[C_],top:[S_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1025&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}let ll=3,il=10;function F_(r,e,t){let n,o;Z(r,ee,_=>t(0,n=_)),Z(r,Ze,_=>t(8,o=_));let l=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],i=o.predictImpact();function s(_){K(ee,n={mode:"impact-detail",road:_},n)}return[n,l,i,s,_=>s(_.detail.features[0]),()=>K(ee,n={mode:"pick-neighbourhood"},n),()=>K(ee,n={mode:"title",firstLoad:!1},n),()=>K(ee,n={mode:"pick-neighbourhood"},n)]}class j_ extends le{constructor(e){super(),ie(this,e,F_,I_,oe,{})}}function B_(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function O_(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function sl(r){let e,t,n;return t=new he({props:{$$slots:{default:[R_]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=$("li"),T(t.$$.fragment)},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&16384&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function R_(r){let e;return{c(){e=N("Editing")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function N_(r){let e,t,n,o,l,i,s,a,u,f,c,_;l=new he({props:{$$slots:{default:[B_]},$$scope:{ctx:r}}}),l.$on("click",r[11]),a=new he({props:{$$slots:{default:[O_]},$$scope:{ctx:r}}}),a.$on("click",r[12]);let d=r[0]=="neighbourhood"&&sl(r);return{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),d&&d.c(),f=P(),c=$("li"),c.textContent="Routing",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(m,g){L(m,e,g),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),d&&d.m(n,null),p(n,f),p(n,c),_=!0},p(m,g){const b={};g&16384&&(b.$$scope={dirty:g,ctx:m}),l.$set(b);const w={};g&16384&&(w.$$scope={dirty:g,ctx:m}),a.$set(w),m[0]=="neighbourhood"?d?(d.p(m,g),g&1&&k(d,1)):(d=sl(m),d.c(),k(d,1),d.m(n,f)):d&&(ve(),S(d,1,1,()=>{d=null}),ke())},i(m){_||(k(l.$$.fragment,m),k(a.$$.fragment,m),k(d),_=!0)},o(m){S(l.$$.fragment,m),S(a.$$.fragment,m),S(d),_=!1},d(m){m&&M(e),E(l),E(a),d&&d.d()}}}function al(r){let e,t,n,o=xt(r[4].features[0].properties.distance)+"",l,i,s=en(r[4].features[0].properties.time)+"",a,u,f,c,_,d=xt(r[4].features[1].properties.distance)+"",m,g,b=en(r[4].features[1].properties.time)+"",w;return{c(){e=$("p"),t=$("span"),t.textContent="Route before",n=N(`
        : `),l=N(o),i=N(", "),a=N(s),u=P(),f=$("p"),c=$("span"),c.textContent="Route after",_=N(`
        : `),m=N(d),g=N(", "),w=N(b),_e(t,"color","red"),_e(c,"color","blue")},m(h,y){L(h,e,y),p(e,t),p(e,n),p(e,l),p(e,i),p(e,a),L(h,u,y),L(h,f,y),p(f,c),p(f,_),p(f,m),p(f,g),p(f,w)},p(h,y){y&16&&o!==(o=xt(h[4].features[0].properties.distance)+"")&&fe(l,o),y&16&&s!==(s=en(h[4].features[0].properties.time)+"")&&fe(a,s),y&16&&d!==(d=xt(h[4].features[1].properties.distance)+"")&&fe(m,d),y&16&&b!==(b=en(h[4].features[1].properties.time)+"")&&fe(w,b)},d(h){h&&(M(e),M(u),M(f))}}}function z_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b;t=new rn({}),t.$on("click",r[6]);let w=r[4].features.length==2&&al(r);return{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),o.textContent="Drag markers for a route",l=P(),w&&w.c(),i=P(),s=$("label"),a=N("Slow-down factor for main roads: "),u=N(r[1]),f=P(),c=$("input"),_=P(),d=$("i"),d.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,C(c,"type","range"),C(c,"min","1.0"),C(c,"max","5.0"),C(c,"step","0.1"),C(e,"slot","sidebar")},m(h,y){L(h,e,y),A(t,e,null),p(e,n),p(e,o),p(e,l),w&&w.m(e,null),p(e,i),p(e,s),p(s,a),p(s,u),p(s,f),p(s,c),Ye(c,r[1]),p(e,_),p(e,d),m=!0,g||(b=[V(c,"change",r[10]),V(c,"input",r[10])],g=!0)},p(h,y){h[4].features.length==2?w?w.p(h,y):(w=al(h),w.c(),w.m(e,i)):w&&(w.d(1),w=null),(!m||y&2)&&fe(u,h[1]),y&2&&Ye(c,h[1])},i(h){m||(k(t.$$.fragment,h),m=!0)},o(h){S(t.$$.fragment,h),m=!1},d(h){h&&M(e),E(t),w&&w.d(),g=!1,at(b)}}}function ul(r){let e,t;return e=new Wn({props:{$$slots:{default:[D_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function D_(r){let e,t,n,o,l,i,s,a;return e=new gr({}),n=new mr({}),l=new pr({}),s=new Jn({props:{interactive:!1}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),T(s.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),L(u,o,f),A(l,u,f),L(u,i,f),A(s,u,f),a=!0},p:Q,i(u){a||(k(e.$$.fragment,u),k(n.$$.fragment,u),k(l.$$.fragment,u),k(s.$$.fragment,u),a=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),S(l.$$.fragment,u),S(s.$$.fragment,u),a=!1},d(u){u&&(M(t),M(o),M(i)),E(e,u),E(n,u),E(l,u),E(s,u)}}}function U_(r){let e,t;const n=[Fe("compare-route"),{paint:{"line-width":10,"line-color":jn(["get","kind"],{before:"red",after:"blue"},"red")}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function H_(r){let e;return{c(){e=N("A")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function G_(r){let e;return{c(){e=N("B")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function J_(r){let e,t,n,o,l,i,s,a,u,f,c,_,d=r[0]=="neighbourhood"&&ul(r);n=new on({}),l=new xe({props:{data:r[4],$$slots:{default:[U_]},$$scope:{ctx:r}}});function m(h){r[8](h)}let g={draggable:!0,$$slots:{default:[H_]},$$scope:{ctx:r}};r[3]!==void 0&&(g.lngLat=r[3]),s=new un({props:g}),Ne.push(()=>ft(s,"lngLat",m));function b(h){r[9](h)}let w={draggable:!0,$$slots:{default:[G_]},$$scope:{ctx:r}};return r[2]!==void 0&&(w.lngLat=r[2]),f=new un({props:w}),Ne.push(()=>ft(f,"lngLat",b)),{c(){e=$("div"),d&&d.c(),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),T(s.$$.fragment),u=P(),T(f.$$.fragment),C(e,"slot","map")},m(h,y){L(h,e,y),d&&d.m(e,null),p(e,t),A(n,e,null),p(e,o),A(l,e,null),p(e,i),A(s,e,null),p(e,u),A(f,e,null),_=!0},p(h,y){h[0]=="neighbourhood"?d?y&1&&k(d,1):(d=ul(h),d.c(),k(d,1),d.m(e,t)):d&&(ve(),S(d,1,1,()=>{d=null}),ke());const v={};y&16&&(v.data=h[4]),y&16384&&(v.$$scope={dirty:y,ctx:h}),l.$set(v);const I={};y&16384&&(I.$$scope={dirty:y,ctx:h}),!a&&y&8&&(a=!0,I.lngLat=h[3],ct(()=>a=!1)),s.$set(I);const O={};y&16384&&(O.$$scope={dirty:y,ctx:h}),!c&&y&4&&(c=!0,O.lngLat=h[2],ct(()=>c=!1)),f.$set(O)},i(h){_||(k(d),k(n.$$.fragment,h),k(l.$$.fragment,h),k(s.$$.fragment,h),k(f.$$.fragment,h),_=!0)},o(h){S(d),S(n.$$.fragment,h),S(l.$$.fragment,h),S(s.$$.fragment,h),S(f.$$.fragment,h),_=!1},d(h){h&&M(e),d&&d.d(),E(n),E(l),E(s),E(f)}}}function W_(r){let e,t;return e=new kt({props:{$$slots:{map:[J_],sidebar:[z_],top:[N_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&16447&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function q_(r,e,t){let n,o,l,i,s,a;Z(r,ee,w=>t(5,o=w)),Z(r,ao,w=>t(1,l=w)),Z(r,On,w=>t(2,i=w)),Z(r,Rn,w=>t(3,s=w)),Z(r,Ze,w=>t(7,a=w));let{prevMode:u}=e;function f(){K(ee,o={mode:u},o)}function c(w){s=w,Rn.set(s)}function _(w){i=w,On.set(i)}function d(){l=Yr(this.value),ao.set(l)}const m=()=>K(ee,o={mode:"title",firstLoad:!1},o),g=()=>K(ee,o={mode:"pick-neighbourhood"},o),b=()=>K(ee,o={mode:"neighbourhood"},o);return r.$$set=w=>{"prevMode"in w&&t(0,u=w.prevMode)},r.$$.update=()=>{r.$$.dirty&142&&t(4,n=a.compareRoute(s,i,l))},[u,l,i,s,n,o,f,a,c,_,d,m,g,b]}class Z_ extends le{constructor(e){super(),ie(this,e,q_,W_,oe,{prevMode:0})}}let bn=vt(null);const At=vt([]);function hi(r){if(r.length<3)return JSON.parse(pt(bn).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(pt(bn).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:X_}=Dl,Y_=r=>({}),fl=r=>({}),K_=r=>({}),cl=r=>({});function dl(r,e,t){const n=r.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function _l(r,e,t){const n=r.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function V_(r){let e,t;const n=r[24]["extra-top"],o=He(n,r,r[38],fl);return{c(){e=$("div"),o&&o.c(),C(e,"slot","top")},m(l,i){L(l,e,i),o&&o.m(e,null),t=!0},p(l,i){o&&o.p&&(!t||i[1]&128)&&Ge(o,n,l,l[38],t?We(n,l[38],i,Y_):Je(l[38]),fl)},i(l){t||(k(o,l),t=!0)},o(l){S(o,l),t=!1},d(l){l&&M(e),o&&o.d(l)}}}function Q_(r){let e,t,n,o,l;return{c(){e=$("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=P(),n=$("p"),n.textContent="Keyboard shortcuts:",o=P(),l=$("ul"),l.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(i,s){L(i,e,s),L(i,t,s),L(i,n,s),L(i,o,s),L(i,l,s)},p:Q,d(i){i&&(M(e),M(t),M(n),M(o),M(l))}}}function x_(r){let e,t=r[8].length+"",n,o;return{c(){e=N("Undo ("),n=N(t),o=N(")")},m(l,i){L(l,e,i),L(l,n,i),L(l,o,i)},p(l,i){i[0]&256&&t!==(t=l[8].length+"")&&fe(n,t)},d(l){l&&(M(e),M(n),M(o))}}}function em(r){let e;return{c(){e=N("Undo")},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function tm(r){let e;return{c(){e=$("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function nm(r){let e,t,n,o,l,i,s,a,u,f,c,_,d;return c=Ul(r[36][0]),{c(){e=$("fieldset"),t=$("label"),n=$("input"),o=N(`
          Snap to roads`),l=P(),i=$("label"),s=$("input"),a=N(`
          Draw anywhere`),u=P(),f=$("p"),f.textContent="Click to add at least 3 points",C(n,"type","radio"),n.__value="snap",Ye(n,n.__value),C(s,"type","radio"),s.__value="free",Ye(s,s.__value),c.p(n,s)},m(m,g){L(m,e,g),p(e,t),p(t,n),n.checked=n.__value===r[7],p(t,o),p(e,l),p(e,i),p(i,s),s.checked=s.__value===r[7],p(i,a),L(m,u,g),L(m,f,g),_||(d=[V(n,"change",r[35]),V(s,"change",r[37])],_=!0)},p(m,g){g[0]&128&&(n.checked=n.__value===m[7]),g[0]&128&&(s.checked=s.__value===m[7])},d(m){m&&(M(e),M(u),M(f)),c.r(),_=!1,at(d)}}}function rm(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m,g,b,w;const h=r[24]["extra-sidebar"],y=He(h,r,r[38],cl);f=new ro({props:{$$slots:{default:[Q_]},$$scope:{ctx:r}}});function v(D,R){return D[8].length==0?em:x_}let I=v(r),O=I(r);function F(D,R){return D[5].length<3?nm:tm}let B=F(r),z=B(r);return{c(){e=$("div"),y&&y.c(),t=P(),n=$("div"),o=$("button"),l=N("Finish"),s=P(),a=$("button"),a.textContent="Cancel",u=P(),T(f.$$.fragment),c=P(),_=$("button"),O.c(),m=P(),z.c(),o.disabled=i=r[5].length<3,C(a,"class","secondary"),_e(n,"display","flex"),C(_,"class","secondary"),_.disabled=d=r[8].length==0,C(e,"slot","sidebar")},m(D,R){L(D,e,R),y&&y.m(e,null),p(e,t),p(e,n),p(n,o),p(o,l),p(n,s),p(n,a),p(n,u),A(f,n,null),p(e,c),p(e,_),O.m(_,null),p(e,m),z.m(e,null),g=!0,b||(w=[V(o,"click",function(){Tr(r[0])&&r[0].apply(this,arguments)}),V(a,"click",function(){Tr(r[1])&&r[1].apply(this,arguments)}),V(_,"click",r[11])],b=!0)},p(D,R){r=D,y&&y.p&&(!g||R[1]&128)&&Ge(y,h,r,r[38],g?We(h,r[38],R,K_):Je(r[38]),cl),(!g||R[0]&32&&i!==(i=r[5].length<3))&&(o.disabled=i);const j={};R[1]&128&&(j.$$scope={dirty:R,ctx:r}),f.$set(j),I===(I=v(r))&&O?O.p(r,R):(O.d(1),O=I(r),O&&(O.c(),O.m(_,null))),(!g||R[0]&256&&d!==(d=r[8].length==0))&&(_.disabled=d),B===(B=F(r))&&z?z.p(r,R):(z.d(1),z=B(r),z&&(z.c(),z.m(e,null)))},i(D){g||(k(y,D),k(f.$$.fragment,D),g=!0)},o(D){S(y,D),S(f.$$.fragment,D),g=!1},d(D){D&&M(e),y&&y.d(D),E(f),O.d(),z.d(),b=!1,at(w)}}}function om(r){let e;return{c(){e=$("span"),C(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped-node",r[47].snapped),gt(e,"free-node",!r[47].snapped),gt(e,"hide",r[4])},m(t,n){L(t,e,n)},p(t,n){n[0]&512&&gt(e,"snapped-node",t[47].snapped),n[0]&512&&gt(e,"free-node",!t[47].snapped),n[0]&16&&gt(e,"hide",t[4])},d(t){t&&M(e)}}}function ml(r){let e,t,n;function o(u){r[25](u,r[47])}function l(){return r[26](r[47])}function i(){return r[27](r[47])}function s(){return r[28](r[47])}let a={draggable:!0,zIndex:0,$$slots:{default:[om]},$$scope:{ctx:r}};return r[47].point!==void 0&&(a.lngLat=r[47].point),e=new dr({props:a}),Ne.push(()=>ft(e,"lngLat",o)),e.$on("dragstart",l),e.$on("drag",i),e.$on("dragend",r[19]),e.$on("click",s),{c(){T(e.$$.fragment)},m(u,f){A(e,u,f),n=!0},p(u,f){r=u;const c={};f[0]&528|f[1]&128&&(c.$$scope={dirty:f,ctx:r}),!t&&f[0]&512&&(t=!0,c.lngLat=r[47].point,ct(()=>t=!1)),e.$set(c)},i(u){n||(k(e.$$.fragment,u),n=!0)},o(u){S(e.$$.fragment,u),n=!1},d(u){E(e,u)}}}function lm(r){let e;return{c(){e=$("span"),e.textContent=`${r[46]+1}`,C(e,"class","dot svelte-1cj4rwq"),gt(e,"snapped",r[44].snapped)},m(t,n){L(t,e,n)},p(t,n){n[0]&32&&gt(e,"snapped",t[44].snapped)},d(t){t&&M(e)}}}function gl(r){let e,t,n;function o(a){r[29](a,r[44])}function l(){return r[30](r[46])}function i(){return r[31](r[46])}let s={draggable:!0,zIndex:1,$$slots:{default:[lm]},$$scope:{ctx:r}};return r[44].point!==void 0&&(s.lngLat=r[44].point),e=new dr({props:s}),Ne.push(()=>ft(e,"lngLat",o)),e.$on("click",l),e.$on("contextmenu",i),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){T(e.$$.fragment)},m(a,u){A(e,a,u),n=!0},p(a,u){r=a;const f={};u[0]&32|u[1]&128&&(f.$$scope={dirty:u,ctx:r}),!t&&u[0]&32&&(t=!0,f.lngLat=r[44].point,ct(()=>t=!1)),e.$set(f)},i(a){n||(k(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){E(e,a)}}}function im(r){let e,t,n,o;const l=[Fe("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let i={};for(let u=0;u<l.length;u+=1)i=Ie(i,l[u]);e=new dt({props:i});const s=[Fe("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let a={};for(let u=0;u<s.length;u+=1)a=Ie(a,s[u]);return n=new jt({props:a}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),o=!0},p(u,f){const c={};e.$set(c);const _={};n.$set(_)},i(u){o||(k(e.$$.fragment,u),k(n.$$.fragment,u),o=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),o=!1},d(u){u&&M(t),E(e,u),E(n,u)}}}function sm(r){let e,t;return e=new dt({props:{paint:{"line-color":"black","line-width":3}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function am(r){let e,t,n,o,l,i,s,a,u;t=new ai({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let f=qe(r[9]),c=[];for(let b=0;b<f.length;b+=1)c[b]=ml(_l(r,f,b));const _=b=>S(c[b],1,1,()=>{c[b]=null});let d=qe(r[5]),m=[];for(let b=0;b<d.length;b+=1)m[b]=gl(dl(r,d,b));const g=b=>S(m[b],1,1,()=>{m[b]=null});return i=new xe({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[im]},$$scope:{ctx:r}}}),a=new xe({props:{data:r[10],$$slots:{default:[sm]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=P();for(let b=0;b<c.length;b+=1)c[b].c();o=P();for(let b=0;b<m.length;b+=1)m[b].c();l=P(),T(i.$$.fragment),s=P(),T(a.$$.fragment),C(e,"slot","map")},m(b,w){L(b,e,w),A(t,e,null),p(e,n);for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(e,null);p(e,o);for(let h=0;h<m.length;h+=1)m[h]&&m[h].m(e,null);p(e,l),A(i,e,null),p(e,s),A(a,e,null),u=!0},p(b,w){if(w[0]&918032){f=qe(b[9]);let v;for(v=0;v<f.length;v+=1){const I=_l(b,f,v);c[v]?(c[v].p(I,w),k(c[v],1)):(c[v]=ml(I),c[v].c(),k(c[v],1),c[v].m(e,o))}for(ve(),v=f.length;v<c.length;v+=1)_(v);ke()}if(w[0]&2146348){d=qe(b[5]);let v;for(v=0;v<d.length;v+=1){const I=dl(b,d,v);m[v]?(m[v].p(I,w),k(m[v],1)):(m[v]=gl(I),m[v].c(),k(m[v],1),m[v].m(e,l))}for(ve(),v=d.length;v<m.length;v+=1)g(v);ke()}const h={};w[0]&96&&(h.data=b[16](b[6],b[5])),w[1]&128&&(h.$$scope={dirty:w,ctx:b}),i.$set(h);const y={};w[0]&1024&&(y.data=b[10]),w[1]&128&&(y.$$scope={dirty:w,ctx:b}),a.$set(y)},i(b){if(!u){k(t.$$.fragment,b);for(let w=0;w<f.length;w+=1)k(c[w]);for(let w=0;w<d.length;w+=1)k(m[w]);k(i.$$.fragment,b),k(a.$$.fragment,b),u=!0}},o(b){S(t.$$.fragment,b),c=c.filter(Boolean);for(let w=0;w<c.length;w+=1)S(c[w]);m=m.filter(Boolean);for(let w=0;w<m.length;w+=1)S(m[w]);S(i.$$.fragment,b),S(a.$$.fragment,b),u=!1},d(b){b&&M(e),E(t),Nt(c,b),Nt(m,b),E(i),E(a)}}}function um(r){let e,t,n,o;return e=new kt({props:{$$slots:{map:[am],sidebar:[rm],top:[V_]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0,n||(o=V(X_,"keydown",r[20]),n=!0)},p(l,i){const s={};i[0]&2047|i[1]&128&&(s.$$scope={dirty:i,ctx:l}),e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l),n=!1,o()}}}function fm(r,e,t){let n,o,l;Z(r,At,x=>t(5,o=x)),Z(r,bn,x=>t(6,l=x));let{$$slots:i={},$$scope:s}=e,{map:a}=e,{finish:u}=e,{cancel:f}=e;Ft(()=>{K(At,o=[],o),l==null||l.stop(),a.getCanvas().style.cursor="inherit"});let c="snap",_=[],d=[],m=null,g=!1,b=!1,w=!1;function h(x){let ce=x.length==0?"crosshair":"inherit";a.getCanvas().style.cursor=ce}function y(){let x=_.pop();t(8,_),x&&K(At,o=x,o)}function v(){_.length==100&&_.shift(),t(8,_=[..._,JSON.parse(JSON.stringify(o))])}function I(){t(7,c=c=="snap"?"free":"snap"),m&&t(23,m.snapped=c=="snap",m)}function O(x){o.length>=3||(v(),At.update(ce=>(ce.push({point:x.detail.lngLat.toArray(),snapped:c=="snap"}),ce)))}function F(x){t(23,m={point:x.detail.lngLat.toArray(),snapped:c=="snap"})}function B(x){v(),At.update(ce=>(ce[x].snapped=!ce[x].snapped,ce))}function z(x){v(),At.update(ce=>(ce.splice(x,1),ce)),t(2,g=!1)}function D(x,ce){try{if(x)return hi(ce)}catch{}return Yt()}function R(x,ce,q,ye){if(ye||ce.length>=3)return Yt();try{if(x&&ce.length>0&&q)return JSON.parse(x.inner.calculateRoute([ce[ce.length-1],q]))}catch{}return Yt()}function j(x,ce,q){if(q)return;if(!x||ce.length<3){t(9,d=[]);return}let ye=[],de=1,me=JSON.parse(JSON.stringify(ce));me.push(me[0]);for(let U=0;U<me.length-1;U++){let tt=JSON.parse(x.inner.getExtraNodes(me[U],me[U+1]));for(let[je,Be,ht]of tt)ye.push({point:[je,Be],snapped:ht,insertIdx:de});de++}t(9,d=ye)}function te(x){v(),At.update(ce=>(ce.splice(x.insertIdx,0,{point:x.point,snapped:x.snapped}),ce)),t(4,w=!0)}function W(x){At.update(ce=>(ce[x.insertIdx].point=x.point,ce))}function X(){t(4,w=!1)}function se(x){let ce=x.target.tagName,q=ce=="INPUT"||ce=="TEXTAREA";x.key=="Enter"&&!q||x.key=="Escape"?(x.stopPropagation(),o.length>=3?u():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):x.key=="s"&&!q?I():x.key=="z"&&x.ctrlKey&&(x.stopPropagation(),y())}function Le(){v(),t(3,b=!0)}const J=[[]];function Ce(x,ce){r.$$.not_equal(ce.point,x)&&(ce.point=x,t(9,d))}const Me=x=>te(x),be=x=>W(x),ae=x=>{te(x),t(4,w=!1)};function Re(x,ce){r.$$.not_equal(ce.point,x)&&(ce.point=x,At.set(o))}const ue=x=>B(x),pe=x=>z(x),$e=()=>t(2,g=!0),ne=()=>t(2,g=!1),we=()=>t(3,b=!1);function lt(){c=this.__value,t(7,c)}function Ct(){c=this.__value,t(7,c)}return r.$$set=x=>{"map"in x&&t(22,a=x.map),"finish"in x&&t(0,u=x.finish),"cancel"in x&&t(1,f=x.cancel),"$$scope"in x&&t(38,s=x.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&j(l,o,w),r.$$.dirty[0]&8388716&&t(10,n=R(l,o,m,g||b)),r.$$.dirty[0]&32&&h(o)},[u,f,g,b,w,o,l,c,_,d,n,y,O,F,B,z,D,te,W,X,se,Le,a,m,i,Ce,Me,be,ae,Re,ue,pe,$e,ne,we,lt,J,Ct,s]}class cm extends le{constructor(e){super(),ie(this,e,fm,um,oe,{map:22,finish:0,cancel:1},null,[-1,-1])}}function dm(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function _m(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function mm(r){let e;return{c(){e=$("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){L(t,e,n)},p:Q,i:Q,o:Q,d(t){t&&M(e)}}}function gm(r){let e,t,n,o,l;return t=new he({props:{$$slots:{default:[pm]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=$("li"),T(t.$$.fragment),n=P(),o=$("li"),o.textContent="Changing neighbourhood boundary"},m(i,s){L(i,e,s),A(t,e,null),L(i,n,s),L(i,o,s),l=!0},p(i,s){const a={};s&4096&&(a.$$scope={dirty:s,ctx:i}),t.$set(a)},i(i){l||(k(t.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),l=!1},d(i){i&&(M(e),M(n),M(o)),E(t)}}}function pm(r){let e;return{c(){e=N("Editing")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function hm(r){let e,t,n,o,l,i,s,a,u,f,c,_;l=new he({props:{$$slots:{default:[dm]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new he({props:{$$slots:{default:[_m]},$$scope:{ctx:r}}}),a.$on("click",r[7]);const d=[gm,mm],m=[];function g(b,w){return b[1]?0:1}return f=g(r),c=m[f]=d[f](r),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),c.c(),C(t,"aria-label","breadcrumb"),C(e,"slot","extra-top")},m(b,w){L(b,e,w),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),m[f].m(n,null),_=!0},p(b,w){const h={};w&4096&&(h.$$scope={dirty:w,ctx:b}),l.$set(h);const y={};w&4096&&(y.$$scope={dirty:w,ctx:b}),a.$set(y);let v=f;f=g(b),f===v?m[f].p(b,w):(ve(),S(m[v],1,1,()=>{m[v]=null}),ke(),c=m[f],c?c.p(b,w):(c=m[f]=d[f](b),c.c()),k(c,1),c.m(n,null))},i(b){_||(k(l.$$.fragment,b),k(a.$$.fragment,b),k(c),_=!0)},o(b){S(l.$$.fragment,b),S(a.$$.fragment,b),S(c),_=!1},d(b){b&&M(e),E(l),E(a),m[f].d()}}}function bm(r){let e,t,n,o;return{c(){e=$("div"),t=$("h1"),n=N("Draw your neighbourhood boundary for "),o=N(r[0]),C(e,"slot","extra-sidebar")},m(l,i){L(l,e,i),p(e,t),p(t,n),p(t,o)},p(l,i){i&1&&fe(o,l[0])},d(l){l&&M(e)}}}function ym(r){let e,t;return e=new cm({props:{map:st(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[bm],"extra-top":[hm]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&8&&(l.map=st(n[3])),o&4103&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function wm(r,e,t){let n,o,l,i,s;Z(r,ee,g=>t(2,n=g)),Z(r,Bn,g=>t(9,o=g)),Z(r,Ze,g=>t(10,l=g)),Z(r,At,g=>t(11,i=g)),Z(r,Ht,g=>t(3,s=g));let{name:a}=e,{existing:u}=e;u&&(u.properties.waypoints?K(At,i=u.properties.waypoints.map(g=>({point:[g.lon,g.lat],snapped:g.snapped})),i):K(At,i=u.geometry.coordinates[0].slice(1).map(g=>({point:g,snapped:!1})),i));function f(){if(i.length>=3)try{let g=hi(i);l.setNeighbourhoodBoundary(a,g),pn(),l.setCurrentNeighbourhood(a,o),K(ee,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),c()}}function c(){u?K(ee,n={mode:"neighbourhood"},n):K(ee,n={mode:"pick-neighbourhood"},n)}const _=()=>K(ee,n={mode:"title",firstLoad:!1},n),d=()=>K(ee,n={mode:"pick-neighbourhood"},n),m=()=>K(ee,n={mode:"neighbourhood"},n);return r.$$set=g=>{"name"in g&&t(0,a=g.name),"existing"in g&&t(1,u=g.existing)},[a,u,n,s,f,c,_,d,m]}class vm extends le{constructor(e){super(),ie(this,e,wm,ym,oe,{name:0,existing:1})}}const km="/ltn/assets/settings-342fb430.svg";function pl(r){let e,t;return e=new fr({props:{$$slots:{default:[$m]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&67&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function $m(r){let e,t,n,o,l,i,s,a,u,f,c,_,d;return n=new Fu({}),{c(){e=$("h1"),e.textContent="Settings",t=P(),T(n.$$.fragment),o=P(),l=$("label"),i=$("input"),s=N(`
      Road thickness depends on shortcuts`),a=P(),u=$("center"),f=$("button"),f.textContent="Confirm",C(i,"type","checkbox")},m(m,g){L(m,e,g),L(m,t,g),A(n,m,g),L(m,o,g),L(m,l,g),p(l,i),i.checked=r[1],p(l,s),L(m,a,g),L(m,u,g),p(u,f),c=!0,_||(d=[V(i,"change",r[3]),V(f,"click",r[4])],_=!0)},p(m,g){g&2&&(i.checked=m[1])},i(m){c||(k(n.$$.fragment,m),c=!0)},o(m){S(n.$$.fragment,m),c=!1},d(m){m&&(M(e),M(t),M(o),M(l),M(a),M(u)),E(n,m),_=!1,at(d)}}}function Lm(r){let e,t,n,o,l,i,s=r[0]&&pl(r);return{c(){e=$("button"),e.innerHTML=`<img src="${km}" alt="Settings"/>`,t=P(),s&&s.c(),n=et(),C(e,"class","outline")},m(a,u){L(a,e,u),L(a,t,u),s&&s.m(a,u),L(a,n,u),o=!0,l||(i=V(e,"click",r[2]),l=!0)},p(a,[u]){a[0]?s?(s.p(a,u),u&1&&k(s,1)):(s=pl(a),s.c(),k(s,1),s.m(n.parentNode,n)):s&&(ve(),S(s,1,1,()=>{s=null}),ke())},i(a){o||(k(s),o=!0)},o(a){S(s),o=!1},d(a){a&&(M(e),M(t),M(n)),s&&s.d(a),l=!1,i()}}}function Mm(r,e,t){let n;Z(r,Er,u=>t(1,n=u));let o=!1;const l=()=>t(0,o=!0);function i(){n=this.checked,Er.set(n)}return[o,n,l,i,()=>t(0,o=!1),()=>t(0,o=!1)]}class Sm extends le{constructor(e){super(),ie(this,e,Mm,Lm,oe,{})}}const Cm=["==",["geometry-type"],"Polygon"],Tm=["==",["geometry-type"],"LineString"],Am=["==",["geometry-type"],"Point"];function bi(){return{type:"FeatureCollection",features:[]}}function Sr(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:yi(r)}}}function yi(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const wi=vt(bi()),vi=vt(0),Em=100;class Pm{constructor(e){rt(this,"map");rt(this,"active");rt(this,"eventListenersSuccess");rt(this,"eventListenersUpdated");rt(this,"eventListenersFailure");rt(this,"points");rt(this,"cursor");rt(this,"hover");rt(this,"dragFrom");rt(this,"previousStates");rt(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let o of this.points)o[0]-=t,o[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});rt(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(hl(this.points).forEach((n,o)=>{t.push([o+1,ua(n,this.cursor).properties.dist])}),t.sort((n,o)=>n[1]-o[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});rt(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Sr(e.lngLat.toArray()),this.onClick(e),this.finish())});rt(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});rt(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});rt(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});rt(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=bi();this.points.forEach((o,l)=>{let i=Sr(o);i.properties.hover=this.hover==l,i.properties.idx=l,e.features.push(i)}),e.features=e.features.concat(hl(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),wi.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,vi.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Sr(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(yi),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Em&&this.previousStates.shift()}}function hl(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Im(r){let e,t,n;return{c(){e=N("Undo ("),t=N(r[1]),n=N(")")},m(o,l){L(o,e,l),L(o,t,l),L(o,n,l)},p(o,l){l&2&&fe(t,o[1])},d(o){o&&(M(e),M(t),M(n))}}}function Fm(r){let e;return{c(){e=N("Undo")},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function jm(r){let e,t,n,o,l,i,s,a,u,f,c;function _(g,b){return g[1]==0?Fm:Im}let d=_(r),m=d(r);return{c(){e=$("div"),t=$("button"),t.textContent="Finish",n=P(),o=$("button"),o.textContent="Cancel",l=P(),i=$("button"),m.c(),a=P(),u=$("ul"),u.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,i.disabled=s=r[1]==0,_e(e,"display","flex"),_e(e,"justify-content","space-between")},m(g,b){L(g,e,b),p(e,t),p(e,n),p(e,o),p(e,l),p(e,i),m.m(i,null),L(g,a,b),L(g,u,b),f||(c=[V(t,"click",r[2]),V(o,"click",r[3]),V(i,"click",r[4])],f=!0)},p(g,[b]){d===(d=_(g))&&m?m.p(g,b):(m.d(1),m=d(g),m&&(m.c(),m.m(i,null))),b&2&&s!==(s=g[1]==0)&&(i.disabled=s)},i:Q,o:Q,d(g){g&&(M(e),M(a),M(u)),m.d(),f=!1,at(c)}}}function Bm(r,e,t){let n;Z(r,vi,a=>t(1,n=a));let{polygonTool:o}=e;const l=()=>o.finish(),i=()=>o.cancel(),s=()=>o.undo();return r.$$set=a=>{"polygonTool"in a&&t(0,o=a.polygonTool)},[o,n,l,i,s]}class Om extends le{constructor(e){super(),ie(this,e,Bm,jm,oe,{polygonTool:0})}}let Rm=Date.now();function qn(r){return`${r}-${Rm++}`}const ki=Symbol.for("svelte-maplibre");function Nm(){return Kr(ki)}function bl(r){return{subscribe:r.subscribe}}function $i({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let o=Nm(),l=vt(null),i=bl(l),s={...o,[r]:bl(l)};if(e&&(s.popupTarget=i),n){let a=vt(null);s.layerEvent=a,o.layerEvent=a}return t&&(s.cluster=vt()),Hl(ki,s),{...o,self:l}}function zm(){return $i({key:"source",setCluster:!0})}function Dm(r=!0){return $i({key:"layer",setPopupTarget:r,setMouseEvent:r})}function yl(r){let e;return t=>{if(t)for(let n in t){let o=e==null?void 0:e[n],l=t[n];o!==l&&r(n,l,o)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function Um(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Hm(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function wl(r){let e=r[0],t,n,o=vl(r);return{c(){o.c(),t=et()},m(l,i){o.m(l,i),L(l,t,i),n=!0},p(l,i){i[0]&1&&oe(e,e=l[0])?(ve(),S(o,1,1,Q),ke(),o=vl(l),o.c(),k(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(k(o),n=!0)},o(l){S(o),n=!1},d(l){l&&M(t),o.d(l)}}}function vl(r){let e;const t=r[36].default,n=He(t,r,r[35],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[1]&16)&&Ge(n,t,o,o[35],e?We(t,o[35],l,null):Je(o[35]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Gm(r){let e,t,n=r[0]&&wl(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,l){o[0]?n?(n.p(o,l),l[0]&1&&k(n,1)):(n=wl(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function Jm(r,e,t){let n,o,l,i,s,a,u,f,c,_,d,m,{$$slots:g={},$$scope:b}=e,{id:w=qn("layer")}=e,{source:h=void 0}=e,{sourceLayer:y=void 0}=e,{beforeId:v=void 0}=e,{beforeLayerType:I=void 0}=e,{type:O}=e,{paint:F=void 0}=e,{layout:B=void 0}=e,{filter:z=void 0}=e,{applyToClusters:D=void 0}=e,{minzoom:R=void 0}=e,{maxzoom:j=void 0}=e,{manageHoverState:te=!1}=e,{hovered:W=null}=e,{interactive:X=!0}=e,{hoverCursor:se=void 0}=e,{eventsIfTopMost:Le=!1}=e;const J=nn(),{map:Ce,source:Me,self:be,minzoom:ae,maxzoom:Re,eventTopMost:ue,layerInfo:pe}=Dm();Z(r,Ce,q=>t(31,c=q)),Z(r,Me,q=>t(32,_=q)),Z(r,be,q=>t(0,f=q)),Z(r,ae,q=>t(34,m=q)),Z(r,Re,q=>t(33,d=q)),Ft(()=>{f&&c&&(pe.delete(f),c==null||c.removeLayer(f))});let $e;function ne(q){var U,tt;if(!X||!f||!c||Le&&ue(q)!==f)return;let ye=q.features??[],de=(tt=(U=ye[0])==null?void 0:U.properties)==null?void 0:tt.cluster_id,me={event:q,map:c,clusterId:de,layer:f,source:s,features:ye};J(q.type,me)}function we(q){var U,tt;if(!X||!f||!c||Le&&ue(q)!==f)return;se&&(c.getCanvas().style.cursor=se);let ye=q.features??[];t(6,W=ye[0]??null);let de=(tt=(U=ye[0])==null?void 0:U.properties)==null?void 0:tt.cluster_id;J("mouseenter",{event:q,map:c,clusterId:de,layer:f,source:s,features:ye})}function lt(q){var U,tt,je;if(!X||!c)return;if(Le&&ue(q)!==f){t(6,W=null),te&&$e!==void 0&&(c==null||c.setFeatureState({source:s,sourceLayer:y,id:$e},{hover:!1}),$e=void 0);return}c.getCanvas().style.cursor=se;let ye=q.features??[],de=(tt=(U=ye[0])==null?void 0:U.properties)==null?void 0:tt.cluster_id,me=(je=ye[0])==null?void 0:je.id;me!==$e&&(te&&($e!==void 0&&(c==null||c.setFeatureState({source:s,id:$e,sourceLayer:y},{hover:!1})),c==null||c.setFeatureState({source:s,id:me,sourceLayer:y},{hover:!0})),$e=me,t(6,W=ye[0]??null)),J("mousemove",{event:q,map:c,clusterId:de,layer:f,source:s,features:ye})}function Ct(q){if(!(!X||!f||!c)){if(se&&(c.getCanvas().style.cursor=""),t(6,W=null),te&&$e!==void 0){const ye={source:s,id:$e,sourceLayer:y};c==null||c.setFeatureState(ye,{hover:!1}),$e=void 0}J("mouseleave",{map:c,layer:f,source:s})}}let x=!0;function ce(q){c&&(c.off("click",q,ne),c.off("dblclick",q,ne),c.off("contextmenu",q,ne),c.off("mouseenter",q,we),c.off("mousemove",q,lt),c.off("mouseleave",q,Ct))}return Ft(()=>{c&&f&&ce(f)}),r.$$set=q=>{"id"in q&&t(7,w=q.id),"source"in q&&t(8,h=q.source),"sourceLayer"in q&&t(9,y=q.sourceLayer),"beforeId"in q&&t(10,v=q.beforeId),"beforeLayerType"in q&&t(11,I=q.beforeLayerType),"type"in q&&t(12,O=q.type),"paint"in q&&t(13,F=q.paint),"layout"in q&&t(14,B=q.layout),"filter"in q&&t(15,z=q.filter),"applyToClusters"in q&&t(16,D=q.applyToClusters),"minzoom"in q&&t(17,R=q.minzoom),"maxzoom"in q&&t(18,j=q.maxzoom),"manageHoverState"in q&&t(19,te=q.manageHoverState),"hovered"in q&&t(6,W=q.hovered),"interactive"in q&&t(20,X=q.interactive),"hoverCursor"in q&&t(21,se=q.hoverCursor),"eventsIfTopMost"in q&&t(22,Le=q.eventsIfTopMost),"$$scope"in q&&t(35,b=q.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=Hm(D)),r.$$.dirty[0]&1073774592&&t(24,o=Um("all",n,z)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,l=R??m),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,i=j??d),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=h||_),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&c&&f!==w&&s){f&&(ce(f),pe.delete(f));let q=v;if(!v&&I){let ye=c.getStyle().layers,de=typeof I=="function"?I:U=>U.type===I,me=ye==null?void 0:ye.find(de);me&&(q=me.id)}K(be,f=w,f),c.addLayer(Fr({id:f,type:O,source:s,"source-layer":y,filter:o,paint:F,layout:B,minzoom:l,maxzoom:i}),q),t(23,x=!0),c.on("click",f,ne),c.on("dblclick",f,ne),c.on("contextmenu",f,ne),c.on("mouseenter",f,we),c.on("mousemove",f,lt),c.on("mouseleave",f,Ct)}r.$$.dirty[0]&1048577&&f&&pe.set(f,{interactive:X}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,a=f?yl((q,ye)=>c==null?void 0:c.setPaintProperty(f,q,ye)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,u=f?yl((q,ye)=>c==null?void 0:c.setLayoutProperty(f,q,ye)):void 0),r.$$.dirty[0]&268443648&&(a==null||a(F)),r.$$.dirty[0]&134234112&&(u==null||u(B)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&f&&(c==null||c.setLayerZoomRange(f,l,i)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&f&&(x?t(23,x=!1):c==null||c.setFilter(f,o))},[f,Ce,Me,be,ae,Re,W,w,h,y,v,I,O,F,B,z,D,R,j,te,X,se,Le,x,o,i,l,u,a,s,n,c,_,d,m,b,g]}class oo extends le{constructor(e){super(),ie(this,e,Jm,Gm,oe,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function Wm(r){let e;const t=r[16].default,n=He(t,r,r[24],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&Ge(n,t,o,o[24],e?We(t,o[24],l,null):Je(o[24]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function qm(r){let e,t,n;function o(i){r[17](i)}let l={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Wm]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new oo({props:l}),Ne.push(()=>ft(e,"hovered",o)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],ct(()=>t=!1)),e.$set(a)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){E(e,i)}}}function Zm(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=qn("circle")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:b=void 0}=e,{manageHoverState:w=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:y=!1}=e,{interactive:v=!0}=e;function I(j){h=j,t(0,h)}function O(j){Pe.call(this,r,j)}function F(j){Pe.call(this,r,j)}function B(j){Pe.call(this,r,j)}function z(j){Pe.call(this,r,j)}function D(j){Pe.call(this,r,j)}function R(j){Pe.call(this,r,j)}return r.$$set=j=>{"id"in j&&t(1,l=j.id),"source"in j&&t(2,i=j.source),"sourceLayer"in j&&t(3,s=j.sourceLayer),"beforeId"in j&&t(4,a=j.beforeId),"beforeLayerType"in j&&t(5,u=j.beforeLayerType),"paint"in j&&t(6,f=j.paint),"layout"in j&&t(7,c=j.layout),"filter"in j&&t(8,_=j.filter),"applyToClusters"in j&&t(9,d=j.applyToClusters),"minzoom"in j&&t(10,m=j.minzoom),"maxzoom"in j&&t(11,g=j.maxzoom),"hoverCursor"in j&&t(12,b=j.hoverCursor),"manageHoverState"in j&&t(13,w=j.manageHoverState),"hovered"in j&&t(0,h=j.hovered),"eventsIfTopMost"in j&&t(14,y=j.eventsIfTopMost),"interactive"in j&&t(15,v=j.interactive),"$$scope"in j&&t(24,o=j.$$scope)},[h,l,i,s,a,u,f,c,_,d,m,g,b,w,y,v,n,I,O,F,B,z,D,R,o]}class Xm extends le{constructor(e){super(),ie(this,e,Zm,qm,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Ym(r){let e;const t=r[15].default,n=He(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Ge(n,t,o,o[23],e?We(t,o[23],l,null):Je(o[23]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function Km(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[Ym]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new oo({props:l}),Ne.push(()=>ft(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],ct(()=>t=!1)),e.$set(a)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){E(e,i)}}}function Vm(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=qn("fill")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:b=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:h=!1}=e,{interactive:y=!0}=e;function v(R){w=R,t(0,w)}function I(R){Pe.call(this,r,R)}function O(R){Pe.call(this,r,R)}function F(R){Pe.call(this,r,R)}function B(R){Pe.call(this,r,R)}function z(R){Pe.call(this,r,R)}function D(R){Pe.call(this,r,R)}return r.$$set=R=>{"id"in R&&t(1,l=R.id),"source"in R&&t(2,i=R.source),"sourceLayer"in R&&t(3,s=R.sourceLayer),"beforeId"in R&&t(4,a=R.beforeId),"beforeLayerType"in R&&t(5,u=R.beforeLayerType),"paint"in R&&t(6,f=R.paint),"layout"in R&&t(7,c=R.layout),"filter"in R&&t(8,_=R.filter),"minzoom"in R&&t(9,d=R.minzoom),"maxzoom"in R&&t(10,m=R.maxzoom),"hoverCursor"in R&&t(11,g=R.hoverCursor),"manageHoverState"in R&&t(12,b=R.manageHoverState),"hovered"in R&&t(0,w=R.hovered),"eventsIfTopMost"in R&&t(13,h=R.eventsIfTopMost),"interactive"in R&&t(14,y=R.interactive),"$$scope"in R&&t(23,o=R.$$scope)},[w,l,i,s,a,u,f,c,_,d,m,g,b,h,y,n,v,I,O,F,B,z,D,o]}class Qm extends le{constructor(e){super(),ie(this,e,Vm,Km,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function xm(r,e,t,n,o){let l=!1;r.getSource(e)&&(l=!0,r.removeSource(e));const i=()=>{n(e)&&(r.addSource(e,t),o())};if(l){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):i())};s()}else i()}function eg(r,e,t){xi().then(()=>{let n=pt(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function kl(r){let e=r[0],t,n,o=$l(r);return{c(){o.c(),t=et()},m(l,i){o.m(l,i),L(l,t,i),n=!0},p(l,i){i&1&&oe(e,e=l[0])?(ve(),S(o,1,1,Q),ke(),o=$l(l),o.c(),k(o,1),o.m(t.parentNode,t)):o.p(l,i)},i(l){n||(k(o),n=!0)},o(l){S(o),n=!1},d(l){l&&M(t),o.d(l)}}}function $l(r){let e;const t=r[15].default,n=He(t,r,r[14],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16384)&&Ge(n,t,o,o[14],e?We(t,o[14],l,null):Je(o[14]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function tg(r){let e,t,n=r[0]&&kl(r);return{c(){n&&n.c(),e=et()},m(o,l){n&&n.m(o,l),L(o,e,l),t=!0},p(o,[l]){o[0]?n?(n.p(o,l),l&1&&k(n,1)):(n=kl(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(ve(),S(n,1,1,()=>{n=null}),ke())},i(o){t||(k(n),t=!0)},o(o){S(n),t=!1},d(o){o&&M(e),n&&n.d(o)}}}function ng(r,e,t){let n,o,l,{$$slots:i={},$$scope:s}=e,{id:a=qn("geojson")}=e,{data:u}=e,{generateId:f=!1}=e,{promoteId:c=void 0}=e,{filter:_=void 0}=e,{lineMetrics:d=void 0}=e,{cluster:m=void 0}=e;const{map:g,cluster:b,self:w}=zm();Z(r,g,v=>t(13,o=v)),Z(r,b,v=>t(16,l=v)),Z(r,w,v=>t(0,n=v));let h,y=!0;return Ft(()=>{n&&h&&o&&(eg(g,n,h),K(w,n=null,n),t(11,h=void 0))}),r.$$set=v=>{"id"in v&&t(4,a=v.id),"data"in v&&t(5,u=v.data),"generateId"in v&&t(6,f=v.generateId),"promoteId"in v&&t(7,c=v.promoteId),"filter"in v&&t(8,_=v.filter),"lineMetrics"in v&&t(9,d=v.lineMetrics),"cluster"in v&&t(10,m=v.cluster),"$$scope"in v&&t(14,s=v.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&K(b,l=m,l),r.$$.dirty&12273&&o&&n!==a&&(K(w,n=a,n),xm(o,n,Fr({type:"geojson",data:u,filter:_,lineMetrics:d,generateId:f,promoteId:c,cluster:!!m,clusterMinPoints:m==null?void 0:m.minPoints,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius,clusterProperties:m==null?void 0:m.properties}),v=>o&&v===n,()=>{n&&(t(11,h=o==null?void 0:o.getSource(n)),t(12,y=!0))})),r.$$.dirty&8208&&(o==null||o.on("style.load",()=>{t(11,h=o==null?void 0:o.getSource(a))})),r.$$.dirty&6176&&h&&(y?t(12,y=!1):h.setData(u)),r.$$.dirty&3072&&(h==null||h.setClusterOptions(Fr({cluster:!!m,clusterMaxZoom:m==null?void 0:m.maxZoom,clusterRadius:m==null?void 0:m.radius})))},[n,g,b,w,a,u,f,c,_,d,m,h,y,o,s,i]}class rg extends le{constructor(e){super(),ie(this,e,ng,tg,oe,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function og(r){let e;const t=r[15].default,n=He(t,r,r[23],null);return{c(){n&&n.c()},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&Ge(n,t,o,o[23],e?We(t,o[23],l,null):Je(o[23]),null)},i(o){e||(k(n,o),e=!0)},o(o){S(n,o),e=!1},d(o){n&&n.d(o)}}}function lg(r){let e,t,n;function o(i){r[16](i)}let l={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[og]},$$scope:{ctx:r}};return r[0]!==void 0&&(l.hovered=r[0]),e=new oo({props:l}),Ne.push(()=>ft(e,"hovered",o)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){T(e.$$.fragment)},m(i,s){A(e,i,s),n=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.minzoom=i[9]),s&1024&&(a.maxzoom=i[10]),s&2048&&(a.hoverCursor=i[11]),s&4096&&(a.manageHoverState=i[12]),s&8192&&(a.eventsIfTopMost=i[13]),s&16384&&(a.interactive=i[14]),s&8388608&&(a.$$scope={dirty:s,ctx:i}),!t&&s&1&&(t=!0,a.hovered=i[0],ct(()=>t=!1)),e.$set(a)},i(i){n||(k(e.$$.fragment,i),n=!0)},o(i){S(e.$$.fragment,i),n=!1},d(i){E(e,i)}}}function ig(r,e,t){let{$$slots:n={},$$scope:o}=e,{id:l=qn("line")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:f}=e,{layout:c=void 0}=e,{filter:_=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:m=void 0}=e,{hoverCursor:g=void 0}=e,{manageHoverState:b=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:h=!1}=e,{interactive:y=!0}=e;function v(R){w=R,t(0,w)}function I(R){Pe.call(this,r,R)}function O(R){Pe.call(this,r,R)}function F(R){Pe.call(this,r,R)}function B(R){Pe.call(this,r,R)}function z(R){Pe.call(this,r,R)}function D(R){Pe.call(this,r,R)}return r.$$set=R=>{"id"in R&&t(1,l=R.id),"source"in R&&t(2,i=R.source),"sourceLayer"in R&&t(3,s=R.sourceLayer),"beforeId"in R&&t(4,a=R.beforeId),"beforeLayerType"in R&&t(5,u=R.beforeLayerType),"paint"in R&&t(6,f=R.paint),"layout"in R&&t(7,c=R.layout),"filter"in R&&t(8,_=R.filter),"minzoom"in R&&t(9,d=R.minzoom),"maxzoom"in R&&t(10,m=R.maxzoom),"hoverCursor"in R&&t(11,g=R.hoverCursor),"manageHoverState"in R&&t(12,b=R.manageHoverState),"hovered"in R&&t(0,w=R.hovered),"eventsIfTopMost"in R&&t(13,h=R.eventsIfTopMost),"interactive"in R&&t(14,y=R.interactive),"$$scope"in R&&t(23,o=R.$$scope)},[w,l,i,s,a,u,f,c,_,d,m,g,b,h,y,n,v,I,O,F,B,z,D,o]}class sg extends le{constructor(e){super(),ie(this,e,ig,lg,oe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function ag(r){let e,t,n,o,l,i;return e=new Qm({props:{id:"edit-polygon-fill",filter:Cm,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new sg({props:{id:"edit-polygon-lines",filter:Tm,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),l=new Xm({props:{id:"edit-polygon-vertices",filter:Am,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment)},m(s,a){A(e,s,a),L(s,t,a),A(n,s,a),L(s,o,a),A(l,s,a),i=!0},p:Q,i(s){i||(k(e.$$.fragment,s),k(n.$$.fragment,s),k(l.$$.fragment,s),i=!0)},o(s){S(e.$$.fragment,s),S(n.$$.fragment,s),S(l.$$.fragment,s),i=!1},d(s){s&&(M(t),M(o)),E(e,s),E(n,s),E(l,s)}}}function ug(r){let e,t;return e=new rg({props:{data:r[0],$$slots:{default:[ag]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1&&(l.data=n[0]),o&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function fg(r,e,t){let n;return Z(r,wi,o=>t(0,n=o)),[n]}class cg extends le{constructor(e){super(),ie(this,e,fg,ug,oe,{})}}function dg(r){let e,t,n,o,l,i,s;return{c(){e=$("button"),e.textContent="Import current view",t=P(),n=$("i"),n.textContent="or...",o=P(),l=$("button"),l.textContent="Draw an area to import on the map",C(e,"type","button"),C(l,"type","button")},m(a,u){L(a,e,u),L(a,t,u),L(a,n,u),L(a,o,u),L(a,l,u),i||(s=[V(e,"click",r[2]),V(l,"click",r[3])],i=!0)},p:Q,i:Q,o:Q,d(a){a&&(M(e),M(t),M(n),M(o),M(l)),i=!1,at(s)}}}function _g(r){let e,t;return e=new Om({props:{polygonTool:r[0]}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1&&(l.polygonTool=n[0]),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function mg(r){let e,t,n,o,l,i,s,a,u;const f=[_g,dg],c=[];function _(d,m){return d[0]?0:1}return e=_(r),t=c[e]=f[e](r),{c(){t.c(),n=P(),o=$("label"),l=$("input"),i=N(`Save a copy of the osm.xml
  after importing`),C(l,"type","checkbox")},m(d,m){c[e].m(d,m),L(d,n,m),L(d,o,m),p(o,l),l.checked=r[1],p(o,i),s=!0,a||(u=V(l,"change",r[5]),a=!0)},p(d,[m]){let g=e;e=_(d),e===g?c[e].p(d,m):(ve(),S(c[g],1,1,()=>{c[g]=null}),ke(),t=c[e],t?t.p(d,m):(t=c[e]=f[e](d),t.c()),k(t,1),t.m(n.parentNode,n)),m&2&&(l.checked=d[1])},i(d){s||(k(t),s=!0)},o(d){S(t),s=!1},d(d){d&&(M(n),M(o)),c[e].d(d),a=!1,u()}}}function $n(r){return[r.lng,r.lat]}function gg(r,e,t){let{map:n}=e;const o=nn();let l=null,i=!1;async function s(_){try{o("loading","Loading from Overpass");let m=await(await fetch(Li(_))).text();i&&lr("osm.xml",m),o("gotXml",{xml:m,boundary:_})}catch(d){o("error",d.toString())}}function a(){let _=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[$n(_.getSouthWest()),$n(_.getNorthWest()),$n(_.getNorthEast()),$n(_.getSouthEast()),$n(_.getSouthWest())]],type:"Polygon"}}}async function u(){if(n){if(n.getZoom()<13){o("error","Zoom in more to import");return}await s(a())}}function f(){n&&(t(0,l=new Pm(n)),l.startNew(),l.addEventListenerSuccess(async _=>{t(0,l=null),await s(_)}),l.addEventListenerFailure(()=>{t(0,l=null)}))}function c(){i=this.checked,t(1,i)}return r.$$set=_=>{"map"in _&&t(4,n=_.map)},[l,i,u,f,n,c]}class pg extends le{constructor(e){super(),ie(this,e,gg,mg,oe,{map:4})}}function Li(r){let e='poly:"';for(let[n,o]of r.geometry.coordinates[0])e+=`${o} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Mi{constructor(e,t,n,o){rt(this,"inner");this.inner=new va(e,t||new Uint8Array,n,o)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=hg(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){return JSON.parse(this.inner.getDemandModel())}}function hg(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function nr(r){tn.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get input files");let[t,n,o]=await bg(e,r.startsWith("ltn_cnt/"));console.timeEnd("get input files"),console.time("load"),Ze.set(new Mi(new Uint8Array(t),n?new Uint8Array(n):void 0,o,e.study_area_name||void 0)),pt(Ze).loadSavefile(e),console.timeEnd("load"),Si()}catch(e){window.alert(`Couldn't open project: ${e}`),tn.set("")}}async function bg(r,e){if(e){let t=pt(Kt)?`/cnt_osm/${r.study_area_name}.osm.pbf`:`https://assets.od2net.org/cnt_osm/${r.study_area_name}.osm.pbf`;console.log(`Grabbing ${t}`);let o=await(await cn(t)).arrayBuffer(),l=pt(Kt)?`/cnt_boundaries/${r.study_area_name}.geojson`:`https://assets.od2net.org/cnt_boundaries/${r.study_area_name}.geojson`,s=await(await cn(l)).json(),a=pt(Kt)?`/cnt_demand/demand_${r.study_area_name}.bin`:`https://assets.od2net.org/cnt_demand/demand_${r.study_area_name}.bin`;console.log(`Grabbing ${a}`);let u=null;try{u=await(await cn(a)).arrayBuffer()}catch(f){console.log(`No demand model: ${f}`)}return[o,u,s]}else if(r.study_area_name){let t=pt(Kt)?`/osm/${r.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${r.study_area_name}.pbf`;console.log(`Grabbing ${t}`);let o=await(await cn(t)).arrayBuffer(),l=pt(Kt)?`/boundaries/${r.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${r.study_area_name}.geojson`,s=await(await cn(l)).json();return[o,null,s]}else{console.log("Grabbing from Overpass");let t=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await cn(Li(t))).arrayBuffer(),null,t]}}function Si(){ee.set({mode:"pick-neighbourhood"}),bn.set(new ca(pt(Ht),pt(Ze).toRouteSnapper(),vt(Yt()),vt(!0),vt(0))),pt(Ht).fitBounds(pt(Ze).getBounds(),{animate:!1}),Rn.set(Cr()),On.set(Cr()),Qn.set(Cr());let r=new URL(window.location.href);r.searchParams.set("project",pt(tn)),window.history.replaceState(null,"",r.toString())}function Cr(){let r=pt(Ze).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new Ir.LngLat(e,t)}function Ll(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function Ml(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function yg(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function wg(r){let e,t,n,o,l,i,s,a;return l=new he({props:{$$slots:{default:[yg]},$$scope:{ctx:r}}}),l.$on("click",r[13]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),s.textContent="New project",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(u,f){L(u,e,f),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),a=!0},p(u,f){const c={};f&33554432&&(c.$$scope={dirty:f,ctx:u}),l.$set(c)},i(u){a||(k(l.$$.fragment,u),a=!0)},o(u){S(l.$$.fragment,u),a=!1},d(u){u&&M(e),E(l)}}}function Sl(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;e=new Gl({props:{loading:r[4]}});let g=qe(r[3]),b=[];for(let w=0;w<g.length;w+=1)b[w]=Tl(Ll(r,g,w));return c=new pg({props:{map:r[5]}}),c.$on("gotXml",r[7]),c.$on("loading",r[11]),c.$on("error",r[12]),{c(){T(e.$$.fragment),t=P(),n=$("label"),o=N(`Load a built-in area:
        `),l=$("select"),i=$("option");for(let w=0;w<b.length;w+=1)b[w].c();s=P(),a=$("i"),a.textContent="or...",u=P(),f=$("div"),T(c.$$.fragment),i.__value="",Ye(i,i.__value),r[2]===void 0&&Zr(()=>r[9].call(l))},m(w,h){A(e,w,h),L(w,t,h),L(w,n,h),p(n,o),p(n,l),p(l,i);for(let y=0;y<b.length;y+=1)b[y]&&b[y].m(l,null);gn(l,r[2],!0),L(w,s,h),L(w,a,h),L(w,u,h),L(w,f,h),A(c,f,null),_=!0,d||(m=[V(l,"change",r[9]),V(l,"change",r[10])],d=!0)},p(w,h){const y={};if(h&16&&(y.loading=w[4]),e.$set(y),h&8){g=qe(w[3]);let I;for(I=0;I<g.length;I+=1){const O=Ll(w,g,I);b[I]?b[I].p(O,h):(b[I]=Tl(O),b[I].c(),b[I].m(l,null))}for(;I<b.length;I+=1)b[I].d(1);b.length=g.length}h&12&&gn(l,w[2]);const v={};h&32&&(v.map=w[5]),c.$set(v)},i(w){_||(k(e.$$.fragment,w),k(c.$$.fragment,w),_=!0)},o(w){S(e.$$.fragment,w),S(c.$$.fragment,w),_=!1},d(w){w&&(M(t),M(n),M(s),M(a),M(u),M(f)),E(e,w),Nt(b,w),E(c),d=!1,at(m)}}}function Cl(r){let e,t=r[22]+"",n,o;return{c(){e=$("option"),n=N(t),e.__value=o=r[21],Ye(e,e.__value)},m(l,i){L(l,e,i),p(e,n)},p(l,i){i&8&&t!==(t=l[22]+"")&&fe(n,t),i&8&&o!==(o=l[21])&&(e.__value=o,Ye(e,e.__value))},d(l){l&&M(e)}}}function Tl(r){let e,t,n=qe(r[18]),o=[];for(let l=0;l<n.length;l+=1)o[l]=Cl(Ml(r,n,l));return{c(){e=$("optgroup");for(let l=0;l<o.length;l+=1)o[l].c();C(e,"label",t=r[17])},m(l,i){L(l,e,i);for(let s=0;s<o.length;s+=1)o[s]&&o[s].m(e,null)},p(l,i){if(i&8){n=qe(l[18]);let s;for(s=0;s<n.length;s+=1){const a=Ml(l,n,s);o[s]?o[s].p(a,i):(o[s]=Cl(a),o[s].c(),o[s].m(e,null))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}i&8&&t!==(t=l[17])&&C(e,"label",t)},d(l){l&&M(e),Nt(o,l)}}}function vg(r){let e,t,n,o,l,i,s,a,u,f=r[1]&&Sl(r);return{c(){e=$("div"),t=$("div"),n=$("label"),o=N(`Project name:
        `),l=$("input"),i=P(),f&&f.c(),C(l,"type","text"),C(e,"slot","sidebar")},m(c,_){L(c,e,_),p(e,t),p(t,n),p(n,o),p(n,l),Ye(l,r[1]),p(e,i),f&&f.m(e,null),s=!0,a||(u=V(l,"input",r[8]),a=!0)},p(c,_){_&2&&l.value!==c[1]&&Ye(l,c[1]),c[1]?f?(f.p(c,_),_&2&&k(f,1)):(f=Sl(c),f.c(),k(f,1),f.m(e,null)):f&&(ve(),S(f,1,1,()=>{f=null}),ke())},i(c){s||(k(f),s=!0)},o(c){S(f),s=!1},d(c){c&&M(e),f&&f.d(),a=!1,u()}}}function kg(r){let e,t,n;return t=new cg({}),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","map")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p:Q,i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function $g(r){let e,t;return e=new kt({props:{$$slots:{map:[kg],sidebar:[vg],top:[wg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&33554558&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Lg(r,e,t){let n,o,l,i,s;Z(r,tn,v=>t(14,n=v)),Z(r,Ze,v=>t(15,o=v)),Z(r,Kt,v=>t(16,l=v)),Z(r,Ht,v=>t(5,i=v)),Z(r,ee,v=>t(6,s=v));let a="",u="",f=[],c="";ur(async()=>{let v=await fetch(l?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,f=await v.json())});function _(v){t(4,c="Loading OSM");try{K(Ze,o=new Mi(new TextEncoder().encode(v.detail.xml),void 0,v.detail.boundary,void 0),o),K(tn,n=`ltn_${a}`,n),Si(),pn()}catch(I){window.alert(`Couldn't import from Overpass: ${I}`)}t(4,c="")}async function d(){if(u=="")return;let v=`ltn_${a}`;window.localStorage.setItem(v,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:u})),t(4,c=`Loading pre-clipped OSM area ${u}`),await nr(v),t(4,c="")}function m(){a=this.value,t(1,a)}function g(){u=Xr(this),t(2,u),t(3,f)}return[d,a,u,f,c,i,s,_,m,g,()=>d(),v=>t(4,c=v.detail),v=>window.alert(v.detail),()=>K(ee,s={mode:"title",firstLoad:!1},s)]}class Mg extends le{constructor(e){super(),ie(this,e,Lg,$g,oe,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Al(r,e,t){const n=r.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function El(r,e,t){const n=r.slice();return n[23]=e[t],n}function Sg(r){let e;return{c(){e=$("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',C(e,"slot","top")},m(t,n){L(t,e,n)},p:Q,d(t){t&&M(e)}}}function Cg(r){let e;return{c(){e=$("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){L(t,e,n)},p:Q,i:Q,o:Q,d(t){t&&M(e)}}}function Tg(r){let e,t,n,o,l,i,s,a,u,f,c,_,d;t=new he({props:{$$slots:{default:[Ag]},$$scope:{ctx:r}}}),t.$on("click",r[11]);let m=qe(r[2]),g=[];for(let w=0;w<m.length;w+=1)g[w]=Il(Al(r,m,w));const b=w=>S(g[w],1,1,()=>{g[w]=null});return{c(){e=$("div"),T(t.$$.fragment),n=P(),o=$("p"),o.textContent="Load a saved project:",l=P(),i=$("ul");for(let w=0;w<g.length;w+=1)g[w].c();s=P(),a=$("label"),u=N(`Load a project from a file
        `),f=$("input"),C(f,"type","file")},m(w,h){L(w,e,h),A(t,e,null),L(w,n,h),L(w,o,h),L(w,l,h),L(w,i,h);for(let y=0;y<g.length;y+=1)g[y]&&g[y].m(i,null);L(w,s,h),L(w,a,h),p(a,u),p(a,f),r[15](f),c=!0,_||(d=V(f,"change",r[6]),_=!0)},p(w,h){const y={};if(h&67108864&&(y.$$scope={dirty:h,ctx:w}),t.$set(y),h&900){m=qe(w[2]);let v;for(v=0;v<m.length;v+=1){const I=Al(w,m,v);g[v]?(g[v].p(I,h),k(g[v],1)):(g[v]=Il(I),g[v].c(),k(g[v],1),g[v].m(i,null))}for(ve(),v=m.length;v<g.length;v+=1)b(v);ke()}},i(w){if(!c){k(t.$$.fragment,w);for(let h=0;h<m.length;h+=1)k(g[h]);c=!0}},o(w){S(t.$$.fragment,w),g=g.filter(Boolean);for(let h=0;h<g.length;h+=1)S(g[h]);c=!1},d(w){w&&(M(e),M(n),M(o),M(l),M(i),M(s),M(a)),E(t),Nt(g,w),r[15](null),_=!1,d()}}}function Ag(r){let e;return{c(){e=N("New project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Eg(r){let e=r[23].slice(4)+"",t;return{c(){t=N(e)},m(n,o){L(n,t,o)},p(n,o){o&4&&e!==(e=n[23].slice(4)+"")&&fe(t,e)},d(n){n&&M(t)}}}function Pl(r){let e,t,n,o,l,i,s,a,u,f,c;function _(){return r[12](r[23])}n=new he({props:{$$slots:{default:[Eg]},$$scope:{ctx:r}}}),n.$on("click",_);function d(){return r[13](r[23])}function m(){return r[14](r[23])}return{c(){e=$("li"),t=$("span"),T(n.$$.fragment),o=P(),l=$("button"),l.innerHTML=`<img src="${pi}" alt="Rename project"/>`,i=P(),s=$("button"),s.innerHTML=`<img src="${gi}" alt="Delete project"/>`,a=P(),C(l,"class","secondary"),C(s,"class","secondary"),_e(t,"display","flex"),_e(t,"justify-content","space-between")},m(g,b){L(g,e,b),p(e,t),A(n,t,null),p(t,o),p(t,l),p(t,i),p(t,s),p(e,a),u=!0,f||(c=[V(l,"click",d),V(s,"click",m)],f=!0)},p(g,b){r=g;const w={};b&67108868&&(w.$$scope={dirty:b,ctx:r}),n.$set(w)},i(g){u||(k(n.$$.fragment,g),u=!0)},o(g){S(n.$$.fragment,g),u=!1},d(g){g&&M(e),E(n),f=!1,at(c)}}}function Il(r){let e,t=(r[19]??"custom area")+"",n,o,l,i,s=qe(r[20]),a=[];for(let f=0;f<s.length;f+=1)a[f]=Pl(El(r,s,f));const u=f=>S(a[f],1,1,()=>{a[f]=null});return{c(){e=$("u"),n=N(t),o=P();for(let f=0;f<a.length;f+=1)a[f].c();l=et()},m(f,c){L(f,e,c),p(e,n),L(f,o,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(f,c);L(f,l,c),i=!0},p(f,c){if((!i||c&4)&&t!==(t=(f[19]??"custom area")+"")&&fe(n,t),c&900){s=qe(f[20]);let _;for(_=0;_<s.length;_+=1){const d=El(f,s,_);a[_]?(a[_].p(d,c),k(a[_],1)):(a[_]=Pl(d),a[_].c(),k(a[_],1),a[_].m(l.parentNode,l))}for(ve(),_=s.length;_<a.length;_+=1)u(_);ke()}},i(f){if(!i){for(let c=0;c<s.length;c+=1)k(a[c]);i=!0}},o(f){a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)S(a[c]);i=!1},d(f){f&&(M(e),M(o),M(l)),Nt(a,f)}}}function Pg(r){let e,t,n,o;const l=[Tg,Cg],i=[];function s(a,u){return a[4]&&a[0]?0:1}return t=s(r),n=i[t]=l[t](r),{c(){e=$("div"),n.c(),C(e,"slot","sidebar")},m(a,u){L(a,e,u),i[t].m(e,null),o=!0},p(a,u){let f=t;t=s(a),t===f?i[t].p(a,u):(ve(),S(i[f],1,1,()=>{i[f]=null}),ke(),n=i[t],n?n.p(a,u):(n=i[t]=l[t](a),n.c()),k(n,1),n.m(e,null))},i(a){o||(k(n),o=!0)},o(a){S(n),o=!1},d(a){a&&M(e),i[t].d()}}}function Ig(r){let e,t,n,o;return e=new Gl({props:{loading:r[1]}}),n=new kt({props:{$$slots:{sidebar:[Pg],top:[Sg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment)},m(l,i){A(e,l,i),L(l,t,i),A(n,l,i),o=!0},p(l,[i]){const s={};i&2&&(s.loading=l[1]),e.$set(s);const a={};i&67108925&&(a.$$scope={dirty:i,ctx:l}),n.$set(a)},i(l){o||(k(e.$$.fragment,l),k(n.$$.fragment,l),o=!0)},o(l){S(e.$$.fragment,l),S(n.$$.fragment,l),o=!1},d(l){l&&M(t),E(e,l),E(n,l)}}}function Vn(){let r=new Map,e=[];for(let n=0;n<window.localStorage.length;n++){let o=window.localStorage.key(n);if(o.startsWith("ltn_")){let l="";try{l=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch{}l&&l.length>0?(r.has(l)||r.set(l,[]),r.get(l).push(o)):e.push(o)}}let t=[...r.entries()];return t.sort((n,o)=>n[0].localeCompare(o[0])),t.push(["custom",e]),t}function Fg(r,e,t){let n,o,l,i,s;Z(r,tn,O=>t(16,n=O)),Z(r,bn,O=>t(17,o=O)),Z(r,Ze,O=>t(18,l=O)),Z(r,Ht,O=>t(4,i=O)),Z(r,ee,O=>t(5,s=O));let{wasmReady:a}=e,{firstLoad:u}=e,f="";if(K(Ze,l=null,l),K(bn,o=null,o),K(tn,n="",n),u){let F=new URLSearchParams(window.location.search).get("project");F&&nr(F)}else{let O=new URL(window.location.href);O.searchParams.delete("project"),window.history.replaceState(null,"",O.toString())}let c=Vn(),_;async function d(O){let F="ltn_"+_.files[0].name;t(1,f=`Loading from file ${F}`),window.localStorage.setItem(F,await _.files[0].text()),t(2,c=Vn()),await nr(F),t(1,f="")}function m(O){window.confirm(`Really delete project ${O}? You can't undo this.`)&&(window.localStorage.removeItem(O),t(2,c=Vn()))}function g(O){let F=window.prompt(`Rename project ${O} to what?`,O);if(F){F.startsWith("ltn_")||(F=`ltn_${F}`);let B=window.localStorage.getItem(O);window.localStorage.setItem(F,B),window.localStorage.removeItem(O),t(2,c=Vn())}}async function b(O){t(1,f=`Loading project ${O}`),await nr(O),t(1,f="")}const w=()=>K(ee,s={mode:"new-project"},s),h=O=>b(O),y=O=>g(O),v=O=>m(O);function I(O){Ne[O?"unshift":"push"](()=>{_=O,t(3,_)})}return r.$$set=O=>{"wasmReady"in O&&t(0,a=O.wasmReady),"firstLoad"in O&&t(10,u=O.firstLoad)},[a,f,c,_,i,s,d,m,g,b,u,w,h,y,v,I]}class jg extends le{constructor(e){super(),ie(this,e,Fg,Ig,oe,{wasmReady:0,firstLoad:10})}}function Bg(r){let e;return{c(){e=N("Choose project")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Og(r){let e;return{c(){e=N("Pick neighbourhood")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Rg(r){let e;return{c(){e=N("Editing")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Ng(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;return l=new he({props:{$$slots:{default:[Bg]},$$scope:{ctx:r}}}),l.$on("click",r[6]),a=new he({props:{$$slots:{default:[Og]},$$scope:{ctx:r}}}),a.$on("click",r[7]),c=new he({props:{$$slots:{default:[Rg]},$$scope:{ctx:r}}}),c.$on("click",r[3]),{c(){e=$("div"),t=$("nav"),n=$("ul"),o=$("li"),T(l.$$.fragment),i=P(),s=$("li"),T(a.$$.fragment),u=P(),f=$("li"),T(c.$$.fragment),_=P(),d=$("li"),d.textContent="Viewing shortcuts",C(t,"aria-label","breadcrumb"),C(e,"slot","top")},m(g,b){L(g,e,b),p(e,t),p(t,n),p(n,o),A(l,o,null),p(n,i),p(n,s),A(a,s,null),p(n,u),p(n,f),A(c,f,null),p(n,_),p(n,d),m=!0},p(g,b){const w={};b&1024&&(w.$$scope={dirty:b,ctx:g}),l.$set(w);const h={};b&1024&&(h.$$scope={dirty:b,ctx:g}),a.$set(h);const y={};b&1024&&(y.$$scope={dirty:b,ctx:g}),c.$set(y)},i(g){m||(k(l.$$.fragment,g),k(a.$$.fragment,g),k(c.$$.fragment,g),m=!0)},o(g){S(l.$$.fragment,g),S(a.$$.fragment,g),S(c.$$.fragment,g),m=!1},d(g){g&&M(e),E(l),E(a),E(c)}}}function zg(r){let e,t,n,o,l,i,s,a,u,f,c=st(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",_,d,m,g,b,w;function h(v){r[5](v)}let y={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(y.idx=r[0].shortcutIndex),l=new _r({props:y}),Ne.push(()=>ft(l,"idx",h)),{c(){e=$("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=P(),n=$("button"),n.textContent="Pick a different road",o=P(),T(l.$$.fragment),s=P(),a=$("p"),u=N("This shortcut is "),f=$("b"),_=N(c),d=N("x"),m=N(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(v,I){L(v,e,I),L(v,t,I),L(v,n,I),L(v,o,I),A(l,v,I),L(v,s,I),L(v,a,I),p(a,u),p(a,f),p(f,_),p(f,d),p(a,m),g=!0,b||(w=V(n,"click",r[4]),b=!0)},p(v,I){const O={};I&1&&(O.list=v[0].gj.features),!i&&I&1&&(i=!0,O.idx=v[0].shortcutIndex,ct(()=>i=!1)),l.$set(O),(!g||I&1)&&c!==(c=st(v[0].gj.features[v[0].shortcutIndex].properties).directness.toFixed(1)+"")&&fe(_,c)},i(v){g||(k(l.$$.fragment,v),g=!0)},o(v){S(l.$$.fragment,v),g=!1},d(v){v&&(M(e),M(t),M(n),M(o),M(s),M(a)),E(l,v),b=!1,w()}}}function Dg(r){let e;return{c(){e=$("p"),e.textContent="Click a road to see shortcuts"},m(t,n){L(t,e,n)},p:Q,i:Q,o:Q,d(t){t&&M(e)}}}function Ug(r){let e,t,n,o,l,i;t=new rn({}),t.$on("click",r[3]);const s=[Dg,zg],a=[];function u(f,c){return f[0].state=="neutral"?0:f[0].state=="chose-road"?1:-1}return~(o=u(r))&&(l=a[o]=s[o](r)),{c(){e=$("div"),T(t.$$.fragment),n=P(),l&&l.c(),C(e,"slot","sidebar")},m(f,c){L(f,e,c),A(t,e,null),p(e,n),~o&&a[o].m(e,null),i=!0},p(f,c){let _=o;o=u(f),o===_?~o&&a[o].p(f,c):(l&&(ve(),S(a[_],1,1,()=>{a[_]=null}),ke()),~o?(l=a[o],l?l.p(f,c):(l=a[o]=s[o](f),l.c()),k(l,1),l.m(e,null)):l=null)},i(f){i||(k(t.$$.fragment,f),k(l),i=!0)},o(f){S(t.$$.fragment,f),S(l),i=!1},d(f){f&&M(e),E(t),~o&&a[o].d()}}}function Hg(r){let e,t;return e=new Jn({props:{interactive:!1}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Gg(r){let e,t;return e=new Jn({props:{onClickLine:r[2],$$slots:{"line-popup":[Wg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&1024&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Jg(r){let e,t=r[9].shortcuts+"",n,o,l=(r[9].name??"unnamed road")+"",i;return{c(){e=$("p"),n=N(t),o=N(" shortcuts through "),i=N(l)},m(s,a){L(s,e,a),p(e,n),p(e,o),p(e,i)},p(s,a){a&512&&t!==(t=s[9].shortcuts+"")&&fe(n,t),a&512&&l!==(l=(s[9].name??"unnamed road")+"")&&fe(i,l)},d(s){s&&M(e)}}}function Wg(r){let e,t,n;return t=new zt({props:{openOn:"hover",$$slots:{default:[Jg,({props:o})=>({9:o}),({props:o})=>o?512:0]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","line-popup")},m(o,l){L(o,e,l),A(t,e,null),n=!0},p(o,l){const i={};l&1536&&(i.$$scope={dirty:l,ctx:o}),t.$set(i)},i(o){n||(k(t.$$.fragment,o),n=!0)},o(o){S(t.$$.fragment,o),n=!1},d(o){o&&M(e),E(t)}}}function qg(r){let e,t,n,o,l,i,s,a,u,f;e=new gr({}),n=new mr({}),l=new pr({});const c=[Gg,Hg],_=[];function d(m,g){return m[0].state=="neutral"?0:m[0].state=="chose-road"?1:-1}return~(s=d(r))&&(a=_[s]=c[s](r)),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),a&&a.c(),u=et()},m(m,g){A(e,m,g),L(m,t,g),A(n,m,g),L(m,o,g),A(l,m,g),L(m,i,g),~s&&_[s].m(m,g),L(m,u,g),f=!0},p(m,g){let b=s;s=d(m),s===b?~s&&_[s].p(m,g):(a&&(ve(),S(_[b],1,1,()=>{_[b]=null}),ke()),~s?(a=_[s],a?a.p(m,g):(a=_[s]=c[s](m),a.c()),k(a,1),a.m(u.parentNode,u)):a=null)},i(m){f||(k(e.$$.fragment,m),k(n.$$.fragment,m),k(l.$$.fragment,m),k(a),f=!0)},o(m){S(e.$$.fragment,m),S(n.$$.fragment,m),S(l.$$.fragment,m),S(a),f=!1},d(m){m&&(M(t),M(o),M(i),M(u)),E(e,m),E(n,m),E(l,m),~s&&_[s].d(m)}}}function Fl(r){let e,t,n,o,l,i,s,a;return e=new xe({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[Zg]},$$scope:{ctx:r}}}),n=new xe({props:{data:r[0].roadGj,$$slots:{default:[Xg]},$$scope:{ctx:r}}}),l=new un({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[Yg]},$$scope:{ctx:r}}}),s=new un({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[Kg]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),T(s.$$.fragment)},m(u,f){A(e,u,f),L(u,t,f),A(n,u,f),L(u,o,f),A(l,u,f),L(u,i,f),A(s,u,f),a=!0},p(u,f){const c={};f&1&&(c.data=u[0].gj.features[u[0].shortcutIndex]),f&1024&&(c.$$scope={dirty:f,ctx:u}),e.$set(c);const _={};f&1&&(_.data=u[0].roadGj),f&1024&&(_.$$scope={dirty:f,ctx:u}),n.$set(_);const d={};f&1&&(d.lngLat=u[0].gj.features[u[0].shortcutIndex].geometry.coordinates[0]),f&1024&&(d.$$scope={dirty:f,ctx:u}),l.$set(d);const m={};f&1&&(m.lngLat=u[0].gj.features[u[0].shortcutIndex].geometry.coordinates[u[0].gj.features[u[0].shortcutIndex].geometry.coordinates.length-1]),f&1024&&(m.$$scope={dirty:f,ctx:u}),s.$set(m)},i(u){a||(k(e.$$.fragment,u),k(n.$$.fragment,u),k(l.$$.fragment,u),k(s.$$.fragment,u),a=!0)},o(u){S(e.$$.fragment,u),S(n.$$.fragment,u),S(l.$$.fragment,u),S(s.$$.fragment,u),a=!1},d(u){u&&(M(t),M(o),M(i)),E(e,u),E(n,u),E(l,u),E(s,u)}}}function Zg(r){let e,t;const n=[Fe("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Xg(r){let e,t;const n=[Fe("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new dt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function Yg(r){let e;return{c(){e=N("A")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Kg(r){let e;return{c(){e=N("B")},m(t,n){L(t,e,n)},d(t){t&&M(e)}}}function Vg(r){let e,t,n,o,l,i;t=new Wn({props:{$$slots:{default:[qg]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Fl(r);return l=new on({}),{c(){e=$("div"),T(t.$$.fragment),n=P(),s&&s.c(),o=P(),T(l.$$.fragment),C(e,"slot","map")},m(a,u){L(a,e,u),A(t,e,null),p(e,n),s&&s.m(e,null),p(e,o),A(l,e,null),i=!0},p(a,u){const f={};u&1025&&(f.$$scope={dirty:u,ctx:a}),t.$set(f),a[0].state=="chose-road"?s?(s.p(a,u),u&1&&k(s,1)):(s=Fl(a),s.c(),k(s,1),s.m(e,o)):s&&(ve(),S(s,1,1,()=>{s=null}),ke())},i(a){i||(k(t.$$.fragment,a),k(s),k(l.$$.fragment,a),i=!0)},o(a){S(t.$$.fragment,a),S(s),S(l.$$.fragment,a),i=!1},d(a){a&&M(e),E(t),s&&s.d(),E(l)}}}function Qg(r){let e,t;return e=new kt({props:{$$slots:{map:[Vg],sidebar:[Ug],top:[Ng]},$$scope:{ctx:r}}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,[o]){const l={};o&1027&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function xg(r,e,t){let n,o;Z(r,ee,_=>t(1,n=_)),Z(r,Ze,_=>t(8,o=_));let l={state:"neutral"};function i(_,d){let m=o.getShortcutsCrossingRoad(_.properties.id);if(m.features.length==0){window.alert("No shortcuts here");return}t(0,l={state:"chose-road",roadGj:_,gj:m,shortcutIndex:0})}function s(){K(ee,n={mode:"neighbourhood"},n)}const a=()=>t(0,l={state:"neutral"});function u(_){r.$$.not_equal(l.shortcutIndex,_)&&(l.shortcutIndex=_,t(0,l))}return[l,n,i,s,a,u,()=>K(ee,n={mode:"title",firstLoad:!1},n),()=>K(ee,n={mode:"pick-neighbourhood"},n)]}class ep extends le{constructor(e){super(),ie(this,e,xg,Qg,oe,{})}}function tp(r){let e,t,n,o,l,i,s,a,u;return o=new Sm({}),{c(){e=$("div"),t=$("button"),t.innerHTML=`<img src="${os}" style="height: 6vh;" alt="A/B Street logo"/>`,n=P(),T(o.$$.fragment),l=P(),i=$("span"),C(t,"class","outline"),_e(i,"width","100%"),C(e,"slot","top"),C(e,"class","pico"),_e(e,"display","flex")},m(f,c){L(f,e,c),p(e,t),p(e,n),A(o,e,null),p(e,l),p(e,i),r[19](i),s=!0,a||(u=V(t,"click",r[18]),a=!0)},p:Q,i(f){s||(k(o.$$.fragment,f),s=!0)},o(f){S(o.$$.fragment,f),s=!1},d(f){f&&M(e),E(o),r[19](null),a=!1,u()}}}function jl(r){let e,t,n,o,l,i;return n=new nf({props:{map:st(r[6]),maptilerBasemap:r[7]}}),{c(){e=$("button"),e.textContent="Zoom to fit study area",t=P(),T(n.$$.fragment),C(e,"class","secondary")},m(s,a){L(s,e,a),L(s,t,a),A(n,s,a),o=!0,l||(i=V(e,"click",r[10]),l=!0)},p(s,a){const u={};a&64&&(u.map=st(s[6])),a&128&&(u.maptilerBasemap=s[7]),n.$set(u)},i(s){o||(k(n.$$.fragment,s),o=!0)},o(s){S(n.$$.fragment,s),o=!1},d(s){s&&(M(e),M(t)),E(n,s),l=!1,i()}}}function np(r){let e,t,n,o,l,i,s=r[5]&&jl(r);return{c(){e=$("div"),t=$("div"),n=P(),o=$("hr"),l=P(),s&&s.c(),C(e,"class","pico"),C(e,"slot","left")},m(a,u){L(a,e,u),p(e,t),r[17](t),p(e,n),p(e,o),p(e,l),s&&s.m(e,null),i=!0},p(a,u){a[5]?s?(s.p(a,u),u&32&&k(s,1)):(s=jl(a),s.c(),k(s,1),s.m(e,null)):s&&(ve(),S(s,1,1,()=>{s=null}),ke())},i(a){i||(k(s),i=!0)},o(a){S(s),i=!1},d(a){a&&M(e),r[17](null),s&&s.d()}}}function rp(r){let e,t;return e=new Mg({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function op(r){let e,t;return e=new jg({props:{wasmReady:r[4],firstLoad:r[8].firstLoad}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&16&&(l.wasmReady=n[4]),o&256&&(l.firstLoad=n[8].firstLoad),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function Bl(r){let e,t,n,o,l,i;e=new xe({props:{data:r[5].getInvertedBoundary(),$$slots:{default:[lp]},$$scope:{ctx:r}}});const s=[hp,pp,gp,mp,_p,dp,cp,fp,up,ap,sp,ip],a=[];function u(f,c){return f[8].mode=="pick-neighbourhood"?0:f[8].mode=="set-boundary"?1:f[8].mode=="auto-boundaries"?2:f[8].mode=="neighbourhood"?3:f[8].mode=="view-shortcuts"?4:f[8].mode=="impact-one-destination"?5:f[8].mode=="route"?6:f[8].mode=="predict-impact"?7:f[8].mode=="impact-detail"?8:f[8].mode=="debug-neighbourhood"?9:f[8].mode=="debug-intersections"?10:f[8].mode=="debug-demand"?11:-1}return~(n=u(r))&&(o=a[n]=s[n](r)),{c(){T(e.$$.fragment),t=P(),o&&o.c(),l=et()},m(f,c){A(e,f,c),L(f,t,c),~n&&a[n].m(f,c),L(f,l,c),i=!0},p(f,c){const _={};c&32&&(_.data=f[5].getInvertedBoundary()),c&2097152&&(_.$$scope={dirty:c,ctx:f}),e.$set(_);let d=n;n=u(f),n===d?~n&&a[n].p(f,c):(o&&(ve(),S(a[d],1,1,()=>{a[d]=null}),ke()),~n?(o=a[n],o?o.p(f,c):(o=a[n]=s[n](f),o.c()),k(o,1),o.m(l.parentNode,l)):o=null)},i(f){i||(k(e.$$.fragment,f),k(o),i=!0)},o(f){S(e.$$.fragment,f),S(o),i=!1},d(f){f&&(M(t),M(l)),E(e,f),~n&&a[n].d(f)}}}function lp(r){let e,t;const n=[Fe("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let o={};for(let l=0;l<n.length;l+=1)o=Ie(o,n[l]);return e=new jt({props:o}),{c(){T(e.$$.fragment)},m(l,i){A(e,l,i),t=!0},p(l,i){const s={};e.$set(s)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){S(e.$$.fragment,l),t=!1},d(l){E(e,l)}}}function ip(r){let e,t;return e=new Ef({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function sp(r){let e,t;return e=new Df({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function ap(r){let e,t;return e=new $c({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function up(r){let e,t;return e=new Gd({props:{road:r[8].road}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&256&&(l.road=n[8].road),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function fp(r){let e,t;return e=new j_({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function cp(r){let e,t;return e=new Z_({props:{prevMode:r[8].prevMode}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&256&&(l.prevMode=n[8].prevMode),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function dp(r){let e,t;return e=new o_({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function _p(r){let e,t;return e=new ep({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function mp(r){let e,t;return e=new Pd({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function gp(r){let e,t;return e=new yf({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function pp(r){let e,t;return e=new vm({props:{name:r[8].name,existing:r[8].existing}}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&256&&(l.name=n[8].name),o&256&&(l.existing=n[8].existing),e.$set(l)},i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function hp(r){let e,t;return e=new $_({}),{c(){T(e.$$.fragment)},m(n,o){A(e,n,o),t=!0},p:Q,i(n){t||(k(e.$$.fragment,n),t=!0)},o(n){S(e.$$.fragment,n),t=!1},d(n){E(e,n)}}}function bp(r){let e,t,n,o,l,i,s,a,u,f,c,_,d,m;e=new ts({}),n=new ns({}),l=new pu({props:{map:r[0],apiKey:jr,country:void 0}});const g=[op,rp],b=[];function w(y,v){return y[8].mode=="title"?0:y[8].mode=="new-project"?1:-1}~(u=w(r))&&(f=b[u]=g[u](r));let h=r[5]&&Bl(r);return d=new Ru({}),{c(){T(e.$$.fragment),t=P(),T(n.$$.fragment),o=P(),T(l.$$.fragment),i=P(),s=$("div"),a=P(),f&&f.c(),c=P(),h&&h.c(),_=P(),T(d.$$.fragment)},m(y,v){A(e,y,v),L(y,t,v),A(n,y,v),L(y,o,v),A(l,y,v),L(y,i,v),L(y,s,v),r[14](s),L(y,a,v),~u&&b[u].m(y,v),L(y,c,v),h&&h.m(y,v),L(y,_,v),A(d,y,v),m=!0},p(y,v){const I={};v&1&&(I.map=y[0]),l.$set(I);let O=u;u=w(y),u===O?~u&&b[u].p(y,v):(f&&(ve(),S(b[O],1,1,()=>{b[O]=null}),ke()),~u?(f=b[u],f?f.p(y,v):(f=b[u]=g[u](y),f.c()),k(f,1),f.m(c.parentNode,c)):f=null),y[5]?h?(h.p(y,v),v&32&&k(h,1)):(h=Bl(y),h.c(),k(h,1),h.m(_.parentNode,_)):h&&(ve(),S(h,1,1,()=>{h=null}),ke())},i(y){m||(k(e.$$.fragment,y),k(n.$$.fragment,y),k(l.$$.fragment,y),k(f),k(h),k(d.$$.fragment,y),m=!0)},o(y){S(e.$$.fragment,y),S(n.$$.fragment,y),S(l.$$.fragment,y),S(f),S(h),S(d.$$.fragment,y),m=!1},d(y){y&&(M(t),M(o),M(i),M(s),M(a),M(c),M(_)),E(e,y),E(n,y),E(l,y),r[14](null),~u&&b[u].d(y),h&&h.d(y),E(d,y)}}}function yp(r){let e,t,n,o;function l(s){r[15](s)}let i={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${jr}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"oneway-arrow",url:rs}],$$slots:{default:[bp]},$$scope:{ctx:r}};return r[0]!==void 0&&(i.map=r[0]),t=new es({props:i}),Ne.push(()=>ft(t,"map",l)),t.$on("error",r[16]),{c(){e=$("div"),T(t.$$.fragment),C(e,"slot","main"),_e(e,"position","relative"),_e(e,"width","100%"),_e(e,"height","100%")},m(s,a){L(s,e,a),A(t,e,null),o=!0},p(s,a){const u={};a&128&&(u.style=`https://api.maptiler.com/maps/${s[7]}/style.json?key=${jr}`),a&2097465&&(u.$$scope={dirty:a,ctx:s}),!n&&a&1&&(n=!0,u.map=s[0],ct(()=>n=!1)),t.$set(u)},i(s){o||(k(t.$$.fragment,s),o=!0)},o(s){S(t.$$.fragment,s),o=!1},d(s){s&&M(e),E(t)}}}function wp(r){let e,t,n,o,l;return t=new ga({}),o=new Mu({props:{$$slots:{main:[yp],left:[np],top:[tp]},$$scope:{ctx:r}}}),{c(){e=$("div"),T(t.$$.fragment),n=P(),T(o.$$.fragment),C(e,"class","pico")},m(i,s){L(i,e,s),A(t,e,null),L(i,n,s),A(o,i,s),l=!0},p(i,[s]){const a={};s&2098175&&(a.$$scope={dirty:s,ctx:i}),o.$set(a)},i(i){l||(k(t.$$.fragment,i),k(o.$$.fragment,i),l=!0)},o(i){S(t.$$.fragment,i),S(o.$$.fragment,i),l=!1},d(i){i&&(M(e),M(n)),E(t),E(o,i)}}}function vp(r,e,t){let n,o,l,i,s,a,u,f,c;Z(r,Ur,B=>t(11,n=B)),Z(r,Dr,B=>t(12,o=B)),Z(r,zr,B=>t(13,l=B)),Z(r,Ze,B=>t(5,i=B)),Z(r,Ht,B=>t(6,s=B)),Z(r,Kt,B=>t(20,a=B)),Z(r,Ar,B=>t(7,u=B)),Z(r,ee,B=>t(8,f=B)),Z(r,rr,B=>t(9,c=B));let _=!1;ur(async()=>{await si(),await Wl(),t(4,_=!0);try{(await fetch("/osm/areas.json")).ok&&(K(Kt,a=!0,a),console.log("Using local cache, not od2net.org"))}catch{}});let d=null;function m(){s.fitBounds(i.getBounds(),{animate:!1})}let g,b,w;function h(B){Ne[B?"unshift":"push"](()=>{w=B,t(3,w),t(11,n)})}function y(B){d=B,t(0,d)}const v=B=>{console.log(B.detail.error)};function I(B){Ne[B?"unshift":"push"](()=>{b=B,t(2,b),t(12,o)})}const O=()=>K(rr,c=!0,c);function F(B){Ne[B?"unshift":"push"](()=>{g=B,t(1,g),t(13,l)})}return r.$$.update=()=>{r.$$.dirty&1&&d&&Ht.set(d),r.$$.dirty&8194&&g&&l&&(t(1,g.innerHTML="",g),g.appendChild(l)),r.$$.dirty&4100&&b&&o&&(t(2,b.innerHTML="",b),b.appendChild(o)),r.$$.dirty&2056&&w&&n&&(t(3,w.innerHTML="",w),w.appendChild(n))},[d,g,b,w,_,i,s,u,f,c,m,n,o,l,h,y,v,I,O,F]}class kp extends le{constructor(e){super(),ie(this,e,vp,wp,oe,{})}}new kp({target:document.getElementById("app")});
