var JA=Object.defineProperty;var YA=(r,e,t)=>e in r?JA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Yn=(r,e,t)=>(YA(r,typeof e!="symbol"?e+"":e,t),t);function QA(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function at(){}function zt(r,e){for(const t in e)r[t]=e[t];return r}function ek(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function Wb(r){return r()}function U0(){return Object.create(null)}function cr(r){r.forEach(Wb)}function Ga(r){return typeof r=="function"}function St(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let _d;function kr(r,e){return r===e?!0:(_d||(_d=document.createElement("a")),_d.href=e,r===_d.href)}function tk(r){return Object.keys(r).length===0}function Eg(r,...e){if(r==null){for(const n of e)n(void 0);return at}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function gi(r){let e;return Eg(r,t=>e=t)(),e}function ct(r,e,t){r.$$.on_destroy.push(Eg(e,t))}function vn(r,e,t,n){if(r){const i=Zb(r,e,t,n);return r[0](i)}}function Zb(r,e,t,n){return r[1]&&n?zt(t.ctx.slice(),r[1](n(e))):t.ctx}function bn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function wn(r,e,t,n,i,o){if(i){const u=Zb(e,t,n,o);r.p(u,i)}}function xn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function gr(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function V0(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Lg(r){const e={};for(const t in r)e[t]=!0;return e}function ec(r){return r??""}function ln(r,e,t){return r.set(t),e}function Vm(r){return r&&Ga(r.destroy)?r.destroy:at}const Xb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function B(r,e){r.appendChild(e)}function G(r,e,t){r.insertBefore(e,t||null)}function H(r){r.parentNode&&r.parentNode.removeChild(r)}function _i(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function ws(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Me(r){return document.createTextNode(r)}function oe(){return Me(" ")}function nr(){return Me("")}function Lt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Ig(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Mf(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function de(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Ud(r,e){for(const t in e)de(r,t,e[t])}function nk(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Pg(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function zl(r){return r===""?null:+r}function rk(r){return Array.from(r.childNodes)}function kt(r,e){e=""+e,r.data!==e&&(r.data=e)}function Zn(r,e){r.value=e??""}function Ye(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Xi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Ba(r){const e=r.querySelector(":checked");return e&&e.__value}function Wt(r,e,t){r.classList.toggle(e,!!t)}function ik(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let jf;function aa(r){jf=r}function lc(){if(!jf)throw new Error("Function called outside component initialization");return jf}function ks(r){lc().$$.on_mount.push(r)}function ri(r){lc().$$.on_destroy.push(r)}function js(){const r=lc();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=ik(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function np(r,e){return lc().$$.context.set(r,e),e}function Yf(r){return lc().$$.context.get(r)}function Pn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const qu=[],dn=[];let Ku=[];const qm=[],Kb=Promise.resolve();let Hm=!1;function Jb(){Hm||(Hm=!0,Kb.then(zg))}function Yb(){return Jb(),Kb}function ys(r){Ku.push(r)}function zn(r){qm.push(r)}const Sm=new Set;let Fu=0;function zg(){if(Fu!==0)return;const r=jf;do{try{for(;Fu<qu.length;){const e=qu[Fu];Fu++,aa(e),ok(e.$$)}}catch(e){throw qu.length=0,Fu=0,e}for(aa(null),qu.length=0,Fu=0;dn.length;)dn.pop()();for(let e=0;e<Ku.length;e+=1){const t=Ku[e];Sm.has(t)||(Sm.add(t),t())}Ku.length=0}while(qu.length);for(;qm.length;)qm.pop()();Hm=!1,Sm.clear(),aa(r)}function ok(r){if(r.fragment!==null){r.update(),cr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ys)}}function sk(r){const e=[],t=[];Ku.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ku=e}const Ed=new Set;let El;function Kt(){El={r:0,c:[],p:El}}function Jt(){El.r||cr(El.c),El=El.p}function N(r,e){r&&r.i&&(Ed.delete(r),r.i(e))}function V(r,e,t,n){if(r&&r.o){if(Ed.has(r))return;Ed.add(r),El.c.push(()=>{Ed.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function q0(r,e){const t=e.token={};function n(i,o,u,s){if(e.token!==t)return;e.resolved=s;let d=e.ctx;u!==void 0&&(d=d.slice(),d[u]=s);const p=i&&(e.current=i)(d);let g=!1;e.block&&(e.blocks?e.blocks.forEach((_,x)=>{x!==o&&_&&(Kt(),V(_,1,1,()=>{e.blocks[x]===_&&(e.blocks[x]=null)}),Jt())}):e.block.d(1),p.c(),N(p,1),p.m(e.mount(),e.anchor),g=!0),e.block=p,e.blocks&&(e.blocks[o]=p),g&&zg()}if(ek(r)){const i=lc();if(r.then(o=>{aa(i),n(e.then,1,e.value,o),aa(null)},o=>{if(aa(i),n(e.catch,2,e.error,o),aa(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function ak(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function On(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function lk(r,e){V(r,1,1,()=>{e.delete(r.key)})}function uk(r,e,t,n,i,o,u,s,d,p,g,_){let x=r.length,C=o.length,T=x;const P={};for(;T--;)P[r[T].key]=T;const I=[],E=new Map,L=new Map,O=[];for(T=C;T--;){const q=_(i,o,T),J=t(q);let fe=u.get(J);fe?n&&O.push(()=>fe.p(q,e)):(fe=p(J,q),fe.c()),E.set(J,I[T]=fe),J in P&&L.set(J,Math.abs(T-P[J]))}const F=new Set,Z=new Set;function K(q){N(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=I[C-1],J=r[x-1],fe=q.key,Ee=J.key;q===J?(g=q.first,x--,C--):E.has(Ee)?!u.has(fe)||F.has(fe)?K(q):Z.has(Ee)?x--:L.get(fe)>L.get(Ee)?(Z.add(fe),K(q)):(F.add(Ee),x--):(d(J,u),x--)}for(;x--;){const q=r[x];E.has(q.key)||d(q,u)}for(;C;)K(I[C-1]);return cr(O),I}function In(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],s=e[o];if(s){for(const d in u)d in s||(n[d]=1);for(const d in s)i[d]||(t[d]=s[d],i[d]=1);r[o]=s}else for(const d in u)i[d]=1}for(const u in n)u in t||(t[u]=void 0);return t}function xo(r){return typeof r=="object"&&r!==null?r:{}}function Dn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ue(r){r&&r.c()}function ae(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ys(()=>{const o=r.$$.on_mount.map(Wb).filter(Ga);r.$$.on_destroy?r.$$.on_destroy.push(...o):cr(o),r.$$.on_mount=[]}),i.forEach(ys)}function le(r,e){const t=r.$$;t.fragment!==null&&(sk(t.after_update),cr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ck(r,e){r.$$.dirty[0]===-1&&(qu.push(r),Jb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Mt(r,e,t,n,i,o,u=null,s=[-1]){const d=jf;aa(r);const p=r.$$={fragment:null,ctx:[],props:o,update:at,not_equal:i,bound:U0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:U0(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=T)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](T),g&&ck(r,_)),x}):[],p.update(),g=!0,cr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=rk(e.target);p.fragment&&p.fragment.l(_),_.forEach(H)}else p.fragment&&p.fragment.c();e.intro&&N(r.$$.fragment),ae(r,e.target,e.anchor),zg()}aa(d)}class Et{constructor(){Yn(this,"$$");Yn(this,"$$set")}$destroy(){le(this,1),this.$destroy=at}$on(e,t){if(!Ga(t))return at;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!tk(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const fk="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(fk);const hk="/ltn/assets/arrow-big-up-4ad5891e.png",dk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",pk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==",Qb="/ltn/assets/no_left_turn-dabd0fc9.png",Dg="/ltn/assets/no_right_turn-74f14f9d.png",ew="/ltn/assets/no_straight_turn-b5273de3.png",tw="/ltn/assets/no_u_left_to_right_turn-59028775.png",nw="/ltn/assets/no_u_right_to_left_turn-1ad8fc8a.png",mk="/ltn/assets/logo-97f2d067.svg",rw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function gk(r){let e,t,n,i,o;const u=r[5].default,s=vn(u,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),s&&s.c()},m(d,p){G(d,e,p),B(e,t),s&&s.m(t,null),r[6](e),n=!0,i||(o=[Lt(e,"click",Mf(r[1])),Lt(e,"keydown",r[2])],i=!0)},p(d,[p]){s&&s.p&&(!n||p&16)&&wn(s,u,d,d[4],n?bn(u,d[4],p,null):xn(d[4]),null)},i(d){n||(N(s,d),n=!0)},o(d){V(s,d),n=!1},d(d){d&&H(e),s&&s.d(d),r[6](null),i=!1,cr(o)}}}function _k(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function s(g){g.target==u&&t(3,o=!1)}function d(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){dn[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,s,d,o,i,n,p]}class Rg extends Et{constructor(e){super(),Mt(this,e,_k,gk,St,{show:3})}}function H0(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function G0(r){let e,t,n=r[1]+"",i,o,u,s=r[2]+"",d,p;return{c(){e=U("tr"),t=U("td"),i=Me(n),o=oe(),u=U("td"),d=Me(s),p=oe()},m(g,_){G(g,e,_),B(e,t),B(t,i),B(e,o),B(e,u),B(u,d),B(e,p)},p(g,_){_&1&&n!==(n=g[1]+"")&&kt(i,n),_&1&&s!==(s=g[2]+"")&&kt(d,s)},d(g){g&&H(e)}}}function yk(r){let e,t,n=On(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=G0(H0(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();de(e,"class","svelte-lh2o9l")},m(o,u){G(o,e,u),B(e,t);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[u]){if(u&1){n=On(Object.entries(o[0]));let s;for(s=0;s<n.length;s+=1){const d=H0(o,n,s);i[s]?i[s].p(d,u):(i[s]=G0(d),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}},i:at,o:at,d(o){o&&H(e),_i(i,o)}}}function vk(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Qf extends Et{constructor(e){super(),Mt(this,e,vk,yk,St,{properties:0})}}function rp(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function mr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var iw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ow(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Bg(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var sw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(iw,function(){var t={},n={};function i(u,s,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function s(c,a,f,m){return new(f||(f=Promise))(function(b,k){function S(j){try{R(m.next(j))}catch(X){k(X)}}function M(j){try{R(m.throw(j))}catch(X){k(X)}}function R(j){var X;j.done?b(j.value):(X=j.value,X instanceof f?X:new f(function(Y){Y(X)})).then(S,M)}R((m=m.apply(c,a||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,a){this.x=c,this.y=a}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,f=c.y-this.y;return a*a+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),f=Math.sin(c),m=f*this.x+a*this.y;return this.x=a*this.x-f*this.y,this.y=m,this},_rotateAround:function(c,a){var f=Math.cos(c),m=Math.sin(c),b=a.y+m*(this.x-a.x)+f*(this.y-a.y);return this.x=a.x+f*(this.x-a.x)-m*(this.y-a.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var _=d(p),x=C;function C(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}C.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var T=d(x);let P,I;function E(){return P==null&&(P=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),P}function L(){if(I==null&&(I=!1,E())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<5*5;m++){const b=4*m;a.fillStyle=`rgb(${b},${b+1},${b+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const f=a.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&f[m]!==m){I=!0;break}}}return I||!1}function O(c,a,f,m){const b=new T(c,a,f,m);return function(k){return b.solve(k)}}const F=O(.25,.1,.25,1);function Z(c,a,f){return Math.min(f,Math.max(a,c))}function K(c,a,f){const m=f-a,b=((c-a)%m+m)%m+a;return b===a?f:b}function q(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}let J=1;function fe(c,a,f){const m={};for(const b in c)m[b]=a.call(f||this,c[b],b,c);return m}function Ee(c,a,f){const m={};for(const b in c)a.call(f||this,c[b],b,c)&&(m[b]=c[b]);return m}function ee(c){return Array.isArray(c)?c.map(ee):typeof c=="object"&&c?fe(c,ee):c}const ie={};function ve(c){ie[c]||(typeof console<"u"&&console.warn(c),ie[c]=!0)}function ye(c,a,f){return(f.y-c.y)*(a.x-c.x)>(a.y-c.y)*(f.x-c.x)}function it(c){let a=0;for(let f,m,b=0,k=c.length,S=k-1;b<k;S=b++)f=c[b],m=c[S],a+=(m.x-f.x)*(f.y+m.y);return a}function Be(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let Ne=null;function Ie(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ke(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const k=new VideoFrame(c,{timestamp:0});try{const S=k==null?void 0:k.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const M=S.startsWith("BGR"),R=new Uint8ClampedArray(m*b*4);if(yield k.copyTo(R,function(j,X,Y,se,pe){const _e=4*Math.max(-X,0),we=(Math.max(0,Y)-Y)*se*4+_e,Ce=4*se,Pe=Math.max(0,X),We=Math.max(0,Y);return{rect:{x:Pe,y:We,width:Math.min(j.width,X+se)-Pe,height:Math.min(j.height,Y+pe)-We},layout:[{offset:we,stride:Ce}]}}(c,a,f,m,b)),M)for(let j=0;j<R.length;j+=4){const X=R[j];R[j]=R[j+2],R[j+2]=X}return R}finally{k.close()}})}let ut,pt;const _t="AbortError";function He(){return new Error(_t)}const mt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Pt(c){return mt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const jt="global-dispatcher";class un extends Error{constructor(a,f,m,b){super(`AJAXError: ${f} (${a}): ${m}`),this.status=a,this.statusText=f,this.url=m,this.body=b}}const nn=()=>Be(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,rn=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Pt(c.url);if(m)return m(c,a);if(Be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:jt},a)}if(!(/^file:/.test(f=c.url)||/^file:/.test(nn())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return s(this,void 0,void 0,function*(){const k=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:nn(),signal:b.signal});m.type==="json"&&k.headers.set("Accept","application/json");const S=yield fetch(k);if(!S.ok){const j=yield S.blob();throw new un(S.status,S.statusText,m.url,j)}let M;M=m.type==="arrayBuffer"||m.type==="image"?S.arrayBuffer():m.type==="json"?S.json():S.text();const R=yield M;if(b.signal.aborted)throw He();return{data:R,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}})}(c,a);if(Be(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:jt},a)}var f;return function(m,b){return new Promise((k,S)=>{const M=new XMLHttpRequest;M.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(M.responseType="arraybuffer");for(const R in m.headers)M.setRequestHeader(R,m.headers[R]);m.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=m.credentials==="include",M.onerror=()=>{S(new Error(M.statusText))},M.onload=()=>{if(!b.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let R=M.response;if(m.type==="json")try{R=JSON.parse(M.response)}catch(j){return void S(j)}k({data:R,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const R=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});S(new un(M.status,M.statusText,m.url,R))}},b.signal.addEventListener("abort",()=>{M.abort(),S(He())}),M.send(m.body)})}(c,a)};function pn(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),f=window.location;return a.protocol===f.protocol&&a.host===f.host}function yn(c,a,f){f[c]&&f[c].indexOf(a)!==-1||(f[c]=f[c]||[],f[c].push(a))}function qe(c,a,f){if(f&&f[c]){const m=f[c].indexOf(a);m!==-1&&f[c].splice(m,1)}}class Ge{constructor(a,f={}){q(this,f),this.type=a}}class At extends Ge{constructor(a,f={}){super("error",q({error:a},f))}}class tt{on(a,f){return this._listeners=this._listeners||{},yn(a,f,this._listeners),this}off(a,f){return qe(a,f,this._listeners),qe(a,f,this._oneTimeListeners),this}once(a,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},yn(a,f,this._oneTimeListeners),this):new Promise(m=>this.once(a,m))}fire(a,f){typeof a=="string"&&(a=new Ge(a,f||{}));const m=a.type;if(this.listens(m)){a.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of b)M.call(this,a);const k=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of k)qe(m,M,this._oneTimeListeners),M.call(this,a);const S=this._eventedParent;S&&(q(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(a))}else a instanceof At&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,f){return this._eventedParent=a,this._eventedParentData=f,this}}var he={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xe(c,a){const f={};for(const m in c)m!=="ref"&&(f[m]=c[m]);return cn.forEach(m=>{m in a&&(f[m]=a[m])}),f}function lt(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let f=0;f<c.length;f++)if(!lt(c[f],a[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const f in c)if(!lt(c[f],a[f]))return!1;return!0}return c===a}function Gt(c,a){c.push(a)}function Kn(c,a,f){Gt(f,{command:"addSource",args:[c,a[c]]})}function Gn(c,a,f){Gt(a,{command:"removeSource",args:[c]}),f[c]=!0}function fr(c,a,f,m){Gn(c,f,m),Kn(c,a,f)}function Sr(c,a,f){let m;for(m in c[f])if(Object.prototype.hasOwnProperty.call(c[f],m)&&m!=="data"&&!lt(c[f][m],a[f][m]))return!1;for(m in a[f])if(Object.prototype.hasOwnProperty.call(a[f],m)&&m!=="data"&&!lt(c[f][m],a[f][m]))return!1;return!0}function Cr(c,a,f,m,b,k){c=c||{},a=a||{};for(const S in c)Object.prototype.hasOwnProperty.call(c,S)&&(lt(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}));for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&!Object.prototype.hasOwnProperty.call(c,S)&&(lt(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}))}function xi(c){return c.id}function Un(c,a){return c[a.id]=a,c}class xt{constructor(a,f,m,b){this.message=(a?`${a}: `:"")+m,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)}}function Pr(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}class br extends Error{constructor(a,f){super(f),this.message=f,this.key=a}}class Bi{constructor(a,f=[]){this.parent=a,this.bindings={};for(const[m,b]of f)this.bindings[m]=b}concat(a){return new Bi(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const $n={kind:"null"},Fe={kind:"number"},yt={kind:"string"},bt={kind:"boolean"},Rt={kind:"color"},Qt={kind:"object"},Yt={kind:"value"},vr={kind:"collator"},or={kind:"formatted"},Se={kind:"padding"},ne={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function ge(c,a){return{kind:"array",itemType:c,N:a}}function xe(c){if(c.kind==="array"){const a=xe(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const Oe=[$n,Fe,yt,bt,Rt,or,Qt,ge(Yt),Se,ne,ce];function $e(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!$e(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const f of Oe)if(!$e(f,a))return null}}return`Expected ${xe(c)} but found ${xe(a)} instead.`}function Ue(c,a){return a.some(f=>f.kind===c.kind)}function ze(c,a){return a.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function re(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const Je=.96422,Qe=.82521,nt=4/29,ht=6/29,Dt=3*ht*ht,en=ht*ht*ht,mn=Math.PI/180,Cn=180/Math.PI;function Nn(c){return(c%=360)<0&&(c+=360),c}function Tr([c,a,f,m]){let b,k;const S=Tn((.2225045*(c=Xr(c))+.7168786*(a=Xr(a))+.0606169*(f=Xr(f)))/1);c===a&&a===f?b=k=S:(b=Tn((.4360747*c+.3850649*a+.1430804*f)/Je),k=Tn((.0139322*c+.0971045*a+.7141733*f)/Qe));const M=116*S-16;return[M<0?0:M,500*(b-S),200*(S-k),m]}function Xr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Tn(c){return c>en?Math.pow(c,1/3):c/Dt+nt}function Or([c,a,f,m]){let b=(c+16)/116,k=isNaN(a)?b:b+a/500,S=isNaN(f)?b:b-f/200;return b=1*Mi(b),k=Je*Mi(k),S=Qe*Mi(S),[ii(3.1338561*k-1.6168667*b-.4906146*S),ii(-.9787684*k+1.9161415*b+.033454*S),ii(.0719453*k-.2289914*b+1.4052427*S),m]}function ii(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Mi(c){return c>ht?c*c*c:Dt*(c-nt)}function Fi(c){return parseInt(c.padEnd(2,c),16)/255}function mi(c,a){return qo(a?c/100:c,0,1)}function qo(c,a,f){return Math.min(Math.max(a,c),f)}function hh(c){return!c.some(Number.isNaN)}const bp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class sr{constructor(a,f,m,b=1,k=!0){this.r=a,this.g=f,this.b=m,this.a=b,k||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,f,m,b]))}static parse(a){if(a instanceof sr)return a;if(typeof a!="string")return;const f=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=bp[m];if(b){const[S,M,R]=b;return[S/255,M/255,R/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const S=m.length<6?1:2;let M=1;return[Fi(m.slice(M,M+=S)),Fi(m.slice(M,M+=S)),Fi(m.slice(M,M+=S)),Fi(m.slice(M,M+S)||"ff")]}if(m.startsWith("rgb")){const S=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[M,R,j,X,Y,se,pe,_e,we,Ce,Pe,We]=S,De=[X||" ",pe||" ",Ce].join("");if(De==="  "||De==="  /"||De===",,"||De===",,,"){const je=[j,se,we].join(""),dt=je==="%%%"?100:je===""?255:0;if(dt){const vt=[qo(+R/dt,0,1),qo(+Y/dt,0,1),qo(+_e/dt,0,1),Pe?mi(+Pe,We):1];if(hh(vt))return vt}}return}}const k=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[S,M,R,j,X,Y,se,pe,_e]=k,we=[R||" ",X||" ",se].join("");if(we==="  "||we==="  /"||we===",,"||we===",,,"){const Ce=[+M,qo(+j,0,100),qo(+Y,0,100),pe?mi(+pe,_e):1];if(hh(Ce))return function([Pe,We,De,je]){function dt(vt){const Ht=(vt+Pe/30)%12,tn=We*Math.min(De,1-De);return De-tn*Math.max(-1,Math.min(Ht-3,9-Ht,1))}return Pe=Nn(Pe),We/=100,De/=100,[dt(0),dt(8),dt(4),je]}(Ce)}}}(a);return f?new sr(...f,!1):void 0}get rgb(){const{r:a,g:f,b:m,a:b}=this,k=b||1/0;return this.overwriteGetter("rgb",[a/k,f/k,m/k,b])}get hcl(){return this.overwriteGetter("hcl",function(a){const[f,m,b,k]=Tr(a),S=Math.sqrt(m*m+b*b);return[Math.round(1e4*S)?Nn(Math.atan2(b,m)*Cn):NaN,S,f,k]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Tr(this.rgb))}overwriteGetter(a,f){return Object.defineProperty(this,a,{value:f}),f}toString(){const[a,f,m,b]=this.rgb;return`rgba(${[a,f,m].map(k=>Math.round(255*k)).join(",")},${b})`}}sr.black=new sr(0,0,0,1),sr.white=new sr(1,1,1,1),sr.transparent=new sr(0,0,0,0),sr.red=new sr(1,0,0,1);class cc{constructor(a,f,m){this.sensitivity=a?f?"variant":"case":f?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,f){return this.collator.compare(a,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fc{constructor(a,f,m,b,k){this.text=a,this.image=f,this.scale=m,this.fontStack=b,this.textColor=k}}class eo{constructor(a){this.sections=a}static fromString(a){return new eo([new fc(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof eo?a:eo.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class Oi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Oi)return a;if(typeof a=="number")return new Oi([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const f of a)if(typeof f!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new Oi(a)}}toString(){return JSON.stringify(this.values)}}const tl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof ho)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let f=0;f<a.length;f+=2){const m=a[f],b=a[f+1];if(typeof m!="string"||!tl.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new ho(a)}}toString(){return JSON.stringify(this.values)}}class po{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new po({name:a,available:!1}):null}}function pa(c,a,f,m){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,a,f,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,a,f,m]:[c,a,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof sr||c instanceof cc||c instanceof eo||c instanceof Oi||c instanceof ho||c instanceof po)return!0;if(Array.isArray(c)){for(const a of c)if(!Nl(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!Nl(c[a]))return!1;return!0}return!1}function Kr(c){if(c===null)return $n;if(typeof c=="string")return yt;if(typeof c=="boolean")return bt;if(typeof c=="number")return Fe;if(c instanceof sr)return Rt;if(c instanceof cc)return vr;if(c instanceof eo)return or;if(c instanceof Oi)return Se;if(c instanceof ho)return ce;if(c instanceof po)return ne;if(Array.isArray(c)){const a=c.length;let f;for(const m of c){const b=Kr(m);if(f){if(f===b)continue;f=Yt;break}f=b}return ge(f||Yt,a)}return Qt}function nl(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof sr||c instanceof eo||c instanceof Oi||c instanceof ho||c instanceof po?c.toString():JSON.stringify(c)}class Ss{constructor(a,f){this.type=a,this.value=f}static parse(a,f){if(a.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Nl(a[1]))return f.error("invalid value");const m=a[1];let b=Kr(m);const k=f.expectedType;return b.kind!=="array"||b.N!==0||!k||k.kind!=="array"||typeof k.N=="number"&&k.N!==0||(b=k),new Ss(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class zr{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const jl={string:yt,number:Fe,boolean:bt,object:Qt};class to{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");let m,b=1;const k=a[0];if(k==="array"){let M,R;if(a.length>2){const j=a[1];if(typeof j!="string"||!(j in jl)||j==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);M=jl[j],b++}else M=Yt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return f.error('The length argument to "array" must be a positive integer literal',2);R=a[2],b++}m=ge(M,R)}else{if(!jl[k])throw new Error(`Types doesn't contain name = ${k}`);m=jl[k]}const S=[];for(;b<a.length;b++){const M=f.parse(a[b],b,Yt);if(!M)return null;S.push(M)}return new to(m,S)}evaluate(a){for(let f=0;f<this.args.length;f++){const m=this.args[f].evaluate(a);if(!$e(this.type,Kr(m)))return m;if(f===this.args.length-1)throw new zr(`Expected value to be of type ${xe(this.type)}, but found ${xe(Kr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Ul={"to-boolean":bt,"to-color":Rt,"to-number":Fe,"to-string":yt};class Ho{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[0];if(!Ul[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return f.error("Expected one argument.");const b=Ul[m],k=[];for(let S=1;S<a.length;S++){const M=f.parse(a[S],S,Yt);if(!M)return null;k.push(M)}return new Ho(b,k)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let f,m;for(const b of this.args){if(f=b.evaluate(a),m=null,f instanceof sr)return f;if(typeof f=="string"){const k=a.parseColor(f);if(k)return k}else if(Array.isArray(f)&&(m=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:pa(f[0],f[1],f[2],f[3]),!m))return new sr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new zr(m||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const m of this.args){f=m.evaluate(a);const b=Oi.parse(f);if(b)return b}throw new zr(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const m of this.args){f=m.evaluate(a);const b=ho.parse(f);if(b)return b}throw new zr(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const m of this.args){if(f=m.evaluate(a),f===null)return 0;const b=Number(f);if(!isNaN(b))return b}throw new zr(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return eo.fromString(nl(this.args[0].evaluate(a)));case"resolvedImage":return po.fromString(nl(this.args[0].evaluate(a)));default:return nl(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const rl=["Unknown","Point","LineString","Polygon"];class ar{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let f=this._parseColorCache[a];return f||(f=this._parseColorCache[a]=sr.parse(a)),f}}class Vl{constructor(a,f,m=[],b,k=new Bi,S=[]){this.registry=a,this.path=m,this.key=m.map(M=>`[${M}]`).join(""),this.scope=k,this.errors=S,this.expectedType=b,this._isConstant=f}parse(a,f,m,b,k={}){return f?this.concat(f,m,b)._parse(a,k):this._parse(a,k)}_parse(a,f){function m(b,k,S){return S==="assert"?new to(k,[b]):S==="coerce"?new Ho(k,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const k=this.registry[b];if(k){let S=k.parse(a,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,R=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||R.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(M.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(M,R))return null}else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"assert")}if(!(S instanceof Ss)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const M=new ar;try{S=new Ss(S.type,S.evaluate(M))}catch(R){return this.error(R.message),null}}return S}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,f,m){const b=typeof a=="number"?this.path.concat(a):this.path,k=m?this.scope.concat(m):this.scope;return new Vl(this.registry,this._isConstant,b,f||null,k,this.errors)}error(a,...f){const m=`${this.key}${f.map(b=>`[${b}]`).join("")}`;this.errors.push(new br(m,a))}checkSubtype(a,f){const m=$e(a,f);return m&&this.error(m),m}}class ma{constructor(a,f,m){this.type=vr,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=f}static parse(a,f){if(a.length!==2)return f.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return f.error("Collator options argument must be an object.");const b=f.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,bt);if(!b)return null;const k=f.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,bt);if(!k)return null;let S=null;return m.locale&&(S=f.parse(m.locale,1,yt),!S)?null:new ma(b,k,S)}evaluate(a){return new cc(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const Cs=8192;function ql(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function il(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function wp(c,a){const f=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(f*b*Cs),Math.round(m*b*Cs)]}function dh(c,a,f){const m=c[0]-a[0],b=c[1]-a[1],k=c[0]-f[0],S=c[1]-f[1];return m*S-k*b==0&&m*k<=0&&b*S<=0}function Hl(c,a){let f=!1;for(let S=0,M=a.length;S<M;S++){const R=a[S];for(let j=0,X=R.length;j<X-1;j++){if(dh(c,R[j],R[j+1]))return!1;(b=R[j])[1]>(m=c)[1]!=(k=R[j+1])[1]>m[1]&&m[0]<(k[0]-b[0])*(m[1]-b[1])/(k[1]-b[1])+b[0]&&(f=!f)}}var m,b,k;return f}function xp(c,a){for(let f=0;f<a.length;f++)if(Hl(c,a[f]))return!0;return!1}function ph(c,a,f,m){const b=m[0]-f[0],k=m[1]-f[1],S=(c[0]-f[0])*k-b*(c[1]-f[1]),M=(a[0]-f[0])*k-b*(a[1]-f[1]);return S>0&&M<0||S<0&&M>0}function Ap(c,a,f){for(const j of f)for(let X=0;X<j.length-1;++X)if((M=[(S=j[X+1])[0]-(k=j[X])[0],S[1]-k[1]])[0]*(R=[(b=a)[0]-(m=c)[0],b[1]-m[1]])[1]-M[1]*R[0]!=0&&ph(m,b,k,S)&&ph(k,S,m,b))return!0;var m,b,k,S,M,R;return!1}function mh(c,a){for(let f=0;f<c.length;++f)if(!Hl(c[f],a))return!1;for(let f=0;f<c.length-1;++f)if(Ap(c[f],c[f+1],a))return!1;return!0}function gh(c,a){for(let f=0;f<a.length;f++)if(mh(c,a[f]))return!0;return!1}function Gl(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=[];for(let S=0;S<c[b].length;S++){const M=wp(c[b][S],f);ql(a,M),k.push(M)}m.push(k)}return m}function _h(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=Gl(c[b],a,f);m.push(k)}return m}function yh(c,a,f,m){if(c[0]<f[0]||c[0]>f[2]){const b=.5*m;let k=c[0]-f[0]>b?-m:f[0]-c[0]>b?m:0;k===0&&(k=c[0]-f[2]>b?-m:f[2]-c[0]>b?m:0),c[0]+=k}ql(a,c)}function Wl(c,a,f,m){const b=Math.pow(2,m.z)*Cs,k=[m.x*Cs,m.y*Cs],S=[];for(const M of c)for(const R of M){const j=[R.x+k[0],R.y+k[1]];yh(j,a,f,b),S.push(j)}return S}function vh(c,a,f,m){const b=Math.pow(2,m.z)*Cs,k=[m.x*Cs,m.y*Cs],S=[];for(const R of c){const j=[];for(const X of R){const Y=[X.x+k[0],X.y+k[1]];ql(a,Y),j.push(Y)}S.push(j)}if(a[2]-a[0]<=b/2){(M=a)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of S)for(const j of R)yh(j,a,f,b)}var M;return S}class Vs{constructor(a,f){this.type=bt,this.geojson=a,this.geometries=f}static parse(a,f){if(a.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Nl(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const b=[];for(const k of m.features){const{type:S,coordinates:M}=k.geometry;S==="Polygon"&&b.push(M),S==="MultiPolygon"&&b.push(...M)}if(b.length)return new Vs(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Vs(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Vs(m,m)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=Gl(m.coordinates,k,S),R=Wl(f.geometry(),b,k,S);if(!il(b,k))return!1;for(const j of R)if(!Hl(j,M))return!1}if(m.type==="MultiPolygon"){const M=_h(m.coordinates,k,S),R=Wl(f.geometry(),b,k,S);if(!il(b,k))return!1;for(const j of R)if(!xp(j,M))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=Gl(m.coordinates,k,S),R=vh(f.geometry(),b,k,S);if(!il(b,k))return!1;for(const j of R)if(!mh(j,M))return!1}if(m.type==="MultiPolygon"){const M=_h(m.coordinates,k,S),R=vh(f.geometry(),b,k,S);if(!il(b,k))return!1;for(const j of R)if(!gh(j,M))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Zl{constructor(a,f){this.type=f.type,this.name=a,this.boundExpression=f}static parse(a,f){if(a.length!==2||typeof a[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const m=a[1];return f.scope.has(m)?new Zl(m,f.scope.get(m)):f.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class no{constructor(a,f,m,b){this.name=a,this.type=f,this._evaluate=m,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,f){const m=a[0],b=no.definitions[m];if(!b)return f.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const k=Array.isArray(b)?b[0]:b.type,S=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=S.filter(([j])=>!Array.isArray(j)||j.length===a.length-1);let R=null;for(const[j,X]of M){R=new Vl(f.registry,ol,f.path,null,f.scope);const Y=[];let se=!1;for(let pe=1;pe<a.length;pe++){const _e=a[pe],we=Array.isArray(j)?j[pe-1]:j.type,Ce=R.parse(_e,1+Y.length,we);if(!Ce){se=!0;break}Y.push(Ce)}if(!se)if(Array.isArray(j)&&j.length!==Y.length)R.error(`Expected ${j.length} arguments, but found ${Y.length} instead.`);else{for(let pe=0;pe<Y.length;pe++){const _e=Array.isArray(j)?j[pe]:j.type,we=Y[pe];R.concat(pe+1).checkSubtype(_e,we.type)}if(R.errors.length===0)return new no(m,k,X,Y)}}if(M.length===1)f.errors.push(...R.errors);else{const j=(M.length?M:S).map(([Y])=>{return se=Y,Array.isArray(se)?`(${se.map(xe).join(", ")})`:`(${xe(se.type)}...)`;var se}).join(" | "),X=[];for(let Y=1;Y<a.length;Y++){const se=f.parse(a[Y],1+X.length);if(!se)return null;X.push(xe(se.type))}f.error(`Expected arguments of type ${j}, but found (${X.join(", ")}) instead.`)}return null}static register(a,f){no.definitions=f;for(const m in f)a[m]=no}}function ol(c){if(c instanceof Zl)return ol(c.boundExpression);if(c instanceof no&&c.name==="error"||c instanceof ma||c instanceof Vs)return!1;const a=c instanceof Ho||c instanceof to;let f=!0;return c.eachChild(m=>{f=a?f&&ol(m):f&&m instanceof Ss}),!!f&&Xl(c)&&al(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xl(c){if(c instanceof no&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Vs)return!1;let a=!0;return c.eachChild(f=>{a&&!Xl(f)&&(a=!1)}),a}function sl(c){if(c instanceof no&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(f=>{a&&!sl(f)&&(a=!1)}),a}function al(c,a){if(c instanceof no&&a.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(m=>{f&&!al(m,a)&&(f=!1)}),f}function ll(c,a){const f=c.length-1;let m,b,k=0,S=f,M=0;for(;k<=S;)if(M=Math.floor((k+S)/2),m=c[M],b=c[M+1],m<=a){if(M===f||a<b)return M;k=M+1}else{if(!(m>a))throw new zr("Input is not a number.");S=M-1}return 0}class ul{constructor(a,f,m){this.type=a,this.input=f,this.labels=[],this.outputs=[];for(const[b,k]of m)this.labels.push(b),this.outputs.push(k)}static parse(a,f){if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");const m=f.parse(a[1],1,Fe);if(!m)return null;const b=[];let k=null;f.expectedType&&f.expectedType.kind!=="value"&&(k=f.expectedType);for(let S=1;S<a.length;S+=2){const M=S===1?-1/0:a[S],R=a[S+1],j=S,X=S+1;if(typeof M!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(b.length&&b[b.length-1][0]>=M)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const Y=f.parse(R,X,k);if(!Y)return null;k=k||Y.type,b.push([M,Y])}return new ul(k,m,b)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;return b>=f[k-1]?m[k-1].evaluate(a):m[ll(f,b)].evaluate(a)}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function kp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Sp=bh;function bh(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}bh.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var Cp=kp(Sp);function qs(c,a,f){return c+f*(a-c)}function Kl(c,a,f){return c.map((m,b)=>qs(m,a[b],f))}const Ei={number:qs,color:function(c,a,f,m="rgb"){switch(m){case"rgb":{const[b,k,S,M]=Kl(c.rgb,a.rgb,f);return new sr(b,k,S,M,!1)}case"hcl":{const[b,k,S,M]=c.hcl,[R,j,X,Y]=a.hcl;let se,pe;if(isNaN(b)||isNaN(R))isNaN(b)?isNaN(R)?se=NaN:(se=R,S!==1&&S!==0||(pe=j)):(se=b,X!==1&&X!==0||(pe=k));else{let We=R-b;R>b&&We>180?We-=360:R<b&&b-R>180&&(We+=360),se=b+f*We}const[_e,we,Ce,Pe]=function([We,De,je,dt]){return We=isNaN(We)?0:We*mn,Or([je,Math.cos(We)*De,Math.sin(We)*De,dt])}([se,pe??qs(k,j,f),qs(S,X,f),qs(M,Y,f)]);return new sr(_e,we,Ce,Pe,!1)}case"lab":{const[b,k,S,M]=Or(Kl(c.lab,a.lab,f));return new sr(b,k,S,M,!1)}}},array:Kl,padding:function(c,a,f){return new Oi(Kl(c.values,a.values,f))},variableAnchorOffsetCollection:function(c,a,f){const m=c.values,b=a.values;if(m.length!==b.length)throw new zr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const k=[];for(let S=0;S<m.length;S+=2){if(m[S]!==b[S])throw new zr(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${m[S]}, to[${S}]: ${b[S]}`);k.push(m[S]);const[M,R]=m[S+1],[j,X]=b[S+1];k.push([qs(M,j,f),qs(R,X,f)])}return new ho(k)}};class Ai{constructor(a,f,m,b,k){this.type=a,this.operator=f,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[S,M]of k)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(a,f,m,b){let k=0;if(a.name==="exponential")k=Jn(f,a.base,m,b);else if(a.name==="linear")k=Jn(f,1,m,b);else if(a.name==="cubic-bezier"){const S=a.controlPoints;k=new Cp(S[0],S[1],S[2],S[3]).solve(Jn(f,1,m,b))}return k}static parse(a,f){let[m,b,k,...S]=a;if(!Array.isArray(b)||b.length===0)return f.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const j=b[1];if(typeof j!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:j}}else{if(b[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const j=b.slice(1);if(j.length!==4||j.some(X=>typeof X!="number"||X<0||X>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:j}}}if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(k=f.parse(k,2,Fe),!k)return null;const M=[];let R=null;m==="interpolate-hcl"||m==="interpolate-lab"?R=Rt:f.expectedType&&f.expectedType.kind!=="value"&&(R=f.expectedType);for(let j=0;j<S.length;j+=2){const X=S[j],Y=S[j+1],se=j+3,pe=j+4;if(typeof X!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(M.length&&M[M.length-1][0]>=X)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);const _e=f.parse(Y,pe,R);if(!_e)return null;R=R||_e.type,M.push([X,_e])}return re(R,Fe)||re(R,Rt)||re(R,Se)||re(R,ce)||re(R,ge(Fe))?new Ai(R,m,b,k,M):f.error(`Type ${xe(R)} is not interpolatable.`)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;if(b>=f[k-1])return m[k-1].evaluate(a);const S=ll(f,b),M=Ai.interpolationFactor(this.interpolation,b,f[S],f[S+1]),R=m[S].evaluate(a),j=m[S+1].evaluate(a);switch(this.operator){case"interpolate":return Ei[this.type.kind](R,j,M);case"interpolate-hcl":return Ei.color(R,j,M,"hcl");case"interpolate-lab":return Ei.color(R,j,M,"lab")}}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Jn(c,a,f,m){const b=m-f,k=c-f;return b===0?0:a===1?k/b:(Math.pow(a,k)-1)/(Math.pow(a,b)-1)}class Jl{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expectected at least one argument.");let m=null;const b=f.expectedType;b&&b.kind!=="value"&&(m=b);const k=[];for(const M of a.slice(1)){const R=f.parse(M,1+k.length,m,void 0,{typeAnnotation:"omit"});if(!R)return null;m=m||R.type,k.push(R)}if(!m)throw new Error("No output type");const S=b&&k.some(M=>$e(b,M.type));return new Jl(S?Yt:m,k)}evaluate(a){let f,m=null,b=0;for(const k of this.args)if(b++,m=k.evaluate(a),m&&m instanceof po&&!m.available&&(f||(f=m.name),m=null,b===this.args.length&&(m=f)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class Yl{constructor(a,f){this.type=f.type,this.bindings=[].concat(a),this.result=f}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const f of this.bindings)a(f[1]);a(this.result)}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let k=1;k<a.length-1;k+=2){const S=a[k];if(typeof S!="string")return f.error(`Expected string, but found ${typeof S} instead.`,k);if(/[^a-zA-Z0-9_]/.test(S))return f.error("Variable names must contain only alphanumeric characters or '_'.",k);const M=f.parse(a[k+1],k+1);if(!M)return null;m.push([S,M])}const b=f.parse(a[a.length-1],a.length-1,f.expectedType,m);return b?new Yl(m,b):null}outputDefined(){return this.result.outputDefined()}}class hc{constructor(a,f,m){this.type=a,this.index=f,this.input=m}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Fe),b=f.parse(a[2],2,ge(f.expectedType||Yt));return m&&b?new hc(b.type.itemType,m,b):null}evaluate(a){const f=this.index.evaluate(a),m=this.input.evaluate(a);if(f<0)throw new zr(`Array index out of bounds: ${f} < 0.`);if(f>=m.length)throw new zr(`Array index out of bounds: ${f} > ${m.length-1}.`);if(f!==Math.floor(f))throw new zr(`Array index must be an integer, but found ${f} instead.`);return m[f]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class dc{constructor(a,f){this.type=bt,this.needle=a,this.haystack=f}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Yt),b=f.parse(a[2],2,Yt);return m&&b?Ue(m.type,[bt,yt,Fe,$n,Yt])?new dc(m,b):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(m.type)} instead`):null}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!ze(f,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(Kr(f))} instead.`);if(!ze(m,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${xe(Kr(m))} instead.`);return m.indexOf(f)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Ql{constructor(a,f,m){this.type=Fe,this.needle=a,this.haystack=f,this.fromIndex=m}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Yt),b=f.parse(a[2],2,Yt);if(!m||!b)return null;if(!Ue(m.type,[bt,yt,Fe,$n,Yt]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,Fe);return k?new Ql(m,b,k):null}return new Ql(m,b)}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!ze(f,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(Kr(f))} instead.`);if(!ze(m,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${xe(Kr(m))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(a);return m.indexOf(f,b)}return m.indexOf(f)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class pc{constructor(a,f,m,b,k,S){this.inputType=a,this.type=f,this.input=m,this.cases=b,this.outputs=k,this.otherwise=S}static parse(a,f){if(a.length<5)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return f.error("Expected an even number of arguments.");let m,b;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);const k={},S=[];for(let j=2;j<a.length-1;j+=2){let X=a[j];const Y=a[j+1];Array.isArray(X)||(X=[X]);const se=f.concat(j);if(X.length===0)return se.error("Expected at least one branch label.");for(const _e of X){if(typeof _e!="number"&&typeof _e!="string")return se.error("Branch labels must be numbers or strings.");if(typeof _e=="number"&&Math.abs(_e)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof _e=="number"&&Math.floor(_e)!==_e)return se.error("Numeric branch labels must be integer values.");if(m){if(se.checkSubtype(m,Kr(_e)))return null}else m=Kr(_e);if(k[String(_e)]!==void 0)return se.error("Branch labels must be unique.");k[String(_e)]=S.length}const pe=f.parse(Y,j,b);if(!pe)return null;b=b||pe.type,S.push(pe)}const M=f.parse(a[1],1,Yt);if(!M)return null;const R=f.parse(a[a.length-1],a.length-1,b);return R?M.type.kind!=="value"&&f.concat(1).checkSubtype(m,M.type)?null:new pc(m,b,M,k,S,R):null}evaluate(a){const f=this.input.evaluate(a);return(Kr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class mc{constructor(a,f,m){this.type=a,this.branches=f,this.otherwise=m}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return f.error("Expected an odd number of arguments.");let m;f.expectedType&&f.expectedType.kind!=="value"&&(m=f.expectedType);const b=[];for(let S=1;S<a.length-1;S+=2){const M=f.parse(a[S],S,bt);if(!M)return null;const R=f.parse(a[S+1],S+1,m);if(!R)return null;b.push([M,R]),m=m||R.type}const k=f.parse(a[a.length-1],a.length-1,m);if(!k)return null;if(!m)throw new Error("Can't infer output type");return new mc(m,b,k)}evaluate(a){for(const[f,m]of this.branches)if(f.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[f,m]of this.branches)a(f),a(m);a(this.otherwise)}outputDefined(){return this.branches.every(([a,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class eu{constructor(a,f,m,b){this.type=a,this.input=f,this.beginIndex=m,this.endIndex=b}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Yt),b=f.parse(a[2],2,Fe);if(!m||!b)return null;if(!Ue(m.type,[ge(Yt),yt,Yt]))return f.error(`Expected first argument to be of type array or string, but found ${xe(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,Fe);return k?new eu(m.type,m,b,k):null}return new eu(m.type,m,b)}evaluate(a){const f=this.input.evaluate(a),m=this.beginIndex.evaluate(a);if(!ze(f,["string","array"]))throw new zr(`Expected first argument to be of type array or string, but found ${xe(Kr(f))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(a);return f.slice(m,b)}return f.slice(m)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function wh(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function xh(c,a,f,m){return m.compare(a,f)===0}function ga(c,a,f){const m=c!=="=="&&c!=="!=";return class aw{constructor(k,S,M){this.type=bt,this.lhs=k,this.rhs=S,this.collator=M,this.hasUntypedArgument=k.type.kind==="value"||S.type.kind==="value"}static parse(k,S){if(k.length!==3&&k.length!==4)return S.error("Expected two or three arguments.");const M=k[0];let R=S.parse(k[1],1,Yt);if(!R)return null;if(!wh(M,R.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${xe(R.type)}'.`);let j=S.parse(k[2],2,Yt);if(!j)return null;if(!wh(M,j.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${xe(j.type)}'.`);if(R.type.kind!==j.type.kind&&R.type.kind!=="value"&&j.type.kind!=="value")return S.error(`Cannot compare types '${xe(R.type)}' and '${xe(j.type)}'.`);m&&(R.type.kind==="value"&&j.type.kind!=="value"?R=new to(j.type,[R]):R.type.kind!=="value"&&j.type.kind==="value"&&(j=new to(R.type,[j])));let X=null;if(k.length===4){if(R.type.kind!=="string"&&j.type.kind!=="string"&&R.type.kind!=="value"&&j.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(X=S.parse(k[3],3,vr),!X)return null}return new aw(R,j,X)}evaluate(k){const S=this.lhs.evaluate(k),M=this.rhs.evaluate(k);if(m&&this.hasUntypedArgument){const R=Kr(S),j=Kr(M);if(R.kind!==j.kind||R.kind!=="string"&&R.kind!=="number")throw new zr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${R.kind}, ${j.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const R=Kr(S),j=Kr(M);if(R.kind!=="string"||j.kind!=="string")return a(k,S,M)}return this.collator?f(k,S,M,this.collator.evaluate(k)):a(k,S,M)}eachChild(k){k(this.lhs),k(this.rhs),this.collator&&k(this.collator)}outputDefined(){return!0}}}const Tp=ga("==",function(c,a,f){return a===f},xh),Mp=ga("!=",function(c,a,f){return a!==f},function(c,a,f,m){return!xh(0,a,f,m)}),Ep=ga("<",function(c,a,f){return a<f},function(c,a,f,m){return m.compare(a,f)<0}),Lp=ga(">",function(c,a,f){return a>f},function(c,a,f,m){return m.compare(a,f)>0}),Ip=ga("<=",function(c,a,f){return a<=f},function(c,a,f,m){return m.compare(a,f)<=0}),Pp=ga(">=",function(c,a,f){return a>=f},function(c,a,f,m){return m.compare(a,f)>=0});class gc{constructor(a,f,m,b,k){this.type=yt,this.number=a,this.locale=f,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=k}static parse(a,f){if(a.length!==3)return f.error("Expected two arguments.");const m=f.parse(a[1],1,Fe);if(!m)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return f.error("NumberFormat options argument must be an object.");let k=null;if(b.locale&&(k=f.parse(b.locale,1,yt),!k))return null;let S=null;if(b.currency&&(S=f.parse(b.currency,1,yt),!S))return null;let M=null;if(b["min-fraction-digits"]&&(M=f.parse(b["min-fraction-digits"],1,Fe),!M))return null;let R=null;return b["max-fraction-digits"]&&(R=f.parse(b["max-fraction-digits"],1,Fe),!R)?null:new gc(m,k,S,M,R)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class tu{constructor(a){this.type=or,this.sections=a}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return f.error("First argument must be an image or text section.");const b=[];let k=!1;for(let S=1;S<=a.length-1;++S){const M=a[S];if(k&&typeof M=="object"&&!Array.isArray(M)){k=!1;let R=null;if(M["font-scale"]&&(R=f.parse(M["font-scale"],1,Fe),!R))return null;let j=null;if(M["text-font"]&&(j=f.parse(M["text-font"],1,ge(yt)),!j))return null;let X=null;if(M["text-color"]&&(X=f.parse(M["text-color"],1,Rt),!X))return null;const Y=b[b.length-1];Y.scale=R,Y.font=j,Y.textColor=X}else{const R=f.parse(a[S],1,Yt);if(!R)return null;const j=R.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,b.push({content:R,scale:null,font:null,textColor:null})}}return new tu(b)}evaluate(a){return new eo(this.sections.map(f=>{const m=f.content.evaluate(a);return Kr(m)===ne?new fc("",m,null,null,null):new fc(nl(m),null,f.scale?f.scale.evaluate(a):null,f.font?f.font.evaluate(a).join(","):null,f.textColor?f.textColor.evaluate(a):null)}))}eachChild(a){for(const f of this.sections)a(f.content),f.scale&&a(f.scale),f.font&&a(f.font),f.textColor&&a(f.textColor)}outputDefined(){return!1}}class _c{constructor(a){this.type=ne,this.input=a}static parse(a,f){if(a.length!==2)return f.error("Expected two arguments.");const m=f.parse(a[1],1,yt);return m?new _c(m):f.error("No image name provided.")}evaluate(a){const f=this.input.evaluate(a),m=po.fromString(f);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(f)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class yc{constructor(a){this.type=Fe,this.input=a}static parse(a,f){if(a.length!==2)return f.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=f.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${xe(m.type)} instead.`):new yc(m):null}evaluate(a){const f=this.input.evaluate(a);if(typeof f=="string"||Array.isArray(f))return f.length;throw new zr(`Expected value to be of type string or array, but found ${xe(Kr(f))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const _a={"==":Tp,"!=":Mp,">":Lp,"<":Ep,">=":Pp,"<=":Ip,array:to,at:hc,boolean:to,case:mc,coalesce:Jl,collator:ma,format:tu,image:_c,in:dc,"index-of":Ql,interpolate:Ai,"interpolate-hcl":Ai,"interpolate-lab":Ai,length:yc,let:Yl,literal:Ss,match:pc,number:to,"number-format":gc,object:to,slice:eu,step:ul,string:to,"to-boolean":Ho,"to-color":Ho,"to-number":Ho,"to-string":Ho,var:Zl,within:Vs};function Ah(c,[a,f,m,b]){a=a.evaluate(c),f=f.evaluate(c),m=m.evaluate(c);const k=b?b.evaluate(c):1,S=pa(a,f,m,k);if(S)throw new zr(S);return new sr(a/255,f/255,m/255,k,!1)}function kh(c,a){return c in a}function vc(c,a){const f=a[c];return f===void 0?null:f}function Hs(c){return{type:c}}function Sh(c){return{result:"success",value:c}}function ya(c){return{result:"error",value:c}}function va(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Ch(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function bc(c){return!!c.expression&&c.expression.interpolated}function Wn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function nu(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function zp(c){return c}function Th(c,a){const f=a.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",b=m||!(m||c.property!==void 0),k=c.type||(bc(a)?"exponential":"interval");if(f||a.type==="padding"){const X=f?sr.parse:Oi.parse;(c=Pr({},c)).stops&&(c.stops=c.stops.map(Y=>[Y[0],X(Y[1])])),c.default=X(c.default?c.default:a.default)}if(c.colorSpace&&(S=c.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var S;let M,R,j;if(k==="exponential")M=Vn;else if(k==="interval")M=Dp;else if(k==="categorical"){M=Gr,R=Object.create(null);for(const X of c.stops)R[X[0]]=X[1];j=typeof c.stops[0][0]}else{if(k!=="identity")throw new Error(`Unknown function type "${k}"`);M=wc}if(m){const X={},Y=[];for(let _e=0;_e<c.stops.length;_e++){const we=c.stops[_e],Ce=we[0].zoom;X[Ce]===void 0&&(X[Ce]={zoom:Ce,type:c.type,property:c.property,default:c.default,stops:[]},Y.push(Ce)),X[Ce].stops.push([we[0].value,we[1]])}const se=[];for(const _e of Y)se.push([X[_e].zoom,Th(X[_e],a)]);const pe={name:"linear"};return{kind:"composite",interpolationType:pe,interpolationFactor:Ai.interpolationFactor.bind(void 0,pe),zoomStops:se.map(_e=>_e[0]),evaluate:({zoom:_e},we)=>Vn({stops:se,base:c.base},a,_e).evaluate(_e,we)}}if(b){const X=k==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:Ai.interpolationFactor.bind(void 0,X),zoomStops:c.stops.map(Y=>Y[0]),evaluate:({zoom:Y})=>M(c,a,Y,R,j)}}return{kind:"source",evaluate(X,Y){const se=Y&&Y.properties?Y.properties[c.property]:void 0;return se===void 0?cl(c.default,a.default):M(c,a,se,R,j)}}}function cl(c,a,f){return c!==void 0?c:a!==void 0?a:f!==void 0?f:void 0}function Gr(c,a,f,m,b){return cl(typeof f===b?m[f]:void 0,c.default,a.default)}function Dp(c,a,f){if(Wn(f)!=="number")return cl(c.default,a.default);const m=c.stops.length;if(m===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[m-1][0])return c.stops[m-1][1];const b=ll(c.stops.map(k=>k[0]),f);return c.stops[b][1]}function Vn(c,a,f){const m=c.base!==void 0?c.base:1;if(Wn(f)!=="number")return cl(c.default,a.default);const b=c.stops.length;if(b===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[b-1][0])return c.stops[b-1][1];const k=ll(c.stops.map(X=>X[0]),f),S=function(X,Y,se,pe){const _e=pe-se,we=X-se;return _e===0?0:Y===1?we/_e:(Math.pow(Y,we)-1)/(Math.pow(Y,_e)-1)}(f,m,c.stops[k][0],c.stops[k+1][0]),M=c.stops[k][1],R=c.stops[k+1][1],j=Ei[a.type]||zp;return typeof M.evaluate=="function"?{evaluate(...X){const Y=M.evaluate.apply(void 0,X),se=R.evaluate.apply(void 0,X);if(Y!==void 0&&se!==void 0)return j(Y,se,S,c.colorSpace)}}:j(M,R,S,c.colorSpace)}function wc(c,a,f){switch(a.type){case"color":f=sr.parse(f);break;case"formatted":f=eo.fromString(f.toString());break;case"resolvedImage":f=po.fromString(f.toString());break;case"padding":f=Oi.parse(f);break;default:Wn(f)===a.type||a.type==="enum"&&a.values[f]||(f=void 0)}return cl(f,c.default,a.default)}no.register(_a,{error:[{kind:"error"},[yt],(c,[a])=>{throw new zr(a.evaluate(c))}],typeof:[yt,[Yt],(c,[a])=>xe(Kr(a.evaluate(c)))],"to-rgba":[ge(Fe,4),[Rt],(c,[a])=>{const[f,m,b,k]=a.evaluate(c).rgb;return[255*f,255*m,255*b,k]}],rgb:[Rt,[Fe,Fe,Fe],Ah],rgba:[Rt,[Fe,Fe,Fe,Fe],Ah],has:{type:bt,overloads:[[[yt],(c,[a])=>kh(a.evaluate(c),c.properties())],[[yt,Qt],(c,[a,f])=>kh(a.evaluate(c),f.evaluate(c))]]},get:{type:Yt,overloads:[[[yt],(c,[a])=>vc(a.evaluate(c),c.properties())],[[yt,Qt],(c,[a,f])=>vc(a.evaluate(c),f.evaluate(c))]]},"feature-state":[Yt,[yt],(c,[a])=>vc(a.evaluate(c),c.featureState||{})],properties:[Qt,[],c=>c.properties()],"geometry-type":[yt,[],c=>c.geometryType()],id:[Yt,[],c=>c.id()],zoom:[Fe,[],c=>c.globals.zoom],"heatmap-density":[Fe,[],c=>c.globals.heatmapDensity||0],"line-progress":[Fe,[],c=>c.globals.lineProgress||0],accumulated:[Yt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Fe,Hs(Fe),(c,a)=>{let f=0;for(const m of a)f+=m.evaluate(c);return f}],"*":[Fe,Hs(Fe),(c,a)=>{let f=1;for(const m of a)f*=m.evaluate(c);return f}],"-":{type:Fe,overloads:[[[Fe,Fe],(c,[a,f])=>a.evaluate(c)-f.evaluate(c)],[[Fe],(c,[a])=>-a.evaluate(c)]]},"/":[Fe,[Fe,Fe],(c,[a,f])=>a.evaluate(c)/f.evaluate(c)],"%":[Fe,[Fe,Fe],(c,[a,f])=>a.evaluate(c)%f.evaluate(c)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(c,[a,f])=>Math.pow(a.evaluate(c),f.evaluate(c))],sqrt:[Fe,[Fe],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))],log2:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[Fe,[Fe],(c,[a])=>Math.sin(a.evaluate(c))],cos:[Fe,[Fe],(c,[a])=>Math.cos(a.evaluate(c))],tan:[Fe,[Fe],(c,[a])=>Math.tan(a.evaluate(c))],asin:[Fe,[Fe],(c,[a])=>Math.asin(a.evaluate(c))],acos:[Fe,[Fe],(c,[a])=>Math.acos(a.evaluate(c))],atan:[Fe,[Fe],(c,[a])=>Math.atan(a.evaluate(c))],min:[Fe,Hs(Fe),(c,a)=>Math.min(...a.map(f=>f.evaluate(c)))],max:[Fe,Hs(Fe),(c,a)=>Math.max(...a.map(f=>f.evaluate(c)))],abs:[Fe,[Fe],(c,[a])=>Math.abs(a.evaluate(c))],round:[Fe,[Fe],(c,[a])=>{const f=a.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[Fe,[Fe],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[Fe,[Fe],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[bt,[yt,Yt],(c,[a,f])=>c.properties()[a.value]===f.value],"filter-id-==":[bt,[Yt],(c,[a])=>c.id()===a.value],"filter-type-==":[bt,[yt],(c,[a])=>c.geometryType()===a.value],"filter-<":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<b}],"filter-id-<":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<m}],"filter->":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>b}],"filter-id->":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>m}],"filter-<=":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<=m}],"filter->=":[bt,[yt,Yt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[bt,[Yt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>=m}],"filter-has":[bt,[Yt],(c,[a])=>a.value in c.properties()],"filter-has-id":[bt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[bt,[ge(yt)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[bt,[ge(Yt)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[bt,[yt,ge(Yt)],(c,[a,f])=>f.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[bt,[yt,ge(Yt)],(c,[a,f])=>function(m,b,k,S){for(;k<=S;){const M=k+S>>1;if(b[M]===m)return!0;b[M]>m?S=M-1:k=M+1}return!1}(c.properties()[a.value],f.value,0,f.value.length-1)],all:{type:bt,overloads:[[[bt,bt],(c,[a,f])=>a.evaluate(c)&&f.evaluate(c)],[Hs(bt),(c,a)=>{for(const f of a)if(!f.evaluate(c))return!1;return!0}]]},any:{type:bt,overloads:[[[bt,bt],(c,[a,f])=>a.evaluate(c)||f.evaluate(c)],[Hs(bt),(c,a)=>{for(const f of a)if(f.evaluate(c))return!0;return!1}]]},"!":[bt,[bt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[bt,[yt],(c,[a])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(a.evaluate(c))}],upcase:[yt,[yt],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[yt,[yt],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[yt,Hs(Yt),(c,a)=>a.map(f=>nl(f.evaluate(c))).join("")],"resolved-locale":[yt,[vr],(c,[a])=>a.evaluate(c).resolvedLocale()]});class wr{constructor(a,f){var m;this.expression=a,this._warningHistory={},this._evaluator=new ar,this._defaultValue=f?(m=f).type==="color"&&nu(m.default)?new sr(0,0,0,0):m.type==="color"?sr.parse(m.default)||null:m.type==="padding"?Oi.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._evaluator.globals=a,this._evaluator.feature=f,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(a,f,m,b,k,S){this._evaluator.globals=a,this._evaluator.feature=f||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new zr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function pr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in _a}function Gs(c,a){const f=new Vl(_a,ol,[],a?function(b){const k={color:Rt,string:yt,number:Fe,enum:yt,boolean:bt,formatted:or,padding:Se,resolvedImage:ne,variableAnchorOffsetCollection:ce};return b.type==="array"?ge(k[b.value]||Yt,b.length):k[b.type]}(a):void 0),m=f.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Sh(new wr(m,a)):ya(f.errors)}class ru{constructor(a,f){this.kind=a,this._styleExpression=f,this.isStateDependent=a!=="constant"&&!sl(f.expression)}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}}class xc{constructor(a,f,m,b){this.kind=a,this.zoomStops=m,this._styleExpression=f,this.isStateDependent=a!=="camera"&&!sl(f.expression),this.interpolationType=b}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}interpolationFactor(a,f,m){return this.interpolationType?Ai.interpolationFactor(this.interpolationType,a,f,m):0}}function Mh(c,a){const f=Gs(c,a);if(f.result==="error")return f;const m=f.value.expression,b=Xl(m);if(!b&&!va(a))return ya([new br("","data expressions not supported")]);const k=al(m,["zoom"]);if(!k&&!Ch(a))return ya([new br("","zoom expressions not supported")]);const S=ou(m);return S||k?S instanceof br?ya([S]):S instanceof Ai&&!bc(a)?ya([new br("",'"interpolate" expressions cannot be used with this property')]):Sh(S?new xc(b?"camera":"composite",f.value,S.labels,S instanceof Ai?S.interpolation:void 0):new ru(b?"constant":"source",f.value)):ya([new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iu{constructor(a,f){this._parameters=a,this._specification=f,Pr(this,Th(this._parameters,this._specification))}static deserialize(a){return new iu(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function ou(c){let a=null;if(c instanceof Yl)a=ou(c.result);else if(c instanceof Jl){for(const f of c.args)if(a=ou(f),a)break}else(c instanceof ul||c instanceof Ai)&&c.input instanceof no&&c.input.name==="zoom"&&(a=c);return a instanceof br||c.eachChild(f=>{const m=ou(f);m instanceof br?a=m:!a&&m?a=new br("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new br("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function su(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!su(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Eh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function au(c){if(c==null)return{filter:()=>!0,needGeometry:!1};su(c)||(c=uu(c));const a=Gs(c,Eh);if(a.result==="error")throw new Error(a.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,m,b)=>a.value.evaluate(f,m,{},b),needGeometry:lu(c)}}function Lh(c,a){return c<a?-1:c>a?1:0}function lu(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(lu(c[a]))return!0;return!1}function uu(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?Ac(c[1],c[2],"=="):a==="!="?cu(Ac(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Ac(c[1],c[2],a):a==="any"?(f=c.slice(1),["any"].concat(f.map(uu))):a==="all"?["all"].concat(c.slice(1).map(uu)):a==="none"?["all"].concat(c.slice(1).map(uu).map(cu)):a==="in"?Ih(c[1],c.slice(2)):a==="!in"?cu(Ih(c[1],c.slice(2))):a==="has"?Ph(c[1]):a==="!has"?cu(Ph(c[1])):a!=="within"||c;var f}function Ac(c,a,f){switch(c){case"$type":return[`filter-type-${f}`,a];case"$id":return[`filter-id-${f}`,a];default:return[`filter-${f}`,c,a]}}function Ih(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(f=>typeof f!=typeof a[0])?["filter-in-large",c,["literal",a.sort(Lh)]]:["filter-in-small",c,["literal",a]]}}function Ph(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function cu(c){return["!",c]}function kc(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let b="[";for(const k of c)b+=`${kc(k)},`;return`${b}]`}const f=Object.keys(c).sort();let m="{";for(let b=0;b<f.length;b++)m+=`${JSON.stringify(f[b])}:${kc(c[f[b]])},`;return`${m}}`}function Rp(c){let a="";for(const f of cn)a+=`/${kc(c[f])}`;return a}function zh(c){const a=c.value;return a?[new xt(c.key,a,"constants have been deprecated as of v8")]:[]}function $r(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Ts(c){if(Array.isArray(c))return c.map(Ts);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const f in c)a[f]=Ts(c[f]);return a}return $r(c)}function Li(c){const a=c.key,f=c.value,m=c.valueSpec||{},b=c.objectElementValidators||{},k=c.style,S=c.styleSpec,M=c.validateSpec;let R=[];const j=Wn(f);if(j!=="object")return[new xt(a,f,`object expected, ${j} found`)];for(const X in f){const Y=X.split(".")[0],se=m[Y]||m["*"];let pe;if(b[Y])pe=b[Y];else if(m[Y])pe=M;else if(b["*"])pe=b["*"];else{if(!m["*"]){R.push(new xt(a,f[X],`unknown property "${X}"`));continue}pe=M}R=R.concat(pe({key:(a&&`${a}.`)+X,value:f[X],valueSpec:se,style:k,styleSpec:S,object:f,objectKey:X,validateSpec:M},f))}for(const X in m)b[X]||m[X].required&&m[X].default===void 0&&f[X]===void 0&&R.push(new xt(a,f,`missing required property "${X}"`));return R}function Sc(c){const a=c.value,f=c.valueSpec,m=c.style,b=c.styleSpec,k=c.key,S=c.arrayElementValidator||c.validateSpec;if(Wn(a)!=="array")return[new xt(k,a,`array expected, ${Wn(a)} found`)];if(f.length&&a.length!==f.length)return[new xt(k,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new xt(k,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let M={type:f.value,values:f.values};b.$version<7&&(M.function=f.function),Wn(f.value)==="object"&&(M=f.value);let R=[];for(let j=0;j<a.length;j++)R=R.concat(S({array:a,arrayIndex:j,value:a[j],valueSpec:M,validateSpec:c.validateSpec,style:m,styleSpec:b,key:`${k}[${j}]`}));return R}function fu(c){const a=c.key,f=c.value,m=c.valueSpec;let b=Wn(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new xt(a,f,`number expected, ${b} found`)]:"minimum"in m&&f<m.minimum?[new xt(a,f,`${f} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&f>m.maximum?[new xt(a,f,`${f} is greater than the maximum value ${m.maximum}`)]:[]}function Dh(c){const a=c.valueSpec,f=$r(c.value.type);let m,b,k,S={};const M=f!=="categorical"&&c.value.property===void 0,R=!M,j=Wn(c.value.stops)==="array"&&Wn(c.value.stops[0])==="array"&&Wn(c.value.stops[0][0])==="object",X=Li({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(pe){if(f==="identity")return[new xt(pe.key,pe.value,'identity function may not have a "stops" property')];let _e=[];const we=pe.value;return _e=_e.concat(Sc({key:pe.key,value:we,valueSpec:pe.valueSpec,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec,arrayElementValidator:Y})),Wn(we)==="array"&&we.length===0&&_e.push(new xt(pe.key,we,"array must have at least one stop")),_e},default:function(pe){return pe.validateSpec({key:pe.key,value:pe.value,valueSpec:a,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec})}}});return f==="identity"&&M&&X.push(new xt(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||X.push(new xt(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!bc(c.valueSpec)&&X.push(new xt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(R&&!va(c.valueSpec)?X.push(new xt(c.key,c.value,"property functions not supported")):M&&!Ch(c.valueSpec)&&X.push(new xt(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!j||c.value.property!==void 0||X.push(new xt(c.key,c.value,'"property" property is required')),X;function Y(pe){let _e=[];const we=pe.value,Ce=pe.key;if(Wn(we)!=="array")return[new xt(Ce,we,`array expected, ${Wn(we)} found`)];if(we.length!==2)return[new xt(Ce,we,`array length 2 expected, length ${we.length} found`)];if(j){if(Wn(we[0])!=="object")return[new xt(Ce,we,`object expected, ${Wn(we[0])} found`)];if(we[0].zoom===void 0)return[new xt(Ce,we,"object stop key must have zoom")];if(we[0].value===void 0)return[new xt(Ce,we,"object stop key must have value")];if(k&&k>$r(we[0].zoom))return[new xt(Ce,we[0].zoom,"stop zoom values must appear in ascending order")];$r(we[0].zoom)!==k&&(k=$r(we[0].zoom),b=void 0,S={}),_e=_e.concat(Li({key:`${Ce}[0]`,value:we[0],valueSpec:{zoom:{}},validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec,objectElementValidators:{zoom:fu,value:se}}))}else _e=_e.concat(se({key:`${Ce}[0]`,value:we[0],valueSpec:{},validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec},we));return pr(Ts(we[1]))?_e.concat([new xt(`${Ce}[1]`,we[1],"expressions are not allowed in function stops.")]):_e.concat(pe.validateSpec({key:`${Ce}[1]`,value:we[1],valueSpec:a,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec}))}function se(pe,_e){const we=Wn(pe.value),Ce=$r(pe.value),Pe=pe.value!==null?pe.value:_e;if(m){if(we!==m)return[new xt(pe.key,Pe,`${we} stop domain type must match previous stop domain type ${m}`)]}else m=we;if(we!=="number"&&we!=="string"&&we!=="boolean")return[new xt(pe.key,Pe,"stop domain value must be a number, string, or boolean")];if(we!=="number"&&f!=="categorical"){let We=`number expected, ${we} found`;return va(a)&&f===void 0&&(We+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(pe.key,Pe,We)]}return f!=="categorical"||we!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?f!=="categorical"&&we==="number"&&b!==void 0&&Ce<b?[new xt(pe.key,Pe,"stop domain values must appear in ascending order")]:(b=Ce,f==="categorical"&&Ce in S?[new xt(pe.key,Pe,"stop domain values must be unique")]:(S[Ce]=!0,[])):[new xt(pe.key,Pe,`integer expected, found ${Ce}`)]}}function Ms(c){const a=(c.expressionContext==="property"?Mh:Gs)(Ts(c.value),c.valueSpec);if(a.result==="error")return a.value.map(m=>new xt(`${c.key}${m.key}`,c.value,m.message));const f=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new xt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!sl(f))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!sl(f))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!al(f,["zoom","feature-state"]))return[new xt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Xl(f))return[new xt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Es(c){const a=c.key,f=c.value,m=c.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf($r(f))===-1&&b.push(new xt(a,f,`expected one of [${m.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(m.values).indexOf($r(f))===-1&&b.push(new xt(a,f,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function ba(c){return su(Ts(c.value))?Ms(Pr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cc(c)}function Cc(c){const a=c.value,f=c.key;if(Wn(a)!=="array")return[new xt(f,a,`array expected, ${Wn(a)} found`)];const m=c.styleSpec;let b,k=[];if(a.length<1)return[new xt(f,a,"filter array must have at least 1 element")];switch(k=k.concat(Es({key:`${f}[0]`,value:a[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),$r(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&$r(a[1])==="$type"&&k.push(new xt(f,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&k.push(new xt(f,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=Wn(a[1]),b!=="string"&&k.push(new xt(`${f}[1]`,a[1],`string expected, ${b} found`)));for(let S=2;S<a.length;S++)b=Wn(a[S]),$r(a[1])==="$type"?k=k.concat(Es({key:`${f}[${S}]`,value:a[S],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&k.push(new xt(`${f}[${S}]`,a[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)k=k.concat(Cc({key:`${f}[${S}]`,value:a[S],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Wn(a[1]),a.length!==2?k.push(new xt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&k.push(new xt(`${f}[1]`,a[1],`string expected, ${b} found`));break;case"within":b=Wn(a[1]),a.length!==2?k.push(new xt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="object"&&k.push(new xt(`${f}[1]`,a[1],`object expected, ${b} found`))}return k}function hu(c,a){const f=c.key,m=c.validateSpec,b=c.style,k=c.styleSpec,S=c.value,M=c.objectKey,R=k[`${a}_${c.layerType}`];if(!R)return[];const j=M.match(/^(.*)-transition$/);if(a==="paint"&&j&&R[j[1]]&&R[j[1]].transition)return m({key:f,value:S,valueSpec:k.transition,style:b,styleSpec:k});const X=c.valueSpec||R[M];if(!X)return[new xt(f,S,`unknown property "${M}"`)];let Y;if(Wn(S)==="string"&&va(X)&&!X.tokens&&(Y=/^{([^}]+)}$/.exec(S)))return[new xt(f,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Y[1])} }\`.`)];const se=[];return c.layerType==="symbol"&&(M==="text-field"&&b&&!b.glyphs&&se.push(new xt(f,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&nu(Ts(S))&&$r(S.type)==="identity"&&se.push(new xt(f,S,'"text-font" does not support identity functions'))),se.concat(m({key:c.key,value:S,valueSpec:X,style:b,styleSpec:k,expressionContext:"property",propertyType:a,propertyKey:M}))}function Tc(c){return hu(c,"paint")}function Mc(c){return hu(c,"layout")}function fl(c){let a=[];const f=c.value,m=c.key,b=c.style,k=c.styleSpec;f.type||f.ref||a.push(new xt(m,f,'either "type" or "ref" is required'));let S=$r(f.type);const M=$r(f.ref);if(f.id){const R=$r(f.id);for(let j=0;j<c.arrayIndex;j++){const X=b.layers[j];$r(X.id)===R&&a.push(new xt(m,f.id,`duplicate layer id "${f.id}", previously used at line ${X.id.__line__}`))}}if("ref"in f){let R;["type","source","source-layer","filter","layout"].forEach(j=>{j in f&&a.push(new xt(m,f[j],`"${j}" is prohibited for ref layers`))}),b.layers.forEach(j=>{$r(j.id)===M&&(R=j)}),R?R.ref?a.push(new xt(m,f.ref,"ref cannot reference another ref layer")):S=$r(R.type):a.push(new xt(m,f.ref,`ref layer "${M}" not found`))}else if(S!=="background")if(f.source){const R=b.sources&&b.sources[f.source],j=R&&$r(R.type);R?j==="vector"&&S==="raster"?a.push(new xt(m,f.source,`layer "${f.id}" requires a raster source`)):j!=="raster-dem"&&S==="hillshade"?a.push(new xt(m,f.source,`layer "${f.id}" requires a raster-dem source`)):j==="raster"&&S!=="raster"?a.push(new xt(m,f.source,`layer "${f.id}" requires a vector source`)):j!=="vector"||f["source-layer"]?j==="raster-dem"&&S!=="hillshade"?a.push(new xt(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!f.paint||!f.paint["line-gradient"]||j==="geojson"&&R.lineMetrics||a.push(new xt(m,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new xt(m,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new xt(m,f.source,`source "${f.source}" not found`))}else a.push(new xt(m,f,'missing required property "source"'));return a=a.concat(Li({key:m,value:f,valueSpec:k.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:f.type,valueSpec:k.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:ba,layout:R=>Li({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":j=>Mc(Pr({layerType:S},j))}}),paint:R=>Li({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":j=>Tc(Pr({layerType:S},j))}})}})),a}function Ws(c){const a=c.value,f=c.key,m=Wn(a);return m!=="string"?[new xt(f,a,`string expected, ${m} found`)]:[]}const Rh={promoteId:function({key:c,value:a}){if(Wn(a)==="string")return Ws({key:c,value:a});{const f=[];for(const m in a)f.push(...Ws({key:`${c}.${m}`,value:a[m]}));return f}}};function Bh(c){const a=c.value,f=c.key,m=c.styleSpec,b=c.style,k=c.validateSpec;if(!a.type)return[new xt(f,a,'"type" is required')];const S=$r(a.type);let M;switch(S){case"vector":case"raster":return M=Li({key:f,value:a,valueSpec:m[`source_${S.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:Rh,validateSpec:k}),M;case"raster-dem":return M=function(R){var j;const X=(j=R.sourceName)!==null&&j!==void 0?j:"",Y=R.value,se=R.styleSpec,pe=se.source_raster_dem,_e=R.style;let we=[];const Ce=Wn(Y);if(Y===void 0)return we;if(Ce!=="object")return we.push(new xt("source_raster_dem",Y,`object expected, ${Ce} found`)),we;const Pe=$r(Y.encoding)==="custom",We=["redFactor","greenFactor","blueFactor","baseShift"],De=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const je in Y)!Pe&&We.includes(je)?we.push(new xt(je,Y[je],`In "${X}": "${je}" is only valid when "encoding" is set to "custom". ${De} encoding found`)):pe[je]?we=we.concat(R.validateSpec({key:je,value:Y[je],valueSpec:pe[je],validateSpec:R.validateSpec,style:_e,styleSpec:se})):we.push(new xt(je,Y[je],`unknown property "${je}"`));return we}({sourceName:f,value:a,style:c.style,styleSpec:m,validateSpec:k}),M;case"geojson":if(M=Li({key:f,value:a,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:k,objectElementValidators:Rh}),a.cluster)for(const R in a.clusterProperties){const[j,X]=a.clusterProperties[R],Y=typeof j=="string"?[j,["accumulated"],["get",R]]:j;M.push(...Ms({key:`${f}.${R}.map`,value:X,validateSpec:k,expressionContext:"cluster-map"})),M.push(...Ms({key:`${f}.${R}.reduce`,value:Y,validateSpec:k,expressionContext:"cluster-reduce"}))}return M;case"video":return Li({key:f,value:a,valueSpec:m.source_video,style:b,validateSpec:k,styleSpec:m});case"image":return Li({key:f,value:a,valueSpec:m.source_image,style:b,validateSpec:k,styleSpec:m});case"canvas":return[new xt(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Es({key:`${f}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:k,styleSpec:m})}}function Fh(c){const a=c.value,f=c.styleSpec,m=f.light,b=c.style;let k=[];const S=Wn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new xt("light",a,`object expected, ${S} found`)]),k;for(const M in a){const R=M.match(/^(.*)-transition$/);k=k.concat(R&&m[R[1]]&&m[R[1]].transition?c.validateSpec({key:M,value:a[M],valueSpec:f.transition,validateSpec:c.validateSpec,style:b,styleSpec:f}):m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new xt(M,a[M],`unknown property "${M}"`)])}return k}function Oh(c){const a=c.value,f=c.styleSpec,m=f.sky,b=c.style,k=Wn(a);if(a===void 0)return[];if(k!=="object")return[new xt("sky",a,`object expected, ${k} found`)];let S=[];for(const M in a)S=S.concat(m[M]?Go({key:M,value:a[M],valueSpec:m[M],style:b,styleSpec:f}):[new xt(M,a[M],`unknown property "${M}"`)]);return S}function hl(c){const a=c.value,f=c.styleSpec,m=f.terrain,b=c.style;let k=[];const S=Wn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new xt("terrain",a,`object expected, ${S} found`)]),k;for(const M in a)k=k.concat(m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new xt(M,a[M],`unknown property "${M}"`)]);return k}function dl(c){let a=[];const f=c.value,m=c.key;if(Array.isArray(f)){const b=[],k=[];for(const S in f)f[S].id&&b.includes(f[S].id)&&a.push(new xt(m,f,`all the sprites' ids must be unique, but ${f[S].id} is duplicated`)),b.push(f[S].id),f[S].url&&k.includes(f[S].url)&&a.push(new xt(m,f,`all the sprites' URLs must be unique, but ${f[S].url} is duplicated`)),k.push(f[S].url),a=a.concat(Li({key:`${m}[${S}]`,value:f[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return Ws({key:m,value:f})}const $i={"*":()=>[],array:Sc,boolean:function(c){const a=c.value,f=c.key,m=Wn(a);return m!=="boolean"?[new xt(f,a,`boolean expected, ${m} found`)]:[]},number:fu,color:function(c){const a=c.key,f=c.value,m=Wn(f);return m!=="string"?[new xt(a,f,`color expected, ${m} found`)]:sr.parse(String(f))?[]:[new xt(a,f,`color expected, "${f}" found`)]},constants:zh,enum:Es,filter:ba,function:Dh,layer:fl,object:Li,source:Bh,light:Fh,sky:Oh,terrain:hl,string:Ws,formatted:function(c){return Ws(c).length===0?[]:Ms(c)},resolvedImage:function(c){return Ws(c).length===0?[]:Ms(c)},padding:function(c){const a=c.key,f=c.value;if(Wn(f)==="array"){if(f.length<1||f.length>4)return[new xt(a,f,`padding requires 1 to 4 values; ${f.length} values found`)];const m={type:"number"};let b=[];for(let k=0;k<f.length;k++)b=b.concat(c.validateSpec({key:`${a}[${k}]`,value:f[k],validateSpec:c.validateSpec,valueSpec:m}));return b}return fu({key:a,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,f=c.value,m=Wn(f),b=c.styleSpec;if(m!=="array"||f.length<1||f.length%2!=0)return[new xt(a,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let k=[];for(let S=0;S<f.length;S+=2)k=k.concat(Es({key:`${a}[${S}]`,value:f[S],valueSpec:b.layout_symbol["text-anchor"]})),k=k.concat(Sc({key:`${a}[${S+1}]`,value:f[S+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:b}));return k},sprite:dl};function Go(c){const a=c.value,f=c.valueSpec,m=c.styleSpec;return c.validateSpec=Go,f.expression&&nu($r(a))?Dh(c):f.expression&&pr(Ts(a))?Ms(c):f.type&&$i[f.type]?$i[f.type](c):Li(Pr({},c,{valueSpec:f.type?m[f.type]:f}))}function Ec(c){const a=c.value,f=c.key,m=Ws(c);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new xt(f,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new xt(f,a,'"glyphs" url must include a "{range}" token'))),m}function So(c,a=he){let f=[];return f=f.concat(Go({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:Go,objectElementValidators:{glyphs:Ec,"*":()=>[]}})),c.constants&&(f=f.concat(zh({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:Go}))),wa(f)}function Wo(c){return function(a){return c({...a,validateSpec:Go})}}function wa(c){return[].concat(c).sort((a,f)=>a.line-f.line)}function Co(c){return function(...a){return wa(c.apply(this,a))}}So.source=Co(Wo(Bh)),So.sprite=Co(Wo(dl)),So.glyphs=Co(Wo(Ec)),So.light=Co(Wo(Fh)),So.sky=Co(Wo(Oh)),So.terrain=Co(Wo(hl)),So.layer=Co(Wo(fl)),So.filter=Co(Wo(ba)),So.paintProperty=Co(Wo(Tc)),So.layoutProperty=Co(Wo(Mc));const Zs=So,Bp=Zs.light,Lc=Zs.paintProperty,Fp=Zs.layoutProperty;function xa(c,a){let f=!1;if(a&&a.length)for(const m of a)c.fire(new At(new Error(m.message))),f=!0;return f}class pl{constructor(a,f,m){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const S=new Int32Array(this.arrayBuffer);a=S[0],this.d=(f=S[1])+2*(m=S[2]);for(let R=0;R<this.d*this.d;R++){const j=S[3+R],X=S[3+R+1];b.push(j===X?null:S.subarray(j,X))}const M=S[3+b.length+1];this.keys=S.subarray(S[3+b.length],M),this.bboxes=S.subarray(M),this.insert=this._insertReadonly}else{this.d=f+2*m;for(let S=0;S<this.d*this.d;S++)b.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=a,this.padding=m,this.scale=f/a,this.uid=0;const k=m/f*a;this.min=-k,this.max=a+k}insert(a,f,m,b,k){this._forEachCell(f,m,b,k,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(k)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,f,m,b,k,S){this.cells[k].push(S)}query(a,f,m,b,k){const S=this.min,M=this.max;if(a<=S&&f<=S&&M<=m&&M<=b&&!k)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(a,f,m,b,this._queryCell,R,{},k),R}}_queryCell(a,f,m,b,k,S,M,R){const j=this.cells[k];if(j!==null){const X=this.keys,Y=this.bboxes;for(let se=0;se<j.length;se++){const pe=j[se];if(M[pe]===void 0){const _e=4*pe;(R?R(Y[_e+0],Y[_e+1],Y[_e+2],Y[_e+3]):a<=Y[_e+2]&&f<=Y[_e+3]&&m>=Y[_e+0]&&b>=Y[_e+1])?(M[pe]=!0,S.push(X[pe])):M[pe]=!1}}}}_forEachCell(a,f,m,b,k,S,M,R){const j=this._convertToCellCoord(a),X=this._convertToCellCoord(f),Y=this._convertToCellCoord(m),se=this._convertToCellCoord(b);for(let pe=j;pe<=Y;pe++)for(let _e=X;_e<=se;_e++){const we=this.d*_e+pe;if((!R||R(this._convertFromCellCoord(pe),this._convertFromCellCoord(_e),this._convertFromCellCoord(pe+1),this._convertFromCellCoord(_e+1)))&&k.call(this,a,f,m,b,we,S,M,R))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,f=3+this.cells.length+1+1;let m=0;for(let S=0;S<this.cells.length;S++)m+=this.cells[S].length;const b=new Int32Array(f+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let k=f;for(let S=0;S<a.length;S++){const M=a[S];b[3+S]=k,b.set(M,k),k+=M.length}return b[3+a.length]=k,b.set(this.keys,k),k+=this.keys.length,b[3+a.length+1]=k,b.set(this.bboxes,k),k+=this.bboxes.length,b.buffer}static serialize(a,f){const m=a.toArrayBuffer();return f&&f.push(m),{buffer:m}}static deserialize(a){return new pl(a.buffer)}}const Zo={};function Zt(c,a,f={}){if(Zo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),Zo[c]={klass:a,omit:f.omit||[],shallow:f.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",pl),Zt("Color",sr),Zt("Error",Error),Zt("AJAXError",un),Zt("ResolvedImage",po),Zt("StylePropertyFunction",iu),Zt("StyleExpression",wr,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",xc),Zt("ZoomConstantExpression",ru),Zt("CompoundExpression",no,{omit:["_evaluate"]});for(const c in _a)_a[c]._classRegistryKey||Zt(`Expression_${c}`,_a[c]);function du(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Aa(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(du(c)||Ie(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return a&&a.push(f.buffer),f}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const m of c)f.push(Aa(m,a));return f}if(typeof c=="object"){const f=c.constructor,m=f._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${f.name}`);if(!Zo[m])throw new Error(`${m} is not registered.`);const b=f.serialize?f.serialize(c,a):{};if(f.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const k in c){if(!c.hasOwnProperty(k)||Zo[m].omit.indexOf(k)>=0)continue;const S=c[k];b[k]=Zo[m].shallow.indexOf(k)>=0?S:Aa(S,a)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(b.$name=m),b}throw new Error("can't serialize object of type "+typeof c)}function ka(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||du(c)||Ie(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(ka);if(typeof c=="object"){const a=c.$name||"Object";if(!Zo[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:f}=Zo[a];if(!f)throw new Error(`can't deserialize unregistered class ${a}`);if(f.deserialize)return f.deserialize(c);const m=Object.create(f.prototype);for(const b of Object.keys(c)){if(b==="$name")continue;const k=c[b];m[b]=Zo[a].shallow.indexOf(b)>=0?k:ka(k)}return m}throw new Error("can't deserialize object of type "+typeof c)}class $h{constructor(){this.first=!0}update(a,f){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=f),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Sa(c){for(const a of c)if(pu(a.charCodeAt(0)))return!0;return!1}function Nh(c){for(const a of c)if(!jh(a.charCodeAt(0)))return!1;return!0}function jh(c){return!(Vt.Arabic(c)||Vt["Arabic Supplement"](c)||Vt["Arabic Extended-A"](c)||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c))}function pu(c){return!(c!==746&&c!==747&&(c<4352||!(Vt["Bopomofo Extended"](c)||Vt.Bopomofo(c)||Vt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Vt["CJK Compatibility Ideographs"](c)||Vt["CJK Compatibility"](c)||Vt["CJK Radicals Supplement"](c)||Vt["CJK Strokes"](c)||!(!Vt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Vt["CJK Unified Ideographs Extension A"](c)||Vt["CJK Unified Ideographs"](c)||Vt["Enclosed CJK Letters and Months"](c)||Vt["Hangul Compatibility Jamo"](c)||Vt["Hangul Jamo Extended-A"](c)||Vt["Hangul Jamo Extended-B"](c)||Vt["Hangul Jamo"](c)||Vt["Hangul Syllables"](c)||Vt.Hiragana(c)||Vt["Ideographic Description Characters"](c)||Vt.Kanbun(c)||Vt["Kangxi Radicals"](c)||Vt["Katakana Phonetic Extensions"](c)||Vt.Katakana(c)&&c!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Vt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](c)||Vt["Unified Canadian Aboriginal Syllabics Extended"](c)||Vt["Vertical Forms"](c)||Vt["Yijing Hexagram Symbols"](c)||Vt["Yi Syllables"](c)||Vt["Yi Radicals"](c))))}function Ic(c){return!(pu(c)||function(a){return!!(Vt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Vt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Vt["Letterlike Symbols"](a)||Vt["Number Forms"](a)||Vt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Vt["Control Pictures"](a)&&a!==9251||Vt["Optical Character Recognition"](a)||Vt["Enclosed Alphanumerics"](a)||Vt["Geometric Shapes"](a)||Vt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Vt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Vt["CJK Symbols and Punctuation"](a)||Vt.Katakana(a)||Vt["Private Use Area"](a)||Vt["CJK Compatibility Forms"](a)||Vt["Small Form Variants"](a)||Vt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function mu(c){return c>=1424&&c<=2303||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c)}function Uh(c,a){return!(!a&&mu(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Vt.Khmer(c))}function Op(c){for(const a of c)if(mu(a.charCodeAt(0)))return!0;return!1}const Ls=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Mr{constructor(a,f){this.zoom=a,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $h,this.transition={})}isSupportedScript(a){return function(f,m){for(const b of f)if(!Uh(b.charCodeAt(0),m))return!1;return!0}(a,Ls.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,f=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*f}}}class ml{constructor(a,f){this.property=a,this.value=f,this.expression=function(m,b){if(nu(m))return new iu(m,b);if(pr(m)){const k=Mh(m,b);if(k.result==="error")throw new Error(k.value.map(S=>`${S.key}: ${S.message}`).join(", "));return k.value}{let k=m;return b.type==="color"&&typeof m=="string"?k=sr.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(k=ho.parse(m)):k=Oi.parse(m),{kind:"constant",evaluate:()=>k}}}(f===void 0?a.specification.default:f,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,f,m){return this.property.possiblyEvaluate(this,a,f,m)}}class gu{constructor(a){this.property=a,this.value=new ml(a,void 0)}transitioned(a,f){return new Vh(this.property,this.value,f,q({},a.transition,this.transition),a.now)}untransitioned(){return new Vh(this.property,this.value,null,{},0)}}class Pc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return ee(this._values[a].value.value)}setValue(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new gu(this._values[a].property)),this._values[a].value=new ml(this._values[a].property,f===null?void 0:ee(f))}getTransition(a){return ee(this._values[a].transition)}setTransition(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new gu(this._values[a].property)),this._values[a].transition=ee(f)||void 0}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m);const b=this.getTransition(f);b!==void 0&&(a[`${f}-transition`]=b)}return a}transitioned(a,f){const m=new qh(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(a,f._values[b]);return m}untransitioned(){const a=new qh(this._properties);for(const f of Object.keys(this._values))a._values[f]=this._values[f].untransitioned();return a}}class Vh{constructor(a,f,m,b,k){this.property=a,this.value=f,this.begin=k+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(a,f,m){const b=a.now||0,k=this.value.possiblyEvaluate(a,f,m),S=this.prior;if(S){if(b>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(b<this.begin)return S.possiblyEvaluate(a,f,m);{const M=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,f,m),k,function(R){if(R<=0)return 0;if(R>=1)return 1;const j=R*R,X=j*R;return 4*(R<.5?X:3*(R-j)+X-.75)}(M))}}return k}}class qh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,f,m){const b=new gl(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Hh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return ee(this._values[a].value)}setValue(a,f){this._values[a]=new ml(this._values[a].property,f===null?void 0:ee(f))}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m)}return a}possiblyEvaluate(a,f,m){const b=new gl(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}}class To{constructor(a,f,m){this.property=a,this.value=f,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,f,m,b){return this.property.evaluate(this.value,this.parameters,a,f,m,b)}}class gl{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class sn{constructor(a){this.specification=a}possiblyEvaluate(a,f){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(f)}interpolate(a,f,m){const b=Ei[this.specification.type];return b?b(a,f,m):a}}class hn{constructor(a,f){this.specification=a,this.overrides=f}possiblyEvaluate(a,f,m,b){return new To(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(f,null,{},m,b)}:a.expression,f)}interpolate(a,f,m){if(a.value.kind!=="constant"||f.value.kind!=="constant")return a;if(a.value.value===void 0||f.value.value===void 0)return new To(this,{kind:"constant",value:void 0},a.parameters);const b=Ei[this.specification.type];if(b){const k=b(a.value.value,f.value.value,m);return new To(this,{kind:"constant",value:k},a.parameters)}return a}evaluate(a,f,m,b,k,S){return a.kind==="constant"?a.value:a.evaluate(f,m,b,k,S)}}class _u extends hn{possiblyEvaluate(a,f,m,b){if(a.value===void 0)return new To(this,{kind:"constant",value:void 0},f);if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b),S=a.property.specification.type==="resolvedImage"&&typeof k!="string"?k.name:k,M=this._calculate(S,S,S,f);return new To(this,{kind:"constant",value:M},f)}if(a.expression.kind==="camera"){const k=this._calculate(a.expression.evaluate({zoom:f.zoom-1}),a.expression.evaluate({zoom:f.zoom}),a.expression.evaluate({zoom:f.zoom+1}),f);return new To(this,{kind:"constant",value:k},f)}return new To(this,a.expression,f)}evaluate(a,f,m,b,k,S){if(a.kind==="source"){const M=a.evaluate(f,m,b,k,S);return this._calculate(M,M,M,f)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(f.zoom)-1},m,b),a.evaluate({zoom:Math.floor(f.zoom)},m,b),a.evaluate({zoom:Math.floor(f.zoom)+1},m,b),f):a.value}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class _l{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b);return this._calculate(k,k,k,f)}return this._calculate(a.expression.evaluate(new Mr(Math.floor(f.zoom-1),f)),a.expression.evaluate(new Mr(Math.floor(f.zoom),f)),a.expression.evaluate(new Mr(Math.floor(f.zoom+1),f)),f)}}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class zc{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){return!!a.expression.evaluate(f,null,{},m,b)}interpolate(){return!1}}class Ni{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in a){const m=a[f];m.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new ml(m,void 0),k=this.defaultTransitionablePropertyValues[f]=new gu(m);this.defaultTransitioningPropertyValues[f]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}}}Zt("DataDrivenProperty",hn),Zt("DataConstantProperty",sn),Zt("CrossFadedDataDrivenProperty",_u),Zt("CrossFadedProperty",_l),Zt("ColorRampProperty",zc);const Dc="-transition";class Mo extends tt{constructor(a,f){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),f.layout&&(this._unevaluatedLayout=new Hh(f.layout)),f.paint)){this._transitionablePaint=new Pc(f.paint);for(const m in a.paint)this.setPaintProperty(m,a.paint[m],{validate:!1});for(const m in a.layout)this.setLayoutProperty(m,a.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gl(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,f,m={}){f!=null&&this._validate(Fp,`layers.${this.id}.layout.${a}`,a,f,m)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,f):this.visibility=f)}getPaintProperty(a){return a.endsWith(Dc)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,f,m={}){if(f!=null&&this._validate(Lc,`layers.${this.id}.paint.${a}`,a,f,m))return!1;if(a.endsWith(Dc))return this._transitionablePaint.setTransition(a.slice(0,-11),f||void 0),!1;{const b=this._transitionablePaint._values[a],k=b.property.specification["property-type"]==="cross-faded-data-driven",S=b.value.isDataDriven(),M=b.value;this._transitionablePaint.setValue(a,f),this._handleSpecialPaintPropertyUpdate(a);const R=this._transitionablePaint._values[a].value;return R.isDataDriven()||S||k||this._handleOverridablePaintPropertyUpdate(a,M,R)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,f,m){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,f){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,f)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Ee(a,(f,m)=>!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length))}_validate(a,f,m,b,k={}){return(!k||k.validate!==!1)&&xa(this,a.call(Zs,{key:f,layerType:this.type,objectKey:m,value:b,styleSpec:he,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const f=this.paint.get(a);if(f instanceof To&&va(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Gh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yl{constructor(a,f){this._structArray=a,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,f){return a._trim(),f&&(a.isTransferred=!0,f.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const f=Object.create(this.prototype);return f.arrayBuffer=a.arrayBuffer,f.length=a.length,f.capacity=a.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wr(c,a=1){let f=0,m=0;return{members:c.map(b=>{const k=Gh[b.type].BYTES_PER_ELEMENT,S=f=Wh(f,Math.max(a,k)),M=b.components||1;return m=Math.max(m,k),f+=k*M,{name:b.name,type:b.type,components:M,offset:S}}),size:Wh(f,Math.max(m,a)),alignment:a}}function Wh(c,a){return Math.ceil(c/a)*a}class vl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.int16[b+0]=f,this.int16[b+1]=m,a}}vl.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",vl);class cs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.int16[k+0]=f,this.int16[k+1]=m,this.int16[k+2]=b,a}}cs.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",cs);class Rc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.int16[S+0]=f,this.int16[S+1]=m,this.int16[S+2]=b,this.int16[S+3]=k,a}}Rc.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Rc);class Bc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const R=6*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.int16[R+2]=b,this.int16[R+3]=k,this.int16[R+4]=S,this.int16[R+5]=M,a}}Bc.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Bc);class Fc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const R=4*a,j=8*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.uint8[j+4]=b,this.uint8[j+5]=k,this.uint8[j+6]=S,this.uint8[j+7]=M,a}}Fc.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Fc);class bl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.float32[b+0]=f,this.float32[b+1]=m,a}}bl.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",bl);class yu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,f,m,b,k,S,M,R,j,X)}emplace(a,f,m,b,k,S,M,R,j,X,Y){const se=10*a;return this.uint16[se+0]=f,this.uint16[se+1]=m,this.uint16[se+2]=b,this.uint16[se+3]=k,this.uint16[se+4]=S,this.uint16[se+5]=M,this.uint16[se+6]=R,this.uint16[se+7]=j,this.uint16[se+8]=X,this.uint16[se+9]=Y,a}}yu.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",yu);class Oc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X,Y,se){const pe=this.length;return this.resize(pe+1),this.emplace(pe,a,f,m,b,k,S,M,R,j,X,Y,se)}emplace(a,f,m,b,k,S,M,R,j,X,Y,se,pe){const _e=12*a;return this.int16[_e+0]=f,this.int16[_e+1]=m,this.int16[_e+2]=b,this.int16[_e+3]=k,this.uint16[_e+4]=S,this.uint16[_e+5]=M,this.uint16[_e+6]=R,this.uint16[_e+7]=j,this.int16[_e+8]=X,this.int16[_e+9]=Y,this.int16[_e+10]=se,this.int16[_e+11]=pe,a}}Oc.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Oc);class $c extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.float32[k+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}$c.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",$c);class fs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint32[1*a+0]=f,a}}fs.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",fs);class vu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j){const X=this.length;return this.resize(X+1),this.emplace(X,a,f,m,b,k,S,M,R,j)}emplace(a,f,m,b,k,S,M,R,j,X){const Y=10*a,se=5*a;return this.int16[Y+0]=f,this.int16[Y+1]=m,this.int16[Y+2]=b,this.int16[Y+3]=k,this.int16[Y+4]=S,this.int16[Y+5]=M,this.uint32[se+3]=R,this.uint16[Y+8]=j,this.uint16[Y+9]=X,a}}vu.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",vu);class wl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const R=6*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.int16[R+2]=b,this.int16[R+3]=k,this.int16[R+4]=S,this.int16[R+5]=M,a}}wl.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",wl);class bu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b,k)}emplace(a,f,m,b,k,S){const M=4*a,R=8*a;return this.float32[M+0]=f,this.float32[M+1]=m,this.float32[M+2]=b,this.int16[R+6]=k,this.int16[R+7]=S,a}}bu.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",bu);class xl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=12*a,M=3*a;return this.uint8[S+0]=f,this.uint8[S+1]=m,this.float32[M+1]=b,this.float32[M+2]=k,a}}xl.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",xl);class wu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[k+0]=f,this.uint16[k+1]=m,this.uint16[k+2]=b,a}}wu.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",wu);class Ca extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we,Ce,Pe){const We=this.length;return this.resize(We+1),this.emplace(We,a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we,Ce,Pe)}emplace(a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we,Ce,Pe,We){const De=24*a,je=12*a,dt=48*a;return this.int16[De+0]=f,this.int16[De+1]=m,this.uint16[De+2]=b,this.uint16[De+3]=k,this.uint32[je+2]=S,this.uint32[je+3]=M,this.uint32[je+4]=R,this.uint16[De+10]=j,this.uint16[De+11]=X,this.uint16[De+12]=Y,this.float32[je+7]=se,this.float32[je+8]=pe,this.uint8[dt+36]=_e,this.uint8[dt+37]=we,this.uint8[dt+38]=Ce,this.uint32[je+10]=Pe,this.int16[De+22]=We,a}}Ca.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ca);class Xs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we,Ce,Pe,We,De,je,dt,vt,Ht,tn,qt,Ut,Ft,Xt){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we,Ce,Pe,We,De,je,dt,vt,Ht,tn,qt,Ut,Ft,Xt)}emplace(a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we,Ce,Pe,We,De,je,dt,vt,Ht,tn,qt,Ut,Ft,Xt,Nt){const It=32*a,fn=16*a;return this.int16[It+0]=f,this.int16[It+1]=m,this.int16[It+2]=b,this.int16[It+3]=k,this.int16[It+4]=S,this.int16[It+5]=M,this.int16[It+6]=R,this.int16[It+7]=j,this.uint16[It+8]=X,this.uint16[It+9]=Y,this.uint16[It+10]=se,this.uint16[It+11]=pe,this.uint16[It+12]=_e,this.uint16[It+13]=we,this.uint16[It+14]=Ce,this.uint16[It+15]=Pe,this.uint16[It+16]=We,this.uint16[It+17]=De,this.uint16[It+18]=je,this.uint16[It+19]=dt,this.uint16[It+20]=vt,this.uint16[It+21]=Ht,this.uint16[It+22]=tn,this.uint32[fn+12]=qt,this.float32[fn+13]=Ut,this.float32[fn+14]=Ft,this.uint16[It+30]=Xt,this.uint16[It+31]=Nt,a}}Xs.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Xs);class xu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.float32[1*a+0]=f,a}}xu.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",xu);class Au extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[6*a+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}Au.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",Au);class Ks extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=4*a;return this.uint32[2*a+0]=f,this.uint16[k+2]=m,this.uint16[k+3]=b,a}}Ks.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Ks);class Nc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.uint16[b+0]=f,this.uint16[b+1]=m,a}}Nc.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",Nc);class jc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint16[1*a+0]=f,a}}jc.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",jc);class ku extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.float32[S+0]=f,this.float32[S+1]=m,this.float32[S+2]=b,this.float32[S+3]=k,a}}ku.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",ku);class Zh extends yl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}Zh.prototype.size=20;class w extends vu{get(a){return new Zh(this,a)}}Zt("CollisionBoxArray",w);class l extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class h extends Ca{get(a){return new l(this,a)}}Zt("PlacedSymbolArray",h);class y extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}y.prototype.size=64;class v extends Xs{get(a){return new y(this,a)}}Zt("SymbolInstanceArray",v);class A extends xu{getoffsetX(a){return this.float32[1*a+0]}}Zt("GlyphOffsetArray",A);class z extends cs{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Zt("SymbolLineVertexArray",z);class D extends yl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}D.prototype.size=12;class $ extends Au{get(a){return new D(this,a)}}Zt("TextAnchorOffsetArray",$);class W extends yl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}W.prototype.size=8;class Q extends Ks{get(a){return new W(this,a)}}Zt("FeatureIndexArray",Q);class te extends vl{}class me extends vl{}class ke extends vl{}class Ae extends Bc{}class Te extends Fc{}class be extends bl{}class Re extends yu{}class et extends Oc{}class Le extends $c{}class Ve extends fs{}class rt extends wl{}class st extends xl{}class ft extends wu{}class Ct extends Nc{}const wt=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Bt}=wt;class Ot{constructor(a=[]){this.segments=a}prepareSegment(a,f,m,b){let k=this.segments[this.segments.length-1];return a>Ot.MAX_VERTEX_ARRAY_LENGTH&&ve(`Max vertices per segment is ${Ot.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!k||k.vertexLength+a>Ot.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==b)&&(k={vertexOffset:f.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(k.sortKey=b),this.segments.push(k)),k}get(){return this.segments}destroy(){for(const a of this.segments)for(const f in a.vaos)a.vaos[f].destroy()}static simpleSegment(a,f,m,b){return new Ot([{vertexOffset:a,primitiveOffset:f,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function kn(c,a){return 256*(c=Z(Math.floor(c),0,255))+Z(Math.floor(a),0,255)}Ot.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Ot);const $t=Wr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gn={exports:{}},Sn={exports:{}};Sn.exports=function(c,a){var f,m,b,k,S,M,R,j;for(m=c.length-(f=3&c.length),b=a,S=3432918353,M=461845907,j=0;j<m;)R=255&c.charCodeAt(j)|(255&c.charCodeAt(++j))<<8|(255&c.charCodeAt(++j))<<16|(255&c.charCodeAt(++j))<<24,++j,b=27492+(65535&(k=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(R=0,f){case 3:R^=(255&c.charCodeAt(j+2))<<16;case 2:R^=(255&c.charCodeAt(j+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&c.charCodeAt(j)))*S+(((R>>>16)*S&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var qn=Sn.exports,An={exports:{}};An.exports=function(c,a){for(var f,m=c.length,b=a^m,k=0;m>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24))+((1540483477*(f>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++k;switch(m){case 3:b^=(255&c.charCodeAt(k+2))<<16;case 2:b^=(255&c.charCodeAt(k+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(k)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var Mn=qn,Rn=An.exports;gn.exports=Mn,gn.exports.murmur3=Mn,gn.exports.murmur2=Rn;var jr=d(gn.exports);class lr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,f,m,b){this.ids.push(ro(a)),this.positions.push(f,m,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=ro(a);let m=0,b=this.ids.length-1;for(;m<b;){const S=m+b>>1;this.ids[S]>=f?b=S:m=S+1}const k=[];for(;this.ids[m]===f;)k.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return k}static serialize(a,f){const m=new Float64Array(a.ids),b=new Uint32Array(a.positions);return oi(m,b,0,m.length-1),f&&f.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(a){const f=new lr;return f.ids=a.ids,f.positions=a.positions,f.indexed=!0,f}}function ro(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:jr(String(c))}function oi(c,a,f,m){for(;f<m;){const b=c[f+m>>1];let k=f-1,S=m+1;for(;;){do k++;while(c[k]<b);do S--;while(c[S]>b);if(k>=S)break;Dr(c,k,S),Dr(a,3*k,3*S),Dr(a,3*k+1,3*S+1),Dr(a,3*k+2,3*S+2)}S-f<m-S?(oi(c,a,f,S),f=S+1):(oi(c,a,S+1,m),m=S)}}function Dr(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}Zt("FeaturePositionMap",lr);class si{constructor(a,f){this.gl=a.gl,this.location=f}}class io extends si{constructor(a,f){super(a,f),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Xo extends si{constructor(a,f){super(a,f),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Is extends si{constructor(a,f){super(a,f),this.current=sr.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const Al=new Float32Array(16);function Ps(c){return[kn(255*c.r,255*c.g),kn(255*c.b,255*c.a)]}class Ko{constructor(a,f,m){this.value=a,this.uniformNames=f.map(b=>`u_${b}`),this.type=m}setUniform(a,f,m){a.set(m.constantOr(this.value))}getBinding(a,f,m){return this.type==="color"?new Is(a,f):new io(a,f)}}class Jr{constructor(a,f){this.uniformNames=f.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=a.tlbr}setUniform(a,f,m,b){const k=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;k&&a.set(k)}getBinding(a,f,m){return m.substr(0,9)==="u_pattern"?new Xo(a,f):new io(a,f)}}class Rr{constructor(a,f,m,b){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=f.map(k=>({name:`a_${k}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,f,m,b,k){const S=this.paintVertexArray.length,M=this.expression.evaluate(new Mr(0),f,{},b,[],k);this.paintVertexArray.resize(a),this._setPaintValue(S,a,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(a,f,k)}_setPaintValue(a,f,m){if(this.type==="color"){const b=Ps(m);for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,b[0],b[1])}else{for(let b=a;b<f;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Er{constructor(a,f,m,b,k,S){this.expression=a,this.uniformNames=f.map(M=>`u_${M}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(a,f,m,b,k){const S=this.expression.evaluate(new Mr(this.zoom),f,{},b,[],k),M=this.expression.evaluate(new Mr(this.zoom+1),f,{},b,[],k),R=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(R,a,S,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:this.zoom},m,b),S=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(a,f,k,S)}_setPaintValue(a,f,m,b){if(this.type==="color"){const k=Ps(m),S=Ps(b);for(let M=a;M<f;M++)this.paintVertexArray.emplace(M,k[0],k[1],S[0],S[1])}else{for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,f){const m=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=Z(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,f,m){return new io(a,f)}}class mo{constructor(a,f,m,b,k,S){this.expression=a,this.type=f,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k}populatePaintArray(a,f,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,f.patterns&&f.patterns[this.layerId],m)}updatePaintArray(a,f,m,b,k){this._setPaintValues(a,f,m.patterns&&m.patterns[this.layerId],k)}_setPaintValues(a,f,m,b){if(!b||!m)return;const{min:k,mid:S,max:M}=m,R=b[k],j=b[S],X=b[M];if(R&&j&&X)for(let Y=a;Y<f;Y++)this.zoomInPaintVertexArray.emplace(Y,j.tl[0],j.tl[1],j.br[0],j.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],j.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(Y,j.tl[0],j.tl[1],j.br[0],j.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],j.pixelRatio,X.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Yr{constructor(a,f,m){this.binders={},this._buffers=[];const b=[];for(const k in a.paint._values){if(!m(k))continue;const S=a.paint.get(k);if(!(S instanceof To&&va(S.property.specification)))continue;const M=go(k,a.type),R=S.value,j=S.property.specification.type,X=S.property.useIntegerZoom,Y=S.property.specification["property-type"],se=Y==="cross-faded"||Y==="cross-faded-data-driven";if(R.kind==="constant")this.binders[k]=se?new Jr(R.value,M):new Ko(R.value,M,j),b.push(`/u_${k}`);else if(R.kind==="source"||se){const pe=Qr(k,j,"source");this.binders[k]=se?new mo(R,j,X,f,pe,a.id):new Rr(R,M,j,pe),b.push(`/a_${k}`)}else{const pe=Qr(k,j,"composite");this.binders[k]=new Er(R,M,j,X,f,pe),b.push(`/z_${k}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const f=this.binders[a];return f instanceof Rr||f instanceof Er?f.maxValue:0}populatePaintArrays(a,f,m,b,k){for(const S in this.binders){const M=this.binders[S];(M instanceof Rr||M instanceof Er||M instanceof mo)&&M.populatePaintArray(a,f,m,b,k)}}setConstantPatternPositions(a,f){for(const m in this.binders){const b=this.binders[m];b instanceof Jr&&b.setConstantPatternPositions(a,f)}}updatePaintArrays(a,f,m,b,k){let S=!1;for(const M in a){const R=f.getPositions(M);for(const j of R){const X=m.feature(j.index);for(const Y in this.binders){const se=this.binders[Y];if((se instanceof Rr||se instanceof Er||se instanceof mo)&&se.expression.isStateDependent===!0){const pe=b.paint.get(Y);se.expression=pe.value,se.updatePaintArray(j.start,j.end,X,a[M],k),S=!0}}}}return S}defines(){const a=[];for(const f in this.binders){const m=this.binders[f];(m instanceof Ko||m instanceof Jr)&&a.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return a}getBinderAttributes(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Rr||m instanceof Er)for(let b=0;b<m.paintVertexAttributes.length;b++)a.push(m.paintVertexAttributes[b].name);else if(m instanceof mo)for(let b=0;b<$t.members.length;b++)a.push($t.members[b].name)}return a}getBinderUniforms(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Ko||m instanceof Jr||m instanceof Er)for(const b of m.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,f){const m=[];for(const b in this.binders){const k=this.binders[b];if(k instanceof Ko||k instanceof Jr||k instanceof Er){for(const S of k.uniformNames)if(f[S]){const M=k.getBinding(a,f[S],S);m.push({name:S,property:b,binding:M})}}}return m}setUniforms(a,f,m,b){for(const{name:k,property:S,binding:M}of f)this.binders[S].setUniform(M,b,m.get(S),k)}updatePaintBuffers(a){this._buffers=[];for(const f in this.binders){const m=this.binders[f];if(a&&m instanceof mo){const b=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof Rr||m instanceof Er)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const f in this.binders){const m=this.binders[f];(m instanceof Rr||m instanceof Er||m instanceof mo)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const f=this.binders[a];(f instanceof Rr||f instanceof Er||f instanceof mo)&&f.destroy()}}}class Br{constructor(a,f,m=()=>!0){this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new Yr(b,f,m);this.needsUpload=!1,this._featureMap=new lr,this._bufferOffset=0}populatePaintArrays(a,f,m,b,k,S){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(a,f,b,k,S);f.id!==void 0&&this._featureMap.add(f.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,f,m,b){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(a,this._featureMap,f,k,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function go(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function Qr(c,a,f){const m={color:{source:bl,composite:ku},number:{source:xu,composite:bl}},b=function(k){return{"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re}}[k]}(c);return b&&b[f]||m[a][f]}Zt("ConstantBinder",Ko),Zt("CrossFadedConstantBinder",Jr),Zt("SourceExpressionBinder",Rr),Zt("CrossFadedCompositeBinder",mo),Zt("CompositeExpressionBinder",Er),Zt("ProgramConfiguration",Yr,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Br);const qr=8192,Uc=Math.pow(2,14)-1,Xh=-Uc-1;function Js(c){const a=qr/c.extent,f=c.loadGeometry();for(let m=0;m<f.length;m++){const b=f[m];for(let k=0;k<b.length;k++){const S=b[k],M=Math.round(S.x*a),R=Math.round(S.y*a);S.x=Z(M,Xh,Uc),S.y=Z(R,Xh,Uc),(M<S.x||M>S.x+1||R<S.y||R>S.y+1)&&ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Ys(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Js(c):[]}}function Su(c,a,f,m,b){c.emplaceBack(2*a+(m+1)/2,2*f+(b+1)/2)}class zs{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new me,this.indexArray=new ft,this.segments=new Ot,this.programConfigurations=new Br(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){const b=this.layers[0],k=[];let S=null,M=!1;b.type==="circle"&&(S=b.layout.get("circle-sort-key"),M=!S.isConstant());for(const{feature:R,id:j,index:X,sourceLayerIndex:Y}of a){const se=this.layers[0]._featureFilter.needGeometry,pe=Ys(R,se);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),pe,m))continue;const _e=M?S.evaluate(pe,{},m):void 0,we={id:j,properties:R.properties,type:R.type,sourceLayerIndex:Y,index:X,geometry:se?pe.geometry:Js(R),patterns:{},sortKey:_e};k.push(we)}M&&k.sort((R,j)=>R.sortKey-j.sortKey);for(const R of k){const{geometry:j,index:X,sourceLayerIndex:Y}=R,se=a[X].feature;this.addFeature(R,j,X,m),f.featureIndex.insert(se,j,X,Y,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Bt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,f,m,b){for(const k of f)for(const S of k){const M=S.x,R=S.y;if(M<0||M>=qr||R<0||R>=qr)continue;const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),X=j.vertexLength;Su(this.layoutVertexArray,M,R,-1,-1),Su(this.layoutVertexArray,M,R,1,-1),Su(this.layoutVertexArray,M,R,1,1),Su(this.layoutVertexArray,M,R,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+3,X+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{},b)}}function Vc(c,a){for(let f=0;f<c.length;f++)if(Tu(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Tu(c,a[f]))return!0;return!!Cu(c,a)}function Kh(c,a,f){return!!Tu(c,a)||!!$p(a,c,f)}function qc(c,a){if(c.length===1)return p_(a,c[0]);for(let f=0;f<a.length;f++){const m=a[f];for(let b=0;b<m.length;b++)if(Tu(c,m[b]))return!0}for(let f=0;f<c.length;f++)if(p_(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Cu(c,a[f]))return!0;return!1}function Hc(c,a,f){if(c.length>1){if(Cu(c,a))return!0;for(let m=0;m<a.length;m++)if($p(a[m],c,f))return!0}for(let m=0;m<c.length;m++)if($p(c[m],a,f))return!0;return!1}function Cu(c,a){if(c.length===0||a.length===0)return!1;for(let f=0;f<c.length-1;f++){const m=c[f],b=c[f+1];for(let k=0;k<a.length-1;k++)if(Gc(m,b,a[k],a[k+1]))return!0}return!1}function Gc(c,a,f,m){return ye(c,f,m)!==ye(a,f,m)&&ye(c,a,f)!==ye(c,a,m)}function $p(c,a,f){const m=f*f;if(a.length===1)return c.distSqr(a[0])<m;for(let b=1;b<a.length;b++)if(d_(c,a[b-1],a[b])<m)return!0;return!1}function d_(c,a,f){const m=a.distSqr(f);if(m===0)return c.distSqr(a);const b=((c.x-a.x)*(f.x-a.x)+(c.y-a.y)*(f.y-a.y))/m;return c.distSqr(b<0?a:b>1?f:f.sub(a)._mult(b)._add(a))}function p_(c,a){let f,m,b,k=!1;for(let S=0;S<c.length;S++){f=c[S];for(let M=0,R=f.length-1;M<f.length;R=M++)m=f[M],b=f[R],m.y>a.y!=b.y>a.y&&a.x<(b.x-m.x)*(a.y-m.y)/(b.y-m.y)+m.x&&(k=!k)}return k}function Tu(c,a){let f=!1;for(let m=0,b=c.length-1;m<c.length;b=m++){const k=c[m],S=c[b];k.y>a.y!=S.y>a.y&&a.x<(S.x-k.x)*(a.y-k.y)/(S.y-k.y)+k.x&&(f=!f)}return f}function ax(c,a,f){const m=f[0],b=f[2];if(c.x<m.x&&a.x<m.x||c.x>b.x&&a.x>b.x||c.y<m.y&&a.y<m.y||c.y>b.y&&a.y>b.y)return!1;const k=ye(c,a,f[0]);return k!==ye(c,a,f[1])||k!==ye(c,a,f[2])||k!==ye(c,a,f[3])}function Wc(c,a,f){const m=a.paint.get(c).value;return m.kind==="constant"?m.value:f.programConfigurations.get(a.id).getMaxValue(c)}function Jh(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Yh(c,a,f,m,b){if(!a[0]&&!a[1])return c;const k=_.convert(a)._mult(b);f==="viewport"&&k._rotate(-m);const S=[];for(let M=0;M<c.length;M++)S.push(c[M].sub(k));return S}let m_,g_;Zt("CircleBucket",zs,{omit:["layers"]});var lx={get paint(){return g_=g_||new Ni({"circle-radius":new hn(he.paint_circle["circle-radius"]),"circle-color":new hn(he.paint_circle["circle-color"]),"circle-blur":new hn(he.paint_circle["circle-blur"]),"circle-opacity":new hn(he.paint_circle["circle-opacity"]),"circle-translate":new sn(he.paint_circle["circle-translate"]),"circle-translate-anchor":new sn(he.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sn(he.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sn(he.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hn(he.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hn(he.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hn(he.paint_circle["circle-stroke-opacity"])})},get layout(){return m_=m_||new Ni({"circle-sort-key":new hn(he.layout_circle["circle-sort-key"])})}},ji=1e-6,Mu=typeof Float32Array<"u"?Float32Array:Array;function Np(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function __(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3],M=a[4],R=a[5],j=a[6],X=a[7],Y=a[8],se=a[9],pe=a[10],_e=a[11],we=a[12],Ce=a[13],Pe=a[14],We=a[15],De=f[0],je=f[1],dt=f[2],vt=f[3];return c[0]=De*m+je*M+dt*Y+vt*we,c[1]=De*b+je*R+dt*se+vt*Ce,c[2]=De*k+je*j+dt*pe+vt*Pe,c[3]=De*S+je*X+dt*_e+vt*We,c[4]=(De=f[4])*m+(je=f[5])*M+(dt=f[6])*Y+(vt=f[7])*we,c[5]=De*b+je*R+dt*se+vt*Ce,c[6]=De*k+je*j+dt*pe+vt*Pe,c[7]=De*S+je*X+dt*_e+vt*We,c[8]=(De=f[8])*m+(je=f[9])*M+(dt=f[10])*Y+(vt=f[11])*we,c[9]=De*b+je*R+dt*se+vt*Ce,c[10]=De*k+je*j+dt*pe+vt*Pe,c[11]=De*S+je*X+dt*_e+vt*We,c[12]=(De=f[12])*m+(je=f[13])*M+(dt=f[14])*Y+(vt=f[15])*we,c[13]=De*b+je*R+dt*se+vt*Ce,c[14]=De*k+je*j+dt*pe+vt*Pe,c[15]=De*S+je*X+dt*_e+vt*We,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var Zc,ux=__;function Qh(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3];return c[0]=f[0]*m+f[4]*b+f[8]*k+f[12]*S,c[1]=f[1]*m+f[5]*b+f[9]*k+f[13]*S,c[2]=f[2]*m+f[6]*b+f[10]*k+f[14]*S,c[3]=f[3]*m+f[7]*b+f[11]*k+f[15]*S,c}Zc=new Mu(4),Mu!=Float32Array&&(Zc[0]=0,Zc[1]=0,Zc[2]=0,Zc[3]=0);class cx extends Mo{constructor(a){super(a,lx)}createBucket(a){return new zs(a)}queryRadius(a){const f=a;return Wc("circle-radius",this,f)+Wc("circle-stroke-width",this,f)+Jh(this.paint.get("circle-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M,R){const j=Yh(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,M),X=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),Y=this.paint.get("circle-pitch-alignment")==="map",se=Y?j:function(_e,we){return _e.map(Ce=>y_(Ce,we))}(j,R),pe=Y?X*M:X;for(const _e of b)for(const we of _e){const Ce=Y?we:y_(we,R);let Pe=pe;const We=Qh([],[we.x,we.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=We[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=S.cameraToCenterDistance/We[3]),Kh(se,Ce,Pe))return!0}return!1}}function y_(c,a){const f=Qh([],[c.x,c.y,0,1],a);return new _(f[0]/f[3],f[1]/f[3])}class v_ extends zs{}let b_;Zt("HeatmapBucket",v_,{omit:["layers"]});var fx={get paint(){return b_=b_||new Ni({"heatmap-radius":new hn(he.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hn(he.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sn(he.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zc(he.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sn(he.paint_heatmap["heatmap-opacity"])})}};function jp(c,{width:a,height:f},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==a*f*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${a*f*m}`)}else b=new Uint8Array(a*f*m);return c.width=a,c.height=f,c.data=b,c}function w_(c,{width:a,height:f},m){if(a===c.width&&f===c.height)return;const b=jp({},{width:a,height:f},m);Up(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,f)},m),c.width=a,c.height=f,c.data=b.data}function Up(c,a,f,m,b,k){if(b.width===0||b.height===0)return a;if(b.width>c.width||b.height>c.height||f.x>c.width-b.width||f.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||m.x>a.width-b.width||m.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,M=a.data;if(S===M)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<b.height;R++){const j=((f.y+R)*c.width+f.x)*k,X=((m.y+R)*a.width+m.x)*k;for(let Y=0;Y<b.width*k;Y++)M[X+Y]=S[j+Y]}return a}class Xc{constructor(a,f){jp(this,a,1,f)}resize(a){w_(this,a,1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Up(a,f,m,b,k,1)}}class Eo{constructor(a,f){jp(this,a,4,f)}resize(a){w_(this,a,4)}replace(a,f){f?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Up(a,f,m,b,k,4)}}function x_(c){const a={},f=c.resolution||256,m=c.clips?c.clips.length:1,b=c.image||new Eo({width:f,height:m});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const k=(S,M,R)=>{a[c.evaluationKey]=R;const j=c.expression.evaluate(a);b.data[S+M+0]=Math.floor(255*j.r/j.a),b.data[S+M+1]=Math.floor(255*j.g/j.a),b.data[S+M+2]=Math.floor(255*j.b/j.a),b.data[S+M+3]=Math.floor(255*j.a)};if(c.clips)for(let S=0,M=0;S<m;++S,M+=4*f)for(let R=0,j=0;R<f;R++,j+=4){const X=R/(f-1),{start:Y,end:se}=c.clips[S];k(M,j,Y*(1-X)+se*X)}else for(let S=0,M=0;S<f;S++,M+=4)k(0,M,S/(f-1));return b}Zt("AlphaImage",Xc),Zt("RGBAImage",Eo);class hx extends Mo{createBucket(a){return new v_(a)}constructor(a){super(a,fx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=x_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let A_;var dx={get paint(){return A_=A_||new Ni({"hillshade-illumination-direction":new sn(he.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sn(he.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sn(he.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sn(he.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sn(he.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sn(he.paint_hillshade["hillshade-accent-color"])})}};class px extends Mo{constructor(a){super(a,dx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const mx=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:gx}=mx;var Vp={exports:{}};function ed(c,a,f){f=f||2;var m,b,k,S,M,R,j,X=a&&a.length,Y=X?a[0]*f:c.length,se=k_(c,0,Y,f,!0),pe=[];if(!se||se.next===se.prev)return pe;if(X&&(se=function(we,Ce,Pe,We){var De,je,dt,vt=[];for(De=0,je=Ce.length;De<je;De++)(dt=k_(we,Ce[De]*We,De<je-1?Ce[De+1]*We:we.length,We,!1))===dt.next&&(dt.steiner=!0),vt.push(kx(dt));for(vt.sort(wx),De=0;De<vt.length;De++)Pe=xx(vt[De],Pe);return Pe}(c,a,se,f)),c.length>80*f){m=k=c[0],b=S=c[1];for(var _e=f;_e<Y;_e+=f)(M=c[_e])<m&&(m=M),(R=c[_e+1])<b&&(b=R),M>k&&(k=M),R>S&&(S=R);j=(j=Math.max(k-m,S-b))!==0?32767/j:0}return Kc(se,pe,f,m,b,j,0),pe}function k_(c,a,f,m,b){var k,S;if(b===Gp(c,a,f,m)>0)for(k=a;k<f;k+=m)S=T_(k,c[k],c[k+1],S);else for(k=f-m;k>=a;k-=m)S=T_(k,c[k],c[k+1],S);return S&&td(S,S.next)&&(Yc(S),S=S.next),S}function kl(c,a){if(!c)return c;a||(a=c);var f,m=c;do if(f=!1,m.steiner||!td(m,m.next)&&Zr(m.prev,m,m.next)!==0)m=m.next;else{if(Yc(m),(m=a=m.prev)===m.next)break;f=!0}while(f||m!==a);return a}function Kc(c,a,f,m,b,k,S){if(c){!S&&k&&function(X,Y,se,pe){var _e=X;do _e.z===0&&(_e.z=qp(_e.x,_e.y,Y,se,pe)),_e.prevZ=_e.prev,_e.nextZ=_e.next,_e=_e.next;while(_e!==X);_e.prevZ.nextZ=null,_e.prevZ=null,function(we){var Ce,Pe,We,De,je,dt,vt,Ht,tn=1;do{for(Pe=we,we=null,je=null,dt=0;Pe;){for(dt++,We=Pe,vt=0,Ce=0;Ce<tn&&(vt++,We=We.nextZ);Ce++);for(Ht=tn;vt>0||Ht>0&&We;)vt!==0&&(Ht===0||!We||Pe.z<=We.z)?(De=Pe,Pe=Pe.nextZ,vt--):(De=We,We=We.nextZ,Ht--),je?je.nextZ=De:we=De,De.prevZ=je,je=De;Pe=We}je.nextZ=null,tn*=2}while(dt>1)}(_e)}(c,m,b,k);for(var M,R,j=c;c.prev!==c.next;)if(M=c.prev,R=c.next,k?yx(c,m,b,k):_x(c))a.push(M.i/f|0),a.push(c.i/f|0),a.push(R.i/f|0),Yc(c),c=R.next,j=R.next;else if((c=R)===j){S?S===1?Kc(c=vx(kl(c),a,f),a,f,m,b,k,2):S===2&&bx(c,a,f,m,b,k):Kc(kl(c),a,f,m,b,k,1);break}}}function _x(c){var a=c.prev,f=c,m=c.next;if(Zr(a,f,m)>=0)return!1;for(var b=a.x,k=f.x,S=m.x,M=a.y,R=f.y,j=m.y,X=b<k?b<S?b:S:k<S?k:S,Y=M<R?M<j?M:j:R<j?R:j,se=b>k?b>S?b:S:k>S?k:S,pe=M>R?M>j?M:j:R>j?R:j,_e=m.next;_e!==a;){if(_e.x>=X&&_e.x<=se&&_e.y>=Y&&_e.y<=pe&&Eu(b,M,k,R,S,j,_e.x,_e.y)&&Zr(_e.prev,_e,_e.next)>=0)return!1;_e=_e.next}return!0}function yx(c,a,f,m){var b=c.prev,k=c,S=c.next;if(Zr(b,k,S)>=0)return!1;for(var M=b.x,R=k.x,j=S.x,X=b.y,Y=k.y,se=S.y,pe=M<R?M<j?M:j:R<j?R:j,_e=X<Y?X<se?X:se:Y<se?Y:se,we=M>R?M>j?M:j:R>j?R:j,Ce=X>Y?X>se?X:se:Y>se?Y:se,Pe=qp(pe,_e,a,f,m),We=qp(we,Ce,a,f,m),De=c.prevZ,je=c.nextZ;De&&De.z>=Pe&&je&&je.z<=We;){if(De.x>=pe&&De.x<=we&&De.y>=_e&&De.y<=Ce&&De!==b&&De!==S&&Eu(M,X,R,Y,j,se,De.x,De.y)&&Zr(De.prev,De,De.next)>=0||(De=De.prevZ,je.x>=pe&&je.x<=we&&je.y>=_e&&je.y<=Ce&&je!==b&&je!==S&&Eu(M,X,R,Y,j,se,je.x,je.y)&&Zr(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;De&&De.z>=Pe;){if(De.x>=pe&&De.x<=we&&De.y>=_e&&De.y<=Ce&&De!==b&&De!==S&&Eu(M,X,R,Y,j,se,De.x,De.y)&&Zr(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;je&&je.z<=We;){if(je.x>=pe&&je.x<=we&&je.y>=_e&&je.y<=Ce&&je!==b&&je!==S&&Eu(M,X,R,Y,j,se,je.x,je.y)&&Zr(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function vx(c,a,f){var m=c;do{var b=m.prev,k=m.next.next;!td(b,k)&&S_(b,m,m.next,k)&&Jc(b,k)&&Jc(k,b)&&(a.push(b.i/f|0),a.push(m.i/f|0),a.push(k.i/f|0),Yc(m),Yc(m.next),m=c=k),m=m.next}while(m!==c);return kl(m)}function bx(c,a,f,m,b,k){var S=c;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Sx(S,M)){var R=C_(S,M);return S=kl(S,S.next),R=kl(R,R.next),Kc(S,a,f,m,b,k,0),void Kc(R,a,f,m,b,k,0)}M=M.next}S=S.next}while(S!==c)}function wx(c,a){return c.x-a.x}function xx(c,a){var f=function(b,k){var S,M=k,R=b.x,j=b.y,X=-1/0;do{if(j<=M.y&&j>=M.next.y&&M.next.y!==M.y){var Y=M.x+(j-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(Y<=R&&Y>X&&(X=Y,S=M.x<M.next.x?M:M.next,Y===R))return S}M=M.next}while(M!==k);if(!S)return null;var se,pe=S,_e=S.x,we=S.y,Ce=1/0;M=S;do R>=M.x&&M.x>=_e&&R!==M.x&&Eu(j<we?R:X,j,_e,we,j<we?X:R,j,M.x,M.y)&&(se=Math.abs(j-M.y)/(R-M.x),Jc(M,b)&&(se<Ce||se===Ce&&(M.x>S.x||M.x===S.x&&Ax(S,M)))&&(S=M,Ce=se)),M=M.next;while(M!==pe);return S}(c,a);if(!f)return a;var m=C_(f,c);return kl(m,m.next),kl(f,f.next)}function Ax(c,a){return Zr(c.prev,c,a.prev)<0&&Zr(a.next,c,c.next)<0}function qp(c,a,f,m,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function kx(c){var a=c,f=c;do(a.x<f.x||a.x===f.x&&a.y<f.y)&&(f=a),a=a.next;while(a!==c);return f}function Eu(c,a,f,m,b,k,S,M){return(b-S)*(a-M)>=(c-S)*(k-M)&&(c-S)*(m-M)>=(f-S)*(a-M)&&(f-S)*(k-M)>=(b-S)*(m-M)}function Sx(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(f,m){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==m.i&&b.next.i!==m.i&&S_(b,b.next,f,m))return!0;b=b.next}while(b!==f);return!1}(c,a)&&(Jc(c,a)&&Jc(a,c)&&function(f,m){var b=f,k=!1,S=(f.x+m.x)/2,M=(f.y+m.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&S<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(k=!k),b=b.next;while(b!==f);return k}(c,a)&&(Zr(c.prev,c,a.prev)||Zr(c,a.prev,a))||td(c,a)&&Zr(c.prev,c,c.next)>0&&Zr(a.prev,a,a.next)>0)}function Zr(c,a,f){return(a.y-c.y)*(f.x-a.x)-(a.x-c.x)*(f.y-a.y)}function td(c,a){return c.x===a.x&&c.y===a.y}function S_(c,a,f,m){var b=rd(Zr(c,a,f)),k=rd(Zr(c,a,m)),S=rd(Zr(f,m,c)),M=rd(Zr(f,m,a));return b!==k&&S!==M||!(b!==0||!nd(c,f,a))||!(k!==0||!nd(c,m,a))||!(S!==0||!nd(f,c,m))||!(M!==0||!nd(f,a,m))}function nd(c,a,f){return a.x<=Math.max(c.x,f.x)&&a.x>=Math.min(c.x,f.x)&&a.y<=Math.max(c.y,f.y)&&a.y>=Math.min(c.y,f.y)}function rd(c){return c>0?1:c<0?-1:0}function Jc(c,a){return Zr(c.prev,c,c.next)<0?Zr(c,a,c.next)>=0&&Zr(c,c.prev,a)>=0:Zr(c,a,c.prev)<0||Zr(c,c.next,a)<0}function C_(c,a){var f=new Hp(c.i,c.x,c.y),m=new Hp(a.i,a.x,a.y),b=c.next,k=a.prev;return c.next=a,a.prev=c,f.next=b,b.prev=f,m.next=f,f.prev=m,k.next=m,m.prev=k,m}function T_(c,a,f,m){var b=new Hp(c,a,f);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Yc(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Hp(c,a,f){this.i=c,this.x=a,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gp(c,a,f,m){for(var b=0,k=a,S=f-m;k<f;k+=m)b+=(c[S]-c[k])*(c[k+1]+c[S+1]),S=k;return b}Vp.exports=ed,Vp.exports.default=ed,ed.deviation=function(c,a,f,m){var b=a&&a.length,k=Math.abs(Gp(c,0,b?a[0]*f:c.length,f));if(b)for(var S=0,M=a.length;S<M;S++)k-=Math.abs(Gp(c,a[S]*f,S<M-1?a[S+1]*f:c.length,f));var R=0;for(S=0;S<m.length;S+=3){var j=m[S]*f,X=m[S+1]*f,Y=m[S+2]*f;R+=Math.abs((c[j]-c[Y])*(c[X+1]-c[j+1])-(c[j]-c[X])*(c[Y+1]-c[j+1]))}return k===0&&R===0?0:Math.abs((R-k)/k)},ed.flatten=function(c){for(var a=c[0][0].length,f={vertices:[],holes:[],dimensions:a},m=0,b=0;b<c.length;b++){for(var k=0;k<c[b].length;k++)for(var S=0;S<a;S++)f.vertices.push(c[b][k][S]);b>0&&f.holes.push(m+=c[b-1].length)}return f};var M_=d(Vp.exports);function Cx(c,a,f,m,b){E_(c,a,f||0,m||c.length-1,b||Tx)}function E_(c,a,f,m,b){for(;m>f;){if(m-f>600){var k=m-f+1,S=a-f+1,M=Math.log(k),R=.5*Math.exp(2*M/3),j=.5*Math.sqrt(M*R*(k-R)/k)*(S-k/2<0?-1:1);E_(c,a,Math.max(f,Math.floor(a-S*R/k+j)),Math.min(m,Math.floor(a+(k-S)*R/k+j)),b)}var X=c[a],Y=f,se=m;for(Qc(c,f,a),b(c[m],X)>0&&Qc(c,f,m);Y<se;){for(Qc(c,Y,se),Y++,se--;b(c[Y],X)<0;)Y++;for(;b(c[se],X)>0;)se--}b(c[f],X)===0?Qc(c,f,se):Qc(c,++se,m),se<=a&&(f=se+1),a<=se&&(m=se-1)}}function Qc(c,a,f){var m=c[a];c[a]=c[f],c[f]=m}function Tx(c,a){return c<a?-1:c>a?1:0}function Wp(c,a){const f=c.length;if(f<=1)return[c];const m=[];let b,k;for(let S=0;S<f;S++){const M=it(c[S]);M!==0&&(c[S].area=Math.abs(M),k===void 0&&(k=M<0),k===M<0?(b&&m.push(b),b=[c[S]]):b.push(c[S]))}if(b&&m.push(b),a>1)for(let S=0;S<m.length;S++)m[S].length<=a||(Cx(m[S],a,1,m[S].length-1,Mx),m[S]=m[S].slice(0,a));return m}function Mx(c,a){return a.area-c.area}function Zp(c,a,f){const m=f.patternDependencies;let b=!1;for(const k of a){const S=k.paint.get(`${c}-pattern`);S.isConstant()||(b=!0);const M=S.constantOr(null);M&&(b=!0,m[M.to]=!0,m[M.from]=!0)}return b}function Xp(c,a,f,m,b){const k=b.patternDependencies;for(const S of a){const M=S.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let R=M.evaluate({zoom:m-1},f,{},b.availableImages),j=M.evaluate({zoom:m},f,{},b.availableImages),X=M.evaluate({zoom:m+1},f,{},b.availableImages);R=R&&R.name?R.name:R,j=j&&j.name?j.name:j,X=X&&X.name?X.name:X,k[R]=!0,k[j]=!0,k[X]=!0,f.patterns[S.id]={min:R,mid:j,max:X}}}return f}class Kp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ke,this.indexArray=new ft,this.indexArray2=new Ct,this.programConfigurations=new Br(a.layers,a.zoom),this.segments=new Ot,this.segments2=new Ot,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Zp("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:R,index:j,sourceLayerIndex:X}of a){const Y=this.layers[0]._featureFilter.needGeometry,se=Ys(M,Y);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),se,m))continue;const pe=k?b.evaluate(se,{},m,f.availableImages):void 0,_e={id:R,properties:M.properties,type:M.type,sourceLayerIndex:X,index:j,geometry:Y?se.geometry:Js(M),patterns:{},sortKey:pe};S.push(_e)}k&&S.sort((M,R)=>M.sortKey-R.sortKey);for(const M of S){const{geometry:R,index:j,sourceLayerIndex:X}=M;if(this.hasPattern){const Y=Xp("fill",this.layers,M,this.zoom,f);this.patternFeatures.push(Y)}else this.addFeature(M,R,j,m,{});f.featureIndex.insert(a[j].feature,R,j,X,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,gx),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,f,m,b,k){for(const S of Wp(f,500)){let M=0;for(const pe of S)M+=pe.length;const R=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),j=R.vertexLength,X=[],Y=[];for(const pe of S){if(pe.length===0)continue;pe!==S[0]&&Y.push(X.length/2);const _e=this.segments2.prepareSegment(pe.length,this.layoutVertexArray,this.indexArray2),we=_e.vertexLength;this.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),this.indexArray2.emplaceBack(we+pe.length-1,we),X.push(pe[0].x),X.push(pe[0].y);for(let Ce=1;Ce<pe.length;Ce++)this.layoutVertexArray.emplaceBack(pe[Ce].x,pe[Ce].y),this.indexArray2.emplaceBack(we+Ce-1,we+Ce),X.push(pe[Ce].x),X.push(pe[Ce].y);_e.vertexLength+=pe.length,_e.primitiveLength+=pe.length}const se=M_(X,Y);for(let pe=0;pe<se.length;pe+=3)this.indexArray.emplaceBack(j+se[pe],j+se[pe+1],j+se[pe+2]);R.vertexLength+=M,R.primitiveLength+=se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}let L_,I_;Zt("FillBucket",Kp,{omit:["layers","patternFeatures"]});var Ex={get paint(){return I_=I_||new Ni({"fill-antialias":new sn(he.paint_fill["fill-antialias"]),"fill-opacity":new hn(he.paint_fill["fill-opacity"]),"fill-color":new hn(he.paint_fill["fill-color"]),"fill-outline-color":new hn(he.paint_fill["fill-outline-color"]),"fill-translate":new sn(he.paint_fill["fill-translate"]),"fill-translate-anchor":new sn(he.paint_fill["fill-translate-anchor"]),"fill-pattern":new _u(he.paint_fill["fill-pattern"])})},get layout(){return L_=L_||new Ni({"fill-sort-key":new hn(he.layout_fill["fill-sort-key"])})}};class Lx extends Mo{constructor(a){super(a,Ex)}recalculate(a,f){super.recalculate(a,f);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Kp(a)}queryRadius(){return Jh(this.paint.get("fill-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){return qc(Yh(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,M),b)}isTileClipped(){return!0}}const Ix=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Px=Wr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:zx}=Ix;var Ta={},Dx=p,P_=Lu;function Lu(c,a,f,m,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=b,c.readFields(Rx,this,a)}function Rx(c,a,f){c==1?a.id=f.readVarint():c==2?function(m,b){for(var k=m.readVarint()+m.pos;m.pos<k;){var S=b._keys[m.readVarint()],M=b._values[m.readVarint()];b.properties[S]=M}}(f,a):c==3?a.type=f.readVarint():c==4&&(a._geometry=f.pos)}function Bx(c){for(var a,f,m=0,b=0,k=c.length,S=k-1;b<k;S=b++)m+=((f=c[S]).x-(a=c[b]).x)*(a.y+f.y);return m}Lu.types=["Unknown","Point","LineString","Polygon"],Lu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,f=c.readVarint()+c.pos,m=1,b=0,k=0,S=0,M=[];c.pos<f;){if(b<=0){var R=c.readVarint();m=7&R,b=R>>3}if(b--,m===1||m===2)k+=c.readSVarint(),S+=c.readSVarint(),m===1&&(a&&M.push(a),a=[]),a.push(new Dx(k,S));else{if(m!==7)throw new Error("unknown command "+m);a&&a.push(a[0].clone())}}return a&&M.push(a),M},Lu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,f=1,m=0,b=0,k=0,S=1/0,M=-1/0,R=1/0,j=-1/0;c.pos<a;){if(m<=0){var X=c.readVarint();f=7&X,m=X>>3}if(m--,f===1||f===2)(b+=c.readSVarint())<S&&(S=b),b>M&&(M=b),(k+=c.readSVarint())<R&&(R=k),k>j&&(j=k);else if(f!==7)throw new Error("unknown command "+f)}return[S,R,M,j]},Lu.prototype.toGeoJSON=function(c,a,f){var m,b,k=this.extent*Math.pow(2,f),S=this.extent*c,M=this.extent*a,R=this.loadGeometry(),j=Lu.types[this.type];function X(pe){for(var _e=0;_e<pe.length;_e++){var we=pe[_e];pe[_e]=[360*(we.x+S)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(we.y+M)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var Y=[];for(m=0;m<R.length;m++)Y[m]=R[m][0];X(R=Y);break;case 2:for(m=0;m<R.length;m++)X(R[m]);break;case 3:for(R=function(pe){var _e=pe.length;if(_e<=1)return[pe];for(var we,Ce,Pe=[],We=0;We<_e;We++){var De=Bx(pe[We]);De!==0&&(Ce===void 0&&(Ce=De<0),Ce===De<0?(we&&Pe.push(we),we=[pe[We]]):we.push(pe[We]))}return we&&Pe.push(we),Pe}(R),m=0;m<R.length;m++)for(b=0;b<R[m].length;b++)X(R[m][b])}R.length===1?R=R[0]:j="Multi"+j;var se={type:"Feature",geometry:{type:j,coordinates:R},properties:this.properties};return"id"in this&&(se.id=this.id),se};var Fx=P_,z_=D_;function D_(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Ox,this,a),this.length=this._features.length}function Ox(c,a,f){c===15?a.version=f.readVarint():c===1?a.name=f.readString():c===5?a.extent=f.readVarint():c===2?a._features.push(f.pos):c===3?a._keys.push(f.readString()):c===4&&a._values.push(function(m){for(var b=null,k=m.readVarint()+m.pos;m.pos<k;){var S=m.readVarint()>>3;b=S===1?m.readString():S===2?m.readFloat():S===3?m.readDouble():S===4?m.readVarint64():S===5?m.readVarint():S===6?m.readSVarint():S===7?m.readBoolean():null}return b}(f))}D_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new Fx(this._pbf,a,this.extent,this._keys,this._values)};var $x=z_;function Nx(c,a,f){if(c===3){var m=new $x(f,f.readVarint()+f.pos);m.length&&(a[m.name]=m)}}Ta.VectorTile=function(c,a){this.layers=c.readFields(Nx,{},a)},Ta.VectorTileFeature=P_,Ta.VectorTileLayer=z_;const jx=Ta.VectorTileFeature.types,Jp=Math.pow(2,13);function ef(c,a,f,m,b,k,S,M){c.emplaceBack(a,f,2*Math.floor(m*Jp)+S,b*Jp*2,k*Jp*2,Math.round(M))}class Yp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Ae,this.centroidVertexArray=new te,this.indexArray=new ft,this.programConfigurations=new Br(a.layers,a.zoom),this.segments=new Ot,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.features=[],this.hasPattern=Zp("fill-extrusion",this.layers,f);for(const{feature:b,id:k,index:S,sourceLayerIndex:M}of a){const R=this.layers[0]._featureFilter.needGeometry,j=Ys(b,R);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),j,m))continue;const X={id:k,sourceLayerIndex:M,index:S,geometry:R?j.geometry:Js(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(Xp("fill-extrusion",this.layers,X,this.zoom,f)):this.addFeature(X,X.geometry,S,m,{}),f.featureIndex.insert(b,X.geometry,S,M,this.index,!0)}}addFeatures(a,f,m){for(const b of this.features){const{geometry:k}=b;this.addFeature(b,k,b.index,f,m)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,zx),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Px.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,f,m,b,k){const S={x:0,y:0,vertexCount:0};for(const M of Wp(f,500)){let R=0;for(const _e of M)R+=_e.length;let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const _e of M){if(_e.length===0||Vx(_e))continue;let we=0;for(let Ce=0;Ce<_e.length;Ce++){const Pe=_e[Ce];if(Ce>=1){const We=_e[Ce-1];if(!Ux(Pe,We)){j.vertexLength+4>Ot.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=Pe.sub(We)._perp()._unit(),je=We.dist(Pe);we+je>32768&&(we=0),ef(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,0,we),ef(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,1,we),S.x+=2*Pe.x,S.y+=2*Pe.y,S.vertexCount+=2,we+=je,ef(this.layoutVertexArray,We.x,We.y,De.x,De.y,0,0,we),ef(this.layoutVertexArray,We.x,We.y,De.x,De.y,0,1,we),S.x+=2*We.x,S.y+=2*We.y,S.vertexCount+=2;const dt=j.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+R>Ot.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),jx[a.type]!=="Polygon")continue;const X=[],Y=[],se=j.vertexLength;for(const _e of M)if(_e.length!==0){_e!==M[0]&&Y.push(X.length/2);for(let we=0;we<_e.length;we++){const Ce=_e[we];ef(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),S.x+=Ce.x,S.y+=Ce.y,S.vertexCount+=1,X.push(Ce.x),X.push(Ce.y)}}const pe=M_(X,Y);for(let _e=0;_e<pe.length;_e+=3)this.indexArray.emplaceBack(se+pe[_e],se+pe[_e+2],se+pe[_e+1]);j.primitiveLength+=pe.length/3,j.vertexLength+=R}for(let M=0;M<S.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}function Ux(c,a){return c.x===a.x&&(c.x<0||c.x>qr)||c.y===a.y&&(c.y<0||c.y>qr)}function Vx(c){return c.every(a=>a.x<0)||c.every(a=>a.x>qr)||c.every(a=>a.y<0)||c.every(a=>a.y>qr)}let R_;Zt("FillExtrusionBucket",Yp,{omit:["layers","features"]});var qx={get paint(){return R_=R_||new Ni({"fill-extrusion-opacity":new sn(he["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hn(he["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sn(he["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sn(he["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _u(he["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hn(he["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hn(he["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sn(he["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Hx extends Mo{constructor(a){super(a,qx)}createBucket(a){return new Yp(a)}queryRadius(){return Jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,f,m,b,k,S,M,R){const j=Yh(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,M),X=this.paint.get("fill-extrusion-height").evaluate(f,m),Y=this.paint.get("fill-extrusion-base").evaluate(f,m),se=function(_e,we,Ce,Pe){const We=[];for(const De of _e){const je=[De.x,De.y,0,1];Qh(je,je,we),We.push(new _(je[0]/je[3],je[1]/je[3]))}return We}(j,R),pe=function(_e,we,Ce,Pe){const We=[],De=[],je=Pe[8]*we,dt=Pe[9]*we,vt=Pe[10]*we,Ht=Pe[11]*we,tn=Pe[8]*Ce,qt=Pe[9]*Ce,Ut=Pe[10]*Ce,Ft=Pe[11]*Ce;for(const Xt of _e){const Nt=[],It=[];for(const fn of Xt){const on=fn.x,Bn=fn.y,xr=Pe[0]*on+Pe[4]*Bn+Pe[12],Lr=Pe[1]*on+Pe[5]*Bn+Pe[13],li=Pe[2]*on+Pe[6]*Bn+Pe[14],_o=Pe[3]*on+Pe[7]*Bn+Pe[15],Ui=li+vt,ei=_o+Ht,yi=xr+tn,Si=Lr+qt,Vi=li+Ut,qi=_o+Ft,ui=new _((xr+je)/ei,(Lr+dt)/ei);ui.z=Ui/ei,Nt.push(ui);const ci=new _(yi/qi,Si/qi);ci.z=Vi/qi,It.push(ci)}We.push(Nt),De.push(It)}return[We,De]}(b,Y,X,R);return function(_e,we,Ce){let Pe=1/0;qc(Ce,we)&&(Pe=B_(Ce,we[0]));for(let We=0;We<we.length;We++){const De=we[We],je=_e[We];for(let dt=0;dt<De.length-1;dt++){const vt=De[dt],Ht=[vt,De[dt+1],je[dt+1],je[dt],vt];Vc(Ce,Ht)&&(Pe=Math.min(Pe,B_(Ce,Ht)))}}return Pe!==1/0&&Pe}(pe[0],pe[1],se)}}function tf(c,a){return c.x*a.x+c.y*a.y}function B_(c,a){if(c.length===1){let f=0;const m=a[f++];let b;for(;!b||m.equals(b);)if(b=a[f++],!b)return 1/0;for(;f<a.length;f++){const k=a[f],S=c[0],M=b.sub(m),R=k.sub(m),j=S.sub(m),X=tf(M,M),Y=tf(M,R),se=tf(R,R),pe=tf(j,M),_e=tf(j,R),we=X*se-Y*Y,Ce=(se*pe-Y*_e)/we,Pe=(X*_e-Y*pe)/we,We=m.z*(1-Ce-Pe)+b.z*Ce+k.z*Pe;if(isFinite(We))return We}return 1/0}{let f=1/0;for(const m of a)f=Math.min(f,m.z);return f}}const Gx=Wr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Wx}=Gx,Zx=Wr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Xx}=Zx,Kx=Ta.VectorTileFeature.types,Jx=Math.cos(Math.PI/180*37.5),F_=Math.pow(2,14)/.5;class Qp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Te,this.layoutVertexArray2=new be,this.indexArray=new ft,this.programConfigurations=new Br(a.layers,a.zoom),this.segments=new Ot,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Zp("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:R,index:j,sourceLayerIndex:X}of a){const Y=this.layers[0]._featureFilter.needGeometry,se=Ys(M,Y);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),se,m))continue;const pe=k?b.evaluate(se,{},m):void 0,_e={id:R,properties:M.properties,type:M.type,sourceLayerIndex:X,index:j,geometry:Y?se.geometry:Js(M),patterns:{},sortKey:pe};S.push(_e)}k&&S.sort((M,R)=>M.sortKey-R.sortKey);for(const M of S){const{geometry:R,index:j,sourceLayerIndex:X}=M;if(this.hasPattern){const Y=Xp("line",this.layers,M,this.zoom,f);this.patternFeatures.push(Y)}else this.addFeature(M,R,j,m,{});f.featureIndex.insert(a[j].feature,R,j,X,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Xx)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Wx),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,f,m,b,k){const S=this.layers[0].layout,M=S.get("line-join").evaluate(a,{}),R=S.get("line-cap"),j=S.get("line-miter-limit"),X=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const Y of f)this.addLine(Y,a,M,R,j,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}addLine(a,f,m,b,k,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<a.length-1;Pe++)this.totalDistance+=a[Pe].dist(a[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Kx[f.type]==="Polygon";let R=a.length;for(;R>=2&&a[R-1].equals(a[R-2]);)R--;let j=0;for(;j<R-1&&a[j].equals(a[j+1]);)j++;if(R<(M?3:2))return;m==="bevel"&&(k=1.05);const X=this.overscaling<=16?15*qr/(512*this.overscaling):0,Y=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let se,pe,_e,we,Ce;this.e1=this.e2=-1,M&&(se=a[R-2],Ce=a[j].sub(se)._unit()._perp());for(let Pe=j;Pe<R;Pe++){if(_e=Pe===R-1?M?a[j+1]:void 0:a[Pe+1],_e&&a[Pe].equals(_e))continue;Ce&&(we=Ce),se&&(pe=se),se=a[Pe],Ce=_e?_e.sub(se)._unit()._perp():we,we=we||Ce;let We=we.add(Ce);We.x===0&&We.y===0||We._unit();const De=we.x*Ce.x+we.y*Ce.y,je=We.x*Ce.x+We.y*Ce.y,dt=je!==0?1/je:1/0,vt=2*Math.sqrt(2-2*je),Ht=je<Jx&&pe&&_e,tn=we.x*Ce.y-we.y*Ce.x>0;if(Ht&&Pe>j){const Ft=se.dist(pe);if(Ft>2*X){const Xt=se.sub(se.sub(pe)._mult(X/Ft)._round());this.updateDistance(pe,Xt),this.addCurrentVertex(Xt,we,0,0,Y),pe=Xt}}const qt=pe&&_e;let Ut=qt?m:M?"butt":b;if(qt&&Ut==="round"&&(dt<S?Ut="miter":dt<=2&&(Ut="fakeround")),Ut==="miter"&&dt>k&&(Ut="bevel"),Ut==="bevel"&&(dt>2&&(Ut="flipbevel"),dt<k&&(Ut="miter")),pe&&this.updateDistance(pe,se),Ut==="miter")We._mult(dt),this.addCurrentVertex(se,We,0,0,Y);else if(Ut==="flipbevel"){if(dt>100)We=Ce.mult(-1);else{const Ft=dt*we.add(Ce).mag()/we.sub(Ce).mag();We._perp()._mult(Ft*(tn?-1:1))}this.addCurrentVertex(se,We,0,0,Y),this.addCurrentVertex(se,We.mult(-1),0,0,Y)}else if(Ut==="bevel"||Ut==="fakeround"){const Ft=-Math.sqrt(dt*dt-1),Xt=tn?Ft:0,Nt=tn?0:Ft;if(pe&&this.addCurrentVertex(se,we,Xt,Nt,Y),Ut==="fakeround"){const It=Math.round(180*vt/Math.PI/20);for(let fn=1;fn<It;fn++){let on=fn/It;if(on!==.5){const xr=on-.5;on+=on*xr*(on-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*xr*xr+(.848013+De*(.215638*De-1.06021)))}const Bn=Ce.sub(we)._mult(on)._add(we)._unit()._mult(tn?-1:1);this.addHalfVertex(se,Bn.x,Bn.y,!1,tn,0,Y)}}_e&&this.addCurrentVertex(se,Ce,-Xt,-Nt,Y)}else if(Ut==="butt")this.addCurrentVertex(se,We,0,0,Y);else if(Ut==="square"){const Ft=pe?1:-1;this.addCurrentVertex(se,We,Ft,Ft,Y)}else Ut==="round"&&(pe&&(this.addCurrentVertex(se,we,0,0,Y),this.addCurrentVertex(se,we,1,1,Y,!0)),_e&&(this.addCurrentVertex(se,Ce,-1,-1,Y,!0),this.addCurrentVertex(se,Ce,0,0,Y)));if(Ht&&Pe<R-1){const Ft=se.dist(_e);if(Ft>2*X){const Xt=se.add(_e.sub(se)._mult(X/Ft)._round());this.updateDistance(se,Xt),this.addCurrentVertex(Xt,Ce,0,0,Y),se=Xt}}}}addCurrentVertex(a,f,m,b,k,S=!1){const M=f.y*b-f.x,R=-f.y-f.x*b;this.addHalfVertex(a,f.x+f.y*m,f.y-f.x*m,S,!1,m,k),this.addHalfVertex(a,M,R,S,!0,-b,k),this.distance>F_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,f,m,b,k,S))}addHalfVertex({x:a,y:f},m,b,k,S,M,R){const j=.5*(this.lineClips?this.scaledDistance*(F_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(k?1:0),(f<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(M===0?0:M<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,X),R.primitiveLength++),S?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,f){this.distance+=a.dist(f),this.updateScaledDistance()}}let O_,$_;Zt("LineBucket",Qp,{omit:["layers","patternFeatures"]});var N_={get paint(){return $_=$_||new Ni({"line-opacity":new hn(he.paint_line["line-opacity"]),"line-color":new hn(he.paint_line["line-color"]),"line-translate":new sn(he.paint_line["line-translate"]),"line-translate-anchor":new sn(he.paint_line["line-translate-anchor"]),"line-width":new hn(he.paint_line["line-width"]),"line-gap-width":new hn(he.paint_line["line-gap-width"]),"line-offset":new hn(he.paint_line["line-offset"]),"line-blur":new hn(he.paint_line["line-blur"]),"line-dasharray":new _l(he.paint_line["line-dasharray"]),"line-pattern":new _u(he.paint_line["line-pattern"]),"line-gradient":new zc(he.paint_line["line-gradient"])})},get layout(){return O_=O_||new Ni({"line-cap":new sn(he.layout_line["line-cap"]),"line-join":new hn(he.layout_line["line-join"]),"line-miter-limit":new sn(he.layout_line["line-miter-limit"]),"line-round-limit":new sn(he.layout_line["line-round-limit"]),"line-sort-key":new hn(he.layout_line["line-sort-key"])})}};class Yx extends hn{possiblyEvaluate(a,f){return f=new Mr(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(a,f)}evaluate(a,f,m,b){return f=q({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(a,f,m,b)}}let id;class Qx extends Mo{constructor(a){super(a,N_),this.gradientVersion=0,id||(id=new Yx(N_.paint.properties["line-width"].specification),id.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,f){super.recalculate(a,f),this.paint._values["line-floorwidth"]=id.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Qp(a)}queryRadius(a){const f=a,m=j_(Wc("line-width",this,f),Wc("line-gap-width",this,f)),b=Wc("line-offset",this,f);return m/2+Math.abs(b)+Jh(this.paint.get("line-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){const R=Yh(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,M),j=M/2*j_(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),X=this.paint.get("line-offset").evaluate(f,m);return X&&(b=function(Y,se){const pe=[];for(let _e=0;_e<Y.length;_e++){const we=Y[_e],Ce=[];for(let Pe=0;Pe<we.length;Pe++){const We=we[Pe-1],De=we[Pe],je=we[Pe+1],dt=Pe===0?new _(0,0):De.sub(We)._unit()._perp(),vt=Pe===we.length-1?new _(0,0):je.sub(De)._unit()._perp(),Ht=dt._add(vt)._unit(),tn=Ht.x*vt.x+Ht.y*vt.y;tn!==0&&Ht._mult(1/tn),Ce.push(Ht._mult(se)._add(De))}pe.push(Ce)}return pe}(b,X*M)),function(Y,se,pe){for(let _e=0;_e<se.length;_e++){const we=se[_e];if(Y.length>=3){for(let Ce=0;Ce<we.length;Ce++)if(Tu(Y,we[Ce]))return!0}if(Hc(Y,we,pe))return!0}return!1}(R,b,j)}isTileClipped(){return!0}}function j_(c,a){return a>0?a+2*c:c}const eA=Wr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tA=Wr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nA=Wr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Wr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const U_=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rA=Wr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iA(c,a,f){return c.sections.forEach(m=>{m.text=function(b,k,S){const M=k.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Ls.applyArabicShaping&&(b=Ls.applyArabicShaping(b)),b}(m.text,a,f)}),c}Wr([{name:"triangle",components:3,type:"Uint16"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wr([{type:"Float32",name:"offsetX"}]),Wr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ai=24,V_=hr,q_=function(c,a,f,m,b){var k,S,M=8*b-m-1,R=(1<<M)-1,j=R>>1,X=-7,Y=f?b-1:0,se=f?-1:1,pe=c[a+Y];for(Y+=se,k=pe&(1<<-X)-1,pe>>=-X,X+=M;X>0;k=256*k+c[a+Y],Y+=se,X-=8);for(S=k&(1<<-X)-1,k>>=-X,X+=m;X>0;S=256*S+c[a+Y],Y+=se,X-=8);if(k===0)k=1-j;else{if(k===R)return S?NaN:1/0*(pe?-1:1);S+=Math.pow(2,m),k-=j}return(pe?-1:1)*S*Math.pow(2,k-m)},H_=function(c,a,f,m,b,k){var S,M,R,j=8*k-b-1,X=(1<<j)-1,Y=X>>1,se=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,pe=m?0:k-1,_e=m?1:-1,we=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=X):(S=Math.floor(Math.log(a)/Math.LN2),a*(R=Math.pow(2,-S))<1&&(S--,R*=2),(a+=S+Y>=1?se/R:se*Math.pow(2,1-Y))*R>=2&&(S++,R/=2),S+Y>=X?(M=0,S=X):S+Y>=1?(M=(a*R-1)*Math.pow(2,b),S+=Y):(M=a*Math.pow(2,Y-1)*Math.pow(2,b),S=0));b>=8;c[f+pe]=255&M,pe+=_e,M/=256,b-=8);for(S=S<<b|M,j+=b;j>0;c[f+pe]=255&S,pe+=_e,S/=256,j-=8);c[f+pe-_e]|=128*we};function hr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}hr.Varint=0,hr.Fixed64=1,hr.Bytes=2,hr.Fixed32=5;var em=4294967296,G_=1/em,W_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Qs(c){return c.type===hr.Bytes?c.readVarint()+c.pos:c.pos+1}function Iu(c,a,f){return f?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function Z_(c,a,f){var m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));f.realloc(m);for(var b=f.pos-1;b>=c;b--)f.buf[b+m]=f.buf[b]}function oA(c,a){for(var f=0;f<c.length;f++)a.writeVarint(c[f])}function sA(c,a){for(var f=0;f<c.length;f++)a.writeSVarint(c[f])}function aA(c,a){for(var f=0;f<c.length;f++)a.writeFloat(c[f])}function lA(c,a){for(var f=0;f<c.length;f++)a.writeDouble(c[f])}function uA(c,a){for(var f=0;f<c.length;f++)a.writeBoolean(c[f])}function cA(c,a){for(var f=0;f<c.length;f++)a.writeFixed32(c[f])}function fA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed32(c[f])}function hA(c,a){for(var f=0;f<c.length;f++)a.writeFixed64(c[f])}function dA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed64(c[f])}function od(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Pu(c,a,f){c[f]=a,c[f+1]=a>>>8,c[f+2]=a>>>16,c[f+3]=a>>>24}function X_(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}hr.prototype={destroy:function(){this.buf=null},readFields:function(c,a,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),b=m>>3,k=this.pos;this.type=7&m,c(b,a,this),this.pos===k&&this.skip(m)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=od(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=X_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=od(this.buf,this.pos)+od(this.buf,this.pos+4)*em;return this.pos+=8,c},readSFixed64:function(){var c=od(this.buf,this.pos)+X_(this.buf,this.pos+4)*em;return this.pos+=8,c},readFloat:function(){var c=q_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=q_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,f,m=this.buf;return a=127&(f=m[this.pos++]),f<128?a:(a|=(127&(f=m[this.pos++]))<<7,f<128?a:(a|=(127&(f=m[this.pos++]))<<14,f<128?a:(a|=(127&(f=m[this.pos++]))<<21,f<128?a:function(b,k,S){var M,R,j=S.buf;if(M=(112&(R=j[S.pos++]))>>4,R<128||(M|=(127&(R=j[S.pos++]))<<3,R<128)||(M|=(127&(R=j[S.pos++]))<<10,R<128)||(M|=(127&(R=j[S.pos++]))<<17,R<128)||(M|=(127&(R=j[S.pos++]))<<24,R<128)||(M|=(1&(R=j[S.pos++]))<<31,R<128))return Iu(b,M,k);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(f=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&W_?function(f,m,b){return W_.decode(f.subarray(m,b))}(this.buf,a,c):function(f,m,b){for(var k="",S=m;S<b;){var M,R,j,X=f[S],Y=null,se=X>239?4:X>223?3:X>191?2:1;if(S+se>b)break;se===1?X<128&&(Y=X):se===2?(192&(M=f[S+1]))==128&&(Y=(31&X)<<6|63&M)<=127&&(Y=null):se===3?(R=f[S+2],(192&(M=f[S+1]))==128&&(192&R)==128&&((Y=(15&X)<<12|(63&M)<<6|63&R)<=2047||Y>=55296&&Y<=57343)&&(Y=null)):se===4&&(R=f[S+2],j=f[S+3],(192&(M=f[S+1]))==128&&(192&R)==128&&(192&j)==128&&((Y=(15&X)<<18|(63&M)<<12|(63&R)<<6|63&j)<=65535||Y>=1114112)&&(Y=null)),Y===null?(Y=65533,se=1):Y>65535&&(Y-=65536,k+=String.fromCharCode(Y>>>10&1023|55296),Y=56320|1023&Y),k+=String.fromCharCode(Y),S+=se}return k}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==hr.Bytes)return c.push(this.readVarint(a));var f=Qs(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==hr.Bytes)return c.push(this.readSVarint());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==hr.Bytes)return c.push(this.readBoolean());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==hr.Bytes)return c.push(this.readFloat());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==hr.Bytes)return c.push(this.readDouble());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==hr.Bytes)return c.push(this.readFixed32());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==hr.Bytes)return c.push(this.readSFixed32());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==hr.Bytes)return c.push(this.readFixed64());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==hr.Bytes)return c.push(this.readSFixed64());var a=Qs(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===hr.Varint)for(;this.buf[this.pos++]>127;);else if(a===hr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===hr.Fixed32)this.pos+=4;else{if(a!==hr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var f=new Uint8Array(a);f.set(this.buf),this.buf=f,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Pu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Pu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Pu(this.buf,-1&c,this.pos),Pu(this.buf,Math.floor(c*G_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Pu(this.buf,-1&c,this.pos),Pu(this.buf,Math.floor(c*G_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,f){var m,b;if(a>=0?(m=a%4294967296|0,b=a/4294967296|0):(b=~(-a/4294967296),4294967295^(m=~(-a%4294967296))?m=m+1|0:(m=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(k,S,M){M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,M.buf[M.pos]=127&(k>>>=7)}(m,0,f),function(k,S){var M=(7&k)<<4;S.buf[S.pos++]|=M|((k>>>=3)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k)))))}(b,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(m,b,k){for(var S,M,R=0;R<b.length;R++){if((S=b.charCodeAt(R))>55295&&S<57344){if(!M){S>56319||R+1===b.length?(m[k++]=239,m[k++]=191,m[k++]=189):M=S;continue}if(S<56320){m[k++]=239,m[k++]=191,m[k++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(m[k++]=239,m[k++]=191,m[k++]=189,M=null);S<128?m[k++]=S:(S<2048?m[k++]=S>>6|192:(S<65536?m[k++]=S>>12|224:(m[k++]=S>>18|240,m[k++]=S>>12&63|128),m[k++]=S>>6&63|128),m[k++]=63&S|128)}return k}(this.buf,c,this.pos);var f=this.pos-a;f>=128&&Z_(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),H_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),H_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var f=0;f<a;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,a){this.pos++;var f=this.pos;c(a,this);var m=this.pos-f;m>=128&&Z_(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,a,f){this.writeTag(c,hr.Bytes),this.writeRawMessage(a,f)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,oA,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,sA,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,uA,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,aA,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,lA,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,cA,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,fA,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,hA,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,dA,a)},writeBytesField:function(c,a){this.writeTag(c,hr.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,hr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,hr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,hr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,hr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,hr.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,hr.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,hr.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,hr.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,hr.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var tm=d(V_);const nm=3;function pA(c,a,f){c===1&&f.readMessage(mA,a)}function mA(c,a,f){if(c===3){const{id:m,bitmap:b,width:k,height:S,left:M,top:R,advance:j}=f.readMessage(gA,{});a.push({id:m,bitmap:new Xc({width:k+2*nm,height:S+2*nm},b),metrics:{width:k,height:S,left:M,top:R,advance:j}})}}function gA(c,a,f){c===1?a.id=f.readVarint():c===2?a.bitmap=f.readBytes():c===3?a.width=f.readVarint():c===4?a.height=f.readVarint():c===5?a.left=f.readSVarint():c===6?a.top=f.readSVarint():c===7&&(a.advance=f.readVarint())}const K_=nm;function J_(c){let a=0,f=0;for(const S of c)a+=S.w*S.h,f=Math.max(f,S.w);c.sort((S,M)=>M.h-S.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),f),h:1/0}];let b=0,k=0;for(const S of c)for(let M=m.length-1;M>=0;M--){const R=m[M];if(!(S.w>R.w||S.h>R.h)){if(S.x=R.x,S.y=R.y,k=Math.max(k,S.y+S.h),b=Math.max(b,S.x+S.w),S.w===R.w&&S.h===R.h){const j=m.pop();M<m.length&&(m[M]=j)}else S.h===R.h?(R.x+=S.w,R.w-=S.w):S.w===R.w?(R.y+=S.h,R.h-=S.h):(m.push({x:R.x+S.w,y:R.y,w:R.w-S.w,h:S.h}),R.y+=S.h,R.h-=S.h);break}}return{w:b,h:k,fill:a/(b*k)||0}}const oo=1;class rm{constructor(a,{pixelRatio:f,version:m,stretchX:b,stretchY:k,content:S}){this.paddedRect=a,this.pixelRatio=f,this.stretchX=b,this.stretchY=k,this.content=S,this.version=m}get tl(){return[this.paddedRect.x+oo,this.paddedRect.y+oo]}get br(){return[this.paddedRect.x+this.paddedRect.w-oo,this.paddedRect.y+this.paddedRect.h-oo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*oo)/this.pixelRatio,(this.paddedRect.h-2*oo)/this.pixelRatio]}}class Y_{constructor(a,f){const m={},b={};this.haveRenderCallbacks=[];const k=[];this.addImages(a,m,k),this.addImages(f,b,k);const{w:S,h:M}=J_(k),R=new Eo({width:S||1,height:M||1});for(const j in a){const X=a[j],Y=m[j].paddedRect;Eo.copy(X.data,R,{x:0,y:0},{x:Y.x+oo,y:Y.y+oo},X.data)}for(const j in f){const X=f[j],Y=b[j].paddedRect,se=Y.x+oo,pe=Y.y+oo,_e=X.data.width,we=X.data.height;Eo.copy(X.data,R,{x:0,y:0},{x:se,y:pe},X.data),Eo.copy(X.data,R,{x:0,y:we-1},{x:se,y:pe-1},{width:_e,height:1}),Eo.copy(X.data,R,{x:0,y:0},{x:se,y:pe+we},{width:_e,height:1}),Eo.copy(X.data,R,{x:_e-1,y:0},{x:se-1,y:pe},{width:1,height:we}),Eo.copy(X.data,R,{x:0,y:0},{x:se+_e,y:pe},{width:1,height:we})}this.image=R,this.iconPositions=m,this.patternPositions=b}addImages(a,f,m){for(const b in a){const k=a[b],S={x:0,y:0,w:k.data.width+2*oo,h:k.data.height+2*oo};m.push(S),f[b]=new rm(S,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,f){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),f),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),f)}patchUpdatedImage(a,f,m){if(!a||!f||a.version===f.version)return;a.version=f.version;const[b,k]=a.tl;m.update(f.data,void 0,{x:b,y:k})}}var Ma;Zt("ImagePosition",rm),Zt("ImageAtlas",Y_),u.ah=void 0,(Ma=u.ah||(u.ah={}))[Ma.none=0]="none",Ma[Ma.horizontal=1]="horizontal",Ma[Ma.vertical=2]="vertical",Ma[Ma.horizontalOnly=3]="horizontalOnly";const rf=-17;class of{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,f){const m=new of;return m.scale=a||1,m.fontStack=f,m}static forImage(a){const f=new of;return f.imageName=a,f}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,f){const m=new zu;for(let b=0;b<a.sections.length;b++){const k=a.sections[b];k.image?m.addImageSection(k):m.addTextSection(k,f)}return m}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let f="";for(let m=0;m<a.length;m++){const b=a.charCodeAt(m+1)||null,k=a.charCodeAt(m-1)||null;f+=b&&Ic(b)&&!nf[a[m+1]]||k&&Ic(k)&&!nf[a[m-1]]||!nf[a[m]]?a[m]:nf[a[m]]}return f}(this.text)}trim(){let a=0;for(let m=0;m<this.text.length&&ad[this.text.charCodeAt(m)];m++)a++;let f=this.text.length;for(let m=this.text.length-1;m>=0&&m>=a&&ad[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)}substring(a,f){const m=new zu;return m.text=this.text.substring(a,f),m.sectionIndex=this.sectionIndex.slice(a,f),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,f)=>Math.max(a,this.sections[f].scale),0)}addTextSection(a,f){this.text+=a.text,this.sections.push(of.forText(a.scale,a.fontStack||f));const m=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(m)}addImageSection(a){const f=a.image?a.image.name:"";if(f.length===0)return void ve("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(of.forImage(f)),this.sectionIndex.push(this.sections.length-1)):ve("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function sd(c,a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e,we){const Ce=zu.fromFeature(c,b);let Pe;Y===u.ah.vertical&&Ce.verticalizePunctuation();const{processBidirectionalText:We,processStyledBidirectionalText:De}=Ls;if(We&&Ce.sections.length===1){Pe=[];const vt=We(Ce.toString(),im(Ce,j,k,a,m,pe,_e));for(const Ht of vt){const tn=new zu;tn.text=Ht,tn.sections=Ce.sections;for(let qt=0;qt<Ht.length;qt++)tn.sectionIndex.push(0);Pe.push(tn)}}else if(De){Pe=[];const vt=De(Ce.text,Ce.sectionIndex,im(Ce,j,k,a,m,pe,_e));for(const Ht of vt){const tn=new zu;tn.text=Ht[0],tn.sectionIndex=Ht[1],tn.sections=Ce.sections,Pe.push(tn)}}else Pe=function(vt,Ht){const tn=[],qt=vt.text;let Ut=0;for(const Ft of Ht)tn.push(vt.substring(Ut,Ft)),Ut=Ft;return Ut<qt.length&&tn.push(vt.substring(Ut,qt.length)),tn}(Ce,im(Ce,j,k,a,m,pe,_e));const je=[],dt={positionedLines:je,text:Ce.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:Y,iconsInText:!1,verticalizable:!1};return function(vt,Ht,tn,qt,Ut,Ft,Xt,Nt,It,fn,on,Bn){let xr=0,Lr=rf,li=0,_o=0;const Ui=Nt==="right"?1:Nt==="left"?0:.5;let ei=0;for(const ui of Ut){ui.trim();const ci=ui.getMaxScale(),Ii=(ci-1)*ai,Hi={positionedGlyphs:[],lineOffset:0};vt.positionedLines[ei]=Hi;const Pi=Hi.positionedGlyphs;let so=0;if(!ui.length()){Lr+=Ft,++ei;continue}for(let fi=0;fi<ui.length();fi++){const jn=ui.getSection(fi),zi=ui.getSectionIndex(fi),Ci=ui.getCharCode(fi);let hi=0,Jo=null,hs=null,ds=null,ea=ai;const Yo=!(It===u.ah.horizontal||!on&&!pu(Ci)||on&&(ad[Ci]||(yi=Ci,Vt.Arabic(yi)||Vt["Arabic Supplement"](yi)||Vt["Arabic Extended-A"](yi)||Vt["Arabic Presentation Forms-A"](yi)||Vt["Arabic Presentation Forms-B"](yi))));if(jn.imageName){const Io=qt[jn.imageName];if(!Io)continue;ds=jn.imageName,vt.iconsInText=vt.iconsInText||!0,hs=Io.paddedRect;const lo=Io.displaySize;jn.scale=jn.scale*ai/Bn,Jo={width:lo[0],height:lo[1],left:oo,top:-K_,advance:Yo?lo[1]:lo[0]},hi=Ii+(ai-lo[1]*jn.scale),ea=Jo.advance;const ta=Yo?lo[0]*jn.scale-ai*ci:lo[1]*jn.scale-ai*ci;ta>0&&ta>so&&(so=ta)}else{const Io=tn[jn.fontStack],lo=Io&&Io[Ci];if(lo&&lo.rect)hs=lo.rect,Jo=lo.metrics;else{const ta=Ht[jn.fontStack],cf=ta&&ta[Ci];if(!cf)continue;Jo=cf.metrics}hi=(ci-jn.scale)*ai}Yo?(vt.verticalizable=!0,Pi.push({glyph:Ci,imageName:ds,x:xr,y:Lr+hi,vertical:Yo,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:zi,metrics:Jo,rect:hs}),xr+=ea*jn.scale+fn):(Pi.push({glyph:Ci,imageName:ds,x:xr,y:Lr+hi,vertical:Yo,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:zi,metrics:Jo,rect:hs}),xr+=Jo.advance*jn.scale+fn)}Pi.length!==0&&(li=Math.max(xr-fn,li),vA(Pi,0,Pi.length-1,Ui,so)),xr=0;const ao=Ft*ci+so;Hi.lineOffset=Math.max(so,Ii),Lr+=ao,_o=Math.max(ao,_o),++ei}var yi;const Si=Lr-rf,{horizontalAlign:Vi,verticalAlign:qi}=om(Xt);(function(ui,ci,Ii,Hi,Pi,so,ao,fi,jn){const zi=(ci-Ii)*Pi;let Ci=0;Ci=so!==ao?-fi*Hi-rf:(-Hi*jn+.5)*ao;for(const hi of ui)for(const Jo of hi.positionedGlyphs)Jo.x+=zi,Jo.y+=Ci})(vt.positionedLines,Ui,Vi,qi,li,_o,Ft,Si,Ut.length),vt.top+=-qi*Si,vt.bottom=vt.top+Si,vt.left+=-Vi*li,vt.right=vt.left+li}(dt,a,f,m,Pe,S,M,R,Y,j,se,we),!function(vt){for(const Ht of vt)if(Ht.positionedGlyphs.length!==0)return!1;return!0}(je)&&dt}const ad={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_A={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Q_(c,a,f,m,b,k){if(a.imageName){const S=m[a.imageName];return S?S.displaySize[0]*a.scale*ai/k+b:0}{const S=f[a.fontStack],M=S&&S[c];return M?M.metrics.advance*a.scale+b:0}}function e0(c,a,f,m){const b=Math.pow(c-a,2);return m?c<a?b/2:2*b:b+Math.abs(f)*f}function yA(c,a,f){let m=0;return c===10&&(m-=1e4),f&&(m+=150),c!==40&&c!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function t0(c,a,f,m,b,k){let S=null,M=e0(a,f,b,k);for(const R of m){const j=e0(a-R.x,f,b,k)+R.badness;j<=M&&(S=R,M=j)}return{index:c,x:a,priorBreak:S,badness:M}}function n0(c){return c?n0(c.priorBreak).concat(c.index):[]}function im(c,a,f,m,b,k,S){if(k!=="point")return[];if(!c)return[];const M=[],R=function(se,pe,_e,we,Ce,Pe){let We=0;for(let De=0;De<se.length();De++){const je=se.getSection(De);We+=Q_(se.getCharCode(De),je,we,Ce,pe,Pe)}return We/Math.max(1,Math.ceil(We/_e))}(c,a,f,m,b,S),j=c.text.indexOf("​")>=0;let X=0;for(let se=0;se<c.length();se++){const pe=c.getSection(se),_e=c.getCharCode(se);if(ad[_e]||(X+=Q_(_e,pe,m,b,a,S)),se<c.length()-1){const we=!((Y=_e)<11904||!(Vt["Bopomofo Extended"](Y)||Vt.Bopomofo(Y)||Vt["CJK Compatibility Forms"](Y)||Vt["CJK Compatibility Ideographs"](Y)||Vt["CJK Compatibility"](Y)||Vt["CJK Radicals Supplement"](Y)||Vt["CJK Strokes"](Y)||Vt["CJK Symbols and Punctuation"](Y)||Vt["CJK Unified Ideographs Extension A"](Y)||Vt["CJK Unified Ideographs"](Y)||Vt["Enclosed CJK Letters and Months"](Y)||Vt["Halfwidth and Fullwidth Forms"](Y)||Vt.Hiragana(Y)||Vt["Ideographic Description Characters"](Y)||Vt["Kangxi Radicals"](Y)||Vt["Katakana Phonetic Extensions"](Y)||Vt.Katakana(Y)||Vt["Vertical Forms"](Y)||Vt["Yi Radicals"](Y)||Vt["Yi Syllables"](Y)));(_A[_e]||we||pe.imageName)&&M.push(t0(se+1,X,R,M,yA(_e,c.getCharCode(se+1),we&&j),!1))}}var Y;return n0(t0(c.length(),X,R,M,0,!0))}function om(c){let a=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:a,verticalAlign:f}}function vA(c,a,f,m,b){if(!m&&!b)return;const k=c[f],S=(c[f].x+k.metrics.advance*k.scale)*m;for(let M=a;M<=f;M++)c[M].x-=S,c[M].y+=b}function bA(c,a,f){const{horizontalAlign:m,verticalAlign:b}=om(f),k=a[0]-c.displaySize[0]*m,S=a[1]-c.displaySize[1]*b;return{image:c,top:S,bottom:S+c.displaySize[1],left:k,right:k+c.displaySize[0]}}function r0(c,a,f,m,b,k){const S=c.image;let M;if(S.content){const Ce=S.content,Pe=S.pixelRatio||1;M=[Ce[0]/Pe,Ce[1]/Pe,S.displaySize[0]-Ce[2]/Pe,S.displaySize[1]-Ce[3]/Pe]}const R=a.left*k,j=a.right*k;let X,Y,se,pe;f==="width"||f==="both"?(pe=b[0]+R-m[3],Y=b[0]+j+m[1]):(pe=b[0]+(R+j-S.displaySize[0])/2,Y=pe+S.displaySize[0]);const _e=a.top*k,we=a.bottom*k;return f==="height"||f==="both"?(X=b[1]+_e-m[0],se=b[1]+we+m[2]):(X=b[1]+(_e+we-S.displaySize[1])/2,se=X+S.displaySize[1]),{image:S,top:X,right:Y,bottom:se,left:pe,collisionPadding:M}}const sf=255,Ds=128,Ea=sf*Ds;function i0(c,a){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Mr(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=f;let k=0;for(;k<m.length&&m[k]<=c;)k++;k=Math.max(0,k-1);let S=k;for(;S<m.length&&m[S]<c+1;)S++;S=Math.min(m.length-1,S);const M=m[k],R=m[S];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:R,minSize:f.evaluate(new Mr(M)),maxSize:f.evaluate(new Mr(R)),interpolationType:b}}}function sm(c,a,f){let m="never";const b=c.get(a);return b?m=b:c.get(f)&&(m="always"),m}const wA=Ta.VectorTileFeature.types,xA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ld(c,a,f,m,b,k,S,M,R,j,X,Y,se){const pe=M?Math.min(Ea,Math.round(M[0])):0,_e=M?Math.min(Ea,Math.round(M[1])):0;c.emplaceBack(a,f,Math.round(32*m),Math.round(32*b),k,S,(pe<<1)+(R?1:0),_e,16*j,16*X,256*Y,256*se)}function am(c,a,f){c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f)}function AA(c){for(const a of c.sections)if(Op(a.text))return!0;return!1}class lm{constructor(a){this.layoutVertexArray=new et,this.indexArray=new ft,this.programConfigurations=a,this.segments=new Ot,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,f,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,eA.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,tA.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,xA,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",lm);class um{constructor(a,f,m){this.layoutVertexArray=new a,this.layoutAttributes=f,this.indexArray=new m,this.segments=new Ot,this.collisionVertexArray=new st}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,nA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",um);class Du{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(S=>S.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Np([]),this.placementViewportMatrix=Np([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=i0(this.zoom,f["text-size"]),this.iconSizeData=i0(this.zoom,f["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),k=m.get("symbol-z-order");this.canOverlap=sm(m,"text-overlap","text-allow-overlap")!=="never"||sm(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=k!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(k==="viewport-y"||k==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(S=>u.ah[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=a.sourceID}createArrays(){this.text=new lm(new Br(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new lm(new Br(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new A,this.lineVertexArray=new z,this.symbolInstances=new v,this.textAnchorOffsets=new $}calculateGlyphDependencies(a,f,m,b,k){for(let S=0;S<a.length;S++)if(f[a.charCodeAt(S)]=!0,(m||b)&&k){const M=nf[a.charAt(S)];M&&(f[M.charCodeAt(0)]=!0)}}populate(a,f,m){const b=this.layers[0],k=b.layout,S=k.get("text-font"),M=k.get("text-field"),R=k.get("icon-image"),j=(M.value.kind!=="constant"||M.value.value instanceof eo&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),X=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,Y=k.get("symbol-sort-key");if(this.features=[],!j&&!X)return;const se=f.iconDependencies,pe=f.glyphDependencies,_e=f.availableImages,we=new Mr(this.zoom);for(const{feature:Ce,id:Pe,index:We,sourceLayerIndex:De}of a){const je=b._featureFilter.needGeometry,dt=Ys(Ce,je);if(!b._featureFilter.filter(we,dt,m))continue;let vt,Ht;if(je||(dt.geometry=Js(Ce)),j){const qt=b.getValueAndResolveTokens("text-field",dt,m,_e),Ut=eo.factory(qt),Ft=this.hasRTLText=this.hasRTLText||AA(Ut);(!Ft||Ls.getRTLTextPluginStatus()==="unavailable"||Ft&&Ls.isParsed())&&(vt=iA(Ut,b,dt))}if(X){const qt=b.getValueAndResolveTokens("icon-image",dt,m,_e);Ht=qt instanceof po?qt:po.fromString(qt)}if(!vt&&!Ht)continue;const tn=this.sortFeaturesByKey?Y.evaluate(dt,{},m):void 0;if(this.features.push({id:Pe,text:vt,icon:Ht,index:We,sourceLayerIndex:De,geometry:dt.geometry,properties:Ce.properties,type:wA[Ce.type],sortKey:tn}),Ht&&(se[Ht.name]=!0),vt){const qt=S.evaluate(dt,{},m).join(","),Ut=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Ft of vt.sections)if(Ft.image)se[Ft.image.name]=!0;else{const Xt=Sa(vt.toString()),Nt=Ft.fontStack||qt,It=pe[Nt]=pe[Nt]||{};this.calculateGlyphDependencies(Ft.text,It,Ut,this.allowVerticalPlacement,Xt)}}}k.get("symbol-placement")==="line"&&(this.features=function(Ce){const Pe={},We={},De=[];let je=0;function dt(qt){De.push(Ce[qt]),je++}function vt(qt,Ut,Ft){const Xt=We[qt];return delete We[qt],We[Ut]=Xt,De[Xt].geometry[0].pop(),De[Xt].geometry[0]=De[Xt].geometry[0].concat(Ft[0]),Xt}function Ht(qt,Ut,Ft){const Xt=Pe[Ut];return delete Pe[Ut],Pe[qt]=Xt,De[Xt].geometry[0].shift(),De[Xt].geometry[0]=Ft[0].concat(De[Xt].geometry[0]),Xt}function tn(qt,Ut,Ft){const Xt=Ft?Ut[0][Ut[0].length-1]:Ut[0][0];return`${qt}:${Xt.x}:${Xt.y}`}for(let qt=0;qt<Ce.length;qt++){const Ut=Ce[qt],Ft=Ut.geometry,Xt=Ut.text?Ut.text.toString():null;if(!Xt){dt(qt);continue}const Nt=tn(Xt,Ft),It=tn(Xt,Ft,!0);if(Nt in We&&It in Pe&&We[Nt]!==Pe[It]){const fn=Ht(Nt,It,Ft),on=vt(Nt,It,De[fn].geometry);delete Pe[Nt],delete We[It],We[tn(Xt,De[on].geometry,!0)]=on,De[fn].geometry=null}else Nt in We?vt(Nt,It,Ft):It in Pe?Ht(Nt,It,Ft):(dt(qt),Pe[Nt]=je-1,We[It]=je-1)}return De.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Pe)=>Ce.sortKey-Pe.sortKey)}update(a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,f,this.layers,m),this.icon.programConfigurations.updatePaintArrays(a,f,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,f){const m=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(f[a.segment+1]),k=a.dist(f[a.segment]);const S={};for(let M=a.segment+1;M<f.length;M++)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:b},M<f.length-1&&(b+=f[M+1].dist(f[M]));for(let M=a.segment||0;M>=0;M--)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:k},M>0&&(k+=f[M-1].dist(f[M]));for(let M=0;M<f.length;M++){const R=S[M];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,f,m,b,k,S,M,R,j,X,Y,se){const pe=a.indexArray,_e=a.layoutVertexArray,we=a.segments.prepareSegment(4*f.length,_e,pe,this.canOverlap?S.sortKey:void 0),Ce=this.glyphOffsetArray.length,Pe=we.vertexLength,We=this.allowVerticalPlacement&&M===u.ah.vertical?Math.PI/2:0,De=S.text&&S.text.sections;for(let je=0;je<f.length;je++){const{tl:dt,tr:vt,bl:Ht,br:tn,tex:qt,pixelOffsetTL:Ut,pixelOffsetBR:Ft,minFontScaleX:Xt,minFontScaleY:Nt,glyphOffset:It,isSDF:fn,sectionIndex:on}=f[je],Bn=we.vertexLength,xr=It[1];ld(_e,R.x,R.y,dt.x,xr+dt.y,qt.x,qt.y,m,fn,Ut.x,Ut.y,Xt,Nt),ld(_e,R.x,R.y,vt.x,xr+vt.y,qt.x+qt.w,qt.y,m,fn,Ft.x,Ut.y,Xt,Nt),ld(_e,R.x,R.y,Ht.x,xr+Ht.y,qt.x,qt.y+qt.h,m,fn,Ut.x,Ft.y,Xt,Nt),ld(_e,R.x,R.y,tn.x,xr+tn.y,qt.x+qt.w,qt.y+qt.h,m,fn,Ft.x,Ft.y,Xt,Nt),am(a.dynamicLayoutVertexArray,R,We),pe.emplaceBack(Bn,Bn+1,Bn+2),pe.emplaceBack(Bn+1,Bn+2,Bn+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(It[0]),je!==f.length-1&&on===f[je+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,S,S.index,{},se,De&&De[on])}a.placedSymbolArray.emplaceBack(R.x,R.y,Ce,this.glyphOffsetArray.length-Ce,Pe,j,X,R.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],M,0,!1,0,Y)}_addCollisionDebugVertex(a,f,m,b,k,S){return f.emplaceBack(0,0),a.emplaceBack(m.x,m.y,b,k,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(a,f,m,b,k,S,M){const R=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),j=R.vertexLength,X=k.layoutVertexArray,Y=k.collisionVertexArray,se=M.anchorX,pe=M.anchorY;this._addCollisionDebugVertex(X,Y,S,se,pe,new _(a,f)),this._addCollisionDebugVertex(X,Y,S,se,pe,new _(m,f)),this._addCollisionDebugVertex(X,Y,S,se,pe,new _(m,b)),this._addCollisionDebugVertex(X,Y,S,se,pe,new _(a,b)),R.vertexLength+=4;const _e=k.indexArray;_e.emplaceBack(j,j+1),_e.emplaceBack(j+1,j+2),_e.emplaceBack(j+2,j+3),_e.emplaceBack(j+3,j),R.primitiveLength+=4}addDebugCollisionBoxes(a,f,m,b){for(let k=a;k<f;k++){const S=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,b?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new um(rt,U_.members,Ct),this.iconCollisionBox=new um(rt,U_.members,Ct);for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(a,f,m,b,k,S,M,R,j){const X={};for(let Y=f;Y<m;Y++){const se=a.get(Y);X.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.textFeatureIndex=se.featureIndex;break}for(let Y=b;Y<k;Y++){const se=a.get(Y);X.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.verticalTextFeatureIndex=se.featureIndex;break}for(let Y=S;Y<M;Y++){const se=a.get(Y);X.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.iconFeatureIndex=se.featureIndex;break}for(let Y=R;Y<j;Y++){const se=a.get(Y);X.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.verticalIconFeatureIndex=se.featureIndex;break}return X}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,f){const m=a.placedSymbolArray.get(f),b=m.vertexStartIndex+4*m.numGlyphs;for(let k=m.vertexStartIndex;k<b;k+=4)a.indexArray.emplaceBack(k,k+1,k+2),a.indexArray.emplaceBack(k+1,k+2,k+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(a),m=Math.cos(a),b=[],k=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const R=this.symbolInstances.get(M);b.push(0|Math.round(f*R.anchorX+m*R.anchorY)),k.push(R.featureIndex)}return S.sort((M,R)=>b[M]-b[R]||k[R]-k[M]),S}addToSortKeyRanges(a,f){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===f?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const m=this.symbolInstances.get(f);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,k,S)=>{b>=0&&S.indexOf(b)===k&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let o0,s0;Zt("SymbolBucket",Du,{omit:["layers","collisionBoxArray","features","compareText"]}),Du.MAX_GLYPHS=65535,Du.addDynamicAttributes=am;var cm={get paint(){return s0=s0||new Ni({"icon-opacity":new hn(he.paint_symbol["icon-opacity"]),"icon-color":new hn(he.paint_symbol["icon-color"]),"icon-halo-color":new hn(he.paint_symbol["icon-halo-color"]),"icon-halo-width":new hn(he.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hn(he.paint_symbol["icon-halo-blur"]),"icon-translate":new sn(he.paint_symbol["icon-translate"]),"icon-translate-anchor":new sn(he.paint_symbol["icon-translate-anchor"]),"text-opacity":new hn(he.paint_symbol["text-opacity"]),"text-color":new hn(he.paint_symbol["text-color"],{runtimeType:Rt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new hn(he.paint_symbol["text-halo-color"]),"text-halo-width":new hn(he.paint_symbol["text-halo-width"]),"text-halo-blur":new hn(he.paint_symbol["text-halo-blur"]),"text-translate":new sn(he.paint_symbol["text-translate"]),"text-translate-anchor":new sn(he.paint_symbol["text-translate-anchor"])})},get layout(){return o0=o0||new Ni({"symbol-placement":new sn(he.layout_symbol["symbol-placement"]),"symbol-spacing":new sn(he.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sn(he.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hn(he.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sn(he.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sn(he.layout_symbol["icon-allow-overlap"]),"icon-overlap":new sn(he.layout_symbol["icon-overlap"]),"icon-ignore-placement":new sn(he.layout_symbol["icon-ignore-placement"]),"icon-optional":new sn(he.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sn(he.layout_symbol["icon-rotation-alignment"]),"icon-size":new hn(he.layout_symbol["icon-size"]),"icon-text-fit":new sn(he.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(he.layout_symbol["icon-text-fit-padding"]),"icon-image":new hn(he.layout_symbol["icon-image"]),"icon-rotate":new hn(he.layout_symbol["icon-rotate"]),"icon-padding":new hn(he.layout_symbol["icon-padding"]),"icon-keep-upright":new sn(he.layout_symbol["icon-keep-upright"]),"icon-offset":new hn(he.layout_symbol["icon-offset"]),"icon-anchor":new hn(he.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sn(he.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sn(he.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sn(he.layout_symbol["text-rotation-alignment"]),"text-field":new hn(he.layout_symbol["text-field"]),"text-font":new hn(he.layout_symbol["text-font"]),"text-size":new hn(he.layout_symbol["text-size"]),"text-max-width":new hn(he.layout_symbol["text-max-width"]),"text-line-height":new sn(he.layout_symbol["text-line-height"]),"text-letter-spacing":new hn(he.layout_symbol["text-letter-spacing"]),"text-justify":new hn(he.layout_symbol["text-justify"]),"text-radial-offset":new hn(he.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sn(he.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new hn(he.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new hn(he.layout_symbol["text-anchor"]),"text-max-angle":new sn(he.layout_symbol["text-max-angle"]),"text-writing-mode":new sn(he.layout_symbol["text-writing-mode"]),"text-rotate":new hn(he.layout_symbol["text-rotate"]),"text-padding":new sn(he.layout_symbol["text-padding"]),"text-keep-upright":new sn(he.layout_symbol["text-keep-upright"]),"text-transform":new hn(he.layout_symbol["text-transform"]),"text-offset":new hn(he.layout_symbol["text-offset"]),"text-allow-overlap":new sn(he.layout_symbol["text-allow-overlap"]),"text-overlap":new sn(he.layout_symbol["text-overlap"]),"text-ignore-placement":new sn(he.layout_symbol["text-ignore-placement"]),"text-optional":new sn(he.layout_symbol["text-optional"])})}};class a0{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:$n,this.defaultValue=a}evaluate(a){if(a.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(a.formattedSection))return f.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",a0,{omit:["defaultValue"]});class ud extends Mo{constructor(a){super(a,cm)}recalculate(a,f){if(super.recalculate(a,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const k of m)b.indexOf(k)<0&&b.push(k);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,f,m,b){const k=this.layout.get(a).evaluate(f,{},m,b),S=this._unevaluatedLayout._values[a];return S.isDataDriven()||pr(S.value)||!k?k:function(M,R){return R.replace(/{([^{}]+)}/g,(j,X)=>M&&X in M?String(M[X]):"")}(f.properties,k)}createBucket(a){return new Du(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of cm.paint.overridableProperties){if(!ud.hasPaintOverride(this.layout,a))continue;const f=this.paint.get(a),m=new a0(f),b=new wr(m,f.property.specification);let k=null;k=f.value.kind==="constant"||f.value.kind==="source"?new ru("source",b):new xc("composite",b,f.value.zoomStops),this.paint._values[a]=new To(f.property,k,f.parameters)}}_handleOverridablePaintPropertyUpdate(a,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&ud.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,f){const m=a.get("text-field"),b=cm.paint.properties[f];let k=!1;const S=M=>{for(const R of M)if(b.overrides&&b.overrides.hasOverride(R))return void(k=!0)};if(m.value.kind==="constant"&&m.value.value instanceof eo)S(m.value.value.sections);else if(m.value.kind==="source"){const M=j=>{k||(j instanceof Ss&&Kr(j.value)===or?S(j.value.sections):j instanceof tu?S(j.sections):j.eachChild(M))},R=m.value;R._styleExpression&&M(R._styleExpression.expression)}return k}}let l0;var kA={get paint(){return l0=l0||new Ni({"background-color":new sn(he.paint_background["background-color"]),"background-pattern":new _l(he.paint_background["background-pattern"]),"background-opacity":new sn(he.paint_background["background-opacity"])})}};class SA extends Mo{constructor(a){super(a,kA)}}let u0;var CA={get paint(){return u0=u0||new Ni({"raster-opacity":new sn(he.paint_raster["raster-opacity"]),"raster-hue-rotate":new sn(he.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sn(he.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sn(he.paint_raster["raster-brightness-max"]),"raster-saturation":new sn(he.paint_raster["raster-saturation"]),"raster-contrast":new sn(he.paint_raster["raster-contrast"]),"raster-resampling":new sn(he.paint_raster["raster-resampling"]),"raster-fade-duration":new sn(he.paint_raster["raster-fade-duration"])})}};class TA extends Mo{constructor(a){super(a,CA)}}class MA extends Mo{constructor(a){super(a,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class EA{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fm=63710088e-1;class La{constructor(a,f){if(isNaN(a)||isNaN(f))throw new Error(`Invalid LngLat object: (${a}, ${f})`);if(this.lng=+a,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new La(K(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const f=Math.PI/180,m=this.lat*f,b=a.lat*f,k=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((a.lng-this.lng)*f);return fm*Math.acos(Math.min(k,1))}static convert(a){if(a instanceof La)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new La(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new La(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const c0=2*Math.PI*fm;function f0(c){return c0*Math.cos(c*Math.PI/180)}function h0(c){return(180+c)/360}function d0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function p0(c,a){return c/f0(a)}function hm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class cd{constructor(a,f,m=0){this.x=+a,this.y=+f,this.z=+m}static fromLngLat(a,f=0){const m=La.convert(a);return new cd(h0(m.lng),d0(m.lat),p0(f,m.lat))}toLngLat(){return new La(360*this.x-180,hm(this.y))}toAltitude(){return this.z*f0(hm(this.y))}meterInMercatorCoordinateUnits(){return 1/c0*(a=hm(this.y),1/Math.cos(a*Math.PI/180));var a}}function m0(c,a,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[c*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class dm{constructor(a,f,m){if(a<0||a>25||m<0||m>=Math.pow(2,a)||f<0||f>=Math.pow(2,a))throw new Error(`x=${f}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=f,this.y=m,this.key=af(0,a,a,f,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,f,m){const b=(S=this.y,M=this.z,R=m0(256*(k=this.x),256*(S=Math.pow(2,M)-S-1),M),j=m0(256*(k+1),256*(S+1),M),R[0]+","+R[1]+","+j[0]+","+j[1]);var k,S,M,R,j;const X=function(Y,se,pe){let _e,we="";for(let Ce=Y;Ce>0;Ce--)_e=1<<Ce-1,we+=(se&_e?1:0)+(pe&_e?2:0);return we}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,X).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const f=this.z-a.z;return f>0&&a.x===this.x>>f&&a.y===this.y>>f}getTilePoint(a){const f=Math.pow(2,this.z);return new _((a.x*f-this.x)*qr,(a.y*f-this.y)*qr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class g0{constructor(a,f){this.wrap=a,this.canonical=f,this.key=af(a,f.z,f.z,f.x,f.y)}}class Lo{constructor(a,f,m,b,k){if(a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=f,this.canonical=new dm(m,+b,+k),this.key=af(f,a,m,b,k)}clone(){return new Lo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?new Lo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Lo(a,this.wrap,a,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(a,f){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?af(this.wrap*+f,a,this.canonical.z,this.canonical.x,this.canonical.y):af(this.wrap*+f,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const f=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>f&&a.canonical.y===this.canonical.y>>f}children(a){if(this.overscaledZ>=a)return[new Lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new Lo(f,this.wrap,f,m,b),new Lo(f,this.wrap,f,m+1,b),new Lo(f,this.wrap,f,m,b+1),new Lo(f,this.wrap,f,m+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Lo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new g0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new cd(a.x-this.wrap,a.y))}}function af(c,a,f,m,b){(c*=2)<0&&(c=-1*c-1);const k=1<<f;return(k*k*c+k*b+m).toString(36)+f.toString(36)+a.toString(36)}Zt("CanonicalTileID",dm),Zt("OverscaledTileID",Lo,{omit:["posMatrix"]});class _0{constructor(a,f,m,b=1,k=1,S=1,M=0){if(this.uid=a,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void ve(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const R=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=k,this.blueFactor=S,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<R;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(R,j)]=this.data[this._idx(R-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,R)]=this.data[this._idx(j,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<R;j++)for(let X=0;X<R;X++){const Y=this.get(j,X);Y>this.max&&(this.max=Y),Y<this.min&&(this.min=Y)}}get(a,f){const m=new Uint8Array(this.data.buffer),b=4*this._idx(a,f);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,f){if(a<-1||a>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(a+1)}unpack(a,f,m){return a*this.redFactor+f*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Eo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,f,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=f*this.dim,k=f*this.dim+this.dim,S=m*this.dim,M=m*this.dim+this.dim;switch(f){case-1:b=k-1;break;case 1:k=b+1}switch(m){case-1:S=M-1;break;case 1:M=S+1}const R=-f*this.dim,j=-m*this.dim;for(let X=S;X<M;X++)for(let Y=b;Y<k;Y++)this.data[this._idx(Y,X)]=a.data[this._idx(Y+R,X+j)]}}Zt("DEMData",_0);class y0{constructor(a){this._stringToNumber={},this._numberToString=[];for(let f=0;f<a.length;f++){const m=a[f];this._stringToNumber[m]=f,this._numberToString[f]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class v0{constructor(a,f,m,b,k){this.type="Feature",this._vectorTileFeature=a,a._z=f,a._x=m,a._y=b,this.properties=a.properties,this.id=k}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(a[f]=this[f]);return a}}class b0{constructor(a,f){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new pl(qr,16,0),this.grid3D=new pl(qr,16,0),this.featureIndexArray=new Q,this.promoteId=f}insert(a,f,m,b,k,S){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,k);const R=S?this.grid3D:this.grid;for(let j=0;j<f.length;j++){const X=f[j],Y=[1/0,1/0,-1/0,-1/0];for(let se=0;se<X.length;se++){const pe=X[se];Y[0]=Math.min(Y[0],pe.x),Y[1]=Math.min(Y[1],pe.y),Y[2]=Math.max(Y[2],pe.x),Y[3]=Math.max(Y[3],pe.y)}Y[0]<qr&&Y[1]<qr&&Y[2]>=0&&Y[3]>=0&&R.insert(M,Y[0],Y[1],Y[2],Y[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ta.VectorTile(new tm(this.rawTileData)).layers,this.sourceLayerCoder=new y0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,f,m,b){this.loadVTLayers();const k=a.params||{},S=qr/a.tileSize/a.scale,M=au(k.filter),R=a.queryGeometry,j=a.queryPadding*S,X=x0(R),Y=this.grid.query(X.minX-j,X.minY-j,X.maxX+j,X.maxY+j),se=x0(a.cameraQueryGeometry),pe=this.grid3D.query(se.minX-j,se.minY-j,se.maxX+j,se.maxY+j,(Ce,Pe,We,De)=>function(je,dt,vt,Ht,tn){for(const Ut of je)if(dt<=Ut.x&&vt<=Ut.y&&Ht>=Ut.x&&tn>=Ut.y)return!0;const qt=[new _(dt,vt),new _(dt,tn),new _(Ht,tn),new _(Ht,vt)];if(je.length>2){for(const Ut of qt)if(Tu(je,Ut))return!0}for(let Ut=0;Ut<je.length-1;Ut++)if(ax(je[Ut],je[Ut+1],qt))return!0;return!1}(a.cameraQueryGeometry,Ce-j,Pe-j,We+j,De+j));for(const Ce of pe)Y.push(Ce);Y.sort(LA);const _e={};let we;for(let Ce=0;Ce<Y.length;Ce++){const Pe=Y[Ce];if(Pe===we)continue;we=Pe;const We=this.featureIndexArray.get(Pe);let De=null;this.loadMatchingFeature(_e,We.bucketIndex,We.sourceLayerIndex,We.featureIndex,M,k.layers,k.availableImages,f,m,b,(je,dt,vt)=>(De||(De=Js(je)),dt.queryIntersectsFeature(R,je,vt,De,this.z,a.transform,S,a.pixelPosMatrix)))}return _e}loadMatchingFeature(a,f,m,b,k,S,M,R,j,X,Y){const se=this.bucketLayerIDs[f];if(S&&!function(Ce,Pe){for(let We=0;We<Ce.length;We++)if(Pe.indexOf(Ce[We])>=0)return!0;return!1}(S,se))return;const pe=this.sourceLayerCoder.decode(m),_e=this.vtLayers[pe].feature(b);if(k.needGeometry){const Ce=Ys(_e,!0);if(!k.filter(new Mr(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!k.filter(new Mr(this.tileID.overscaledZ),_e))return;const we=this.getId(_e,pe);for(let Ce=0;Ce<se.length;Ce++){const Pe=se[Ce];if(S&&S.indexOf(Pe)<0)continue;const We=R[Pe];if(!We)continue;let De={};we&&X&&(De=X.getState(We.sourceLayer||"_geojsonTileLayer",we));const je=q({},j[Pe]);je.paint=w0(je.paint,We.paint,_e,De,M),je.layout=w0(je.layout,We.layout,_e,De,M);const dt=!Y||Y(_e,We,De);if(!dt)continue;const vt=new v0(_e,this.z,this.x,this.y,we);vt.layer=je;let Ht=a[Pe];Ht===void 0&&(Ht=a[Pe]=[]),Ht.push({featureIndex:b,feature:vt,intersectionZ:dt})}}lookupSymbolFeatures(a,f,m,b,k,S,M,R){const j={};this.loadVTLayers();const X=au(k);for(const Y of a)this.loadMatchingFeature(j,m,b,Y,X,S,M,R,f);return j}hasLayer(a){for(const f of this.bucketLayerIDs)for(const m of f)if(a===m)return!0;return!1}getId(a,f){let m=a.id;return this.promoteId&&(m=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof m=="boolean"&&(m=Number(m))),m}}function w0(c,a,f,m,b){return fe(c,(k,S)=>{const M=a instanceof gl?a.get(S):null;return M&&M.evaluate?M.evaluate(f,m,b):M})}function x0(c){let a=1/0,f=1/0,m=-1/0,b=-1/0;for(const k of c)a=Math.min(a,k.x),f=Math.min(f,k.y),m=Math.max(m,k.x),b=Math.max(b,k.y);return{minX:a,minY:f,maxX:m,maxY:b}}function LA(c,a){return a-c}function A0(c,a,f,m,b){const k=[];for(let S=0;S<c.length;S++){const M=c[S];let R;for(let j=0;j<M.length-1;j++){let X=M[j],Y=M[j+1];X.x<a&&Y.x<a||(X.x<a?X=new _(a,X.y+(a-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x<a&&(Y=new _(a,X.y+(a-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y<f&&Y.y<f||(X.y<f?X=new _(X.x+(f-X.y)/(Y.y-X.y)*(Y.x-X.x),f)._round():Y.y<f&&(Y=new _(X.x+(f-X.y)/(Y.y-X.y)*(Y.x-X.x),f)._round()),X.x>=m&&Y.x>=m||(X.x>=m?X=new _(m,X.y+(m-X.x)/(Y.x-X.x)*(Y.y-X.y))._round():Y.x>=m&&(Y=new _(m,X.y+(m-X.x)/(Y.x-X.x)*(Y.y-X.y))._round()),X.y>=b&&Y.y>=b||(X.y>=b?X=new _(X.x+(b-X.y)/(Y.y-X.y)*(Y.x-X.x),b)._round():Y.y>=b&&(Y=new _(X.x+(b-X.y)/(Y.y-X.y)*(Y.x-X.x),b)._round()),R&&X.equals(R[R.length-1])||(R=[X],k.push(R)),R.push(Y)))))}}return k}Zt("FeatureIndex",b0,{omit:["rawTileData","sourceLayerCoder"]});class Ia extends _{constructor(a,f,m,b){super(a,f),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Ia(this.x,this.y,this.angle,this.segment)}}function k0(c,a,f,m,b){if(a.segment===void 0||f===0)return!0;let k=a,S=a.segment+1,M=0;for(;M>-f/2;){if(S--,S<0)return!1;M-=c[S].dist(k),k=c[S]}M+=c[S].dist(c[S+1]),S++;const R=[];let j=0;for(;M<f/2;){const X=c[S],Y=c[S+1];if(!Y)return!1;let se=c[S-1].angleTo(X)-X.angleTo(Y);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:se}),j+=se;M-R[0].distance>m;)j-=R.shift().angleDelta;if(j>b)return!1;S++,M+=X.dist(Y)}return!0}function S0(c){let a=0;for(let f=0;f<c.length-1;f++)a+=c[f].dist(c[f+1]);return a}function C0(c,a,f){return c?.6*a*f:0}function T0(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function IA(c,a,f,m,b,k){const S=C0(f,b,k),M=T0(f,m)*k;let R=0;const j=S0(c)/2;for(let X=0;X<c.length-1;X++){const Y=c[X],se=c[X+1],pe=Y.dist(se);if(R+pe>j){const _e=(j-R)/pe,we=Ei.number(Y.x,se.x,_e),Ce=Ei.number(Y.y,se.y,_e),Pe=new Ia(we,Ce,se.angleTo(Y),X);return Pe._round(),!S||k0(c,Pe,M,S,a)?Pe:void 0}R+=pe}}function PA(c,a,f,m,b,k,S,M,R){const j=C0(m,k,S),X=T0(m,b),Y=X*S,se=c[0].x===0||c[0].x===R||c[0].y===0||c[0].y===R;return a-Y<a/4&&(a=Y+a/4),M0(c,se?a/2*M%a:(X/2+2*k)*S*M%a,a,j,f,Y,se,!1,R)}function M0(c,a,f,m,b,k,S,M,R){const j=k/2,X=S0(c);let Y=0,se=a-f,pe=[];for(let _e=0;_e<c.length-1;_e++){const we=c[_e],Ce=c[_e+1],Pe=we.dist(Ce),We=Ce.angleTo(we);for(;se+f<Y+Pe;){se+=f;const De=(se-Y)/Pe,je=Ei.number(we.x,Ce.x,De),dt=Ei.number(we.y,Ce.y,De);if(je>=0&&je<R&&dt>=0&&dt<R&&se-j>=0&&se+j<=X){const vt=new Ia(je,dt,We,_e);vt._round(),m&&!k0(c,vt,k,m,b)||pe.push(vt)}}Y+=Pe}return M||pe.length||S||(pe=M0(c,Y/2,f,m,b,k,S,!0,R)),pe}Zt("Anchor",Ia);const Ru=oo;function E0(c,a,f,m){const b=[],k=c.image,S=k.pixelRatio,M=k.paddedRect.w-2*Ru,R=k.paddedRect.h-2*Ru,j=c.right-c.left,X=c.bottom-c.top,Y=k.stretchX||[[0,M]],se=k.stretchY||[[0,R]],pe=(Ft,Xt)=>Ft+Xt[1]-Xt[0],_e=Y.reduce(pe,0),we=se.reduce(pe,0),Ce=M-_e,Pe=R-we;let We=0,De=_e,je=0,dt=we,vt=0,Ht=Ce,tn=0,qt=Pe;if(k.content&&m){const Ft=k.content;We=fd(Y,0,Ft[0]),je=fd(se,0,Ft[1]),De=fd(Y,Ft[0],Ft[2]),dt=fd(se,Ft[1],Ft[3]),vt=Ft[0]-We,tn=Ft[1]-je,Ht=Ft[2]-Ft[0]-De,qt=Ft[3]-Ft[1]-dt}const Ut=(Ft,Xt,Nt,It)=>{const fn=hd(Ft.stretch-We,De,j,c.left),on=dd(Ft.fixed-vt,Ht,Ft.stretch,_e),Bn=hd(Xt.stretch-je,dt,X,c.top),xr=dd(Xt.fixed-tn,qt,Xt.stretch,we),Lr=hd(Nt.stretch-We,De,j,c.left),li=dd(Nt.fixed-vt,Ht,Nt.stretch,_e),_o=hd(It.stretch-je,dt,X,c.top),Ui=dd(It.fixed-tn,qt,It.stretch,we),ei=new _(fn,Bn),yi=new _(Lr,Bn),Si=new _(Lr,_o),Vi=new _(fn,_o),qi=new _(on/S,xr/S),ui=new _(li/S,Ui/S),ci=a*Math.PI/180;if(ci){const Pi=Math.sin(ci),so=Math.cos(ci),ao=[so,-Pi,Pi,so];ei._matMult(ao),yi._matMult(ao),Vi._matMult(ao),Si._matMult(ao)}const Ii=Ft.stretch+Ft.fixed,Hi=Xt.stretch+Xt.fixed;return{tl:ei,tr:yi,bl:Vi,br:Si,tex:{x:k.paddedRect.x+Ru+Ii,y:k.paddedRect.y+Ru+Hi,w:Nt.stretch+Nt.fixed-Ii,h:It.stretch+It.fixed-Hi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:qi,pixelOffsetBR:ui,minFontScaleX:Ht/S/j,minFontScaleY:qt/S/X,isSDF:f}};if(m&&(k.stretchX||k.stretchY)){const Ft=L0(Y,Ce,_e),Xt=L0(se,Pe,we);for(let Nt=0;Nt<Ft.length-1;Nt++){const It=Ft[Nt],fn=Ft[Nt+1];for(let on=0;on<Xt.length-1;on++)b.push(Ut(It,Xt[on],fn,Xt[on+1]))}}else b.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return b}function fd(c,a,f){let m=0;for(const b of c)m+=Math.max(a,Math.min(f,b[1]))-Math.max(a,Math.min(f,b[0]));return m}function L0(c,a,f){const m=[{fixed:-Ru,stretch:0}];for(const[b,k]of c){const S=m[m.length-1];m.push({fixed:b-S.stretch,stretch:S.stretch}),m.push({fixed:b-S.stretch,stretch:S.stretch+(k-b)})}return m.push({fixed:a+Ru,stretch:f}),m}function hd(c,a,f,m){return c/a*f+m}function dd(c,a,f,m){return c-a*f/m}class pd{constructor(a,f,m,b,k,S,M,R,j,X){if(this.boxStartIndex=a.length,j){let Y=S.top,se=S.bottom;const pe=S.collisionPadding;pe&&(Y-=pe[1],se+=pe[3]);let _e=se-Y;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{let Y=S.top*M-R[0],se=S.bottom*M+R[2],pe=S.left*M-R[3],_e=S.right*M+R[1];const we=S.collisionPadding;if(we&&(pe-=we[0]*M,Y-=we[1]*M,_e+=we[2]*M,se+=we[3]*M),X){const Ce=new _(pe,Y),Pe=new _(_e,Y),We=new _(pe,se),De=new _(_e,se),je=X*Math.PI/180;Ce._rotate(je),Pe._rotate(je),We._rotate(je),De._rotate(je),pe=Math.min(Ce.x,Pe.x,We.x,De.x),_e=Math.max(Ce.x,Pe.x,We.x,De.x),Y=Math.min(Ce.y,Pe.y,We.y,De.y),se=Math.max(Ce.y,Pe.y,We.y,De.y)}a.emplaceBack(f.x,f.y,pe,Y,_e,se,m,b,k)}this.boxEndIndex=a.length}}class zA{constructor(a=[],f=DA){if(this.data=a,this.length=this.data.length,this.compare=f,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:f,compare:m}=this,b=f[a];for(;a>0;){const k=a-1>>1,S=f[k];if(m(b,S)>=0)break;f[a]=S,a=k}f[a]=b}_down(a){const{data:f,compare:m}=this,b=this.length>>1,k=f[a];for(;a<b;){let S=1+(a<<1),M=f[S];const R=S+1;if(R<this.length&&m(f[R],M)<0&&(S=R,M=f[R]),m(M,k)>=0)break;f[a]=M,a=S}f[a]=k}}function DA(c,a){return c<a?-1:c>a?1:0}function RA(c,a=1,f=!1){let m=1/0,b=1/0,k=-1/0,S=-1/0;const M=c[0];for(let pe=0;pe<M.length;pe++){const _e=M[pe];(!pe||_e.x<m)&&(m=_e.x),(!pe||_e.y<b)&&(b=_e.y),(!pe||_e.x>k)&&(k=_e.x),(!pe||_e.y>S)&&(S=_e.y)}const R=Math.min(k-m,S-b);let j=R/2;const X=new zA([],BA);if(R===0)return new _(m,b);for(let pe=m;pe<k;pe+=R)for(let _e=b;_e<S;_e+=R)X.push(new Bu(pe+j,_e+j,j,c));let Y=function(pe){let _e=0,we=0,Ce=0;const Pe=pe[0];for(let We=0,De=Pe.length,je=De-1;We<De;je=We++){const dt=Pe[We],vt=Pe[je],Ht=dt.x*vt.y-vt.x*dt.y;we+=(dt.x+vt.x)*Ht,Ce+=(dt.y+vt.y)*Ht,_e+=3*Ht}return new Bu(we/_e,Ce/_e,0,pe)}(c),se=X.length;for(;X.length;){const pe=X.pop();(pe.d>Y.d||!Y.d)&&(Y=pe,f&&console.log("found best %d after %d probes",Math.round(1e4*pe.d)/1e4,se)),pe.max-Y.d<=a||(j=pe.h/2,X.push(new Bu(pe.p.x-j,pe.p.y-j,j,c)),X.push(new Bu(pe.p.x+j,pe.p.y-j,j,c)),X.push(new Bu(pe.p.x-j,pe.p.y+j,j,c)),X.push(new Bu(pe.p.x+j,pe.p.y+j,j,c)),se+=4)}return f&&(console.log(`num probes: ${se}`),console.log(`best distance: ${Y.d}`)),Y.p}function BA(c,a){return a.max-c.max}function Bu(c,a,f,m){this.p=new _(c,a),this.h=f,this.d=function(b,k){let S=!1,M=1/0;for(let R=0;R<k.length;R++){const j=k[R];for(let X=0,Y=j.length,se=Y-1;X<Y;se=X++){const pe=j[X],_e=j[se];pe.y>b.y!=_e.y>b.y&&b.x<(_e.x-pe.x)*(b.y-pe.y)/(_e.y-pe.y)+pe.x&&(S=!S),M=Math.min(M,d_(b,pe,_e))}}return(S?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var ki;u.ap=void 0,(ki=u.ap||(u.ap={}))[ki.center=1]="center",ki[ki.left=2]="left",ki[ki.right=3]="right",ki[ki.top=4]="top",ki[ki.bottom=5]="bottom",ki[ki["top-left"]=6]="top-left",ki[ki["top-right"]=7]="top-right",ki[ki["bottom-left"]=8]="bottom-left",ki[ki["bottom-right"]=9]="bottom-right";const Pa=7,pm=Number.POSITIVE_INFINITY;function I0(c,a){return a[1]!==pm?function(f,m,b){let k=0,S=0;switch(m=Math.abs(m),b=Math.abs(b),f){case"top-right":case"top-left":case"top":S=b-Pa;break;case"bottom-right":case"bottom-left":case"bottom":S=-b+Pa}switch(f){case"top-right":case"bottom-right":case"right":k=-m;break;case"top-left":case"bottom-left":case"left":k=m}return[k,S]}(c,a[0],a[1]):function(f,m){let b=0,k=0;m<0&&(m=0);const S=m/Math.SQRT2;switch(f){case"top-right":case"top-left":k=S-Pa;break;case"bottom-right":case"bottom-left":k=-S+Pa;break;case"bottom":k=-m+Pa;break;case"top":k=m-Pa}switch(f){case"top-right":case"bottom-right":b=-S;break;case"top-left":case"bottom-left":b=S;break;case"left":b=m;break;case"right":b=-m}return[b,k]}(c,a[0])}function P0(c,a,f){var m;const b=c.layout,k=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},f);if(k){const M=k.values,R=[];for(let j=0;j<M.length;j+=2){const X=R[j]=M[j],Y=M[j+1].map(se=>se*ai);X.startsWith("top")?Y[1]-=Pa:X.startsWith("bottom")&&(Y[1]+=Pa),R[j+1]=Y}return new ho(R)}const S=b.get("text-variable-anchor");if(S){let M;M=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},f)*ai,pm]:b.get("text-offset").evaluate(a,{},f).map(j=>j*ai);const R=[];for(const j of S)R.push(j,I0(j,M));return new ho(R)}return null}function mm(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FA(c,a,f,m,b,k,S,M,R,j,X){let Y=k.textMaxSize.evaluate(a,{});Y===void 0&&(Y=S);const se=c.layers[0].layout,pe=se.get("icon-offset").evaluate(a,{},X),_e=D0(f.horizontal),we=S/24,Ce=c.tilePixelRatio*we,Pe=c.tilePixelRatio*Y/24,We=c.tilePixelRatio*M,De=c.tilePixelRatio*se.get("symbol-spacing"),je=se.get("text-padding")*c.tilePixelRatio,dt=function(It,fn,on,Bn=1){const xr=It.get("icon-padding").evaluate(fn,{},on),Lr=xr&&xr.values;return[Lr[0]*Bn,Lr[1]*Bn,Lr[2]*Bn,Lr[3]*Bn]}(se,a,X,c.tilePixelRatio),vt=se.get("text-max-angle")/180*Math.PI,Ht=se.get("text-rotation-alignment")!=="viewport"&&se.get("symbol-placement")!=="point",tn=se.get("icon-rotation-alignment")==="map"&&se.get("symbol-placement")!=="point",qt=se.get("symbol-placement"),Ut=De/2,Ft=se.get("icon-text-fit");let Xt;m&&Ft!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(Xt=r0(m,f.vertical,Ft,se.get("icon-text-fit-padding"),pe,we)),_e&&(m=r0(m,_e,Ft,se.get("icon-text-fit-padding"),pe,we)));const Nt=(It,fn)=>{fn.x<0||fn.x>=qr||fn.y<0||fn.y>=qr||function(on,Bn,xr,Lr,li,_o,Ui,ei,yi,Si,Vi,qi,ui,ci,Ii,Hi,Pi,so,ao,fi,jn,zi,Ci,hi,Jo){const hs=on.addToLineVertexArray(Bn,xr);let ds,ea,Yo,Io,lo=0,ta=0,cf=0,O0=0,Am=-1,km=-1;const na={};let $0=jr("");if(on.allowVerticalPlacement&&Lr.vertical){const Di=ei.layout.get("text-rotate").evaluate(jn,{},hi)+90;Yo=new pd(yi,Bn,Si,Vi,qi,Lr.vertical,ui,ci,Ii,Di),Ui&&(Io=new pd(yi,Bn,Si,Vi,qi,Ui,Pi,so,Ii,Di))}if(li){const Di=ei.layout.get("icon-rotate").evaluate(jn,{}),Po=ei.layout.get("icon-text-fit")!=="none",Sl=E0(li,Di,Ci,Po),ms=Ui?E0(Ui,Di,Ci,Po):void 0;ea=new pd(yi,Bn,Si,Vi,qi,li,Pi,so,!1,Di),lo=4*Sl.length;const Cl=on.iconSizeData;let Rs=null;Cl.kind==="source"?(Rs=[Ds*ei.layout.get("icon-size").evaluate(jn,{})],Rs[0]>Ea&&ve(`${on.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)):Cl.kind==="composite"&&(Rs=[Ds*zi.compositeIconSizes[0].evaluate(jn,{},hi),Ds*zi.compositeIconSizes[1].evaluate(jn,{},hi)],(Rs[0]>Ea||Rs[1]>Ea)&&ve(`${on.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)),on.addSymbols(on.icon,Sl,Rs,fi,ao,jn,u.ah.none,Bn,hs.lineStartIndex,hs.lineLength,-1,hi),Am=on.icon.placedSymbolArray.length-1,ms&&(ta=4*ms.length,on.addSymbols(on.icon,ms,Rs,fi,ao,jn,u.ah.vertical,Bn,hs.lineStartIndex,hs.lineLength,-1,hi),km=on.icon.placedSymbolArray.length-1)}const N0=Object.keys(Lr.horizontal);for(const Di of N0){const Po=Lr.horizontal[Di];if(!ds){$0=jr(Po.text);const ms=ei.layout.get("text-rotate").evaluate(jn,{},hi);ds=new pd(yi,Bn,Si,Vi,qi,Po,ui,ci,Ii,ms)}const Sl=Po.positionedLines.length===1;if(cf+=z0(on,Bn,Po,_o,ei,Ii,jn,Hi,hs,Lr.vertical?u.ah.horizontal:u.ah.horizontalOnly,Sl?N0:[Di],na,Am,zi,hi),Sl)break}Lr.vertical&&(O0+=z0(on,Bn,Lr.vertical,_o,ei,Ii,jn,Hi,hs,u.ah.vertical,["vertical"],na,km,zi,hi));const NA=ds?ds.boxStartIndex:on.collisionBoxArray.length,jA=ds?ds.boxEndIndex:on.collisionBoxArray.length,UA=Yo?Yo.boxStartIndex:on.collisionBoxArray.length,VA=Yo?Yo.boxEndIndex:on.collisionBoxArray.length,qA=ea?ea.boxStartIndex:on.collisionBoxArray.length,HA=ea?ea.boxEndIndex:on.collisionBoxArray.length,GA=Io?Io.boxStartIndex:on.collisionBoxArray.length,WA=Io?Io.boxEndIndex:on.collisionBoxArray.length;let ps=-1;const gd=(Di,Po)=>Di&&Di.circleDiameter?Math.max(Di.circleDiameter,Po):Po;ps=gd(ds,ps),ps=gd(Yo,ps),ps=gd(ea,ps),ps=gd(Io,ps);const j0=ps>-1?1:0;j0&&(ps*=Jo/ai),on.glyphOffsetArray.length>=Du.MAX_GLYPHS&&ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jn.sortKey!==void 0&&on.addToSortKeyRanges(on.symbolInstances.length,jn.sortKey);const ZA=P0(ei,jn,hi),[XA,KA]=function(Di,Po){const Sl=Di.length,ms=Po==null?void 0:Po.values;if((ms==null?void 0:ms.length)>0)for(let Cl=0;Cl<ms.length;Cl+=2){const Rs=ms[Cl+1];Di.emplaceBack(u.ap[ms[Cl]],Rs[0],Rs[1])}return[Sl,Di.length]}(on.textAnchorOffsets,ZA);on.symbolInstances.emplaceBack(Bn.x,Bn.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical||-1,Am,km,$0,NA,jA,UA,VA,qA,HA,GA,WA,Si,cf,O0,lo,ta,j0,0,ui,ps,XA,KA)}(c,fn,It,f,m,b,Xt,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,Ce,[je,je,je,je],Ht,R,We,dt,tn,pe,a,k,j,X,S)};if(qt==="line")for(const It of A0(a.geometry,0,0,qr,qr)){const fn=PA(It,De,vt,f.vertical||_e,m,24,Pe,c.overscaling,qr);for(const on of fn)_e&&OA(c,_e.text,Ut,on)||Nt(It,on)}else if(qt==="line-center"){for(const It of a.geometry)if(It.length>1){const fn=IA(It,vt,f.vertical||_e,m,24,Pe);fn&&Nt(It,fn)}}else if(a.type==="Polygon")for(const It of Wp(a.geometry,0)){const fn=RA(It,16);Nt(It[0],new Ia(fn.x,fn.y,0))}else if(a.type==="LineString")for(const It of a.geometry)Nt(It,new Ia(It[0].x,It[0].y,0));else if(a.type==="Point")for(const It of a.geometry)for(const fn of It)Nt([fn],new Ia(fn.x,fn.y,0))}function z0(c,a,f,m,b,k,S,M,R,j,X,Y,se,pe,_e){const we=function(We,De,je,dt,vt,Ht,tn,qt){const Ut=dt.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Ft=[];for(const Xt of De.positionedLines)for(const Nt of Xt.positionedGlyphs){if(!Nt.rect)continue;const It=Nt.rect||{};let fn=K_+1,on=!0,Bn=1,xr=0;const Lr=(vt||qt)&&Nt.vertical,li=Nt.metrics.advance*Nt.scale/2;if(qt&&De.verticalizable&&(xr=Xt.lineOffset/2-(Nt.imageName?-(ai-Nt.metrics.width*Nt.scale)/2:(Nt.scale-1)*ai)),Nt.imageName){const fi=tn[Nt.imageName];on=fi.sdf,Bn=fi.pixelRatio,fn=oo/Bn}const _o=vt?[Nt.x+li,Nt.y]:[0,0];let Ui=vt?[0,0]:[Nt.x+li+je[0],Nt.y+je[1]-xr],ei=[0,0];Lr&&(ei=Ui,Ui=[0,0]);const yi=Nt.metrics.isDoubleResolution?2:1,Si=(Nt.metrics.left-fn)*Nt.scale-li+Ui[0],Vi=(-Nt.metrics.top-fn)*Nt.scale+Ui[1],qi=Si+It.w/yi*Nt.scale/Bn,ui=Vi+It.h/yi*Nt.scale/Bn,ci=new _(Si,Vi),Ii=new _(qi,Vi),Hi=new _(Si,ui),Pi=new _(qi,ui);if(Lr){const fi=new _(-li,li-rf),jn=-Math.PI/2,zi=ai/2-li,Ci=new _(5-rf-zi,-(Nt.imageName?zi:0)),hi=new _(...ei);ci._rotateAround(jn,fi)._add(Ci)._add(hi),Ii._rotateAround(jn,fi)._add(Ci)._add(hi),Hi._rotateAround(jn,fi)._add(Ci)._add(hi),Pi._rotateAround(jn,fi)._add(Ci)._add(hi)}if(Ut){const fi=Math.sin(Ut),jn=Math.cos(Ut),zi=[jn,-fi,fi,jn];ci._matMult(zi),Ii._matMult(zi),Hi._matMult(zi),Pi._matMult(zi)}const so=new _(0,0),ao=new _(0,0);Ft.push({tl:ci,tr:Ii,bl:Hi,br:Pi,tex:It,writingMode:De.writingMode,glyphOffset:_o,sectionIndex:Nt.sectionIndex,isSDF:on,pixelOffsetTL:so,pixelOffsetBR:ao,minFontScaleX:0,minFontScaleY:0})}return Ft}(0,f,M,b,k,S,m,c.allowVerticalPlacement),Ce=c.textSizeData;let Pe=null;Ce.kind==="source"?(Pe=[Ds*b.layout.get("text-size").evaluate(S,{})],Pe[0]>Ea&&ve(`${c.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Pe=[Ds*pe.compositeTextSizes[0].evaluate(S,{},_e),Ds*pe.compositeTextSizes[1].evaluate(S,{},_e)],(Pe[0]>Ea||Pe[1]>Ea)&&ve(`${c.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)),c.addSymbols(c.text,we,Pe,M,k,S,j,a,R.lineStartIndex,R.lineLength,se,_e);for(const We of X)Y[We]=c.text.placedSymbolArray.length-1;return 4*we.length}function D0(c){for(const a in c)return c[a];return null}function OA(c,a,f,m){const b=c.compareText;if(a in b){const k=b[a];for(let S=k.length-1;S>=0;S--)if(m.dist(k[S])<f)return!0}else b[a]=[];return b[a].push(m),!1}const R0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gm{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,m]=new Uint8Array(a,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const k=R0[15&m];if(!k)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(a,2,1),[M]=new Uint32Array(a,4,1);return new gm(M,S,k,a)}constructor(a,f=64,m=Float64Array,b){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const k=R0.indexOf(this.ArrayType),S=2*a*this.ArrayType.BYTES_PER_ELEMENT,M=a*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-M%8)%8;if(k<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+R,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+R),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+R,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+k]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=a)}add(a,f){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=f,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return _m(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,f,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:k,coords:S,nodeSize:M}=this,R=[0,k.length-1,0],j=[];for(;R.length;){const X=R.pop()||0,Y=R.pop()||0,se=R.pop()||0;if(Y-se<=M){for(let Ce=se;Ce<=Y;Ce++){const Pe=S[2*Ce],We=S[2*Ce+1];Pe>=a&&Pe<=m&&We>=f&&We<=b&&j.push(k[Ce])}continue}const pe=se+Y>>1,_e=S[2*pe],we=S[2*pe+1];_e>=a&&_e<=m&&we>=f&&we<=b&&j.push(k[pe]),(X===0?a<=_e:f<=we)&&(R.push(se),R.push(pe-1),R.push(1-X)),(X===0?m>=_e:b>=we)&&(R.push(pe+1),R.push(Y),R.push(1-X))}return j}within(a,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:k,nodeSize:S}=this,M=[0,b.length-1,0],R=[],j=m*m;for(;M.length;){const X=M.pop()||0,Y=M.pop()||0,se=M.pop()||0;if(Y-se<=S){for(let Ce=se;Ce<=Y;Ce++)F0(k[2*Ce],k[2*Ce+1],a,f)<=j&&R.push(b[Ce]);continue}const pe=se+Y>>1,_e=k[2*pe],we=k[2*pe+1];F0(_e,we,a,f)<=j&&R.push(b[pe]),(X===0?a-m<=_e:f-m<=we)&&(M.push(se),M.push(pe-1),M.push(1-X)),(X===0?a+m>=_e:f+m>=we)&&(M.push(pe+1),M.push(Y),M.push(1-X))}return R}}function _m(c,a,f,m,b,k){if(b-m<=f)return;const S=m+b>>1;B0(c,a,S,m,b,k),_m(c,a,f,m,S-1,1-k),_m(c,a,f,S+1,b,1-k)}function B0(c,a,f,m,b,k){for(;b>m;){if(b-m>600){const j=b-m+1,X=f-m+1,Y=Math.log(j),se=.5*Math.exp(2*Y/3),pe=.5*Math.sqrt(Y*se*(j-se)/j)*(X-j/2<0?-1:1);B0(c,a,f,Math.max(m,Math.floor(f-X*se/j+pe)),Math.min(b,Math.floor(f+(j-X)*se/j+pe)),k)}const S=a[2*f+k];let M=m,R=b;for(lf(c,a,m,f),a[2*b+k]>S&&lf(c,a,m,b);M<R;){for(lf(c,a,M,R),M++,R--;a[2*M+k]<S;)M++;for(;a[2*R+k]>S;)R--}a[2*m+k]===S?lf(c,a,m,R):(R++,lf(c,a,R,b)),R<=f&&(m=R+1),f<=R&&(b=R-1)}}function lf(c,a,f,m){ym(c,f,m),ym(a,2*f,2*m),ym(a,2*f+1,2*m+1)}function ym(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}function F0(c,a,f,m){const b=c-f,k=a-m;return b*b+k*k}var vm;u.bd=void 0,(vm=u.bd||(u.bd={})).create="create",vm.load="load",vm.fullLoad="fullLoad";let md=null,uf=[];const bm=1e3/60,wm="loadTime",xm="fullLoadTime",$A={mark(c){performance.mark(c)},frame(c){const a=c;md!=null&&uf.push(a-md),md=a},clearMetrics(){md=null,uf=[],performance.clearMeasures(wm),performance.clearMeasures(xm);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(wm,u.bd.create,u.bd.load),performance.measure(xm,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(wm)[0].duration,a=performance.getEntriesByName(xm)[0].duration,f=uf.length,m=1/(uf.reduce((k,S)=>k+S,0)/f/1e3),b=uf.filter(k=>k>bm).reduce((k,S)=>k+(S-bm)/bm,0);return{loadTime:c,fullLoadTime:a,fps:m,percentDroppedFrames:b/(f+b)*100,totalFrames:f}}};u.$=Ot,u.A=Mu,u.B=function(c){if(Ne==null){const a=c.navigator?c.navigator.userAgent:null;Ne=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ne},u.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new EA(()=>this.process()),this.subscription=function(f,m,b,k){return f.addEventListener(m,b,!1),{unsubscribe:()=>{f.removeEventListener(m,b,!1)}}}(this.target,"message",f=>this.receive(f)),this.globalScope=Be(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((f,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:f,reject:m},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const M={id:b,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const k=[],S=Object.assign(Object.assign({},c),{id:b,sourceMapId:this.mapId,origin:location.origin,data:Aa(c.data,k)});this.target.postMessage(S,{transfer:k})})}receive(c){const a=c.data,f=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[f];const m=this.abortControllers[f];return delete this.abortControllers[f],void(m&&m.abort())}if(Be(self)||a.mustQueue)return this.tasks[f]=a,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return s(this,void 0,void 0,function*(){if(a.type==="<response>"){const b=this.resolveRejects[c];return delete this.resolveRejects[c],b?void(a.error?b.reject(ka(a.error)):b.resolve(ka(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=ka(a.data),m=new AbortController;this.abortControllers[c]=m;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,f,m);this.completeTask(c,null,b)}catch(b){this.completeTask(c,b)}})}completeTask(c,a,f){const m=[];delete this.abortControllers[c];const b={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?Aa(a):null,data:Aa(f,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=sn,u.E=tt,u.F=function(){var c=new Mu(16);return Mu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=jt,u.H=function(c,a,f){var m,b,k,S,M,R,j,X,Y,se,pe,_e,we=f[0],Ce=f[1],Pe=f[2];return a===c?(c[12]=a[0]*we+a[4]*Ce+a[8]*Pe+a[12],c[13]=a[1]*we+a[5]*Ce+a[9]*Pe+a[13],c[14]=a[2]*we+a[6]*Ce+a[10]*Pe+a[14],c[15]=a[3]*we+a[7]*Ce+a[11]*Pe+a[15]):(b=a[1],k=a[2],S=a[3],M=a[4],R=a[5],j=a[6],X=a[7],Y=a[8],se=a[9],pe=a[10],_e=a[11],c[0]=m=a[0],c[1]=b,c[2]=k,c[3]=S,c[4]=M,c[5]=R,c[6]=j,c[7]=X,c[8]=Y,c[9]=se,c[10]=pe,c[11]=_e,c[12]=m*we+M*Ce+Y*Pe+a[12],c[13]=b*we+R*Ce+se*Pe+a[13],c[14]=k*we+j*Ce+pe*Pe+a[14],c[15]=S*we+X*Ce+_e*Pe+a[15]),c},u.I=rm,u.J=function(c,a,f){var m=f[0],b=f[1],k=f[2];return c[0]=a[0]*m,c[1]=a[1]*m,c[2]=a[2]*m,c[3]=a[3]*m,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*k,c[9]=a[9]*k,c[10]=a[10]*k,c[11]=a[11]*k,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.K=__,u.L=function(c,a){const f={};for(let m=0;m<a.length;m++){const b=a[m];b in c&&(f[b]=c[b])}return f},u.M=La,u.N=h0,u.O=d0,u.P=_,u.Q=Lo,u.R=Eo,u.S=E,u.T=Pc,u.U=L,u.V=Ke,u.W=qr,u.X=Wr,u.Y=cd,u.Z=class extends Rc{},u._=s,u.a=mt,u.a$=function(c,a,f){return c[0]=a[0]*f[0],c[1]=a[1]*f[1],c[2]=a[2]*f[2],c[3]=a[3]*f[3],c},u.a0=dm,u.a1=xt,u.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(f=>{a.onloadstart=()=>{f(a)};for(const m of c){const b=window.document.createElement("source");pn(m)||(a.crossOrigin="Anonymous"),b.src=m,a.appendChild(b)}})},u.a3=function(){return J++},u.a4=w,u.a5=Du,u.a6=au,u.a7=Ys,u.a8=Mr,u.a9=v0,u.aA=ee,u.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let f=[];try{if(!lt(c.version,a.version))return[{command:"setStyle",args:[a]}];lt(c.center,a.center)||f.push({command:"setCenter",args:[a.center]}),lt(c.zoom,a.zoom)||f.push({command:"setZoom",args:[a.zoom]}),lt(c.bearing,a.bearing)||f.push({command:"setBearing",args:[a.bearing]}),lt(c.pitch,a.pitch)||f.push({command:"setPitch",args:[a.pitch]}),lt(c.sprite,a.sprite)||f.push({command:"setSprite",args:[a.sprite]}),lt(c.glyphs,a.glyphs)||f.push({command:"setGlyphs",args:[a.glyphs]}),lt(c.transition,a.transition)||f.push({command:"setTransition",args:[a.transition]}),lt(c.light,a.light)||f.push({command:"setLight",args:[a.light]}),lt(c.terrain,a.terrain)||f.push({command:"setTerrain",args:[a.terrain]}),lt(c.sky,a.sky)||f.push({command:"setSky",args:[a.sky]});const m={},b=[];(function(S,M,R,j){let X;for(X in M=M||{},S=S||{})Object.prototype.hasOwnProperty.call(S,X)&&(Object.prototype.hasOwnProperty.call(M,X)||Gn(X,R,j));for(X in M)Object.prototype.hasOwnProperty.call(M,X)&&(Object.prototype.hasOwnProperty.call(S,X)?lt(S[X],M[X])||(S[X].type==="geojson"&&M[X].type==="geojson"&&Sr(S,M,X)?Gt(R,{command:"setGeoJSONSourceData",args:[X,M[X].data]}):fr(X,M,R,j)):Kn(X,M,R))})(c.sources,a.sources,b,m);const k=[];c.layers&&c.layers.forEach(S=>{"source"in S&&m[S.source]?f.push({command:"removeLayer",args:[S.id]}):k.push(S)}),f=f.concat(b),function(S,M,R){M=M||[];const j=(S=S||[]).map(xi),X=M.map(xi),Y=S.reduce(Un,{}),se=M.reduce(Un,{}),pe=j.slice(),_e=Object.create(null);let we,Ce,Pe,We,De;for(let je=0,dt=0;je<j.length;je++)we=j[je],Object.prototype.hasOwnProperty.call(se,we)?dt++:(Gt(R,{command:"removeLayer",args:[we]}),pe.splice(pe.indexOf(we,dt),1));for(let je=0,dt=0;je<X.length;je++)we=X[X.length-1-je],pe[pe.length-1-je]!==we&&(Object.prototype.hasOwnProperty.call(Y,we)?(Gt(R,{command:"removeLayer",args:[we]}),pe.splice(pe.lastIndexOf(we,pe.length-dt),1)):dt++,We=pe[pe.length-je],Gt(R,{command:"addLayer",args:[se[we],We]}),pe.splice(pe.length-je,0,we),_e[we]=!0);for(let je=0;je<X.length;je++)if(we=X[je],Ce=Y[we],Pe=se[we],!_e[we]&&!lt(Ce,Pe))if(lt(Ce.source,Pe.source)&&lt(Ce["source-layer"],Pe["source-layer"])&&lt(Ce.type,Pe.type)){for(De in Cr(Ce.layout,Pe.layout,R,we,null,"setLayoutProperty"),Cr(Ce.paint,Pe.paint,R,we,null,"setPaintProperty"),lt(Ce.filter,Pe.filter)||Gt(R,{command:"setFilter",args:[we,Pe.filter]}),lt(Ce.minzoom,Pe.minzoom)&&lt(Ce.maxzoom,Pe.maxzoom)||Gt(R,{command:"setLayerZoomRange",args:[we,Pe.minzoom,Pe.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Cr(Ce[De],Pe[De],R,we,De.slice(6),"setPaintProperty"):lt(Ce[De],Pe[De])||Gt(R,{command:"setLayerProperty",args:[we,De,Pe[De]]}));for(De in Pe)Object.prototype.hasOwnProperty.call(Pe,De)&&!Object.prototype.hasOwnProperty.call(Ce,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Cr(Ce[De],Pe[De],R,we,De.slice(6),"setPaintProperty"):lt(Ce[De],Pe[De])||Gt(R,{command:"setLayerProperty",args:[we,De,Pe[De]]}))}else Gt(R,{command:"removeLayer",args:[we]}),We=pe[pe.lastIndexOf(we)+1],Gt(R,{command:"addLayer",args:[Pe,We]})}(k,a.layers,f)}catch(m){console.warn("Unable to compute style diff:",m),f=[{command:"setStyle",args:[a]}]}return f},u.aC=function(c){const a=[],f=c.id;return f===void 0&&a.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),a},u.aD=function c(a,f){if(Array.isArray(a)){if(!Array.isArray(f)||a.length!==f.length)return!1;for(let m=0;m<a.length;m++)if(!c(a[m],f[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&f!==null){if(typeof f!="object"||Object.keys(a).length!==Object.keys(f).length)return!1;for(const m in a)if(!c(a[m],f[m]))return!1;return!0}return a===f},u.aE=fe,u.aF=Ee,u.aG=class extends si{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=io,u.aI=class extends si{constructor(c,a){super(c,a),this.current=Al}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Xo,u.aK=class extends si{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends si{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=Is,u.aN=function(c,a,f,m,b,k,S){var M=1/(a-f),R=1/(m-b),j=1/(k-S);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*R,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*j,c[11]=0,c[12]=(a+f)*M,c[13]=(b+m)*R,c[14]=(S+k)*j,c[15]=1,c},u.aO=sr,u.aP=ux,u.aQ=class extends bu{},u.aR=rA,u.aS=class extends wu{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=x_,u.aV=te,u.aW=class extends jc{},u.aX=ft,u.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},u.aZ=function(c,a){var f=c[0],m=c[1],b=c[2],k=c[3],S=c[4],M=c[5],R=c[6],j=c[7],X=c[8],Y=c[9],se=c[10],pe=c[11],_e=c[12],we=c[13],Ce=c[14],Pe=c[15],We=a[0],De=a[1],je=a[2],dt=a[3],vt=a[4],Ht=a[5],tn=a[6],qt=a[7],Ut=a[8],Ft=a[9],Xt=a[10],Nt=a[11],It=a[12],fn=a[13],on=a[14],Bn=a[15];return Math.abs(f-We)<=ji*Math.max(1,Math.abs(f),Math.abs(We))&&Math.abs(m-De)<=ji*Math.max(1,Math.abs(m),Math.abs(De))&&Math.abs(b-je)<=ji*Math.max(1,Math.abs(b),Math.abs(je))&&Math.abs(k-dt)<=ji*Math.max(1,Math.abs(k),Math.abs(dt))&&Math.abs(S-vt)<=ji*Math.max(1,Math.abs(S),Math.abs(vt))&&Math.abs(M-Ht)<=ji*Math.max(1,Math.abs(M),Math.abs(Ht))&&Math.abs(R-tn)<=ji*Math.max(1,Math.abs(R),Math.abs(tn))&&Math.abs(j-qt)<=ji*Math.max(1,Math.abs(j),Math.abs(qt))&&Math.abs(X-Ut)<=ji*Math.max(1,Math.abs(X),Math.abs(Ut))&&Math.abs(Y-Ft)<=ji*Math.max(1,Math.abs(Y),Math.abs(Ft))&&Math.abs(se-Xt)<=ji*Math.max(1,Math.abs(se),Math.abs(Xt))&&Math.abs(pe-Nt)<=ji*Math.max(1,Math.abs(pe),Math.abs(Nt))&&Math.abs(_e-It)<=ji*Math.max(1,Math.abs(_e),Math.abs(It))&&Math.abs(we-fn)<=ji*Math.max(1,Math.abs(we),Math.abs(fn))&&Math.abs(Ce-on)<=ji*Math.max(1,Math.abs(Ce),Math.abs(on))&&Math.abs(Pe-Bn)<=ji*Math.max(1,Math.abs(Pe),Math.abs(Bn))},u.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,m,b,k)=>{const S=b||k;return a[m]=!S||S.toLowerCase(),""}),a["max-age"]){const f=parseInt(a["max-age"],10);isNaN(f)?delete a["max-age"]:a["max-age"]=f}return a},u.ab=function(c,a){const f=[];for(const m in c)m in a||f.push(m);return f},u.ac=Z,u.ad=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[0],S=a[1],M=a[2],R=a[3],j=a[4],X=a[5],Y=a[6],se=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=k*b+j*m,c[1]=S*b+X*m,c[2]=M*b+Y*m,c[3]=R*b+se*m,c[4]=j*b-k*m,c[5]=X*b-S*m,c[6]=Y*b-M*m,c[7]=se*b-R*m,c},u.ae=function(c){var a=new Mu(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},u.af=Qh,u.ag=function(c,a){let f=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:b,minZoom:k,maxZoom:S}=c,M=b?Z(Ai.interpolationFactor(b,a,k,S),0,1):0;c.kind==="camera"?m=Ei.number(c.minSize,c.maxSize,M):f=M}return{uSizeT:f,uSize:m}},u.ai=function(c,{uSize:a,uSizeT:f},{lowerSize:m,upperSize:b}){return c.kind==="source"?m/Ds:c.kind==="composite"?Ei.number(m/Ds,b/Ds,f):a},u.aj=am,u.ak=function(c,a,f,m){const b=a.y-c.y,k=a.x-c.x,S=m.y-f.y,M=m.x-f.x,R=S*k-M*b;if(R===0)return null;const j=(M*(c.y-f.y)-S*(c.x-f.x))/R;return new _(c.x+j*k,c.y+j*b)},u.al=A0,u.am=Vc,u.an=Np,u.ao=ai,u.aq=sm,u.ar=function(c,a){var f=a[0],m=a[1],b=a[2],k=a[3],S=a[4],M=a[5],R=a[6],j=a[7],X=a[8],Y=a[9],se=a[10],pe=a[11],_e=a[12],we=a[13],Ce=a[14],Pe=a[15],We=f*M-m*S,De=f*R-b*S,je=f*j-k*S,dt=m*R-b*M,vt=m*j-k*M,Ht=b*j-k*R,tn=X*we-Y*_e,qt=X*Ce-se*_e,Ut=X*Pe-pe*_e,Ft=Y*Ce-se*we,Xt=Y*Pe-pe*we,Nt=se*Pe-pe*Ce,It=We*Nt-De*Xt+je*Ft+dt*Ut-vt*qt+Ht*tn;return It?(c[0]=(M*Nt-R*Xt+j*Ft)*(It=1/It),c[1]=(b*Xt-m*Nt-k*Ft)*It,c[2]=(we*Ht-Ce*vt+Pe*dt)*It,c[3]=(se*vt-Y*Ht-pe*dt)*It,c[4]=(R*Ut-S*Nt-j*qt)*It,c[5]=(f*Nt-b*Ut+k*qt)*It,c[6]=(Ce*je-_e*Ht-Pe*De)*It,c[7]=(X*Ht-se*je+pe*De)*It,c[8]=(S*Xt-M*Ut+j*tn)*It,c[9]=(m*Ut-f*Xt-k*tn)*It,c[10]=(_e*vt-we*je+Pe*We)*It,c[11]=(Y*je-X*vt-pe*We)*It,c[12]=(M*qt-S*Ft-R*tn)*It,c[13]=(f*Ft-m*qt+b*tn)*It,c[14]=(we*De-_e*dt-Ce*We)*It,c[15]=(X*dt-Y*De+se*We)*It,c):null},u.as=mm,u.at=om,u.au=gm,u.av=function(){const c={},a=he.$version;for(const f in he.$root){const m=he.$root[f];if(m.required){let b=null;b=f==="version"?a:m.type==="array"?[]:{},b!=null&&(c[f]=b)}}return c},u.aw=$h,u.ax=nn,u.ay=function(c){c=c.slice();const a=Object.create(null);for(let f=0;f<c.length;f++)a[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=Xe(c[f],a[c[f].ref]));return c},u.az=function(c){if(c.type==="custom")return new MA(c);switch(c.type){case"background":return new SA(c);case"circle":return new cx(c);case"fill":return new Lx(c);case"fill-extrusion":return new Hx(c);case"heatmap":return new hx(c);case"hillshade":return new px(c);case"line":return new Qx(c);case"raster":return new TA(c);case"symbol":return new ud(c)}},u.b=Ie,u.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},u.b1=K,u.b2=g0,u.b3=p0,u.b4=function(c,a,f,m,b){var k,S=1/Math.tan(a/2);return c[0]=S/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,b!=null&&b!==1/0?(c[10]=(b+m)*(k=1/(m-b)),c[14]=2*b*m*k):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[4],S=a[5],M=a[6],R=a[7],j=a[8],X=a[9],Y=a[10],se=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=k*b+j*m,c[5]=S*b+X*m,c[6]=M*b+Y*m,c[7]=R*b+se*m,c[8]=j*b-k*m,c[9]=X*b-S*m,c[10]=Y*b-M*m,c[11]=se*b-R*m,c},u.b6=O,u.b7=F,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=Ls,u.ba=class extends cs{},u.bb=fm,u.bc=$A,u.be=un,u.bf=function(c,a){mt.REGISTERED_PROTOCOLS[c]=a},u.bg=function(c){delete mt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,a){const f={};for(let b=0;b<c.length;b++){const k=a&&a[c[b].id]||Rp(c[b]);a&&(a[c[b].id]=k);let S=f[k];S||(S=f[k]=[]),S.push(c[b])}const m=[];for(const b in f)m.push(f[b]);return m},u.bi=Zt,u.bj=y0,u.bk=b0,u.bl=Y_,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=qr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],f=a.layout,m=a._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Mr(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Mr(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Mr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=c.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Mr(j),c.canonical),m["text-size"].possiblyEvaluate(new Mr(X),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=c.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Mr(j),c.canonical),m["icon-size"].possiblyEvaluate(new Mr(X),c.canonical)]}const k=f.get("text-line-height")*ai,S=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",M=f.get("text-keep-upright"),R=f.get("text-size");for(const j of c.bucket.features){const X=f.get("text-font").evaluate(j,{},c.canonical).join(","),Y=R.evaluate(j,{},c.canonical),se=b.layoutTextSize.evaluate(j,{},c.canonical),pe=b.layoutIconSize.evaluate(j,{},c.canonical),_e={horizontal:{},vertical:void 0},we=j.text;let Ce,Pe=[0,0];if(we){const je=we.toString(),dt=f.get("text-letter-spacing").evaluate(j,{},c.canonical)*ai,vt=Nh(je)?dt:0,Ht=f.get("text-anchor").evaluate(j,{},c.canonical),tn=P0(a,j,c.canonical);if(!tn){const Nt=f.get("text-radial-offset").evaluate(j,{},c.canonical);Pe=Nt?I0(Ht,[Nt*ai,pm]):f.get("text-offset").evaluate(j,{},c.canonical).map(It=>It*ai)}let qt=S?"center":f.get("text-justify").evaluate(j,{},c.canonical);const Ut=f.get("symbol-placement"),Ft=Ut==="point"?f.get("text-max-width").evaluate(j,{},c.canonical)*ai:0,Xt=()=>{c.bucket.allowVerticalPlacement&&Sa(je)&&(_e.vertical=sd(we,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,Ht,"left",vt,Pe,u.ah.vertical,!0,Ut,se,Y))};if(!S&&tn){const Nt=new Set;if(qt==="auto")for(let fn=0;fn<tn.values.length;fn+=2)Nt.add(mm(tn.values[fn]));else Nt.add(qt);let It=!1;for(const fn of Nt)if(!_e.horizontal[fn])if(It)_e.horizontal[fn]=_e.horizontal[0];else{const on=sd(we,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,"center",fn,vt,Pe,u.ah.horizontal,!1,Ut,se,Y);on&&(_e.horizontal[fn]=on,It=on.positionedLines.length===1)}Xt()}else{qt==="auto"&&(qt=mm(Ht));const Nt=sd(we,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,Ht,qt,vt,Pe,u.ah.horizontal,!1,Ut,se,Y);Nt&&(_e.horizontal[qt]=Nt),Xt(),Sa(je)&&S&&M&&(_e.vertical=sd(we,c.glyphMap,c.glyphPositions,c.imagePositions,X,Ft,k,Ht,qt,vt,Pe,u.ah.vertical,!1,Ut,se,Y))}}let We=!1;if(j.icon&&j.icon.name){const je=c.imageMap[j.icon.name];je&&(Ce=bA(c.imagePositions[j.icon.name],f.get("icon-offset").evaluate(j,{},c.canonical),f.get("icon-anchor").evaluate(j,{},c.canonical)),We=!!je.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=We:c.bucket.sdfIcons!==We&&ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const De=D0(_e.horizontal)||_e.vertical;c.bucket.iconsInText=!!De&&De.iconsInText,(De||Ce)&&FA(c.bucket,j,_e,Ce,c.imageMap,b,se,pe,Pe,We,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=Qp,u.bo=Kp,u.bp=Yp,u.bq=Ta,u.br=tm,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(L())try{return yield Ke(c,a,f,m,b)}catch{}return function(k,S,M,R,j){const X=k.width,Y=k.height;ut&&pt||(ut=new OffscreenCanvas(X,Y),pt=ut.getContext("2d",{willReadFrequently:!0})),ut.width=X,ut.height=Y,pt.drawImage(k,0,0,X,Y);const se=pt.getImageData(S,M,R,j);return pt.clearRect(0,0,X,Y),se.data}(c,a,f,m,b)})},u.bu=_0,u.bv=d,u.bw=p,u.bx=V_,u.by=Gs,u.bz=function(c){return c.message===_t},u.c=He,u.d=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=q,u.f=c=>new Promise((a,f)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=ot})},m.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(b):ot}),u.g=Pt,u.h=(c,a)=>rn(q(c,{type:"json"}),a),u.i=Be,u.j=At,u.k=Ge,u.l=(c,a)=>rn(q(c,{type:"arrayBuffer"}),a),u.m=rn,u.n=function(c){return new tm(c).readFields(pA,[])},u.o=Xc,u.p=J_,u.q=Ni,u.r=Bp,u.s=pn,u.t=xa,u.u=Vt,u.v=he,u.w=ve,u.x=Zs,u.y=function([c,a,f]){return a+=90,a*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(f),y:c*Math.sin(a)*Math.sin(f),z:c*Math.cos(f)}},u.z=Ei}),i("worker",["./shared"],function(u){class s{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,ce){for(const xe of ne){this._layerConfigs[xe.id]=xe;const Oe=this._layers[xe.id]=u.az(xe);Oe._featureFilter=u.a6(Oe.filter),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of ce)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ge=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const xe of ge){const Oe=xe.map(Qe=>this._layers[Qe.id]),$e=Oe[0];if($e.visibility==="none")continue;const Ue=$e.source||"";let ze=this.familiesBySource[Ue];ze||(ze=this.familiesBySource[Ue]={});const re=$e.sourceLayer||"_geojsonTileLayer";let Je=ze[re];Je||(Je=ze[re]=[]),Je.push(Oe)}}}class d{constructor(ne){const ce={},ge=[];for(const Ue in ne){const ze=ne[Ue],re=ce[Ue]={};for(const Je in ze){const Qe=ze[+Je];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const nt={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};ge.push(nt),re[Je]={rect:nt,metrics:Qe.metrics}}}const{w:xe,h:Oe}=u.p(ge),$e=new u.o({width:xe||1,height:Oe||1});for(const Ue in ne){const ze=ne[Ue];for(const re in ze){const Je=ze[+re];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const Qe=ce[Ue][re].rect;u.o.copy(Je.bitmap,$e,{x:0,y:0},{x:Qe.x+1,y:Qe.y+1},Je.bitmap)}}this.image=$e,this.positions=ce}}u.bi("GlyphAtlas",d);class p{constructor(ne){this.tileID=new u.Q(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[]}parse(ne,ce,ge,xe){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new u.a4;const Oe=new u.bj(Object.keys(ne.layers).sort()),$e=new u.bk(this.tileID,this.promoteId);$e.bucketLayerIDs=[];const Ue={},ze={featureIndex:$e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},re=ce.familiesBySource[this.source];for(const Tn in re){const Or=ne.layers[Tn];if(!Or)continue;Or.version===1&&u.w(`Vector tile source "${this.source}" layer "${Tn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ii=Oe.encode(Tn),Mi=[];for(let Fi=0;Fi<Or.length;Fi++){const mi=Or.feature(Fi),qo=$e.getId(mi,Tn);Mi.push({feature:mi,id:qo,index:Fi,sourceLayerIndex:ii})}for(const Fi of re[Tn]){const mi=Fi[0];mi.source!==this.source&&u.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(g(Fi,this.zoom,ge),(Ue[mi.id]=mi.createBucket({index:$e.bucketLayerIDs.length,layers:Fi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source})).populate(Mi,ze,this.tileID.canonical),$e.bucketLayerIDs.push(Fi.map(qo=>qo.id)))}}const Je=u.aE(ze.glyphDependencies,Tn=>Object.keys(Tn).map(Number));this.inFlightDependencies.forEach(Tn=>Tn==null?void 0:Tn.abort()),this.inFlightDependencies=[];let Qe=Promise.resolve({});if(Object.keys(Je).length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),Qe=xe.sendAsync({type:"GG",data:{stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"}},Tn)}const nt=Object.keys(ze.iconDependencies);let ht=Promise.resolve({});if(nt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),ht=xe.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"icons"}},Tn)}const Dt=Object.keys(ze.patternDependencies);let en=Promise.resolve({});if(Dt.length){const Tn=new AbortController;this.inFlightDependencies.push(Tn),en=xe.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Tn)}const[mn,Cn,Nn]=yield Promise.all([Qe,ht,en]),Tr=new d(mn),Xr=new u.bl(Cn,Nn);for(const Tn in Ue){const Or=Ue[Tn];Or instanceof u.a5?(g(Or.layers,this.zoom,ge),u.bm({bucket:Or,glyphMap:mn,glyphPositions:Tr.positions,imageMap:Cn,imagePositions:Xr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Or.hasPattern&&(Or instanceof u.bn||Or instanceof u.bo||Or instanceof u.bp)&&(g(Or.layers,this.zoom,ge),Or.addFeatures(ze,this.tileID.canonical,Xr.patternPositions))}return this.status="done",{buckets:Object.values(Ue).filter(Tn=>!Tn.isEmpty()),featureIndex:$e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Tr.image,imageAtlas:Xr,glyphMap:this.returnDependencies?mn:null,iconMap:this.returnDependencies?Cn:null,glyphPositions:this.returnDependencies?Tr.positions:null}})}}function g(Se,ne,ce){const ge=new u.a8(ne);for(const xe of Se)xe.recalculate(ge,ce)}class _{constructor(ne,ce,ge){this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const ge=yield u.l(ne.request,ce);try{return{vectorTile:new u.bq.VectorTile(new u.br(ge.data)),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(xe){const Oe=new Uint8Array(ge.data);let $e=`Unable to parse the tile at ${ne.request.url}, `;throw $e+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xe.messge}`,new Error($e)}})}loadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid,ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request),xe=new p(ne);this.loading[ce]=xe;const Oe=new AbortController;xe.abort=Oe;try{const $e=yield this.loadVectorTile(ne,Oe);if(delete this.loading[ce],!$e)return null;const Ue=$e.rawData,ze={};$e.expires&&(ze.expires=$e.expires),$e.cacheControl&&(ze.cacheControl=$e.cacheControl);const re={};if(ge){const Qe=ge.finish();Qe&&(re.resourceTiming=JSON.parse(JSON.stringify(Qe)))}xe.vectorTile=$e.vectorTile;const Je=xe.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ce]=xe,this.fetching[ce]={rawTileData:Ue,cacheControl:ze,resourceTiming:re};try{const Qe=yield Je;return u.e({rawTileData:Ue.slice(0)},Qe,ze,re)}finally{delete this.fetching[ce]}}catch($e){throw delete this.loading[ce],xe.status="done",this.loaded[ce]=xe,$e}})}reloadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[ce];if(ge.showCollisionBoxes=ne.showCollisionBoxes,ge.status==="parsing"){const xe=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor);let Oe;if(this.fetching[ce]){const{rawTileData:$e,cacheControl:Ue,resourceTiming:ze}=this.fetching[ce];delete this.fetching[ce],Oe=u.e({rawTileData:$e.slice(0)},xe,Ue,ze)}else Oe=xe;return Oe}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ne){return u._(this,void 0,void 0,function*(){const ce=this.loading,ge=ne.uid;ce&&ce[ge]&&ce[ge].abort&&(ce[ge].abort.abort(),delete ce[ge])})}removeTile(ne){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]})}}class x{constructor(){this.loaded={}}loadTile(ne){return u._(this,void 0,void 0,function*(){const{uid:ce,encoding:ge,rawImageData:xe,redFactor:Oe,greenFactor:$e,blueFactor:Ue,baseShift:ze}=ne,re=xe.width+2,Je=xe.height+2,Qe=u.b(xe)?new u.R({width:re,height:Je},yield u.bt(xe,-1,-1,re,Je)):xe,nt=new u.bu(ce,Qe,ge,Oe,$e,Ue,ze);return this.loaded=this.loaded||{},this.loaded[ce]=nt,nt})}removeTile(ne){const ce=this.loaded,ge=ne.uid;ce&&ce[ge]&&delete ce[ge]}}function C(Se,ne){if(Se.length!==0){T(Se[0],ne);for(var ce=1;ce<Se.length;ce++)T(Se[ce],!ne)}}function T(Se,ne){for(var ce=0,ge=0,xe=0,Oe=Se.length,$e=Oe-1;xe<Oe;$e=xe++){var Ue=(Se[xe][0]-Se[$e][0])*(Se[$e][1]+Se[xe][1]),ze=ce+Ue;ge+=Math.abs(ce)>=Math.abs(Ue)?ce-ze+Ue:Ue-ze+ce,ce=ze}ce+ge>=0!=!!ne&&Se.reverse()}var P=u.bv(function Se(ne,ce){var ge,xe=ne&&ne.type;if(xe==="FeatureCollection")for(ge=0;ge<ne.features.length;ge++)Se(ne.features[ge],ce);else if(xe==="GeometryCollection")for(ge=0;ge<ne.geometries.length;ge++)Se(ne.geometries[ge],ce);else if(xe==="Feature")Se(ne.geometry,ce);else if(xe==="Polygon")C(ne.coordinates,ce);else if(xe==="MultiPolygon")for(ge=0;ge<ne.coordinates.length;ge++)C(ne.coordinates[ge],ce);return ne});const I=u.bq.VectorTileFeature.prototype.toGeoJSON;var E={exports:{}},L=u.bw,O=u.bq.VectorTileFeature,F=Z;function Z(Se,ne){this.options=ne||{},this.features=Se,this.length=Se.length}function K(Se,ne){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=ne||4096}Z.prototype.feature=function(Se){return new K(this.features[Se],this.options.extent)},K.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Se.length;ne++){for(var ce=Se[ne],ge=[],xe=0;xe<ce.length;xe++)ge.push(new L(ce[xe][0],ce[xe][1]));this.geometry.push(ge)}return this.geometry},K.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,ne=1/0,ce=-1/0,ge=1/0,xe=-1/0,Oe=0;Oe<Se.length;Oe++)for(var $e=Se[Oe],Ue=0;Ue<$e.length;Ue++){var ze=$e[Ue];ne=Math.min(ne,ze.x),ce=Math.max(ce,ze.x),ge=Math.min(ge,ze.y),xe=Math.max(xe,ze.y)}return[ne,ge,ce,xe]},K.prototype.toGeoJSON=O.prototype.toGeoJSON;var q=u.bx,J=F;function fe(Se){var ne=new q;return function(ce,ge){for(var xe in ce.layers)ge.writeMessage(3,Ee,ce.layers[xe])}(Se,ne),ne.finish()}function Ee(Se,ne){var ce;ne.writeVarintField(15,Se.version||1),ne.writeStringField(1,Se.name||""),ne.writeVarintField(5,Se.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Se.length;ce++)ge.feature=Se.feature(ce),ne.writeMessage(2,ee,ge);var xe=ge.keys;for(ce=0;ce<xe.length;ce++)ne.writeStringField(3,xe[ce]);var Oe=ge.values;for(ce=0;ce<Oe.length;ce++)ne.writeMessage(4,Be,Oe[ce])}function ee(Se,ne){var ce=Se.feature;ce.id!==void 0&&ne.writeVarintField(1,ce.id),ne.writeMessage(2,ie,Se),ne.writeVarintField(3,ce.type),ne.writeMessage(4,it,ce)}function ie(Se,ne){var ce=Se.feature,ge=Se.keys,xe=Se.values,Oe=Se.keycache,$e=Se.valuecache;for(var Ue in ce.properties){var ze=ce.properties[Ue],re=Oe[Ue];if(ze!==null){re===void 0&&(ge.push(Ue),Oe[Ue]=re=ge.length-1),ne.writeVarint(re);var Je=typeof ze;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(ze=JSON.stringify(ze));var Qe=Je+":"+ze,nt=$e[Qe];nt===void 0&&(xe.push(ze),$e[Qe]=nt=xe.length-1),ne.writeVarint(nt)}}}function ve(Se,ne){return(ne<<3)+(7&Se)}function ye(Se){return Se<<1^Se>>31}function it(Se,ne){for(var ce=Se.loadGeometry(),ge=Se.type,xe=0,Oe=0,$e=ce.length,Ue=0;Ue<$e;Ue++){var ze=ce[Ue],re=1;ge===1&&(re=ze.length),ne.writeVarint(ve(1,re));for(var Je=ge===3?ze.length-1:ze.length,Qe=0;Qe<Je;Qe++){Qe===1&&ge!==1&&ne.writeVarint(ve(2,Je-1));var nt=ze[Qe].x-xe,ht=ze[Qe].y-Oe;ne.writeVarint(ye(nt)),ne.writeVarint(ye(ht)),xe+=nt,Oe+=ht}ge===3&&ne.writeVarint(ve(7,1))}}function Be(Se,ne){var ce=typeof Se;ce==="string"?ne.writeStringField(1,Se):ce==="boolean"?ne.writeBooleanField(7,Se):ce==="number"&&(Se%1!=0?ne.writeDoubleField(3,Se):Se<0?ne.writeSVarintField(6,Se):ne.writeVarintField(5,Se))}E.exports=fe,E.exports.fromVectorTileJs=fe,E.exports.fromGeojsonVt=function(Se,ne){ne=ne||{};var ce={};for(var ge in Se)ce[ge]=new J(Se[ge].features,ne),ce[ge].name=ge,ce[ge].version=ne.version,ce[ge].extent=ne.extent;return fe({layers:ce})},E.exports.GeoJSONWrapper=J;var Ne=u.bv(E.exports);const Ie={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},ot=Math.fround||(Ke=new Float32Array(1),Se=>(Ke[0]=+Se,Ke[0]));var Ke;const ut=3,pt=5,_t=6;class He{constructor(ne){this.options=Object.assign(Object.create(Ie),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:ge,maxZoom:xe}=this.options;ce&&console.time("total time");const Oe=`prepare ${ne.length} points`;ce&&console.time(Oe),this.points=ne;const $e=[];for(let ze=0;ze<ne.length;ze++){const re=ne[ze];if(!re.geometry)continue;const[Je,Qe]=re.geometry.coordinates,nt=ot(jt(Je)),ht=ot(un(Qe));$e.push(nt,ht,1/0,ze,-1,1),this.options.reduce&&$e.push(0)}let Ue=this.trees[xe+1]=this._createTree($e);ce&&console.timeEnd(Oe);for(let ze=xe;ze>=ge;ze--){const re=+Date.now();Ue=this.trees[ze]=this._createTree(this._cluster(Ue,ze)),ce&&console.log("z%d: %d clusters in %dms",ze,Ue.numItems,+Date.now()-re)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let ge=((ne[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,ne[1]));let Oe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,Oe=180;else if(ge>Oe){const Qe=this.getClusters([ge,xe,180,$e],ce),nt=this.getClusters([-180,xe,Oe,$e],ce);return Qe.concat(nt)}const Ue=this.trees[this._limitZoom(ce)],ze=Ue.range(jt(ge),un($e),jt(Oe),un(xe)),re=Ue.data,Je=[];for(const Qe of ze){const nt=this.stride*Qe;Je.push(re[nt+pt]>1?mt(re,nt,this.clusterProps):this.points[re[nt+ut]])}return Je}getChildren(ne){const ce=this._getOriginId(ne),ge=this._getOriginZoom(ne),xe="No cluster with the specified id.",Oe=this.trees[ge];if(!Oe)throw new Error(xe);const $e=Oe.data;if(ce*this.stride>=$e.length)throw new Error(xe);const Ue=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=Oe.within($e[ce*this.stride],$e[ce*this.stride+1],Ue),re=[];for(const Je of ze){const Qe=Je*this.stride;$e[Qe+4]===ne&&re.push($e[Qe+pt]>1?mt($e,Qe,this.clusterProps):this.points[$e[Qe+ut]])}if(re.length===0)throw new Error(xe);return re}getLeaves(ne,ce,ge){const xe=[];return this._appendLeaves(xe,ne,ce=ce||10,ge=ge||0,0),xe}getTile(ne,ce,ge){const xe=this.trees[this._limitZoom(ne)],Oe=Math.pow(2,ne),{extent:$e,radius:Ue}=this.options,ze=Ue/$e,re=(ge-ze)/Oe,Je=(ge+1+ze)/Oe,Qe={features:[]};return this._addTileFeatures(xe.range((ce-ze)/Oe,re,(ce+1+ze)/Oe,Je),xe.data,ce,ge,Oe,Qe),ce===0&&this._addTileFeatures(xe.range(1-ze/Oe,re,1,Je),xe.data,Oe,ge,Oe,Qe),ce===Oe-1&&this._addTileFeatures(xe.range(0,re,ze/Oe,Je),xe.data,-1,ge,Oe,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const ge=this.getChildren(ne);if(ce++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,ge,xe,Oe){const $e=this.getChildren(ce);for(const Ue of $e){const ze=Ue.properties;if(ze&&ze.cluster?Oe+ze.point_count<=xe?Oe+=ze.point_count:Oe=this._appendLeaves(ne,ze.cluster_id,ge,xe,Oe):Oe<xe?Oe++:ne.push(Ue),ne.length===ge)break}return Oe}_createTree(ne){const ce=new u.au(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)ce.add(ne[ge],ne[ge+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,ge,xe,Oe,$e){for(const Ue of ne){const ze=Ue*this.stride,re=ce[ze+pt]>1;let Je,Qe,nt;if(re)Je=Pt(ce,ze,this.clusterProps),Qe=ce[ze],nt=ce[ze+1];else{const en=this.points[ce[ze+ut]];Je=en.properties;const[mn,Cn]=en.geometry.coordinates;Qe=jt(mn),nt=un(Cn)}const ht={type:1,geometry:[[Math.round(this.options.extent*(Qe*Oe-ge)),Math.round(this.options.extent*(nt*Oe-xe))]],tags:Je};let Dt;Dt=re||this.options.generateId?ce[ze+ut]:this.points[ce[ze+ut]].id,Dt!==void 0&&(ht.id=Dt),$e.features.push(ht)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:ge,extent:xe,reduce:Oe,minPoints:$e}=this.options,Ue=ge/(xe*Math.pow(2,ce)),ze=ne.data,re=[],Je=this.stride;for(let Qe=0;Qe<ze.length;Qe+=Je){if(ze[Qe+2]<=ce)continue;ze[Qe+2]=ce;const nt=ze[Qe],ht=ze[Qe+1],Dt=ne.within(ze[Qe],ze[Qe+1],Ue),en=ze[Qe+pt];let mn=en;for(const Cn of Dt){const Nn=Cn*Je;ze[Nn+2]>ce&&(mn+=ze[Nn+pt])}if(mn>en&&mn>=$e){let Cn,Nn=nt*en,Tr=ht*en,Xr=-1;const Tn=((Qe/Je|0)<<5)+(ce+1)+this.points.length;for(const Or of Dt){const ii=Or*Je;if(ze[ii+2]<=ce)continue;ze[ii+2]=ce;const Mi=ze[ii+pt];Nn+=ze[ii]*Mi,Tr+=ze[ii+1]*Mi,ze[ii+4]=Tn,Oe&&(Cn||(Cn=this._map(ze,Qe,!0),Xr=this.clusterProps.length,this.clusterProps.push(Cn)),Oe(Cn,this._map(ze,ii)))}ze[Qe+4]=Tn,re.push(Nn/mn,Tr/mn,1/0,Tn,-1,mn),Oe&&re.push(Xr)}else{for(let Cn=0;Cn<Je;Cn++)re.push(ze[Qe+Cn]);if(mn>1)for(const Cn of Dt){const Nn=Cn*Je;if(!(ze[Nn+2]<=ce)){ze[Nn+2]=ce;for(let Tr=0;Tr<Je;Tr++)re.push(ze[Nn+Tr])}}}}return re}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,ge){if(ne[ce+pt]>1){const $e=this.clusterProps[ne[ce+_t]];return ge?Object.assign({},$e):$e}const xe=this.points[ne[ce+ut]].properties,Oe=this.options.map(xe);return ge&&Oe===xe?Object.assign({},Oe):Oe}}function mt(Se,ne,ce){return{type:"Feature",id:Se[ne+ut],properties:Pt(Se,ne,ce),geometry:{type:"Point",coordinates:[(ge=Se[ne],360*(ge-.5)),nn(Se[ne+1])]}};var ge}function Pt(Se,ne,ce){const ge=Se[ne+pt],xe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Oe=Se[ne+_t],$e=Oe===-1?{}:Object.assign({},ce[Oe]);return Object.assign($e,{cluster:!0,cluster_id:Se[ne+ut],point_count:ge,point_count_abbreviated:xe})}function jt(Se){return Se/360+.5}function un(Se){const ne=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function nn(Se){const ne=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function rn(Se,ne,ce,ge){for(var xe,Oe=ge,$e=ce-ne>>1,Ue=ce-ne,ze=Se[ne],re=Se[ne+1],Je=Se[ce],Qe=Se[ce+1],nt=ne+3;nt<ce;nt+=3){var ht=pn(Se[nt],Se[nt+1],ze,re,Je,Qe);if(ht>Oe)xe=nt,Oe=ht;else if(ht===Oe){var Dt=Math.abs(nt-$e);Dt<Ue&&(xe=nt,Ue=Dt)}}Oe>ge&&(xe-ne>3&&rn(Se,ne,xe,ge),Se[xe+2]=Oe,ce-xe>3&&rn(Se,xe,ce,ge))}function pn(Se,ne,ce,ge,xe,Oe){var $e=xe-ce,Ue=Oe-ge;if($e!==0||Ue!==0){var ze=((Se-ce)*$e+(ne-ge)*Ue)/($e*$e+Ue*Ue);ze>1?(ce=xe,ge=Oe):ze>0&&(ce+=$e*ze,ge+=Ue*ze)}return($e=Se-ce)*$e+(Ue=ne-ge)*Ue}function yn(Se,ne,ce,ge){var xe={id:Se===void 0?null:Se,type:ne,geometry:ce,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var $e=Oe.geometry,Ue=Oe.type;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")qe(Oe,$e);else if(Ue==="Polygon"||Ue==="MultiLineString")for(var ze=0;ze<$e.length;ze++)qe(Oe,$e[ze]);else if(Ue==="MultiPolygon")for(ze=0;ze<$e.length;ze++)for(var re=0;re<$e[ze].length;re++)qe(Oe,$e[ze][re])}(xe),xe}function qe(Se,ne){for(var ce=0;ce<ne.length;ce+=3)Se.minX=Math.min(Se.minX,ne[ce]),Se.minY=Math.min(Se.minY,ne[ce+1]),Se.maxX=Math.max(Se.maxX,ne[ce]),Se.maxY=Math.max(Se.maxY,ne[ce+1])}function Ge(Se,ne,ce,ge){if(ne.geometry){var xe=ne.geometry.coordinates,Oe=ne.geometry.type,$e=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),Ue=[],ze=ne.id;if(ce.promoteId?ze=ne.properties[ce.promoteId]:ce.generateId&&(ze=ge||0),Oe==="Point")At(xe,Ue);else if(Oe==="MultiPoint")for(var re=0;re<xe.length;re++)At(xe[re],Ue);else if(Oe==="LineString")tt(xe,Ue,$e,!1);else if(Oe==="MultiLineString"){if(ce.lineMetrics){for(re=0;re<xe.length;re++)tt(xe[re],Ue=[],$e,!1),Se.push(yn(ze,"LineString",Ue,ne.properties));return}he(xe,Ue,$e,!1)}else if(Oe==="Polygon")he(xe,Ue,$e,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(re=0;re<ne.geometry.geometries.length;re++)Ge(Se,{id:ze,geometry:ne.geometry.geometries[re],properties:ne.properties},ce,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<xe.length;re++){var Je=[];he(xe[re],Je,$e,!0),Ue.push(Je)}}Se.push(yn(ze,Oe,Ue,ne.properties))}}function At(Se,ne){ne.push(cn(Se[0])),ne.push(Xe(Se[1])),ne.push(0)}function tt(Se,ne,ce,ge){for(var xe,Oe,$e=0,Ue=0;Ue<Se.length;Ue++){var ze=cn(Se[Ue][0]),re=Xe(Se[Ue][1]);ne.push(ze),ne.push(re),ne.push(0),Ue>0&&($e+=ge?(xe*re-ze*Oe)/2:Math.sqrt(Math.pow(ze-xe,2)+Math.pow(re-Oe,2))),xe=ze,Oe=re}var Je=ne.length-3;ne[2]=1,rn(ne,0,Je,ce),ne[Je+2]=1,ne.size=Math.abs($e),ne.start=0,ne.end=ne.size}function he(Se,ne,ce,ge){for(var xe=0;xe<Se.length;xe++){var Oe=[];tt(Se[xe],Oe,ce,ge),ne.push(Oe)}}function cn(Se){return Se/360+.5}function Xe(Se){var ne=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function lt(Se,ne,ce,ge,xe,Oe,$e,Ue){if(ge/=ne,Oe>=(ce/=ne)&&$e<ge)return Se;if($e<ce||Oe>=ge)return null;for(var ze=[],re=0;re<Se.length;re++){var Je=Se[re],Qe=Je.geometry,nt=Je.type,ht=xe===0?Je.minX:Je.minY,Dt=xe===0?Je.maxX:Je.maxY;if(ht>=ce&&Dt<ge)ze.push(Je);else if(!(Dt<ce||ht>=ge)){var en=[];if(nt==="Point"||nt==="MultiPoint")Gt(Qe,en,ce,ge,xe);else if(nt==="LineString")Kn(Qe,en,ce,ge,xe,!1,Ue.lineMetrics);else if(nt==="MultiLineString")fr(Qe,en,ce,ge,xe,!1);else if(nt==="Polygon")fr(Qe,en,ce,ge,xe,!0);else if(nt==="MultiPolygon")for(var mn=0;mn<Qe.length;mn++){var Cn=[];fr(Qe[mn],Cn,ce,ge,xe,!0),Cn.length&&en.push(Cn)}if(en.length){if(Ue.lineMetrics&&nt==="LineString"){for(mn=0;mn<en.length;mn++)ze.push(yn(Je.id,nt,en[mn],Je.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(en.length===1?(nt="LineString",en=en[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=en.length===3?"Point":"MultiPoint"),ze.push(yn(Je.id,nt,en,Je.tags))}}}return ze.length?ze:null}function Gt(Se,ne,ce,ge,xe){for(var Oe=0;Oe<Se.length;Oe+=3){var $e=Se[Oe+xe];$e>=ce&&$e<=ge&&(ne.push(Se[Oe]),ne.push(Se[Oe+1]),ne.push(Se[Oe+2]))}}function Kn(Se,ne,ce,ge,xe,Oe,$e){for(var Ue,ze,re=Gn(Se),Je=xe===0?Cr:xi,Qe=Se.start,nt=0;nt<Se.length-3;nt+=3){var ht=Se[nt],Dt=Se[nt+1],en=Se[nt+2],mn=Se[nt+3],Cn=Se[nt+4],Nn=xe===0?ht:Dt,Tr=xe===0?mn:Cn,Xr=!1;$e&&(Ue=Math.sqrt(Math.pow(ht-mn,2)+Math.pow(Dt-Cn,2))),Nn<ce?Tr>ce&&(ze=Je(re,ht,Dt,mn,Cn,ce),$e&&(re.start=Qe+Ue*ze)):Nn>ge?Tr<ge&&(ze=Je(re,ht,Dt,mn,Cn,ge),$e&&(re.start=Qe+Ue*ze)):Sr(re,ht,Dt,en),Tr<ce&&Nn>=ce&&(ze=Je(re,ht,Dt,mn,Cn,ce),Xr=!0),Tr>ge&&Nn<=ge&&(ze=Je(re,ht,Dt,mn,Cn,ge),Xr=!0),!Oe&&Xr&&($e&&(re.end=Qe+Ue*ze),ne.push(re),re=Gn(Se)),$e&&(Qe+=Ue)}var Tn=Se.length-3;ht=Se[Tn],Dt=Se[Tn+1],en=Se[Tn+2],(Nn=xe===0?ht:Dt)>=ce&&Nn<=ge&&Sr(re,ht,Dt,en),Tn=re.length-3,Oe&&Tn>=3&&(re[Tn]!==re[0]||re[Tn+1]!==re[1])&&Sr(re,re[0],re[1],re[2]),re.length&&ne.push(re)}function Gn(Se){var ne=[];return ne.size=Se.size,ne.start=Se.start,ne.end=Se.end,ne}function fr(Se,ne,ce,ge,xe,Oe){for(var $e=0;$e<Se.length;$e++)Kn(Se[$e],ne,ce,ge,xe,Oe,!1)}function Sr(Se,ne,ce,ge){Se.push(ne),Se.push(ce),Se.push(ge)}function Cr(Se,ne,ce,ge,xe,Oe){var $e=(Oe-ne)/(ge-ne);return Se.push(Oe),Se.push(ce+(xe-ce)*$e),Se.push(1),$e}function xi(Se,ne,ce,ge,xe,Oe){var $e=(Oe-ce)/(xe-ce);return Se.push(ne+(ge-ne)*$e),Se.push(Oe),Se.push(1),$e}function Un(Se,ne){for(var ce=[],ge=0;ge<Se.length;ge++){var xe,Oe=Se[ge],$e=Oe.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")xe=xt(Oe.geometry,ne);else if($e==="MultiLineString"||$e==="Polygon"){xe=[];for(var Ue=0;Ue<Oe.geometry.length;Ue++)xe.push(xt(Oe.geometry[Ue],ne))}else if($e==="MultiPolygon")for(xe=[],Ue=0;Ue<Oe.geometry.length;Ue++){for(var ze=[],re=0;re<Oe.geometry[Ue].length;re++)ze.push(xt(Oe.geometry[Ue][re],ne));xe.push(ze)}ce.push(yn(Oe.id,$e,xe,Oe.tags))}return ce}function xt(Se,ne){var ce=[];ce.size=Se.size,Se.start!==void 0&&(ce.start=Se.start,ce.end=Se.end);for(var ge=0;ge<Se.length;ge+=3)ce.push(Se[ge]+ne,Se[ge+1],Se[ge+2]);return ce}function Pr(Se,ne){if(Se.transformed)return Se;var ce,ge,xe,Oe=1<<Se.z,$e=Se.x,Ue=Se.y;for(ce=0;ce<Se.features.length;ce++){var ze=Se.features[ce],re=ze.geometry,Je=ze.type;if(ze.geometry=[],Je===1)for(ge=0;ge<re.length;ge+=2)ze.geometry.push(br(re[ge],re[ge+1],ne,Oe,$e,Ue));else for(ge=0;ge<re.length;ge++){var Qe=[];for(xe=0;xe<re[ge].length;xe+=2)Qe.push(br(re[ge][xe],re[ge][xe+1],ne,Oe,$e,Ue));ze.geometry.push(Qe)}}return Se.transformed=!0,Se}function br(Se,ne,ce,ge,xe,Oe){return[Math.round(ce*(Se*ge-xe)),Math.round(ce*(ne*ge-Oe))]}function Bi(Se,ne,ce,ge,xe){for(var Oe=ne===xe.maxZoom?0:xe.tolerance/((1<<ne)*xe.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ue=0;Ue<Se.length;Ue++){$e.numFeatures++,$n($e,Se[Ue],Oe,xe);var ze=Se[Ue].minX,re=Se[Ue].minY,Je=Se[Ue].maxX,Qe=Se[Ue].maxY;ze<$e.minX&&($e.minX=ze),re<$e.minY&&($e.minY=re),Je>$e.maxX&&($e.maxX=Je),Qe>$e.maxY&&($e.maxY=Qe)}return $e}function $n(Se,ne,ce,ge){var xe=ne.geometry,Oe=ne.type,$e=[];if(Oe==="Point"||Oe==="MultiPoint")for(var Ue=0;Ue<xe.length;Ue+=3)$e.push(xe[Ue]),$e.push(xe[Ue+1]),Se.numPoints++,Se.numSimplified++;else if(Oe==="LineString")Fe($e,xe,Se,ce,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(Ue=0;Ue<xe.length;Ue++)Fe($e,xe[Ue],Se,ce,Oe==="Polygon",Ue===0);else if(Oe==="MultiPolygon")for(var ze=0;ze<xe.length;ze++){var re=xe[ze];for(Ue=0;Ue<re.length;Ue++)Fe($e,re[Ue],Se,ce,!0,Ue===0)}if($e.length){var Je=ne.tags||null;if(Oe==="LineString"&&ge.lineMetrics){for(var Qe in Je={},ne.tags)Je[Qe]=ne.tags[Qe];Je.mapbox_clip_start=xe.start/xe.size,Je.mapbox_clip_end=xe.end/xe.size}var nt={geometry:$e,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:Je};ne.id!==null&&(nt.id=ne.id),Se.features.push(nt)}}function Fe(Se,ne,ce,ge,xe,Oe){var $e=ge*ge;if(ge>0&&ne.size<(xe?$e:ge))ce.numPoints+=ne.length/3;else{for(var Ue=[],ze=0;ze<ne.length;ze+=3)(ge===0||ne[ze+2]>$e)&&(ce.numSimplified++,Ue.push(ne[ze]),Ue.push(ne[ze+1])),ce.numPoints++;xe&&function(re,Je){for(var Qe=0,nt=0,ht=re.length,Dt=ht-2;nt<ht;Dt=nt,nt+=2)Qe+=(re[nt]-re[Dt])*(re[nt+1]+re[Dt+1]);if(Qe>0===Je)for(nt=0,ht=re.length;nt<ht/2;nt+=2){var en=re[nt],mn=re[nt+1];re[nt]=re[ht-2-nt],re[nt+1]=re[ht-1-nt],re[ht-2-nt]=en,re[ht-1-nt]=mn}}(Ue,Oe),Se.push(Ue)}}function yt(Se,ne){var ce=(ne=this.options=function(xe,Oe){for(var $e in Oe)xe[$e]=Oe[$e];return xe}(Object.create(this.options),ne)).debug;if(ce&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(xe,Oe){var $e=[];if(xe.type==="FeatureCollection")for(var Ue=0;Ue<xe.features.length;Ue++)Ge($e,xe.features[Ue],Oe,Ue);else Ge($e,xe.type==="Feature"?xe:{geometry:xe},Oe);return $e}(Se,ne);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(xe,Oe){var $e=Oe.buffer/Oe.extent,Ue=xe,ze=lt(xe,1,-1-$e,$e,0,-1,2,Oe),re=lt(xe,1,1-$e,2+$e,0,-1,2,Oe);return(ze||re)&&(Ue=lt(xe,1,-$e,1+$e,0,-1,2,Oe)||[],ze&&(Ue=Un(ze,1).concat(Ue)),re&&(Ue=Ue.concat(Un(re,-1)))),Ue}(ge,ne),ge.length&&this.splitTile(ge,0,0,0),ce&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bt(Se,ne,ce){return 32*((1<<Se)*ce+ne)+Se}function Rt(Se,ne){return ne?Se.properties[ne]:Se.id}function Qt(Se,ne){if(Se==null)return!0;if(Se.type==="Feature")return Rt(Se,ne)!=null;if(Se.type==="FeatureCollection"){const ce=new Set;for(const ge of Se.features){const xe=Rt(ge,ne);if(xe==null||ce.has(xe))return!1;ce.add(xe)}return!0}return!1}function Yt(Se,ne){const ce=new Map;if(Se!=null)if(Se.type==="Feature")ce.set(Rt(Se,ne),Se);else for(const ge of Se.features)ce.set(Rt(ge,ne),ge);return ce}yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(Se,ne,ce,ge,xe,Oe,$e){for(var Ue=[Se,ne,ce,ge],ze=this.options,re=ze.debug;Ue.length;){ge=Ue.pop(),ce=Ue.pop(),ne=Ue.pop(),Se=Ue.pop();var Je=1<<ne,Qe=bt(ne,ce,ge),nt=this.tiles[Qe];if(!nt&&(re>1&&console.time("creation"),nt=this.tiles[Qe]=Bi(Se,ne,ce,ge,ze),this.tileCoords.push({z:ne,x:ce,y:ge}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ce,ge,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));var ht="z"+ne;this.stats[ht]=(this.stats[ht]||0)+1,this.total++}if(nt.source=Se,xe){if(ne===ze.maxZoom||ne===xe)continue;var Dt=1<<xe-ne;if(ce!==Math.floor(Oe/Dt)||ge!==Math.floor($e/Dt))continue}else if(ne===ze.indexMaxZoom||nt.numPoints<=ze.indexMaxPoints)continue;if(nt.source=null,Se.length!==0){re>1&&console.time("clipping");var en,mn,Cn,Nn,Tr,Xr,Tn=.5*ze.buffer/ze.extent,Or=.5-Tn,ii=.5+Tn,Mi=1+Tn;en=mn=Cn=Nn=null,Tr=lt(Se,Je,ce-Tn,ce+ii,0,nt.minX,nt.maxX,ze),Xr=lt(Se,Je,ce+Or,ce+Mi,0,nt.minX,nt.maxX,ze),Se=null,Tr&&(en=lt(Tr,Je,ge-Tn,ge+ii,1,nt.minY,nt.maxY,ze),mn=lt(Tr,Je,ge+Or,ge+Mi,1,nt.minY,nt.maxY,ze),Tr=null),Xr&&(Cn=lt(Xr,Je,ge-Tn,ge+ii,1,nt.minY,nt.maxY,ze),Nn=lt(Xr,Je,ge+Or,ge+Mi,1,nt.minY,nt.maxY,ze),Xr=null),re>1&&console.timeEnd("clipping"),Ue.push(en||[],ne+1,2*ce,2*ge),Ue.push(mn||[],ne+1,2*ce,2*ge+1),Ue.push(Cn||[],ne+1,2*ce+1,2*ge),Ue.push(Nn||[],ne+1,2*ce+1,2*ge+1)}}},yt.prototype.getTile=function(Se,ne,ce){var ge=this.options,xe=ge.extent,Oe=ge.debug;if(Se<0||Se>24)return null;var $e=1<<Se,Ue=bt(Se,ne=(ne%$e+$e)%$e,ce);if(this.tiles[Ue])return Pr(this.tiles[Ue],xe);Oe>1&&console.log("drilling down to z%d-%d-%d",Se,ne,ce);for(var ze,re=Se,Je=ne,Qe=ce;!ze&&re>0;)re--,Je=Math.floor(Je/2),Qe=Math.floor(Qe/2),ze=this.tiles[bt(re,Je,Qe)];return ze&&ze.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",re,Je,Qe),Oe>1&&console.time("drilling down"),this.splitTile(ze.source,re,Je,Qe,Se,ne,ce),Oe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?Pr(this.tiles[Ue],xe):null):null};class vr extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const ge=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!xe)return null;const Oe=new class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=Ue.length,this._features=Ue}feature(Ue){return new class{constructor(ze){this._feature=ze,this.extent=u.W,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){const ze=[];for(const re of this._feature.geometry)ze.push([new u.P(re[0],re[1])]);return ze}{const ze=[];for(const re of this._feature.geometry){const Je=[];for(const Qe of re)Je.push(new u.P(Qe[0],Qe[1]));ze.push(Je)}return ze}}toGeoJSON(ze,re,Je){return I.call(this,ze,re,Je)}}(this._features[Ue])}}(xe.features);let $e=Ne(Oe);return $e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),{vectorTile:Oe,rawData:$e.buffer}})}loadData(ne){return u._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request);this._pendingRequest=new AbortController;try{let xe=yield this.loadGeoJSON(ne,this._pendingRequest);if(delete this._pendingRequest,typeof xe!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(P(xe,!0),ne.filter){const $e=u.by(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));xe={type:"FeatureCollection",features:xe.features.filter(ze=>$e.value.evaluate({zoom:0},ze))}}this._geoJSONIndex=ne.cluster?new He(function({superclusterOptions:$e,clusterProperties:Ue}){if(!Ue||!$e)return $e;const ze={},re={},Je={accumulated:null,zoom:0},Qe={properties:null},nt=Object.keys(Ue);for(const ht of nt){const[Dt,en]=Ue[ht],mn=u.by(en),Cn=u.by(typeof Dt=="string"?[Dt,["accumulated"],["get",ht]]:Dt);ze[ht]=mn.value,re[ht]=Cn.value}return $e.map=ht=>{Qe.properties=ht;const Dt={};for(const en of nt)Dt[en]=ze[en].evaluate(Je,Qe);return Dt},$e.reduce=(ht,Dt)=>{Qe.properties=Dt;for(const en of nt)Je.accumulated=ht[en],ht[en]=re[en].evaluate(Je,Qe)},$e}(ne)).load(xe.features):function($e,Ue){return new yt($e,Ue)}(xe,ne.geojsonVtOptions),this.loaded={};const Oe={};if(ge){const $e=ge.finish();$e&&(Oe.resourceTiming={},Oe.resourceTiming[ne.source]=JSON.parse(JSON.stringify($e)))}return Oe}catch(xe){if(delete this._pendingRequest,u.bz(xe))return{abandoned:!0};throw xe}})}reloadTile(ne){const ce=this.loaded;return ce&&ce[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadGeoJSON(ne,ce){return u._(this,void 0,void 0,function*(){const{promoteId:ge}=ne;if(ne.request){const xe=yield u.h(ne.request,ce);return this._dataUpdateable=Qt(xe.data,ge)?Yt(xe.data,ge):void 0,xe.data}if(typeof ne.data=="string")try{const xe=JSON.parse(ne.data);return this._dataUpdateable=Qt(xe,ge)?Yt(xe,ge):void 0,xe}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return function(xe,Oe,$e){var Ue,ze,re,Je;if(Oe.removeAll&&xe.clear(),Oe.remove)for(const Qe of Oe.remove)xe.delete(Qe);if(Oe.add)for(const Qe of Oe.add){const nt=Rt(Qe,$e);nt!=null&&xe.set(nt,Qe)}if(Oe.update)for(const Qe of Oe.update){let nt=xe.get(Qe.id);if(nt==null)continue;const ht=!Qe.removeAllProperties&&(((Ue=Qe.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((ze=Qe.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0);if((Qe.newGeometry||Qe.removeAllProperties||ht)&&(nt=Object.assign({},nt),xe.set(Qe.id,nt),ht&&(nt.properties=Object.assign({},nt.properties))),Qe.newGeometry&&(nt.geometry=Qe.newGeometry),Qe.removeAllProperties)nt.properties={};else if(((re=Qe.removeProperties)===null||re===void 0?void 0:re.length)>0)for(const Dt of Qe.removeProperties)Object.prototype.hasOwnProperty.call(nt.properties,Dt)&&delete nt.properties[Dt];if(((Je=Qe.addOrUpdateProperties)===null||Je===void 0?void 0:Je.length)>0)for(const{key:Dt,value:en}of Qe.addOrUpdateProperties)nt.properties[Dt]=en}}(this._dataUpdateable,ne.dataDiff,ge),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ne){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class or{constructor(ne){this.self=ne,this.actor=new u.C(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,ge)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=ge},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=ce=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,ge)=>this._getDEMWorkerSource(ce,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("LT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(ce,ge)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][ge.type]||!this.workerSources[ce][ge.type][ge.source])return;const xe=this.workerSources[ce][ge.type][ge.source];delete this.workerSources[ce][ge.type][ge.source],xe.removeSource!==void 0&&xe.removeSource(ge)})),this.actor.registerMessageHandler("RM",ce=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,ge)=>u._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(ce,ge)=>this._syncRTLPluginState(ce,ge)),this.actor.registerMessageHandler("IS",(ce,ge)=>u._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(ce,ge)=>this._setImages(ce,ge)),this.actor.registerMessageHandler("UL",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(ge.layers,ge.removedIds)})),this.actor.registerMessageHandler("SL",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(ge)}))}_setImages(ne,ce){return u._(this,void 0,void 0,function*(){this.availableImages[ne]=ce;for(const ge in this.workerSources[ne]){const xe=this.workerSources[ne][ge];for(const Oe in xe)xe[Oe].availableImages=ce}})}_syncRTLPluginState(ne,ce){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(ce.pluginStatus!=="loading")return u.bA.setState(ce),ce;const ge=ce.pluginURL;if(this.self.importScripts(ge),u.bA.isParsed()){const xe={pluginStatus:"loaded",pluginURL:ge};return u.bA.setState(xe),xe}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ge}`)})}_getAvailableImages(ne){let ce=this.availableImages[ne];return ce||(ce=[]),ce}_getLayerIndex(ne){let ce=this.layerIndexes[ne];return ce||(ce=this.layerIndexes[ne]=new s),ce}_getWorkerSource(ne,ce,ge){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][ce]||(this.workerSources[ne][ce]={}),!this.workerSources[ne][ce][ge]){const xe={sendAsync:(Oe,$e)=>(Oe.targetMapId=ne,this.actor.sendAsync(Oe,$e))};switch(ce){case"vector":this.workerSources[ne][ce][ge]=new _(xe,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][ce][ge]=new vr(xe,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][ce][ge]=new this.externalWorkerSourceTypes[ce](xe,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][ce][ge]}_getDEMWorkerSource(ne,ce){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ce]||(this.demWorkerSources[ne][ce]=new x),this.demWorkerSources[ne][ce]}}return u.i(self)&&(self.worker=new or(self)),or}),i("index",["exports","./shared"],function(u,s){var d="4.1.3";let p,g;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,h)=>{const y=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),h(s.c())})}),getImageData(w,l=0){return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,h.drawImage(w,0,0,w.width,w.height),h},resolveURL:w=>(p||(p=document.createElement("a")),p.href=w,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let h=0;h<l.length;h++)if(l[h]in x.docStyle)return l[h];return l[0]}static create(l,h,y){const v=window.document.createElement(l);return h!==void 0&&(v.className=h),y&&y.appendChild(v),v}static createNS(l,h){return window.document.createElementNS(l,h)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,h){l.style[x.transformProp]=h}static addEventListener(l,h,y,v={}){l.addEventListener(h,y,"passive"in v?v:v.capture)}static removeEventListener(l,h,y,v={}){l.removeEventListener(h,y,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const h=l.getBoundingClientRect();return{x:h.width/l.offsetWidth||1,y:h.height/l.offsetHeight||1,boundingClientRect:h}}static getPoint(l,h,y){const v=h.boundingClientRect;return new s.P((y.clientX-v.left)/h.x-l.clientLeft,(y.clientY-v.top)/h.y-l.clientTop)}static mousePos(l,h){const y=x.getScale(l);return x.getPoint(l,y,h)}static touchPos(l,h){const y=[],v=x.getScale(l);for(let A=0;A<h.length;A++)y.push(x.getPoint(l,v,h[A]));return y}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(w){!I&&P&&(E?L(w):T=w)}};let T,P,I=!1,E=!1;function L(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,P),w.isContextLost())return;C.supported=!0}catch{}w.deleteTexture(l),I=!0}var O;typeof document<"u"&&(P=document.createElement("img"),P.onload=function(){T&&L(T),T=null,E=!0},P.onerror=function(){I=!0,T=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,h,y,v;w.resetRequestQueue=()=>{l=[],h=0,y=0,v={}},w.addThrottleControl=$=>{const W=y++;return v[W]=$,W},w.removeThrottleControl=$=>{delete v[$],z()},w.getImage=($,W,Q=!0)=>new Promise((te,me)=>{C.supported&&($.headers||($.headers={}),$.headers.accept="image/webp,*/*"),s.e($,{type:"image"}),l.push({abortController:W,requestParameters:$,supportImageRefresh:Q,state:"queued",onError:ke=>{me(ke)},onSuccess:ke=>{te(ke)}}),z()});const A=$=>s._(this,void 0,void 0,function*(){$.state="running";const{requestParameters:W,supportImageRefresh:Q,onError:te,onSuccess:me,abortController:ke}=$,Ae=Q===!1&&!s.i(self)&&!s.g(W.url)&&(!W.headers||Object.keys(W.headers).reduce((Re,et)=>Re&&et==="accept",!0));h++;const Te=Ae?D(W,ke):s.m(W,ke);try{const Re=yield Te;delete $.abortController,$.state="completed",Re.data instanceof HTMLImageElement||s.b(Re.data)?me(Re):Re.data&&me({data:yield(be=Re.data,typeof createImageBitmap=="function"?s.d(be):s.f(be)),cacheControl:Re.cacheControl,expires:Re.expires})}catch(Re){delete $.abortController,te(Re)}finally{h--,z()}var be}),z=()=>{const $=(()=>{for(const W of Object.keys(v))if(v[W]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let W=h;W<$&&l.length>0;W++){const Q=l.shift();Q.abortController.signal.aborted?W--:A(Q)}},D=($,W)=>new Promise((Q,te)=>{const me=new Image,ke=$.url,Ae=$.credentials;Ae&&Ae==="include"?me.crossOrigin="use-credentials":(Ae&&Ae==="same-origin"||!s.s(ke))&&(me.crossOrigin="anonymous"),W.signal.addEventListener("abort",()=>{me.src="",te(s.c())}),me.fetchPriority="high",me.onload=()=>{me.onerror=me.onload=null,Q({data:me})},me.onerror=()=>{me.onerror=me.onload=null,W.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},me.src=ke})}(O||(O={})),O.resetRequestQueue();class F{constructor(l){this._transformRequestFn=l}transformRequest(l,h){return this._transformRequestFn&&this._transformRequestFn(l,h)||{url:l}}normalizeSpriteURL(l,h,y){const v=function(A){const z=A.match(Z);if(!z)throw new Error(`Unable to parse URL "${A}"`);return{protocol:z[1],authority:z[2],path:z[3]||"/",params:z[4]?z[4].split("&"):[]}}(l);return v.path+=`${h}${y}`,function(A){const z=A.params.length?`?${A.params.join("&")}`:"";return`${A.protocol}://${A.authority}${A.path}${z}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function K(w){var l=new s.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var q,J=function(w,l,h){return w[0]=l[0]-h[0],w[1]=l[1]-h[1],w[2]=l[2]-h[2],w};q=new s.A(3),s.A!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0);var fe=function(w){var l=w[0],h=w[1];return l*l+h*h};function Ee(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const h=[];for(const{id:y,url:v}of w){const A=`${y}${v}`;h.indexOf(A)===-1&&(h.push(A),l.push({id:y,url:v}))}}return l}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class ee{constructor(l,h,y,v){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(h,v)}update(l,h,y){const{width:v,height:A}=l,z=!(this.size&&this.size[0]===v&&this.size[1]===A||y),{context:D}=this,{gl:$}=D;if(this.useMipmap=!!(h&&h.useMipmap),$.bindTexture($.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===$.RGBA&&(!h||h.premultiply!==!1)),z)this.size=[v,A],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texImage2D($.TEXTURE_2D,0,this.format,this.format,$.UNSIGNED_BYTE,l):$.texImage2D($.TEXTURE_2D,0,this.format,v,A,0,this.format,$.UNSIGNED_BYTE,l.data);else{const{x:W,y:Q}=y||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texSubImage2D($.TEXTURE_2D,0,W,Q,$.RGBA,$.UNSIGNED_BYTE,l):$.texSubImage2D($.TEXTURE_2D,0,W,Q,v,A,$.RGBA,$.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&$.generateMipmap($.TEXTURE_2D)}bind(l,h,y){const{context:v}=this,{gl:A}=v;A.bindTexture(A.TEXTURE_2D,this.texture),y!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=A.LINEAR),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,y||l),this.filter=l),h!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,h),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ie(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class ve extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:h,promiseResolve:y}of this.requestors)y(this._getImagesForIds(h));this.requestors=[]}}getImage(l){const h=this.images[l];if(h&&!h.data&&h.spriteData){const y=h.spriteData;h.data=new s.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),h.spriteData=null}return h}addImage(l,h){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,h)&&(this.images[l]=h)}_validate(l,h){let y=!0;const v=h.data||h.spriteData;return this._validateStretch(h.stretchX,v&&v.width)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,v&&v.height)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,h){if(!l)return!0;let y=0;for(const v of l){if(v[0]<y||v[1]<v[0]||h<v[1])return!1;y=v[1]}return!0}_validateContent(l,h){if(!l)return!0;if(l.length!==4)return!1;const y=h.spriteData,v=y&&y.width||h.data.width,A=y&&y.height||h.data.height;return!(l[0]<0||v<l[0]||l[1]<0||A<l[1]||l[2]<0||v<l[2]||l[3]<0||A<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,h,y=!0){const v=this.getImage(l);if(y&&(v.data.width!==h.data.width||v.data.height!==h.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=v.version+1,this.images[l]=h,this.updatedImages[l]=!0}removeImage(l){const h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((h,y)=>{let v=!0;if(!this.isLoaded())for(const A of l)this.images[A]||(v=!1);this.isLoaded()||v?h(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:h})})}_getImagesForIds(l){const h={};for(const y of l){let v=this.getImage(y);v||(this.fire(new s.k("styleimagemissing",{id:y})),v=this.getImage(y)),v?h[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:l,height:h}=this.atlasImage;return{width:l,height:h}}getPattern(l){const h=this.patterns[l],y=this.getImage(l);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{const v={w:y.data.width+2,h:y.data.height+2,x:0,y:0},A=new s.I(v,y);this.patterns[l]={bin:v,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ee(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:h,h:y}=s.p(l),v=this.atlasImage;v.resize({width:h||1,height:y||1});for(const A in this.patterns){const{bin:z}=this.patterns[A],D=z.x+1,$=z.y+1,W=this.getImage(A).data,Q=W.width,te=W.height;s.R.copy(W,v,{x:0,y:0},{x:D,y:$},{width:Q,height:te}),s.R.copy(W,v,{x:0,y:te-1},{x:D,y:$-1},{width:Q,height:1}),s.R.copy(W,v,{x:0,y:0},{x:D,y:$+te},{width:Q,height:1}),s.R.copy(W,v,{x:Q-1,y:0},{x:D-1,y:$},{width:1,height:te}),s.R.copy(W,v,{x:0,y:0},{x:D+Q,y:$},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const h of l){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const y=this.getImage(h);y||s.w(`Image with ID: "${h}" was not found`),ie(y)&&this.updateImage(h,y)}}}const ye=1e20;function it(w,l,h,y,v,A,z,D,$){for(let W=l;W<l+y;W++)Be(w,h*A+W,A,v,z,D,$);for(let W=h;W<h+v;W++)Be(w,W*A+l,1,y,z,D,$)}function Be(w,l,h,y,v,A,z){A[0]=0,z[0]=-ye,z[1]=ye,v[0]=w[l];for(let D=1,$=0,W=0;D<y;D++){v[D]=w[l+D*h];const Q=D*D;do{const te=A[$];W=(v[D]-v[te]+Q-te*te)/(D-te)/2}while(W<=z[$]&&--$>-1);$++,A[$]=D,z[$]=W,z[$+1]=ye}for(let D=0,$=0;D<y;D++){for(;z[$+1]<D;)$++;const W=A[$],Q=D-W;w[l+D*h]=v[W]+Q*Q}}class Ne{constructor(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,function*(){const h=[];for(const A in l)for(const z of l[A])h.push(this._getAndCacheGlyphsPromise(A,z));const y=yield Promise.all(h),v={};for(const{stack:A,id:z,glyph:D}of y)v[A]||(v[A]={}),v[A][z]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return v})}_getAndCacheGlyphsPromise(l,h){return s._(this,void 0,void 0,function*(){let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{}});let v=y.glyphs[h];if(v!==void 0)return{stack:l,id:h,glyph:v};if(v=this._tinySDF(y,l,h),v)return y.glyphs[h]=v,{stack:l,id:h,glyph:v};const A=Math.floor(h/256);if(256*A>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[A])return{stack:l,id:h,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[A]){const D=Ne.loadGlyphRange(l,A,this.url,this.requestManager);y.requests[A]=D}const z=yield y.requests[A];for(const D in z)this._doesCharSupportLocalGlyph(+D)||(y.glyphs[+D]=z[+D]);return y.ranges[A]=!0,{stack:l,id:h,glyph:z[h]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](l)||s.u["Hangul Syllables"](l)||s.u.Hiragana(l)||s.u.Katakana(l))}_tinySDF(l,h,y){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(y))return;let A=l.tinySDF;if(!A){let D="400";/bold/i.test(h)?D="900":/medium/i.test(h)?D="500":/light/i.test(h)&&(D="200"),A=l.tinySDF=new Ne.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:D})}const z=A.draw(String.fromCharCode(y));return{id:y,bitmap:new s.o({width:z.width||60,height:z.height||60},z.data),metrics:{width:z.glyphWidth/2||24,height:z.glyphHeight/2||24,left:z.glyphLeft/2+.5||0,top:z.glyphTop/2-27.5||-8,advance:z.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ne.loadGlyphRange=function(w,l,h,y){return s._(this,void 0,void 0,function*(){const v=256*l,A=v+255,z=y.transformRequest(h.replace("{fontstack}",w).replace("{range}",`${v}-${A}`),"Glyphs"),D=yield s.l(z,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${l}, ${v}-${A}`);const $={};for(const W of s.n(D.data))$[W.id]=W;return $})},Ne.TinySDF=class{constructor({fontSize:w=24,buffer:l=3,radius:h=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:A="normal",fontStyle:z="normal"}={}){this.buffer=l,this.cutoff=y,this.radius=h;const D=this.size=w+4*l,$=this._createCanvas(D),W=this.ctx=$.getContext("2d",{willReadFrequently:!0});W.font=`${z} ${A} ${w}px ${v}`,W.textBaseline="alphabetic",W.textAlign="left",W.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:y,actualBoundingBoxLeft:v,actualBoundingBoxRight:A}=this.ctx.measureText(w),z=Math.ceil(h),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-v))),$=Math.min(this.size-this.buffer,z+Math.ceil(y)),W=D+2*this.buffer,Q=$+2*this.buffer,te=Math.max(W*Q,0),me=new Uint8ClampedArray(te),ke={data:me,width:W,height:Q,glyphWidth:D,glyphHeight:$,glyphTop:z,glyphLeft:0,glyphAdvance:l};if(D===0||$===0)return ke;const{ctx:Ae,buffer:Te,gridInner:be,gridOuter:Re}=this;Ae.clearRect(Te,Te,D,$),Ae.fillText(w,Te,Te+z);const et=Ae.getImageData(Te,Te,D,$);Re.fill(ye,0,te),be.fill(0,0,te);for(let Le=0;Le<$;Le++)for(let Ve=0;Ve<D;Ve++){const rt=et.data[4*(Le*D+Ve)+3]/255;if(rt===0)continue;const st=(Le+Te)*W+Ve+Te;if(rt===1)Re[st]=0,be[st]=ye;else{const ft=.5-rt;Re[st]=ft>0?ft*ft:0,be[st]=ft<0?ft*ft:0}}it(Re,0,0,W,Q,W,this.f,this.v,this.z),it(be,Te,Te,D,$,W,this.f,this.v,this.z);for(let Le=0;Le<te;Le++){const Ve=Math.sqrt(Re[Le])-Math.sqrt(be[Le]);me[Le]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return ke}};class Ie{constructor(){this.specification=s.v.light.position}possiblyEvaluate(l,h){return s.y(l.expression.evaluate(h))}interpolate(l,h,y){return{x:s.z.number(l.x,h.x,y),y:s.z.number(l.y,h.y,y),z:s.z.number(l.z,h.z,y)}}}let ot;class Ke extends s.E{constructor(l){super(),ot=ot||new s.q({anchor:new s.D(s.v.light.anchor),position:new Ie,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ot),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h={}){if(!this._validate(s.r,l,h))for(const y in l){const v=l[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),v):this._transitionable.setValue(y,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||y.validate!==!1)&&s.t(this,l.call(s.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class ut{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,h){const y=l.join(",")+String(h);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(l,h)),this.dashEntry[y]}getDashRanges(l,h,y){const v=[];let A=l.length%2==1?-l[l.length-1]*y:0,z=l[0]*y,D=!0;v.push({left:A,right:z,isDash:D,zeroLength:l[0]===0});let $=l[0];for(let W=1;W<l.length;W++){D=!D;const Q=l[W];A=$*y,$+=Q,z=$*y,v.push({left:A,right:z,isDash:D,zeroLength:Q===0})}return v}addRoundDash(l,h,y){const v=h/2;for(let A=-y;A<=y;A++){const z=this.width*(this.nextRow+y+A);let D=0,$=l[D];for(let W=0;W<this.width;W++){W/$.right>1&&($=l[++D]);const Q=Math.abs(W-$.left),te=Math.abs(W-$.right),me=Math.min(Q,te);let ke;const Ae=A/y*(v+1);if($.isDash){const Te=v-Math.abs(Ae);ke=Math.sqrt(me*me+Te*Te)}else ke=v-Math.sqrt(me*me+Ae*Ae);this.data[z+W]=Math.max(0,Math.min(255,ke+128))}}}addRegularDash(l){for(let D=l.length-1;D>=0;--D){const $=l[D],W=l[D+1];$.zeroLength?l.splice(D,1):W&&W.isDash===$.isDash&&(W.left=$.left,l.splice(D,1))}const h=l[0],y=l[l.length-1];h.isDash===y.isDash&&(h.left=y.left-this.width,y.right=h.right+this.width);const v=this.width*this.nextRow;let A=0,z=l[A];for(let D=0;D<this.width;D++){D/z.right>1&&(z=l[++A]);const $=Math.abs(D-z.left),W=Math.abs(D-z.right),Q=Math.min($,W);this.data[v+D]=Math.max(0,Math.min(255,(z.isDash?Q:-Q)+128))}}addDash(l,h){const y=h?7:0,v=2*y+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let A=0;for(let D=0;D<l.length;D++)A+=l[D];if(A!==0){const D=this.width/A,$=this.getDashRanges(l,this.width,D);h?this.addRoundDash($,D,y):this.addRegularDash($)}const z={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:A};return this.nextRow+=v,this.dirty=!0,z}bind(l){const h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const pt="maplibre_preloaded_worker_pool";class _t{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<_t.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pt]}numActive(){return Object.keys(this.active).length}}const He=Math.floor(_.hardwareConcurrency/2);let mt,Pt;function jt(){return mt||(mt=new _t),mt}_t.workerCount=s.B(globalThis)?Math.max(Math.min(He,3),1):1;class un{constructor(l,h){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=h;const y=this.workerPool.acquire(h);for(let v=0;v<y.length;v++){const A=new s.C(y[v],h);A.name=`Worker ${v}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,h){const y=[];for(const v of this.actors)y.push(v.sendAsync({type:l,data:h}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,h){for(const y of this.actors)y.registerMessageHandler(l,h)}}function nn(){return Pt||(Pt=new un(jt(),s.G),Pt.registerMessageHandler("GR",(w,l,h)=>s.m(l,h))),Pt}function rn(w,l){const h=s.F();return s.H(h,h,[1,1,0]),s.J(h,h,[.5*w.width,.5*w.height,1]),s.K(h,h,w.calculatePosMatrix(l.toUnwrapped()))}function pn(w,l,h,y,v,A){const z=function(te,me,ke){if(te)for(const Ae of te){const Te=me[Ae];if(Te&&Te.source===ke&&Te.type==="fill-extrusion")return!0}else for(const Ae in me){const Te=me[Ae];if(Te.source===ke&&Te.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,w.id),D=A.maxPitchScaleFactor(),$=w.tilesIn(y,D,z);$.sort(yn);const W=[];for(const te of $)W.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,h,w._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,v,A,D,rn(w.transform,te.tileID))});const Q=function(te){const me={},ke={};for(const Ae of te){const Te=Ae.queryResults,be=Ae.wrappedTileID,Re=ke[be]=ke[be]||{};for(const et in Te){const Le=Te[et],Ve=Re[et]=Re[et]||{},rt=me[et]=me[et]||[];for(const st of Le)Ve[st.featureIndex]||(Ve[st.featureIndex]=!0,rt.push(st))}}return me}(W);for(const te in Q)Q[te].forEach(me=>{const ke=me.feature,Ae=w.getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Ae});return Q}function yn(w,l){const h=w.tileID,y=l.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function qe(w,l,h){return s._(this,void 0,void 0,function*(){let y=w;if(w.url?y=(yield s.h(l.transformRequest(w.url,"Source"),h)).data:yield _.frameAsync(h),!y)return null;const v=s.L(s.e(y,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(A=>A.id)),v})}class Ge{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}extend(l){const h=this._sw,y=this._ne;let v,A;if(l instanceof s.M)v=l,A=l;else{if(!(l instanceof Ge))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ge.convert(l)):this.extend(s.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.M.convert(l)):this;if(v=l._sw,A=l._ne,!v||!A)return this}return h||y?(h.lng=Math.min(v.lng,h.lng),h.lat=Math.min(v.lat,h.lat),y.lng=Math.max(A.lng,y.lng),y.lat=Math.max(A.lat,y.lat)):(this._sw=new s.M(v.lng,v.lat),this._ne=new s.M(A.lng,A.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:y}=s.M.convert(l);let v=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&v}static convert(l){return l instanceof Ge?l:l&&new Ge(l)}static fromLngLat(l,h=0){const y=360*h/40075017,v=y/Math.cos(Math.PI/180*l.lat);return new Ge(new s.M(l.lng-v,l.lat-y),new s.M(l.lng+v,l.lat+y))}}class At{constructor(l,h,y){this.bounds=Ge.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),y=Math.floor(s.N(this.bounds.getWest())*h),v=Math.floor(s.O(this.bounds.getNorth())*h),A=Math.ceil(s.N(this.bounds.getEast())*h),z=Math.ceil(s.O(this.bounds.getSouth())*h);return l.x>=y&&l.x<A&&l.y>=v&&l.y<z}}class tt extends s.E{constructor(l,h,y,v){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(h,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new At(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(h,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((A,z)=>{l.reloadPromise={resolve:A,reject:z}})}else l.actor=this.dispatcher.getActor(),v="LT";l.abortController=new AbortController;try{const A=yield l.actor.sendAsync({type:v,data:y},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,A)}catch(A){if(delete l.abortController,l.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,h){if(h&&h.resourceTiming&&(l.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&l.setExpiryData(h),l.loadVectorData(h,this.map.painter),l.reloadPromise){const y=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(y.resolve).catch(y.reject)}}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class he extends s.E{constructor(l,h,y,v){super(),this.id=l,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},h),s.e(this,s.L(h,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new At(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const y=yield O.getImage(this.map._requestManager.transformRequest(h,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const v=this.map.painter.context,A=v.gl,z=y.data;l.texture=this.map.painter.getTileTexture(z.width),l.texture?l.texture.update(z,{useMipmap:!0}):(l.texture=new ee(v,z,A.RGBA,{useMipmap:!0}),l.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class cn extends he{constructor(l,h,y,v){super(l,h,y,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(h,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const v=yield O.getImage(y,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){const A=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const z=s.b(A)&&s.S()?A:yield this.readImageNow(A),D={type:this.type,uid:l.uid,source:this.id,rawImageData:z,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const $=yield l.actor.sendAsync({type:"LDT",data:D});l.dem=$,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}})}readImageNow(l){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const h=l.width+2,y=l.height+2;try{return new s.R({width:h,height:y},yield s.V(l,-1,-1,h,y))}catch{}}return _.getImageData(l,1)})}_getNeighboringTiles(l){const h=l.canonical,y=Math.pow(2,h.z),v=(h.x-1+y)%y,A=h.x===0?l.wrap-1:l.wrap,z=(h.x+1+y)%y,D=h.x+1===y?l.wrap+1:l.wrap,$={};return $[new s.Q(l.overscaledZ,A,h.z,v,h.y).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,h.z,z,h.y).key]={backfilled:!1},h.y>0&&($[new s.Q(l.overscaledZ,A,h.z,v,h.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,h.z,z,h.y-1).key]={backfilled:!1}),h.y+1<y&&($[new s.Q(l.overscaledZ,A,h.z,v,h.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,h.z,z,h.y+1).key]={backfilled:!1}),$}unloadTile(l){return s._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Xe extends s.E{constructor(l,h,y,v){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=h.data,this._options=s.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const A=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*A,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*A,extent:s.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.W,radius:(h.clusterRadius||50)*A,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,h,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:h,offset:y}})}_updateWorkerData(l){return s._(this,void 0,void 0,function*(){const h=s.e({type:this.type},this.workerOptions);l?h.dataDiff=l:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let v=null;y.resourceTiming&&y.resourceTiming[this.id]&&(v=y.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(A,{resourceTiming:v}),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.actor?"RT":"LT";l.actor=this.actor;const y={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const v=yield this.actor.sendAsync({type:h,data:y},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(v,this.map.painter,h==="RT")})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var lt=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Gt extends s.E{constructor(l,h,y,v){super(),this.id=l,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h}load(l){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield O.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,l&&(this.coordinates=l),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new s.j(h))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const h=l.map(s.Y.fromLngLat);this.tileID=function(v){let A=1/0,z=1/0,D=-1/0,$=-1/0;for(const me of v)A=Math.min(A,me.x),z=Math.min(z,me.y),D=Math.max(D,me.x),$=Math.max($,me.y);const W=Math.max(D-A,$-z),Q=Math.max(0,Math.floor(-Math.log(W)/Math.LN2)),te=Math.pow(2,Q);return new s.a0(Q,Math.floor((A+D)/2*te),Math.floor((z+$)/2*te))}(h),this.minzoom=this.maxzoom=this.tileID.z;const y=h.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,s.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,s.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ee(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Kn extends Gt{constructor(l,h,y,v){super(l,h,y,v),this.roundZoom=!0,this.type="video",this.options=h}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const h of l.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield s.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new s.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ee(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Gn extends Gt{constructor(l,h,y,v){super(l,h,y,v),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(z=>typeof z!="number"))||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,y=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ee(h,this.canvas,y.RGBA,{premultiply:!0});let v=!1;for(const A in this.tiles){const z=this.tiles[A];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture,v=!0)}v&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const fr={},Sr=w=>{switch(w){case"geojson":return Xe;case"image":return Gt;case"raster":return he;case"raster-dem":return cn;case"vector":return tt;case"video":return Kn;case"canvas":return Gn}return fr[w]},Cr="RTLPluginLoaded";class xi extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nn()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,function*(h,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(Cr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Un=null;function xt(){return Un||(Un=new xi),Un}class Pr{constructor(l,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=s.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const h=l+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,h,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,A){const z={};if(!A)return z;for(const D of v){const $=D.layerIds.map(W=>A.getLayer(W)).filter(Boolean);if($.length!==0){D.layers=$,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(W=>$.filter(Q=>Q.id===W)[0]));for(const W of $)z[W.id]=D}}return z}(l.buckets,h.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5){if(this.hasSymbolBuckets=!0,!y)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5&&A.hasRTLText){this.hasRTLText=!0,xt().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const A=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(v).queryRadius(A))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(l)}const h=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ee(l,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ee(l,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,h,y,v,A,z,D,$,W,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:A,scale:z,tileSize:this.tileSize,pixelPosMatrix:Q,transform:$,params:D,queryPadding:this.queryPadding*W},l,h,y):{}}querySourceFeatures(l,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const v=y.loadVTLayers(),A=h&&h.sourceLayer?h.sourceLayer:"",z=v._geojsonTileLayer||v[A];if(!z)return;const D=s.a6(h&&h.filter),{z:$,x:W,y:Q}=this.tileID.canonical,te={z:$,x:W,y:Q};for(let me=0;me<z.length;me++){const ke=z.feature(me);if(D.needGeometry){const be=s.a7(ke,!0);if(!D.filter(new s.a8(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!D.filter(new s.a8(this.tileID.overscaledZ),ke))continue;const Ae=y.getId(ke,A),Te=new s.a9(ke,$,W,Q,Ae);Te.tile=te,l.push(Te)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const h=this.expirationTime;if(l.cacheControl){const y=s.aa(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let v=!1;if(this.expirationTime>y)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const A=this.expirationTime-h;A?this.expirationTime=y+Math.max(A,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!h.style.hasLayer(v))continue;const A=this.buckets[v],z=A.layers[0].sourceLayer||"_geojsonTileLayer",D=y[z],$=l[z];if(!D||!$||Object.keys($).length===0)continue;A.update($,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const W=h&&h.style&&h.style.getLayer(v);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=_.now()+l}setDependencies(l,h){const y={};for(const v of h)y[v]=!0;this.dependencies[l]=y}hasDependency(l,h){for(const y of l){const v=this.dependencies[y];if(v){for(const A of h)if(v[A])return!0}}return!1}}class br{constructor(l,h){this.max=l,this.onRemove=h,this.reset()}reset(){for(const l in this.data)for(const h of this.data[l])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(l,h,y){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const A={value:h,timeout:void 0};if(y!==void 0&&(A.timeout=setTimeout(()=>{this.remove(l,A)},y)),this.data[v].push(A),this.order.push(v),this.order.length>this.max){const z=this._getAndRemoveByKey(this.order[0]);z&&this.onRemove(z)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value}getByKey(l){const h=this.data[l];return h?h[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,h){if(!this.has(l))return this;const y=l.wrapped().key,v=h===void 0?0:this.data[y].indexOf(h),A=this.data[y][v];return this.data[y].splice(v,1),A.timeout&&clearTimeout(A.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(A.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(l){const h=[];for(const y in this.data)for(const v of this.data[y])l(v.value)||h.push(v);for(const y of h)this.remove(y.value.tileID,y)}}class Bi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,h,y){const v=String(h);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},s.e(this.stateChanges[l][v],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const A in this.state[l])A!==v&&(this.deletedStates[l][A]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const A in this.state[l][v])y[A]||(this.deletedStates[l][v][A]=null)}else for(const A in y)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][A]===null&&delete this.deletedStates[l][v][A]}removeFeatureState(l,h,y){if(this.deletedStates[l]===null)return;const v=String(h);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&h!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][y]=null);else if(h!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(y in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][y]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,h){const y=String(h),v=s.e({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const A=this.deletedStates[l][h];if(A===null)return{};for(const z in A)delete v[z]}return v}initializeTileState(l,h){l.setFeatureState(this.state,h)}coalesceChanges(l,h){const y={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const A={};for(const z in this.stateChanges[v])this.state[v][z]||(this.state[v][z]={}),s.e(this.state[v][z],this.stateChanges[v][z]),A[z]=this.state[v][z];y[v]=A}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const A={};if(this.deletedStates[v]===null)for(const z in this.state[v])A[z]={},this.state[v][z]={};else for(const z in this.deletedStates[v]){if(this.deletedStates[v][z]===null)this.state[v][z]={};else for(const D of Object.keys(this.deletedStates[v][z]))delete this.state[v][z][D];A[z]=this.state[v][z]}y[v]=y[v]||{},s.e(y[v],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const v in l)l[v].setFeatureState(y,h)}}class $n extends s.E{constructor(l,h,y){super(),this.id=l,this.dispatcher=y,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,A,z,D)=>{const $=new(Sr(A.type))(v,A,z,D);if($.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${$.id}`);return $})(l,h,y,this),this._tiles={},this._cache=new br(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bi,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,h,y){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,h,y)}catch(v){l.state="errored",v.status!==404?this._source.fire(new s.j(v,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Fe).map(l=>l.key)}getRenderableIds(l){const h=[];for(const y in this._tiles)this._isIdRenderable(y,l)&&h.push(this._tiles[y]);return l?h.sort((y,v)=>{const A=y.tileID,z=v.tileID,D=new s.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),$=new s.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-z.overscaledZ||$.y-D.y||$.x-D.x}).map(y=>y.tileID.key):h.map(y=>y.tileID).sort(Fe).map(y=>y.key)}hasRenderableParent(l){const h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,h){return s._(this,void 0,void 0,function*(){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=h),yield this._loadTile(y,l,h))})}_tileLoaded(l,h,y){l.timeAdded=_.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const h=this.getRenderableIds();for(let v=0;v<h.length;v++){const A=h[v];if(l.neighboringTiles&&l.neighboringTiles[A]){const z=this.getTileByID(A);y(l,z),y(z,l)}}function y(v,A){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let z=A.tileID.canonical.x-v.tileID.canonical.x;const D=A.tileID.canonical.y-v.tileID.canonical.y,$=Math.pow(2,v.tileID.canonical.z),W=A.tileID.key;z===0&&D===0||Math.abs(D)>1||(Math.abs(z)>1&&(Math.abs(z+$)===1?z+=$:Math.abs(z-$)===1&&(z-=$)),A.dem&&v.dem&&(v.dem.backfillBorder(A.dem,z,D),v.neighboringTiles&&v.neighboringTiles[W]&&(v.neighboringTiles[W].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,h,y,v){for(const A in this._tiles){let z=this._tiles[A];if(v[A]||!z.hasData()||z.tileID.overscaledZ<=h||z.tileID.overscaledZ>y)continue;let D=z.tileID;for(;z&&z.tileID.overscaledZ>h+1;){const W=z.tileID.scaledTo(z.tileID.overscaledZ-1);z=this._tiles[W.key],z&&z.hasData()&&(D=W)}let $=D;for(;$.overscaledZ>h;)if($=$.scaledTo($.overscaledZ-1),l[$.key]){v[D.key]=D;break}}}findLoadedParent(l,h){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=l.overscaledZ-1;y>=h;y--){const v=l.scaledTo(y),A=this._getLoadedTile(v);if(A)return A}}_getLoadedTile(l){const h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const h=Math.ceil(l.width/this._source.tileSize)+1,y=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(h*y*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(A)}handleWrapJump(l){const h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){const y={};for(const v in this._tiles){const A=this._tiles[v];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),y[A.tileID.key]=A}this._tiles=y;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,h){if(!this._sourceLoaded||this._paused)return;let y;this.transform=l,this.terrain=h,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(Q=>new s.Q(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y)):(y=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(y=y.filter(Q=>this._source.hasTile(Q)))):y=[];const v=l.coveringZoomLevel(this._source),A=Math.max(v-$n.maxOverzooming,this._source.minzoom),z=Math.max(v+$n.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Q={};for(const te of y)if(te.canonical.z>this._source.minzoom){const me=te.scaledTo(te.canonical.z-1);Q[me.key]=me;const ke=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));Q[ke.key]=ke}y=y.concat(Object.values(Q))}const D=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const $=this._updateRetainedTiles(y,v);if(yt(this._source.type)){const Q={},te={},me=Object.keys($),ke=_.now();for(const Ae of me){const Te=$[Ae],be=this._tiles[Ae];if(!be||be.fadeEndTime!==0&&be.fadeEndTime<=ke)continue;const Re=this.findLoadedParent(Te,A);Re&&(this._addTile(Re.tileID),Q[Re.tileID.key]=Re.tileID),te[Ae]=Te}this._retainLoadedChildren(te,v,z,$);for(const Ae in Q)$[Ae]||(this._coveredTiles[Ae]=!0,$[Ae]=Q[Ae]);if(h){const Ae={},Te={};for(const be of y)this._tiles[be.key].hasData()?Ae[be.key]=be:Te[be.key]=be;for(const be in Te){const Re=Te[be].children(this._source.maxzoom);this._tiles[Re[0].key]&&this._tiles[Re[1].key]&&this._tiles[Re[2].key]&&this._tiles[Re[3].key]&&(Ae[Re[0].key]=$[Re[0].key]=Re[0],Ae[Re[1].key]=$[Re[1].key]=Re[1],Ae[Re[2].key]=$[Re[2].key]=Re[2],Ae[Re[3].key]=$[Re[3].key]=Re[3],delete Te[be])}for(const be in Te){const Re=this.findLoadedParent(Te[be],this._source.minzoom);if(Re){Ae[Re.tileID.key]=$[Re.tileID.key]=Re.tileID;for(const et in Ae)Ae[et].isChildOf(Re.tileID)&&delete Ae[et]}}for(const be in this._tiles)Ae[be]||(this._coveredTiles[be]=!0)}}for(const Q in $)this._tiles[Q].clearFadeHold();const W=s.ab(this._tiles,$);for(const Q of W){const te=this._tiles[Q];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(Q)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,h){const y={},v={},A=Math.max(h-$n.maxOverzooming,this._source.minzoom),z=Math.max(h+$n.maxUnderzooming,this._source.minzoom),D={};for(const $ of l){const W=this._addTile($);y[$.key]=$,W.hasData()||h<this._source.maxzoom&&(D[$.key]=$)}this._retainLoadedChildren(D,h,z,y);for(const $ of l){let W=this._tiles[$.key];if(W.hasData())continue;if(h+1>this._source.maxzoom){const te=$.children(this._source.maxzoom)[0],me=this.getTile(te);if(me&&me.hasData()){y[te.key]=te;continue}}else{const te=$.children(this._source.maxzoom);if(y[te[0].key]&&y[te[1].key]&&y[te[2].key]&&y[te[3].key])continue}let Q=W.wasRequested();for(let te=$.overscaledZ-1;te>=A;--te){const me=$.scaledTo(te);if(v[me.key])break;if(v[me.key]=!0,W=this.getTile(me),!W&&Q&&(W=this._addTile(me)),W){const ke=W.hasData();if((Q||ke)&&(y[me.key]=me),Q=W.wasRequested(),ke)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const h=[];let y,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){y=this._loadedParentTiles[v.key];break}h.push(v.key);const A=v.scaledTo(v.overscaledZ-1);if(y=this._getLoadedTile(A),y)break;v=A}for(const A of h)this._loadedParentTiles[A]=y}}_addTile(l){let h=this._tiles[l.key];if(h)return h;h=this._cache.getAndRemove(l),h&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));const y=h;return h||(h=new Pr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,l.key,h.state)),h.uses++,this._tiles[l.key]=h,y||this._source.fire(new s.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(l,h){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=h.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(l){const h=l.sourceDataType;l.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,h,y){const v=[],A=this.transform;if(!A)return v;const z=y?A.getCameraQueryGeometry(l):l,D=l.map(Ae=>A.pointCoordinate(Ae,this.terrain)),$=z.map(Ae=>A.pointCoordinate(Ae,this.terrain)),W=this.getIds();let Q=1/0,te=1/0,me=-1/0,ke=-1/0;for(const Ae of $)Q=Math.min(Q,Ae.x),te=Math.min(te,Ae.y),me=Math.max(me,Ae.x),ke=Math.max(ke,Ae.y);for(let Ae=0;Ae<W.length;Ae++){const Te=this._tiles[W[Ae]];if(Te.holdingForFade())continue;const be=Te.tileID,Re=Math.pow(2,A.zoom-Te.tileID.overscaledZ),et=h*Te.queryPadding*s.W/Te.tileSize/Re,Le=[be.getTilePoint(new s.Y(Q,te)),be.getTilePoint(new s.Y(me,ke))];if(Le[0].x-et<s.W&&Le[0].y-et<s.W&&Le[1].x+et>=0&&Le[1].y+et>=0){const Ve=D.map(st=>be.getTilePoint(st)),rt=$.map(st=>be.getTilePoint(st));v.push({tile:Te,tileID:be,queryGeometry:Ve,cameraQueryGeometry:rt,scale:Re})}}return v}getVisibleCoordinates(l){const h=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of h)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(yt(this._source.type)){const l=_.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=l)return!0}return!1}setFeatureState(l,h,y){this._state.updateState(l=l||"_geojsonTileLayer",h,y)}removeFeatureState(l,h,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,y)}getFeatureState(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)}setDependencies(l,h,y){const v=this._tiles[l];v&&v.setDependencies(h,y)}reloadTilesForDependencies(l,h){for(const y in this._tiles)this._tiles[y].hasDependency(l,h)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(l,h))}}function Fe(w,l){const h=Math.abs(2*w.wrap)-+(w.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||y-h||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function yt(w){return w==="raster"||w==="image"||w==="video"}$n.maxOverzooming=10,$n.maxUnderzooming=3;class bt{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ac(l,0,1);let h=1,y=this._distances[h];const v=l*this.paddedLength+this.padding;for(;y<v&&h<this._distances.length;)y=this._distances[++h];const A=h-1,z=this._distances[A],D=y-z,$=D>0?(v-z)/D:0;return this.points[A].mult(1-$).add(this.points[h].mult($))}}function Rt(w,l){let h=!0;return w==="always"||w!=="never"&&l!=="never"||(h=!1),h}class Qt{constructor(l,h,y){const v=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(h/y);for(let z=0;z<this.xCellCount*this.yCellCount;z++)v.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,y,v,A){this._forEachCell(h,y,v,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(A)}insertCircle(l,h,y,v){this._forEachCell(h-v,y-v,h+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(y),this.circles.push(v)}_insertBoxCell(l,h,y,v,A,z){this.boxCells[A].push(z)}_insertCircleCell(l,h,y,v,A,z){this.circleCells[A].push(z)}_query(l,h,y,v,A,z,D){if(y<0||l>this.width||v<0||h>this.height)return[];const $=[];if(l<=0&&h<=0&&this.width<=y&&this.height<=v){if(A)return[{key:null,x1:l,y1:h,x2:y,y2:v}];for(let W=0;W<this.boxKeys.length;W++)$.push({key:this.boxKeys[W],x1:this.bboxes[4*W],y1:this.bboxes[4*W+1],x2:this.bboxes[4*W+2],y2:this.bboxes[4*W+3]});for(let W=0;W<this.circleKeys.length;W++){const Q=this.circles[3*W],te=this.circles[3*W+1],me=this.circles[3*W+2];$.push({key:this.circleKeys[W],x1:Q-me,y1:te-me,x2:Q+me,y2:te+me})}}else this._forEachCell(l,h,y,v,this._queryCell,$,{hitTest:A,overlapMode:z,seenUids:{box:{},circle:{}}},D);return $}query(l,h,y,v){return this._query(l,h,y,v,!1,null)}hitTest(l,h,y,v,A,z){return this._query(l,h,y,v,!0,A,z).length>0}hitTestCircle(l,h,y,v,A){const z=l-y,D=l+y,$=h-y,W=h+y;if(D<0||z>this.width||W<0||$>this.height)return!1;const Q=[];return this._forEachCell(z,$,D,W,this._queryCellCircle,Q,{hitTest:!0,overlapMode:v,circle:{x:l,y:h,radius:y},seenUids:{box:{},circle:{}}},A),Q.length>0}_queryCell(l,h,y,v,A,z,D,$){const{seenUids:W,hitTest:Q,overlapMode:te}=D,me=this.boxCells[A];if(me!==null){const Ae=this.bboxes;for(const Te of me)if(!W.box[Te]){W.box[Te]=!0;const be=4*Te,Re=this.boxKeys[Te];if(l<=Ae[be+2]&&h<=Ae[be+3]&&y>=Ae[be+0]&&v>=Ae[be+1]&&(!$||$(Re))&&(!Q||!Rt(te,Re.overlapMode))&&(z.push({key:Re,x1:Ae[be],y1:Ae[be+1],x2:Ae[be+2],y2:Ae[be+3]}),Q))return!0}}const ke=this.circleCells[A];if(ke!==null){const Ae=this.circles;for(const Te of ke)if(!W.circle[Te]){W.circle[Te]=!0;const be=3*Te,Re=this.circleKeys[Te];if(this._circleAndRectCollide(Ae[be],Ae[be+1],Ae[be+2],l,h,y,v)&&(!$||$(Re))&&(!Q||!Rt(te,Re.overlapMode))){const et=Ae[be],Le=Ae[be+1],Ve=Ae[be+2];if(z.push({key:Re,x1:et-Ve,y1:Le-Ve,x2:et+Ve,y2:Le+Ve}),Q)return!0}}}return!1}_queryCellCircle(l,h,y,v,A,z,D,$){const{circle:W,seenUids:Q,overlapMode:te}=D,me=this.boxCells[A];if(me!==null){const Ae=this.bboxes;for(const Te of me)if(!Q.box[Te]){Q.box[Te]=!0;const be=4*Te,Re=this.boxKeys[Te];if(this._circleAndRectCollide(W.x,W.y,W.radius,Ae[be+0],Ae[be+1],Ae[be+2],Ae[be+3])&&(!$||$(Re))&&!Rt(te,Re.overlapMode))return z.push(!0),!0}}const ke=this.circleCells[A];if(ke!==null){const Ae=this.circles;for(const Te of ke)if(!Q.circle[Te]){Q.circle[Te]=!0;const be=3*Te,Re=this.circleKeys[Te];if(this._circlesCollide(Ae[be],Ae[be+1],Ae[be+2],W.x,W.y,W.radius)&&(!$||$(Re))&&!Rt(te,Re.overlapMode))return z.push(!0),!0}}}_forEachCell(l,h,y,v,A,z,D,$){const W=this._convertToXCellCoord(l),Q=this._convertToYCellCoord(h),te=this._convertToXCellCoord(y),me=this._convertToYCellCoord(v);for(let ke=W;ke<=te;ke++)for(let Ae=Q;Ae<=me;Ae++)if(A.call(this,l,h,y,v,this.xCellCount*Ae+ke,z,D,$))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,y,v,A,z){const D=v-l,$=A-h,W=y+z;return W*W>D*D+$*$}_circleAndRectCollide(l,h,y,v,A,z,D){const $=(z-v)/2,W=Math.abs(l-(v+$));if(W>$+y)return!1;const Q=(D-A)/2,te=Math.abs(h-(A+Q));if(te>Q+y)return!1;if(W<=$||te<=Q)return!0;const me=W-$,ke=te-Q;return me*me+ke*ke<=y*y}}function Yt(w,l,h,y,v){const A=s.F();return l?(s.J(A,A,[1/v,1/v,1]),h||s.ad(A,A,y.angle)):s.K(A,y.labelPlaneMatrix,w),A}function vr(w,l,h,y,v){if(l){const A=s.ae(w);return s.J(A,A,[v,v,1]),h||s.ad(A,A,-y.angle),A}return y.glCoordMatrix}function or(w,l,h){let y;h?(y=[w.x,w.y,h(w.x,w.y),1],s.af(y,y,l)):(y=[w.x,w.y,0,1],ht(y,y,l));const v=y[3];return{point:new s.P(y[0]/v,y[1]/v),signedDistanceFromCamera:v}}function Se(w,l){return .5+w/l*.5}function ne(w,l){const h=w[0]/w[3],y=w[1]/w[3];return h>=-l[0]&&h<=l[0]&&y>=-l[1]&&y<=l[1]}function ce(w,l,h,y,v,A,z,D,$,W){const Q=y?w.textSizeData:w.iconSizeData,te=s.ag(Q,h.transform.zoom),me=[256/h.width*2+1,256/h.height*2+1],ke=y?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;ke.clear();const Ae=w.lineVertexArray,Te=y?w.text.placedSymbolArray:w.icon.placedSymbolArray,be=h.transform.width/h.transform.height;let Re=!1;for(let et=0;et<Te.length;et++){const Le=Te.get(et);if(Le.hidden||Le.writingMode===s.ah.vertical&&!Re){nt(Le.numGlyphs,ke);continue}let Ve;if(Re=!1,W?(Ve=[Le.anchorX,Le.anchorY,W(Le.anchorX,Le.anchorY),1],s.af(Ve,Ve,l)):(Ve=[Le.anchorX,Le.anchorY,0,1],ht(Ve,Ve,l)),!ne(Ve,me)){nt(Le.numGlyphs,ke);continue}const rt=Se(h.transform.cameraToCenterDistance,Ve[3]),st=s.ai(Q,te,Le),ft=z?st/rt:st*rt,Ct=new s.P(Le.anchorX,Le.anchorY),wt=or(Ct,v,W).point,Bt={projections:{},offsets:{}},Ot=Oe(Le,ft,!1,D,l,v,A,w.glyphOffsetArray,Ae,ke,wt,Ct,Bt,be,$,W);Re=Ot.useVertical,(Ot.notEnoughRoom||Re||Ot.needsFlipping&&Oe(Le,ft,!0,D,l,v,A,w.glyphOffsetArray,Ae,ke,wt,Ct,Bt,be,$,W).notEnoughRoom)&&nt(Le.numGlyphs,ke)}y?w.text.dynamicLayoutVertexBuffer.updateData(ke):w.icon.dynamicLayoutVertexBuffer.updateData(ke)}function ge(w,l,h,y,v,A,z,D,$,W,Q,te,me){const ke=D.glyphStartIndex+D.numGlyphs,Ae=D.lineStartIndex,Te=D.lineStartIndex+D.lineLength,be=l.getoffsetX(D.glyphStartIndex),Re=l.getoffsetX(ke-1),et=Je(w*be,h,y,v,A,z,D.segment,Ae,Te,$,W,Q,te,me);if(!et)return null;const Le=Je(w*Re,h,y,v,A,z,D.segment,Ae,Te,$,W,Q,te,me);return Le?{first:et,last:Le}:null}function xe(w,l,h,y){return w===s.ah.horizontal&&Math.abs(h.y-l.y)>Math.abs(h.x-l.x)*y?{useVertical:!0}:(w===s.ah.vertical?l.y<h.y:l.x>h.x)?{needsFlipping:!0}:null}function Oe(w,l,h,y,v,A,z,D,$,W,Q,te,me,ke,Ae,Te){const be=l/24,Re=w.lineOffsetX*be,et=w.lineOffsetY*be;let Le;if(w.numGlyphs>1){const Ve=w.glyphStartIndex+w.numGlyphs,rt=w.lineStartIndex,st=w.lineStartIndex+w.lineLength,ft=ge(be,D,Re,et,h,Q,te,w,$,A,me,Ae,Te);if(!ft)return{notEnoughRoom:!0};const Ct=or(ft.first.point,z,Te).point,wt=or(ft.last.point,z,Te).point;if(y&&!h){const Bt=xe(w.writingMode,Ct,wt,ke);if(Bt)return Bt}Le=[ft.first];for(let Bt=w.glyphStartIndex+1;Bt<Ve-1;Bt++)Le.push(Je(be*D.getoffsetX(Bt),Re,et,h,Q,te,w.segment,rt,st,$,A,me,Ae,Te));Le.push(ft.last)}else{if(y&&!h){const rt=or(te,v,Te).point,st=w.lineStartIndex+w.segment+1,ft=new s.P($.getx(st),$.gety(st)),Ct=or(ft,v,Te),wt=Ct.signedDistanceFromCamera>0?Ct.point:$e(te,ft,rt,1,v,Te),Bt=xe(w.writingMode,rt,wt,ke);if(Bt)return Bt}const Ve=Je(be*D.getoffsetX(w.glyphStartIndex),Re,et,h,Q,te,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,$,A,me,Ae,Te);if(!Ve)return{notEnoughRoom:!0};Le=[Ve]}for(const Ve of Le)s.aj(W,Ve.point,Ve.angle);return{}}function $e(w,l,h,y,v,A){const z=or(w.add(w.sub(l)._unit()),v,A).point,D=h.sub(z);return h.add(D._mult(y/D.mag()))}function Ue(w,l){const{projectionCache:h,lineVertexArray:y,labelPlaneMatrix:v,tileAnchorPoint:A,distanceFromAnchor:z,getElevation:D,previousVertex:$,direction:W,absOffsetX:Q}=l;if(h.projections[w])return h.projections[w];const te=new s.P(y.getx(w),y.gety(w)),me=or(te,v,D);if(me.signedDistanceFromCamera>0)return h.projections[w]=me.point,me.point;const ke=w-W;return $e(z===0?A:new s.P(y.getx(ke),y.gety(ke)),te,$,Q-z+1,v,D)}function ze(w,l,h){return w._unit()._perp()._mult(l*h)}function re(w,l,h,y,v,A,z,D){const{projectionCache:$,direction:W}=D;if($.offsets[w])return $.offsets[w];const Q=h.add(l);if(w+W<y||w+W>=v)return $.offsets[w]=Q,Q;const te=Ue(w+W,D),me=ze(te.sub(h),z,W),ke=h.add(me),Ae=te.add(me);return $.offsets[w]=s.ak(A,Q,ke,Ae)||Q,$.offsets[w]}function Je(w,l,h,y,v,A,z,D,$,W,Q,te,me,ke){const Ae=y?w-l:w+l;let Te=Ae>0?1:-1,be=0;y&&(Te*=-1,be=Math.PI),Te<0&&(be+=Math.PI);let Re,et,Le=Te>0?D+z:D+z+1,Ve=v,rt=v,st=0,ft=0;const Ct=Math.abs(Ae),wt=[];let Bt;for(;st+ft<=Ct;){if(Le+=Te,Le<D||Le>=$)return null;st+=ft,rt=Ve,et=Re;const $t={projectionCache:te,lineVertexArray:W,labelPlaneMatrix:Q,tileAnchorPoint:A,distanceFromAnchor:st,getElevation:ke,previousVertex:rt,direction:Te,absOffsetX:Ct};if(Ve=Ue(Le,$t),h===0)wt.push(rt),Bt=Ve.sub(rt);else{let gn;const Sn=Ve.sub(rt);gn=Sn.mag()===0?ze(Ue(Le+Te,$t).sub(Ve),h,Te):ze(Sn,h,Te),et||(et=rt.add(gn)),Re=re(Le,gn,Ve,D,$,et,h,$t),wt.push(et),Bt=Re.sub(et)}ft=Bt.mag()}const Ot=Bt._mult((Ct-st)/ft)._add(et||rt),kn=be+Math.atan2(Ve.y-rt.y,Ve.x-rt.x);return wt.push(Ot),{point:Ot,angle:me?kn:0,path:wt}}const Qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(w,l){for(let h=0;h<w;h++){const y=l.length;l.resize(y+4),l.float32.set(Qe,3*y)}}function ht(w,l,h){const y=l[0],v=l[1];return w[0]=h[0]*y+h[4]*v+h[12],w[1]=h[1]*y+h[5]*v+h[13],w[3]=h[3]*y+h[7]*v+h[15],w}const Dt=100;class en{constructor(l,h=new Qt(l.width+200,l.height+200,25),y=new Qt(l.width+200,l.height+200,25)){this.transform=l,this.grid=h,this.ignoredGrid=y,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Dt,this.screenBottomBoundary=l.height+Dt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,h,y,v,A,z){const D=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,z),$=y*D.perspectiveRatio,W=l.x1*$+D.point.x,Q=l.y1*$+D.point.y,te=l.x2*$+D.point.x,me=l.y2*$+D.point.y;return!this.isInsideGrid(W,Q,te,me)||h!=="always"&&this.grid.hitTest(W,Q,te,me,h,A)||D.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[W,Q,te,me],offscreen:this.isOffscreen(W,Q,te,me)}}placeCollisionCircles(l,h,y,v,A,z,D,$,W,Q,te,me,ke,Ae){const Te=[],be=new s.P(h.anchorX,h.anchorY),Re=or(be,z,Ae),et=Se(this.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),Le=(Q?A/et:A*et)/s.ao,Ve=or(be,D,Ae).point,rt=ge(Le,v,h.lineOffsetX*Le,h.lineOffsetY*Le,!1,Ve,be,h,y,D,{projections:{},offsets:{}},!1,Ae);let st=!1,ft=!1,Ct=!0;if(rt){const wt=.5*me*et+ke,Bt=new s.P(-100,-100),Ot=new s.P(this.screenRightBoundary,this.screenBottomBoundary),kn=new bt,$t=rt.first,gn=rt.last;let Sn=[];for(let Mn=$t.path.length-1;Mn>=1;Mn--)Sn.push($t.path[Mn]);for(let Mn=1;Mn<gn.path.length;Mn++)Sn.push(gn.path[Mn]);const qn=2.5*wt;if($){const Mn=Sn.map(Rn=>or(Rn,$,Ae));Sn=Mn.some(Rn=>Rn.signedDistanceFromCamera<=0)?[]:Mn.map(Rn=>Rn.point)}let An=[];if(Sn.length>0){const Mn=Sn[0].clone(),Rn=Sn[0].clone();for(let jr=1;jr<Sn.length;jr++)Mn.x=Math.min(Mn.x,Sn[jr].x),Mn.y=Math.min(Mn.y,Sn[jr].y),Rn.x=Math.max(Rn.x,Sn[jr].x),Rn.y=Math.max(Rn.y,Sn[jr].y);An=Mn.x>=Bt.x&&Rn.x<=Ot.x&&Mn.y>=Bt.y&&Rn.y<=Ot.y?[Sn]:Rn.x<Bt.x||Mn.x>Ot.x||Rn.y<Bt.y||Mn.y>Ot.y?[]:s.al([Sn],Bt.x,Bt.y,Ot.x,Ot.y)}for(const Mn of An){kn.reset(Mn,.25*wt);let Rn=0;Rn=kn.length<=.5*wt?1:Math.ceil(kn.paddedLength/qn)+1;for(let jr=0;jr<Rn;jr++){const lr=jr/Math.max(Rn-1,1),ro=kn.lerp(lr),oi=ro.x+Dt,Dr=ro.y+Dt;Te.push(oi,Dr,wt,0);const si=oi-wt,io=Dr-wt,Xo=oi+wt,Is=Dr+wt;if(Ct=Ct&&this.isOffscreen(si,io,Xo,Is),ft=ft||this.isInsideGrid(si,io,Xo,Is),l!=="always"&&this.grid.hitTestCircle(oi,Dr,wt,l,te)&&(st=!0,!W))return{circles:[],offscreen:!1,collisionDetected:st}}}}return{circles:!W&&st||!ft||et<this.perspectiveRatioCutoff?[]:Te,offscreen:Ct,collisionDetected:st}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,v=1/0,A=-1/0,z=-1/0;for(const Q of l){const te=new s.P(Q.x+Dt,Q.y+Dt);y=Math.min(y,te.x),v=Math.min(v,te.y),A=Math.max(A,te.x),z=Math.max(z,te.y),h.push(te)}const D=this.grid.query(y,v,A,z).concat(this.ignoredGrid.query(y,v,A,z)),$={},W={};for(const Q of D){const te=Q.key;if($[te.bucketInstanceId]===void 0&&($[te.bucketInstanceId]={}),$[te.bucketInstanceId][te.featureIndex])continue;const me=[new s.P(Q.x1,Q.y1),new s.P(Q.x2,Q.y1),new s.P(Q.x2,Q.y2),new s.P(Q.x1,Q.y2)];s.am(h,me)&&($[te.bucketInstanceId][te.featureIndex]=!0,W[te.bucketInstanceId]===void 0&&(W[te.bucketInstanceId]=[]),W[te.bucketInstanceId].push(te.featureIndex))}return W}insertCollisionBox(l,h,y,v,A,z){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:A,collisionGroupID:z,overlapMode:h},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,y,v,A,z){const D=y?this.ignoredGrid:this.grid,$={bucketInstanceId:v,featureIndex:A,collisionGroupID:z,overlapMode:h};for(let W=0;W<l.length;W+=4)D.insertCircle($,l[W],l[W+1],l[W+2])}projectAndGetPerspectiveRatio(l,h,y,v){let A;return v?(A=[h,y,v(h,y),1],s.af(A,A,l)):(A=[h,y,0,1],ht(A,A,l)),{point:new s.P((A[0]/A[3]+1)/2*this.transform.width+Dt,(-A[1]/A[3]+1)/2*this.transform.height+Dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A[3]*.5}}isOffscreen(l,h,y,v){return y<Dt||l>=this.screenRightBoundary||v<Dt||h>this.screenBottomBoundary}isInsideGrid(l,h,y,v){return y>=0&&l<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=s.an([]);return s.H(l,l,[-100,-100,0]),l}}function mn(w,l,h){return l*(s.W/(w.tileSize*Math.pow(2,h-w.tileID.overscaledZ)))}class Cn{constructor(l,h,y,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Nn{constructor(l,h,y,v,A){this.text=new Cn(l?l.text:null,h,y,A),this.icon=new Cn(l?l.icon:null,h,v,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tr{constructor(l,h,y){this.text=l,this.icon=h,this.skipFade=y}}class Xr{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class Tn{constructor(l,h,y,v,A){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=A}}class Or{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[l]}}function ii(w,l,h,y,v){const{horizontalAlign:A,verticalAlign:z}=s.at(w);return new s.P(-(A-.5)*l+y[0]*v,-(z-.5)*h+y[1]*v)}function Mi(w,l,h,y,v,A){const{x1:z,x2:D,y1:$,y2:W,anchorPointX:Q,anchorPointY:te}=w,me=new s.P(l,h);return y&&me._rotate(v?A:-A),{x1:z+me.x,y1:$+me.y,x2:D+me.x,y2:W+me.y,anchorPointX:Q,anchorPointY:te}}class Fi{constructor(l,h,y,v,A){this.transform=l.clone(),this.terrain=h,this.collisionIndex=new en(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Or(v),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,y,v){const A=y.getBucket(h),z=y.latestFeatureIndex;if(!A||!z||h.id!==A.layerIds[0])return;const D=y.collisionBoxArray,$=A.layers[0].layout,W=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Q=y.tileSize/s.W,te=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),me=$.get("text-pitch-alignment")==="map",ke=$.get("text-rotation-alignment")==="map",Ae=mn(y,1,this.transform.zoom),Te=Yt(te,me,ke,this.transform,Ae);let be=null;if(me){const et=vr(te,me,ke,this.transform,Ae);be=s.K([],this.transform.labelPlaneMatrix,et)}this.retainedQueryData[A.bucketInstanceId]=new Tn(A.bucketInstanceId,z,A.sourceLayerIndex,A.index,y.tileID);const Re={bucket:A,layout:$,posMatrix:te,textLabelPlaneMatrix:Te,labelToScreenMatrix:be,scale:W,textPixelRatio:Q,holdingForFade:y.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.ag(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(v)for(const et of A.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:Ve,symbolInstanceEnd:rt}=et;l.push({sortKey:Le,symbolInstanceStart:Ve,symbolInstanceEnd:rt,parameters:Re})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Re})}attemptAnchorPlacement(l,h,y,v,A,z,D,$,W,Q,te,me,ke,Ae,Te,be){const Re=s.ap[l.textAnchor],et=[l.textOffset0,l.textOffset1],Le=ii(Re,y,v,et,A),Ve=this.collisionIndex.placeCollisionBox(Mi(h,Le.x,Le.y,z,D,this.transform.angle),te,$,W,Q.predicate,be);if((!Te||this.collisionIndex.placeCollisionBox(Mi(Te,Le.x,Le.y,z,D,this.transform.angle),te,$,W,Q.predicate,be).box.length!==0)&&Ve.box.length>0){let rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(rt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:et,width:y,height:v,anchor:Re,textBoxScale:A,prevAnchor:rt},this.markUsedJustification(ke,Re,me,Ae),ke.allowVerticalPlacement&&(this.markUsedOrientation(ke,Ae,me),this.placedOrientations[me.crossTileID]=Ae),{shift:Le,placedGlyphBoxes:Ve}}}placeLayerBucketPart(l,h,y){const{bucket:v,layout:A,posMatrix:z,textLabelPlaneMatrix:D,labelToScreenMatrix:$,textPixelRatio:W,holdingForFade:Q,collisionBoxArray:te,partiallyEvaluatedTextSize:me,collisionGroup:ke}=l.parameters,Ae=A.get("text-optional"),Te=A.get("icon-optional"),be=s.aq(A,"text-overlap","text-allow-overlap"),Re=be==="always",et=s.aq(A,"icon-overlap","icon-allow-overlap"),Le=et==="always",Ve=A.get("text-rotation-alignment")==="map",rt=A.get("text-pitch-alignment")==="map",st=A.get("icon-text-fit")!=="none",ft=A.get("symbol-z-order")==="viewport-y",Ct=Re&&(Le||!v.hasIconData()||Te),wt=Le&&(Re||!v.hasTextData()||Ae);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te);const Bt=this.retainedQueryData[v.bucketInstanceId].tileID,Ot=this.terrain?($t,gn)=>this.terrain.getElevation(Bt,$t,gn):null,kn=($t,gn)=>{var Sn,qn;if(h[$t.crossTileID])return;if(Q)return void(this.placements[$t.crossTileID]=new Tr(!1,!1,!1));let An=!1,Mn=!1,Rn=!0,jr=null,lr={box:null,offscreen:null},ro={box:null,offscreen:null},oi=null,Dr=null,si=null,io=0,Xo=0,Is=0;gn.textFeatureIndex?io=gn.textFeatureIndex:$t.useRuntimeCollisionCircles&&(io=$t.featureIndex),gn.verticalTextFeatureIndex&&(Xo=gn.verticalTextFeatureIndex);const Al=gn.textBox;if(Al){const Jr=Yr=>{let Br=s.ah.horizontal;if(v.allowVerticalPlacement&&!Yr&&this.prevPlacement){const go=this.prevPlacement.placedOrientations[$t.crossTileID];go&&(this.placedOrientations[$t.crossTileID]=go,Br=go,this.markUsedOrientation(v,Br,$t))}return Br},Rr=(Yr,Br)=>{if(v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&gn.verticalTextBox){for(const go of v.writingModes)if(go===s.ah.vertical?(lr=Br(),ro=lr):lr=Yr(),lr&&lr.box&&lr.box.length)break}else lr=Yr()},Er=$t.textAnchorOffsetStartIndex,mo=$t.textAnchorOffsetEndIndex;if(mo===Er){const Yr=(Br,go)=>{const Qr=this.collisionIndex.placeCollisionBox(Br,be,W,z,ke.predicate,Ot);return Qr&&Qr.box&&Qr.box.length&&(this.markUsedOrientation(v,go,$t),this.placedOrientations[$t.crossTileID]=go),Qr};Rr(()=>Yr(Al,s.ah.horizontal),()=>{const Br=gn.verticalTextBox;return v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Br?Yr(Br,s.ah.vertical):{box:null,offscreen:null}}),Jr(lr&&lr.box&&lr.box.length)}else{let Yr=s.ap[(qn=(Sn=this.prevPlacement)===null||Sn===void 0?void 0:Sn.variableOffsets[$t.crossTileID])===null||qn===void 0?void 0:qn.anchor];const Br=(Qr,qr,Uc)=>{const Xh=Qr.x2-Qr.x1,Js=Qr.y2-Qr.y1,Ys=$t.textBoxScale,Su=st&&et==="never"?qr:null;let zs={box:[],offscreen:!1},Vc=be==="never"?1:2,Kh="never";Yr&&Vc++;for(let qc=0;qc<Vc;qc++){for(let Hc=Er;Hc<mo;Hc++){const Cu=v.textAnchorOffsets.get(Hc);if(Yr&&Cu.textAnchor!==Yr)continue;const Gc=this.attemptAnchorPlacement(Cu,Qr,Xh,Js,Ys,Ve,rt,W,z,ke,Kh,$t,v,Uc,Su,Ot);if(Gc&&(zs=Gc.placedGlyphBoxes,zs&&zs.box&&zs.box.length))return An=!0,jr=Gc.shift,zs}Yr?Yr=null:Kh=be}return zs};Rr(()=>Br(Al,gn.iconBox,s.ah.horizontal),()=>{const Qr=gn.verticalTextBox;return v.allowVerticalPlacement&&!(lr&&lr.box&&lr.box.length)&&$t.numVerticalGlyphVertices>0&&Qr?Br(Qr,gn.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),lr&&(An=lr.box,Rn=lr.offscreen);const go=Jr(lr&&lr.box);if(!An&&this.prevPlacement){const Qr=this.prevPlacement.variableOffsets[$t.crossTileID];Qr&&(this.variableOffsets[$t.crossTileID]=Qr,this.markUsedJustification(v,Qr.anchor,$t,go))}}}if(oi=lr,An=oi&&oi.box&&oi.box.length>0,Rn=oi&&oi.offscreen,$t.useRuntimeCollisionCircles){const Jr=v.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),Rr=s.ai(v.textSizeData,me,Jr),Er=A.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(be,Jr,v.lineVertexArray,v.glyphOffsetArray,Rr,z,D,$,y,rt,ke.predicate,$t.collisionCircleDiameter,Er,Ot),Dr.circles.length&&Dr.collisionDetected&&!y&&s.w("Collisions detected, but collision boxes are not shown"),An=Re||Dr.circles.length>0&&!Dr.collisionDetected,Rn=Rn&&Dr.offscreen}if(gn.iconFeatureIndex&&(Is=gn.iconFeatureIndex),gn.iconBox){const Jr=Rr=>{const Er=st&&jr?Mi(Rr,jr.x,jr.y,Ve,rt,this.transform.angle):Rr;return this.collisionIndex.placeCollisionBox(Er,et,W,z,ke.predicate,Ot)};ro&&ro.box&&ro.box.length&&gn.verticalIconBox?(si=Jr(gn.verticalIconBox),Mn=si.box.length>0):(si=Jr(gn.iconBox),Mn=si.box.length>0),Rn=Rn&&si.offscreen}const Ps=Ae||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,Ko=Te||$t.numIconVertices===0;if(Ps||Ko?Ko?Ps||(Mn=Mn&&An):An=Mn&&An:Mn=An=Mn&&An,An&&oi&&oi.box&&this.collisionIndex.insertCollisionBox(oi.box,be,A.get("text-ignore-placement"),v.bucketInstanceId,ro&&ro.box&&Xo?Xo:io,ke.ID),Mn&&si&&this.collisionIndex.insertCollisionBox(si.box,et,A.get("icon-ignore-placement"),v.bucketInstanceId,Is,ke.ID),Dr&&(An&&this.collisionIndex.insertCollisionCircles(Dr.circles,be,A.get("text-ignore-placement"),v.bucketInstanceId,io,ke.ID),y)){const Jr=v.bucketInstanceId;let Rr=this.collisionCircleArrays[Jr];Rr===void 0&&(Rr=this.collisionCircleArrays[Jr]=new Xr);for(let Er=0;Er<Dr.circles.length;Er+=4)Rr.circles.push(Dr.circles[Er+0]),Rr.circles.push(Dr.circles[Er+1]),Rr.circles.push(Dr.circles[Er+2]),Rr.circles.push(Dr.collisionDetected?1:0)}if($t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new Tr(An||Ct,Mn||wt,Rn||v.justReloaded),h[$t.crossTileID]=!0};if(ft){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=v.getSortedSymbolIndexes(this.transform.angle);for(let gn=$t.length-1;gn>=0;--gn){const Sn=$t[gn];kn(v.symbolInstances.get(Sn),v.collisionArrays[Sn])}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)kn(v.symbolInstances.get($t),v.collisionArrays[$t]);if(y&&v.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[v.bucketInstanceId];s.ar($t.invProjMatrix,z),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,h,y,v){let A;A=v===s.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[s.as(h)];const z=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const D of z)D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=A>=0&&D!==A?0:y.crossTileID)}markUsedOrientation(l,h,y){const v=h===s.ah.horizontal||h===s.ah.horizontalOnly?h:0,A=h===s.ah.vertical?h:0,z=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const D of z)l.text.placedSymbolArray.get(D).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(l):1,A=h?h.opacities:{},z=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const $ in this.placements){const W=this.placements[$],Q=A[$];Q?(this.opacities[$]=new Nn(Q,v,W.text,W.icon),y=y||W.text!==Q.text.placed||W.icon!==Q.icon.placed):(this.opacities[$]=new Nn(null,v,W.text,W.icon,W.skipFade),y=y||W.text||W.icon)}for(const $ in A){const W=A[$];if(!this.opacities[$]){const Q=new Nn(W,v,!1,!1);Q.isHidden()||(this.opacities[$]=Q,y=y||W.text.placed||W.icon.placed)}}for(const $ in z)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=z[$]);for(const $ in D)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=D[$]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const y={};for(const v of h){const A=v.getBucket(l);A&&v.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,y,v.collisionBoxArray)}}updateBucketOpacities(l,h,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],A=v.layout,z=new Nn(null,0,!1,!1,!0),D=A.get("text-allow-overlap"),$=A.get("icon-allow-overlap"),W=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Q=A.get("text-rotation-alignment")==="map",te=A.get("text-pitch-alignment")==="map",me=A.get("icon-text-fit")!=="none",ke=new Nn(null,0,D&&($||!l.hasIconData()||A.get("icon-optional")),$&&(D||!l.hasTextData()||A.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const Ae=(Te,be,Re)=>{for(let et=0;et<be/4;et++)Te.opacityVertexArray.emplaceBack(Re);Te.hasVisibleVertices=Te.hasVisibleVertices||Re!==tl};for(let Te=0;Te<l.symbolInstances.length;Te++){const be=l.symbolInstances.get(Te),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:et,crossTileID:Le}=be;let Ve=this.opacities[Le];h[Le]?Ve=z:Ve||(Ve=ke,this.opacities[Le]=Ve),h[Le]=!0;const rt=be.numIconVertices>0,st=this.placedOrientations[be.crossTileID],ft=st===s.ah.vertical,Ct=st===s.ah.horizontal||st===s.ah.horizontalOnly;if(Re>0||et>0){const wt=Oi(Ve.text);Ae(l.text,Re,ft?tl:wt),Ae(l.text,et,Ct?tl:wt);const Bt=Ve.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(l.text.placedSymbolArray.get($t).hidden=Bt||ft?1:0)}),be.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=Bt||Ct?1:0);const Ot=this.variableOffsets[be.crossTileID];Ot&&this.markUsedJustification(l,Ot.anchor,be,st);const kn=this.placedOrientations[be.crossTileID];kn&&(this.markUsedJustification(l,"left",be,kn),this.markUsedOrientation(l,kn,be))}if(rt){const wt=Oi(Ve.icon),Bt=!(me&&be.verticalPlacedIconSymbolIndex&&ft);be.placedIconSymbolIndex>=0&&(Ae(l.icon,be.numIconVertices,Bt?wt:tl),l.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(Ae(l.icon,be.numVerticalIconVertices,Bt?tl:wt),l.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const wt=l.collisionArrays[Te];if(wt){let Bt=new s.P(0,0);if(wt.textBox||wt.verticalTextBox){let kn=!0;if(W){const $t=this.variableOffsets[Le];$t?(Bt=ii($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),Q&&Bt._rotate(te?this.transform.angle:-this.transform.angle)):kn=!1}wt.textBox&&mi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!kn||ft,Bt.x,Bt.y),wt.verticalTextBox&&mi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!kn||Ct,Bt.x,Bt.y)}const Ot=!!(!Ct&&wt.verticalIconBox);wt.iconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,Ot,me?Bt.x:0,me?Bt.y:0),wt.verticalIconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!Ot,me?Bt.x:0,me?Bt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Te.invProjMatrix,l.placementViewportMatrix=Te.viewportMatrix,l.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function mi(w,l,h,y,v){w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0)}const qo=Math.pow(2,25),hh=Math.pow(2,24),bp=Math.pow(2,17),sr=Math.pow(2,16),cc=Math.pow(2,9),fc=Math.pow(2,8),eo=Math.pow(2,1);function Oi(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,h=Math.floor(127*w.opacity);return h*qo+l*hh+h*bp+l*sr+h*cc+l*fc+h*eo+l}const tl=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,h,y,v,A){const z=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(z,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort((D,$)=>D.sortKey-$.sortKey));this._currentPartIndex<z.length;)if(h.placeLayerBucketPart(z[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,A())return!0;return!1}}class po{constructor(l,h,y,v,A,z,D,$){this.placement=new Fi(l,h,z,D,$),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(l,h,y){const v=_.now(),A=()=>!this._forceFullPlacement&&_.now()-v>2;for(;this._currentPlacementIndex>=0;){const z=h[l[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=D)&&(!z.maxzoom||z.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new ho(z)),this._inProgressLayer.continuePlacement(y[z.source],this.placement,this._showCollisionBoxes,z,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const pa=512/s.W/2;class Nl{constructor(l,h,y){this.tileID=l,this.bucketInstanceId=y,this._symbolsByKey={};const v=new Map;for(let A=0;A<h.length;A++){const z=h.get(A),D=z.key,$=v.get(D);$?$.push(z):v.set(D,[z])}for(const[A,z]of v){const D={positions:z.map($=>({x:Math.floor($.anchorX*pa),y:Math.floor($.anchorY*pa)})),crossTileIDs:z.map($=>$.crossTileID)};if(D.positions.length>128){const $=new s.au(D.positions.length,16,Uint16Array);for(const{x:W,y:Q}of D.positions)$.add(W,Q);$.finish(),delete D.positions,D.index=$}this._symbolsByKey[A]=D}}getScaledCoordinates(l,h){const{x:y,y:v,z:A}=this.tileID.canonical,{x:z,y:D,z:$}=h.canonical,W=pa/Math.pow(2,$-A),Q=(D*s.W+l.anchorY)*W,te=v*s.W*pa;return{x:Math.floor((z*s.W+l.anchorX)*W-y*s.W*pa),y:Math.floor(Q-te)}}findMatches(l,h,y){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let A=0;A<l.length;A++){const z=l.get(A);if(z.crossTileID)continue;const D=this._symbolsByKey[z.key];if(!D)continue;const $=this.getScaledCoordinates(z,h);if(D.index){const W=D.index.range($.x-v,$.y-v,$.x+v,$.y+v).sort();for(const Q of W){const te=D.crossTileIDs[Q];if(!y[te]){y[te]=!0,z.crossTileID=te;break}}}else if(D.positions)for(let W=0;W<D.positions.length;W++){const Q=D.positions[W],te=D.crossTileIDs[W];if(Math.abs(Q.x-$.x)<=v&&Math.abs(Q.y-$.y)<=v&&!y[te]){y[te]=!0,z.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Kr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const y in this.indexes){const v=this.indexes[y],A={};for(const z in v){const D=v[z];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),A[D.tileID.key]=D}this.indexes[y]=A}this.lng=l}addBucket(l,h,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<h.symbolInstances.length;A++)h.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const z=this.indexes[A];if(Number(A)>l.overscaledZ)for(const D in z){const $=z[D];$.tileID.isChildOf(l)&&$.findMatches(h.symbolInstances,l,v)}else{const D=z[l.scaledTo(Number(A)).key];D&&D.findMatches(h.symbolInstances,l,v)}}for(let A=0;A<h.symbolInstances.length;A++){const z=h.symbolInstances.get(A);z.crossTileID||(z.crossTileID=y.generate(),v[z.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Nl(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const y of h.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let h=!1;for(const y in this.indexes){const v=this.indexes[y];for(const A in v)l[v[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,v[A]),delete v[A],h=!0)}return h}}class Ss{constructor(){this.layerIndexes={},this.crossTileIDs=new Kr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,y){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new nl);let A=!1;const z={};v.handleWrapJump(y);for(const D of h){const $=D.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,$,this.crossTileIDs)&&(A=!0),z[$.bucketInstanceId]=!0)}return v.removeStaleBuckets(z)&&(A=!0),A}pruneUnusedLayers(l){const h={};l.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const zr=(w,l)=>s.t(w,l&&l.filter(h=>h.identifier!=="source.canvas")),jl=s.av();class to extends s.E{constructor(l,h={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const v=this.sourceCaches[y].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[y].reload()}},this.map=l,this.dispatcher=new un(jt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new ve,this.imageManager.setEventedParent(this),this.glyphManager=new Ne(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new Ss,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ax()),xt().on(Cr,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.sourceCaches[y.sourceId];if(!v)return;const A=v.getSource();if(A&&A.vectorLayerIds)for(const z in this._layers){const D=this._layers[z];D.source===A.id&&this._validateLayer(D)}})}loadURL(l,h={},y){this.fire(new s.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const v=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,s.h(v,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,h,y)}).catch(A=>{this._loadStyleRequest=null,A&&this.fire(new s.j(A))})}loadJSON(l,h={},y){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(l,h,y)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(jl,{validate:!1})}_load(l,h,y){var v;const A=h.transformStyle?h.transformStyle(y,l):l;if(!h.validate||!zr(this,s.x(A))){this._loaded=!0,this.stylesheet=A;for(const z in A.sources)this.addSource(z,A.sources[z],{validate:!1});A.sprite?this._loadSprite(A.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(A.glyphs),this._createLayers(),this.light=new Ke(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const l=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of l){const y=s.az(h);y.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=y}}_loadSprite(l,h=!1,y=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(A,z,D,$){return s._(this,void 0,void 0,function*(){const W=Ee(A),Q=D>1?"@2x":"",te={},me={};for(const{id:ke,url:Ae}of W){const Te=z.transformRequest(z.normalizeSpriteURL(Ae,Q,".json"),"SpriteJSON");te[ke]=s.h(Te,$);const be=z.transformRequest(z.normalizeSpriteURL(Ae,Q,".png"),"SpriteImage");me[ke]=O.getImage(be,$)}return yield Promise.all([...Object.values(te),...Object.values(me)]),function(ke,Ae){return s._(this,void 0,void 0,function*(){const Te={};for(const be in ke){Te[be]={};const Re=_.getImageCanvasContext((yield Ae[be]).data),et=(yield ke[be]).data;for(const Le in et){const{width:Ve,height:rt,x:st,y:ft,sdf:Ct,pixelRatio:wt,stretchX:Bt,stretchY:Ot,content:kn}=et[Le];Te[be][Le]={data:null,pixelRatio:wt,sdf:Ct,stretchX:Bt,stretchY:Ot,content:kn,spriteData:{width:Ve,height:rt,x:st,y:ft,context:Re}}}}return Te})}(te,me)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(A=>{if(this._spriteRequest=null,A)for(const z in A){this._spritesImagesIds[z]=[];const D=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter($=>!($ in A)):[];for(const $ of D)this.imageManager.removeImage($),this._changedImages[$]=!0;for(const $ in A[z]){const W=z==="default"?$:`${z}:${$}`;this._spritesImagesIds[z].push(W),W in this.imageManager.images?this.imageManager.updateImage(W,A[z][$],!1):this.imageManager.addImage(W,A[z][$]),h&&(this._changedImages[W]=!0)}}}).catch(A=>{this._spriteRequest=null,v=A,this.fire(new s.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(l){const h=this.sourceCaches[l.source];if(!h)return;const y=l.sourceLayer;if(!y)return;const v=h.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.j(new Error(`Source layer "${y}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const h=this._serializedAllLayers();if(!l||l.length===0)return Object.values(h);const y=[];for(const v of l)h[v]&&y.push(h[v]);return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const h=Object.keys(this._layers);for(const y of h){const v=this._layers[y];v.type!=="custom"&&(l[y]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const h=this._changed;if(h){const v=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(v.length||A.length)&&this._updateWorkerLayers(v,A);for(const z in this._updatedSources){const D=this._updatedSources[z];if(D==="reload")this._reloadSource(z);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const z in this._updatedPaintProps)this._layers[z].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const y={};for(const v in this.sourceCaches){const A=this.sourceCaches[v];y[v]=A.used,A.used=!1}for(const v of this._order){const A=this._layers[v];A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const v in y){const A=this.sourceCaches[v];!!y[v]!=!!A.used&&A.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,h={}){var y;this._checkLoaded();const v=this.serialize();if(l=h.transformStyle?h.transformStyle(v,l):l,((y=h.validate)===null||y===void 0||y)&&zr(this,s.x(l)))return!1;(l=s.aA(l)).layers=s.ay(l.layers);const A=s.aB(v,l),z=this._getOperationsToPerform(A);if(z.unimplemented.length>0)throw new Error(`Unimplemented: ${z.unimplemented.join(", ")}.`);if(z.operations.length===0)return!1;for(const D of z.operations)D();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const h=[],y=[];for(const v of l)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":h.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":h.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":h.push(()=>{});break;default:y.push(v.command)}return{operations:h,unimplemented:y}}addImage(l,h){if(this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,h),this._afterImageUpdated(l)}updateImage(l,h){this.imageManager.updateImage(l,h)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,h,y={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.x.source,`sources.${l}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=this.sourceCaches[l]=new $n(l,h,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===l)return this.fire(new s.j(new Error(`Source "${l}" cannot be removed while layer "${y}" is using it.`)));const h=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],h.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,h){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const y=this.sourceCaches[l].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(h),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,h,y={}){this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new s.j(new Error(`Layer "${v}" already exists on this map.`)));let A;if(l.type==="custom"){if(zr(this,s.aC(l)))return;A=s.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=s.aA(l),l=s.e(l,{source:v})),this._validate(s.x.layer,`layers.${v}`,l,{arrayIndex:-1},y))return;A=s.az(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:v}})}const z=h?this._order.indexOf(h):this._order.length;if(h&&z===-1)this.fire(new s.j(new Error(`Cannot add layer "${v}" before non-existing layer "${h}".`)));else{if(this._order.splice(z,0,v),this._layerOrderChanged=!0,this._layers[v]=A,this._removedLayers[v]&&A.source&&A.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(l,h){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===h)return;const y=this._order.indexOf(l);this._order.splice(y,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new s.j(new Error(`Cannot move layer "${l}" before non-existing layer "${h}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const h=this._layers[l];if(!h)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${l}".`)));h.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,h,y){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===h&&v.maxzoom===y||(h!=null&&(v.minzoom=h),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,h,y={}){this._checkLoaded();const v=this.getLayer(l);if(v){if(!s.aD(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.x.filter,`layers.${v.id}.filter`,h,null,y)||(v.filter=s.aA(h),this._updateLayer(v)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.aA(this.getLayer(l).filter)}setLayoutProperty(l,h,y,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getLayoutProperty(h),y)||(A.setLayoutProperty(h,y,v),this._updateLayer(A)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,h){const y=this.getLayer(l);if(y)return y.getLayoutProperty(h);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,h,y,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getPaintProperty(h),y)||(A.setPaintProperty(h,y,v)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,h){return this.getLayer(l).getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const y=l.source,v=l.sourceLayer,A=this.sourceCaches[y];if(A===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const z=A.getSource().type;z==="geojson"&&v?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):z!=="vector"||v?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),A.setFeatureState(v,l.id,h)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,h){this._checkLoaded();const y=l.source,v=this.sourceCaches[y];if(v===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const A=v.getSource().type,z=A==="vector"?l.sourceLayer:void 0;A!=="vector"||z?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(z,l.id,h):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const h=l.source,y=l.sourceLayer,v=this.sourceCaches[h];if(v!==void 0)return v.getSource().type!=="vector"||y?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,l.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.aE(this.sourceCaches,A=>A.serialize()),h=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet;return s.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:h,terrain:y},A=>A!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const h=z=>this._layers[z].type==="fill-extrusion",y={},v=[];for(let z=this._order.length-1;z>=0;z--){const D=this._order[z];if(h(D)){y[D]=z;for(const $ of l){const W=$[D];if(W)for(const Q of W)v.push(Q)}}}v.sort((z,D)=>D.intersectionZ-z.intersectionZ);const A=[];for(let z=this._order.length-1;z>=0;z--){const D=this._order[z];if(h(D))for(let $=v.length-1;$>=0;$--){const W=v[$].feature;if(y[W.layer.id]<z)break;A.push(W),v.pop()}else for(const $ of l){const W=$[D];if(W)for(const Q of W)A.push(Q.feature)}}return A}queryRenderedFeatures(l,h,y){h&&h.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const $=this._layers[D];if(!$)return this.fire(new s.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[$.source]=!0}}const A=[];h.availableImages=this._availableImages;const z=this._serializedAllLayers();for(const D in this.sourceCaches)h.layers&&!v[D]||A.push(pn(this.sourceCaches[D],this._layers,z,l,h,y));return this.placement&&A.push(function(D,$,W,Q,te,me,ke){const Ae={},Te=me.queryRenderedSymbols(Q),be=[];for(const Re of Object.keys(Te).map(Number))be.push(ke[Re]);be.sort(yn);for(const Re of be){const et=Re.featureIndex.lookupSymbolFeatures(Te[Re.bucketInstanceId],$,Re.bucketIndex,Re.sourceLayerIndex,te.filter,te.layers,te.availableImages,D);for(const Le in et){const Ve=Ae[Le]=Ae[Le]||[],rt=et[Le];rt.sort((st,ft)=>{const Ct=Re.featureSortOrder;if(Ct){const wt=Ct.indexOf(st.featureIndex);return Ct.indexOf(ft.featureIndex)-wt}return ft.featureIndex-st.featureIndex});for(const st of rt)Ve.push(st)}}for(const Re in Ae)Ae[Re].forEach(et=>{const Le=et.feature,Ve=W[D[Re].source].getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=Ve});return Ae}(this._layers,z,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,h){h&&h.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",h.filter,null,h);const y=this.sourceCaches[l];return y?function(v,A){const z=v.getRenderableIds().map(W=>v.getTileByID(W)),D=[],$={};for(let W=0;W<z.length;W++){const Q=z[W],te=Q.tileID.canonical.key;$[te]||($[te]=!0,Q.querySourceFeatures(D,A))}return D}(y,h):[]}getLight(){return this.light.getLight()}setLight(l,h={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const z in l)if(!s.aD(l[z],y[z])){v=!0;break}if(!v)return;const A={now:_.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(A)}_validate(l,h,y,v,A={}){return(!A||A.validate!==!1)&&zr(this,l.call(s.x,s.e({key:h,style:this.serialize(),value:y,styleSpec:s.v},v)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),xt().off(Cr,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const y=this.sourceCaches[h];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const h in this.sourceCaches)this.sourceCaches[h].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,h,y,v,A=!1){let z=!1,D=!1;const $={};for(const W of this._order){const Q=this._layers[W];if(Q.type!=="symbol")continue;if(!$[Q.source]){const me=this.sourceCaches[Q.source];$[Q.source]=me.getRenderableIds(!0).map(ke=>me.getTileByID(ke)).sort((ke,Ae)=>Ae.tileID.overscaledZ-ke.tileID.overscaledZ||(ke.tileID.isLessThan(Ae.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(Q,$[Q.source],l.center.lng);z=z||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),l.zoom))&&(this.pauseablePlacement=new po(l,this.map.terrain,this._order,A,h,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),D=!0),z&&this.pauseablePlacement.placement.setStale()),D||z)for(const W of this._order){const Q=this._layers[W];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,$[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,h){return s._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,h.icons),y})}getGlyphs(l,h){return s._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(h.stacks),v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,h={}){this._checkLoaded(),l&&this._validate(s.x.glyphs,"glyphs",l,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,h,y={},v){this._checkLoaded();const A=[{id:l,url:h}],z=[...Ee(this.stylesheet.sprite),...A];this._validate(s.x.sprite,"sprite",z,null,y)||(this.stylesheet.sprite=z,this._loadSprite(A,!0,v))}removeSprite(l){this._checkLoaded();const h=Ee(this.stylesheet.sprite);if(h.find(y=>y.id===l)){if(this._spritesImagesIds[l])for(const y of this._spritesImagesIds[l])this.imageManager.removeImage(y),this._changedImages[y]=!0;h.splice(h.findIndex(y=>y.id===l),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ee(this.stylesheet.sprite)}setSprite(l,h={},y){this._checkLoaded(),l&&this._validate(s.x.sprite,"sprite",l,null,h)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,y):(this._unloadSprite(),y&&y(null)))}}var Ul=s.X([{name:"a_pos",type:"Int16",components:2}]),Ho="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const rl={prelude:ar(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ar(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ar(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ar(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ar("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ar(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ar("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ar("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ar(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ar(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ar(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ar(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ar(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ar(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ar(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ar(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ar(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ar(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ar("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ho),terrainDepth:ar("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ho),terrainCoords:ar("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ho)};function ar(w,l){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=l.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=A?A.concat(v):v,D={};return{fragmentSource:w=w.replace(h,($,W,Q,te,me)=>(D[me]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_${me}
varying ${Q} ${te} ${me};
#else
uniform ${Q} ${te} u_${me};
#endif
`:`
#ifdef HAS_UNIFORM_u_${me}
    ${Q} ${te} ${me} = u_${me};
#endif
`)),vertexSource:l=l.replace(h,($,W,Q,te,me)=>{const ke=te==="float"?"vec2":"vec4",Ae=me.match(/color/)?"color":ke;return D[me]?W==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${Q} ${ke} a_${me};
varying ${Q} ${te} ${me};
#else
uniform ${Q} ${te} u_${me};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = a_${me};
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = unpack_mix_${Ae}(a_${me}, u_${me}_t);
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${Q} ${ke} a_${me};
#else
uniform ${Q} ${te} u_${me};
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${Q} ${te} ${me} = a_${me};
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${Q} ${te} ${me} = unpack_mix_${Ae}(a_${me}, u_${me}_t);
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`}),staticAttributes:y,staticUniforms:z}}class Vl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,h,y,v,A,z,D,$,W){this.context=l;let Q=this.boundPaintVertexBuffers.length!==v.length;for(let te=0;!Q&&te<v.length;te++)this.boundPaintVertexBuffers[te]!==v[te]&&(Q=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||Q||this.boundIndexBuffer!==A||this.boundVertexOffset!==z||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==$||this.boundDynamicVertexBuffer3!==W?this.freshBind(h,y,v,A,z,D,$,W):(l.bindVertexArray.set(this.vao),D&&D.bind(),A&&A.dynamicDraw&&A.bind(),$&&$.bind(),W&&W.bind())}freshBind(l,h,y,v,A,z,D,$){const W=l.numAttributes,Q=this.context,te=Q.gl;this.vao&&this.destroy(),this.vao=Q.createVertexArray(),Q.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=z,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=$,h.enableAttributes(te,l);for(const me of y)me.enableAttributes(te,l);z&&z.enableAttributes(te,l),D&&D.enableAttributes(te,l),$&&$.enableAttributes(te,l),h.bind(),h.setVertexAttribPointers(te,l,A);for(const me of y)me.bind(),me.setVertexAttribPointers(te,l,A);z&&(z.bind(),z.setVertexAttribPointers(te,l,A)),v&&v.bind(),D&&(D.bind(),D.setVertexAttribPointers(te,l,A)),$&&($.bind(),$.setVertexAttribPointers(te,l,A)),Q.currentNumAttributes=W}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ma(w){const l=[];for(let h=0;h<w.length;h++){if(w[h]===null)continue;const y=w[h].split(" ");l.push(y.pop())}return l}class Cs{constructor(l,h,y,v,A,z){const D=l.gl;this.program=D.createProgram();const $=ma(h.staticAttributes),W=y?y.getBinderAttributes():[],Q=$.concat(W),te=rl.prelude.staticUniforms?ma(rl.prelude.staticUniforms):[],me=h.staticUniforms?ma(h.staticUniforms):[],ke=y?y.getBinderUniforms():[],Ae=te.concat(me).concat(ke),Te=[];for(const st of Ae)Te.indexOf(st)<0&&Te.push(st);const be=y?y.defines():[];A&&be.push("#define OVERDRAW_INSPECTOR;"),z&&be.push("#define TERRAIN3D;");const Re=be.concat(rl.prelude.fragmentSource,h.fragmentSource).join(`
`),et=be.concat(rl.prelude.vertexSource,h.vertexSource).join(`
`),Le=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Le,Re),D.compileShader(Le),!D.getShaderParameter(Le,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Le)}`);D.attachShader(this.program,Le);const Ve=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ve,et),D.compileShader(Ve),!D.getShaderParameter(Ve,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ve)}`);D.attachShader(this.program,Ve),this.attributes={};const rt={};this.numAttributes=Q.length;for(let st=0;st<this.numAttributes;st++)Q[st]&&(D.bindAttribLocation(this.program,st,Q[st]),this.attributes[Q[st]]=st);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ve),D.deleteShader(Le);for(let st=0;st<Te.length;st++){const ft=Te[st];if(ft&&!rt[ft]){const Ct=D.getUniformLocation(this.program,ft);Ct&&(rt[ft]=Ct)}}this.fixedUniforms=v(l,rt),this.terrainUniforms=((st,ft)=>({u_depth:new s.aG(st,ft.u_depth),u_terrain:new s.aG(st,ft.u_terrain),u_terrain_dim:new s.aH(st,ft.u_terrain_dim),u_terrain_matrix:new s.aI(st,ft.u_terrain_matrix),u_terrain_unpack:new s.aJ(st,ft.u_terrain_unpack),u_terrain_exaggeration:new s.aH(st,ft.u_terrain_exaggeration)}))(l,rt),this.binderUniforms=y?y.getUniforms(l,rt):[]}draw(l,h,y,v,A,z,D,$,W,Q,te,me,ke,Ae,Te,be,Re,et){const Le=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(y),l.setStencilMode(v),l.setColorMode(A),l.setCullFace(z),$){l.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,$.depthTexture),l.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,$.texture);for(const rt in this.terrainUniforms)this.terrainUniforms[rt].set($[rt])}for(const rt in this.fixedUniforms)this.fixedUniforms[rt].set(D[rt]);Te&&Te.setUniforms(l,this.binderUniforms,ke,{zoom:Ae});let Ve=0;switch(h){case Le.LINES:Ve=2;break;case Le.TRIANGLES:Ve=3;break;case Le.LINE_STRIP:Ve=1}for(const rt of me.get()){const st=rt.vaos||(rt.vaos={});(st[W]||(st[W]=new Vl)).bind(l,this,Q,Te?Te.getPaintVertexBuffers():[],te,rt.vertexOffset,be,Re,et),Le.drawElements(h,rt.primitiveLength*Ve,Le.UNSIGNED_SHORT,rt.primitiveOffset*Ve*2)}}}function ql(w,l,h){const y=1/mn(h,1,l.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),A=h.tileSize*Math.pow(2,l.transform.tileZoom)/v,z=A*(h.tileID.canonical.x+h.tileID.wrap*v),D=A*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[y,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[z>>16,D>>16],u_pixel_coord_lower:[65535&z,65535&D]}}const il=(w,l,h,y)=>{const v=l.style.light,A=v.properties.get("position"),z=[A.x,A.y,A.z],D=function(){var W=new s.A(9);return s.A!=Float32Array&&(W[1]=0,W[2]=0,W[3]=0,W[5]=0,W[6]=0,W[7]=0),W[0]=1,W[4]=1,W[8]=1,W}();v.properties.get("anchor")==="viewport"&&function(W,Q){var te=Math.sin(Q),me=Math.cos(Q);W[0]=me,W[1]=te,W[2]=0,W[3]=-te,W[4]=me,W[5]=0,W[6]=0,W[7]=0,W[8]=1}(D,-l.transform.angle),function(W,Q,te){var me=Q[0],ke=Q[1],Ae=Q[2];W[0]=me*te[0]+ke*te[3]+Ae*te[6],W[1]=me*te[1]+ke*te[4]+Ae*te[7],W[2]=me*te[2]+ke*te[5]+Ae*te[8]}(z,z,D);const $=v.properties.get("color");return{u_matrix:w,u_lightpos:z,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+h,u_opacity:y}},wp=(w,l,h,y,v,A,z)=>s.e(il(w,l,h,y),ql(A,l,z),{u_height_factor:-Math.pow(2,v.overscaledZ)/z.tileSize/8}),dh=w=>({u_matrix:w}),Hl=(w,l,h,y)=>s.e(dh(w),ql(h,l,y)),xp=(w,l)=>({u_matrix:w,u_world:l}),ph=(w,l,h,y,v)=>s.e(Hl(w,l,h,y),{u_world:v}),Ap=(w,l,h,y)=>{const v=w.transform;let A,z;if(y.paint.get("circle-pitch-alignment")==="map"){const D=mn(h,1,v.zoom);A=!0,z=[D,D]}else A=!1,z=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,h,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:z}},mh=(w,l,h)=>{const y=mn(h,1,l.zoom),v=Math.pow(2,l.zoom-h.tileID.overscaledZ),A=h.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[l.pixelsToGLUnits[0]/(y*v),l.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:A}},gh=(w,l,h=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:h}),Gl=w=>({u_matrix:w}),_h=(w,l,h,y)=>({u_matrix:w,u_extrude_scale:mn(l,1,h),u_intensity:y});function yh(w,l){const h=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new s.Y(0,y/h).toLngLat().lat,new s.Y(0,(y+1)/h).toLngLat().lat]}const Wl=(w,l,h,y)=>{const v=w.transform;return{u_matrix:ol(w,l,h,y),u_ratio:1/mn(l,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},vh=(w,l,h,y,v)=>s.e(Wl(w,l,h,v),{u_image:0,u_image_height:y}),Vs=(w,l,h,y,v)=>{const A=w.transform,z=no(l,A);return{u_matrix:ol(w,l,h,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/mn(l,1,A.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[z,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Zl=(w,l,h,y,v,A)=>{const z=w.lineAtlas,D=no(l,w.transform),$=h.layout.get("line-cap")==="round",W=z.getDash(y.from,$),Q=z.getDash(y.to,$),te=W.width*v.fromScale,me=Q.width*v.toScale;return s.e(Wl(w,l,h,A),{u_patternscale_a:[D/te,-W.height/2],u_patternscale_b:[D/me,-Q.height/2],u_sdfgamma:z.width/(256*Math.min(te,me)*w.pixelRatio)/2,u_image:0,u_tex_y_a:W.y,u_tex_y_b:Q.y,u_mix:v.t})};function no(w,l){return 1/mn(w,1,l.tileZoom)}function ol(w,l,h,y){return w.translatePosMatrix(y?y.posMatrix:l.tileID.posMatrix,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Xl=(w,l,h,y,v)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:h,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(z=v.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(A=v.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:sl(v.paint.get("raster-hue-rotate"))};var A,z};function sl(w){w*=Math.PI/180;const l=Math.sin(w),h=Math.cos(w);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const al=(w,l,h,y,v,A,z,D,$,W)=>{const Q=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Q.width/Q.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:z,u_coord_matrix:D,u_is_text:+$,u_pitch_with_map:+y,u_texsize:W,u_texture:0}},ll=(w,l,h,y,v,A,z,D,$,W,Q)=>{const te=v.transform;return s.e(al(w,l,h,y,v,A,z,D,$,W),{u_gamma_scale:y?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+Q})},ul=(w,l,h,y,v,A,z,D,$,W)=>s.e(ll(w,l,h,y,v,A,z,D,!0,$,!0),{u_texsize_icon:W,u_texture_icon:1}),kp=(w,l,h)=>({u_matrix:w,u_opacity:l,u_color:h}),Sp=(w,l,h,y,v,A)=>s.e(function(z,D,$,W){const Q=$.imageManager.getPattern(z.from.toString()),te=$.imageManager.getPattern(z.to.toString()),{width:me,height:ke}=$.imageManager.getPixelSize(),Ae=Math.pow(2,W.tileID.overscaledZ),Te=W.tileSize*Math.pow(2,$.transform.tileZoom)/Ae,be=Te*(W.tileID.canonical.x+W.tileID.wrap*Ae),Re=Te*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[me,ke],u_mix:D.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/mn(W,1,$.transform.tileZoom),u_pixel_coord_upper:[be>>16,Re>>16],u_pixel_coord_lower:[65535&be,65535&Re]}}(y,A,h,v),{u_matrix:w,u_opacity:l}),bh={fillExtrusion:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_opacity:new s.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_height_factor:new s.aH(w,l.u_height_factor),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade),u_opacity:new s.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,l.u_scale_with_map),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_matrix:new s.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_overscale_factor:new s.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_inv_matrix:new s.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_viewport_size:new s.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new s.aM(w,l.u_color),u_matrix:new s.aI(w,l.u_matrix),u_overlay:new s.aG(w,l.u_overlay),u_overlay_scale:new s.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new s.aH(w,l.u_extrude_scale),u_intensity:new s.aH(w,l.u_intensity),u_matrix:new s.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_color_ramp:new s.aG(w,l.u_color_ramp),u_opacity:new s.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_latrange:new s.aL(w,l.u_latrange),u_light:new s.aL(w,l.u_light),u_shadow:new s.aM(w,l.u_shadow),u_highlight:new s.aM(w,l.u_highlight),u_accent:new s.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_dimension:new s.aL(w,l.u_dimension),u_zoom:new s.aH(w,l.u_zoom),u_unpack:new s.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_image:new s.aG(w,l.u_image),u_image_height:new s.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texsize:new s.aL(w,l.u_texsize),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_image:new s.aG(w,l.u_image),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_patternscale_a:new s.aL(w,l.u_patternscale_a),u_patternscale_b:new s.aL(w,l.u_patternscale_b),u_sdfgamma:new s.aH(w,l.u_sdfgamma),u_image:new s.aG(w,l.u_image),u_tex_y_a:new s.aH(w,l.u_tex_y_a),u_tex_y_b:new s.aH(w,l.u_tex_y_b),u_mix:new s.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_tl_parent:new s.aL(w,l.u_tl_parent),u_scale_parent:new s.aH(w,l.u_scale_parent),u_buffer_scale:new s.aH(w,l.u_buffer_scale),u_fade_t:new s.aH(w,l.u_fade_t),u_opacity:new s.aH(w,l.u_opacity),u_image0:new s.aG(w,l.u_image0),u_image1:new s.aG(w,l.u_image1),u_brightness_low:new s.aH(w,l.u_brightness_low),u_brightness_high:new s.aH(w,l.u_brightness_high),u_saturation_factor:new s.aH(w,l.u_saturation_factor),u_contrast_factor:new s.aH(w,l.u_contrast_factor),u_spin_weights:new s.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texsize_icon:new s.aL(w,l.u_texsize_icon),u_texture:new s.aG(w,l.u_texture),u_texture_icon:new s.aG(w,l.u_texture_icon),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_color:new s.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_image:new s.aG(w,l.u_image),u_pattern_tl_a:new s.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,l.u_pattern_br_b),u_texsize:new s.aL(w,l.u_texsize),u_mix:new s.aH(w,l.u_mix),u_pattern_size_a:new s.aL(w,l.u_pattern_size_a),u_pattern_size_b:new s.aL(w,l.u_pattern_size_b),u_scale_a:new s.aH(w,l.u_scale_a),u_scale_b:new s.aH(w,l.u_scale_b),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_terrain_coords_id:new s.aH(w,l.u_terrain_coords_id),u_ele_delta:new s.aH(w,l.u_ele_delta)})};class Cp{constructor(l,h,y){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Kl{constructor(l,h,y,v){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let y=0;y<this.attributes.length;y++){const v=h.attributes[this.attributes[y].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,h,y){for(let v=0;v<this.attributes.length;v++){const A=this.attributes[v],z=h.attributes[A.name];z!==void 0&&l.vertexAttribPointer(z,A.components,l[qs[A.type]],!1,this.itemSize,A.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ei=new WeakMap;function Ai(w){var l;if(Ei.has(w))return Ei.get(w);{const h=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Ei.set(w,h),h}}class Jn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jl extends Jn{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Yl extends Jn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class hc extends Jn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class dc extends Jn{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ql extends Jn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class pc extends Jn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class mc extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class eu extends Jn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class wh extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class xh extends Jn{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class ga extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class Tp extends Jn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Mp extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Ep extends Jn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Lp extends Jn{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ip extends Jn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Pp extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class gc extends Jn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class tu extends Jn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class _c extends Jn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class yc extends Jn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class _a extends Jn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ah extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class kh extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class vc extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Hs extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Sh extends Jn{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ya extends Jn{getDefault(){return null}set(l){var h;if(l===this.current&&!this.dirty)return;const y=this.gl;Ai(y)?y.bindVertexArray(l):(h=y.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class va extends Jn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ch extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class bc extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Wn extends Jn{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class nu extends Wn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class zp extends Wn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Th extends Wn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class cl{constructor(l,h,y,v,A){this.context=l,this.width=h,this.height=y;const z=l.gl,D=this.framebuffer=z.createFramebuffer();if(this.colorAttachment=new nu(l,D),v)this.depthAttachment=A?new Th(l,D):new zp(l,D);else if(A)throw new Error("Stencil cannot be set without depth");if(z.checkFramebufferStatus(z.FRAMEBUFFER)!==z.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){const y=this.depthAttachment.get();y&&l.deleteRenderbuffer(y)}l.deleteFramebuffer(this.framebuffer)}}class Gr{constructor(l,h,y){this.blendFunction=l,this.blendColor=h,this.mask=y}}Gr.Replace=[1,0],Gr.disabled=new Gr(Gr.Replace,s.aO.transparent,[!1,!1,!1,!1]),Gr.unblended=new Gr(Gr.Replace,s.aO.transparent,[!0,!0,!0,!0]),Gr.alphaBlended=new Gr([1,771],s.aO.transparent,[!0,!0,!0,!0]);class Dp{constructor(l){var h,y;if(this.gl=l,this.clearColor=new Jl(this),this.clearDepth=new Yl(this),this.clearStencil=new hc(this),this.colorMask=new dc(this),this.depthMask=new Ql(this),this.stencilMask=new pc(this),this.stencilFunc=new mc(this),this.stencilOp=new eu(this),this.stencilTest=new wh(this),this.depthRange=new xh(this),this.depthTest=new ga(this),this.depthFunc=new Tp(this),this.blend=new Mp(this),this.blendFunc=new Ep(this),this.blendColor=new Lp(this),this.blendEquation=new Ip(this),this.cullFace=new Pp(this),this.cullFaceSide=new gc(this),this.frontFace=new tu(this),this.program=new _c(this),this.activeTexture=new yc(this),this.viewport=new _a(this),this.bindFramebuffer=new Ah(this),this.bindRenderbuffer=new kh(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new Hs(this),this.bindElementBuffer=new Sh(this),this.bindVertexArray=new ya(this),this.pixelStoreUnpack=new va(this),this.pixelStoreUnpackPremultiplyAlpha=new Ch(this),this.pixelStoreUnpackFlipY=new bc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),Ai(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=l.RGBA16F)!==null&&h!==void 0?h:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(y=l.RGB16F)!==null&&y!==void 0?y:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h){return new Cp(this,l,h)}createVertexBuffer(l,h,y){return new Kl(this,l,h,y)}createRenderbuffer(l,h,y){const v=this.gl,A=v.createRenderbuffer();return this.bindRenderbuffer.set(A),v.renderbufferStorage(v.RENDERBUFFER,l,h,y),this.bindRenderbuffer.set(null),A}createFramebuffer(l,h,y,v){return new cl(this,l,h,y,v)}clear({color:l,depth:h,stencil:y}){const v=this.gl;let A=0;l&&(A|=v.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(A|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(A|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.aD(l.blendFunction,Gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return Ai(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var h;return Ai(this.gl)?this.gl.deleteVertexArray(l):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Vn{constructor(l,h,y){this.func=l,this.mask=h,this.range=y}}Vn.ReadOnly=!1,Vn.ReadWrite=!0,Vn.disabled=new Vn(519,Vn.ReadOnly,[0,1]);const wc=7680;class wr{constructor(l,h,y,v,A,z){this.test=l,this.ref=h,this.mask=y,this.fail=v,this.depthFail=A,this.pass=z}}wr.disabled=new wr({func:519,mask:0},0,0,wc,wc,wc);class pr{constructor(l,h,y){this.enable=l,this.mode=h,this.frontFace=y}}let Gs;function ru(w,l,h,y,v,A,z){const D=w.context,$=D.gl,W=w.useProgram("collisionBox"),Q=[];let te=0,me=0;for(let Le=0;Le<y.length;Le++){const Ve=y[Le],rt=l.getTile(Ve),st=rt.getBucket(h);if(!st)continue;let ft=Ve.posMatrix;v[0]===0&&v[1]===0||(ft=w.translatePosMatrix(Ve.posMatrix,rt,v,A));const Ct=z?st.textCollisionBox:st.iconCollisionBox,wt=st.collisionCircleArray;if(wt.length>0){const Bt=s.F(),Ot=ft;s.aP(Bt,st.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(Bt,Bt,st.placementViewportMatrix),Q.push({circleArray:wt,circleOffset:me,transform:Ot,invTransform:Bt,coord:Ve}),te+=wt.length/4,me=te}Ct&&W.draw(D,$.LINES,Vn.disabled,wr.disabled,w.colorModeForRenderPass(),pr.disabled,mh(ft,w.transform,rt),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),h.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,w.transform.zoom,null,null,Ct.collisionVertexBuffer)}if(!z||!Q.length)return;const ke=w.useProgram("collisionCircle"),Ae=new s.aQ;Ae.resize(4*te),Ae._trim();let Te=0;for(const Le of Q)for(let Ve=0;Ve<Le.circleArray.length/4;Ve++){const rt=4*Ve,st=Le.circleArray[rt+0],ft=Le.circleArray[rt+1],Ct=Le.circleArray[rt+2],wt=Le.circleArray[rt+3];Ae.emplace(Te++,st,ft,Ct,wt,0),Ae.emplace(Te++,st,ft,Ct,wt,1),Ae.emplace(Te++,st,ft,Ct,wt,2),Ae.emplace(Te++,st,ft,Ct,wt,3)}(!Gs||Gs.length<2*te)&&(Gs=function(Le){const Ve=2*Le,rt=new s.aS;rt.resize(Ve),rt._trim();for(let st=0;st<Ve;st++){const ft=6*st;rt.uint16[ft+0]=4*st+0,rt.uint16[ft+1]=4*st+1,rt.uint16[ft+2]=4*st+2,rt.uint16[ft+3]=4*st+2,rt.uint16[ft+4]=4*st+3,rt.uint16[ft+5]=4*st+0}return rt}(te));const be=D.createIndexBuffer(Gs,!0),Re=D.createVertexBuffer(Ae,s.aR.members,!0);for(const Le of Q){const Ve={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(et=w.transform).cameraToCenterDistance,u_viewport_size:[et.width,et.height]};ke.draw(D,$.TRIANGLES,Vn.disabled,wr.disabled,w.colorModeForRenderPass(),pr.disabled,Ve,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Le.coord),h.id,Re,be,s.$.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,w.transform.zoom,null,null,null)}var et;Re.destroy(),be.destroy()}pr.disabled=new pr(!1,1029,2305),pr.backCCW=new pr(!0,1029,2305);const xc=s.an(new Float32Array(16));function Mh(w,l,h,y,v,A){const{horizontalAlign:z,verticalAlign:D}=s.at(w);return new s.P((-(z-.5)*l/v+y[0])*A,(-(D-.5)*h/v+y[1])*A)}function iu(w,l,h,y,v,A,z,D,$,W,Q){const te=w.text.placedSymbolArray,me=w.text.dynamicLayoutVertexArray,ke=w.icon.dynamicLayoutVertexArray,Ae={};me.clear();for(let Te=0;Te<te.length;Te++){const be=te.get(Te),Re=be.hidden||!be.crossTileID||w.allowVerticalPlacement&&!be.placedOrientation?null:y[be.crossTileID];if(Re){const et=new s.P(be.anchorX,be.anchorY),Le=or(et,h?z:A,Q),Ve=Se(v.cameraToCenterDistance,Le.signedDistanceFromCamera);let rt=s.ai(w.textSizeData,$,be)*Ve/s.ao;h&&(rt*=w.tilePixelRatio/D);const{width:st,height:ft,anchor:Ct,textOffset:wt,textBoxScale:Bt}=Re,Ot=Mh(Ct,st,ft,wt,Bt,rt),kn=h?or(et.add(Ot),A,Q).point:Le.point.add(l?Ot.rotate(-v.angle):Ot),$t=w.allowVerticalPlacement&&be.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let gn=0;gn<be.numGlyphs;gn++)s.aj(me,kn,$t);W&&be.associatedIconIndex>=0&&(Ae[be.associatedIconIndex]={shiftedAnchor:kn,angle:$t})}else nt(be.numGlyphs,me)}if(W){ke.clear();const Te=w.icon.placedSymbolArray;for(let be=0;be<Te.length;be++){const Re=Te.get(be);if(Re.hidden)nt(Re.numGlyphs,ke);else{const et=Ae[be];if(et)for(let Le=0;Le<Re.numGlyphs;Le++)s.aj(ke,et.shiftedAnchor,et.angle);else nt(Re.numGlyphs,ke)}}w.icon.dynamicLayoutVertexBuffer.updateData(ke)}w.text.dynamicLayoutVertexBuffer.updateData(me)}function ou(w,l,h){return h.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function su(w,l,h,y,v,A,z,D,$,W,Q,te){const me=w.context,ke=me.gl,Ae=w.transform,Te=D==="map",be=$==="map",Re=D!=="viewport"&&h.layout.get("symbol-placement")!=="point",et=Te&&!be&&!Re,Le=!h.layout.get("symbol-sort-key").isConstant();let Ve=!1;const rt=w.depthModeForSublayer(0,Vn.ReadOnly),st=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ft=[];for(const Ct of y){const wt=l.getTile(Ct),Bt=wt.getBucket(h);if(!Bt)continue;const Ot=v?Bt.text:Bt.icon;if(!Ot||!Ot.segments.get().length||!Ot.hasVisibleVertices)continue;const kn=Ot.programConfigurations.get(h.id),$t=v||Bt.sdfIcons,gn=v?Bt.textSizeData:Bt.iconSizeData,Sn=be||Ae.pitch!==0,qn=w.useProgram(ou($t,v,Bt),kn),An=s.ag(gn,Ae.zoom),Mn=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ct);let Rn,jr,lr,ro,oi=[0,0],Dr=null;if(v)jr=wt.glyphAtlasTexture,lr=ke.LINEAR,Rn=wt.glyphAtlasTexture.size,Bt.iconsInText&&(oi=wt.imageAtlasTexture.size,Dr=wt.imageAtlasTexture,ro=Sn||w.options.rotating||w.options.zooming||gn.kind==="composite"||gn.kind==="camera"?ke.LINEAR:ke.NEAREST);else{const Yr=h.layout.get("icon-size").constantOr(0)!==1||Bt.iconsNeedLinear;jr=wt.imageAtlasTexture,lr=$t||w.options.rotating||w.options.zooming||Yr||Sn?ke.LINEAR:ke.NEAREST,Rn=wt.imageAtlasTexture.size}const si=mn(wt,1,w.transform.zoom),io=Yt(Ct.posMatrix,be,Te,w.transform,si),Xo=vr(Ct.posMatrix,be,Te,w.transform,si),Is=st&&Bt.hasTextData(),Al=h.layout.get("icon-text-fit")!=="none"&&Is&&Bt.hasIconData();if(Re){const Yr=w.style.map.terrain?(go,Qr)=>w.style.map.terrain.getElevation(Ct,go,Qr):null,Br=h.layout.get("text-rotation-alignment")==="map";ce(Bt,Ct.posMatrix,w,v,io,Xo,be,W,Br,Yr)}const Ps=w.translatePosMatrix(Ct.posMatrix,wt,A,z),Ko=Re||v&&st||Al?xc:io,Jr=w.translatePosMatrix(Xo,wt,A,z,!0),Rr=$t&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Er;Er=$t?Bt.iconsInText?ul(gn.kind,An,et,be,w,Ps,Ko,Jr,Rn,oi):ll(gn.kind,An,et,be,w,Ps,Ko,Jr,v,Rn,!0):al(gn.kind,An,et,be,w,Ps,Ko,Jr,v,Rn);const mo={program:qn,buffers:Ot,uniformValues:Er,atlasTexture:jr,atlasTextureIcon:Dr,atlasInterpolation:lr,atlasInterpolationIcon:ro,isSDF:$t,hasHalo:Rr};if(Le&&Bt.canOverlap){Ve=!0;const Yr=Ot.segments.get();for(const Br of Yr)ft.push({segments:new s.$([Br]),sortKey:Br.sortKey,state:mo,terrainData:Mn})}else ft.push({segments:Ot.segments,sortKey:0,state:mo,terrainData:Mn})}Ve&&ft.sort((Ct,wt)=>Ct.sortKey-wt.sortKey);for(const Ct of ft){const wt=Ct.state;if(me.activeTexture.set(ke.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,ke.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(me.activeTexture.set(ke.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,ke.CLAMP_TO_EDGE)),wt.isSDF){const Bt=wt.uniformValues;wt.hasHalo&&(Bt.u_is_halo=1,Eh(wt.buffers,Ct.segments,h,w,wt.program,rt,Q,te,Bt,Ct.terrainData)),Bt.u_is_halo=0}Eh(wt.buffers,Ct.segments,h,w,wt.program,rt,Q,te,wt.uniformValues,Ct.terrainData)}}function Eh(w,l,h,y,v,A,z,D,$,W){const Q=y.context;v.draw(Q,Q.gl.TRIANGLES,A,z,D,pr.disabled,$,W,h.id,w.layoutVertexBuffer,w.indexBuffer,l,h.paint,y.transform.zoom,w.programConfigurations.get(h.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function au(w,l,h,y,v){if(!h||!y||!y.imageAtlas)return;const A=y.imageAtlas.patternPositions;let z=A[h.to.toString()],D=A[h.from.toString()];if(!z&&D&&(z=D),!D&&z&&(D=z),!z||!D){const $=v.getPaintProperty(l);z=A[$],D=A[$]}z&&D&&w.setConstantPatternPositions(z,D)}function Lh(w,l,h,y,v,A,z){const D=w.context.gl,$="fill-pattern",W=h.paint.get($),Q=W&&W.constantOr(1),te=h.getCrossfadeParameters();let me,ke,Ae,Te,be;z?(ke=Q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",me=D.LINES):(ke=Q?"fillPattern":"fill",me=D.TRIANGLES);const Re=W.constantOr(null);for(const et of y){const Le=l.getTile(et);if(Q&&!Le.patternsLoaded())continue;const Ve=Le.getBucket(h);if(!Ve)continue;const rt=Ve.programConfigurations.get(h.id),st=w.useProgram(ke,rt),ft=w.style.map.terrain&&w.style.map.terrain.getTerrainData(et);Q&&(w.context.activeTexture.set(D.TEXTURE0),Le.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),rt.updatePaintBuffers(te)),au(rt,$,Re,Le,h);const Ct=ft?et:null,wt=w.translatePosMatrix(Ct?Ct.posMatrix:et.posMatrix,Le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(z){Te=Ve.indexBuffer2,be=Ve.segments2;const Bt=[D.drawingBufferWidth,D.drawingBufferHeight];Ae=ke==="fillOutlinePattern"&&Q?ph(wt,w,te,Le,Bt):xp(wt,Bt)}else Te=Ve.indexBuffer,be=Ve.segments,Ae=Q?Hl(wt,w,te,Le):dh(wt);st.draw(w.context,me,v,w.stencilModeForClipping(et),A,pr.disabled,Ae,ft,h.id,Ve.layoutVertexBuffer,Te,be,h.paint,w.transform.zoom,rt)}}function lu(w,l,h,y,v,A,z){const D=w.context,$=D.gl,W="fill-extrusion-pattern",Q=h.paint.get(W),te=Q.constantOr(1),me=h.getCrossfadeParameters(),ke=h.paint.get("fill-extrusion-opacity"),Ae=Q.constantOr(null);for(const Te of y){const be=l.getTile(Te),Re=be.getBucket(h);if(!Re)continue;const et=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Te),Le=Re.programConfigurations.get(h.id),Ve=w.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Le);te&&(w.context.activeTexture.set($.TEXTURE0),be.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Le.updatePaintBuffers(me)),au(Le,W,Ae,be,h);const rt=w.translatePosMatrix(Te.posMatrix,be,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),st=h.paint.get("fill-extrusion-vertical-gradient"),ft=te?wp(rt,w,st,ke,Te,me,be):il(rt,w,st,ke);Ve.draw(D,D.gl.TRIANGLES,v,A,z,pr.backCCW,ft,et,h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,h.paint,w.transform.zoom,Le,w.style.map.terrain&&Re.centroidVertexBuffer)}}function uu(w,l,h,y,v,A,z){const D=w.context,$=D.gl,W=h.fbo;if(!W)return;const Q=w.useProgram("hillshade"),te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);D.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,W.colorAttachment.get()),Q.draw(D,$.TRIANGLES,v,A,z,pr.disabled,((me,ke,Ae,Te)=>{const be=Ae.paint.get("hillshade-shadow-color"),Re=Ae.paint.get("hillshade-highlight-color"),et=Ae.paint.get("hillshade-accent-color");let Le=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Le-=me.transform.angle);const Ve=!me.options.moving;return{u_matrix:Te?Te.posMatrix:me.transform.calculatePosMatrix(ke.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:yh(0,ke.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),Le],u_shadow:be,u_highlight:Re,u_accent:et}})(w,h,y,te?l:null),te,y.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function Ac(w,l,h,y,v,A){const z=w.context,D=z.gl,$=l.dem;if($&&$.data){const W=$.dim,Q=$.stride,te=$.getPixels();if(z.activeTexture.set(D.TEXTURE1),z.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(Q),l.demTexture){const ke=l.demTexture;ke.update(te,{premultiply:!1}),ke.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else l.demTexture=new ee(z,te,D.RGBA,{premultiply:!1}),l.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);z.activeTexture.set(D.TEXTURE0);let me=l.fbo;if(!me){const ke=new ee(z,{width:W,height:W,data:null},D.RGBA);ke.bind(D.LINEAR,D.CLAMP_TO_EDGE),me=l.fbo=z.createFramebuffer(W,W,!0,!1),me.colorAttachment.set(ke.texture)}z.bindFramebuffer.set(me.framebuffer),z.viewport.set([0,0,W,W]),w.useProgram("hillshadePrepare").draw(z,D.TRIANGLES,y,v,A,pr.disabled,((ke,Ae)=>{const Te=Ae.stride,be=s.F();return s.aN(be,0,s.W,-s.W,0,0,1),s.H(be,be,[0,-s.W,0]),{u_matrix:be,u_image:1,u_dimension:[Te,Te],u_zoom:ke.overscaledZ,u_unpack:Ae.getUnpackVector()}})(l.tileID,$),null,h.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Ih(w,l,h,y,v,A){const z=y.paint.get("raster-fade-duration");if(!A&&z>0){const D=_.now(),$=(D-w.timeAdded)/z,W=l?(D-l.timeAdded)/z:-1,Q=h.getSource(),te=v.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),me=!l||Math.abs(l.tileID.overscaledZ-te)>Math.abs(w.tileID.overscaledZ-te),ke=me&&w.refreshedUponExpiration?1:s.ac(me?$:1-W,0,1);return w.refreshedUponExpiration&&$>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-ke}:{opacity:ke,mix:0}}return{opacity:1,mix:0}}const Ph=new s.aO(1,0,0,1),cu=new s.aO(0,1,0,1),kc=new s.aO(0,0,1,1),Rp=new s.aO(1,0,1,1),zh=new s.aO(0,1,1,1);function $r(w,l,h,y){Li(w,0,l+h/2,w.transform.width,h,y)}function Ts(w,l,h,y){Li(w,l-h/2,0,h,w.transform.height,y)}function Li(w,l,h,y,v,A){const z=w.context,D=z.gl;D.enable(D.SCISSOR_TEST),D.scissor(l*w.pixelRatio,h*w.pixelRatio,y*w.pixelRatio,v*w.pixelRatio),z.clear({color:A}),D.disable(D.SCISSOR_TEST)}function Sc(w,l,h){const y=w.context,v=y.gl,A=h.posMatrix,z=w.useProgram("debug"),D=Vn.disabled,$=wr.disabled,W=w.colorModeForRenderPass(),Q="$debug",te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(h);y.activeTexture.set(v.TEXTURE0);const me=l.getTileByID(h.key).latestRawTileData,ke=Math.floor((me&&me.byteLength||0)/1024),Ae=l.getTile(h).tileSize,Te=512/Math.min(Ae,512)*(h.overscaledZ/w.transform.zoom)*.5;let be=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(be+=` => ${h.overscaledZ}`),function(Re,et){Re.initDebugOverlayCanvas();const Le=Re.debugOverlayCanvas,Ve=Re.context.gl,rt=Re.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Le.width,Le.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(et,5,5),rt.strokeText(et,5,5),Re.debugOverlayTexture.update(Le),Re.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(w,`${be} ${ke}kB`),z.draw(y,v.TRIANGLES,D,$,Gr.alphaBlended,pr.disabled,gh(A,s.aO.transparent,Te),null,Q,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),z.draw(y,v.LINE_STRIP,D,$,W,pr.disabled,gh(A,s.aO.red),te,Q,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function fu(w,l,h){const y=w.context,v=y.gl,A=w.colorModeForRenderPass(),z=new Vn(v.LEQUAL,Vn.ReadWrite,w.depthRangeFor3D),D=w.useProgram("terrain"),$=l.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,w.width,w.height]);for(const W of h){const Q=w.renderToTexture.getTexture(W),te=l.getTerrainData(W.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Q.texture);const me={u_matrix:w.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};D.draw(y,v.TRIANGLES,z,wr.disabled,A,pr.backCCW,me,te,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}class Dh{constructor(l,h){this.context=new Dp(l),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=$n.maxUnderzooming+$n.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ss}resize(l,h,y){if(this.width=Math.floor(l*y),this.height=Math.floor(h*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,h=new s.aV;h.emplaceBack(0,0),h.emplaceBack(s.W,0),h.emplaceBack(0,s.W),h.emplaceBack(s.W,s.W),this.tileExtentBuffer=l.createVertexBuffer(h,Ul.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const y=new s.aV;y.emplaceBack(0,0),y.emplaceBack(s.W,0),y.emplaceBack(0,s.W),y.emplaceBack(s.W,s.W),this.debugBuffer=l.createVertexBuffer(y,Ul.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const v=new s.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(s.W,0,s.W,0),v.emplaceBack(0,s.W,0,s.W),v.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=l.createVertexBuffer(v,lt.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const A=new s.aV;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(A,Ul.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const z=new s.aW;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(z);const D=new s.aX;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D);const $=this.context.gl;this.stencilClearMode=new wr({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO)}clearStencil(){const l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=s.F();s.aN(y,0,this.width,this.height,0,0,1),s.J(y,y,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,Vn.disabled,this.stencilClearMode,Gr.disabled,pr.disabled,Gl(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,h){if(this.currentStencilSource===l.source||!l.isTileClipped()||!h||!h.length)return;this.currentStencilSource=l.source;const y=this.context,v=y.gl;this.nextStencilID+h.length>256&&this.clearStencil(),y.setColorMode(Gr.disabled),y.setDepthMode(Vn.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of h){const D=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z);A.draw(y,v.TRIANGLES,Vn.disabled,new wr({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Gr.disabled,pr.disabled,Gl(z.posMatrix),$,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new wr({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){const h=this.context.gl;return new wr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,y=l.sort((z,D)=>D.overscaledZ-z.overscaledZ),v=y[y.length-1].overscaledZ,A=y[0].overscaledZ-v+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const z={};for(let D=0;D<A;D++)z[D+v]=new wr({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=A,[z,y]}return[{[v]:wr.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Gr([l.CONSTANT_COLOR,l.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gr.unblended:Gr.alphaBlended}depthModeForSublayer(l,h,y){if(!this.opaquePassEnabledForLayer())return Vn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Vn(y||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const y=this.style._order,v=this.style.sourceCaches,A={},z={},D={};for(const $ in v){const W=v[$];W.used&&W.prepare(this.context),A[$]=W.getVisibleCoordinates(),z[$]=A[$].slice().reverse(),D[$]=W.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<y.length;$++)if(this.style._layers[y[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of y){const W=this.style._layers[$];if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;const Q=z[W.source];(W.type==="custom"||Q.length)&&this.renderLayer(this,v[W.source],W,Q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[y[this.currentLayer]],W=v[$.source],Q=A[$.source];this._renderTileClippingMasks($,Q),this.renderLayer(this,W,$,Q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const $=this.style._layers[y[this.currentLayer]],W=v[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($))continue;const Q=($.type==="symbol"?D:z)[$.source];this._renderTileClippingMasks($,A[$.source]),this.renderLayer(this,W,$,Q)}if(this.options.showTileBoundaries){const $=function(W,Q){let te=null;const me=Object.values(W._layers).flatMap(be=>be.source&&!be.isHidden(Q)?[W.sourceCaches[be.source]]:[]),ke=me.filter(be=>be.getSource().type==="vector"),Ae=me.filter(be=>be.getSource().type!=="vector"),Te=be=>{(!te||te.getSource().maxzoom<be.getSource().maxzoom)&&(te=be)};return ke.forEach(be=>Te(be)),te||Ae.forEach(be=>Te(be)),te}(this.style,this.transform.zoom);$&&function(W,Q,te){for(let me=0;me<te.length;me++)Sc(W,Q,te[me])}(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const W=$.transform.padding;$r($,$.transform.height-(W.top||0),3,Ph),$r($,W.bottom||0,3,cu),Ts($,W.left||0,3,kc),Ts($,$.transform.width-(W.right||0),3,Rp);const Q=$.transform.centerPoint;(function(te,me,ke,Ae){Li(te,me-1,ke-10,2,20,Ae),Li(te,me-10,ke-1,20,2,Ae)})($,Q.x,$.transform.height-Q.y,zh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=l?!s.aY(h,y):!s.aZ(h,y)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(s.a_(h,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,z){const D=A.context,$=D.gl,W=Gr.unblended,Q=new Vn($.LEQUAL,Vn.ReadWrite,[0,1]),te=z.getTerrainMesh(),me=z.sourceCache.getRenderableTiles(),ke=A.useProgram("terrainDepth");D.bindFramebuffer.set(z.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1});for(const Ae of me){const Te=z.getTerrainData(Ae.tileID),be={u_matrix:A.transform.calculatePosMatrix(Ae.tileID.toUnwrapped()),u_ele_delta:z.getMeshFrameDelta(A.transform.zoom)};ke.draw(D,$.TRIANGLES,Q,wr.disabled,W,pr.backCCW,be,Te,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,z){const D=A.context,$=D.gl,W=Gr.unblended,Q=new Vn($.LEQUAL,Vn.ReadWrite,[0,1]),te=z.getTerrainMesh(),me=z.getCoordsTexture(),ke=z.sourceCache.getRenderableTiles(),Ae=A.useProgram("terrainCoords");D.bindFramebuffer.set(z.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1}),z.coordsIndex=[];for(const Te of ke){const be=z.getTerrainData(Te.tileID);D.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,me.texture);const Re={u_matrix:A.transform.calculatePosMatrix(Te.tileID.toUnwrapped()),u_terrain_coords_id:(255-z.coordsIndex.length)/255,u_texture:0,u_ele_delta:z.getMeshFrameDelta(A.transform.zoom)};Ae.draw(D,$.TRIANGLES,Q,wr.disabled,W,pr.backCCW,Re,be,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),z.coordsIndex.push(Te.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}renderLayer(l,h,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(A,z,D,$,W){if(A.renderPass!=="translucent")return;const Q=wr.disabled,te=A.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(me,ke,Ae,Te,be,Re,et){const Le=ke.transform,Ve=be==="map",rt=Re==="map";for(const st of me){const ft=Te.getTile(st),Ct=ft.getBucket(Ae);if(!Ct||!Ct.text||!Ct.text.segments.get().length)continue;const wt=s.ag(Ct.textSizeData,Le.zoom),Bt=mn(ft,1,ke.transform.zoom),Ot=Yt(st.posMatrix,rt,Ve,ke.transform,Bt),kn=Ae.layout.get("icon-text-fit")!=="none"&&Ct.hasIconData();if(wt){const $t=Math.pow(2,Le.zoom-ft.tileID.overscaledZ);iu(Ct,Ve,rt,et,Le,Ot,st.posMatrix,$t,wt,kn,ke.style.map.terrain?(gn,Sn)=>ke.style.map.terrain.getElevation(st,gn,Sn):null)}}}($,A,D,z,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),W),D.paint.get("icon-opacity").constantOr(1)!==0&&su(A,z,D,$,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Q,te),D.paint.get("text-opacity").constantOr(1)!==0&&su(A,z,D,$,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Q,te),z.map.showCollisionBoxes&&(ru(A,z,D,$,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),!0),ru(A,z,D,$,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),!1))})(l,h,y,v,this.style.placement.variableOffsets);break;case"circle":(function(A,z,D,$){if(A.renderPass!=="translucent")return;const W=D.paint.get("circle-opacity"),Q=D.paint.get("circle-stroke-width"),te=D.paint.get("circle-stroke-opacity"),me=!D.layout.get("circle-sort-key").isConstant();if(W.constantOr(1)===0&&(Q.constantOr(1)===0||te.constantOr(1)===0))return;const ke=A.context,Ae=ke.gl,Te=A.depthModeForSublayer(0,Vn.ReadOnly),be=wr.disabled,Re=A.colorModeForRenderPass(),et=[];for(let Le=0;Le<$.length;Le++){const Ve=$[Le],rt=z.getTile(Ve),st=rt.getBucket(D);if(!st)continue;const ft=st.programConfigurations.get(D.id),Ct=A.useProgram("circle",ft),wt=st.layoutVertexBuffer,Bt=st.indexBuffer,Ot=A.style.map.terrain&&A.style.map.terrain.getTerrainData(Ve),kn={programConfiguration:ft,program:Ct,layoutVertexBuffer:wt,indexBuffer:Bt,uniformValues:Ap(A,Ve,rt,D),terrainData:Ot};if(me){const $t=st.segments.get();for(const gn of $t)et.push({segments:new s.$([gn]),sortKey:gn.sortKey,state:kn})}else et.push({segments:st.segments,sortKey:0,state:kn})}me&&et.sort((Le,Ve)=>Le.sortKey-Ve.sortKey);for(const Le of et){const{programConfiguration:Ve,program:rt,layoutVertexBuffer:st,indexBuffer:ft,uniformValues:Ct,terrainData:wt}=Le.state;rt.draw(ke,Ae.TRIANGLES,Te,be,Re,pr.disabled,Ct,wt,D.id,st,ft,Le.segments,D.paint,A.transform.zoom,Ve)}})(l,h,y,v);break;case"heatmap":(function(A,z,D,$){if(D.paint.get("heatmap-opacity")!==0)if(A.renderPass==="offscreen"){const W=A.context,Q=W.gl,te=wr.disabled,me=new Gr([Q.ONE,Q.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(ke,Ae,Te){const be=ke.gl;ke.activeTexture.set(be.TEXTURE1),ke.viewport.set([0,0,Ae.width/4,Ae.height/4]);let Re=Te.heatmapFbo;if(Re)be.bindTexture(be.TEXTURE_2D,Re.colorAttachment.get()),ke.bindFramebuffer.set(Re.framebuffer);else{const et=be.createTexture();be.bindTexture(be.TEXTURE_2D,et),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),Re=Te.heatmapFbo=ke.createFramebuffer(Ae.width/4,Ae.height/4,!1,!1),function(Le,Ve,rt,st){var ft,Ct;const wt=Le.gl,Bt=(ft=Le.HALF_FLOAT)!==null&&ft!==void 0?ft:wt.UNSIGNED_BYTE,Ot=(Ct=Le.RGBA16F)!==null&&Ct!==void 0?Ct:wt.RGBA;wt.texImage2D(wt.TEXTURE_2D,0,Ot,Ve.width/4,Ve.height/4,0,wt.RGBA,Bt,null),st.colorAttachment.set(rt)}(ke,Ae,et,Re)}})(W,A,D),W.clear({color:s.aO.transparent});for(let ke=0;ke<$.length;ke++){const Ae=$[ke];if(z.hasRenderableParent(Ae))continue;const Te=z.getTile(Ae),be=Te.getBucket(D);if(!be)continue;const Re=be.programConfigurations.get(D.id),et=A.useProgram("heatmap",Re),{zoom:Le}=A.transform;et.draw(W,Q.TRIANGLES,Vn.disabled,te,me,pr.disabled,_h(Ae.posMatrix,Te,Le,D.paint.get("heatmap-intensity")),null,D.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,D.paint,A.transform.zoom,Re)}W.viewport.set([0,0,A.width,A.height])}else A.renderPass==="translucent"&&(A.context.setColorMode(A.colorModeForRenderPass()),function(W,Q){const te=W.context,me=te.gl,ke=Q.heatmapFbo;if(!ke)return;te.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,ke.colorAttachment.get()),te.activeTexture.set(me.TEXTURE1);let Ae=Q.colorRampTexture;Ae||(Ae=Q.colorRampTexture=new ee(te,Q.colorRamp,me.RGBA)),Ae.bind(me.LINEAR,me.CLAMP_TO_EDGE),W.useProgram("heatmapTexture").draw(te,me.TRIANGLES,Vn.disabled,wr.disabled,W.colorModeForRenderPass(),pr.disabled,((Te,be,Re,et)=>{const Le=s.F();s.aN(Le,0,Te.width,Te.height,0,0,1);const Ve=Te.context.gl;return{u_matrix:Le,u_world:[Ve.drawingBufferWidth,Ve.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:be.paint.get("heatmap-opacity")}})(W,Q),null,Q.id,W.viewportBuffer,W.quadTriangleIndexBuffer,W.viewportSegments,Q.paint,W.transform.zoom)}(A,D))})(l,h,y,v);break;case"line":(function(A,z,D,$){if(A.renderPass!=="translucent")return;const W=D.paint.get("line-opacity"),Q=D.paint.get("line-width");if(W.constantOr(1)===0||Q.constantOr(1)===0)return;const te=A.depthModeForSublayer(0,Vn.ReadOnly),me=A.colorModeForRenderPass(),ke=D.paint.get("line-dasharray"),Ae=D.paint.get("line-pattern"),Te=Ae.constantOr(1),be=D.paint.get("line-gradient"),Re=D.getCrossfadeParameters(),et=Te?"linePattern":ke?"lineSDF":be?"lineGradient":"line",Le=A.context,Ve=Le.gl;let rt=!0;for(const st of $){const ft=z.getTile(st);if(Te&&!ft.patternsLoaded())continue;const Ct=ft.getBucket(D);if(!Ct)continue;const wt=Ct.programConfigurations.get(D.id),Bt=A.context.program.get(),Ot=A.useProgram(et,wt),kn=rt||Ot.program!==Bt,$t=A.style.map.terrain&&A.style.map.terrain.getTerrainData(st),gn=Ae.constantOr(null);if(gn&&ft.imageAtlas){const An=ft.imageAtlas,Mn=An.patternPositions[gn.to.toString()],Rn=An.patternPositions[gn.from.toString()];Mn&&Rn&&wt.setConstantPatternPositions(Mn,Rn)}const Sn=$t?st:null,qn=Te?Vs(A,ft,D,Re,Sn):ke?Zl(A,ft,D,ke,Re,Sn):be?vh(A,ft,D,Ct.lineClipsArray.length,Sn):Wl(A,ft,D,Sn);if(Te)Le.activeTexture.set(Ve.TEXTURE0),ft.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),wt.updatePaintBuffers(Re);else if(ke&&(kn||A.lineAtlas.dirty))Le.activeTexture.set(Ve.TEXTURE0),A.lineAtlas.bind(Le);else if(be){const An=Ct.gradients[D.id];let Mn=An.texture;if(D.gradientVersion!==An.version){let Rn=256;if(D.stepInterpolant){const jr=z.getSource().maxzoom,lr=st.canonical.z===jr?Math.ceil(1<<A.transform.maxZoom-st.canonical.z):1;Rn=s.ac(s.aT(Ct.maxLineLength/s.W*1024*lr),256,Le.maxTextureSize)}An.gradient=s.aU({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Rn,image:An.gradient||void 0,clips:Ct.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new ee(Le,An.gradient,Ve.RGBA),An.version=D.gradientVersion,Mn=An.texture}Le.activeTexture.set(Ve.TEXTURE0),Mn.bind(D.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Ot.draw(Le,Ve.TRIANGLES,te,A.stencilModeForClipping(st),me,pr.disabled,qn,$t,D.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,D.paint,A.transform.zoom,wt,Ct.layoutVertexBuffer2),rt=!1}})(l,h,y,v);break;case"fill":(function(A,z,D,$){const W=D.paint.get("fill-color"),Q=D.paint.get("fill-opacity");if(Q.constantOr(1)===0)return;const te=A.colorModeForRenderPass(),me=D.paint.get("fill-pattern"),ke=A.opaquePassEnabledForLayer()&&!me.constantOr(1)&&W.constantOr(s.aO.transparent).a===1&&Q.constantOr(0)===1?"opaque":"translucent";if(A.renderPass===ke){const Ae=A.depthModeForSublayer(1,A.renderPass==="opaque"?Vn.ReadWrite:Vn.ReadOnly);Lh(A,z,D,$,Ae,te,!1)}if(A.renderPass==="translucent"&&D.paint.get("fill-antialias")){const Ae=A.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Vn.ReadOnly);Lh(A,z,D,$,Ae,te,!0)}})(l,h,y,v);break;case"fill-extrusion":(function(A,z,D,$){const W=D.paint.get("fill-extrusion-opacity");if(W!==0&&A.renderPass==="translucent"){const Q=new Vn(A.context.gl.LEQUAL,Vn.ReadWrite,A.depthRangeFor3D);if(W!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))lu(A,z,D,$,Q,wr.disabled,Gr.disabled),lu(A,z,D,$,Q,A.stencilModeFor3D(),A.colorModeForRenderPass());else{const te=A.colorModeForRenderPass();lu(A,z,D,$,Q,wr.disabled,te)}}})(l,h,y,v);break;case"hillshade":(function(A,z,D,$){if(A.renderPass!=="offscreen"&&A.renderPass!=="translucent")return;const W=A.context,Q=A.depthModeForSublayer(0,Vn.ReadOnly),te=A.colorModeForRenderPass(),[me,ke]=A.renderPass==="translucent"?A.stencilConfigForOverlap($):[{},$];for(const Ae of ke){const Te=z.getTile(Ae);Te.needsHillshadePrepare!==void 0&&Te.needsHillshadePrepare&&A.renderPass==="offscreen"?Ac(A,Te,D,Q,wr.disabled,te):A.renderPass==="translucent"&&uu(A,Ae,Te,D,Q,me[Ae.overscaledZ],te)}W.viewport.set([0,0,A.width,A.height])})(l,h,y,v);break;case"raster":(function(A,z,D,$){if(A.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!$.length)return;const W=A.context,Q=W.gl,te=z.getSource(),me=A.useProgram("raster"),ke=A.colorModeForRenderPass(),[Ae,Te]=te instanceof Gt?[{},$]:A.stencilConfigForOverlap($),be=Te[Te.length-1].overscaledZ,Re=!A.options.moving;for(const et of Te){const Le=A.depthModeForSublayer(et.overscaledZ-be,D.paint.get("raster-opacity")===1?Vn.ReadWrite:Vn.ReadOnly,Q.LESS),Ve=z.getTile(et);Ve.registerFadeDuration(D.paint.get("raster-fade-duration"));const rt=z.findLoadedParent(et,0),st=Ih(Ve,rt,z,D,A.transform,A.style.map.terrain);let ft,Ct;const wt=D.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR;W.activeTexture.set(Q.TEXTURE0),Ve.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),W.activeTexture.set(Q.TEXTURE1),rt?(rt.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,rt.tileID.overscaledZ-Ve.tileID.overscaledZ),Ct=[Ve.tileID.canonical.x*ft%1,Ve.tileID.canonical.y*ft%1]):Ve.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST);const Bt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(et),Ot=Bt?et:null,kn=Ot?Ot.posMatrix:A.transform.calculatePosMatrix(et.toUnwrapped(),Re),$t=Xl(kn,Ct||[0,0],ft||1,st,D);te instanceof Gt?me.draw(W,Q.TRIANGLES,Le,wr.disabled,ke,pr.disabled,$t,Bt,D.id,te.boundsBuffer,A.quadTriangleIndexBuffer,te.boundsSegments):me.draw(W,Q.TRIANGLES,Le,Ae[et.overscaledZ],ke,pr.disabled,$t,Bt,D.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments)}})(l,h,y,v);break;case"background":(function(A,z,D,$){const W=D.paint.get("background-color"),Q=D.paint.get("background-opacity");if(Q===0)return;const te=A.context,me=te.gl,ke=A.transform,Ae=ke.tileSize,Te=D.paint.get("background-pattern");if(A.isPatternMissing(Te))return;const be=!Te&&W.a===1&&Q===1&&A.opaquePassEnabledForLayer()?"opaque":"translucent";if(A.renderPass!==be)return;const Re=wr.disabled,et=A.depthModeForSublayer(0,be==="opaque"?Vn.ReadWrite:Vn.ReadOnly),Le=A.colorModeForRenderPass(),Ve=A.useProgram(Te?"backgroundPattern":"background"),rt=$||ke.coveringTiles({tileSize:Ae,terrain:A.style.map.terrain});Te&&(te.activeTexture.set(me.TEXTURE0),A.imageManager.bind(A.context));const st=D.getCrossfadeParameters();for(const ft of rt){const Ct=$?ft.posMatrix:A.transform.calculatePosMatrix(ft.toUnwrapped()),wt=Te?Sp(Ct,Q,A,Te,{tileID:ft,tileSize:Ae},st):kp(Ct,Q,W),Bt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ft);Ve.draw(te,me.TRIANGLES,et,Re,Le,pr.disabled,wt,Bt,D.id,A.tileExtentBuffer,A.quadTriangleIndexBuffer,A.tileExtentSegments)}})(l,0,y,v);break;case"custom":(function(A,z,D){const $=A.context,W=D.implementation;if(A.renderPass==="offscreen"){const Q=W.prerender;Q&&(A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),Q.call(W,$.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState())}else if(A.renderPass==="translucent"){A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),$.setStencilMode(wr.disabled);const Q=W.renderingMode==="3d"?new Vn(A.context.gl.LEQUAL,Vn.ReadWrite,A.depthRangeFor3D):A.depthModeForSublayer(0,Vn.ReadOnly);$.setDepthMode(Q),W.render($.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState(),$.bindFramebuffer.set(null)}})(l,0,y)}}translatePosMatrix(l,h,y,v,A){if(!y[0]&&!y[1])return l;const z=A?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(z){const W=Math.sin(z),Q=Math.cos(z);y=[y[0]*Q-y[1]*W,y[0]*W+y[1]*Q]}const D=[A?y[0]:mn(h,y[0],this.transform.zoom),A?y[1]:mn(h,y[1],this.transform.zoom),0],$=new Float32Array(16);return s.H($,l,D),$}saveTileTexture(l){const h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const h=this.imageManager.getPattern(l.from.toString()),y=this.imageManager.getPattern(l.to.toString());return!h||!y}useProgram(l,h){this.cache=this.cache||{};const y=l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Cs(this.context,rl[l],h,bh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ee(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:h}=this.context.gl;return this.width!==l||this.height!==h}}class Ms{constructor(l,h){this.points=l,this.planes=h}static fromInvProjectionMatrix(l,h,y){const v=Math.pow(2,y),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const $=1/(D=s.af([],D,l))[3]/h*v;return s.a$(D,D,[$,$,1/D[3],$])}),z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const $=function(me,ke){var Ae=ke[0],Te=ke[1],be=ke[2],Re=Ae*Ae+Te*Te+be*be;return Re>0&&(Re=1/Math.sqrt(Re)),me[0]=ke[0]*Re,me[1]=ke[1]*Re,me[2]=ke[2]*Re,me}([],function(me,ke,Ae){var Te=ke[0],be=ke[1],Re=ke[2],et=Ae[0],Le=Ae[1],Ve=Ae[2];return me[0]=be*Ve-Re*Le,me[1]=Re*et-Te*Ve,me[2]=Te*Le-be*et,me}([],J([],A[D[0]],A[D[1]]),J([],A[D[2]],A[D[1]]))),W=-((Q=$)[0]*(te=A[D[1]])[0]+Q[1]*te[1]+Q[2]*te[2]);var Q,te;return $.concat(W)});return new Ms(A,z)}}class Es{constructor(l,h){this.min=l,this.max=h,this.center=function(y,v,A){return y[0]=.5*v[0],y[1]=.5*v[1],y[2]=.5*v[2],y}([],function(y,v,A){return y[0]=v[0]+A[0],y[1]=v[1]+A[1],y[2]=v[2]+A[2],y}([],this.min,this.max))}quadrant(l){const h=[l%2==0,l<2],y=K(this.min),v=K(this.max);for(let A=0;A<h.length;A++)y[A]=h[A]?this.min[A]:this.center[A],v[A]=h[A]?this.center[A]:this.max[A];return v[2]=this.max[2],new Es(y,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let v=0;v<l.planes.length;v++){const A=l.planes[v];let z=0;for(let D=0;D<h.length;D++)s.b0(A,h[D])>=0&&z++;if(z===0)return 0;z!==h.length&&(y=!1)}if(y)return 2;for(let v=0;v<3;v++){let A=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let D=0;D<l.points.length;D++){const $=l.points[D][v]-this.min[v];A=Math.min(A,$),z=Math.max(z,$)}if(z<0||A>this.max[v]-this.min[v])return 0}return 1}}class ba{constructor(l=0,h=0,y=0,v=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=y,this.right=v}interpolate(l,h,y){return h.top!=null&&l.top!=null&&(this.top=s.z.number(l.top,h.top,y)),h.bottom!=null&&l.bottom!=null&&(this.bottom=s.z.number(l.bottom,h.bottom,y)),h.left!=null&&l.left!=null&&(this.left=s.z.number(l.left,h.left,y)),h.right!=null&&l.right!=null&&(this.right=s.z.number(l.right,h.right,y)),this}getCenter(l,h){const y=s.ac((this.left+l-this.right)/2,0,l),v=s.ac((this.top+h-this.bottom)/2,0,h);return new s.P(y,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ba(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Cc=85.051129;class hu{constructor(l,h,y,v,A){this.tileSize=512,this._renderWorldCopies=A===void 0||!!A,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ba,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new hu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const h=-s.b1(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var y=new s.A(4);return s.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,v,A){var z=v[0],D=v[1],$=v[2],W=v[3],Q=Math.sin(A),te=Math.cos(A);y[0]=z*te+$*Q,y[1]=D*te+W*Q,y[2]=z*-Q+$*te,y[3]=D*-Q+W*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=s.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,y){this._unmodified=!1,this._edgeInsets.interpolate(l,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new s.b2(0,l)];if(this._renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),A=this.pointCoordinate(new s.P(this.width,this.height)),z=this.pointCoordinate(new s.P(0,this.height)),D=Math.floor(Math.min(y.x,v.x,A.x,z.x)),$=Math.floor(Math.max(y.x,v.x,A.x,z.x)),W=1;for(let Q=D-W;Q<=$+W;Q++)Q!==0&&h.push(new s.b2(Q,l))}return h}coveringTiles(l){var h,y;let v=this.coveringZoomLevel(l);const A=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const z=this.pointCoordinate(this.getCameraPoint()),D=s.Y.fromLngLat(this.center),$=Math.pow(2,v),W=[$*z.x,$*z.y,0],Q=[$*D.x,$*D.y,0],te=Ms.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let me=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(me=v);const ke=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,Ae=Le=>({aabb:new Es([Le*$,0,0],[(Le+1)*$,$,0]),zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Te=[],be=[],Re=v,et=l.reparseOverscaled?A:v;if(this._renderWorldCopies)for(let Le=1;Le<=3;Le++)Te.push(Ae(-Le)),Te.push(Ae(Le));for(Te.push(Ae(0));Te.length>0;){const Le=Te.pop(),Ve=Le.x,rt=Le.y;let st=Le.fullyVisible;if(!st){const Ot=Le.aabb.intersects(te);if(Ot===0)continue;st=Ot===2}const ft=l.terrain?W:Q,Ct=Le.aabb.distanceX(ft),wt=Le.aabb.distanceY(ft),Bt=Math.max(Math.abs(Ct),Math.abs(wt));if(Le.zoom===Re||Bt>ke+(1<<Re-Le.zoom)-2&&Le.zoom>=me){const Ot=Re-Le.zoom,kn=W[0]-.5-(Ve<<Ot),$t=W[1]-.5-(rt<<Ot);be.push({tileID:new s.Q(Le.zoom===Re?et:Le.zoom,Le.wrap,Le.zoom,Ve,rt),distanceSq:fe([Q[0]-.5-Ve,Q[1]-.5-rt]),tileDistanceToCamera:Math.sqrt(kn*kn+$t*$t)})}else for(let Ot=0;Ot<4;Ot++){const kn=(Ve<<1)+Ot%2,$t=(rt<<1)+(Ot>>1),gn=Le.zoom+1;let Sn=Le.aabb.quadrant(Ot);if(l.terrain){const qn=new s.Q(gn,Le.wrap,gn,kn,$t),An=l.terrain.getMinMaxElevation(qn),Mn=(h=An.minElevation)!==null&&h!==void 0?h:this.elevation,Rn=(y=An.maxElevation)!==null&&y!==void 0?y:this.elevation;Sn=new Es([Sn.min[0],Sn.min[1],Mn],[Sn.max[0],Sn.max[1],Rn])}Te.push({aabb:Sn,zoom:gn,x:kn,y:$t,wrap:Le.wrap,fullyVisible:st})}}return be.sort((Le,Ve)=>Le.distanceSq-Ve.distanceSq).map(Le=>Le.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=s.ac(l.lat,-85.051129,Cc);return new s.P(s.N(l.lng)*this.worldSize,s.O(h)*this.worldSize)}unproject(l){return new s.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const h=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,l),A=l.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-A))return;const z=y+h-A,D=Math.cos(this._pitch)*this.cameraToCenterDistance/z/s.b3(1,v.lat),$=this.scaleZoom(D/this.tileSize);this._elevation=A,this._center=v,this.zoom=$}setLocationAtPoint(l,h){const y=this.pointCoordinate(h),v=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(l),z=new s.Y(A.x-(y.x-v.x),A.y-(y.y-v.y));this.center=this.coordinateLocation(z),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,h){return h?this.coordinatePoint(this.locationCoordinate(l),h.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,h){return this.coordinateLocation(this.pointCoordinate(l,h))}locationCoordinate(l){return s.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,h){if(h){const me=h.pointCoordinate(l);if(me!=null)return me}const y=[l.x,l.y,0,1],v=[l.x,l.y,1,1];s.af(y,y,this.pixelMatrixInverse),s.af(v,v,this.pixelMatrixInverse);const A=y[3],z=v[3],D=y[1]/A,$=v[1]/z,W=y[2]/A,Q=v[2]/z,te=W===Q?0:(0-W)/(Q-W);return new s.Y(s.z.number(y[0]/A,v[0]/z,te)/this.worldSize,s.z.number(D,$,te)/this.worldSize)}coordinatePoint(l,h=0,y=this.pixelMatrix){const v=[l.x*this.worldSize,l.y*this.worldSize,h,1];return s.af(v,v,y),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Ge().extend(this.pointLocation(new s.P(0,l))).extend(this.pointLocation(new s.P(this.width,l))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Cc])}calculatePosMatrix(l,h=!1){const y=l.key,v=h?this._alignedPosMatrixCache:this._posMatrixCache;if(v[y])return v[y];const A=l.canonical,z=this.worldSize/this.zoomScale(A.z),D=A.x+Math.pow(2,A.z)*l.wrap,$=s.an(new Float64Array(16));return s.H($,$,[D*z,A.y*z,0]),s.J($,$,[z/s.W,z/s.W,1]),s.K($,h?this.alignedProjMatrix:this.projMatrix,$),v[y]=new Float32Array($),v[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,h){h=s.ac(+h,this.minZoom,this.maxZoom);const y={center:new s.M(l.lng,l.lat),zoom:h};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const Le=179.9999999999;v=[-Le,Le]}const A=this.tileSize*this.zoomScale(y.zoom);let z=0,D=A,$=0,W=A,Q=0,te=0;const{x:me,y:ke}=this.size;if(this.latRange){const Le=this.latRange;z=s.O(Le[1])*A,D=s.O(Le[0])*A,D-z<ke&&(Q=ke/(D-z))}v&&($=s.b1(s.N(v[0])*A,0,A),W=s.b1(s.N(v[1])*A,0,A),W<$&&(W+=A),W-$<me&&(te=me/(W-$)));const{x:Ae,y:Te}=this.project.call({worldSize:A},l);let be,Re;const et=Math.max(te||0,Q||0);if(et){const Le=new s.P(te?(W+$)/2:Ae,Q?(D+z)/2:Te);return y.center=this.unproject.call({worldSize:A},Le).wrap(),y.zoom+=this.scaleZoom(et),y}if(this.latRange){const Le=ke/2;Te-Le<z&&(Re=z+Le),Te+Le>D&&(Re=D-Le)}if(v){const Le=($+W)/2;let Ve=Ae;this._renderWorldCopies&&(Ve=s.b1(Ae,Le-A/2,Le+A/2));const rt=me/2;Ve-rt<$&&(be=$+rt),Ve+rt>W&&(be=W-rt)}if(be!==void 0||Re!==void 0){const Le=new s.P(be??Ae,Re??Te);y.center=this.unproject.call({worldSize:A},Le).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:h,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=y,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let v=s.an(new Float64Array(16));s.J(v,v,[this.width/2,-this.height/2,1]),s.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=s.an(new Float64Array(16)),s.J(v,v,[1,-1,1]),s.H(v,v,[-1,-1,0]),s.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const A=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),z=Math.min(this.elevation,this.minElevationForCurrentTile),D=A-z*this._pixelPerMeter/Math.cos(this._pitch),$=z<0?D:A,W=Math.PI/2+this._pitch,Q=this._fov*(.5+l.y/this.height),te=Math.sin(Q)*$/Math.sin(s.ac(Math.PI-W-Q,.01,Math.PI-.01)),me=this.getHorizon(),ke=2*Math.atan(me/this.cameraToCenterDistance)*(.5+l.y/(2*me)),Ae=Math.sin(ke)*$/Math.sin(s.ac(Math.PI-W-ke,.01,Math.PI-.01)),Te=Math.min(te,Ae),be=1.01*(Math.cos(Math.PI/2-this._pitch)*Te+$),Re=this.height/50;v=new Float64Array(16),s.b4(v,this._fov,this.width/this.height,Re,be),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,s.J(v,v,[1,-1,1]),s.H(v,v,[0,0,-this.cameraToCenterDistance]),s.b5(v,v,this._pitch),s.ad(v,v,this.angle),s.H(v,v,[-h,-y,0]),this.mercatorMatrix=s.J([],v,[this.worldSize,this.worldSize,this.worldSize]),s.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,v),s.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=s.ar([],v),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,v);const et=this.width%2/2,Le=this.height%2/2,Ve=Math.cos(this.angle),rt=Math.sin(this.angle),st=h-Math.round(h)+Ve*et+rt*Le,ft=y-Math.round(y)+Ve*Le+rt*et,Ct=new Float64Array(v);if(s.H(Ct,Ct,[st>.5?st-1:st,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=Ct,v=s.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new s.P(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}getCameraQueryGeometry(l){const h=this.getCameraPoint();if(l.length===1)return[l[0],h];{let y=h.x,v=h.y,A=h.x,z=h.y;for(const D of l)y=Math.min(y,D.x),v=Math.min(v,D.y),A=Math.max(A,D.x),z=Math.max(z,D.y);return[new s.P(y,v),new s.P(A,v),new s.P(A,z),new s.P(y,z),new s.P(y,v)]}}lngLatToCameraDepth(l,h){const y=this.locationCoordinate(l),v=[y.x*this.worldSize,y.y*this.worldSize,h,1];return s.af(v,v,this.projMatrix),v[2]/v[3]}}function Tc(w,l){let h,y=!1,v=null,A=null;const z=()=>{v=null,y&&(w.apply(A,h),v=setTimeout(z,l),y=!1)};return(...D)=>(y=!0,A=this,h=D,v||z(),v)}class Mc{constructor(l){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let y;return h.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Tc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const h=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,v),z=Math.round(h.lng*A)/A,D=Math.round(h.lat*A)/A,$=this._map.getBearing(),W=this._map.getPitch();let Q="";if(Q+=l?`/${z}/${D}/${y}`:`${y}/${D}/${z}`,($||W)&&(Q+="/"+Math.round(10*$)/10),W&&(Q+=`/${Math.round(W)}`),this._hashName){const te=this._hashName;let me=!1;const ke=window.location.hash.slice(1).split("&").map(Ae=>{const Te=Ae.split("=")[0];return Te===te?(me=!0,`${Te}=${Q}`):Ae}).filter(Ae=>Ae);return me||ke.push(`${te}=${Q}`),`#${ke.join("&")}`}return`#${Q}`}}const fl={linearity:.3,easing:s.b6(0,0,.3,1)},Ws=s.e({deceleration:2500,maxSpeed:1400},fl),Rh=s.e({deceleration:20,maxSpeed:1400},fl),Bh=s.e({deceleration:1e3,maxSpeed:360},fl),Fh=s.e({deceleration:1e3,maxSpeed:90},fl);class Oh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=_.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)h.zoom+=A.zoomDelta||0,h.bearing+=A.bearingDelta||0,h.pitch+=A.pitchDelta||0,A.panDelta&&h.pan._add(A.panDelta),A.around&&(h.around=A.around),A.pinchAround&&(h.pinchAround=A.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const A=dl(h.pan.mag(),y,s.e({},Ws,l||{}));v.offset=h.pan.mult(A.amount/h.pan.mag()),v.center=this._map.transform.center,hl(v,A)}if(h.zoom){const A=dl(h.zoom,y,Rh);v.zoom=this._map.transform.zoom+A.amount,hl(v,A)}if(h.bearing){const A=dl(h.bearing,y,Bh);v.bearing=this._map.transform.bearing+s.ac(A.amount,-179,179),hl(v,A)}if(h.pitch){const A=dl(h.pitch,y,Fh);v.pitch=this._map.transform.pitch+A.amount,hl(v,A)}if(v.zoom||v.bearing){const A=h.pinchAround===void 0?h.around:h.pinchAround;v.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function hl(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function dl(w,l,h){const{maxSpeed:y,linearity:v,deceleration:A}=h,z=s.ac(w*v/(l/1e3),-y,y),D=Math.abs(z)/(A*v);return{easing:h.easing,duration:1e3*D,amount:z*(D/2)}}class $i extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y,v={}){const A=x.mousePos(h.getCanvas(),y),z=h.unproject(A);super(l,s.e({point:A,lngLat:z,originalEvent:y},v)),this._defaultPrevented=!1,this.target=h}}class Go extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){const v=l==="touchend"?y.changedTouches:y.touches,A=x.touchPos(h.getCanvasContainer(),v),z=A.map($=>h.unproject($)),D=A.reduce(($,W,Q,te)=>$.add(W.div(te.length)),new s.P(0,0));super(l,{points:A,point:D,lngLats:z,lngLat:h.unproject(D),originalEvent:y}),this._defaultPrevented=!1}}class Ec extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){super(l,{originalEvent:y}),this._defaultPrevented=!1}}class So{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Ec(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new $i(l.type,this._map,l))}mouseup(l){this._map.fire(new $i(l.type,this._map,l))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new $i(l.type,this._map,l))}dblclick(l){return this._firePreventable(new $i(l.type,this._map,l))}mouseover(l){this._map.fire(new $i(l.type,this._map,l))}mouseout(l){this._map.fire(new $i(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Go(l.type,this._map,l))}touchmove(l){this._map.fire(new Go(l.type,this._map,l))}touchend(l){this._map.fire(new Go(l.type,this._map,l))}touchcancel(l){this._map.fire(new Go(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new $i(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new $i(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wa{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(s.P.convert(l),this._map.terrain)}}class Co{constructor(l,h){this._map=l,this._tr=new wa(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const y=h;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=y,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(v.x,y.x),z=Math.max(v.x,y.x),D=Math.min(v.y,y.y),$=Math.max(v.y,y.y);x.setTransform(this._box,`translate(${A}px,${D}px)`),this._box.style.width=z-A+"px",this._box.style.height=$-D+"px"}mouseupWindow(l,h){if(!this._active||l.button!==0)return;const y=this._startPos,v=h;if(this.reset(),x.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new s.k(l,{originalEvent:h}))}}function Zs(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const h={};for(let y=0;y<w.length;y++)h[w[y].identifier]=l[y];return h}class Bp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(v){const A=new s.P(0,0);for(const z of v)A._add(z);return A.div(v.length)}(h),this.touches=Zs(y,h)))}touchmove(l,h,y){if(this.aborted||!this.centroid)return;const v=Zs(y,h);for(const A in this.touches){const z=v[A];(!z||z.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(l,h,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Lc{constructor(l){this.singleTap=new Bp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,h,y){this.singleTap.touchstart(l,h,y)}touchmove(l,h,y){this.singleTap.touchmove(l,h,y)}touchend(l,h,y){const v=this.singleTap.touchend(l,h,y);if(v){const A=l.timeStamp-this.lastTime<500,z=!this.lastTap||this.lastTap.dist(v)<30;if(A&&z||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Fp{constructor(l){this._tr=new wa(l),this._zoomIn=new Lc({numTouches:1,numTaps:2}),this._zoomOut=new Lc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,y){this._zoomIn.touchstart(l,h,y),this._zoomOut.touchstart(l,h,y)}touchmove(l,h,y){this._zoomIn.touchmove(l,h,y),this._zoomOut.touchmove(l,h,y)}touchend(l,h,y){const v=this._zoomIn.touchend(l,h,y),A=this._zoomOut.touchend(l,h,y),z=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:z.zoom+1,around:z.unproject(v)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:z.zoom-1,around:z.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const h=this._moveFunction(...l);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(l,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,h){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=h.length?h[0]:h;return!this._moved&&v.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(y,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const pl={0:1,2:2};class Zo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const h=x.mouseButton(l);this._eventButton=h}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(h,y){const v=pl[y];return h.buttons===void 0||(h.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class Zt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const du=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},Aa=({enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:h=.8})=>{const y=new Zo({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new xa({clickTolerance:l,move:(v,A)=>({bearingDelta:(A.x-v.x)*h}),moveStateManager:y,enable:w,assignEvents:du})},ka=({enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:h=-.5})=>{const y=new Zo({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new xa({clickTolerance:l,move:(v,A)=>({pitchDelta:(A.y-v.y)*h}),moveStateManager:y,enable:w,assignEvents:du})};class $h{constructor(l,h){this._clickTolerance=l.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,h,y){return this._calculateTransform(l,h,y)}touchmove(l,h,y){if(this._active&&!(y.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,h,y)}touchend(l,h,y){this._calculateTransform(l,h,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,y){y.length>0&&(this._active=!0);const v=Zs(y,h),A=new s.P(0,0),z=new s.P(0,0);let D=0;for(const W in v){const Q=v[W],te=this._touches[W];te&&(A._add(Q),z._add(Q.sub(te)),D++,v[W]=Q)}if(this._touches=v,D<this.minTouchs()||!z.mag())return;const $=z.div(D);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(D),panDelta:$}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,y){if(!this._firstTwoTouches)return;l.preventDefault();const[v,A]=this._firstTwoTouches,z=Sa(y,h,v),D=Sa(y,h,A);if(!z||!D)return;const $=this._aroundCenter?null:z.add(D).div(2);return this._move([z,D],$,l)}touchend(l,h,y){if(!this._firstTwoTouches)return;const[v,A]=this._firstTwoTouches,z=Sa(y,h,v),D=Sa(y,h,A);z&&D||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sa(w,l,h){for(let y=0;y<w.length;y++)if(w[y].identifier===h)return l[y]}function Nh(w,l){return Math.log(w/l)/Math.LN2}class jh extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Nh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nh(this._distance,y),pinchAround:h}}}function pu(w,l){return 180*w.angleWith(l)/Math.PI}class Ic extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h,y){const v=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pu(this._vector,v),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,y=pu(l,this._startVector);return Math.abs(y)<h}}function mu(w){return Math.abs(w.y)>Math.abs(w.x)}class Uh extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,h,y){super.touchstart(l,h,y),this._currentTouchCount=y.length}_start(l){this._lastPoints=l,mu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),A=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,A,y.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(l,h,y){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,A=h.mag()>=2;if(!v&&!A)return;if(!v||!A)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const z=l.y>0==h.y>0;return mu(l)&&mu(h)&&z}}const Op={panStep:100,bearingStep:15,pitchStep:10};class Ls{constructor(l){this._tr=new wa(l);const h=Op;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,y=0,v=0,A=0,z=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),z=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),z=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:D=>{const $=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:Mr,zoom:h?Math.round($.zoom)+h*(l.shiftKey?2:1):$.zoom,bearing:$.bearing+y*this._bearingStep,pitch:$.pitch+v*this._pitchStep,offset:[-A*this._panStep,-z*this._panStep],center:$.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mr(w){return w*(2-w)}const ml=4.000244140625;class gu{constructor(l,h){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=l,this._tr=new wa(l),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=_.now(),v=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%ml==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=x.mousePos(this._map.getCanvas(),l),y=this._tr;this._around=h.y>y.transform.height/2-y.transform.getHorizon()?s.M.convert(this._aroundCenter?y.center:y.unproject(h)):s.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>ml?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&$!==0&&($=1/$);const W=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(W*$))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,y=this._startZoom,v=this._easing;let A,z=!1;if(this._type==="wheel"&&y&&v){const D=Math.min((_.now()-this._lastWheelEventTime)/200,1),$=v(D);A=s.z.number(y,h,$),D<1?this._frameId||(this._frameId=!0):z=!0}else A=h,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:A-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=s.b7;if(this._prevEase){const y=this._prevEase,v=(_.now()-y.start)/y.duration,A=y.easing(v+.01)-y.easing(v),z=.27/Math.sqrt(A*A+1e-4)*.01,D=Math.sqrt(.0729-z*z);h=s.b6(z,D,.25,1)}return this._prevEase={start:_.now(),duration:l,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pc{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vh{constructor(l){this._tr=new wa(l),this.reset()}reset(){this._active=!1}dblclick(l,h){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qh{constructor(){this._tap=new Lc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,h,y){if(!this._swipePoint)if(this._tapTime){const v=h[0],A=l.timeStamp-this._tapTime<500,z=this._tapPoint.dist(v)<30;A&&z?y.length>0&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(l,h,y)}touchmove(l,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const v=h[0],A=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,h,y)}touchend(l,h,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const v=this._tap.touchend(l,h,y);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(l,h,y){this._el=l,this._mousePan=h,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class To{constructor(l,h,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gl{constructor(l,h,y,v){this._el=l,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class sn{constructor(l,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=h,this._container.appendChild(v);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=y,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const hn=w=>w.zoom||w.drag||w.pitch||w.rotate;class _u extends s.k{}function _l(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class zc{constructor(l,h){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,A)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const z=v.type==="renderFrame"?void 0:v,D={needsRenderFrame:!1},$={},W={},Q=v.touches,te=Q?this._getMapTouches(Q):void 0,me=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),v);for(const{handlerName:Te,handler:be,allowed:Re}of this._handlers){if(!be.isEnabled())continue;let et;this._blockedByActive(W,Re,Te)?be.reset():be[A||v.type]&&(et=be[A||v.type](v,me,te),this.mergeHandlerResult(D,$,et,Te,z),et&&et.needsRenderFrame&&this._triggerRenderFrame()),(et||be.isActive())&&(W[Te]=be)}const ke={};for(const Te in this._previousActiveHandlers)W[Te]||(ke[Te]=z);this._previousActiveHandlers=W,(Object.keys(ke).length||_l(D))&&(this._changes.push([D,$,ke]),this._triggerRenderFrame()),(Object.keys(W).length||_l(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ae}=D;Ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ae(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Oh(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,A,z]of this._listeners)x.addEventListener(v,A,v===document?this.handleWindowEvent:this.handleEvent,z)}destroy(){for(const[l,h,y]of this._listeners)x.removeEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(l){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new So(h,l));const v=h.boxZoom=new Co(h,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const A=h.cooperativeGestures=new sn(h,l.cooperativeGestures);this._add("cooperativeGestures",A),l.cooperativeGestures&&A.enable();const z=new Fp(h),D=new Vh(h);h.doubleClickZoom=new Pc(D,z),this._add("tapZoom",z),this._add("clickZoom",D),l.interactive&&l.doubleClickZoom&&h.doubleClickZoom.enable();const $=new qh;this._add("tapDragZoom",$);const W=h.touchPitch=new Uh(h);this._add("touchPitch",W),l.interactive&&l.touchPitch&&h.touchPitch.enable(l.touchPitch);const Q=Aa(l),te=ka(l);h.dragRotate=new To(l,Q,te),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),l.interactive&&l.dragRotate&&h.dragRotate.enable();const me=(({enable:et,clickTolerance:Le})=>{const Ve=new Zo({checkCorrectEvent:rt=>x.mouseButton(rt)===0&&!rt.ctrlKey});return new xa({clickTolerance:Le,move:(rt,st)=>({around:st,panDelta:st.sub(rt)}),activateOnStart:!0,moveStateManager:Ve,enable:et,assignEvents:du})})(l),ke=new $h(l,h);h.dragPan=new Hh(y,me,ke),this._add("mousePan",me),this._add("touchPan",ke,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&h.dragPan.enable(l.dragPan);const Ae=new Ic,Te=new jh;h.touchZoomRotate=new gl(y,Te,Ae,$),this._add("touchRotate",Ae,["touchPan","touchZoom"]),this._add("touchZoom",Te,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&h.touchZoomRotate.enable(l.touchZoomRotate);const be=h.scrollZoom=new gu(h,()=>this._triggerRenderFrame());this._add("scrollZoom",be,["mousePan"]),l.interactive&&l.scrollZoom&&h.scrollZoom.enable(l.scrollZoom);const Re=h.keyboard=new Ls(h);this._add("keyboard",Re),l.interactive&&l.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Wo(h))}_add(l,h,y){this._handlers.push({handlerName:l,handler:h,allowed:y}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hn(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,h,y){for(const v in l)if(v!==y&&(!h||h.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const h=[];for(const y of l)this._el.contains(y.target)&&h.push(y);return h}mergeHandlerResult(l,h,y,v,A){if(!y)return;s.e(l,y);const z={handlerName:v,originalEvent:y.originalEvent||A};y.zoomDelta!==void 0&&(h.zoom=z),y.panDelta!==void 0&&(h.drag=z),y.pitchDelta!==void 0&&(h.pitch=z),y.bearingDelta!==void 0&&(h.rotate=z)}_applyChanges(){const l={},h={},y={};for(const[v,A,z]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),s.e(h,A),s.e(y,z);this._updateMapTransform(l,h,y),this._changes=[]}_updateMapTransform(l,h,y){const v=this._map,A=v._getTransformForUpdate(),z=v.terrain;if(!(_l(l)||z&&this._terrainMovement))return this._fireEvents(h,y,!0);let{panDelta:D,zoomDelta:$,bearingDelta:W,pitchDelta:Q,around:te,pinchAround:me}=l;me!==void 0&&(te=me),v._stop(!0),te=te||v.transform.centerPoint;const ke=A.pointLocation(D?te.sub(D):te);W&&(A.bearing+=W),Q&&(A.pitch+=Q),$&&(A.zoom+=$),z?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?A.center=A.pointLocation(A.centerPoint.sub(D)):A.setLocationAtPoint(ke,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,A.setLocationAtPoint(ke,te),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,A.recalculateZoom(v.terrain)})):A.setLocationAtPoint(ke,te),v._applyUpdatedTransform(A),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,y,!0)}_fireEvents(l,h,y){const v=hn(this._eventsInProgress),A=hn(l),z={};for(const Q in l){const{originalEvent:te}=l[Q];this._eventsInProgress[Q]||(z[`${Q}start`]=te),this._eventsInProgress[Q]=l[Q]}!v&&A&&this._fireEvent("movestart",A.originalEvent);for(const Q in z)this._fireEvent(Q,z[Q]);A&&this._fireEvent("move",A.originalEvent);for(const Q in l){const{originalEvent:te}=l[Q];this._fireEvent(Q,te)}const D={};let $;for(const Q in this._eventsInProgress){const{handlerName:te,originalEvent:me}=this._eventsInProgress[Q];this._handlersById[te].isActive()||(delete this._eventsInProgress[Q],$=h[te]||me,D[`${Q}end`]=$)}for(const Q in D)this._fireEvent(Q,D[Q]);const W=hn(this._eventsInProgress);if(y&&(v||A)&&!W){this._updatingCamera=!0;const Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!Q||!Q.essential&&_.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:$})),te(this._map.getBearing())&&this._map.resetNorth()):(te(Q.bearing||this._map.getBearing())&&(Q.bearing=0),Q.freezeElevation=!0,this._map.easeTo(Q,{originalEvent:$})),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new s.k(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new _u("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ni extends s.E{constructor(l,h){super(),this._renderFrameCallback=()=>{const y=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,y){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},h),y)}panTo(l,h,y){return this.easeTo(s.e({center:l},h),y)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,y){return this.easeTo(s.e({zoom:l},h),y)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,y){return this.easeTo(s.e({bearing:l},h),y)}resetNorth(l,h){return this.rotateTo(0,s.e({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=Ge.convert(l);const y=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),y,h)}_cameraForBoxAndBearing(l,h,y,v){const A={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const Ot=v.padding;v.padding={top:Ot,bottom:Ot,right:Ot,left:Ot}}v.padding=s.e(A,v.padding);const z=this.transform,D=z.padding,$=new Ge(l,h),W=z.project($.getNorthWest()),Q=z.project($.getNorthEast()),te=z.project($.getSouthEast()),me=z.project($.getSouthWest()),ke=s.b8(-y),Ae=W.rotate(ke),Te=Q.rotate(ke),be=te.rotate(ke),Re=me.rotate(ke),et=new s.P(Math.max(Ae.x,Te.x,Re.x,be.x),Math.max(Ae.y,Te.y,Re.y,be.y)),Le=new s.P(Math.min(Ae.x,Te.x,Re.x,be.x),Math.min(Ae.y,Te.y,Re.y,be.y)),Ve=et.sub(Le),rt=(z.width-(D.left+D.right+v.padding.left+v.padding.right))/Ve.x,st=(z.height-(D.top+D.bottom+v.padding.top+v.padding.bottom))/Ve.y;if(st<0||rt<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ft=Math.min(z.scaleZoom(z.scale*Math.min(rt,st)),v.maxZoom),Ct=s.P.convert(v.offset),wt=new s.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(s.b8(y)),Bt=Ct.add(wt).mult(z.scale/z.zoomScale(ft));return{center:z.unproject(W.add(te).div(2).sub(Bt)),zoom:ft,bearing:y}}fitBounds(l,h,y){return this._fitInternal(this.cameraForBounds(l,h),h,y)}fitScreenCoordinates(l,h,y,v,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(l)),this.transform.pointLocation(s.P.convert(h)),y,v),v,A)}_fitInternal(l,h,y){return l?(delete(h=s.e(l,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(l,h){this.stop();const y=this._getTransformForUpdate();let v=!1,A=!1,z=!1;return"zoom"in l&&y.zoom!==+l.zoom&&(v=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=s.M.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(A=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(z=!0,y.pitch=+l.pitch),l.padding==null||y.isPaddingEqual(l.padding)||(y.padding=l.padding),this._applyUpdatedTransform(y),this.fire(new s.k("movestart",h)).fire(new s.k("move",h)),v&&this.fire(new s.k("zoomstart",h)).fire(new s.k("zoom",h)).fire(new s.k("zoomend",h)),A&&this.fire(new s.k("rotatestart",h)).fire(new s.k("rotate",h)).fire(new s.k("rotateend",h)),z&&this.fire(new s.k("pitchstart",h)).fire(new s.k("pitch",h)).fire(new s.k("pitchend",h)),this.fire(new s.k("moveend",h))}calculateCameraOptionsFromTo(l,h,y,v=0){const A=s.Y.fromLngLat(l,h),z=s.Y.fromLngLat(y,v),D=z.x-A.x,$=z.y-A.y,W=z.z-A.z,Q=Math.hypot(D,$,W);if(Q===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(D,$),me=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Q/this.transform.tileSize),ke=180*Math.atan2(D,-$)/Math.PI;let Ae=180*Math.acos(te/Q)/Math.PI;return Ae=W<0?90-Ae:90+Ae,{center:z.toLngLat(),zoom:me,pitch:Ae,bearing:ke}}easeTo(l,h){var y;this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.b7},l)).animate===!1||!l.essential&&_.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),A=this.getZoom(),z=this.getBearing(),D=this.getPitch(),$=this.getPadding(),W="bearing"in l?this._normalizeBearing(l.bearing,z):z,Q="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,me=s.P.convert(l.offset);let ke=v.centerPoint.add(me);const Ae=v.pointLocation(ke),{center:Te,zoom:be}=v.getConstrained(s.M.convert(l.center||Ae),(y=l.zoom)!==null&&y!==void 0?y:A);this._normalizeCenter(Te);const Re=v.project(Ae),et=v.project(Te).sub(Re),Le=v.zoomScale(be-A);let Ve,rt;l.around&&(Ve=s.M.convert(l.around),rt=v.locationPoint(Ve));const st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==A,this._rotating=this._rotating||z!==W,this._pitching=this._pitching||Q!==D,this._padding=!v.isPaddingEqual(te),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,st),this.terrain&&this._prepareElevation(Te),this._ease(ft=>{if(this._zooming&&(v.zoom=s.z.number(A,be,ft)),this._rotating&&(v.bearing=s.z.number(z,W,ft)),this._pitching&&(v.pitch=s.z.number(D,Q,ft)),this._padding&&(v.interpolatePadding($,te,ft),ke=v.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(ft),Ve)v.setLocationAtPoint(Ve,rt);else{const Ct=v.zoomScale(v.zoom-A),wt=be>A?Math.min(2,Le):Math.max(.5,Le),Bt=Math.pow(wt,1-ft),Ot=v.unproject(Re.add(et.mult(ft*Bt)).mult(Ct));v.setLocationAtPoint(v.renderWorldCopies?Ot.wrap():Ot,ke)}this._applyUpdatedTransform(v),this._fireMoveEvents(h)},ft=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,ft)},l),this}_prepareEase(l,h,y={}){this._moving=!0,h||y.moving||this.fire(new s.k("movestart",l)),this._zooming&&!y.zooming&&this.fire(new s.k("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new s.k("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new s.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&h!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(y-(h-(y*l+this._elevationStart))/(1-l)),this._elevationTarget=h}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const h=l.clone(),{center:y,zoom:v,pitch:A,bearing:z,elevation:D}=this.transformCameraUpdate(h);y&&(h.center=y),v!==void 0&&(h.zoom=v),A!==void 0&&(h.pitch=A),z!==void 0&&(h.bearing=z),D!==void 0&&(h.elevation=D),this.transform.apply(h)}_fireMoveEvents(l){this.fire(new s.k("move",l)),this._zooming&&this.fire(new s.k("zoom",l)),this._rotating&&this.fire(new s.k("rotate",l)),this._pitching&&this.fire(new s.k("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const y=this._zooming,v=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.k("zoomend",l)),v&&this.fire(new s.k("rotateend",l)),A&&this.fire(new s.k("pitchend",l)),this.fire(new s.k("moveend",l))}flyTo(l,h){var y;if(!l.essential&&_.prefersReducedMotion){const qn=s.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qn,h)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},l);const v=this._getTransformForUpdate(),A=this.getZoom(),z=this.getBearing(),D=this.getPitch(),$=this.getPadding(),W="bearing"in l?this._normalizeBearing(l.bearing,z):z,Q="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,me=s.P.convert(l.offset);let ke=v.centerPoint.add(me);const Ae=v.pointLocation(ke),{center:Te,zoom:be}=v.getConstrained(s.M.convert(l.center||Ae),(y=l.zoom)!==null&&y!==void 0?y:A);this._normalizeCenter(Te);const Re=v.zoomScale(be-A),et=v.project(Ae),Le=v.project(Te).sub(et);let Ve=l.curve;const rt=Math.max(v.width,v.height),st=rt/Re,ft=Le.mag();if("minZoom"in l){const qn=s.ac(Math.min(l.minZoom,A,be),v.minZoom,v.maxZoom),An=rt/v.zoomScale(qn-A);Ve=Math.sqrt(An/ft*2)}const Ct=Ve*Ve;function wt(qn){const An=(st*st-rt*rt+(qn?-1:1)*Ct*Ct*ft*ft)/(2*(qn?st:rt)*Ct*ft);return Math.log(Math.sqrt(An*An+1)-An)}function Bt(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function Ot(qn){return(Math.exp(qn)+Math.exp(-qn))/2}const kn=wt(!1);let $t=function(qn){return Ot(kn)/Ot(kn+Ve*qn)},gn=function(qn){return rt*((Ot(kn)*(Bt(An=kn+Ve*qn)/Ot(An))-Bt(kn))/Ct)/ft;var An},Sn=(wt(!0)-kn)/Ve;if(Math.abs(ft)<1e-6||!isFinite(Sn)){if(Math.abs(rt-st)<1e-6)return this.easeTo(l,h);const qn=st<rt?-1:1;Sn=Math.abs(Math.log(st/rt))/Ve,gn=function(){return 0},$t=function(An){return Math.exp(qn*Ve*An)}}return l.duration="duration"in l?+l.duration:1e3*Sn/("screenSpeed"in l?+l.screenSpeed/Ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=z!==W,this._pitching=Q!==D,this._padding=!v.isPaddingEqual(te),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Te),this._ease(qn=>{const An=qn*Sn,Mn=1/$t(An);v.zoom=qn===1?be:A+v.scaleZoom(Mn),this._rotating&&(v.bearing=s.z.number(z,W,qn)),this._pitching&&(v.pitch=s.z.number(D,Q,qn)),this._padding&&(v.interpolatePadding($,te,qn),ke=v.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(qn);const Rn=qn===1?Te:v.unproject(et.add(Le.mult(gn(An))).mult(Mn));v.setLocationAtPoint(v.renderWorldCopies?Rn.wrap():Rn,ke),this._applyUpdatedTransform(v),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,h,y){y.animate===!1||y.duration===0?(l(1),h()):(this._easeStart=_.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,h){l=s.b1(l,-180,180);const y=Math.abs(l-h);return Math.abs(l-360-h)<y&&(l-=360),Math.abs(l+360-h)<y&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const y=l.lng-h.center.lng;l.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const Dc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Mo{constructor(l=Dc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,h){const y=this._map._getUIString(`AttributionControl.${h}`);l.title=y,l.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style.sourceCaches;for(const v in h){const A=h[v];if(A.used||A.usedForTerrain){const z=A.getSource();z.attribution&&l.indexOf(z.attribution)<0&&l.push(z.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,A)=>v.length-A.length),l=l.filter((v,A)=>{for(let z=A+1;z<l.length;z++)if(l[z].indexOf(v)>=0)return!1;return!0});const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gh{constructor(l={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const y=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const h=x.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const v of y)if(v.id===l)return void(v.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nr=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class Wr extends s.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,h){this.sourceCache.update(l,h),this._renderableTilesKeys=[];const y={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),s.aN(v.posMatrix,0,s.W,0,s.W,0,1),this._tiles[v.key]=new Pr(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(l){for(const h in this._tiles){const y=this._tiles[h];(!l||y.tileID.equals(l)||y.tileID.isChildOf(l)||l.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const h={};for(const y of this._renderableTilesKeys){const v=this._tiles[y].tileID;if(v.canonical.equals(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16),s.aN(A.posMatrix,0,s.W,0,s.W,0,1),h[y]=A}else if(v.canonical.isChildOf(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const z=v.canonical.z-l.canonical.z,D=v.canonical.x-(v.canonical.x>>z<<z),$=v.canonical.y-(v.canonical.y>>z<<z),W=s.W>>z;s.aN(A.posMatrix,0,W,0,W,0,1),s.H(A.posMatrix,A.posMatrix,[-D*W,-$*W,0]),h[y]=A}else if(l.canonical.isChildOf(v.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const z=l.canonical.z-v.canonical.z,D=l.canonical.x-(l.canonical.x>>z<<z),$=l.canonical.y-(l.canonical.y>>z<<z),W=s.W>>z;s.aN(A.posMatrix,0,s.W,0,s.W,0,1),s.H(A.posMatrix,A.posMatrix,[D*W,$*W,0]),s.J(A.posMatrix,A.posMatrix,[1/2**z,1/2**z,0]),h[y]=A}}return h}getSourceTile(l,h){const y=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>y.maxzoom&&(v=y.maxzoom),v<y.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!A||!A.dem)&&h)for(;v>=y.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(l.scaledTo(v--).key);return A}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=l)}}class Wh{constructor(l,h,y){this.painter=l,this.sourceCache=new Wr(h),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,h,y,v=s.W){var A;if(!(h>=0&&h<v&&y>=0&&y<v))return 0;const z=this.getTerrainData(l),D=(A=z.tile)===null||A===void 0?void 0:A.dem;if(!D)return 0;const $=function(Ae,Te,be){var Re=Te[0],et=Te[1];return Ae[0]=be[0]*Re+be[4]*et+be[12],Ae[1]=be[1]*Re+be[5]*et+be[13],Ae}([],[h/v*s.W,y/v*s.W],z.u_terrain_matrix),W=[$[0]*D.dim,$[1]*D.dim],Q=Math.floor(W[0]),te=Math.floor(W[1]),me=W[0]-Q,ke=W[1]-te;return D.get(Q,te)*(1-me)*(1-ke)+D.get(Q+1,te)*me*(1-ke)+D.get(Q,te+1)*(1-me)*ke+D.get(Q+1,te+1)*me*ke}getElevationForLngLatZoom(l,h){const{tileID:y,mercatorX:v,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(l,h);return this.getElevation(y,v%s.W,A%s.W,s.W)}getElevation(l,h,y,v=s.W){return this.getDEMElevation(l,h,y,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,A=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ee(v,A,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ee(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const h=this.sourceCache.getSourceTile(l,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const v=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ee(v,h.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),h.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const y=h&&h+h.tileID.key+l.key;if(y&&!this._demMatrixCache[y]){const v=this.sourceCache.sourceCache._source.maxzoom;let A=l.canonical.z-h.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?A=l.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const z=l.canonical.x-(l.canonical.x>>A<<A),D=l.canonical.y-(l.canonical.y>>A<<A),$=s.b9(new Float64Array(16),[1/(s.W<<A),1/(s.W<<A),0]);s.H($,$,[z*s.W,D*s.W,0]),this._demMatrixCache[l.key]={matrix:$,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(l){const h=this.painter,y=h.width/devicePixelRatio,v=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ee(h.context,{width:y,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ee(h.context,{width:y,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,z=0;A<this._coordsTextureSize;A++)for(let D=0;D<this._coordsTextureSize;D++,z+=4)h[z+0]=255&D,h[z+1]=255&A,h[z+2]=D>>8<<4|A>>8,h[z+3]=0;const y=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),v=new ee(l,y,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),y=this.painter.context,v=y.gl,A=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),z=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(A,D-z-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null);const $=h[0]+(h[2]>>4<<8),W=h[1]+((15&h[2])<<8),Q=this.coordsIndex[255-h[3]],te=Q&&this.sourceCache.getTileByID(Q);if(!te)return null;const me=this._coordsTextureSize,ke=(1<<te.tileID.canonical.z)*me;return new s.Y((te.tileID.canonical.x*me+$)/ke+te.tileID.wrap,(te.tileID.canonical.y*me+W)/ke,this.getElevation(te.tileID,$,W,me))}depthAtPoint(l){const h=new Uint8Array(4),y=this.painter.context,v=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,h=new s.ba,y=new s.aX,v=this.meshSize,A=s.W/v,z=v*v;for(let te=0;te<=v;te++)for(let me=0;me<=v;me++)h.emplaceBack(me*A,te*A,0);for(let te=0;te<z;te+=v+1)for(let me=0;me<v;me++)y.emplaceBack(me+te,v+me+te+1,v+me+te+2),y.emplaceBack(me+te,v+me+te+2,me+te+1);const D=h.length,$=D+2*(v+1);for(const te of[0,1])for(let me=0;me<=v;me++)for(const ke of[0,1])h.emplaceBack(me*A,te*s.W,ke);for(let te=0;te<2*v;te+=2)y.emplaceBack($+te,$+te+1,$+te+3),y.emplaceBack($+te,$+te+3,$+te+2),y.emplaceBack(D+te,D+te+3,D+te+1),y.emplaceBack(D+te,D+te+2,D+te+3);const W=h.length,Q=W+2*(v+1);for(const te of[0,1])for(let me=0;me<=v;me++)for(const ke of[0,1])h.emplaceBack(te*s.W,me*A,ke);for(let te=0;te<2*v;te+=2)y.emplaceBack(W+te,W+te+1,W+te+3),y.emplaceBack(W+te,W+te+3,W+te+2),y.emplaceBack(Q+te,Q+te+3,Q+te+1),y.emplaceBack(Q+te,Q+te+2,Q+te+3);return this._mesh={indexBuffer:l.createIndexBuffer(y),vertexBuffer:l.createVertexBuffer(h,Nr.members),segments:s.$.simpleSegment(0,0,h.length,y.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*s.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,h){var y;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,h);return(y=this.getMinMaxElevation(v).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(l){const h=this.getTerrainData(l).tile,y={minElevation:null,maxElevation:null};return h&&h.dem&&(y.minElevation=h.dem.min*this.exaggeration,y.maxElevation=h.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(l,h){const y=s.Y.fromLngLat(l.wrap()),v=(1<<h)*s.W,A=y.x*v,z=y.y*v,D=Math.floor(A/s.W),$=Math.floor(z/s.W);return{tileID:new s.Q(h,0,h,D,$),mercatorX:A,mercatorY:z}}}class vl{constructor(l,h,y){this._context=l,this._size=h,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new ee(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(y.texture),{id:l,fbo:h,texture:y,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>l.id!==h),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const cs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Rc{constructor(l,h){this.painter=l,this.terrain=h,this.pool=new vl(l.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(y=>!l._layers[y].isHidden(h)),this._coordsDescendingInv={};for(const y in l.sourceCaches){this._coordsDescendingInv[y]={};const v=l.sourceCaches[y].getVisibleCoordinates();for(const A of v){const z=this.terrain.sourceCache.getTerrainCoords(A);for(const D in z)this._coordsDescendingInv[y][D]||(this._coordsDescendingInv[y][D]=[]),this._coordsDescendingInv[y][D].push(z[D])}}this._coordsDescendingInvStr={};for(const y of l._order){const v=l._layers[y],A=v.source;if(cs[v.type]&&!this._coordsDescendingInvStr[A]){this._coordsDescendingInvStr[A]={};for(const z in this._coordsDescendingInv[A])this._coordsDescendingInvStr[A][z]=this._coordsDescendingInv[A][z].map(D=>D.key).sort().join()}}for(const y of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const A=this._coordsDescendingInvStr[v][y.tileID.key];A&&A!==y.rttCoords[v]&&(y.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const h=l.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(cs[h]&&(this._prevType&&cs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(cs[this._prevType]||cs[h]&&v){this._prevType=h;const A=this._stacks.length-1,z=this._stacks[A]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[A]){const W=this.pool.getObjectForId(D.rtt[A].id);if(W.stamp===D.rtt[A].stamp){this.pool.useObject(W);continue}}const $=this.pool.getOrCreateFreeObject();this.pool.useObject($),this.pool.stampObject($),D.rtt[A]={id:$.id,stamp:$.stamp},y.context.bindFramebuffer.set($.fbo.framebuffer),y.context.clear({color:s.aO.transparent,stencil:0}),y.currentStencilSource=void 0;for(let W=0;W<z.length;W++){const Q=y.style._layers[z[W]],te=Q.source?this._coordsDescendingInv[Q.source][D.tileID.key]:[D.tileID];y.context.viewport.set([0,0,$.fbo.width,$.fbo.height]),y._renderTileClippingMasks(Q,te),y.renderLayer(y,y.style.sourceCaches[Q.source],Q,te),Q.source&&(D.rttCoords[Q.source]=this._coordsDescendingInvStr[Q.source][D.tileID.key])}}return fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),cs[h]}return!1}}const Bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Fc=d,bl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Dc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},yu=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Oc={showCompass:!0,showZoom:!0,visualizePitch:!1};class $c{constructor(l,h,y=!1){this.mousedown=z=>{this.startMouse(s.e({},z,{ctrlKey:!0,preventDefault:()=>z.preventDefault()}),x.mousePos(this.element,z)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=z=>{this.moveMouse(z,x.mousePos(this.element,z))},this.mouseup=z=>{this.mouseRotate.dragEnd(z),this.mousePitch&&this.mousePitch.dragEnd(z),this.offTemp()},this.touchstart=z=>{z.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,z.targetTouches)[0],this.startTouch(z,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=z=>{z.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,z.targetTouches)[0],this.moveTouch(z,this._lastPos))},this.touchend=z=>{z.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),A=l.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Aa({clickTolerance:v,enable:!0}),this.touchRotate=(({enable:z,clickTolerance:D,bearingDegreesPerPixelMoved:$=.8})=>{const W=new Zt;return new xa({clickTolerance:D,move:(Q,te)=>({bearingDelta:(te.x-Q.x)*$}),moveStateManager:W,enable:z,assignEvents:yu})})({clickTolerance:v,enable:!0}),this.map=l,y&&(this.mousePitch=ka({clickTolerance:A,enable:!0}),this.touchPitch=(({enable:z,clickTolerance:D,pitchDegreesPerPixelMoved:$=-.5})=>{const W=new Zt;return new xa({clickTolerance:D,move:(Q,te)=>({pitchDelta:(te.y-Q.y)*$}),moveStateManager:W,enable:z,assignEvents:yu})})({clickTolerance:A,enable:!0})),x.addEventListener(h,"mousedown",this.mousedown),x.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(h,"touchcancel",this.reset)}startMouse(l,h){this.mouseRotate.dragStart(l,h),this.mousePitch&&this.mousePitch.dragStart(l,h),x.disableDrag()}startTouch(l,h){this.touchRotate.dragStart(l,h),this.touchPitch&&this.touchPitch.dragStart(l,h),x.disableDrag()}moveMouse(l,h){const y=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,h)||{};if(v&&y.setBearing(y.getBearing()+v),this.mousePitch){const{pitchDelta:A}=this.mousePitch.dragMove(l,h)||{};A&&y.setPitch(y.getPitch()+A)}}moveTouch(l,h){const y=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,h)||{};if(v&&y.setBearing(y.getBearing()+v),this.touchPitch){const{pitchDelta:A}=this.touchPitch.dragMove(l,h)||{};A&&y.setPitch(y.getPitch()+A)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let fs;function vu(w,l,h){const y=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),l){const v=new s.M(w.lng-360,w.lat),A=new s.M(w.lng+360,w.lat),z=h.locationPoint(w).distSqr(l);h.locationPoint(v).distSqr(l)<z?w=v:h.locationPoint(A).distSqr(l)<z&&(w=A)}for(;Math.abs(w.lng-h.center.lng)>180;){const v=h.locationPoint(w);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;w.lng>h.center.lng?w.lng-=360:w.lng+=360}return w.lng!==y.lng&&h.locationPoint(w).y>h.height/2-h.getHorizon()?w:y}const wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bu(w,l,h){const y=w.classList;for(const v in wl)y.remove(`maplibregl-${h}-anchor-${v}`);y.add(`maplibregl-${h}-anchor-${l}`)}class xl extends s.E{constructor(l){if(super(),this._onKeyPress=h=>{const y=h.code,v=h.charCode||h.keyCode;y!=="Space"&&y!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=h=>{const y=h.originalEvent.target,v=this._element;this._popup&&(y===v||v.contains(y))&&this.togglePopup()},this._update=h=>{var y;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?vu(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let z="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?z="rotateX(0deg)":this._pitchAlignment==="map"&&(z=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${wl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${z} ${A}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const h=x.createNS("http://www.w3.org/2000/svg","svg"),y=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${y}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${y}`);const A=x.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const z=x.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill-rule","nonzero");const D=x.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of $){const et=x.createNS("http://www.w3.org/2000/svg","ellipse");et.setAttributeNS(null,"opacity","0.04"),et.setAttributeNS(null,"cx","10.5"),et.setAttributeNS(null,"cy","5.80029008"),et.setAttributeNS(null,"rx",Re.rx),et.setAttributeNS(null,"ry",Re.ry),D.appendChild(et)}const W=x.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"fill",this._color);const Q=x.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),W.appendChild(Q);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const me=x.createNS("http://www.w3.org/2000/svg","path");me.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(me);const ke=x.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ke.setAttributeNS(null,"fill","#FFFFFF");const Ae=x.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Te=x.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#000000"),Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962");const be=x.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),Ae.appendChild(Te),Ae.appendChild(be),z.appendChild(D),z.appendChild(W),z.appendChild(te),z.appendChild(ke),z.appendChild(Ae),h.appendChild(z),h.setAttributeNS(null,"height",y*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),bu(this._element,this._anchor,"marker"),l&&l.className)for(const h of l.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var h,y;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,A=v.terrain.depthAtPoint(this._pos),z=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,z)-A<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/v.transform._pixelPerMeter,$=Math.sin(v.getPitch()*Math.PI/180)*D,W=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),Q=v.transform.lngLatToCameraDepth(this._lngLat,z+$)-W>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&Q&&this._popup.remove(),this._element.style.opacity=Q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,h){return l===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const wu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ca=0,Xs=!1;const xu={maxWidth:100,unit:"metric"};function Au(w,l,h){const y=h&&h.maxWidth||100,v=w._container.clientHeight/2,A=w.unproject([0,v]),z=w.unproject([y,v]),D=A.distanceTo(z);if(h&&h.unit==="imperial"){const $=3.2808*D;$>5280?Ks(l,y,$/5280,w._getUIString("ScaleControl.Miles")):Ks(l,y,$,w._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ks(l,y,D/1852,w._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Ks(l,y,D/1e3,w._getUIString("ScaleControl.Kilometers")):Ks(l,y,D,w._getUIString("ScaleControl.Meters"))}function Ks(w,l,h,y){const v=function(A){const z=Math.pow(10,`${Math.floor(A)}`.length-1);let D=A/z;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function($){const W=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*W)/W}(D),z*D}(h);w.style.width=l*(v/h)+"px",w.innerHTML=`${v}&nbsp;${y}`}const Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ku(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-w),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const l=s.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return ku(new s.P(0,0))}const Zh=d;u.AJAXError=s.be,u.Evented=s.E,u.LngLat=s.M,u.MercatorCoordinate=s.Y,u.Point=s.P,u.addProtocol=s.bf,u.config=s.a,u.removeProtocol=s.bg,u.AttributionControl=Mo,u.BoxZoomHandler=Co,u.CanvasSource=Gn,u.CooperativeGesturesHandler=sn,u.DoubleClickZoomHandler=Pc,u.DragPanHandler=Hh,u.DragRotateHandler=To,u.EdgeInsets=ba,u.FullscreenControl=class extends s.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var l;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=h==null?void 0:h.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Xe,u.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const h=new s.M(l.coords.longitude,l.coords.latitude),y=l.coords.accuracy,v=this._map.getBearing(),A=s.e({bearing:v},this.options.fitBoundsOptions),z=Ge.fromLngLat(h,y);this._map.fitBounds(z,A,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const h=new s.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Xs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xl({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},wu,w)}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function*(l=!1){if(fs!==void 0&&!l)return fs;if(window.navigator.permissions===void 0)return fs=!!window.navigator.geolocation,fs;try{fs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{fs=!!window.navigator.geolocation}return fs})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ca=0,Xs=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),h=w.coords;return l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),h=w.getNorthEast(),y=l.distanceTo(h),v=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ca--,Xs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ca++,Ca>1?(w={maximumAge:6e5,timeout:0},Xs=!0):(w=this.options.positionOptions,Xs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Mc,u.ImageSource=Gt,u.KeyboardHandler=Ls,u.LngLatBounds=Ge,u.LogoControl=Gh,u.Map=class extends Ni{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},bl,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hu(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new yl,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Bc,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=O.addThrottleControl(()=>this.isMoving()),this._requestManager=new F(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const h=Tc(y=>{this._trackResize&&!this._removed&&this.resize(y)._update()},50);this._resizeObserver=new ResizeObserver(y=>{l?h(y):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,w),this._hash=w.hash&&new Mc(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Mo(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Gh,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=w.onAdd(this);this._controls.push(w);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,h,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,h,y)}resize(w){var l;const h=this._containerDimensions(),y=h[0],v=h[1],A=this._getClampedPixelRatio(y,v);if(this._resizeCanvas(y,v,A),this.painter.resize(y,v,A),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const $=this._getClampedPixelRatio(y,v);this._resizeCanvas(y,v,$),this.painter.resize(y,v,$)}this.transform.resize(y,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(y,v);const z=!this._moving;return z&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),z&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:h,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),A=w*v,z=l*v;return Math.min(A>h?h/A:1,z>y?y/z:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Ge.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,h){if(w==="mouseenter"||w==="mouseover"){let y=!1;return{layer:l,listener:h,delegates:{mousemove:A=>{const z=this.getLayer(l)?this.queryRenderedFeatures(A.point,{layers:[l]}):[];z.length?y||(y=!0,h.call(this,new $i(w,this,A.originalEvent,{features:z}))):y=!1},mouseout:()=>{y=!1}}}}if(w==="mouseleave"||w==="mouseout"){let y=!1;return{layer:l,listener:h,delegates:{mousemove:z=>{(this.getLayer(l)?this.queryRenderedFeatures(z.point,{layers:[l]}):[]).length?y=!0:y&&(y=!1,h.call(this,new $i(w,this,z.originalEvent)))},mouseout:z=>{y&&(y=!1,h.call(this,new $i(w,this,z.originalEvent)))}}}}{const y=v=>{const A=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];A.length&&(v.features=A,h.call(this,v),delete v.features)};return{layer:l,listener:h,delegates:{[w]:y}}}}on(w,l,h){if(h===void 0)return super.on(w,l);const y=this._createDelegatedListener(w,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(w,l,h){if(h===void 0)return super.once(w,l);const y=this._createDelegatedListener(w,l,h);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(w,l,h){return h===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(y=>{const v=this._delegatedListeners[w];for(let A=0;A<v.length;A++){const z=v[A];if(z.layer===l&&z.listener===h){for(const D in z.delegates)this.off(D,z.delegates[D]);return v.splice(A,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let h;const y=w instanceof s.P||Array.isArray(w),v=y?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(y?{}:w)||{},v instanceof s.P||typeof v[0]=="number")h=[s.P.convert(v)];else{const A=s.P.convert(v[0]),z=s.P.convert(v[1]);h=[A,new s.P(z.x,A.y),z,new s.P(A.x,z.y),A]}return this.style.queryRenderedFeatures(h,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const h=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new to(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,h):this.style.loadJSON(w,l,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new to(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const h=this._requestManager.transformRequest(w,"Style");s.h(h,new AbortController).then(y=>{this._updateDiff(y.data,l)}).catch(y=>{y&&this.fire(new s.j(y))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(h){s.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const h in this.style._layers){const y=this.style._layers[h];y.type==="hillshade"&&y.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Wh(this.painter,l,w),this.painter.renderToTexture=new Rc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const h=w[l]._tiles;for(const y in h){const v=h[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,h={}){const{pixelRatio:y=1,sdf:v=!1,stretchX:A,stretchY:z,content:D}=h;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:W,data:Q}=l,te=l;return this.style.addImage(w,{data:new s.R({width:$,height:W},new Uint8Array(Q)),pixelRatio:y,stretchX:A,stretchY:z,content:D,sdf:v,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:$,height:W,data:Q}=_.getImageData(l);this.style.addImage(w,{data:new s.R({width:$,height:W},Q),pixelRatio:y,stretchX:A,stretchY:z,content:D,sdf:v,version:0})}}updateImage(w,l){const h=this.style.getImage(w);if(!h)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||s.b(l)?_.getImageData(l):l,{width:v,height:A,data:z}=y;if(v===void 0||A===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||A!==h.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(l instanceof HTMLImageElement||s.b(l));return h.data.replace(z,D),this.style.updateImage(w,h),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return O.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,h){return this.style.setLayerZoomRange(w,l,h),this._update(!0)}setFilter(w,l,h={}){return this.style.setFilter(w,l,h),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,h,y={}){return this.style.setPaintProperty(w,l,h,y),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,h,y={}){return this.style.setLayoutProperty(w,l,h,y),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,h,y=>{y||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,h=>{h||this._update(!0)}),this}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),y=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],y);const v=this._controlContainer=x.create("div","maplibregl-control-container",w),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(z=>{A[z]=x.create("div",`maplibregl-ctrl-${z} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,h){this._canvas.width=Math.floor(h*w),this._canvas.height=Math.floor(h*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{l={requestedAttributes:w},y&&(l.statusMessage=y.statusMessage,l.type=y.type)},{once:!0});const h=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!h){const y="Failed to initialize WebGL";throw l?(l.message=y,new Error(JSON.stringify(l))):new Error(y)}this.painter=new Dh(h,this.transform),C.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,A=_.now();this.style.zoomHistory.update(v,A);const z=new s.a8(v,{now:A,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=z.crossFadingFactor();D===1&&D===this._crossFadingFactor||(h=!0,this._crossFadingFactor=D),this.style.update(z)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),O.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Fc}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=$i,u.MapTouchEvent=Go,u.MapWheelEvent=Ec,u.Marker=xl,u.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),h=l===this._map.getMaxZoom(),y=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,h)=>{const y=this._map._getUIString(`NavigationControl.${h}`);l.title=y,l.setAttribute("aria-label",y)},this.options=s.e({},Oc,w),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $c(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const h=x.create("button",w,this._container);return h.type="button",h.addEventListener("click",l),h}},u.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?vu(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!l)return;const y=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const A=ku(this.options.offset);if(!v){const D=this._container.offsetWidth,$=this._container.offsetHeight;let W;W=y.y+A.bottom.y<$?["top"]:y.y>this._map.transform.height-$?["bottom"]:[],y.x<D/2?W.push("left"):y.x>this._map.transform.width-D/2&&W.push("right"),v=W.length===0?"bottom":W.join("-")}let z=y.add(A[v]);this.options.subpixelPositioning||(z=z.round()),x.setTransform(this._container,`${wl[v]} translate(${z.x}px,${z.y}px)`),bu(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Nc),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=w;y=h.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(jc);w&&w.focus()}},u.RasterDEMTileSource=cn,u.RasterTileSource=he,u.ScaleControl=class{constructor(w){this._onMove=()=>{Au(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,Au(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xu),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=gu,u.Style=to,u.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Uh,u.TwoFingersTouchRotateHandler=Ic,u.TwoFingersTouchZoomHandler=jh,u.TwoFingersTouchZoomRotateHandler=gl,u.VectorTileSource=tt,u.VideoSource=Kn,u.addSourceType=(w,l)=>s._(void 0,void 0,void 0,function*(){if(Sr(w))throw new Error(`A source type called "${w}" already exists.`);((h,y)=>{fr[h]=y})(w,l)}),u.clearPrewarmedResources=function(){const w=mt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(pt),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return xt().getRTLTextPluginStatus()},u.getVersion=function(){return Zh},u.getWorkerCount=function(){return _t.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(w){return nn().broadcast("IS",w)},u.prewarm=function(){jt().acquire(pt)},u.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},u.setRTLTextPlugin=function(w,l){return xt().setRTLTextPlugin(w,l)},u.setWorkerCount=function(w){_t.workerCount=w},u.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(sw);var ua=sw.exports;const ni=ow(ua),bk=QA({__proto__:null,default:ni},[ua]);let an;const lw=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&lw.decode();let wf=null;function Ef(){return(wf===null||wf.byteLength===0)&&(wf=new Uint8Array(an.memory.buffer)),wf}function Qo(r,e){return r=r>>>0,lw.decode(Ef().subarray(r,r+e))}const oa=new Array(128).fill(void 0);oa.push(void 0,null,!0,!1);let Lf=oa.length;function ti(r){Lf===oa.length&&oa.push(oa.length+1);const e=Lf;return Lf=oa[e],oa[e]=r,e}function Hn(r){return oa[r]}function wk(r){r<132||(oa[r]=Lf,Lf=r)}function Hu(r){const e=Hn(r);return wk(r),e}function Cm(r){return r==null}let xf=null;function xk(){return(xf===null||xf.byteLength===0)&&(xf=new Float64Array(an.memory.buffer)),xf}let Af=null;function Qn(){return(Af===null||Af.byteLength===0)&&(Af=new Int32Array(an.memory.buffer)),Af}let Fa=0;const Ld=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ak=typeof Ld.encodeInto=="function"?function(r,e){return Ld.encodeInto(r,e)}:function(r,e){const t=Ld.encode(r);return e.set(t),{read:r.length,written:t.length}};function yd(r,e,t){if(t===void 0){const s=Ld.encode(r),d=e(s.length,1)>>>0;return Ef().subarray(d,d+s.length).set(s),Fa=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Ef();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Ef().subarray(i+u,i+n),d=Ak(r,s);u+=d.written}return Fa=u,i}function Gm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Gm(r[0]));for(let u=1;u<i;u++)o+=", "+Gm(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function kk(r,e){const t=e(r.length*1,1)>>>0;return Ef().set(r,t/1),Fa=r.length,t}function Tm(r,e){try{return r.apply(this,e)}catch(t){an.__wbindgen_exn_store(ti(t))}}class Vd{static __wrap(e){e=e>>>0;const t=Object.create(Vd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();an.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=an.__wbindgen_add_to_stack_pointer(-16),u=kk(e,an.__wbindgen_malloc),s=Fa;an.jsroutesnapper_new(o,u,s);var t=Qn()[o/4+0],n=Qn()[o/4+1],i=Qn()[o/4+2];if(i)throw Hu(n);return Vd.__wrap(t)}finally{an.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){an.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ti(e))}setAreaMode(){an.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=Qn()[o/4+0],i=Qn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Qn()[n/4+0],t=Qn()[n/4+1];let i;return e!==0&&(i=Qo(e,t).slice(),an.__wbindgen_free(e,t*1)),i}finally{an.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=Qn()[o/4+0],i=Qn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}toggleSnapMode(){an.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return an.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){an.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return an.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return an.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){an.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_editExisting(i,this.__wbg_ptr,ti(e));var t=Qn()[i/4+0],n=Qn()[i/4+1];if(n)throw Hu(t)}finally{an.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=Qn()[o/4+0],i=Qn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=Qn()[o/4+0],i=Qn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,ti(e));var i=Qn()[g/4+0],o=Qn()[g/4+1],u=Qn()[g/4+2],s=Qn()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Hu(u);return t=d,n=p,Qo(d,p)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){an.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){an.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,ti(e));var i=Qn()[g/4+0],o=Qn()[g/4+1],u=Qn()[g/4+2],s=Qn()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Hu(u);return t=d,n=p,Qo(d,p)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const _=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_getExtraNodes(_,this.__wbg_ptr,ti(e),ti(t));var o=Qn()[_/4+0],u=Qn()[_/4+1],s=Qn()[_/4+2],d=Qn()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Hu(s);return n=p,i=g,Qo(p,g)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(n,i,1)}}}async function Sk(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ck(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Qo(e,t);return ti(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Hu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Qo(e,t));return ti(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Hn(t),i=typeof n=="number"?n:void 0;xk()[e/8+1]=Cm(i)?0:i,Qn()[e/4+0]=!Cm(i)},r.wbg.__wbindgen_is_object=function(e){const t=Hn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Hn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Hn(e)in Hn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Hn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Hn(e)==Hn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Hn(t),i=typeof n=="string"?n:void 0;var o=Cm(i)?0:yd(i,an.__wbindgen_malloc,an.__wbindgen_realloc),u=Fa;Qn()[e/4+1]=u,Qn()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Hn(t)),i=yd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Fa;Qn()[e/4+1]=o,Qn()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Hn(e);return ti(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Hn(e)[Hn(t)];return ti(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ti(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Hn(t).stack,i=yd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Fa;Qn()[e/4+1]=o,Qn()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Qo(e,t))}finally{an.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Hn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Hn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Hn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Hn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Hn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Hn(e)[t>>>0];return ti(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Hn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Hn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Hn(e).next;return ti(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Tm(function(e){const t=Hn(e).next();return ti(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Hn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Hn(e).value;return ti(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ti(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Tm(function(e,t){const n=Reflect.get(Hn(e),Hn(t));return ti(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Tm(function(e,t){const n=Hn(e).call(Hn(t));return ti(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Hn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Hn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Hn(e).buffer;return ti(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Hn(e));return ti(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Hn(e).set(Hn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Hn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Hn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Gm(Hn(t)),i=yd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Fa;Qn()[e/4+1]=o,Qn()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Qo(e,t))},r.wbg.__wbindgen_memory=function(){const e=an.memory;return ti(e)},r}function Tk(r,e){return an=r.exports,uw.__wbindgen_wasm_module=e,xf=null,Af=null,wf=null,an}async function uw(r){if(an!==void 0)return an;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Ck();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Sk(await r,e);return Tk(t,n)}var Wi=63710088e-1,Fg={centimeters:Wi*100,centimetres:Wi*100,degrees:Wi/111325,feet:Wi*3.28084,inches:Wi*39.37,kilometers:Wi/1e3,kilometres:Wi/1e3,meters:Wi,metres:Wi,miles:Wi/1609.344,millimeters:Wi*1e3,millimetres:Wi*1e3,nauticalmiles:Wi/1852,radians:1,yards:Wi*1.0936},Mk={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Wi,yards:1.0936133},Wm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ss(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ek(r,e,t){switch(r){case"Point":return yo(e).geometry;case"LineString":return ts(e).geometry;case"Polygon":return Og(e).geometry;case"MultiPoint":return fw(e).geometry;case"MultiLineString":return cw(e).geometry;case"MultiPolygon":return hw(e).geometry;default:throw new Error(r+" is invalid")}}function yo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qd(r[0])||!qd(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ss(n,e,t)}function Lk(r,e,t){return t===void 0&&(t={}),Dl(r.map(function(n){return yo(n,e)}),t)}function Og(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return ss(s,e,t)}function Ik(r,e,t){return t===void 0&&(t={}),Dl(r.map(function(n){return Og(n,e)}),t)}function ts(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ss(n,e,t)}function Pk(r,e,t){return t===void 0&&(t={}),Dl(r.map(function(n){return ts(n,e)}),t)}function Dl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function cw(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ss(n,e,t)}function fw(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ss(n,e,t)}function hw(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ss(n,e,t)}function zk(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ss(n,e,t)}function Dk(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function $g(r,e){e===void 0&&(e="kilometers");var t=Fg[e];if(!t)throw new Error(e+" units is invalid");return r*t}function ip(r,e){e===void 0&&(e="kilometers");var t=Fg[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Rk(r,e){return Uf(ip(r,e))}function Bk(r){var e=r%360;return e<0&&(e+=360),e}function Uf(r){var e=r%(2*Math.PI);return e*180/Math.PI}function ns(r){var e=r%360;return e*Math.PI/180}function Fk(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return $g(ip(r,e),t)}function Ok(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Wm[e];if(!n)throw new Error("invalid original units");var i=Wm[t];if(!i)throw new Error("invalid final units");return r/n*i}function qd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ng(r){return!!r&&r.constructor===Object}function $k(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!qd(e))throw new Error("bbox must only contain numbers")})}function Nk(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const jk=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Wm,bearingToAzimuth:Bk,convertArea:Ok,convertLength:Fk,degreesToRadians:ns,earthRadius:Wi,factors:Fg,feature:ss,featureCollection:Dl,geometry:Ek,geometryCollection:zk,isNumber:qd,isObject:Ng,lengthToDegrees:Rk,lengthToRadians:ip,lineString:ts,lineStrings:Pk,multiLineString:cw,multiPoint:fw,multiPolygon:hw,point:yo,points:Lk,polygon:Og,polygons:Ik,radiansToDegrees:Uf,radiansToLength:$g,round:Dk,unitsFactors:Mk,validateBBox:$k,validateId:Nk},Symbol.toStringTag,{value:"Module"}));function Vf(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function eh(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",P=C==="Feature",I=T?r.features.length:1,E=0;E<I;E++){p=T?r.features[E].geometry:P?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var L=0;L<s;L++){var O=0,F=0;if(u=x?p.geometries[L]:p,u!==null){d=u.coordinates;var Z=u.type;switch(g=t&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,_,E,O,F)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,E,O,F)===!1)return!1;_++,Z==="MultiPoint"&&O++}Z==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,E,O,F)===!1)return!1;_++}Z==="MultiLineString"&&O++,Z==="Polygon"&&F++}Z==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(F=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,E,O,F)===!1)return!1;_++}F++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(eh(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Uk(r,e,t,n){var i=t;return eh(r,function(o,u,s,d,p){u===0&&t===void 0?i=o:i=e(i,o,u,s,d,p)},n),i}function dw(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Vk(r,e,t){var n=t;return dw(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Hd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function qk(r,e,t){var n=t;return Hd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Hk(r){var e=[];return eh(r,function(t){e.push(t)}),e}function jg(r,e){var t,n,i,o,u,s,d,p,g,_,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",P=C?r.features.length:1;for(t=0;t<P;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,_=C?r.features[t].id:T?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function Gk(r,e,t){var n=t;return jg(r,function(i,o,u,s,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,s,d)}),n}function uc(r,e){jg(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(ss(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(ss(_,i),n,p)===!1)return!1}})}function Wk(r,e,t){var n=t;return uc(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function pw(r,e){uc(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var s,d=0,p=0,g=0;if(eh(t,function(_,x,C,T,P){if(s===void 0||n>d||T>p||P>g){s=_,d=n,p=T,g=P,o=0;return}var I=ts([s,_],t.properties);if(e(I,n,i,P,o)===!1)return!1;o++,s=_})===!1)return!1}}})}function Zk(r,e,t){var n=t,i=!1;return pw(r,function(o,u,s,d,p){i===!1&&t===void 0?n=o:n=e(n,o,u,s,d,p),i=!0}),n}function mw(r,e){if(!r)throw new Error("geojson is required");uc(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<u.length;s++)if(e(ts(u[s],t.properties),n,i,s)===!1)return!1;break}}})}function Xk(r,e,t){var n=t;return mw(r,function(i,o,u,s){o===0&&t===void 0?n=i:n=e(n,i,o,u,s)}),n}function Kk(r,e){if(e=e||{},!Ng(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),ts([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),ts([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),ts([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),ts([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function Jk(r,e){if(e=e||{},!Ng(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":return yo(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),yo(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),yo(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),yo(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),yo(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),yo(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const Yk=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Hk,coordEach:eh,coordReduce:Uk,featureEach:Hd,featureReduce:qk,findPoint:Jk,findSegment:Kk,flattenEach:uc,flattenReduce:Wk,geomEach:jg,geomReduce:Gk,lineEach:mw,lineReduce:Xk,propEach:dw,propReduce:Vk,segmentEach:pw,segmentReduce:Zk},Symbol.toStringTag,{value:"Module"}));function gw(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Qk(r,e);var n=Vf(r),i=Vf(e),o=ns(n[0]),u=ns(i[0]),s=ns(n[1]),d=ns(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return Uf(Math.atan2(p,g))}function Qk(r,e){var t=gw(e,r);return t=(t+180)%360,t}function ff(r,e,t){t===void 0&&(t={});var n=Vf(r),i=Vf(e),o=ns(i[1]-n[1]),u=ns(i[0]-n[0]),s=ns(n[1]),d=ns(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return $g(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function W0(r,e,t,n){n===void 0&&(n={});var i=Vf(r),o=ns(i[0]),u=ns(i[1]),s=ns(t),d=ip(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),_=Uf(g),x=Uf(p);return yo([_,x],n.properties)}function Z0(r){if(!r)throw new Error("geojson is required");var e=[];return uc(r,function(t){e3(t,e)}),Dl(e)}function e3(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=tc(n);break;case"LineString":t=[tc(n)]}t.forEach(function(i){var o=t3(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function t3(r,e){var t=[];return r.reduce(function(n,i){var o=ts([n,i],e);return o.bbox=n3(n,i),t.push(o),i}),t}function n3(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,s=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[u,s,d,p]}var Ug={exports:{}},_w={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(iw,function(){function t(L,O,F,Z,K){(function q(J,fe,Ee,ee,ie){for(;ee>Ee;){if(ee-Ee>600){var ve=ee-Ee+1,ye=fe-Ee+1,it=Math.log(ve),Be=.5*Math.exp(2*it/3),Ne=.5*Math.sqrt(it*Be*(ve-Be)/ve)*(ye-ve/2<0?-1:1),Ie=Math.max(Ee,Math.floor(fe-ye*Be/ve+Ne)),ot=Math.min(ee,Math.floor(fe+(ve-ye)*Be/ve+Ne));q(J,fe,Ie,ot,ie)}var Ke=J[fe],ut=Ee,pt=ee;for(n(J,Ee,fe),ie(J[ee],Ke)>0&&n(J,Ee,ee);ut<pt;){for(n(J,ut,pt),ut++,pt--;ie(J[ut],Ke)<0;)ut++;for(;ie(J[pt],Ke)>0;)pt--}ie(J[Ee],Ke)===0?n(J,Ee,pt):n(J,++pt,ee),pt<=fe&&(Ee=pt+1),fe<=pt&&(ee=pt-1)}})(L,O,F||0,Z||L.length-1,K||i)}function n(L,O,F){var Z=L[O];L[O]=L[F],L[F]=Z}function i(L,O){return L<O?-1:L>O?1:0}var o=function(L){L===void 0&&(L=9),this._maxEntries=Math.max(4,L),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(L,O,F){if(!F)return O.indexOf(L);for(var Z=0;Z<O.length;Z++)if(F(L,O[Z]))return Z;return-1}function s(L,O){d(L,0,L.children.length,O,L)}function d(L,O,F,Z,K){K||(K=I(null)),K.minX=1/0,K.minY=1/0,K.maxX=-1/0,K.maxY=-1/0;for(var q=O;q<F;q++){var J=L.children[q];p(K,L.leaf?Z(J):J)}return K}function p(L,O){return L.minX=Math.min(L.minX,O.minX),L.minY=Math.min(L.minY,O.minY),L.maxX=Math.max(L.maxX,O.maxX),L.maxY=Math.max(L.maxY,O.maxY),L}function g(L,O){return L.minX-O.minX}function _(L,O){return L.minY-O.minY}function x(L){return(L.maxX-L.minX)*(L.maxY-L.minY)}function C(L){return L.maxX-L.minX+(L.maxY-L.minY)}function T(L,O){return L.minX<=O.minX&&L.minY<=O.minY&&O.maxX<=L.maxX&&O.maxY<=L.maxY}function P(L,O){return O.minX<=L.maxX&&O.minY<=L.maxY&&O.maxX>=L.minX&&O.maxY>=L.minY}function I(L){return{children:L,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(L,O,F,Z,K){for(var q=[O,F];q.length;)if(!((F=q.pop())-(O=q.pop())<=Z)){var J=O+Math.ceil((F-O)/Z/2)*Z;t(L,J,O,F,K),q.push(O,J,J,F)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(L){var O=this.data,F=[];if(!P(L,O))return F;for(var Z=this.toBBox,K=[];O;){for(var q=0;q<O.children.length;q++){var J=O.children[q],fe=O.leaf?Z(J):J;P(L,fe)&&(O.leaf?F.push(J):T(L,fe)?this._all(J,F):K.push(J))}O=K.pop()}return F},o.prototype.collides=function(L){var O=this.data;if(!P(L,O))return!1;for(var F=[];O;){for(var Z=0;Z<O.children.length;Z++){var K=O.children[Z],q=O.leaf?this.toBBox(K):K;if(P(L,q)){if(O.leaf||T(L,q))return!0;F.push(K)}}O=F.pop()}return!1},o.prototype.load=function(L){if(!L||!L.length)return this;if(L.length<this._minEntries){for(var O=0;O<L.length;O++)this.insert(L[O]);return this}var F=this._build(L.slice(),0,L.length-1,0);if(this.data.children.length)if(this.data.height===F.height)this._splitRoot(this.data,F);else{if(this.data.height<F.height){var Z=this.data;this.data=F,F=Z}this._insert(F,this.data.height-F.height-1,!0)}else this.data=F;return this},o.prototype.insert=function(L){return L&&this._insert(L,this.data.height-1),this},o.prototype.clear=function(){return this.data=I([]),this},o.prototype.remove=function(L,O){if(!L)return this;for(var F,Z,K,q=this.data,J=this.toBBox(L),fe=[],Ee=[];q||fe.length;){if(q||(q=fe.pop(),Z=fe[fe.length-1],F=Ee.pop(),K=!0),q.leaf){var ee=u(L,q.children,O);if(ee!==-1)return q.children.splice(ee,1),fe.push(q),this._condense(fe),this}K||q.leaf||!T(q,J)?Z?(F++,q=Z.children[F],K=!1):q=null:(fe.push(q),Ee.push(F),F=0,Z=q,q=q.children[0])}return this},o.prototype.toBBox=function(L){return L},o.prototype.compareMinX=function(L,O){return L.minX-O.minX},o.prototype.compareMinY=function(L,O){return L.minY-O.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(L){return this.data=L,this},o.prototype._all=function(L,O){for(var F=[];L;)L.leaf?O.push.apply(O,L.children):F.push.apply(F,L.children),L=F.pop();return O},o.prototype._build=function(L,O,F,Z){var K,q=F-O+1,J=this._maxEntries;if(q<=J)return s(K=I(L.slice(O,F+1)),this.toBBox),K;Z||(Z=Math.ceil(Math.log(q)/Math.log(J)),J=Math.ceil(q/Math.pow(J,Z-1))),(K=I([])).leaf=!1,K.height=Z;var fe=Math.ceil(q/J),Ee=fe*Math.ceil(Math.sqrt(J));E(L,O,F,Ee,this.compareMinX);for(var ee=O;ee<=F;ee+=Ee){var ie=Math.min(ee+Ee-1,F);E(L,ee,ie,fe,this.compareMinY);for(var ve=ee;ve<=ie;ve+=fe){var ye=Math.min(ve+fe-1,ie);K.children.push(this._build(L,ve,ye,Z-1))}}return s(K,this.toBBox),K},o.prototype._chooseSubtree=function(L,O,F,Z){for(;Z.push(O),!O.leaf&&Z.length-1!==F;){for(var K=1/0,q=1/0,J=void 0,fe=0;fe<O.children.length;fe++){var Ee=O.children[fe],ee=x(Ee),ie=(ve=L,ye=Ee,(Math.max(ye.maxX,ve.maxX)-Math.min(ye.minX,ve.minX))*(Math.max(ye.maxY,ve.maxY)-Math.min(ye.minY,ve.minY))-ee);ie<q?(q=ie,K=ee<K?ee:K,J=Ee):ie===q&&ee<K&&(K=ee,J=Ee)}O=J||O.children[0]}var ve,ye;return O},o.prototype._insert=function(L,O,F){var Z=F?L:this.toBBox(L),K=[],q=this._chooseSubtree(Z,this.data,O,K);for(q.children.push(L),p(q,Z);O>=0&&K[O].children.length>this._maxEntries;)this._split(K,O),O--;this._adjustParentBBoxes(Z,K,O)},o.prototype._split=function(L,O){var F=L[O],Z=F.children.length,K=this._minEntries;this._chooseSplitAxis(F,K,Z);var q=this._chooseSplitIndex(F,K,Z),J=I(F.children.splice(q,F.children.length-q));J.height=F.height,J.leaf=F.leaf,s(F,this.toBBox),s(J,this.toBBox),O?L[O-1].children.push(J):this._splitRoot(F,J)},o.prototype._splitRoot=function(L,O){this.data=I([L,O]),this.data.height=L.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(L,O,F){for(var Z,K,q,J,fe,Ee,ee,ie=1/0,ve=1/0,ye=O;ye<=F-O;ye++){var it=d(L,0,ye,this.toBBox),Be=d(L,ye,F,this.toBBox),Ne=(K=it,q=Be,J=void 0,fe=void 0,Ee=void 0,ee=void 0,J=Math.max(K.minX,q.minX),fe=Math.max(K.minY,q.minY),Ee=Math.min(K.maxX,q.maxX),ee=Math.min(K.maxY,q.maxY),Math.max(0,Ee-J)*Math.max(0,ee-fe)),Ie=x(it)+x(Be);Ne<ie?(ie=Ne,Z=ye,ve=Ie<ve?Ie:ve):Ne===ie&&Ie<ve&&(ve=Ie,Z=ye)}return Z||F-O},o.prototype._chooseSplitAxis=function(L,O,F){var Z=L.leaf?this.compareMinX:g,K=L.leaf?this.compareMinY:_;this._allDistMargin(L,O,F,Z)<this._allDistMargin(L,O,F,K)&&L.children.sort(Z)},o.prototype._allDistMargin=function(L,O,F,Z){L.children.sort(Z);for(var K=this.toBBox,q=d(L,0,O,K),J=d(L,F-O,F,K),fe=C(q)+C(J),Ee=O;Ee<F-O;Ee++){var ee=L.children[Ee];p(q,L.leaf?K(ee):ee),fe+=C(q)}for(var ie=F-O-1;ie>=O;ie--){var ve=L.children[ie];p(J,L.leaf?K(ve):ve),fe+=C(J)}return fe},o.prototype._adjustParentBBoxes=function(L,O,F){for(var Z=F;Z>=0;Z--)p(O[Z],L)},o.prototype._condense=function(L){for(var O=L.length-1,F=void 0;O>=0;O--)L[O].children.length===0?O>0?(F=L[O-1].children).splice(F.indexOf(L[O]),1):this.clear():s(L[O],this.toBBox)},o})})(_w);var r3=_w.exports;const i3=Bg(jk),o3=Bg(Yk);function yw(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",P=C==="Feature",I=T?r.features.length:1,E=0;E<I;E++){p=T?r.features[E].geometry:P?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var L=0;L<s;L++){var O=0,F=0;if(u=x?p.geometries[L]:p,u!==null){d=u.coordinates;var Z=u.type;switch(g=t&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,_,E,O,F)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,E,O,F)===!1)return!1;_++,Z==="MultiPoint"&&O++}Z==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,E,O,F)===!1)return!1;_++}Z==="MultiLineString"&&O++,Z==="Polygon"&&F++}Z==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(F=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,E,O,F)===!1)return!1;_++}F++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(yw(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function vw(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return yw(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var s3=vw;const a3=Object.freeze(Object.defineProperty({__proto__:null,bbox:vw,default:s3},Symbol.toStringTag,{value:"Module"})),l3=Bg(a3);var Bs=r3,bw=i3,ww=o3,Ou=l3.default,u3=ww.featureEach;ww.coordEach;bw.polygon;var X0=bw.featureCollection;function xw(r){var e=new Bs(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ou(t),Bs.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Ou(i),n.push(i)}):u3(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Ou(i),n.push(i)}),Bs.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ou(t),Bs.prototype.remove.call(this,t,n)},e.clear=function(){return Bs.prototype.clear.call(this)},e.search=function(t){var n=Bs.prototype.search.call(this,this.toBBox(t));return X0(n)},e.collides=function(t){return Bs.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Bs.prototype.all.call(this);return X0(t)},e.toJSON=function(){return Bs.prototype.toJSON.call(this)},e.fromJSON=function(t){return Bs.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Ou(t);else if(t.type==="FeatureCollection")n=Ou(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ug.exports=xw;Ug.exports.default=xw;var c3=Ug.exports;const f3=ow(c3);function h3(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ss(r)),e.type==="LineString"&&(e=ss(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=K0(r,e);return i&&n.push(i),Dl(n)}var o=f3();return o.load(Z0(e)),Hd(Z0(r),function(u){Hd(o.search(u),function(s){var d=K0(u,s);if(d){var p=tc(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),Dl(n)}function K0(r,e){var t=tc(r),n=tc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],s=t[1][1],d=n[0][0],p=n[0][1],g=n[1][0],_=n[1][1],x=(_-p)*(u-i)-(g-d)*(s-o),C=(g-d)*(o-p)-(_-p)*(i-d),T=(u-i)*(o-p)-(s-o)*(i-d);if(x===0)return null;var P=C/x,I=T/x;if(P>=0&&P<=1&&I>=0&&I<=1){var E=i+P*(u-i),L=o+P*(s-o);return yo([E,L])}return null}function d3(r,e,t){t===void 0&&(t={});var n=yo([1/0,1/0],{dist:1/0}),i=0;return uc(r,function(o){for(var u=tc(o),s=0;s<u.length-1;s++){var d=yo(u[s]);d.properties.dist=ff(e,d,t);var p=yo(u[s+1]);p.properties.dist=ff(e,p,t);var g=ff(d,p,t),_=Math.max(d.properties.dist,p.properties.dist),x=gw(d,p),C=W0(e,_,x+90,t),T=W0(e,_,x-90,t),P=h3(ts([C.geometry.coordinates,T.geometry.coordinates]),ts([d.geometry.coordinates,p.geometry.coordinates])),I=null;P.features.length>0&&(I=P.features[0],I.properties.dist=ff(e,I,t),I.properties.location=i+ff(d,I,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=s,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=s+1,n.properties.location=i+g),I&&I.properties.dist<n.properties.dist&&(n=I,n.properties.index=s),i+=g}}),n}const p3=30;class m3{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const s=[u.point.x-p3,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Vd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const $u=[];function Id(r,e){return{subscribe:Ln(r,e).subscribe}}function Ln(r,e=at){let t;const n=new Set;function i(s){if(St(r,s)&&(r=s,t)){const d=!$u.length;for(const p of n)p[1](),$u.push(p,r);if(d){for(let p=0;p<$u.length;p+=2)$u[p][0]($u[p+1]);$u.length=0}}}function o(s){i(s(r))}function u(s,d=at){const p=[s,d];return n.add(p),n.size===1&&(t=e(i,o)||at),s(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}function Aw(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return Id(t,(u,s)=>{let d=!1;const p=[];let g=0,_=at;const x=()=>{if(g)return;_();const T=e(n?p[0]:p,u,s);o?u(T):_=Ga(T)?T:at},C=i.map((T,P)=>Eg(T,I=>{p[P]=I,g&=~(1<<P),d&&x()},()=>{g|=1<<P}));return d=!0,x(),function(){cr(C),_(),d=!1}})}class g3{constructor(){Yn(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty — nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new Mm(n,1,Pd);for(const[o,u]of _3(n))for(const{projectKey:s,projectName:d}of u){let p=window.localStorage.getItem(s);if(!p){console.warn(`Project features not found for ${s}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=d,console.log(`migrating project ${s}`);let _=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${s} -> ${i.projectKey(_)}`),window.localStorage.removeItem(s)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new Mm(n,2,Pd);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new Mm(e,this.storedSchemaVersion,Pd)}}const Pd=Symbol("internal_method_token");class Mm{constructor(e,t,n){Yn(this,"appFocus");Yn(this,"dbSchemaVersion");if(n!==Pd)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t="My neighbourhood",i=this.project(e).features.filter(s=>{var d;return((d=s.properties)==null?void 0:d.kind)=="boundary"}),o=t,u=1;for(;i.some(s=>{var d;return((d=s.properties)==null?void 0:d.name)==o});)u++,o=`${t} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function _3(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,s,d]=o.split("/");e.has(s)||e.set(s,[]),e.get(s).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),s=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:s})):t.push({projectKey:o,projectName:s})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const kw="MZEJTanw3WpxRvt7qDfo";let as=Ln(null),As=Ln("global"),$s=Ln(void 0),y3=Aw($s,r=>{if(r)return gi(Wa).project(r)}),Da=Ln(void 0),Sw=new g3,Wa=Aw(As,r=>Sw.projectStorage(r)),J0=Ln(!0),Gd=Ln(!1),Ir=Ln(null),If=Ln(new ua.LngLat(0,0)),Pf=Ln(new ua.LngLat(0,0)),vd=Ln(new ua.LngLat(0,0)),Y0=Ln(1),Zi=Ln(1),tr=Ln({mode:"title",firstLoad:!0}),zf=Ln(!1),Zm=Ln("streets-v2"),Xm=Ln("walk_cycle_only"),Q0=Ln(!1),Km=Ln(!0),Wd=Ln(!0),Zd=Ln("shortcuts"),Jm=Ln(!1),Ym=Ln(!0),ey=Ln(500);function qf(){const r=gi($s);try{gi(Wa).saveProject(r,gi(Ir).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let Qm=Ln(!1);function $o(r){return gi(Qm)?`/${r}`:`https://assets.od2net.org/${r}`}function eg(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const s=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*s;return new ua.LngLat(u,d)}const t=(n=gi(as))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(gi(r))||r.set(e(t))}function v3(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=oe(),n=U("p"),n.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,i=oe(),o=U("ul"),o.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,u=oe(),s=U("p"),s.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the tool’s development, particular thanks to:`,d=oe(),p=U("ul"),p.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li>',g=oe(),_=U("p"),_.textContent="This tool would not be possible without:",x=oe(),C=U("ul"),C.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',T=oe(),P=U("p"),P.textContent="Some road signs images © Crown copyright."},m(I,E){G(I,e,E),G(I,t,E),G(I,n,E),G(I,i,E),G(I,o,E),G(I,u,E),G(I,s,E),G(I,d,E),G(I,p,E),G(I,g,E),G(I,_,E),G(I,x,E),G(I,C,E),G(I,T,E),G(I,P,E)},p:at,d(I){I&&(H(e),H(t),H(n),H(i),H(o),H(u),H(s),H(d),H(p),H(g),H(_),H(x),H(C),H(T),H(P))}}}function b3(r){let e,t,n;function i(u){r[1](u)}let o={$$slots:{default:[v3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Rg({props:o}),dn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&4&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function w3(r,e,t){let n;ct(r,Gd,o=>t(0,n=o));function i(o){n=o,Gd.set(n)}return[n,i]}class x3 extends Et{constructor(e){super(),Mt(this,e,w3,b3,St,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const A3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},ty=A3;function ny(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Em(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=zt(n,t[i]);return{c(){e=ws(r[11]),Ud(e,n)},m(i,o){G(i,e,o)},p(i,o){Ud(e,n=In(t,[o&32&&i[12]]))},d(i){i&&H(e)}}}function ry(r){let e=r[11],t,n=r[11]&&Em(r);return{c(){n&&n.c(),t=nr()},m(i,o){n&&n.m(i,o),G(i,t,o)},p(i,o){i[11]?e?St(e,i[11])?(n.d(1),n=Em(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Em(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&H(t),n&&n.d(i)}}}function k3(r){let e,t,n,i,o,u=On(r[5]),s=[];for(let x=0;x<u.length;x+=1)s[x]=ry(ny(r,u,x));const d=r[10].default,p=vn(d,r,r[9],null);let g=[ty,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],_={};for(let x=0;x<g.length;x+=1)_=zt(_,g[x]);return{c(){e=ws("svg");for(let x=0;x<s.length;x+=1)s[x].c();t=nr(),p&&p.c(),Ud(e,_)},m(x,C){G(x,e,C);for(let T=0;T<s.length;T+=1)s[T]&&s[T].m(e,null);B(e,t),p&&p.m(e,null),o=!0},p(x,[C]){if(C&32){u=On(x[5]);let T;for(T=0;T<u.length;T+=1){const P=ny(x,u,T);s[T]?s[T].p(P,C):(s[T]=ry(P),s[T].c(),s[T].m(e,t))}for(;T<s.length;T+=1)s[T].d(1);s.length=u.length}p&&p.p&&(!o||C&512)&&wn(p,d,x,x[9],o?bn(d,x[9],C,null):xn(x[9]),null),Ud(e,_=In(g,[ty,C&128&&x[7],(!o||C&4)&&{width:x[2]},(!o||C&4)&&{height:x[2]},(!o||C&2)&&{stroke:x[1]},(!o||C&28&&n!==(n=x[4]?Number(x[3])*24/Number(x[2]):x[3]))&&{"stroke-width":n},(!o||C&257&&i!==(i=x[6]("lucide-icon","lucide",x[0]?`lucide-${x[0]}`:"",x[8].class)))&&{class:i}]))},i(x){o||(N(p,x),o=!0)},o(x){V(p,x),o=!1},d(x){x&&H(e),_i(s,x),p&&p.d(x)}}}function S3(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=V0(e,n),{$$slots:o={},$$scope:u}=e,{name:s=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:_=!1}=e,{iconNode:x=[]}=e;const C=(...T)=>T.filter((P,I,E)=>!!P&&E.indexOf(P)===I).join(" ");return r.$$set=T=>{t(8,e=zt(zt({},e),gr(T))),t(7,i=V0(e,n)),"name"in T&&t(0,s=T.name),"color"in T&&t(1,d=T.color),"size"in T&&t(2,p=T.size),"strokeWidth"in T&&t(3,g=T.strokeWidth),"absoluteStrokeWidth"in T&&t(4,_=T.absoluteStrokeWidth),"iconNode"in T&&t(5,x=T.iconNode),"$$scope"in T&&t(9,u=T.$$scope)},e=gr(e),[s,d,p,g,_,x,C,i,e,u,o]}class C3 extends Et{constructor(e){super(),Mt(this,e,S3,k3,St,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const Ao=C3;function T3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function M3(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[T3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function E3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class L3 extends Et{constructor(e){super(),Mt(this,e,E3,M3,St,{})}}const I3=L3;function P3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function z3(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[P3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function D3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class R3 extends Et{constructor(e){super(),Mt(this,e,D3,z3,St,{})}}const B3=R3;function F3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function O3(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[F3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function $3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class N3 extends Et{constructor(e){super(),Mt(this,e,$3,O3,St,{})}}const j3=N3;function U3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function V3(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[U3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function q3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class H3 extends Et{constructor(e){super(),Mt(this,e,q3,V3,St,{})}}const G3=H3;function W3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Z3(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[W3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function X3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class K3 extends Et{constructor(e){super(),Mt(this,e,X3,Z3,St,{})}}const J3=K3;function Y3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Q3(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Y3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function e4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class t4 extends Et{constructor(e){super(),Mt(this,e,e4,Q3,St,{})}}const Cw=t4;function n4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function r4(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[n4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function i4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class o4 extends Et{constructor(e){super(),Mt(this,e,i4,r4,St,{})}}const s4=o4;function a4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function l4(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[a4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function u4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class c4 extends Et{constructor(e){super(),Mt(this,e,u4,l4,St,{})}}const f4=c4;function h4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function d4(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[h4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function p4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class m4 extends Et{constructor(e){super(),Mt(this,e,p4,d4,St,{})}}const Tw=m4;function g4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function _4(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[g4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function y4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class v4 extends Et{constructor(e){super(),Mt(this,e,y4,_4,St,{})}}const Vg=v4;function b4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function w4(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[b4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function x4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class A4 extends Et{constructor(e){super(),Mt(this,e,x4,w4,St,{})}}const Mw=A4;function k4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function S4(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[k4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function C4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class T4 extends Et{constructor(e){super(),Mt(this,e,C4,S4,St,{})}}const M4=T4;function E4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function L4(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[E4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function I4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class P4 extends Et{constructor(e){super(),Mt(this,e,I4,L4,St,{})}}const qg=P4;function z4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function D4(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[z4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ao({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?In(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function R4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),gr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=gr(e),[o,e,n,i]}class B4 extends Et{constructor(e){super(),Mt(this,e,R4,D4,St,{})}}const F4=B4;let O4=Date.now();function Fl(r){return`${r}-${O4++}`}const Hg=Symbol.for("svelte-maplibre");function Za(){return Yf(Hg)}function $4(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(s=>{var d;return(d=r.get(s.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function N4(){let r=new Map;return np(Hg,{map:Ln(null),source:Id(null),layer:Id(null),popupTarget:Id(null),cluster:Ln(),loadedImages:Ln(new Set),minzoom:Ln(0),maxzoom:Ln(24),layerEvent:Ln(null),layerInfo:r,eventTopMost:$4(r),markerClickManager:new V4})}function iy(r){return{subscribe:r.subscribe}}function Gg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Za(),o=Ln(null),u=iy(o),s={...i,[r]:iy(o)};if(e&&(s.popupTarget=u),n){let d=Ln(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=Ln()),np(Hg,s),{...i,self:o}}function Ew(){return Gg({key:"source",setCluster:!0})}function Lw(r=!0){return Gg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function j4(){return Gg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function U4(r){return"layerType"in r&&r.layerType==="deckgl"}class V4{constructor(){Yn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function oy(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function q4(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function H4(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function er(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Na=G4;function G4(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],s=r[u];s!=null&&(e[u]=s)}return e}}}function sy(r){let e=r[0],t,n,i=ay(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),G(o,t,u),n=!0},p(o,u){u[0]&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=ay(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function ay(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function W4(r){let e,t,n=r[0]&&sy(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=sy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function Z4(r,e,t){let n,i,o,u,s,d,p,g,_,x,C,T,{$$slots:P={},$$scope:I}=e,{id:E=Fl("layer")}=e,{source:L=void 0}=e,{sourceLayer:O=void 0}=e,{beforeId:F=void 0}=e,{beforeLayerType:Z=void 0}=e,{type:K}=e,{paint:q=void 0}=e,{layout:J=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:Ee=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:ie=void 0}=e,{manageHoverState:ve=!1}=e,{hovered:ye=null}=e,{interactive:it=!0}=e,{hoverCursor:Be=void 0}=e,{eventsIfTopMost:Ne=!1}=e;const Ie=js(),{map:ot,source:Ke,self:ut,minzoom:pt,maxzoom:_t,eventTopMost:He,layerInfo:mt}=Lw();ct(r,ot,qe=>t(31,_=qe)),ct(r,Ke,qe=>t(32,x=qe)),ct(r,ut,qe=>t(0,g=qe)),ct(r,pt,qe=>t(34,T=qe)),ct(r,_t,qe=>t(33,C=qe)),ri(()=>{g&&_&&(mt.delete(g),_==null||_.removeLayer(g))});let Pt;function jt(qe){var he,cn;if(!it||!g||!_||Ne&&He(qe)!==g)return;let Ge=qe.features??[],At=(cn=(he=Ge[0])==null?void 0:he.properties)==null?void 0:cn.cluster_id,tt={event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge};Ie(qe.type,tt)}function un(qe){var he,cn;if(!it||!g||!_||Ne&&He(qe)!==g)return;Be&&(_.getCanvas().style.cursor=Be);let Ge=qe.features??[];t(6,ye=Ge[0]??null);let At=(cn=(he=Ge[0])==null?void 0:he.properties)==null?void 0:cn.cluster_id;Ie("mouseenter",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function nn(qe){var he,cn,Xe;if(!it||!_)return;if(Ne&&He(qe)!==g){t(6,ye=null),ve&&Pt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:O,id:Pt},{hover:!1}),Pt=void 0);return}_.getCanvas().style.cursor=Be;let Ge=qe.features??[],At=(cn=(he=Ge[0])==null?void 0:he.properties)==null?void 0:cn.cluster_id,tt=(Xe=Ge[0])==null?void 0:Xe.id;tt!==Pt&&(ve&&(Pt!==void 0&&(_==null||_.setFeatureState({source:s,id:Pt,sourceLayer:O},{hover:!1})),_==null||_.setFeatureState({source:s,id:tt,sourceLayer:O},{hover:!0})),Pt=tt,t(6,ye=Ge[0]??null)),Ie("mousemove",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function rn(qe){if(!(!it||!g||!_)){if(Be&&(_.getCanvas().style.cursor=""),t(6,ye=null),ve&&Pt!==void 0){const Ge={source:s,id:Pt,sourceLayer:O};_==null||_.setFeatureState(Ge,{hover:!1}),Pt=void 0}Ie("mouseleave",{map:_,layer:g,source:s})}}let pn=!0;function yn(qe){_&&(_.off("click",qe,jt),_.off("dblclick",qe,jt),_.off("contextmenu",qe,jt),_.off("mouseenter",qe,un),_.off("mousemove",qe,nn),_.off("mouseleave",qe,rn))}return ri(()=>{_&&g&&yn(g)}),r.$$set=qe=>{"id"in qe&&t(7,E=qe.id),"source"in qe&&t(8,L=qe.source),"sourceLayer"in qe&&t(9,O=qe.sourceLayer),"beforeId"in qe&&t(10,F=qe.beforeId),"beforeLayerType"in qe&&t(11,Z=qe.beforeLayerType),"type"in qe&&t(12,K=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,J=qe.layout),"filter"in qe&&t(15,fe=qe.filter),"applyToClusters"in qe&&t(16,Ee=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,ie=qe.maxzoom),"manageHoverState"in qe&&t(19,ve=qe.manageHoverState),"hovered"in qe&&t(6,ye=qe.hovered),"interactive"in qe&&t(20,it=qe.interactive),"hoverCursor"in qe&&t(21,Be=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,Ne=qe.eventsIfTopMost),"$$scope"in qe&&t(35,I=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=H4(Ee)),r.$$.dirty[0]&1073774592&&t(24,i=q4("all",n,fe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=ie??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=L||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==E&&s){g&&(yn(g),mt.delete(g));let qe=F;if(!F&&Z){let Ge=_.getStyle().layers,At=typeof Z=="function"?Z:he=>he.type===Z,tt=Ge==null?void 0:Ge.find(At);tt&&(qe=tt.id)}ln(ut,g=E,g),_.addLayer(Na({id:g,type:K,source:s,"source-layer":O,filter:i,paint:q,layout:J,minzoom:o,maxzoom:u}),qe),t(23,pn=!0),_.on("click",g,jt),_.on("dblclick",g,jt),_.on("contextmenu",g,jt),_.on("mouseenter",g,un),_.on("mousemove",g,nn),_.on("mouseleave",g,rn)}r.$$.dirty[0]&1048577&&g&&mt.set(g,{interactive:it}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?oy((qe,Ge)=>{_!=null&&_.style._loaded?_.setPaintProperty(g,qe,Ge):_==null||_.once("styledata",()=>_==null?void 0:_.setPaintProperty(g,qe,Ge))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?oy((qe,Ge)=>{_!=null&&_.style._loaded?_.setLayoutProperty(g,qe,Ge):_==null||_.once("styledata",()=>_==null?void 0:_.setLayoutProperty(g,qe,Ge))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(q)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(pn?t(23,pn=!1):_==null||_.setFilter(g,i))},[g,ot,Ke,ut,pt,_t,ye,E,L,O,F,Z,K,q,J,fe,Ee,ee,ie,ve,it,Be,Ne,pn,i,u,o,p,d,s,n,_,x,C,T,I,P]}let op=class extends Et{constructor(e){super(),Mt(this,e,Z4,W4,St,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function X4(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function K4(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[X4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new op({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function J4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Fl("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:I=void 0}=e,{manageHoverState:E=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:F=!0}=e;function Z(ie){L=ie,t(0,L)}function K(ie){Pn.call(this,r,ie)}function q(ie){Pn.call(this,r,ie)}function J(ie){Pn.call(this,r,ie)}function fe(ie){Pn.call(this,r,ie)}function Ee(ie){Pn.call(this,r,ie)}function ee(ie){Pn.call(this,r,ie)}return r.$$set=ie=>{"id"in ie&&t(1,o=ie.id),"source"in ie&&t(2,u=ie.source),"sourceLayer"in ie&&t(3,s=ie.sourceLayer),"beforeId"in ie&&t(4,d=ie.beforeId),"beforeLayerType"in ie&&t(5,p=ie.beforeLayerType),"paint"in ie&&t(6,g=ie.paint),"layout"in ie&&t(7,_=ie.layout),"filter"in ie&&t(8,x=ie.filter),"applyToClusters"in ie&&t(9,C=ie.applyToClusters),"minzoom"in ie&&t(10,T=ie.minzoom),"maxzoom"in ie&&t(11,P=ie.maxzoom),"hoverCursor"in ie&&t(12,I=ie.hoverCursor),"manageHoverState"in ie&&t(13,E=ie.manageHoverState),"hovered"in ie&&t(0,L=ie.hovered),"eventsIfTopMost"in ie&&t(14,O=ie.eventsIfTopMost),"interactive"in ie&&t(15,F=ie.interactive),"$$scope"in ie&&t(24,i=ie.$$scope)},[L,o,u,s,d,p,g,_,x,C,T,P,I,E,O,F,n,Z,K,q,J,fe,Ee,ee,i]}let Ol=class extends Et{constructor(e){super(),Mt(this,e,J4,K4,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Y4(r){let e,t;const n=r[7].default,i=vn(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),de(e,"class",r[1]),Wt(e,"maplibregl-ctrl",r[0])},m(o,u){G(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,null):xn(o[6]),null),(!t||u&2)&&de(e,"class",o[1]),(!t||u&3)&&Wt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o),r[8](null)}}}function Q4(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:s="top-right"}=e,{class:d=void 0}=e;const{map:p}=Za();ct(r,p,C=>t(5,n=C));let g,_={onAdd(){return g},onRemove(){var C;(C=g==null?void 0:g.parentNode)==null||C.removeChild(g)}};ri(()=>{n==null||n.removeControl(_)});function x(C){dn[C?"unshift":"push"](()=>{g=C,t(2,g)})}return r.$$set=C=>{"defaultStyling"in C&&t(0,u=C.defaultStyling),"position"in C&&t(4,s=C.position),"class"in C&&t(1,d=C.class),"$$scope"in C&&t(6,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(_,s)},[u,d,g,p,s,n,o,i,x]}class tg extends Et{constructor(e){super(),Mt(this,e,Q4,Y4,St,{defaultStyling:0,position:4,class:1})}}function eS(r){let e,t,n,i,o,u;const s=r[5].default,d=vn(s,r,r[4],null);return{c(){e=U("button"),t=U("div"),d&&d.c(),de(t,"class",n=ec(r[3])+" svelte-1s83zbq"),Wt(t,"maplibregl-ctrl-icon",r[0]),Wt(t,"ctrl-btn-center",r[1]),de(e,"type","button"),de(e,"title",r[2])},m(p,g){G(p,e,g),B(e,t),d&&d.m(t,null),i=!0,o||(u=Lt(e,"click",r[6]),o=!0)},p(p,[g]){d&&d.p&&(!i||g&16)&&wn(d,s,p,p[4],i?bn(s,p[4],g,null):xn(p[4]),null),(!i||g&8&&n!==(n=ec(p[3])+" svelte-1s83zbq"))&&de(t,"class",n),(!i||g&9)&&Wt(t,"maplibregl-ctrl-icon",p[0]),(!i||g&10)&&Wt(t,"ctrl-btn-center",p[1]),(!i||g&4)&&de(e,"title",p[2])},i(p){i||(N(d,p),i=!0)},o(p){V(d,p),i=!1},d(p){p&&H(e),d&&d.d(p),o=!1,u()}}}function tS(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:s=void 0}=e,{class:d=void 0}=e;function p(g){Pn.call(this,r,g)}return r.$$set=g=>{"icon"in g&&t(0,o=g.icon),"center"in g&&t(1,u=g.center),"title"in g&&t(2,s=g.title),"class"in g&&t(3,d=g.class),"$$scope"in g&&t(4,i=g.$$scope)},[o,u,s,d,i,n,p]}class Iw extends Et{constructor(e){super(),Mt(this,e,tS,eS,St,{icon:0,center:1,title:2,class:3})}}function nS(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[1],null);return{c(){e=U("div"),o&&o.c(),de(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,s){G(u,e,s),o&&o.m(e,null),n=!0},p(u,[s]){o&&o.p&&(!n||s&2)&&wn(o,i,u,u[1],n?bn(i,u[1],s,null):xn(u[1]),null),(!n||s&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&de(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&H(e),o&&o.d(u)}}}function rS(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class Pw extends Et{constructor(e){super(),Mt(this,e,rS,nS,St,{class:0})}}function iS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function oS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[iS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new op({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function sS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Fl("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:I=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:O=!0}=e;function F(ee){E=ee,t(0,E)}function Z(ee){Pn.call(this,r,ee)}function K(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,I=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,L=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,P,I,L,O,n,F,Z,K,q,J,fe,Ee,i]}let Ji=class extends Et{constructor(e){super(),Mt(this,e,sS,oS,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function aS(r,e,t){let n;const{map:i}=Za();ct(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,s=null;return ri(()=>{n!=null&&n.loaded()&&s&&n.removeControl(s)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!s){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,s=new ni.FullscreenControl({container:d})),n.addControl(s,o)}},[i,o,u,s,n]}class lS extends Et{constructor(e){super(),Mt(this,e,aS,null,St,{position:1,container:2})}}function zw(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function Dw(r,e,t){Yb().then(()=>{let n=gi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function ly(r){let e=r[0],t,n,i=uy(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),G(o,t,u),n=!0},p(o,u){u&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=uy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function uy(r){let e;const t=r[19].default,n=vn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&wn(n,t,i,i[18],e?bn(t,i[18],o,null):xn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function uS(r){let e,t,n=r[0]&&ly(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=ly(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function cS(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=Fl("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e,{maxzoom:P=void 0}=e,{attribution:I=void 0}=e,{buffer:E=void 0}=e,{tolerance:L=void 0}=e;const{map:O,cluster:F,self:Z}=Ew();ct(r,O,J=>t(17,i=J)),ct(r,F,J=>t(20,o=J)),ct(r,Z,J=>t(0,n=J));let K,q=!0;return ri(()=>{n&&K&&i&&(Dw(O,n,K),ln(Z,n=null,n),t(15,K=void 0))}),r.$$set=J=>{"id"in J&&t(4,d=J.id),"data"in J&&t(5,p=J.data),"generateId"in J&&t(6,g=J.generateId),"promoteId"in J&&t(7,_=J.promoteId),"filter"in J&&t(8,x=J.filter),"lineMetrics"in J&&t(9,C=J.lineMetrics),"cluster"in J&&t(10,T=J.cluster),"maxzoom"in J&&t(11,P=J.maxzoom),"attribution"in J&&t(12,I=J.attribution),"buffer"in J&&t(13,E=J.buffer),"tolerance"in J&&t(14,L=J.tolerance),"$$scope"in J&&t(18,s=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ln(F,o=T,o),r.$$.dirty&196593&&i&&n!==d&&(ln(Z,n=d,n),zw(i,n,Na({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties,maxzoom:P,attribution:I,buffer:E,tolerance:L}),J=>i&&J===n,()=>{n&&(t(15,K=i==null?void 0:i.getSource(n)),t(16,q=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,K=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&K&&(q?t(16,q=!1):K.setData(p)),r.$$.dirty&33792&&(K==null||K.setClusterOptions(Na({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,O,F,Z,d,p,g,_,x,C,T,P,I,E,L,K,q,i,s,u]}let _r=class extends Et{constructor(e){super(),Mt(this,e,cS,uS,St,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function fS(r,e,t){let n;const{map:i}=Za();ct(r,i,x=>t(8,n=x));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:s=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:_=null}=e;return ri(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=x=>{"position"in x&&t(2,o=x.position),"positionOptions"in x&&t(3,u=x.positionOptions),"fitBoundsOptions"in x&&t(4,s=x.fitBoundsOptions),"trackUserLocation"in x&&t(5,d=x.trackUserLocation),"showAccuracyCircle"in x&&t(6,p=x.showAccuracyCircle),"showUserLocation"in x&&t(7,g=x.showUserLocation),"control"in x&&t(1,_=x.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!_&&(t(1,_=new ni.GeolocateControl({positionOptions:u,fitBoundsOptions:s,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:g})),n.addControl(_,o))},[i,_,o,u,s,d,p,g,n]}class hS extends Et{constructor(e){super(),Mt(this,e,fS,null,St,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function dS(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:s=void 0}=e,d=new Set;const{map:p,source:g}=Lw();return ct(r,p,_=>t(6,n=_)),ct(r,g,_=>t(7,i=_)),r.$$set=_=>{"data"in _&&t(2,o=_.data),"idCol"in _&&t(3,u=_.idCol),"sourceLayer"in _&&t(4,s=_.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let _=new Set;for(const x of o){const C=x[u];if(!C)continue;d.delete(C),_.add(C);const T={id:C,source:i,sourceLayer:s},P=n.getFeatureState(T);let I=!1;for(const E of Object.keys(x))if(P[E]!==x[E]){I=!0;break}I&&n.setFeatureState(T,x)}for(const x of d){const C={id:x,source:i,sourceLayer:s},T=n.getFeatureState(C);for(const P of Object.keys(T))n.removeFeatureState(C,P)}t(5,d=_)}},[p,g,o,u,s,d,n,i]}class pS extends Et{constructor(e){super(),Mt(this,e,dS,null,St,{data:2,idCol:3,sourceLayer:4})}}function mS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function gS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[mS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new op({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function _S(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Fl("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:I=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:O=!0}=e;function F(ee){E=ee,t(0,E)}function Z(ee){Pn.call(this,r,ee)}function K(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,I=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,L=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,P,I,L,O,n,F,Z,K,q,J,fe,Ee,i]}let ur=class extends Et{constructor(e){super(),Mt(this,e,_S,gS,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function yS(r,e,t){let n;const i=js();let{layer:o=void 0}=e;const{map:u}=Za();ct(r,u,g=>t(2,n=g));function s(g){i(g.type,{...g,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ri(()=>{if(n)if(o)for(const g of d)n.off(g,o,s);else for(const g of p)n.off(g,s)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of d)n.on(g,o,s);else for(const g of p)n.on(g,s)},[u,o,n]}class Wg extends Et{constructor(e){super(),Mt(this,e,yS,null,St,{layer:1})}}function vS(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,s=`${t}/${o}/${u}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(s+=`/${Math.round(d*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function bS(r){return r.replace("#","").split("/").map(parseFloat)}var Nu=Zg;function Zg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?cy(r,e):{}.toString.call(r)=="[object Set]"?cy(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?xS(r,e):wS(r,e)}function wS(r,e){return r.toString()===e.toString()}function cy(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Zg(r[n],e[n]))return!1;return!0}function xS(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Zg(r[o],e[o])))return!1}return!0}function AS(r,e,t){let n;const{map:i}=Za();ct(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:s=!0}=e,{visualizePitch:d=!1}=e,p=null;return ri(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,s=g.showZoom),"visualizePitch"in g&&t(4,d=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new ni.NavigationControl({showCompass:u,showZoom:s,visualizePitch:d})),n.addControl(p,o))},[i,o,u,s,d,p,n]}class Rw extends Et{constructor(e){super(),Mt(this,e,AS,null,St,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function kS(r,e,t){let n;const{map:i}=Za();ct(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:s="metric"}=e,d=null;return ri(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,s=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new ni.ScaleControl({maxWidth:u,unit:s})),n.addControl(d,o))},[i,o,u,s,d,n]}class Bw extends Et{constructor(e){super(),Mt(this,e,kS,null,St,{position:1,maxWidth:2,unit:3})}}const{window:SS}=Xb,CS=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),fy=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function hy(r){let e,t,n=r[3]&&dy(r);const i=r[46].default,o=vn(i,r,r[45],fy);return{c(){n&&n.c(),e=oe(),o&&o.c()},m(u,s){n&&n.m(u,s),G(u,e,s),o&&o.m(u,s),t=!0},p(u,s){u[3]?n?(n.p(u,s),s[0]&8&&N(n,1)):(n=dy(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt()),o&&o.p&&(!t||s[0]&112|s[1]&16384)&&wn(o,i,u,u[45],t?bn(i,u[45],s,CS):xn(u[45]),fy)},i(u){t||(N(n),N(o,u),t=!0)},o(u){V(n),V(o,u),t=!1},d(u){u&&H(e),n&&n.d(u),o&&o.d(u)}}}function dy(r){let e,t,n,i,o,u,s,d;return e=new Rw({props:{position:r[7]}}),n=new hS({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new lS({props:{position:r[7]}}),s=new Bw({props:{position:r[7]}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),G(p,i,g),ae(o,p,g),G(p,u,g),ae(s,p,g),d=!0},p(p,g){const _={};g[0]&128&&(_.position=p[7]),e.$set(_);const x={};g[0]&128&&(x.position=p[7]),n.$set(x);const C={};g[0]&128&&(C.position=p[7]),o.$set(C);const T={};g[0]&128&&(T.position=p[7]),s.$set(T)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(H(t),H(i),H(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function TS(r){let e,t,n,i,o,u=r[4]&&r[0]&&hy(r);return{c(){e=U("div"),u&&u.c(),de(e,"class",t=ec(r[2])+" svelte-p00lfq"),de(e,"data-testid","map-container"),Wt(e,"expand-map",!r[2])},m(s,d){G(s,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[Lt(SS,"hashchange",r[11]),Vm(r[10].call(null,e))],i=!0)},p(s,d){s[4]&&s[0]?u?(u.p(s,d),d[0]&17&&N(u,1)):(u=hy(s),u.c(),N(u,1),u.m(e,null)):u&&(Kt(),V(u,1,1,()=>{u=null}),Jt()),(!n||d[0]&4&&t!==(t=ec(s[2])+" svelte-p00lfq"))&&de(e,"class",t),(!n||d[0]&4)&&Wt(e,"expand-map",!s[2])},i(s){n||(N(u),n=!0)},o(s){V(u),n=!1},d(s){s&&H(e),u&&u.d(),r[47](null),i=!1,cr(o)}}}function MS(r,e,t){let n,i,o,u,{$$slots:s={},$$scope:d}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:_=void 0}=e,{style:x}=e,{diffStyleUpdates:C=!1}=e,{center:T=void 0}=e,{zoom:P=void 0}=e,{pitch:I=0}=e,{bearing:E=0}=e,{bounds:L=void 0}=e,{hash:O=!1}=e,{updateHash:F=Xe=>{window.history.replaceState(window.history.state,"",Xe)}}=e,{loaded:Z=!1}=e,{minZoom:K=0}=e,{maxZoom:q=22}=e,{minPitch:J=0}=e,{maxPitch:fe=60}=e,{renderWorldCopies:Ee=void 0}=e,{dragPan:ee=void 0}=e,{dragRotate:ie=void 0}=e,{pitchWithRotate:ve=void 0}=e,{antialias:ye=void 0}=e,{zoomOnDoubleClick:it=!0}=e,{locale:Be=void 0}=e,{interactive:Ne=!0}=e,{attributionControl:Ie=!0}=e,{cooperativeGestures:ot=!1}=e,{preserveDrawingBuffer:Ke=!1}=e,{maxBounds:ut=void 0}=e,{images:pt=[]}=e,{standardControls:_t=!1}=e,{filterLayers:He=void 0}=e,{transformRequest:mt=void 0}=e;const Pt=js(),{map:jt,loadedImages:un}=N4();ct(r,jt,Xe=>t(4,o=Xe)),ct(r,un,Xe=>t(5,u=Xe));let nn=new Set;async function rn(Xe,lt=!1){if(o&&!(!o.loaded()&&!lt))if("url"in Xe){nn.add(Xe.id);try{let Gt=await o.loadImage(Xe.url);o==null||o.addImage(Xe.id,Gt.data,Xe.options),u.add(Xe.id),un.set(u)}catch(Gt){Pt("error",Gt)}finally{nn.delete(Xe.id)}}else o.addImage(Xe.id,Xe.data,Xe.options),u.add(Xe.id),un.set(u)}let pn,yn,qe,Ge;function At(Xe){return he(),ln(jt,o=new ni.Map(Na({container:Xe,style:x,locale:Be,center:T,zoom:P,pitch:I,bearing:E,minZoom:K,maxZoom:q,minPitch:J,maxPitch:fe,renderWorldCopies:Ee,dragPan:ee,dragRotate:ie,pitchWithRotate:ve,antialias:ye,interactive:Ne,preserveDrawingBuffer:Ke,maxBounds:ut,bounds:L,attributionControl:Ie,transformRequest:mt,cooperativeGestures:ot})),o),o.on("load",lt=>{lt.target.getContainer().setAttribute("data-testid","map"),lt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,Z=!0),Pt("load",o)}),o.on("error",lt=>Pt("error",{...lt,map:o})),o.on("movestart",lt=>Pt("movestart",{...lt,map:o})),o.on("moveend",lt=>{if(t(12,T=lt.target.getCenter()),t(13,P=lt.target.getZoom()),t(14,I=lt.target.getPitch()),t(15,E=lt.target.getBearing()),t(16,L=lt.target.getBounds()),Pt("moveend",{...lt,map:o}),O){let Gt=new URL(window.location.href.replace(/(#.+)?$/,vS(o)));F(Gt)}}),o.on("click",lt=>Pt("click",{...lt,map:o})),o.on("dblclick",lt=>Pt("dblclick",{...lt,map:o})),o.on("contextmenu",lt=>Pt("contextmenu",{...lt,map:o})),o.on("zoomstart",lt=>Pt("zoomstart",{...lt,map:o})),o.on("zoom",lt=>{Pt("zoom",{...lt,map:o})}),o.on("zoomend",lt=>{Pt("zoomend",{...lt,map:o})}),o.on("style.load",()=>{if(o){const lt=o.getStyle();if(t(42,pn=lt.layers.map(Gt=>Gt.id)),t(43,yn=Object.keys(lt.sources)),Ge)for(const[Gt,Kn]of Object.entries(Ge))o.addSource(Gt,Kn);if(qe)for(const Gt of qe)o.addLayer(Gt);for(const Gt of pt)rn(Gt,!0)}}),o.on("styledata",lt=>{if(o&&He){const Gt=o.getStyle().layers;if(Gt)for(let Kn of Gt)He(Kn)||o.setLayoutProperty(Kn.id,"visibility","none")}Pt("styledata",{...lt,map:o})}),{destroy(){t(0,Z=!1),o==null||o.remove(),ln(jt,o=null,o)}}}let tt=x;function he(){if(O){let Xe=bS(window.location.hash);Xe.length>=3&&(t(13,P=Xe[0]),t(12,T=[Xe[2],Xe[1]])),Xe.length==5&&(t(15,E=Xe[3]),t(14,I=Xe[4]))}}function cn(Xe){dn[Xe?"unshift":"push"](()=>{g=Xe,t(1,g)})}return r.$$set=Xe=>{"map"in Xe&&t(17,p=Xe.map),"mapContainer"in Xe&&t(1,g=Xe.mapContainer),"class"in Xe&&t(2,_=Xe.class),"style"in Xe&&t(18,x=Xe.style),"diffStyleUpdates"in Xe&&t(19,C=Xe.diffStyleUpdates),"center"in Xe&&t(12,T=Xe.center),"zoom"in Xe&&t(13,P=Xe.zoom),"pitch"in Xe&&t(14,I=Xe.pitch),"bearing"in Xe&&t(15,E=Xe.bearing),"bounds"in Xe&&t(16,L=Xe.bounds),"hash"in Xe&&t(20,O=Xe.hash),"updateHash"in Xe&&t(21,F=Xe.updateHash),"loaded"in Xe&&t(0,Z=Xe.loaded),"minZoom"in Xe&&t(22,K=Xe.minZoom),"maxZoom"in Xe&&t(23,q=Xe.maxZoom),"minPitch"in Xe&&t(24,J=Xe.minPitch),"maxPitch"in Xe&&t(25,fe=Xe.maxPitch),"renderWorldCopies"in Xe&&t(26,Ee=Xe.renderWorldCopies),"dragPan"in Xe&&t(27,ee=Xe.dragPan),"dragRotate"in Xe&&t(28,ie=Xe.dragRotate),"pitchWithRotate"in Xe&&t(29,ve=Xe.pitchWithRotate),"antialias"in Xe&&t(30,ye=Xe.antialias),"zoomOnDoubleClick"in Xe&&t(31,it=Xe.zoomOnDoubleClick),"locale"in Xe&&t(32,Be=Xe.locale),"interactive"in Xe&&t(33,Ne=Xe.interactive),"attributionControl"in Xe&&t(34,Ie=Xe.attributionControl),"cooperativeGestures"in Xe&&t(35,ot=Xe.cooperativeGestures),"preserveDrawingBuffer"in Xe&&t(36,Ke=Xe.preserveDrawingBuffer),"maxBounds"in Xe&&t(37,ut=Xe.maxBounds),"images"in Xe&&t(38,pt=Xe.images),"standardControls"in Xe&&t(3,_t=Xe.standardControls),"filterLayers"in Xe&&t(39,He=Xe.filterLayers),"transformRequest"in Xe&&t(40,mt=Xe.transformRequest),"$$scope"in Xe&&t(45,d=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof _t=="boolean"?void 0:_t),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Nu(x,tt)){const Xe=o.getStyle();if(pn&&(qe=Xe.layers.filter(lt=>!pn.includes(lt.id))),yn){const lt=Object.keys(Xe.sources).filter(Gt=>!yn.includes(Gt));Ge={};for(const Gt of lt)Ge[Gt]=Xe.sources[Gt]}t(44,tt=x),o.setStyle(x,{diff:C}),ln(un,u=new Set,u),t(41,nn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&Z&&o!=null&&o.loaded())for(let Xe of pt)!u.has(Xe.id)&&!nn.has(Xe.id)&&!o.hasImage(Xe.id)&&rn(Xe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=pt.every(Xe=>u.has(Xe.id))),r.$$.dirty[0]&61456&&o){let Xe={};T!=null&&!Nu(T,o==null?void 0:o.getCenter())&&(Xe.center=T),P!=null&&!Nu(P,o==null?void 0:o.getZoom())&&(Xe.zoom=P),E!=null&&!Nu(E,o==null?void 0:o.getBearing())&&(Xe.bearing=E),I!=null&&!Nu(I,o==null?void 0:o.getPitch())&&(Xe.pitch=I),Object.keys(Xe).length&&o.easeTo(Xe)}r.$$.dirty[0]&65552&&L&&!Nu(L,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(L)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(it?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[Z,g,_,_t,o,u,i,n,jt,un,At,he,T,P,I,E,L,p,x,C,O,F,K,q,J,fe,Ee,ee,ie,ve,ye,it,Be,Ne,Ie,ot,Ke,ut,pt,He,mt,nn,pn,yn,tt,d,s,cn]}class ES extends Et{constructor(e){super(),Mt(this,e,MS,TS,St,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const LS=r=>({marker:r&8}),py=r=>({marker:r[3]});function IS(r){let e,t,n,i,o,u,s;const d=r[19].default,p=vn(d,r,r[18],py);return{c(){e=U("div"),p&&p.c(),de(e,"tabindex",t=r[1]?0:void 0),de(e,"role",n=r[1]?"button":void 0),Ye(e,"z-index",r[2])},m(g,_){G(g,e,_),p&&p.m(e,null),o=!0,u||(s=[Vm(r[7].call(null,e)),Vm(i=PS.call(null,e,r[0])),Lt(e,"click",Mf(r[20])),Lt(e,"dblclick",Mf(r[21])),Lt(e,"contextmenu",Mf(Ig(r[22]))),Lt(e,"mouseenter",r[23]),Lt(e,"mouseleave",r[24]),Lt(e,"mousemove",r[25]),Lt(e,"keydown",r[8])],u=!0)},p(g,[_]){p&&p.p&&(!o||_&262152)&&wn(p,d,g,g[18],o?bn(d,g[18],_,LS):xn(g[18]),py),(!o||_&2&&t!==(t=g[1]?0:void 0))&&de(e,"tabindex",t),(!o||_&2&&n!==(n=g[1]?"button":void 0))&&de(e,"role",n),i&&Ga(i.update)&&_&1&&i.update.call(null,g[0]),_&4&&Ye(e,"z-index",g[2])},i(g){o||(N(p,g),o=!0)},o(g){V(p,g),o=!1},d(g){g&&H(e),p&&p.d(g),u=!1,cr(s)}}}function PS(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function zS(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:_=!0}=e,{asButton:x=!1}=e,{draggable:C=!1}=e,{feature:T=null}=e,{offset:P=void 0}=e,{zIndex:I=void 0}=e,{rotation:E=0}=e,{opacity:L=1}=e;const O=js(),{map:F,layerEvent:Z,self:K,markerClickManager:q}=j4();ct(r,F,Ie=>t(27,o=Ie)),ct(r,Z,Ie=>t(26,n=Ie)),ct(r,K,Ie=>t(3,i=Ie));function J(Ie){ln(K,i=new ni.Marker({element:Ie,rotation:E,draggable:C,offset:P,opacity:L.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const ot=()=>ee("dragstart"),Ke=()=>{fe(),ee("drag")},ut=()=>{fe(),ee("dragend")};return C&&(i.on("dragstart",ot),i.on("drag",Ke),i.on("dragend",ut)),{destroy(){C&&(i==null||i.off("dragstart",ot),i==null||i.off("drag",Ke),i==null||i.off("dragend",ut)),t(11,d=void 0),i==null||i.remove()}}}function fe(){let Ie=i==null?void 0:i.getLngLat();Ie&&(Array.isArray(p)?t(10,p=[Ie.lng,Ie.lat]):p&&"lon"in p?t(10,p={lon:Ie.lng,lat:Ie.lat}):t(10,p=Ie))}function Ee(Ie){Ie.key===" "&&(Ie.preventDefault(),Ie.stopPropagation(),ee("click"))}function ee(Ie){if(!_)return;let ot=i==null?void 0:i.getLngLat();if(!ot)return;const Ke=[ot.lng,ot.lat];let ut={map:o,marker:i,lngLat:Ke,features:[{type:"Feature",properties:(T==null?void 0:T.properties)??{},geometry:{type:"Point",coordinates:Ke}}]};(Ie==="click"||Ie==="contextmenu")&&q.handleClick(ut),ln(Z,n={...ut,layerType:"marker",type:Ie},n),O(Ie,ut)}const ie=()=>ee("click"),ve=()=>ee("dblclick"),ye=()=>{ee("contextmenu")},it=()=>{ee("mouseenter")},Be=()=>{ee("mouseleave")},Ne=()=>ee("mousemove");return r.$$set=Ie=>{"marker"in Ie&&t(11,d=Ie.marker),"lngLat"in Ie&&t(10,p=Ie.lngLat),"class"in Ie&&t(0,g=Ie.class),"interactive"in Ie&&t(12,_=Ie.interactive),"asButton"in Ie&&t(1,x=Ie.asButton),"draggable"in Ie&&t(13,C=Ie.draggable),"feature"in Ie&&t(14,T=Ie.feature),"offset"in Ie&&t(15,P=Ie.offset),"zIndex"in Ie&&t(2,I=Ie.zIndex),"rotation"in Ie&&t(16,E=Ie.rotation),"opacity"in Ie&&t(17,L=Ie.opacity),"$$scope"in Ie&&t(18,s=Ie.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(P??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(E)),r.$$.dirty&131080&&(i==null||i.setOpacity(L.toString()))},[g,x,I,i,F,Z,K,J,Ee,ee,p,d,_,C,T,P,E,L,s,u,ie,ve,ye,it,Be,Ne]}class sp extends Et{constructor(e){super(),Mt(this,e,zS,IS,St,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const DS=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),my=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function gy(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof ni.Marker)&&_y(r);return{c(){e=U("div"),n&&n.c()},m(o,u){G(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var s;(s=o[4])!=null&&s.length||o[3]instanceof ni.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=_y(o),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(o){t||(N(n),t=!0)},o(o){V(n),t=!1},d(o){o&&H(e),n&&n.d(),r[32](null)}}}function _y(r){let e;const t=r[30].default,n=vn(t,r,r[29],my);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,DS):xn(i[29]),my)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function RS(r){let e,t,n=r[9].default&&gy(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=gy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function BS(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const _=Lg(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:P=!1}=e,{openOn:I="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:L=!0}=e,{anchor:O=void 0}=e,{offset:F=void 0}=e,{popupClass:Z=void 0}=e,{maxWidth:K=void 0}=e,{lngLat:q=void 0}=e,{html:J=void 0}=e,{open:fe=!1}=e;const Ee=js(),{map:ee,popupTarget:ie,layerEvent:ve,layer:ye,eventTopMost:it,markerClickManager:Be}=Za();ct(r,ee,he=>t(2,o=he)),ct(r,ie,he=>t(3,s=he)),ct(r,ve,he=>t(28,u=he)),ct(r,ye,he=>t(35,d=he));const Ne=["click","dblclick","contextmenu"];let Ie,ot=!1,Ke;function ut(){if(!Ie)return;let he=Ie.getElement();!he||he===Ke||(Ke=he,I==="hover"&&(Ke.style.pointerEvents="none"),Ke.addEventListener("mouseenter",()=>{t(24,ot=!0)},{passive:!0}),Ke.addEventListener("mouseleave",()=>{t(24,ot=!1)},{passive:!0}),Ke.addEventListener("click",()=>{T&&t(0,fe=!1)},{passive:!0}))}ks(()=>{if(o)return o.on("click",yn),o.on("contextmenu",yn),Be.add(qe),typeof s=="string"&&(o.on("click",s,Pt),o.on("dblclick",s,Pt),o.on("contextmenu",s,Pt),o.on("mousemove",s,pn),o.on("mouseleave",s,rn),o.on("touchstart",s,un),o.on("touchend",s,nn)),()=>{o!=null&&o.loaded()&&(Ie==null||Ie.remove(),o.off("click",yn),o.off("contextmenu",yn),Be.remove(qe),s instanceof ni.Marker?s.getPopup()===Ie&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Pt),o.off("dblclick",s,Pt),o.off("contextmenu",s,Pt),o.off("mousemove",s,pn),o.off("mouseleave",s,rn),o.off("touchstart",s,un),o.off("touchend",s,nn)))}});function pt(he){return E?!("marker"in he)&&!U4(he)&&it(he)!==d:!1}let _t=null,He="normal";function mt(he){"layerType"in he&&he.layerType==="deckgl"?(t(10,q=he.coordinate),t(4,_t=he.object?[he.object]:null)):(t(10,q=he.lngLat),t(4,_t=he.features??[]))}function Pt(he){he.type!==I||pt(he)||(mt(he),setTimeout(()=>t(0,fe=!0)))}let jt=null;function un(he){jt=he.point}function nn(he){if(!jt||I!=="hover")return;let cn=jt.dist(he.point);jt=null,cn<3&&(t(10,q=he.lngLat),t(4,_t=he.features??[]),Ie.isOpen()?t(25,He="justOpened"):(t(25,He="opening"),t(0,fe=!0)))}function rn(he){I!=="hover"||jt||He!=="normal"||(t(0,fe=!1),t(4,_t=null))}function pn(he){if(!(I!=="hover"||jt||He!=="normal")){if(pt(he)){t(0,fe=!1),t(4,_t=null);return}t(0,fe=!0),t(4,_t=he.features??[]),t(10,q=he.lngLat)}}function yn(he){if(He==="justOpened"){t(25,He="normal");return}if(!C)return;let cn=[Ke,s instanceof ni.Marker?s==null?void 0:s.getElement():null];fe&&Ie.isOpen()&&!cn.some(Xe=>Xe==null?void 0:Xe.contains(he.originalEvent.target))&&(he.type==="contextmenu"&&I==="contextmenu"||he.type!=="contextmenu")&&t(0,fe=!1)}function qe(he){C&&fe&&Ie.isOpen()&&he.marker!==s&&t(0,fe=!1)}ri(()=>{o&&(Ie!=null&&Ie.isOpen())&&Ie.remove()});let Ge;const At=()=>t(0,fe=!1);function tt(he){dn[he?"unshift":"push"](()=>{Ge=he,t(1,Ge)})}return r.$$set=he=>{"closeButton"in he&&t(11,x=he.closeButton),"closeOnClickOutside"in he&&t(12,C=he.closeOnClickOutside),"closeOnClickInside"in he&&t(13,T=he.closeOnClickInside),"closeOnMove"in he&&t(14,P=he.closeOnMove),"openOn"in he&&t(15,I=he.openOn),"openIfTopMost"in he&&t(16,E=he.openIfTopMost),"focusAfterOpen"in he&&t(17,L=he.focusAfterOpen),"anchor"in he&&t(18,O=he.anchor),"offset"in he&&t(19,F=he.offset),"popupClass"in he&&t(20,Z=he.popupClass),"maxWidth"in he&&t(21,K=he.maxWidth),"lngLat"in he&&t(10,q=he.lngLat),"html"in he&&t(22,J=he.html),"open"in he&&t(0,fe=he.open),"$$scope"in he&&t(29,g=he.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(Ie||(t(23,Ie=new ni.Popup({closeButton:n,closeOnClick:!1,closeOnMove:P,focusAfterOpen:L,maxWidth:K,className:Z,anchor:O,offset:F})),Ke=Ie.getElement(),Ie.on("open",()=>{t(0,fe=!0),ut(),Ee("open",Ie)}),Ie.on("close",()=>{t(0,fe=!1),Ee("close",Ie)}),Ie.on("hover",()=>{Ee("hover",Ie)}))),r.$$.dirty[0]&8421384&&Ie&&s instanceof ni.Marker&&(I==="click"?s.setPopup(Ie):s.getPopup()===Ie&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ne.includes(I)&&(u==null?void 0:u.type)===I&&(Pt(u),ln(ve,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=I==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&I==="hover"&&ve&&(i&&u&&mt(u),t(0,fe=(i||ot)??!1)),r.$$.dirty[0]&12582914&&(Ge?Ie.setDOMContent(Ge):J&&Ie.setHTML(J)),r.$$.dirty[0]&8389632&&q&&Ie.setLngLat(q),r.$$.dirty[0]&41943045&&o){let he=Ie.isOpen();fe&&!he?(Ie.addTo(o),He==="opening"&&t(25,He="justOpened")):!fe&&he&&Ie.remove()}},[fe,Ge,o,s,_t,ee,ie,ve,ye,_,q,x,C,T,P,I,E,L,O,F,Z,K,J,Ie,ot,He,i,n,u,g,p,At,tt]}let Fw=class extends Et{constructor(e){super(),Mt(this,e,BS,RS,St,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Ju=Math.pow,Ki=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{s(t.next(d))}catch(p){i(p)}},u=d=>{try{s(t.throw(d))}catch(p){i(p)}},s=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);s((t=t.apply(r,e)).next())}),jo=Uint8Array,Xu=Uint16Array,FS=Int32Array,Ow=new jo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$w=new jo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),OS=new jo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nw=function(r,e){for(var t=new Xu(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new FS(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},jw=Nw(Ow,2),Uw=jw.b,$S=jw.r;Uw[28]=258,$S[258]=28;var NS=Nw($w,0),jS=NS.b,ng=new Xu(32768);for(dr=0;dr<32768;++dr)ra=(dr&43690)>>1|(dr&21845)<<1,ra=(ra&52428)>>2|(ra&13107)<<2,ra=(ra&61680)>>4|(ra&3855)<<4,ng[dr]=((ra&65280)>>8|(ra&255)<<8)>>1;var ra,dr,Df=function(r,e,t){for(var n=r.length,i=0,o=new Xu(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Xu(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var s;if(t){s=new Xu(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],_=u[r[i]-1]++<<g,x=_|(1<<g)-1;_<=x;++_)s[ng[_]>>d]=p}else for(s=new Xu(n),i=0;i<n;++i)r[i]&&(s[i]=ng[u[r[i]-1]++]>>15-r[i]);return s},th=new jo(288);for(dr=0;dr<144;++dr)th[dr]=8;var dr;for(dr=144;dr<256;++dr)th[dr]=9;var dr;for(dr=256;dr<280;++dr)th[dr]=7;var dr;for(dr=280;dr<288;++dr)th[dr]=8;var dr,Vw=new jo(32);for(dr=0;dr<32;++dr)Vw[dr]=5;var dr,US=Df(th,9,1),VS=Df(Vw,5,1),Lm=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},gs=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Im=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},qS=function(r){return(r+7)/8|0},HS=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new jo(t-e);return n.set(r.subarray(e,t)),n},GS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Fo=function(r,e,t){var n=new Error(e||GS[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Fo),!t)throw n;return n},Xg=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new jo(0);var u=!t||e.i!=2,s=e.i;t||(t=new jo(i*3));var d=function(rn){var pn=t.length;if(rn>pn){var yn=new jo(Math.max(pn*2,rn));yn.set(t),t=yn}},p=e.f||0,g=e.p||0,_=e.b||0,x=e.l,C=e.d,T=e.m,P=e.n,I=i*8;do{if(!x){p=gs(r,g,1);var E=gs(r,g+1,3);if(g+=3,E)if(E==1)x=US,C=VS,T=9,P=5;else if(E==2){var Z=gs(r,g,31)+257,K=gs(r,g+10,15)+4,q=Z+gs(r,g+5,31)+1;g+=14;for(var J=new jo(q),fe=new jo(19),Ee=0;Ee<K;++Ee)fe[OS[Ee]]=gs(r,g+Ee*3,7);g+=K*3;for(var ee=Lm(fe),ie=(1<<ee)-1,ve=Df(fe,ee,1),Ee=0;Ee<q;){var ye=ve[gs(r,g,ie)];g+=ye&15;var L=ye>>4;if(L<16)J[Ee++]=L;else{var it=0,Be=0;for(L==16?(Be=3+gs(r,g,3),g+=2,it=J[Ee-1]):L==17?(Be=3+gs(r,g,7),g+=3):L==18&&(Be=11+gs(r,g,127),g+=7);Be--;)J[Ee++]=it}}var Ne=J.subarray(0,Z),Ie=J.subarray(Z);T=Lm(Ne),P=Lm(Ie),x=Df(Ne,T,1),C=Df(Ie,P,1)}else Fo(1);else{var L=qS(g)+4,O=r[L-4]|r[L-3]<<8,F=L+O;if(F>i){s&&Fo(0);break}u&&d(_+O),t.set(r.subarray(L,F),_),e.b=_+=O,e.p=g=F*8,e.f=p;continue}if(g>I){s&&Fo(0);break}}u&&d(_+131072);for(var ot=(1<<T)-1,Ke=(1<<P)-1,ut=g;;ut=g){var it=x[Im(r,g)&ot],pt=it>>4;if(g+=it&15,g>I){s&&Fo(0);break}if(it||Fo(2),pt<256)t[_++]=pt;else if(pt==256){ut=g,x=null;break}else{var _t=pt-254;if(pt>264){var Ee=pt-257,He=Ow[Ee];_t=gs(r,g,(1<<He)-1)+Uw[Ee],g+=He}var mt=C[Im(r,g)&Ke],Pt=mt>>4;mt||Fo(3),g+=mt&15;var Ie=jS[Pt];if(Pt>3){var He=$w[Pt];Ie+=Im(r,g)&(1<<He)-1,g+=He}if(g>I){s&&Fo(0);break}u&&d(_+131072);var jt=_+_t;if(_<Ie){var un=o-Ie,nn=Math.min(Ie,jt);for(un+_<0&&Fo(3);_<nn;++_)t[_]=n[un+_]}for(;_<jt;_+=4)t[_]=t[_-Ie],t[_+1]=t[_+1-Ie],t[_+2]=t[_+2-Ie],t[_+3]=t[_+3-Ie];_=jt}}e.l=x,e.p=ut,e.b=_,e.f=p,x&&(p=1,e.m=T,e.d=C,e.n=P)}while(!p);return _==t.length?t:HS(t,0,_)},WS=new jo(0),ZS=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Fo(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},XS=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},KS=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Fo(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Fo(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function JS(r,e){return Xg(r,{i:2},e&&e.out,e&&e.dictionary)}function YS(r,e){var t=ZS(r);return t+8>r.length&&Fo(6,"invalid gzip data"),Xg(r.subarray(t,-8),{i:2},e&&e.out||new jo(XS(r)),e&&e.dictionary)}function QS(r,e){return Xg(r.subarray(KS(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function rg(r,e){return r[0]==31&&r[1]==139&&r[2]==8?YS(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?JS(r,e):QS(r,e)}var e5=typeof TextDecoder<"u"&&new TextDecoder,t5=0;try{e5.decode(WS,{stream:!0}),t5=1}catch{}var qw=(r,e)=>r*Ju(2,e),hf=(r,e)=>Math.floor(r/Ju(2,e)),Xd=(r,e)=>qw(r.getUint16(e+1,!0),8)+r.getUint8(e),Hw=(r,e)=>qw(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),n5=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=Xd(n,i+1);if(e!==o)return e-o;const u=Xd(n,i+4);return t!==u?t-u:0},r5=(r,e,t,n)=>{const i=Gw(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},yy=(r,e,t,n)=>{const i=Gw(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},Gw=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,s=n5(e,t,n,r,u*17);if(s>0)i=u+1;else if(s<0)o=u-1;else return[Hw(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},i5=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Ww=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Xd(r,e*17+1),y:Xd(r,e*17+4),offset:Hw(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},vy=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(Ww(t,n));return o5(e)},o5=r=>{r.sort(i5);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=hf(i.offset,8)&255,t[n*17+9]=hf(i.offset,16)&255,t[n*17+10]=hf(i.offset,24)&255,t[n*17+11]=hf(i.offset,32)&255,t[n*17+12]=hf(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},s5=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=Ww(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:s}}return null};function a5(r){return Ki(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let s=0;u.compression==="gzip"&&(s=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,_=0,x=0,C=-180,T=-85,P=180,I=85;if(u.bounds){const L=u.bounds.split(",");C=+L[0],T=+L[1],P=+L[2],I=+L[3]}if(u.center){const L=u.center.split(",");g=+L[0],_=+L[1],x=+L[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:d,maxZoom:p,minLon:C,minLat:T,maxLon:P,maxLat:I,centerZoom:x,centerLon:g,centerLat:_,etag:e.etag}})}function l5(r,e,t,n,i,o,u){return Ki(this,null,function*(){let s=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(s=vy(s));const d=yy(new DataView(s),n,i,o);if(d){let _=(yield e.getBytes(d.offset,d.length,u)).data;const x=new DataView(_);return x.getUint8(0)===31&&x.getUint8(1)===139&&(_=rg(new Uint8Array(_))),{data:_}}const p=s5(new DataView(s),{z:n,x:i,y:o});if(p){const g=r5(new DataView(s),p.z,p.x,p.y);if(g){let _=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(_=vy(_));const x=yy(new DataView(_),n,i,o);if(x){let T=(yield e.getBytes(x.offset,x.length,u)).data;const P=new DataView(T);return P.getUint8(0)===31&&P.getUint8(1)===139&&(T=rg(new Uint8Array(T))),{data:T}}}}})}var Zw={getHeader:a5,getZxy:l5},u5=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},c5=class{constructor(){this.tilev4=(r,e)=>Ki(this,null,function*(){if(r.type==="json"){const _=r.url.substr(10);let x=this.tiles.get(_);x||(x=new by(_),this.tiles.set(_,x));const C=yield x.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new by(i),this.tiles.set(i,o));const u=n[2],s=n[3],d=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+s,+d,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=u5(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function ju(r,e){return(e>>>0)*4294967296+(r>>>0)}function f5(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return ju(r,i);throw new Error("Expected varint not more than 10 bytes")}function df(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,f5(n,r))}function h5(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var d5=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function p5(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Ju(2,r)-1||t>Ju(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=d5[r],i=Ju(2,r);let o=0,u=0,s=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,u=(d[1]&p)>0?1:0,s+=p*p*(3*o^u),h5(p,d,o,u),p=p/2;return n+s}function Xw(r,e){return Ki(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return rg(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var m5=127;function g5(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var _5=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Ki(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let s;this.mustReload&&(s="reload");let d=yield fetch(this.url,{signal:o,cache:s,headers:u});if(r===0&&d.status===416){const x=d.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const C=+x.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${C-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new ig(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function _s(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Ju(2,32)+n}function y5(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:_s(t,8),rootDirectoryLength:_s(t,16),jsonMetadataOffset:_s(t,24),jsonMetadataLength:_s(t,32),leafDirectoryOffset:_s(t,40),leafDirectoryLength:_s(t,48),tileDataOffset:_s(t,56),tileDataLength:_s(t,64),numAddressedTiles:_s(t,72),numTileEntries:_s(t,80),numTileContents:_s(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Kw(r){const e={buf:new Uint8Array(r),pos:0},t=df(e),n=[];let i=0;for(let o=0;o<t;o++){const u=df(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=df(e);for(let o=0;o<t;o++)n[o].length=df(e);for(let o=0;o<t;o++){const u=df(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function v5(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ig=class extends Error{};function b5(r,e){return Ki(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(v5(t.data)<3)return[yield Zw.getHeader(r)];const i=t.data.slice(0,m5),o=y5(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=Kw(yield e(u,o.internalCompression));return[o,[s,d.length,d]]})}function w5(r,e,t,n,i){return Ki(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),s=Kw(u);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var x5=class{constructor(r=100,e=!0,t=Xw){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Ki(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{b5(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Ki(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{w5(r,this.decompress,e,t,n).then(p=>{s(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Ki(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{s(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Ki(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},by=class{constructor(r,e,t){typeof r=="string"?this.source=new _5(r):this.source=r,t?this.decompress=t:this.decompress=Xw,e?this.cache=e:this.cache=new x5}getHeader(){return Ki(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Ki(this,null,function*(){const i=p5(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Zw.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,u,s,o),g=g5(p,i);if(g){if(g.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}u=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Ki(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof ig)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Ki(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Ki(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ig)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function A5(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function k5(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[A5]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new op({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function S5(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Fl("symbol")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:I=void 0}=e,{manageHoverState:E=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:F=!0}=e;function Z(ie){L=ie,t(0,L)}function K(ie){Pn.call(this,r,ie)}function q(ie){Pn.call(this,r,ie)}function J(ie){Pn.call(this,r,ie)}function fe(ie){Pn.call(this,r,ie)}function Ee(ie){Pn.call(this,r,ie)}function ee(ie){Pn.call(this,r,ie)}return r.$$set=ie=>{"id"in ie&&t(1,o=ie.id),"source"in ie&&t(2,u=ie.source),"sourceLayer"in ie&&t(3,s=ie.sourceLayer),"beforeId"in ie&&t(4,d=ie.beforeId),"beforeLayerType"in ie&&t(5,p=ie.beforeLayerType),"paint"in ie&&t(6,g=ie.paint),"layout"in ie&&t(7,_=ie.layout),"filter"in ie&&t(8,x=ie.filter),"applyToClusters"in ie&&t(9,C=ie.applyToClusters),"minzoom"in ie&&t(10,T=ie.minzoom),"maxzoom"in ie&&t(11,P=ie.maxzoom),"hoverCursor"in ie&&t(12,I=ie.hoverCursor),"manageHoverState"in ie&&t(13,E=ie.manageHoverState),"hovered"in ie&&t(0,L=ie.hovered),"eventsIfTopMost"in ie&&t(14,O=ie.eventsIfTopMost),"interactive"in ie&&t(15,F=ie.interactive),"$$scope"in ie&&t(24,i=ie.$$scope)},[L,o,u,s,d,p,g,_,x,C,T,P,I,E,O,F,n,Z,K,q,J,fe,Ee,ee,i]}class nc extends Et{constructor(e){super(),Mt(this,e,S5,k5,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function wy(r){let e=r[0],t,n,i=xy(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),G(o,t,u),n=!0},p(o,u){u&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=xy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function xy(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function C5(r){let e,t,n=r[0]&&wy(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=wy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function T5(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:s=Fl("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:_=null}=e,{scheme:x=null}=e,{attribution:C=null}=e,{minzoom:T=null}=e,{maxzoom:P=null}=e,{volatile:I=null}=e;if(d&&d.includes("pmtiles://")&&!ni.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let F=new c5;ni.addProtocol("pmtiles",F.tile)}const{map:E,self:L}=Ew();ct(r,E,F=>t(13,i=F)),ct(r,L,F=>t(0,n=F));let O;return ri(()=>{n&&i&&(Dw(E,n,O),ln(L,n=null,n),O=void 0)}),r.$$set=F=>{"id"in F&&t(3,s=F.id),"url"in F&&t(4,d=F.url),"tiles"in F&&t(5,p=F.tiles),"promoteId"in F&&t(6,g=F.promoteId),"bounds"in F&&t(7,_=F.bounds),"scheme"in F&&t(8,x=F.scheme),"attribution"in F&&t(9,C=F.attribution),"minzoom"in F&&t(10,T=F.minzoom),"maxzoom"in F&&t(11,P=F.maxzoom),"volatile"in F&&t(12,I=F.volatile),"$$scope"in F&&t(14,u=F.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==s&&(ln(L,n=s,n),zw(i,n,Na({type:"vector",url:d,tiles:p,promoteId:g,bounds:_,scheme:x,attribution:C,minzoom:T,maxzoom:P,volatile:I}),F=>i&&F===n,()=>{n&&(O=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{O=i==null?void 0:i.getSource(s)}))},[n,E,L,s,d,p,g,_,x,C,T,P,I,i,u,o]}class nh extends Et{constructor(e){super(),Mt(this,e,T5,C5,St,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}var bo="top",ls="bottom",us="right",wo="left",Kg="auto",rh=[bo,ls,us,wo],rc="start",Hf="end",M5="clippingParents",Jw="viewport",pf="popper",E5="reference",Ay=rh.reduce(function(r,e){return r.concat([e+"-"+rc,e+"-"+Hf])},[]),Yw=[].concat(rh,[Kg]).reduce(function(r,e){return r.concat([e,e+"-"+rc,e+"-"+Hf])},[]),L5="beforeRead",I5="read",P5="afterRead",z5="beforeMain",D5="main",R5="afterMain",B5="beforeWrite",F5="write",O5="afterWrite",$5=[L5,I5,P5,z5,D5,R5,B5,F5,O5];function Ns(r){return r?(r.nodeName||"").toLowerCase():null}function Uo(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Rl(r){var e=Uo(r).Element;return r instanceof e||r instanceof Element}function is(r){var e=Uo(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Jg(r){if(typeof ShadowRoot>"u")return!1;var e=Uo(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function N5(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];!is(o)||!Ns(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(u){var s=i[u];s===!1?o.removeAttribute(u):o.setAttribute(u,s===!0?"":s)}))})}function j5(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),s=u.reduce(function(d,p){return d[p]="",d},{});!is(i)||!Ns(i)||(Object.assign(i.style,s),Object.keys(o).forEach(function(d){i.removeAttribute(d)}))})}}const Qw={name:"applyStyles",enabled:!0,phase:"write",fn:N5,effect:j5,requires:["computeStyles"]};function Os(r){return r.split("-")[0]}var Pl=Math.max,Kd=Math.min,ic=Math.round;function og(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function e2(){return!/^((?!chrome|android).)*safari/i.test(og())}function oc(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=r.getBoundingClientRect(),i=1,o=1;e&&is(r)&&(i=r.offsetWidth>0&&ic(n.width)/r.offsetWidth||1,o=r.offsetHeight>0&&ic(n.height)/r.offsetHeight||1);var u=Rl(r)?Uo(r):window,s=u.visualViewport,d=!e2()&&t,p=(n.left+(d&&s?s.offsetLeft:0))/i,g=(n.top+(d&&s?s.offsetTop:0))/o,_=n.width/i,x=n.height/o;return{width:_,height:x,top:g,right:p+_,bottom:g+x,left:p,x:p,y:g}}function Yg(r){var e=oc(r),t=r.offsetWidth,n=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:n}}function t2(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Jg(t)){var n=e;do{if(n&&r.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function ca(r){return Uo(r).getComputedStyle(r)}function U5(r){return["table","td","th"].indexOf(Ns(r))>=0}function Xa(r){return((Rl(r)?r.ownerDocument:r.document)||window.document).documentElement}function ap(r){return Ns(r)==="html"?r:r.assignedSlot||r.parentNode||(Jg(r)?r.host:null)||Xa(r)}function ky(r){return!is(r)||ca(r).position==="fixed"?null:r.offsetParent}function V5(r){var e=/firefox/i.test(og()),t=/Trident/i.test(og());if(t&&is(r)){var n=ca(r);if(n.position==="fixed")return null}var i=ap(r);for(Jg(i)&&(i=i.host);is(i)&&["html","body"].indexOf(Ns(i))<0;){var o=ca(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function ih(r){for(var e=Uo(r),t=ky(r);t&&U5(t)&&ca(t).position==="static";)t=ky(t);return t&&(Ns(t)==="html"||Ns(t)==="body"&&ca(t).position==="static")?e:t||V5(r)||e}function Qg(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Rf(r,e,t){return Pl(r,Kd(e,t))}function q5(r,e,t){var n=Rf(r,e,t);return n>t?t:n}function n2(){return{top:0,right:0,bottom:0,left:0}}function r2(r){return Object.assign({},n2(),r)}function i2(r,e){return e.reduce(function(t,n){return t[n]=r,t},{})}var H5=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,r2(typeof e!="number"?e:i2(e,rh))};function G5(r){var e,t=r.state,n=r.name,i=r.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,s=Os(t.placement),d=Qg(s),p=[wo,us].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!u)){var _=H5(i.padding,t),x=Yg(o),C=d==="y"?bo:wo,T=d==="y"?ls:us,P=t.rects.reference[g]+t.rects.reference[d]-u[d]-t.rects.popper[g],I=u[d]-t.rects.reference[d],E=ih(o),L=E?d==="y"?E.clientHeight||0:E.clientWidth||0:0,O=P/2-I/2,F=_[C],Z=L-x[g]-_[T],K=L/2-x[g]/2+O,q=Rf(F,K,Z),J=d;t.modifiersData[n]=(e={},e[J]=q,e.centerOffset=q-K,e)}}function W5(r){var e=r.state,t=r.options,n=t.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||t2(e.elements.popper,i)&&(e.elements.arrow=i))}const Z5={name:"arrow",enabled:!0,phase:"main",fn:G5,effect:W5,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function sc(r){return r.split("-")[1]}var X5={top:"auto",right:"auto",bottom:"auto",left:"auto"};function K5(r,e){var t=r.x,n=r.y,i=e.devicePixelRatio||1;return{x:ic(t*i)/i||0,y:ic(n*i)/i||0}}function Sy(r){var e,t=r.popper,n=r.popperRect,i=r.placement,o=r.variation,u=r.offsets,s=r.position,d=r.gpuAcceleration,p=r.adaptive,g=r.roundOffsets,_=r.isFixed,x=u.x,C=x===void 0?0:x,T=u.y,P=T===void 0?0:T,I=typeof g=="function"?g({x:C,y:P}):{x:C,y:P};C=I.x,P=I.y;var E=u.hasOwnProperty("x"),L=u.hasOwnProperty("y"),O=wo,F=bo,Z=window;if(p){var K=ih(t),q="clientHeight",J="clientWidth";if(K===Uo(t)&&(K=Xa(t),ca(K).position!=="static"&&s==="absolute"&&(q="scrollHeight",J="scrollWidth")),K=K,i===bo||(i===wo||i===us)&&o===Hf){F=ls;var fe=_&&K===Z&&Z.visualViewport?Z.visualViewport.height:K[q];P-=fe-n.height,P*=d?1:-1}if(i===wo||(i===bo||i===ls)&&o===Hf){O=us;var Ee=_&&K===Z&&Z.visualViewport?Z.visualViewport.width:K[J];C-=Ee-n.width,C*=d?1:-1}}var ee=Object.assign({position:s},p&&X5),ie=g===!0?K5({x:C,y:P},Uo(t)):{x:C,y:P};if(C=ie.x,P=ie.y,d){var ve;return Object.assign({},ee,(ve={},ve[F]=L?"0":"",ve[O]=E?"0":"",ve.transform=(Z.devicePixelRatio||1)<=1?"translate("+C+"px, "+P+"px)":"translate3d("+C+"px, "+P+"px, 0)",ve))}return Object.assign({},ee,(e={},e[F]=L?P+"px":"",e[O]=E?C+"px":"",e.transform="",e))}function J5(r){var e=r.state,t=r.options,n=t.gpuAcceleration,i=n===void 0?!0:n,o=t.adaptive,u=o===void 0?!0:o,s=t.roundOffsets,d=s===void 0?!0:s,p={placement:Os(e.placement),variation:sc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Sy(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Sy(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const Y5={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:J5,data:{}};var bd={passive:!0};function Q5(r){var e=r.state,t=r.instance,n=r.options,i=n.scroll,o=i===void 0?!0:i,u=n.resize,s=u===void 0?!0:u,d=Uo(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,bd)}),s&&d.addEventListener("resize",t.update,bd),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,bd)}),s&&d.removeEventListener("resize",t.update,bd)}}const eC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Q5,data:{}};var tC={left:"right",right:"left",bottom:"top",top:"bottom"};function zd(r){return r.replace(/left|right|bottom|top/g,function(e){return tC[e]})}var nC={start:"end",end:"start"};function Cy(r){return r.replace(/start|end/g,function(e){return nC[e]})}function e_(r){var e=Uo(r),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function t_(r){return oc(Xa(r)).left+e_(r).scrollLeft}function rC(r,e){var t=Uo(r),n=Xa(r),i=t.visualViewport,o=n.clientWidth,u=n.clientHeight,s=0,d=0;if(i){o=i.width,u=i.height;var p=e2();(p||!p&&e==="fixed")&&(s=i.offsetLeft,d=i.offsetTop)}return{width:o,height:u,x:s+t_(r),y:d}}function iC(r){var e,t=Xa(r),n=e_(r),i=(e=r.ownerDocument)==null?void 0:e.body,o=Pl(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=Pl(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-n.scrollLeft+t_(r),d=-n.scrollTop;return ca(i||t).direction==="rtl"&&(s+=Pl(t.clientWidth,i?i.clientWidth:0)-o),{width:o,height:u,x:s,y:d}}function n_(r){var e=ca(r),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function o2(r){return["html","body","#document"].indexOf(Ns(r))>=0?r.ownerDocument.body:is(r)&&n_(r)?r:o2(ap(r))}function Bf(r,e){var t;e===void 0&&(e=[]);var n=o2(r),i=n===((t=r.ownerDocument)==null?void 0:t.body),o=Uo(n),u=i?[o].concat(o.visualViewport||[],n_(n)?n:[]):n,s=e.concat(u);return i?s:s.concat(Bf(ap(u)))}function sg(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function oC(r,e){var t=oc(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Ty(r,e,t){return e===Jw?sg(rC(r,t)):Rl(e)?oC(e,t):sg(iC(Xa(r)))}function sC(r){var e=Bf(ap(r)),t=["absolute","fixed"].indexOf(ca(r).position)>=0,n=t&&is(r)?ih(r):r;return Rl(n)?e.filter(function(i){return Rl(i)&&t2(i,n)&&Ns(i)!=="body"}):[]}function aC(r,e,t,n){var i=e==="clippingParents"?sC(r):[].concat(e),o=[].concat(i,[t]),u=o[0],s=o.reduce(function(d,p){var g=Ty(r,p,n);return d.top=Pl(g.top,d.top),d.right=Kd(g.right,d.right),d.bottom=Kd(g.bottom,d.bottom),d.left=Pl(g.left,d.left),d},Ty(r,u,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function s2(r){var e=r.reference,t=r.element,n=r.placement,i=n?Os(n):null,o=n?sc(n):null,u=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,d;switch(i){case bo:d={x:u,y:e.y-t.height};break;case ls:d={x:u,y:e.y+e.height};break;case us:d={x:e.x+e.width,y:s};break;case wo:d={x:e.x-t.width,y:s};break;default:d={x:e.x,y:e.y}}var p=i?Qg(i):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case rc:d[p]=d[p]-(e[g]/2-t[g]/2);break;case Hf:d[p]=d[p]+(e[g]/2-t[g]/2);break}}return d}function Gf(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?r.placement:n,o=t.strategy,u=o===void 0?r.strategy:o,s=t.boundary,d=s===void 0?M5:s,p=t.rootBoundary,g=p===void 0?Jw:p,_=t.elementContext,x=_===void 0?pf:_,C=t.altBoundary,T=C===void 0?!1:C,P=t.padding,I=P===void 0?0:P,E=r2(typeof I!="number"?I:i2(I,rh)),L=x===pf?E5:pf,O=r.rects.popper,F=r.elements[T?L:x],Z=aC(Rl(F)?F:F.contextElement||Xa(r.elements.popper),d,g,u),K=oc(r.elements.reference),q=s2({reference:K,element:O,strategy:"absolute",placement:i}),J=sg(Object.assign({},O,q)),fe=x===pf?J:K,Ee={top:Z.top-fe.top+E.top,bottom:fe.bottom-Z.bottom+E.bottom,left:Z.left-fe.left+E.left,right:fe.right-Z.right+E.right},ee=r.modifiersData.offset;if(x===pf&&ee){var ie=ee[i];Object.keys(Ee).forEach(function(ve){var ye=[us,ls].indexOf(ve)>=0?1:-1,it=[bo,ls].indexOf(ve)>=0?"y":"x";Ee[ve]+=ie[it]*ye})}return Ee}function lC(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=t.boundary,o=t.rootBoundary,u=t.padding,s=t.flipVariations,d=t.allowedAutoPlacements,p=d===void 0?Yw:d,g=sc(n),_=g?s?Ay:Ay.filter(function(T){return sc(T)===g}):rh,x=_.filter(function(T){return p.indexOf(T)>=0});x.length===0&&(x=_);var C=x.reduce(function(T,P){return T[P]=Gf(r,{placement:P,boundary:i,rootBoundary:o,padding:u})[Os(P)],T},{});return Object.keys(C).sort(function(T,P){return C[T]-C[P]})}function uC(r){if(Os(r)===Kg)return[];var e=zd(r);return[Cy(r),e,Cy(e)]}function cC(r){var e=r.state,t=r.options,n=r.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!0:u,d=t.fallbackPlacements,p=t.padding,g=t.boundary,_=t.rootBoundary,x=t.altBoundary,C=t.flipVariations,T=C===void 0?!0:C,P=t.allowedAutoPlacements,I=e.options.placement,E=Os(I),L=E===I,O=d||(L||!T?[zd(I)]:uC(I)),F=[I].concat(O).reduce(function(He,mt){return He.concat(Os(mt)===Kg?lC(e,{placement:mt,boundary:g,rootBoundary:_,padding:p,flipVariations:T,allowedAutoPlacements:P}):mt)},[]),Z=e.rects.reference,K=e.rects.popper,q=new Map,J=!0,fe=F[0],Ee=0;Ee<F.length;Ee++){var ee=F[Ee],ie=Os(ee),ve=sc(ee)===rc,ye=[bo,ls].indexOf(ie)>=0,it=ye?"width":"height",Be=Gf(e,{placement:ee,boundary:g,rootBoundary:_,altBoundary:x,padding:p}),Ne=ye?ve?us:wo:ve?ls:bo;Z[it]>K[it]&&(Ne=zd(Ne));var Ie=zd(Ne),ot=[];if(o&&ot.push(Be[ie]<=0),s&&ot.push(Be[Ne]<=0,Be[Ie]<=0),ot.every(function(He){return He})){fe=ee,J=!1;break}q.set(ee,ot)}if(J)for(var Ke=T?3:1,ut=function(mt){var Pt=F.find(function(jt){var un=q.get(jt);if(un)return un.slice(0,mt).every(function(nn){return nn})});if(Pt)return fe=Pt,"break"},pt=Ke;pt>0;pt--){var _t=ut(pt);if(_t==="break")break}e.placement!==fe&&(e.modifiersData[n]._skip=!0,e.placement=fe,e.reset=!0)}}const fC={name:"flip",enabled:!0,phase:"main",fn:cC,requiresIfExists:["offset"],data:{_skip:!1}};function My(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function Ey(r){return[bo,us,ls,wo].some(function(e){return r[e]>=0})}function hC(r){var e=r.state,t=r.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,u=Gf(e,{elementContext:"reference"}),s=Gf(e,{altBoundary:!0}),d=My(u,n),p=My(s,i,o),g=Ey(d),_=Ey(p);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":_})}const dC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:hC};function pC(r,e,t){var n=Os(r),i=[wo,bo].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,u=o[0],s=o[1];return u=u||0,s=(s||0)*i,[wo,us].indexOf(n)>=0?{x:s,y:u}:{x:u,y:s}}function mC(r){var e=r.state,t=r.options,n=r.name,i=t.offset,o=i===void 0?[0,0]:i,u=Yw.reduce(function(g,_){return g[_]=pC(_,e.rects,o),g},{}),s=u[e.placement],d=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=p),e.modifiersData[n]=u}const gC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:mC};function _C(r){var e=r.state,t=r.name;e.modifiersData[t]=s2({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const yC={name:"popperOffsets",enabled:!0,phase:"read",fn:_C,data:{}};function vC(r){return r==="x"?"y":"x"}function bC(r){var e=r.state,t=r.options,n=r.name,i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!1:u,d=t.boundary,p=t.rootBoundary,g=t.altBoundary,_=t.padding,x=t.tether,C=x===void 0?!0:x,T=t.tetherOffset,P=T===void 0?0:T,I=Gf(e,{boundary:d,rootBoundary:p,padding:_,altBoundary:g}),E=Os(e.placement),L=sc(e.placement),O=!L,F=Qg(E),Z=vC(F),K=e.modifiersData.popperOffsets,q=e.rects.reference,J=e.rects.popper,fe=typeof P=="function"?P(Object.assign({},e.rects,{placement:e.placement})):P,Ee=typeof fe=="number"?{mainAxis:fe,altAxis:fe}:Object.assign({mainAxis:0,altAxis:0},fe),ee=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ie={x:0,y:0};if(K){if(o){var ve,ye=F==="y"?bo:wo,it=F==="y"?ls:us,Be=F==="y"?"height":"width",Ne=K[F],Ie=Ne+I[ye],ot=Ne-I[it],Ke=C?-J[Be]/2:0,ut=L===rc?q[Be]:J[Be],pt=L===rc?-J[Be]:-q[Be],_t=e.elements.arrow,He=C&&_t?Yg(_t):{width:0,height:0},mt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:n2(),Pt=mt[ye],jt=mt[it],un=Rf(0,q[Be],He[Be]),nn=O?q[Be]/2-Ke-un-Pt-Ee.mainAxis:ut-un-Pt-Ee.mainAxis,rn=O?-q[Be]/2+Ke+un+jt+Ee.mainAxis:pt+un+jt+Ee.mainAxis,pn=e.elements.arrow&&ih(e.elements.arrow),yn=pn?F==="y"?pn.clientTop||0:pn.clientLeft||0:0,qe=(ve=ee==null?void 0:ee[F])!=null?ve:0,Ge=Ne+nn-qe-yn,At=Ne+rn-qe,tt=Rf(C?Kd(Ie,Ge):Ie,Ne,C?Pl(ot,At):ot);K[F]=tt,ie[F]=tt-Ne}if(s){var he,cn=F==="x"?bo:wo,Xe=F==="x"?ls:us,lt=K[Z],Gt=Z==="y"?"height":"width",Kn=lt+I[cn],Gn=lt-I[Xe],fr=[bo,wo].indexOf(E)!==-1,Sr=(he=ee==null?void 0:ee[Z])!=null?he:0,Cr=fr?Kn:lt-q[Gt]-J[Gt]-Sr+Ee.altAxis,xi=fr?lt+q[Gt]+J[Gt]-Sr-Ee.altAxis:Gn,Un=C&&fr?q5(Cr,lt,xi):Rf(C?Cr:Kn,lt,C?xi:Gn);K[Z]=Un,ie[Z]=Un-lt}e.modifiersData[n]=ie}}const wC={name:"preventOverflow",enabled:!0,phase:"main",fn:bC,requiresIfExists:["offset"]};function xC(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function AC(r){return r===Uo(r)||!is(r)?e_(r):xC(r)}function kC(r){var e=r.getBoundingClientRect(),t=ic(e.width)/r.offsetWidth||1,n=ic(e.height)/r.offsetHeight||1;return t!==1||n!==1}function SC(r,e,t){t===void 0&&(t=!1);var n=is(e),i=is(e)&&kC(e),o=Xa(e),u=oc(r,i,t),s={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(n||!n&&!t)&&((Ns(e)!=="body"||n_(o))&&(s=AC(e)),is(e)?(d=oc(e,!0),d.x+=e.clientLeft,d.y+=e.clientTop):o&&(d.x=t_(o))),{x:u.left+s.scrollLeft-d.x,y:u.top+s.scrollTop-d.y,width:u.width,height:u.height}}function CC(r){var e=new Map,t=new Set,n=[];r.forEach(function(o){e.set(o.name,o)});function i(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(s){if(!t.has(s)){var d=e.get(s);d&&i(d)}}),n.push(o)}return r.forEach(function(o){t.has(o.name)||i(o)}),n}function TC(r){var e=CC(r);return $5.reduce(function(t,n){return t.concat(e.filter(function(i){return i.phase===n}))},[])}function MC(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function EC(r){var e=r.reduce(function(t,n){var i=t[n.name];return t[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var Ly={placement:"bottom",modifiers:[],strategy:"absolute"};function Iy(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function LC(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?Ly:i;return function(s,d,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ly,o),modifiersData:{},elements:{reference:s,popper:d},attributes:{},styles:{}},_=[],x=!1,C={state:g,setOptions:function(E){var L=typeof E=="function"?E(g.options):E;P(),g.options=Object.assign({},o,g.options,L),g.scrollParents={reference:Rl(s)?Bf(s):s.contextElement?Bf(s.contextElement):[],popper:Bf(d)};var O=TC(EC([].concat(n,g.options.modifiers)));return g.orderedModifiers=O.filter(function(F){return F.enabled}),T(),C.update()},forceUpdate:function(){if(!x){var E=g.elements,L=E.reference,O=E.popper;if(Iy(L,O)){g.rects={reference:SC(L,ih(O),g.options.strategy==="fixed"),popper:Yg(O)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(Ee){return g.modifiersData[Ee.name]=Object.assign({},Ee.data)});for(var F=0;F<g.orderedModifiers.length;F++){if(g.reset===!0){g.reset=!1,F=-1;continue}var Z=g.orderedModifiers[F],K=Z.fn,q=Z.options,J=q===void 0?{}:q,fe=Z.name;typeof K=="function"&&(g=K({state:g,options:J,name:fe,instance:C})||g)}}}},update:MC(function(){return new Promise(function(I){C.forceUpdate(),I(g)})}),destroy:function(){P(),x=!0}};if(!Iy(s,d))return C;C.setOptions(p).then(function(I){!x&&p.onFirstUpdate&&p.onFirstUpdate(I)});function T(){g.orderedModifiers.forEach(function(I){var E=I.name,L=I.options,O=L===void 0?{}:L,F=I.effect;if(typeof F=="function"){var Z=F({state:g,name:E,instance:C,options:O}),K=function(){};_.push(Z||K)}})}function P(){_.forEach(function(I){return I()}),_=[]}return C}}var IC=[eC,yC,Y5,Qw,gC,fC,wC,Z5,dC],PC=LC({defaultModifiers:IC}),zC="tippy-box",a2="tippy-content",DC="tippy-backdrop",l2="tippy-arrow",u2="tippy-svg-arrow",Ml={passive:!0,capture:!0},c2=function(){return document.body};function Pm(r,e,t){if(Array.isArray(r)){var n=r[e];return n??(Array.isArray(t)?t[e]:t)}return r}function r_(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function f2(r,e){return typeof r=="function"?r.apply(void 0,e):r}function Py(r,e){if(e===0)return r;var t;return function(n){clearTimeout(t),t=setTimeout(function(){r(n)},e)}}function RC(r){return r.split(/\s+/).filter(Boolean)}function Gu(r){return[].concat(r)}function zy(r,e){r.indexOf(e)===-1&&r.push(e)}function BC(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function FC(r){return r.split("-")[0]}function Jd(r){return[].slice.call(r)}function Dy(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function Ff(){return document.createElement("div")}function lp(r){return["Element","Fragment"].some(function(e){return r_(r,e)})}function OC(r){return r_(r,"NodeList")}function $C(r){return r_(r,"MouseEvent")}function NC(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function jC(r){return lp(r)?[r]:OC(r)?Jd(r):Array.isArray(r)?r:Jd(document.querySelectorAll(r))}function zm(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Ry(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function UC(r){var e,t=Gu(r),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function VC(r,e){var t=e.clientX,n=e.clientY;return r.every(function(i){var o=i.popperRect,u=i.popperState,s=i.props,d=s.interactiveBorder,p=FC(u.placement),g=u.modifiersData.offset;if(!g)return!0;var _=p==="bottom"?g.top.y:0,x=p==="top"?g.bottom.y:0,C=p==="right"?g.left.x:0,T=p==="left"?g.right.x:0,P=o.top-n+_>d,I=n-o.bottom-x>d,E=o.left-t+C>d,L=t-o.right-T>d;return P||I||E||L})}function Dm(r,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){r[n](i,t)})}function By(r,e){for(var t=e;t;){var n;if(r.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Fs={isTouch:!1},Fy=0;function qC(){Fs.isTouch||(Fs.isTouch=!0,window.performance&&document.addEventListener("mousemove",h2))}function h2(){var r=performance.now();r-Fy<20&&(Fs.isTouch=!1,document.removeEventListener("mousemove",h2)),Fy=r}function HC(){var r=document.activeElement;if(NC(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function GC(){document.addEventListener("touchstart",qC,Ml),window.addEventListener("blur",HC)}var WC=typeof window<"u"&&typeof document<"u",ZC=WC?!!window.msCrypto:!1,XC={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},KC={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},vs=Object.assign({appendTo:c2,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},XC,KC),JC=Object.keys(vs),YC=function(e){var t=Object.keys(e);t.forEach(function(n){vs[n]=e[n]})};function d2(r){var e=r.plugins||[],t=e.reduce(function(n,i){var o=i.name,u=i.defaultValue;if(o){var s;n[o]=r[o]!==void 0?r[o]:(s=vs[o])!=null?s:u}return n},{});return Object.assign({},r,t)}function QC(r,e){var t=e?Object.keys(d2(Object.assign({},vs,{plugins:e}))):JC,n=t.reduce(function(i,o){var u=(r.getAttribute("data-tippy-"+o)||"").trim();if(!u)return i;if(o==="content")i[o]=u;else try{i[o]=JSON.parse(u)}catch{i[o]=u}return i},{});return n}function Oy(r,e){var t=Object.assign({},e,{content:f2(e.content,[r])},e.ignoreAttributes?{}:QC(r,e.plugins));return t.aria=Object.assign({},vs.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var eT=function(){return"innerHTML"};function ag(r,e){r[eT()]=e}function $y(r){var e=Ff();return r===!0?e.className=l2:(e.className=u2,lp(r)?e.appendChild(r):ag(e,r)),e}function Ny(r,e){lp(e.content)?(ag(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?ag(r,e.content):r.textContent=e.content)}function lg(r){var e=r.firstElementChild,t=Jd(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(a2)}),arrow:t.find(function(n){return n.classList.contains(l2)||n.classList.contains(u2)}),backdrop:t.find(function(n){return n.classList.contains(DC)})}}function p2(r){var e=Ff(),t=Ff();t.className=zC,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Ff();n.className=a2,n.setAttribute("data-state","hidden"),Ny(n,r.props),e.appendChild(t),t.appendChild(n),i(r.props,r.props);function i(o,u){var s=lg(e),d=s.box,p=s.content,g=s.arrow;u.theme?d.setAttribute("data-theme",u.theme):d.removeAttribute("data-theme"),typeof u.animation=="string"?d.setAttribute("data-animation",u.animation):d.removeAttribute("data-animation"),u.inertia?d.setAttribute("data-inertia",""):d.removeAttribute("data-inertia"),d.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?d.setAttribute("role",u.role):d.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&Ny(p,r.props),u.arrow?g?o.arrow!==u.arrow&&(d.removeChild(g),d.appendChild($y(u.arrow))):d.appendChild($y(u.arrow)):g&&d.removeChild(g)}return{popper:e,onUpdate:i}}p2.$$tippy=!0;var tT=1,wd=[],Rm=[];function nT(r,e){var t=Oy(r,Object.assign({},vs,d2(Dy(e)))),n,i,o,u=!1,s=!1,d=!1,p=!1,g,_,x,C=[],T=Py(Ge,t.interactiveDebounce),P,I=tT++,E=null,L=BC(t.plugins),O={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},F={id:I,reference:r,popper:Ff(),popperInstance:E,props:t,state:O,plugins:L,clearDelayTimeouts:Cr,setProps:xi,setContent:Un,show:xt,hide:Pr,hideWithInteractivity:br,enable:fr,disable:Sr,unmount:Bi,destroy:$n};if(!t.render)return F;var Z=t.render(F),K=Z.popper,q=Z.onUpdate;K.setAttribute("data-tippy-root",""),K.id="tippy-"+F.id,F.popper=K,r._tippy=F,K._tippy=F;var J=L.map(function(Fe){return Fe.fn(F)}),fe=r.hasAttribute("aria-expanded");return pn(),Ke(),Ne(),Ie("onCreate",[F]),t.showOnCreate&&Kn(),K.addEventListener("mouseenter",function(){F.props.interactive&&F.state.isVisible&&F.clearDelayTimeouts()}),K.addEventListener("mouseleave",function(){F.props.interactive&&F.props.trigger.indexOf("mouseenter")>=0&&ye().addEventListener("mousemove",T)}),F;function Ee(){var Fe=F.props.touch;return Array.isArray(Fe)?Fe:[Fe,0]}function ee(){return Ee()[0]==="hold"}function ie(){var Fe;return!!((Fe=F.props.render)!=null&&Fe.$$tippy)}function ve(){return P||r}function ye(){var Fe=ve().parentNode;return Fe?UC(Fe):document}function it(){return lg(K)}function Be(Fe){return F.state.isMounted&&!F.state.isVisible||Fs.isTouch||g&&g.type==="focus"?0:Pm(F.props.delay,Fe?0:1,vs.delay)}function Ne(Fe){Fe===void 0&&(Fe=!1),K.style.pointerEvents=F.props.interactive&&!Fe?"":"none",K.style.zIndex=""+F.props.zIndex}function Ie(Fe,yt,bt){if(bt===void 0&&(bt=!0),J.forEach(function(Qt){Qt[Fe]&&Qt[Fe].apply(Qt,yt)}),bt){var Rt;(Rt=F.props)[Fe].apply(Rt,yt)}}function ot(){var Fe=F.props.aria;if(Fe.content){var yt="aria-"+Fe.content,bt=K.id,Rt=Gu(F.props.triggerTarget||r);Rt.forEach(function(Qt){var Yt=Qt.getAttribute(yt);if(F.state.isVisible)Qt.setAttribute(yt,Yt?Yt+" "+bt:bt);else{var vr=Yt&&Yt.replace(bt,"").trim();vr?Qt.setAttribute(yt,vr):Qt.removeAttribute(yt)}})}}function Ke(){if(!(fe||!F.props.aria.expanded)){var Fe=Gu(F.props.triggerTarget||r);Fe.forEach(function(yt){F.props.interactive?yt.setAttribute("aria-expanded",F.state.isVisible&&yt===ve()?"true":"false"):yt.removeAttribute("aria-expanded")})}}function ut(){ye().removeEventListener("mousemove",T),wd=wd.filter(function(Fe){return Fe!==T})}function pt(Fe){if(!(Fs.isTouch&&(d||Fe.type==="mousedown"))){var yt=Fe.composedPath&&Fe.composedPath()[0]||Fe.target;if(!(F.props.interactive&&By(K,yt))){if(Gu(F.props.triggerTarget||r).some(function(bt){return By(bt,yt)})){if(Fs.isTouch||F.state.isVisible&&F.props.trigger.indexOf("click")>=0)return}else Ie("onClickOutside",[F,Fe]);F.props.hideOnClick===!0&&(F.clearDelayTimeouts(),F.hide(),s=!0,setTimeout(function(){s=!1}),F.state.isMounted||Pt())}}}function _t(){d=!0}function He(){d=!1}function mt(){var Fe=ye();Fe.addEventListener("mousedown",pt,!0),Fe.addEventListener("touchend",pt,Ml),Fe.addEventListener("touchstart",He,Ml),Fe.addEventListener("touchmove",_t,Ml)}function Pt(){var Fe=ye();Fe.removeEventListener("mousedown",pt,!0),Fe.removeEventListener("touchend",pt,Ml),Fe.removeEventListener("touchstart",He,Ml),Fe.removeEventListener("touchmove",_t,Ml)}function jt(Fe,yt){nn(Fe,function(){!F.state.isVisible&&K.parentNode&&K.parentNode.contains(K)&&yt()})}function un(Fe,yt){nn(Fe,yt)}function nn(Fe,yt){var bt=it().box;function Rt(Qt){Qt.target===bt&&(Dm(bt,"remove",Rt),yt())}if(Fe===0)return yt();Dm(bt,"remove",_),Dm(bt,"add",Rt),_=Rt}function rn(Fe,yt,bt){bt===void 0&&(bt=!1);var Rt=Gu(F.props.triggerTarget||r);Rt.forEach(function(Qt){Qt.addEventListener(Fe,yt,bt),C.push({node:Qt,eventType:Fe,handler:yt,options:bt})})}function pn(){ee()&&(rn("touchstart",qe,{passive:!0}),rn("touchend",At,{passive:!0})),RC(F.props.trigger).forEach(function(Fe){if(Fe!=="manual")switch(rn(Fe,qe),Fe){case"mouseenter":rn("mouseleave",At);break;case"focus":rn(ZC?"focusout":"blur",tt);break;case"focusin":rn("focusout",tt);break}})}function yn(){C.forEach(function(Fe){var yt=Fe.node,bt=Fe.eventType,Rt=Fe.handler,Qt=Fe.options;yt.removeEventListener(bt,Rt,Qt)}),C=[]}function qe(Fe){var yt,bt=!1;if(!(!F.state.isEnabled||he(Fe)||s)){var Rt=((yt=g)==null?void 0:yt.type)==="focus";g=Fe,P=Fe.currentTarget,Ke(),!F.state.isVisible&&$C(Fe)&&wd.forEach(function(Qt){return Qt(Fe)}),Fe.type==="click"&&(F.props.trigger.indexOf("mouseenter")<0||u)&&F.props.hideOnClick!==!1&&F.state.isVisible?bt=!0:Kn(Fe),Fe.type==="click"&&(u=!bt),bt&&!Rt&&Gn(Fe)}}function Ge(Fe){var yt=Fe.target,bt=ve().contains(yt)||K.contains(yt);if(!(Fe.type==="mousemove"&&bt)){var Rt=Gt().concat(K).map(function(Qt){var Yt,vr=Qt._tippy,or=(Yt=vr.popperInstance)==null?void 0:Yt.state;return or?{popperRect:Qt.getBoundingClientRect(),popperState:or,props:t}:null}).filter(Boolean);VC(Rt,Fe)&&(ut(),Gn(Fe))}}function At(Fe){var yt=he(Fe)||F.props.trigger.indexOf("click")>=0&&u;if(!yt){if(F.props.interactive){F.hideWithInteractivity(Fe);return}Gn(Fe)}}function tt(Fe){F.props.trigger.indexOf("focusin")<0&&Fe.target!==ve()||F.props.interactive&&Fe.relatedTarget&&K.contains(Fe.relatedTarget)||Gn(Fe)}function he(Fe){return Fs.isTouch?ee()!==Fe.type.indexOf("touch")>=0:!1}function cn(){Xe();var Fe=F.props,yt=Fe.popperOptions,bt=Fe.placement,Rt=Fe.offset,Qt=Fe.getReferenceClientRect,Yt=Fe.moveTransition,vr=ie()?lg(K).arrow:null,or=Qt?{getBoundingClientRect:Qt,contextElement:Qt.contextElement||ve()}:r,Se={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ge){var xe=ge.state;if(ie()){var Oe=it(),$e=Oe.box;["placement","reference-hidden","escaped"].forEach(function(Ue){Ue==="placement"?$e.setAttribute("data-placement",xe.placement):xe.attributes.popper["data-popper-"+Ue]?$e.setAttribute("data-"+Ue,""):$e.removeAttribute("data-"+Ue)}),xe.attributes.popper={}}}},ne=[{name:"offset",options:{offset:Rt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Yt}},Se];ie()&&vr&&ne.push({name:"arrow",options:{element:vr,padding:3}}),ne.push.apply(ne,(yt==null?void 0:yt.modifiers)||[]),F.popperInstance=PC(or,K,Object.assign({},yt,{placement:bt,onFirstUpdate:x,modifiers:ne}))}function Xe(){F.popperInstance&&(F.popperInstance.destroy(),F.popperInstance=null)}function lt(){var Fe=F.props.appendTo,yt,bt=ve();F.props.interactive&&Fe===c2||Fe==="parent"?yt=bt.parentNode:yt=f2(Fe,[bt]),yt.contains(K)||yt.appendChild(K),F.state.isMounted=!0,cn()}function Gt(){return Jd(K.querySelectorAll("[data-tippy-root]"))}function Kn(Fe){F.clearDelayTimeouts(),Fe&&Ie("onTrigger",[F,Fe]),mt();var yt=Be(!0),bt=Ee(),Rt=bt[0],Qt=bt[1];Fs.isTouch&&Rt==="hold"&&Qt&&(yt=Qt),yt?n=setTimeout(function(){F.show()},yt):F.show()}function Gn(Fe){if(F.clearDelayTimeouts(),Ie("onUntrigger",[F,Fe]),!F.state.isVisible){Pt();return}if(!(F.props.trigger.indexOf("mouseenter")>=0&&F.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Fe.type)>=0&&u)){var yt=Be(!1);yt?i=setTimeout(function(){F.state.isVisible&&F.hide()},yt):o=requestAnimationFrame(function(){F.hide()})}}function fr(){F.state.isEnabled=!0}function Sr(){F.hide(),F.state.isEnabled=!1}function Cr(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function xi(Fe){if(!F.state.isDestroyed){Ie("onBeforeUpdate",[F,Fe]),yn();var yt=F.props,bt=Oy(r,Object.assign({},yt,Dy(Fe),{ignoreAttributes:!0}));F.props=bt,pn(),yt.interactiveDebounce!==bt.interactiveDebounce&&(ut(),T=Py(Ge,bt.interactiveDebounce)),yt.triggerTarget&&!bt.triggerTarget?Gu(yt.triggerTarget).forEach(function(Rt){Rt.removeAttribute("aria-expanded")}):bt.triggerTarget&&r.removeAttribute("aria-expanded"),Ke(),Ne(),q&&q(yt,bt),F.popperInstance&&(cn(),Gt().forEach(function(Rt){requestAnimationFrame(Rt._tippy.popperInstance.forceUpdate)})),Ie("onAfterUpdate",[F,Fe])}}function Un(Fe){F.setProps({content:Fe})}function xt(){var Fe=F.state.isVisible,yt=F.state.isDestroyed,bt=!F.state.isEnabled,Rt=Fs.isTouch&&!F.props.touch,Qt=Pm(F.props.duration,0,vs.duration);if(!(Fe||yt||bt||Rt)&&!ve().hasAttribute("disabled")&&(Ie("onShow",[F],!1),F.props.onShow(F)!==!1)){if(F.state.isVisible=!0,ie()&&(K.style.visibility="visible"),Ne(),mt(),F.state.isMounted||(K.style.transition="none"),ie()){var Yt=it(),vr=Yt.box,or=Yt.content;zm([vr,or],0)}x=function(){var ne;if(!(!F.state.isVisible||p)){if(p=!0,K.offsetHeight,K.style.transition=F.props.moveTransition,ie()&&F.props.animation){var ce=it(),ge=ce.box,xe=ce.content;zm([ge,xe],Qt),Ry([ge,xe],"visible")}ot(),Ke(),zy(Rm,F),(ne=F.popperInstance)==null||ne.forceUpdate(),Ie("onMount",[F]),F.props.animation&&ie()&&un(Qt,function(){F.state.isShown=!0,Ie("onShown",[F])})}},lt()}}function Pr(){var Fe=!F.state.isVisible,yt=F.state.isDestroyed,bt=!F.state.isEnabled,Rt=Pm(F.props.duration,1,vs.duration);if(!(Fe||yt||bt)&&(Ie("onHide",[F],!1),F.props.onHide(F)!==!1)){if(F.state.isVisible=!1,F.state.isShown=!1,p=!1,u=!1,ie()&&(K.style.visibility="hidden"),ut(),Pt(),Ne(!0),ie()){var Qt=it(),Yt=Qt.box,vr=Qt.content;F.props.animation&&(zm([Yt,vr],Rt),Ry([Yt,vr],"hidden"))}ot(),Ke(),F.props.animation?ie()&&jt(Rt,F.unmount):F.unmount()}}function br(Fe){ye().addEventListener("mousemove",T),zy(wd,T),T(Fe)}function Bi(){F.state.isVisible&&F.hide(),F.state.isMounted&&(Xe(),Gt().forEach(function(Fe){Fe._tippy.unmount()}),K.parentNode&&K.parentNode.removeChild(K),Rm=Rm.filter(function(Fe){return Fe!==F}),F.state.isMounted=!1,Ie("onHidden",[F]))}function $n(){F.state.isDestroyed||(F.clearDelayTimeouts(),F.unmount(),yn(),delete r._tippy,F.state.isDestroyed=!0,Ie("onDestroy",[F]))}}function oh(r,e){e===void 0&&(e={});var t=vs.plugins.concat(e.plugins||[]);GC();var n=Object.assign({},e,{plugins:t}),i=jC(r),o=i.reduce(function(u,s){var d=s&&nT(s,n);return d&&u.push(d),u},[]);return lp(r)?o[0]:o}oh.defaultProps=vs;oh.setDefaultProps=YC;oh.currentInput=Fs;Object.assign({},Qw,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});oh.setDefaultProps({render:p2});const rT=r=>({}),jy=r=>({}),iT=r=>({}),Uy=r=>({});function Vy(r){let e,t,n;return t=new i_({props:{$$slots:{default:[oT]},$$scope:{ctx:r}}}),{c(){e=U("span"),ue(t.$$.fragment),Ye(e,"margin-left","auto")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&64&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function oT(r){let e,t;const n=r[3].help,i=vn(n,r,r[6],Uy);return{c(){e=U("div"),i&&i.c(),de(e,"class","context-layer-help-content")},m(o,u){G(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,iT):xn(o[6]),Uy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function qy(r){let e,t;const n=r[3].legend,i=vn(n,r,r[6],jy);return{c(){e=U("div"),i&&i.c(),de(e,"class","legend svelte-1cu2wie")},m(o,u){G(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,rT):xn(o[6]),jy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function sT(r){let e,t,n,i,o,u,s,d,p,g,_=r[2].help&&Vy(r),x=r[0]&&r[2].legend&&qy(r);return{c(){e=U("button"),t=U("input"),n=oe(),i=Me(r[1]),o=oe(),_&&_.c(),u=oe(),x&&x.c(),s=nr(),Ye(t,"aspect-ratio","1.0"),de(t,"type","checkbox"),de(e,"class","context-control"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"justify-content","leading"),Ye(e,"gap","8px"),Ye(e,"text-align","left")},m(C,T){G(C,e,T),B(e,t),t.checked=r[0],B(e,n),B(e,i),B(e,o),_&&_.m(e,null),G(C,u,T),x&&x.m(C,T),G(C,s,T),d=!0,p||(g=[Lt(t,"change",r[4]),Lt(e,"click",r[5])],p=!0)},p(C,[T]){T&1&&(t.checked=C[0]),(!d||T&2)&&kt(i,C[1]),C[2].help?_?(_.p(C,T),T&4&&N(_,1)):(_=Vy(C),_.c(),N(_,1),_.m(e,null)):_&&(Kt(),V(_,1,1,()=>{_=null}),Jt()),C[0]&&C[2].legend?x?(x.p(C,T),T&5&&N(x,1)):(x=qy(C),x.c(),N(x,1),x.m(s.parentNode,s)):x&&(Kt(),V(x,1,1,()=>{x=null}),Jt())},i(C){d||(N(_),N(x),d=!0)},o(C){V(_),V(x),d=!1},d(C){C&&(H(e),H(u),H(s)),_&&_.d(),x&&x.d(C),p=!1,cr(g)}}}function aT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Lg(n);let{label:u}=e,{show:s=!1}=e;function d(){s=this.checked,t(0,s)}const p=()=>t(0,s=!s);return r.$$set=g=>{"label"in g&&t(1,u=g.label),"show"in g&&t(0,s=g.show),"$$scope"in g&&t(6,i=g.$$scope)},[s,u,o,n,d,p,i]}class os extends Et{constructor(e){super(),Mt(this,e,aT,sT,St,{label:1,show:0})}}let Dd=Ln(!0);function lT(r){let e,t;return e=new Ji({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function uT(r){let e,t;return e=new _r({props:{data:r[1],$$slots:{default:[lT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cT(r,e,t){let n;return ct(r,Dd,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class fT extends Et{constructor(e){super(),Mt(this,e,cT,uT,St,{})}}function hT(r){let e,t;return e=new sp({props:{lngLat:r[0],$$slots:{default:[pT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function dT(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[mT]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new sp({props:o}),dn.push(()=>Dn(e,"lngLat",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};s&16&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.lngLat=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function pT(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),de(e,"class","dot svelte-nb4dgc")},m(o,u){G(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function mT(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),de(e,"class","dot svelte-nb4dgc")},m(o,u){G(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function gT(r){let e,t,n,i;const o=[dT,hT],u=[];function s(d,p){return d[1]?0:1}return e=s(r),t=u[e]=o[e](r),{c(){t.c(),n=nr()},m(d,p){u[e].m(d,p),G(d,n,p),i=!0},p(d,[p]){let g=e;e=s(d),e===g?u[e].p(d,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Jt(),t=u[e],t?t.p(d,p):(t=u[e]=o[e](d),t.c()),N(t,1),t.m(n.parentNode,n))},i(d){i||(N(t),i=!0)},o(d){V(t),i=!1},d(d){d&&H(n),u[e].d(d)}}}function _T(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function s(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,s,i]}class Bl extends Et{constructor(e){super(),Mt(this,e,_T,gT,St,{lngLat:0,draggable:1})}}function yT(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=oe(),o&&o.c()},m(u,s){G(u,e,s),G(u,t,s),o&&o.m(u,s),n=!0},p(u,s){o&&o.p&&(!n||s&32)&&wn(o,i,u,u[5],n?bn(i,u[5],s,null):xn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&(H(e),H(t)),o&&o.d(u)}}}function vT(r){let e,t,n,i,o,u,s,d;t=new I3({props:{color:r[0]}});function p(_){r[4](_)}let g={$$slots:{default:[yT]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new Rg({props:g}),dn.push(()=>Dn(i,"show",p)),{c(){e=U("button"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),de(e,"class","icon-btn help svelte-my65h"),de(e,"title","Help")},m(_,x){G(_,e,x),ae(t,e,null),G(_,n,x),ae(i,_,x),u=!0,s||(d=Lt(e,"click",Mf(r[3])),s=!0)},p(_,[x]){const C={};x&1&&(C.color=_[0]),t.$set(C);const T={};x&32&&(T.$$scope={dirty:x,ctx:_}),!o&&x&2&&(o=!0,T.show=_[1],zn(()=>o=!1)),i.$set(T)},i(_){u||(N(t.$$.fragment,_),N(i.$$.fragment,_),u=!0)},o(_){V(t.$$.fragment,_),V(i.$$.fragment,_),u=!1},d(_){_&&(H(e),H(n)),le(t),le(i,_),s=!1,d()}}}function bT(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const s=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,s,d,i]}class i_ extends Et{constructor(e){super(),Mt(this,e,bT,vT,St,{color:0})}}function wT(r){let e,t,n,i;const o=r[1].default,u=vn(o,r,r[0],null);return{c(){e=U("a"),u&&u.c(),de(e,"href","#")},m(s,d){G(s,e,d),u&&u.m(e,null),t=!0,n||(i=Lt(e,"click",Ig(r[2])),n=!0)},p(s,[d]){u&&u.p&&(!t||d&1)&&wn(u,o,s,s[0],t?bn(o,s[0],d,null):xn(s[0]),null)},i(s){t||(N(u,s),t=!0)},o(s){V(u,s),t=!1},d(s){s&&H(e),u&&u.d(s),n=!1,i()}}}function xT(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Pn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class sh extends Et{constructor(e){super(),Mt(this,e,xT,wT,St,{})}}function Hy(r){let e,t,n,i=r[1]!=null&&Gy(r);return{c(){e=U("div"),t=Me(r[0]),n=oe(),i&&i.c(),de(e,"class","cover svelte-1w7hi45")},m(o,u){G(o,e,u),B(e,t),B(e,n),i&&i.m(e,null)},p(o,u){u&1&&kt(t,o[0]),o[1]!=null?i?i.p(o,u):(i=Gy(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&H(e),i&&i.d()}}}function Gy(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],Ye(t,"width","100%")},m(n,i){G(n,e,i),B(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&H(e)}}}function AT(r){let e,t=r[0]&&Hy(r);return{c(){t&&t.c(),e=nr()},m(n,i){t&&t.m(n,i),G(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=Hy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:at,o:at,d(n){n&&H(e),t&&t.d(n)}}}function kT(r,e,t){let{loading:n}=e,{progress:i=null}=e,o,u;return r.$$set=s=>{"loading"in s&&t(0,n=s.loading),"progress"in s&&t(1,i=s.progress)},r.$$.update=()=>{if(r.$$.dirty&13){if(n&&!o)t(2,o=Date.now()),t(3,u=n);else if(!n&&o){const s=Date.now()-o;console.log(`Loading "${u}" took ${s}ms`),t(2,o=void 0)}}},[n,i,o,u]}class ah extends Et{constructor(e){super(),Mt(this,e,kT,AT,St,{loading:0,progress:1})}}function yr(r){var e;switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return((e=gi(y3))==null?void 0:e.project_name)||"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return gi(Da)||"Editing";case"view-shortcuts":return"Shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function ST(r){let e,t=yr(r[0].mode)+"",n;return{c(){e=U("span"),n=Me(t),de(e,"class","page-title svelte-1o8s136")},m(i,o){G(i,e,o),B(e,n)},p(i,o){o&1&&t!==(t=yr(i[0].mode)+"")&&kt(n,t)},d(i){i&&H(e)}}}function CT(r){let e;const t=r[3].default,n=vn(t,r,r[5],null),i=n||ST(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&32)&&wn(n,t,o,o[5],e?bn(t,o[5],u,null):xn(o[5]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){V(i,o),e=!1},d(o){i&&i.d(o)}}}function TT(r){let e,t;return e=new sh({props:{$$slots:{default:[CT]},$$scope:{ctx:r}}}),e.$on("click",r[4]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function MT(r,e,t){let n;ct(r,tr,p=>t(2,n=p));let{$$slots:i={},$$scope:o}=e,{mode:u}=e,{afterLink:s=void 0}=e;const d=()=>{ln(tr,n=u,n),s&&s()};return r.$$set=p=>{"mode"in p&&t(0,u=p.mode),"afterLink"in p&&t(1,s=p.afterLink),"$$scope"in p&&t(5,o=p.$$scope)},[u,s,n,i,d,o]}class Fn extends Et{constructor(e){super(),Mt(this,e,MT,TT,St,{mode:0,afterLink:1})}}function ET(r){let e,t,n,i,o,u=r[0]+1+"",s,d,p=r[1].length+"",g,_,x,C,T,P,I;return{c(){e=U("div"),t=U("button"),n=Me("Previous"),o=oe(),s=Me(u),d=Me(" / "),g=Me(p),_=oe(),x=U("button"),C=Me("Next"),t.disabled=i=r[0]==0,de(t,"data-tippy-content","Left"),x.disabled=T=r[0]==r[1].length-1,de(x,"data-tippy-content","Right"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between"),Ye(e,"align-items","center")},m(E,L){G(E,e,L),B(e,t),B(t,n),B(e,o),B(e,s),B(e,d),B(e,g),B(e,_),B(e,x),B(x,C),P||(I=[Lt(window,"keydown",r[2]),Lt(t,"click",r[3]),Lt(x,"click",r[4])],P=!0)},p(E,[L]){L&1&&i!==(i=E[0]==0)&&(t.disabled=i),L&1&&u!==(u=E[0]+1+"")&&kt(s,u),L&2&&p!==(p=E[1].length+"")&&kt(g,p),L&3&&T!==(T=E[0]==E[1].length-1)&&(x.disabled=T)},i:at,o:at,d(E){E&&H(e),P=!1,cr(I)}}}function LT(r,e,t){let n;ct(r,as,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;ks(()=>{n==null||n.keyboard.disable(),x2()}),ri(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),s()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function s(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,s,d]}class up extends Et{constructor(e){super(),Mt(this,e,LT,ET,St,{list:1,idx:0})}}function Wy(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Zy(r){let e,t,n,i,o=r[4]+"",u,s;return{c(){e=U("div"),t=U("span"),i=oe(),u=Me(o),s=oe(),de(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Ye(t,"background",r[5]),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","6px")},m(d,p){G(d,e,p),B(e,t),B(e,i),B(e,u),B(e,s)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&de(t,"class",n),p&1&&Ye(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&kt(u,o)},d(d){d&&H(e)}}}function IT(r){let e,t=On(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=Zy(Wy(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();Ye(e,"display","grid"),Ye(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Ye(e,"gap","10px")},m(i,o){G(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=On(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const s=Wy(i,t,u);n[u]?n[u].p(s,o):(n[u]=Zy(s),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:at,o:at,d(i){i&&H(e),_i(n,i)}}}function PT(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=s=>{"labelColors"in s&&t(0,n=s.labelColors),"swatchClass"in s&&t(1,i=s.swatchClass),"itemsPerRow"in s&&t(3,o=s.itemsPerRow)},[n,i,u,o]}class o_ extends Et{constructor(e){super(),Mt(this,e,PT,IT,St,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Xy(r,e,t){const n=r.slice();return n[6]=e[t],n}function Ky(r,e,t){const n=r.slice();return n[9]=e[t],n}function Jy(r){let e,t;return{c(){e=U("span"),t=Me(" "),de(e,"class","bucket svelte-3plrz9"),Ye(e,"background",r[9])},m(n,i){G(n,e,i),B(e,t)},p(n,i){i&1&&Ye(e,"background",n[9])},d(n){n&&H(e)}}}function Yy(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,de(e,"class","svelte-3plrz9")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function zT(r){let e,t,n,i,o=On(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=Jy(Ky(r,o,p));let s=On(r[3]),d=[];for(let p=0;p<s.length;p+=1)d[p]=Yy(Xy(r,s,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<u.length;p+=1)u[p].c();n=oe(),i=U("div");for(let p=0;p<d.length;p+=1)d[p].c();de(t,"class","colors svelte-3plrz9"),de(i,"class","labels svelte-3plrz9"),de(e,"class","svelte-3plrz9"),Wt(e,"full-width-bucket-legend",r[2]),Wt(e,"bucketed",r[1].hasOwnProperty("buckets")),Wt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){G(p,e,g),B(e,t);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(t,null);B(e,n),B(e,i);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(i,null)},p(p,[g]){if(g&1){o=On(p[0]);let _;for(_=0;_<o.length;_+=1){const x=Ky(p,o,_);u[_]?u[_].p(x,g):(u[_]=Jy(x),u[_].c(),u[_].m(t,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=o.length}if(g&8){s=On(p[3]);let _;for(_=0;_<s.length;_+=1){const x=Xy(p,s,_);d[_]?d[_].p(x,g):(d[_]=Yy(x),d[_].c(),d[_].m(i,null))}for(;_<d.length;_+=1)d[_].d(1);d.length=s.length}g&4&&Wt(e,"full-width-bucket-legend",p[2]),g&2&&Wt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&Wt(e,"limits",p[1].hasOwnProperty("limits"))},i:at,o:at,d(p){p&&H(e),_i(u,p),_i(d,p)}}}function DT(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,s=[];"limits"in i?s=i.limits:s=i.buckets;let d=s.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,d,o]}class Vo extends Et{constructor(e){super(),Mt(this,e,DT,zT,St,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function RT(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:BT}=Xb;function FT(r){let e,t;return e=new J3({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function OT(r){let e,t;return e=new G3({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Qy(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L;return I=Pg(r[9][0]),{c(){e=U("div"),t=Me(`Click the map to see street view
      `),n=U("br"),i=oe(),o=U("br"),u=oe(),s=U("b"),s.textContent="Street view source",d=oe(),p=U("label"),g=U("input"),_=Me(`
        Google Street View`),x=oe(),C=U("label"),T=U("input"),P=Me(`
        Bing Streetside`),de(g,"type","radio"),g.__value="google",Zn(g,g.__value),de(g,"class","svelte-1kgc7zz"),de(p,"class","svelte-1kgc7zz"),de(T,"type","radio"),T.__value="bing",Zn(T,T.__value),de(T,"class","svelte-1kgc7zz"),de(C,"class","svelte-1kgc7zz"),de(e,"class","street-view-control-source svelte-1kgc7zz"),Wt(e,"expanded",r[0]),I.p(g,T)},m(O,F){G(O,e,F),B(e,t),B(e,n),B(e,i),B(e,o),B(e,u),B(e,s),B(e,d),B(e,p),B(p,g),g.checked=g.__value===r[1],B(p,_),B(e,x),B(e,C),B(C,T),T.checked=T.__value===r[1],B(C,P),E||(L=[Lt(g,"change",r[8]),Lt(T,"change",r[10])],E=!0)},p(O,F){F&2&&(g.checked=g.__value===O[1]),F&2&&(T.checked=T.__value===O[1]),F&1&&Wt(e,"expanded",O[0])},d(O){O&&H(e),I.r(),E=!1,cr(L)}}}function $T(r){let e,t,n,i,o,u,s,d,p;const g=[OT,FT],_=[];function x(T,P){return T[0]?0:1}n=x(r),i=_[n]=g[n](r);let C=r[0]&&Qy(r);return{c(){e=U("button"),t=U("div"),i.c(),o=oe(),C&&C.c(),u=nr(),de(t,"class","ltn-map-btn"),de(e,"title","Street view")},m(T,P){G(T,e,P),B(e,t),_[n].m(t,null),G(T,o,P),C&&C.m(T,P),G(T,u,P),s=!0,d||(p=Lt(e,"click",r[7]),d=!0)},p(T,P){let I=n;n=x(T),n!==I&&(Kt(),V(_[I],1,1,()=>{_[I]=null}),Jt(),i=_[n],i||(i=_[n]=g[n](T),i.c()),N(i,1),i.m(t,null)),T[0]?C?C.p(T,P):(C=Qy(T),C.c(),C.m(u.parentNode,u)):C&&(C.d(1),C=null)},i(T){s||(N(i),s=!0)},o(T){V(i),s=!1},d(T){T&&(H(e),H(o),H(u)),_[n].d(),C&&C.d(T),d=!1,p()}}}function NT(r){let e,t,n,i;return e=new Iw({props:{$$slots:{default:[$T]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Lt(BT,"keydown",r[4]),n=!0)},p(o,[u]){const s={};u&16387&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function jT(r,e,t){let n;ct(r,Dd,E=>t(12,n=E));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,s="google",d=[];function p(){ln(Dd,n=!1,n),i.on("click",_),i.getCanvas().style.cursor="crosshair";for(let E of RT(i,o))d.push([E,i.getPaintProperty(E,"line-color")]),i.setPaintProperty(E,"line-color","cyan")}function g(){ln(Dd,n=!0,n),i.off("click",_),i.getCanvas().style.cursor="inherit";for(let[E,L]of d)i.setPaintProperty(E,"line-color",L);d=[]}ri(g);function _(E){let L=E.lngLat.lng,O=E.lngLat.lat;s=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${O},${L}&cbp=11,0,0,0,0`,"_blank"):s=="bing"&&window.open(`https://www.bing.com/maps?cp=${O}~${L}&style=x`,"_blank")}function x(E){!n&&E.key=="Escape"&&(E.stopPropagation(),g())}const C=[[]],T=()=>{t(0,u=!u),u?p():g()};function P(){s=this.__value,t(1,s)}function I(){s=this.__value,t(1,s)}return r.$$set=E=>{"map"in E&&t(5,i=E.map),"maptilerBasemap"in E&&t(6,o=E.maptilerBasemap)},[u,s,p,g,x,i,o,T,P,C,I]}class UT extends Et{constructor(e){super(),Mt(this,e,jT,NT,St,{map:5,maptilerBasemap:6})}}function _n(r,e=!0){return{id:r,beforeId:VT(r),eventsIfTopMost:e}}function VT(r){let e=gi(as);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=e1.length-1;i>=0;i--){let o=e1[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Bm=r=>r,Fm=r=>r;const e1=[Bm(Fm("Background")),"neighbourhood-boundaries",Bm("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Fm("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Fm("Road labels"),Bm("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let m2=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],g2=[20,30,40,50,60,70],$l=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],cp=$l,fp=[0,20,40,60,80,100],hp=$l.toReversed(),dp=[0,1300,3e3,4200,5900,52e3],Rd=$l.toReversed(),qT=[0,.3,.6,1,1.5,2],HT=$l.toReversed(),_2=[0,1,10,50,100,1e3],y2=$l.toReversed(),v2=[0,1,10,50,100,1e3],b2=$l.toReversed(),pp=[0,20,40,60,80,100],mp=$l;function w2(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const GT="#0C793A",vo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function x2(){oh("[data-tippy-content]")}function ia(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function ja(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Ua(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function ac(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function Of(r){return r?gi(As)=="cnt"?cg(r,"LAD_"):r:"custom area"}function A2(r){let e=gi(Wa).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;rp(n,JSON.stringify(e))}function ug(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function za(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function t1(r){return r.reduce((e,t)=>e+t,0)}function cg(r,e){return r.startsWith(e)?r.slice(e.length):r}function n1(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function WT(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function ZT(r){let e,t;const n=[_n("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":ia(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?In(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function XT(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Bus routes",$$slots:{help:[WT]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new nh({props:{url:`pmtiles://${$o("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[ZT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),G(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&5&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}function KT(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class JT extends Et{constructor(e){super(),Mt(this,e,KT,XT,St,{})}}var YT=Object.defineProperty,k2=r=>{throw TypeError(r)},QT=(r,e,t)=>e in r?YT(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ro=(r,e,t)=>QT(r,typeof e!="symbol"?e+"":e,t),S2=(r,e,t)=>e.has(r)||k2("Cannot "+t),vi=(r,e,t)=>(S2(r,e,"read from private field"),t?t.call(r):e.get(r)),r1=(r,e,t)=>e.has(r)?k2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),i1=(r,e,t,n)=>(S2(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Ur(){}function eM(r,e){for(const t in e)r[t]=e[t];return r}function C2(r){return r()}function o1(){return Object.create(null)}function da(r){r.forEach(C2)}function T2(r){return typeof r=="function"}function Ka(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let xd;function Yi(r,e){return r===e?!0:(xd||(xd=document.createElement("a")),xd.href=e,r===xd.href)}function tM(r){return Object.keys(r).length===0}function nM(r,e,t,n){if(r){const i=M2(r,e,t,n);return r[0](i)}}function M2(r,e,t,n){return r[1]&&n?eM(t.ctx.slice(),r[1](n(e))):t.ctx}function rM(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function iM(r,e,t,n,i,o){if(i){const u=M2(e,t,n,o);r.p(u,i)}}function oM(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function s1(r){return r??""}function rr(r,e){r.appendChild(e)}function Hr(r,e,t){r.insertBefore(e,t||null)}function Vr(r){r.parentNode&&r.parentNode.removeChild(r)}function Ar(r){return document.createElement(r)}function xs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Va(r){return document.createTextNode(r)}function Oo(){return Va(" ")}function sM(){return Va("")}function co(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function aM(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Tt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function lM(r){return Array.from(r.childNodes)}function Wf(r,e){e=""+e,r.data!==e&&(r.data=e)}function a1(r,e){r.value=e??""}function rs(r,e,t){r.classList.toggle(e,!!t)}function uM(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Zf;function $f(r){Zf=r}function E2(){if(!Zf)throw new Error("Function called outside component initialization");return Zf}function cM(r){E2().$$.on_destroy.push(r)}function fM(){const r=E2();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=uM(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function l1(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Wu=[],fg=[];let Yu=[];const u1=[],hM=Promise.resolve();let hg=!1;function dM(){hg||(hg=!0,hM.then(L2))}function dg(r){Yu.push(r)}const Om=new Set;let Uu=0;function L2(){if(Uu!==0)return;const r=Zf;do{try{for(;Uu<Wu.length;){const e=Wu[Uu];Uu++,$f(e),pM(e.$$)}}catch(e){throw Wu.length=0,Uu=0,e}for($f(null),Wu.length=0,Uu=0;fg.length;)fg.pop()();for(let e=0;e<Yu.length;e+=1){const t=Yu[e];Om.has(t)||(Om.add(t),t())}Yu.length=0}while(Wu.length);for(;u1.length;)u1.pop()();hg=!1,Om.clear(),$f(r)}function pM(r){if(r.fragment!==null){r.update(),da(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(dg)}}function mM(r){const e=[],t=[];Yu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Yu=e}const Bd=new Set;let Ll;function Fd(){Ll={r:0,c:[],p:Ll}}function Od(){Ll.r||da(Ll.c),Ll=Ll.p}function di(r,e){r&&r.i&&(Bd.delete(r),r.i(e))}function Ti(r,e,t,n){if(r&&r.o){if(Bd.has(r))return;Bd.add(r),Ll.c.push(()=>{Bd.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function c1(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function gM(r,e){Ti(r,1,1,()=>{e.delete(r.key)})}function _M(r,e,t,n,i,o,u,s,d,p,g,_){let x=r.length,C=o.length,T=x;const P={};for(;T--;)P[r[T].key]=T;const I=[],E=new Map,L=new Map,O=[];for(T=C;T--;){const q=_(i,o,T),J=t(q);let fe=u.get(J);fe?O.push(()=>fe.p(q,e)):(fe=p(J,q),fe.c()),E.set(J,I[T]=fe),J in P&&L.set(J,Math.abs(T-P[J]))}const F=new Set,Z=new Set;function K(q){di(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=I[C-1],J=r[x-1],fe=q.key,Ee=J.key;q===J?(g=q.first,x--,C--):E.has(Ee)?!u.has(fe)||F.has(fe)?K(q):Z.has(Ee)?x--:L.get(fe)>L.get(Ee)?(Z.add(fe),K(q)):(F.add(Ee),x--):(d(J,u),x--)}for(;x--;){const q=r[x];E.has(q.key)||d(q,u)}for(;C;)K(I[C-1]);return da(O),I}function qa(r){r&&r.c()}function fa(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),dg(()=>{const o=r.$$.on_mount.map(C2).filter(T2);r.$$.on_destroy?r.$$.on_destroy.push(...o):da(o),r.$$.on_mount=[]}),i.forEach(dg)}function ha(r,e){const t=r.$$;t.fragment!==null&&(mM(t.after_update),da(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function yM(r,e){r.$$.dirty[0]===-1&&(Wu.push(r),dM(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ja(r,e,t,n,i,o,u=null,s=[-1]){const d=Zf;$f(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Ur,not_equal:i,bound:o1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:o1(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=T)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](T),g&&yM(r,_)),x}):[],p.update(),g=!0,da(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=lM(e.target);p.fragment&&p.fragment.l(_),_.forEach(Vr)}else p.fragment&&p.fragment.c();e.intro&&di(r.$$.fragment),fa(r,e.target,e.anchor),L2()}$f(d)}class Ya{constructor(){Ro(this,"$$"),Ro(this,"$$set")}$destroy(){ha(this,1),this.$destroy=Ur}$on(e,t){if(!T2(t))return Ur;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!tM(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const vM="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(vM);function bM(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Tt(e,"viewBox","0 0 14 14"),Tt(e,"width","13"),Tt(e,"height","13"),Tt(e,"class","svelte-en2qvf")},m(n,i){Hr(n,e,i),rr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class I2 extends Ya{constructor(e){super(),Ja(this,e,null,bM,Ka,{})}}function wM(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Tt(e,"viewBox","0 0 30 30"),Tt(e,"fill","none"),Tt(e,"xmlns","http://www.w3.org/2000/svg"),Tt(e,"class","svelte-d2loi5")},m(n,i){Hr(n,e,i),rr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class P2 extends Ya{constructor(e){super(),Ja(this,e,null,wM,Ka,{})}}function xM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"area.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"area.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function AM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"reverse.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"reverse.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function kM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"poi.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"poi.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function SM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"postal_code.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"postal_code.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function CM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"street.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"street.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function TM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"road.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"road.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function MM(r){let e,t;return{c(){e=Ar("img"),Yi(e.src,t=r[3]+"housenumber.svg")||Tt(e,"src",t),Tt(e,"alt",r[6]),Tt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"housenumber.svg")&&Tt(e,"src",t),i&64&&Tt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function EM(r){let e,t,n,i;return{c(){e=Ar("img"),Yi(e.src,t=r[5])||Tt(e,"src",t),Tt(e,"alt",r[4]),Tt(e,"class","svelte-ltkwvy")},m(o,u){Hr(o,e,u),n||(i=co(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Yi(e.src,t=o[5])&&Tt(e,"src",t),u&16&&Tt(e,"alt",o[4])},d(o){o&&Vr(e),n=!1,i()}}}function f1(r){let e,t;return{c(){e=Ar("span"),t=Va(r[6]),Tt(e,"class","secondary svelte-ltkwvy")},m(n,i){Hr(n,e,i),rr(e,t)},p(n,i){i&64&&Wf(t,n[6])},d(n){n&&Vr(e)}}}function LM(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,P,I=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,L,O;function F(J,fe){return fe&1&&(t=null),fe&1&&(n=null),fe&1&&(i=null),fe&1&&(o=null),J[5]?EM:J[0].address?MM:(t==null&&(t=!!J[0].id.startsWith("road.")),t?TM:(n==null&&(n=!!J[0].id.startsWith("address.")),n?CM:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?SM:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?kM:J[7]?AM:xM))))}let Z=F(r,-1),K=Z(r),q=C&&f1(r);return{c(){e=Ar("li"),K.c(),u=Oo(),s=Ar("span"),d=Ar("span"),p=Ar("span"),_=Va(g),x=Oo(),q&&q.c(),T=Oo(),P=Ar("span"),E=Va(I),Tt(p,"class","primary svelte-ltkwvy"),Tt(d,"class","svelte-ltkwvy"),Tt(P,"class","line2 svelte-ltkwvy"),Tt(s,"class","texts svelte-ltkwvy"),Tt(e,"tabindex","0"),Tt(e,"data-selected",r[1]),Tt(e,"class","svelte-ltkwvy"),rs(e,"selected",r[1])},m(J,fe){Hr(J,e,fe),K.m(e,null),rr(e,u),rr(e,s),rr(s,d),rr(d,p),rr(p,_),rr(d,x),q&&q.m(d,null),rr(s,T),rr(s,P),rr(P,E),L||(O=[co(e,"mouseenter",r[12]),co(e,"focus",r[13])],L=!0)},p(J,[fe]){Z===(Z=F(J,fe))&&K?K.p(J,fe):(K.d(1),K=Z(J),K&&(K.c(),K.m(e,u))),fe&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&Wf(_,g),fe&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?q?q.p(J,fe):(q=f1(J),q.c(),q.m(d,null)):q&&(q.d(1),q=null),fe&1&&I!==(I=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Wf(E,I),fe&2&&Tt(e,"data-selected",J[1]),fe&2&&rs(e,"selected",J[1])},i:Ur,o:Ur,d(J){J&&Vr(e),K.d(),q&&q.d(),L=!1,da(O)}}}function IM(r,e,t){var n;let i,o,{feature:u}=e,{selected:s=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const _=(n=u.properties)==null?void 0:n.categories;let x,C,T=0,P=u.place_type[0]==="reverse";function I(){C&&p.add(C),t(10,T++,T)}function E(F){l1.call(this,r,F)}function L(F){l1.call(this,r,F)}const O=()=>I();return r.$$set=F=>{"feature"in F&&t(0,u=F.feature),"selected"in F&&t(1,s=F.selected),"showPlaceType"in F&&t(2,d=F.showPlaceType),"missingIconsCache"in F&&t(9,p=F.missingIconsCache),"iconsBaseUrl"in F&&t(3,g=F.iconsBaseUrl)},r.$$.update=()=>{var F,Z,K,q;if(r.$$.dirty&3640)do t(11,i--,i),t(4,x=_==null?void 0:_[i]),t(5,C=x?g+x.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||p.has(C)));r.$$.dirty&1&&t(6,o=((Z=(F=u.properties)==null?void 0:F.categories)==null?void 0:Z.join(", "))??((q=(K=u.properties)==null?void 0:K.place_type_name)==null?void 0:q[0])??u.place_type[0])},t(11,i=(_==null?void 0:_.length)??0),[u,s,d,g,x,C,o,P,I,p,T,i,E,L,O]}class PM extends Ya{constructor(e){super(),Ja(this,e,IM,LM,Ka,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function zM(r){let e;return{c(){e=Ar("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Tt(e,"class","svelte-7cmwmc")},m(t,n){Hr(t,e,n)},p:Ur,i:Ur,o:Ur,d(t){t&&Vr(e)}}}class DM extends Ya{constructor(e){super(),Ja(this,e,null,zM,Ka,{})}}function RM(r){let e,t,n;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"stroke-width","4"),Tt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Tt(t,"class","svelte-gzo3ar"),Tt(e,"width",n=r[0]==="list"?20:void 0),Tt(e,"viewBox","0 0 70 85"),Tt(e,"fill","none"),Tt(e,"class","svelte-gzo3ar"),rs(e,"in-map",r[0]!=="list"),rs(e,"list-icon",r[0]==="list")},m(i,o){Hr(i,e,o),rr(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&Tt(e,"width",n),o&1&&rs(e,"in-map",i[0]!=="list"),o&1&&rs(e,"list-icon",i[0]==="list")},i:Ur,o:Ur,d(i){i&&Vr(e)}}}function BM(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class FM extends Ya{constructor(e){super(),Ja(this,e,BM,RM,Ka,{displayIn:0})}}function OM(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Tt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Tt(e,"viewBox","0 0 60.006 21.412"),Tt(e,"width","14"),Tt(e,"height","20"),Tt(e,"class","svelte-en2qvf")},m(n,i){Hr(n,e,i),rr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class $M extends Ya{constructor(e){super(),Ja(this,e,null,OM,Ka,{})}}function NM(r){let e,t,n;return{c(){e=xs("svg"),t=xs("circle"),n=xs("path"),Tt(t,"cx","4.789"),Tt(t,"cy","4.787"),Tt(t,"r","3.85"),Tt(t,"class","svelte-1aq105l"),Tt(n,"d","M12.063 12.063 7.635 7.635"),Tt(n,"class","svelte-1aq105l"),Tt(e,"xmlns","http://www.w3.org/2000/svg"),Tt(e,"width","13"),Tt(e,"height","13"),Tt(e,"viewBox","0 0 13 13"),Tt(e,"class","svelte-1aq105l")},m(i,o){Hr(i,e,o),rr(e,t),rr(e,n)},p:Ur,i:Ur,o:Ur,d(i){i&&Vr(e)}}}class jM extends Ya{constructor(e){super(),Ja(this,e,null,NM,Ka,{})}}function UM(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function Yd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let mf;async function VM(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(mf&&i.cachedLocationExpiry&&mf.time+i.cachedLocationExpiry>Date.now()){if(!mf.coords)break e;return mf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(mf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const qM=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,h1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,d1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,p1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,m1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,g1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function HM(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i}° ${u}, ${o}° ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=_1(_,3).toFixed(3).padStart(6,"0"),T=_1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),d=`${p}° ${C}' ${u}, ${g}° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(_),T=Math.floor(x);let P=((_-C)*60).toFixed(1).padStart(4,"0"),I=((x-T)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),L=T.toString().padStart(2,"0");P.endsWith(".0")&&I.endsWith(".0")&&(P=P.replace(/\.0$/,""),I=I.replace(/\.0$/,"")),d=`${p}° ${E}' ${P}" ${u}, ${g}° ${L}' ${I}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function _1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function s_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(qM.test(r))throw new Error("invalid coordinate value");if(h1.test(r))if(s=h1.exec(r),d=gf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(d1.test(r))if(s=d1.exec(r),d=gf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(p1.test(r))if(s=p1.exec(r),d=gf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(m1.test(r))if(s=m1.exec(r),d=gf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(g1.test(r)){if(s=g1.exec(r),d=gf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const E=Math.floor(r.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;T.length%2==1?E=Math.floor(T.length/2):E=T.length/2-1;let L=0;if(E==0)L=g.indexOf(T[0]),_=g.substring(0,L).trim(),x=g.substring(L+1).trim();else{let O=0,F=0;for(;O<=E;)L=g.indexOf(T[O],F),F=L+1,O++;_=g.substring(0,L).trim(),x=g.substring(L+1).trim()}}const P=_.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");const I=x.split(".");if(I.length==2&&I[1]==0&&I[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:GM,toCoordinateFormat:HM})}else throw new Error("coordinates pattern match failed")}function gf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function y1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function GM(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return y1(this.decimalLatitude,Number(e[0]))&&y1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const WM=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});s_.to=WM;const ZM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],XM={decimalLatitude:40.123,decimalLongitude:-74.123},KM=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],JM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function YM(){const r=[];return ZM.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...XM})}),[...r,...KM,...JM]}const QM=YM();s_.formats=QM.map(r=>r.verbatimCoordinates);const eE=s_;function v1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function b1(r){let e,t;return e=new DM({}),{c(){qa(e.$$.fragment)},m(n,i){fa(e,n,i),t=!0},i(n){t||(di(e.$$.fragment,n),t=!0)},o(n){Ti(e.$$.fragment,n),t=!1},d(n){ha(e,n)}}}function w1(r){let e,t,n,i,o;return t=new $M({}),{c(){e=Ar("button"),qa(t.$$.fragment),Tt(e,"type","button"),Tt(e,"title",r[9]),Tt(e,"class","svelte-bz0zu3"),rs(e,"active",r[0])},m(u,s){Hr(u,e,s),fa(t,e,null),n=!0,i||(o=co(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&Tt(e,"title",u[9]),(!n||s[0]&1)&&rs(e,"active",u[0])},i(u){n||(di(t.$$.fragment,u),n=!0)},o(u){Ti(t.$$.fragment,u),n=!1},d(u){u&&Vr(e),ha(t),i=!1,o()}}}function tE(r){let e,t=[],n=new Map,i,o,u,s=c1(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=v1(r,s,p),_=d(g);n.set(_,t[p]=x1(_,g))}return{c(){e=Ar("ul");for(let p=0;p<t.length;p+=1)t[p].c();Tt(e,"class","options svelte-bz0zu3")},m(p,g){Hr(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[co(e,"mouseleave",r[73]),co(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=c1(p[14]),Fd(),t=_M(t,g,d,1,p,s,n,e,gM,x1,null,v1),Od())},i(p){if(!i){for(let g=0;g<s.length;g+=1)di(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Ti(t[g]);i=!1},d(p){p&&Vr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,da(u)}}}function nE(r){let e,t,n,i,o,u;return t=new P2({}),{c(){e=Ar("div"),qa(t.$$.fragment),n=Oo(),i=Ar("div"),o=Va(r[7]),Tt(i,"class","svelte-bz0zu3"),Tt(e,"class","no-results svelte-bz0zu3")},m(s,d){Hr(s,e,d),fa(t,e,null),rr(e,n),rr(e,i),rr(i,o),u=!0},p(s,d){(!u||d[0]&128)&&Wf(o,s[7])},i(s){u||(di(t.$$.fragment,s),u=!0)},o(s){Ti(t.$$.fragment,s),u=!1},d(s){s&&Vr(e),ha(t)}}}function rE(r){let e="",t;return{c(){t=Va(e)},m(n,i){Hr(n,t,i)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(t)}}}function iE(r){let e,t,n,i,o,u,s,d,p,g,_;return t=new P2({}),d=new I2({}),{c(){e=Ar("div"),qa(t.$$.fragment),n=Oo(),i=Ar("div"),o=Va(r[6]),u=Oo(),s=Ar("button"),qa(d.$$.fragment),Tt(i,"class","svelte-bz0zu3"),Tt(s,"class","svelte-bz0zu3"),Tt(e,"class","error svelte-bz0zu3")},m(x,C){Hr(x,e,C),fa(t,e,null),rr(e,n),rr(e,i),rr(i,o),rr(e,u),rr(e,s),fa(d,s,null),p=!0,g||(_=co(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&Wf(o,x[6])},i(x){p||(di(t.$$.fragment,x),di(d.$$.fragment,x),p=!0)},o(x){Ti(t.$$.fragment,x),Ti(d.$$.fragment,x),p=!1},d(x){x&&Vr(e),ha(t),ha(d),g=!1,_()}}}function x1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new PM({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=sM(),qa(n.$$.fragment),this.first=t},m(s,d){Hr(s,t,d),fa(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(di(n.$$.fragment,s),i=!0)},o(s){Ti(n.$$.fragment,s),i=!1},d(s){s&&Vr(t),ha(n,s)}}}function oE(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K=!1;o=new jM({}),_=new I2({});let q=r[19]&&b1(),J=r[5]==="button"&&w1(r);const fe=r[61].default,Ee=nM(fe,r,r[60],null),ee=[iE,rE,nE,tE],ie=[];function ve(ye,it){var Be,Ne;return ye[18]?0:ye[16]?((Be=ye[14])==null?void 0:Be.length)===0?2:ye[16]&&(Ne=ye[14])!=null&&Ne.length?3:-1:1}return~(I=ve(r))&&(E=ie[I]=ee[I](r)),{c(){e=Oo(),t=Ar("form"),n=Ar("div"),i=Ar("button"),qa(o.$$.fragment),u=Oo(),s=Ar("input"),d=Oo(),p=Ar("div"),g=Ar("button"),qa(_.$$.fragment),x=Oo(),q&&q.c(),C=Oo(),J&&J.c(),T=Oo(),Ee&&Ee.c(),P=Oo(),E&&E.c(),Tt(i,"class","search-button svelte-bz0zu3"),Tt(i,"type","button"),Tt(s,"placeholder",r[8]),Tt(s,"aria-label",r[8]),Tt(s,"class","svelte-bz0zu3"),Tt(g,"type","button"),Tt(g,"title",r[3]),Tt(g,"class","svelte-bz0zu3"),Tt(p,"class","clear-button-container svelte-bz0zu3"),rs(p,"displayable",r[1]!==""),Tt(n,"class","input-group svelte-bz0zu3"),Tt(t,"tabindex","0"),Tt(t,"class",L=s1(r[2])+" svelte-bz0zu3"),rs(t,"can-collapse",r[4]&&r[1]==="")},m(ye,it){Hr(ye,e,it),Hr(ye,t,it),rr(t,n),rr(n,i),fa(o,i,null),rr(n,u),rr(n,s),r[63](s),a1(s,r[1]),rr(n,d),rr(n,p),rr(p,g),fa(_,g,null),rr(p,x),q&&q.m(p,null),rr(n,C),J&&J.m(n,null),rr(n,T),Ee&&Ee.m(n,null),rr(t,P),~I&&ie[I].m(t,null),O=!0,F||(Z=[co(i,"click",r[62]),co(s,"input",r[64]),co(s,"focus",r[65]),co(s,"blur",r[66]),co(s,"keydown",r[22]),co(s,"input",r[67]),co(g,"click",r[68]),co(t,"submit",aM(r[21]))],F=!0)},p(ye,it){(!O||it[0]&256)&&Tt(s,"placeholder",ye[8]),(!O||it[0]&256)&&Tt(s,"aria-label",ye[8]),it[0]&2&&s.value!==ye[1]&&a1(s,ye[1]),(!O||it[0]&8)&&Tt(g,"title",ye[3]),ye[19]?q?it[0]&524288&&di(q,1):(q=b1(),q.c(),di(q,1),q.m(p,null)):q&&(Fd(),Ti(q,1,1,()=>{q=null}),Od()),(!O||it[0]&2)&&rs(p,"displayable",ye[1]!==""),ye[5]==="button"?J?(J.p(ye,it),it[0]&32&&di(J,1)):(J=w1(ye),J.c(),di(J,1),J.m(n,T)):J&&(Fd(),Ti(J,1,1,()=>{J=null}),Od()),Ee&&Ee.p&&(!O||it[1]&536870912)&&iM(Ee,fe,ye,ye[60],O?rM(fe,ye[60],it,null):oM(ye[60]),null);let Be=I;I=ve(ye),I===Be?~I&&ie[I].p(ye,it):(E&&(Fd(),Ti(ie[Be],1,1,()=>{ie[Be]=null}),Od()),~I?(E=ie[I],E?E.p(ye,it):(E=ie[I]=ee[I](ye),E.c()),di(E,1),E.m(t,null)):E=null),(!O||it[0]&4&&L!==(L=s1(ye[2])+" svelte-bz0zu3"))&&Tt(t,"class",L),(!O||it[0]&22)&&rs(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){O||(di(K),di(o.$$.fragment,ye),di(_.$$.fragment,ye),di(q),di(J),di(Ee,ye),di(E),O=!0)},o(ye){Ti(K),Ti(o.$$.fragment,ye),Ti(_.$$.fragment,ye),Ti(q),Ti(J),Ti(Ee,ye),Ti(E),O=!1},d(ye){ye&&(Vr(e),Vr(t)),ha(o),r[63](null),ha(_),q&&q.d(),J&&J.d(),Ee&&Ee.d(ye),~I&&ie[I].d(),F=!1,da(Z)}}}function sE(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:P=200}=e,{enableReverse:I="never"}=e,{errorMessage:E="Something went wrong…"}=e,{filter:L=()=>!0}=e,{flyTo:O=!0}=e,{fuzzyMatch:F=!0}=e,{language:Z=void 0}=e,{limit:K=void 0}=e,{mapController:q=void 0}=e,{minLength:J=2}=e,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ee="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:ie=I==="always"}=e,{reverseButtonTitle:ve="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:it="full-geometry"}=e,{showPlaceType:Be="if-needed"}=e,{showResultsWhileTyping:Ne=!0}=e,{selectFirst:Ie=!0}=e,{flyToSelected:ot=!1}=e,{markerOnSelected:Ke=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:pt=!1}=e,{excludeTypes:_t=!1}=e,{zoom:He=s}=e,{apiUrl:mt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:un=()=>{}}=e;function nn(){Xe.focus()}function rn(){Xe.blur()}function pn(re,Je=!0,Qe=!1){t(1,ye=re),Je?(t(15,lt=-1),xt()):(bt(!Qe,Qe),setTimeout(()=>{Xe.focus(),Xe.select()}))}function yn(){t(14,At=void 0),t(56,he=void 0),t(15,lt=-1)}function qe(){t(55,tt=[]),t(56,he=void 0)}let Ge=!1,At,tt,he,cn="",Xe,lt=-1,Gt,Kn=[],Gn,fr,Sr,Cr;const xi=new Set,Un=fM();cM(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function xt(re){if(fr&&(clearTimeout(fr),fr=void 0),lt>-1&&At)t(56,he=At[lt]),t(1,ye=he.place_type[0]==="reverse"?he.place_name:he.place_name.replace(/,.*/,"")),t(18,Gt=void 0),t(55,tt=void 0),t(15,lt=-1);else if(ye){const Je=re||!Pr(ye);br(ye,{exact:!0}).then(()=>{t(55,tt=At),t(56,he=void 0),Je&&Bi()}).catch(Qe=>t(18,Gt=Qe))}}function Pr(re){try{return eE(re,6)}catch{return!1}}async function br(re,{byId:Je=!1,exact:Qe=!1}={}){t(18,Gt=void 0),Gn==null||Gn.abort();const nt=new AbortController;t(19,Gn=nt);try{const ht=Pr(re),Dt=new URLSearchParams;if(Z!==void 0&&Dt.set("language",Array.isArray(Z)?Z.join(","):Z??""),ut&&Dt.set("types",ut.join(",")),_t&&Dt.set("excludeTypes",String(_t)),g&&Dt.set("bbox",g.map(Nn=>Nn.toFixed(6)).join(",")),T&&Dt.set("country",Array.isArray(T)?T.join(","):T),!Je&&!ht){const Nn=await VM(q,ee,nt);Nn&&Dt.set("proximity",Nn),(Qe||!Ne)&&Dt.set("autocomplete","false"),Dt.set("fuzzyMatch",String(F))}K!==void 0&&(pt||!ht||(ut==null?void 0:ut.length)===1)&&Dt.set("limit",String(K)),Dt.set("key",p),un(Dt);const en=mt+"/"+encodeURIComponent(ht?ht.decimalLongitude+","+ht.decimalLatitude:re)+".json?"+Dt.toString();if(en===cn){Je?(t(14,At=void 0),t(56,he=Kn[0])):t(14,At=Kn);return}cn=en;const mn=await fetch(en,{signal:nt.signal,...Pt});if(!mn.ok)throw new Error(await mn.text());const Cn=await mn.json();Un("response",{url:en,featureCollection:Cn}),Je?(t(14,At=void 0),t(56,he=Cn.features[0]),Kn=[he]):(t(14,At=Cn.features.filter(L)),ht&&At.unshift({type:"Feature",properties:{},id:"reverse_"+ht.decimalLongitude+"_"+ht.decimalLatitude,text:ht.decimalLatitude+", "+ht.decimalLongitude,place_name:ht.decimalLatitude+", "+ht.decimalLongitude,place_type:["reverse"],center:[ht.decimalLongitude,ht.decimalLatitude],bbox:[ht.decimalLongitude,ht.decimalLatitude,ht.decimalLongitude,ht.decimalLatitude],geometry:{type:"Point",coordinates:[ht.decimalLongitude,ht.decimalLatitude]}}),Kn=At,ht&&Xe.focus())}catch(ht){if(ht&&typeof ht=="object"&&"name"in ht&&ht.name==="AbortError")return;throw ht}finally{nt===Gn&&t(19,Gn=void 0)}}function Bi(){var re;if(!(tt!=null&&tt.length)||!O)return;const Je=[180,90,-180,-90],Qe=!tt.some(ht=>!ht.matching_text);let nt;for(const ht of tt){const Dt=$n(ht);if(nt=nt===void 0?Dt:Dt===void 0?nt:Math.max(nt,Dt),Qe||!ht.matching_text)for(const en of[0,1,2,3])Je[en]=Math[en<2?"min":"max"](Je[en],((re=ht.bbox)==null?void 0:re[en])??ht.center[en%2])}q&&tt.length>0&&(he&&Je[0]===Je[2]&&Je[1]===Je[3]?q.flyTo(he.center,$n(he)):q.fitBounds(Yd(Je),50,nt))}function $n(re){var Je;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Qe=re.id.replace(/\..*/,"");return(Array.isArray((Je=re.properties)==null?void 0:Je.categories)?re.properties.categories.reduce((nt,ht)=>{const Dt=He[Qe+"."+ht];return nt===void 0?Dt:Dt===void 0?nt:Math.max(nt,Dt)},void 0):void 0)??He[Qe]}function Fe(re){t(0,ie=I==="always"),t(14,At=void 0),t(56,he=void 0),t(15,lt=-1),pn(re[1].toFixed(6)+", "+UM(re[0],[-180,180],!0).toFixed(6),!1,!0)}function yt(re){if(!At)return;let Je=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Je&&(lt===(Ie?0:-1)&&Je===-1&&t(15,lt=At.length),t(15,lt+=Je),lt>=At.length&&t(15,lt=-1),lt<0&&Ie&&t(15,lt=0),re.preventDefault())}function bt(re=!0,Je=!1){if(t(18,Gt=void 0),Ne||Je){if(fr&&clearTimeout(fr),ye.length<J)return;const Qe=ye;fr=window.setTimeout(()=>{br(Qe).catch(nt=>t(18,Gt=nt))},re?P:0)}else t(14,At=void 0),t(18,Gt=void 0)}function Rt(re){t(56,he=re),t(1,ye=re.place_name),t(15,lt=-1)}const Qt=()=>Xe.focus();function Yt(re){fg[re?"unshift":"push"](()=>{Xe=re,t(17,Xe)})}function vr(){ye=this.value,t(1,ye),t(13,Ge),t(28,x)}const or=()=>t(13,Ge=!0),Se=()=>t(13,Ge=!1),ne=()=>bt(),ce=()=>{t(1,ye=""),Xe.focus()},ge=()=>t(0,ie=!ie),xe=()=>t(18,Gt=void 0),Oe=re=>t(15,lt=re),$e=re=>Rt(re),Ue=()=>{Ie||t(15,lt=-1)},ze=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,T=re.country),"debounceSearch"in re&&t(30,P=re.debounceSearch),"enableReverse"in re&&t(5,I=re.enableReverse),"errorMessage"in re&&t(6,E=re.errorMessage),"filter"in re&&t(31,L=re.filter),"flyTo"in re&&t(32,O=re.flyTo),"fuzzyMatch"in re&&t(33,F=re.fuzzyMatch),"language"in re&&t(34,Z=re.language),"limit"in re&&t(35,K=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,J=re.minLength),"noResultsMessage"in re&&t(7,fe=re.noResultsMessage),"placeholder"in re&&t(8,Ee=re.placeholder),"proximity"in re&&t(38,ee=re.proximity),"reverseActive"in re&&t(0,ie=re.reverseActive),"reverseButtonTitle"in re&&t(9,ve=re.reverseButtonTitle),"searchValue"in re&&t(1,ye=re.searchValue),"pickedResultStyle"in re&&t(39,it=re.pickedResultStyle),"showPlaceType"in re&&t(10,Be=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,Ne=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Ie=re.selectFirst),"flyToSelected"in re&&t(41,ot=re.flyToSelected),"markerOnSelected"in re&&t(42,Ke=re.markerOnSelected),"types"in re&&t(43,ut=re.types),"exhaustiveReverseGeocoding"in re&&t(44,pt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,_t=re.excludeTypes),"zoom"in re&&t(46,He=re.zoom),"apiUrl"in re&&t(47,mt=re.apiUrl),"fetchParameters"in re&&t(48,Pt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,jt=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,un=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ie=I==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Sr=Ge),x&&!Ge&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<J&&(t(56,he=void 0),t(14,At=void 0),t(18,Gt=void 0),t(55,tt=At)),r.$$.dirty[1]&33554688&&it!=="marker-only"&&he&&!he.address&&he.geometry.type==="Point"&&he.place_type[0]!=="reverse"&&br(he.id,{byId:!0}).catch(re=>t(18,Gt=re)),r.$$.dirty[1]&100663330&&(q&&he&&he.id!==Cr&&O&&(!he.bbox||he.bbox[0]===he.bbox[2]&&he.bbox[1]===he.bbox[3]?q.flyTo(he.center,$n(he)):q.fitBounds(Yd(he.bbox),50,$n(he)),t(14,At=void 0),t(55,tt=void 0),t(15,lt=-1)),t(57,Cr=he==null?void 0:he.id)),r.$$.dirty[0]&18432&&Ie&&At!=null&&At.length&&t(15,lt=0),r.$$.dirty[0]&2&&t(15,lt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&tt!==At&&t(55,tt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":ie&&Fe(re.coordinates);break;case"markerClick":{const Je=At==null?void 0:At.find(Qe=>Qe.id===re.id);Je&&Rt(Je)}break;case"markerMouseEnter":tt&&t(15,lt=Sr?(At==null?void 0:At.findIndex(Je=>Je.id===re.id))??-1:-1);break;case"markerMouseLeave":tt&&t(15,lt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=At==null?void 0:At[lt]),r.$$.dirty[1]&134218786&&q&&i&&O&&ot&&q.flyTo(i.center,$n(i)),r.$$.dirty[1]&256&&t(59,n=it==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ke||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Ke&&!tt&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(tt,he,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&tt&&q&&q.setSelectedMarker(lt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=Pr(ye);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Un("select",{feature:i}),r.$$.dirty[1]&33554432&&Un("pick",{feature:he}),r.$$.dirty[0]&81920&&Un("optionsvisibilitychange",{optionsVisible:Sr&&!!At}),r.$$.dirty[0]&16384&&Un("featureslisted",{features:At}),r.$$.dirty[1]&16777216&&Un("featuresmarked",{features:tt}),r.$$.dirty[0]&1&&Un("reversetoggle",{reverse:ie}),r.$$.dirty[0]&2&&Un("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(ie)},[ie,ye,d,_,C,I,E,fe,Ee,ve,Be,Ie,jt,Ge,At,lt,Sr,Xe,Gt,Gn,xi,xt,yt,bt,Rt,s,p,g,x,T,P,L,O,F,Z,K,q,J,ee,it,Ne,ot,Ke,ut,pt,_t,He,mt,Pt,un,nn,rn,pn,yn,qe,tt,he,Cr,i,n,u,o,Qt,Yt,vr,or,Se,ne,ce,ge,xe,Oe,$e,Ue,ze]}let aE=class extends Ya{constructor(r){super(),Ja(this,r,sE,oE,Ka,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Xf(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function a_(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return Xf({type:"Polygon",coordinates:r},e,t)}function Kf(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function z2(r,e,t={}){return Xf({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function lE(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(p){return function(g){return d([p,g])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var Ha=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function uE(r,e){return r>e?1:r<e?-1:0}function Ra(r,e,t){for(var n=new Ha(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function $m(r,e,t,n){var i=new Ha(r,e);if(t===null)return i.left=i.right=null,i;t=Ra(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function A1(r,e,t){var n=null,i=null;if(e){e=Ra(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function cE(r,e,t){return e===null?r:(r===null||(e=Ra(r.key,e,t),e.left=r),e)}function pg(r,e,t,n,i){if(r){n(""+e+(t?"└── ":"├── ")+i(r)+`
`);var o=e+(t?"    ":"│   ");r.left&&pg(r.left,o,!1,n,i),r.right&&pg(r.right,o,!0,n,i)}}var l_=function(){function r(e){e===void 0&&(e=uE),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=$m(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ha(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Ra(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Ra(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Ra(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ra(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Ra(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,s=this._root,d;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),d=u(s.key,t),d>0)break;if(u(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return hE(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&_g(e,t,0,i-1,o),this._root===null)this._root=mg(e,t,0,i),this._size=i;else{var u=dE(this.toList(),fE(e,t),o);i=this._size+i,this._root=gg({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return pg(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=A1(e,this._root,i),u=o.left,s=o.right;i(e,t)<0?s=$m(t,n,s,i):u=$m(t,n,u,i),this._root=cE(u,s,i)},r.prototype.split=function(e){return A1(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return lE(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function mg(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],s=e[o],d=new Ha(u,s);return d.left=mg(r,e,t,o),d.right=mg(r,e,o+1,n),d}return null}function fE(r,e){for(var t=new Ha(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ha(r[i],e[i]);return n.next=null,t.next}function hE(r){for(var e=r,t=[],n=!1,i=new Ha(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function gg(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=gg(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=gg(r,i+1,t),u}return null}function dE(r,e,t){for(var n=new Ha(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function _g(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,s=n+1;;){do u++;while(i(r[u],o)<0);do s--;while(i(r[s],o)>0);if(u>=s)break;var d=r[u];r[u]=r[s],r[s]=d,d=e[u],e[u]=e[s],e[s]=d}_g(r,e,t,s,i),_g(r,e,s+1,n,i)}}const la=11102230246251565e-32,Gi=134217729,pE=(3+8*la)*la;function Nm(r,e,t,n,i){let o,u,s,d,p=e[0],g=n[0],_=0,x=0;g>p==g>-p?(o=p,p=e[++_]):(o=g,g=n[++x]);let C=0;if(_<r&&x<t)for(g>p==g>-p?(u=p+o,s=o-(u-p),p=e[++_]):(u=g+o,s=o-(u-g),g=n[++x]),o=u,s!==0&&(i[C++]=s);_<r&&x<t;)g>p==g>-p?(u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++_]):(u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x]),o=u,s!==0&&(i[C++]=s);for(;_<r;)u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++_],o=u,s!==0&&(i[C++]=s);for(;x<t;)u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x],o=u,s!==0&&(i[C++]=s);return(o!==0||C===0)&&(i[C++]=o),C}function mE(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function lh(r){return new Float64Array(r)}const gE=(3+16*la)*la,_E=(2+12*la)*la,yE=(9+64*la)*la*la,Vu=lh(4),k1=lh(8),S1=lh(12),C1=lh(16),uo=lh(4);function vE(r,e,t,n,i,o,u){let s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K,q,J;const fe=r-i,Ee=t-i,ee=e-o,ie=n-o;F=fe*ie,x=Gi*fe,C=x-(x-fe),T=fe-C,x=Gi*ie,P=x-(x-ie),I=ie-P,Z=T*I-(F-C*P-T*P-C*I),K=ee*Ee,x=Gi*ee,C=x-(x-ee),T=ee-C,x=Gi*Ee,P=x-(x-Ee),I=Ee-P,q=T*I-(K-C*P-T*P-C*I),E=Z-q,_=Z-E,Vu[0]=Z-(E+_)+(_-q),L=F+E,_=L-F,O=F-(L-_)+(E-_),E=O-K,_=O-E,Vu[1]=O-(E+_)+(_-K),J=L+E,_=J-L,Vu[2]=L-(J-_)+(E-_),Vu[3]=J;let ve=mE(4,Vu),ye=_E*u;if(ve>=ye||-ve>=ye||(_=r-fe,s=r-(fe+_)+(_-i),_=t-Ee,p=t-(Ee+_)+(_-i),_=e-ee,d=e-(ee+_)+(_-o),_=n-ie,g=n-(ie+_)+(_-o),s===0&&d===0&&p===0&&g===0)||(ye=yE*u+pE*Math.abs(ve),ve+=fe*g+ie*s-(ee*p+Ee*d),ve>=ye||-ve>=ye))return ve;F=s*ie,x=Gi*s,C=x-(x-s),T=s-C,x=Gi*ie,P=x-(x-ie),I=ie-P,Z=T*I-(F-C*P-T*P-C*I),K=d*Ee,x=Gi*d,C=x-(x-d),T=d-C,x=Gi*Ee,P=x-(x-Ee),I=Ee-P,q=T*I-(K-C*P-T*P-C*I),E=Z-q,_=Z-E,uo[0]=Z-(E+_)+(_-q),L=F+E,_=L-F,O=F-(L-_)+(E-_),E=O-K,_=O-E,uo[1]=O-(E+_)+(_-K),J=L+E,_=J-L,uo[2]=L-(J-_)+(E-_),uo[3]=J;const it=Nm(4,Vu,4,uo,k1);F=fe*g,x=Gi*fe,C=x-(x-fe),T=fe-C,x=Gi*g,P=x-(x-g),I=g-P,Z=T*I-(F-C*P-T*P-C*I),K=ee*p,x=Gi*ee,C=x-(x-ee),T=ee-C,x=Gi*p,P=x-(x-p),I=p-P,q=T*I-(K-C*P-T*P-C*I),E=Z-q,_=Z-E,uo[0]=Z-(E+_)+(_-q),L=F+E,_=L-F,O=F-(L-_)+(E-_),E=O-K,_=O-E,uo[1]=O-(E+_)+(_-K),J=L+E,_=J-L,uo[2]=L-(J-_)+(E-_),uo[3]=J;const Be=Nm(it,k1,4,uo,S1);F=s*g,x=Gi*s,C=x-(x-s),T=s-C,x=Gi*g,P=x-(x-g),I=g-P,Z=T*I-(F-C*P-T*P-C*I),K=d*p,x=Gi*d,C=x-(x-d),T=d-C,x=Gi*p,P=x-(x-p),I=p-P,q=T*I-(K-C*P-T*P-C*I),E=Z-q,_=Z-E,uo[0]=Z-(E+_)+(_-q),L=F+E,_=L-F,O=F-(L-_)+(E-_),E=O-K,_=O-E,uo[1]=O-(E+_)+(_-K),J=L+E,_=J-L,uo[2]=L-(J-_)+(E-_),uo[3]=J;const Ne=Nm(Be,S1,4,uo,C1);return C1[Ne-1]}function bE(r,e,t,n,i,o){const u=(e-o)*(t-i),s=(r-i)*(n-o),d=u-s,p=Math.abs(u+s);return Math.abs(d)>=gE*p?d:-vE(r,e,t,n,i,o,p)}const _f=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,yg=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Oa=Number.EPSILON;Oa===void 0&&(Oa=Math.pow(2,-52));const wE=Oa*Oa,T1=(r,e)=>{if(-Oa<r&&r<Oa&&-Oa<e&&e<Oa)return 0;const t=r-e;return t*t<wE*r*e?0:r<e?-1:1};class xE{constructor(){this.reset()}reset(){this.xRounder=new M1,this.yRounder=new M1}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class M1{constructor(){this.tree=new l_,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&T1(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&T1(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const Jf=new xE,$d=(r,e)=>r.x*e.y-r.y*e.x,D2=(r,e)=>r.x*e.x+r.y*e.y,E1=(r,e,t)=>{const n=bE(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},Qd=r=>Math.sqrt(D2(r,r)),AE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return $d(i,n)/Qd(i)/Qd(n)},kE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return D2(i,n)/Qd(i)/Qd(n)},L1=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},I1=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},SE=(r,e,t,n)=>{if(e.x===0)return I1(t,n,r.x);if(n.x===0)return I1(r,e,t.x);if(e.y===0)return L1(t,n,r.y);if(n.y===0)return L1(r,e,t.y);const i=$d(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=$d(o,e)/i,s=$d(o,n)/i,d=r.x+s*e.x,p=t.x+u*n.x,g=r.y+s*e.y,_=t.y+u*n.y,x=(d+p)/2,C=(g+_)/2;return{x,y:C}};class es{static compare(e,t){const n=es.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:$a.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:AE(this.point,e.point,o.point),cosine:kE(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:s}=t.get(i),{sine:d,cosine:p}=t.get(o);return u>=0&&d>=0?s<p?1:s>p?-1:0:u<0&&d<0?s<p?-1:s>p?1:0:d<u?-1:d>u?1:0}}}let CE=0;class $a{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const s=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(d<s&&d<p)return 1;if(d>s&&d>p)return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(n>i){if(s<d&&s<g)return-1;if(s>d&&s>g)return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s<d)return-1;if(s>d)return 1;if(o<u){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o>u){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(o!==u){const _=p-s,x=o-n,C=g-d,T=u-i;if(_>x&&C<T)return 1;if(_<x&&C>T)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++CE,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const s=es.comparePoints(e,t);if(s<0)i=e,o=t,u=1;else if(s>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new es(i,!0),p=new es(o,!1);return new $a(d,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const s=(e.x-t.x)/i.x,d=t.y+s*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=yg(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,s=e.leftSE.point,d=e.rightSE.point,p=_f(t,s)&&this.comparePoint(s)===0,g=_f(n,o)&&e.comparePoint(o)===0,_=_f(t,d)&&this.comparePoint(d)===0,x=_f(n,u)&&e.comparePoint(u)===0;if(g&&p)return x&&!_?u:!x&&_?d:null;if(g)return _&&o.x===d.x&&o.y===d.y?null:o;if(p)return x&&u.x===s.x&&u.y===s.y?null:s;if(x&&_)return null;if(x)return u;if(_)return d;const C=SE(o,this.vector(),s,e.vector());return C===null||!_f(i,C)?null:Jf.round(C.x,C.y)}split(e){const t=[],n=e.events!==void 0,i=new es(e,!0),o=new es(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const s=new $a(i,u,this.rings.slice(),this.windings.slice());return es.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),es.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=$a.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const s=n.rings[o],d=n.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,d=this.rings.length;s<d;s++){const p=this.rings[s],g=this.windings[s],_=t.indexOf(p);_===-1?(t.push(p),n.push(g)):n[_]+=g}const o=[],u=[];for(let s=0,d=t.length;s<d;s++){if(n[s]===0)continue;const p=t[s],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let s=0,d=o.length;s<d;s++){const p=o[s].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(bs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===bs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${bs.type}`)}return this._isInResult}}class P1{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Jf.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,s=e.length;u<s;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=Jf.round(e[u][0],e[u][1]);d.x===o.x&&d.y===o.y||(this.segments.push($a.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push($a.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class TE{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new P1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new P1(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class z1{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new TE(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class ep{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,s=o.leftSE,d=o.rightSE;const p=[s],g=s.point,_=[];for(;u=s,s=d,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const P=p[0].point,I=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${P.x}, ${P.y}]. Last matching segment found ends at [${I.x}, ${I.y}].`)}if(x.length===1){d=x[0].otherSE;break}let C=null;for(let P=0,I=_.length;P<I;P++)if(_[P].point===s.point){C=P;break}if(C!==null){const P=_.splice(C)[0],I=p.splice(P.index);I.unshift(I[0].otherSE),t.push(new ep(I.reverse()));continue}_.push({index:p.length,point:s.point});const T=s.getLeftmostComparator(u);d=x.sort(T)[0].otherSE;break}t.push(new ep(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const _=this.events[p].point,x=this.events[p+1].point;E1(_,e,x)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const n=t[0],i=t[1];E1(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,d=[];for(let p=u;p!=s;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];es.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class D1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class ME{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new D1(o));else{const u=o.enclosingRing();u.poly||t.push(new D1(u)),u.poly.addInterior(o)}}return t}}class EE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$a.compare;this.queue=e,this.tree=new l_(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,s,d;for(;s===void 0;)o=this.tree.prev(o),o===null?s=null:o.key.consumedBy===void 0&&(s=o.key);for(;d===void 0;)u=this.tree.next(u),u===null?d=null:u.key.consumedBy===void 0&&(d=u.key);if(e.isLeft){let p=null;if(s){const _=s.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(p=_),!s.isAnEndpoint(_))){const x=this._splitSafely(s,_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}let g=null;if(d){const _=d.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(g=_),!d.isAnEndpoint(_))){const x=this._splitSafely(d,_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}if(p!==null||g!==null){let _=null;p===null?_=g:g===null?_=p:_=es.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const x=t.split(_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&d){const p=s.getIntersection(d);if(p!==null){if(!s.isAnEndpoint(p)){const g=this._splitSafely(s,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}if(!d.isAnEndpoint(p)){const g=this._splitSafely(d,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const R1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,LE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class IE{run(e,t,n){bs.type=e,Jf.reset();const i=[new z1(t,!0)];for(let g=0,_=n.length;g<_;g++)i.push(new z1(n[g],!1));if(bs.numMultiPolys=i.length,bs.type==="difference"){const g=i[0];let _=1;for(;_<i.length;)yg(i[_].bbox,g.bbox)!==null?_++:i.splice(_,1)}if(bs.type==="intersection")for(let g=0,_=i.length;g<_;g++){const x=i[g];for(let C=g+1,T=i.length;C<T;C++)if(yg(x.bbox,i[C].bbox)===null)return[]}const o=new l_(es.compare);for(let g=0,_=i.length;g<_;g++){const x=i[g].getSweepEvents();for(let C=0,T=x.length;C<T;C++)if(o.insert(x[C]),o.size>R1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new EE(o);let s=o.size,d=o.pop();for(;d;){const g=d.key;if(o.size===s){const x=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(o.size>R1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>LE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const _=u.process(g);for(let x=0,C=_.length;x<C;x++){const T=_[x];T.consumedBy===void 0&&o.insert(T)}s=o.size,d=o.pop()}Jf.reset();const p=ep.factory(u.segments);return new ME(p).getGeom()}}const bs=new IE,PE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("union",r,t)},zE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("intersection",r,t)},DE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("xor",r,t)},RE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("difference",r,t)};var R2={union:PE,intersection:zE,xor:DE,difference:RE};function B2(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",P=C==="Feature",I=T?r.features.length:1,E=0;E<I;E++){p=T?r.features[E].geometry:P?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var L=0;L<s;L++){var O=0,F=0;if(u=x?p.geometries[L]:p,u!==null){d=u.coordinates;var Z=u.type;switch(g=0,Z){case null:break;case"Point":if(e(d,_,E,O,F)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,E,O,F)===!1)return!1;_++,Z==="MultiPoint"&&O++}Z==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,E,O,F)===!1)return!1;_++}Z==="MultiLineString"&&O++,Z==="Polygon"&&F++}Z==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(F=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,E,O,F)===!1)return!1;_++}F++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(B2(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function u_(r,e){var t,n,i,o,u,s,d,p,g,_,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",P=C?r.features.length:1;for(t=0;t<P;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,_=C?r.features[t].id:T?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function BE(r,e){u_(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Xf(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(Xf(_,i),n,p)===!1)return!1}})}function FE(r,e={}){const t=[];if(u_(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=R2.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?a_(n[0],e.properties):z2(n,e.properties)}var F2=FE;function OE(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return B2(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var B1=OE;function $E(r){const e=[];if(u_(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=R2.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?a_(n[0],t):z2(n,t)}var NE=$E;function jE(r){if(!r)throw new Error("geojson is required");var e=[];return BE(r,function(t){e.push(t)}),Kf(e)}var UE=jE;function F1(r,e){const t=NE(Kf([a_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=Yd(B1(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,s=UE(r);if(s.features.length>1&&(o||u))for(const d of s.features){const p=Yd(B1(d));if(u&&p[0]<-180+i)for(const g of d.geometry.coordinates)for(const _ of g)_[0]+=360-i;if(o&&p[2]>180-i)for(const g of d.geometry.coordinates)for(const _ of g)_[0]-=360-i}e(Kf([s.features.length<2?r:F2(s)??r,t]))}const O1={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Ad="mtlr-gc-full-geom",$1="mtlr-gc-full-geom-fill",N1="mtlr-gc-full-geom-line";function O2(r,e,t=!0,n=!0,i={},o={},u=O1){let s;const d=[];let p,g,_;function x(){if(!r.loaded){r.once("load",x);return}const I=u?u===!0?O1:u:void 0;if(!(I!=null&&I.fill)&&!(I!=null&&I.line))return;const E=r.getSource(Ad);if(E)E.setData(_??Kf([]));else if(_)r.addSource(Ad,{type:"geojson",data:_});else return;!r.getLayer($1)&&I!=null&&I.fill&&r.addLayer({...I==null?void 0:I.fill,id:$1,type:"fill",source:Ad}),!r.getLayer(N1)&&I!=null&&I.line&&r.addLayer({...I==null?void 0:I.line,id:N1,type:"line",source:Ad})}function C(I){_=I,x()}r.on("styledata",()=>{setTimeout(()=>{_&&x()})});const T=I=>{s==null||s({type:"mapClick",coordinates:[I.lngLat.lng,I.lngLat.lat]})};function P(I=!1){if(!e)throw new Error;const E=document.createElement("div");return I&&E.classList.add("marker-interactive"),new FM({props:{displayIn:"maplibre"},target:E}),new e.Marker({element:E,offset:[1,-13]})}return{setEventHandler(I){I?(s=I,r.on("click",T)):(s=void 0,r.off("click",T))},flyTo(I,E){r.flyTo({center:I,...E?{zoom:E}:{},...i})},fitBounds(I,E,L){r.fitBounds([[I[0],I[1]],[I[2],I[3]]],{padding:E,...L?{maxZoom:L}:{},...o})},indicateReverse(I){r.getCanvasContainer().style.cursor=I?"crosshair":""},setReverseMarker(I){!e||!t||(g?I?g.setLngLat(I):(g.remove(),g=void 0):I&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):P()).setLngLat(I).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(I,E,L){for(const O of d)O.remove();if(d.length=0,C(void 0),!!e){if(E){let O=!1;if(E.geometry.type==="GeometryCollection"){const F=E.geometry.geometries.filter(Z=>Z.type==="Polygon"||Z.type==="MultiPolygon");e:if(F.length>0){const Z=F2(Kf(F.map(K=>Xf(K))));if(!Z)break e;F1({...E,geometry:Z.geometry},C),O=!0}else{const Z=E.geometry.geometries.filter(K=>K.type==="LineString"||K.type==="MultiLineString");Z.length>0&&(C({...E,geometry:{type:"GeometryCollection",geometries:Z}}),O=!0)}}if(!O){if(E.geometry.type==="Polygon"||E.geometry.type==="MultiPolygon")F1(E,C);else if(E.geometry.type==="LineString"||E.geometry.type==="MultiLineString"){C(E);return}}if(!L&&E.geometry.type!=="Point")return;if(t instanceof Function){const F=t(r,E);F&&d.push(F)}else t&&d.push(typeof t=="object"?new e.Marker(t):P().setLngLat(E.center).addTo(r))}if(n)for(const O of I??[]){if(O===E)continue;let F;if(n instanceof Function){if(F=n(r,O),!F)continue}else F=(typeof n=="object"?new e.Marker(n):P(!0)).setLngLat(O.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(O.place_type[0]==="reverse"?O.place_name:O.place_name.replace(/,.*/,""))).addTo(r);const Z=F.getElement();Z.addEventListener("click",K=>{K.stopPropagation(),s==null||s({type:"markerClick",id:O.id})}),Z.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:O.id}),F.togglePopup()}),Z.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:O.id}),F.togglePopup()}),d.push(F)}}},setSelectedMarker(I){p&&p.getElement().classList.toggle("marker-selected",!1),p=I>-1?d[I]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const I=r.getCenter();return[r.getZoom(),I.lng,I.lat]}}}function VE(r,e,t){var n,i;class o{constructor(I,E){Ro(this,"type"),Ro(this,"target"),this.type=E,this.target=I}}class u extends o{constructor(I,E){super(I,"select"),Ro(this,"feature"),Object.assign(this,E)}}class s extends o{constructor(I,E){super(I,"featureslisted"),Ro(this,"features"),this.features=E}}class d extends o{constructor(I,E){super(I,"featuresmarked"),Ro(this,"features"),this.features=E}}class p extends o{constructor(I,E){super(I,"optionsvisibilitychange"),Ro(this,"optionsVisible"),this.optionsVisible=E}}class g extends o{constructor(I,E){super(I,"pick"),Ro(this,"feature"),this.feature=E}}class _ extends o{constructor(I,E){super(I,"querychange"),Ro(this,"query"),this.query=E}}class x extends o{constructor(I,E,L){super(I,"response"),Ro(this,"url"),Ro(this,"featureCollection"),this.url=E,this.featureCollection=L}}class C extends o{constructor(I,E){super(I,"reversetoggle"),Ro(this,"reverse"),this.reverse=E}}class T extends r{constructor(I={}){super(),r1(this,n),r1(this,i),i1(this,i,I)}onAddInt(I){const E=document.createElement("div");E.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:L,showResultMarkers:O,flyTo:F,fullGeometryStyle:Z,...K}=vi(this,i),q=typeof F=="boolean"?{}:F,J={mapController:O2(I,e,L,O,q,q,Z),flyTo:F===void 0?!0:!!F,apiKey:"",...t==null?void 0:t(I,E),...K};if(!J.apiKey)throw new Error("no apiKey provided");return i1(this,n,new aE({target:E,props:J})),vi(this,n).$on("select",fe=>{this.fire(new u(this,fe.detail))}),vi(this,n).$on("pick",fe=>{this.fire(new g(this,fe.detail.feature))}),vi(this,n).$on("featureslisted",fe=>{this.fire(new s(this,fe.detail.features))}),vi(this,n).$on("featuresmarked",fe=>{this.fire(new d(this,fe.detail.features))}),vi(this,n).$on("response",fe=>{this.fire(new x(this,fe.detail.url,fe.detail.featureCollection))}),vi(this,n).$on("optionsvisibilitychange",fe=>{this.fire(new p(this,fe.detail.optionsVisible))}),vi(this,n).$on("reversetoggle",fe=>{this.fire(new C(this,fe.detail.reverse))}),vi(this,n).$on("querychange",fe=>{this.fire(new _(this,fe.detail.query))}),E}on(I,E){return super.on(I,E)}once(I,E){return super.once(I,E)}off(I,E){return super.off(I,E)}listens(I){return super.listens(I)}setOptions(I){var E;Object.assign(vi(this,i),I);const{marker:L,showResultMarkers:O,flyTo:F,fullGeometryStyle:Z,...K}=vi(this,i);(E=vi(this,n))==null||E.$set(K)}setQuery(I,E=!0){var L;(L=vi(this,n))==null||L.setQuery(I,E)}clearMap(){var I;(I=vi(this,n))==null||I.clearMap()}clearList(){var I;(I=vi(this,n))==null||I.clearList()}setReverseMode(I){var E;(E=vi(this,n))==null||E.$set({reverseActive:I})}focus(){var I;(I=vi(this,n))==null||I.focus()}blur(){var I;(I=vi(this,n))==null||I.blur()}onRemove(){var I;(I=vi(this,n))==null||I.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:T,events:{SelectEvent:u,FeaturesListedEvent:s,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:_,ResponseEvent:x,ReverseToggleEvent:C}}}const{MapLibreBasedGeocodingControl:PB,events:Qa}=VE(ua.Evented,bk);Qa.SelectEvent;Qa.FeaturesListedEvent;Qa.FeaturesMarkedEvent;Qa.OptionsVisibilityChangeEvent;Qa.PickEvent;Qa.QueryChangeEvent;Qa.ResponseEvent;Qa.ReverseToggleEvent;function qE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),de(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),de(e,"viewBox","0 0 14 14"),de(e,"width","13"),de(e,"height","13"),de(e,"class","svelte-en2qvf")},m(n,i){G(n,e,i),B(e,t)},p:at,i:at,o:at,d(n){n&&H(e)}}}class $2 extends Et{constructor(e){super(),Mt(this,e,null,qE,St,{})}}function HE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),de(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),de(e,"viewBox","0 0 30 30"),de(e,"fill","none"),de(e,"xmlns","http://www.w3.org/2000/svg"),de(e,"class","svelte-d2loi5")},m(n,i){G(n,e,i),B(e,t)},p:at,i:at,o:at,d(n){n&&H(e)}}}class N2 extends Et{constructor(e){super(),Mt(this,e,null,HE,St,{})}}function GE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"area.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"area.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function WE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"reverse.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"reverse.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function ZE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"poi.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"poi.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function XE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"postal_code.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"postal_code.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function KE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"street.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"street.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function JE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"road.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"road.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function YE(r){let e,t;return{c(){e=U("img"),kr(e.src,t=r[3]+"housenumber.svg")||de(e,"src",t),de(e,"alt",r[6]),de(e,"class","svelte-ltkwvy")},m(n,i){G(n,e,i)},p(n,i){i&8&&!kr(e.src,t=n[3]+"housenumber.svg")&&de(e,"src",t),i&64&&de(e,"alt",n[6])},d(n){n&&H(e)}}}function QE(r){let e,t,n,i;return{c(){e=U("img"),kr(e.src,t=r[5])||de(e,"src",t),de(e,"alt",r[4]),de(e,"class","svelte-ltkwvy")},m(o,u){G(o,e,u),n||(i=Lt(e,"error",r[14]),n=!0)},p(o,u){u&32&&!kr(e.src,t=o[5])&&de(e,"src",t),u&16&&de(e,"alt",o[4])},d(o){o&&H(e),n=!1,i()}}}function j1(r){let e,t;return{c(){e=U("span"),t=Me(r[6]),de(e,"class","secondary svelte-ltkwvy")},m(n,i){G(n,e,i),B(e,t)},p(n,i){i&64&&kt(t,n[6])},d(n){n&&H(e)}}}function e6(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,P,I=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,L,O;function F(J,fe){return fe&1&&(t=null),fe&1&&(n=null),fe&1&&(i=null),fe&1&&(o=null),J[5]?QE:J[0].address?YE:(t==null&&(t=!!J[0].id.startsWith("road.")),t?JE:(n==null&&(n=!!J[0].id.startsWith("address.")),n?KE:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?XE:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?ZE:J[7]?WE:GE))))}let Z=F(r,-1),K=Z(r),q=C&&j1(r);return{c(){e=U("li"),K.c(),u=oe(),s=U("span"),d=U("span"),p=U("span"),_=Me(g),x=oe(),q&&q.c(),T=oe(),P=U("span"),E=Me(I),de(p,"class","primary svelte-ltkwvy"),de(d,"class","svelte-ltkwvy"),de(P,"class","line2 svelte-ltkwvy"),de(s,"class","texts svelte-ltkwvy"),de(e,"tabindex","0"),de(e,"data-selected",r[1]),de(e,"class","svelte-ltkwvy"),Wt(e,"selected",r[1])},m(J,fe){G(J,e,fe),K.m(e,null),B(e,u),B(e,s),B(s,d),B(d,p),B(p,_),B(d,x),q&&q.m(d,null),B(s,T),B(s,P),B(P,E),L||(O=[Lt(e,"mouseenter",r[12]),Lt(e,"focus",r[13])],L=!0)},p(J,[fe]){Z===(Z=F(J,fe))&&K?K.p(J,fe):(K.d(1),K=Z(J),K&&(K.c(),K.m(e,u))),fe&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&kt(_,g),fe&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?q?q.p(J,fe):(q=j1(J),q.c(),q.m(d,null)):q&&(q.d(1),q=null),fe&1&&I!==(I=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&kt(E,I),fe&2&&de(e,"data-selected",J[1]),fe&2&&Wt(e,"selected",J[1])},i:at,o:at,d(J){J&&H(e),K.d(),q&&q.d(),L=!1,cr(O)}}}function t6(r,e,t){var O;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:s}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const g=(O=o.properties)==null?void 0:O.categories;let _,x,C=0,T=o.place_type[0]==="reverse";function P(){x&&d.add(x),t(10,C++,C)}function I(F){Pn.call(this,r,F)}function E(F){Pn.call(this,r,F)}const L=()=>P();return r.$$set=F=>{"feature"in F&&t(0,o=F.feature),"selected"in F&&t(1,u=F.selected),"showPlaceType"in F&&t(2,s=F.showPlaceType),"missingIconsCache"in F&&t(9,d=F.missingIconsCache),"iconsBaseUrl"in F&&t(3,p=F.iconsBaseUrl)},r.$$.update=()=>{var F,Z,K,q;if(r.$$.dirty&3640)do t(11,n--,n),t(4,_=g==null?void 0:g[n]),t(5,x=_?p+_.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!x||d.has(x)));r.$$.dirty&1&&t(6,i=((Z=(F=o.properties)==null?void 0:F.categories)==null?void 0:Z.join(", "))??((q=(K=o.properties)==null?void 0:K.place_type_name)==null?void 0:q[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,s,p,_,x,i,T,P,d,C,n,I,E,L]}class n6 extends Et{constructor(e){super(),Mt(this,e,t6,e6,St,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function r6(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',de(e,"class","svelte-7cmwmc")},m(t,n){G(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}class i6 extends Et{constructor(e){super(),Mt(this,e,null,r6,St,{})}}function o6(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),de(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),de(e,"viewBox","0 0 60.006 21.412"),de(e,"width","14"),de(e,"height","20"),de(e,"class","svelte-en2qvf")},m(n,i){G(n,e,i),B(e,t)},p:at,i:at,o:at,d(n){n&&H(e)}}}class s6 extends Et{constructor(e){super(),Mt(this,e,null,o6,St,{})}}function a6(r){let e,t,n;return{c(){e=ws("svg"),t=ws("circle"),n=ws("path"),de(t,"cx","4.789"),de(t,"cy","4.787"),de(t,"r","3.85"),de(t,"class","svelte-1aq105l"),de(n,"d","M12.063 12.063 7.635 7.635"),de(n,"class","svelte-1aq105l"),de(e,"xmlns","http://www.w3.org/2000/svg"),de(e,"width","13"),de(e,"height","13"),de(e,"viewBox","0 0 13 13"),de(e,"class","svelte-1aq105l")},m(i,o){G(i,e,o),B(e,t),B(e,n)},p:at,i:at,o:at,d(i){i&&H(e)}}}class l6 extends Et{constructor(e){super(),Mt(this,e,null,a6,St,{})}}function u6(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function U1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let yf;async function c6(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(yf&&i.cachedLocationExpiry&&yf.time+i.cachedLocationExpiry>Date.now()){if(!yf.coords)break e;return yf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(yf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const f6=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,V1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,q1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([•º°]?)[\s]*(EAST|WEST|[EW])?$/i,H1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,G1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,W1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|’’|´´|["″”\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([•º°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['′´’\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|′′|´´|’’|["″”\.])?\s*(EAST|WEST|[EW])?$/i;function h6(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i}° ${u}, ${o}° ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=Z1(_,3).toFixed(3).padStart(6,"0"),T=Z1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),d=`${p}° ${C}' ${u}, ${g}° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(_),T=Math.floor(x);let P=((_-C)*60).toFixed(1).padStart(4,"0"),I=((x-T)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),L=T.toString().padStart(2,"0");P.endsWith(".0")&&I.endsWith(".0")&&(P=P.replace(/\.0$/,""),I=I.replace(/\.0$/,"")),d=`${p}° ${E}' ${P}" ${u}, ${g}° ${L}' ${I}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function Z1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function c_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(f6.test(r))throw new Error("invalid coordinate value");if(V1.test(r))if(s=V1.exec(r),d=vf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(q1.test(r))if(s=q1.exec(r),d=vf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(H1.test(r))if(s=H1.exec(r),d=vf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(G1.test(r))if(s=G1.exec(r),d=vf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(W1.test(r)){if(s=W1.exec(r),d=vf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const E=Math.floor(r.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;T.length%2==1?E=Math.floor(T.length/2):E=T.length/2-1;let L=0;if(E==0)L=g.indexOf(T[0]),_=g.substring(0,L).trim(),x=g.substring(L+1).trim();else{let O=0,F=0;for(;O<=E;)L=g.indexOf(T[O],F),F=L+1,O++;_=g.substring(0,L).trim(),x=g.substring(L+1).trim()}}const P=_.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");const I=x.split(".");if(I.length==2&&I[1]==0&&I[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:d6,toCoordinateFormat:h6})}else throw new Error("coordinates pattern match failed")}function vf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function X1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function d6(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return X1(this.decimalLatitude,Number(e[0]))&&X1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const p6=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});c_.to=p6;const m6=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],g6={decimalLatitude:40.123,decimalLongitude:-74.123},_6=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],y6=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48° 30,6410', E 18° 57,4583'",verbatimLatitude:"N 48° 30,6410'",verbatimLongitude:"E 18° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function v6(){const r=[];return m6.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...g6})}),[...r,..._6,...y6]}const b6=v6();c_.formats=b6.map(r=>r.verbatimCoordinates);const w6=c_;function K1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function J1(r){let e,t;return e=new i6({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Y1(r){let e,t,n,i,o;return t=new s6({}),{c(){e=U("button"),ue(t.$$.fragment),de(e,"type","button"),de(e,"title",r[9]),de(e,"class","svelte-bz0zu3"),Wt(e,"active",r[0])},m(u,s){G(u,e,s),ae(t,e,null),n=!0,i||(o=Lt(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&de(e,"title",u[9]),(!n||s[0]&1)&&Wt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){V(t.$$.fragment,u),n=!1},d(u){u&&H(e),le(t),i=!1,o()}}}function x6(r){let e,t=[],n=new Map,i,o,u,s=On(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=K1(r,s,p),_=d(g);n.set(_,t[p]=Q1(_,g))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();de(e,"class","options svelte-bz0zu3")},m(p,g){G(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[Lt(e,"mouseleave",r[73]),Lt(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=On(p[14]),Kt(),t=uk(t,g,d,1,p,s,n,e,lk,Q1,null,K1),Jt())},i(p){if(!i){for(let g=0;g<s.length;g+=1)N(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)V(t[g]);i=!1},d(p){p&&H(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,cr(u)}}}function A6(r){let e,t,n,i,o,u;return t=new N2({}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),o=Me(r[7]),de(i,"class","svelte-bz0zu3"),de(e,"class","no-results svelte-bz0zu3")},m(s,d){G(s,e,d),ae(t,e,null),B(e,n),B(e,i),B(i,o),u=!0},p(s,d){(!u||d[0]&128)&&kt(o,s[7])},i(s){u||(N(t.$$.fragment,s),u=!0)},o(s){V(t.$$.fragment,s),u=!1},d(s){s&&H(e),le(t)}}}function k6(r){let e="",t;return{c(){t=Me(e)},m(n,i){G(n,t,i)},p:at,i:at,o:at,d(n){n&&H(t)}}}function S6(r){let e,t,n,i,o,u,s,d,p,g,_;return t=new N2({}),d=new $2({}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),o=Me(r[6]),u=oe(),s=U("button"),ue(d.$$.fragment),de(i,"class","svelte-bz0zu3"),de(s,"class","svelte-bz0zu3"),de(e,"class","error svelte-bz0zu3")},m(x,C){G(x,e,C),ae(t,e,null),B(e,n),B(e,i),B(i,o),B(e,u),B(e,s),ae(d,s,null),p=!0,g||(_=Lt(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&kt(o,x[6])},i(x){p||(N(t.$$.fragment,x),N(d.$$.fragment,x),p=!0)},o(x){V(t.$$.fragment,x),V(d.$$.fragment,x),p=!1},d(x){x&&H(e),le(t),le(d),g=!1,_()}}}function Q1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new n6({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=nr(),ue(n.$$.fragment),this.first=t},m(s,d){G(s,t,d),ae(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(N(n.$$.fragment,s),i=!0)},o(s){V(n.$$.fragment,s),i=!1},d(s){s&&H(t),le(n,s)}}}function C6(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K=!1;o=new l6({}),_=new $2({});let q=r[19]&&J1(),J=r[5]==="button"&&Y1(r);const fe=r[61].default,Ee=vn(fe,r,r[60],null),ee=[S6,k6,A6,x6],ie=[];function ve(ye,it){var Be,Ne;return ye[18]?0:ye[16]?((Be=ye[14])==null?void 0:Be.length)===0?2:ye[16]&&((Ne=ye[14])!=null&&Ne.length)?3:-1:1}return~(I=ve(r))&&(E=ie[I]=ee[I](r)),{c(){e=oe(),t=U("form"),n=U("div"),i=U("button"),ue(o.$$.fragment),u=oe(),s=U("input"),d=oe(),p=U("div"),g=U("button"),ue(_.$$.fragment),x=oe(),q&&q.c(),C=oe(),J&&J.c(),T=oe(),Ee&&Ee.c(),P=oe(),E&&E.c(),de(i,"class","search-button svelte-bz0zu3"),de(i,"type","button"),de(s,"placeholder",r[8]),de(s,"aria-label",r[8]),de(s,"class","svelte-bz0zu3"),de(g,"type","button"),de(g,"title",r[3]),de(g,"class","svelte-bz0zu3"),de(p,"class","clear-button-container svelte-bz0zu3"),Wt(p,"displayable",r[1]!==""),de(n,"class","input-group svelte-bz0zu3"),de(t,"tabindex","0"),de(t,"class",L=ec(r[2])+" svelte-bz0zu3"),Wt(t,"can-collapse",r[4]&&r[1]==="")},m(ye,it){G(ye,e,it),G(ye,t,it),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),r[63](s),Zn(s,r[1]),B(n,d),B(n,p),B(p,g),ae(_,g,null),B(p,x),q&&q.m(p,null),B(n,C),J&&J.m(n,null),B(n,T),Ee&&Ee.m(n,null),B(t,P),~I&&ie[I].m(t,null),O=!0,F||(Z=[Lt(i,"click",r[62]),Lt(s,"input",r[64]),Lt(s,"focus",r[65]),Lt(s,"blur",r[66]),Lt(s,"keydown",r[22]),Lt(s,"input",r[67]),Lt(g,"click",r[68]),Lt(t,"submit",Ig(r[21]))],F=!0)},p(ye,it){(!O||it[0]&256)&&de(s,"placeholder",ye[8]),(!O||it[0]&256)&&de(s,"aria-label",ye[8]),it[0]&2&&s.value!==ye[1]&&Zn(s,ye[1]),(!O||it[0]&8)&&de(g,"title",ye[3]),ye[19]?q?it[0]&524288&&N(q,1):(q=J1(),q.c(),N(q,1),q.m(p,null)):q&&(Kt(),V(q,1,1,()=>{q=null}),Jt()),(!O||it[0]&2)&&Wt(p,"displayable",ye[1]!==""),ye[5]==="button"?J?(J.p(ye,it),it[0]&32&&N(J,1)):(J=Y1(ye),J.c(),N(J,1),J.m(n,T)):J&&(Kt(),V(J,1,1,()=>{J=null}),Jt()),Ee&&Ee.p&&(!O||it[1]&536870912)&&wn(Ee,fe,ye,ye[60],O?bn(fe,ye[60],it,null):xn(ye[60]),null);let Be=I;I=ve(ye),I===Be?~I&&ie[I].p(ye,it):(E&&(Kt(),V(ie[Be],1,1,()=>{ie[Be]=null}),Jt()),~I?(E=ie[I],E?E.p(ye,it):(E=ie[I]=ee[I](ye),E.c()),N(E,1),E.m(t,null)):E=null),(!O||it[0]&4&&L!==(L=ec(ye[2])+" svelte-bz0zu3"))&&de(t,"class",L),(!O||it[0]&22)&&Wt(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){O||(N(K),N(o.$$.fragment,ye),N(_.$$.fragment,ye),N(q),N(J),N(Ee,ye),N(E),O=!0)},o(ye){V(K),V(o.$$.fragment,ye),V(_.$$.fragment,ye),V(q),V(J),V(Ee,ye),V(E),O=!1},d(ye){ye&&(H(e),H(t)),le(o),r[63](null),le(_),q&&q.d(),J&&J.d(),Ee&&Ee.d(ye),~I&&ie[I].d(),F=!1,cr(Z)}}}function T6(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:P=200}=e,{enableReverse:I="never"}=e,{errorMessage:E="Something went wrong…"}=e,{filter:L=()=>!0}=e,{flyTo:O=!0}=e,{fuzzyMatch:F=!0}=e,{language:Z=void 0}=e,{limit:K=void 0}=e,{mapController:q=void 0}=e,{minLength:J=2}=e,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ee="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:ie=I==="always"}=e,{reverseButtonTitle:ve="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:it="full-geometry"}=e,{showPlaceType:Be="if-needed"}=e,{showResultsWhileTyping:Ne=!0}=e,{selectFirst:Ie=!0}=e,{flyToSelected:ot=!1}=e,{markerOnSelected:Ke=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:pt=!1}=e,{excludeTypes:_t=!1}=e,{zoom:He=s}=e,{apiUrl:mt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:un=()=>{}}=e;function nn(){Xe.focus()}function rn(){Xe.blur()}function pn(re,Je=!0,Qe=!1){t(1,ye=re),Je?(t(15,lt=-1),xt()):(bt(!Qe,Qe),setTimeout(()=>{Xe.focus(),Xe.select()}))}function yn(){t(14,At=void 0),t(56,he=void 0),t(15,lt=-1)}function qe(){t(55,tt=[]),t(56,he=void 0)}let Ge=!1,At,tt,he,cn="",Xe,lt=-1,Gt,Kn=[],Gn,fr,Sr,Cr;const xi=new Set,Un=js();ri(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function xt(re){if(fr&&(clearTimeout(fr),fr=void 0),lt>-1&&At)t(56,he=At[lt]),t(1,ye=he.place_type[0]==="reverse"?he.place_name:he.place_name.replace(/,.*/,"")),t(18,Gt=void 0),t(55,tt=void 0),t(15,lt=-1);else if(ye){const Je=re||!Pr(ye);br(ye,{exact:!0}).then(()=>{t(55,tt=At),t(56,he=void 0),Je&&Bi()}).catch(Qe=>t(18,Gt=Qe))}}function Pr(re){try{return w6(re,6)}catch{return!1}}async function br(re,{byId:Je=!1,exact:Qe=!1}={}){t(18,Gt=void 0),Gn==null||Gn.abort();const nt=new AbortController;t(19,Gn=nt);try{const ht=Pr(re),Dt=new URLSearchParams;if(Z!==void 0&&Dt.set("language",Array.isArray(Z)?Z.join(","):Z??""),ut&&Dt.set("types",ut.join(",")),_t&&Dt.set("excludeTypes",String(_t)),g&&Dt.set("bbox",g.map(Nn=>Nn.toFixed(6)).join(",")),T&&Dt.set("country",Array.isArray(T)?T.join(","):T),!Je&&!ht){const Nn=await c6(q,ee,nt);Nn&&Dt.set("proximity",Nn),(Qe||!Ne)&&Dt.set("autocomplete","false"),Dt.set("fuzzyMatch",String(F))}K!==void 0&&(pt||!ht||(ut==null?void 0:ut.length)===1)&&Dt.set("limit",String(K)),Dt.set("key",p),un(Dt);const en=mt+"/"+encodeURIComponent(ht?ht.decimalLongitude+","+ht.decimalLatitude:re)+".json?"+Dt.toString();if(en===cn){Je?(t(14,At=void 0),t(56,he=Kn[0])):t(14,At=Kn);return}cn=en;const mn=await fetch(en,{signal:nt.signal,...Pt});if(!mn.ok)throw new Error(await mn.text());const Cn=await mn.json();Un("response",{url:en,featureCollection:Cn}),Je?(t(14,At=void 0),t(56,he=Cn.features[0]),Kn=[he]):(t(14,At=Cn.features.filter(L)),ht&&At.unshift({type:"Feature",properties:{},id:"reverse_"+ht.decimalLongitude+"_"+ht.decimalLatitude,text:ht.decimalLatitude+", "+ht.decimalLongitude,place_name:ht.decimalLatitude+", "+ht.decimalLongitude,place_type:["reverse"],center:[ht.decimalLongitude,ht.decimalLatitude],bbox:[ht.decimalLongitude,ht.decimalLatitude,ht.decimalLongitude,ht.decimalLatitude],geometry:{type:"Point",coordinates:[ht.decimalLongitude,ht.decimalLatitude]}}),Kn=At,ht&&Xe.focus())}catch(ht){if(ht&&typeof ht=="object"&&"name"in ht&&ht.name==="AbortError")return;throw ht}finally{nt===Gn&&t(19,Gn=void 0)}}function Bi(){var nt;if(!(tt!=null&&tt.length)||!O)return;const re=[180,90,-180,-90],Je=!tt.some(ht=>!ht.matching_text);let Qe;for(const ht of tt){const Dt=$n(ht);if(Qe=Qe===void 0?Dt:Dt===void 0?Qe:Math.max(Qe,Dt),Je||!ht.matching_text)for(const en of[0,1,2,3])re[en]=Math[en<2?"min":"max"](re[en],((nt=ht.bbox)==null?void 0:nt[en])??ht.center[en%2])}q&&tt.length>0&&(he&&re[0]===re[2]&&re[1]===re[3]?q.flyTo(he.center,$n(he)):q.fitBounds(U1(re),50,Qe))}function $n(re){var Qe;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Je=re.id.replace(/\..*/,"");return(Array.isArray((Qe=re.properties)==null?void 0:Qe.categories)?re.properties.categories.reduce((nt,ht)=>{const Dt=He[Je+"."+ht];return nt===void 0?Dt:Dt===void 0?nt:Math.max(nt,Dt)},void 0):void 0)??He[Je]}function Fe(re){t(0,ie=I==="always"),t(14,At=void 0),t(56,he=void 0),t(15,lt=-1),pn(re[1].toFixed(6)+", "+u6(re[0],[-180,180],!0).toFixed(6),!1,!0)}function yt(re){if(!At)return;let Je=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Je&&(lt===(Ie?0:-1)&&Je===-1&&t(15,lt=At.length),t(15,lt+=Je),lt>=At.length&&t(15,lt=-1),lt<0&&Ie&&t(15,lt=0),re.preventDefault())}function bt(re=!0,Je=!1){if(t(18,Gt=void 0),Ne||Je){if(fr&&clearTimeout(fr),ye.length<J)return;const Qe=ye;fr=window.setTimeout(()=>{br(Qe).catch(nt=>t(18,Gt=nt))},re?P:0)}else t(14,At=void 0),t(18,Gt=void 0)}function Rt(re){t(56,he=re),t(1,ye=re.place_name),t(15,lt=-1)}const Qt=()=>Xe.focus();function Yt(re){dn[re?"unshift":"push"](()=>{Xe=re,t(17,Xe)})}function vr(){ye=this.value,t(1,ye),t(13,Ge),t(28,x)}const or=()=>t(13,Ge=!0),Se=()=>t(13,Ge=!1),ne=()=>bt(),ce=()=>{t(1,ye=""),Xe.focus()},ge=()=>t(0,ie=!ie),xe=()=>t(18,Gt=void 0),Oe=re=>t(15,lt=re),$e=re=>Rt(re),Ue=()=>{Ie||t(15,lt=-1)},ze=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,T=re.country),"debounceSearch"in re&&t(30,P=re.debounceSearch),"enableReverse"in re&&t(5,I=re.enableReverse),"errorMessage"in re&&t(6,E=re.errorMessage),"filter"in re&&t(31,L=re.filter),"flyTo"in re&&t(32,O=re.flyTo),"fuzzyMatch"in re&&t(33,F=re.fuzzyMatch),"language"in re&&t(34,Z=re.language),"limit"in re&&t(35,K=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,J=re.minLength),"noResultsMessage"in re&&t(7,fe=re.noResultsMessage),"placeholder"in re&&t(8,Ee=re.placeholder),"proximity"in re&&t(38,ee=re.proximity),"reverseActive"in re&&t(0,ie=re.reverseActive),"reverseButtonTitle"in re&&t(9,ve=re.reverseButtonTitle),"searchValue"in re&&t(1,ye=re.searchValue),"pickedResultStyle"in re&&t(39,it=re.pickedResultStyle),"showPlaceType"in re&&t(10,Be=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,Ne=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Ie=re.selectFirst),"flyToSelected"in re&&t(41,ot=re.flyToSelected),"markerOnSelected"in re&&t(42,Ke=re.markerOnSelected),"types"in re&&t(43,ut=re.types),"exhaustiveReverseGeocoding"in re&&t(44,pt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,_t=re.excludeTypes),"zoom"in re&&t(46,He=re.zoom),"apiUrl"in re&&t(47,mt=re.apiUrl),"fetchParameters"in re&&t(48,Pt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,jt=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,un=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ie=I==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Sr=Ge),x&&!Ge&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<J&&(t(56,he=void 0),t(14,At=void 0),t(18,Gt=void 0),t(55,tt=At)),r.$$.dirty[1]&33554688&&it!=="marker-only"&&he&&!he.address&&he.geometry.type==="Point"&&he.place_type[0]!=="reverse"&&br(he.id,{byId:!0}).catch(re=>t(18,Gt=re)),r.$$.dirty[1]&100663330&&(q&&he&&he.id!==Cr&&O&&(!he.bbox||he.bbox[0]===he.bbox[2]&&he.bbox[1]===he.bbox[3]?q.flyTo(he.center,$n(he)):q.fitBounds(U1(he.bbox),50,$n(he)),t(14,At=void 0),t(55,tt=void 0),t(15,lt=-1)),t(57,Cr=he==null?void 0:he.id)),r.$$.dirty[0]&18432&&Ie&&At!=null&&At.length&&t(15,lt=0),r.$$.dirty[0]&2&&t(15,lt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&tt!==At&&t(55,tt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":ie&&Fe(re.coordinates);break;case"markerClick":{const Je=At==null?void 0:At.find(Qe=>Qe.id===re.id);Je&&Rt(Je)}break;case"markerMouseEnter":tt&&t(15,lt=Sr?(At==null?void 0:At.findIndex(Je=>Je.id===re.id))??-1:-1);break;case"markerMouseLeave":tt&&t(15,lt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=At==null?void 0:At[lt]),r.$$.dirty[1]&134218786&&q&&i&&O&&ot&&q.flyTo(i.center,$n(i)),r.$$.dirty[1]&256&&t(59,n=it==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ke||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Ke&&!tt&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(tt,he,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&tt&&q&&q.setSelectedMarker(lt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=Pr(ye);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Un("select",{feature:i}),r.$$.dirty[1]&33554432&&Un("pick",{feature:he}),r.$$.dirty[0]&81920&&Un("optionsvisibilitychange",{optionsVisible:Sr&&!!At}),r.$$.dirty[0]&16384&&Un("featureslisted",{features:At}),r.$$.dirty[1]&16777216&&Un("featuresmarked",{features:tt}),r.$$.dirty[0]&1&&Un("reversetoggle",{reverse:ie}),r.$$.dirty[0]&2&&Un("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(ie)},[ie,ye,d,_,C,I,E,fe,Ee,ve,Be,Ie,jt,Ge,At,lt,Sr,Xe,Gt,Gn,xi,xt,yt,bt,Rt,s,p,g,x,T,P,L,O,F,Z,K,q,J,ee,it,Ne,ot,Ke,ut,pt,_t,He,mt,Pt,un,nn,rn,pn,yn,qe,tt,he,Cr,i,n,u,o,Qt,Yt,vr,or,Se,ne,ce,ge,xe,Oe,$e,Ue,ze]}class M6 extends Et{constructor(e){super(),Mt(this,e,T6,C6,St,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function ev(r){let e,t,n;return t=new M6({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"class","svelte-ixhnie")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function E6(r){let e,t,n=r[2]&&ev(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=ev(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function L6(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?O2(p,ni,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,s,o]}class I6 extends Et{constructor(e){super(),Mt(this,e,L6,E6,St,{apiKey:0,map:4,country:1})}}const P6=Symbol.for("svelte-maplibre");function z6(){return Yf(P6)}function D6(r){return"layerType"in r&&r.layerType==="deckgl"}const R6=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),tv=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function nv(r){let e,t,n=(r[4]||r[3]instanceof ni.Marker)&&rv(r);return{c(){e=U("div"),n&&n.c()},m(i,o){G(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof ni.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=rv(i),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(),r[32](null)}}}function rv(r){let e;const t=r[30].default,n=vn(t,r,r[29],tv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,R6):xn(i[29]),tv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function B6(r){let e,t,n=r[9].default&&nv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=nv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function F6(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const _=Lg(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:P=!1}=e,{openOn:I="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:L=!0}=e,{anchor:O=void 0}=e,{offset:F=void 0}=e,{popupClass:Z=void 0}=e,{maxWidth:K=void 0}=e,{lngLat:q=void 0}=e,{html:J=void 0}=e,{open:fe=!1}=e;const Ee=js(),{map:ee,popupTarget:ie,layerEvent:ve,layer:ye,eventTopMost:it}=z6();ct(r,ee,Ge=>t(2,o=Ge)),ct(r,ie,Ge=>t(3,s=Ge)),ct(r,ve,Ge=>t(28,u=Ge)),ct(r,ye,Ge=>t(35,d=Ge));const Be=["click","dblclick","contextmenu"];let Ne,Ie=!1,ot;function Ke(){if(!Ne)return;let Ge=Ne.getElement();!Ge||Ge===ot||(ot=Ge,I==="hover"&&(ot.style.pointerEvents="none"),ot.addEventListener("mouseenter",()=>{t(24,Ie=!0)},{passive:!0}),ot.addEventListener("mouseleave",()=>{t(24,Ie=!1)},{passive:!0}),ot.addEventListener("click",()=>{T&&t(0,fe=!1)},{passive:!0}))}ks(()=>{if(o)return o.on("click",rn),o.on("contextmenu",rn),typeof s=="string"&&(o.on("click",s,He),o.on("dblclick",s,He),o.on("contextmenu",s,He),o.on("mousemove",s,nn),o.on("mouseleave",s,un),o.on("touchstart",s,Pt),o.on("touchend",s,jt)),()=>{o!=null&&o.loaded()&&(Ne==null||Ne.remove(),o.off("click",rn),o.off("contextmenu",rn),s instanceof ni.Marker?s.getPopup()===Ne&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,He),o.off("dblclick",s,He),o.off("contextmenu",s,He),o.off("mousemove",s,nn),o.off("mouseleave",s,un),o.off("touchstart",s,Pt),o.off("touchend",s,jt)))}});function ut(Ge){return E?!("marker"in Ge)&&!D6(Ge)&&it(Ge)!==d:!1}let pt=null,_t="normal";function He(Ge){Ge.type===I&&(ut(Ge)||("layerType"in Ge?Ge.layerType==="deckgl"?(t(10,q=Ge.coordinate),t(4,pt=Ge.object?[Ge.object]:null)):(t(10,q=Ge.lngLat),t(4,pt=Ge.features??[])):(t(10,q=Ge.lngLat),t(4,pt=Ge.features??[])),setTimeout(()=>t(0,fe=!0))))}let mt=null;function Pt(Ge){mt=Ge.point}function jt(Ge){if(!mt||I!=="hover")return;let At=mt.dist(Ge.point);mt=null,At<3&&(t(10,q=Ge.lngLat),t(4,pt=Ge.features??[]),Ne.isOpen()?t(25,_t="justOpened"):(t(25,_t="opening"),t(0,fe=!0)))}function un(Ge){I!=="hover"||mt||_t!=="normal"||(t(0,fe=!1),t(4,pt=null))}function nn(Ge){if(!(I!=="hover"||mt||_t!=="normal")){if(ut(Ge)){t(0,fe=!1),t(4,pt=null);return}t(0,fe=!0),t(4,pt=Ge.features??[]),t(10,q=Ge.lngLat)}}function rn(Ge){if(_t==="justOpened"){t(25,_t="normal");return}if(!C)return;let At=[ot,s instanceof ni.Marker?s==null?void 0:s.getElement():null];fe&&Ne.isOpen()&&!At.some(tt=>tt==null?void 0:tt.contains(Ge.originalEvent.target))&&(Ge.type==="contextmenu"&&I==="contextmenu"||Ge.type!=="contextmenu")&&t(0,fe=!1)}ri(()=>{o&&(Ne!=null&&Ne.isOpen())&&Ne.remove()});let pn;const yn=()=>t(0,fe=!1);function qe(Ge){dn[Ge?"unshift":"push"](()=>{pn=Ge,t(1,pn)})}return r.$$set=Ge=>{"closeButton"in Ge&&t(11,x=Ge.closeButton),"closeOnClickOutside"in Ge&&t(12,C=Ge.closeOnClickOutside),"closeOnClickInside"in Ge&&t(13,T=Ge.closeOnClickInside),"closeOnMove"in Ge&&t(14,P=Ge.closeOnMove),"openOn"in Ge&&t(15,I=Ge.openOn),"openIfTopMost"in Ge&&t(16,E=Ge.openIfTopMost),"focusAfterOpen"in Ge&&t(17,L=Ge.focusAfterOpen),"anchor"in Ge&&t(18,O=Ge.anchor),"offset"in Ge&&t(19,F=Ge.offset),"popupClass"in Ge&&t(20,Z=Ge.popupClass),"maxWidth"in Ge&&t(21,K=Ge.maxWidth),"lngLat"in Ge&&t(10,q=Ge.lngLat),"html"in Ge&&t(22,J=Ge.html),"open"in Ge&&t(0,fe=Ge.open),"$$scope"in Ge&&t(29,g=Ge.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(Ne||(t(23,Ne=new ni.Popup({closeButton:n,closeOnClick:!1,closeOnMove:P,focusAfterOpen:L,maxWidth:K,className:Z,anchor:O,offset:F})),ot=Ne.getElement(),Ne.on("open",()=>{t(0,fe=!0),Ke(),Ee("open",Ne)}),Ne.on("close",()=>{t(0,fe=!1),Ee("close",Ne)}),Ne.on("hover",()=>{Ee("hover",Ne)}))),r.$$.dirty[0]&8421384&&Ne&&s instanceof ni.Marker&&(I==="click"?s.setPopup(Ne):s.getPopup()===Ne&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Be.includes(I)&&(u==null?void 0:u.type)===I&&(He(u),ln(ve,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=I==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&I==="hover"&&ve&&(i&&u&&(u.layerType==="deckgl"?(t(10,q=u.coordinate),t(4,pt=u.object?[u.object]:null)):(t(10,q=u.lngLat),t(4,pt=u.features??[]))),t(0,fe=(i||Ie)??!1)),r.$$.dirty[0]&12582914&&(pn?Ne.setDOMContent(pn):J&&Ne.setHTML(J)),r.$$.dirty[0]&8389632&&q&&Ne.setLngLat(q),r.$$.dirty[0]&41943045&&o){let Ge=Ne.isOpen();fe&&!Ge?(Ne.addTo(o),_t==="opening"&&t(25,_t="justOpened")):!fe&&Ge&&Ne.remove()}},[fe,pn,o,s,pt,ee,ie,ve,ye,_,q,x,C,T,P,I,E,L,O,F,Z,K,J,Ne,Ie,_t,i,n,u,g,p,yn,qe]}class O6 extends Et{constructor(e){super(),Mt(this,e,F6,B6,St,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const $6=r=>({props:r&8}),iv=r=>({props:U6(r[3])});function N6(r){let e;const t=r[1].default,n=vn(t,r,r[2],iv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&wn(n,t,i,i[2],e?bn(t,i[2],o,$6):xn(i[2]),iv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function j6(r){let e,t;return e=new O6({props:{openOn:r[0],$$slots:{default:[N6,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function U6(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function V6(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class pi extends Et{constructor(e){super(),Mt(this,e,V6,j6,St,{openOn:0})}}function No(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function fo(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Qi(){return{type:"FeatureCollection",features:[]}}function q6(r){let e,t,n;return t=new Vo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","legend")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function H6(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function G6(r){let e,t,n;return t=new Vo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","legend")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function W6(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function Z6(r){let e,t,n;return t=new o_({props:{labelColors:r[5]}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","legend")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function X6(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function K6(r){let e,t,n,i,o,u;const s=[_n("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":No(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":ia(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let C=0;C<s.length;C+=1)d=zt(d,s[C]);e=new ur({props:d});const p=[_n("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":No(["get","Level of Service"],r[4],"cyan"),"line-width":ia(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let C=0;C<p.length;C+=1)g=zt(g,p[C]);n=new ur({props:g});const _=[_n("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":No(["get","Infrastructure type"],r[5],"cyan"),"line-width":ia(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={};for(let C=0;C<_.length;C+=1)x=zt(x,_[C]);return o=new ur({props:x}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment)},m(C,T){ae(e,C,T),G(C,t,T),ae(n,C,T),G(C,i,T),ae(o,C,T),u=!0},p(C,T){const P=T&9?In(s,[s[0],s[1],s[2],T&8&&{paint:{"line-color":No(["get","Traffic volume category"],{"0 to 1999":C[3].colorScale[0],"2000 to 3999":C[3].colorScale[1],"4000+":C[3].colorScale[2]},"cyan"),"line-width":ia(0)}},T&1&&{layout:{visibility:C[0]?"visible":"none"}}]):{};e.$set(P);const I=T&18?In(p,[p[0],p[1],T&16&&{paint:{"line-color":No(["get","Level of Service"],C[4],"cyan"),"line-width":ia(1)}},T&2&&{layout:{visibility:C[1]?"visible":"none"}}]):{};n.$set(I);const E=T&36?In(_,[_[0],_[1],_[2],T&32&&{paint:{"line-color":No(["get","Infrastructure type"],C[5],"cyan"),"line-width":ia(1)}},T&4&&{layout:{visibility:C[2]?"visible":"none"}}]):{};o.$set(E)},i(C){u||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),u=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),u=!1},d(C){C&&(H(t),H(i)),le(e,C),le(n,C),le(o,C)}}}function J6(r){let e,t,n,i,o,u,s,d,p,g,_;function x(L){r[6](L)}let C={label:"Traffic",$$slots:{help:[H6],legend:[q6]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new os({props:C}),dn.push(()=>Dn(e,"show",x));function T(L){r[7](L)}let P={label:"Level of Service",$$slots:{help:[W6],legend:[G6]},$$scope:{ctx:r}};r[1]!==void 0&&(P.show=r[1]),i=new os({props:P}),dn.push(()=>Dn(i,"show",T));function I(L){r[8](L)}let E={label:"Cycle infrastructure",$$slots:{help:[X6],legend:[Z6]},$$scope:{ctx:r}};return r[2]!==void 0&&(E.show=r[2]),s=new os({props:E}),dn.push(()=>Dn(s,"show",I)),g=new nh({props:{url:`pmtiles://${$o("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[K6]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment),u=oe(),ue(s.$$.fragment),p=oe(),ue(g.$$.fragment)},m(L,O){ae(e,L,O),G(L,n,O),ae(i,L,O),G(L,u,O),ae(s,L,O),G(L,p,O),ae(g,L,O),_=!0},p(L,[O]){const F={};O&512&&(F.$$scope={dirty:O,ctx:L}),!t&&O&1&&(t=!0,F.show=L[0],zn(()=>t=!1)),e.$set(F);const Z={};O&512&&(Z.$$scope={dirty:O,ctx:L}),!o&&O&2&&(o=!0,Z.show=L[1],zn(()=>o=!1)),i.$set(Z);const K={};O&512&&(K.$$scope={dirty:O,ctx:L}),!d&&O&4&&(d=!0,K.show=L[2],zn(()=>d=!1)),s.$set(K);const q={};O&519&&(q.$$scope={dirty:O,ctx:L}),g.$set(q)},i(L){_||(N(e.$$.fragment,L),N(i.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),_=!0)},o(L){V(e.$$.fragment,L),V(i.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),_=!1},d(L){L&&(H(n),H(u),H(p)),le(e,L),le(i,L),le(s,L),le(g,L)}}}function Y6(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(x){n=x,t(0,n)}function g(x){i=x,t(1,i)}function _(x){o=x,t(2,o)}return[n,i,o,u,s,d,p,g,_]}class Q6 extends Et{constructor(e){super(),Mt(this,e,Y6,J6,St,{})}}function eL(r){let e,t,n;return t=new o_({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","legend")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function tL(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function ov(r){let e,t;return e=new _r({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[iL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function nL(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Me(e)},m(n,i){G(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&kt(t,e)},d(n){n&&H(t)}}}function rL(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[nL,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function iL(r){let e,t;const n=[_n("context-pois"),{paint:{"circle-color":No(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[rL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ol({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&5?In(n,[n[0],u&4&&{paint:{"circle-color":No(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function oL(r){let e,t,n,i,o;function u(p){r[3](p)}let s={label:"POIs",$$slots:{help:[tL],legend:[eL]},$$scope:{ctx:r}};r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u));let d=r[1]&&ov(r);return{c(){ue(e.$$.fragment),n=oe(),d&&d.c(),i=nr()},m(p,g){ae(e,p,g),G(p,n,g),d&&d.m(p,g),G(p,i,g),o=!0},p(p,[g]){const _={};g&32&&(_.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,_.show=p[0],zn(()=>t=!1)),e.$set(_),p[1]?d?(d.p(p,g),g&2&&N(d,1)):(d=ov(p),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Kt(),V(d,1,1,()=>{d=null}),Jt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(H(n),H(i)),le(e,p),d&&d.d(p)}}}function sL(r,e,t){let n;ct(r,Ir,s=>t(1,n=s));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99",Recreation:"#f0027f"};function u(s){i=s,t(0,i)}return[i,n,o,u]}class aL extends Et{constructor(e){super(),Mt(this,e,sL,oL,St,{})}}function lL(r){let e,t,n,i,o;return t=new Vo({props:{colorScale:cp,labels:{buckets:w2(fp)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),de(e,"slot","legend")},m(u,s){G(u,e,s),ae(t,e,null),B(e,n),B(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&H(e),le(t)}}}function uL(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function cL(r){let e,t,n,i,o;return t=new Vo({props:{colorScale:hp,labels:{limits:dp}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / km²</span> <span>More dense</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),de(e,"slot","legend")},m(u,s){G(u,e,s),ae(t,e,null),B(e,n),B(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&H(e),le(t)}}}function fL(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function hL(r){let e,t,n,i,o;return t=new Vo({props:{colorScale:mp,labels:{limits:pp.map(xL)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),de(e,"slot","legend")},m(u,s){G(u,e,s),ae(t,e,null),B(e,n),B(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&H(e),le(t)}}}function dL(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function pL(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",s,d,p=r[6].imd_rank+"",g,_,x=r[6].imd_percentile+"",C,T;return{c(){e=U("p"),t=Me("Data zone "),i=Me(n),o=Me(`
        has `),s=Me(u),d=Me(`
        people, and a SIMD rank of `),g=Me(p),_=Me(`, making it less deprived
        than `),C=Me(x),T=Me("% of data zones.")},m(P,I){G(P,e,I),B(e,t),B(e,i),B(e,o),B(e,s),B(e,d),B(e,g),B(e,_),B(e,C),B(e,T)},p(P,I){I&64&&n!==(n=P[6].id+"")&&kt(i,n),I&64&&u!==(u=P[6].population.toLocaleString()+"")&&kt(s,u),I&64&&p!==(p=P[6].imd_rank+"")&&kt(g,p),I&64&&x!==(x=P[6].imd_percentile+"")&&kt(C,x)},d(P){P&&H(e)}}}function mL(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[pL,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gL(r){let e,t,n=r[6].id+"",i,o,u=ac(r[6].households_with_cars_or_vans,r[6].total_households)+"",s,d,p=r[6].total_households.toLocaleString()+"",g,_;return{c(){e=U("p"),t=Me("In data zone "),i=Me(n),o=oe(),s=Me(u),d=Me(" of approximately "),g=Me(p),_=Me(`
        households have at least one car or van.`)},m(x,C){G(x,e,C),B(e,t),B(e,i),B(e,o),B(e,s),B(e,d),B(e,g),B(e,_)},p(x,C){C&64&&n!==(n=x[6].id+"")&&kt(i,n),C&64&&u!==(u=ac(x[6].households_with_cars_or_vans,x[6].total_households)+"")&&kt(s,u),C&64&&p!==(p=x[6].total_households.toLocaleString()+"")&&kt(g,p)},d(x){x&&H(e)}}}function _L(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[gL,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yL(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",s,d,p=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",g,_;return{c(){e=U("p"),t=Me("Data zone "),i=Me(n),o=Me(`
        has `),s=Me(u),d=Me(`
        people, with a density of `),g=Me(p),_=Me(" people per square kilometer")},m(x,C){G(x,e,C),B(e,t),B(e,i),B(e,o),B(e,s),B(e,d),B(e,g),B(e,_)},p(x,C){C&64&&n!==(n=x[6].id+"")&&kt(i,n),C&64&&u!==(u=x[6].population.toLocaleString()+"")&&kt(s,u),C&64&&p!==(p=Math.round(x[6].population/(x[6].area/1e6)).toLocaleString()+"")&&kt(g,p)},d(x){x&&H(e)}}}function vL(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[yL,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function bL(r){let e,t,n,i,o,u,s,d;const p=[_n("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":fo(["get","imd_percentile"],fp,cp),"fill-opacity":er(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[mL]},$$scope:{ctx:r}};for(let E=0;E<p.length;E+=1)g=zt(g,p[E]);e=new Ji({props:g});const _=[_n("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":fo(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],pp,mp),"fill-opacity":er(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={$$slots:{default:[_L]},$$scope:{ctx:r}};for(let E=0;E<_.length;E+=1)x=zt(x,_[E]);n=new Ji({props:x});const C=[_n("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":fo(["/",["get","population"],["/",["get","area"],1e6]],dp,hp),"fill-opacity":er(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let T={$$slots:{default:[vL]},$$scope:{ctx:r}};for(let E=0;E<C.length;E+=1)T=zt(T,C[E]);o=new Ji({props:T});const P=[_n("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let I={};for(let E=0;E<P.length;E+=1)I=zt(I,P[E]);return s=new ur({props:I}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(E,L){ae(e,E,L),G(E,t,L),ae(n,E,L),G(E,i,L),ae(o,E,L),G(E,u,L),ae(s,E,L),d=!0},p(E,L){const O=L&1?In(p,[p[0],p[1],p[2],p[3],{layout:{visibility:E[0]?"visible":"none"}}]):{};L&128&&(O.$$scope={dirty:L,ctx:E}),e.$set(O);const F=L&4?In(_,[_[0],_[1],_[2],_[3],{layout:{visibility:E[2]?"visible":"none"}}]):{};L&128&&(F.$$scope={dirty:L,ctx:E}),n.$set(F);const Z=L&2?In(C,[C[0],C[1],C[2],C[3],{layout:{visibility:E[1]?"visible":"none"}}]):{};L&128&&(Z.$$scope={dirty:L,ctx:E}),o.$set(Z);const K=L&7?In(P,[P[0],P[1],P[2],{layout:{visibility:E[0]||E[1]||E[2]?"visible":"none"}}]):{};s.$set(K)},i(E){d||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),d=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),d=!1},d(E){E&&(H(t),H(i),H(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function wL(r){let e,t,n,i,o,u,s,d,p,g,_;function x(L){r[3](L)}let C={label:"SIMD",$$slots:{help:[uL],legend:[lL]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new os({props:C}),dn.push(()=>Dn(e,"show",x));function T(L){r[4](L)}let P={label:"Population density",$$slots:{help:[fL],legend:[cL]},$$scope:{ctx:r}};r[1]!==void 0&&(P.show=r[1]),i=new os({props:P}),dn.push(()=>Dn(i,"show",T));function I(L){r[5](L)}let E={label:"Car ownership",$$slots:{help:[dL],legend:[hL]},$$scope:{ctx:r}};return r[2]!==void 0&&(E.show=r[2]),s=new os({props:E}),dn.push(()=>Dn(s,"show",I)),g=new nh({props:{url:`pmtiles://${$o("cnt_layers/population.pmtiles")}`,$$slots:{default:[bL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment),u=oe(),ue(s.$$.fragment),p=oe(),ue(g.$$.fragment)},m(L,O){ae(e,L,O),G(L,n,O),ae(i,L,O),G(L,u,O),ae(s,L,O),G(L,p,O),ae(g,L,O),_=!0},p(L,[O]){const F={};O&128&&(F.$$scope={dirty:O,ctx:L}),!t&&O&1&&(t=!0,F.show=L[0],zn(()=>t=!1)),e.$set(F);const Z={};O&128&&(Z.$$scope={dirty:O,ctx:L}),!o&&O&2&&(o=!0,Z.show=L[1],zn(()=>o=!1)),i.$set(Z);const K={};O&128&&(K.$$scope={dirty:O,ctx:L}),!d&&O&4&&(d=!0,K.show=L[2],zn(()=>d=!1)),s.$set(K);const q={};O&135&&(q.$$scope={dirty:O,ctx:L}),g.$set(q)},i(L){_||(N(e.$$.fragment,L),N(i.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),_=!0)},o(L){V(e.$$.fragment,L),V(i.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),_=!1},d(L){L&&(H(n),H(u),H(p)),le(e,L),le(i,L),le(s,L),le(g,L)}}}const xL=r=>`${r}%`;function AL(r,e,t){let n=!1,i=!1,o=!1;function u(p){n=p,t(0,n)}function s(p){i=p,t(1,i)}function d(p){o=p,t(2,o)}return[n,i,o,u,s,d]}class kL extends Et{constructor(e){super(),Mt(this,e,AL,wL,St,{})}}function SL(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${rw}" alt="National Rail logo"/>
    Station`,de(e,"slot","legend"),Ye(e,"display","flex"),Ye(e,"gap","8px"),Ye(e,"align-items","center")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function CL(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function TL(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=Me(t)},m(i,o){G(i,e,o),B(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&kt(n,t)},d(i){i&&H(e)}}}function ML(r){let e,t;return e=new pi({props:{$$slots:{default:[TL,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function EL(r){let e,t;const n=[_n("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[ML]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new nc({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?In(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function LL(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Railway stations",$$slots:{help:[CL],legend:[SL]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new _r({props:{data:$o("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[EL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),G(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&9&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}function IL(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class PL extends Et{constructor(e){super(),Mt(this,e,IL,LL,St,{})}}function sv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function av(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function lv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function uv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function cv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function fv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function zL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function hv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){G(i,e,o),B(e,n)},p:at,d(i){i&&H(e)}}}function dv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){G(i,e,o),B(e,n)},p:at,d(i){i&&H(e)}}}function pv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){G(i,e,o),B(e,n)},p:at,d(i){i&&H(e)}}}function mv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Me(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){G(i,e,o),B(e,n)},p:at,d(i){i&&H(e)}}}function DL(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O=On(r[7]),F=[];for(let ee=0;ee<O.length;ee+=1)F[ee]=hv(fv(r,O,ee));let Z=On(r[8]),K=[];for(let ee=0;ee<Z.length;ee+=1)K[ee]=dv(cv(r,Z,ee));let q=On(r[9]),J=[];for(let ee=0;ee<q.length;ee+=1)J[ee]=pv(uv(r,q,ee));let fe=On(r[10]),Ee=[];for(let ee=0;ee<fe.length;ee+=1)Ee[ee]=mv(lv(r,fe,ee));return{c(){e=U("div"),t=U("label"),n=Me(`Trip purpose:
      `),i=U("select");for(let ee=0;ee<F.length;ee+=1)F[ee].c();o=oe(),u=U("label"),s=Me(`Scenario:
      `),d=U("select");for(let ee=0;ee<K.length;ee+=1)K[ee].c();p=oe(),g=U("label"),_=Me(`Network type:
      `),x=U("select");for(let ee=0;ee<J.length;ee+=1)J[ee].c();C=oe(),T=U("label"),P=Me(`Color by:
      `),I=U("select");for(let ee=0;ee<Ee.length;ee+=1)Ee[ee].c();r[0]===void 0&&ys(()=>r[11].call(i)),r[1]===void 0&&ys(()=>r[12].call(d)),r[2]===void 0&&ys(()=>r[13].call(x)),r[3]===void 0&&ys(()=>r[14].call(I)),de(e,"slot","legend")},m(ee,ie){G(ee,e,ie),B(e,t),B(t,n),B(t,i);for(let ve=0;ve<F.length;ve+=1)F[ve]&&F[ve].m(i,null);Xi(i,r[0],!0),B(e,o),B(e,u),B(u,s),B(u,d);for(let ve=0;ve<K.length;ve+=1)K[ve]&&K[ve].m(d,null);Xi(d,r[1],!0),B(e,p),B(e,g),B(g,_),B(g,x);for(let ve=0;ve<J.length;ve+=1)J[ve]&&J[ve].m(x,null);Xi(x,r[2],!0),B(e,C),B(e,T),B(T,P),B(T,I);for(let ve=0;ve<Ee.length;ve+=1)Ee[ve]&&Ee[ve].m(I,null);Xi(I,r[3],!0),E||(L=[Lt(i,"change",r[11]),Lt(d,"change",r[12]),Lt(x,"change",r[13]),Lt(I,"change",r[14])],E=!0)},p(ee,ie){if(ie[0]&128){O=On(ee[7]);let ve;for(ve=0;ve<O.length;ve+=1){const ye=fv(ee,O,ve);F[ve]?F[ve].p(ye,ie):(F[ve]=hv(ye),F[ve].c(),F[ve].m(i,null))}for(;ve<F.length;ve+=1)F[ve].d(1);F.length=O.length}if(ie[0]&129&&Xi(i,ee[0]),ie[0]&256){Z=On(ee[8]);let ve;for(ve=0;ve<Z.length;ve+=1){const ye=cv(ee,Z,ve);K[ve]?K[ve].p(ye,ie):(K[ve]=dv(ye),K[ve].c(),K[ve].m(d,null))}for(;ve<K.length;ve+=1)K[ve].d(1);K.length=Z.length}if(ie[0]&258&&Xi(d,ee[1]),ie[0]&512){q=On(ee[9]);let ve;for(ve=0;ve<q.length;ve+=1){const ye=uv(ee,q,ve);J[ve]?J[ve].p(ye,ie):(J[ve]=pv(ye),J[ve].c(),J[ve].m(x,null))}for(;ve<J.length;ve+=1)J[ve].d(1);J.length=q.length}if(ie[0]&516&&Xi(x,ee[2]),ie[0]&1024){fe=On(ee[10]);let ve;for(ve=0;ve<fe.length;ve+=1){const ye=lv(ee,fe,ve);Ee[ve]?Ee[ve].p(ye,ie):(Ee[ve]=mv(ye),Ee[ve].c(),Ee[ve].m(I,null))}for(;ve<Ee.length;ve+=1)Ee[ve].d(1);Ee.length=fe.length}ie[0]&1032&&Xi(I,ee[3])},d(ee){ee&&H(e),_i(F,ee),_i(K,ee),_i(J,ee),_i(Ee,ee),E=!1,cr(L)}}}function gv(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",T,P;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),u=Me(o),s=oe(),d=U("td"),g=Me(p),_=oe(),x=U("td"),T=Me(C),P=oe()},m(I,E){G(I,e,E),B(e,t),B(e,n),B(e,i),B(i,u),B(e,s),B(e,d),B(d,g),B(e,_),B(e,x),B(x,T),B(e,P)},p(I,E){E[0]&131072&&o!==(o=I[17][`${I[18]}_fastest_bicycle`].toLocaleString()+"")&&kt(u,o),E[0]&131072&&p!==(p=I[17][`${I[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&kt(g,p),E[0]&131072&&C!==(C=I[17][`${I[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&kt(T,C)},d(I){I&&H(e)}}}function _v(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",T,P;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),u=Me(o),s=oe(),d=U("td"),g=Me(p),_=oe(),x=U("td"),T=Me(C),P=oe()},m(I,E){G(I,e,E),B(e,t),B(e,n),B(e,i),B(i,u),B(e,s),B(e,d),B(d,g),B(e,_),B(e,x),B(x,T),B(e,P)},p(I,E){E[0]&131072&&o!==(o=I[17][`${I[18]}_quietest_bicycle`].toLocaleString()+"")&&kt(u,o),E[0]&131072&&p!==(p=I[17][`${I[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&kt(g,p),E[0]&131072&&C!==(C=I[17][`${I[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&kt(T,C)},d(I){I&&H(e)}}}function RL(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,s,d,p=r[17].gradient+"",g,_,x,C,T,P=r[17].quietness+"",I,E,L,O,F,Z,K,q,J,fe,Ee,ee,ie,ve,ye,it,Be,Ne=On(r[7]),Ie=[];for(let ut=0;ut<Ne.length;ut+=1)Ie[ut]=gv(av(r,Ne,ut));let ot=On(r[7]),Ke=[];for(let ut=0;ut<ot.length;ut+=1)Ke[ut]=_v(sv(r,ot,ut));return{c(){e=U("div"),t=U("p"),n=Me("Cyclists: "),o=Me(i),u=oe(),s=U("p"),d=Me("Gradient: "),g=Me(p),_=Me("%"),x=oe(),C=U("p"),T=Me("Cycle-friendliness: "),I=Me(P),E=Me("%"),L=oe(),O=U("details"),F=U("summary"),F.textContent="All network details",Z=oe(),K=U("p"),K.textContent="Fast/Direct network",q=oe(),J=U("table"),fe=U("tr"),fe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ee=oe();for(let ut=0;ut<Ie.length;ut+=1)Ie[ut].c();ee=oe(),ie=U("p"),ie.textContent="Quiet/Indirect network",ve=oe(),ye=U("table"),it=U("tr"),it.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Be=oe();for(let ut=0;ut<Ke.length;ut+=1)Ke[ut].c();Ye(e,"max-width","30vw"),Ye(e,"max-height","60vh"),Ye(e,"overflow","auto")},m(ut,pt){G(ut,e,pt),B(e,t),B(t,n),B(t,o),B(e,u),B(e,s),B(s,d),B(s,g),B(s,_),B(e,x),B(e,C),B(C,T),B(C,I),B(C,E),B(e,L),B(e,O),B(O,F),B(O,Z),B(O,K),B(O,q),B(O,J),B(J,fe),B(J,Ee);for(let _t=0;_t<Ie.length;_t+=1)Ie[_t]&&Ie[_t].m(J,null);B(O,ee),B(O,ie),B(O,ve),B(O,ye),B(ye,it),B(ye,Be);for(let _t=0;_t<Ke.length;_t+=1)Ke[_t]&&Ke[_t].m(ye,null)},p(ut,pt){if(pt[0]&131088&&i!==(i=ut[17][ut[4]].toLocaleString()+"")&&kt(o,i),pt[0]&131072&&p!==(p=ut[17].gradient+"")&&kt(g,p),pt[0]&131072&&P!==(P=ut[17].quietness+"")&&kt(I,P),pt[0]&131200){Ne=On(ut[7]);let _t;for(_t=0;_t<Ne.length;_t+=1){const He=av(ut,Ne,_t);Ie[_t]?Ie[_t].p(He,pt):(Ie[_t]=gv(He),Ie[_t].c(),Ie[_t].m(J,null))}for(;_t<Ie.length;_t+=1)Ie[_t].d(1);Ie.length=Ne.length}if(pt[0]&131200){ot=On(ut[7]);let _t;for(_t=0;_t<ot.length;_t+=1){const He=sv(ut,ot,_t);Ke[_t]?Ke[_t].p(He,pt):(Ke[_t]=_v(He),Ke[_t].c(),Ke[_t].m(ye,null))}for(;_t<Ke.length;_t+=1)Ke[_t].d(1);Ke.length=ot.length}},d(ut){ut&&H(e),_i(Ie,ut),_i(Ke,ut)}}}function BL(r){let e,t;return e=new pi({props:{openOn:"click",$$slots:{default:[RL,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function FL(r){let e,t;const n=[_n("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":yv(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[BL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u[0]&112?In(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":yv(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function OL(r){let e,t,n,i,o;function u(d){r[15](d)}let s={label:"Route network",$$slots:{legend:[DL],help:[zL]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new nh({props:{url:`pmtiles://${$o("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[FL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),G(d,n,p),ae(i,d,p),o=!0},p(d,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,g.show=d[5],zn(()=>t=!1)),e.$set(g);const _={};p[0]&112|p[1]&2&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}function yv(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function $L(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function NL(r,e,t){let n,i,o=!1,u="all",s="bicycle_go_dutch",d="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],_=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],x=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],C=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],T={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function P(){u=Ba(this),t(0,u),t(7,g)}function I(){s=Ba(this),t(1,s),t(8,_)}function E(){d=Ba(this),t(2,d),t(9,x)}function L(){p=Ba(this),t(3,p),t(10,C)}function O(F){o=F,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${s}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:$L(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:fo(["abs",["get","gradient"]],T.limits,T.colorScale)}[p])},[u,s,d,p,n,o,i,g,_,x,C,P,I,E,L,O]}class jL extends Et{constructor(e){super(),Mt(this,e,NL,OL,St,{},null,[-1,-1])}}function UL(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data © Crown copyright and database right 2025.</p>`,de(e,"slot","help")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function VL(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K,q;return F=new o_({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=Me(`
        Pedestrians`),u=oe(),s=U("label"),d=U("input"),p=Me(`
        Cyclists`),g=oe(),_=U("fieldset"),x=U("label"),C=Me(`From
        `),T=U("input"),P=oe(),I=U("label"),E=Me(`To
        `),L=U("input"),O=oe(),ue(F.$$.fragment),de(i,"type","checkbox"),de(i,"class","svelte-rvrx5w"),de(d,"type","checkbox"),de(d,"class","svelte-rvrx5w"),Ye(t,"display","flex"),Ye(t,"gap","3em"),de(t,"class","svelte-rvrx5w"),de(T,"type","number"),de(T,"min",2017),de(T,"max",2023),de(T,"class","svelte-rvrx5w"),de(L,"type","number"),de(L,"min",2017),de(L,"max",2023),de(L,"class","svelte-rvrx5w"),de(_,"class","year-filter svelte-rvrx5w"),de(e,"slot","legend")},m(J,fe){G(J,e,fe),B(e,t),B(t,n),B(n,i),i.checked=r[1].pedestrians,B(n,o),B(t,u),B(t,s),B(s,d),d.checked=r[1].cyclists,B(s,p),B(e,g),B(e,_),B(_,x),B(x,C),B(x,T),Zn(T,r[1].minYear),B(_,P),B(_,I),B(I,E),B(I,L),Zn(L,r[1].maxYear),B(e,O),ae(F,e,null),Z=!0,K||(q=[Lt(i,"change",r[7]),Lt(d,"change",r[8]),Lt(T,"input",r[9]),Lt(L,"input",r[10])],K=!0)},p(J,fe){fe&2&&(i.checked=J[1].pedestrians),fe&2&&(d.checked=J[1].cyclists),fe&2&&zl(T.value)!==J[1].minYear&&Zn(T,J[1].minYear),fe&2&&zl(L.value)!==J[1].maxYear&&Zn(L,J[1].maxYear)},i(J){Z||(N(F.$$.fragment,J),Z=!0)},o(J){V(F.$$.fragment,J),Z=!1},d(J){J&&H(e),le(F),K=!1,cr(q)}}}function vv(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=Me("Pedestrian location: "),n=U("b"),o=Me(i)},m(u,s){G(u,e,s),B(e,t),B(e,n),B(n,o)},p(u,s){s&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&kt(o,i)},d(u){u&&H(e)}}}function bv(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=Me("Pedestrian movement: "),n=U("b"),o=Me(i)},m(u,s){G(u,e,s),B(e,t),B(e,n),B(n,o)},p(u,s){s&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&kt(o,i)},d(u){u&&H(e)}}}function qL(r){let e,t,n,i=r[12].year+"",o,u,s,d,p,g=r[5][r[12].severity]+"",_,x,C,T,P,I=wv(r[12])+"",E,L,O,F,Z,K=r[12].pedestrian_location&&vv(r),q=r[12].pedestrian_movement&&bv(r);return{c(){e=U("p"),t=Me("Year: "),n=U("b"),o=Me(i),u=oe(),s=U("p"),d=Me("Severity: "),p=U("b"),_=Me(g),x=oe(),C=U("p"),T=Me("Casualties: "),P=U("b"),E=Me(I),L=oe(),K&&K.c(),O=oe(),q&&q.c(),F=oe(),Z=U("p"),Z.textContent="Click to open full report in CycleStreets"},m(J,fe){G(J,e,fe),B(e,t),B(e,n),B(n,o),G(J,u,fe),G(J,s,fe),B(s,d),B(s,p),B(p,_),G(J,x,fe),G(J,C,fe),B(C,T),B(C,P),B(P,E),G(J,L,fe),K&&K.m(J,fe),G(J,O,fe),q&&q.m(J,fe),G(J,F,fe),G(J,Z,fe)},p(J,fe){fe&4096&&i!==(i=J[12].year+"")&&kt(o,i),fe&4096&&g!==(g=J[5][J[12].severity]+"")&&kt(_,g),fe&4096&&I!==(I=wv(J[12])+"")&&kt(E,I),J[12].pedestrian_location?K?K.p(J,fe):(K=vv(J),K.c(),K.m(O.parentNode,O)):K&&(K.d(1),K=null),J[12].pedestrian_movement?q?q.p(J,fe):(q=bv(J),q.c(),q.m(F.parentNode,F)):q&&(q.d(1),q=null)},d(J){J&&(H(e),H(u),H(s),H(x),H(C),H(L),H(O),H(F),H(Z)),K&&K.d(J),q&&q.d(J)}}}function HL(r){let e,t;return e=new pi({props:{$$slots:{default:[qL,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function GL(r){let e,t;const n=[_n("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":fo(["get","severity"],[1,2,3],[vg,bg,wg]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[HL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ol({props:i}),e.$on("click",ZL),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&7?In(n,[n[0],n[1],u&0&&{paint:{"circle-color":fo(["get","severity"],[1,2,3],[vg,bg,wg]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},u&6&&{filter:o[2](o[1])},u&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};u&8192&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function WL(r){let e,t,n,i,o;function u(d){r[11](d)}let s={label:"Collisions",$$slots:{legend:[VL],help:[UL]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new nh({props:{url:`pmtiles://${$o("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[GL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),G(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&8195&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}let vg="#080C54",bg="#1F9EB7",wg="#CDE594";function wv(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function ZL(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function XL(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(P){let I=["any"];return i.pedestrians&&I.push(["get","pedestrian"]),i.cyclists&&I.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],I]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:wg,Serious:bg,Fatal:vg};function g(){i.pedestrians=this.checked,t(1,i)}function _(){i.cyclists=this.checked,t(1,i)}function x(){i.minYear=zl(this.value),t(1,i)}function C(){i.maxYear=zl(this.value),t(1,i)}function T(P){n=P,t(0,n)}return[n,i,o,u,s,d,p,g,_,x,C,T]}class KL extends Et{constructor(e){super(),Mt(this,e,XL,WL,St,{})}}function xv(r){let e;return{c(){e=Me("Layers")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function Av(r){let e,t,n,i,o;function u(p){r[6](p)}let s={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(s.show=r[2]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u));let d=r[3]=="cnt"&&kv();return{c(){ue(e.$$.fragment),n=oe(),d&&d.c(),i=nr()},m(p,g){ae(e,p,g),G(p,n,g),d&&d.m(p,g),G(p,i,g),o=!0},p(p,g){const _={};!t&&g&4&&(t=!0,_.show=p[2],zn(()=>t=!1)),e.$set(_),p[3]=="cnt"?d?g&8&&N(d,1):(d=kv(),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Kt(),V(d,1,1,()=>{d=null}),Jt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(H(n),H(i)),le(e,p),d&&d.d(p)}}}function kv(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T;return e=new aL({}),n=new kL({}),o=new PL({}),s=new JT({}),p=new Q6({}),_=new jL({}),C=new KL({}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),d=oe(),ue(p.$$.fragment),g=oe(),ue(_.$$.fragment),x=oe(),ue(C.$$.fragment)},m(P,I){ae(e,P,I),G(P,t,I),ae(n,P,I),G(P,i,I),ae(o,P,I),G(P,u,I),ae(s,P,I),G(P,d,I),ae(p,P,I),G(P,g,I),ae(_,P,I),G(P,x,I),ae(C,P,I),T=!0},i(P){T||(N(e.$$.fragment,P),N(n.$$.fragment,P),N(o.$$.fragment,P),N(s.$$.fragment,P),N(p.$$.fragment,P),N(_.$$.fragment,P),N(C.$$.fragment,P),T=!0)},o(P){V(e.$$.fragment,P),V(n.$$.fragment,P),V(o.$$.fragment,P),V(s.$$.fragment,P),V(p.$$.fragment,P),V(_.$$.fragment,P),V(C.$$.fragment,P),T=!1},d(P){P&&(H(t),H(i),H(u),H(d),H(g),H(x)),le(e,P),le(n,P),le(o,P),le(s,P),le(p,P),le(_,P),le(C,P)}}}function JL(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F;i=new f4({props:{color:"#333"}});let Z=r[0]&&xv(),K=r[1]&&Av(r);return{c(){e=U("div"),t=U("button"),n=U("div"),ue(i.$$.fragment),o=oe(),Z&&Z.c(),s=oe(),d=U("div"),K&&K.c(),p=oe(),g=U("div"),_=U("span"),_.textContent="Basemap",x=oe(),C=U("select"),T=U("option"),T.textContent="MapTiler Dataviz",P=U("option"),P.textContent="MapTiler Streets",I=U("option"),I.textContent="MapTiler Satellite",E=U("option"),E.textContent="OS Open Zoomstack",Ye(n,"display","flex"),Ye(n,"gap","12px"),Ye(n,"color","#333"),Ye(n,"align-items","center"),Ye(n,"justify-content","center"),de(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1nl5dst"),de(t,"aria-label","Layers"),Ye(_,"font-size","20px"),Ye(_,"margin-left","8px"),Ye(_,"margin-top","4px"),T.__value="dataviz",Zn(T,T.__value),P.__value="streets-v2",Zn(P,P.__value),I.__value="hybrid",Zn(I,I.__value),E.__value="uk-openzoomstack-light",Zn(E,E.__value),Ye(C,"width","auto"),Ye(C,"font-size","20px"),Ye(C,"margin","8px"),Ye(C,"padding","8px"),Ye(C,"text-overflow","ellipsis"),r[4]===void 0&&ys(()=>r[7].call(C)),de(g,"class","context-control"),de(d,"class","contextual-layer-controls svelte-1nl5dst"),Ye(d,"flex-direction","column"),Ye(d,"display",r[0]?"flex":"none"),de(e,"class","pico contextual-layers svelte-1nl5dst"),Ye(e,"display","flex"),Ye(e,"flex-direction","column"),Ye(e,"border-radius","5px"),Ye(e,"width",r[0]?"300px":"auto")},m(q,J){G(q,e,J),B(e,t),B(t,n),ae(i,n,null),B(n,o),Z&&Z.m(n,null),B(e,s),B(e,d),K&&K.m(d,null),B(d,p),B(d,g),B(g,_),B(g,x),B(g,C),B(C,T),B(C,P),B(C,I),B(C,E),Xi(C,r[4],!0),L=!0,O||(F=[Lt(t,"click",r[5]),Lt(C,"change",r[7])],O=!0)},p(q,J){q[0]?Z||(Z=xv(),Z.c(),Z.m(n,null)):Z&&(Z.d(1),Z=null),(!L||J&1&&u!==(u="show-layers-button icon-btn "+(q[0]?"expanded":"")+" svelte-1nl5dst"))&&de(t,"class",u),q[1]?K?(K.p(q,J),J&2&&N(K,1)):(K=Av(q),K.c(),N(K,1),K.m(d,p)):K&&(Kt(),V(K,1,1,()=>{K=null}),Jt()),J&16&&Xi(C,q[4]),J&1&&Ye(d,"display",q[0]?"flex":"none"),J&1&&Ye(e,"width",q[0]?"300px":"auto")},i(q){L||(N(i.$$.fragment,q),N(K),L=!0)},o(q){V(i.$$.fragment,q),V(K),L=!1},d(q){q&&H(e),le(i),Z&&Z.d(),K&&K.d(),O=!1,cr(F)}}}function YL(r){let e,t;return e=new tg({props:{defaultStyling:!0,$$slots:{default:[JL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function QL(r,e,t){let n,i,o,u;ct(r,Ir,_=>t(1,n=_)),ct(r,Wd,_=>t(2,i=_)),ct(r,As,_=>t(3,o=_)),ct(r,Zm,_=>t(4,u=_));let s=!1;const d=()=>t(0,s=!s);function p(_){i=_,Wd.set(i)}function g(){u=Ba(this),Zm.set(u)}return[s,n,i,o,u,d,p,g]}class eI extends Et{constructor(e){super(),Mt(this,e,QL,YL,St,{})}}let Ze;const sa=new Array(128).fill(void 0);sa.push(void 0,null,!0,!1);function En(r){return sa[r]}let wi=0,kf=null;function Qu(){return(kf===null||kf.byteLength===0)&&(kf=new Uint8Array(Ze.memory.buffer)),kf}const Nd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},tI=typeof Nd.encodeInto=="function"?function(r,e){return Nd.encodeInto(r,e)}:function(r,e){const t=Nd.encode(r);return e.set(t),{read:r.length,written:t.length}};function Bo(r,e,t){if(t===void 0){const s=Nd.encode(r),d=e(s.length,1)>>>0;return Qu().subarray(d,d+s.length).set(s),wi=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Qu();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Qu().subarray(i+u,i+n),d=tI(r,s);u+=d.written}return wi=u,i}function Zu(r){return r==null}let Sf=null;function gt(){return(Sf===null||Sf.byteLength===0)&&(Sf=new Int32Array(Ze.memory.buffer)),Sf}let Nf=sa.length;function nI(r){r<132||(sa[r]=Nf,Nf=r)}function Xn(r){const e=En(r);return nI(r),e}const j2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&j2.decode();function Fr(r,e){return r=r>>>0,j2.decode(Qu().subarray(r,r+e))}function ir(r){Nf===sa.length&&sa.push(sa.length+1);const e=Nf;return Nf=sa[e],sa[e]=r,e}let Cf=null;function U2(){return(Cf===null||Cf.byteLength===0)&&(Cf=new Float64Array(Ze.memory.buffer)),Cf}let Tf=null;function rI(){return(Tf===null||Tf.byteLength===0)&&(Tf=new BigInt64Array(Ze.memory.buffer)),Tf}function xg(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=xg(r[0]));for(let u=1;u<i;u++)o+=", "+xg(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function jm(r,e){const t=e(r.length*1,1)>>>0;return Qu().set(r,t/1),wi=r.length,t}function iI(r,e){return r=r>>>0,U2().subarray(r/8,r/8+e)}function oI(r,e){return r=r>>>0,Qu().subarray(r/1,r/1+e)}function Tl(r,e){try{return r.apply(this,e)}catch(t){Ze.__wbindgen_exn_store(ir(t))}}class sI{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ze.__wbg_ltn_free(e)}constructor(e,t,n,i,o,u,s,d){try{const T=Ze.__wbindgen_add_to_stack_pointer(-16),P=jm(e,Ze.__wbindgen_malloc),I=wi,E=jm(t,Ze.__wbindgen_malloc),L=wi,O=jm(n,Ze.__wbindgen_malloc),F=wi,Z=Bo(o,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),K=wi;var p=Zu(u)?0:Bo(u,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),g=wi;const q=Bo(s,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),J=wi;Ze.ltn_new(T,P,I,E,L,O,F,ir(i),Z,K,p,g,q,J,d);var _=gt()[T/4+0],x=gt()[T/4+1],C=gt()[T/4+2];if(C)throw Xn(x);return this.__wbg_ptr=_>>>0,this}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getBounds(){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getBounds(i,this.__wbg_ptr);var e=gt()[i/4+0],t=gt()[i/4+1],n=iI(e,t).slice();return Ze.__wbindgen_free(e,t*8,8),n}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=gt()[i/4+0],t=gt()[i/4+1],n=oI(e,t).slice();return Ze.__wbindgen_free(e,t*1,1),n}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_renderModalFilters(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_generateMergedBoundary(g,this.__wbg_ptr,ir(e));var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Xn(u);return t=d,n=p,Fr(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}extractWaypointsFromRing(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_extractWaypointsFromRing(g,this.__wbg_ptr,ir(e));var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Xn(u);return t=d,n=p,Fr(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}setCurrentNeighbourhoodBoundary(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16),u=Bo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),s=wi;Ze.ltn_setCurrentNeighbourhoodBoundary(o,this.__wbg_ptr,u,s,ir(t));var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Xn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Bo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),n=wi;Ze.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Bo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),i=wi,o=Bo(t,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),u=wi;Ze.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16),o=Bo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),u=wi;Ze.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,u);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Xn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16),u=Bo(t,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),s=wi;Ze.ltn_addModalFilter(o,this.__wbg_ptr,ir(e),u,s);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Xn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16),u=Bo(t,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),s=wi;Ze.ltn_addManyModalFilters(o,this.__wbg_ptr,ir(e),u,s);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Xn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){Ze.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Xn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Xn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Xn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Xn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const u=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_deleteTurnRestriction(u,this.__wbg_ptr,e,t,n);var i=gt()[u/4+0],o=gt()[u/4+1];if(o)throw Xn(i)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getTurnRestrictionTargets(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Xn(u);return t=d,n=p,Fr(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){Ze.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Xn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}reclassifyRoadsAlongLine(e,t,n){try{const u=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_reclassifyRoadsAlongLine(u,this.__wbg_ptr,ir(e),t,n);var i=gt()[u/4+0],o=gt()[u/4+1];if(o)throw Xn(i)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}undo(){try{const n=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_undo(n,this.__wbg_ptr);var e=gt()[n/4+0],t=gt()[n/4+1];if(t)throw Xn(e)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}redo(){try{const n=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_redo(n,this.__wbg_ptr);var e=gt()[n/4+0],t=gt()[n/4+1];if(t)throw Xn(e)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}getShortcutsCrossingRoad(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getShortcutsCrossingRoad(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Xn(u);return t=d,n=p,Fr(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toSavefile(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_loadSavefile(i,this.__wbg_ptr,ir(e));var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Xn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let u,s;try{const T=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_compareRoute(T,this.__wbg_ptr,e,t,n,i,o);var d=gt()[T/4+0],p=gt()[T/4+1],g=gt()[T/4+2],_=gt()[T/4+3],x=d,C=p;if(_)throw x=0,C=0,Xn(g);return u=x,s=C,Fr(x,C)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(u,s,1)}}impactToOneDestination(e,t){let n,i;try{const _=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_impactToOneDestination(_,this.__wbg_ptr,e,t);var o=gt()[_/4+0],u=gt()[_/4+1],s=gt()[_/4+2],d=gt()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Xn(s);return n=p,i=g,Fr(p,g)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_predictImpact(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Xn(u);return t=d,n=p,Fr(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const _=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getImpactsOnRoad(_,this.__wbg_ptr,e,t);var o=gt()[_/4+0],u=gt()[_/4+1],s=gt()[_/4+2],d=gt()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Xn(s);return n=p,i=g,Fr(p,g)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getAllIntersections(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getMovements(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Xn(u);return t=d,n=p,Fr(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getDemandModel(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getPOIs(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Xn(o);return e=s,t=d,Fr(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}}async function aI(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function lI(){const r={};return r.wbg={},r.wbg.__wbindgen_string_get=function(e,t){const n=En(t),i=typeof n=="string"?n:void 0;var o=Zu(i)?0:Bo(i,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),u=wi;gt()[e/4+1]=u,gt()[e/4+0]=o},r.wbg.__wbindgen_object_drop_ref=function(e){Xn(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Fr(e,t));return ir(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=Fr(e,t);return ir(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=En(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof En(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=En(t),i=typeof n=="number"?n:void 0;U2()[e/8+1]=Zu(i)?0:i,gt()[e/4+0]=!Zu(i)},r.wbg.__wbindgen_is_object=function(e){const t=En(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return En(e)in En(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return ir(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return En(e)===En(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ir(t)},r.wbg.__wbindgen_is_undefined=function(e){return En(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return En(e)==En(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=En(e);return ir(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=En(e)[En(t)];return ir(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(En(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(En(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(En(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(En(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(En(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ir(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=En(t).stack,i=Bo(n,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),o=wi;gt()[e/4+1]=o,gt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Fr(e,t))}finally{Ze.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=En(e).performance;return ir(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return En(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=En(e)[t>>>0];return ir(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return En(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof En(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Fr(e,t));return ir(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=En(e).next;return ir(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Tl(function(e){const t=En(e).next();return ir(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return En(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=En(e).value;return ir(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ir(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Tl(function(e,t){const n=Reflect.get(En(e),En(t));return ir(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Tl(function(e,t){const n=En(e).call(En(t));return ir(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Tl(function(){const e=self.self;return ir(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Tl(function(){const e=window.window;return ir(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Tl(function(){const e=globalThis.globalThis;return ir(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Tl(function(){const e=global.global;return ir(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(En(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=En(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(En(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(En(e));return ir(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=En(e).buffer;return ir(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(En(e));return ir(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){En(e).set(En(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return En(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=En(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=En(t),i=typeof n=="bigint"?n:void 0;rI()[e/8+1]=Zu(i)?BigInt(0):i,gt()[e/4+0]=!Zu(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=xg(En(t)),i=Bo(n,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),o=wi;gt()[e/4+1]=o,gt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Fr(e,t))},r.wbg.__wbindgen_memory=function(){const e=Ze.memory;return ir(e)},r}function uI(r,e){return Ze=r.exports,V2.__wbindgen_wasm_module=e,Tf=null,Cf=null,Sf=null,kf=null,Ze}async function V2(r){if(Ze!==void 0)return Ze;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=lI();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await aI(await r,e);return uI(t,n)}const cI=r=>({}),Sv=r=>({}),fI=r=>({}),Cv=r=>({}),hI=r=>({}),Tv=r=>({});function dI(r){let e,t,n,i,o,u,s,d;const p=r[1].top,g=vn(p,r,r[0],Tv),_=r[1].left,x=vn(_,r,r[0],Cv),C=r[1].main,T=vn(C,r,r[0],Sv);return{c(){e=U("div"),t=U("div"),g&&g.c(),n=oe(),i=U("div"),o=U("div"),x&&x.c(),u=oe(),s=U("div"),T&&T.c(),de(t,"class","top svelte-29q570"),de(o,"class","left svelte-29q570"),de(s,"class","main svelte-29q570"),de(i,"class","content svelte-29q570"),de(e,"class","flex-container svelte-29q570")},m(P,I){G(P,e,I),B(e,t),g&&g.m(t,null),B(e,n),B(e,i),B(i,o),x&&x.m(o,null),B(i,u),B(i,s),T&&T.m(s,null),d=!0},p(P,[I]){g&&g.p&&(!d||I&1)&&wn(g,p,P,P[0],d?bn(p,P[0],I,hI):xn(P[0]),Tv),x&&x.p&&(!d||I&1)&&wn(x,_,P,P[0],d?bn(_,P[0],I,fI):xn(P[0]),Cv),T&&T.p&&(!d||I&1)&&wn(T,C,P,P[0],d?bn(C,P[0],I,cI):xn(P[0]),Sv)},i(P){d||(N(g,P),N(x,P),N(T,P),d=!0)},o(P){V(g,P),V(x,P),V(T,P),d=!1},d(P){P&&H(e),g&&g.d(P),x&&x.d(P),T&&T.d(P)}}}function pI(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class mI extends Et{constructor(e){super(),Mt(this,e,pI,dI,St,{})}}const gI=r=>({}),Mv=r=>({}),_I=r=>({}),Ev=r=>({}),yI=r=>({}),Lv=r=>({});function vI(r){let e,t,n,i,o,u;const s=r[4].top,d=vn(s,r,r[3],Lv),p=r[4].sidebar,g=vn(p,r,r[3],Ev),_=r[4].map,x=vn(_,r,r[3],Mv);return{c(){e=U("div"),d&&d.c(),t=oe(),n=U("div"),g&&g.c(),i=oe(),o=U("div"),x&&x.c()},m(C,T){G(C,e,T),d&&d.m(e,null),r[5](e),G(C,t,T),G(C,n,T),g&&g.m(n,null),r[6](n),G(C,i,T),G(C,o,T),x&&x.m(o,null),r[7](o),u=!0},p(C,[T]){d&&d.p&&(!u||T&8)&&wn(d,s,C,C[3],u?bn(s,C[3],T,yI):xn(C[3]),Lv),g&&g.p&&(!u||T&8)&&wn(g,p,C,C[3],u?bn(p,C[3],T,_I):xn(C[3]),Ev),x&&x.p&&(!u||T&8)&&wn(x,_,C,C[3],u?bn(_,C[3],T,gI):xn(C[3]),Mv)},i(C){u||(N(d,C),N(g,C),N(x,C),u=!0)},o(C){V(d,C),V(g,C),V(x,C),u=!1},d(C){C&&(H(e),H(t),H(n),H(i),H(o)),d&&d.d(C),r[5](null),g&&g.d(C),r[6](null),x&&x.d(C),r[7](null)}}}function bI(r,e,t){let n,i,o;ct(r,Ag,_=>t(0,n=_)),ct(r,kg,_=>t(1,i=_)),ct(r,Sg,_=>t(2,o=_));let{$$slots:u={},$$scope:s}=e;function d(_){dn[_?"unshift":"push"](()=>{n=_,Ag.set(n)})}function p(_){dn[_?"unshift":"push"](()=>{i=_,kg.set(i)})}function g(_){dn[_?"unshift":"push"](()=>{o=_,Sg.set(o)})}return r.$$set=_=>{"$$scope"in _&&t(3,s=_.$$scope)},[n,i,o,s,u,d,p,g]}class ko extends Et{constructor(e){super(),Mt(this,e,bI,vI,St,{})}}let Ag=Ln(null),kg=Ln(null),Sg=Ln(null);const wI="/ltn/assets/streets-v2-style-b76f3b8b.json";function xI(r){let e;return{c(){e=Me("Back")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function AI(r){let e,t,n,i;return e=new sh({props:{$$slots:{default:[xI]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Lt(window,"keydown",r[2]),n=!0)},p(o,[u]){const s={};u&16&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function kI(r,e,t){let n;ct(r,tr,s=>t(1,n=s));let{mode:i}=e;function o(s){s.key=="Escape"&&(s.stopPropagation(),ln(tr,n=i,n))}const u=()=>ln(tr,n=i,n);return r.$$set=s=>{"mode"in s&&t(0,i=s.mode)},[i,n,o,u]}class Us extends Et{constructor(e){super(),Mt(this,e,kI,AI,St,{mode:0})}}let tp=Ln(null);function Iv(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function Pv(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function SI(r){let e,t=r[6].length+"",n,i;return{c(){e=Me("Undo ("),n=Me(t),i=Me(")")},m(o,u){G(o,e,u),G(o,n,u),G(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&kt(n,t)},d(o){o&&(H(e),H(n),H(i))}}}function CI(r){let e;return{c(){e=Me("Undo")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function TI(r){let e;return{c(){e=U("span"),de(e,"class","dot svelte-11yzwwb"),Wt(e,"snapped-node",r[40].snapped),Wt(e,"free-node",!r[40].snapped),Wt(e,"hide",r[4])},m(t,n){G(t,e,n)},p(t,n){n[0]&128&&Wt(e,"snapped-node",t[40].snapped),n[0]&128&&Wt(e,"free-node",!t[40].snapped),n[0]&16&&Wt(e,"hide",t[4])},d(t){t&&H(e)}}}function zv(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function s(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[TI]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new sp({props:d}),dn.push(()=>Dn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",s),{c(){ue(e.$$.fragment)},m(p,g){ae(e,p,g),n=!0},p(p,g){r=p;const _={};g[0]&144|g[1]&4096&&(_.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,_.lngLat=r[40].point,zn(()=>t=!1)),e.$set(_)},i(p){n||(N(e.$$.fragment,p),n=!0)},o(p){V(e.$$.fragment,p),n=!1},d(p){le(e,p)}}}function MI(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Ye(e,"padding-right","0"),Ye(e,"padding-left","20px"),Ye(e,"margin","0")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function EI(r){let e,t,n,i;return n=new Fw({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[MI]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=oe(),ue(n.$$.fragment),de(e,"class","dot svelte-11yzwwb"),Wt(e,"snapped",r[37].snapped)},m(o,u){G(o,e,u),G(o,t,u),ae(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Wt(e,"snapped",o[37].snapped);const s={};u[1]&4096&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),le(n,o)}}}function Dv(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let s={draggable:!0,zIndex:1,$$slots:{default:[EI]},$$scope:{ctx:r}};return r[37].point!==void 0&&(s.lngLat=r[37].point),e=new sp({props:s}),dn.push(()=>Dn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){ue(e.$$.fragment)},m(d,p){ae(e,d,p),n=!0},p(d,p){r=d;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,zn(()=>t=!1)),e.$set(g)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){V(e.$$.fragment,d),n=!1},d(d){le(e,d)}}}function LI(r){let e,t,n,i;const o=[_n("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new Ji({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function II(r){let e,t;const n=[_n("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function PI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K;function q(Be,Ne){return Be[6].length==0?CI:SI}let J=q(r),fe=J(r);x=new Wg({}),x.$on("click",r[10]),x.$on("mousemove",r[11]);let Ee=On(r[7]),ee=[];for(let Be=0;Be<Ee.length;Be+=1)ee[Be]=zv(Pv(r,Ee,Be));const ie=Be=>V(ee[Be],1,1,()=>{ee[Be]=null});let ve=On(r[0]),ye=[];for(let Be=0;Be<ve.length;Be+=1)ye[Be]=Dv(Iv(r,ve,Be));const it=Be=>V(ye[Be],1,1,()=>{ye[Be]=null});return I=new _r({props:{data:r[1]||Qi(),generateId:!0,$$slots:{default:[LI]},$$scope:{ctx:r}}}),L=new _r({props:{data:r[8],$$slots:{default:[II]},$$scope:{ctx:r}}}),F=Pg(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=oe(),n=U("div"),i=U("label"),o=U("input"),s=Me(`
    Snap boundary to roads`),d=oe(),p=U("button"),fe.c(),_=oe(),ue(x.$$.fragment),C=oe();for(let Be=0;Be<ee.length;Be+=1)ee[Be].c();T=oe();for(let Be=0;Be<ye.length;Be+=1)ye[Be].c();P=oe(),ue(I.$$.fragment),E=oe(),ue(L.$$.fragment),o.disabled=u=r[0].length>=3,de(o,"type","checkbox"),o.__value="snap",Zn(o,o.__value),de(p,"class","secondary"),p.disabled=g=r[6].length==0,Ye(n,"display","flex"),Ye(n,"gap","16px"),F.p(o)},m(Be,Ne){G(Be,e,Ne),G(Be,t,Ne),G(Be,n,Ne),B(n,i),B(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),B(i,s),B(n,d),B(n,p),fe.m(p,null),G(Be,_,Ne),ae(x,Be,Ne),G(Be,C,Ne);for(let Ie=0;Ie<ee.length;Ie+=1)ee[Ie]&&ee[Ie].m(Be,Ne);G(Be,T,Ne);for(let Ie=0;Ie<ye.length;Ie+=1)ye[Ie]&&ye[Ie].m(Be,Ne);G(Be,P,Ne),ae(I,Be,Ne),G(Be,E,Ne),ae(L,Be,Ne),O=!0,Z||(K=[Lt(o,"change",r[21]),Lt(p,"click",r[9])],Z=!0)},p(Be,Ne){if((!O||Ne[0]&1&&u!==(u=Be[0].length>=3))&&(o.disabled=u),Ne[0]&32&&(o.checked=~(Be[5]||[]).indexOf(o.__value)),J===(J=q(Be))&&fe?fe.p(Be,Ne):(fe.d(1),fe=J(Be),fe&&(fe.c(),fe.m(p,null))),(!O||Ne[0]&64&&g!==(g=Be[6].length==0))&&(p.disabled=g),Ne[0]&114832){Ee=On(Be[7]);let Ke;for(Ke=0;Ke<Ee.length;Ke+=1){const ut=Pv(Be,Ee,Ke);ee[Ke]?(ee[Ke].p(ut,Ne),N(ee[Ke],1)):(ee[Ke]=zv(ut),ee[Ke].c(),N(ee[Ke],1),ee[Ke].m(T.parentNode,T))}for(Kt(),Ke=Ee.length;Ke<ee.length;Ke+=1)ie(Ke);Jt()}if(Ne[0]&143373){ve=On(Be[0]);let Ke;for(Ke=0;Ke<ve.length;Ke+=1){const ut=Iv(Be,ve,Ke);ye[Ke]?(ye[Ke].p(ut,Ne),N(ye[Ke],1)):(ye[Ke]=Dv(ut),ye[Ke].c(),N(ye[Ke],1),ye[Ke].m(P.parentNode,P))}for(Kt(),Ke=ve.length;Ke<ye.length;Ke+=1)it(Ke);Jt()}const Ie={};Ne[0]&2&&(Ie.data=Be[1]||Qi()),Ne[1]&4096&&(Ie.$$scope={dirty:Ne,ctx:Be}),I.$set(Ie);const ot={};Ne[0]&256&&(ot.data=Be[8]),Ne[1]&4096&&(ot.$$scope={dirty:Ne,ctx:Be}),L.$set(ot)},i(Be){if(!O){N(x.$$.fragment,Be);for(let Ne=0;Ne<Ee.length;Ne+=1)N(ee[Ne]);for(let Ne=0;Ne<ve.length;Ne+=1)N(ye[Ne]);N(I.$$.fragment,Be),N(L.$$.fragment,Be),O=!0}},o(Be){V(x.$$.fragment,Be),ee=ee.filter(Boolean);for(let Ne=0;Ne<ee.length;Ne+=1)V(ee[Ne]);ye=ye.filter(Boolean);for(let Ne=0;Ne<ye.length;Ne+=1)V(ye[Ne]);V(I.$$.fragment,Be),V(L.$$.fragment,Be),O=!1},d(Be){Be&&(H(e),H(t),H(n),H(_),H(C),H(T),H(P),H(E)),fe.d(),le(x,Be),_i(ee,Be),_i(ye,Be),le(I,Be),le(L,Be),F.r(),Z=!1,cr(K)}}}function zI(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function DI(r,e,t){let n,i;ct(r,tp,He=>t(20,i=He));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:s=void 0}=e;ri(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],g=[],_=null,x=!1,C=!1,T=!1;function P(He){let mt=He.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=mt}function I(){let He=p.pop();t(6,p),He&&t(0,u=He)}function E(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function L(He){u.length>=3||(E(),u.push({point:He.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function O(He){t(19,_={point:He.detail.lngLat.toArray(),snapped:d=="snap"})}function F(He){E(),t(0,u[He].snapped=!u[He].snapped,u),t(0,u)}function Z(He){E(),u.splice(He,1),t(0,u),t(2,x=!1)}function K(He,mt,Pt,jt){if(jt||mt.length>=3)return Qi();try{if(He&&mt.length>0&&Pt)return JSON.parse(He.inner.calculateRoute([mt[mt.length-1],Pt]))}catch{}return Qi()}function q(He,mt,Pt){if(Pt)return;if(!He||mt.length<3){t(7,g=[]);return}let jt=[],un=1,nn=JSON.parse(JSON.stringify(mt));nn.push(nn[0]);for(let rn=0;rn<nn.length-1;rn++){let pn=JSON.parse(He.inner.getExtraNodes(nn[rn],nn[rn+1]));for(let[yn,qe,Ge]of pn)jt.push({point:[yn,qe],snapped:Ge,insertIdx:un});un++}t(7,g=jt)}function J(He){E(),u.splice(He.insertIdx,0,{point:He.point,snapped:He.snapped}),t(0,u),t(4,T=!0)}function fe(He){t(0,u[He.insertIdx].point=He.point,u),t(0,u)}function Ee(){t(4,T=!1)}function ee(){E(),t(3,C=!0)}const ie=[[]];function ve(){d=nk(ie[0],this.__value,this.checked),t(5,d)}function ye(He,mt){r.$$.not_equal(mt.point,He)&&(mt.point=He,t(7,g))}const it=He=>J(He),Be=He=>fe(He),Ne=He=>{J(He),t(4,T=!1)};function Ie(He,mt){r.$$.not_equal(mt.point,He)&&(mt.point=He,t(0,u))}const ot=He=>F(He),Ke=He=>Z(He),ut=()=>t(2,x=!0),pt=()=>t(2,x=!1),_t=()=>t(3,C=!1);return r.$$set=He=>{"map"in He&&t(18,o=He.map),"waypoints"in He&&t(0,u=He.waypoints),"drawnShapeOut"in He&&t(1,s=He.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,s=zI(i,u))}catch(He){console.log("error drawing shape",He),t(1,s=void 0)}r.$$.dirty[0]&1048593&&q(i,u,T),r.$$.dirty[0]&1572877&&t(8,n=K(i,u,_,x||C)),r.$$.dirty[0]&1&&P(u)},[u,s,x,C,T,d,p,g,n,I,L,O,F,Z,J,fe,Ee,ee,o,_,i,ve,ie,ye,it,Be,Ne,Ie,ot,Ke,ut,pt,_t]}class q2 extends Et{constructor(e){super(),Mt(this,e,DI,PI,St,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function Rv(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",u,s,d,p,g,_,x,C=r[0].properties.simd.toFixed(1)+"",T,P,I,E,L,O,F,Z=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",K,q,J,fe,Ee,ee,ie,ve=ac(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",ye,it,Be,Ne,Ie,ot,Ke,ut=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",pt,_t;return{c(){e=U("tr"),t=U("th"),t.textContent="Population density",n=oe(),i=U("td"),u=Me(o),s=Me(" people / km²"),d=oe(),p=U("tr"),g=U("th"),g.textContent="SIMD",_=oe(),x=U("td"),T=Me(C),P=Me("%"),I=oe(),E=U("tr"),L=U("th"),L.textContent="Collision density",O=oe(),F=U("td"),K=Me(Z),q=Me(" / km²"),J=oe(),fe=U("tr"),Ee=U("th"),Ee.textContent="Car ownership",ee=oe(),ie=U("td"),ye=Me(ve),it=Me(" of households"),Be=oe(),Ne=U("tr"),Ie=U("th"),Ie.textContent="POI density",ot=oe(),Ke=U("td"),pt=Me(ut),_t=Me(" / km²")},m(He,mt){G(He,e,mt),B(e,t),B(e,n),B(e,i),B(i,u),B(i,s),G(He,d,mt),G(He,p,mt),B(p,g),B(p,_),B(p,x),B(x,T),B(x,P),G(He,I,mt),G(He,E,mt),B(E,L),B(E,O),B(E,F),B(F,K),B(F,q),G(He,J,mt),G(He,fe,mt),B(fe,Ee),B(fe,ee),B(fe,ie),B(ie,ye),B(ie,it),G(He,Be,mt),G(He,Ne,mt),B(Ne,Ie),B(Ne,ot),B(Ne,Ke),B(Ke,pt),B(Ke,_t)},p(He,mt){mt&1&&o!==(o=Math.round(He[0].properties.population/He[0].properties.area_km2).toLocaleString()+"")&&kt(u,o),mt&1&&C!==(C=He[0].properties.simd.toFixed(1)+"")&&kt(T,C),mt&1&&Z!==(Z=(He[0].properties.number_stats19_collisions/He[0].properties.area_km2).toFixed(1)+"")&&kt(K,Z),mt&1&&ve!==(ve=ac(He[0].properties.households_with_cars_or_vans,He[0].properties.total_households)+"")&&kt(ye,ve),mt&1&&ut!==(ut=(He[0].properties.number_pois/He[0].properties.area_km2).toFixed(1)+"")&&kt(pt,ut)},d(He){He&&(H(e),H(d),H(p),H(I),H(E),H(J),H(fe),H(Be),H(Ne))}}}function RI(r){let e,t,n,i,o,u=r[0].properties.area_km2.toFixed(1)+"",s,d,p,g=r[1]=="cnt"&&Rv(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=oe(),o=U("td"),s=Me(u),d=Me(" km²"),p=oe(),g&&g.c(),de(e,"class","svelte-1kpsyee")},m(_,x){G(_,e,x),B(e,t),B(t,n),B(t,i),B(t,o),B(o,s),B(o,d),B(e,p),g&&g.m(e,null)},p(_,[x]){x&1&&u!==(u=_[0].properties.area_km2.toFixed(1)+"")&&kt(s,u),_[1]=="cnt"?g?g.p(_,x):(g=Rv(_),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i:at,o:at,d(_){_&&H(e),g&&g.d()}}}function BI(r,e,t){let n;ct(r,As,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class H2 extends Et{constructor(e){super(),Mt(this,e,BI,RI,St,{neighbourhoodBoundary:0})}}function G2(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function FI(r){let e,t,n,i;return e=new Vo({props:{colorScale:b2,labels:{limits:v2}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.textContent="POIs / km²",Ye(n,"text-align","center")},m(o,u){ae(e,o,u),G(o,t,u),G(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function OI(r){let e,t,n,i;return e=new Vo({props:{colorScale:y2,labels:{limits:_2}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.textContent="collisions / km²",Ye(n,"text-align","center")},m(o,u){ae(e,o,u),G(o,t,u),G(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function $I(r){let e,t,n,i;return e=new Vo({props:{colorScale:cp,labels:{buckets:w2(fp)}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",de(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),G(o,t,u),G(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function NI(r){let e,t,n,i;return e=new Vo({props:{colorScale:mp,labels:{limits:pp.map(VI)}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(n,"display","flex"),Ye(n,"justify-content","space-between")},m(o,u){ae(e,o,u),G(o,t,u),G(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function jI(r){let e,t,n,i;return e=new Vo({props:{colorScale:hp,labels:{limits:dp}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / km²</span> <span>More dense</span>",de(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),G(o,t,u),G(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function UI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E;const L=[jI,NI,$I,OI,FI],O=[];function F(Z,K){return Z[0]=="density"?0:Z[0]=="car_ownership"?1:Z[0]=="simd"?2:Z[0]=="stats19"?3:Z[0]=="pois"?4:-1}return~(x=F(r))&&(C=O[x]=L[x](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=oe(),i=U("select"),o=U("option"),o.textContent="None",u=U("option"),u.textContent="Density",s=U("option"),s.textContent="Collisions",d=U("option"),d.textContent="SIMD",p=U("option"),p.textContent="Points of interest",g=U("option"),g.textContent="Car ownership",_=oe(),C&&C.c(),T=nr(),Ye(t,"margin","0"),Ye(t,"padding","0"),de(t,"for","prioritization-selection"),o.__value="none",Zn(o,o.__value),u.__value="density",Zn(u,u.__value),s.__value="stats19",Zn(s,s.__value),d.__value="simd",Zn(d,d.__value),p.__value="pois",Zn(p,p.__value),g.__value="car_ownership",Zn(g,g.__value),de(i,"id","prioritization-selection"),r[0]===void 0&&ys(()=>r[1].call(i)),Ye(e,"display","flex"),Ye(e,"gap","16px"),Ye(e,"align-items","center"),Ye(e,"width","fit-content")},m(Z,K){G(Z,e,K),B(e,t),B(e,n),B(e,i),B(i,o),B(i,u),B(i,s),B(i,d),B(i,p),B(i,g),Xi(i,r[0],!0),G(Z,_,K),~x&&O[x].m(Z,K),G(Z,T,K),P=!0,I||(E=Lt(i,"change",r[1]),I=!0)},p(Z,[K]){K&1&&Xi(i,Z[0]);let q=x;x=F(Z),x!==q&&(C&&(Kt(),V(O[q],1,1,()=>{O[q]=null}),Jt()),~x?(C=O[x],C||(C=O[x]=L[x](Z),C.c()),N(C,1),C.m(T.parentNode,T)):C=null)},i(Z){P||(N(C),P=!0)},o(Z){V(C),P=!1},d(Z){Z&&(H(e),H(_),H(T)),~x&&O[x].d(Z),I=!1,E()}}}const VI=r=>`${r}%`;function qI(r,e,t){let n;ct(r,As,s=>t(2,n=s));let{selectedPrioritization:i}=e;function o(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="density"?t(0,i="density"):s=="simd"?t(0,i="simd"):s=="stats19"?t(0,i="stats19"):s=="pois"?t(0,i="pois"):s=="car_ownership"&&t(0,i="car_ownership")}n=="cnt"?o():i="none";function u(){i=Ba(this),t(0,i)}return r.$$set=s=>{"selectedPrioritization"in s&&t(0,i=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);i=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",i),history.replaceState({},"",s)}},[i,u]}class W2 extends Et{constructor(e){super(),Mt(this,e,qI,UI,St,{selectedPrioritization:0})}}function Z2(r,e){return{none:r.none,area:fo(["get","area_km2"],qT,HT),car_ownership:fo(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],pp,mp),density:fo(["/",["get","population"],["get","area_km2"]],dp,hp),pois:fo(["/",["get","number_pois"],["get","area_km2"]],v2,b2),simd:fo(["get","simd"],fp,cp),stats19:fo(["/",["get","number_stats19_collisions"],["get","area_km2"]],_2,y2)}[e]}function HI(r){let e,t,n,i,o,u,s,d,p,g,_=yr(r[8].mode)+"",x,C;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),x=Me(_),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(T,P){G(T,e,P),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),B(g,x),C=!0},p(T,P){(!C||P&256)&&_!==(_=yr(T[8].mode)+"")&&kt(x,_)},i(T){C||(N(o.$$.fragment,T),N(d.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(d.$$.fragment,T),C=!1},d(T){T&&H(e),le(o),le(d)}}}function Bv(r){let e,t,n,i,o,u,s;function d(g){r[20](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new W2({props:p}),dn.push(()=>Dn(o,"selectedPrioritization",d)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=oe(),ue(o.$$.fragment)},m(g,_){G(g,e,_),G(g,t,_),G(g,n,_),G(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};!u&&_&16&&(u=!0,x.selectedPrioritization=g[4],zn(()=>u=!1)),o.$set(x)},i(g){s||(N(o.$$.fragment,g),s=!0)},o(g){V(o.$$.fragment,g),s=!1},d(g){g&&(H(e),H(t),H(n),H(i)),le(o,g)}}}function Fv(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function GI(r){let e,t,n,i,o,u,s,d;function p(x){r[23](x)}function g(x){r[24](x)}let _={map:mr(r[10])};return r[6]!==void 0&&(_.waypoints=r[6]),r[1]!==void 0&&(_.drawnShapeOut=r[1]),n=new q2({props:_}),dn.push(()=>Dn(n,"waypoints",p)),dn.push(()=>Dn(n,"drawnShapeOut",g)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-iaefgo">1. Draw your neighbourhood</h3>',t=oe(),ue(n.$$.fragment),u=oe(),s=U("div"),s.innerHTML=`<h3 class="svelte-iaefgo">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,de(e,"class","step svelte-iaefgo"),Wt(e,"active",!r[7]),Wt(e,"complete",r[7]),de(s,"class","step svelte-iaefgo"),Ye(s,"margin-top","16px"),Wt(s,"active",r[7]),Wt(s,"complete",r[5].size>1)},m(x,C){G(x,e,C),G(x,t,C),ae(n,x,C),G(x,u,C),G(x,s,C),d=!0},p(x,C){(!d||C&128)&&Wt(e,"active",!x[7]),(!d||C&128)&&Wt(e,"complete",x[7]);const T={};C&1024&&(T.map=mr(x[10])),!i&&C&64&&(i=!0,T.waypoints=x[6],zn(()=>i=!1)),!o&&C&2&&(o=!0,T.drawnShapeOut=x[1],zn(()=>o=!1)),n.$set(T),(!d||C&128)&&Wt(s,"active",x[7]),(!d||C&32)&&Wt(s,"complete",x[5].size>1)},i(x){d||(N(n.$$.fragment,x),d=!0)},o(x){V(n.$$.fragment,x),d=!1},d(x){x&&(H(e),H(t),H(u),H(s)),le(n,x)}}}function WI(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-iaefgo">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=oe(),n=U("div"),n.innerHTML='<h3 class="svelte-iaefgo">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',de(e,"class","step svelte-iaefgo"),Wt(e,"active",!r[7]),Wt(e,"complete",r[7]),de(n,"class","step svelte-iaefgo"),Wt(n,"active",r[7]),Wt(n,"complete",r[5].size>1)},m(i,o){G(i,e,o),G(i,t,o),G(i,n,o)},p(i,o){o&128&&Wt(e,"active",!i[7]),o&128&&Wt(e,"complete",i[7]),o&128&&Wt(n,"active",i[7]),o&32&&Wt(n,"complete",i[5].size>1)},i:at,o:at,d(i){i&&(H(e),H(t),H(n))}}}function ZI(r){let e;function t(o,u){if(o[0]=="choose-area")return JI;if(o[0]=="draw-area")return KI}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),Ye(e,"text-align","center")},m(o,u){G(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:at,o:at,d(o){o&&H(e),i&&i.d()}}}function XI(r){let e,t;return e=new H2({props:{neighbourhoodBoundary:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function KI(r){let e;function t(o,u){return o[6].length<3?QI:YI}let n=t(r),i=n(r);return{c(){i.c(),e=nr()},m(o,u){i.m(o,u),G(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i.d(o)}}}function JI(r){let e;return{c(){e=Me("Empty so far. Click a colored area to get started.")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function YI(r){let e;return{c(){e=Me(`Not a valid shape yet — try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function QI(r){let e;return{c(){e=Me(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function e8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K,q,J,fe,Ee,ee,ie,ve,ye,it,Be,Ne,Ie,ot,Ke,ut,pt,_t,He,mt,Pt,jt,un;t=new Us({props:{mode:{mode:"pick-neighbourhood"}}});let nn=r[9]=="cnt"&&Bv(r),rn=r[4]=="none"&&Fv();_=new Mw({}),P=new Vg({});const pn=[WI,GI],yn=[];function qe(he,cn){return he[0]=="choose-area"?0:he[0]=="draw-area"?1:-1}~(L=qe(r))&&(O=yn[L]=pn[L](r)),ve=new qg({});const Ge=[XI,ZI],At=[];function tt(he,cn){return he[7]?0:1}return Ke=tt(r),ut=At[Ke]=Ge[Ke](r),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),nn&&nn.c(),i=oe(),rn&&rn.c(),o=oe(),u=U("hr"),s=oe(),d=U("div"),p=U("div"),g=U("button"),ue(_.$$.fragment),x=Me(`
          Choose area`),C=Me(`
        or
        `),T=U("button"),ue(P.$$.fragment),I=Me(`
          Draw area`),E=oe(),O&&O.c(),F=oe(),Z=U("div"),Z.innerHTML='<h3 class="svelte-iaefgo">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',K=oe(),q=U("div"),J=U("button"),fe=Me("Create neighborhood"),ee=oe(),ie=U("button"),ue(ve.$$.fragment),ye=Me(" Start over"),Be=oe(),Ne=U("h3"),Ne.textContent="Your neighbourhood overall",Ie=oe(),ot=U("div"),ut.c(),pt=oe(),_t=U("hr"),He=oe(),mt=U("button"),mt.textContent="Export to GeoJSON",Wt(g,"active",r[0]=="choose-area"),Wt(T,"active",r[0]=="draw-area"),de(p,"class","tool-palette svelte-iaefgo"),Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","16px"),de(Z,"class","step svelte-iaefgo"),Wt(Z,"active",r[7]),J.disabled=Ee=!r[7],de(ie,"class","destructive"),Ye(ie,"display","flex"),Ye(ie,"gap","8px"),Ye(ie,"align-items","center"),ie.disabled=it=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Ye(q,"display","flex"),Ye(q,"gap","16px"),Ye(q,"justify-content","space-between"),Ye(q,"margin-bottom","16px"),de(ot,"class","neighbourhood-boundary-summary svelte-iaefgo"),de(mt,"class","secondary"),de(e,"slot","sidebar")},m(he,cn){G(he,e,cn),ae(t,e,null),B(e,n),nn&&nn.m(e,null),B(e,i),rn&&rn.m(e,null),B(e,o),B(e,u),B(e,s),B(e,d),B(d,p),B(p,g),ae(_,g,null),B(g,x),B(p,C),B(p,T),ae(P,T,null),B(T,I),B(d,E),~L&&yn[L].m(d,null),B(d,F),B(d,Z),B(d,K),B(d,q),B(q,J),B(J,fe),B(q,ee),B(q,ie),ae(ve,ie,null),B(ie,ye),B(d,Be),B(d,Ne),B(d,Ie),B(d,ot),At[Ke].m(ot,null),B(e,pt),B(e,_t),B(e,He),B(e,mt),Pt=!0,jt||(un=[Lt(g,"click",r[21]),Lt(T,"click",r[22]),Lt(J,"click",r[25]),Lt(ie,"click",r[16]),Lt(mt,"click",r[13])],jt=!0)},p(he,cn){he[9]=="cnt"?nn?(nn.p(he,cn),cn&512&&N(nn,1)):(nn=Bv(he),nn.c(),N(nn,1),nn.m(e,i)):nn&&(Kt(),V(nn,1,1,()=>{nn=null}),Jt()),he[4]=="none"?rn||(rn=Fv(),rn.c(),rn.m(e,o)):rn&&(rn.d(1),rn=null),(!Pt||cn&1)&&Wt(g,"active",he[0]=="choose-area"),(!Pt||cn&1)&&Wt(T,"active",he[0]=="draw-area");let Xe=L;L=qe(he),L===Xe?~L&&yn[L].p(he,cn):(O&&(Kt(),V(yn[Xe],1,1,()=>{yn[Xe]=null}),Jt()),~L?(O=yn[L],O?O.p(he,cn):(O=yn[L]=pn[L](he),O.c()),N(O,1),O.m(d,F)):O=null),(!Pt||cn&128)&&Wt(Z,"active",he[7]),(!Pt||cn&128&&Ee!==(Ee=!he[7]))&&(J.disabled=Ee),(!Pt||cn&193&&it!==(it=!(he[7]||he[0]=="draw-area"&&he[6].length>0)))&&(ie.disabled=it);let lt=Ke;Ke=tt(he),Ke===lt?At[Ke].p(he,cn):(Kt(),V(At[lt],1,1,()=>{At[lt]=null}),Jt(),ut=At[Ke],ut?ut.p(he,cn):(ut=At[Ke]=Ge[Ke](he),ut.c()),N(ut,1),ut.m(ot,null))},i(he){Pt||(N(t.$$.fragment,he),N(nn),N(_.$$.fragment,he),N(P.$$.fragment,he),N(O),N(ve.$$.fragment,he),N(ut),Pt=!0)},o(he){V(t.$$.fragment,he),V(nn),V(_.$$.fragment,he),V(P.$$.fragment,he),V(O),V(ve.$$.fragment,he),V(ut),Pt=!1},d(he){he&&H(e),le(t),nn&&nn.d(),rn&&rn.d(),le(_),le(P),~L&&yn[L].d(),le(ve),At[Ke].d(),jt=!1,cr(un)}}}function Ov(r){let e,t;return e=new _r({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[t8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i&1073741824&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function t8(r){let e,t,n,i;const o=[_n("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new ur({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function $v(r){let e,t;return e=new _r({props:{data:r[3],generateId:!0,$$slots:{default:[u8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.data=n[3]),i&1073741840&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Nv(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[a8,({props:n})=>({29:n}),({props:n})=>n?536870912:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1610612752&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function n8(r){let e,t,n,i,o=(r[29].number_pois/r[29].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Points of interest",t=oe(),n=U("br"),i=oe(),u=Me(o),s=Me(" / km²")},m(d,p){G(d,e,p),G(d,t,p),G(d,n,p),G(d,i,p),G(d,u,p),G(d,s,p)},p(d,p){p&536870912&&o!==(o=(d[29].number_pois/d[29].area_km2).toFixed(1)+"")&&kt(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(s))}}}function r8(r){let e,t,n,i,o=(r[29].number_stats19_collisions/r[29].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=oe(),n=U("br"),i=oe(),u=Me(o),s=Me(` /
                km²`)},m(d,p){G(d,e,p),G(d,t,p),G(d,n,p),G(d,i,p),G(d,u,p),G(d,s,p)},p(d,p){p&536870912&&o!==(o=(d[29].number_stats19_collisions/d[29].area_km2).toFixed(1)+"")&&kt(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(s))}}}function i8(r){let e,t,n,i,o=Math.round(r[29].population/r[29].area_km2).toLocaleString()+"",u,s;return{c(){e=U("b"),e.textContent="Population density",t=oe(),n=U("br"),i=oe(),u=Me(o),s=Me(`
                people / km²`)},m(d,p){G(d,e,p),G(d,t,p),G(d,n,p),G(d,i,p),G(d,u,p),G(d,s,p)},p(d,p){p&536870912&&o!==(o=Math.round(d[29].population/d[29].area_km2).toLocaleString()+"")&&kt(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(s))}}}function o8(r){let e,t,n,i,o=ac(r[29].households_with_cars_or_vans,r[29].total_households)+"",u,s,d=r[29].total_households.toLocaleString()+"",p,g;return{c(){e=U("b"),e.textContent="Car or van ownership",t=oe(),n=U("br"),i=oe(),u=Me(o),s=Me(" of approximately "),p=Me(d),g=Me(`
                households have at least one car or van.`)},m(_,x){G(_,e,x),G(_,t,x),G(_,n,x),G(_,i,x),G(_,u,x),G(_,s,x),G(_,p,x),G(_,g,x)},p(_,x){x&536870912&&o!==(o=ac(_[29].households_with_cars_or_vans,_[29].total_households)+"")&&kt(u,o),x&536870912&&d!==(d=_[29].total_households.toLocaleString()+"")&&kt(p,d)},d(_){_&&(H(e),H(t),H(n),H(i),H(u),H(s),H(p),H(g))}}}function s8(r){let e,t,n=r[29].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=oe(),i=Me(n),o=Me(" km²")},m(u,s){G(u,e,s),G(u,t,s),G(u,i,s),G(u,o,s)},p(u,s){s&536870912&&n!==(n=u[29].area_km2.toFixed(1)+"")&&kt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function a8(r){let e;function t(o,u){if(o[4]=="none")return s8;if(o[4]=="car_ownership")return o8;if(o[4]=="density")return i8;if(o[4]=="stats19")return r8;if(o[4]=="pois")return n8}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=nr()},m(o,u){i&&i.m(o,u),G(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function l8(r){let e,t,n=r[4]!="simd"&&Nv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o&16&&N(n,1)):(n=Nv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function u8(r){let e,t,n,i;const o=[_n("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[l8]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new Ji({props:u}),e.$on("click",r[11]);const s=[_n("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new ur({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&49168?In(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g&1073741840&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function c8(r){let e,t,n,i=r[7]&&Ov(r),o=r[0]=="choose-area"&&$v(r);return{c(){e=U("div"),i&&i.c(),t=oe(),o&&o.c(),de(e,"slot","map")},m(u,s){G(u,e,s),i&&i.m(e,null),B(e,t),o&&o.m(e,null),n=!0},p(u,s){u[7]?i?(i.p(u,s),s&128&&N(i,1)):(i=Ov(u),i.c(),N(i,1),i.m(e,t)):i&&(Kt(),V(i,1,1,()=>{i=null}),Jt()),u[0]=="choose-area"?o?(o.p(u,s),s&1&&N(o,1)):(o=$v(u),o.c(),N(o,1),o.m(e,null)):o&&(Kt(),V(o,1,1,()=>{o=null}),Jt())},i(u){n||(N(i),N(o),n=!0)},o(u){V(i),V(o),n=!1},d(u){u&&H(e),i&&i.d(),o&&o.d()}}}function f8(r){let e,t,n,i;return e=new ah({props:{loading:r[2]}}),n=new ko({props:{$$slots:{map:[c8],sidebar:[e8],top:[HI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.loading=o[2]),e.$set(s);const d={};u&1073743867&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function h8(r,e,t){let n,i,o,u,s,d,p;ct(r,tr,Be=>t(8,n=Be)),ct(r,Da,Be=>t(26,i=Be)),ct(r,Ir,Be=>t(19,o=Be)),ct(r,$s,Be=>t(27,u=Be)),ct(r,Wa,Be=>t(28,s=Be)),ct(r,As,Be=>t(9,d=Be)),ct(r,as,Be=>t(10,p=Be));let g="Generating severance boundaries...",_=Qi(),x="choose-area",C="none",T=null,P=new Map,I=[],E,L=null,O=null;ks(async()=>{await new Promise(Be=>{requestAnimationFrame(()=>{requestAnimationFrame(Be)})}),t(3,_=o.generatedBoundaries()),t(2,g="")});function F(Be){let Ne=Be.detail.features[0].id,Ie=_.features[Ne],ot=new Map(P);if(ot.has(Ne)?ot.delete(Ne):ot.set(Ne,Ie),ot.size===0)t(17,T=null),t(5,P=ot);else if(ot.size===1)t(17,T=ot.values().next().value),t(5,P=ot);else{let Ke={type:"FeatureCollection",features:Array.from(ot.values())};try{t(17,T=o.generateMergedBoundary(Ke)),t(5,P=ot)}catch(ut){console.log(`error merging boundaries: ${ut}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${ut}`)}}}function Z(Be){var ot;let Ne=s.nextAvailableNeighbourhoodName(u),Ie=G2(o,"What do you want to name the neighbourhood?",Ne);if(Ie)try{const Ke={};x=="draw-area"&&((ot=E==null?void 0:E.properties)!=null&&ot.waypoints)&&(Ke.waypoints=E.properties.waypoints);let ut={type:"Feature",properties:Ke,geometry:Be.geometry};o.setCurrentNeighbourhoodBoundary(Ie,ut),ln(Da,i=Ie,i),qf(),ln(tr,n={mode:"neighbourhood"},n)}catch(Ke){window.alert(`Sorry, this boundary is invalid: ${Ke}`)}}function K(){rp("auto_boundaries.geojson",JSON.stringify(_,null,"  "))}function q(Be){return Z2({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},Be)}function J(Be){return{none:er(.3,.5),area:er(.7,.9),car_ownership:er(.7,.9),density:er(.7,.9),pois:er(.7,.9),simd:er(.7,.9),stats19:er(.7,.9)}[Be]}function fe(){t(17,T=null),P.clear(),t(5,P),t(6,I=[]),t(18,L=null),t(7,O=null)}function Ee(Be){C=Be,t(4,C)}const ee=()=>t(0,x="choose-area"),ie=()=>t(0,x="draw-area");function ve(Be){I=Be,t(6,I)}function ye(Be){E=Be,t(1,E)}const it=()=>Z(mr(O));return r.$$.update=()=>{if(r.$$.dirty&524290){let Be=null;if(E&&E.geometry.coordinates[0].length>3){let Ne={type:"FeatureCollection",features:[E]};try{Be=o.generateMergedBoundary(Ne)}catch(Ie){console.log(`error merging boundaries: ${Ie}`)}}t(18,L=Be)}r.$$.dirty&393217&&(x=="draw-area"?t(7,O=L):t(7,O=T))},[x,E,g,_,C,P,I,O,n,d,p,F,Z,K,q,J,fe,T,L,o,Ee,ee,ie,ve,ye,it]}class d8 extends Et{constructor(e){super(),Mt(this,e,h8,f8,St,{})}}const p8="/ltn/assets/bus_gate_icon-5ea86d80.gif",m8="/ltn/assets/bus_gate-fc08b133.gif",g8="/ltn/assets/no_entry_icon-a9bfd826.gif",_8="/ltn/assets/no_entry-6857cf3d.gif",y8="/ltn/assets/school_street_icon-38e9058e.gif",v8="/ltn/assets/school_street-a0b77e20.gif",b8="/ltn/assets/walk_cycle_only_icon-4c8b48c0.gif",w8="/ltn/assets/walk_cycle_only-03bfc59f.gif",bi=class bi{constructor(e,t,n,i,o){Yn(this,"filterType");Yn(this,"label");Yn(this,"description");Yn(this,"imageUrl");Yn(this,"iconUrl");this.filterType=e,this.label=t,this.description=n,this.imageUrl=i,this.iconUrl=o}get iconURL(){return this.iconUrl}get largeImageURL(){return this.imageUrl}static getFilter(e){switch(e){case"walk_cycle_only":return bi.walkCycleOnly;case"no_entry":return bi.noEntry;case"bus_gate":return bi.busGate;case"school_street":return bi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};Yn(bi,"walkCycleOnly",new bi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.",w8,b8)),Yn(bi,"noEntry",new bi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.",_8,g8)),Yn(bi,"busGate",new bi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.",m8,p8)),Yn(bi,"schoolStreet",new bi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.",v8,y8)),Yn(bi,"allTypes",[bi.walkCycleOnly,bi.noEntry,bi.busGate,bi.schoolStreet]);let Ri=bi;function x8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=yr(r[7].mode)+"",P,I;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Me(T),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(E,L){G(E,e,L),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),ae(_,g,null),B(n,x),B(n,C),B(C,P),I=!0},p(E,L){(!I||L&128)&&T!==(T=yr(E[7].mode)+"")&&kt(P,T)},i(E){I||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),I=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),I=!1},d(E){E&&H(e),le(o),le(d),le(_)}}}function A8(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function k8(r){let e,t=r[6].properties.name+"",n,i,o,u,s=r[6].properties.sum_from.toLocaleString()+"",d,p,g,_,x=r[6].properties.sum_to.toLocaleString()+"",C,T,P,I,E=r[6].properties.counts_from[r[3]]+"",L;return{c(){e=U("u"),n=Me(t),i=oe(),o=U("p"),u=Me("Total trips from here: "),d=Me(s),p=oe(),g=U("p"),_=Me("Total trips to here: "),C=Me(x),T=oe(),P=U("p"),I=Me("Total intra-zonal trips starting and ending here: "),L=Me(E)},m(O,F){G(O,e,F),B(e,n),G(O,i,F),G(O,o,F),B(o,u),B(o,d),G(O,p,F),G(O,g,F),B(g,_),B(g,C),G(O,T,F),G(O,P,F),B(P,I),B(P,L)},p(O,F){F&64&&t!==(t=O[6].properties.name+"")&&kt(n,t),F&64&&s!==(s=O[6].properties.sum_from.toLocaleString()+"")&&kt(d,s),F&64&&x!==(x=O[6].properties.sum_to.toLocaleString()+"")&&kt(C,x),F&72&&E!==(E=O[6].properties.counts_from[O[3]]+"")&&kt(L,E)},d(O){O&&(H(e),H(i),H(o),H(p),H(g),H(T),H(P))}}}function S8(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",s,d,p,g,_,x,C,T,P,I,E=r[1]?"from":"to",L,O,F=r[3]==null?"each zone":"this zone",Z,K,q,J,fe,Ee,ee,ie,ve,ye;t=new Us({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),J=new Vo({props:{colorScale:Rd,labels:{limits:r[5]}}});function it(Ie,ot){return Ie[6]&&Ie[3]!=null?k8:A8}let Be=it(r),Ne=Be(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),o=Me("Trips begin and end in "),s=Me(u),d=Me(" zones"),p=oe(),g=U("label"),_=Me(`Trips from
      `),x=U("input"),C=Me(`
      Trips to`),T=oe(),P=U("p"),I=Me("Trips "),L=Me(E),O=oe(),Z=Me(F),K=Me(":"),q=oe(),ue(J.$$.fragment),fe=oe(),Ee=U("hr"),ee=oe(),Ne.c(),de(x,"type","checkbox"),de(x,"role","switch"),de(e,"slot","sidebar")},m(Ie,ot){G(Ie,e,ot),ae(t,e,null),B(e,n),B(e,i),B(i,o),B(i,s),B(i,d),B(e,p),B(e,g),B(g,_),B(g,x),x.checked=r[1],B(g,C),B(e,T),B(e,P),B(P,I),B(P,L),B(P,O),B(P,Z),B(P,K),B(e,q),ae(J,e,null),B(e,fe),B(e,Ee),B(e,ee),Ne.m(e,null),ie=!0,ve||(ye=Lt(x,"change",r[9]),ve=!0)},p(Ie,ot){(!ie||ot&1)&&u!==(u=Ie[0].features.length.toLocaleString()+"")&&kt(s,u),ot&2&&(x.checked=Ie[1]),(!ie||ot&2)&&E!==(E=Ie[1]?"from":"to")&&kt(L,E),(!ie||ot&8)&&F!==(F=Ie[3]==null?"each zone":"this zone")&&kt(Z,F);const Ke={};ot&32&&(Ke.labels={limits:Ie[5]}),J.$set(Ke),Be===(Be=it(Ie))&&Ne?Ne.p(Ie,ot):(Ne.d(1),Ne=Be(Ie),Ne&&(Ne.c(),Ne.m(e,null)))},i(Ie){ie||(N(t.$$.fragment,Ie),N(J.$$.fragment,Ie),ie=!0)},o(Ie){V(t.$$.fragment,Ie),V(J.$$.fragment,Ie),ie=!1},d(Ie){Ie&&H(e),le(t),le(J),Ne.d(),ve=!1,ye()}}}function C8(r){let e,t,n,i,o;const u=[_n("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":er(.5,.1)}},{manageHoverState:!0}];function s(_){r[8](_)}let d={};for(let _=0;_<u.length;_+=1)d=zt(d,u[_]);r[2]!==void 0&&(d.hovered=r[2]),e=new Ji({props:d}),dn.push(()=>Dn(e,"hovered",s));const p=[_n("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let _=0;_<p.length;_+=1)g=zt(g,p[_]);return i=new ur({props:g}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(_,x){ae(e,_,x),G(_,n,x),ae(i,_,x),o=!0},p(_,x){const C=x&16?In(u,[u[0],{paint:{"fill-color":_[4],"fill-opacity":er(.5,.1)}},u[2]]):{};!t&&x&4&&(t=!0,C.hovered=_[2],zn(()=>t=!1)),e.$set(C);const T={};i.$set(T)},i(_){o||(N(e.$$.fragment,_),N(i.$$.fragment,_),o=!0)},o(_){V(e.$$.fragment,_),V(i.$$.fragment,_),o=!1},d(_){_&&H(n),le(e,_),le(i,_)}}}function T8(r){let e,t,n;return t=new _r({props:{data:r[0],generateId:!0,$$slots:{default:[C8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","map")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function M8(r){let e,t;return e=new ko({props:{$$slots:{map:[T8],sidebar:[S8],top:[x8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function E8(r,e,t){let n,i,o,u,s,d;ct(r,tr,I=>t(7,s=I)),ct(r,Ir,I=>t(10,d=I));let p=Qi();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),ln(tr,s={mode:"pick-neighbourhood"},s)}let g=!1,_=null;function x(I,E){if(I==null){let L=E?"sum_to":"sum_from",O=Math.max(...p.features.map(Z=>Z.properties[L])),F=C(O);return[F,fo(["get",L],F,Rd)]}else{let L=E?"counts_to":"counts_from",O=[...p.features.map(K=>K.properties[L][I])],F=Math.max(...O),Z=C(F);return[Z,fo(["at",["id"],["literal",O]],Z,Rd)]}}function C(I){let E=Rd.length+1;return Array.from(Array(E).keys()).map(L=>Math.round(I/(E-1)*L))}function T(I){_=I,t(2,_)}function P(){g=this.checked,t(1,g)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=_==null?null:_.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=x(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,_)))},[p,g,_,n,u,o,i,s,T,P]}class L8 extends Et{constructor(e){super(),Mt(this,e,E8,M8,St,{})}}function I8(r){let e,t,n,i,o,u,s,d,p,g,_=yr(r[4].mode)+"",x,C;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),x=Me(_),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(T,P){G(T,e,P),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),B(g,x),C=!0},p(T,P){(!C||P&16)&&_!==(_=yr(T[4].mode)+"")&&kt(x,_)},i(T){C||(N(o.$$.fragment,T),N(d.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(d.$$.fragment,T),C=!1},d(T){T&&H(e),le(o),le(d)}}}function jv(r){let e,t,n,i,o,u,s;function d(g){r[7](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new up({props:p}),dn.push(()=>Dn(n,"idx",d)),{c(){e=U("button"),e.textContent="Pick another intersection",t=oe(),ue(n.$$.fragment),de(e,"class","secondary")},m(g,_){G(g,e,_),G(g,t,_),ae(n,g,_),o=!0,u||(s=Lt(e,"click",r[6]),u=!0)},p(g,_){const x={};_&2&&(x.list=g[1].features),!i&&_&4&&(i=!0,x.idx=g[2],zn(()=>i=!1)),n.$set(x)},i(g){o||(N(n.$$.fragment,g),o=!0)},o(g){V(n.$$.fragment,g),o=!1},d(g){g&&(H(e),H(t)),le(n,g),u=!1,s()}}}function Uv(r){let e,t;return{c(){e=U("a"),t=Me("Open OSM"),de(e,"href",r[0]),de(e,"target","_blank")},m(n,i){G(n,e,i),B(e,t)},p(n,i){i&1&&de(e,"href",n[0])},d(n){n&&H(e)}}}function P8(r){let e,t,n,i,o,u,s;t=new Us({props:{mode:{mode:"pick-neighbourhood"}}});let d=r[1].features.length>0&&jv(r),p=r[0]&&Uv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=oe(),d&&d.c(),u=oe(),p&&p.c(),de(e,"slot","sidebar")},m(g,_){G(g,e,_),ae(t,e,null),B(e,n),B(e,i),B(e,o),d&&d.m(e,null),B(e,u),p&&p.m(e,null),s=!0},p(g,_){g[1].features.length>0?d?(d.p(g,_),_&2&&N(d,1)):(d=jv(g),d.c(),N(d,1),d.m(e,u)):d&&(Kt(),V(d,1,1,()=>{d=null}),Jt()),g[0]?p?p.p(g,_):(p=Uv(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){s||(N(t.$$.fragment,g),N(d),s=!0)},o(g){V(t.$$.fragment,g),V(d),s=!1},d(g){g&&H(e),le(t),d&&d.d(),p&&p.d()}}}function z8(r){let e,t;const n=[_n("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ol({props:i}),e.$on("click",r[5]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function D8(r){let e,t,n,i;const o=[_n("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new Ji({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&4?In(s,[s[0],{filter:["==",["id"],p[2]]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function R8(r){let e,t,n,i,o;return t=new _r({props:{data:mr(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[z8]},$$scope:{ctx:r}}}),i=new _r({props:{data:r[1],generateId:!0,$$slots:{default:[D8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),de(e,"slot","map")},m(u,s){G(u,e,s),ae(t,e,null),B(e,n),ae(i,e,null),o=!0},p(u,s){const d={};s&8&&(d.data=mr(u[3]).getAllIntersections()),s&256&&(d.$$scope={dirty:s,ctx:u}),t.$set(d);const p={};s&2&&(p.data=u[1]),s&260&&(p.$$scope={dirty:s,ctx:u}),i.$set(p)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&H(e),le(t),le(i)}}}function B8(r){let e,t;return e=new ko({props:{$$slots:{map:[R8],sidebar:[P8],top:[I8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function F8(r,e,t){let n,i;ct(r,Ir,_=>t(3,n=_)),ct(r,tr,_=>t(4,i=_));let o=null,u=Qi(),s=0;function d(_){t(0,o=_.detail.features[0].properties.osm),t(1,u=n.getMovements(_.detail.features[0].id)),t(2,s=0)}const p=()=>t(1,u=Qi());function g(_){s=_,t(2,s)}return[o,u,s,n,i,d,p,g]}class O8 extends Et{constructor(e){super(),Mt(this,e,F8,B8,St,{})}}function $8(r){let e,t,n,i;const o=[_n("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":jd(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new Ji({props:u});const s=[_n("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":kd(1),"icon-offset":Vv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":jd(),"icon-halo-color":"black","icon-opacity":qv(),"icon-halo-width":kd(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new nc({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,[g]){const _=g&1?In(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(_);const x=g&2?In(s,[s[0],s[1],g&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":kd(1),"icon-offset":Vv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},g&0&&{paint:{"icon-color":jd(),"icon-halo-color":"black","icon-opacity":qv(),"icon-halo-width":kd(1.5),"icon-halo-blur":0}},s[4],s[5]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function kd(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function Vv(r){return[0,-50*r]}function qv(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function N8(r,e,t){let n,i;return ct(r,Zd,o=>t(0,n=o)),ct(r,Km,o=>t(1,i=o)),[n,i]}class gp extends Et{constructor(e){super(),Mt(this,e,N8,$8,St,{})}}function j8(r){let e,t;const n=[_n("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ji({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class _p extends Et{constructor(e){super(),Mt(this,e,null,j8,St,{})}}const U8=r=>({}),Hv=r=>({}),V8=r=>({}),Gv=r=>({});function Wv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Gv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,V8):xn(i[10]),Gv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function q8(r){let e,t,n=r[0]&&Wv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Wv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function Zv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Hv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,U8):xn(i[10]),Hv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function H8(r){let e,t,n=r[0]&&Zv(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Zv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function G8(r){let e,t,n,i,o,u,s,d;const p=[_n("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let E=0;E<p.length;E+=1)g=zt(g,p[E]);e=new ur({props:g});const _=[_n("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":er(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let x={$$slots:{default:[q8]},$$scope:{ctx:r}};for(let E=0;E<_.length;E+=1)x=zt(x,_[E]);n=new ur({props:x}),n.$on("click",r[8]);const C=[_n("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let T={};for(let E=0;E<C.length;E+=1)T=zt(T,C[E]);o=new ur({props:T});const P=[_n("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":er("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":er(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let I={$$slots:{default:[H8]},$$scope:{ctx:r}};for(let E=0;E<P.length;E+=1)I=zt(I,P[E]);return s=new ur({props:I}),s.$on("click",r[9]),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(E,L){ae(e,E,L),G(E,t,L),ae(n,E,L),G(E,i,L),ae(o,E,L),G(E,u,L),ae(s,E,L),d=!0},p(E,[L]){const O=L&84?In(p,[p[0],p[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(O);const F=L&125?In(_,[_[0],_[1],L&124&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,0),"line-color":E[5](E[3],E[4].maxShortcuts),"line-opacity":er(1,.5)}},_[3],_[4],L&1&&{manageHoverState:E[0]},L&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};L&1025&&(F.$$scope={dirty:L,ctx:E}),n.$set(F);const Z=L&84?In(C,[C[0],C[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,6),"line-color":"black"}},C[3]]):{};o.$set(Z);const K=L&85?In(P,[P[0],P[1],L&84&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,4),"line-color":er("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":er(1,.5)}},P[3],P[4],L&1&&{manageHoverState:E[0]},L&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};L&1025&&(K.$$scope={dirty:L,ctx:E}),s.$set(K)},i(E){d||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),d=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),d=!1},d(E){E&&(H(t),H(i),H(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function W8(r,e,t){let n,i;ct(r,Jm,T=>t(2,n=T)),ct(r,Zd,T=>t(3,i=T));let{$$slots:o={},$$scope:u}=e,s=Yf("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(T,P)=>{}}=e;function g(T,P){return T=="cells"?jd():T=="edits"?er(["case",["get","edited"],GT,"white"],vo.mapFeature.hover.backgroundColor):T=="speeds"?fo(["get","speed_mph"],g2,m2):P<=2?er("white","blue"):(console.assert(T=="shortcuts"),er(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",P,"#A32015"],vo.mapFeature.hover.backgroundColor))}function _(T,P,I){return!T||P<=2?ia(I):["interpolate",["linear"],["get","shortcuts"],0,5+I,P,25+I]}const x=T=>d&&p(T.detail.features[0],T.detail.event.lngLat),C=T=>d&&p(T.detail.features[0],T.detail.event.lngLat);return r.$$set=T=>{"interactive"in T&&t(0,d=T.interactive),"onClickLine"in T&&t(1,p=T.onClickLine),"$$scope"in T&&t(10,u=T.$$scope)},[d,p,n,i,s,g,_,o,x,C,u]}class uh extends Et{constructor(e){super(),Mt(this,e,W8,G8,St,{interactive:0,onClickLine:1})}}function Z8(r){let e;const t=r[7].default,n=vn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&wn(n,t,i,i[9],e?bn(t,i[9],o,null):xn(i[9]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function X8(r){let e,t,n;const i=[_n("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(s){r[8](s)}let u={$$slots:{default:[Z8]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=zt(u,i[s]);return r[1]!==void 0&&(u.hovered=r[1]),e=new nc({props:u}),dn.push(()=>Dn(e,"hovered",o)),e.$on("click",function(){Ga(r[0])&&r[0].apply(this,arguments)}),{c(){ue(e.$$.fragment)},m(s,d){ae(e,s,d),n=!0},p(s,d){r=s;const p=d&16?In(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function K8(r){let e,t;const n=[_n("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function J8(r){let e,t,n,i;return e=new _r({props:{data:r[2],generateId:!0,$$slots:{default:[X8]},$$scope:{ctx:r}}}),n=new _r({props:{data:r[3],$$slots:{default:[K8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.data=o[2]),u&531&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&8&&(d.data=o[3]),u&512&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function Y8(r,e,t){let n,i,o,u,s;ct(r,Ir,C=>t(5,o=C)),ct(r,Zi,C=>t(6,u=C)),ct(r,Wd,C=>t(4,s=C));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,_=null;function x(C){_=C,t(1,_)}return r.$$set=C=>{"onClickTurnRestriction"in C&&t(0,g=C.onClickTurnRestriction),"$$scope"in C&&t(9,p=C.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=_==null?Qi():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(_.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(_.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():Qi())},[g,_,i,n,s,o,u,d,x,p]}class Q8 extends Et{constructor(e){super(),Mt(this,e,Y8,J8,St,{onClickTurnRestriction:0})}}const eP=r=>({}),Xv=r=>({}),tP=r=>({}),Kv=r=>({});function nP(r){let e;const t=r[7]["modal-filter"],n=vn(t,r,r[8],Kv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,tP):xn(i[8]),Kv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function rP(r){let e,t,n,i;const o=[_n("modal-filters"),{interactive:r[2]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},{minzoom:Sd},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[nP]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new nc({props:u}),e.$on("click",function(){Ga(r[0])&&r[0].apply(this,arguments)});const s=[_n("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Sd},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new nc({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){r=p;const _=g&20?In(o,[o[0],g&4&&{interactive:r[2]},g&16&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Sd},o[4],o[5]]):{};g&256&&(_.$$scope={dirty:g,ctx:r}),e.$set(_);const x=g&0?In(s,[s[0],s[1],{minzoom:Sd},s[3],s[4]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function iP(r){let e;const t=r[7]["turn-restriction"],n=vn(t,r,r[8],Xv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,eP):xn(i[8]),Xv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function oP(r){let e,t,n,i;return e=new _r({props:{data:r[3],generateId:!0,$$slots:{default:[rP]},$$scope:{ctx:r}}}),n=new Q8({props:{onClickTurnRestriction:r[1],$$slots:{default:[iP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&8&&(s.data=o[3]),u&277&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&2&&(d.onClickTurnRestriction=o[1]),u&256&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}let Sd=13;function sP(r,e,t){let n,i,o,u;ct(r,Ir,x=>t(5,i=x)),ct(r,Zi,x=>t(6,o=x)),ct(r,Wd,x=>t(4,u=x));let{$$slots:s={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e,{interactive:_}=e;return r.$$set=x=>{"onClickModalFilter"in x&&t(0,p=x.onClickModalFilter),"onClickTurnRestriction"in x&&t(1,g=x.onClickTurnRestriction),"interactive"in x&&t(2,_=x.interactive),"$$scope"in x&&t(8,d=x.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&t(3,n=o>0?i.renderModalFilters():Qi())},[p,g,_,n,u,i,o,s,d]}class el extends Et{constructor(e){super(),Mt(this,e,sP,oP,St,{onClickModalFilter:0,onClickTurnRestriction:1,interactive:2})}}function aP(r){let e,t;const n=[_n("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new nc({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class yp extends Et{constructor(e){super(),Mt(this,e,null,aP,St,{})}}function lP(r){let e;const t=r[3].default,n=vn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&wn(n,t,i,i[4],e?bn(t,i[4],o,null):xn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function uP(r){let e,t;return e=new _r({props:{data:r[0],generateId:!0,$$slots:{default:[lP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cP(r,e,t){let n,i;ct(r,Ir,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:s=null}=e;return r.$$set=d=>{"input"in d&&t(1,s=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||i.renderNeighbourhood()),r.$$.dirty&1&&np("neighbourhoodGj",n)},[n,s,i,o,u]}class ch extends Et{constructor(e){super(),Mt(this,e,cP,uP,St,{input:1})}}function jd(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function fP(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=yr(r[2].mode)+"",P,I;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Me(T),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(E,L){G(E,e,L),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),ae(_,g,null),B(n,x),B(n,C),B(C,P),I=!0},p(E,L){(!I||L&4)&&T!==(T=yr(E[2].mode)+"")&&kt(P,T)},i(E){I||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),I=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),I=!1},d(E){E&&H(e),le(o),le(d),le(_)}}}function Jv(r){let e,t,n;return{c(){e=U("button"),e.textContent="Ⓧ",de(e,"class","close-btn svelte-khnvno")},m(i,o){G(i,e,o),t||(n=Lt(e,"click",r[5]),t=!0)},p:at,d(i){i&&H(e),t=!1,n()}}}function hP(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){G(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}function dP(r){let e,t,n,i,o,u,s;e=new Qf({props:{properties:r[0].feature.properties}});function d(g){r[6](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new up({props:p}),dn.push(()=>Dn(o,"idx",d)),{c(){ue(e.$$.fragment),t=oe(),n=U("h5"),n.textContent="Turn restrictions:",i=oe(),ue(o.$$.fragment)},m(g,_){ae(e,g,_),G(g,t,_),G(g,n,_),G(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};_&1&&(x.properties=g[0].feature.properties),e.$set(x);const C={};_&1&&(C.list=g[0].movements.features),!u&&_&1&&(u=!0,C.idx=g[0].movementIdx,zn(()=>u=!1)),o.$set(C)},i(g){s||(N(e.$$.fragment,g),N(o.$$.fragment,g),s=!0)},o(g){V(e.$$.fragment,g),V(o.$$.fragment,g),s=!1},d(g){g&&(H(t),H(n),H(i)),le(e,g),le(o,g)}}}function pP(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T;t=new Us({props:{mode:{mode:"neighbourhood"}}});let P=r[0]&&Jv(r);const I=[dP,hP],E=[];function L(O,F){return O[0]?0:1}return x=L(r),C=E[x]=I[x](r),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("h4"),i.textContent="Roads",o=oe(),u=U("p"),u.textContent="Click a road to visit its OSM object.",s=oe(),d=U("div"),p=U("h4"),p.textContent="Intersections",g=oe(),P&&P.c(),_=oe(),C.c(),Ye(d,"display","flex"),Ye(d,"align-items","start"),Ye(d,"justify-content","space-between"),de(e,"slot","sidebar")},m(O,F){G(O,e,F),ae(t,e,null),B(e,n),B(e,i),B(e,o),B(e,u),B(e,s),B(e,d),B(d,p),B(d,g),P&&P.m(d,null),B(e,_),E[x].m(e,null),T=!0},p(O,F){O[0]?P?P.p(O,F):(P=Jv(O),P.c(),P.m(d,null)):P&&(P.d(1),P=null);let Z=x;x=L(O),x===Z?E[x].p(O,F):(Kt(),V(E[Z],1,1,()=>{E[Z]=null}),Jt(),C=E[x],C?C.p(O,F):(C=E[x]=I[x](O),C.c()),N(C,1),C.m(e,null))},i(O){T||(N(t.$$.fragment,O),N(C),T=!0)},o(O){V(t.$$.fragment,O),V(C),T=!1},d(O){O&&H(e),le(t),P&&P.d(),E[x].d()}}}function mP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[mP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function _P(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yP(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[_P,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","line-popup")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function vP(r){let e,t,n,i,o,u,s,d,p,g;e=new _p({}),n=new gp({}),o=new yp({});const _=[_n("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let x={$$slots:{default:[gP]},$$scope:{ctx:r}};for(let C=0;C<_.length;C+=1)x=zt(x,_[C]);return s=new Ol({props:x}),p=new uh({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[yP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),d=oe(),ue(p.$$.fragment)},m(C,T){ae(e,C,T),G(C,t,T),ae(n,C,T),G(C,i,T),ae(o,C,T),G(C,u,T),ae(s,C,T),G(C,d,T),ae(p,C,T),g=!0},p(C,T){const P={};T&256&&(P.$$scope={dirty:T,ctx:C}),s.$set(P);const I={};T&256&&(I.$$scope={dirty:T,ctx:C}),p.$set(I)},i(C){g||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(s.$$.fragment,C),N(p.$$.fragment,C),g=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),V(s.$$.fragment,C),V(p.$$.fragment,C),g=!1},d(C){C&&(H(t),H(i),H(u),H(d)),le(e,C),le(n,C),le(o,C),le(s,C),le(p,C)}}}function bP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[bP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function xP(r){let e,t;return e=new Qf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function AP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[xP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kP(r){var o,u,s;let e,t;const n=[_n("debug-intersections"),{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":er(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:s.intersection_id)??-1],.3,er(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[AP]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=zt(i,n[d]);return e=new Ol({props:i}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(d,p){ae(e,d,p),t=!0},p(d,p){var _,x,C;const g=p&1?In(n,[n[0],{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":er(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((C=(x=(_=d[0])==null?void 0:_.feature)==null?void 0:x.properties)==null?void 0:C.intersection_id)??-1],.3,er(0,.5)]}},n[2],n[3]]):{};p&256&&(g.$$scope={dirty:p,ctx:d}),e.$set(g)},i(d){t||(N(e.$$.fragment,d),t=!0)},o(d){V(e.$$.fragment,d),t=!1},d(d){le(e,d)}}}function Yv(r){let e,t;return e=new _r({props:{data:r[0].movements,generateId:!0,$$slots:{default:[SP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function SP(r){let e,t,n,i;const o=[_n("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new Ji({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&1?In(s,[s[0],{filter:["==",["id"],p[0].movementIdx]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function CP(r){let e,t,n,i,o,u,s,d;t=new ch({props:{$$slots:{default:[vP]},$$scope:{ctx:r}}}),i=new el({props:{interactive:!0,$$slots:{default:[wP]},$$scope:{ctx:r}}}),u=new _r({props:{data:mr(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[kP]},$$scope:{ctx:r}}});let p=r[0]&&Yv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),s=oe(),p&&p.c(),de(e,"slot","map")},m(g,_){G(g,e,_),ae(t,e,null),B(e,n),ae(i,e,null),B(e,o),ae(u,e,null),B(e,s),p&&p.m(e,null),d=!0},p(g,_){const x={};_&256&&(x.$$scope={dirty:_,ctx:g}),t.$set(x);const C={};_&256&&(C.$$scope={dirty:_,ctx:g}),i.$set(C);const T={};_&2&&(T.data=mr(g[1]).getAllIntersections()),_&257&&(T.$$scope={dirty:_,ctx:g}),u.$set(T),g[0]?p?(p.p(g,_),_&1&&N(p,1)):(p=Yv(g),p.c(),N(p,1),p.m(e,null)):p&&(Kt(),V(p,1,1,()=>{p=null}),Jt())},i(g){d||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(u.$$.fragment,g),N(p),d=!0)},o(g){V(t.$$.fragment,g),V(i.$$.fragment,g),V(u.$$.fragment,g),V(p),d=!1},d(g){g&&H(e),le(t),le(i),le(u),p&&p.d()}}}function TP(r){let e,t;return e=new ko({props:{$$slots:{map:[CP],sidebar:[pP],top:[fP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function MP(r,e,t){let n,i;ct(r,Ir,g=>t(1,n=g)),ct(r,tr,g=>t(2,i=g));let o=null;function u(g){let _=g.detail.features[0],x=n.getMovements(_.properties.intersection_id);t(0,o={feature:_,movements:x,movementIdx:0})}const s=(g,_)=>window.open(mr(g.properties).way,"_blank"),d=()=>t(0,o=null);function p(g){r.$$.not_equal(o.movementIdx,g)&&(o.movementIdx=g,t(0,o))}return[o,n,i,u,s,d,p]}class EP extends Et{constructor(e){super(),Mt(this,e,MP,TP,St,{})}}const LP="/ltn/assets/eraser-894c4bbc.svg",IP="/ltn/assets/paintbrush-511a1297.svg",Qv="/ltn/assets/one_way_left-9368d5dd.svg",PP="/ltn/assets/traffic_1-a90740ec.svg";var zo=63710088e-1,zP={centimeters:zo*100,centimetres:zo*100,degrees:360/(2*Math.PI),feet:zo*3.28084,inches:zo*39.37,kilometers:zo/1e3,kilometres:zo/1e3,meters:zo,metres:zo,miles:zo/1609.344,millimeters:zo*1e3,millimetres:zo*1e3,nauticalmiles:zo/1852,radians:1,yards:zo*1.0936};function DP(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Cg(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!eb(r[0])||!eb(r[1]))throw new Error("coordinates must contain numbers");return DP({type:"Point",coordinates:r},e,t)}function RP(r,e="kilometers"){const t=zP[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Tg(r){return r%(2*Math.PI)*180/Math.PI}function Il(r){return r%360*Math.PI/180}function eb(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Mg(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function BP(r){return r.type==="Feature"?r.geometry:r}function X2(r,e,t={}){if(t.final===!0)return FP(r,e);const n=Mg(r),i=Mg(e),o=Il(n[0]),u=Il(i[0]),s=Il(n[1]),d=Il(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return Tg(Math.atan2(p,g))}function FP(r,e){let t=X2(e,r);return t=(t+180)%360,t}function OP(r,e,t,n={}){const i=Mg(r),o=Il(i[0]),u=Il(i[1]),s=Il(t),d=RP(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),_=Tg(g),x=Tg(p);return Cg([_,x],n.properties)}var Do=63710088e-1,$P={centimeters:Do*100,centimetres:Do*100,degrees:360/(2*Math.PI),feet:Do*3.28084,inches:Do*39.37,kilometers:Do/1e3,kilometres:Do/1e3,meters:Do,metres:Do,miles:Do/1609.344,millimeters:Do*1e3,millimetres:Do*1e3,nauticalmiles:Do/1852,radians:1,yards:Do*1.0936};function NP(r,e="kilometers"){const t=$P[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Cd(r){return r%360*Math.PI/180}function tb(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function K2(r,e,t={}){var n=tb(r),i=tb(e),o=Cd(i[1]-n[1]),u=Cd(i[0]-n[0]),s=Cd(n[1]),d=Cd(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return NP(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}var jP=K2;function UP(r,e,t={}){const i=BP(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const s=e-o;if(s){const d=X2(i[u],i[u-1])-180;return OP(i[u],s,d,t)}else return Cg(i[u])}else o+=K2(i[u],i[u+1],t);return Cg(i[i.length-1])}var VP=UP;function qP(r){let e,t;const n=[_n("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ol({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function HP(r){let e,t;return e=new _r({props:{data:r[0],$$slots:{default:[qP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}let GP=50,WP=100,ZP=.01;function XP(r,e,t){let{paths:n}=e,i=d(),o=p(),u=_(),s=setInterval(x,WP);ri(()=>clearInterval(s));function d(){return n.features.map(C=>1/C.properties.directness).reduce((C,T)=>C+T,0)}function p(){return n.features.length==0?[]:Array.from({length:GP},g)}function g(){let C=Math.random()*i,T=0;for(let[P,I]of n.features.entries())if(T+=1/I.properties.directness,C<T)return{idx:P,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function _(){return{type:"FeatureCollection",features:o.map(({idx:C,distance:T})=>VP(n.features[C],T,{units:"kilometers"}))}}function x(){for(let[C,T]of o.entries())T.distance+=ZP,T.distance>=n.features[T.idx].properties.length_meters/1e3&&(o[C]=g());t(0,u=_())}return r.$$set=C=>{"paths"in C&&t(1,n=C.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[u,n]}class KP extends Et{constructor(e){super(),Mt(this,e,XP,HP,St,{paths:1})}}class JP{constructor(e){Yn(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}const f_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==";function YP(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=oe(),n=U("img"),o=Me(`
    Add diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"margin-top","-12px"),de(e,"class","icon"),kr(n.src,i=f_)||de(n,"src",i),de(n,"alt","Add diagonal filter"),Ye(n,"transform","rotate(135deg)"),de(n,"class","svelte-j2s60j")},m(u,s){G(u,e,s),G(u,t,s),G(u,n,s),G(u,o,s)},p:at,d(u){u&&(H(e),H(t),H(n),H(o))}}}function QP(r){let e;function t(o,u){return o[0].hasRotatedFilter?tz:ez}let n=t(r),i=n(r);return{c(){i.c(),e=nr()},m(o,u){i.m(o,u),G(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i.d(o)}}}function ez(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="↻",t=oe(),n=U("img"),o=Me(`
      Rotate diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"padding-bottom","4px"),de(e,"class","icon"),kr(n.src,i=f_)||de(n,"src",i),de(n,"alt","Rotate diagonal filter"),Ye(n,"transform","rotate(45deg)"),de(n,"class","svelte-j2s60j")},m(u,s){G(u,e,s),G(u,t,s),G(u,n,s),G(u,o,s)},d(u){u&&(H(e),H(t),H(n),H(o))}}}function tz(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="❌",t=oe(),n=U("img"),o=Me(`
      Delete diagonal filter`),de(e,"class","icon"),kr(n.src,i=f_)||de(n,"src",i),de(n,"alt","Remove diagonal filter"),Ye(n,"transform","rotate(45deg)"),de(n,"class","svelte-j2s60j")},m(u,s){G(u,e,s),G(u,t,s),G(u,n,s),G(u,o,s)},d(u){u&&(H(e),H(t),H(n),H(o))}}}function nz(r){let e;function t(o,u){return o[0].filter?QP:YP}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),Ye(e,"display","flex"),Ye(e,"align-items","center")},m(o,u){G(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:at,o:at,d(o){o&&H(e),i.d()}}}function rz(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class iz extends Et{constructor(e){super(),Mt(this,e,rz,nz,St,{intersection:0})}}function oz(r){let e,t;return e=new iz({props:{intersection:r[2](r[6])}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function sz(r){let e,t;return e=new Fw({props:{openOn:"hover",$$slots:{default:[oz,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function az(r){let e,t;const n=[_n("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-opacity":er(0,.5),"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":er(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[sz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ol({props:i}),e.$on("click",r[4]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&2?In(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function lz(r,e,t){let{neighbourhood:n=Yf("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new JP(g)}function s(p){return u(p[0].id)}const d=p=>i(s(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,s,n,d]}class uz extends Et{constructor(e){super(),Mt(this,e,lz,az,St,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function nb(r,e,t){const n=r.slice();return n[6]=e[t],n}function rb(r){let e,t,n,i,o,u,s=r[6].label+"",d,p,g,_,x;function C(){return r[3](r[6])}return{c(){e=U("button"),t=U("img"),i=oe(),o=U("br"),u=oe(),d=Me(s),p=oe(),kr(t.src,n=r[6].iconURL)||de(t,"src",n),de(t,"width","80"),de(t,"alt",r[6].label),de(e,"class","outline"),Ye(e,"width","100%"),e.disabled=g=r[1]==r[6].filterType},m(T,P){G(T,e,P),B(e,t),B(e,i),B(e,o),B(e,u),B(e,d),B(e,p),_||(x=Lt(e,"click",C),_=!0)},p(T,P){r=T,P&2&&g!==(g=r[1]==r[6].filterType)&&(e.disabled=g)},d(T){T&&H(e),_=!1,x()}}}function cz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C=r[2].description+"",T,P,I,E,L,O,F=On(Ri.allTypes),Z=[];for(let K=0;K<F.length;K+=1)Z[K]=rb(nb(r,F,K));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=oe(),n=U("table"),i=U("tr"),o=U("td");for(let K=0;K<Z.length;K+=1)Z[K].c();u=oe(),s=U("td"),d=U("img"),_=oe(),x=U("p"),T=Me(C),P=oe(),I=U("center"),E=U("button"),E.textContent="Confirm",kr(d.src,p=r[2].largeImageURL)||de(d,"src",p),de(d,"height","300"),de(d,"alt",g=r[2].label)},m(K,q){G(K,e,q),G(K,t,q),G(K,n,q),B(n,i),B(i,o);for(let J=0;J<Z.length;J+=1)Z[J]&&Z[J].m(o,null);B(i,u),B(i,s),B(s,d),B(s,_),B(s,x),B(x,T),G(K,P,q),G(K,I,q),B(I,E),L||(O=Lt(E,"click",r[4]),L=!0)},p(K,q){if(q&2){F=On(Ri.allTypes);let J;for(J=0;J<F.length;J+=1){const fe=nb(K,F,J);Z[J]?Z[J].p(fe,q):(Z[J]=rb(fe),Z[J].c(),Z[J].m(o,null))}for(;J<Z.length;J+=1)Z[J].d(1);Z.length=F.length}q&4&&!kr(d.src,p=K[2].largeImageURL)&&de(d,"src",p),q&4&&g!==(g=K[2].label)&&de(d,"alt",g),q&4&&C!==(C=K[2].description+"")&&kt(T,C)},d(K){K&&(H(e),H(t),H(n),H(P),H(I)),_i(Z,K),L=!1,O()}}}function fz(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[cz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Rg({props:o}),dn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&519&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function hz(r,e,t){let n,i;ct(r,Xm,p=>t(1,i=p));let{show:o}=e;const u=p=>ln(Xm,i=p.filterType,i),s=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=Ri.allTypes.find(p=>p.filterType==i))},[o,i,n,u,s,d]}class dz extends Et{constructor(e){super(),Mt(this,e,hz,fz,St,{show:0})}}function ib(r){let e,t;return e=new _r({props:{data:r[0],$$slots:{default:[pz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function pz(r){let e,t;const n=[_n("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function mz(r){let e,t,n=r[0]&&ib(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=ib(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function gz(r,e,t){let{map:n}=e,i=null;const o=js();n.on("dragstart",u),n.on("mousemove",s),n.on("mouseup",d),ri(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",s),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(p){if(i){let g=p.lngLat.toArray(),_=i.geometry.coordinates.at(-1);if(_&&jP(_,g)*1e3<.5)return;i.geometry.coordinates.push(g),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function d(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class J2 extends Et{constructor(e){super(),Mt(this,e,gz,mz,St,{map:1})}}function _z(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function ob(r){let e,t,n;return t=new Fn({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[yz]},$$scope:{ctx:r}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){G(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function yz(r){let e;return{c(){e=Me("Debug")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function vz(r){let e,t,n,i,o,u,s,d,p,g,_=yr(r[14].mode)+"",x,C,T,P,I,E,L,O,F,Z,K,q,J,fe,Ee,ee,ie,ve,ye,it,Be,Ne;o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),T=new i_({props:{$$slots:{default:[_z]},$$scope:{ctx:r}}}),O=new Fn({props:{mode:{mode:"view-shortcuts"}}}),K=new Fn({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),fe=new Fn({props:{mode:{mode:"predict-impact",prevMode:"neighbourhood"}}}),ie=new Fn({props:{mode:{mode:"impact-one-destination"}}}),it=new Fn({props:{mode:{mode:"set-boundary",name:mr(r[6]).properties.name,existing:mr(r[6])}}});let Ie=r[15]&&ob(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),x=Me(_),C=oe(),ue(T.$$.fragment),P=oe(),I=U("nav"),E=U("ul"),L=U("li"),ue(O.$$.fragment),F=oe(),Z=U("li"),ue(K.$$.fragment),q=oe(),J=U("li"),ue(fe.$$.fragment),Ee=oe(),ee=U("li"),ue(ie.$$.fragment),ve=oe(),ye=U("li"),ue(it.$$.fragment),Be=oe(),Ie&&Ie.c(),de(t,"aria-label","breadcrumb"),de(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(ot,Ke){G(ot,e,Ke),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),B(g,x),B(g,C),ae(T,g,null),B(e,P),B(e,I),B(I,E),B(E,L),ae(O,L,null),B(E,F),B(E,Z),ae(K,Z,null),B(E,q),B(E,J),ae(fe,J,null),B(E,Ee),B(E,ee),ae(ie,ee,null),B(E,ve),B(E,ye),ae(it,ye,null),B(E,Be),Ie&&Ie.m(E,null),Ne=!0},p(ot,Ke){(!Ne||Ke[0]&16384)&&_!==(_=yr(ot[14].mode)+"")&&kt(x,_);const ut={};Ke[1]&524288&&(ut.$$scope={dirty:Ke,ctx:ot}),T.$set(ut);const pt={};Ke[0]&64&&(pt.mode={mode:"set-boundary",name:mr(ot[6]).properties.name,existing:mr(ot[6])}),it.$set(pt),ot[15]?Ie?Ke[0]&32768&&N(Ie,1):(Ie=ob(ot),Ie.c(),N(Ie,1),Ie.m(E,null)):Ie&&(Kt(),V(Ie,1,1,()=>{Ie=null}),Jt())},i(ot){Ne||(N(o.$$.fragment,ot),N(d.$$.fragment,ot),N(T.$$.fragment,ot),N(O.$$.fragment,ot),N(K.$$.fragment,ot),N(fe.$$.fragment,ot),N(ie.$$.fragment,ot),N(it.$$.fragment,ot),N(Ie),Ne=!0)},o(ot){V(o.$$.fragment,ot),V(d.$$.fragment,ot),V(T.$$.fragment,ot),V(O.$$.fragment,ot),V(K.$$.fragment,ot),V(fe.$$.fragment,ot),V(ie.$$.fragment,ot),V(it.$$.fragment,ot),V(Ie),Ne=!1},d(ot){ot&&H(e),le(o),le(d),le(T),le(O),le(K),le(fe),le(ie),le(it),Ie&&Ie.d()}}}function bz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K,q,J,fe,Ee,ee;return g=new Mw({}),I=new Tw({}),K=new j3({}),{c(){e=U("h3"),e.textContent="Reclassify main roads",t=oe(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=oe(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`,u=oe(),s=U("div"),d=U("button"),p=U("div"),ue(g.$$.fragment),_=oe(),x=U("span"),x.textContent="Toggle segment or pan map",C=oe(),T=U("button"),P=U("div"),ue(I.$$.fragment),E=oe(),L=U("span"),L.textContent="Mark as main along a line",O=oe(),F=U("button"),Z=U("div"),ue(K.$$.fragment),q=oe(),J=U("span"),J.textContent="Erase main classification",Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","8px"),de(d,"data-tippy-content","Click a road to reclassify it"),Wt(d,"active",!r[0].freehand),Wt(d,"outline",r[0].freehand),Ye(P,"display","flex"),Ye(P,"align-items","center"),Ye(P,"gap","8px"),de(T,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Wt(T,"active",r[0].freehand&&r[0].isMain),Wt(T,"outline",!(r[0].freehand&&r[0].isMain)),Ye(Z,"display","flex"),Ye(Z,"align-items","center"),Ye(Z,"gap","8px"),de(F,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Wt(F,"active",r[0].freehand&&!r[0].isMain),Wt(F,"outline",!(r[0].freehand&&!r[0].isMain)),de(s,"class","classification-buttons svelte-b4nchc"),Ye(s,"display","flex"),Ye(s,"flex-direction","column"),Ye(s,"gap","8px"),Ye(s,"justify-content","left")},m(ie,ve){G(ie,e,ve),G(ie,t,ve),G(ie,n,ve),G(ie,i,ve),G(ie,o,ve),G(ie,u,ve),G(ie,s,ve),B(s,d),B(d,p),ae(g,p,null),B(p,_),B(p,x),B(s,C),B(s,T),B(T,P),ae(I,P,null),B(P,E),B(P,L),B(s,O),B(s,F),B(F,Z),ae(K,Z,null),B(Z,q),B(Z,J),fe=!0,Ee||(ee=[Lt(d,"click",r[40]),Lt(T,"click",r[41]),Lt(F,"click",r[42])],Ee=!0)},p(ie,ve){(!fe||ve[0]&1)&&Wt(d,"active",!ie[0].freehand),(!fe||ve[0]&1)&&Wt(d,"outline",ie[0].freehand),(!fe||ve[0]&1)&&Wt(T,"active",ie[0].freehand&&ie[0].isMain),(!fe||ve[0]&1)&&Wt(T,"outline",!(ie[0].freehand&&ie[0].isMain)),(!fe||ve[0]&1)&&Wt(F,"active",ie[0].freehand&&!ie[0].isMain),(!fe||ve[0]&1)&&Wt(F,"outline",!(ie[0].freehand&&!ie[0].isMain))},i(ie){fe||(N(g.$$.fragment,ie),N(I.$$.fragment,ie),N(K.$$.fragment,ie),fe=!0)},o(ie){V(g.$$.fragment,ie),V(I.$$.fragment,ie),V(K.$$.fragment,ie),fe=!1},d(ie){ie&&(H(e),H(t),H(n),H(i),H(o),H(u),H(s)),le(g),le(I),le(K),Ee=!1,cr(ee)}}}function wz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Restrict turns",t=oe(),n=U("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){G(i,e,o),G(i,t,o),G(i,n,o)},p:at,i:at,o:at,d(i){i&&(H(e),H(t),H(n))}}}function xz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Toggle one-way",t=oe(),n=U("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){G(i,e,o),G(i,t,o),G(i,n,o)},p:at,i:at,o:at,d(i){i&&(H(e),H(t),H(n))}}}function Az(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L;function O(Z){r[36](Z)}let F={};return r[3]!==void 0&&(F.show=r[3]),o=new dz({props:F}),dn.push(()=>Dn(o,"show",O)),C=new Tw({}),{c(){e=U("h3"),e.textContent="Add modal filter",t=oe(),n=U("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=oe(),ue(o.$$.fragment),s=oe(),d=U("div"),p=U("button"),p.textContent="Change modal filter type",g=oe(),_=U("button"),x=U("div"),ue(C.$$.fragment),T=oe(),P=U("span"),P.textContent="Add along a line",de(p,"class","outline"),Ye(x,"display","flex"),Ye(x,"align-items","center"),Ye(x,"gap","8px"),de(_,"data-tippy-content","Add many modal filters along a line"),Wt(_,"active",r[0].freehand),Wt(_,"outline",!r[0].freehand),Ye(d,"display","flex"),Ye(d,"gap","8px"),Ye(d,"align-items","leading"),Ye(d,"flex-direction","column"),Ye(d,"width","fit-content")},m(Z,K){G(Z,e,K),G(Z,t,K),G(Z,n,K),G(Z,i,K),ae(o,Z,K),G(Z,s,K),G(Z,d,K),B(d,p),B(d,g),B(d,_),B(_,x),ae(C,x,null),B(x,T),B(x,P),I=!0,E||(L=[Lt(p,"click",r[37]),Lt(_,"click",function(){Ga(r[0].freehand?r[38]:r[39])&&(r[0].freehand?r[38]:r[39]).apply(this,arguments)})],E=!0)},p(Z,K){r=Z;const q={};!u&&K[0]&8&&(u=!0,q.show=r[3],zn(()=>u=!1)),o.$set(q),(!I||K[0]&1)&&Wt(_,"active",r[0].freehand),(!I||K[0]&1)&&Wt(_,"outline",!r[0].freehand)},i(Z){I||(N(o.$$.fragment,Z),N(C.$$.fragment,Z),I=!0)},o(Z){V(o.$$.fragment,Z),V(C.$$.fragment,Z),I=!1},d(Z){Z&&(H(e),H(t),H(n),H(i),H(s),H(d)),le(o,Z),le(C),E=!1,cr(L)}}}function sb(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function ab(r){let e,t;return e=new Vo({props:{colorScale:m2,labels:{limits:g2}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K,q,J,fe,Ee,ee,ie,ve,ye,it,Be,Ne,Ie,ot,Ke,ut,pt,_t,He,mt,Pt,jt,un,nn,rn,pn,yn,qe,Ge,At,tt,he,cn,Xe,lt,Gt,Kn,Gn,fr,Sr,Cr,xi,Un,xt,Pr,br;L=new F4({}),q=new M4({});const Bi=[Az,xz,wz,bz],$n=[];function Fe(Rt,Qt){return Rt[0].kind=="filter"?0:Rt[0].kind=="oneway"?1:Rt[0].kind=="turn_restriction"?2:Rt[0].kind=="main-roads"?3:-1}~(ie=Fe(r))&&(ve=$n[ie]=Bi[ie](r));let yt=r[8]>0&&sb(),bt=r[13]=="speeds"&&ab();return Un=new H2({props:{neighbourhoodBoundary:mr(r[6])}}),{c(){e=U("div"),t=U("h2"),t.textContent="Editing tools",n=oe(),i=U("div"),o=U("div"),u=U("button"),s=U("img"),p=oe(),g=U("button"),g.innerHTML=`<div style="height: 100%; width: 100%; position: relative;"><img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${Qv}" alt="Reverse directions"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${Qv}" alt="Reverse directions"/></div>`,_=oe(),x=U("button"),x.innerHTML=`<img src="${Dg}" alt="Restrict turns"/>`,C=oe(),T=U("button"),T.innerHTML=`<img src="${PP}" alt="Change main/minor roads"/>`,P=oe(),I=U("div"),E=U("button"),ue(L.$$.fragment),Z=oe(),K=U("button"),ue(q.$$.fragment),Ee=oe(),ee=U("div"),ve&&ve.c(),ye=oe(),yt&&yt.c(),it=oe(),Be=U("h2"),Be.textContent="Map style",Ne=oe(),Ie=U("label"),ot=U("input"),Ke=Me(`
      Animate shortcuts`),ut=U("span"),pt=Me("1"),_t=oe(),He=U("label"),mt=U("input"),Pt=Me(`
      Show entries into cells`),jt=U("span"),un=Me("2"),nn=oe(),rn=U("label"),pn=U("input"),yn=Me(`
      Road thickness depends on shortcuts`),qe=U("span"),Ge=Me("1"),At=oe(),tt=U("label"),he=U("span"),he.textContent="Draw roads:",cn=oe(),Xe=U("select"),lt=U("option"),lt.textContent="Worst shortcuts",Gt=U("option"),Gt.textContent="Cell",Kn=U("option"),Kn.textContent="Edits (either filter or direction)",Gn=U("option"),Gn.textContent="Speed limit",fr=oe(),bt&&bt.c(),Sr=oe(),Cr=U("h2"),Cr.textContent="Neighbourhood stats",xi=oe(),ue(Un.$$.fragment),kr(s.src,d=mr(Ri.getFilter(r[9])).iconURL)||de(s,"src",d),de(s,"alt","Add a modal filter"),de(u,"class","icon-btn"),de(u,"data-tippy-content","Add a modal filter (hotkey 1)"),Wt(u,"active",r[0].kind=="filter"),de(g,"class","icon-btn"),de(g,"data-tippy-content","Toggle one-way (hotkey 2)"),Wt(g,"active",r[0].kind=="oneway"),de(x,"class","icon-btn"),de(x,"data-tippy-content","Restrict turns (hotkey 3)"),Wt(x,"active",r[0].kind=="turn_restriction"),de(T,"class","icon-btn"),de(T,"data-tippy-content","Reclassify main roads (hotkey 4)"),Wt(T,"active",r[0].kind=="main-roads"),Ye(o,"height","50px"),Ye(o,"display","flex"),Ye(o,"justify-content","left"),Ye(o,"gap","6px"),de(E,"class","outline icon-btn"),E.disabled=O=r[4]==0,de(E,"data-tippy-content",F=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),de(K,"class","outline icon-btn"),K.disabled=J=r[5]==0,de(K,"data-tippy-content",fe=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),Ye(I,"height","50px"),Ye(I,"display","flex"),Ye(I,"justify-content","right"),Ye(I,"gap","6px"),de(i,"class","tool-palette"),Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),Ye(i,"flex-wrap","wrap"),Ye(i,"gap","6px"),Ye(ee,"min-height","200px"),Ye(ee,"padding-bottom","16px"),Ye(ee,"border-bottom","solid var(--pico-muted-border-color) 1px"),de(ot,"type","checkbox"),de(ut,"class","footnote-ref svelte-b4nchc"),de(ut,"data-tippy-content",cb),de(mt,"type","checkbox"),de(jt,"class","footnote-ref svelte-b4nchc"),de(jt,"data-tippy-content",Hz),de(pn,"type","checkbox"),de(qe,"class","footnote-ref svelte-b4nchc"),de(qe,"data-tippy-content",cb),Ye(he,"text-wrap","nowrap"),lt.__value="shortcuts",Zn(lt,lt.__value),Gt.__value="cells",Zn(Gt,Gt.__value),Kn.__value="edits",Zn(Kn,Kn.__value),Gn.__value="speeds",Zn(Gn,Gn.__value),Ye(Xe,"margin","0"),Ye(Xe,"padding","8px"),Ye(Xe,"width","auto"),r[13]===void 0&&ys(()=>r[46].call(Xe)),Ye(tt,"display","flex"),Ye(tt,"align-items","center"),Ye(tt,"gap","8px"),Ye(tt,"flex-wrap","wrap"),de(e,"slot","sidebar")},m(Rt,Qt){G(Rt,e,Qt),B(e,t),B(e,n),B(e,i),B(i,o),B(o,u),B(u,s),B(o,p),B(o,g),B(o,_),B(o,x),B(o,C),B(o,T),B(i,P),B(i,I),B(I,E),ae(L,E,null),B(I,Z),B(I,K),ae(q,K,null),B(e,Ee),B(e,ee),~ie&&$n[ie].m(ee,null),B(e,ye),yt&&yt.m(e,null),B(e,it),B(e,Be),B(e,Ne),B(e,Ie),B(Ie,ot),ot.checked=r[10],B(Ie,Ke),B(Ie,ut),B(ut,pt),B(e,_t),B(e,He),B(He,mt),mt.checked=r[11],B(He,Pt),B(He,jt),B(jt,un),B(e,nn),B(e,rn),B(rn,pn),pn.checked=r[12],B(rn,yn),B(rn,qe),B(qe,Ge),B(e,At),B(e,tt),B(tt,he),B(tt,cn),B(tt,Xe),B(Xe,lt),B(Xe,Gt),B(Xe,Kn),B(Xe,Gn),Xi(Xe,r[13],!0),B(e,fr),bt&&bt.m(e,null),B(e,Sr),B(e,Cr),B(e,xi),ae(Un,e,null),xt=!0,Pr||(br=[Lt(u,"click",r[32]),Lt(g,"click",r[33]),Lt(x,"click",r[34]),Lt(T,"click",r[35]),Lt(E,"click",r[24]),Lt(K,"click",r[25]),Lt(ot,"change",r[43]),Lt(mt,"change",r[44]),Lt(pn,"change",r[45]),Lt(Xe,"change",r[46])],Pr=!0)},p(Rt,Qt){(!xt||Qt[0]&512&&!kr(s.src,d=mr(Ri.getFilter(Rt[9])).iconURL))&&de(s,"src",d),(!xt||Qt[0]&1)&&Wt(u,"active",Rt[0].kind=="filter"),(!xt||Qt[0]&1)&&Wt(g,"active",Rt[0].kind=="oneway"),(!xt||Qt[0]&1)&&Wt(x,"active",Rt[0].kind=="turn_restriction"),(!xt||Qt[0]&1)&&Wt(T,"active",Rt[0].kind=="main-roads"),(!xt||Qt[0]&16&&O!==(O=Rt[4]==0))&&(E.disabled=O),(!xt||Qt[0]&16&&F!==(F=Rt[4]==0?"Undo Ctrl+Z":`Undo (${Rt[4]}) Ctrl+Z`))&&de(E,"data-tippy-content",F),(!xt||Qt[0]&32&&J!==(J=Rt[5]==0))&&(K.disabled=J),(!xt||Qt[0]&32&&fe!==(fe=Rt[5]==0?"Redo Ctrl+Y":`Redo (${Rt[5]}) Ctrl+Y`))&&de(K,"data-tippy-content",fe);let Yt=ie;ie=Fe(Rt),ie===Yt?~ie&&$n[ie].p(Rt,Qt):(ve&&(Kt(),V($n[Yt],1,1,()=>{$n[Yt]=null}),Jt()),~ie?(ve=$n[ie],ve?ve.p(Rt,Qt):(ve=$n[ie]=Bi[ie](Rt),ve.c()),N(ve,1),ve.m(ee,null)):ve=null),Rt[8]>0?yt||(yt=sb(),yt.c(),yt.m(e,it)):yt&&(yt.d(1),yt=null),Qt[0]&1024&&(ot.checked=Rt[10]),Qt[0]&2048&&(mt.checked=Rt[11]),Qt[0]&4096&&(pn.checked=Rt[12]),Qt[0]&8192&&Xi(Xe,Rt[13]),Rt[13]=="speeds"?bt?Qt[0]&8192&&N(bt,1):(bt=ab(),bt.c(),N(bt,1),bt.m(e,Sr)):bt&&(Kt(),V(bt,1,1,()=>{bt=null}),Jt());const vr={};Qt[0]&64&&(vr.neighbourhoodBoundary=mr(Rt[6])),Un.$set(vr)},i(Rt){xt||(N(L.$$.fragment,Rt),N(q.$$.fragment,Rt),N(ve),N(bt),N(Un.$$.fragment,Rt),xt=!0)},o(Rt){V(L.$$.fragment,Rt),V(q.$$.fragment,Rt),V(ve),V(bt),V(Un.$$.fragment,Rt),xt=!1},d(Rt){Rt&&H(e),le(L),le(q),~ie&&$n[ie].d(),yt&&yt.d(),bt&&bt.d(),le(Un),Pr=!1,cr(br)}}}function Sz(r){let e,t,n=(r[49].name??"unnamed road")+"",i,o,u=Math.round(r[49].speed_mph)+"",s,d;return{c(){e=U("p"),t=Me("Main road: "),i=Me(n),o=Me(`
                (`),s=Me(u),d=Me(" mph)")},m(p,g){G(p,e,g),B(e,t),B(e,i),B(e,o),B(e,s),B(e,d)},p(p,g){g[1]&262144&&n!==(n=(p[49].name??"unnamed road")+"")&&kt(i,n),g[1]&262144&&u!==(u=Math.round(p[49].speed_mph)+"")&&kt(s,u)},d(p){p&&H(e)}}}function Cz(r){let e,t=r[49].shortcuts+"",n,i,o=(r[49].name??"unnamed road")+"",u,s,d=Math.round(r[49].speed_mph)+"",p,g;return{c(){e=U("p"),n=Me(t),i=Me(" shortcuts through "),u=Me(o),s=Me(`
                (`),p=Me(d),g=Me(" mph)")},m(_,x){G(_,e,x),B(e,n),B(e,i),B(e,u),B(e,s),B(e,p),B(e,g)},p(_,x){x[1]&262144&&t!==(t=_[49].shortcuts+"")&&kt(n,t),x[1]&262144&&o!==(o=(_[49].name??"unnamed road")+"")&&kt(u,o),x[1]&262144&&d!==(d=Math.round(_[49].speed_mph)+"")&&kt(p,d)},d(_){_&&H(e)}}}function Tz(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function Mz(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function Ez(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function Lz(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=Me(`
                Click to add modal filter`),kr(t.src,n=mr(Ri.getFilter(r[9])).iconURL)||de(t,"src",n),de(t,"width","20"),de(t,"alt","Add modal filter")},m(o,u){G(o,e,u),B(e,t),B(e,i)},p(o,u){u[0]&512&&!kr(t.src,n=mr(Ri.getFilter(o[9])).iconURL)&&de(t,"src",n)},d(o){o&&H(e)}}}function Iz(r){let e,t;function n(p,g){if(p[49].kind=="interior_road")return Cz;if(p[49].kind=="main_road")return Sz}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return Lz;if(p[0].kind=="oneway")return Ez;if(p[0].kind=="main-roads"&&!p[0].freehand)return Mz;if(p[0].kind=="turn_restriction")return Tz}let s=u(r),d=s&&s(r);return{c(){o&&o.c(),e=oe(),d&&d.c(),t=nr()},m(p,g){o&&o.m(p,g),G(p,e,g),d&&d.m(p,g),G(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(H(e),H(t)),o&&o.d(p),d&&d.d(p)}}}function Pz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[Iz,({props:i})=>({49:i}),({props:i})=>[0,i?262144:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","line-popup")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[0]&513|o[1]&786432&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function zz(r){let e,t,n,i,o,u,s,d,p,g;return e=new _p({}),n=new gp({}),o=new yp({}),s=new uh({props:{interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&!r[0].freehand||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[17],$$slots:{"line-popup":[Pz]},$$scope:{ctx:r}}}),p=new uz({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[22]}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),d=oe(),ue(p.$$.fragment)},m(_,x){ae(e,_,x),G(_,t,x),ae(n,_,x),G(_,i,x),ae(o,_,x),G(_,u,x),ae(s,_,x),G(_,d,x),ae(p,_,x),g=!0},p(_,x){const C={};x[0]&1&&(C.interactive=_[0].kind=="filter"&&!_[0].freehand||_[0].kind=="oneway"||_[0].kind=="main-roads"&&!_[0].freehand||_[0].kind=="turn_restriction"&&_[0].from_road_id==null),x[0]&513|x[1]&524288&&(C.$$scope={dirty:x,ctx:_}),s.$set(C);const T={};x[0]&1&&(T.interactive=_[0].kind=="filter"),x[0]&2&&(T.neighbourhood=_[1]),p.$set(T)},i(_){g||(N(e.$$.fragment,_),N(n.$$.fragment,_),N(o.$$.fragment,_),N(s.$$.fragment,_),N(p.$$.fragment,_),g=!0)},o(_){V(e.$$.fragment,_),V(n.$$.fragment,_),V(o.$$.fragment,_),V(s.$$.fragment,_),V(p.$$.fragment,_),g=!1},d(_){_&&(H(t),H(i),H(u),H(d)),le(e,_),le(n,_),le(o,_),le(s,_),le(p,_)}}}function lb(r){let e,t;return e=new KP({props:{paths:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Dz(r){let e;return{c(){e=Me("Click to delete filter")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function Rz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[Dz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","modal-filter")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&524288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function Bz(r){let e;return{c(){e=Me("Click to delete turn restriction")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function Fz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[Bz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","turn-restriction")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&524288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function Oz(r){let e,t;return e=new J2({props:{map:mr(r[2])}}),e.$on("done",r[30]),e.$on("progress",r[31]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=mr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function $z(r){let e,t;return e=new J2({props:{map:mr(r[2])}}),e.$on("done",r[26]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=mr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ub(r){let e,t;return e=new _r({props:{data:r[0].possible_targets||Qi(),generateId:!0,$$slots:{default:[Uz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Qi()),i[0]&1|i[1]&524288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Nz(r){let e,t,n,i,o=r[0].from_road_name+"",u,s,d=(r[49].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=Me(`

              Create a turn restriction from `),u=Me(o),s=Me(" to "),p=Me(d),kr(t.src,n=r[28][r[49].kind])||de(t,"src",n),de(t,"width","20"),de(t,"alt","Add turn restriction")},m(g,_){G(g,e,_),B(e,t),B(e,i),B(e,u),B(e,s),B(e,p)},p(g,_){_[1]&262144&&!kr(t.src,n=g[28][g[49].kind])&&de(t,"src",n),_[0]&1&&o!==(o=g[0].from_road_name+"")&&kt(u,o),_[1]&262144&&d!==(d=(g[49].name||"unnamed road")+"")&&kt(p,d)},d(g){g&&H(e)}}}function jz(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[Nz,({props:n})=>({49:n}),({props:n})=>[0,n?262144:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Uz(r){let e,t;const n=[_n("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":er(.5,1),"line-width":ia(1)}}];let i={$$slots:{default:[jz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),e.$on("click",r[19]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};u[0]&1|u[1]&524288&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Vz(r){let e,t,n,i,o,u,s,d,p,g,_,x;t=new Wg({}),t.$on("click",r[18]),i=new ch({props:{input:r[1],$$slots:{default:[zz]},$$scope:{ctx:r}}});let C=r[10]&&lb(r);s=new el({props:{onClickModalFilter:r[20],onClickTurnRestriction:r[21],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[Fz],"modal-filter":[Rz]},$$scope:{ctx:r}}});const T=[$z,Oz],P=[];function I(L,O){return L[0].kind=="filter"&&L[0].freehand?0:L[0].kind=="main-roads"&&L[0].freehand?1:-1}~(p=I(r))&&(g=P[p]=T[p](r));let E=r[0].kind=="turn_restriction"&&ub(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),C&&C.c(),u=oe(),ue(s.$$.fragment),d=oe(),g&&g.c(),_=oe(),E&&E.c(),de(e,"slot","map")},m(L,O){G(L,e,O),ae(t,e,null),B(e,n),ae(i,e,null),B(e,o),C&&C.m(e,null),B(e,u),ae(s,e,null),B(e,d),~p&&P[p].m(e,null),B(e,_),E&&E.m(e,null),x=!0},p(L,O){const F={};O[0]&2&&(F.input=L[1]),O[0]&515|O[1]&524288&&(F.$$scope={dirty:O,ctx:L}),i.$set(F),L[10]?C?(C.p(L,O),O[0]&1024&&N(C,1)):(C=lb(L),C.c(),N(C,1),C.m(e,u)):C&&(Kt(),V(C,1,1,()=>{C=null}),Jt());const Z={};O[0]&1&&(Z.interactive=L[0].kind=="filter"),O[1]&524288&&(Z.$$scope={dirty:O,ctx:L}),s.$set(Z);let K=p;p=I(L),p===K?~p&&P[p].p(L,O):(g&&(Kt(),V(P[K],1,1,()=>{P[K]=null}),Jt()),~p?(g=P[p],g?g.p(L,O):(g=P[p]=T[p](L),g.c()),N(g,1),g.m(e,_)):g=null),L[0].kind=="turn_restriction"?E?(E.p(L,O),O[0]&1&&N(E,1)):(E=ub(L),E.c(),N(E,1),E.m(e,null)):E&&(Kt(),V(E,1,1,()=>{E=null}),Jt())},i(L){x||(N(t.$$.fragment,L),N(i.$$.fragment,L),N(C),N(s.$$.fragment,L),N(g),N(E),x=!0)},o(L){V(t.$$.fragment,L),V(i.$$.fragment,L),V(C),V(s.$$.fragment,L),V(g),V(E),x=!1},d(L){L&&H(e),le(t),le(i),C&&C.d(),le(s),~p&&P[p].d(),E&&E.d()}}}function qz(r){let e,t,n,i;return e=new ko({props:{$$slots:{map:[Vz],sidebar:[kz],top:[vz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Lt(window,"keydown",r[23]),n=!0)},p(o,u){const s={};u[0]&65535|u[1]&524288&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}let cb="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",Hz="Cells are the colored area reachable without travelling along a main road.";function Gz(r,e,t){let n,i,o,u,s,d,p,g,_,x,C;ct(r,Zi,tt=>t(29,i=tt)),ct(r,Ir,tt=>t(47,o=tt)),ct(r,Xm,tt=>t(9,u=tt)),ct(r,as,tt=>t(2,s=tt)),ct(r,Q0,tt=>t(10,d=tt)),ct(r,Km,tt=>t(11,p=tt)),ct(r,Jm,tt=>t(12,g=tt)),ct(r,Zd,tt=>t(13,_=tt)),ct(r,tr,tt=>t(14,x=tt)),ct(r,zf,tt=>t(15,C=tt));function T(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Qi()}}let P={kind:"filter",freehand:!1},I=!1,E=0,L=0,O,F,Z=o.getAllShortcuts();ks(()=>{x2()}),ri(()=>{s.doubleClickZoom.enable()});function K(tt){t(1,F=o.renderNeighbourhood()),t(6,O=F.features.find(he=>he.properties.kind=="boundary")),t(4,E=F.undo_length),t(5,L=F.redo_length),t(7,Z=o.getAllShortcuts()),qf()}function q(tt,he){P.kind=="filter"?(o.addModalFilter(he,u),ln(Zi,i++,i)):P.kind=="oneway"?(o.toggleTravelFlow(tt.properties.road),ln(Zi,i++,i)):P.kind=="main-roads"&&!P.freehand?(o.toggleMainRoad(tt.properties.road),ln(Zi,i++,i)):P.kind=="turn_restriction"&&(t(0,P.from_road_id=tt.properties.road,P),t(0,P.from_road_name=tt.properties.name||"unnamed road",P),t(0,P.possible_targets=o.getTurnRestrictionTargets(tt.properties.road),P))}function J(tt){P.kind=="turn_restriction"&&(s.queryRenderedFeatures(tt.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,P=T()))}function fe(tt){if(P.kind=="turn_restriction"&&P.from_road_id!=null){let he=tt.detail.features[0].properties.road;o.addTurnRestriction(P.from_road_id,he),ln(Zi,i++,i)}t(0,P=T())}function Ee(tt){let he=tt.detail.features[0];o.deleteModalFilter(he.properties.road),ln(Zi,i++,i)}function ee(tt){let he=tt.detail.features[0];o.deleteTurnRestriction(he.properties.intersection,he.properties.from_road,he.properties.to_road),ln(Zi,i++,i)}function ie(tt){if(P.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${P.kind}`);return}tt.hasRotatedFilter?(o.deleteDiagonalFilter(tt),ln(Zi,i++,i)):tt.filter?(o.rotateDiagonalFilter(tt),ln(Zi,i++,i)):(o.addDiagonalFilter(tt),ln(Zi,i++,i))}function ve(tt){tt.target.tagName!="INPUT"&&(tt.ctrlKey&&tt.key=="z"&&ye(),tt.ctrlKey&&tt.key=="y"&&it(),tt.key=="1"&&t(0,P={kind:"filter",freehand:!1}),tt.key=="2"&&t(0,P={kind:"oneway"}),tt.key=="3"&&t(0,P=T()),tt.key=="4"&&t(0,P={kind:"main-roads",freehand:!1,isMain:!1}))}function ye(){o.undo(),ln(Zi,i++,i)}function it(){o.redo(),ln(Zi,i++,i)}function Be(tt){let he=tt.detail;he&&(o.addManyModalFilters(he,u),ln(Zi,i++,i)),t(0,P={kind:"filter",freehand:!1})}function Ne(tt,he){if(P.kind!="main-roads"){console.assert(!1,"cant paint line unless in main-roads mode");return}let cn=tt.detail;cn&&(o.reclassifyRoadsAlongLine(cn,P.isMain,he),ln(Zi,i++,i))}let Ie={left:Qb,right:Dg,straight:ew,u_left_to_right:nw,u_right_to_left:tw};const ot=tt=>Ne(tt,!0),Ke=tt=>Ne(tt,!1),ut=()=>t(0,P={kind:"filter",freehand:!1}),pt=()=>t(0,P={kind:"oneway"}),_t=()=>t(0,P=T()),He=()=>t(0,P={kind:"main-roads",freehand:!1,isMain:!1});function mt(tt){I=tt,t(3,I)}const Pt=()=>t(3,I=!0),jt=()=>t(0,P={kind:"filter",freehand:!1}),un=()=>t(0,P={kind:"filter",freehand:!0}),nn=()=>{t(0,P={kind:"main-roads",freehand:!1,isMain:!0})},rn=()=>{t(0,P={kind:"main-roads",freehand:!0,isMain:!0})},pn=()=>{t(0,P={kind:"main-roads",freehand:!0,isMain:!1})};function yn(){d=this.checked,Q0.set(d)}function qe(){p=this.checked,Km.set(p)}function Ge(){g=this.checked,Jm.set(g)}function At(){_=Ba(this),Zd.set(_)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(P.kind=="oneway"||P.kind=="main-roads"?s.doubleClickZoom.disable():s.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(P.kind=="filter"&&P.freehand||P.kind=="main-roads"&&P.freehand&&P.isMain?s.getCanvas().style.cursor=`url(${IP}) 8 22, cell`:P.kind=="main-roads"&&P.freehand&&!P.isMain?s.getCanvas().style.cursor=`url(${LP}) 8 22, cell`:s.getCanvas().style.cursor=""),r.$$.dirty[0]&536870912&&K(),r.$$.dirty[0]&2&&t(8,n=F.features.filter(tt=>tt.properties.kind=="cell"&&tt.properties.cell_color=="disconnected").length)},[P,F,s,I,E,L,O,Z,n,u,d,p,g,_,x,C,T,q,J,fe,Ee,ee,ie,ve,ye,it,Be,Ne,Ie,i,ot,Ke,ut,pt,_t,He,mt,Pt,jt,un,nn,rn,pn,yn,qe,Ge,At]}class Wz extends Et{constructor(e){super(),Mt(this,e,Gz,qz,St,{},null,[-1,-1])}}function fb(r){let e,t,n;return t=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){G(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function Zz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P=yr(r[5].mode)+"",I,E;o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}});let L=r[0]=="neighbourhood"&&fb();return x=new Fn({props:{mode:{mode:"predict-impact",prevMode:r[0]}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),L&&L.c(),g=oe(),_=U("li"),ue(x.$$.fragment),C=oe(),T=U("li"),I=Me(P),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(O,F){G(O,e,F),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),L&&L.m(n,null),B(n,g),B(n,_),ae(x,_,null),B(n,C),B(n,T),B(T,I),E=!0},p(O,F){O[0]=="neighbourhood"?L?F&1&&N(L,1):(L=fb(),L.c(),N(L,1),L.m(n,g)):L&&(Kt(),V(L,1,1,()=>{L=null}),Jt());const Z={};F&1&&(Z.mode={mode:"predict-impact",prevMode:O[0]}),x.$set(Z),(!E||F&32)&&P!==(P=yr(O[5].mode)+"")&&kt(I,P)},i(O){E||(N(o.$$.fragment,O),N(d.$$.fragment,O),N(L),N(x.$$.fragment,O),E=!0)},o(O){V(o.$$.fragment,O),V(d.$$.fragment,O),V(L),V(x.$$.fragment,O),E=!1},d(O){O&&H(e),le(o),le(d),L&&L.d(),le(x)}}}function hb(r){let e,t,n,i,o,u,s;function d(C){r[10](C)}let p={list:r[2]};r[3]!==void 0&&(p.idx=r[3]),e=new up({props:p}),dn.push(()=>Dn(e,"idx",d));let g=r[2][r[3]].count>1&&db(r),_=r[2][r[3]].before==null&&pb(),x=r[2][r[3]].after==null&&mb();return{c(){ue(e.$$.fragment),n=oe(),g&&g.c(),i=oe(),_&&_.c(),o=oe(),x&&x.c(),u=nr()},m(C,T){ae(e,C,T),G(C,n,T),g&&g.m(C,T),G(C,i,T),_&&_.m(C,T),G(C,o,T),x&&x.m(C,T),G(C,u,T),s=!0},p(C,T){const P={};T&4&&(P.list=C[2]),!t&&T&8&&(t=!0,P.idx=C[3],zn(()=>t=!1)),e.$set(P),C[2][C[3]].count>1?g?g.p(C,T):(g=db(C),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),C[2][C[3]].before==null?_||(_=pb(),_.c(),_.m(o.parentNode,o)):_&&(_.d(1),_=null),C[2][C[3]].after==null?x||(x=mb(),x.c(),x.m(u.parentNode,u)):x&&(x.d(1),x=null)},i(C){s||(N(e.$$.fragment,C),s=!0)},o(C){V(e.$$.fragment,C),s=!1},d(C){C&&(H(n),H(i),H(o),H(u)),le(e,C),g&&g.d(C),_&&_.d(C),x&&x.d(C)}}}function db(r){let e,t,n=r[2][r[3]].count.toLocaleString()+"",i,o,u,s;return{c(){e=U("p"),t=Me(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Me(n),o=Me(` trips between the
          same points.`),u=oe(),s=U("i"),s.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){G(d,e,p),B(e,t),B(e,i),B(e,o),G(d,u,p),G(d,s,p)},p(d,p){p&12&&n!==(n=d[2][d[3]].count.toLocaleString()+"")&&kt(i,n)},d(d){d&&(H(e),H(u),H(s))}}}function pb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","red")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function mb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","blue")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function Xz(r){let e,t,n,i,o=r[1].before.toLocaleString()+"",u,s,d,p,g=r[1].after.toLocaleString()+"",_,x,C,T,P=Math.round(100*r[1].after/r[1].before)+"",I,E,L,O;t=new Us({props:{mode:{mode:"predict-impact",prevMode:r[0]}}});let F=r[2].length>0&&hb(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),u=Me(o),s=Me(` routes cross here
      `),d=U("span"),d.textContent="before your changes",p=Me(`
      , and `),_=Me(g),x=oe(),C=U("span"),C.textContent="after your changes",T=Me(`
      . That's
      `),I=Me(P),E=Me("% of the original traffic."),L=oe(),F&&F.c(),Ye(d,"color","red"),Ye(C,"color","blue"),de(e,"slot","sidebar")},m(Z,K){G(Z,e,K),ae(t,e,null),B(e,n),B(e,i),B(i,u),B(i,s),B(i,d),B(i,p),B(i,_),B(i,x),B(i,C),B(i,T),B(i,I),B(i,E),B(e,L),F&&F.m(e,null),O=!0},p(Z,K){const q={};K&1&&(q.mode={mode:"predict-impact",prevMode:Z[0]}),t.$set(q),(!O||K&2)&&o!==(o=Z[1].before.toLocaleString()+"")&&kt(u,o),(!O||K&2)&&g!==(g=Z[1].after.toLocaleString()+"")&&kt(_,g),(!O||K&2)&&P!==(P=Math.round(100*Z[1].after/Z[1].before)+"")&&kt(I,P),Z[2].length>0?F?(F.p(Z,K),K&4&&N(F,1)):(F=hb(Z),F.c(),N(F,1),F.m(e,null)):F&&(Kt(),V(F,1,1,()=>{F=null}),Jt())},i(Z){O||(N(t.$$.fragment,Z),N(F),O=!0)},o(Z){V(t.$$.fragment,Z),V(F),O=!1},d(Z){Z&&H(e),le(t),F&&F.d()}}}function gb(r){let e,t,n,i,o,u;return e=new _r({props:{data:r[6](r[3]),$$slots:{default:[Kz]},$$scope:{ctx:r}}}),n=new Bl({props:{lngLat:r[7](r[3]),$$slots:{default:[Jz]},$$scope:{ctx:r}}}),o=new Bl({props:{lngLat:r[8](r[3]),$$slots:{default:[Yz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment)},m(s,d){ae(e,s,d),G(s,t,d),ae(n,s,d),G(s,i,d),ae(o,s,d),u=!0},p(s,d){const p={};d&8&&(p.data=s[6](s[3])),d&8192&&(p.$$scope={dirty:d,ctx:s}),e.$set(p);const g={};d&8&&(g.lngLat=s[7](s[3])),d&8192&&(g.$$scope={dirty:d,ctx:s}),n.$set(g);const _={};d&8&&(_.lngLat=s[8](s[3])),d&8192&&(_.$$scope={dirty:d,ctx:s}),o.$set(_)},i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(H(t),H(i)),le(e,s),le(n,s),le(o,s)}}}function Kz(r){let e,t;const n=[_n("predict-impact"),{paint:{"line-width":No(["get","kind"],{focus:8},5),"line-color":No(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":No(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Jz(r){let e;return{c(){e=Me("A")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function Yz(r){let e;return{c(){e=Me("B")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function Qz(r){let e,t,n,i,o=r[2].length>0&&gb(r);return n=new el({props:{interactive:!1}}),{c(){e=U("div"),o&&o.c(),t=oe(),ue(n.$$.fragment),de(e,"slot","map")},m(u,s){G(u,e,s),o&&o.m(e,null),B(e,t),ae(n,e,null),i=!0},p(u,s){u[2].length>0?o?(o.p(u,s),s&4&&N(o,1)):(o=gb(u),o.c(),N(o,1),o.m(e,t)):o&&(Kt(),V(o,1,1,()=>{o=null}),Jt())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){V(o),V(n.$$.fragment,u),i=!1},d(u){u&&H(e),o&&o.d(),le(n)}}}function e7(r){let e,t,n,i;return e=new ah({props:{loading:r[4]}}),n=new ko({props:{$$slots:{map:[Qz],sidebar:[Xz],top:[Zz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&16&&(s.loading=o[4]),e.$set(s);const d={};u&8239&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function t7(r,e,t){let n,i,o;ct(r,tr,I=>t(5,n=I)),ct(r,Ym,I=>t(11,i=I)),ct(r,Ir,I=>t(12,o=I));let{road:u}=e,{prevPrevMode:s}=e,d=u.properties;d.kind="focus";let p=[],g=0,_="Finding changes to this road";ks(async()=>{await new Promise(I=>{requestAnimationFrame(()=>{requestAnimationFrame(I)})}),t(2,p=o.getImpactsOnRoad(d.id,i)),t(4,_=""),p.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),ln(tr,n={mode:"predict-impact",prevMode:s},n))});function x(I){return{type:"FeatureCollection",features:[p[I].before,p[I].after,u].filter(E=>E!=null)}}function C(I){return p[I].before!=null?p[I].before.geometry.coordinates[0]:p[I].after.geometry.coordinates[0]}function T(I){let E=p[I].before!=null?p[I].before.geometry.coordinates:p[I].after.geometry.coordinates;return E[E.length-1]}function P(I){g=I,t(3,g)}return r.$$set=I=>{"road"in I&&t(9,u=I.road),"prevPrevMode"in I&&t(0,s=I.prevPrevMode)},[s,d,p,g,_,n,x,C,T,u,P]}class n7 extends Et{constructor(e){super(),Mt(this,e,t7,e7,St,{road:9,prevPrevMode:0})}}function r7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=yr(r[6].mode)+"",P,I;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Me(T),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(E,L){G(E,e,L),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),ae(_,g,null),B(n,x),B(n,C),B(C,P),I=!0},p(E,L){(!I||L&64)&&T!==(T=yr(E[6].mode)+"")&&kt(P,T)},i(E){I||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),I=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),I=!1},d(E){E&&H(e),le(o),le(d),le(_)}}}function i7(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function o7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function s7(r){let e,t=ja(r[4].properties.distance)+"",n,i,o=Ua(r[4].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,d){G(s,e,d),B(e,n),B(e,i),B(e,u)},p(s,d){d&16&&t!==(t=ja(s[4].properties.distance)+"")&&kt(n,t),d&16&&o!==(o=Ua(s[4].properties.time)+"")&&kt(u,o)},d(s){s&&H(e)}}}function a7(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function l7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function u7(r){let e,t=ja(r[3].properties.distance)+"",n,i,o=Ua(r[3].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,d){G(s,e,d),B(e,n),B(e,i),B(e,u)},p(s,d){d&8&&t!==(t=ja(s[3].properties.distance)+"")&&kt(n,t),d&8&&o!==(o=Ua(s[3].properties.time)+"")&&kt(u,o)},d(s){s&&H(e)}}}function c7(r){let e,t,n,i,o,u,s,d,p,g,_;t=new Us({props:{mode:{mode:"neighbourhood"}}});function x(L,O){return L[4]?s7:L[3]?o7:i7}let C=x(r),T=C(r);function P(L,O){return L[3]?u7:L[4]?l7:a7}let I=P(r),E=I(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=oe(),u=U("u"),u.textContent="Route before changes",s=oe(),T.c(),d=oe(),p=U("u"),p.textContent="Route after changes",g=oe(),E.c(),Ye(u,"color","red"),Ye(p,"color","blue"),de(e,"slot","sidebar")},m(L,O){G(L,e,O),ae(t,e,null),B(e,n),B(e,i),B(e,o),B(e,u),B(e,s),T.m(e,null),B(e,d),B(e,p),B(e,g),E.m(e,null),_=!0},p(L,O){C===(C=x(L))&&T?T.p(L,O):(T.d(1),T=C(L),T&&(T.c(),T.m(e,d))),I===(I=P(L))&&E?E.p(L,O):(E.d(1),E=I(L),E&&(E.c(),E.m(e,null)))},i(L){_||(N(t.$$.fragment,L),_=!0)},o(L){V(t.$$.fragment,L),_=!1},d(L){L&&H(e),le(t),T.d(),E.d()}}}function f7(r){let e,t;const n=[_n("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ji({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function h7(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=Me("Time ratio: "),i=Me(n)},m(o,u){G(o,e,u),B(e,t),B(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&kt(i,n)},d(o){o&&H(e)}}}function d7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[h7,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function p7(r){let e,t,n;const i=[_n("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[10](s)}let u={$$slots:{default:[d7]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=zt(u,i[s]);return r[0]!==void 0&&(u.hovered=r[0]),e=new ur({props:u}),dn.push(()=>Dn(e,"hovered",o)),e.$on("click",r[11]),{c(){ue(e.$$.fragment)},m(s,d){ae(e,s,d),n=!0},p(s,d){const p=d&32?In(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&131072&&(p.$$scope={dirty:d,ctx:s}),!t&&d&1&&(t=!0,p.hovered=s[0],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function m7(r){let e,t;const n=[_n("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":No(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function g7(r){let e;return{c(){e=Me("X")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function _7(r){let e,t,n,i,o,u,s,d,p,g,_,x;t=new ch({props:{$$slots:{default:[f7]},$$scope:{ctx:r}}}),i=new _r({props:{data:r[5],generateId:!0,$$slots:{default:[p7]},$$scope:{ctx:r}}}),u=new _r({props:{data:r[1],$$slots:{default:[m7]},$$scope:{ctx:r}}}),d=new el({props:{interactive:!1}});function C(P){r[12](P)}let T={draggable:!0,$$slots:{default:[g7]},$$scope:{ctx:r}};return r[2]!==void 0&&(T.lngLat=r[2]),g=new Bl({props:T}),dn.push(()=>Dn(g,"lngLat",C)),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),s=oe(),ue(d.$$.fragment),p=oe(),ue(g.$$.fragment),de(e,"slot","map")},m(P,I){G(P,e,I),ae(t,e,null),B(e,n),ae(i,e,null),B(e,o),ae(u,e,null),B(e,s),ae(d,e,null),B(e,p),ae(g,e,null),x=!0},p(P,I){const E={};I&131072&&(E.$$scope={dirty:I,ctx:P}),t.$set(E);const L={};I&32&&(L.data=P[5]),I&131105&&(L.$$scope={dirty:I,ctx:P}),i.$set(L);const O={};I&2&&(O.data=P[1]),I&131072&&(O.$$scope={dirty:I,ctx:P}),u.$set(O);const F={};I&131072&&(F.$$scope={dirty:I,ctx:P}),!_&&I&4&&(_=!0,F.lngLat=P[2],zn(()=>_=!1)),g.$set(F)},i(P){x||(N(t.$$.fragment,P),N(i.$$.fragment,P),N(u.$$.fragment,P),N(d.$$.fragment,P),N(g.$$.fragment,P),x=!0)},o(P){V(t.$$.fragment,P),V(i.$$.fragment,P),V(u.$$.fragment,P),V(d.$$.fragment,P),V(g.$$.fragment,P),x=!1},d(P){P&&H(e),le(t),le(i),le(u),le(d),le(g)}}}function y7(r){let e,t,n,i;return e=new Wg({}),e.$on("contextmenu",r[8]),n=new ko({props:{$$slots:{map:[_7],sidebar:[c7],top:[r7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&131199&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function v7(r,e,t){let n,i,o,u,s,d,p,g,_;ct(r,vd,O=>t(2,s=O)),ct(r,tr,O=>t(6,d=O)),ct(r,Pf,O=>t(13,p=O)),ct(r,If,O=>t(14,g=O)),ct(r,Ir,O=>t(9,_=O));let x=null;ks(()=>{setTimeout(()=>{s&&eg(vd)},10)});function C(O){return O?_.compareRoute(new ua.LngLat(O.properties.pt1_x,O.properties.pt1_y),s,1):Qi()}function T(O){ln(If,g=new ua.LngLat(O.properties.pt1_x,O.properties.pt1_y),g),ln(Pf,p=s,p),ln(tr,d={mode:"route",prevMode:"impact-one-destination"},d)}function P(O){ln(vd,s=O.detail.lngLat,s)}function I(O){x=O,t(0,x)}const E=O=>T(O.detail.features[0]);function L(O){s=O,vd.set(s)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=_.impactToOneDestination(s)),r.$$.dirty&1&&t(1,i=C(x)),r.$$.dirty&2&&t(4,o=i.features.find(O=>O.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find(O=>O.properties.kind=="after"))},[x,i,s,u,o,n,d,T,P,_,I,E,L]}class b7 extends Et{constructor(e){super(),Mt(this,e,v7,y7,St,{})}}function _b(r,e,t){const n=r.slice();return n[27]=e[t].properties.name,n}function w7(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function yb(r){let e,t,n;return t=new Fn({props:{mode:{mode:"debug-intersections"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){G(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function x7(r){let e,t,n,i,o,u,s,d=yr(r[5].mode)+"",p,g,_,x,C,T,P,I,E,L,O,F,Z;o=new Fn({props:{mode:{mode:"title"}}}),_=new i_({props:{$$slots:{default:[w7]},$$scope:{ctx:r}}}),I=new Fn({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),O=new Fn({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}});let K=r[8]&&yb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),p=Me(d),g=oe(),ue(_.$$.fragment),x=oe(),C=U("nav"),T=U("ul"),P=U("li"),ue(I.$$.fragment),E=oe(),L=U("li"),ue(O.$$.fragment),F=oe(),K&&K.c(),de(t,"aria-label","breadcrumb"),de(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(q,J){G(q,e,J),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),B(s,p),B(s,g),ae(_,s,null),B(e,x),B(e,C),B(C,T),B(T,P),ae(I,P,null),B(T,E),B(T,L),ae(O,L,null),B(T,F),K&&K.m(T,null),Z=!0},p(q,J){(!Z||J&32)&&d!==(d=yr(q[5].mode)+"")&&kt(p,d);const fe={};J&1073741824&&(fe.$$scope={dirty:J,ctx:q}),_.$set(fe),q[8]?K?J&256&&N(K,1):(K=yb(),K.c(),N(K,1),K.m(T,null)):K&&(Kt(),V(K,1,1,()=>{K=null}),Jt())},i(q){Z||(N(o.$$.fragment,q),N(_.$$.fragment,q),N(I.$$.fragment,q),N(O.$$.fragment,q),N(K),Z=!0)},o(q){V(o.$$.fragment,q),V(_.$$.fragment,q),V(I.$$.fragment,q),V(O.$$.fragment,q),V(K),Z=!1},d(q){q&&H(e),le(o),le(_),le(I),le(O),K&&K.d()}}}function A7(r){let e=r[27]+"",t;return{c(){t=Me(e)},m(n,i){G(n,t,i)},p(n,i){i&1&&e!==(e=n[27]+"")&&kt(t,e)},d(n){n&&H(t)}}}function vb(r){let e,t,n,i,o,u,s,d,p,g,_,x,C;function T(){return r[19](r[27])}n=new sh({props:{$$slots:{default:[A7]},$$scope:{ctx:r}}}),n.$on("click",T),s=new Vg({props:{color:"black"}});function P(){return r[20](r[27])}g=new qg({props:{color:"white"}});function I(){return r[21](r[27])}function E(){return r[22](r[27])}return{c(){var L;e=U("li"),t=U("h3"),ue(n.$$.fragment),i=oe(),o=U("span"),u=U("button"),ue(s.$$.fragment),d=oe(),p=U("button"),ue(g.$$.fragment),de(u,"class","outline icon-btn"),de(u,"title","Rename neighbourhood"),de(p,"class","icon-btn destructive"),de(p,"title","Delete neighbourhood"),de(o,"class","actions"),de(e,"class","actionable-cell svelte-qhjp0j"),Wt(e,"highlighted",((L=r[3])==null?void 0:L.properties.name)==r[27]||r[2]==r[27])},m(L,O){G(L,e,O),B(e,t),ae(n,t,null),B(e,i),B(e,o),B(o,u),ae(s,u,null),B(o,d),B(o,p),ae(g,p,null),_=!0,x||(C=[Lt(u,"click",P),Lt(p,"click",I),Lt(e,"mouseenter",E),Lt(e,"mouseleave",r[23])],x=!0)},p(L,O){var Z;r=L;const F={};O&1073741825&&(F.$$scope={dirty:O,ctx:r}),n.$set(F),(!_||O&13)&&Wt(e,"highlighted",((Z=r[3])==null?void 0:Z.properties.name)==r[27]||r[2]==r[27])},i(L){_||(N(n.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),_=!0)},o(L){V(n.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),_=!1},d(L){L&&H(e),le(n),le(s),le(g),x=!1,cr(C)}}}function k7(r){let e,t,n;return e=new B3({}),{c(){ue(e.$$.fragment),t=Me(`
          Add a new neighbourhood`)},m(i,o){ae(e,i,o),G(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){V(e.$$.fragment,i),n=!1},d(i){i&&H(t),le(e,i)}}}function bb(r){let e,t,n,i,o,u,s,d,p;function g(x){r[24](x)}let _={};return r[1]!==void 0&&(_.selectedPrioritization=r[1]),o=new W2({props:_}),dn.push(()=>Dn(o,"selectedPrioritization",g)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across your neighbourhoods.",i=oe(),ue(o.$$.fragment),s=oe(),d=U("hr")},m(x,C){G(x,e,C),G(x,t,C),G(x,n,C),G(x,i,C),ae(o,x,C),G(x,s,C),G(x,d,C),p=!0},p(x,C){const T={};!u&&C&2&&(u=!0,T.selectedPrioritization=x[1],zn(()=>u=!1)),o.$set(T)},i(x){p||(N(o.$$.fragment,x),p=!0)},o(x){V(o.$$.fragment,x),p=!1},d(x){x&&(H(e),H(t),H(n),H(i),H(s),H(d)),le(o,x)}}}function wb(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",de(e,"class","secondary")},m(i,o){G(i,e,o),t||(n=Lt(e,"click",r[12]),t=!0)},p:at,d(i){i&&H(e),t=!1,n()}}}function S7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L=r[4].modalFilters+"",O,F,Z,K,q=r[4].deletedModalFilters+"",J,fe,Ee,ee,ie=r[4].travelFlows+"",ve,ye,it,Be,Ne,Ie;s=new Cw({});let ot=On(r[0].features),Ke=[];for(let He=0;He<ot.length;He+=1)Ke[He]=vb(_b(r,ot,He));const ut=He=>V(Ke[He],1,1,()=>{Ke[He]=null});T=new Fn({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[k7]},$$scope:{ctx:r}}});let pt=r[7]=="cnt"&&bb(r),_t=r[8]&&wb(r);return{c(){e=U("div"),t=U("div"),n=U("h2"),n.textContent="Neighbourhoods",i=oe(),o=U("button"),u=U("div"),ue(s.$$.fragment),d=oe(),p=U("span"),p.textContent="Export",g=oe(),_=U("ul");for(let He=0;He<Ke.length;He+=1)Ke[He].c();x=oe(),C=U("li"),ue(T.$$.fragment),P=oe(),pt&&pt.c(),I=oe(),E=U("p"),O=Me(L),F=Me(" new modal filter(s) added"),Z=oe(),K=U("p"),J=Me(q),fe=Me(`
      existing modal filter(s) removed`),Ee=oe(),ee=U("p"),ve=Me(ie),ye=Me(" road segment direction(s) changed"),it=oe(),_t&&_t.c(),Ye(p,"margin-right","2px"),Ye(u,"display","flex"),Ye(u,"align-items","center"),Ye(u,"gap","8px"),Ye(u,"color","black"),de(o,"class","outline"),Ye(o,"margin-right","8px"),de(o,"title","Download project as GeoJSON"),Ye(t,"display","flex"),Ye(t,"justify-content","space-between"),Ye(t,"align-items","center"),Ye(t,"gap","16px"),de(_,"class","navigable-list"),de(e,"slot","sidebar")},m(He,mt){G(He,e,mt),B(e,t),B(t,n),B(t,i),B(t,o),B(o,u),ae(s,u,null),B(u,d),B(u,p),B(e,g),B(e,_);for(let Pt=0;Pt<Ke.length;Pt+=1)Ke[Pt]&&Ke[Pt].m(_,null);B(_,x),B(_,C),ae(T,C,null),B(e,P),pt&&pt.m(e,null),B(e,I),B(e,E),B(E,O),B(E,F),B(e,Z),B(e,K),B(K,J),B(K,fe),B(e,Ee),B(e,ee),B(ee,ve),B(ee,ye),B(e,it),_t&&_t.m(e,null),Be=!0,Ne||(Ie=Lt(o,"click",r[18]),Ne=!0)},p(He,mt){if(mt&3597){ot=On(He[0].features);let jt;for(jt=0;jt<ot.length;jt+=1){const un=_b(He,ot,jt);Ke[jt]?(Ke[jt].p(un,mt),N(Ke[jt],1)):(Ke[jt]=vb(un),Ke[jt].c(),N(Ke[jt],1),Ke[jt].m(_,x))}for(Kt(),jt=ot.length;jt<Ke.length;jt+=1)ut(jt);Jt()}const Pt={};mt&1073741824&&(Pt.$$scope={dirty:mt,ctx:He}),T.$set(Pt),He[7]=="cnt"?pt?(pt.p(He,mt),mt&128&&N(pt,1)):(pt=bb(He),pt.c(),N(pt,1),pt.m(e,I)):pt&&(Kt(),V(pt,1,1,()=>{pt=null}),Jt()),(!Be||mt&16)&&L!==(L=He[4].modalFilters+"")&&kt(O,L),(!Be||mt&16)&&q!==(q=He[4].deletedModalFilters+"")&&kt(J,q),(!Be||mt&16)&&ie!==(ie=He[4].travelFlows+"")&&kt(ve,ie),He[8]?_t?_t.p(He,mt):(_t=wb(He),_t.c(),_t.m(e,null)):_t&&(_t.d(1),_t=null)},i(He){if(!Be){N(s.$$.fragment,He);for(let mt=0;mt<ot.length;mt+=1)N(Ke[mt]);N(T.$$.fragment,He),N(pt),Be=!0}},o(He){V(s.$$.fragment,He),Ke=Ke.filter(Boolean);for(let mt=0;mt<Ke.length;mt+=1)V(Ke[mt]);V(T.$$.fragment,He),V(pt),Be=!1},d(He){He&&H(e),le(s),_i(Ke,He),le(T),pt&&pt.d(),_t&&_t.d(),Ne=!1,Ie()}}}function C7(r){let e,t,n=(r[26].number_pois/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=oe(),i=Me(n),o=Me(" / km²")},m(u,s){G(u,e,s),G(u,t,s),G(u,i,s),G(u,o,s)},p(u,s){s&67108864&&n!==(n=(u[26].number_pois/u[26].area_km2).toFixed(1)+"")&&kt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function T7(r){let e,t,n=(r[26].number_stats19_collisions/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=oe(),i=Me(n),o=Me(" / km²")},m(u,s){G(u,e,s),G(u,t,s),G(u,i,s),G(u,o,s)},p(u,s){s&67108864&&n!==(n=(u[26].number_stats19_collisions/u[26].area_km2).toFixed(1)+"")&&kt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function M7(r){let e,t,n=Math.round(r[26].population/r[26].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=oe(),i=Me(n),o=Me(` people
            / km²`)},m(u,s){G(u,e,s),G(u,t,s),G(u,i,s),G(u,o,s)},p(u,s){s&67108864&&n!==(n=Math.round(u[26].population/u[26].area_km2).toLocaleString()+"")&&kt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function E7(r){let e,t=r[26].name+"",n,i,o;function u(p,g){if(p[1]=="density")return M7;if(p[1]=="stats19")return T7;if(p[1]=="pois")return C7}let s=u(r),d=s&&s(r);return{c(){e=U("h2"),n=Me(t),i=oe(),d&&d.c(),o=nr()},m(p,g){G(p,e,g),B(e,n),G(p,i,g),d&&d.m(p,g),G(p,o,g)},p(p,g){g&67108864&&t!==(t=p[26].name+"")&&kt(n,t),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(H(e),H(i),H(o)),d&&d.d(p)}}}function L7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[E7,({props:n})=>({26:n}),({props:n})=>n?67108864:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1140850690&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function I7(r){let e,t,n,i,o,u,s,d,p;e=new pS({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},_n("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let _={};for(let E=0;E<g.length;E+=1)_=zt(_,g[E]);n=new ur({props:_});const x=[{filter:["==",["get","kind"],"boundary"]},_n("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let C={};for(let E=0;E<x.length;E+=1)C=zt(C,x[E]);o=new ur({props:C});const T=[_n("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function P(E){r[16](E)}let I={$$slots:{default:[L7]},$$scope:{ctx:r}};for(let E=0;E<T.length;E+=1)I=zt(I,T[E]);return r[3]!==void 0&&(I.hovered=r[3]),s=new Ji({props:I}),dn.push(()=>Dn(s,"hovered",P)),s.$on("click",r[17]),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(E,L){ae(e,E,L),G(E,t,L),ae(n,E,L),G(E,i,L),ae(o,E,L),G(E,u,L),ae(s,E,L),p=!0},p(E,L){const O={};L&4&&(O.data=E[2]?[{name:E[2],highlight:"yes"}]:[]),e.$set(O);const F={};n.$set(F);const Z={};o.$set(Z);const K=L&24578?In(T,[T[0],T[1],{paint:{"fill-color":E[13](E[1]),"fill-opacity":E[14](E[1])}},T[3],T[4]]):{};L&1073741826&&(K.$$scope={dirty:L,ctx:E}),!d&&L&8&&(d=!0,K.hovered=E[3],zn(()=>d=!1)),s.$set(K)},i(E){p||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),p=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),p=!1},d(E){E&&(H(t),H(i),H(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function P7(r){let e,t,n,i,o;return t=new _r({props:{data:r[0],promoteId:"name",$$slots:{default:[I7]},$$scope:{ctx:r}}}),i=new el({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),de(e,"slot","map")},m(u,s){G(u,e,s),ae(t,e,null),B(e,n),ae(i,e,null),o=!0},p(u,s){const d={};s&1&&(d.data=u[0]),s&1073741838&&(d.$$scope={dirty:s,ctx:u}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&H(e),le(t),le(i)}}}function z7(r){let e,t;return e=new ko({props:{$$slots:{map:[P7],sidebar:[S7],top:[x7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1073742335&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function D7(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function R7(r,e,t){let n,i,o,u,s,d,p,g;ct(r,Ir,ve=>t(15,o=ve)),ct(r,Da,ve=>t(25,u=ve)),ct(r,tr,ve=>t(5,s=ve)),ct(r,$s,ve=>t(6,d=ve)),ct(r,As,ve=>t(7,p=ve)),ct(r,zf,ve=>t(8,g=ve));let _="none",x=null,C=null;ln(Da,u=void 0,u);function T(ve){o.setCurrentNeighbourhood(ve),ln(Da,u=ve,u),ln(tr,s={mode:"neighbourhood"},s)}function P(ve){window.confirm(`Really delete neighbourhood ${ve}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(ve),console.assert(!Da),qf(),t(0,n=o.getAllNeighbourhoods()))}function I(ve){let ye=G2(o,`Rename neighbourhood ${ve} to what?`,ve);ye&&(o.renameNeighbourhoodBoundary(ve,ye),ln(Da,u=ye,u),qf(),t(0,n=o.getAllNeighbourhoods()))}function E(){rp("debug_route_snapper.geojson",o.toRouteSnapperGj())}function L(ve){let ye=vo.mapFeature.hover.backgroundColor,it=Z2({none:ye},ve);return["case",["==",["feature-state","highlight"],"yes"],ye,it]}function O(ve){let ye=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],ye,er(.3,ye)],area:er(.7,.9),density:er(.7,.9),simd:er(.7,.9),stats19:er(.7,.9),pois:er(.7,.9),car_ownership:er(.7,.9)}[ve]}function F(ve){C=ve,t(3,C)}const Z=ve=>T(mr(ve.detail.features[0].properties).name),K=()=>A2(mr(d)),q=ve=>T(ve),J=ve=>I(ve),fe=ve=>P(ve),Ee=ve=>t(2,x=ve),ee=()=>t(2,x=null);function ie(ve){_=ve,t(1,_)}return r.$$.update=()=>{r.$$.dirty&32768&&t(0,n=o.getAllNeighbourhoods()),r.$$.dirty&1&&t(4,i=D7(n))},[n,_,x,C,i,s,d,p,g,T,P,I,E,L,O,o,F,Z,K,q,J,fe,Ee,ee,ie]}class B7 extends Et{constructor(e){super(),Mt(this,e,R7,z7,St,{})}}function xb(r){let e,t,n;return t=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){G(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function F7(r){let e,t,n,i,o,u,s,d,p,g,_,x=yr(r[4].mode)+"",C,T;o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}});let P=r[0]=="neighbourhood"&&xb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),P&&P.c(),g=oe(),_=U("li"),C=Me(x),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(I,E){G(I,e,E),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),P&&P.m(n,null),B(n,g),B(n,_),B(_,C),T=!0},p(I,E){I[0]=="neighbourhood"?P?E&1&&N(P,1):(P=xb(),P.c(),N(P,1),P.m(n,g)):P&&(Kt(),V(P,1,1,()=>{P=null}),Jt()),(!T||E&16)&&x!==(x=yr(I[4].mode)+"")&&kt(C,x)},i(I){T||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(P),T=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(P),T=!1},d(I){I&&H(e),le(o),le(d),P&&P.d()}}}function O7(r){let e;return{c(){e=Me("Explore the origin/destination demand data used")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function $7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z,K,q,J,fe,Ee,ee;return t=new Us({props:{mode:{mode:r[0]}}}),u=new Fn({props:{mode:{mode:"debug-demand"},$$slots:{default:[O7]},$$scope:{ctx:r}}}),q=new Vo({props:{colorScale:r[6],labels:{limits:["0%","50%","same","150%","200%"]}}}),fe=Pg(r[13][0]),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),o=Me(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),ue(u.$$.fragment),s=oe(),d=U("fieldset"),p=U("label"),g=U("input"),_=Me(`
        Calculate quickly`),x=oe(),C=U("label"),T=U("input"),P=Me(`
        Calculate more accurately`),I=oe(),E=U("p"),E.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,L=oe(),O=U("label"),F=Me(`Only show roads with at least this many daily trips before or after
      `),Z=U("input"),K=oe(),ue(q.$$.fragment),de(g,"type","radio"),g.__value="fast",Zn(g,g.__value),de(T,"type","radio"),T.__value="accurate",Zn(T,T.__value),de(Z,"type","number"),de(Z,"min",0),de(e,"slot","sidebar"),fe.p(g,T)},m(ie,ve){G(ie,e,ve),ae(t,e,null),B(e,n),B(e,i),B(i,o),ae(u,i,null),B(e,s),B(e,d),B(d,p),B(p,g),g.checked=g.__value===r[3],B(p,_),B(d,x),B(d,C),B(C,T),T.checked=T.__value===r[3],B(C,P),B(e,I),B(e,E),B(e,L),B(e,O),B(O,F),B(O,Z),Zn(Z,r[5]),B(e,K),ae(q,e,null),J=!0,Ee||(ee=[Lt(g,"change",r[12]),Lt(g,"change",r[9]),Lt(T,"change",r[14]),Lt(T,"change",r[9]),Lt(Z,"input",r[15])],Ee=!0)},p(ie,ve){const ye={};ve&1&&(ye.mode={mode:ie[0]}),t.$set(ye);const it={};ve&524288&&(it.$$scope={dirty:ve,ctx:ie}),u.$set(it),ve&8&&(g.checked=g.__value===ie[3]),ve&8&&(T.checked=T.__value===ie[3]),ve&32&&zl(Z.value)!==ie[5]&&Zn(Z,ie[5])},i(ie){J||(N(t.$$.fragment,ie),N(u.$$.fragment,ie),N(q.$$.fragment,ie),J=!0)},o(ie){V(t.$$.fragment,ie),V(u.$$.fragment,ie),V(q.$$.fragment,ie),J=!1},d(ie){ie&&H(e),le(t),le(u),le(q),fe.r(),Ee=!1,cr(ee)}}}function N7(r){let e,t;const n=[_n("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ji({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function j7(r){let e,t=r[18].before.toLocaleString()+"",n,i,o=r[18].after.toLocaleString()+"",u,s,d,p,g=Math.round(100*r[18].after/r[18].before)+"",_,x;return{c(){e=U("p"),n=Me(t),i=Me(" before, "),u=Me(o),s=Me(`
            after`),d=oe(),p=U("p"),_=Me(g),x=Me("%")},m(C,T){G(C,e,T),B(e,n),B(e,i),B(e,u),B(e,s),G(C,d,T),G(C,p,T),B(p,_),B(p,x)},p(C,T){T&262144&&t!==(t=C[18].before.toLocaleString()+"")&&kt(n,t),T&262144&&o!==(o=C[18].after.toLocaleString()+"")&&kt(u,o),T&262144&&g!==(g=Math.round(100*C[18].after/C[18].before)+"")&&kt(_,g)},d(C){C&&(H(e),H(d),H(p))}}}function U7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[j7,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function V7(r){let e,t,n,i;const o=[_n("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Td,r[2].max_count,1.5*Md],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Td,r[2].max_count,Md],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[6][0],50,r[6][1],100,r[6][2],150,r[6][3],200,r[6][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[U7]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new ur({props:d}),n.$on("click",r[11]),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&36?In(o,[o[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&4&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Td,p[2].max_count,1.5*Md],"line-color":"black"}}]):{};e.$set(_);const x=g&100?In(s,[s[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&68&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Td,p[2].max_count,Md],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[6][0],50,p[6][1],100,p[6][2],150,p[6][3],200,p[6][4]]]}},s[3],s[4]]):{};g&524288&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function q7(r){let e,t,n,i,o,u,s;return t=new _r({props:{data:r[7],$$slots:{default:[N7]},$$scope:{ctx:r}}}),i=new _r({props:{data:r[2],generateId:!0,$$slots:{default:[V7]},$$scope:{ctx:r}}}),u=new el({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),de(e,"slot","map")},m(d,p){G(d,e,p),ae(t,e,null),B(e,n),ae(i,e,null),B(e,o),ae(u,e,null),s=!0},p(d,p){const g={};p&524288&&(g.$$scope={dirty:p,ctx:d}),t.$set(g);const _={};p&4&&(_.data=d[2]),p&524324&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){s||(N(t.$$.fragment,d),N(i.$$.fragment,d),N(u.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(i.$$.fragment,d),V(u.$$.fragment,d),s=!1},d(d){d&&H(e),le(t),le(i),le(u)}}}function H7(r){let e,t,n,i;return e=new ah({props:{loading:r[1]}}),n=new ko({props:{$$slots:{map:[q7],sidebar:[$7],top:[F7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&524349&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}let Td=3,Md=10;function G7(r,e,t){let n,i,o,u;ct(r,Ym,Z=>t(10,n=Z)),ct(r,Ir,Z=>t(16,i=Z)),ct(r,tr,Z=>t(4,o=Z)),ct(r,ey,Z=>t(5,u=Z));let{prevMode:s}=e,d=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],p="",g={type:"FeatureCollection",features:[],max_count:1},_=i.getAllNeighbourhoods();function x(Z){ln(tr,o={mode:"impact-detail",road:Z,prevPrevMode:s},o)}async function C(Z){t(1,p="Calculating impact"),await new Promise(K=>{requestAnimationFrame(()=>{requestAnimationFrame(K)})}),t(2,g=i.predictImpact(Z)),t(1,p="")}let T=n?"fast":"accurate";function P(){ln(Ym,n=T=="fast",n)}const I=[[]],E=Z=>x(Z.detail.features[0]);function L(){T=this.__value,t(3,T)}function O(){T=this.__value,t(3,T)}function F(){u=zl(this.value),ey.set(u)}return r.$$set=Z=>{"prevMode"in Z&&t(0,s=Z.prevMode)},r.$$.update=()=>{r.$$.dirty&1024&&C(n)},[s,p,g,T,o,u,d,_,x,P,n,E,L,I,O,F]}class W7 extends Et{constructor(e){super(),Mt(this,e,G7,H7,St,{prevMode:0})}}function Ab(r){let e,t,n;return t=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){G(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function Z7(r){let e,t,n,i,o,u,s,d,p,g,_,x=yr(r[7].mode)+"",C,T;o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}});let P=r[0]=="neighbourhood"&&Ab();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),P&&P.c(),g=oe(),_=U("li"),C=Me(x),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(I,E){G(I,e,E),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),P&&P.m(n,null),B(n,g),B(n,_),B(_,C),T=!0},p(I,E){I[0]=="neighbourhood"?P?E&1&&N(P,1):(P=Ab(),P.c(),N(P,1),P.m(n,g)):P&&(Kt(),V(P,1,1,()=>{P=null}),Jt()),(!T||E&128)&&x!==(x=yr(I[7].mode)+"")&&kt(C,x)},i(I){T||(N(o.$$.fragment,I),N(d.$$.fragment,I),N(P),T=!0)},o(I){V(o.$$.fragment,I),V(d.$$.fragment,I),V(P),T=!1},d(I){I&&H(e),le(o),le(d),P&&P.d()}}}function X7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function K7(r){let e,t=ja(r[6].properties.distance)+"",n,i,o=Ua(r[6].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,d){G(s,e,d),B(e,n),B(e,i),B(e,u)},p(s,d){d&64&&t!==(t=ja(s[6].properties.distance)+"")&&kt(n,t),d&64&&o!==(o=Ua(s[6].properties.time)+"")&&kt(u,o)},d(s){s&&H(e)}}}function J7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function Y7(r){let e,t=ja(r[5].properties.distance)+"",n,i,o=Ua(r[5].properties.time)+"",u;return{c(){e=U("p"),n=Me(t),i=Me(", "),u=Me(o)},m(s,d){G(s,e,d),B(e,n),B(e,i),B(e,u)},p(s,d){d&32&&t!==(t=ja(s[5].properties.distance)+"")&&kt(n,t),d&32&&o!==(o=Ua(s[5].properties.time)+"")&&kt(u,o)},d(s){s&&H(e)}}}function Q7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L,O,F,Z;t=new Us({props:{mode:{mode:r[0]}}});function K(ie,ve){return ie[6]?K7:X7}let q=K(r),J=q(r);function fe(ie,ve){return ie[5]?Y7:J7}let Ee=fe(r),ee=Ee(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Drag markers for a route",o=oe(),u=U("u"),u.textContent="Route before changes",s=oe(),J.c(),d=oe(),p=U("u"),p.textContent="Route after changes",g=oe(),ee.c(),_=oe(),x=U("label"),C=Me("Slow-down factor for main roads: "),T=Me(r[2]),P=oe(),I=U("input"),E=oe(),L=U("i"),L.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ye(u,"color","red"),Ye(p,"color","blue"),de(I,"type","range"),de(I,"min","1.0"),de(I,"max","5.0"),de(I,"step","0.1"),de(e,"slot","sidebar")},m(ie,ve){G(ie,e,ve),ae(t,e,null),B(e,n),B(e,i),B(e,o),B(e,u),B(e,s),J.m(e,null),B(e,d),B(e,p),B(e,g),ee.m(e,null),B(e,_),B(e,x),B(x,C),B(x,T),B(x,P),B(x,I),Zn(I,r[2]),B(e,E),B(e,L),O=!0,F||(Z=[Lt(I,"change",r[11]),Lt(I,"input",r[11])],F=!0)},p(ie,ve){const ye={};ve&1&&(ye.mode={mode:ie[0]}),t.$set(ye),q===(q=K(ie))&&J?J.p(ie,ve):(J.d(1),J=q(ie),J&&(J.c(),J.m(e,d))),Ee===(Ee=fe(ie))&&ee?ee.p(ie,ve):(ee.d(1),ee=Ee(ie),ee&&(ee.c(),ee.m(e,_))),(!O||ve&4)&&kt(T,ie[2]),ve&4&&Zn(I,ie[2])},i(ie){O||(N(t.$$.fragment,ie),O=!0)},o(ie){V(t.$$.fragment,ie),O=!1},d(ie){ie&&H(e),le(t),J.d(),ee.d(),F=!1,cr(Z)}}}function kb(r){let e,t;return e=new ch({props:{$$slots:{default:[eD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function eD(r){let e,t,n,i,o,u,s,d;return e=new _p({}),n=new gp({}),o=new yp({}),s=new uh({props:{interactive:!1}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),G(p,i,g),ae(o,p,g),G(p,u,g),ae(s,p,g),d=!0},p:at,i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(H(t),H(i),H(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function tD(r){let e,t;const n=[_n("compare-route"),{paint:{"line-width":10,"line-color":No(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function nD(r){let e;return{c(){e=Me("A")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function rD(r){let e;return{c(){e=Me("B")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function iD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C=r[0]=="neighbourhood"&&kb(r);n=new el({props:{interactive:!1}}),o=new _r({props:{data:r[1],$$slots:{default:[tD]},$$scope:{ctx:r}}});function T(L){r[9](L)}let P={draggable:!0,$$slots:{default:[nD]},$$scope:{ctx:r}};r[4]!==void 0&&(P.lngLat=r[4]),s=new Bl({props:P}),dn.push(()=>Dn(s,"lngLat",T));function I(L){r[10](L)}let E={draggable:!0,$$slots:{default:[rD]},$$scope:{ctx:r}};return r[3]!==void 0&&(E.lngLat=r[3]),g=new Bl({props:E}),dn.push(()=>Dn(g,"lngLat",I)),{c(){e=U("div"),C&&C.c(),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),p=oe(),ue(g.$$.fragment),de(e,"slot","map")},m(L,O){G(L,e,O),C&&C.m(e,null),B(e,t),ae(n,e,null),B(e,i),ae(o,e,null),B(e,u),ae(s,e,null),B(e,p),ae(g,e,null),x=!0},p(L,O){L[0]=="neighbourhood"?C?O&1&&N(C,1):(C=kb(L),C.c(),N(C,1),C.m(e,t)):C&&(Kt(),V(C,1,1,()=>{C=null}),Jt());const F={};O&2&&(F.data=L[1]),O&4096&&(F.$$scope={dirty:O,ctx:L}),o.$set(F);const Z={};O&4096&&(Z.$$scope={dirty:O,ctx:L}),!d&&O&16&&(d=!0,Z.lngLat=L[4],zn(()=>d=!1)),s.$set(Z);const K={};O&4096&&(K.$$scope={dirty:O,ctx:L}),!_&&O&8&&(_=!0,K.lngLat=L[3],zn(()=>_=!1)),g.$set(K)},i(L){x||(N(C),N(n.$$.fragment,L),N(o.$$.fragment,L),N(s.$$.fragment,L),N(g.$$.fragment,L),x=!0)},o(L){V(C),V(n.$$.fragment,L),V(o.$$.fragment,L),V(s.$$.fragment,L),V(g.$$.fragment,L),x=!1},d(L){L&&H(e),C&&C.d(),le(n),le(o),le(s),le(g)}}}function oD(r){let e,t;return e=new ko({props:{$$slots:{map:[iD],sidebar:[Q7],top:[Z7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function sD(r,e,t){let n,i,o,u,s,d,p,g;ct(r,Y0,P=>t(2,u=P)),ct(r,Pf,P=>t(3,s=P)),ct(r,If,P=>t(4,d=P)),ct(r,Ir,P=>t(8,p=P)),ct(r,tr,P=>t(7,g=P));let{prevMode:_}=e;ks(()=>{setTimeout(()=>{eg(If),eg(Pf)},10)});function x(P){d=P,If.set(d)}function C(P){s=P,Pf.set(s)}function T(){u=zl(this.value),Y0.set(u)}return r.$$set=P=>{"prevMode"in P&&t(0,_=P.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=p.compareRoute(d,s,u)),r.$$.dirty&2&&t(6,i=n.features.find(P=>P.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(P=>P.properties.kind=="after"))},[_,n,u,s,d,o,i,g,p,x,C,T]}class aD extends Et{constructor(e){super(),Mt(this,e,sD,oD,St,{prevMode:0})}}function lD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=yr(r[2].mode)+"",P,I;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Me(T),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(E,L){G(E,e,L),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),ae(_,g,null),B(n,x),B(n,C),B(C,P),I=!0},p(E,L){(!I||L&4)&&T!==(T=yr(E[2].mode)+"")&&kt(P,T)},i(E){I||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),I=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),I=!1},d(E){E&&H(e),le(o),le(d),le(_)}}}function uD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E,L;t=new Us({props:{mode:{mode:"neighbourhood"}}});function O(K){r[8](K)}function F(K){r[9](K)}let Z={map:mr(r[3])};return r[0]!==void 0&&(Z.waypoints=r[0]),r[1]!==void 0&&(Z.drawnShapeOut=r[1]),u=new q2({props:Z}),dn.push(()=>Dn(u,"waypoints",O)),dn.push(()=>Dn(u,"drawnShapeOut",F)),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("h1"),i.textContent="Adjust boundary",o=oe(),ue(u.$$.fragment),p=oe(),g=U("div"),_=U("button"),x=Me("Finish"),T=oe(),P=U("button"),P.textContent="Cancel",_.disabled=C=r[0].length<3,de(P,"class","secondary"),Ye(g,"display","flex"),Ye(g,"gap","16px"),de(e,"slot","sidebar")},m(K,q){G(K,e,q),ae(t,e,null),B(e,n),B(e,i),B(e,o),ae(u,e,null),B(e,p),B(e,g),B(g,_),B(_,x),B(g,T),B(g,P),I=!0,E||(L=[Lt(_,"click",r[4]),Lt(P,"click",r[5])],E=!0)},p(K,q){const J={};q&8&&(J.map=mr(K[3])),!s&&q&1&&(s=!0,J.waypoints=K[0],zn(()=>s=!1)),!d&&q&2&&(d=!0,J.drawnShapeOut=K[1],zn(()=>d=!1)),u.$set(J),(!I||q&1&&C!==(C=K[0].length<3))&&(_.disabled=C)},i(K){I||(N(t.$$.fragment,K),N(u.$$.fragment,K),I=!0)},o(K){V(t.$$.fragment,K),V(u.$$.fragment,K),I=!1},d(K){K&&H(e),le(t),le(u),E=!1,cr(L)}}}function cD(r){let e,t;return e=new ko({props:{$$slots:{sidebar:[uD],top:[lD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4111&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function fD(r,e,t){let n,i,o;ct(r,tr,P=>t(2,n=P)),ct(r,Ir,P=>t(11,i=P)),ct(r,as,P=>t(3,o=P));let{name:u}=e,{existing:s}=e,d=[],p,g=s.properties.waypoints;if(!g){let P={type:"LineString",coordinates:s.geometry.coordinates[1]};g=i.extractWaypointsFromRing(P)}d=g.map(P=>({point:[P.lon,P.lat],snapped:P.snapped}));function _(){if(p)try{i.setCurrentNeighbourhoodBoundary(u,p),qf(),ln(tr,n={mode:"neighbourhood"},n)}catch(P){window.alert(`Sorry, this boundary is invalid: ${P}`),x()}}function x(){ln(tr,n={mode:"neighbourhood"},n)}function C(P){d=P,t(0,d)}function T(P){p=P,t(1,p)}return r.$$set=P=>{"name"in P&&t(6,u=P.name),"existing"in P&&t(7,s=P.existing)},[d,p,n,o,_,x,u,s,C,T]}class hD extends Et{constructor(e){super(),Mt(this,e,fD,cD,St,{name:6,existing:7})}}const dD=["==",["geometry-type"],"Polygon"],pD=["==",["geometry-type"],"LineString"],mD=["==",["geometry-type"],"Point"];function Y2(){return{type:"FeatureCollection",features:[]}}function Um(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Q2(r)}}}function Q2(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const ex=Ln(Y2()),tx=Ln(0),gD=100;class _D{constructor(e){Yn(this,"map");Yn(this,"active");Yn(this,"eventListenersSuccess");Yn(this,"eventListenersUpdated");Yn(this,"eventListenersFailure");Yn(this,"points");Yn(this,"cursor");Yn(this,"hover");Yn(this,"dragFrom");Yn(this,"previousStates");Yn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Yn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Sb(this.points).forEach((n,i)=>{t.push([i+1,d3(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Yn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Um(e.lngLat.toArray()),this.onClick(e),this.finish())});Yn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Yn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Yn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Yn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Y2();this.points.forEach((i,o)=>{let u=Um(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(Sb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),ex.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,tx.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Um(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Q2),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>gD&&this.previousStates.shift()}}function Sb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function yD(r){let e,t,n;return{c(){e=Me("Undo ("),t=Me(r[1]),n=Me(")")},m(i,o){G(i,e,o),G(i,t,o),G(i,n,o)},p(i,o){o&2&&kt(t,i[1])},d(i){i&&(H(e),H(t),H(n))}}}function vD(r){let e;return{c(){e=Me("Undo")},m(t,n){G(t,e,n)},p:at,d(t){t&&H(e)}}}function bD(r){let e,t,n,i,o,u,s,d,p,g,_;function x(P,I){return P[1]==0?vD:yD}let C=x(r),T=C(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=oe(),i=U("button"),i.textContent="Cancel",o=oe(),u=U("button"),T.c(),d=oe(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=s=r[1]==0,Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(P,I){G(P,e,I),B(e,t),B(e,n),B(e,i),B(e,o),B(e,u),T.m(u,null),G(P,d,I),G(P,p,I),g||(_=[Lt(t,"click",r[2]),Lt(i,"click",r[3]),Lt(u,"click",r[4])],g=!0)},p(P,[I]){C===(C=x(P))&&T?T.p(P,I):(T.d(1),T=C(P),T&&(T.c(),T.m(u,null))),I&2&&s!==(s=P[1]==0)&&(u.disabled=s)},i:at,o:at,d(P){P&&(H(e),H(d),H(p)),T.d(),g=!1,cr(_)}}}function wD(r,e,t){let n;ct(r,tx,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),s=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,s]}class xD extends Et{constructor(e){super(),Mt(this,e,wD,bD,St,{polygonTool:0})}}let AD=Date.now();function fh(r){return`${r}-${AD++}`}const nx=Symbol.for("svelte-maplibre");function kD(){return Yf(nx)}function Cb(r){return{subscribe:r.subscribe}}function rx({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=kD(),o=Ln(null),u=Cb(o),s={...i,[r]:Cb(o)};if(e&&(s.popupTarget=u),n){let d=Ln(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=Ln()),np(nx,s),{...i,self:o}}function SD(){return rx({key:"source",setCluster:!0})}function CD(r=!0){return rx({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Tb(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function TD(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function MD(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Mb(r){let e=r[0],t,n,i=Eb(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),G(o,t,u),n=!0},p(o,u){u[0]&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=Eb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function Eb(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function ED(r){let e,t,n=r[0]&&Mb(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Mb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function LD(r,e,t){let n,i,o,u,s,d,p,g,_,x,C,T,{$$slots:P={},$$scope:I}=e,{id:E=fh("layer")}=e,{source:L=void 0}=e,{sourceLayer:O=void 0}=e,{beforeId:F=void 0}=e,{beforeLayerType:Z=void 0}=e,{type:K}=e,{paint:q=void 0}=e,{layout:J=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:Ee=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:ie=void 0}=e,{manageHoverState:ve=!1}=e,{hovered:ye=null}=e,{interactive:it=!0}=e,{hoverCursor:Be=void 0}=e,{eventsIfTopMost:Ne=!1}=e;const Ie=js(),{map:ot,source:Ke,self:ut,minzoom:pt,maxzoom:_t,eventTopMost:He,layerInfo:mt}=CD();ct(r,ot,qe=>t(31,_=qe)),ct(r,Ke,qe=>t(32,x=qe)),ct(r,ut,qe=>t(0,g=qe)),ct(r,pt,qe=>t(34,T=qe)),ct(r,_t,qe=>t(33,C=qe)),ri(()=>{g&&_&&(mt.delete(g),_==null||_.removeLayer(g))});let Pt;function jt(qe){var he,cn;if(!it||!g||!_||Ne&&He(qe)!==g)return;let Ge=qe.features??[],At=(cn=(he=Ge[0])==null?void 0:he.properties)==null?void 0:cn.cluster_id,tt={event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge};Ie(qe.type,tt)}function un(qe){var he,cn;if(!it||!g||!_||Ne&&He(qe)!==g)return;Be&&(_.getCanvas().style.cursor=Be);let Ge=qe.features??[];t(6,ye=Ge[0]??null);let At=(cn=(he=Ge[0])==null?void 0:he.properties)==null?void 0:cn.cluster_id;Ie("mouseenter",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function nn(qe){var he,cn,Xe;if(!it||!_)return;if(Ne&&He(qe)!==g){t(6,ye=null),ve&&Pt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:O,id:Pt},{hover:!1}),Pt=void 0);return}_.getCanvas().style.cursor=Be;let Ge=qe.features??[],At=(cn=(he=Ge[0])==null?void 0:he.properties)==null?void 0:cn.cluster_id,tt=(Xe=Ge[0])==null?void 0:Xe.id;tt!==Pt&&(ve&&(Pt!==void 0&&(_==null||_.setFeatureState({source:s,id:Pt,sourceLayer:O},{hover:!1})),_==null||_.setFeatureState({source:s,id:tt,sourceLayer:O},{hover:!0})),Pt=tt,t(6,ye=Ge[0]??null)),Ie("mousemove",{event:qe,map:_,clusterId:At,layer:g,source:s,features:Ge})}function rn(qe){if(!(!it||!g||!_)){if(Be&&(_.getCanvas().style.cursor=""),t(6,ye=null),ve&&Pt!==void 0){const Ge={source:s,id:Pt,sourceLayer:O};_==null||_.setFeatureState(Ge,{hover:!1}),Pt=void 0}Ie("mouseleave",{map:_,layer:g,source:s})}}let pn=!0;function yn(qe){_&&(_.off("click",qe,jt),_.off("dblclick",qe,jt),_.off("contextmenu",qe,jt),_.off("mouseenter",qe,un),_.off("mousemove",qe,nn),_.off("mouseleave",qe,rn))}return ri(()=>{_&&g&&yn(g)}),r.$$set=qe=>{"id"in qe&&t(7,E=qe.id),"source"in qe&&t(8,L=qe.source),"sourceLayer"in qe&&t(9,O=qe.sourceLayer),"beforeId"in qe&&t(10,F=qe.beforeId),"beforeLayerType"in qe&&t(11,Z=qe.beforeLayerType),"type"in qe&&t(12,K=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,J=qe.layout),"filter"in qe&&t(15,fe=qe.filter),"applyToClusters"in qe&&t(16,Ee=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,ie=qe.maxzoom),"manageHoverState"in qe&&t(19,ve=qe.manageHoverState),"hovered"in qe&&t(6,ye=qe.hovered),"interactive"in qe&&t(20,it=qe.interactive),"hoverCursor"in qe&&t(21,Be=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,Ne=qe.eventsIfTopMost),"$$scope"in qe&&t(35,I=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=MD(Ee)),r.$$.dirty[0]&1073774592&&t(24,i=TD("all",n,fe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=ie??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=L||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==E&&s){g&&(yn(g),mt.delete(g));let qe=F;if(!F&&Z){let Ge=_.getStyle().layers,At=typeof Z=="function"?Z:he=>he.type===Z,tt=Ge==null?void 0:Ge.find(At);tt&&(qe=tt.id)}ln(ut,g=E,g),_.addLayer(Na({id:g,type:K,source:s,"source-layer":O,filter:i,paint:q,layout:J,minzoom:o,maxzoom:u}),qe),t(23,pn=!0),_.on("click",g,jt),_.on("dblclick",g,jt),_.on("contextmenu",g,jt),_.on("mouseenter",g,un),_.on("mousemove",g,nn),_.on("mouseleave",g,rn)}r.$$.dirty[0]&1048577&&g&&mt.set(g,{interactive:it}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Tb((qe,Ge)=>_==null?void 0:_.setPaintProperty(g,qe,Ge)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Tb((qe,Ge)=>_==null?void 0:_.setLayoutProperty(g,qe,Ge)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(q)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(pn?t(23,pn=!1):_==null||_.setFilter(g,i))},[g,ot,Ke,ut,pt,_t,ye,E,L,O,F,Z,K,q,J,fe,Ee,ee,ie,ve,it,Be,Ne,pn,i,u,o,p,d,s,n,_,x,C,T,I,P]}class h_ extends Et{constructor(e){super(),Mt(this,e,LD,ED,St,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function ID(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function PD(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[ID]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new h_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function zD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=fh("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:I=void 0}=e,{manageHoverState:E=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:F=!0}=e;function Z(ie){L=ie,t(0,L)}function K(ie){Pn.call(this,r,ie)}function q(ie){Pn.call(this,r,ie)}function J(ie){Pn.call(this,r,ie)}function fe(ie){Pn.call(this,r,ie)}function Ee(ie){Pn.call(this,r,ie)}function ee(ie){Pn.call(this,r,ie)}return r.$$set=ie=>{"id"in ie&&t(1,o=ie.id),"source"in ie&&t(2,u=ie.source),"sourceLayer"in ie&&t(3,s=ie.sourceLayer),"beforeId"in ie&&t(4,d=ie.beforeId),"beforeLayerType"in ie&&t(5,p=ie.beforeLayerType),"paint"in ie&&t(6,g=ie.paint),"layout"in ie&&t(7,_=ie.layout),"filter"in ie&&t(8,x=ie.filter),"applyToClusters"in ie&&t(9,C=ie.applyToClusters),"minzoom"in ie&&t(10,T=ie.minzoom),"maxzoom"in ie&&t(11,P=ie.maxzoom),"hoverCursor"in ie&&t(12,I=ie.hoverCursor),"manageHoverState"in ie&&t(13,E=ie.manageHoverState),"hovered"in ie&&t(0,L=ie.hovered),"eventsIfTopMost"in ie&&t(14,O=ie.eventsIfTopMost),"interactive"in ie&&t(15,F=ie.interactive),"$$scope"in ie&&t(24,i=ie.$$scope)},[L,o,u,s,d,p,g,_,x,C,T,P,I,E,O,F,n,Z,K,q,J,fe,Ee,ee,i]}class DD extends Et{constructor(e){super(),Mt(this,e,zD,PD,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function RD(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function BD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[RD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new h_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function FD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=fh("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:I=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:O=!0}=e;function F(ee){E=ee,t(0,E)}function Z(ee){Pn.call(this,r,ee)}function K(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,I=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,L=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,P,I,L,O,n,F,Z,K,q,J,fe,Ee,i]}class OD extends Et{constructor(e){super(),Mt(this,e,FD,BD,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function $D(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function ND(r,e,t){Yb().then(()=>{let n=gi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Lb(r){let e=r[0],t,n,i=Ib(r);return{c(){i.c(),t=nr()},m(o,u){i.m(o,u),G(o,t,u),n=!0},p(o,u){u&1&&St(e,e=o[0])?(Kt(),V(i,1,1,at),Jt(),i=Ib(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function Ib(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function jD(r){let e,t,n=r[0]&&Lb(r);return{c(){n&&n.c(),e=nr()},m(i,o){n&&n.m(i,o),G(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Lb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function UD(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=fh("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e;const{map:P,cluster:I,self:E}=SD();ct(r,P,F=>t(13,i=F)),ct(r,I,F=>t(16,o=F)),ct(r,E,F=>t(0,n=F));let L,O=!0;return ri(()=>{n&&L&&i&&(ND(P,n,L),ln(E,n=null,n),t(11,L=void 0))}),r.$$set=F=>{"id"in F&&t(4,d=F.id),"data"in F&&t(5,p=F.data),"generateId"in F&&t(6,g=F.generateId),"promoteId"in F&&t(7,_=F.promoteId),"filter"in F&&t(8,x=F.filter),"lineMetrics"in F&&t(9,C=F.lineMetrics),"cluster"in F&&t(10,T=F.cluster),"$$scope"in F&&t(14,s=F.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ln(I,o=T,o),r.$$.dirty&12273&&i&&n!==d&&(ln(E,n=d,n),$D(i,n,Na({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties}),F=>i&&F===n,()=>{n&&(t(11,L=i==null?void 0:i.getSource(n)),t(12,O=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,L=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&L&&(O?t(12,O=!1):L.setData(p)),r.$$.dirty&3072&&(L==null||L.setClusterOptions(Na({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,P,I,E,d,p,g,_,x,C,T,L,O,i,s,u]}class VD extends Et{constructor(e){super(),Mt(this,e,UD,jD,St,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function qD(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function HD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[qD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new h_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function GD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=fh("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:I=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:O=!0}=e;function F(ee){E=ee,t(0,E)}function Z(ee){Pn.call(this,r,ee)}function K(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function J(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Ee(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,T=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,I=ee.manageHoverState),"hovered"in ee&&t(0,E=ee.hovered),"eventsIfTopMost"in ee&&t(13,L=ee.eventsIfTopMost),"interactive"in ee&&t(14,O=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,P,I,L,O,n,F,Z,K,q,J,fe,Ee,i]}class WD extends Et{constructor(e){super(),Mt(this,e,GD,HD,St,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function ZD(r){let e,t,n,i,o,u;return e=new OD({props:{id:"edit-polygon-fill",filter:dD,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new WD({props:{id:"edit-polygon-lines",filter:pD,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new DD({props:{id:"edit-polygon-vertices",filter:mD,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment)},m(s,d){ae(e,s,d),G(s,t,d),ae(n,s,d),G(s,i,d),ae(o,s,d),u=!0},p:at,i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(H(t),H(i)),le(e,s),le(n,s),le(o,s)}}}function XD(r){let e,t;return e=new VD({props:{data:r[0],$$slots:{default:[ZD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function KD(r,e,t){let n;return ct(r,ex,i=>t(0,n=i)),[n]}class JD extends Et{constructor(e){super(),Mt(this,e,KD,XD,St,{})}}function YD(r){let e,t,n,i,o,u,s;return{c(){e=U("button"),e.textContent="Import current view",t=oe(),n=U("i"),n.textContent="or...",i=oe(),o=U("button"),o.textContent="Draw an area to import on the map",de(e,"type","button"),de(o,"type","button")},m(d,p){G(d,e,p),G(d,t,p),G(d,n,p),G(d,i,p),G(d,o,p),u||(s=[Lt(e,"click",r[2]),Lt(o,"click",r[3])],u=!0)},p:at,i:at,o:at,d(d){d&&(H(e),H(t),H(n),H(i),H(o)),u=!1,cr(s)}}}function QD(r){let e,t;return e=new xD({props:{polygonTool:r[0]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function eR(r){let e,t,n,i,o,u,s,d,p;const g=[QD,YD],_=[];function x(C,T){return C[0]?0:1}return e=x(r),t=_[e]=g[e](r),{c(){t.c(),n=oe(),i=U("label"),o=U("input"),u=Me(`Save a copy of the osm.xml
  after importing`),de(o,"type","checkbox")},m(C,T){_[e].m(C,T),G(C,n,T),G(C,i,T),B(i,o),o.checked=r[1],B(i,u),s=!0,d||(p=Lt(o,"change",r[5]),d=!0)},p(C,[T]){let P=e;e=x(C),e===P?_[e].p(C,T):(Kt(),V(_[P],1,1,()=>{_[P]=null}),Jt(),t=_[e],t?t.p(C,T):(t=_[e]=g[e](C),t.c()),N(t,1),t.m(n.parentNode,n)),T&2&&(o.checked=C[1])},i(C){s||(N(t),s=!0)},o(C){V(t),s=!1},d(C){C&&(H(n),H(i)),_[e].d(C),d=!1,p()}}}function bf(r){return[r.lng,r.lat]}function tR(r,e,t){let{map:n}=e;const i=js();let o=null,u=!1;async function s(x){try{i("loading","Loading from Overpass");let T=await(await fetch(ix(x))).text();u&&rp("osm.xml",T),i("gotXml",{xml:T,boundary:x})}catch(C){i("error",C.toString())}}function d(){let x=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[bf(x.getSouthWest()),bf(x.getNorthWest()),bf(x.getNorthEast()),bf(x.getSouthEast()),bf(x.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await s(d())}}function g(){n&&(t(0,o=new _D(n)),o.startNew(),o.addEventListenerSuccess(async x=>{t(0,o=null),await s(x)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function _(){u=this.checked,t(1,u)}return r.$$set=x=>{"map"in x&&t(4,n=x.map)},[o,u,p,g,n,_]}class nR extends Et{constructor(e){super(),Mt(this,e,tR,eR,St,{map:4})}}function ix(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class ox{constructor(e,t,n,i,o,u,s,d){Yn(this,"inner");this.inner=new sI(e,t||new Uint8Array,n||new Uint8Array,i,o,u,s,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setCurrentNeighbourhoodBoundary(e,t){this.inner.setCurrentNeighbourhoodBoundary(e,t)}extractWaypointsFromRing(e){let t=this.inner.extractWaypointsFromRing(e);return JSON.parse(t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}reclassifyRoadsAlongLine(e,t,n){this.inner.reclassifyRoadsAlongLine(e,t,n)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=t1(t.properties.counts_from),t.properties.sum_to=t1(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}}async function vp(r){let e=gi(Wa).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await rR(e);console.timeEnd("get input files"),console.time("load"),Ir.set(new ox(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),gi(Ir).loadSavefile(e),$s.set(r),console.timeEnd("load"),sx(r)}catch(t){window.alert(`Couldn't open project: ${t}`),$s.set(void 0)}}async function rR(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=$o(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await za(e)).arrayBuffer(),i=$o(`cnt_boundaries/${r.study_area_name}.geojson`),u=await(await za(i)).json(),s=$o(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${s}`);let d;try{d=await(await za(s)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let p=$o(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let g;try{g=await(await za(p)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:n,boundary:u,demandBuffer:d,contextDataBuffer:g}}else if(r.study_area_name){let e=$o(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await za(e)).arrayBuffer(),i=$o(`boundaries/${r.study_area_name}.geojson`),u=await(await za(i)).json();return{osmBuffer:n,boundary:u}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await za(ix(e))).arrayBuffer(),boundary:e}}}function sx(r){tp.set(new m3(gi(as),gi(Ir).toRouteSnapper(),Ln(Qi()),Ln(!0),Ln(0))),gi(as).fitBounds(gi(Ir).getBounds(),{duration:500});let e=new URL(window.location.href);e.searchParams.set("project",r),window.history.replaceState(null,"",e.toString())}function Pb(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function zb(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function iR(r){let e,t,n,i,o,u,s,d=yr(r[5].mode)+"",p,g;return o=new Fn({props:{mode:{mode:"title"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),p=Me(d),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(_,x){G(_,e,x),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),B(s,p),g=!0},p(_,x){(!g||x&32)&&d!==(d=yr(_[5].mode)+"")&&kt(p,d)},i(_){g||(N(o.$$.fragment,_),g=!0)},o(_){V(o.$$.fragment,_),g=!1},d(_){_&&H(e),le(o)}}}function Db(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T;e=new ah({props:{loading:r[4]}});let P=On(r[3]),I=[];for(let E=0;E<P.length;E+=1)I[E]=Bb(Pb(r,P,E));return _=new nR({props:{map:r[6]}}),_.$on("gotXml",r[7]),_.$on("loading",r[11]),_.$on("error",r[12]),{c(){ue(e.$$.fragment),t=oe(),n=U("label"),i=Me(`Load a built-in area:
        `),o=U("select"),u=U("option");for(let E=0;E<I.length;E+=1)I[E].c();s=oe(),d=U("i"),d.textContent="or...",p=oe(),g=U("div"),ue(_.$$.fragment),u.__value="",Zn(u,u.__value),r[2]===void 0&&ys(()=>r[9].call(o))},m(E,L){ae(e,E,L),G(E,t,L),G(E,n,L),B(n,i),B(n,o),B(o,u);for(let O=0;O<I.length;O+=1)I[O]&&I[O].m(o,null);Xi(o,r[2],!0),G(E,s,L),G(E,d,L),G(E,p,L),G(E,g,L),ae(_,g,null),x=!0,C||(T=[Lt(o,"change",r[9]),Lt(o,"change",r[10])],C=!0)},p(E,L){const O={};if(L&16&&(O.loading=E[4]),e.$set(O),L&8){P=On(E[3]);let Z;for(Z=0;Z<P.length;Z+=1){const K=Pb(E,P,Z);I[Z]?I[Z].p(K,L):(I[Z]=Bb(K),I[Z].c(),I[Z].m(o,null))}for(;Z<I.length;Z+=1)I[Z].d(1);I.length=P.length}L&12&&Xi(o,E[2]);const F={};L&64&&(F.map=E[6]),_.$set(F)},i(E){x||(N(e.$$.fragment,E),N(_.$$.fragment,E),x=!0)},o(E){V(e.$$.fragment,E),V(_.$$.fragment,E),x=!1},d(E){E&&(H(t),H(n),H(s),H(d),H(p),H(g)),le(e,E),_i(I,E),le(_),C=!1,cr(T)}}}function Rb(r){let e,t=r[22]+"",n,i;return{c(){e=U("option"),n=Me(t),e.__value=i=r[21],Zn(e,e.__value)},m(o,u){G(o,e,u),B(e,n)},p(o,u){u&8&&t!==(t=o[22]+"")&&kt(n,t),u&8&&i!==(i=o[21])&&(e.__value=i,Zn(e,e.__value))},d(o){o&&H(e)}}}function Bb(r){let e,t,n=On(r[18]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Rb(zb(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();de(e,"label",t=r[17])},m(o,u){G(o,e,u);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(e,null)},p(o,u){if(u&8){n=On(o[18]);let s;for(s=0;s<n.length;s+=1){const d=zb(o,n,s);i[s]?i[s].p(d,u):(i[s]=Rb(d),i[s].c(),i[s].m(e,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}u&8&&t!==(t=o[17])&&de(e,"label",t)},d(o){o&&H(e),_i(i,o)}}}function oR(r){let e,t,n,i,o,u,s,d,p,g=r[1]&&Db(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=Me(`Project name:
        `),o=U("input"),u=oe(),g&&g.c(),de(o,"type","text"),de(e,"slot","sidebar")},m(_,x){G(_,e,x),B(e,t),B(t,n),B(n,i),B(n,o),Zn(o,r[1]),B(e,u),g&&g.m(e,null),s=!0,d||(p=Lt(o,"input",r[8]),d=!0)},p(_,x){x&2&&o.value!==_[1]&&Zn(o,_[1]),_[1]?g?(g.p(_,x),x&2&&N(g,1)):(g=Db(_),g.c(),N(g,1),g.m(e,null)):g&&(Kt(),V(g,1,1,()=>{g=null}),Jt())},i(_){s||(N(g),s=!0)},o(_){V(g),s=!1},d(_){_&&H(e),g&&g.d(),d=!1,p()}}}function sR(r){let e,t,n;return t=new JD({}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","map")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function aR(r){let e,t;return e=new ko({props:{$$slots:{map:[sR],sidebar:[oR],top:[iR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&33554558&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function lR(r,e,t){let n,i,o,u,s,d;ct(r,tr,F=>t(5,n=F)),ct(r,Wa,F=>t(13,i=F)),ct(r,$s,F=>t(14,o=F)),ct(r,Ir,F=>t(15,u=F)),ct(r,As,F=>t(16,s=F)),ct(r,as,F=>t(6,d=F));let p="",g=null,_=[],x="";ks(async()=>{let F=await za($o("severance_pbfs/areas.json"));t(3,_=await F.json())});async function C(F){t(4,x="Loading OSM");try{let Z;ln(Ir,u=new ox(new TextEncoder().encode(F.detail.xml),void 0,void 0,F.detail.boundary,s,Z,p,i.dbSchemaVersion),u);const K=i.createProject(u.toSavefile());ln($s,o=K,o),sx(K),ln(tr,n={mode:"add-neighbourhood"},n)}catch(Z){window.alert(`Couldn't import from Overpass: ${Z}`)}t(4,x="")}async function T(){if(!g)return;let F;try{F=i.createEmptyProject(p,g)}catch(Z){t(2,g=null),window.alert(`Couldn't create project: ${Z}`);return}t(4,x=`Loading pre-clipped OSM area ${g}`),await vp(F),ln(tr,n={mode:"add-neighbourhood"},n),t(4,x="")}function P(){p=this.value,t(1,p)}function I(){g=Ba(this),t(2,g),t(3,_)}return[T,p,g,_,x,n,d,C,P,I,()=>T(),F=>t(4,x=F.detail),F=>window.alert(F.detail)]}class uR extends Et{constructor(e){super(),Mt(this,e,lR,aR,St,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const cR="/ltn/assets/boundaries-2701bb3b.geojson";function Fb(r,e,t){const n=r.slice();return n[9]=e[t],n}function fR(r){let e=r[9]+"",t;return{c(){t=Me(e)},m(n,i){G(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&kt(t,e)},d(n){n&&H(t)}}}function Ob(r){let e,t,n;function i(){return r[5](r[9])}return t=new sh({props:{$$slots:{default:[fR]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),ue(t.$$.fragment)},m(o,u){G(o,e,u),ae(t,e,null),n=!0},p(o,u){r=o;const s={};u&4098&&(s.$$scope={dirty:u,ctx:r}),t.$set(s)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&H(e),le(t)}}}function hR(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=Me("Click to start a new project in "),i=Me(n)},m(o,u){G(o,e,u),B(e,t),B(e,i)},p(o,u){u&256&&n!==(n=o[8].name+"")&&kt(i,n)},d(o){o&&H(e)}}}function dR(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[hR,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function pR(r){let e,t,n,i;return e=new Ji({props:{paint:{"fill-color":vo.mapFeature.hover.backgroundColor,"fill-outline-color":vo.mapFeature.hover.backgroundColor,"fill-opacity":er(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[dR]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new ur({props:{paint:{"line-color":vo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&4096&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function mR(r){let e,t,n,i,o,u,s=On(r[1]),d=[];for(let g=0;g<s.length;g+=1)d[g]=Ob(Fb(r,s,g));const p=g=>V(d[g],1,1,()=>{d[g]=null});return o=new _r({props:{data:r[0],generateId:!0,$$slots:{default:[pR]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=oe(),n=U("ul");for(let g=0;g<d.length;g+=1)d[g].c();i=oe(),ue(o.$$.fragment),Ye(n,"columns","3")},m(g,_){G(g,e,_),G(g,t,_),G(g,n,_);for(let x=0;x<d.length;x+=1)d[x]&&d[x].m(n,null);G(g,i,_),ae(o,g,_),u=!0},p(g,[_]){if(_&10){s=On(g[1]);let C;for(C=0;C<s.length;C+=1){const T=Fb(g,s,C);d[C]?(d[C].p(T,_),N(d[C],1)):(d[C]=Ob(T),d[C].c(),N(d[C],1),d[C].m(n,null))}for(Kt(),C=s.length;C<d.length;C+=1)p(C);Jt()}const x={};_&1&&(x.data=g[0]),_&4096&&(x.$$scope={dirty:_,ctx:g}),o.$set(x)},i(g){if(!u){for(let _=0;_<s.length;_+=1)N(d[_]);N(o.$$.fragment,g),u=!0}},o(g){d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)V(d[_]);V(o.$$.fragment,g),u=!1},d(g){g&&(H(e),H(t),H(n),H(i)),_i(d,g),le(o,g)}}}function gR(r,e,t){let n,i;ct(r,tr,_=>t(6,n=_)),ct(r,Wa,_=>t(7,i=_));let{activityIndicatorText:o}=e,u={type:"FeatureCollection",features:[]},s=[];ks(async()=>{let _=await fetch(cR);t(0,u=await _.json());for(let x of u.features)s.push(x.properties.name);s.sort(),t(1,s)});function d(_){let x=_.detail.features[0].properties;p(`${x.kind}_${x.name}`)}async function p(_){let x,C=!1;for(;!C;){let T=x||i.nextAvailableProjectName(Of(_));if(x=window.prompt(`Please pick a project name to create in ${Of(_)}`,T),x===null)return;if(x=x.trim(),x===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${Of(_)}`);try{let P=i.createEmptyProject(x,_);await vp(P),ln(tr,n={mode:"add-neighbourhood"},n),C=!0}catch(P){window.alert(P)}t(4,o="")}}const g=_=>p(`LAD_${_}`);return r.$$set=_=>{"activityIndicatorText"in _&&t(4,o=_.activityIndicatorText)},[u,s,d,p,o,g]}class _R extends Et{constructor(e){super(),Mt(this,e,gR,mR,St,{activityIndicatorText:4})}}function yR(r){let e,t,n,i,o,u;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=oe(),i=U("input"),de(i,"type","file"),Ye(e,"margin-top","16px")},m(s,d){G(s,e,d),B(e,t),B(e,n),B(e,i),r[3](i),o||(u=Lt(i,"change",r[1]),o=!0)},p:at,i:at,o:at,d(s){s&&H(e),r[3](null),o=!1,u()}}}function vR(r,e,t){let n;ct(r,tr,d=>t(4,n=d));let{loading:i}=e,o;async function u(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let g=await o.files[0].text(),_=JSON.parse(g),x,C,T;_.app_focus&&(console.assert(_.app_focus=="global"||_.app_focus=="cnt"),x=_.app_focus),_.study_area_name&&(C=_.study_area_name),_.project_name&&(T=_.project_name),(!_.app_focus||!_.project_name)&&(_.study_area_name&&_.study_area_name.startsWith("LAD_")?(x="cnt",T=n1(cg(p,`ltn_cnt_${_.study_area_name}_`),".geojson")):(x="global",T=n1(cg(p,"ltn_"),".geojson"))),T=T,x=x;let P=Sw.projectStorage(x);T=P.nextAvailableProjectName(T),_.project_name=T,_.app_focus=x,_.study_area_name=C;let I=P.createProject(_);await vp(I),ln(tr,n={mode:"pick-neighbourhood"},n),t(2,i="")}function s(d){dn[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,u,i,s]}class bR extends Et{constructor(e){super(),Mt(this,e,vR,yR,St,{loading:2})}}function $b(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function Nb(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function wR(r){let e,t,n,i,o=yr(r[3].mode)+"",u;return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),u=Me(o),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(s,d){G(s,e,d),B(e,t),B(t,n),B(n,i),B(i,u)},p(s,d){d&8&&o!==(o=yr(s[3].mode)+"")&&kt(u,o)},d(s){s&&H(e)}}}function xR(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){G(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}function AR(r){let e,t,n,i,o,u,s,d,p,g=r[2].length>0&&jb(r);const _=[CR,SR],x=[];function C(I,E){return I[5]=="global"?0:I[5]=="cnt"?1:-1}~(i=C(r))&&(o=x[i]=_[i](r));function T(I){r[15](I)}let P={};return r[1]!==void 0&&(P.loading=r[1]),s=new bR({props:P}),dn.push(()=>Dn(s,"loading",T)),{c(){g&&g.c(),e=oe(),t=U("h1"),t.textContent="Start a new project",n=oe(),o&&o.c(),u=oe(),ue(s.$$.fragment)},m(I,E){g&&g.m(I,E),G(I,e,E),G(I,t,E),G(I,n,E),~i&&x[i].m(I,E),G(I,u,E),ae(s,I,E),p=!0},p(I,E){I[2].length>0?g?(g.p(I,E),E&4&&N(g,1)):(g=jb(I),g.c(),N(g,1),g.m(e.parentNode,e)):g&&(Kt(),V(g,1,1,()=>{g=null}),Jt());let L=i;i=C(I),i===L?~i&&x[i].p(I,E):(o&&(Kt(),V(x[L],1,1,()=>{x[L]=null}),Jt()),~i?(o=x[i],o?o.p(I,E):(o=x[i]=_[i](I),o.c()),N(o,1),o.m(u.parentNode,u)):o=null);const O={};!d&&E&2&&(d=!0,O.loading=I[1],zn(()=>d=!1)),s.$set(O)},i(I){p||(N(g),N(o),N(s.$$.fragment,I),p=!0)},o(I){V(g),V(o),V(s.$$.fragment,I),p=!1},d(I){I&&(H(e),H(t),H(n),H(u)),g&&g.d(I),~i&&x[i].d(I),le(s,I)}}}function jb(r){let e,t,n,i,o=On(r[2]),u=[];for(let d=0;d<o.length;d+=1)u[d]=Vb($b(r,o,d));const s=d=>V(u[d],1,1,()=>{u[d]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=oe(),n=U("div");for(let d=0;d<u.length;d+=1)u[d].c();de(n,"class","project-list svelte-s5f8l2")},m(d,p){G(d,e,p),G(d,t,p),G(d,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(d,p){if(p&452){o=On(d[2]);let g;for(g=0;g<o.length;g+=1){const _=$b(d,o,g);u[g]?(u[g].p(_,p),N(u[g],1)):(u[g]=Vb(_),u[g].c(),N(u[g],1),u[g].m(n,null))}for(Kt(),g=o.length;g<u.length;g+=1)s(g);Jt()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)N(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)V(u[p]);i=!1},d(d){d&&(H(e),H(t),H(n)),_i(u,d)}}}function kR(r){let e=r[27]+"",t;return{c(){t=Me(e)},m(n,i){G(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&kt(t,e)},d(n){n&&H(t)}}}function Ub(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I;function E(){return r[9](r[26],r[27])}n=new sh({props:{$$slots:{default:[kR]},$$scope:{ctx:r}}}),n.$on("click",E),s=new Cw({props:{color:"black"}});function L(){return r[10](r[26])}g=new Vg({props:{color:"black"}});function O(){return r[11](r[26],r[27])}C=new qg({props:{color:"white"}});function F(){return r[12](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),ue(n.$$.fragment),i=oe(),o=U("span"),u=U("button"),ue(s.$$.fragment),d=oe(),p=U("button"),ue(g.$$.fragment),_=oe(),x=U("button"),ue(C.$$.fragment),de(u,"class","outline icon-btn"),de(u,"title","Download project as GeoJSON"),de(p,"class","outline icon-btn"),de(p,"title","Rename project"),de(x,"class","icon-btn destructive"),de(x,"title","Delete project"),de(o,"class","actions"),de(e,"class","actionable-cell svelte-s5f8l2")},m(Z,K){G(Z,e,K),B(e,t),ae(n,t,null),B(e,i),B(e,o),B(o,u),ae(s,u,null),B(o,d),B(o,p),ae(g,p,null),B(o,_),B(o,x),ae(C,x,null),T=!0,P||(I=[Lt(u,"click",L),Lt(p,"click",O),Lt(x,"click",F)],P=!0)},p(Z,K){r=Z;const q={};K&1073741828&&(q.$$scope={dirty:K,ctx:r}),n.$set(q)},i(Z){T||(N(n.$$.fragment,Z),N(s.$$.fragment,Z),N(g.$$.fragment,Z),N(C.$$.fragment,Z),T=!0)},o(Z){V(n.$$.fragment,Z),V(s.$$.fragment,Z),V(g.$$.fragment,Z),V(C.$$.fragment,Z),T=!1},d(Z){Z&&H(e),le(n),le(s),le(g),le(C),P=!1,cr(I)}}}function Vb(r){let e,t=Of(r[22])+"",n,i,o,u,s,d=On(r[23]),p=[];for(let _=0;_<d.length;_+=1)p[_]=Ub(Nb(r,d,_));const g=_=>V(p[_],1,1,()=>{p[_]=null});return{c(){e=U("h2"),n=Me(t),i=oe(),o=U("ul");for(let _=0;_<p.length;_+=1)p[_].c();u=oe(),de(e,"class","study-area-name svelte-s5f8l2"),de(o,"class","navigable-list")},m(_,x){G(_,e,x),B(e,n),G(_,i,x),G(_,o,x);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(o,null);B(o,u),s=!0},p(_,x){if((!s||x&4)&&t!==(t=Of(_[22])+"")&&kt(n,t),x&452){d=On(_[23]);let C;for(C=0;C<d.length;C+=1){const T=Nb(_,d,C);p[C]?(p[C].p(T,x),N(p[C],1)):(p[C]=Ub(T),p[C].c(),N(p[C],1),p[C].m(o,u))}for(Kt(),C=d.length;C<p.length;C+=1)g(C);Jt()}},i(_){if(!s){for(let x=0;x<d.length;x+=1)N(p[x]);s=!0}},o(_){p=p.filter(Boolean);for(let x=0;x<p.length;x+=1)V(p[x]);s=!1},d(_){_&&(H(e),H(i),H(o)),_i(p,_)}}}function SR(r){let e,t,n;function i(u){r[14](u)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new _R({props:o}),dn.push(()=>Dn(e,"activityIndicatorText",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};!t&&s&2&&(t=!0,d.activityIndicatorText=u[1],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function CR(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){G(i,e,o),t||(n=Lt(e,"click",r[13]),t=!0)},p:at,i:at,o:at,d(i){i&&H(e),t=!1,n()}}}function TR(r){let e,t,n,i;const o=[AR,xR],u=[];function s(d,p){return d[4]&&d[0]?0:1}return t=s(r),n=u[t]=o[t](r),{c(){e=U("div"),n.c(),de(e,"slot","sidebar")},m(d,p){G(d,e,p),u[t].m(e,null),i=!0},p(d,p){let g=t;t=s(d),t===g?u[t].p(d,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Jt(),n=u[t],n?n.p(d,p):(n=u[t]=o[t](d),n.c()),N(n,1),n.m(e,null))},i(d){i||(N(n),i=!0)},o(d){V(n),i=!1},d(d){d&&H(e),u[t].d()}}}function MR(r){let e,t,n,i;return e=new ah({props:{loading:r[1]}}),n=new ko({props:{$$slots:{sidebar:[TR],top:[wR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&1073741887&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function ER(r,e,t){let n,i,o,u,s,d,p,g;ct(r,tr,fe=>t(3,n=fe)),ct(r,Wa,fe=>t(16,i=fe)),ct(r,as,fe=>t(4,o=fe)),ct(r,As,fe=>t(5,u=fe)),ct(r,J0,fe=>t(17,s=fe)),ct(r,$s,fe=>t(18,d=fe)),ct(r,tp,fe=>t(19,p=fe)),ct(r,Ir,fe=>t(20,g=fe));let{wasmReady:_}=e,x="";if(ln(Ir,g=null,g),ln(tp,p=null,p),ln($s,d=void 0,d),s){let Ee=new URLSearchParams(window.location.search).get("project");Ee&&T(Ee),ln(J0,s=!1,s)}else{let fe=new URL(window.location.href);fe.searchParams.delete("project"),window.history.replaceState(null,"",fe.toString())}if(o&&!s){let fe=[-180,-90,180,90];u=="cnt"&&(fe=[-8.943,54.631,-.901,59.489]),o.fitBounds(fe,{duration:500})}let C=i.studyAreaProjects();function T(fe){let Ee=fe;try{let ee=i.projectName(Ee);if(!ee){console.error(`Project ${Ee} from URL not found`);return}E(Ee,ee)}catch{console.error(`Error trying to fetch project from URL: ${Ee}`)}}function P(fe,Ee){window.confirm(`Really delete project ${Ee}? You can't undo this.`)&&(i.removeProject(fe),t(2,C=i.studyAreaProjects()))}function I(fe,Ee){let ee=window.prompt(`Rename project ${Ee} to what?`,Ee);if(ee){try{i.renameProject(fe,ee)}catch(ie){window.alert(`Couldn't rename project: ${ie}`)}t(2,C=i.studyAreaProjects())}}async function E(fe,Ee){t(1,x=`Loading project ${Ee}`),await vp(fe),ln(tr,n={mode:"pick-neighbourhood"},n),t(1,x="")}const L=(fe,Ee)=>E(fe,Ee),O=fe=>A2(fe),F=(fe,Ee)=>I(fe,Ee),Z=(fe,Ee)=>P(fe,Ee),K=()=>ln(tr,n={mode:"new-project"},n);function q(fe){x=fe,t(1,x)}function J(fe){x=fe,t(1,x)}return r.$$set=fe=>{"wasmReady"in fe&&t(0,_=fe.wasmReady)},[_,x,C,n,o,u,P,I,E,L,O,F,Z,K,q,J]}class LR extends Et{constructor(e){super(),Mt(this,e,ER,MR,St,{wasmReady:0})}}function IR(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=yr(r[1].mode)+"",P,I;return o=new Fn({props:{mode:{mode:"title"}}}),d=new Fn({props:{mode:{mode:"pick-neighbourhood"}}}),_=new Fn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Me(T),de(t,"aria-label","breadcrumb"),de(e,"slot","top")},m(E,L){G(E,e,L),B(e,t),B(t,n),B(n,i),ae(o,i,null),B(n,u),B(n,s),ae(d,s,null),B(n,p),B(n,g),ae(_,g,null),B(n,x),B(n,C),B(C,P),I=!0},p(E,L){(!I||L&2)&&T!==(T=yr(E[1].mode)+"")&&kt(P,T)},i(E){I||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),I=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),I=!1},d(E){E&&H(e),le(o),le(d),le(_)}}}function PR(r){let e,t,n,i,o,u,s,d,p,g,_=mr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",x,C,T,P,I,E;function L(F){r[4](F)}let O={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(O.idx=r[0].shortcutIndex),o=new up({props:O}),dn.push(()=>Dn(o,"idx",L)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=oe(),n=U("button"),n.textContent="Pick a different road",i=oe(),ue(o.$$.fragment),s=oe(),d=U("p"),p=Me("This shortcut is "),g=U("b"),x=Me(_),C=Me("x"),T=Me(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(F,Z){G(F,e,Z),G(F,t,Z),G(F,n,Z),G(F,i,Z),ae(o,F,Z),G(F,s,Z),G(F,d,Z),B(d,p),B(d,g),B(g,x),B(g,C),B(d,T),P=!0,I||(E=Lt(n,"click",r[3]),I=!0)},p(F,Z){const K={};Z&1&&(K.list=F[0].gj.features),!u&&Z&1&&(u=!0,K.idx=F[0].shortcutIndex,zn(()=>u=!1)),o.$set(K),(!P||Z&1)&&_!==(_=mr(F[0].gj.features[F[0].shortcutIndex].properties).directness.toFixed(1)+"")&&kt(x,_)},i(F){P||(N(o.$$.fragment,F),P=!0)},o(F){V(o.$$.fragment,F),P=!1},d(F){F&&(H(e),H(t),H(n),H(i),H(s),H(d)),le(o,F),I=!1,E()}}}function zR(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){G(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}function DR(r){let e,t,n,i,o,u;t=new Us({props:{mode:{mode:"neighbourhood"}}});const s=[zR,PR],d=[];function p(g,_){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=s[i](r)),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),o&&o.c(),de(e,"slot","sidebar")},m(g,_){G(g,e,_),ae(t,e,null),B(e,n),~i&&d[i].m(e,null),u=!0},p(g,_){let x=i;i=p(g),i===x?~i&&d[i].p(g,_):(o&&(Kt(),V(d[x],1,1,()=>{d[x]=null}),Jt()),~i?(o=d[i],o?o.p(g,_):(o=d[i]=s[i](g),o.c()),N(o,1),o.m(e,null)):o=null)},i(g){u||(N(t.$$.fragment,g),N(o),u=!0)},o(g){V(t.$$.fragment,g),V(o),u=!1},d(g){g&&H(e),le(t),~i&&d[i].d()}}}function RR(r){let e,t;return e=new uh({props:{interactive:!1}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function BR(r){let e,t;return e=new uh({props:{onClickLine:r[2],$$slots:{"line-popup":[NR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function FR(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=U("p"),t=Me("Main road: "),i=Me(n)},m(o,u){G(o,e,u),B(e,t),B(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&kt(i,n)},d(o){o&&H(e)}}}function OR(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=U("p"),n=Me(t),i=Me(" shortcuts through "),u=Me(o)},m(s,d){G(s,e,d),B(e,n),B(e,i),B(e,u)},p(s,d){d&64&&t!==(t=s[6].shortcuts+"")&&kt(n,t),d&64&&o!==(o=(s[6].name??"unnamed road")+"")&&kt(u,o)},d(s){s&&H(e)}}}function $R(r){let e;function t(o,u){if(o[6].kind=="interior_road")return OR;if(o[6].kind=="main_road")return FR}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=nr()},m(o,u){i&&i.m(o,u),G(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function NR(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[$R,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"slot","line-popup")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function jR(r){let e,t,n,i,o,u,s,d,p,g;e=new _p({}),n=new gp({}),o=new yp({});const _=[BR,RR],x=[];function C(T,P){return T[0].state=="neutral"?0:T[0].state=="chose-road"?1:-1}return~(s=C(r))&&(d=x[s]=_[s](r)),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),d&&d.c(),p=nr()},m(T,P){ae(e,T,P),G(T,t,P),ae(n,T,P),G(T,i,P),ae(o,T,P),G(T,u,P),~s&&x[s].m(T,P),G(T,p,P),g=!0},p(T,P){let I=s;s=C(T),s===I?~s&&x[s].p(T,P):(d&&(Kt(),V(x[I],1,1,()=>{x[I]=null}),Jt()),~s?(d=x[s],d?d.p(T,P):(d=x[s]=_[s](T),d.c()),N(d,1),d.m(p.parentNode,p)):d=null)},i(T){g||(N(e.$$.fragment,T),N(n.$$.fragment,T),N(o.$$.fragment,T),N(d),g=!0)},o(T){V(e.$$.fragment,T),V(n.$$.fragment,T),V(o.$$.fragment,T),V(d),g=!1},d(T){T&&(H(t),H(i),H(u),H(p)),le(e,T),le(n,T),le(o,T),~s&&x[s].d(T)}}}function qb(r){let e,t,n,i,o,u,s,d;return e=new _r({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[UR]},$$scope:{ctx:r}}}),n=new _r({props:{data:r[0].roadGj,$$slots:{default:[VR]},$$scope:{ctx:r}}}),o=new Bl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[qR]},$$scope:{ctx:r}}}),s=new Bl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[HR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),G(p,t,g),ae(n,p,g),G(p,i,g),ae(o,p,g),G(p,u,g),ae(s,p,g),d=!0},p(p,g){const _={};g&1&&(_.data=p[0].gj.features[p[0].shortcutIndex]),g&128&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};g&1&&(x.data=p[0].roadGj),g&128&&(x.$$scope={dirty:g,ctx:p}),n.$set(x);const C={};g&1&&(C.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&128&&(C.$$scope={dirty:g,ctx:p}),o.$set(C);const T={};g&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&128&&(T.$$scope={dirty:g,ctx:p}),s.$set(T)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(H(t),H(i),H(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function UR(r){let e,t;const n=[_n("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function VR(r){let e,t;const n=[_n("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function qR(r){let e;return{c(){e=Me("A")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function HR(r){let e;return{c(){e=Me("B")},m(t,n){G(t,e,n)},d(t){t&&H(e)}}}function GR(r){let e,t,n,i,o,u;t=new ch({props:{$$slots:{default:[jR]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&qb(r);return o=new el({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),s&&s.c(),i=oe(),ue(o.$$.fragment),de(e,"slot","map")},m(d,p){G(d,e,p),ae(t,e,null),B(e,n),s&&s.m(e,null),B(e,i),ae(o,e,null),u=!0},p(d,p){const g={};p&129&&(g.$$scope={dirty:p,ctx:d}),t.$set(g),d[0].state=="chose-road"?s?(s.p(d,p),p&1&&N(s,1)):(s=qb(d),s.c(),N(s,1),s.m(e,i)):s&&(Kt(),V(s,1,1,()=>{s=null}),Jt())},i(d){u||(N(t.$$.fragment,d),N(s),N(o.$$.fragment,d),u=!0)},o(d){V(t.$$.fragment,d),V(s),V(o.$$.fragment,d),u=!1},d(d){d&&H(e),le(t),s&&s.d(),le(o)}}}function WR(r){let e,t;return e=new ko({props:{$$slots:{map:[GR],sidebar:[DR],top:[IR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ZR(r,e,t){let n,i;ct(r,Ir,p=>t(5,n=p)),ct(r,tr,p=>t(1,i=p));let o={state:"neutral"};function u(p,g){let _=n.getShortcutsCrossingRoad(p.properties.id);if(_.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:p,gj:_,shortcutIndex:0})}const s=()=>t(0,o={state:"neutral"});function d(p){r.$$.not_equal(o.shortcutIndex,p)&&(o.shortcutIndex=p,t(0,o))}return[o,i,u,s,d]}class XR extends Et{constructor(e){super(),Mt(this,e,ZR,WR,St,{})}}function KR(r){let e,t,n,i,o,u;return{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${mk}" style="height: 32px;" alt="A/B Street logo"/>`,n=oe(),i=U("span"),de(t,"class","outline"),Ye(i,"width","100%"),de(e,"slot","top"),de(e,"class","pico"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","8px")},m(s,d){G(s,e,d),B(e,t),B(e,n),B(e,i),r[24](i),o||(u=Lt(t,"click",r[23]),o=!0)},p:at,d(s){s&&H(e),r[24](null),o=!1,u()}}}function JR(r){let e,t;return{c(){e=U("div"),t=U("div"),de(e,"class","pico"),de(e,"slot","left")},m(n,i){G(n,e,i),B(e,t),r[22](t)},p:at,d(n){n&&H(e),r[22](null)}}}function YR(r){return{c:at,m:at,p:at,i:at,o:at,d:at}}function QR(r){let e,t,n;function i(u){r[20](u)}let o={style:r[27],hash:!0,bounds:r[5],maxZoom:19,images:[{id:Ri.walkCycleOnly.filterType,url:Ri.walkCycleOnly.iconURL},{id:Ri.noEntry.filterType,url:Ri.noEntry.iconURL},{id:Ri.busGate.filterType,url:Ri.busGate.iconURL},{id:Ri.schoolStreet.filterType,url:Ri.schoolStreet.iconURL},{id:"diagonal_filter",url:pk},{id:"no_straight_turn",url:ew},{id:"no_left_turn",url:Qb},{id:"no_right_turn",url:Dg},{id:"no_u_left_to_right_turn",url:nw},{id:"no_u_right_to_left_turn",url:tw},{id:"oneway_arrow",url:dk},{id:"border_entry_arrow",url:hk,options:{sdf:!0}},{id:"national_rail",url:rw}],$$slots:{default:[bB]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new ES({props:o}),dn.push(()=>Dn(e,"map",i)),e.$on("error",r[21]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};s&512&&(d.style=u[27]),s&32&&(d.bounds=u[5]),s&268437209&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.map=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function Hb(r){let e,t,n,i;return e=new tg({props:{position:"top-left",$$slots:{default:[nB]},$$scope:{ctx:r}}}),n=new tg({props:{position:"top-left",$$slots:{default:[iB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),G(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&268435456&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&268436096&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function eB(r){let e,t,n;return t=new s4({}),{c(){e=U("div"),ue(t.$$.fragment),de(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){G(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function tB(r){let e,t;return e=new Iw({props:{title:"Zoom to fit study area",$$slots:{default:[eB]},$$scope:{ctx:r}}}),e.$on("click",r[18]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function nB(r){let e,t;return e=new Pw({props:{$$slots:{default:[tB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function rB(r){let e,t;return e=new UT({props:{map:mr(r[7]),maptilerBasemap:r[9]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.map=mr(n[7])),i&512&&(o.maptilerBasemap=n[9]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function iB(r){let e,t;return e=new Pw({props:{$$slots:{default:[rB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268436096&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function oB(r){let e,t;return e=new uR({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function sB(r){let e,t;return e=new LR({props:{wasmReady:r[4]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Gb(r){let e,t,n,i,o,u;e=new _r({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[aB]},$$scope:{ctx:r}}});const s=[vB,yB,_B,gB,mB,pB,dB,hB,fB,cB,uB,lB],d=[];function p(g,_){return g[10].mode=="pick-neighbourhood"?0:g[10].mode=="set-boundary"?1:g[10].mode=="add-neighbourhood"?2:g[10].mode=="neighbourhood"?3:g[10].mode=="view-shortcuts"?4:g[10].mode=="impact-one-destination"?5:g[10].mode=="route"?6:g[10].mode=="predict-impact"?7:g[10].mode=="impact-detail"?8:g[10].mode=="debug-neighbourhood"?9:g[10].mode=="debug-intersections"?10:g[10].mode=="debug-demand"?11:-1}return~(n=p(r))&&(i=d[n]=s[n](r)),{c(){ue(e.$$.fragment),t=oe(),i&&i.c(),o=nr()},m(g,_){ae(e,g,_),G(g,t,_),~n&&d[n].m(g,_),G(g,o,_),u=!0},p(g,_){const x={};_&64&&(x.data=g[6].getInvertedBoundary()),_&268435456&&(x.$$scope={dirty:_,ctx:g}),e.$set(x);let C=n;n=p(g),n===C?~n&&d[n].p(g,_):(i&&(Kt(),V(d[C],1,1,()=>{d[C]=null}),Jt()),~n?(i=d[n],i?i.p(g,_):(i=d[n]=s[n](g),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(g){u||(N(e.$$.fragment,g),N(i),u=!0)},o(g){V(e.$$.fragment,g),V(i),u=!1},d(g){g&&(H(t),H(o)),le(e,g),~n&&d[n].d(g)}}}function aB(r){let e,t;const n=[_n("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Ji({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function lB(r){let e,t;return e=new L8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function uB(r){let e,t;return e=new O8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cB(r){let e,t;return e=new EP({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function fB(r){let e,t;return e=new n7({props:{road:r[10].road,prevPrevMode:r[10].prevPrevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),i&1024&&(o.prevPrevMode=n[10].prevPrevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hB(r){let e,t;return e=new W7({props:{prevMode:r[10].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function dB(r){let e,t;return e=new aD({props:{prevMode:r[10].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function pB(r){let e,t;return e=new b7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function mB(r){let e,t;return e=new XR({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gB(r){let e,t;return e=new Wz({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function _B(r){let e,t;return e=new d8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yB(r){let e,t;return e=new hD({props:{name:r[10].name,existing:r[10].existing}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function vB(r){let e,t;return e=new B7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function bB(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,P,I,E;e=new Rw({});let L=r[6]&&Hb(r);i=new I6({props:{map:r[0],apiKey:kw,country:void 0}}),u=new Bw({});const O=[sB,oB],F=[];function Z(q,J){return q[10].mode=="title"?0:q[10].mode=="new-project"?1:-1}~(g=Z(r))&&(_=F[g]=O[g](r)),C=new eI({});let K=r[6]&&Gb(r);return I=new fT({}),{c(){ue(e.$$.fragment),t=oe(),L&&L.c(),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),s=oe(),d=U("div"),p=oe(),_&&_.c(),x=oe(),ue(C.$$.fragment),T=oe(),K&&K.c(),P=oe(),ue(I.$$.fragment)},m(q,J){ae(e,q,J),G(q,t,J),L&&L.m(q,J),G(q,n,J),ae(i,q,J),G(q,o,J),ae(u,q,J),G(q,s,J),G(q,d,J),r[19](d),G(q,p,J),~g&&F[g].m(q,J),G(q,x,J),ae(C,q,J),G(q,T,J),K&&K.m(q,J),G(q,P,J),ae(I,q,J),E=!0},p(q,J){q[6]?L?(L.p(q,J),J&64&&N(L,1)):(L=Hb(q),L.c(),N(L,1),L.m(n.parentNode,n)):L&&(Kt(),V(L,1,1,()=>{L=null}),Jt());const fe={};J&1&&(fe.map=q[0]),i.$set(fe);let Ee=g;g=Z(q),g===Ee?~g&&F[g].p(q,J):(_&&(Kt(),V(F[Ee],1,1,()=>{F[Ee]=null}),Jt()),~g?(_=F[g],_?_.p(q,J):(_=F[g]=O[g](q),_.c()),N(_,1),_.m(x.parentNode,x)):_=null),q[6]?K?(K.p(q,J),J&64&&N(K,1)):(K=Gb(q),K.c(),N(K,1),K.m(P.parentNode,P)):K&&(Kt(),V(K,1,1,()=>{K=null}),Jt())},i(q){E||(N(e.$$.fragment,q),N(L),N(i.$$.fragment,q),N(u.$$.fragment,q),N(_),N(C.$$.fragment,q),N(K),N(I.$$.fragment,q),E=!0)},o(q){V(e.$$.fragment,q),V(L),V(i.$$.fragment,q),V(u.$$.fragment,q),V(_),V(C.$$.fragment,q),V(K),V(I.$$.fragment,q),E=!1},d(q){q&&(H(t),H(n),H(o),H(s),H(d),H(p),H(x),H(T),H(P)),le(e,q),L&&L.d(q),le(i,q),le(u,q),r[19](null),~g&&F[g].d(q),le(C,q),K&&K.d(q),le(I,q)}}}function wB(r){return{c:at,m:at,p:at,i:at,o:at,d:at}}function xB(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:wB,then:QR,catch:YR,value:27,blocks:[,,,]};return q0(t=r[13](r[9]),i),{c(){e=U("div"),i.block.c(),de(e,"slot","main"),Ye(e,"position","relative"),Ye(e,"width","100%"),Ye(e,"height","100%")},m(o,u){G(o,e,u),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,u){r=o,i.ctx=r,u&512&&t!==(t=r[13](r[9]))&&q0(t,i)||ak(i,r,u)},i(o){n||(N(i.block),n=!0)},o(o){for(let u=0;u<3;u+=1){const s=i.blocks[u];V(s)}n=!1},d(o){o&&H(e),i.block.d(),i.token=null,i=null}}}function AB(r){let e,t,n,i,o,u,s;return t=new x3({}),o=new mI({props:{$$slots:{main:[xB],left:[JR],top:[KR]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),ue(o.$$.fragment),de(e,"class","pico"),de(i,"class",u="app-focus-"+r[8])},m(d,p){G(d,e,p),ae(t,e,null),G(d,n,p),G(d,i,p),ae(o,i,null),s=!0},p(d,[p]){const g={};p&268439295&&(g.$$scope={dirty:p,ctx:d}),o.$set(g),(!s||p&256&&u!==(u="app-focus-"+d[8]))&&de(i,"class",u)},i(d){s||(N(t.$$.fragment,d),N(o.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(o.$$.fragment,d),s=!1},d(d){d&&(H(e),H(n),H(i)),le(t),le(o)}}}function kB(r,e,t){let n,i,o,u,s,d,p,g,_,x,C;ct(r,Sg,ye=>t(15,n=ye)),ct(r,kg,ye=>t(16,i=ye)),ct(r,Ag,ye=>t(17,o=ye)),ct(r,Ir,ye=>t(6,u=ye)),ct(r,as,ye=>t(7,s=ye)),ct(r,zf,ye=>t(25,d=ye)),ct(r,Qm,ye=>t(26,p=ye)),ct(r,As,ye=>t(8,g=ye)),ct(r,Zm,ye=>t(9,_=ye)),ct(r,tr,ye=>t(10,x=ye)),ct(r,Gd,ye=>t(11,C=ye));let{appFocus:T="global"}=e;As.set(T);let P=!1;ks(async()=>{await V2(),await uw(),t(4,P=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(ln(Qm,p=!0,p),console.log("Using local cache, not od2net.org"))}catch{}let ye=new URLSearchParams(window.location.search).get("dev");ye==="true"||ye===""?ln(zf,d=!0,d):(console.assert(ye===null||ye=="false",`unknown dev mode value: ${ye}, should be "true", "false", or empty`),ln(zf,d=!1,d))});let I=null;function E(ye){s.fitBounds(u.getBounds(),{animate:ye})}let L,O,F,Z;T=="cnt"&&(Z=[-8.943,54.631,-.901,59.489]);async function K(ye){return ye=="streets-v2"?wI:`https://api.maptiler.com/maps/${ye}/style.json?key=${kw}`}const q=()=>E(!0);function J(ye){dn[ye?"unshift":"push"](()=>{F=ye,t(3,F),t(15,n)})}function fe(ye){I=ye,t(0,I)}const Ee=ye=>{console.log(ye.detail.error)};function ee(ye){dn[ye?"unshift":"push"](()=>{O=ye,t(2,O),t(16,i)})}const ie=()=>ln(Gd,C=!0,C);function ve(ye){dn[ye?"unshift":"push"](()=>{L=ye,t(1,L),t(17,o)})}return r.$$set=ye=>{"appFocus"in ye&&t(14,T=ye.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&I&&as.set(I),r.$$.dirty&131074&&L&&o&&(t(1,L.innerHTML="",L),L.appendChild(o)),r.$$.dirty&65540&&O&&i&&(t(2,O.innerHTML="",O),O.appendChild(i)),r.$$.dirty&32776&&F&&n&&(t(3,F.innerHTML="",F),F.appendChild(n))},[I,L,O,F,P,Z,u,s,g,_,x,C,E,K,T,n,i,o,q,J,fe,Ee,ee,ie,ve]}class zB extends Et{constructor(e){super(),Mt(this,e,kB,AB,St,{appFocus:14})}}export{zB as A};
